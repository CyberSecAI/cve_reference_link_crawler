=== Content from github.com_63b4d284_20250111_124956.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F5585334d772b253a01a6730e8202ffb1607c3d25)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F5585334d772b253a01a6730e8202ffb1607c3d25)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/5585334d772b253a01a6730e8202ffb1607c3d25)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.11] [gh-91133](https://github.com/python/cpython/issues/91133): tempfile.TemporaryDirectory: fix symlink bug in clea…

[Browse files](/python/cpython/tree/5585334d772b253a01a6730e8202ffb1607c3d25)
Browse the repository at this point in the history

```
…nup ([GH-99930](https://github.com/python/cpython/pull/99930)) ([GH-112839](https://github.com/python/cpython/pull/112839))

(cherry picked from commit [81c16cd](https://github.com/python/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
```

* Loading branch information

[![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&v=4)](/serhiy-storchaka) [![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&v=4)](/kwi-dk)

[serhiy-storchaka](/python/cpython/commits?author=serhiy-storchaka "View all commits by serhiy-storchaka")
and
[kwi-dk](/python/cpython/commits?author=kwi-dk "View all commits by kwi-dk")
authored
Dec 7, 2023

1 parent
[666a484](/python/cpython/commit/666a484d295fc96cf8efad4a5d83639dc21cd5e0)

commit 5585334

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**125 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib

  + Lib/tempfile.py
    [tempfile.py](#diff-6553a99f3ae04c9fc9c2349ac27037bfe3b274d5ca54d5800d9c5b5f11e29d21)
  + test

    - Lib/test/test\_tempfile.py
      [test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983)
* Misc/NEWS.d/next/Library

  + Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst
    [2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst](#diff-f4f1ac9bf7b7e0f7c86de7e7cf998e1d40cbb748dc8a4f8c040364806139e39c)

## There are no files selected for viewing

27 changes: 18 additions & 9 deletions

27
[Lib/tempfile.py](#diff-6553a99f3ae04c9fc9c2349ac27037bfe3b274d5ca54d5800d9c5b5f11e29d21 "Lib/tempfile.py")

Show comments

[View file](/python/cpython/blob/5585334d772b253a01a6730e8202ffb1607c3d25/Lib/tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -270,6 +270,22 @@ def \_mkstemp\_inner(dir, pre, suf, flags, output\_type): |
|  |  | raise FileExistsError(\_errno.EEXIST, |
|  |  | "No usable temporary file name found") |
|  |  |  |
|  |  | def \_dont\_follow\_symlinks(func, path, \*args): |
|  |  | # Pass follow\_symlinks=False, unless not supported on this platform. |
|  |  | if func in \_os.supports\_follow\_symlinks: |
|  |  | func(path, \*args, follow\_symlinks=False) |
|  |  | elif \_os.name == 'nt' or not \_os.path.islink(path): |
|  |  | func(path, \*args) |
|  |  |  |
|  |  | def \_resetperms(path): |
|  |  | try: |
|  |  | chflags = \_os.chflags |
|  |  | except AttributeError: |
|  |  | pass |
|  |  | else: |
|  |  | \_dont\_follow\_symlinks(chflags, path, 0) |
|  |  | \_dont\_follow\_symlinks(\_os.chmod, path, 0o700) |
|  |  |  |
|  |  |  |
|  |  | # User visible interfaces. |
|  |  |  |
| Expand Down  Expand Up | | @@ -863,17 +879,10 @@ def \_\_init\_\_(self, suffix=None, prefix=None, dir=None, |
|  |  | def \_rmtree(cls, name, ignore\_errors=False): |
|  |  | def onerror(func, path, exc\_info): |
|  |  | if issubclass(exc\_info[0], PermissionError): |
|  |  | def resetperms(path): |
|  |  | try: |
|  |  | \_os.chflags(path, 0) |
|  |  | except AttributeError: |
|  |  | pass |
|  |  | \_os.chmod(path, 0o700) |
|  |  |  |
|  |  | try: |
|  |  | if path != name: |
|  |  | resetperms(\_os.path.dirname(path)) |
|  |  | resetperms(path) |
|  |  | \_resetperms(\_os.path.dirname(path)) |
|  |  | \_resetperms(path) |
|  |  |  |
|  |  | try: |
|  |  | \_os.unlink(path) |
| Expand Down | |  |

111 changes: 105 additions & 6 deletions

111
[Lib/test/test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983 "Lib/test/test_tempfile.py")

Show comments

[View file](/python/cpython/blob/5585334d772b253a01a6730e8202ffb1607c3d25/Lib/test/test_tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1565,6 +1565,103 @@ def test\_cleanup\_with\_symlink\_to\_a\_directory(self): |
|  |  | "were deleted") |
|  |  | d2.cleanup() |
|  |  |  |
|  |  | @os\_helper.skip\_unless\_symlink |
|  |  | def test\_cleanup\_with\_symlink\_modes(self): |
|  |  | # cleanup() should not follow symlinks when fixing mode bits (#91133) |
|  |  | with self.do\_create(recurse=0) as d2: |
|  |  | file1 = os.path.join(d2, 'file1') |
|  |  | open(file1, 'wb').close() |
|  |  | dir1 = os.path.join(d2, 'dir1') |
|  |  | os.mkdir(dir1) |
|  |  | for mode in range(8): |
|  |  | mode <<= 6 |
|  |  | with self.subTest(mode=format(mode, '03o')): |
|  |  | def test(target, target\_is\_directory): |
|  |  | d1 = self.do\_create(recurse=0) |
|  |  | symlink = os.path.join(d1.name, 'symlink') |
|  |  | os.symlink(target, symlink, |
|  |  | target\_is\_directory=target\_is\_directory) |
|  |  | try: |
|  |  | os.chmod(symlink, mode, follow\_symlinks=False) |
|  |  | except NotImplementedError: |
|  |  | pass |
|  |  | try: |
|  |  | os.chmod(symlink, mode) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | os.chmod(d1.name, mode) |
|  |  | d1.cleanup() |
|  |  | self.assertFalse(os.path.exists(d1.name)) |
|  |  |  |
|  |  | with self.subTest('nonexisting file'): |
|  |  | test('nonexisting', target\_is\_directory=False) |
|  |  | with self.subTest('nonexisting dir'): |
|  |  | test('nonexisting', target\_is\_directory=True) |
|  |  |  |
|  |  | with self.subTest('existing file'): |
|  |  | os.chmod(file1, mode) |
|  |  | old\_mode = os.stat(file1).st\_mode |
|  |  | test(file1, target\_is\_directory=False) |
|  |  | new\_mode = os.stat(file1).st\_mode |
|  |  | self.assertEqual(new\_mode, old\_mode, |
|  |  | '%03o != %03o' % (new\_mode, old\_mode)) |
|  |  |  |
|  |  | with self.subTest('existing dir'): |
|  |  | os.chmod(dir1, mode) |
|  |  | old\_mode = os.stat(dir1).st\_mode |
|  |  | test(dir1, target\_is\_directory=True) |
|  |  | new\_mode = os.stat(dir1).st\_mode |
|  |  | self.assertEqual(new\_mode, old\_mode, |
|  |  | '%03o != %03o' % (new\_mode, old\_mode)) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | @os\_helper.skip\_unless\_symlink |
|  |  | def test\_cleanup\_with\_symlink\_flags(self): |
|  |  | # cleanup() should not follow symlinks when fixing flags (#91133) |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  | self.check\_flags(flags) |
|  |  |  |
|  |  | with self.do\_create(recurse=0) as d2: |
|  |  | file1 = os.path.join(d2, 'file1') |
|  |  | open(file1, 'wb').close() |
|  |  | dir1 = os.path.join(d2, 'dir1') |
|  |  | os.mkdir(dir1) |
|  |  | def test(target, target\_is\_directory): |
|  |  | d1 = self.do\_create(recurse=0) |
|  |  | symlink = os.path.join(d1.name, 'symlink') |
|  |  | os.symlink(target, symlink, |
|  |  | target\_is\_directory=target\_is\_directory) |
|  |  | try: |
|  |  | os.chflags(symlink, flags, follow\_symlinks=False) |
|  |  | except NotImplementedError: |
|  |  | pass |
|  |  | try: |
|  |  | os.chflags(symlink, flags) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | os.chflags(d1.name, flags) |
|  |  | d1.cleanup() |
|  |  | self.assertFalse(os.path.exists(d1.name)) |
|  |  |  |
|  |  | with self.subTest('nonexisting file'): |
|  |  | test('nonexisting', target\_is\_directory=False) |
|  |  | with self.subTest('nonexisting dir'): |
|  |  | test('nonexisting', target\_is\_directory=True) |
|  |  |  |
|  |  | with self.subTest('existing file'): |
|  |  | os.chflags(file1, flags) |
|  |  | old\_flags = os.stat(file1).st\_flags |
|  |  | test(file1, target\_is\_directory=False) |
|  |  | new\_flags = os.stat(file1).st\_flags |
|  |  | self.assertEqual(new\_flags, old\_flags) |
|  |  |  |
|  |  | with self.subTest('existing dir'): |
|  |  | os.chflags(dir1, flags) |
|  |  | old\_flags = os.stat(dir1).st\_flags |
|  |  | test(dir1, target\_is\_directory=True) |
|  |  | new\_flags = os.stat(dir1).st\_flags |
|  |  | self.assertEqual(new\_flags, old\_flags) |
|  |  |  |
|  |  | @support.cpython\_only |
|  |  | def test\_del\_on\_collection(self): |
|  |  | # A TemporaryDirectory is deleted when garbage collected |
| Expand Down  Expand Up | | @@ -1737,10 +1834,7 @@ def test\_modes(self): |
|  |  | d.cleanup() |
|  |  | self.assertFalse(os.path.exists(d.name)) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | def test\_flags(self): |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  |  |
|  |  | def check\_flags(self, flags): |
|  |  | # skip the test if these flags are not supported (ex: FreeBSD 13) |
|  |  | filename = os\_helper.TESTFN |
|  |  | try: |
| Expand All | | @@ -1749,13 +1843,18 @@ def test\_flags(self): |
|  |  | os.chflags(filename, flags) |
|  |  | except OSError as exc: |
|  |  | # "OSError: [Errno 45] Operation not supported" |
|  |  | self.skipTest(f"chflags() doesn't support " |
|  |  | f"UF\_IMMUTABLE|UF\_NOUNLINK: {exc}") |
|  |  | self.skipTest(f"chflags() doesn't support flags " |
|  |  | f"{flags:#b}: {exc}") |
|  |  | else: |
|  |  | os.chflags(filename, 0) |
|  |  | finally: |
|  |  | os\_helper.unlink(filename) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | def test\_flags(self): |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  | self.check\_flags(flags) |
|  |  |  |
|  |  | d = self.do\_create(recurse=3, dirs=2, files=2) |
|  |  | with d: |
|  |  | # Change files and directories flags recursively. |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst](#diff-f4f1ac9bf7b7e0f7c86de7e7cf998e1d40cbb748dc8a4f8c040364806139e39c "Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst")

Show comments

[View file](/python/cpython/blob/5585334d772b253a01a6730e8202ffb1607c3d25/Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,2 @@ |
|  |  | Fix a bug in :class:`tempfile.TemporaryDirectory` cleanup, which now no longer |
|  |  | dereferences symlinks when working around file system permission errors. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `5585334`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F5585334d772b253a01a6730e8202ffb1607c3d25) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from mail.python.org_3d3a7998_20250111_125004.html ===


[Mailman 3 python.org](/archives/)

[Sign In](/accounts/login/?next=/archives/list/security-announce%40python.org/thread/Q5C6ATFC67K53XFV4KE45325S7NS62LD/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40python.org/thread/Q5C6ATFC67K53XFV4KE45325S7NS62LD/)

[Manage this list](/mailman3/lists/security-announce.python.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40python.org/thread/Q5C6ATFC67K53XFV4KE45325S7NS62LD/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40python.org/thread/Q5C6ATFC67K53XFV4KE45325S7NS62LD/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[newer](/archives/list/security-announce%40python.org/thread/PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636/ "[CVE-2024-4030] tempfile.mkdtemp() may be readable and writeable by all users on Windows")

[[CVE-2024-4030] tempfile.mkdtemp()...](/archives/list/security-announce%40python.org/thread/PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636/ "[CVE-2024-4030] tempfile.mkdtemp() may be readable and writeable by all users on Windows")

### [CVE-2023-6597] tempfile.TemporaryDirectory dereferences symlinks during cleanup

[older](/archives/list/security-announce%40python.org/thread/XELNUX2L3IOHBTFU7RQHCY6OUVEWZ2FG/ "[CVE-2024-0450] Quoted zip-bomb protection for zipfile")

[[CVE-2024-0450] Quoted zip-bomb...](/archives/list/security-announce%40python.org/thread/XELNUX2L3IOHBTFU7RQHCY6OUVEWZ2FG/ "[CVE-2024-0450] Quoted zip-bomb protection for zipfile")

![](https://secure.gravatar.com/avatar/f96e020357b4a421390564f722b130b2.jpg?s=120&d=mm&r=g)

## [Ee Durbin](/archives/users/d2f5d45d0c1a45e1937afd7600b2a3fa/ "See the profile for Ee Durbin")

19 Mar
2024

19 Mar
'24

3:10 p.m.

An issue was found in the CPython `tempfile.TemporaryDirectory` class
affecting versions 3.12.2, 3.11.8, 3.10.13, 3.9.18, and 3.8.18 and prior.

The tempfile.TemporaryDirectory class would dereference symlinks during
cleanup of permissions-related errors. This means users which can run
privileged programs are potentially able to modify permissions of files
referenced by symlinks in some circumstances.

*\*References\**

* CVE: <https://www.cve.org/CVERecord?id=CVE-2023-6597>
* Patch: <https://github.com/python/cpython/pull/99930>
* Issue: <https://github.com/python/cpython/issues/91133>

Attachments:

* [attachment.html](/archives/list/security-announce%40python.org/message/Q5C6ATFC67K53XFV4KE45325S7NS62LD/attachment/2/attachment.html)
  (text/html — 877 bytes)

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40python.org/thread/Q5C6ATFC67K53XFV4KE45325S7NS62LD/)
Use email software

[Show replies by date](/archives/list/security-announce%40python.org/thread/Q5C6ATFC67K53XFV4KE45325S7NS62LD/?sort=date)

![Loading...](/static/hyperkitty/img/ajax-loader.gif)
[Visit here for a non-javascript version of this page.](/archives/list/security-announce%40python.org/thread/Q5C6ATFC67K53XFV4KE45325S7NS62LD/?noscript)

298
Age (days ago)

298
Last active (days ago)

[List overview](/archives/list/security-announce%40python.org/)

[Download](/archives/list/security-announce%40python.org/export/security-announce%40python.org-Q5C6ATFC67K53XFV4KE45325S7NS62LD.mbox.gz?thread=Q5C6ATFC67K53XFV4KE45325S7NS62LD "This thread in gzipped mbox format")

0 comments

1 participants

[Add to favorites](#AddFav "You must be logged-in to have favorites.")
[Remove from favorites](#RmFav)

### tags

### participants (1)

* ![](https://secure.gravatar.com/avatar/f96e020357b4a421390564f722b130b2.jpg?s=48&d=mm&r=g)
  Ee Durbin

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from www.openwall.com_27933240_20250111_124954.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](4) [[next>]](../../../2024/03/21/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <77dc10fa-9ef5-4314-9093-fbc392778ca8@oracle.com>
Date: Wed, 20 Mar 2024 16:35:37 -0700
From: Alan Coopersmith <alan.coopersmith@...cle.com>
To: oss-security@...ts.openwall.com
Subject: Security fixes in Python 3.10.14, 3.9.19, and 3.8.19 (CVE-2023-6597 &
 CVE-2024-0450)

<https://discuss.python.org/t/python-3-10-14-3-9-19-and-3-8-19-is-now-available/48993>
announces the availability of Python 3.10.14, 3.9.19, and 3.8.19,
including these security fixes (see above URL for links to details on each):

- gh-115399 & gh-115398: bundled libexpat was updated to 2.6.0 to address
   CVE-2023-52425, and control of the new reparse deferral functionality was
   exposed with new APIs. Thanks to Sebastian Pipping, the maintainer of
   libexpat, who worked with us directly on incorporating those fixes!

- gh-109858 : zipfile is now protected from the “quoted-overlap” zipbomb to
   address CVE-2024-0450 . It now raises BadZipFile when attempting to read an
   entry that overlaps with another entry or central directory

- gh-91133: tempfile.TemporaryDirectory cleanup no longer dereferences symlinks
   when working around file system permission errors to address CVE-2023-6597

- gh-115197: urllib.request no longer resolves the hostname before checking it
   against the system’s proxy bypass list on macOS and Windows

- gh-81194: a crash in socket.if_indextoname() with a specific value (UINT_MAX)
   was fixed. Relatedly, an integer overflow in socket.if_indextoname() on 64-bit
   non-Windows platforms was fixed

- gh-113659: .pth files with names starting with a dot or containing the hidden
   file attribute are now skipped

- gh-102388: iso2022_jp_3 and iso2022_jp_2004 codecs no longer read out of
   bounds

- gh-114572 : ssl.SSLContext.cert_store_stats() and
   ssl.SSLContext.get_ca_certs() now correctly lock access to the certificate
   store, when the ssl.SSLContext is shared across multiple threads

Presumably releases for 3.11 & 3.12 will follow as the announcements of the
two new CVEs listed them as also affected.

[https://mail.python.org/archives/list/security-announce@python.org/thread/XELNUX2L3IOHBTFU7RQHCY6OUVEWZ2FG/](https://mail.python.org/archives/list/security-announce%40python.org/thread/XELNUX2L3IOHBTFU7RQHCY6OUVEWZ2FG/)
said:

   [CVE-2024-0450] Quoted zip-bomb protection for zipfile

   An issue was found in the CPython `zipfile` module affecting versions
   3.12.2, 3.11.8, 3.10.13, 3.9.18, and 3.8.18 and prior.

   The zipfile module is vulnerable to “quoted-overlap” zip-bombs which exploit
   the zip format to create a zip-bomb with a high compression ratio. The fixed
   versions of CPython makes the zipfile module reject zip archives which overlap
   entries in the archive.

   *References*
   * CVE: <https://www.cve.org/CVERecord?id=CVE-2024-0450>
   * Patch: <https://github.com/python/cpython/pull/110016>
   * Issue: <https://github.com/python/cpython/issues/109858>

[https://mail.python.org/archives/list/security-announce@python.org/thread/Q5C6ATFC67K53XFV4KE45325S7NS62LD/](https://mail.python.org/archives/list/security-announce%40python.org/thread/Q5C6ATFC67K53XFV4KE45325S7NS62LD/)
said:

   [CVE-2023-6597] tempfile.TemporaryDirectory dereferences symlinks during cleanup

   An issue was found in the CPython `tempfile.TemporaryDirectory` class
   affecting versions 3.12.2, 3.11.8, 3.10.13, 3.9.18, and 3.8.18 and prior.

   The tempfile.TemporaryDirectory class would dereference symlinks during
   cleanup of permissions-related errors. This means users which can run
   privileged programs are potentially able to modify permissions of files
   referenced by symlinks in some circumstances.

   *References*
   * CVE: <https://www.cve.org/CVERecord?id=CVE-2023-6597>
   * Patch: <https://github.com/python/cpython/pull/99930>
   * Issue: <https://github.com/python/cpython/issues/91133>

--
         -Alan Coopersmith-                 alan.coopersmith@...cle.com
          Oracle Solaris Engineering - <https://blogs.oracle.com/solaris>

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_71ac9d49_20250111_125000.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fd54e22a669ae6e987199bb5d2c69bb5a46b0083b)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fd54e22a669ae6e987199bb5d2c69bb5a46b0083b)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/d54e22a669ae6e987199bb5d2c69bb5a46b0083b)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.9] [gh-91133](https://github.com/python/cpython/issues/91133): tempfile.TemporaryDirectory: fix symlink bug in clean…

[Browse files](/python/cpython/tree/d54e22a669ae6e987199bb5d2c69bb5a46b0083b)
Browse the repository at this point in the history

```
…up ([GH-99930](https://github.com/python/cpython/pull/99930)) ([GH-112842](https://github.com/python/cpython/pull/112842))

(cherry picked from commit [81c16cd](https://github.com/python/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
```

* Loading branch information

[![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&v=4)](/serhiy-storchaka) [![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&v=4)](/kwi-dk)

[serhiy-storchaka](/python/cpython/commits?author=serhiy-storchaka "View all commits by serhiy-storchaka")
and
[kwi-dk](/python/cpython/commits?author=kwi-dk "View all commits by kwi-dk")
authored
Jan 17, 2024

1 parent
[a6f73f6](/python/cpython/commit/a6f73f61147048187908299ae911c5ad498d813a)

commit d54e22a

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**136 additions**
and
**10 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib

  + Lib/tempfile.py
    [tempfile.py](#diff-6553a99f3ae04c9fc9c2349ac27037bfe3b274d5ca54d5800d9c5b5f11e29d21)
  + test

    - Lib/test/test\_tempfile.py
      [test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983)
* Misc/NEWS.d/next/Library

  + Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst
    [2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst](#diff-f4f1ac9bf7b7e0f7c86de7e7cf998e1d40cbb748dc8a4f8c040364806139e39c)

## There are no files selected for viewing

27 changes: 18 additions & 9 deletions

27
[Lib/tempfile.py](#diff-6553a99f3ae04c9fc9c2349ac27037bfe3b274d5ca54d5800d9c5b5f11e29d21 "Lib/tempfile.py")

Show comments

[View file](/python/cpython/blob/d54e22a669ae6e987199bb5d2c69bb5a46b0083b/Lib/tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -268,6 +268,22 @@ def \_mkstemp\_inner(dir, pre, suf, flags, output\_type): |
|  |  | raise FileExistsError(\_errno.EEXIST, |
|  |  | "No usable temporary file name found") |
|  |  |  |
|  |  | def \_dont\_follow\_symlinks(func, path, \*args): |
|  |  | # Pass follow\_symlinks=False, unless not supported on this platform. |
|  |  | if func in \_os.supports\_follow\_symlinks: |
|  |  | func(path, \*args, follow\_symlinks=False) |
|  |  | elif \_os.name == 'nt' or not \_os.path.islink(path): |
|  |  | func(path, \*args) |
|  |  |  |
|  |  | def \_resetperms(path): |
|  |  | try: |
|  |  | chflags = \_os.chflags |
|  |  | except AttributeError: |
|  |  | pass |
|  |  | else: |
|  |  | \_dont\_follow\_symlinks(chflags, path, 0) |
|  |  | \_dont\_follow\_symlinks(\_os.chmod, path, 0o700) |
|  |  |  |
|  |  |  |
|  |  | # User visible interfaces. |
|  |  |  |
| Expand Down  Expand Up | | @@ -789,17 +805,10 @@ def \_\_init\_\_(self, suffix=None, prefix=None, dir=None): |
|  |  | def \_rmtree(cls, name): |
|  |  | def onerror(func, path, exc\_info): |
|  |  | if issubclass(exc\_info[0], PermissionError): |
|  |  | def resetperms(path): |
|  |  | try: |
|  |  | \_os.chflags(path, 0) |
|  |  | except AttributeError: |
|  |  | pass |
|  |  | \_os.chmod(path, 0o700) |
|  |  |  |
|  |  | try: |
|  |  | if path != name: |
|  |  | resetperms(\_os.path.dirname(path)) |
|  |  | resetperms(path) |
|  |  | \_resetperms(\_os.path.dirname(path)) |
|  |  | \_resetperms(path) |
|  |  |  |
|  |  | try: |
|  |  | \_os.unlink(path) |
| Expand Down | |  |

117 changes: 116 additions & 1 deletion

117
[Lib/test/test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983 "Lib/test/test_tempfile.py")

Show comments

[View file](/python/cpython/blob/d54e22a669ae6e987199bb5d2c69bb5a46b0083b/Lib/test/test_tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1394,6 +1394,103 @@ def test\_cleanup\_with\_symlink\_to\_a\_directory(self): |
|  |  | "were deleted") |
|  |  | d2.cleanup() |
|  |  |  |
|  |  | @support.skip\_unless\_symlink |
|  |  | def test\_cleanup\_with\_symlink\_modes(self): |
|  |  | # cleanup() should not follow symlinks when fixing mode bits (#91133) |
|  |  | with self.do\_create(recurse=0) as d2: |
|  |  | file1 = os.path.join(d2, 'file1') |
|  |  | open(file1, 'wb').close() |
|  |  | dir1 = os.path.join(d2, 'dir1') |
|  |  | os.mkdir(dir1) |
|  |  | for mode in range(8): |
|  |  | mode <<= 6 |
|  |  | with self.subTest(mode=format(mode, '03o')): |
|  |  | def test(target, target\_is\_directory): |
|  |  | d1 = self.do\_create(recurse=0) |
|  |  | symlink = os.path.join(d1.name, 'symlink') |
|  |  | os.symlink(target, symlink, |
|  |  | target\_is\_directory=target\_is\_directory) |
|  |  | try: |
|  |  | os.chmod(symlink, mode, follow\_symlinks=False) |
|  |  | except NotImplementedError: |
|  |  | pass |
|  |  | try: |
|  |  | os.chmod(symlink, mode) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | os.chmod(d1.name, mode) |
|  |  | d1.cleanup() |
|  |  | self.assertFalse(os.path.exists(d1.name)) |
|  |  |  |
|  |  | with self.subTest('nonexisting file'): |
|  |  | test('nonexisting', target\_is\_directory=False) |
|  |  | with self.subTest('nonexisting dir'): |
|  |  | test('nonexisting', target\_is\_directory=True) |
|  |  |  |
|  |  | with self.subTest('existing file'): |
|  |  | os.chmod(file1, mode) |
|  |  | old\_mode = os.stat(file1).st\_mode |
|  |  | test(file1, target\_is\_directory=False) |
|  |  | new\_mode = os.stat(file1).st\_mode |
|  |  | self.assertEqual(new\_mode, old\_mode, |
|  |  | '%03o != %03o' % (new\_mode, old\_mode)) |
|  |  |  |
|  |  | with self.subTest('existing dir'): |
|  |  | os.chmod(dir1, mode) |
|  |  | old\_mode = os.stat(dir1).st\_mode |
|  |  | test(dir1, target\_is\_directory=True) |
|  |  | new\_mode = os.stat(dir1).st\_mode |
|  |  | self.assertEqual(new\_mode, old\_mode, |
|  |  | '%03o != %03o' % (new\_mode, old\_mode)) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | @support.skip\_unless\_symlink |
|  |  | def test\_cleanup\_with\_symlink\_flags(self): |
|  |  | # cleanup() should not follow symlinks when fixing flags (#91133) |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  | self.check\_flags(flags) |
|  |  |  |
|  |  | with self.do\_create(recurse=0) as d2: |
|  |  | file1 = os.path.join(d2, 'file1') |
|  |  | open(file1, 'wb').close() |
|  |  | dir1 = os.path.join(d2, 'dir1') |
|  |  | os.mkdir(dir1) |
|  |  | def test(target, target\_is\_directory): |
|  |  | d1 = self.do\_create(recurse=0) |
|  |  | symlink = os.path.join(d1.name, 'symlink') |
|  |  | os.symlink(target, symlink, |
|  |  | target\_is\_directory=target\_is\_directory) |
|  |  | try: |
|  |  | os.chflags(symlink, flags, follow\_symlinks=False) |
|  |  | except NotImplementedError: |
|  |  | pass |
|  |  | try: |
|  |  | os.chflags(symlink, flags) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | os.chflags(d1.name, flags) |
|  |  | d1.cleanup() |
|  |  | self.assertFalse(os.path.exists(d1.name)) |
|  |  |  |
|  |  | with self.subTest('nonexisting file'): |
|  |  | test('nonexisting', target\_is\_directory=False) |
|  |  | with self.subTest('nonexisting dir'): |
|  |  | test('nonexisting', target\_is\_directory=True) |
|  |  |  |
|  |  | with self.subTest('existing file'): |
|  |  | os.chflags(file1, flags) |
|  |  | old\_flags = os.stat(file1).st\_flags |
|  |  | test(file1, target\_is\_directory=False) |
|  |  | new\_flags = os.stat(file1).st\_flags |
|  |  | self.assertEqual(new\_flags, old\_flags) |
|  |  |  |
|  |  | with self.subTest('existing dir'): |
|  |  | os.chflags(dir1, flags) |
|  |  | old\_flags = os.stat(dir1).st\_flags |
|  |  | test(dir1, target\_is\_directory=True) |
|  |  | new\_flags = os.stat(dir1).st\_flags |
|  |  | self.assertEqual(new\_flags, old\_flags) |
|  |  |  |
|  |  | @support.cpython\_only |
|  |  | def test\_del\_on\_collection(self): |
|  |  | # A TemporaryDirectory is deleted when garbage collected |
| Expand Down  Expand Up | | @@ -1506,9 +1603,27 @@ def test\_modes(self): |
|  |  | d.cleanup() |
|  |  | self.assertFalse(os.path.exists(d.name)) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.lchflags') |
|  |  | def check\_flags(self, flags): |
|  |  | # skip the test if these flags are not supported (ex: FreeBSD 13) |
|  |  | filename = support.TESTFN |
|  |  | try: |
|  |  | open(filename, "w").close() |
|  |  | try: |
|  |  | os.chflags(filename, flags) |
|  |  | except OSError as exc: |
|  |  | # "OSError: [Errno 45] Operation not supported" |
|  |  | self.skipTest(f"chflags() doesn't support flags " |
|  |  | f"{flags:#b}: {exc}") |
|  |  | else: |
|  |  | os.chflags(filename, 0) |
|  |  | finally: |
|  |  | support.unlink(filename) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | def test\_flags(self): |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  | self.check\_flags(flags) |
|  |  |  |
|  |  | d = self.do\_create(recurse=3, dirs=2, files=2) |
|  |  | with d: |
|  |  | # Change files and directories flags recursively. |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst](#diff-f4f1ac9bf7b7e0f7c86de7e7cf998e1d40cbb748dc8a4f8c040364806139e39c "Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst")

Show comments

[View file](/python/cpython/blob/d54e22a669ae6e987199bb5d2c69bb5a46b0083b/Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,2 @@ |
|  |  | Fix a bug in :class:`tempfile.TemporaryDirectory` cleanup, which now no longer |
|  |  | dereferences symlinks when working around file system permission errors. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d54e22a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fd54e22a669ae6e987199bb5d2c69bb5a46b0083b) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.fedoraproject.org_3d4da13f_20250111_125003.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/T3IGRX54M7RNCQOXVQO5KQKTGWCOABIM/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/T3IGRX54M7RNCQOXVQO5KQKTGWCOABIM/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/T3IGRX54M7RNCQOXVQO5KQKTGWCOABIM/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/T3IGRX54M7RNCQOXVQO5KQKTGWCOABIM/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-T3IGRX54M7RNCQOXVQO5KQKTGWCOABIM.mbox.gz?message=T3IGRX54M7RNCQOXVQO5KQKTGWCOABIM "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/T3IGRX54M7RNCQOXVQO5KQKTGWCOABIM/#T3IGRX54M7RNCQOXVQO5KQKTGWCOABIM)

# [SECURITY] Fedora 39 Update: python3.6-3.6.15-28.fc39

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updates＠fedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updates＠fedoraproject.org")

1 Jun
2024

1 Jun
'24

2:12 a.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2024-18b9c9b9cf
2024-06-01 01:12:10.293568
--------------------------------------------------------------------------------

Name : python3.6
Product : Fedora 39
Version : 3.6.15
Release : 28.fc39
URL : <https://www.python.org/>
Summary : Version 3.6 of the Python interpreter
Description :
Python 3.6 package for developers.

This package exists to allow developers to test their code against an older
version of Python. This is not a full Python stack and if you wish to run
your applications with Python 3.6, see other distributions
that support it, such as CentOS or RHEL with Software Collections
or older Fedora releases.

--------------------------------------------------------------------------------
Update Information:

Security fix for CVE-2024-0450 and CVE-2023-6597
--------------------------------------------------------------------------------
ChangeLog:

\* Wed Apr 24 2024 Lum��r Balhar lbalhar@redhat.com - 3.6.15-28
- Security fix for CVE-2024-0450 and CVE-2023-6597
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2024-18b9c9b9cf' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/T3IGRX54M7RNCQOXVQO5KQKTGWCOABIM/#T3IGRX54M7RNCQOXVQO5KQKTGWCOABIM)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from github.com_15cd95eb_20250111_124959.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F8eaeefe49d179ca4908d052745e3bb8b6f238f82)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F8eaeefe49d179ca4908d052745e3bb8b6f238f82)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/8eaeefe49d179ca4908d052745e3bb8b6f238f82)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.10] [gh-91133](https://github.com/python/cpython/issues/91133): tempfile.TemporaryDirectory: fix symlink bug in clea…

[Browse files](/python/cpython/tree/8eaeefe49d179ca4908d052745e3bb8b6f238f82)
Browse the repository at this point in the history

```
…nup ([GH-99930](https://github.com/python/cpython/pull/99930)) ([GH-112840](https://github.com/python/cpython/pull/112840))

(cherry picked from commit [81c16cd](https://github.com/python/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
```

* Loading branch information

[![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&v=4)](/serhiy-storchaka) [![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&v=4)](/kwi-dk)

[serhiy-storchaka](/python/cpython/commits?author=serhiy-storchaka "View all commits by serhiy-storchaka")
and
[kwi-dk](/python/cpython/commits?author=kwi-dk "View all commits by kwi-dk")
authored
Jan 17, 2024

1 parent
[32e7acd](/python/cpython/commit/32e7acdc05a3adb9a32c65242c63eb456696dfb6)

commit 8eaeefe

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**136 additions**
and
**10 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib

  + Lib/tempfile.py
    [tempfile.py](#diff-6553a99f3ae04c9fc9c2349ac27037bfe3b274d5ca54d5800d9c5b5f11e29d21)
  + test

    - Lib/test/test\_tempfile.py
      [test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983)
* Misc/NEWS.d/next/Library

  + Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst
    [2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst](#diff-f4f1ac9bf7b7e0f7c86de7e7cf998e1d40cbb748dc8a4f8c040364806139e39c)

## There are no files selected for viewing

27 changes: 18 additions & 9 deletions

27
[Lib/tempfile.py](#diff-6553a99f3ae04c9fc9c2349ac27037bfe3b274d5ca54d5800d9c5b5f11e29d21 "Lib/tempfile.py")

Show comments

[View file](/python/cpython/blob/8eaeefe49d179ca4908d052745e3bb8b6f238f82/Lib/tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -269,6 +269,22 @@ def \_mkstemp\_inner(dir, pre, suf, flags, output\_type): |
|  |  | raise FileExistsError(\_errno.EEXIST, |
|  |  | "No usable temporary file name found") |
|  |  |  |
|  |  | def \_dont\_follow\_symlinks(func, path, \*args): |
|  |  | # Pass follow\_symlinks=False, unless not supported on this platform. |
|  |  | if func in \_os.supports\_follow\_symlinks: |
|  |  | func(path, \*args, follow\_symlinks=False) |
|  |  | elif \_os.name == 'nt' or not \_os.path.islink(path): |
|  |  | func(path, \*args) |
|  |  |  |
|  |  | def \_resetperms(path): |
|  |  | try: |
|  |  | chflags = \_os.chflags |
|  |  | except AttributeError: |
|  |  | pass |
|  |  | else: |
|  |  | \_dont\_follow\_symlinks(chflags, path, 0) |
|  |  | \_dont\_follow\_symlinks(\_os.chmod, path, 0o700) |
|  |  |  |
|  |  |  |
|  |  | # User visible interfaces. |
|  |  |  |
| Expand Down  Expand Up | | @@ -827,17 +843,10 @@ def \_\_init\_\_(self, suffix=None, prefix=None, dir=None, |
|  |  | def \_rmtree(cls, name, ignore\_errors=False): |
|  |  | def onerror(func, path, exc\_info): |
|  |  | if issubclass(exc\_info[0], PermissionError): |
|  |  | def resetperms(path): |
|  |  | try: |
|  |  | \_os.chflags(path, 0) |
|  |  | except AttributeError: |
|  |  | pass |
|  |  | \_os.chmod(path, 0o700) |
|  |  |  |
|  |  | try: |
|  |  | if path != name: |
|  |  | resetperms(\_os.path.dirname(path)) |
|  |  | resetperms(path) |
|  |  | \_resetperms(\_os.path.dirname(path)) |
|  |  | \_resetperms(path) |
|  |  |  |
|  |  | try: |
|  |  | \_os.unlink(path) |
| Expand Down | |  |

117 changes: 116 additions & 1 deletion

117
[Lib/test/test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983 "Lib/test/test_tempfile.py")

Show comments

[View file](/python/cpython/blob/8eaeefe49d179ca4908d052745e3bb8b6f238f82/Lib/test/test_tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1499,6 +1499,103 @@ def test\_cleanup\_with\_symlink\_to\_a\_directory(self): |
|  |  | "were deleted") |
|  |  | d2.cleanup() |
|  |  |  |
|  |  | @os\_helper.skip\_unless\_symlink |
|  |  | def test\_cleanup\_with\_symlink\_modes(self): |
|  |  | # cleanup() should not follow symlinks when fixing mode bits (#91133) |
|  |  | with self.do\_create(recurse=0) as d2: |
|  |  | file1 = os.path.join(d2, 'file1') |
|  |  | open(file1, 'wb').close() |
|  |  | dir1 = os.path.join(d2, 'dir1') |
|  |  | os.mkdir(dir1) |
|  |  | for mode in range(8): |
|  |  | mode <<= 6 |
|  |  | with self.subTest(mode=format(mode, '03o')): |
|  |  | def test(target, target\_is\_directory): |
|  |  | d1 = self.do\_create(recurse=0) |
|  |  | symlink = os.path.join(d1.name, 'symlink') |
|  |  | os.symlink(target, symlink, |
|  |  | target\_is\_directory=target\_is\_directory) |
|  |  | try: |
|  |  | os.chmod(symlink, mode, follow\_symlinks=False) |
|  |  | except NotImplementedError: |
|  |  | pass |
|  |  | try: |
|  |  | os.chmod(symlink, mode) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | os.chmod(d1.name, mode) |
|  |  | d1.cleanup() |
|  |  | self.assertFalse(os.path.exists(d1.name)) |
|  |  |  |
|  |  | with self.subTest('nonexisting file'): |
|  |  | test('nonexisting', target\_is\_directory=False) |
|  |  | with self.subTest('nonexisting dir'): |
|  |  | test('nonexisting', target\_is\_directory=True) |
|  |  |  |
|  |  | with self.subTest('existing file'): |
|  |  | os.chmod(file1, mode) |
|  |  | old\_mode = os.stat(file1).st\_mode |
|  |  | test(file1, target\_is\_directory=False) |
|  |  | new\_mode = os.stat(file1).st\_mode |
|  |  | self.assertEqual(new\_mode, old\_mode, |
|  |  | '%03o != %03o' % (new\_mode, old\_mode)) |
|  |  |  |
|  |  | with self.subTest('existing dir'): |
|  |  | os.chmod(dir1, mode) |
|  |  | old\_mode = os.stat(dir1).st\_mode |
|  |  | test(dir1, target\_is\_directory=True) |
|  |  | new\_mode = os.stat(dir1).st\_mode |
|  |  | self.assertEqual(new\_mode, old\_mode, |
|  |  | '%03o != %03o' % (new\_mode, old\_mode)) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | @os\_helper.skip\_unless\_symlink |
|  |  | def test\_cleanup\_with\_symlink\_flags(self): |
|  |  | # cleanup() should not follow symlinks when fixing flags (#91133) |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  | self.check\_flags(flags) |
|  |  |  |
|  |  | with self.do\_create(recurse=0) as d2: |
|  |  | file1 = os.path.join(d2, 'file1') |
|  |  | open(file1, 'wb').close() |
|  |  | dir1 = os.path.join(d2, 'dir1') |
|  |  | os.mkdir(dir1) |
|  |  | def test(target, target\_is\_directory): |
|  |  | d1 = self.do\_create(recurse=0) |
|  |  | symlink = os.path.join(d1.name, 'symlink') |
|  |  | os.symlink(target, symlink, |
|  |  | target\_is\_directory=target\_is\_directory) |
|  |  | try: |
|  |  | os.chflags(symlink, flags, follow\_symlinks=False) |
|  |  | except NotImplementedError: |
|  |  | pass |
|  |  | try: |
|  |  | os.chflags(symlink, flags) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | os.chflags(d1.name, flags) |
|  |  | d1.cleanup() |
|  |  | self.assertFalse(os.path.exists(d1.name)) |
|  |  |  |
|  |  | with self.subTest('nonexisting file'): |
|  |  | test('nonexisting', target\_is\_directory=False) |
|  |  | with self.subTest('nonexisting dir'): |
|  |  | test('nonexisting', target\_is\_directory=True) |
|  |  |  |
|  |  | with self.subTest('existing file'): |
|  |  | os.chflags(file1, flags) |
|  |  | old\_flags = os.stat(file1).st\_flags |
|  |  | test(file1, target\_is\_directory=False) |
|  |  | new\_flags = os.stat(file1).st\_flags |
|  |  | self.assertEqual(new\_flags, old\_flags) |
|  |  |  |
|  |  | with self.subTest('existing dir'): |
|  |  | os.chflags(dir1, flags) |
|  |  | old\_flags = os.stat(dir1).st\_flags |
|  |  | test(dir1, target\_is\_directory=True) |
|  |  | new\_flags = os.stat(dir1).st\_flags |
|  |  | self.assertEqual(new\_flags, old\_flags) |
|  |  |  |
|  |  | @support.cpython\_only |
|  |  | def test\_del\_on\_collection(self): |
|  |  | # A TemporaryDirectory is deleted when garbage collected |
| Expand Down  Expand Up | | @@ -1671,9 +1768,27 @@ def test\_modes(self): |
|  |  | d.cleanup() |
|  |  | self.assertFalse(os.path.exists(d.name)) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.lchflags') |
|  |  | def check\_flags(self, flags): |
|  |  | # skip the test if these flags are not supported (ex: FreeBSD 13) |
|  |  | filename = os\_helper.TESTFN |
|  |  | try: |
|  |  | open(filename, "w").close() |
|  |  | try: |
|  |  | os.chflags(filename, flags) |
|  |  | except OSError as exc: |
|  |  | # "OSError: [Errno 45] Operation not supported" |
|  |  | self.skipTest(f"chflags() doesn't support flags " |
|  |  | f"{flags:#b}: {exc}") |
|  |  | else: |
|  |  | os.chflags(filename, 0) |
|  |  | finally: |
|  |  | os\_helper.unlink(filename) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | def test\_flags(self): |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  | self.check\_flags(flags) |
|  |  |  |
|  |  | d = self.do\_create(recurse=3, dirs=2, files=2) |
|  |  | with d: |
|  |  | # Change files and directories flags recursively. |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst](#diff-f4f1ac9bf7b7e0f7c86de7e7cf998e1d40cbb748dc8a4f8c040364806139e39c "Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst")

Show comments

[View file](/python/cpython/blob/8eaeefe49d179ca4908d052745e3bb8b6f238f82/Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,2 @@ |
|  |  | Fix a bug in :class:`tempfile.TemporaryDirectory` cleanup, which now no longer |
|  |  | dereferences symlinks when working around file system permission errors. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8eaeefe`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F8eaeefe49d179ca4908d052745e3bb8b6f238f82) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c5ac2d54_20250111_124955.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F02a9259c717738dfe6b463c44d7e17f2b6d2cb3a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F02a9259c717738dfe6b463c44d7e17f2b6d2cb3a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/02a9259c717738dfe6b463c44d7e17f2b6d2cb3a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.8] [gh-91133](https://github.com/python/cpython/issues/91133): tempfile.TemporaryDirectory: fix symlink bug in clean…

[Browse files](/python/cpython/tree/02a9259c717738dfe6b463c44d7e17f2b6d2cb3a)
Browse the repository at this point in the history

```
…up ([GH-99930](https://github.com/python/cpython/pull/99930)) ([GH-112843](https://github.com/python/cpython/pull/112843))

(cherry picked from commit [81c16cd](https://github.com/python/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
```

* Loading branch information

[![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&v=4)](/serhiy-storchaka) [![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&v=4)](/kwi-dk)

[serhiy-storchaka](/python/cpython/commits?author=serhiy-storchaka "View all commits by serhiy-storchaka")
and
[kwi-dk](/python/cpython/commits?author=kwi-dk "View all commits by kwi-dk")
authored
Jan 17, 2024

1 parent
[2e1156c](/python/cpython/commit/2e1156c562ad09f83596dc234e7ca9e8f938bf93)

commit 02a9259

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**136 additions**
and
**10 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib

  + Lib/tempfile.py
    [tempfile.py](#diff-6553a99f3ae04c9fc9c2349ac27037bfe3b274d5ca54d5800d9c5b5f11e29d21)
  + test

    - Lib/test/test\_tempfile.py
      [test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983)
* Misc/NEWS.d/next/Library

  + Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst
    [2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst](#diff-f4f1ac9bf7b7e0f7c86de7e7cf998e1d40cbb748dc8a4f8c040364806139e39c)

## There are no files selected for viewing

27 changes: 18 additions & 9 deletions

27
[Lib/tempfile.py](#diff-6553a99f3ae04c9fc9c2349ac27037bfe3b274d5ca54d5800d9c5b5f11e29d21 "Lib/tempfile.py")

Show comments

[View file](/python/cpython/blob/02a9259c717738dfe6b463c44d7e17f2b6d2cb3a/Lib/tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -263,6 +263,22 @@ def \_mkstemp\_inner(dir, pre, suf, flags, output\_type): |
|  |  | raise FileExistsError(\_errno.EEXIST, |
|  |  | "No usable temporary file name found") |
|  |  |  |
|  |  | def \_dont\_follow\_symlinks(func, path, \*args): |
|  |  | # Pass follow\_symlinks=False, unless not supported on this platform. |
|  |  | if func in \_os.supports\_follow\_symlinks: |
|  |  | func(path, \*args, follow\_symlinks=False) |
|  |  | elif \_os.name == 'nt' or not \_os.path.islink(path): |
|  |  | func(path, \*args) |
|  |  |  |
|  |  | def \_resetperms(path): |
|  |  | try: |
|  |  | chflags = \_os.chflags |
|  |  | except AttributeError: |
|  |  | pass |
|  |  | else: |
|  |  | \_dont\_follow\_symlinks(chflags, path, 0) |
|  |  | \_dont\_follow\_symlinks(\_os.chmod, path, 0o700) |
|  |  |  |
|  |  |  |
|  |  | # User visible interfaces. |
|  |  |  |
| Expand Down  Expand Up | | @@ -786,17 +802,10 @@ def \_\_init\_\_(self, suffix=None, prefix=None, dir=None): |
|  |  | def \_rmtree(cls, name): |
|  |  | def onerror(func, path, exc\_info): |
|  |  | if issubclass(exc\_info[0], PermissionError): |
|  |  | def resetperms(path): |
|  |  | try: |
|  |  | \_os.chflags(path, 0) |
|  |  | except AttributeError: |
|  |  | pass |
|  |  | \_os.chmod(path, 0o700) |
|  |  |  |
|  |  | try: |
|  |  | if path != name: |
|  |  | resetperms(\_os.path.dirname(path)) |
|  |  | resetperms(path) |
|  |  | \_resetperms(\_os.path.dirname(path)) |
|  |  | \_resetperms(path) |
|  |  |  |
|  |  | try: |
|  |  | \_os.unlink(path) |
| Expand Down | |  |

117 changes: 116 additions & 1 deletion

117
[Lib/test/test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983 "Lib/test/test_tempfile.py")

Show comments

[View file](/python/cpython/blob/02a9259c717738dfe6b463c44d7e17f2b6d2cb3a/Lib/test/test_tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1377,6 +1377,103 @@ def test\_cleanup\_with\_symlink\_to\_a\_directory(self): |
|  |  | "were deleted") |
|  |  | d2.cleanup() |
|  |  |  |
|  |  | @support.skip\_unless\_symlink |
|  |  | def test\_cleanup\_with\_symlink\_modes(self): |
|  |  | # cleanup() should not follow symlinks when fixing mode bits (#91133) |
|  |  | with self.do\_create(recurse=0) as d2: |
|  |  | file1 = os.path.join(d2, 'file1') |
|  |  | open(file1, 'wb').close() |
|  |  | dir1 = os.path.join(d2, 'dir1') |
|  |  | os.mkdir(dir1) |
|  |  | for mode in range(8): |
|  |  | mode <<= 6 |
|  |  | with self.subTest(mode=format(mode, '03o')): |
|  |  | def test(target, target\_is\_directory): |
|  |  | d1 = self.do\_create(recurse=0) |
|  |  | symlink = os.path.join(d1.name, 'symlink') |
|  |  | os.symlink(target, symlink, |
|  |  | target\_is\_directory=target\_is\_directory) |
|  |  | try: |
|  |  | os.chmod(symlink, mode, follow\_symlinks=False) |
|  |  | except NotImplementedError: |
|  |  | pass |
|  |  | try: |
|  |  | os.chmod(symlink, mode) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | os.chmod(d1.name, mode) |
|  |  | d1.cleanup() |
|  |  | self.assertFalse(os.path.exists(d1.name)) |
|  |  |  |
|  |  | with self.subTest('nonexisting file'): |
|  |  | test('nonexisting', target\_is\_directory=False) |
|  |  | with self.subTest('nonexisting dir'): |
|  |  | test('nonexisting', target\_is\_directory=True) |
|  |  |  |
|  |  | with self.subTest('existing file'): |
|  |  | os.chmod(file1, mode) |
|  |  | old\_mode = os.stat(file1).st\_mode |
|  |  | test(file1, target\_is\_directory=False) |
|  |  | new\_mode = os.stat(file1).st\_mode |
|  |  | self.assertEqual(new\_mode, old\_mode, |
|  |  | '%03o != %03o' % (new\_mode, old\_mode)) |
|  |  |  |
|  |  | with self.subTest('existing dir'): |
|  |  | os.chmod(dir1, mode) |
|  |  | old\_mode = os.stat(dir1).st\_mode |
|  |  | test(dir1, target\_is\_directory=True) |
|  |  | new\_mode = os.stat(dir1).st\_mode |
|  |  | self.assertEqual(new\_mode, old\_mode, |
|  |  | '%03o != %03o' % (new\_mode, old\_mode)) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | @support.skip\_unless\_symlink |
|  |  | def test\_cleanup\_with\_symlink\_flags(self): |
|  |  | # cleanup() should not follow symlinks when fixing flags (#91133) |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  | self.check\_flags(flags) |
|  |  |  |
|  |  | with self.do\_create(recurse=0) as d2: |
|  |  | file1 = os.path.join(d2, 'file1') |
|  |  | open(file1, 'wb').close() |
|  |  | dir1 = os.path.join(d2, 'dir1') |
|  |  | os.mkdir(dir1) |
|  |  | def test(target, target\_is\_directory): |
|  |  | d1 = self.do\_create(recurse=0) |
|  |  | symlink = os.path.join(d1.name, 'symlink') |
|  |  | os.symlink(target, symlink, |
|  |  | target\_is\_directory=target\_is\_directory) |
|  |  | try: |
|  |  | os.chflags(symlink, flags, follow\_symlinks=False) |
|  |  | except NotImplementedError: |
|  |  | pass |
|  |  | try: |
|  |  | os.chflags(symlink, flags) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | os.chflags(d1.name, flags) |
|  |  | d1.cleanup() |
|  |  | self.assertFalse(os.path.exists(d1.name)) |
|  |  |  |
|  |  | with self.subTest('nonexisting file'): |
|  |  | test('nonexisting', target\_is\_directory=False) |
|  |  | with self.subTest('nonexisting dir'): |
|  |  | test('nonexisting', target\_is\_directory=True) |
|  |  |  |
|  |  | with self.subTest('existing file'): |
|  |  | os.chflags(file1, flags) |
|  |  | old\_flags = os.stat(file1).st\_flags |
|  |  | test(file1, target\_is\_directory=False) |
|  |  | new\_flags = os.stat(file1).st\_flags |
|  |  | self.assertEqual(new\_flags, old\_flags) |
|  |  |  |
|  |  | with self.subTest('existing dir'): |
|  |  | os.chflags(dir1, flags) |
|  |  | old\_flags = os.stat(dir1).st\_flags |
|  |  | test(dir1, target\_is\_directory=True) |
|  |  | new\_flags = os.stat(dir1).st\_flags |
|  |  | self.assertEqual(new\_flags, old\_flags) |
|  |  |  |
|  |  | @support.cpython\_only |
|  |  | def test\_del\_on\_collection(self): |
|  |  | # A TemporaryDirectory is deleted when garbage collected |
| Expand Down  Expand Up | | @@ -1489,9 +1586,27 @@ def test\_modes(self): |
|  |  | d.cleanup() |
|  |  | self.assertFalse(os.path.exists(d.name)) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.lchflags') |
|  |  | def check\_flags(self, flags): |
|  |  | # skip the test if these flags are not supported (ex: FreeBSD 13) |
|  |  | filename = support.TESTFN |
|  |  | try: |
|  |  | open(filename, "w").close() |
|  |  | try: |
|  |  | os.chflags(filename, flags) |
|  |  | except OSError as exc: |
|  |  | # "OSError: [Errno 45] Operation not supported" |
|  |  | self.skipTest(f"chflags() doesn't support flags " |
|  |  | f"{flags:#b}: {exc}") |
|  |  | else: |
|  |  | os.chflags(filename, 0) |
|  |  | finally: |
|  |  | support.unlink(filename) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | def test\_flags(self): |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  | self.check\_flags(flags) |
|  |  |  |
|  |  | d = self.do\_create(recurse=3, dirs=2, files=2) |
|  |  | with d: |
|  |  | # Change files and directories flags recursively. |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst](#diff-f4f1ac9bf7b7e0f7c86de7e7cf998e1d40cbb748dc8a4f8c040364806139e39c "Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst")

Show comments

[View file](/python/cpython/blob/02a9259c717738dfe6b463c44d7e17f2b6d2cb3a/Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,2 @@ |
|  |  | Fix a bug in :class:`tempfile.TemporaryDirectory` cleanup, which now no longer |
|  |  | dereferences symlinks when working around file system permission errors. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `02a9259`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F02a9259c717738dfe6b463c44d7e17f2b6d2cb3a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.fedoraproject.org_fdc75b96_20250111_125003.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/U5VHWS52HGD743C47UMCSAK2A773M2YE/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/U5VHWS52HGD743C47UMCSAK2A773M2YE/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/U5VHWS52HGD743C47UMCSAK2A773M2YE/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/U5VHWS52HGD743C47UMCSAK2A773M2YE/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-U5VHWS52HGD743C47UMCSAK2A773M2YE.mbox.gz?message=U5VHWS52HGD743C47UMCSAK2A773M2YE "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/U5VHWS52HGD743C47UMCSAK2A773M2YE/#U5VHWS52HGD743C47UMCSAK2A773M2YE)

# [SECURITY] Fedora 40 Update: python3.6-3.6.15-30.fc40

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updates＠fedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updates＠fedoraproject.org")

31 May
2024

31 May
'24

2:17 a.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2024-a702b78744
2024-05-31 01:15:54.301494
--------------------------------------------------------------------------------

Name : python3.6
Product : Fedora 40
Version : 3.6.15
Release : 30.fc40
URL : <https://www.python.org/>
Summary : Version 3.6 of the Python interpreter
Description :
Python 3.6 package for developers.

This package exists to allow developers to test their code against an older
version of Python. This is not a full Python stack and if you wish to run
your applications with Python 3.6, see other distributions
that support it, such as CentOS or RHEL with Software Collections
or older Fedora releases.

--------------------------------------------------------------------------------
Update Information:

Security fix for CVE-2024-0450 and CVE-2023-6597
--------------------------------------------------------------------------------
ChangeLog:

\* Wed Apr 24 2024 Lum��r Balhar lbalhar@redhat.com - 3.6.15-30
- Security fix for CVE-2024-0450 and CVE-2023-6597
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2024-a702b78744' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/U5VHWS52HGD743C47UMCSAK2A773M2YE/#U5VHWS52HGD743C47UMCSAK2A773M2YE)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from lists.debian.org_4df8b146_20250111_125002.html ===


---

[[Date Prev](msg00024.html)][[Date Next](msg00026.html)]
[[Thread Prev](msg00024.html)][[Thread Next](msg00026.html)]
[[Date Index](maillist.html#00025)]
[[Thread Index](threads.html#00025)]

# [SECURITY] [DLA 3772-1] python3.7 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3772-1] python3.7 security update
* *From*: Adrian Bunk <bunk@debian.org>
* *Date*: Sun, 24 Mar 2024 23:51:46 +0200
* *Message-id*: <[[🔎]](/msgid-search/ZgCgcm46HSbPPO0k%40localhost) [ZgCgcm46HSbPPO0k@localhost](msg00025.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3772-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                          Adrian Bunk
March 24, 2024                                <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : python3.7
Version        : 3.7.3-2+deb10u7
CVE ID         : CVE-2023-6597 CVE-2024-0450

Two vulnerabilities have been fixed in the Python 3 interpreter.

CVE-2023-6597

    tempfile.TemporaryDirectory failure to remove dir

CVE-2024-0450

    quoted-overlap zipbomb DoS

For Debian 10 buster, these problems have been fixed in version
3.7.3-2+deb10u7.

We recommend that you upgrade your python3.7 packages.

For the detailed security status of python3.7 please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/python3.7>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEOvp1f6xuoR0v9F3wiNJCh6LYmLEFAmYAoHIACgkQiNJCh6LY
mLFLBhAAl4hp5bxyoVUX5ju/DYAHCEunfTCk9qImA+EyyU/miBXht+l2gO+9SKwc
krPDAZICfTLISNDWUvhM+E6OCCB4rcivc+wRAMU4xkYb0RqtX/FGockRRZOiul2O
GFPy96vpY5A3y8dVW/n7vIQG9Flys1ktdYAVIzd7qitcb5W54+PikauTK89Ph4Tk
xl6wuni24BU2zcxRiqr/F3GOi1H+j29uoPJh9XFCcUHz1DzJKxDHg5DF0M+jbi1U
cebugv5xMFsGe0uRkQfAZ0OHtusLKqrO7rOFQteWk0oq9mDqfPQnRLdnCPUW4sEm
X/3ohOk+57ZmrNKSXzy2LA1nmQWQThQyeQM44A5LQ3mFgQc9UFvzwuO5bjvWDp5x
SdjkOtSO97PfrvEY3Vu161f8dEk3UcckjnxKGghL5b0Mklc8szgdDbYvZ2pvv1N9
X9xlc+Cej26fQQnUOjnzRwnWm3o7KpKVkbJlzc9a5uOuJfFyty5/ATyLqFTX/CXF
KPLxo6Y7QduyVVUBJuLvZnR5Gweolm3nFwjck+DZ/8ZjoczKeF0wwqduMeVUiLTr
X7FGzA90gdEXoj8UOzvGxQY9f2dMfHU8vT74PLyYsgV2ur2WNefowhlyYh7MRrLm
/Ce8barFNPip0d4s7di1GufKB9aDN+RN6+9JFpBtYZVo5qnWW3g=
=jMmp
-----END PGP SIGNATURE-----

```

---



=== Content from github.com_12d1783c_20250111_124957.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F6ceb8aeda504b079fef7a57b8d81472f15cdd9a5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F6ceb8aeda504b079fef7a57b8d81472f15cdd9a5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/6ceb8aeda504b079fef7a57b8d81472f15cdd9a5)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.12] [gh-91133](https://github.com/python/cpython/issues/91133): tempfile.TemporaryDirectory: fix symlink bug in clea…

[Browse files](/python/cpython/tree/6ceb8aeda504b079fef7a57b8d81472f15cdd9a5)
Browse the repository at this point in the history

```
…nup ([GH-99930](https://github.com/python/cpython/pull/99930)) ([GH-112838](https://github.com/python/cpython/pull/112838))

(cherry picked from commit [81c16cd](https://github.com/python/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>
```

* Loading branch information

[![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&v=4)](/miss-islington) [![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&v=4)](/kwi-dk) [![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&v=4)](/serhiy-storchaka)

3 people

authored
Dec 7, 2023

1 parent
[8f1c912](/python/cpython/commit/8f1c9128dd5f0976f9635cb43691d7914438903d)

commit 6ceb8ae

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**125 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib

  + Lib/tempfile.py
    [tempfile.py](#diff-6553a99f3ae04c9fc9c2349ac27037bfe3b274d5ca54d5800d9c5b5f11e29d21)
  + test

    - Lib/test/test\_tempfile.py
      [test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983)
* Misc/NEWS.d/next/Library

  + Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst
    [2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst](#diff-f4f1ac9bf7b7e0f7c86de7e7cf998e1d40cbb748dc8a4f8c040364806139e39c)

## There are no files selected for viewing

27 changes: 18 additions & 9 deletions

27
[Lib/tempfile.py](#diff-6553a99f3ae04c9fc9c2349ac27037bfe3b274d5ca54d5800d9c5b5f11e29d21 "Lib/tempfile.py")

Show comments

[View file](/python/cpython/blob/6ceb8aeda504b079fef7a57b8d81472f15cdd9a5/Lib/tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -270,6 +270,22 @@ def \_mkstemp\_inner(dir, pre, suf, flags, output\_type): |
|  |  | raise FileExistsError(\_errno.EEXIST, |
|  |  | "No usable temporary file name found") |
|  |  |  |
|  |  | def \_dont\_follow\_symlinks(func, path, \*args): |
|  |  | # Pass follow\_symlinks=False, unless not supported on this platform. |
|  |  | if func in \_os.supports\_follow\_symlinks: |
|  |  | func(path, \*args, follow\_symlinks=False) |
|  |  | elif \_os.name == 'nt' or not \_os.path.islink(path): |
|  |  | func(path, \*args) |
|  |  |  |
|  |  | def \_resetperms(path): |
|  |  | try: |
|  |  | chflags = \_os.chflags |
|  |  | except AttributeError: |
|  |  | pass |
|  |  | else: |
|  |  | \_dont\_follow\_symlinks(chflags, path, 0) |
|  |  | \_dont\_follow\_symlinks(\_os.chmod, path, 0o700) |
|  |  |  |
|  |  |  |
|  |  | # User visible interfaces. |
|  |  |  |
| Expand Down  Expand Up | | @@ -876,17 +892,10 @@ def \_\_init\_\_(self, suffix=None, prefix=None, dir=None, |
|  |  | def \_rmtree(cls, name, ignore\_errors=False): |
|  |  | def onexc(func, path, exc): |
|  |  | if isinstance(exc, PermissionError): |
|  |  | def resetperms(path): |
|  |  | try: |
|  |  | \_os.chflags(path, 0) |
|  |  | except AttributeError: |
|  |  | pass |
|  |  | \_os.chmod(path, 0o700) |
|  |  |  |
|  |  | try: |
|  |  | if path != name: |
|  |  | resetperms(\_os.path.dirname(path)) |
|  |  | resetperms(path) |
|  |  | \_resetperms(\_os.path.dirname(path)) |
|  |  | \_resetperms(path) |
|  |  |  |
|  |  | try: |
|  |  | \_os.unlink(path) |
| Expand Down | |  |

111 changes: 105 additions & 6 deletions

111
[Lib/test/test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983 "Lib/test/test_tempfile.py")

Show comments

[View file](/python/cpython/blob/6ceb8aeda504b079fef7a57b8d81472f15cdd9a5/Lib/test/test_tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1673,6 +1673,103 @@ def test\_cleanup\_with\_symlink\_to\_a\_directory(self): |
|  |  | "were deleted") |
|  |  | d2.cleanup() |
|  |  |  |
|  |  | @os\_helper.skip\_unless\_symlink |
|  |  | def test\_cleanup\_with\_symlink\_modes(self): |
|  |  | # cleanup() should not follow symlinks when fixing mode bits (#91133) |
|  |  | with self.do\_create(recurse=0) as d2: |
|  |  | file1 = os.path.join(d2, 'file1') |
|  |  | open(file1, 'wb').close() |
|  |  | dir1 = os.path.join(d2, 'dir1') |
|  |  | os.mkdir(dir1) |
|  |  | for mode in range(8): |
|  |  | mode <<= 6 |
|  |  | with self.subTest(mode=format(mode, '03o')): |
|  |  | def test(target, target\_is\_directory): |
|  |  | d1 = self.do\_create(recurse=0) |
|  |  | symlink = os.path.join(d1.name, 'symlink') |
|  |  | os.symlink(target, symlink, |
|  |  | target\_is\_directory=target\_is\_directory) |
|  |  | try: |
|  |  | os.chmod(symlink, mode, follow\_symlinks=False) |
|  |  | except NotImplementedError: |
|  |  | pass |
|  |  | try: |
|  |  | os.chmod(symlink, mode) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | os.chmod(d1.name, mode) |
|  |  | d1.cleanup() |
|  |  | self.assertFalse(os.path.exists(d1.name)) |
|  |  |  |
|  |  | with self.subTest('nonexisting file'): |
|  |  | test('nonexisting', target\_is\_directory=False) |
|  |  | with self.subTest('nonexisting dir'): |
|  |  | test('nonexisting', target\_is\_directory=True) |
|  |  |  |
|  |  | with self.subTest('existing file'): |
|  |  | os.chmod(file1, mode) |
|  |  | old\_mode = os.stat(file1).st\_mode |
|  |  | test(file1, target\_is\_directory=False) |
|  |  | new\_mode = os.stat(file1).st\_mode |
|  |  | self.assertEqual(new\_mode, old\_mode, |
|  |  | '%03o != %03o' % (new\_mode, old\_mode)) |
|  |  |  |
|  |  | with self.subTest('existing dir'): |
|  |  | os.chmod(dir1, mode) |
|  |  | old\_mode = os.stat(dir1).st\_mode |
|  |  | test(dir1, target\_is\_directory=True) |
|  |  | new\_mode = os.stat(dir1).st\_mode |
|  |  | self.assertEqual(new\_mode, old\_mode, |
|  |  | '%03o != %03o' % (new\_mode, old\_mode)) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | @os\_helper.skip\_unless\_symlink |
|  |  | def test\_cleanup\_with\_symlink\_flags(self): |
|  |  | # cleanup() should not follow symlinks when fixing flags (#91133) |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  | self.check\_flags(flags) |
|  |  |  |
|  |  | with self.do\_create(recurse=0) as d2: |
|  |  | file1 = os.path.join(d2, 'file1') |
|  |  | open(file1, 'wb').close() |
|  |  | dir1 = os.path.join(d2, 'dir1') |
|  |  | os.mkdir(dir1) |
|  |  | def test(target, target\_is\_directory): |
|  |  | d1 = self.do\_create(recurse=0) |
|  |  | symlink = os.path.join(d1.name, 'symlink') |
|  |  | os.symlink(target, symlink, |
|  |  | target\_is\_directory=target\_is\_directory) |
|  |  | try: |
|  |  | os.chflags(symlink, flags, follow\_symlinks=False) |
|  |  | except NotImplementedError: |
|  |  | pass |
|  |  | try: |
|  |  | os.chflags(symlink, flags) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | os.chflags(d1.name, flags) |
|  |  | d1.cleanup() |
|  |  | self.assertFalse(os.path.exists(d1.name)) |
|  |  |  |
|  |  | with self.subTest('nonexisting file'): |
|  |  | test('nonexisting', target\_is\_directory=False) |
|  |  | with self.subTest('nonexisting dir'): |
|  |  | test('nonexisting', target\_is\_directory=True) |
|  |  |  |
|  |  | with self.subTest('existing file'): |
|  |  | os.chflags(file1, flags) |
|  |  | old\_flags = os.stat(file1).st\_flags |
|  |  | test(file1, target\_is\_directory=False) |
|  |  | new\_flags = os.stat(file1).st\_flags |
|  |  | self.assertEqual(new\_flags, old\_flags) |
|  |  |  |
|  |  | with self.subTest('existing dir'): |
|  |  | os.chflags(dir1, flags) |
|  |  | old\_flags = os.stat(dir1).st\_flags |
|  |  | test(dir1, target\_is\_directory=True) |
|  |  | new\_flags = os.stat(dir1).st\_flags |
|  |  | self.assertEqual(new\_flags, old\_flags) |
|  |  |  |
|  |  | @support.cpython\_only |
|  |  | def test\_del\_on\_collection(self): |
|  |  | # A TemporaryDirectory is deleted when garbage collected |
| Expand Down  Expand Up | | @@ -1845,10 +1942,7 @@ def test\_modes(self): |
|  |  | d.cleanup() |
|  |  | self.assertFalse(os.path.exists(d.name)) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | def test\_flags(self): |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  |  |
|  |  | def check\_flags(self, flags): |
|  |  | # skip the test if these flags are not supported (ex: FreeBSD 13) |
|  |  | filename = os\_helper.TESTFN |
|  |  | try: |
| Expand All | | @@ -1857,13 +1951,18 @@ def test\_flags(self): |
|  |  | os.chflags(filename, flags) |
|  |  | except OSError as exc: |
|  |  | # "OSError: [Errno 45] Operation not supported" |
|  |  | self.skipTest(f"chflags() doesn't support " |
|  |  | f"UF\_IMMUTABLE|UF\_NOUNLINK: {exc}") |
|  |  | self.skipTest(f"chflags() doesn't support flags " |
|  |  | f"{flags:#b}: {exc}") |
|  |  | else: |
|  |  | os.chflags(filename, 0) |
|  |  | finally: |
|  |  | os\_helper.unlink(filename) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | def test\_flags(self): |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  | self.check\_flags(flags) |
|  |  |  |
|  |  | d = self.do\_create(recurse=3, dirs=2, files=2) |
|  |  | with d: |
|  |  | # Change files and directories flags recursively. |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst](#diff-f4f1ac9bf7b7e0f7c86de7e7cf998e1d40cbb748dc8a4f8c040364806139e39c "Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst")

Show comments

[View file](/python/cpython/blob/6ceb8aeda504b079fef7a57b8d81472f15cdd9a5/Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,2 @@ |
|  |  | Fix a bug in :class:`tempfile.TemporaryDirectory` cleanup, which now no longer |
|  |  | dereferences symlinks when working around file system permission errors. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `6ceb8ae`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F6ceb8aeda504b079fef7a57b8d81472f15cdd9a5) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3ec95783_20250111_125002.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fissues%2F91133)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fissues%2F91133)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fpython%2Fcpython%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fpython%2Fcpython%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# tempfile.TemporaryDirectory fails removing dir in some edge cases related to symlinks [CVE-2023-6597] #91133

Closed

afeblot mannequin opened this issue
Mar 10, 2022
· 6 comments

Closed

# [tempfile.TemporaryDirectory fails removing dir in some edge cases related to symlinks [CVE-2023-6597]](#top) #91133

afeblot mannequin opened this issue
Mar 10, 2022
· 6 comments

Labels
[3.8 (EOL)](/python/cpython/labels/3.8%20%28EOL%29)
end of life
[3.9](/python/cpython/labels/3.9)
only security fixes
[3.10](/python/cpython/labels/3.10)
only security fixes
[3.11](/python/cpython/labels/3.11)
only security fixes
[3.12](/python/cpython/labels/3.12)
bugs and security fixes
[3.13](/python/cpython/labels/3.13)
bugs and security fixes
[stdlib](/python/cpython/labels/stdlib)
Python modules in the Lib dir
[type-bug](/python/cpython/labels/type-bug)
An unexpected behavior, bug, or error
[type-security](/python/cpython/labels/type-security)
A security issue

## Comments

![@afeblot](https://avatars.githubusercontent.com/u/101755586?s=80&v=4)

Copy link

Mannequin

### **afeblot mannequin** commented [Mar 10, 2022](#issue-1199076757) • edited by bedevere-app bot Loading

|  |  |  |  |  |
| --- | --- | --- | --- | --- |
| | BPO | [46977](https://bugs.python.org/issue46977) | | --- | --- | | Nosy | [@afeblot](https://github.com/afeblot) |   *Note: these values reflect the state of the issue at the time it was migrated and might not reflect the current state.* Show more details   GitHub fields:  ``` assignee = None closed_at = None created_at = <Date 2022-03-10.17:22:08.506> labels = ['library', '3.9', 'type-crash'] title = 'tempfile.TemporaryDirectory fails removing dir in some edge cases related to symlinks' updated_at = <Date 2022-03-10.17:25:32.378> user = 'https://github.com/afeblot' ```  bugs.python.org fields:  ``` activity = <Date 2022-03-10.17:25:32.378> actor = 'afeblot' assignee = 'none' closed = False closed_date = None closer = None components = ['Library (Lib)'] creation = <Date 2022-03-10.17:22:08.506> creator = 'afeblot' dependencies = [] files = [] hgrepos = [] issue_num = 46977 keywords = [] message_count = 1.0 messages = ['414871'] nosy_count = 1.0 nosy_names = ['afeblot'] pr_nums = [] priority = 'normal' resolution = None stage = None status = 'open' superseder = None type = 'crash' url = 'https://bugs.python.org/issue46977' versions = ['Python 3.9'] ```   Linked PRs  * [gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup #99930](https://github.com/python/cpython/pull/99930) * [[3.12] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) #112838](https://github.com/python/cpython/pull/112838) * [[3.11] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) #112839](https://github.com/python/cpython/pull/112839) * [[3.10] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) #112840](https://github.com/python/cpython/pull/112840) * [[3.9] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) #112842](https://github.com/python/cpython/pull/112842) * [[3.8] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) #112843](https://github.com/python/cpython/pull/112843) |
| The text was updated successfully, but these errors were encountered: |

All reactions

![@afeblot](https://avatars.githubusercontent.com/u/101755586?s=80&v=4)

Copy link

Mannequin

Author

### **afeblot mannequin** commented [Mar 10, 2022](#issuecomment-1093946353)

| ``` #!/usr/bin/env python3  import os import tempfile  def createUnremovableDir(workdir):     print(workdir)     os.mkdir(f'{workdir}/mydir')     os.symlink('/bin/bash', f'{workdir}/mydir/mylink') # Symlink to a root owned file     os.chmod(f'{workdir}/mydir', 0o555)  with tempfile.TemporaryDirectory() as workdir:     createUnremovableDir(workdir) ```  Fails because `tempfile.TemporaryDirectory._rmtree` tries to execute os.chmod(path, 0o700) on the symlink, which by default tries to change the root owned file symlink target instead of the symlink itself:  ``` /tmp/tmp1_dy42ef Traceback (most recent call last):   File "/usr/lib/python3.9/shutil.py", line 682, in _rmtree_safe_fd     os.unlink(entry.name, dir_fd=topfd) PermissionError: [Errno 13] Permission denied: 'mylink'  During handling of the above exception, another exception occurred:  Traceback (most recent call last):   File "~/tempfile_demo_bug.py", line 13, in <module>     createUnremovableDir(workdir)   File "/usr/lib/python3.9/tempfile.py", line 969, in __exit__     self.cleanup()   File "/usr/lib/python3.9/tempfile.py", line 973, in cleanup     self._rmtree(self.name)   File "/usr/lib/python3.9/tempfile.py", line 955, in _rmtree     _rmtree(name, onerror=onerror)   File "/usr/lib/python3.9/shutil.py", line 727, in rmtree     _rmtree_safe_fd(fd, path, onerror)   File "/usr/lib/python3.9/shutil.py", line 664, in _rmtree_safe_fd     _rmtree_safe_fd(dirfd, fullname, onerror)   File "/usr/lib/python3.9/shutil.py", line 684, in _rmtree_safe_fd     onerror(os.unlink, fullname, sys.exc_info())   File "/usr/lib/python3.9/tempfile.py", line 941, in onerror     resetperms(path)   File "/usr/lib/python3.9/tempfile.py", line 936, in resetperms     _os.chmod(path, 0o700) PermissionError: [Errno 1] Operation not permitted: '/tmp/tmp1_dy42ef/mydir/mylink'  ```  and leaves:  ``` (.venv python 3.9.9) $ find /tmp/tmp1_dy42ef -ls    148228      4 drwx------   3 myuser myuser     4096 Mar 10 16:54 /tmp/tmp1_dy42ef    148229      4 drwx------   2 myuser myuser     4096 Mar 10 16:54 /tmp/tmp1_dy42ef/mydir    148230      0 lrwxrwxrwx   1 myuser myuser        9 Mar 10 16:54 /tmp/tmp1_dy42ef/mydir/mylink -> /bin/bash   ```  This fixes it:  ``` #!/usr/bin/env python3  import os import tempfile  def createUnremovableDir(workdir):     print(workdir)     os.mkdir(f'{workdir}/mydir')     os.symlink('/bin/bash', f'{workdir}/mydir/mylink') # Symlink to a root owned file     os.chmod(f'{workdir}/mydir', 0o555)  def _rmtree(cls, name, ignore_errors=False):     def onerror(func, path, exc_info):         if issubclass(exc_info[0], PermissionError):             def resetperms(path):                 try:                     if os.chflags in os.supports_follow_symlinks:  # This is the patch                         os.chflags(path, 0, follow_symlinks=False) # This is the patch                     elif not os.path.islink(path):                 # This is the patch                         os.chflags(path, 0)                 except AttributeError:                     pass                 if os.chmod in os.supports_follow_symlinks:        # This is the patch                     os.chmod(path, 0o700, follow_symlinks=False)   # This is the patch                 elif not os.path.islink(path):                     # This is the patch                     os.chmod(path, 0o700)              try:                 if path != name:                     resetperms(os.path.dirname(path))                 resetperms(path)                  try:                     os.unlink(path)                 # PermissionError is raised on FreeBSD for directories                 except (IsADirectoryError, PermissionError):                     cls._rmtree(path, ignore_errors=ignore_errors)             except FileNotFoundError:                 pass         elif issubclass(exc_info[0], FileNotFoundError):             pass         else:             if not ignore_errors:                 raise      shutil.rmtree(name, onerror=onerror)  # Monkey patch the class method tempfile.TemporaryDirectory._rmtree from types import MethodType import shutil tempfile.TemporaryDirectory._rmtree = MethodType(_rmtree, tempfile.TemporaryDirectory)  with tempfile.TemporaryDirectory() as workdir:     createUnremovableDir(workdir) ``` |
| --- |

All reactions

Sorry, something went wrong.

![@afeblot](https://avatars.githubusercontent.com/u/101755586?s=40&v=4)
afeblot
mannequin
added
[3.9](/python/cpython/labels/3.9)
only security fixes
[stdlib](/python/cpython/labels/stdlib)
Python modules in the Lib dir
[type-crash](/python/cpython/labels/type-crash)
A hard crash of the interpreter, possibly with a core dump
labels
[Mar 10, 2022](#event-6404217386)

[![@ezio-melotti](https://avatars.githubusercontent.com/u/25624924?s=40&v=4)](/ezio-melotti)
[ezio-melotti](/ezio-melotti)
transferred this issue from another repository
[Apr 10, 2022](#event-6404217396)

[![@iritkatriel](https://avatars.githubusercontent.com/u/1055913?s=40&u=bd7f6cd5d9c24d45c154019042cdc3e9db610e36&v=4)](/iritkatriel)
[iritkatriel](/iritkatriel)
added
[type-bug](/python/cpython/labels/type-bug)
An unexpected behavior, bug, or error
and removed
[type-crash](/python/cpython/labels/type-crash)
A hard crash of the interpreter, possibly with a core dump
labels
[May 18, 2022](#event-6630731640)

[![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka)
[serhiy-storchaka](/serhiy-storchaka)
added this to [Tempfile issues](/orgs/python/projects/17)
[May 20, 2022](#event-15235855845)

[kwi-dk](/kwi-dk)
added a commit
to kwi-dk/cpython
that referenced
this issue
[Dec 1, 2022](#ref-commit-38f8356)
[![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk)

`[pythongh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug](/kwi-dk/cpython/commit/38f835665b79a752ac3ded66c1f83b573e6985eb "gh-91133: tempfile.TemporaryDirectory: fix symlink bug")`

`[38f8356](/kwi-dk/cpython/commit/38f835665b79a752ac3ded66c1f83b573e6985eb)`

[kwi-dk](/kwi-dk)
added a commit
to kwi-dk/cpython
that referenced
this issue
[Dec 1, 2022](#ref-commit-a826acf)
[![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk)

`[pythongh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug in cleanup](/kwi-dk/cpython/commit/a826acf38c5a3252b6cab0e5ae329cd172f0ea99 "gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup")`

`[a826acf](/kwi-dk/cpython/commit/a826acf38c5a3252b6cab0e5ae329cd172f0ea99)`

[![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk)
[kwi-dk](/kwi-dk)
mentioned this issue
[Dec 1, 2022](#ref-pullrequest-1471574211)

[gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup
#99930](/python/cpython/pull/99930)
 Merged

[kwi-dk](/kwi-dk)
added a commit
to kwi-dk/cpython
that referenced
this issue
[Dec 14, 2022](#ref-commit-d268947)
[![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk)

`[pythongh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug in cleanup](/kwi-dk/cpython/commit/d268947f7a846a7b91df054a4185b215dc794038 "gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup")`

`[d268947](/kwi-dk/cpython/commit/d268947f7a846a7b91df054a4185b215dc794038)`

[![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=80&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka)

Copy link

Member

### **[serhiy-storchaka](/serhiy-storchaka)** commented [Dec 7, 2023](#issuecomment-1845361003)

| I think that it is a security issue which allows an unprivileged user to reset permissions of files if they can run Python program that has higher privileges. There are be special conditions for this, but perhaps you can do this by making the program to unpack a special tarfile that contains symlinks out of the tree in temporary directory. |
| --- |

All reactions

Sorry, something went wrong.

[![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka)
[serhiy-storchaka](/serhiy-storchaka)
added
[type-security](/python/cpython/labels/type-security)
A security issue
[3.11](/python/cpython/labels/3.11)
only security fixes
[3.10](/python/cpython/labels/3.10)
only security fixes
[3.8 (EOL)](/python/cpython/labels/3.8%20%28EOL%29)
end of life
[3.12](/python/cpython/labels/3.12)
bugs and security fixes
[3.13](/python/cpython/labels/3.13)
bugs and security fixes
labels
[Dec 7, 2023](#event-11182142872)

[serhiy-storchaka](/serhiy-storchaka)
added a commit
that referenced
this issue
[Dec 7, 2023](#ref-commit-81c16cd)
[![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk) [![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka)

`[gh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug in cleanup (](/python/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d "gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)

Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>")[GH…](https://github.com/python/cpython/pull/99930)`
…

`[81c16cd](/python/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d)`

```
[…-99930](https://github.com/python/cpython/pull/99930))

Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>
```

[miss-islington](/miss-islington)
pushed a commit
to miss-islington/cpython
that referenced
this issue
[Dec 7, 2023](#ref-commit-1a0267a)
[![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk) [![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka) [![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&v=4)](/miss-islington)

`[pythongh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug in clean…](/miss-islington/cpython/commit/1a0267af7ce1f6b76364459b568fb7a3ac176a25 "gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>")`
…

`[1a0267a](/miss-islington/cpython/commit/1a0267af7ce1f6b76364459b568fb7a3ac176a25)`

```
…up ([pythonGH-99930](https://github.com/python/cpython/pull/99930))

(cherry picked from commit [81c16cd](https://github.com/miss-islington/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>
```

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this issue
[Dec 7, 2023](#ref-pullrequest-2031069886)

[[3.12] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
#112838](/python/cpython/pull/112838)
 Merged

[serhiy-storchaka](/serhiy-storchaka)
added a commit
to serhiy-storchaka/cpython
that referenced
this issue
[Dec 7, 2023](#ref-commit-7c5a128)
[![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk) [![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka)

`[[3.11]](/serhiy-storchaka/cpython/commit/7c5a1286ab0659f4028175f3ac91f32b5590ff8b "[3.11] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>") [pythongh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug i…](/serhiy-storchaka/cpython/commit/7c5a1286ab0659f4028175f3ac91f32b5590ff8b "[3.11] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>")`
…

`[7c5a128](/serhiy-storchaka/cpython/commit/7c5a1286ab0659f4028175f3ac91f32b5590ff8b)`

```
…n cleanup ([pythonGH-99930](https://github.com/python/cpython/pull/99930))

(cherry picked from commit [81c16cd](https://github.com/serhiy-storchaka/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>
```

This was referenced Dec 7, 2023

[[3.11] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
#112839](/python/cpython/pull/112839)
 Merged

[[3.10] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
#112840](/python/cpython/pull/112840)
 Merged

[serhiy-storchaka](/serhiy-storchaka)
added a commit
to serhiy-storchaka/cpython
that referenced
this issue
[Dec 7, 2023](#ref-commit-6a24d2a)
[![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk) [![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka)

`[[3.10]](/serhiy-storchaka/cpython/commit/6a24d2a124465440ed8b6c3c72b580bc0afad4b7 "[3.10] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>") [pythongh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug i…](/serhiy-storchaka/cpython/commit/6a24d2a124465440ed8b6c3c72b580bc0afad4b7 "[3.10] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>")`
…

`[6a24d2a](/serhiy-storchaka/cpython/commit/6a24d2a124465440ed8b6c3c72b580bc0afad4b7)`

```
…n cleanup ([pythonGH-99930](https://github.com/python/cpython/pull/99930))

(cherry picked from commit [81c16cd](https://github.com/serhiy-storchaka/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>
```

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this issue
[Dec 7, 2023](#ref-pullrequest-2031092012)

[[3.9] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
#112842](/python/cpython/pull/112842)
 Merged

[serhiy-storchaka](/serhiy-storchaka)
added a commit
to serhiy-storchaka/cpython
that referenced
this issue
[Dec 7, 2023](#ref-commit-cec0724)
[![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk) [![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka)

`[[3.9]](/serhiy-storchaka/cpython/commit/cec0724f046280053e895b891d405da37c2c9215 "[3.9] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>") [pythongh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug in…](/serhiy-storchaka/cpython/commit/cec0724f046280053e895b891d405da37c2c9215 "[3.9] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>")`
…

`[cec0724](/serhiy-storchaka/cpython/commit/cec0724f046280053e895b891d405da37c2c9215)`

```
… cleanup ([pythonGH-99930](https://github.com/python/cpython/pull/99930))

(cherry picked from commit [81c16cd](https://github.com/serhiy-storchaka/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>
```

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this issue
[Dec 7, 2023](#ref-pullrequest-2031097544)

[[3.8] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
#112843](/python/cpython/pull/112843)
 Merged

[serhiy-storchaka](/serhiy-storchaka)
added a commit
to serhiy-storchaka/cpython
that referenced
this issue
[Dec 7, 2023](#ref-commit-3ed752e)
[![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk) [![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka)

`[[3.8]](/serhiy-storchaka/cpython/commit/3ed752e27b85711d9779c26760a568cbfc9d9a84 "[3.8] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>") [pythongh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug in…](/serhiy-storchaka/cpython/commit/3ed752e27b85711d9779c26760a568cbfc9d9a84 "[3.8] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)
(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>")`
…

`[3ed752e](/serhiy-storchaka/cpython/commit/3ed752e27b85711d9779c26760a568cbfc9d9a84)`

```
… cleanup ([pythonGH-99930](https://github.com/python/cpython/pull/99930))

(cherry picked from commit [81c16cd](https://github.com/serhiy-storchaka/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>
```

[serhiy-storchaka](/serhiy-storchaka)
added a commit
that referenced
this issue
[Dec 7, 2023](#ref-commit-6ceb8ae)
[![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&u=31ad766412aaeb40a51582d882e34d67f2fae635&v=4)](/miss-islington) [![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk) [![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka)

`[[3.12]](/python/cpython/commit/6ceb8aeda504b079fef7a57b8d81472f15cdd9a5 "[3.12] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) (GH-112838)

(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>") [gh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug in clea…](/python/cpython/commit/6ceb8aeda504b079fef7a57b8d81472f15cdd9a5 "[3.12] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) (GH-112838)

(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>")`
…

`[6ceb8ae](/python/cpython/commit/6ceb8aeda504b079fef7a57b8d81472f15cdd9a5)`

```
…nup ([GH-99930](https://github.com/python/cpython/pull/99930)) ([GH-112838](https://github.com/python/cpython/pull/112838))

(cherry picked from commit [81c16cd](https://github.com/python/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>
```

[serhiy-storchaka](/serhiy-storchaka)
added a commit
that referenced
this issue
[Dec 7, 2023](#ref-commit-5585334)
[![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka) [![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk)

`[[3.11]](/python/cpython/commit/5585334d772b253a01a6730e8202ffb1607c3d25 "[3.11] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) (GH-112839)

(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>") [gh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug in clea…](/python/cpython/commit/5585334d772b253a01a6730e8202ffb1607c3d25 "[3.11] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) (GH-112839)

(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>")`
…

`[5585334](/python/cpython/commit/5585334d772b253a01a6730e8202ffb1607c3d25)`

```
…nup ([GH-99930](https://github.com/python/cpython/pull/99930)) ([GH-112839](https://github.com/python/cpython/pull/112839))

(cherry picked from commit [81c16cd](https://github.com/python/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
```

[![@gpshead](https://avatars.githubusercontent.com/u/68491?s=40&v=4)](/gpshead)
[gpshead](/gpshead)
changed the title
~~tempfile.TemporaryDirectory fails removing dir in some edge cases related to symlinks~~
tempfile.TemporaryDirectory fails removing dir in some edge cases related to symlinks [CVE-2023-6597]
[Dec 8, 2023](#event-11197964069)

[ambv](/ambv)
pushed a commit
that referenced
this issue
[Jan 17, 2024](#ref-commit-02a9259)
[![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka) [![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk)

`[[3.8]](/python/cpython/commit/02a9259c717738dfe6b463c44d7e17f2b6d2cb3a "[3.8] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) (GH-112843)

(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>") [gh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug in clean…](/python/cpython/commit/02a9259c717738dfe6b463c44d7e17f2b6d2cb3a "[3.8] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) (GH-112843)

(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>")`
…

`[02a9259](/python/cpython/commit/02a9259c717738dfe6b463c44d7e17f2b6d2cb3a)`

```
…up ([GH-99930](https://github.com/python/cpython/pull/99930)) ([GH-112843](https://github.com/python/cpython/pull/112843))

(cherry picked from commit [81c16cd](https://github.com/python/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
```

[ambv](/ambv)
pushed a commit
that referenced
this issue
[Jan 17, 2024](#ref-commit-d54e22a)
[![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka) [![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk)

`[[3.9]](/python/cpython/commit/d54e22a669ae6e987199bb5d2c69bb5a46b0083b "[3.9] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) (GH-112842)

(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>") [gh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug in clean…](/python/cpython/commit/d54e22a669ae6e987199bb5d2c69bb5a46b0083b "[3.9] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) (GH-112842)

(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>")`
…

`[d54e22a](/python/cpython/commit/d54e22a669ae6e987199bb5d2c69bb5a46b0083b)`

```
…up ([GH-99930](https://github.com/python/cpython/pull/99930)) ([GH-112842](https://github.com/python/cpython/pull/112842))

(cherry picked from commit [81c16cd](https://github.com/python/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
```

[ambv](/ambv)
pushed a commit
that referenced
this issue
[Jan 17, 2024](#ref-commit-8eaeefe)
[![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka) [![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk)

`[[3.10]](/python/cpython/commit/8eaeefe49d179ca4908d052745e3bb8b6f238f82 "[3.10] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) (GH-112840)

(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>") [gh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug in clea…](/python/cpython/commit/8eaeefe49d179ca4908d052745e3bb8b6f238f82 "[3.10] gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930) (GH-112840)

(cherry picked from commit 81c16cd94ec38d61aa478b9a452436dc3b1b524d)

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>")`
…

`[8eaeefe](/python/cpython/commit/8eaeefe49d179ca4908d052745e3bb8b6f238f82)`

```
…nup ([GH-99930](https://github.com/python/cpython/pull/99930)) ([GH-112840](https://github.com/python/cpython/pull/112840))

(cherry picked from commit [81c16cd](https://github.com/python/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d))

Co-authored-by: Søren Løvborg <sorenl@unity3d.com>
```

[aisk](/aisk)
pushed a commit
to aisk/cpython
that referenced
this issue
[Feb 11, 2024](#ref-commit-762c12e)
[![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk) [![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka) [![@aisk](https://avatars.githubusercontent.com/u/699636?s=40&v=4)](/aisk)

`[pythongh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug in clean…](/aisk/cpython/commit/762c12eb1cf67e0827f342355d85f24c772f5edf "gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)

Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>")`
…

`[762c12e](/aisk/cpython/commit/762c12eb1cf67e0827f342355d85f24c772f5edf)`

```
…up ([pythonGH-99930](https://github.com/python/cpython/pull/99930))

Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>
```

[![@gpshead](https://avatars.githubusercontent.com/u/68491?s=40&v=4)](/gpshead)
[gpshead](/gpshead)
moved this to **Done**
in [Tempfile issues](/orgs/python/projects/17)
[Feb 21, 2024](#event-15079193136)

[![@gpshead](https://avatars.githubusercontent.com/u/68491?s=80&v=4)](/gpshead)

Copy link

Member

### **[gpshead](/gpshead)** commented [Feb 21, 2024](#issuecomment-1957750357)

| the fixes were merged, releases will be going out soon. thanks for the report and PRs everyone! |
| --- |

All reactions

Sorry, something went wrong.

[![@gpshead](https://avatars.githubusercontent.com/u/68491?s=40&v=4)](/gpshead)
[gpshead](/gpshead)
closed this as [completed](/python/cpython/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Feb 21, 2024](#event-11881127332)

[![@sparrowt](https://avatars.githubusercontent.com/u/793763?s=80&u=17d190762144c19f6a9e895ff22ba726f63f2f66&v=4)](/sparrowt)

Copy link

Contributor

### **[sparrowt](/sparrowt)** commented [Apr 3, 2024](#issuecomment-2034224575)

| The GHSA page for this [CVE-2023-6597](https://github.com/advisories/GHSA-797f-63wg-8chv "CVE-2023-6597") [GHSA-797f-63wg-8chv](https://github.com/advisories/GHSA-797f-63wg-8chv "GHSA-797f-63wg-8chv") states that it affects python "versions 3.12.2, 3.11.8, ..." but AFAICS those versions both contain the fix (see `gh-91133` mentioned in [3.12.2 release notes](https://docs.python.org/3.12/whatsnew/changelog.html#python-3-12-2-final) and [3.11.8 release notes](https://docs.python.org/3.11/whatsnew/changelog.html#python-3-11-8-final)).  See also [this comment](https://github.com/python/cpython/issues/109858#issuecomment-2034212507) on another CVE-fixing-PR where the same thing has happened. |
| --- |

All reactions

Sorry, something went wrong.

[![@sethmlarson](https://avatars.githubusercontent.com/u/18519037?s=80&u=41090cc65ae0a34aee49c7a35cfbd40e2e12eb53&v=4)](/sethmlarson)

Copy link

Contributor

### **[sethmlarson](/sethmlarson)** commented [Apr 3, 2024](#issuecomment-2035557122)

| As noted here, I have fixed the CVE record metadata: [#109858 (comment)](https://github.com/python/cpython/issues/109858#issuecomment-2035556550) |
| --- |

All reactions

Sorry, something went wrong.

[![@sparrowt](https://avatars.githubusercontent.com/u/793763?s=80&u=17d190762144c19f6a9e895ff22ba726f63f2f66&v=4)](/sparrowt)

Copy link

Contributor

### **[sparrowt](/sparrowt)** commented [May 15, 2024](#issuecomment-2112841914)

| Thank you. Sadly [GHSA-797f-63wg-8chv](https://github.com/advisories/GHSA-797f-63wg-8chv "GHSA-797f-63wg-8chv") is still wrong :( |
| --- |

All reactions

Sorry, something went wrong.

[![@SmartManoj](https://avatars.githubusercontent.com/u/7231077?s=40&v=4)](/SmartManoj)
[SmartManoj](/SmartManoj)
mentioned this issue
[Jul 28, 2024](#ref-pullrequest-2433878645)

[CVE: Apply patched `tempfile` module to the affected test
All-Hands-AI/OpenHands#3155](/All-Hands-AI/OpenHands/pull/3155)
 Closed

[Glyphack](/Glyphack)
pushed a commit
to Glyphack/cpython
that referenced
this issue
[Sep 2, 2024](#ref-commit-0b01b50)
[![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&u=3342402a9bdb2db6e383b894536296740f73f19a&v=4)](/kwi-dk) [![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&u=1a0dce9f648413b5aabad98594a79a0949cc5682&v=4)](/serhiy-storchaka) [![@Glyphack](https://avatars.githubusercontent.com/u/20788334?s=40&v=4)](/Glyphack)

`[pythongh-91133](https://github.com/python/cpython/issues/91133)[: tempfile.TemporaryDirectory: fix symlink bug in clean…](/Glyphack/cpython/commit/0b01b5088bf23bc5bb65c7eb851a635b4ffeca2e "gh-91133: tempfile.TemporaryDirectory: fix symlink bug in cleanup (GH-99930)

Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>")`
…

`[0b01b50](/Glyphack/cpython/commit/0b01b5088bf23bc5bb65c7eb851a635b4ffeca2e)`

```
…up ([pythonGH-99930](https://github.com/python/cpython/pull/99930))

Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fissues%2F91133)

Assignees

No one assigned

Labels

[3.8 (EOL)](/python/cpython/labels/3.8%20%28EOL%29)
end of life
[3.9](/python/cpython/labels/3.9)
only security fixes
[3.10](/python/cpython/labels/3.10)
only security fixes
[3.11](/python/cpython/labels/3.11)
only security fixes
[3.12](/python/cpython/labels/3.12)
bugs and security fixes
[3.13](/python/cpython/labels/3.13)
bugs and security fixes
[stdlib](/python/cpython/labels/stdlib)
Python modules in the Lib dir
[type-bug](/python/cpython/labels/type-bug)
An unexpected behavior, bug, or error
[type-security](/python/cpython/labels/type-security)
A security issue

Projects

[Tempfile issues](/orgs/python/projects/17)
Status: Done

Milestone

No milestone

Development

No branches or pull requests

5 participants

[![@gpshead](https://avatars.githubusercontent.com/u/68491?s=52&v=4)](/gpshead) [![@sparrowt](https://avatars.githubusercontent.com/u/793763?s=52&v=4)](/sparrowt) [![@iritkatriel](https://avatars.githubusercontent.com/u/1055913?s=52&v=4)](/iritkatriel) [![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=52&v=4)](/serhiy-storchaka) [![@sethmlarson](https://avatars.githubusercontent.com/u/18519037?s=52&v=4)](/sethmlarson)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_0769ebf0_20250111_124959.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F81c16cd94ec38d61aa478b9a452436dc3b1b524d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F81c16cd94ec38d61aa478b9a452436dc3b1b524d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/81c16cd94ec38d61aa478b9a452436dc3b1b524d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[gh-91133](https://github.com/python/cpython/issues/91133): tempfile.TemporaryDirectory: fix symlink bug in cleanup ([GH…](https://github.com/python/cpython/pull/99930)

[Browse files](/python/cpython/tree/81c16cd94ec38d61aa478b9a452436dc3b1b524d)
Browse the repository at this point in the history

```
[…-99930](https://github.com/python/cpython/pull/99930))

Co-authored-by: Serhiy Storchaka <storchaka@gmail.com>
```

* Loading branch information

[![@kwi-dk](https://avatars.githubusercontent.com/u/1167359?s=40&v=4)](/kwi-dk) [![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=40&v=4)](/serhiy-storchaka)

[kwi-dk](/python/cpython/commits?author=kwi-dk "View all commits by kwi-dk")
and
[serhiy-storchaka](/python/cpython/commits?author=serhiy-storchaka "View all commits by serhiy-storchaka")
authored
Dec 7, 2023

1 parent
[21221c3](/python/cpython/commit/21221c398f6d89b2d9295895d8a2fd71d28138fa)

commit 81c16cd

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**125 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib

  + Lib/tempfile.py
    [tempfile.py](#diff-6553a99f3ae04c9fc9c2349ac27037bfe3b274d5ca54d5800d9c5b5f11e29d21)
  + test

    - Lib/test/test\_tempfile.py
      [test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983)
* Misc/NEWS.d/next/Library

  + Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst
    [2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst](#diff-f4f1ac9bf7b7e0f7c86de7e7cf998e1d40cbb748dc8a4f8c040364806139e39c)

## There are no files selected for viewing

27 changes: 18 additions & 9 deletions

27
[Lib/tempfile.py](#diff-6553a99f3ae04c9fc9c2349ac27037bfe3b274d5ca54d5800d9c5b5f11e29d21 "Lib/tempfile.py")

Show comments

[View file](/python/cpython/blob/81c16cd94ec38d61aa478b9a452436dc3b1b524d/Lib/tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -270,6 +270,22 @@ def \_mkstemp\_inner(dir, pre, suf, flags, output\_type): |
|  |  | raise FileExistsError(\_errno.EEXIST, |
|  |  | "No usable temporary file name found") |
|  |  |  |
|  |  | def \_dont\_follow\_symlinks(func, path, \*args): |
|  |  | # Pass follow\_symlinks=False, unless not supported on this platform. |
|  |  | if func in \_os.supports\_follow\_symlinks: |
|  |  | func(path, \*args, follow\_symlinks=False) |
|  |  | elif \_os.name == 'nt' or not \_os.path.islink(path): |
|  |  | func(path, \*args) |
|  |  |  |
|  |  | def \_resetperms(path): |
|  |  | try: |
|  |  | chflags = \_os.chflags |
|  |  | except AttributeError: |
|  |  | pass |
|  |  | else: |
|  |  | \_dont\_follow\_symlinks(chflags, path, 0) |
|  |  | \_dont\_follow\_symlinks(\_os.chmod, path, 0o700) |
|  |  |  |
|  |  |  |
|  |  | # User visible interfaces. |
|  |  |  |
| Expand Down  Expand Up | | @@ -876,17 +892,10 @@ def \_\_init\_\_(self, suffix=None, prefix=None, dir=None, |
|  |  | def \_rmtree(cls, name, ignore\_errors=False): |
|  |  | def onexc(func, path, exc): |
|  |  | if isinstance(exc, PermissionError): |
|  |  | def resetperms(path): |
|  |  | try: |
|  |  | \_os.chflags(path, 0) |
|  |  | except AttributeError: |
|  |  | pass |
|  |  | \_os.chmod(path, 0o700) |
|  |  |  |
|  |  | try: |
|  |  | if path != name: |
|  |  | resetperms(\_os.path.dirname(path)) |
|  |  | resetperms(path) |
|  |  | \_resetperms(\_os.path.dirname(path)) |
|  |  | \_resetperms(path) |
|  |  |  |
|  |  | try: |
|  |  | \_os.unlink(path) |
| Expand Down | |  |

111 changes: 105 additions & 6 deletions

111
[Lib/test/test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983 "Lib/test/test_tempfile.py")

Show comments

[View file](/python/cpython/blob/81c16cd94ec38d61aa478b9a452436dc3b1b524d/Lib/test/test_tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1673,6 +1673,103 @@ def test\_cleanup\_with\_symlink\_to\_a\_directory(self): |
|  |  | "were deleted") |
|  |  | d2.cleanup() |
|  |  |  |
|  |  | @os\_helper.skip\_unless\_symlink |
|  |  | def test\_cleanup\_with\_symlink\_modes(self): |
|  |  | # cleanup() should not follow symlinks when fixing mode bits (#91133) |
|  |  | with self.do\_create(recurse=0) as d2: |
|  |  | file1 = os.path.join(d2, 'file1') |
|  |  | open(file1, 'wb').close() |
|  |  | dir1 = os.path.join(d2, 'dir1') |
|  |  | os.mkdir(dir1) |
|  |  | for mode in range(8): |
|  |  | mode <<= 6 |
|  |  | with self.subTest(mode=format(mode, '03o')): |
|  |  | def test(target, target\_is\_directory): |
|  |  | d1 = self.do\_create(recurse=0) |
|  |  | symlink = os.path.join(d1.name, 'symlink') |
|  |  | os.symlink(target, symlink, |
|  |  | target\_is\_directory=target\_is\_directory) |
|  |  | try: |
|  |  | os.chmod(symlink, mode, follow\_symlinks=False) |
|  |  | except NotImplementedError: |
|  |  | pass |
|  |  | try: |
|  |  | os.chmod(symlink, mode) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | os.chmod(d1.name, mode) |
|  |  | d1.cleanup() |
|  |  | self.assertFalse(os.path.exists(d1.name)) |
|  |  |  |
|  |  | with self.subTest('nonexisting file'): |
|  |  | test('nonexisting', target\_is\_directory=False) |
|  |  | with self.subTest('nonexisting dir'): |
|  |  | test('nonexisting', target\_is\_directory=True) |
|  |  |  |
|  |  | with self.subTest('existing file'): |
|  |  | os.chmod(file1, mode) |
|  |  | old\_mode = os.stat(file1).st\_mode |
|  |  | test(file1, target\_is\_directory=False) |
|  |  | new\_mode = os.stat(file1).st\_mode |
|  |  | self.assertEqual(new\_mode, old\_mode, |
|  |  | '%03o != %03o' % (new\_mode, old\_mode)) |
|  |  |  |
|  |  | with self.subTest('existing dir'): |
|  |  | os.chmod(dir1, mode) |
|  |  | old\_mode = os.stat(dir1).st\_mode |
|  |  | test(dir1, target\_is\_directory=True) |
|  |  | new\_mode = os.stat(dir1).st\_mode |
|  |  | self.assertEqual(new\_mode, old\_mode, |
|  |  | '%03o != %03o' % (new\_mode, old\_mode)) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | @os\_helper.skip\_unless\_symlink |
|  |  | def test\_cleanup\_with\_symlink\_flags(self): |
|  |  | # cleanup() should not follow symlinks when fixing flags (#91133) |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  | self.check\_flags(flags) |
|  |  |  |
|  |  | with self.do\_create(recurse=0) as d2: |
|  |  | file1 = os.path.join(d2, 'file1') |
|  |  | open(file1, 'wb').close() |
|  |  | dir1 = os.path.join(d2, 'dir1') |
|  |  | os.mkdir(dir1) |
|  |  | def test(target, target\_is\_directory): |
|  |  | d1 = self.do\_create(recurse=0) |
|  |  | symlink = os.path.join(d1.name, 'symlink') |
|  |  | os.symlink(target, symlink, |
|  |  | target\_is\_directory=target\_is\_directory) |
|  |  | try: |
|  |  | os.chflags(symlink, flags, follow\_symlinks=False) |
|  |  | except NotImplementedError: |
|  |  | pass |
|  |  | try: |
|  |  | os.chflags(symlink, flags) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | os.chflags(d1.name, flags) |
|  |  | d1.cleanup() |
|  |  | self.assertFalse(os.path.exists(d1.name)) |
|  |  |  |
|  |  | with self.subTest('nonexisting file'): |
|  |  | test('nonexisting', target\_is\_directory=False) |
|  |  | with self.subTest('nonexisting dir'): |
|  |  | test('nonexisting', target\_is\_directory=True) |
|  |  |  |
|  |  | with self.subTest('existing file'): |
|  |  | os.chflags(file1, flags) |
|  |  | old\_flags = os.stat(file1).st\_flags |
|  |  | test(file1, target\_is\_directory=False) |
|  |  | new\_flags = os.stat(file1).st\_flags |
|  |  | self.assertEqual(new\_flags, old\_flags) |
|  |  |  |
|  |  | with self.subTest('existing dir'): |
|  |  | os.chflags(dir1, flags) |
|  |  | old\_flags = os.stat(dir1).st\_flags |
|  |  | test(dir1, target\_is\_directory=True) |
|  |  | new\_flags = os.stat(dir1).st\_flags |
|  |  | self.assertEqual(new\_flags, old\_flags) |
|  |  |  |
|  |  | @support.cpython\_only |
|  |  | def test\_del\_on\_collection(self): |
|  |  | # A TemporaryDirectory is deleted when garbage collected |
| Expand Down  Expand Up | | @@ -1845,10 +1942,7 @@ def test\_modes(self): |
|  |  | d.cleanup() |
|  |  | self.assertFalse(os.path.exists(d.name)) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | def test\_flags(self): |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  |  |
|  |  | def check\_flags(self, flags): |
|  |  | # skip the test if these flags are not supported (ex: FreeBSD 13) |
|  |  | filename = os\_helper.TESTFN |
|  |  | try: |
| Expand All | | @@ -1857,13 +1951,18 @@ def test\_flags(self): |
|  |  | os.chflags(filename, flags) |
|  |  | except OSError as exc: |
|  |  | # "OSError: [Errno 45] Operation not supported" |
|  |  | self.skipTest(f"chflags() doesn't support " |
|  |  | f"UF\_IMMUTABLE|UF\_NOUNLINK: {exc}") |
|  |  | self.skipTest(f"chflags() doesn't support flags " |
|  |  | f"{flags:#b}: {exc}") |
|  |  | else: |
|  |  | os.chflags(filename, 0) |
|  |  | finally: |
|  |  | os\_helper.unlink(filename) |
|  |  |  |
|  |  | @unittest.skipUnless(hasattr(os, 'chflags'), 'requires os.chflags') |
|  |  | def test\_flags(self): |
|  |  | flags = stat.UF\_IMMUTABLE | stat.UF\_NOUNLINK |
|  |  | self.check\_flags(flags) |
|  |  |  |
|  |  | d = self.do\_create(recurse=3, dirs=2, files=2) |
|  |  | with d: |
|  |  | # Change files and directories flags recursively. |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst](#diff-f4f1ac9bf7b7e0f7c86de7e7cf998e1d40cbb748dc8a4f8c040364806139e39c "Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst")

Show comments

[View file](/python/cpython/blob/81c16cd94ec38d61aa478b9a452436dc3b1b524d/Misc/NEWS.d/next/Library/2022-12-01-16-57-44.gh-issue-91133.LKMVCV.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,2 @@ |
|  |  | Fix a bug in :class:`tempfile.TemporaryDirectory` cleanup, which now no longer |
|  |  | dereferences symlinks when working around file system permission errors. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `81c16cd`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F81c16cd94ec38d61aa478b9a452436dc3b1b524d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


