=== Content from github.com_0852999a_20250111_043230.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F65cc597cea28cdc25bea3b8a86384b4251872919)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F65cc597cea28cdc25bea3b8a86384b4251872919)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=moby%2Fmoby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moby](/moby)
/
**[moby](/moby/moby)**
Public

* [Notifications](/login?return_to=%2Fmoby%2Fmoby) You must be signed in to change notification settings
* [Fork
  18.7k](/login?return_to=%2Fmoby%2Fmoby)
* [Star
   69k](/login?return_to=%2Fmoby%2Fmoby)

* [Code](/moby/moby)
* [Issues
  3.1k](/moby/moby/issues)
* [Pull requests
  419](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects
  4](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

Additional navigation options

* [Code](/moby/moby)
* [Issues](/moby/moby/issues)
* [Pull requests](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

## Commit

[Permalink](/moby/moby/commit/65cc597cea28cdc25bea3b8a86384b4251872919)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/moby/moby/tree/65cc597cea28cdc25bea3b8a86384b4251872919)
Browse the repository at this point in the history

```
[25.0] AuthZ plugin security fixes
```

* Loading branch information

[![@thaJeztah](https://avatars.githubusercontent.com/u/1804568?s=40&v=4)](/thaJeztah)

[thaJeztah](/moby/moby/commits?author=thaJeztah "View all commits by thaJeztah")
authored
Jul 23, 2024

2 parents
[b722836](/moby/moby/commit/b722836927669b414569c42f096869cd800b59a6)
+
[91903e8](/moby/moby/commit/91903e81ca3e358dd489fc2a0cbbfef607a95cd2)

commit 65cc597

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**115 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* pkg/authorization

  + pkg/authorization/authz.go
    [authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320)
  + pkg/authorization/authz\_unix\_test.go
    [authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321)

## There are no files selected for viewing

38 changes: 34 additions & 4 deletions

38
[pkg/authorization/authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320 "pkg/authorization/authz.go")

Show comments

[View file](/moby/moby/blob/65cc597cea28cdc25bea3b8a86384b4251872919/pkg/authorization/authz.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,6 +8,8 @@ import ( |
|  |  | "io" |
|  |  | "mime" |
|  |  | "net/http" |
|  |  | "net/url" |
|  |  | "regexp" |
|  |  | "strings" |
|  |  |  |
|  |  | "github.com/containerd/log" |
| Expand Down  Expand Up | | @@ -53,10 +55,23 @@ type Ctx struct { |
|  |  | authReq \*Request |
|  |  | } |
|  |  |  |
|  |  | func isChunked(r \*http.Request) bool { |
|  |  | // RFC 7230 specifies that content length is to be ignored if Transfer-Encoding is chunked |
|  |  | if strings.EqualFold(r.Header.Get("Transfer-Encoding"), "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | for \_, v := range r.TransferEncoding { |
|  |  | if strings.EqualFold(v, "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // AuthZRequest authorized the request to the docker daemon using authZ plugins |
|  |  | func (ctx \*Ctx) AuthZRequest(w http.ResponseWriter, r \*http.Request) error { |
|  |  | var body []byte |
|  |  | if sendBody(ctx.requestURI, r.Header) && r.ContentLength > 0 && r.ContentLength < maxBodySize { |
|  |  | if sendBody(ctx.requestURI, r.Header) && (r.ContentLength > 0 || isChunked(r)) && r.ContentLength < maxBodySize { |
|  |  | var err error |
|  |  | body, r.Body, err = drainBody(r.Body) |
|  |  | if err != nil { |
| Expand Down  Expand Up | | @@ -109,7 +124,6 @@ func (ctx \*Ctx) AuthZResponse(rm ResponseModifier, r \*http.Request) error { |
|  |  | if sendBody(ctx.requestURI, rm.Header()) { |
|  |  | ctx.authReq.ResponseBody = rm.RawBody() |
|  |  | } |
|  |  |  |
|  |  | for \_, plugin := range ctx.plugins { |
|  |  | log.G(context.TODO()).Debugf("AuthZ response using plugin %s", plugin.Name()) |
|  |  |  |
| Expand Down  Expand Up | | @@ -147,10 +161,26 @@ func drainBody(body io.ReadCloser) ([]byte, io.ReadCloser, error) { |
|  |  | return nil, newBody, err |
|  |  | } |
|  |  |  |
|  |  | func isAuthEndpoint(urlPath string) (bool, error) { |
|  |  | // eg www.test.com/v1.24/auth/optional?optional1=something&optional2=something (version optional) |
|  |  | matched, err := regexp.MatchString(`^[^\/]\*\/(v\d[\d\.]\*\/)?auth.\*`, urlPath) |
|  |  | if err != nil { |
|  |  | return false, err |
|  |  | } |
|  |  | return matched, nil |
|  |  | } |
|  |  |  |
|  |  | // sendBody returns true when request/response body should be sent to AuthZPlugin |
|  |  | func sendBody(url string, header http.Header) bool { |
|  |  | func sendBody(inURL string, header http.Header) bool { |
|  |  | u, err := url.Parse(inURL) |
|  |  | // Assume no if the URL cannot be parsed - an empty request will still be forwarded to the plugin and should be rejected |
|  |  | if err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // Skip body for auth endpoint |
|  |  | if strings.HasSuffix(url, "/auth") { |
|  |  | isAuth, err := isAuthEndpoint(u.Path) |
|  |  | if isAuth || err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
| Expand Down | |  |

84 changes: 81 additions & 3 deletions

84
[pkg/authorization/authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321 "pkg/authorization/authz_unix_test.go")

Show comments

[View file](/moby/moby/blob/65cc597cea28cdc25bea3b8a86384b4251872919/pkg/authorization/authz_unix_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -174,8 +174,8 @@ func TestDrainBody(t \*testing.T) { |
|  |  |  |
|  |  | func TestSendBody(t \*testing.T) { |
|  |  | var ( |
|  |  | url = "nothing.com" |
|  |  | testcases = []struct { |
|  |  | url string |
|  |  | contentType string |
|  |  | expected bool |
|  |  | }{ |
| Expand Down  Expand Up | | @@ -219,15 +219,93 @@ func TestSendBody(t \*testing.T) { |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth?p1=test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | } |
|  |  | ) |
|  |  |  |
|  |  | for \_, testcase := range testcases { |
|  |  | header := http.Header{} |
|  |  | header.Set("Content-Type", testcase.contentType) |
|  |  | if testcase.url == "" { |
|  |  | testcase.url = "nothing.com" |
|  |  | } |
|  |  |  |
|  |  | if b := sendBody(url, header); b != testcase.expected { |
|  |  | t.Fatalf("Unexpected Content-Type; Expected: %t, Actual: %t", testcase.expected, b) |
|  |  | if b := sendBody(testcase.url, header); b != testcase.expected { |
|  |  | t.Fatalf("sendBody failed: url: %s, content-type: %s; Expected: %t, Actual: %t", testcase.url, testcase.contentType, testcase.expected, b) |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `65cc597`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F65cc597cea28cdc25bea3b8a86384b4251872919) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e3b22743_20250111_043231.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fa31260625655cff9ae226b51757915e275e304b0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fa31260625655cff9ae226b51757915e275e304b0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=moby%2Fmoby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moby](/moby)
/
**[moby](/moby/moby)**
Public

* [Notifications](/login?return_to=%2Fmoby%2Fmoby) You must be signed in to change notification settings
* [Fork
  18.7k](/login?return_to=%2Fmoby%2Fmoby)
* [Star
   69k](/login?return_to=%2Fmoby%2Fmoby)

* [Code](/moby/moby)
* [Issues
  3.1k](/moby/moby/issues)
* [Pull requests
  419](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects
  4](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

Additional navigation options

* [Code](/moby/moby)
* [Issues](/moby/moby/issues)
* [Pull requests](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

## Commit

[Permalink](/moby/moby/commit/a31260625655cff9ae226b51757915e275e304b0)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/moby/moby/tree/a31260625655cff9ae226b51757915e275e304b0)
Browse the repository at this point in the history

```
[26.0] AuthZ plugin security fixes
```

* Loading branch information

[![@thaJeztah](https://avatars.githubusercontent.com/u/1804568?s=40&v=4)](/thaJeztah)

[thaJeztah](/moby/moby/commits?author=thaJeztah "View all commits by thaJeztah")
authored
Jul 23, 2024

2 parents
[8ce163b](/moby/moby/commit/8ce163b7dc6542865ce50c82727325f6ab87bf3b)
+
[754d8f1](/moby/moby/commit/754d8f168eab61636602def59b91405795644574)

commit a312606

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**115 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* pkg/authorization

  + pkg/authorization/authz.go
    [authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320)
  + pkg/authorization/authz\_unix\_test.go
    [authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321)

## There are no files selected for viewing

38 changes: 34 additions & 4 deletions

38
[pkg/authorization/authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320 "pkg/authorization/authz.go")

Show comments

[View file](/moby/moby/blob/a31260625655cff9ae226b51757915e275e304b0/pkg/authorization/authz.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,6 +8,8 @@ import ( |
|  |  | "io" |
|  |  | "mime" |
|  |  | "net/http" |
|  |  | "net/url" |
|  |  | "regexp" |
|  |  | "strings" |
|  |  |  |
|  |  | "github.com/containerd/log" |
| Expand Down  Expand Up | | @@ -53,10 +55,23 @@ type Ctx struct { |
|  |  | authReq \*Request |
|  |  | } |
|  |  |  |
|  |  | func isChunked(r \*http.Request) bool { |
|  |  | // RFC 7230 specifies that content length is to be ignored if Transfer-Encoding is chunked |
|  |  | if strings.EqualFold(r.Header.Get("Transfer-Encoding"), "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | for \_, v := range r.TransferEncoding { |
|  |  | if strings.EqualFold(v, "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // AuthZRequest authorized the request to the docker daemon using authZ plugins |
|  |  | func (ctx \*Ctx) AuthZRequest(w http.ResponseWriter, r \*http.Request) error { |
|  |  | var body []byte |
|  |  | if sendBody(ctx.requestURI, r.Header) && r.ContentLength > 0 && r.ContentLength < maxBodySize { |
|  |  | if sendBody(ctx.requestURI, r.Header) && (r.ContentLength > 0 || isChunked(r)) && r.ContentLength < maxBodySize { |
|  |  | var err error |
|  |  | body, r.Body, err = drainBody(r.Body) |
|  |  | if err != nil { |
| Expand Down  Expand Up | | @@ -109,7 +124,6 @@ func (ctx \*Ctx) AuthZResponse(rm ResponseModifier, r \*http.Request) error { |
|  |  | if sendBody(ctx.requestURI, rm.Header()) { |
|  |  | ctx.authReq.ResponseBody = rm.RawBody() |
|  |  | } |
|  |  |  |
|  |  | for \_, plugin := range ctx.plugins { |
|  |  | log.G(context.TODO()).Debugf("AuthZ response using plugin %s", plugin.Name()) |
|  |  |  |
| Expand Down  Expand Up | | @@ -147,10 +161,26 @@ func drainBody(body io.ReadCloser) ([]byte, io.ReadCloser, error) { |
|  |  | return nil, newBody, err |
|  |  | } |
|  |  |  |
|  |  | func isAuthEndpoint(urlPath string) (bool, error) { |
|  |  | // eg www.test.com/v1.24/auth/optional?optional1=something&optional2=something (version optional) |
|  |  | matched, err := regexp.MatchString(`^[^\/]\*\/(v\d[\d\.]\*\/)?auth.\*`, urlPath) |
|  |  | if err != nil { |
|  |  | return false, err |
|  |  | } |
|  |  | return matched, nil |
|  |  | } |
|  |  |  |
|  |  | // sendBody returns true when request/response body should be sent to AuthZPlugin |
|  |  | func sendBody(url string, header http.Header) bool { |
|  |  | func sendBody(inURL string, header http.Header) bool { |
|  |  | u, err := url.Parse(inURL) |
|  |  | // Assume no if the URL cannot be parsed - an empty request will still be forwarded to the plugin and should be rejected |
|  |  | if err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // Skip body for auth endpoint |
|  |  | if strings.HasSuffix(url, "/auth") { |
|  |  | isAuth, err := isAuthEndpoint(u.Path) |
|  |  | if isAuth || err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
| Expand Down | |  |

84 changes: 81 additions & 3 deletions

84
[pkg/authorization/authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321 "pkg/authorization/authz_unix_test.go")

Show comments

[View file](/moby/moby/blob/a31260625655cff9ae226b51757915e275e304b0/pkg/authorization/authz_unix_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -174,8 +174,8 @@ func TestDrainBody(t \*testing.T) { |
|  |  |  |
|  |  | func TestSendBody(t \*testing.T) { |
|  |  | var ( |
|  |  | url = "nothing.com" |
|  |  | testcases = []struct { |
|  |  | url string |
|  |  | contentType string |
|  |  | expected bool |
|  |  | }{ |
| Expand Down  Expand Up | | @@ -219,15 +219,93 @@ func TestSendBody(t \*testing.T) { |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth?p1=test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | } |
|  |  | ) |
|  |  |  |
|  |  | for \_, testcase := range testcases { |
|  |  | header := http.Header{} |
|  |  | header.Set("Content-Type", testcase.contentType) |
|  |  | if testcase.url == "" { |
|  |  | testcase.url = "nothing.com" |
|  |  | } |
|  |  |  |
|  |  | if b := sendBody(url, header); b != testcase.expected { |
|  |  | t.Fatalf("Unexpected Content-Type; Expected: %t, Actual: %t", testcase.expected, b) |
|  |  | if b := sendBody(testcase.url, header); b != testcase.expected { |
|  |  | t.Fatalf("sendBody failed: url: %s, content-type: %s; Expected: %t, Actual: %t", testcase.url, testcase.contentType, testcase.expected, b) |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a312606`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fa31260625655cff9ae226b51757915e275e304b0) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from security.netapp.com_0d5f2a83_20250111_043236.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [CVE-2024-41110 Docker Vulnerability in NetApp Products](https://security.netapp.com/advisory/ntap-20240802-0001)

## CVE-2024-41110 Docker Vulnerability in NetApp Products

circle-info

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20240802-0001 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20240802-0001 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20240802-0001 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20240802-0001 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20240802-0001
**Version:**
6.0

**Last updated:**
11/22/2024

**Status:**
Interim.

**CVEs:** CVE-2024-41110

Overview
#### Summary

Multiple NetApp products incorporate Docker. Docker Engine versions through v19.03.15, through v20.10.27, through v23.0.14, through v24.0.9, through v25.0.5, through v26.0.2, through v26.1.4, through v27.0.3 and through v27.1.0 are susceptible to a vulnerability when authorization plugins are used to make access control decisions which when successfully exploited could lead to disclosure of information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of this vulnerability could lead to disclosure of information, addition or modification of data, or Denial of Service (DoS).

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2024-41110](https://nvd.nist.gov/vuln/detail/CVE-2024-41110) | 9.9 (CRITICAL) | CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

#### References

* <https://www.docker.com/blog/docker-security-advisory-docker-engine-authz-plugin/>
* <https://github.com/moby/moby/security/advisories/GHSA-v23v-6jw2-98fq>

Affected Products
#### Affected Products

None.

#### Products Not Affected

* AFF BIOS - A1K/A70/A90
* AFF BIOS - A700s
* AFF Baseboard Management Controller (BMC) - A1K/A70/A90
* AFF Baseboard Management Controller (BMC) - A700s
* AFF LOADER- A1K/A70/A90
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Control Center
* Astra Control Center - NetApp Kubernetes Monitoring Operator
* Astra Control Provisioner
* Astra Trident
* Astra Trident Autosupport
* BlueXP Classification
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Volumes ONTAP Mediator
* Data Infrastructure Insights Acquisition Unit (formerly Cloud Insights Acquisition Unit)
* Data Infrastructure Insights Storage Workload Security Agent (formerly Cloud Insights Storage Workload Security Agent)
* Data Infrastructure Insights Telegraf Agent (formerly Cloud Insights Telegraf Agent)
* E-Series BIOS
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Powershell Tools
* Element Python SDK
* FAS/AFF BIOS - 2820
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF BIOS - A250/500f/C250
* FAS/AFF BIOS - A300/8200/C190/A220/2720/2750/A150
* FAS/AFF BIOS - A320
* FAS/AFF BIOS - A700/9000
* FAS/AFF BIOS - A800/C800
* FAS/AFF BIOS - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - A320
* FAS/AFF Baseboard Management Controller (BMC) - A800/C800
* FAS/AFF Baseboard Management Controller (BMC) - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - C190/A150/A220/FAS2720/FAS2750
* FAS/AFF Baseboard Management Controller (BMC) - FAS2820
* FAS/AFF Service Processor - A300/8200
* FAS/AFF Service Processor - A700/9000
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM12 SAS Disk Shelf Firmware
* IOM12B SAS Disk Shelf Firmware
* IOM12E SAS Disk Shelf Firmware
* IOM12F SAS Disk Shelf Firmware
* IOM12G SAS Disk Shelf Firmware
* IOM6 SAS Disk Shelf Firmware
* IOM6E SAS Disk Shelf Firmware
* Management Services for Element Software and NetApp HCI
* MetroCluster DataCollector
* MetroCluster Tiebreaker
* Multipath I/O (SANtricity DSM for Windows MPIO)
* NetApp BlueXP
* NetApp Converged Systems Advisor Agent
* NetApp DataOps Toolkit
* NetApp E-Series Host Collection
* NetApp E-Series SANtricity Collection
* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node (Bootstrap OS)
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Kubernetes Monitoring Operator
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP 9
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP Select Deploy administration utility
* ONTAP tools for VMware vSphere 10
* ONTAP tools for VMware vSphere 9
* OnCommand Insight
* OnCommand Workflow Automation
* RcfFileGenerator for MetroCluster IP
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine
* SnapGathers
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID BIOS SG1000/SG100/SG1100/SG110
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG5812/SG5860
* StorageGRID BIOS SG6060/SGF6024/SGF6112/SG6160
* StorageGRID Baseboard Management Controller (BMC) - SG6060/SG6160/SGF6024/SGF6112/SG100/SG110/SG1000/SG1100
* StorageGRID Baseboard Management Controller (BMC) SG5812/SG5860
* System Manager 9.x
* Terraform Provider for ONTAP
* Workload Factory for VMware

Remediation
#### Software Versions and Fixes

None.

This section will be updated as patches are released.

#### Workarounds

None.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

mysupport.netapp.com

1 888 4 NETAPP (1 888 463 8277) (U.S. and Canada)

+00 800 44 638277 (EMEA/Europe)

+800 800 80 800 (Asia/Pacific)

Revision History
#### Status of This Notice

**Interim.**

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20240802-0001>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20240802 | Initial Public Release |
| 2.0 | 20240808 | E-Series SANtricity OS Controller Software 11.x moved to Products Not Affected |
| 3.0 | 20240814 | Astra Control Provisioner, Astra Trident and Astra Trident Autosupport moved to Products Not Affected |
| 4.0 | 20240821 | SANtricity Storage Plugin for vCenter moved to Products Not Affected |
| 5.0 | 20241030 | Brocade SAN Navigator (SANnav) Firmware moved to Products Not Affected |
| 6.0 | 20241122 | ONTAP tools for VMware vSphere 10 moved to Products Not Affected |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from www.docker.com_afe14851_20250111_043237.html ===

![](https://www.docker.com/wp-content/uploads/2024/01/icon-new.svg)[Incident Update: Docker Desktop for Mac. Learn more](https://www.docker.com/blog/incident-update-docker-desktop-for-mac/)
[Docs](https://docs.docker.com/build/cloud/)
[Get support](/support/)
[Contact sales](/pricing/contact-sales/)

* [xml version="1.0" encoding="UTF-8"?](/)
* [Productsxml version="1.0" encoding="utf-8"?](/products/)
  + Products

    - [Docker Desktop](https://www.docker.com/products/docker-desktop/)Containerize your applications
    - [Docker Hub](https://www.docker.com/products/docker-hub/)Discover and share container images
    - [Docker Scout](https://www.docker.com/products/docker-scout/)Simplify the software supply chain
    - [Docker Build Cloud](https://www.docker.com/products/build-cloud/)Speed up your image builds
    - [Testcontainers Desktopxml version="1.0" encoding="UTF-8"?](https://testcontainers.com/desktop/) Local testing with real dependencies
    - [Testcontainers Cloudxml version="1.0" encoding="UTF-8"?](https://testcontainers.com/cloud/) Test without limits in the cloud
    - [See our product roadmap](https://github.com/docker/roadmap)
  + MORE resources for developers

    Docker Desktop v4.37

    Find out what’s new to Docker Desktop in the latest release
    [Read more](https://www.docker.com/blog/docker-desktop-4-37/)
- Developersxml version="1.0" encoding="utf-8"?
  * Developers

    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-book-closed.svg)
    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-atom.svg)[Getting Started](https://www.docker.com/get-started/)Learn the Docker basics
    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-graduation-hat.svg)[Resources](https://www.docker.com/resources/)Search a library of helpful materials
    + ![icon](https://www.docker.com/wp-content/uploads/2024/06/icon-youtube.svg)[Training](/resources/trainings/)Skill up your Docker knowledge
    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-puzzle-piece.svg)[Extensions SDK](https://www.docker.com/developers/sdk/)Create and share your own extensions
    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-heart-hand.svg)[Community](https://www.docker.com/community/)Connect with other Docker developers
    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-container.svg)[Open Source](https://www.docker.com/products/trusted-open-source-content/)Explore open source projects
    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-eye.svg)[Preview Program](https://www.docker.com/community/get-involved/developer-preview/)Help shape the future of Docker
    + ![icon](https://www.docker.com/wp-content/uploads/2024/06/icon-blue-users-01.svg)[Customer Stories](/customer-stories/)Get inspired with customer stories
    + [Get the latest Docker news](/newsletter-subscription/)
  * MORE resources for developers

    Webinar: Docker 2024

    Sign up for an exciting round-up of Docker innovation, live on January 15th
    [Read more](https://www.docker.com/resources/docker-2024-cloud-genai-development-innovations-webinar/)

    2024 State Of Application Development Report

    A deep-focus snapshot of the evolving software development world
    [Read more](https://www.docker.com/resources/2024-state-of-application-development-report/)
- [Pricing](https://www.docker.com/pricing/)
- [Support](https://www.docker.com/support/)
- [Blog](https://www.docker.com/blog/)
- [Companyxml version="1.0" encoding="utf-8"?](https://www.docker.com/company/)
  * Company

    + [About Us](https://www.docker.com/company/)Let us introduce ourselves
    + [What is a Container?](/resources/what-container/)Learn about containerization
    + [Why Docker](https://www.docker.com/why-docker/)Discover what makes us different
    + [Trust](https://www.docker.com/trust/)Find our customer trust resources
    + [Partners](/partners/)Become a Docker partner
    + [Customer Success](https://www.docker.com/customer-success/)Learn how you can succeed with Docker
    + [Events](https://www.docker.com/events/)Attend live and virtual meet ups
    + [Docker Storexml version="1.0" encoding="UTF-8"?](https://stores.kotisdesign.com/docker) Gear up with exclusive SWAG
    + [Careers](https://www.docker.com/careers/)Apply to join our team
    + [Contact Us](https://www.docker.com/company/contact/)We’d love to hear from you
  * Company

    Docker Announces SOC 2 Type 2 Attestation & ISO 27001 Certification

    Learn what this means for Docker security and compliance
    [Read more](https://www.docker.com/blog/docker-announces-soc-2-type-2-attestation-iso-27001-certification/)
- [Get started](/get-started/)
- [Docs](https://docs.docker.com/build/cloud/)
- [Get support](/support/)
- [Contact sales](/pricing/contact-sales/)
- * search
  [Sign In](https://app.docker.com/login)
  [Get started](/get-started/)
- xml version="1.0" encoding="utf-8"?

+ search
* [Productsxml version="1.0" encoding="utf-8"?](/products/)
  + Products

    - [Docker Desktop](https://www.docker.com/products/docker-desktop/)Containerize your applications
    - [Docker Hub](https://www.docker.com/products/docker-hub/)Discover and share container images
    - [Docker Scout](https://www.docker.com/products/docker-scout/)Simplify the software supply chain
    - [Docker Build Cloud](https://www.docker.com/products/build-cloud/)Speed up your image builds
    - [Testcontainers Desktopxml version="1.0" encoding="UTF-8"?](https://testcontainers.com/desktop/) Local testing with real dependencies
    - [Testcontainers Cloudxml version="1.0" encoding="UTF-8"?](https://testcontainers.com/cloud/) Test without limits in the cloud
    - [See our product roadmap](https://github.com/docker/roadmap)
  + MORE resources for developers

    Docker Desktop v4.37

    Find out what’s new to Docker Desktop in the latest release
    [Read more](https://www.docker.com/blog/docker-desktop-4-37/)

- Developersxml version="1.0" encoding="utf-8"?
  * Developers

    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-book-closed.svg)[Documentationxml version="1.0" encoding="UTF-8"?](https://docs.docker.com/) Find guides for Docker products
    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-atom.svg)[Getting Started](https://www.docker.com/get-started/)Learn the Docker basics
    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-graduation-hat.svg)[Resources](https://www.docker.com/resources/)Search a library of helpful materials
    + ![icon](https://www.docker.com/wp-content/uploads/2024/06/icon-youtube.svg)[Training](/resources/trainings/)Skill up your Docker knowledge
    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-puzzle-piece.svg)[Extensions SDK](https://www.docker.com/developers/sdk/)Create and share your own extensions
    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-heart-hand.svg)[Community](https://www.docker.com/community/)Connect with other Docker developers
    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-container.svg)[Open Source](https://www.docker.com/products/trusted-open-source-content/)Explore open source projects
    + ![icon](https://www.docker.com/wp-content/uploads/2024/05/icon-eye.svg)[Preview Program](https://www.docker.com/community/get-involved/developer-preview/)Help shape the future of Docker
    + ![icon](https://www.docker.com/wp-content/uploads/2024/06/icon-blue-users-01.svg)[Customer Stories](/customer-stories/)Get inspired with customer stories
    + [Get the latest Docker news](/newsletter-subscription/)
  * MORE resources for developers

    Webinar: Docker 2024

    Sign up for an exciting round-up of Docker innovation, live on January 15th
    [Read more](https://www.docker.com/resources/docker-2024-cloud-genai-development-innovations-webinar/)

    2024 State Of Application Development Report

    A deep-focus snapshot of the evolving software development world
    [Read more](https://www.docker.com/resources/2024-state-of-application-development-report/)
- [Pricing](https://www.docker.com/pricing/)
- [Support](https://www.docker.com/support/)
- [Blog](https://www.docker.com/blog/)
- [Companyxml version="1.0" encoding="utf-8"?](https://www.docker.com/company/)
  * Company

    + [About Us](https://www.docker.com/company/)Let us introduce ourselves
    + [What is a Container?](/resources/what-container/)Learn about containerization
    + [Why Docker](https://www.docker.com/why-docker/)Discover what makes us different
    + [Trust](https://www.docker.com/trust/)Find our customer trust resources
    + [Partners](/partners/)Become a Docker partner
    + [Customer Success](https://www.docker.com/customer-success/)Learn how you can succeed with Docker
    + [Events](https://www.docker.com/events/)Attend live and virtual meet ups
    + [Docker Storexml version="1.0" encoding="UTF-8"?](https://stores.kotisdesign.com/docker) Gear up with exclusive SWAG
    + [Careers](https://www.docker.com/careers/)Apply to join our team
    + [Contact Us](https://www.docker.com/company/contact/)We’d love to hear from you
  * Company

    Docker Announces SOC 2 Type 2 Attestation & ISO 27001 Certification

    Learn what this means for Docker security and compliance
    [Read more](https://www.docker.com/blog/docker-announces-soc-2-type-2-attestation-iso-27001-certification/)
- [Get started](/get-started/)
- [Docs](https://docs.docker.com/build/cloud/)
- [Get support](/support/)
- [Contact sales](/pricing/contact-sales/)
- [Sign In](https://app.docker.com/login)
  [Get started](/get-started/)

# Docker Security Advisory: AuthZ Plugin Bypass Regression in Docker Engine

![](https://www.docker.com/wp-content/uploads/2024/01/gabriela-georgieva-3.jpeg)

[Gabriela Georgieva](https://www.docker.com/author/gabriela-georgieva/ "Posts by Gabriela Georgieva")

Certain versions of [Docker Engine](https://docs.docker.com/engine/) have a security vulnerability that could allow an attacker to bypass authorization plugins (AuthZ) under specific circumstances. The base likelihood of this being exploited is low. This advisory outlines the issue, identifies the affected versions, and provides remediation steps for impacted users.

![Banner docker security advisory](https://www.docker.com/wp-content/uploads/2024/01/banner_docker-security-advisory-1110x583.png "- Banner Docker Security Advisory")
## Problem

Docker’s default authorization model is all-or-nothing. Users with access to the Docker daemon can execute any Docker command. For greater access control, authorization plugins (AuthZ) can be used. These plugins approve or deny requests to the Docker daemon based on authentication and command context.

In 2018, a security issue was discovered where an attacker could bypass AuthZ plugins using a specially crafted API request. This could lead to unauthorized actions, including privilege escalation. Although this issue was fixed in Docker Engine [v18.09.1](https://docs.docker.com/engine/release-notes/18.09/#security-fixes-1) in January 2019, the fix was not carried forward to later versions, resulting in a regression.

## Vulnerability details

* **AuthZ bypass and privilege escalation:** An attacker could exploit a bypass using an API request with Content-Length set to 0, causing the Docker daemon to forward the request without the body to the AuthZ plugin, which might approve the request incorrectly if not set to deny by default.
* **Initial fix:** The issue was fixed in Docker Engine [v18.09.1](https://docs.docker.com/engine/release-notes/18.09/#security-fixes-1) January 2019.
* **Regression:** The fix was not included in Docker Engine v19.03 or newer versions. This was identified in April 2024 and patches were released for the affected versions on July 23, 2024. The issue was assigned [CVE-2024-41110](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-41110).

## Affected versions

| Affected versions | Patched versions |
| --- | --- |
| <= v19.03.15, <= v20.10.27, <= v23.0.14, <= v24.0.9, <= v25.0.5, <= v26.0.2, <= v26.1.4, <= v27.0.3, <= v27.1.0 | > v23.0.14, >26.1.4, > v27.1.0 |

## Who is impacted?

* Users of Docker Engine v19.03.x **and** later versions who rely on authorization plugins to make access control decisions.

## Who is not impacted?

* Users of Docker Engine v19.03.x **and** later versions who **do not** rely on authorization plugins to make access control decisions and users of all versions of Mirantis Container Runtime are not vulnerable.
* Users of Docker commercial products and internal infrastructure who **do not** rely on AuthZ plugins are unaffected.

## Impact on Docker Desktop

* Docker Desktop up to v4.32.0 includes affected versions of Docker Engine.
* The impact for Docker Desktop is limited compared to production environments.
  + Exploitation requires access to the Docker API, which usually means the attacker needs to already have local access to the host machine, unless the Docker daemon is insecurely exposed over TCP.
  + Default Docker Desktop configuration does not include AuthZ plugins.
  + Privilege escalation is limited to the Docker Desktop VM, not the underlying host.
* A patched version of Docker Engine is included in [Docker Desktop 4.33](https://docs.docker.com/desktop/release-notes/).

## Remediation steps

1. Update [Docker Engine](https://docs.docker.com/engine/):

* If you are running an affected version, update to the most recent patched version.

2. Mitigation if unable to update immediately:

* Avoid using AuthZ plugins.
* Restrict access to the Docker API to trusted parties, following the principle of least privilege.

3. Update Docker Desktop:

* If using an affected version, update to [Docker Desktop 4.33](https://docs.docker.com/desktop/release-notes/) .
* Ensure AuthZ plugins are not used and do not expose the Docker API over TCP without protection.
* [Docker Business](https://www.docker.com/products/business/) subscribers can use *Settings Management* to enforce secure settings.

## Learn more

* See the [GitHub security advisory](https://github.com/moby/moby/security/advisories/GHSA-v23v-6jw2-98fq).
* [Authenticate and update](https://www.docker.com/pricing/) to receive your subscription level’s newest Docker Desktop features.
* New to Docker? [Create an account](https://app.docker.com/signup?_gl=1*452i3u*_ga*MjEzNzc3Njk5MC4xNjgzNjY3NDkw*_ga_XJWPQMJYHQ*MTcwODcxNjA4Ni4zNjguMS4xNzA4NzE2MzE2LjUzLjAuMA..).
* Subscribe to the [Docker Newsletter](https://www.docker.com/newsletter-subscription/).
xml version="1.0" encoding="UTF-8"?  [Docker Desktop](https://www.docker.com/blog/tag/docker-desktop/), [Docker engine](https://www.docker.com/blog/tag/docker-engine/), [security](https://www.docker.com/blog/tag/security/)
#### [Incident Update: Docker Desktop for Mac](https://www.docker.com/blog/incident-update-docker-desktop-for-mac/)

By [Chris Crone](https://www.docker.com/author/chriscrone/ "Posts by Chris Crone") January 8, 2025
#### [How to Dockerize a Django App: Step-by-Step Guide for Beginners](https://www.docker.com/blog/how-to-dockerize-django-app/)

By [Lance Haig](https://www.docker.com/author/lance-haig/ "Posts by Lance Haig") January 8, 2025
#### [Unlocking Efficiency with Docker for AI and Cloud-Native Development](https://www.docker.com/blog/unlocking-efficiency-with-docker-for-ai-and-cloud-native-development/)

By [Yiwen Xu](https://www.docker.com/author/yiwen-xu/ "Posts by Yiwen Xu") January 8, 2025

#### Posted

Jul 23, 2024

#### Post Tags

[Docker Desktop](https://www.docker.com/blog/tag/docker-desktop/)[Docker engine](https://www.docker.com/blog/tag/docker-engine/)[security](https://www.docker.com/blog/tag/security/)
#### Categories

* [Community](https://www.docker.com/blog/category/community-content/)
* [Company](https://www.docker.com/blog/category/company/)
* [Engineering](https://www.docker.com/blog/category/engineering/)
* [Products](https://www.docker.com/blog/category/products/)

xml version="1.0" encoding="UTF-8"?

* Products
  + [Docker Desktop](/products/docker-desktop/)
  + [Docker Hub](/products/docker-hub/)
  + [Docker Scout](https://www.docker.com/products/docker-scout/)
  + [Docker Build Cloud](/products/build-cloud/)
  + Features
  + [Command Line Interface](/products/cli/)
  + [IDE Extensions](/products/ide/)
  + [Container Runtime](/products/container-runtime/)
  + [Docker Extensions](https://www.docker.com/products/extensions/)
  + [Trusted Open Source Content](/products/trusted-content/open-source/)
  + [Secure Software Supply Chain](https://www.docker.com/solutions/security/)
  + [Product Roadmap](https://github.com/docker/roadmap)
* Developers
  + [Documentation](https://docs.docker.com/)
  + [Getting Started](/get-started/)
  + [Trainings](/resources/trainings/)
  + [Extensions SDK](/developers/sdk/)
  + [Community](/community/)
  + [Open Source](/community/open-source/)
  + [Preview Program](/community/get-involved/developer-preview/)
* [Pricing](/pricing/)
  + [Personal](/products/personal/)
  + [Pro](/products/pro/)
  + [Team](/products/team/)
  + [Business](/products/business/)
  + [Pricing FAQ](/pricing/faq/)
  + [Contact Sales](/pricing/contact-sales/)
* [Support](https://www.docker.com/support/)
  + [Docker System Status](http://dockerstatus.com/)
* [Blog](/blog/)
  + [Newsletter](/newsletter-subscription/)
* [Company](/company/)
  + [About Us](/company/)
  + [What is a Container](/resources/what-container/)
  + [Why Docker](/why-docker/)
  + [Trust](/trust/)
  + [Customer Success](/customer-success/)
  + [Partners](/partners/)
  + [Events](/events/)
  + [Newsroom](/company/newsroom/)
  + [Swag Store](https://stores.kotisdesign.com/docker)
  + [Brand Guidelines](/company/newsroom/media-resources/)
  + [Trademark Guidelines](/legal/trademark-guidelines/)
  + [Careers](/careers/)
  + [Contact Us](/company/contact/)
  + Languages
    - [English](https://www.docker.com/)
    - [日本語](https://www.docker.com/ja-jp/)

* [![twitter logo](data:image/svg+xml...)![twitter logo](/wp-content/themes/Ponyo-divi-child/dist/images/social/docker-social-twitter.svg)](http://twitter.com/docker)
* [![linkedin logo](data:image/svg+xml...)![linkedin logo](/wp-content/themes/Ponyo-divi-child/dist/images/social/docker-social-linkedin.svg)](https://www.linkedin.com/company/docker)
* [![instagram logo](data:image/svg+xml...)![instagram logo](/wp-content/themes/Ponyo-divi-child/dist/images/social/docker-social-instagram.svg)](https://www.instagram.com/dockerinc/)
* [![youtube logo](data:image/svg+xml...)![youtube logo](/wp-content/themes/Ponyo-divi-child/dist/images/social/docker-social-youtube.svg)](http://www.youtube.com/user/dockerrun)
* [![facebook logo](data:image/svg+xml...)![facebook logo](/wp-content/themes/Ponyo-divi-child/dist/images/social/docker-social-facebook.svg)](https://www.facebook.com/docker.run)
* [![rss feed logo](data:image/svg+xml...)![rss feed logo](/wp-content/themes/Ponyo-divi-child/dist/images/social/docker-social-blog.svg)](/blog/feed)

© 2025 Docker Inc. All rights reserved|[Terms of Service](/legal/docker-terms-service)|[Privacy](/legal/privacy)|[Legal](/legal)

Cookie Settings



=== Content from github.com_9edcd847_20250111_043235.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Ffc274cd2ff4cf3b48c91697fb327dd1fb95588fb)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Ffc274cd2ff4cf3b48c91697fb327dd1fb95588fb)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=moby%2Fmoby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moby](/moby)
/
**[moby](/moby/moby)**
Public

* [Notifications](/login?return_to=%2Fmoby%2Fmoby) You must be signed in to change notification settings
* [Fork
  18.7k](/login?return_to=%2Fmoby%2Fmoby)
* [Star
   69k](/login?return_to=%2Fmoby%2Fmoby)

* [Code](/moby/moby)
* [Issues
  3.1k](/moby/moby/issues)
* [Pull requests
  419](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects
  4](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

Additional navigation options

* [Code](/moby/moby)
* [Issues](/moby/moby/issues)
* [Pull requests](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

## Commit

[Permalink](/moby/moby/commit/fc274cd2ff4cf3b48c91697fb327dd1fb95588fb)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Authz plugin security fixes for 0-length content and path validation …

[Browse files](/moby/moby/tree/fc274cd2ff4cf3b48c91697fb327dd1fb95588fb)
Browse the repository at this point in the history

```
…Signed-off-by: Jameson Hyde <jameson.hyde@docker.com>

fix comments

(cherry picked from commit [9659c3a](https://github.com/moby/moby/commit/9659c3a52bac57e615b5fb49b0652baca448643e))
Signed-off-by: Sebastiaan van Stijn <github@gone.nl>
Signed-off-by: Eli Uriegas <eli.uriegas@docker.com>
```

* Loading branch information

[![@jamesonhyde-docker](https://avatars.githubusercontent.com/u/40806266?s=40&v=4)](/jamesonhyde-docker) [![@seemethere](https://avatars.githubusercontent.com/u/1700823?s=40&v=4)](/seemethere)

[jamesonhyde-docker](/moby/moby/commits?author=jamesonhyde-docker "View all commits by jamesonhyde-docker")
authored and
[seemethere](/moby/moby/commits?author=seemethere "View all commits by seemethere")
committed
Jan 9, 2019

1 parent
[d4f336d](/moby/moby/commit/d4f336d8ef43ca86c914952eeb44cc4489755d20)

commit fc274cd

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**80 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* pkg/authorization

  + pkg/authorization/authz.go
    [authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320)
  + pkg/authorization/authz\_unix\_test.go
    [authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321)

## There are no files selected for viewing

38 changes: 34 additions & 4 deletions

38
[pkg/authorization/authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320 "pkg/authorization/authz.go")

Show comments

[View file](/moby/moby/blob/fc274cd2ff4cf3b48c91697fb327dd1fb95588fb/pkg/authorization/authz.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,6 +7,8 @@ import ( |
|  |  | "io" |
|  |  | "mime" |
|  |  | "net/http" |
|  |  | "net/url" |
|  |  | "regexp" |
|  |  | "strings" |
|  |  |  |
|  |  | "github.com/docker/docker/pkg/ioutils" |
| Expand Down  Expand Up | | @@ -52,10 +54,23 @@ type Ctx struct { |
|  |  | authReq \*Request |
|  |  | } |
|  |  |  |
|  |  | func isChunked(r \*http.Request) bool { |
|  |  | //RFC 7230 specifies that content length is to be ignored if Transfer-Encoding is chunked |
|  |  | if strings.ToLower(r.Header.Get("Transfer-Encoding")) == "chunked" { |
|  |  | return true |
|  |  | } |
|  |  | for \_, v := range r.TransferEncoding { |
|  |  | if 0 == strings.Compare(strings.ToLower(v), "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // AuthZRequest authorized the request to the docker daemon using authZ plugins |
|  |  | func (ctx \*Ctx) AuthZRequest(w http.ResponseWriter, r \*http.Request) error { |
|  |  | var body []byte |
|  |  | if sendBody(ctx.requestURI, r.Header) && r.ContentLength > 0 && r.ContentLength < maxBodySize { |
|  |  | if sendBody(ctx.requestURI, r.Header) && (r.ContentLength > 0 || isChunked(r)) && r.ContentLength < maxBodySize { |
|  |  | var err error |
|  |  | body, r.Body, err = drainBody(r.Body) |
|  |  | if err != nil { |
| Expand Down  Expand Up | | @@ -108,7 +123,6 @@ func (ctx \*Ctx) AuthZResponse(rm ResponseModifier, r \*http.Request) error { |
|  |  | if sendBody(ctx.requestURI, rm.Header()) { |
|  |  | ctx.authReq.ResponseBody = rm.RawBody() |
|  |  | } |
|  |  |  |
|  |  | for \_, plugin := range ctx.plugins { |
|  |  | logrus.Debugf("AuthZ response using plugin %s", plugin.Name()) |
|  |  |  |
| Expand Down  Expand Up | | @@ -146,10 +160,26 @@ func drainBody(body io.ReadCloser) ([]byte, io.ReadCloser, error) { |
|  |  | return nil, newBody, err |
|  |  | } |
|  |  |  |
|  |  | func isAuthEndpoint(urlPath string) (bool, error) { |
|  |  | // eg www.test.com/v1.24/auth/optional?optional1=something&optional2=something (version optional) |
|  |  | matched, err := regexp.MatchString(`^[^\/]+\/(v\d[\d\.]\*\/)?auth.\*`, urlPath) |
|  |  | if err != nil { |
|  |  | return false, err |
|  |  | } |
|  |  | return matched, nil |
|  |  | } |
|  |  |  |
|  |  | // sendBody returns true when request/response body should be sent to AuthZPlugin |
|  |  | func sendBody(url string, header http.Header) bool { |
|  |  | func sendBody(inURL string, header http.Header) bool { |
|  |  | u, err := url.Parse(inURL) |
|  |  | // Assume no if the URL cannot be parsed - an empty request will still be forwarded to the plugin and should be rejected |
|  |  | if err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // Skip body for auth endpoint |
|  |  | if strings.HasSuffix(url, "/auth") { |
|  |  | isAuth, err := isAuthEndpoint(u.Path) |
|  |  | if isAuth || err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
| Expand Down | |  |

49 changes: 46 additions & 3 deletions

49
[pkg/authorization/authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321 "pkg/authorization/authz_unix_test.go")

Show comments

[View file](/moby/moby/blob/fc274cd2ff4cf3b48c91697fb327dd1fb95588fb/pkg/authorization/authz_unix_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -174,8 +174,8 @@ func TestDrainBody(t \*testing.T) { |
|  |  |  |
|  |  | func TestSendBody(t \*testing.T) { |
|  |  | var ( |
|  |  | url = "nothing.com" |
|  |  | testcases = []struct { |
|  |  | url string |
|  |  | contentType string |
|  |  | expected bool |
|  |  | }{ |
| Expand Down  Expand Up | | @@ -219,15 +219,58 @@ func TestSendBody(t \*testing.T) { |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth?p1=test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | } |
|  |  | ) |
|  |  |  |
|  |  | for \_, testcase := range testcases { |
|  |  | header := http.Header{} |
|  |  | header.Set("Content-Type", testcase.contentType) |
|  |  | if testcase.url == "" { |
|  |  | testcase.url = "nothing.com" |
|  |  | } |
|  |  |  |
|  |  | if b := sendBody(url, header); b != testcase.expected { |
|  |  | t.Fatalf("Unexpected Content-Type; Expected: %t, Actual: %t", testcase.expected, b) |
|  |  | if b := sendBody(testcase.url, header); b != testcase.expected { |
|  |  | t.Fatalf("sendBody failed: url: %s, content-type: %s; Expected: %t, Actual: %t", testcase.url, testcase.contentType, testcase.expected, b) |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `fc274cd`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Ffc274cd2ff4cf3b48c91697fb327dd1fb95588fb) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_83b4590c_20250111_043229.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F42f40b1d6dd7562342f832b9cd2adf9e668eeb76)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F42f40b1d6dd7562342f832b9cd2adf9e668eeb76)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=moby%2Fmoby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moby](/moby)
/
**[moby](/moby/moby)**
Public

* [Notifications](/login?return_to=%2Fmoby%2Fmoby) You must be signed in to change notification settings
* [Fork
  18.7k](/login?return_to=%2Fmoby%2Fmoby)
* [Star
   69k](/login?return_to=%2Fmoby%2Fmoby)

* [Code](/moby/moby)
* [Issues
  3.1k](/moby/moby/issues)
* [Pull requests
  419](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects
  4](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

Additional navigation options

* [Code](/moby/moby)
* [Issues](/moby/moby/issues)
* [Pull requests](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

## Commit

[Permalink](/moby/moby/commit/42f40b1d6dd7562342f832b9cd2adf9e668eeb76)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/moby/moby/tree/42f40b1d6dd7562342f832b9cd2adf9e668eeb76)
Browse the repository at this point in the history

```
[20.10] AuthZ plugin security fixes
```

* Loading branch information

[![@thaJeztah](https://avatars.githubusercontent.com/u/1804568?s=40&v=4)](/thaJeztah)

[thaJeztah](/moby/moby/commits?author=thaJeztah "View all commits by thaJeztah")
authored
Jul 23, 2024

2 parents
[b201b1b](/moby/moby/commit/b201b1b3d078ebe5f49fbb8863b11d8165e8a6aa)
+
[7ff423c](/moby/moby/commit/7ff423cc1c991d8dc0a7b5d1d93e1cf3efaac169)

commit 42f40b1

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**115 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* pkg/authorization

  + pkg/authorization/authz.go
    [authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320)
  + pkg/authorization/authz\_unix\_test.go
    [authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321)

## There are no files selected for viewing

38 changes: 34 additions & 4 deletions

38
[pkg/authorization/authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320 "pkg/authorization/authz.go")

Show comments

[View file](/moby/moby/blob/42f40b1d6dd7562342f832b9cd2adf9e668eeb76/pkg/authorization/authz.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,6 +7,8 @@ import ( |
|  |  | "io" |
|  |  | "mime" |
|  |  | "net/http" |
|  |  | "net/url" |
|  |  | "regexp" |
|  |  | "strings" |
|  |  |  |
|  |  | "github.com/docker/docker/pkg/ioutils" |
| Expand Down  Expand Up | | @@ -52,10 +54,23 @@ type Ctx struct { |
|  |  | authReq \*Request |
|  |  | } |
|  |  |  |
|  |  | func isChunked(r \*http.Request) bool { |
|  |  | // RFC 7230 specifies that content length is to be ignored if Transfer-Encoding is chunked |
|  |  | if strings.EqualFold(r.Header.Get("Transfer-Encoding"), "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | for \_, v := range r.TransferEncoding { |
|  |  | if strings.EqualFold(v, "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // AuthZRequest authorized the request to the docker daemon using authZ plugins |
|  |  | func (ctx \*Ctx) AuthZRequest(w http.ResponseWriter, r \*http.Request) error { |
|  |  | var body []byte |
|  |  | if sendBody(ctx.requestURI, r.Header) && r.ContentLength > 0 && r.ContentLength < maxBodySize { |
|  |  | if sendBody(ctx.requestURI, r.Header) && (r.ContentLength > 0 || isChunked(r)) && r.ContentLength < maxBodySize { |
|  |  | var err error |
|  |  | body, r.Body, err = drainBody(r.Body) |
|  |  | if err != nil { |
| Expand Down  Expand Up | | @@ -108,7 +123,6 @@ func (ctx \*Ctx) AuthZResponse(rm ResponseModifier, r \*http.Request) error { |
|  |  | if sendBody(ctx.requestURI, rm.Header()) { |
|  |  | ctx.authReq.ResponseBody = rm.RawBody() |
|  |  | } |
|  |  |  |
|  |  | for \_, plugin := range ctx.plugins { |
|  |  | logrus.Debugf("AuthZ response using plugin %s", plugin.Name()) |
|  |  |  |
| Expand Down  Expand Up | | @@ -146,10 +160,26 @@ func drainBody(body io.ReadCloser) ([]byte, io.ReadCloser, error) { |
|  |  | return nil, newBody, err |
|  |  | } |
|  |  |  |
|  |  | func isAuthEndpoint(urlPath string) (bool, error) { |
|  |  | // eg www.test.com/v1.24/auth/optional?optional1=something&optional2=something (version optional) |
|  |  | matched, err := regexp.MatchString(`^[^\/]\*\/(v\d[\d\.]\*\/)?auth.\*`, urlPath) |
|  |  | if err != nil { |
|  |  | return false, err |
|  |  | } |
|  |  | return matched, nil |
|  |  | } |
|  |  |  |
|  |  | // sendBody returns true when request/response body should be sent to AuthZPlugin |
|  |  | func sendBody(url string, header http.Header) bool { |
|  |  | func sendBody(inURL string, header http.Header) bool { |
|  |  | u, err := url.Parse(inURL) |
|  |  | // Assume no if the URL cannot be parsed - an empty request will still be forwarded to the plugin and should be rejected |
|  |  | if err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // Skip body for auth endpoint |
|  |  | if strings.HasSuffix(url, "/auth") { |
|  |  | isAuth, err := isAuthEndpoint(u.Path) |
|  |  | if isAuth || err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
| Expand Down | |  |

84 changes: 81 additions & 3 deletions

84
[pkg/authorization/authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321 "pkg/authorization/authz_unix_test.go")

Show comments

[View file](/moby/moby/blob/42f40b1d6dd7562342f832b9cd2adf9e668eeb76/pkg/authorization/authz_unix_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -175,8 +175,8 @@ func TestDrainBody(t \*testing.T) { |
|  |  |  |
|  |  | func TestSendBody(t \*testing.T) { |
|  |  | var ( |
|  |  | url = "nothing.com" |
|  |  | testcases = []struct { |
|  |  | url string |
|  |  | contentType string |
|  |  | expected bool |
|  |  | }{ |
| Expand Down  Expand Up | | @@ -220,15 +220,93 @@ func TestSendBody(t \*testing.T) { |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth?p1=test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | } |
|  |  | ) |
|  |  |  |
|  |  | for \_, testcase := range testcases { |
|  |  | header := http.Header{} |
|  |  | header.Set("Content-Type", testcase.contentType) |
|  |  | if testcase.url == "" { |
|  |  | testcase.url = "nothing.com" |
|  |  | } |
|  |  |  |
|  |  | if b := sendBody(url, header); b != testcase.expected { |
|  |  | t.Fatalf("Unexpected Content-Type; Expected: %t, Actual: %t", testcase.expected, b) |
|  |  | if b := sendBody(testcase.url, header); b != testcase.expected { |
|  |  | t.Fatalf("sendBody failed: url: %s, content-type: %s; Expected: %t, Actual: %t", testcase.url, testcase.contentType, testcase.expected, b) |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `42f40b1`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F42f40b1d6dd7562342f832b9cd2adf9e668eeb76) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8a170e6a_20250111_043231.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F852759a7df454cbf88db4e954c919becd48faa9b)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F852759a7df454cbf88db4e954c919becd48faa9b)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=moby%2Fmoby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moby](/moby)
/
**[moby](/moby/moby)**
Public

* [Notifications](/login?return_to=%2Fmoby%2Fmoby) You must be signed in to change notification settings
* [Fork
  18.7k](/login?return_to=%2Fmoby%2Fmoby)
* [Star
   69k](/login?return_to=%2Fmoby%2Fmoby)

* [Code](/moby/moby)
* [Issues
  3.1k](/moby/moby/issues)
* [Pull requests
  419](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects
  4](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

Additional navigation options

* [Code](/moby/moby)
* [Issues](/moby/moby/issues)
* [Pull requests](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

## Commit

[Permalink](/moby/moby/commit/852759a7df454cbf88db4e954c919becd48faa9b)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/moby/moby/tree/852759a7df454cbf88db4e954c919becd48faa9b)
Browse the repository at this point in the history

```
[24.0] AuthZ plugin security fixes
```

* Loading branch information

[![@thaJeztah](https://avatars.githubusercontent.com/u/1804568?s=40&v=4)](/thaJeztah)

[thaJeztah](/moby/moby/commits?author=thaJeztah "View all commits by thaJeztah")
authored
Jul 23, 2024

2 parents
[e0ce0ff](/moby/moby/commit/e0ce0ff8d5eaee6296e5c206e6a6fc6c623ec056)
+
[55fa16e](/moby/moby/commit/55fa16e22f5dcea24d79ae667cafbb1b006ff688)

commit 852759a

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**115 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* pkg/authorization

  + pkg/authorization/authz.go
    [authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320)
  + pkg/authorization/authz\_unix\_test.go
    [authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321)

## There are no files selected for viewing

38 changes: 34 additions & 4 deletions

38
[pkg/authorization/authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320 "pkg/authorization/authz.go")

Show comments

[View file](/moby/moby/blob/852759a7df454cbf88db4e954c919becd48faa9b/pkg/authorization/authz.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,6 +7,8 @@ import ( |
|  |  | "io" |
|  |  | "mime" |
|  |  | "net/http" |
|  |  | "net/url" |
|  |  | "regexp" |
|  |  | "strings" |
|  |  |  |
|  |  | "github.com/docker/docker/pkg/ioutils" |
| Expand Down  Expand Up | | @@ -52,10 +54,23 @@ type Ctx struct { |
|  |  | authReq \*Request |
|  |  | } |
|  |  |  |
|  |  | func isChunked(r \*http.Request) bool { |
|  |  | // RFC 7230 specifies that content length is to be ignored if Transfer-Encoding is chunked |
|  |  | if strings.EqualFold(r.Header.Get("Transfer-Encoding"), "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | for \_, v := range r.TransferEncoding { |
|  |  | if strings.EqualFold(v, "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // AuthZRequest authorized the request to the docker daemon using authZ plugins |
|  |  | func (ctx \*Ctx) AuthZRequest(w http.ResponseWriter, r \*http.Request) error { |
|  |  | var body []byte |
|  |  | if sendBody(ctx.requestURI, r.Header) && r.ContentLength > 0 && r.ContentLength < maxBodySize { |
|  |  | if sendBody(ctx.requestURI, r.Header) && (r.ContentLength > 0 || isChunked(r)) && r.ContentLength < maxBodySize { |
|  |  | var err error |
|  |  | body, r.Body, err = drainBody(r.Body) |
|  |  | if err != nil { |
| Expand Down  Expand Up | | @@ -108,7 +123,6 @@ func (ctx \*Ctx) AuthZResponse(rm ResponseModifier, r \*http.Request) error { |
|  |  | if sendBody(ctx.requestURI, rm.Header()) { |
|  |  | ctx.authReq.ResponseBody = rm.RawBody() |
|  |  | } |
|  |  |  |
|  |  | for \_, plugin := range ctx.plugins { |
|  |  | logrus.Debugf("AuthZ response using plugin %s", plugin.Name()) |
|  |  |  |
| Expand Down  Expand Up | | @@ -146,10 +160,26 @@ func drainBody(body io.ReadCloser) ([]byte, io.ReadCloser, error) { |
|  |  | return nil, newBody, err |
|  |  | } |
|  |  |  |
|  |  | func isAuthEndpoint(urlPath string) (bool, error) { |
|  |  | // eg www.test.com/v1.24/auth/optional?optional1=something&optional2=something (version optional) |
|  |  | matched, err := regexp.MatchString(`^[^\/]\*\/(v\d[\d\.]\*\/)?auth.\*`, urlPath) |
|  |  | if err != nil { |
|  |  | return false, err |
|  |  | } |
|  |  | return matched, nil |
|  |  | } |
|  |  |  |
|  |  | // sendBody returns true when request/response body should be sent to AuthZPlugin |
|  |  | func sendBody(url string, header http.Header) bool { |
|  |  | func sendBody(inURL string, header http.Header) bool { |
|  |  | u, err := url.Parse(inURL) |
|  |  | // Assume no if the URL cannot be parsed - an empty request will still be forwarded to the plugin and should be rejected |
|  |  | if err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // Skip body for auth endpoint |
|  |  | if strings.HasSuffix(url, "/auth") { |
|  |  | isAuth, err := isAuthEndpoint(u.Path) |
|  |  | if isAuth || err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
| Expand Down | |  |

84 changes: 81 additions & 3 deletions

84
[pkg/authorization/authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321 "pkg/authorization/authz_unix_test.go")

Show comments

[View file](/moby/moby/blob/852759a7df454cbf88db4e954c919becd48faa9b/pkg/authorization/authz_unix_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -175,8 +175,8 @@ func TestDrainBody(t \*testing.T) { |
|  |  |  |
|  |  | func TestSendBody(t \*testing.T) { |
|  |  | var ( |
|  |  | url = "nothing.com" |
|  |  | testcases = []struct { |
|  |  | url string |
|  |  | contentType string |
|  |  | expected bool |
|  |  | }{ |
| Expand Down  Expand Up | | @@ -220,15 +220,93 @@ func TestSendBody(t \*testing.T) { |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth?p1=test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | } |
|  |  | ) |
|  |  |  |
|  |  | for \_, testcase := range testcases { |
|  |  | header := http.Header{} |
|  |  | header.Set("Content-Type", testcase.contentType) |
|  |  | if testcase.url == "" { |
|  |  | testcase.url = "nothing.com" |
|  |  | } |
|  |  |  |
|  |  | if b := sendBody(url, header); b != testcase.expected { |
|  |  | t.Fatalf("Unexpected Content-Type; Expected: %t, Actual: %t", testcase.expected, b) |
|  |  | if b := sendBody(testcase.url, header); b != testcase.expected { |
|  |  | t.Fatalf("sendBody failed: url: %s, content-type: %s; Expected: %t, Actual: %t", testcase.url, testcase.contentType, testcase.expected, b) |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `852759a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F852759a7df454cbf88db4e954c919becd48faa9b) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_5b1ba34c_20250111_043233.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fae160b4edddb72ef4bd71f66b975a1a1cc434f00)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fae160b4edddb72ef4bd71f66b975a1a1cc434f00)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=moby%2Fmoby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moby](/moby)
/
**[moby](/moby/moby)**
Public

* [Notifications](/login?return_to=%2Fmoby%2Fmoby) You must be signed in to change notification settings
* [Fork
  18.7k](/login?return_to=%2Fmoby%2Fmoby)
* [Star
   69k](/login?return_to=%2Fmoby%2Fmoby)

* [Code](/moby/moby)
* [Issues
  3.1k](/moby/moby/issues)
* [Pull requests
  419](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects
  4](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

Additional navigation options

* [Code](/moby/moby)
* [Issues](/moby/moby/issues)
* [Pull requests](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

## Commit

[Permalink](/moby/moby/commit/ae160b4edddb72ef4bd71f66b975a1a1cc434f00)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/moby/moby/tree/ae160b4edddb72ef4bd71f66b975a1a1cc434f00)
Browse the repository at this point in the history

```
[19.03] AuthZ plugin security fixes
```

* Loading branch information

[![@thaJeztah](https://avatars.githubusercontent.com/u/1804568?s=40&v=4)](/thaJeztah)

[thaJeztah](/moby/moby/commits?author=thaJeztah "View all commits by thaJeztah")
authored
Jul 23, 2024

2 parents
[69f9c8c](/moby/moby/commit/69f9c8c90662290f3e3abc01a3be51b95b80367b)
+
[eaa1968](/moby/moby/commit/eaa196855e1cec8f5e03919374e983ac412be668)

commit ae160b4

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**115 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* pkg/authorization

  + pkg/authorization/authz.go
    [authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320)
  + pkg/authorization/authz\_unix\_test.go
    [authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321)

## There are no files selected for viewing

38 changes: 34 additions & 4 deletions

38
[pkg/authorization/authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320 "pkg/authorization/authz.go")

Show comments

[View file](/moby/moby/blob/ae160b4edddb72ef4bd71f66b975a1a1cc434f00/pkg/authorization/authz.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,6 +7,8 @@ import ( |
|  |  | "io" |
|  |  | "mime" |
|  |  | "net/http" |
|  |  | "net/url" |
|  |  | "regexp" |
|  |  | "strings" |
|  |  |  |
|  |  | "github.com/docker/docker/pkg/ioutils" |
| Expand Down  Expand Up | | @@ -52,10 +54,23 @@ type Ctx struct { |
|  |  | authReq \*Request |
|  |  | } |
|  |  |  |
|  |  | func isChunked(r \*http.Request) bool { |
|  |  | // RFC 7230 specifies that content length is to be ignored if Transfer-Encoding is chunked |
|  |  | if strings.EqualFold(r.Header.Get("Transfer-Encoding"), "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | for \_, v := range r.TransferEncoding { |
|  |  | if strings.EqualFold(v, "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // AuthZRequest authorized the request to the docker daemon using authZ plugins |
|  |  | func (ctx \*Ctx) AuthZRequest(w http.ResponseWriter, r \*http.Request) error { |
|  |  | var body []byte |
|  |  | if sendBody(ctx.requestURI, r.Header) && r.ContentLength > 0 && r.ContentLength < maxBodySize { |
|  |  | if sendBody(ctx.requestURI, r.Header) && (r.ContentLength > 0 || isChunked(r)) && r.ContentLength < maxBodySize { |
|  |  | var err error |
|  |  | body, r.Body, err = drainBody(r.Body) |
|  |  | if err != nil { |
| Expand Down  Expand Up | | @@ -108,7 +123,6 @@ func (ctx \*Ctx) AuthZResponse(rm ResponseModifier, r \*http.Request) error { |
|  |  | if sendBody(ctx.requestURI, rm.Header()) { |
|  |  | ctx.authReq.ResponseBody = rm.RawBody() |
|  |  | } |
|  |  |  |
|  |  | for \_, plugin := range ctx.plugins { |
|  |  | logrus.Debugf("AuthZ response using plugin %s", plugin.Name()) |
|  |  |  |
| Expand Down  Expand Up | | @@ -146,10 +160,26 @@ func drainBody(body io.ReadCloser) ([]byte, io.ReadCloser, error) { |
|  |  | return nil, newBody, err |
|  |  | } |
|  |  |  |
|  |  | func isAuthEndpoint(urlPath string) (bool, error) { |
|  |  | // eg www.test.com/v1.24/auth/optional?optional1=something&optional2=something (version optional) |
|  |  | matched, err := regexp.MatchString(`^[^\/]\*\/(v\d[\d\.]\*\/)?auth.\*`, urlPath) |
|  |  | if err != nil { |
|  |  | return false, err |
|  |  | } |
|  |  | return matched, nil |
|  |  | } |
|  |  |  |
|  |  | // sendBody returns true when request/response body should be sent to AuthZPlugin |
|  |  | func sendBody(url string, header http.Header) bool { |
|  |  | func sendBody(inURL string, header http.Header) bool { |
|  |  | u, err := url.Parse(inURL) |
|  |  | // Assume no if the URL cannot be parsed - an empty request will still be forwarded to the plugin and should be rejected |
|  |  | if err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // Skip body for auth endpoint |
|  |  | if strings.HasSuffix(url, "/auth") { |
|  |  | isAuth, err := isAuthEndpoint(u.Path) |
|  |  | if isAuth || err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
| Expand Down | |  |

84 changes: 81 additions & 3 deletions

84
[pkg/authorization/authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321 "pkg/authorization/authz_unix_test.go")

Show comments

[View file](/moby/moby/blob/ae160b4edddb72ef4bd71f66b975a1a1cc434f00/pkg/authorization/authz_unix_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -174,8 +174,8 @@ func TestDrainBody(t \*testing.T) { |
|  |  |  |
|  |  | func TestSendBody(t \*testing.T) { |
|  |  | var ( |
|  |  | url = "nothing.com" |
|  |  | testcases = []struct { |
|  |  | url string |
|  |  | contentType string |
|  |  | expected bool |
|  |  | }{ |
| Expand Down  Expand Up | | @@ -219,15 +219,93 @@ func TestSendBody(t \*testing.T) { |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth?p1=test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | } |
|  |  | ) |
|  |  |  |
|  |  | for \_, testcase := range testcases { |
|  |  | header := http.Header{} |
|  |  | header.Set("Content-Type", testcase.contentType) |
|  |  | if testcase.url == "" { |
|  |  | testcase.url = "nothing.com" |
|  |  | } |
|  |  |  |
|  |  | if b := sendBody(url, header); b != testcase.expected { |
|  |  | t.Fatalf("Unexpected Content-Type; Expected: %t, Actual: %t", testcase.expected, b) |
|  |  | if b := sendBody(testcase.url, header); b != testcase.expected { |
|  |  | t.Fatalf("sendBody failed: url: %s, content-type: %s; Expected: %t, Actual: %t", testcase.url, testcase.contentType, testcase.expected, b) |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ae160b4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fae160b4edddb72ef4bd71f66b975a1a1cc434f00) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a22bada7_20250111_043228.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F411e817ddf710ff8e08fa193da80cb78af708191)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F411e817ddf710ff8e08fa193da80cb78af708191)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=moby%2Fmoby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moby](/moby)
/
**[moby](/moby/moby)**
Public

* [Notifications](/login?return_to=%2Fmoby%2Fmoby) You must be signed in to change notification settings
* [Fork
  18.7k](/login?return_to=%2Fmoby%2Fmoby)
* [Star
   69k](/login?return_to=%2Fmoby%2Fmoby)

* [Code](/moby/moby)
* [Issues
  3.1k](/moby/moby/issues)
* [Pull requests
  419](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects
  4](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

Additional navigation options

* [Code](/moby/moby)
* [Issues](/moby/moby/issues)
* [Pull requests](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

## Commit

[Permalink](/moby/moby/commit/411e817ddf710ff8e08fa193da80cb78af708191)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/moby/moby/tree/411e817ddf710ff8e08fa193da80cb78af708191)
Browse the repository at this point in the history

```
[26.1] AuthZ plugin security fixes
```

* Loading branch information

[![@thaJeztah](https://avatars.githubusercontent.com/u/1804568?s=40&v=4)](/thaJeztah)

[thaJeztah](/moby/moby/commits?author=thaJeztah "View all commits by thaJeztah")
authored
Jul 23, 2024

2 parents
[6bc4906](/moby/moby/commit/6bc49067a6c7647db245d77e0660778c8f61f314)
+
[9cc85ea](/moby/moby/commit/9cc85eaef15739234909e9c1d4b9915b37bac4ab)

commit 411e817

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**115 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* pkg/authorization

  + pkg/authorization/authz.go
    [authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320)
  + pkg/authorization/authz\_unix\_test.go
    [authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321)

## There are no files selected for viewing

38 changes: 34 additions & 4 deletions

38
[pkg/authorization/authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320 "pkg/authorization/authz.go")

Show comments

[View file](/moby/moby/blob/411e817ddf710ff8e08fa193da80cb78af708191/pkg/authorization/authz.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,6 +8,8 @@ import ( |
|  |  | "io" |
|  |  | "mime" |
|  |  | "net/http" |
|  |  | "net/url" |
|  |  | "regexp" |
|  |  | "strings" |
|  |  |  |
|  |  | "github.com/containerd/log" |
| Expand Down  Expand Up | | @@ -53,10 +55,23 @@ type Ctx struct { |
|  |  | authReq \*Request |
|  |  | } |
|  |  |  |
|  |  | func isChunked(r \*http.Request) bool { |
|  |  | // RFC 7230 specifies that content length is to be ignored if Transfer-Encoding is chunked |
|  |  | if strings.EqualFold(r.Header.Get("Transfer-Encoding"), "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | for \_, v := range r.TransferEncoding { |
|  |  | if strings.EqualFold(v, "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // AuthZRequest authorized the request to the docker daemon using authZ plugins |
|  |  | func (ctx \*Ctx) AuthZRequest(w http.ResponseWriter, r \*http.Request) error { |
|  |  | var body []byte |
|  |  | if sendBody(ctx.requestURI, r.Header) && r.ContentLength > 0 && r.ContentLength < maxBodySize { |
|  |  | if sendBody(ctx.requestURI, r.Header) && (r.ContentLength > 0 || isChunked(r)) && r.ContentLength < maxBodySize { |
|  |  | var err error |
|  |  | body, r.Body, err = drainBody(r.Body) |
|  |  | if err != nil { |
| Expand Down  Expand Up | | @@ -109,7 +124,6 @@ func (ctx \*Ctx) AuthZResponse(rm ResponseModifier, r \*http.Request) error { |
|  |  | if sendBody(ctx.requestURI, rm.Header()) { |
|  |  | ctx.authReq.ResponseBody = rm.RawBody() |
|  |  | } |
|  |  |  |
|  |  | for \_, plugin := range ctx.plugins { |
|  |  | log.G(context.TODO()).Debugf("AuthZ response using plugin %s", plugin.Name()) |
|  |  |  |
| Expand Down  Expand Up | | @@ -147,10 +161,26 @@ func drainBody(body io.ReadCloser) ([]byte, io.ReadCloser, error) { |
|  |  | return nil, newBody, err |
|  |  | } |
|  |  |  |
|  |  | func isAuthEndpoint(urlPath string) (bool, error) { |
|  |  | // eg www.test.com/v1.24/auth/optional?optional1=something&optional2=something (version optional) |
|  |  | matched, err := regexp.MatchString(`^[^\/]\*\/(v\d[\d\.]\*\/)?auth.\*`, urlPath) |
|  |  | if err != nil { |
|  |  | return false, err |
|  |  | } |
|  |  | return matched, nil |
|  |  | } |
|  |  |  |
|  |  | // sendBody returns true when request/response body should be sent to AuthZPlugin |
|  |  | func sendBody(url string, header http.Header) bool { |
|  |  | func sendBody(inURL string, header http.Header) bool { |
|  |  | u, err := url.Parse(inURL) |
|  |  | // Assume no if the URL cannot be parsed - an empty request will still be forwarded to the plugin and should be rejected |
|  |  | if err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // Skip body for auth endpoint |
|  |  | if strings.HasSuffix(url, "/auth") { |
|  |  | isAuth, err := isAuthEndpoint(u.Path) |
|  |  | if isAuth || err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
| Expand Down | |  |

84 changes: 81 additions & 3 deletions

84
[pkg/authorization/authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321 "pkg/authorization/authz_unix_test.go")

Show comments

[View file](/moby/moby/blob/411e817ddf710ff8e08fa193da80cb78af708191/pkg/authorization/authz_unix_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -174,8 +174,8 @@ func TestDrainBody(t \*testing.T) { |
|  |  |  |
|  |  | func TestSendBody(t \*testing.T) { |
|  |  | var ( |
|  |  | url = "nothing.com" |
|  |  | testcases = []struct { |
|  |  | url string |
|  |  | contentType string |
|  |  | expected bool |
|  |  | }{ |
| Expand Down  Expand Up | | @@ -219,15 +219,93 @@ func TestSendBody(t \*testing.T) { |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth?p1=test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | } |
|  |  | ) |
|  |  |  |
|  |  | for \_, testcase := range testcases { |
|  |  | header := http.Header{} |
|  |  | header.Set("Content-Type", testcase.contentType) |
|  |  | if testcase.url == "" { |
|  |  | testcase.url = "nothing.com" |
|  |  | } |
|  |  |  |
|  |  | if b := sendBody(url, header); b != testcase.expected { |
|  |  | t.Fatalf("Unexpected Content-Type; Expected: %t, Actual: %t", testcase.expected, b) |
|  |  | if b := sendBody(testcase.url, header); b != testcase.expected { |
|  |  | t.Fatalf("sendBody failed: url: %s, content-type: %s; Expected: %t, Actual: %t", testcase.url, testcase.contentType, testcase.expected, b) |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `411e817`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F411e817ddf710ff8e08fa193da80cb78af708191) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.debian.org_8ea60dd2_20250111_043236.html ===


---

[[Date Prev](msg00008.html)][[Date Next](msg00010.html)]
[[Thread Prev](msg00008.html)][[Thread Next](msg00010.html)]
[[Date Index](maillist.html#00009)]
[[Thread Index](threads.html#00009)]

# [SECURITY] [DLA 3918-1] docker.io security update

---

* *To*: <debian-lts-announce@lists.debian.org>
* *Subject*: [SECURITY] [DLA 3918-1] docker.io security update
* *From*: rouca@debian.org
* *Date*: Sun, 13 Oct 2024 18:59:14 +0000
* *Message-id*: <[[🔎]](/msgid-search/957b82e1243f2faf14787a47b51ef627.rouca%40debian.org) [957b82e1243f2faf14787a47b51ef627.rouca@debian.org](msg00009.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3918-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                   Bastien RoucariÃ¨s
October 13, 2024                              <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : docker.io
Version        : 20.10.5+dfsg1-1+deb11u3
CVE ID         : CVE-2024-41110
Debian Bug     : 1084993

A vulnerability has been detected in
the Docker Engine, which could allow an attacker
to bypass authorization plugins (AuthZ) under specific
circumstances.

For Debian 11 bullseye, this problem has been fixed in version
20.10.5+dfsg1-1+deb11u3.

We recommend that you upgrade your docker.io packages.

For the detailed security status of docker.io please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/docker.io>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQJFBAEBCgAvFiEEXQGHuUCiRbrXsPVqADoaLapBCF8FAmcMGIERHHJvdWNhQGRl
Ymlhbi5vcmcACgkQADoaLapBCF/sdw/+JiaZgD/5M9uy0FEkv+SntUpBMb50jy/T
/CwlngZycCDp5cpO7EkHGXfICsN7oaHDAO477EVxRhWPA6OVjOzMwPXhEfcvZEnc
/LsuCxgaljzBVm0ZVlwkdxz8a4yXefEk1m/MZYHSSz21Q341rmw7sl+RIcFtzGa6
fedGJGwqw4ae1cFUw5MCuN7F/JJ7eGRAQ+OaT1VpzskFpXq1hQTmateIUwsF2Zj+
J8pv/X8OgW1fomTDWecSUDqBXUIBsrGDMD+FOGzpsSZ9Xeer3Ig4zF14ApQCez3P
PvLLT7eUYjGPSDdn0ONKsmtgloj+fssO2gmQ2QRNHqWh8vZiOwsmK6AOFeWNJa52
CpExapEmF6F3o3w3quapjST0dJ5bXEO4fGu76OXSplmhNOO7cYcUaxgclHZLWcVn
TBtKJl/Znb/GtkjKmMaVPvVezi8Cm/Zb1w84SxEC+dGkuW1oPA1yDBDw5nKRU2BO
YuY/SvdfsNGJtGm4tVFWCWst8ILk9giM8tMQDdnP6EBnpp+bJVC+9L2z7rBzSxeB
RnTL5cQdtXMfoH+U1iQbPNyJ35e0l/l7HOsIPR+UpRqps56Htasd7MQJwt7gG8Ua
LuVqOHQ6TPADZKYypxm7L/VeyFFPslLY5kXVYj8gEQCIQAt7Tyd3sWs///FtnQQx
681FUAUVAFQ=
=qh39
-----END PGP SIGNATURE-----

```

---



=== Content from github.com_c2c55a5f_20250111_043234.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fae2b3666c517c96cbc2adf1af5591a6b00d4ec0f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fae2b3666c517c96cbc2adf1af5591a6b00d4ec0f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=moby%2Fmoby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moby](/moby)
/
**[moby](/moby/moby)**
Public

* [Notifications](/login?return_to=%2Fmoby%2Fmoby) You must be signed in to change notification settings
* [Fork
  18.7k](/login?return_to=%2Fmoby%2Fmoby)
* [Star
   69k](/login?return_to=%2Fmoby%2Fmoby)

* [Code](/moby/moby)
* [Issues
  3.1k](/moby/moby/issues)
* [Pull requests
  419](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects
  4](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

Additional navigation options

* [Code](/moby/moby)
* [Issues](/moby/moby/issues)
* [Pull requests](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

## Commit

[Permalink](/moby/moby/commit/ae2b3666c517c96cbc2adf1af5591a6b00d4ec0f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/moby/moby/tree/ae2b3666c517c96cbc2adf1af5591a6b00d4ec0f)
Browse the repository at this point in the history

```
[23.0] AuthZ plugin security fixes
```

* Loading branch information

[![@thaJeztah](https://avatars.githubusercontent.com/u/1804568?s=40&v=4)](/thaJeztah)

[thaJeztah](/moby/moby/commits?author=thaJeztah "View all commits by thaJeztah")
authored
Jul 23, 2024

2 parents
[b449180](/moby/moby/commit/b449180f066ebe31bbae6bb464470cb846bee155)
+
[7e895c4](/moby/moby/commit/7e895c4888117e69b1c7d8f7d3dee81e80bf3299)

commit ae2b366

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**115 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* pkg/authorization

  + pkg/authorization/authz.go
    [authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320)
  + pkg/authorization/authz\_unix\_test.go
    [authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321)

## There are no files selected for viewing

38 changes: 34 additions & 4 deletions

38
[pkg/authorization/authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320 "pkg/authorization/authz.go")

Show comments

[View file](/moby/moby/blob/ae2b3666c517c96cbc2adf1af5591a6b00d4ec0f/pkg/authorization/authz.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,6 +7,8 @@ import ( |
|  |  | "io" |
|  |  | "mime" |
|  |  | "net/http" |
|  |  | "net/url" |
|  |  | "regexp" |
|  |  | "strings" |
|  |  |  |
|  |  | "github.com/docker/docker/pkg/ioutils" |
| Expand Down  Expand Up | | @@ -52,10 +54,23 @@ type Ctx struct { |
|  |  | authReq \*Request |
|  |  | } |
|  |  |  |
|  |  | func isChunked(r \*http.Request) bool { |
|  |  | // RFC 7230 specifies that content length is to be ignored if Transfer-Encoding is chunked |
|  |  | if strings.EqualFold(r.Header.Get("Transfer-Encoding"), "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | for \_, v := range r.TransferEncoding { |
|  |  | if strings.EqualFold(v, "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // AuthZRequest authorized the request to the docker daemon using authZ plugins |
|  |  | func (ctx \*Ctx) AuthZRequest(w http.ResponseWriter, r \*http.Request) error { |
|  |  | var body []byte |
|  |  | if sendBody(ctx.requestURI, r.Header) && r.ContentLength > 0 && r.ContentLength < maxBodySize { |
|  |  | if sendBody(ctx.requestURI, r.Header) && (r.ContentLength > 0 || isChunked(r)) && r.ContentLength < maxBodySize { |
|  |  | var err error |
|  |  | body, r.Body, err = drainBody(r.Body) |
|  |  | if err != nil { |
| Expand Down  Expand Up | | @@ -108,7 +123,6 @@ func (ctx \*Ctx) AuthZResponse(rm ResponseModifier, r \*http.Request) error { |
|  |  | if sendBody(ctx.requestURI, rm.Header()) { |
|  |  | ctx.authReq.ResponseBody = rm.RawBody() |
|  |  | } |
|  |  |  |
|  |  | for \_, plugin := range ctx.plugins { |
|  |  | logrus.Debugf("AuthZ response using plugin %s", plugin.Name()) |
|  |  |  |
| Expand Down  Expand Up | | @@ -146,10 +160,26 @@ func drainBody(body io.ReadCloser) ([]byte, io.ReadCloser, error) { |
|  |  | return nil, newBody, err |
|  |  | } |
|  |  |  |
|  |  | func isAuthEndpoint(urlPath string) (bool, error) { |
|  |  | // eg www.test.com/v1.24/auth/optional?optional1=something&optional2=something (version optional) |
|  |  | matched, err := regexp.MatchString(`^[^\/]\*\/(v\d[\d\.]\*\/)?auth.\*`, urlPath) |
|  |  | if err != nil { |
|  |  | return false, err |
|  |  | } |
|  |  | return matched, nil |
|  |  | } |
|  |  |  |
|  |  | // sendBody returns true when request/response body should be sent to AuthZPlugin |
|  |  | func sendBody(url string, header http.Header) bool { |
|  |  | func sendBody(inURL string, header http.Header) bool { |
|  |  | u, err := url.Parse(inURL) |
|  |  | // Assume no if the URL cannot be parsed - an empty request will still be forwarded to the plugin and should be rejected |
|  |  | if err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // Skip body for auth endpoint |
|  |  | if strings.HasSuffix(url, "/auth") { |
|  |  | isAuth, err := isAuthEndpoint(u.Path) |
|  |  | if isAuth || err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
| Expand Down | |  |

84 changes: 81 additions & 3 deletions

84
[pkg/authorization/authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321 "pkg/authorization/authz_unix_test.go")

Show comments

[View file](/moby/moby/blob/ae2b3666c517c96cbc2adf1af5591a6b00d4ec0f/pkg/authorization/authz_unix_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -175,8 +175,8 @@ func TestDrainBody(t \*testing.T) { |
|  |  |  |
|  |  | func TestSendBody(t \*testing.T) { |
|  |  | var ( |
|  |  | url = "nothing.com" |
|  |  | testcases = []struct { |
|  |  | url string |
|  |  | contentType string |
|  |  | expected bool |
|  |  | }{ |
| Expand Down  Expand Up | | @@ -220,15 +220,93 @@ func TestSendBody(t \*testing.T) { |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth?p1=test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | } |
|  |  | ) |
|  |  |  |
|  |  | for \_, testcase := range testcases { |
|  |  | header := http.Header{} |
|  |  | header.Set("Content-Type", testcase.contentType) |
|  |  | if testcase.url == "" { |
|  |  | testcase.url = "nothing.com" |
|  |  | } |
|  |  |  |
|  |  | if b := sendBody(url, header); b != testcase.expected { |
|  |  | t.Fatalf("Unexpected Content-Type; Expected: %t, Actual: %t", testcase.expected, b) |
|  |  | if b := sendBody(testcase.url, header); b != testcase.expected { |
|  |  | t.Fatalf("sendBody failed: url: %s, content-type: %s; Expected: %t, Actual: %t", testcase.url, testcase.contentType, testcase.expected, b) |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ae2b366`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fae2b3666c517c96cbc2adf1af5591a6b00d4ec0f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_cb856560_20250111_043232.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fa79fabbfe84117696a19671f4aa88b82d0f64fc1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fa79fabbfe84117696a19671f4aa88b82d0f64fc1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=moby%2Fmoby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moby](/moby)
/
**[moby](/moby/moby)**
Public

* [Notifications](/login?return_to=%2Fmoby%2Fmoby) You must be signed in to change notification settings
* [Fork
  18.7k](/login?return_to=%2Fmoby%2Fmoby)
* [Star
   69k](/login?return_to=%2Fmoby%2Fmoby)

* [Code](/moby/moby)
* [Issues
  3.1k](/moby/moby/issues)
* [Pull requests
  419](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects
  4](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

Additional navigation options

* [Code](/moby/moby)
* [Issues](/moby/moby/issues)
* [Pull requests](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

## Commit

[Permalink](/moby/moby/commit/a79fabbfe84117696a19671f4aa88b82d0f64fc1)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

If url includes scheme, urlPath will drop hostname, which would not m…

[Browse files](/moby/moby/tree/a79fabbfe84117696a19671f4aa88b82d0f64fc1)
Browse the repository at this point in the history

```
…atch the auth check

Signed-off-by: Jameson Hyde <jameson.hyde@docker.com>
(cherry picked from commit [754fb8d](https://github.com/moby/moby/commit/754fb8d9d03895ae3ab60d2ad778152b0d835206))
Signed-off-by: Sebastiaan van Stijn <github@gone.nl>
Signed-off-by: Eli Uriegas <eli.uriegas@docker.com>
```

* Loading branch information

[![@jamesonhyde-docker](https://avatars.githubusercontent.com/u/40806266?s=40&v=4)](/jamesonhyde-docker) [![@seemethere](https://avatars.githubusercontent.com/u/1700823?s=40&v=4)](/seemethere)

[jamesonhyde-docker](/moby/moby/commits?author=jamesonhyde-docker "View all commits by jamesonhyde-docker")
authored and
[seemethere](/moby/moby/commits?author=seemethere "View all commits by seemethere")
committed
Jan 9, 2019

1 parent
[fc274cd](/moby/moby/commit/fc274cd2ff4cf3b48c91697fb327dd1fb95588fb)

commit a79fabb

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**38 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* pkg/authorization

  + pkg/authorization/authz.go
    [authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320)
  + pkg/authorization/authz\_unix\_test.go
    [authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321)

## There are no files selected for viewing

6 changes: 3 additions & 3 deletions

6
[pkg/authorization/authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320 "pkg/authorization/authz.go")

Show comments

[View file](/moby/moby/blob/a79fabbfe84117696a19671f4aa88b82d0f64fc1/pkg/authorization/authz.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -56,11 +56,11 @@ type Ctx struct { |
|  |  |  |
|  |  | func isChunked(r \*http.Request) bool { |
|  |  | //RFC 7230 specifies that content length is to be ignored if Transfer-Encoding is chunked |
|  |  | if strings.ToLower(r.Header.Get("Transfer-Encoding")) == "chunked" { |
|  |  | if strings.EqualFold(r.Header.Get("Transfer-Encoding"), "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | for \_, v := range r.TransferEncoding { |
|  |  | if 0 == strings.Compare(strings.ToLower(v), "chunked") { |
|  |  | if strings.EqualFold(v, "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | } |
| Expand Down  Expand Up | | @@ -162,7 +162,7 @@ func drainBody(body io.ReadCloser) ([]byte, io.ReadCloser, error) { |
|  |  |  |
|  |  | func isAuthEndpoint(urlPath string) (bool, error) { |
|  |  | // eg www.test.com/v1.24/auth/optional?optional1=something&optional2=something (version optional) |
|  |  | matched, err := regexp.MatchString(`^[^\/]+\/(v\d[\d\.]\*\/)?auth.\*`, urlPath) |
|  |  | matched, err := regexp.MatchString(`^[^\/]\*\/(v\d[\d\.]\*\/)?auth.\*`, urlPath) |
|  |  | if err != nil { |
|  |  | return false, err |
|  |  | } |
| Expand Down | |  |

35 changes: 35 additions & 0 deletions

35
[pkg/authorization/authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321 "pkg/authorization/authz_unix_test.go")

Show comments

[View file](/moby/moby/blob/a79fabbfe84117696a19671f4aa88b82d0f64fc1/pkg/authorization/authz_unix_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -259,6 +259,41 @@ func TestSendBody(t \*testing.T) { |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | } |
|  |  | ) |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a79fabb`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fa79fabbfe84117696a19671f4aa88b82d0f64fc1) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1019a605_20250111_043234.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fcc13f952511154a2866bddbb7dddebfe9e83b801)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fcc13f952511154a2866bddbb7dddebfe9e83b801)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=moby%2Fmoby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moby](/moby)
/
**[moby](/moby/moby)**
Public

* [Notifications](/login?return_to=%2Fmoby%2Fmoby) You must be signed in to change notification settings
* [Fork
  18.7k](/login?return_to=%2Fmoby%2Fmoby)
* [Star
   69k](/login?return_to=%2Fmoby%2Fmoby)

* [Code](/moby/moby)
* [Issues
  3.1k](/moby/moby/issues)
* [Pull requests
  419](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects
  4](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

Additional navigation options

* [Code](/moby/moby)
* [Issues](/moby/moby/issues)
* [Pull requests](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

## Commit

[Permalink](/moby/moby/commit/cc13f952511154a2866bddbb7dddebfe9e83b801)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/moby/moby/tree/cc13f952511154a2866bddbb7dddebfe9e83b801)
Browse the repository at this point in the history

```
[27.0] AuthZ plugin security fixes
```

* Loading branch information

[![@thaJeztah](https://avatars.githubusercontent.com/u/1804568?s=40&v=4)](/thaJeztah)

[thaJeztah](/moby/moby/commits?author=thaJeztah "View all commits by thaJeztah")
authored
Jul 23, 2024

2 parents
[a21b1a2](/moby/moby/commit/a21b1a2d12e2c01542cb191eb526d7bfad0641e3)
+
[d1bbb61](/moby/moby/commit/d1bbb61844171b0fbcdfb80e4d06334e43cc7e5b)

commit cc13f95

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**115 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* pkg/authorization

  + pkg/authorization/authz.go
    [authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320)
  + pkg/authorization/authz\_unix\_test.go
    [authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321)

## There are no files selected for viewing

38 changes: 34 additions & 4 deletions

38
[pkg/authorization/authz.go](#diff-4fba707264ab4bc4865e42234a95bb4a749e2e28b1156ced9e225f4a8920e320 "pkg/authorization/authz.go")

Show comments

[View file](/moby/moby/blob/cc13f952511154a2866bddbb7dddebfe9e83b801/pkg/authorization/authz.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,6 +8,8 @@ import ( |
|  |  | "io" |
|  |  | "mime" |
|  |  | "net/http" |
|  |  | "net/url" |
|  |  | "regexp" |
|  |  | "strings" |
|  |  |  |
|  |  | "github.com/containerd/log" |
| Expand Down  Expand Up | | @@ -53,10 +55,23 @@ type Ctx struct { |
|  |  | authReq \*Request |
|  |  | } |
|  |  |  |
|  |  | func isChunked(r \*http.Request) bool { |
|  |  | // RFC 7230 specifies that content length is to be ignored if Transfer-Encoding is chunked |
|  |  | if strings.EqualFold(r.Header.Get("Transfer-Encoding"), "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | for \_, v := range r.TransferEncoding { |
|  |  | if strings.EqualFold(v, "chunked") { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // AuthZRequest authorized the request to the docker daemon using authZ plugins |
|  |  | func (ctx \*Ctx) AuthZRequest(w http.ResponseWriter, r \*http.Request) error { |
|  |  | var body []byte |
|  |  | if sendBody(ctx.requestURI, r.Header) && r.ContentLength > 0 && r.ContentLength < maxBodySize { |
|  |  | if sendBody(ctx.requestURI, r.Header) && (r.ContentLength > 0 || isChunked(r)) && r.ContentLength < maxBodySize { |
|  |  | var err error |
|  |  | body, r.Body, err = drainBody(r.Body) |
|  |  | if err != nil { |
| Expand Down  Expand Up | | @@ -109,7 +124,6 @@ func (ctx \*Ctx) AuthZResponse(rm ResponseModifier, r \*http.Request) error { |
|  |  | if sendBody(ctx.requestURI, rm.Header()) { |
|  |  | ctx.authReq.ResponseBody = rm.RawBody() |
|  |  | } |
|  |  |  |
|  |  | for \_, plugin := range ctx.plugins { |
|  |  | log.G(context.TODO()).Debugf("AuthZ response using plugin %s", plugin.Name()) |
|  |  |  |
| Expand Down  Expand Up | | @@ -147,10 +161,26 @@ func drainBody(body io.ReadCloser) ([]byte, io.ReadCloser, error) { |
|  |  | return nil, newBody, err |
|  |  | } |
|  |  |  |
|  |  | func isAuthEndpoint(urlPath string) (bool, error) { |
|  |  | // eg www.test.com/v1.24/auth/optional?optional1=something&optional2=something (version optional) |
|  |  | matched, err := regexp.MatchString(`^[^\/]\*\/(v\d[\d\.]\*\/)?auth.\*`, urlPath) |
|  |  | if err != nil { |
|  |  | return false, err |
|  |  | } |
|  |  | return matched, nil |
|  |  | } |
|  |  |  |
|  |  | // sendBody returns true when request/response body should be sent to AuthZPlugin |
|  |  | func sendBody(url string, header http.Header) bool { |
|  |  | func sendBody(inURL string, header http.Header) bool { |
|  |  | u, err := url.Parse(inURL) |
|  |  | // Assume no if the URL cannot be parsed - an empty request will still be forwarded to the plugin and should be rejected |
|  |  | if err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // Skip body for auth endpoint |
|  |  | if strings.HasSuffix(url, "/auth") { |
|  |  | isAuth, err := isAuthEndpoint(u.Path) |
|  |  | if isAuth || err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
| Expand Down | |  |

84 changes: 81 additions & 3 deletions

84
[pkg/authorization/authz\_unix\_test.go](#diff-5bb0efdd976179768917eca6a8eadc4bbace801ba183502656c57f3c2a5c5321 "pkg/authorization/authz_unix_test.go")

Show comments

[View file](/moby/moby/blob/cc13f952511154a2866bddbb7dddebfe9e83b801/pkg/authorization/authz_unix_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -174,8 +174,8 @@ func TestDrainBody(t \*testing.T) { |
|  |  |  |
|  |  | func TestSendBody(t \*testing.T) { |
|  |  | var ( |
|  |  | url = "nothing.com" |
|  |  | testcases = []struct { |
|  |  | url string |
|  |  | contentType string |
|  |  | expected bool |
|  |  | }{ |
| Expand Down  Expand Up | | @@ -219,15 +219,93 @@ func TestSendBody(t \*testing.T) { |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth?p1=test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "nothing.com/v1/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://nothing.com/v1.24/auth/test", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: false, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "http://www.nothing.com/test?p1=/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | { |
|  |  | url: "https://www.nothing.com/something/auth", |
|  |  | contentType: "application/json;charset=UTF8", |
|  |  | expected: true, |
|  |  | }, |
|  |  | } |
|  |  | ) |
|  |  |  |
|  |  | for \_, testcase := range testcases { |
|  |  | header := http.Header{} |
|  |  | header.Set("Content-Type", testcase.contentType) |
|  |  | if testcase.url == "" { |
|  |  | testcase.url = "nothing.com" |
|  |  | } |
|  |  |  |
|  |  | if b := sendBody(url, header); b != testcase.expected { |
|  |  | t.Fatalf("Unexpected Content-Type; Expected: %t, Actual: %t", testcase.expected, b) |
|  |  | if b := sendBody(testcase.url, header); b != testcase.expected { |
|  |  | t.Fatalf("sendBody failed: url: %s, content-type: %s; Expected: %t, Actual: %t", testcase.url, testcase.contentType, testcase.expected, b) |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `cc13f95`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2Fcc13f952511154a2866bddbb7dddebfe9e83b801) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e9612501_20250111_043235.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fsecurity%2Fadvisories%2FGHSA-v23v-6jw2-98fq)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fsecurity%2Fadvisories%2FGHSA-v23v-6jw2-98fq)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=moby%2Fmoby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moby](/moby)
/
**[moby](/moby/moby)**
Public

* [Notifications](/login?return_to=%2Fmoby%2Fmoby) You must be signed in to change notification settings
* [Fork
  18.7k](/login?return_to=%2Fmoby%2Fmoby)
* [Star
   69k](/login?return_to=%2Fmoby%2Fmoby)

* [Code](/moby/moby)
* [Issues
  3.1k](/moby/moby/issues)
* [Pull requests
  419](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects
  4](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

Additional navigation options

* [Code](/moby/moby)
* [Issues](/moby/moby/issues)
* [Pull requests](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

# Authz zero length regression

Critical

[thaJeztah](/thaJeztah)
published
GHSA-v23v-6jw2-98fq
Jul 23, 2024

## Package

docker-ce
(docker-ce)

## Affected versions

<= v19.03.15, <= v20.10.27, <= v23.0.14, <= v24.0.9, <= v25.0.5, <= v26.0.2, <= v26.1.4, <= v27.0.3, <= v27.1.0

## Patched versions

> v23.0.14, > v26.1.4, > v27.1.0

## Description

A security vulnerability has been detected in certain versions of Docker Engine, which could allow an attacker to bypass [authorization plugins (AuthZ)](https://docs.docker.com/engine/extend/plugins_authorization/) under specific circumstances. The base likelihood of this being exploited is low. This advisory outlines the issue, identifies the affected versions, and provides remediation steps for impacted users.

### Impact

Using a specially-crafted API request, an Engine API client could make the daemon forward the request or response to an [authorization plugin](https://docs.docker.com/engine/extend/plugins_authorization/) without the body. In certain circumstances, the authorization plugin may allow a request which it would have otherwise denied if the body had been forwarded to it.

A security issue was discovered In 2018, where an attacker could bypass AuthZ plugins using a specially crafted API request. This could lead to unauthorized actions, including privilege escalation. Although this issue was fixed in Docker Engine [v18.09.1](https://docs.docker.com/engine/release-notes/18.09/#security-fixes-1) in January 2019, the fix was not carried forward to later major versions, resulting in a regression. Anyone who depends on authorization plugins that introspect the request and/or response body to make access control decisions is potentially impacted.

Docker EE v19.03.x and all versions of Mirantis Container Runtime **are not vulnerable.**

### Vulnerability details

* **AuthZ bypass and privilege escalation:** An attacker could exploit a bypass using an API request with Content-Length set to 0, causing the Docker daemon to forward the request without the body to the AuthZ plugin, which might approve the request incorrectly.
* **Initial fix:** The issue was fixed in Docker Engine [v18.09.1](https://docs.docker.com/engine/release-notes/18.09/#security-fixes-1) January 2019..
* **Regression:** The fix was not included in Docker Engine v19.03 or newer versions. This was identified in April 2024 and patches were released for the affected versions on July 23, 2024. The issue was assigned [CVE-2024-41110](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-41110).

### Patches

* docker-ce v27.1.1 containes patches to fix the vulnerability.
* Patches have also been merged into the master, 19.0, 20.0, 23.0, 24.0, 25.0, 26.0, and 26.1 release branches.

### Remediation steps

* If you are running an affected version, update to the most recent patched version.
* Mitigation if unable to update immediately:
  + Avoid using AuthZ plugins.
  + Restrict access to the Docker API to trusted parties, following the principle of least privilege.

### References

* [fc274cd](https://github.com/moby/moby/commit/fc274cd2ff4cf3b48c91697fb327dd1fb95588fb)
* [a79fabb](https://github.com/moby/moby/commit/a79fabbfe84117696a19671f4aa88b82d0f64fc1)
* <https://www.docker.com/blog/docker-security-advisory-docker-engine-authz-plugin/>

### Severity

Critical

10.0

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H

### CVE ID

CVE-2024-41110

### Weaknesses

[CWE-187](/advisories?query=cwe%3A187) [CWE-444](/advisories?query=cwe%3A444) [CWE-863](/advisories?query=cwe%3A863)

### Credits

* [![@corhere](https://avatars.githubusercontent.com/u/274527?s=40&v=4)](/corhere)
  [corhere](/corhere)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


