

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1860977)
* [XML](/show_bug.cgi?ctype=xml&id=1860977)

Closed
[Bug 1860977](/show_bug.cgi?id=1860977)
(CVE-2024-1936)

Opened 1 year ago
Closed 11 months ago

# PGP encryption can change subject of E-Mail if selecting other mail A while large mail B is decrypting

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

PGP encryption can change subject of E-Mail if selecting other mail A while large mail B is decrypting

## Categories

### (MailNews Core :: Security: OpenPGP, defect, P1)

[Product:](/describecomponents.cgi?product=MailNews%20Core)

MailNews Core
▾

MailNews Core
Mail and news components common to Thunderbird and SeaMonkey
[See Open Bugs in This Product](/buglist.cgi?product=MailNews%20Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=MailNews%20Core)
Watch This Product

[Component:](/describecomponents.cgi?product=MailNews%20Core&component=Security%3A%20OpenPGP#Security%3A%20OpenPGP)

Security: OpenPGP
▾

MailNews Core :: Security: OpenPGP
OpenPGP is about all aspects related to encrypted or signed email messages using the OpenPGP protocol.
[See Open Bugs in This Component](/buglist.cgi?product=MailNews%20Core&component=Security%3A%20OpenPGP&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=MailNews%20Core&component=Security%3A%20OpenPGP&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=MailNews%20Core&component=Security%3A%20OpenPGP)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Thunderbird 115

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

## Tracking

### (thunderbird\_esr115 fixed, thunderbird124 affected)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

125 Branch

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| thunderbird\_esr115 | --- | [fixed](/buglist.cgi?f1=cf_status_thunderbird_esr115&o1=equals&v1=fixed) |
| thunderbird124 | --- | [affected](/buglist.cgi?f1=cf_status_thunderbird_124&o1=equals&v1=affected) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| relnote-thunderbird |  | --- |
| seamonkey2.53 | --- | --- |
| seamonkey2.57esr | --- | --- |
| thunderbird\_esr115 | --- | fixed |
| thunderbird\_esr128 | --- | --- |
| thunderbird124 |  | affected |
| thunderbird133 | --- | --- |
| thunderbird134 | --- | --- |
| thunderbird135 | --- | --- |

## People

### (Reporter: 2paso2, Assigned: mkmelin)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/18eb16a976feb4b40d839c5e9036bc3a?d=mm&size=40)  [mkmelin](/user_profile?user_id=101158)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/fbec245ad02709be0a91826b802763d0?d=mm&size=40)  [2paso2](/user_profile?user_id=737136)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/d11b5b0a468ed960df1fde3c304d3580?d=mm&size=40)  [KaiE](/user_profile?user_id=36541)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

25 people

## References

### (Regression)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[1803255](/show_bug.cgi?id=1803255 "RESOLVED FIXED - Fix and enable the remaining tests with the new 3-pane")

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1873871](/show_bug.cgi?id=1873871 "RESOLVED DUPLICATE - Email subject is overwritten while waiting for decryption"), [1881689](/show_bug.cgi?id=1881689 "RESOLVED DUPLICATE - Security-Relevant: Message subject of GPG encrypted mail is wrongly assigned to different message, breaks confidentiality")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1892876](/show_bug.cgi?id=1892876 "UNCONFIRMED - Attachments are shown in wrong email if selecting other email A while large email B is decrypting")

## Details

### (Keywords: regression, sec-high, testcase, Whiteboard: [see comment 32, 38])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-1936

[Keywords:](/describekeywords.cgi)

[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[see comment 32, 38]

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

2

Bug Flags:

|  | wanted-thunderbird |  |
| --- | --- | --- |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | relnote |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 3 obsolete files)

| [pics.zip](/attachment.cgi?id=9360189)  [1 year ago](#c0)  [2paso2](/user_profile?user_id=737136)   32.93 KB, application/zip |  | [Details](/attachment.cgi?id=9360189&action=edit) |
| --- | --- | --- |
| [Bug 1860977 - Don't set the subject on the wrong message. r=kaie](/attachment.cgi?id=9379470)  [11 months ago](#c10)  [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9379470&action=edit) | [Review](/attachment.cgi?id=9379470) |
| [1860977-115-v1.patch](/attachment.cgi?id=9381948)  [11 months ago](#c18)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   1.82 KB, patch | mkmelin : [review+](#c25 "11 months ago") | [Details](/attachment.cgi?id=9381948&action=edit) | [Diff](/attachment.cgi?id=9381948&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1860977&attachment=9381948) |
| [large-encrypted.gz](/attachment.cgi?id=9381965)  [11 months ago](#c22)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   8.04 MB, application/gzip |  | [Details](/attachment.cgi?id=9381965&action=edit) |
| [1860977-115-v2.patch](/attachment.cgi?id=9382153)  [11 months ago](#c28)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   1.86 KB, patch | KaiE : [review+](#c28 "11 months ago") | [Details](/attachment.cgi?id=9382153&action=edit) | [Diff](/attachment.cgi?id=9382153&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1860977&attachment=9382153) |
| [Bug 1860977 - Don't set the subject on the wrong message, backport to 115.x. r=mkmelin](/attachment.cgi?id=9382500)  [11 months ago](#c36)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   48 bytes, text/x-phabricator-request | wsmwk : [approval-comm-esr115+](#c51 "11 months ago") | [Details](/attachment.cgi?id=9382500&action=edit) | [Review](/attachment.cgi?id=9382500) |
| [Bug 1860977 - Don't try to modify missing subject header attribute. r=mkmelin](/attachment.cgi?id=9387286)  [11 months ago](#c42)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9387286&action=edit) | [Review](/attachment.cgi?id=9387286) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [2paso2](/user_profile?user_id=737136)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1860977#c0)• 1 year ago |
|  | |

Attached file
[pics.zip](attachment.cgi?id=9360189)
— [Details](attachment.cgi?id=9360189&action=edit)

User Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86\_64; rv:109.0) Gecko/20100101 Firefox/118.0

Steps to reproduce:

Send 2 E-Mails to myself.

E-Mail A with no encryption

E-Mail B with PGP encryption and 5 MB

Open E-Mail B

While Thunderbird is loading/decrypting click to open E-Mail A

Actual results:

After E-Mail B is encrypted the subject of E-Mail A is permanently changed to the subject of E-Mail B, restarting Thunderbird does not resolve this bug.

Expected results:

Subject of E-Mail A should not change.

|  | [2paso2](/user_profile?user_id=737136)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1860977#c1)• 1 year ago |
|  | |

typo in Actual results:

it should be after E-Mail B is decrypted

|  | [2paso2](/user_profile?user_id=737136)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a596_737136)• 1 year ago |

Summary: PGP encryption can changes subject of E-Mail → PGP encryption can change subject of E-Mail

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a903_101158)• 1 year ago |

Component: Untriaged → Security: OpenPGPProduct: Thunderbird → MailNews CoreSummary: PGP encryption can change subject of E-Mail → PGP encryption can change subject of E-Mail if selecting other mail A while large mail B is decrypting

|  | [Al](/user_profile?user_id=739236) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1860977#c2)• 1 year ago |
|  | |

I confirm same behavior in User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:115.0) Gecko/20100101 Thunderbird/115.5.1.

It doesn't matter if the First Message is encrypted or not, nor if the subject of the Encrypted Message is encrypted or not.

Also it doesn't matter if Thunderbird is running with all Add-Ons switched off, nor if it is in Troubleshooting Mode, nor which is the active view, nor if it is clean installation.

Usually this behavior occurs with big enough Encrypted Message witch load slowlier than the smaller ones. I've tested with message with size 8 MB.

This behavior doesn't occur in previous stable versions - 91.13.1 and 102.15.1.

Steps to reproduce:

* "Message Pane (F8)" switched on
* Select Encrypted Message
* While Thunderbird is loading/decrypting the Encrypted Message click to open the First Message

Result - the Subject of First Message is changed with the Subject of the Encrypted Message.

The only thing helping to restore the original subjects is to do "Repair Folder". But after that if the steps above are repeated, the subject is messed up again.

I've tested with folder within IMAP Account and with folder within "Local Folders" - the same behavior occurs.

The following errors are thrown in Error Console:

---

16:39:59.364 TypeError: currentHeaderData.subject is undefined

setSubject chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:772

modifyMessageHeaders chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:1101

processDecryptionResult chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:1065

displayStatus chrome://openpgp/content/modules/mimeDecrypt.jsm:667

onStopRequest chrome://openpgp/content/modules/mimeDecrypt.jsm:594

mimeDecrypt.jsm:695:15

16:39:59.364 mimeDecrypt.jsm: caught exception: TypeError

Message: 'currentHeaderData.subject is undefined'

File: chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js

Line: 772

Stack: setSubject@chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:772:5

modifyMessageHeaders@chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:1101:26

processDecryptionResult@chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:1065:16

displayStatus@chrome://openpgp/content/modules/mimeDecrypt.jsm:667:20

onStopRequest@chrome://openpgp/content/modules/mimeDecrypt.jsm:594:12

---

Under Windows 10 the JS files are loaded from C:\Program Files\Mozilla Thunderbird\omnia.ja (omni.ja\chrome\openpgp\content\openpgp\ui).

If the Encrypted Message is fully loaded with it's Subject, the Subject of the First Message is shown as it should be. But if you repeat the steps above, the wrong behavior occurs again.

|  | [MD-Work](/user_profile?user_id=644785) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1860977#c3)• 1 year ago |
|  | |

Same here with Thunderbird-115.5.0 on openSUSE-15.5 Linux.

Workaround to fix the subject of an existing mail in an IMAP account:

Use another mail client\* to move the mail to another folder.

When Thunderbird finds the mail in another folder it will read the subject again.

\*another mail client: second Thunderbird profile / web mail client / different software / mail client on another device

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1860977#c4)• 1 year ago |
|  | |

Maybe some race with <https://searchfox.org/comm-central/rev/6cc041af2c1702985462e561048396bf790b5721/mail/base/content/msgHdrView.js#736> and (callers of) <https://searchfox.org/comm-central/rev/6cc041af2c1702985462e561048396bf790b5721/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js#715>

|  | [Al](/user_profile?user_id=739236) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1860977#c5)• 1 year ago |
|  | |

Not fixed in newly updated Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:115.0) Gecko/20100101 Thunderbird/115.6.0.

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a6663273_101158)• 1 year ago |

Duplicate of this bug: [1873871](/show_bug.cgi?id=1873871 "RESOLVED DUPLICATE - Email subject is overwritten while waiting for decryption")

|  | [sprinz](/user_profile?user_id=741401) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1860977#c7)• 1 year ago |
|  | |

A workaround to restore the actual subject of the mail is to "Repair" the folder via Settings of the containing folder -> Repair

|  | [michaelspohn](/user_profile?user_id=180496) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1860977#c8)• 11 months ago |
|  | |

I and at least two of my colleagues have the same problem, and it's quite annoying!

Our workaround: DEL and then immediately CTRL-Z to undo the "Delete" restores the correct subject.

|  | [betterbird.project+14](/user_profile?user_id=741663) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1860977#c9)• 11 months ago |
|  | |

<https://github.com/Betterbird/thunderbird-patches/blob/main/115/bugs/1860977-dont-set-subject-on-wrong-message.patch>

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1860977#c10)• 11 months ago |
|  | |

Attached file
[Bug 1860977 - Don't set the subject on the wrong message. r=kaie](attachment.cgi?id=9379470)
— [Details](attachment.cgi?id=9379470&action=edit)

Based on <https://github.com/Betterbird/thunderbird-patches/blob/main/115/bugs/1860977-dont-set-subject-on-wrong-message.patch>

Some parts needed changing due to changed on trunk vs 115.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a9507768_600971)• 11 months ago |

Assignee: nobody → mkmelin+mozillaStatus: UNCONFIRMED → ASSIGNEDEver confirmed: true

|  | [betterbird.project+14](/user_profile?user_id=741663) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1860977#c11)• 11 months ago |
|  | |

Thanks for picking up this patch. Please change `gMessage.date = Date.parse(hdr.date) * 1000;` to use `msg`.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1860977#c12)• 11 months ago |
|  | |

This is a regression caused by [bug 1803255](/show_bug.cgi?id=1803255 "RESOLVED FIXED - Fix and enable the remaining tests with the new 3-pane")

A necessary check in function isCurrentMessage(), which was designed to catch this kind of problem, was dropped in this commit:

<https://phabricator.services.mozilla.com/D164012>

The commit was described as "fix tests", so probably the code that got removed had caused the tests to fail?

It shouldn't have been removed.

I wonder why I wasn't involved in the review of that change...

I suggest that in order to fix this bug, that the old code gets restored.

Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a9516790_36541)• 11 months ago |

Regressed by: [1803255](/show_bug.cgi?id=1803255 "RESOLVED FIXED - Fix and enable the remaining tests with the new 3-pane")

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a9886666_36541)• 11 months ago |

Severity: -- → S2Priority: -- → P1

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a10117273_101158)• 11 months ago |

[status-thunderbird124](/buglist.cgi?f1=cf_status_thunderbird_124&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_thunderbird_124&o1=equals&v1=affected)
[status-thunderbird\_esr115](/buglist.cgi?f1=cf_status_thunderbird_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_thunderbird_esr115&o1=equals&v1=affected)Keywords: [checkin-needed-tb](/buglist.cgi?keywords=checkin-needed-tb&resolution=---)Target Milestone: --- → 125 Branch

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1860977#c13)• 11 months ago |
|  | |

Pushed by mkmelin@iki.fi:

<https://hg.mozilla.org/comm-central/rev/edd59a219b18>

Don't set the subject on the wrong message. r=kaie

Status: ASSIGNED → RESOLVEDClosed: 11 months agoKeywords: [checkin-needed-tb](/buglist.cgi?keywords=checkin-needed-tb&resolution=---)Resolution: --- → FIXED

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1860977#c14)• 11 months ago |
|  | |

The 115 code is different in multiple ways, so I think we can just let this ride the trains.

[status-thunderbird\_esr115](/buglist.cgi?f1=cf_status_thunderbird_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_thunderbird_esr115&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_thunderbird_esr115&o1=equals&v1=wontfix)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1860977#c15)• 11 months ago |
|  | |

I'd prefer to find a way to backport, this seems like a significant regression.

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1860977#c16)• 11 months ago |
|  | |

Ok, let me check how that seems.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1860977#c17)• 11 months ago |
|  | |

I wonder if it's sufficient to simply restore the code for the isCurrentMessage() function.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1860977#c18)• 11 months ago |
|  | |

Attached patch

[1860977-115-v1.patch](attachment.cgi?id=9381948&action=diff) (obsolete)
— [Details](attachment.cgi?id=9381948&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1860977&attachment=9381948)

With this patch for 115 (on top of the other queued patches I locally carry for 115), I get successful tests for

mail/test/browser/openpgp

mail/extensions/openpgp/test

mailnews/mime/test/unit/test\_openpgp\_decrypt.js

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1860977#c19)• 11 months ago |
|  | |

Might work since that doesn't have the uri type confusions from [bug 1852922](/show_bug.cgi?id=1852922 "RESOLVED FIXED - Code coverage false negatives").

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1860977#c20)• 11 months ago |
|  | |

I'm working on creating a very large local message for reproducing the bug and testing the fix locally (unless you have a better idea).

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1860977#c21)• 11 months ago |
|  | |

Please go ahead.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1860977#c22)• 11 months ago |
|  | |

Attached file
[large-encrypted.gz](attachment.cgi?id=9381965)
— [Details](attachment.cgi?id=9381965&action=edit)

This is a compressed mailbox file.

Save.

gzip -d large-encrypted.gz

Then move the file large-encrypted to the $HOME/.thunderbird/some-profile/Mail/Local\ Folders/

directory

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1860977#c23)• 11 months ago |
|  | |

The attached patch for the 115 branch works for me.

Without the patch, I can easily reproduce the bug. Start Thunderbird, click the local folder "large encrypted", click the second message that shows with a subject "...", which takes about 2-3 seconds. Immediately after clicking that message, click on the other message in the folder.

Without patch, I can reproduce the bug.

With patch, no bug.

To restart testing, delete the large-encrypted.msf file.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1860977#c24)• 11 months ago |
|  | |

Comment on [attachment 9381948](/attachment.cgi?id=9381948 "1860977-115-v1.patch") [[details]](/attachment.cgi?id=9381948&action=edit "1860977-115-v1.patch") [[diff]](/attachment.cgi?id=9381948&action=diff "1860977-115-v1.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1860977&attachment=9381948)

1860977-115-v1.patch

Magnus, do you want to mark the backport patch as r+ here, or would you like us to use phabricator?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a10375262_36541)• 11 months ago |

[status-thunderbird\_esr115](/buglist.cgi?f1=cf_status_thunderbird_esr115&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_thunderbird_esr115&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_thunderbird_esr115&o1=equals&v1=affected)

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1860977#c25)• 11 months ago |
|  | |

Comment on [attachment 9381948](/attachment.cgi?id=9381948 "1860977-115-v1.patch") [[details]](/attachment.cgi?id=9381948&action=edit "1860977-115-v1.patch") [[diff]](/attachment.cgi?id=9381948&action=diff "1860977-115-v1.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1860977&attachment=9381948)
1860977-115-v1.patch
Review of [attachment 9381948](/attachment.cgi?id=9381948 "1860977-115-v1.patch") [[details]](/attachment.cgi?id=9381948&action=edit "1860977-115-v1.patch") [[diff]](/attachment.cgi?id=9381948&action=diff "1860977-115-v1.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1860977&attachment=9381948):
-----------------------------------------------------------------
Thanks! r=mkmelin
[Attachment #9381948](/attachment.cgi?id=9381948&action=edit "1860977-115-v1.patch") -
Flags: review+

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1860977#c26)• 11 months ago |
|  | |

The backport patch doesn't depend on the BB patch, IMHO.

I had independently discovered the removal of the isCurrentMessage() function, and Magnus created the patch based on the old deleted message.

No attribution seems necessary.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1860977#c27)• 11 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1860977&comment_id=16808278 "1 revision") |
|  | |

I don't see any related failures in a comm-esr115 try build with 1860977-115-v1.patch

I will attach a version 2 with linting fixed.

I will use a local 115.x build with this patch included for a while as my primary Thunderbird, and watch for regressions, prior to requesting 115 approval.

edit:

try build is here:

<https://treeherder.mozilla.org/jobs?repo=try-comm-central&revision=9fec4cfba57eb83f37d9d84d8ca1e6811bb83ccc>

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1860977#c28)• 11 months ago |
|  | |

Attached patch

[1860977-115-v2.patch](attachment.cgi?id=9382153&action=diff) (obsolete)
— [Details](attachment.cgi?id=9382153&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1860977&attachment=9382153)

carrying forward r=mkmelin

[Attachment #9381948](/attachment.cgi?id=9381948&action=edit "1860977-115-v1.patch") -
Attachment is obsolete: true
[Attachment #9382153](/attachment.cgi?id=9382153&action=edit "1860977-115-v2.patch") -
Flags: review+

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1860977#c29)• 11 months ago |
|  | |

There seems to be another way how the broken code could have caused a mess:

If you have multiple tabs open, and one of them is an encrypted message, and then you (re)start Thunderbird, messages will be loading in parallel and corruption may happen.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a10462481_36541)• 11 months ago |

Duplicate of this bug: [1881689](/show_bug.cgi?id=1881689 "RESOLVED DUPLICATE - Security-Relevant: Message subject of GPG encrypted mail is wrongly assigned to different message, breaks confidentiality")

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1860977#c31)• 11 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1860977&comment_id=16809155 "1 revision") |
|  | |

For everyone affected by this bug, I would like to offer you a test build, a modified version of the 115.x version with the planned fix included, which you could use with your existing Thunderbird settings, to test the fix. I'd appreciate your feedback.

Linux 64bit:

<https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/I7JiLB7vRsqAXg9xElLoOg/runs/0/artifacts/public/build/target.tar.bz2>

Linux 32bit:

<https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/L0QwXuqrT4uIvUi8-RciMA/runs/0/artifacts/public/build/target.tar.bz2>

Windows 64bit:

<https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/Wv3dSUSwR9Wplr-Y967UFA/runs/0/artifacts/public/build/target.zip>

Windows 32bit:

<https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/ItnE_FoXRaClS0SDUfhnbA/runs/0/artifacts/public/build/target.zip>

OSX:

<https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/V-6z0Pw7Rwucw1qBxmSkMg/runs/0/artifacts/public/build/target.dmg>

To use, download, and extract the file to a separate directory. Quit your usual Thunderbird. Use a terminal and "cd" to the directory that contains the downloaded build. Run the build from there. I suggest to run from terminal, because then you can easily provide a command line parameter. I suggest to use -P which will allow you to select your existing Thunderbird profile. (Otherwise, the test build might just create a fresh profile with default settings.)

(Using the OSX build is a bit more difficult, as you have to convince the OS to execute the download. I'd have to lookup the details, if necessary.)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1860977#c32)• 11 months ago |
|  | |

Unfortunately we aren't able to automatically repair the existing wrong subject assignments. The fix is limited to avoiding new trouble. It will be necessary that you use the repair folder approach (on each affected folder) to clean up the wrong assignments.

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a10475940_29811)• 11 months ago |

Keywords: [testcase](/buglist.cgi?keywords=testcase&resolution=---)Whiteboard: [see comment 31, 32]

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1860977#c33)• 11 months ago |
|  | |

I was told that some users cannot provide their feedback in bugzilla, because this bug is closed.

I'm hereby re-opening the bug temporarily.

If you wanted to provide feedback on the test build, but couldn't, please go ahead and try again. Thanks!

Status: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1860977#c34)• 11 months ago |
|  | |

I got a report from Al that the JS exceptions from [comment 2](/show_bug.cgi?id=1860977#c2 "RESOLVED FIXED - PGP encryption can change subject of E-Mail if selecting other mail A while large mail B is decrypting") are still seen with the experimental build from [comment 31](/show_bug.cgi?id=1860977#c31 "RESOLVED FIXED - PGP encryption can change subject of E-Mail if selecting other mail A while large mail B is decrypting").

We have to decide whether we want to attempt a more complete backport, or whether those exceptions are not harmful.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1860977#c35)• 11 months ago |
|  | |

Ok, let's attempt a more complete backport. I'll create a new try build and use phabricator for the updated patch.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a10660471_36541)• 11 months ago |

[Attachment #9382153](/attachment.cgi?id=9382153&action=edit "1860977-115-v2.patch") -
Attachment is obsolete: true

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1860977#c36)• 11 months ago |
|  | |

Attached file
[Bug 1860977 - Don't set the subject on the wrong message, backport to 115.x. r=mkmelin](attachment.cgi?id=9382500)
— [Details](attachment.cgi?id=9382500&action=edit)

Based on <https://github.com/Betterbird/thunderbird-patches/blob/main/115/bugs/1860977-dont-set-subject-on-wrong-message.patch>

|  | [Al](/user_profile?user_id=739236) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1860977#c37)• 11 months ago |
|  | |

I'm posting what I've wrote to Kai as feedback prior reopening the bug.

I've tested the 64bit test builds of modified 115.x version on Windows 10 x64 and Ubuntu 22.04.4 LTS Jammy.

On both operating systems the subjects are loaded correctly with "Message Pane (F8)" is switched on or if there are Tab opened messages.

Under Windows 10 the error console throw couple of times the following, but I suppose that I've switched between the messages too fast:

---

## 17:34:44.575 TypeError: currentHeaderData.subject is undefined setSubject chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:759 modifyMessageHeaders chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:1081 processDecryptionResult chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:1045 displayStatus chrome://openpgp/content/modules/mimeDecrypt.jsm:668 onStopRequest chrome://openpgp/content/modules/mimeDecrypt.jsm:595 mimeDecrypt.jsm:700:15 17:34:44.576 mimeDecrypt.jsm: caught exception: TypeError Message: 'currentHeaderData.subject is undefined' File: chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js Line: 759 Stack: setSubject@chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:759:5 modifyMessageHeaders@chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:1081:26 processDecryptionResult@chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:1045:16 displayStatus@chrome://openpgp/content/modules/mimeDecrypt.jsm:668:20 onStopRequest@chrome://openpgp/content/modules/mimeDecrypt.jsm:595:12

Generally this build works fine for me.

Thank you for your hard work!

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1860977#c38)• 11 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1860977&comment_id=16810565 "1 revision") |
|  | |

New test build (based on TB 115.x) that uses the improved backported patch:

Linux 64bit:

<https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/a3FIqBGmRoqGyA2Y_JdAGQ/runs/0/artifacts/public/build/target.tar.bz2>

Linux 32bit:

<https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/ULTYjBLHTXuHr70_Woh6QQ/runs/0/artifacts/public/build/target.tar.bz2>

Windows 64bit:

<https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/MTslZT-tReqz0Q8crKj9kA/runs/0/artifacts/public/build/target.zip>

Windows 32bit:

<https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/IviUFC99Rmuvxk9l-vH4Vg/runs/0/artifacts/public/build/target.zip>

OSX:

<https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/LAiJFczwR8OwOIzJDTVwnQ/runs/0/artifacts/public/build/target.dmg>

( <https://treeherder.mozilla.org/jobs?repo=try-comm-central&revision=11f7cfcdb7bad93e3aa5d33e3d9fa242aead717b&selectedTaskRun=LAiJFczwR8OwOIzJDTVwnQ.0> )

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a10719570_36541)• 11 months ago |

Flags: needinfo?(alverb)

|  | [Al](/user_profile?user_id=739236) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1860977#c39)• 11 months ago |
|  | |

I've tested the last 64bit test build (115.8.1 20240225182930I) again on Windows 10 x64 and Ubuntu 22.04.4 LTS Jammy.

With this build the above mentioned errors are hardly reproduceable and occur accidentally.

I've received similar errors just two times:

---

15:49:20.704 TypeError: currentHeaderData.subject is undefined

setSubject chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:760

modifyMessageHeaders chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:1084

processDecryptionResult chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:1042

displayStatus chrome://openpgp/content/modules/mimeDecrypt.jsm:668

onStopRequest chrome://openpgp/content/modules/mimeDecrypt.jsm:595

mimeDecrypt.jsm:700:15

15:49:20.704 mimeDecrypt.jsm: caught exception: TypeError

Message: 'currentHeaderData.subject is undefined'

File: chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js

Line: 760

Stack: setSubject@chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:760:7

modifyMessageHeaders@chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:1084:26

processDecryptionResult@chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js:1042:16

displayStatus@chrome://openpgp/content/modules/mimeDecrypt.jsm:668:20

onStopRequest@chrome://openpgp/content/modules/mimeDecrypt.jsm:595:12

---

Sometimes when I open a big message with encrypted Subject stored in folder within "Local Folders", the following error is shown in Error Console:

---

15:39:29.244 rnp\_op\_verify\_execute returned unexpected: 268435456 RNP.jsm:1845:17

---

All above behavior occurs accidentally only when I'm rapidly switching, opening etc. So I believe that's because some JS are not fully loaded.

Flags: needinfo?(alverb)

|  | [betterbird.project+15@gmail.com](/user_profile?user_id=743539) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1860977#c40)• 11 months ago |
|  | |

Regarding this error: `15:49:20.704 TypeError: currentHeaderData.subject is undefined`.

We've wondered why this line got added here:

<https://hg.mozilla.org/comm-central/rev/14a2afecab58#l3.57>

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1860977#c41)• 11 months ago |
|  | |

Al, thanks for testing.

Can you please clarify: Despite the errors on the console, is this bug here correctly fixed in your testing?

Flags: needinfo?(alverb)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1860977#c42)• 11 months ago |
|  | |

Attached file
[Bug 1860977 - Don't try to modify missing subject header attribute. r=mkmelin](attachment.cgi?id=9387286) (obsolete)
— [Details](attachment.cgi?id=9387286&action=edit)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1860977#c43)• 11 months ago |
|  | |

Magnus, it might be useful to add the protective change from D202809, to prevent the exception.

I see other places that also check for specific headers being present in currentHeaderData, for example, search for "in currentHeaderData" in mail/base/content/msgHdrView.js

Flags: needinfo?(mkmelin+mozilla)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1860977#c44)• 11 months ago |
|  | |

If D202809 gets r+ from Magnus, I'll merge that little change into the backport-115 revision D202672.

|  | [Al](/user_profile?user_id=739236) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1860977#c45)• 11 months ago |
|  | |

(In reply to Kai Engert (:KaiE:) from [comment #41](/show_bug.cgi?id=1860977#c41 "RESOLVED FIXED - PGP encryption can change subject of E-Mail if selecting other mail A while large mail B is decrypting"))

> Al, thanks for testing.
>
> Can you please clarify: Despite the errors on the console, is this bug here correctly fixed in your testing?

Yes, I think the bug is fixed.

Till now I didn't found any issues or side effects.

You and the other developers can confirm for sure if the coding is OK. :)

Thank you!

Flags: needinfo?(alverb)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a10814489_600971)• 11 months ago |

[Attachment #9387286](/attachment.cgi?id=9387286&action=edit "Bug 1860977 - Don't try to modify missing subject header attribute. r=mkmelin") -
Attachment is obsolete: true

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1860977#c46)• 11 months ago |
|  | |

(In reply to Al from [comment #45](/show_bug.cgi?id=1860977#c45 "RESOLVED FIXED - PGP encryption can change subject of E-Mail if selecting other mail A while large mail B is decrypting"))

> Yes, I think the bug is fixed.
>
> Till now I didn't found any issues or side effects.

Thank you!

> You and the other developers can confirm for sure if the coding is OK. :)

I wish life was that simple.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1860977#c47)• 11 months ago |
|  | |

(In reply to Kai Engert (:KaiE:) from [comment #44](/show_bug.cgi?id=1860977#c44 "RESOLVED FIXED - PGP encryption can change subject of E-Mail if selecting other mail A while large mail B is decrypting"))

> If D202809 gets r+ from Magnus, I'll merge that little change into the backport-115 revision D202672.

Magnus accepted the change for 115, I've updated the backport revision in phabricator, and I think we're ready to land on 115.

Flags: needinfo?(mkmelin+mozilla)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1860977#c48)• 11 months ago |
|  | |

Comment on [attachment 9382500](/attachment.cgi?id=9382500 "Bug 1860977 - Don't set the subject on the wrong message, backport to 115.x. r=mkmelin") [[details]](/attachment.cgi?id=9382500&action=edit "Bug 1860977 - Don't set the subject on the wrong message, backport to 115.x. r=mkmelin")

[Bug 1860977](/show_bug.cgi?id=1860977 "RESOLVED FIXED - PGP encryption can change subject of E-Mail if selecting other mail A while large mail B is decrypting") - Don't set the subject on the wrong message, backport to 115.x. r=mkmelin

[Approval Request Comment]

Regression caused by (bug #): 1803255

User impact if declined: wrong functional behavior, false information shown, inconsistent database contents

Testing completed (on c-c, etc.): yes, by volunteers - c-c uses a slightly different patch

Risk to taking this patch (and alternatives if risky): low, because we add more checks, and try to avoid false actions

[Attachment #9382500](/attachment.cgi?id=9382500&action=edit "Bug 1860977 - Don't set the subject on the wrong message, backport to 115.x. r=mkmelin") -
Flags: approval-comm-esr115?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1860977#c49)• 11 months ago |
|  | |

Tom, could you please assign a CVE ID ?

Flags: needinfo?(tom)Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1860977#c50)• 11 months ago |
|  | |

Suggested advisory text:

```
CVE-2024-NNNN:
    title: Leaking of encrypted email subjects to other conversations
    impact: high
    reporter: Several reporters
    description: |
      The encrypted subject of an email message could be incorrectly
and permanently assigned to an arbitrary other email message in
Thunderbird's local cache. Consequently, when replying to the
contaminated email message, the user might accidentally leak the
confidential subject to a third party. While this update fixes the bug
and avoids future message contamination, it does not automatically
repair existing contaminations. Users are advised to use the repair
folder functionality, which is available from the context menu of email
folders, which will erase incorrect subject assignments.
    bugs:
      - url: 1860977

```

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a10816474_36541)• 11 months ago |

Whiteboard: [see comment 31, 32] → [see comment 32, 38]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a10822098_578488)• 11 months ago |

Alias: CVE-2024-1936Flags: needinfo?(tom)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1860977#c51)• 11 months ago |
|  | |

Comment on [attachment 9382500](/attachment.cgi?id=9382500 "Bug 1860977 - Don't set the subject on the wrong message, backport to 115.x. r=mkmelin") [[details]](/attachment.cgi?id=9382500&action=edit "Bug 1860977 - Don't set the subject on the wrong message, backport to 115.x. r=mkmelin")

[Bug 1860977](/show_bug.cgi?id=1860977 "RESOLVED FIXED - PGP encryption can change subject of E-Mail if selecting other mail A while large mail B is decrypting") - Don't set the subject on the wrong message, backport to 115.x. r=mkmelin

[Triage Comment]

Approved for esr115

[Attachment #9382500](/attachment.cgi?id=9382500&action=edit "Bug 1860977 - Don't set the subject on the wrong message, backport to 115.x. r=mkmelin") -
Flags: approval-comm-esr115? → approval-comm-esr115+

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1860977#c52)• 11 months ago |
|  | |

I'm closing this again. Please file a new bug report, if see any related issues, and add a reference to this bug in the new bug.

Status: REOPENED → RESOLVEDClosed: 11 months ago → 11 months agoResolution: --- → FIXED

|  | [Daniel Darnell [:dandarnell]](/user_profile?user_id=709542) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1860977#c53)• 11 months ago |
| bugherder uplift | |

Thunderbird 115.8.1:

<https://hg.mozilla.org/releases/comm-esr115/rev/1f10323255a0>

[status-thunderbird\_esr115](/buglist.cgi?f1=cf_status_thunderbird_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_thunderbird_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_thunderbird_esr115&o1=equals&v1=fixed)

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1860977#a15670308_101158)• 9 months ago |

See Also: → [1892876](/show_bug.cgi?id=1892876 "UNCONFIRMED - Attachments are shown in wrong email if selecting other email A while large email B is decrypting")
You need to [log in](/show_bug.cgi?id=1860977&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [2paso2](/user_profile?user_id=737136)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

