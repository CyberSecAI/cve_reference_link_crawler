

[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Private job artifacts can be accessed by any user

âš  **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #2456845](https://hackerone.com/reports/2456845)** by `js_noob` on 2024-04-09, assigned to `GitLab Team`:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Hello team, a user in a project can set the artifacts of a job to be private so they're not accessible by any unauthorized user, from the [docs](https://docs.gitlab.com/ee/ci/yaml/index.html#artifactspublic):

> To deny read access to artifacts in public pipelines for anonymous, guest, and reporter users, set `artifacts:public` to `false`

This is working as expected in the UI and the API, however, anonymous unauthorized users can still access those private artifacts using the `needs` keyword, in another pipeline.

**NB:** The following POC just shows a simple example of a static value, however, artifacts especially the `env` one usually contain confidential variables/info.

##### Steps to reproduce

**As the victim:**

1. Create a new group and apply the ultimate trial to it
2. Create a public project in that group
3. Create a `.gitlab-ci.yml` file in that project, this job creates an ENV artifact, that's private and isn't accessible by unauthorized

```
build_vars:
  stage: build
  script:
    - echo "BUILD_VERSION=hello" >> build.env
  artifacts:
    reports:
      dotenv: build.env
    public: false
```

4. When the pipeline finishes, verify the creation of a new artifact

[![Screenshot_2024-04-10_at_12.38.24_AM.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/d486810a8c1c0e95a88cb2298f35040032beabee/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f31623733663764612d343861382d346134352d616566612d6337333463336432346132342f53637265656e73686f745f323032342d30342d31305f61745f31322e33382e32345f414d2e706e67)

**As the attacker:**

5. Navigate to that project's artifacts page and verify that you can't download the `.env` artifact
6. Create a new group, and apply the ultimate trial to it
7. Create a project in that group, with the following `.gitlab-ci.yml` file

```
my_job:
  script:
    - echo "$BUILD_VERSION"
  needs:
    - project: VICTIM/PROJECT
      job: build_vars
      ref: main
      artifacts: true
```

8. Notice the triggered pipeline, it should contain the value of the `BUILD_VERSION` variable that's saved in a private artifact

##### Example

[Screen\_Recording\_2024-04-10\_at\_12.48.55\_AM.mov](https://user-content.gitlab-static.net/1df7e18707096ab3bda4aa139621adc4d7aaa958/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f64623139663733312d313235632d343834322d383939632d3863633230373762386439612f53637265656e5f5265636f7264696e675f323032342d30342d31305f61745f31322e34382e35355f414d2e6d6f76 "Download 'Screen_Recording_2024-04-10_at_12.48.55_AM.mov'")

##### What is the current bug behavior?

Private artifacts are accessible using the `needs` keyword.

##### What is the expected correct behavior?

Private artifacts shouldn't be accessible using the `needs` keyword.

##### Output of checks

This bug happens on GitLab.com

#### Impact

Disclosure of private job artifacts to unauthorized users.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [Screenshot\_2024-04-10\_at\_12.38.24\_AM.png](https://h1.sec.gitlab.net/a/1b73f7da-48a8-4a45-aefa-c734c3d24a24/Screenshot_2024-04-10_at_12.38.24_AM.png)
* [Screen\_Recording\_2024-04-10\_at\_12.48.55\_AM.mov](https://h1.sec.gitlab.net/a/db19f731-125c-4842-899c-8cc2077b8d9a/Screen_Recording_2024-04-10_at_12.48.55_AM.mov)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.

