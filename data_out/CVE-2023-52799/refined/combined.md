=== Content from git.kernel.org_b11aa36d_20250111_095229.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=88b7894a8f8705bf4e7ea90b10229376abf14514)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=88b7894a8f8705bf4e7ea90b10229376abf14514)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=88b7894a8f8705bf4e7ea90b10229376abf14514)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=88b7894a8f8705bf4e7ea90b10229376abf14514)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Manas Ghandat <ghandatmanas@gmail.com> | 2023-10-04 11:17:18 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-28 17:14:47 +0000 |
| commit | [88b7894a8f8705bf4e7ea90b10229376abf14514](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=88b7894a8f8705bf4e7ea90b10229376abf14514) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=88b7894a8f8705bf4e7ea90b10229376abf14514)) | |
| tree | [b16ace6b757506ece715c83252f7801c9b8368b7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=88b7894a8f8705bf4e7ea90b10229376abf14514) | |
| parent | [dca403bb035a565bb98ecc1dda5d30f676feda40](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dca403bb035a565bb98ecc1dda5d30f676feda40) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=88b7894a8f8705bf4e7ea90b10229376abf14514&id2=dca403bb035a565bb98ecc1dda5d30f676feda40)) | |
| download | [linux-88b7894a8f8705bf4e7ea90b10229376abf14514.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-88b7894a8f8705bf4e7ea90b10229376abf14514.tar.gz) | |

jfs: fix array-index-out-of-bounds in dbFindLeaf[ Upstream commit 22cad8bc1d36547cdae0eef316c47d917ce3147c ]
Currently while searching for dmtree\_t for sufficient free blocks there
is an array out of bounds while getting element in tp->dm\_stree. To add
the required check for out of bound we first need to determine the type
of dmtree. Thus added an extra parameter to dbFindLeaf so that the type
of tree can be determined and the required check can be applied.
Reported-by: syzbot+aea1ad91e854d0a83e04@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=aea1ad91e854d0a83e04
Signed-off-by: Manas Ghandat <ghandatmanas@gmail.com>
Signed-off-by: Dave Kleikamp <dave.kleikamp@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=88b7894a8f8705bf4e7ea90b10229376abf14514)

| -rw-r--r-- | [fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/jfs/jfs_dmap.c?id=88b7894a8f8705bf4e7ea90b10229376abf14514) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/jfs/jfs\_dmap.c b/fs/jfs/jfs\_dmap.cindex 4d59373f9e6c99..11c77757ead9e0 100644--- a/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=dca403bb035a565bb98ecc1dda5d30f676feda40)+++ b/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=88b7894a8f8705bf4e7ea90b10229376abf14514)@@ -87,7 +87,7 @@ static int dbAllocCtl(struct bmap \* bmp, s64 nblocks, int l2nb, s64 blkno, static int dbExtend(struct inode \*ip, s64 blkno, s64 nblocks, s64 addnblocks); static int dbFindBits(u32 word, int l2nb); static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno);-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx);+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl); static int dbFreeBits(struct bmap \* bmp, struct dmap \* dp, s64 blkno, int nblocks); static int dbFreeDmap(struct bmap \* bmp, struct dmap \* dp, s64 blkno,@@ -1717,7 +1717,7 @@ static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno) \* dbFindLeaf() returns the index of the leaf at which \* free space was found. \*/- rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx);+ rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx, true);  /\* release the buffer. \*/@@ -1964,7 +1964,7 @@ dbAllocDmapLev(struct bmap \* bmp, \* free space. if sufficient free space is found, dbFindLeaf() \* returns the index of the leaf at which free space was found. \*/- if (dbFindLeaf((dmtree\_t \*) & dp->tree, l2nb, &leafidx))+ if (dbFindLeaf((dmtree\_t \*) &dp->tree, l2nb, &leafidx, false)) return -ENOSPC;  if (leafidx < 0)@@ -2928,14 +2928,18 @@ static void dbAdjTree(dmtree\_t \* tp, int leafno, int newval) \* leafidx - return pointer to be set to the index of the leaf \* describing at least l2nb free blocks if sufficient \* free blocks are found.+ \* is\_ctl - determines if the tree is of type ctl \* \* RETURN VALUES: \* 0 - success \* -ENOSPC - insufficient free blocks. \*/-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx)+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl) { int ti, n = 0, k, x = 0;+ int max\_size;++ max\_size = is\_ctl ? CTLTREESIZE : TREESIZE;  /\* first check the root of the tree to see if there is \* sufficient free space.@@ -2956,6 +2960,8 @@ static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx) /\* sufficient free space found. move to the next \* level (or quit if this is the last level). \*/+ if (x + n > max\_size)+ return -ENOSPC; if (l2nb <= tp->dmt\_stree[x + n]) break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:51:07 +0000



=== Content from git.kernel.org_bfec32af_20250111_095231.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Manas Ghandat <ghandatmanas@gmail.com> | 2023-10-04 11:17:18 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-28 16:56:18 +0000 |
| commit | [da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9)) | |
| tree | [d8574020ac5d8e66c5932b59d732806855d3bc72](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9) | |
| parent | [1f74d336990f37703a8eee77153463d65b67f70e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1f74d336990f37703a8eee77153463d65b67f70e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9&id2=1f74d336990f37703a8eee77153463d65b67f70e)) | |
| download | [linux-da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9.tar.gz) | |

jfs: fix array-index-out-of-bounds in dbFindLeaf[ Upstream commit 22cad8bc1d36547cdae0eef316c47d917ce3147c ]
Currently while searching for dmtree\_t for sufficient free blocks there
is an array out of bounds while getting element in tp->dm\_stree. To add
the required check for out of bound we first need to determine the type
of dmtree. Thus added an extra parameter to dbFindLeaf so that the type
of tree can be determined and the required check can be applied.
Reported-by: syzbot+aea1ad91e854d0a83e04@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=aea1ad91e854d0a83e04
Signed-off-by: Manas Ghandat <ghandatmanas@gmail.com>
Signed-off-by: Dave Kleikamp <dave.kleikamp@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9)

| -rw-r--r-- | [fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/jfs/jfs_dmap.c?id=da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/jfs/jfs\_dmap.c b/fs/jfs/jfs\_dmap.cindex 217a673b751eff..5b01026fff9bf7 100644--- a/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=1f74d336990f37703a8eee77153463d65b67f70e)+++ b/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=da3da5e1e6f71c21d8e6149d7076d936ef5d4cb9)@@ -87,7 +87,7 @@ static int dbAllocCtl(struct bmap \* bmp, s64 nblocks, int l2nb, s64 blkno, static int dbExtend(struct inode \*ip, s64 blkno, s64 nblocks, s64 addnblocks); static int dbFindBits(u32 word, int l2nb); static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno);-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx);+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl); static int dbFreeBits(struct bmap \* bmp, struct dmap \* dp, s64 blkno, int nblocks); static int dbFreeDmap(struct bmap \* bmp, struct dmap \* dp, s64 blkno,@@ -1785,7 +1785,7 @@ static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno) \* dbFindLeaf() returns the index of the leaf at which \* free space was found. \*/- rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx);+ rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx, true);  /\* release the buffer. \*/@@ -2032,7 +2032,7 @@ dbAllocDmapLev(struct bmap \* bmp, \* free space. if sufficient free space is found, dbFindLeaf() \* returns the index of the leaf at which free space was found. \*/- if (dbFindLeaf((dmtree\_t \*) & dp->tree, l2nb, &leafidx))+ if (dbFindLeaf((dmtree\_t \*) &dp->tree, l2nb, &leafidx, false)) return -ENOSPC;  if (leafidx < 0)@@ -2996,14 +2996,18 @@ static void dbAdjTree(dmtree\_t \* tp, int leafno, int newval) \* leafidx - return pointer to be set to the index of the leaf \* describing at least l2nb free blocks if sufficient \* free blocks are found.+ \* is\_ctl - determines if the tree is of type ctl \* \* RETURN VALUES: \* 0 - success \* -ENOSPC - insufficient free blocks. \*/-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx)+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl) { int ti, n = 0, k, x = 0;+ int max\_size;++ max\_size = is\_ctl ? CTLTREESIZE : TREESIZE;  /\* first check the root of the tree to see if there is \* sufficient free space.@@ -3024,6 +3028,8 @@ static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx) /\* sufficient free space found. move to the next \* level (or quit if this is the last level). \*/+ if (x + n > max\_size)+ return -ENOSPC; if (l2nb <= tp->dmt\_stree[x + n]) break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:51:08 +0000



=== Content from git.kernel.org_58560367_20250111_095225.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=20f9310a18e3e99fc031e036fcbed67105ae1859)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=20f9310a18e3e99fc031e036fcbed67105ae1859)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=20f9310a18e3e99fc031e036fcbed67105ae1859)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=20f9310a18e3e99fc031e036fcbed67105ae1859)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Manas Ghandat <ghandatmanas@gmail.com> | 2023-10-04 11:17:18 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-28 16:45:43 +0000 |
| commit | [20f9310a18e3e99fc031e036fcbed67105ae1859](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=20f9310a18e3e99fc031e036fcbed67105ae1859) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=20f9310a18e3e99fc031e036fcbed67105ae1859)) | |
| tree | [fd4d6b4e085cd3a8391eb72c0cf3583b59266ea8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=20f9310a18e3e99fc031e036fcbed67105ae1859) | |
| parent | [a0649e2dd4a3595b5595a29d0064d047c2fae2fb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a0649e2dd4a3595b5595a29d0064d047c2fae2fb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=20f9310a18e3e99fc031e036fcbed67105ae1859&id2=a0649e2dd4a3595b5595a29d0064d047c2fae2fb)) | |
| download | [linux-20f9310a18e3e99fc031e036fcbed67105ae1859.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-20f9310a18e3e99fc031e036fcbed67105ae1859.tar.gz) | |

jfs: fix array-index-out-of-bounds in dbFindLeaf[ Upstream commit 22cad8bc1d36547cdae0eef316c47d917ce3147c ]
Currently while searching for dmtree\_t for sufficient free blocks there
is an array out of bounds while getting element in tp->dm\_stree. To add
the required check for out of bound we first need to determine the type
of dmtree. Thus added an extra parameter to dbFindLeaf so that the type
of tree can be determined and the required check can be applied.
Reported-by: syzbot+aea1ad91e854d0a83e04@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=aea1ad91e854d0a83e04
Signed-off-by: Manas Ghandat <ghandatmanas@gmail.com>
Signed-off-by: Dave Kleikamp <dave.kleikamp@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=20f9310a18e3e99fc031e036fcbed67105ae1859)

| -rw-r--r-- | [fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/jfs/jfs_dmap.c?id=20f9310a18e3e99fc031e036fcbed67105ae1859) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/jfs/jfs\_dmap.c b/fs/jfs/jfs\_dmap.cindex 713f11dee52aa5..ed7989d7b2ba43 100644--- a/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=a0649e2dd4a3595b5595a29d0064d047c2fae2fb)+++ b/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=20f9310a18e3e99fc031e036fcbed67105ae1859)@@ -100,7 +100,7 @@ static int dbAllocCtl(struct bmap \* bmp, s64 nblocks, int l2nb, s64 blkno, static int dbExtend(struct inode \*ip, s64 blkno, s64 nblocks, s64 addnblocks); static int dbFindBits(u32 word, int l2nb); static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno);-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx);+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl); static int dbFreeBits(struct bmap \* bmp, struct dmap \* dp, s64 blkno, int nblocks); static int dbFreeDmap(struct bmap \* bmp, struct dmap \* dp, s64 blkno,@@ -1798,7 +1798,7 @@ static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno) \* dbFindLeaf() returns the index of the leaf at which \* free space was found. \*/- rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx);+ rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx, true);  /\* release the buffer. \*/@@ -2045,7 +2045,7 @@ dbAllocDmapLev(struct bmap \* bmp, \* free space. if sufficient free space is found, dbFindLeaf() \* returns the index of the leaf at which free space was found. \*/- if (dbFindLeaf((dmtree\_t \*) & dp->tree, l2nb, &leafidx))+ if (dbFindLeaf((dmtree\_t \*) &dp->tree, l2nb, &leafidx, false)) return -ENOSPC;  if (leafidx < 0)@@ -3005,14 +3005,18 @@ static void dbAdjTree(dmtree\_t \* tp, int leafno, int newval) \* leafidx - return pointer to be set to the index of the leaf \* describing at least l2nb free blocks if sufficient \* free blocks are found.+ \* is\_ctl - determines if the tree is of type ctl \* \* RETURN VALUES: \* 0 - success \* -ENOSPC - insufficient free blocks. \*/-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx)+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl) { int ti, n = 0, k, x = 0;+ int max\_size;++ max\_size = is\_ctl ? CTLTREESIZE : TREESIZE;  /\* first check the root of the tree to see if there is \* sufficient free space.@@ -3033,6 +3037,8 @@ static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx) /\* sufficient free space found. move to the next \* level (or quit if this is the last level). \*/+ if (x + n > max\_size)+ return -ENOSPC; if (l2nb <= tp->dmt\_stree[x + n]) break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:51:03 +0000



=== Content from git.kernel.org_9df11708_20250111_095230.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a50b796d36719757526ee094c703378895ab5e67)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a50b796d36719757526ee094c703378895ab5e67)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a50b796d36719757526ee094c703378895ab5e67)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a50b796d36719757526ee094c703378895ab5e67)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Manas Ghandat <ghandatmanas@gmail.com> | 2023-10-04 11:17:18 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-28 17:06:59 +0000 |
| commit | [a50b796d36719757526ee094c703378895ab5e67](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a50b796d36719757526ee094c703378895ab5e67) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a50b796d36719757526ee094c703378895ab5e67)) | |
| tree | [7f1724ecd51e7c4dce0b93eacd255337f6381bd4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a50b796d36719757526ee094c703378895ab5e67) | |
| parent | [5013f8269887642cca784adc8db9b5f0b771533f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5013f8269887642cca784adc8db9b5f0b771533f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a50b796d36719757526ee094c703378895ab5e67&id2=5013f8269887642cca784adc8db9b5f0b771533f)) | |
| download | [linux-a50b796d36719757526ee094c703378895ab5e67.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a50b796d36719757526ee094c703378895ab5e67.tar.gz) | |

jfs: fix array-index-out-of-bounds in dbFindLeaf[ Upstream commit 22cad8bc1d36547cdae0eef316c47d917ce3147c ]
Currently while searching for dmtree\_t for sufficient free blocks there
is an array out of bounds while getting element in tp->dm\_stree. To add
the required check for out of bound we first need to determine the type
of dmtree. Thus added an extra parameter to dbFindLeaf so that the type
of tree can be determined and the required check can be applied.
Reported-by: syzbot+aea1ad91e854d0a83e04@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=aea1ad91e854d0a83e04
Signed-off-by: Manas Ghandat <ghandatmanas@gmail.com>
Signed-off-by: Dave Kleikamp <dave.kleikamp@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a50b796d36719757526ee094c703378895ab5e67)

| -rw-r--r-- | [fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/jfs/jfs_dmap.c?id=a50b796d36719757526ee094c703378895ab5e67) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/jfs/jfs\_dmap.c b/fs/jfs/jfs\_dmap.cindex e2927d1f3d1d34..4d56f6081a5d25 100644--- a/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=5013f8269887642cca784adc8db9b5f0b771533f)+++ b/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=a50b796d36719757526ee094c703378895ab5e67)@@ -87,7 +87,7 @@ static int dbAllocCtl(struct bmap \* bmp, s64 nblocks, int l2nb, s64 blkno, static int dbExtend(struct inode \*ip, s64 blkno, s64 nblocks, s64 addnblocks); static int dbFindBits(u32 word, int l2nb); static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno);-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx);+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl); static int dbFreeBits(struct bmap \* bmp, struct dmap \* dp, s64 blkno, int nblocks); static int dbFreeDmap(struct bmap \* bmp, struct dmap \* dp, s64 blkno,@@ -1717,7 +1717,7 @@ static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno) \* dbFindLeaf() returns the index of the leaf at which \* free space was found. \*/- rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx);+ rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx, true);  /\* release the buffer. \*/@@ -1964,7 +1964,7 @@ dbAllocDmapLev(struct bmap \* bmp, \* free space. if sufficient free space is found, dbFindLeaf() \* returns the index of the leaf at which free space was found. \*/- if (dbFindLeaf((dmtree\_t \*) & dp->tree, l2nb, &leafidx))+ if (dbFindLeaf((dmtree\_t \*) &dp->tree, l2nb, &leafidx, false)) return -ENOSPC;  if (leafidx < 0)@@ -2928,14 +2928,18 @@ static void dbAdjTree(dmtree\_t \* tp, int leafno, int newval) \* leafidx - return pointer to be set to the index of the leaf \* describing at least l2nb free blocks if sufficient \* free blocks are found.+ \* is\_ctl - determines if the tree is of type ctl \* \* RETURN VALUES: \* 0 - success \* -ENOSPC - insufficient free blocks. \*/-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx)+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl) { int ti, n = 0, k, x = 0;+ int max\_size;++ max\_size = is\_ctl ? CTLTREESIZE : TREESIZE;  /\* first check the root of the tree to see if there is \* sufficient free space.@@ -2956,6 +2960,8 @@ static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx) /\* sufficient free space found. move to the next \* level (or quit if this is the last level). \*/+ if (x + n > max\_size)+ return -ENOSPC; if (l2nb <= tp->dmt\_stree[x + n]) break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:51:07 +0000



=== Content from git.kernel.org_fc58e31f_20250111_095227.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=81aa58cd8495b8c3b527f58ccbe19478d8087f61)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=81aa58cd8495b8c3b527f58ccbe19478d8087f61)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=81aa58cd8495b8c3b527f58ccbe19478d8087f61)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=81aa58cd8495b8c3b527f58ccbe19478d8087f61)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Manas Ghandat <ghandatmanas@gmail.com> | 2023-10-04 11:17:18 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-28 16:54:51 +0000 |
| commit | [81aa58cd8495b8c3b527f58ccbe19478d8087f61](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=81aa58cd8495b8c3b527f58ccbe19478d8087f61) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=81aa58cd8495b8c3b527f58ccbe19478d8087f61)) | |
| tree | [204b4c965d12e32fe2c9d866c1c1de2e1fa9a0cc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=81aa58cd8495b8c3b527f58ccbe19478d8087f61) | |
| parent | [c6c8863fb3f57700ab583d875adda04caaf2278a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c6c8863fb3f57700ab583d875adda04caaf2278a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=81aa58cd8495b8c3b527f58ccbe19478d8087f61&id2=c6c8863fb3f57700ab583d875adda04caaf2278a)) | |
| download | [linux-81aa58cd8495b8c3b527f58ccbe19478d8087f61.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-81aa58cd8495b8c3b527f58ccbe19478d8087f61.tar.gz) | |

jfs: fix array-index-out-of-bounds in dbFindLeaf[ Upstream commit 22cad8bc1d36547cdae0eef316c47d917ce3147c ]
Currently while searching for dmtree\_t for sufficient free blocks there
is an array out of bounds while getting element in tp->dm\_stree. To add
the required check for out of bound we first need to determine the type
of dmtree. Thus added an extra parameter to dbFindLeaf so that the type
of tree can be determined and the required check can be applied.
Reported-by: syzbot+aea1ad91e854d0a83e04@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=aea1ad91e854d0a83e04
Signed-off-by: Manas Ghandat <ghandatmanas@gmail.com>
Signed-off-by: Dave Kleikamp <dave.kleikamp@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=81aa58cd8495b8c3b527f58ccbe19478d8087f61)

| -rw-r--r-- | [fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/jfs/jfs_dmap.c?id=81aa58cd8495b8c3b527f58ccbe19478d8087f61) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/jfs/jfs\_dmap.c b/fs/jfs/jfs\_dmap.cindex 2ccb52371ceb58..72eb5ed54c2aba 100644--- a/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=c6c8863fb3f57700ab583d875adda04caaf2278a)+++ b/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=81aa58cd8495b8c3b527f58ccbe19478d8087f61)@@ -87,7 +87,7 @@ static int dbAllocCtl(struct bmap \* bmp, s64 nblocks, int l2nb, s64 blkno, static int dbExtend(struct inode \*ip, s64 blkno, s64 nblocks, s64 addnblocks); static int dbFindBits(u32 word, int l2nb); static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno);-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx);+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl); static int dbFreeBits(struct bmap \* bmp, struct dmap \* dp, s64 blkno, int nblocks); static int dbFreeDmap(struct bmap \* bmp, struct dmap \* dp, s64 blkno,@@ -1785,7 +1785,7 @@ static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno) \* dbFindLeaf() returns the index of the leaf at which \* free space was found. \*/- rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx);+ rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx, true);  /\* release the buffer. \*/@@ -2032,7 +2032,7 @@ dbAllocDmapLev(struct bmap \* bmp, \* free space. if sufficient free space is found, dbFindLeaf() \* returns the index of the leaf at which free space was found. \*/- if (dbFindLeaf((dmtree\_t \*) & dp->tree, l2nb, &leafidx))+ if (dbFindLeaf((dmtree\_t \*) &dp->tree, l2nb, &leafidx, false)) return -ENOSPC;  if (leafidx < 0)@@ -2992,14 +2992,18 @@ static void dbAdjTree(dmtree\_t \* tp, int leafno, int newval) \* leafidx - return pointer to be set to the index of the leaf \* describing at least l2nb free blocks if sufficient \* free blocks are found.+ \* is\_ctl - determines if the tree is of type ctl \* \* RETURN VALUES: \* 0 - success \* -ENOSPC - insufficient free blocks. \*/-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx)+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl) { int ti, n = 0, k, x = 0;+ int max\_size;++ max\_size = is\_ctl ? CTLTREESIZE : TREESIZE;  /\* first check the root of the tree to see if there is \* sufficient free space.@@ -3020,6 +3024,8 @@ static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx) /\* sufficient free space found. move to the next \* level (or quit if this is the last level). \*/+ if (x + n > max\_size)+ return -ENOSPC; if (l2nb <= tp->dmt\_stree[x + n]) break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:51:04 +0000



=== Content from git.kernel.org_6f853313_20250111_095228.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=86df90f3fea7c5591f05c8a0010871d435e83046)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=86df90f3fea7c5591f05c8a0010871d435e83046)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=86df90f3fea7c5591f05c8a0010871d435e83046)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=86df90f3fea7c5591f05c8a0010871d435e83046)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Manas Ghandat <ghandatmanas@gmail.com> | 2023-10-04 11:17:18 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-28 16:46:32 +0000 |
| commit | [86df90f3fea7c5591f05c8a0010871d435e83046](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=86df90f3fea7c5591f05c8a0010871d435e83046) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=86df90f3fea7c5591f05c8a0010871d435e83046)) | |
| tree | [26e6bb0ab70cf474e798edadde74ab50007ddc75](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=86df90f3fea7c5591f05c8a0010871d435e83046) | |
| parent | [ce15b0f1a431168f07b1cc6c9f71206a2db5c809](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ce15b0f1a431168f07b1cc6c9f71206a2db5c809) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=86df90f3fea7c5591f05c8a0010871d435e83046&id2=ce15b0f1a431168f07b1cc6c9f71206a2db5c809)) | |
| download | [linux-86df90f3fea7c5591f05c8a0010871d435e83046.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-86df90f3fea7c5591f05c8a0010871d435e83046.tar.gz) | |

jfs: fix array-index-out-of-bounds in dbFindLeaf[ Upstream commit 22cad8bc1d36547cdae0eef316c47d917ce3147c ]
Currently while searching for dmtree\_t for sufficient free blocks there
is an array out of bounds while getting element in tp->dm\_stree. To add
the required check for out of bound we first need to determine the type
of dmtree. Thus added an extra parameter to dbFindLeaf so that the type
of tree can be determined and the required check can be applied.
Reported-by: syzbot+aea1ad91e854d0a83e04@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=aea1ad91e854d0a83e04
Signed-off-by: Manas Ghandat <ghandatmanas@gmail.com>
Signed-off-by: Dave Kleikamp <dave.kleikamp@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=86df90f3fea7c5591f05c8a0010871d435e83046)

| -rw-r--r-- | [fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/jfs/jfs_dmap.c?id=86df90f3fea7c5591f05c8a0010871d435e83046) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/jfs/jfs\_dmap.c b/fs/jfs/jfs\_dmap.cindex eb86d170f2246e..2f452b5ee73133 100644--- a/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=ce15b0f1a431168f07b1cc6c9f71206a2db5c809)+++ b/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=86df90f3fea7c5591f05c8a0010871d435e83046)@@ -100,7 +100,7 @@ static int dbAllocCtl(struct bmap \* bmp, s64 nblocks, int l2nb, s64 blkno, static int dbExtend(struct inode \*ip, s64 blkno, s64 nblocks, s64 addnblocks); static int dbFindBits(u32 word, int l2nb); static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno);-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx);+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl); static int dbFreeBits(struct bmap \* bmp, struct dmap \* dp, s64 blkno, int nblocks); static int dbFreeDmap(struct bmap \* bmp, struct dmap \* dp, s64 blkno,@@ -1798,7 +1798,7 @@ static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno) \* dbFindLeaf() returns the index of the leaf at which \* free space was found. \*/- rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx);+ rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx, true);  /\* release the buffer. \*/@@ -2045,7 +2045,7 @@ dbAllocDmapLev(struct bmap \* bmp, \* free space. if sufficient free space is found, dbFindLeaf() \* returns the index of the leaf at which free space was found. \*/- if (dbFindLeaf((dmtree\_t \*) & dp->tree, l2nb, &leafidx))+ if (dbFindLeaf((dmtree\_t \*) &dp->tree, l2nb, &leafidx, false)) return -ENOSPC;  if (leafidx < 0)@@ -3005,14 +3005,18 @@ static void dbAdjTree(dmtree\_t \* tp, int leafno, int newval) \* leafidx - return pointer to be set to the index of the leaf \* describing at least l2nb free blocks if sufficient \* free blocks are found.+ \* is\_ctl - determines if the tree is of type ctl \* \* RETURN VALUES: \* 0 - success \* -ENOSPC - insufficient free blocks. \*/-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx)+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl) { int ti, n = 0, k, x = 0;+ int max\_size;++ max\_size = is\_ctl ? CTLTREESIZE : TREESIZE;  /\* first check the root of the tree to see if there is \* sufficient free space.@@ -3033,6 +3037,8 @@ static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx) /\* sufficient free space found. move to the next \* level (or quit if this is the last level). \*/+ if (x + n > max\_size)+ return -ENOSPC; if (l2nb <= tp->dmt\_stree[x + n]) break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:51:05 +0000



=== Content from git.kernel.org_60b45451_20250111_095232.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ecfb47f13b08b02cf28b7b50d4941eefa21954d2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ecfb47f13b08b02cf28b7b50d4941eefa21954d2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ecfb47f13b08b02cf28b7b50d4941eefa21954d2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ecfb47f13b08b02cf28b7b50d4941eefa21954d2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Manas Ghandat <ghandatmanas@gmail.com> | 2023-10-04 11:17:18 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-28 16:50:15 +0000 |
| commit | [ecfb47f13b08b02cf28b7b50d4941eefa21954d2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ecfb47f13b08b02cf28b7b50d4941eefa21954d2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ecfb47f13b08b02cf28b7b50d4941eefa21954d2)) | |
| tree | [bbc4fb20850561dd41f834d9d804582b80bbdc99](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ecfb47f13b08b02cf28b7b50d4941eefa21954d2) | |
| parent | [32bd8f1cbcf8b663e29dd1f908ba3a129541a11b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=32bd8f1cbcf8b663e29dd1f908ba3a129541a11b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ecfb47f13b08b02cf28b7b50d4941eefa21954d2&id2=32bd8f1cbcf8b663e29dd1f908ba3a129541a11b)) | |
| download | [linux-ecfb47f13b08b02cf28b7b50d4941eefa21954d2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ecfb47f13b08b02cf28b7b50d4941eefa21954d2.tar.gz) | |

jfs: fix array-index-out-of-bounds in dbFindLeaf[ Upstream commit 22cad8bc1d36547cdae0eef316c47d917ce3147c ]
Currently while searching for dmtree\_t for sufficient free blocks there
is an array out of bounds while getting element in tp->dm\_stree. To add
the required check for out of bound we first need to determine the type
of dmtree. Thus added an extra parameter to dbFindLeaf so that the type
of tree can be determined and the required check can be applied.
Reported-by: syzbot+aea1ad91e854d0a83e04@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=aea1ad91e854d0a83e04
Signed-off-by: Manas Ghandat <ghandatmanas@gmail.com>
Signed-off-by: Dave Kleikamp <dave.kleikamp@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ecfb47f13b08b02cf28b7b50d4941eefa21954d2)

| -rw-r--r-- | [fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/jfs/jfs_dmap.c?id=ecfb47f13b08b02cf28b7b50d4941eefa21954d2) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/jfs/jfs\_dmap.c b/fs/jfs/jfs\_dmap.cindex b23b219b20aaba..ea330ce921b1a8 100644--- a/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=32bd8f1cbcf8b663e29dd1f908ba3a129541a11b)+++ b/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=ecfb47f13b08b02cf28b7b50d4941eefa21954d2)@@ -87,7 +87,7 @@ static int dbAllocCtl(struct bmap \* bmp, s64 nblocks, int l2nb, s64 blkno, static int dbExtend(struct inode \*ip, s64 blkno, s64 nblocks, s64 addnblocks); static int dbFindBits(u32 word, int l2nb); static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno);-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx);+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl); static int dbFreeBits(struct bmap \* bmp, struct dmap \* dp, s64 blkno, int nblocks); static int dbFreeDmap(struct bmap \* bmp, struct dmap \* dp, s64 blkno,@@ -1785,7 +1785,7 @@ static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno) \* dbFindLeaf() returns the index of the leaf at which \* free space was found. \*/- rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx);+ rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx, true);  /\* release the buffer. \*/@@ -2032,7 +2032,7 @@ dbAllocDmapLev(struct bmap \* bmp, \* free space. if sufficient free space is found, dbFindLeaf() \* returns the index of the leaf at which free space was found. \*/- if (dbFindLeaf((dmtree\_t \*) & dp->tree, l2nb, &leafidx))+ if (dbFindLeaf((dmtree\_t \*) &dp->tree, l2nb, &leafidx, false)) return -ENOSPC;  if (leafidx < 0)@@ -2992,14 +2992,18 @@ static void dbAdjTree(dmtree\_t \* tp, int leafno, int newval) \* leafidx - return pointer to be set to the index of the leaf \* describing at least l2nb free blocks if sufficient \* free blocks are found.+ \* is\_ctl - determines if the tree is of type ctl \* \* RETURN VALUES: \* 0 - success \* -ENOSPC - insufficient free blocks. \*/-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx)+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl) { int ti, n = 0, k, x = 0;+ int max\_size;++ max\_size = is\_ctl ? CTLTREESIZE : TREESIZE;  /\* first check the root of the tree to see if there is \* sufficient free space.@@ -3020,6 +3024,8 @@ static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx) /\* sufficient free space found. move to the next \* level (or quit if this is the last level). \*/+ if (x + n > max\_size)+ return -ENOSPC; if (l2nb <= tp->dmt\_stree[x + n]) break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:51:09 +0000



=== Content from git.kernel.org_a8a47a51_20250111_095228.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=87c681ab49e99039ff2dd3e71852417381b13878)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=87c681ab49e99039ff2dd3e71852417381b13878)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87c681ab49e99039ff2dd3e71852417381b13878)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87c681ab49e99039ff2dd3e71852417381b13878)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Manas Ghandat <ghandatmanas@gmail.com> | 2023-10-04 11:17:18 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-28 17:19:43 +0000 |
| commit | [87c681ab49e99039ff2dd3e71852417381b13878](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87c681ab49e99039ff2dd3e71852417381b13878) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=87c681ab49e99039ff2dd3e71852417381b13878)) | |
| tree | [e8b3cbd59735015729403696b97be90b042a5fba](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=87c681ab49e99039ff2dd3e71852417381b13878) | |
| parent | [2323de34a3ae61a9f9b544c18583f71cea86721f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2323de34a3ae61a9f9b544c18583f71cea86721f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87c681ab49e99039ff2dd3e71852417381b13878&id2=2323de34a3ae61a9f9b544c18583f71cea86721f)) | |
| download | [linux-87c681ab49e99039ff2dd3e71852417381b13878.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-87c681ab49e99039ff2dd3e71852417381b13878.tar.gz) | |

jfs: fix array-index-out-of-bounds in dbFindLeaf[ Upstream commit 22cad8bc1d36547cdae0eef316c47d917ce3147c ]
Currently while searching for dmtree\_t for sufficient free blocks there
is an array out of bounds while getting element in tp->dm\_stree. To add
the required check for out of bound we first need to determine the type
of dmtree. Thus added an extra parameter to dbFindLeaf so that the type
of tree can be determined and the required check can be applied.
Reported-by: syzbot+aea1ad91e854d0a83e04@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=aea1ad91e854d0a83e04
Signed-off-by: Manas Ghandat <ghandatmanas@gmail.com>
Signed-off-by: Dave Kleikamp <dave.kleikamp@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87c681ab49e99039ff2dd3e71852417381b13878)

| -rw-r--r-- | [fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/jfs/jfs_dmap.c?id=87c681ab49e99039ff2dd3e71852417381b13878) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/jfs/jfs\_dmap.c b/fs/jfs/jfs\_dmap.cindex 4d59373f9e6c99..11c77757ead9e0 100644--- a/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=2323de34a3ae61a9f9b544c18583f71cea86721f)+++ b/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=87c681ab49e99039ff2dd3e71852417381b13878)@@ -87,7 +87,7 @@ static int dbAllocCtl(struct bmap \* bmp, s64 nblocks, int l2nb, s64 blkno, static int dbExtend(struct inode \*ip, s64 blkno, s64 nblocks, s64 addnblocks); static int dbFindBits(u32 word, int l2nb); static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno);-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx);+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl); static int dbFreeBits(struct bmap \* bmp, struct dmap \* dp, s64 blkno, int nblocks); static int dbFreeDmap(struct bmap \* bmp, struct dmap \* dp, s64 blkno,@@ -1717,7 +1717,7 @@ static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno) \* dbFindLeaf() returns the index of the leaf at which \* free space was found. \*/- rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx);+ rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx, true);  /\* release the buffer. \*/@@ -1964,7 +1964,7 @@ dbAllocDmapLev(struct bmap \* bmp, \* free space. if sufficient free space is found, dbFindLeaf() \* returns the index of the leaf at which free space was found. \*/- if (dbFindLeaf((dmtree\_t \*) & dp->tree, l2nb, &leafidx))+ if (dbFindLeaf((dmtree\_t \*) &dp->tree, l2nb, &leafidx, false)) return -ENOSPC;  if (leafidx < 0)@@ -2928,14 +2928,18 @@ static void dbAdjTree(dmtree\_t \* tp, int leafno, int newval) \* leafidx - return pointer to be set to the index of the leaf \* describing at least l2nb free blocks if sufficient \* free blocks are found.+ \* is\_ctl - determines if the tree is of type ctl \* \* RETURN VALUES: \* 0 - success \* -ENOSPC - insufficient free blocks. \*/-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx)+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl) { int ti, n = 0, k, x = 0;+ int max\_size;++ max\_size = is\_ctl ? CTLTREESIZE : TREESIZE;  /\* first check the root of the tree to see if there is \* sufficient free space.@@ -2956,6 +2960,8 @@ static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx) /\* sufficient free space found. move to the next \* level (or quit if this is the last level). \*/+ if (x + n > max\_size)+ return -ENOSPC; if (l2nb <= tp->dmt\_stree[x + n]) break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:51:06 +0000



=== Content from git.kernel.org_6593e615_20250111_095226.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=22cad8bc1d36547cdae0eef316c47d917ce3147c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=22cad8bc1d36547cdae0eef316c47d917ce3147c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=22cad8bc1d36547cdae0eef316c47d917ce3147c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=22cad8bc1d36547cdae0eef316c47d917ce3147c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Manas Ghandat <ghandatmanas@gmail.com> | 2023-10-04 11:17:18 +0530 |
| --- | --- | --- |
| committer | Dave Kleikamp <dave.kleikamp@oracle.com> | 2023-10-04 09:17:53 -0500 |
| commit | [22cad8bc1d36547cdae0eef316c47d917ce3147c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=22cad8bc1d36547cdae0eef316c47d917ce3147c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=22cad8bc1d36547cdae0eef316c47d917ce3147c)) | |
| tree | [3624a19b65212722d99db6b3b701b85ed63aee0a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=22cad8bc1d36547cdae0eef316c47d917ce3147c) | |
| parent | [64933ab7b04881c6c18b21ff206c12278341c72e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=64933ab7b04881c6c18b21ff206c12278341c72e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=22cad8bc1d36547cdae0eef316c47d917ce3147c&id2=64933ab7b04881c6c18b21ff206c12278341c72e)) | |
| download | [linux-22cad8bc1d36547cdae0eef316c47d917ce3147c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-22cad8bc1d36547cdae0eef316c47d917ce3147c.tar.gz) | |

jfs: fix array-index-out-of-bounds in dbFindLeafCurrently while searching for dmtree\_t for sufficient free blocks there
is an array out of bounds while getting element in tp->dm\_stree. To add
the required check for out of bound we first need to determine the type
of dmtree. Thus added an extra parameter to dbFindLeaf so that the type
of tree can be determined and the required check can be applied.
Reported-by: syzbot+aea1ad91e854d0a83e04@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=aea1ad91e854d0a83e04
Signed-off-by: Manas Ghandat <ghandatmanas@gmail.com>
Signed-off-by: Dave Kleikamp <dave.kleikamp@oracle.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=22cad8bc1d36547cdae0eef316c47d917ce3147c)

| -rw-r--r-- | [fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/jfs/jfs_dmap.c?id=22cad8bc1d36547cdae0eef316c47d917ce3147c) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/jfs/jfs\_dmap.c b/fs/jfs/jfs\_dmap.cindex 4d59373f9e6c99..11c77757ead9e0 100644--- a/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=64933ab7b04881c6c18b21ff206c12278341c72e)+++ b/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=22cad8bc1d36547cdae0eef316c47d917ce3147c)@@ -87,7 +87,7 @@ static int dbAllocCtl(struct bmap \* bmp, s64 nblocks, int l2nb, s64 blkno, static int dbExtend(struct inode \*ip, s64 blkno, s64 nblocks, s64 addnblocks); static int dbFindBits(u32 word, int l2nb); static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno);-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx);+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl); static int dbFreeBits(struct bmap \* bmp, struct dmap \* dp, s64 blkno, int nblocks); static int dbFreeDmap(struct bmap \* bmp, struct dmap \* dp, s64 blkno,@@ -1717,7 +1717,7 @@ static int dbFindCtl(struct bmap \* bmp, int l2nb, int level, s64 \* blkno) \* dbFindLeaf() returns the index of the leaf at which \* free space was found. \*/- rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx);+ rc = dbFindLeaf((dmtree\_t \*) dcp, l2nb, &leafidx, true);  /\* release the buffer. \*/@@ -1964,7 +1964,7 @@ dbAllocDmapLev(struct bmap \* bmp, \* free space. if sufficient free space is found, dbFindLeaf() \* returns the index of the leaf at which free space was found. \*/- if (dbFindLeaf((dmtree\_t \*) & dp->tree, l2nb, &leafidx))+ if (dbFindLeaf((dmtree\_t \*) &dp->tree, l2nb, &leafidx, false)) return -ENOSPC;  if (leafidx < 0)@@ -2928,14 +2928,18 @@ static void dbAdjTree(dmtree\_t \* tp, int leafno, int newval) \* leafidx - return pointer to be set to the index of the leaf \* describing at least l2nb free blocks if sufficient \* free blocks are found.+ \* is\_ctl - determines if the tree is of type ctl \* \* RETURN VALUES: \* 0 - success \* -ENOSPC - insufficient free blocks. \*/-static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx)+static int dbFindLeaf(dmtree\_t \*tp, int l2nb, int \*leafidx, bool is\_ctl) { int ti, n = 0, k, x = 0;+ int max\_size;++ max\_size = is\_ctl ? CTLTREESIZE : TREESIZE;  /\* first check the root of the tree to see if there is \* sufficient free space.@@ -2956,6 +2960,8 @@ static int dbFindLeaf(dmtree\_t \* tp, int l2nb, int \*leafidx) /\* sufficient free space found. move to the next \* level (or quit if this is the last level). \*/+ if (x + n > max\_size)+ return -ENOSPC; if (l2nb <= tp->dmt\_stree[x + n]) break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:51:03 +0000


