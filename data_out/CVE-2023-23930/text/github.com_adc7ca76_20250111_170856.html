
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fcommit%2Fe62f03bacf2247bd59eed217e2e7338c3a01a5f0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fcommit%2Fe62f03bacf2247bd59eed217e2e7338c3a01a5f0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=vantage6%2Fvantage6)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vantage6](/vantage6)
/
**[vantage6](/vantage6/vantage6)**
Public

* [Notifications](/login?return_to=%2Fvantage6%2Fvantage6) You must be signed in to change notification settings
* [Fork
  11](/login?return_to=%2Fvantage6%2Fvantage6)
* [Star
   31](/login?return_to=%2Fvantage6%2Fvantage6)

* [Code](/vantage6/vantage6)
* [Issues
  239](/vantage6/vantage6/issues)
* [Pull requests
  9](/vantage6/vantage6/pulls)
* [Actions](/vantage6/vantage6/actions)
* [Projects
  2](/vantage6/vantage6/projects)
* [Security](/vantage6/vantage6/security)
* [Insights](/vantage6/vantage6/pulse)

Additional navigation options

* [Code](/vantage6/vantage6)
* [Issues](/vantage6/vantage6/issues)
* [Pull requests](/vantage6/vantage6/pulls)
* [Actions](/vantage6/vantage6/actions)
* [Projects](/vantage6/vantage6/projects)
* [Security](/vantage6/vantage6/security)
* [Insights](/vantage6/vantage6/pulse)

## Commit

[Permalink](/vantage6/vantage6/commit/e62f03bacf2247bd59eed217e2e7338c3a01a5f0)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-5m22-cfq9-86x6](https://github.com/advisories/GHSA-5m22-cfq9-86x6 "GHSA-5m22-cfq9-86x6")

[Browse files](/vantage6/vantage6/tree/e62f03bacf2247bd59eed217e2e7338c3a01a5f0)
Browse the repository at this point in the history

```
Removing pickle serialization/deserialization
```

* Loading branch information

[![@frankcorneliusmartin](https://avatars.githubusercontent.com/u/15981243?s=40&v=4)](/frankcorneliusmartin)

[frankcorneliusmartin](/vantage6/vantage6/commits?author=frankcorneliusmartin "View all commits by frankcorneliusmartin")
authored
Jun 12, 2023

2 parents
[e3b5306](/vantage6/vantage6/commit/e3b53066cc2937c76d2604453cecd38e964ebb0d)
+
[4f8da32](/vantage6/vantage6/commit/4f8da32a045dfcf7475427976eeb5af235aa7689)

commit e62f03b

 Show file tree

 Hide file tree

Showing
**15 changed files**
with
**91 additions**
and
**529 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* docs

  + algorithms

    - docs/algorithms/classic\_tutorial.rst
      [classic\_tutorial.rst](#diff-6c1e13bbd08ecd629c6a8449c1f3530fae5e9d77954223d09896df8122bb1380)
  + user

    - docs/user/pyclient.rst
      [pyclient.rst](#diff-2cc6733785bba57bd4ba380953f5c406fb941a14e5a21ba9c5cc484a99721c0c)
* vantage6-client

  + tests

    - vantage6-client/tests/test\_client.py
      [test\_client.py](#diff-53129fe793c761a38d830a22719991464bab167acbb4d0ba11b46045afdd0c61)
    - vantage6-client/tests/test\_deserialization.py
      [test\_deserialization.py](#diff-eda475b2f64f16ffde29c746e7c950c312156007b4594cf808e8dce322ccad2f)
    - vantage6-client/tests/test\_docker\_wrapper.py
      [test\_docker\_wrapper.py](#diff-f08c8156b7eac3e98e871cdd2545c4eaffbcf56a94e69cce31c4ae550a5821bb)
    - vantage6-client/tests/test\_serialization.py
      [test\_serialization.py](#diff-54240c687f6bf442881223eb39dd2c339bc24ed0e052f5a391edef8ec0d25109)
  + vantage6

    - client

      * vantage6-client/vantage6/client/\_\_init\_\_.py
        [\_\_init\_\_.py](#diff-69a6539ff08614cba317f57bddb5f0ff560da1a9adb1e9f9d5cf6ff698b34dda)
      * vantage6-client/vantage6/client/deserialization.py
        [deserialization.py](#diff-bb1f63c3468b120deb55686b292cf6e90cc8acbc687eb6c423693f031ee2cc44)
      * vantage6-client/vantage6/client/serialization.py
        [serialization.py](#diff-40c70ebfb02c3e1bd31026cf105521d31bd87196aa23aae179a9ab689c390e1a)
    - tools

      * vantage6-client/vantage6/tools/data\_format.py
        [data\_format.py](#diff-e92d1a55f403e4e520a7541594a3f919ff24a2d044a356cba509c32ab7dc15fb)
      * vantage6-client/vantage6/tools/deserialization.py
        [deserialization.py](#diff-d3619b462ffe66c9b524b5c9c5253ac7b8e25349771cbcc186c2181f796bc9a9)
      * vantage6-client/vantage6/tools/docker\_wrapper.py
        [docker\_wrapper.py](#diff-292297b5a446f996192e4f5803ce6fba24d02638b6792548cfebcec767ee684d)
      * vantage6-client/vantage6/tools/mock\_client.py
        [mock\_client.py](#diff-8b64cd5d9b88aec8a1ac68c4634df080880ccb00c13afebf904eacf0087491da)
      * vantage6-client/vantage6/tools/serialization.py
        [serialization.py](#diff-116f36cb35e509e2fd9869f953eba0aa426cc4118a7330e0515a35bcce599836)
* vantage6-node/vantage6/node/docker

  + vantage6-node/vantage6/node/docker/task\_manager.py
    [task\_manager.py](#diff-d3f31f74f29b10b1dd04d6a2f6b51a5f53880909b3e7e5ac8031194eb69613f2)

## There are no files selected for viewing

26 changes: 0 additions & 26 deletions

26
[docs/algorithms/classic\_tutorial.rst](#diff-6c1e13bbd08ecd629c6a8449c1f3530fae5e9d77954223d09896df8122bb1380 "docs/algorithms/classic_tutorial.rst")

Show comments

[View file](/vantage6/vantage6/blob/e62f03bacf2247bd59eed217e2e7338c3a01a5f0/docs/algorithms/classic_tutorial.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -519,29 +519,3 @@ address (harbor2.vantage6.ai) and the project name (demo). |
|  |  | .. note:: |
|  |  | Reach out to us on `Discord <https://discord.gg/yAyFf6Y>`\_\_ if you want to |
|  |  | use our registries (harbor.vantage6.ai and harbor2.vantage6.ai). |
|  |  |  |
|  |  | Cross-language serialization |
|  |  | ---------------------------- |
|  |  |  |
|  |  | It is possible that a vantage6 algorithm is developed in one programming |
|  |  | language, but you would like to run the task from another language. For |
|  |  | these use-cases, the Python algorithm wrapper and client support |
|  |  | cross-language serialization. By default, input to the algorithms and |
|  |  | output back to the client are serialized using pickle. However, it is |
|  |  | possible to define a different serialization format. |
|  |  |  |
|  |  | Input and output serialization can be specified as follows: |
|  |  |  |
|  |  | .. code:: python |
|  |  |  |
|  |  | client.post\_task( |
|  |  | name='mytask', |
|  |  | image='harbor2.vantage6.ai/testing/v6-test-py', |
|  |  | collaboration\_id=COLLABORATION\_ID, |
|  |  | organization\_ids=ORGANIZATION\_IDS, |
|  |  | data\_format='json', # Specify input format to the algorithm |
|  |  | input\_={ |
|  |  | 'method': 'column\_names', |
|  |  | 'kwargs': {'data\_format': 'json'}, # Specify output format |
|  |  | } |
|  |  | ) |

8 changes: 2 additions & 6 deletions

8
[docs/user/pyclient.rst](#diff-2cc6733785bba57bd4ba380953f5c406fb941a14e5a21ba9c5cc484a99721c0c "docs/user/pyclient.rst")

Show comments

[View file](/vantage6/vantage6/blob/e62f03bacf2247bd59eed217e2e7338c3a01a5f0/docs/user/pyclient.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -85,8 +85,6 @@ new user: |
|  |  | # Human readable description |
|  |  | # input : dict |
|  |  | # Algorithm input |
|  |  | # data\_format : str, optional |
|  |  | # IO data format used, by default LEGACY |
|  |  | # database: str, optional |
|  |  | # Name of the database to use. This should match the key |
|  |  | # in the node configuration files. If not specified the |
| Expand Down  Expand Up | | @@ -396,8 +394,7 @@ us create a task that runs the master algorithm of the |
|  |  | name="an-awesome-task", |
|  |  | image="harbor2.vantage6.ai/demo/average", |
|  |  | description='', |
|  |  | input=input\_, |
|  |  | data\_format='json') |
|  |  | input=input\_) |
|  |  |  |
|  |  | Note that the ``kwargs`` we specified in the ``input\_`` are specific to |
|  |  | this algorithm: this algorithm expects an argument ``column\_name`` to be |
| Expand Down  Expand Up | | @@ -431,8 +428,7 @@ master algorithm will normally do: |
|  |  | name="an-awesome-task", |
|  |  | image="harbor2.vantage6.ai/demo/average", |
|  |  | description='', |
|  |  | input=input\_, |
|  |  | data\_format='json') |
|  |  | input=input\_) |
|  |  |  |
|  |  | \*\*Inspecting the results\*\* |
|  |  |  |
| Expand Down | |  |

49 changes: 12 additions & 37 deletions

49
[vantage6-client/tests/test\_client.py](#diff-53129fe793c761a38d830a22719991464bab167acbb4d0ba11b46045afdd0c61 "vantage6-client/tests/test_client.py")

Show comments

[View file](/vantage6/vantage6/blob/e62f03bacf2247bd59eed217e2e7338c3a01a5f0/vantage6-client/tests/test_client.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,6 @@ |
|  |  | import base64 |
|  |  | import json |
|  |  | import pickle |
|  |  |  |
|  |  | from unittest import TestCase |
|  |  | from unittest.mock import patch, MagicMock |
|  |  |  |
| Expand All | | @@ -26,48 +26,20 @@ |
|  |  |  |
|  |  | class TestClient(TestCase): |
|  |  |  |
|  |  | def test\_post\_task\_legacy\_method(self): |
|  |  | post\_input = TestClient.post\_task\_on\_mock\_client(SAMPLE\_INPUT, 'legacy') |
|  |  | decoded\_input = base64.b64decode(post\_input) |
|  |  | decoded\_input = pickle.loads(decoded\_input) |
|  |  | assert {'method': 'test-task'} == decoded\_input |
|  |  |  |
|  |  | def test\_post\_json\_task(self): |
|  |  | post\_input = TestClient.post\_task\_on\_mock\_client(SAMPLE\_INPUT, 'json') |
|  |  | decoded\_input = base64.b64decode(post\_input) |
|  |  | assert b'json.{"method": "test-task"}' == decoded\_input |
|  |  |  |
|  |  | def test\_post\_pickle\_task(self): |
|  |  | post\_input = TestClient.post\_task\_on\_mock\_client(SAMPLE\_INPUT, 'pickle') |
|  |  | def test\_post\_task(self): |
|  |  | post\_input = TestClient.post\_task\_on\_mock\_client(SAMPLE\_INPUT) |
|  |  | decoded\_input = base64.b64decode(post\_input) |
|  |  | assert b'{"method": "test-task"}' == decoded\_input |
|  |  |  |
|  |  | assert b'pickle.' == decoded\_input[0:7] |
|  |  |  |
|  |  | assert {'method': 'test-task'} == pickle.loads(decoded\_input[7:]) |
|  |  |  |
|  |  | def test\_get\_legacy\_results(self): |
|  |  | mock\_result = pickle.dumps(1) |
|  |  |  |
|  |  | results = TestClient.\_receive\_results\_on\_mock\_client(mock\_result) |
|  |  |  |
|  |  | assert results == [{'result': 1}] |
|  |  |  |
|  |  | def test\_get\_json\_results(self): |
|  |  | mock\_result = b'json.' + json.dumps({'some\_key': 'some\_value'}).encode() |
|  |  | def test\_get\_results(self): |
|  |  | mock\_result = json.dumps({'some\_key': 'some\_value'}).encode() |
|  |  |  |
|  |  | results = TestClient.\_receive\_results\_on\_mock\_client(mock\_result) |
|  |  |  |
|  |  | assert results == [{'result': {'some\_key': 'some\_value'}}] |
|  |  |  |
|  |  | def test\_get\_pickle\_results(self): |
|  |  | mock\_result = b'pickle.' + pickle.dumps([1, 2, 3, 4, 5]) |
|  |  |  |
|  |  | results = TestClient.\_receive\_results\_on\_mock\_client(mock\_result) |
|  |  |  |
|  |  | assert results == [{'result': [1, 2, 3, 4, 5]}] |
|  |  |  |
|  |  | @staticmethod |
|  |  | def post\_task\_on\_mock\_client(input\_, serialization: str) -> dict[str, any]: |
|  |  | def post\_task\_on\_mock\_client(input\_) -> dict[str, any]: |
|  |  | mock\_requests = MagicMock() |
|  |  | mock\_requests.get.return\_value.status\_code = 200 |
|  |  | mock\_requests.post.return\_value.status\_code = 200 |
| Expand All | | @@ -76,8 +48,11 @@ def post\_task\_on\_mock\_client(input\_, serialization: str) -> dict[str, any]: |
|  |  | with patch.multiple('vantage6.client', requests=mock\_requests, jwt=mock\_jwt): |
|  |  | client = TestClient.setup\_client() |
|  |  |  |
|  |  | client.post\_task(name=TASK\_NAME, image=TASK\_IMAGE, collaboration\_id=COLLABORATION\_ID, |
|  |  | organization\_ids=ORGANIZATION\_IDS, input\_=input\_, data\_format=serialization) |
|  |  | client.post\_task( |
|  |  | name=TASK\_NAME, image=TASK\_IMAGE, |
|  |  | collaboration\_id=COLLABORATION\_ID, |
|  |  | organization\_ids=ORGANIZATION\_IDS, input\_=input\_ |
|  |  | ) |
|  |  |  |
|  |  | # In a request.post call, json is provided with the keyword argument 'json' |
|  |  | # call\_args provides a tuple with positional arguments followed by a dict with positional arguments |
| Expand Down | |  |

17 changes: 1 addition & 16 deletions

17
[vantage6-client/tests/test\_deserialization.py](#diff-eda475b2f64f16ffde29c746e7c950c312156007b4594cf808e8dce322ccad2f "vantage6-client/tests/test_deserialization.py")

Show comments

[View file](/vantage6/vantage6/blob/e62f03bacf2247bd59eed217e2e7338c3a01a5f0/vantage6-client/tests/test_deserialization.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,5 @@ |
|  |  | import pickle |
|  |  | from pathlib import Path |
|  |  | from vantage6.tools import deserialization |
|  |  | from vantage6.tools.data\_format import DataFormat |
|  |  |  |
|  |  | SIMPLE\_TARGET\_DATA = {'key': 'value'} |
|  |  |  |
| Expand All | | @@ -12,19 +10,6 @@ def test\_deserialize\_json(tmp\_path: Path): |
|  |  | json\_path.write\_text(data) |
|  |  |  |
|  |  | with json\_path.open('r') as f: |
|  |  | result = deserialization.deserialize(f, DataFormat.JSON) |
|  |  | result = deserialization.deserialize(f) |
|  |  |  |
|  |  | assert SIMPLE\_TARGET\_DATA == result |
|  |  |  |
|  |  |  |
|  |  | def test\_deserialize\_pickle(tmp\_path: Path): |
|  |  | data = {'key': 'value'} |
|  |  |  |
|  |  | pickle\_path = tmp\_path / 'picklefile.pkl' |
|  |  |  |
|  |  | with pickle\_path.open('wb') as f: |
|  |  | pickle.dump(data, f) |
|  |  |  |
|  |  | with pickle\_path.open('rb') as f: |
|  |  | result = deserialization.deserialize(f, DataFormat.PICKLE) |
|  |  | assert SIMPLE\_TARGET\_DATA == result |

119 changes: 29 additions & 90 deletions

119
[vantage6-client/tests/test\_docker\_wrapper.py](#diff-f08c8156b7eac3e98e871cdd2545c4eaffbcf56a94e69cce31c4ae550a5821bb "vantage6-client/tests/test_docker_wrapper.py")

Show comments

[View file](/vantage6/vantage6/blob/e62f03bacf2247bd59eed217e2e7338c3a01a5f0/vantage6-client/tests/test_docker_wrapper.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,13 +1,10 @@ |
|  |  | import json |
|  |  | import pickle |
|  |  | from pathlib import Path |
|  |  | from unittest.mock import patch, MagicMock |
|  |  |  |
|  |  | import pandas as pd |
|  |  | from pytest import raises |
|  |  |  |
|  |  | from vantage6.tools import wrapper |
|  |  | from vantage6.tools.exceptions import DeserializationException |
|  |  |  |
|  |  | MODULE\_NAME = 'algorithm\_module' |
|  |  | DATA = 'column1,column2\n1,2' |
| Expand All | | @@ -16,107 +13,49 @@ |
|  |  | JSON\_FORMAT = 'json' |
|  |  | SEPARATOR = '.' |
|  |  | SAMPLE\_DB = pd.DataFrame([[1, 2]], columns=['column1', 'column2']) |
|  |  | PICKLE\_FORMAT = 'pickle' |
|  |  |  |
|  |  | MOCK\_SPARQL\_ENDPOINT = 'sparql://some\_triplestore' |
|  |  |  |
|  |  |  |
|  |  | def test\_old\_pickle\_input\_wrapper(tmp\_path): |
|  |  | """ |
|  |  | Testing if wrapper still parses legacy input. |
|  |  | """ |
|  |  | input\_file = tmp\_path / 'input.pkl' |
|  |  |  |
|  |  | with input\_file.open('wb') as f: |
|  |  | pickle.dump(INPUT\_PARAMETERS, f) |
|  |  | # def test\_json\_input\_without\_format\_raises\_deserializationexception(tmp\_path): |
|  |  | # """ |
|  |  | # It should only be possible to provide json input if it is preceded by the |
|  |  | # string "json." in unicode. Otherwise a `DeserializationException` should |
|  |  | # be thrown. |
|  |  | # """ |
|  |  | # input\_file = tmp\_path / 'input.json' |
|  |  |  |
|  |  | output\_file = run\_docker\_wrapper\_with\_echo\_db(input\_file, tmp\_path) |
|  |  | assert file\_echoes\_db(output\_file) |
|  |  | #  with input\_file.open('wb') as f: |
|  |  | #  f.write(json.dumps(INPUT\_PARAMETERS).encode()) |
|  |  |  |
|  |  | # with raises(DeserializationException): |
|  |  | # run\_docker\_wrapper\_with\_echo\_db(input\_file, tmp\_path) |
|  |  |  |
|  |  | def test\_json\_input\_without\_format\_raises\_deserializationexception(tmp\_path): |
|  |  | """ |
|  |  | It should only be possible to provide json input if it is preceded by the |
|  |  | string "json." in unicode. Otherwise a `DeserializationException` should |
|  |  | be thrown. |
|  |  | """ |
|  |  | input\_file = tmp\_path / 'input.json' |
|  |  |  |
|  |  | with input\_file.open('wb') as f: |
|  |  | f.write(json.dumps(INPUT\_PARAMETERS).encode()) |
|  |  |  |
|  |  | with raises(DeserializationException): |
|  |  | run\_docker\_wrapper\_with\_echo\_db(input\_file, tmp\_path) |
|  |  |  |
|  |  |  |
|  |  | def test\_json\_input\_with\_format\_succeeds(tmp\_path): |
|  |  | input\_file = tmp\_path / 'input.txt' |
|  |  |  |
|  |  | with input\_file.open('wb') as f: |
|  |  | f.write(f'JSON{SEPARATOR}'.encode()) |
|  |  | f.write(json.dumps(INPUT\_PARAMETERS).encode()) |
|  |  |  |
|  |  | output\_file = run\_docker\_wrapper\_with\_echo\_db(input\_file, tmp\_path) |
|  |  | assert file\_echoes\_db(output\_file) |
|  |  | # def test\_json\_input\_with\_format\_succeeds(tmp\_path): |
|  |  | #  input\_file = tmp\_path / 'input.txt' |
|  |  |  |
|  |  | # with input\_file.open('wb') as f: |
|  |  | # f.write(json.dumps(INPUT\_PARAMETERS).encode()) |
|  |  |  |
|  |  | def test\_pickle\_input\_with\_format\_succeeds(tmp\_path): |
|  |  | input\_file = create\_pickle\_input(tmp\_path) |
|  |  | output\_file = run\_docker\_wrapper\_with\_echo\_db(input\_file, tmp\_path) |
|  |  | assert file\_echoes\_db(output\_file) |
|  |  | # output\_file = run\_docker\_wrapper\_with\_echo\_db(input\_file, tmp\_path) |
|  |  | # assert file\_echoes\_db(output\_file) |
|  |  |  |
|  |  |  |
|  |  | def test\_wrapper\_serializes\_pickle\_output(tmp\_path): |
|  |  | input\_parameters = { |
|  |  | 'method': 'hello\_world', |
|  |  | 'output\_format': PICKLE\_FORMAT |
|  |  | } |
|  |  | input\_file = create\_pickle\_input(tmp\_path, input\_parameters) |
|  |  |  |
|  |  | output\_file = run\_docker\_wrapper\_with\_echo\_db(input\_file, tmp\_path) |
|  |  |  |
|  |  | with output\_file.open('rb') as f: |
|  |  | # Check whether the output starts with `pickle.` to indicate the pickle |
|  |  | # data format |
|  |  | assert f.read(len(PICKLE\_FORMAT) + 1).decode() == f'{PICKLE\_FORMAT}.' |
|  |  |  |
|  |  | result = pickle.loads(f.read()) |
|  |  | pd.testing.assert\_frame\_equal(SAMPLE\_DB, result) |
|  |  |  |
|  |  |  |
|  |  | def test\_wrapper\_serializes\_json\_output(tmp\_path): |
|  |  | input\_parameters = {'method': 'hello\_world', 'output\_format': JSON\_FORMAT} |
|  |  | input\_file = create\_pickle\_input(tmp\_path, input\_parameters) |
|  |  |  |
|  |  | output\_file = run\_docker\_wrapper\_with\_echo\_db(input\_file, tmp\_path) |
|  |  |  |
|  |  | with output\_file.open('rb') as f: |
|  |  | # Check whether the data is preceded by json format string |
|  |  | assert f.read(len(JSON\_FORMAT) + 1).decode() == f'{JSON\_FORMAT}.' |
|  |  |  |
|  |  | # Since the echo\_db algorithm was triggered, output will be table that |
|  |  | # can be read by pandas. |
|  |  | result = pd.read\_json(f.read()) |
|  |  | pd.testing.assert\_frame\_equal(SAMPLE\_DB, result) |
|  |  |  |
|  |  |  |
|  |  | def create\_pickle\_input(tmp\_path, input\_parameters=None): |
|  |  | if input\_parameters is None: |
|  |  | input\_parameters = INPUT\_PARAMETERS |
|  |  |  |
|  |  | input\_file = tmp\_path / 'input.pkl' |
|  |  | with input\_file.open('wb') as f: |
|  |  | f.write(f'PICKLE{SEPARATOR}'.encode()) |
|  |  | f.write(pickle.dumps(input\_parameters)) |
|  |  | return input\_file |
|  |  | # def test\_wrapper\_serializes\_json\_output(tmp\_path): |
|  |  | # input\_parameters = {'method': 'hello\_world', 'output\_format': JSON\_FORMAT} |
|  |  | # input\_file = create\_pickle\_input(tmp\_path, input\_parameters) |
|  |  |  |
|  |  | # output\_file = run\_docker\_wrapper\_with\_echo\_db(input\_file, tmp\_path) |
|  |  |  |
|  |  | def file\_echoes\_db(output\_file): |
|  |  | with output\_file.open('rb') as f: |
|  |  | result = pickle.load(f) |
|  |  | target = SAMPLE\_DB |
|  |  | # with output\_file.open('rb') as f: |
|  |  | # # Check whether the data is preceded by json format string |
|  |  | # assert f.read(len(JSON\_FORMAT) + 1).decode() == f'{JSON\_FORMAT}.' |
|  |  |  |
|  |  | return target.equals(result) |
|  |  | # # Since the echo\_db algorithm was triggered, output will be table that |
|  |  | # # can be read by pandas. |
|  |  | # result = pd.read\_json(f.read()) |
|  |  | # pd.testing.assert\_frame\_equal(SAMPLE\_DB, result) |
|  |  |  |
|  |  |  |
|  |  | def run\_docker\_wrapper\_with\_echo\_db(input\_file, tmp\_path): |
| Expand Down  Expand Up | | @@ -169,7 +108,7 @@ def test\_sparql\_docker\_wrapper\_passes\_dataframe( |
|  |  | input\_args = {'query': 'select \*'} |
|  |  |  |
|  |  | with input\_file.open('wb') as f: |
|  |  | pickle.dump(input\_args, f) |
|  |  | json.dumps(input\_args, f) |
|  |  |  |
|  |  | with token\_file.open('w') as f: |
|  |  | f.write(TOKEN) |
| Expand Down | |  |

29 changes: 3 additions & 26 deletions

29
[vantage6-client/tests/test\_serialization.py](#diff-54240c687f6bf442881223eb39dd2c339bc24ed0e052f5a391edef8ec0d25109 "vantage6-client/tests/test_serialization.py")

Show comments

[View file](/vantage6/vantage6/blob/e62f03bacf2247bd59eed217e2e7338c3a01a5f0/vantage6-client/tests/test_serialization.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,14 +1,8 @@ |
|  |  | import pickle |
|  |  |  |
|  |  | from pytest import mark |
|  |  |  |
|  |  | from vantage6.tools import serialization |
|  |  | import pandas as pd |
|  |  |  |
|  |  | from vantage6.tools.data\_format import DataFormat |
|  |  |  |
|  |  | JSON = 'json' |
|  |  |  |
|  |  |  |
|  |  | @mark.parametrize("data,target", [ |
|  |  | # Default serialization |
| Expand All | | @@ -17,28 +11,11 @@ |
|  |  | ({'hello': 'goodbye'}, '{"hello": "goodbye"}'), |
|  |  |  |
|  |  | # Pandas serialization |
|  |  | (pd.DataFrame([[1, 2, 3]], columns=['one', 'two', 'three']), '{"one":{"0":1},"two":{"0":2},"three":{"0":3}}'), |
|  |  | (pd.DataFrame([[1, 2, 3]], columns=['one', 'two', 'three']), |
|  |  | '{"one":{"0":1},"two":{"0":2},"three":{"0":3}}'), |
|  |  | (pd.Series([1, 2, 3]), '{"0":1,"1":2,"2":3}') |
|  |  | ]) |
|  |  | def test\_json\_serialization(data, target): |
|  |  | result = serialization.serialize(data, DataFormat.JSON) |
|  |  | result = serialization.serialize(data) |
|  |  |  |
|  |  | assert target == result.decode() |
|  |  |  |
|  |  |  |
|  |  | @mark.parametrize("data", [ |
|  |  | ({'key': 'value'}), |
|  |  | (123), |
|  |  | ([1, 2, 3]), |
|  |  | ]) |
|  |  | def test\_pickle\_serialization(data): |
|  |  | pickled = serialization.serialize(data, DataFormat.PICKLE) |
|  |  |  |
|  |  | assert data == pickle.loads(pickled) |
|  |  |  |
|  |  |  |
|  |  | def test\_pickle\_serialization\_pandas(): |
|  |  | data = pd.DataFrame([1, 2, 3]) |
|  |  | pickled = serialization.serialize(data, DataFormat.PICKLE) |
|  |  |  |
|  |  | pd.testing.assert\_frame\_equal(data, pickle.loads(pickled)) |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e62f03b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fcommit%2Fe62f03bacf2247bd59eed217e2e7338c3a01a5f0) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

