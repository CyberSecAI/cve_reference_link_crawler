

| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=24f6008564183aa120d07c03d9289519c2fe02af)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=24f6008564183aa120d07c03d9289519c2fe02af)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=24f6008564183aa120d07c03d9289519c2fe02af)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=24f6008564183aa120d07c03d9289519c2fe02af)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric W. Biederman <ebiederm@xmission.com> | 2022-01-20 11:04:01 -0600 |
| --- | --- | --- |
| committer | Tejun Heo <tj@kernel.org> | 2022-02-01 07:28:00 -1000 |
| commit | [24f6008564183aa120d07c03d9289519c2fe02af](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=24f6008564183aa120d07c03d9289519c2fe02af) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=24f6008564183aa120d07c03d9289519c2fe02af)) | |
| tree | [116de0e1cf8b69ec7bdc1fec15a9a623d77eee04](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=24f6008564183aa120d07c03d9289519c2fe02af) | |
| parent | [c80d401c52a2d1baf2a5afeb06f0ffe678e56d23](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c80d401c52a2d1baf2a5afeb06f0ffe678e56d23) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=24f6008564183aa120d07c03d9289519c2fe02af&id2=c80d401c52a2d1baf2a5afeb06f0ffe678e56d23)) | |
| download | [linux-24f6008564183aa120d07c03d9289519c2fe02af.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-24f6008564183aa120d07c03d9289519c2fe02af.tar.gz) | |

cgroup-v1: Require capabilities to set release\_agentThe cgroup release\_agent is called with call\_usermodehelper. The function
call\_usermodehelper starts the release\_agent with a full set fo capabilities.
Therefore require capabilities when setting the release\_agaent.
Reported-by: Tabitha Sable <tabitha.c.sable@gmail.com>
Tested-by: Tabitha Sable <tabitha.c.sable@gmail.com>
Fixes: 81a6a5cdd2c5 ("Task Control Groups: automatic userspace notification of idle cgroups")
Cc: stable@vger.kernel.org # v2.6.24+
Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>
Signed-off-by: Tejun Heo <tj@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=24f6008564183aa120d07c03d9289519c2fe02af)

| -rw-r--r-- | [kernel/cgroup/cgroup-v1.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/cgroup/cgroup-v1.c?id=24f6008564183aa120d07c03d9289519c2fe02af) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 0 deletions

| diff --git a/kernel/cgroup/cgroup-v1.c b/kernel/cgroup/cgroup-v1.cindex 41e0837a5a0bda..0e877dbcfeea9c 100644--- a/[kernel/cgroup/cgroup-v1.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/cgroup/cgroup-v1.c?id=c80d401c52a2d1baf2a5afeb06f0ffe678e56d23)+++ b/[kernel/cgroup/cgroup-v1.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/cgroup/cgroup-v1.c?id=24f6008564183aa120d07c03d9289519c2fe02af)@@ -549,6 +549,14 @@ static ssize\_t cgroup\_release\_agent\_write(struct kernfs\_open\_file \*of,  BUILD\_BUG\_ON(sizeof(cgrp->root->release\_agent\_path) < PATH\_MAX); + /\*+ \* Release agent gets called with all capabilities,+ \* require capabilities to set release agent.+ \*/+ if ((of->file->f\_cred->user\_ns != &init\_user\_ns) ||+ !capable(CAP\_SYS\_ADMIN))+ return -EPERM;+ cgrp = cgroup\_kn\_lock\_live(of->kn, false); if (!cgrp) return -ENODEV;@@ -954,6 +962,12 @@ int cgroup1\_parse\_param(struct fs\_context \*fc, struct fs\_parameter \*param) /\* Specifying two release agents is forbidden \*/ if (ctx->release\_agent) return invalfc(fc, "release\_agent respecified");+ /\*+ \* Release agent gets called with all capabilities,+ \* require capabilities to set release agent.+ \*/+ if ((fc->user\_ns != &init\_user\_ns) || !capable(CAP\_SYS\_ADMIN))+ return invalfc(fc, "Setting release\_agent not allowed"); ctx->release\_agent = param->string; param->string = NULL; break; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-05 22:24:41 +0000

