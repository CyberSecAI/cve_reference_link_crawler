

![](/static/v20241211.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1720098)
* [XML](/show_bug.cgi?ctype=xml&id=1720098)

Closed
[Bug 1720098](/show_bug.cgi?id=1720098)
(CVE-2022-22757)

Opened 3 years ago
Closed 3 years ago

# Need to validate Host and Origin headers for remote agent websockets connection

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Need to validate Host and Origin headers for remote agent websockets connection

## Categories

### (Remote Protocol :: Agent, defect, P2)

[Product:](/describecomponents.cgi?product=Remote%20Protocol)

Remote Protocol
▾

Remote Protocol
The Firefox Remote Protocol is a low-level debugging interface based on the CDP protocol. With it, you can inspect the state and control execution of documents running in web content, instrument Gecko in interesting ways, simulate user interaction for automation purposes, and debug JavaScript execution
[See Open Bugs in This Product](/buglist.cgi?product=Remote%20Protocol&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Remote%20Protocol)
Watch This Product

[Component:](/describecomponents.cgi?product=Remote%20Protocol&component=Agent#Agent)

Agent
▾

Remote Protocol :: Agent
Underlying transport layer and server to allow remoting of Firefox for automation and debugging.
[See Open Bugs in This Component](/buglist.cgi?product=Remote%20Protocol&component=Agent&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Remote%20Protocol&component=Agent&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Remote%20Protocol&component=Agent)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

2

## Tracking

### (firefox-esr91 wontfix, firefox95 wontfix, firefox96 wontfix, firefox97 fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

97 Branch

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr91 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix) |
| firefox95 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=wontfix) |
| firefox96 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=wontfix) |
| firefox97 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr91 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox95 |  | wontfix |
| firefox96 |  | wontfix |
| firefox97 |  | fixed |
| firefox133 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jgraham, Assigned: jdescottes)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/60dd86ccfd9c63b53e9f2a34b2f48442?d=mm&size=40)  [jdescottes](/user_profile?user_id=559949)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1f995d40ccb8561d5ae1e53ede750c3e?d=mm&size=40)  [jgraham](/user_profile?user_id=389650)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/293c22edcb706bae477fec3c9c94496c?d=mm&size=40)  [whimboo](/user_profile?user_id=76551)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1750689](/show_bug.cgi?id=1750689 "RESOLVED FIXED - Add opt-in support for hosts and origins other then local loopback interfaces for WebDriver BiDi")

[1745892](/show_bug.cgi?id=1745892 "RESOLVED DUPLICATE - Only allow WebSocketHandshake::allowNullOrigin to be called during tests"), [1746953](/show_bug.cgi?id=1746953 "RESOLVED FIXED - Update error message when validating origin header"), [1755317](/show_bug.cgi?id=1755317 "VERIFIED FIXED - Only validate Origin header for remote agent websockets connection if BiDi is enabled")

Dependency [tree](/showdependencytree.cgi?id=1720098&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1720098)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1754738](/show_bug.cgi?id=1754738 "RESOLVED WONTFIX - Consider not building WebDriver components for release versions of Firefox")

## Details

### (Keywords: sec-moderate, Whiteboard: [failures could end up being sec-high][bidi-m2-mvp][post-critsmash-triage][adv-main97+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-22757

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[failures could end up being sec-high][bidi-m2-mvp][post-critsmash-triage][adv-main97+]

Change Request:

---

Bug Flags:

|  | firefox-backlog |  |
| --- | --- | --- |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 1 obsolete file)

| [Bug 1720098 - [remote] Check websocket handshake requests are from localhost](/attachment.cgi?id=9253200)  [3 years ago](#c3)  [Julian Descottes [:jdescottes]](/user_profile?user_id=559949)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9253200&action=edit) | [Review](/attachment.cgi?id=9253200) |
| --- | --- | --- |
| [Bug 1720098 - [wdspec] Add mozilla-only wdspec test for remote agent websocket host validation](/attachment.cgi?id=9254227)  [3 years ago](#c4)  [Julian Descottes [:jdescottes]](/user_profile?user_id=559949)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9254227&action=edit) | [Review](/attachment.cgi?id=9254227) |
| [advisory.txt](/attachment.cgi?id=9261945)  [3 years ago](#c8)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   353 bytes, text/plain |  | [Details](/attachment.cgi?id=9261945&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [James Graham [:jgraham]](/user_profile?user_id=389650)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1720098#c0)• 3 years ago |
|  | |

Otherwise it may be posibble for websites to connect to the remote agent c.f. <https://bugzilla.mozilla.org/show_bug.cgi?id=1648964>. Checxks should go in <https://searchfox.org/mozilla-central/source/remote/server/WebSocketHandshake.jsm#76>

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a343_76551)• 3 years ago |

Whiteboard: [webdriver:triage]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a5757_76551)• 3 years ago |

Priority: -- → P2Whiteboard: [webdriver:triage]

|  | [Daniel Veditz [:dveditz] back January 6](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1720098#c1)• 3 years ago |
|  | |

We'll call this `sec-moderate` for now because we don't know of a specific exploitable case at the moment and not many users run this, but like [bug 1648964](/show_bug.cgi?id=1648964 "RESOLVED FIXED - CSRF to RCE in geckodriver") failures are likely to be of the `sec-high` type

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)Whiteboard: failures could end up being sec-high

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a7589401_76551)• 3 years ago |

Whiteboard: failures could end up being sec-high → [failures could end up being sec-high][webdriver:triage]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1720098#c2)• 3 years ago |
|  | |

As discussed in our triage meeting checking headers should actually be easy. But it might be harder to figure out what we actually need here. So we could start simple with just allowing localhost/127.0.0.1 even without IPv6 support which would reduce the points to just 2.

But for now lets add to our M2 milestone because it would be bad to tell Selenium folks to not use our BiDi implementation for logging because it totally unsecure.

Points: --- → 8Whiteboard: [failures could end up being sec-high][webdriver:triage] → [failures could end up being sec-high][bidi-m2-mvp]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a10301371_76551)• 3 years ago |

Severity: -- → S3

|  | [Julian Descottes [:jdescottes]](/user_profile?user_id=559949)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a12213419_559949)• 3 years ago |

Assignee: nobody → jdescottesStatus: NEW → ASSIGNED

|  | [Julian Descottes [:jdescottes]](/user_profile?user_id=559949)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1720098#c3)• 3 years ago |
|  | |

Attached file
[Bug 1720098 - [remote] Check websocket handshake requests are from localhost](attachment.cgi?id=9253200)
— [Details](attachment.cgi?id=9253200&action=edit)

|  | [Julian Descottes [:jdescottes]](/user_profile?user_id=559949)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a12711474_559949)• 3 years ago |

Points: 8 → 2

|  | [Julian Descottes [:jdescottes]](/user_profile?user_id=559949)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1720098#c4)• 3 years ago |
|  | |

Attached file
[Bug 1720098 - [wdspec] Add mozilla-only wdspec test for remote agent websocket host validation](attachment.cgi?id=9254227) (obsolete)
— [Details](attachment.cgi?id=9254227&action=edit)

Depends on D132561

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a12859943_600971)• 3 years ago |

[Attachment #9254227](/attachment.cgi?id=9254227&action=edit "Bug 1720098 - [wdspec] Add mozilla-only wdspec test for remote agent websocket host validation") -
Attachment is obsolete: true

|  | [Julian Descottes [:jdescottes]](/user_profile?user_id=559949)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a13381182_559949)• 3 years ago |

Blocks: [1745892](/show_bug.cgi?id=1745892 "RESOLVED DUPLICATE - Only allow WebSocketHandshake::allowNullOrigin to be called during tests")

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1720098#c5)• 3 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/e426e5c345bf>

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 3 years ago
[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=wontfix)
[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=affected)
[status-firefox97](/buglist.cgi?f1=cf_status_firefox97&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=fixed)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)Resolution: --- → FIXEDTarget Milestone: --- → 97 Branch

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1720098#c6)• 3 years ago |
|  | |

WebDriver Bidi is not enabled by default on release branches. And as such no testing is done. Therefore we aren't considering an uplift to beta.

[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=wontfix)

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1720098#c7)• 3 years ago |
|  | |

Same applies also to the esr91 branch.

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a13666362_553429)• 3 years ago |

Whiteboard: [failures could end up being sec-high][bidi-m2-mvp] → [failures could end up being sec-high][bidi-m2-mvp][post-critsmash-triage]

|  | [Julian Descottes [:jdescottes]](/user_profile?user_id=559949)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a13948240_559949)• 3 years ago |

Blocks: [1746953](/show_bug.cgi?id=1746953 "RESOLVED FIXED - Update error message when validating origin header")

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a16400471_76551)• 3 years ago |

Blocks: [1750689](/show_bug.cgi?id=1750689 "RESOLVED FIXED - Add opt-in support for hosts and origins other then local loopback interfaces for WebDriver BiDi")

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a17725814_578488)• 3 years ago |

Whiteboard: [failures could end up being sec-high][bidi-m2-mvp][post-critsmash-triage] → [failures could end up being sec-high][bidi-m2-mvp][post-critsmash-triage][adv-main97+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1720098#c8)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9261945)
— [Details](attachment.cgi?id=9261945&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a18157124_578488)• 3 years ago |

Alias: CVE-2022-22757

|  | [Mark Straver](/user_profile?user_id=364942) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a18404220_364942)• 3 years ago |

See Also: → [1754738](/show_bug.cgi?id=1754738 "RESOLVED WONTFIX - Consider not building WebDriver components for release versions of Firefox")

|  | [Julian Descottes [:jdescottes]](/user_profile?user_id=559949)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a18762733_559949)• 3 years ago |

Blocks: [1755317](/show_bug.cgi?id=1755317 "VERIFIED FIXED - Only validate Origin header for remote agent websockets connection if BiDi is enabled")

|  | [Daniel Veditz [:dveditz] back January 6](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1720098#a35494910_1689)• 2 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1720098&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Julian Descottes [:jdescottes]](/user_profile?user_id=559949)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

