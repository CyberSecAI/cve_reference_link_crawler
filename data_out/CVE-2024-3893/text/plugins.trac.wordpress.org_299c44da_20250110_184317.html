

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3073754%2Fclassified-listing%2Ftrunk%2Fapp%2FControllers%2FAjax%2FFormBuilderAjax.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3066199/classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php "Changeset 3066199 for classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php")
* [Next Change](/changeset/3116262/classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php "Changeset 3116262 for classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php") →

---

# Changeset [3073754](/changeset/3073754 "Show full changeset") for [classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php](/browser/classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php?rev=3073754 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
04/19/2024 10:54:20 AM
([9 months](/timeline?from=2024-04-19T10%3A54%3A20Z&precision=second "See timeline at 04/19/2024 10:54:20 AM") ago)

Author:
techlabpro1
Message:

Release new version 3.0.11

File:

1 edited

* [classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php](/browser/classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php?rev=3073754 "Show entry in browser")
  (modified)
  ([3 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php](/changeset/3073754/classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php "Show the changeset 3073754 restricted to classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php")

  | [r3066199](/browser/classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php?rev=3066199#L493 "Show revision 3066199 of this file in browser") | [r3073754](/browser/classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php?rev=3073754#L493 "Show revision 3073754 of this file in browser") |  |
  | --- | --- | --- |
  | 493 | 493 | return; |
  | 494 | 494 | } |
  | 495 |  |  |
  |  | 495 | $listing\_id = absint( Functions::request( "listingId" ) ); |
  |  | 496 | $listing = rtcl()->factory->get\_listing($listing\_id); |
  |  | 497 |  |
  |  | 498 | if (  ! $listing || ! current\_user\_can( 'edit\_rtcl\_listing', $listing\_id ) )  { |
  |  | 499 | wp\_send\_json\_error( apply\_filters( 'rtcl\_fb\_not\_found\_error\_message', \_\_( 'You do not have sufficient permissions to access this page.', 'classified-listing' ), $\_REQUEST, 'permission\_error' ) ); |
  |  | 500 |  |
  |  | 501 | return; |
  |  | 502 | } |
  |  | 503 |  |
  | 496 | 504 | $attach\_id = isset( $\_POST["attach\_id"] ) ? absint( $\_POST["attach\_id"] ) : 0; |
  | 497 | 505 | $attach    = get\_post( $attach\_id ); |
  | […](/browser/classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php?rev=3066199#L507) | […](/browser/classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php?rev=3073754#L515) |  |
  | 507 | 515 | return; |
  | 508 | 516 | } |
  |  | 517 |  |
  |  | 518 | $featureImageRemoved = false; |
  |  | 519 | if(get\_post\_thumbnail\_id( $listing->get\_id() ) === $attach\_id){ |
  |  | 520 | $featureImageRemoved = true; |
  |  | 521 | } |
  | 509 | 522 |  |
  | 510 | 523 | if ( ! wp\_delete\_attachment( $attach\_id ) ) { |
  | […](/browser/classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php?rev=3066199#L512) | […](/browser/classified-listing/trunk/app/Controllers/Ajax/FormBuilderAjax.php?rev=3073754#L525) |  |
  | 512 | 525 |  |
  | 513 | 526 | return; |
  |  | 527 | } |
  |  | 528 |  |
  |  | 529 | if($featureImageRemoved){ |
  |  | 530 | $attachmentIds = get\_children( [ |
  |  | 531 | 'post\_parent'    => $listing->get\_id(), |
  |  | 532 | 'fields'         => 'ids', |
  |  | 533 | 'post\_type'      => 'attachment', |
  |  | 534 | 'posts\_per\_page' => - 1, |
  |  | 535 | 'post\_status'    => 'inherit', |
  |  | 536 | 'orderby'        => 'menu\_order', |
  |  | 537 | 'order'          => 'ASC', |
  |  | 538 | 'meta\_query'     => [ // phpcs:ignore WordPress.DB.SlowDBQuery.slow\_db\_query\_meta\_query |
  |  | 539 | 'relation' => 'OR', |
  |  | 540 | [ |
  |  | 541 | 'key'     => '\_rtcl\_attachment\_type', |
  |  | 542 | 'value'   => 'image', |
  |  | 543 | 'compare' => '=' |
  |  | 544 | ], |
  |  | 545 | [ |
  |  | 546 | 'key'     => '\_rtcl\_attachment\_type', |
  |  | 547 | 'compare' => 'NOT EXISTS' |
  |  | 548 | ] |
  |  | 549 | ] |
  |  | 550 | ] ); |
  |  | 551 | if(!empty($attachmentIds)){ |
  |  | 552 | set\_post\_thumbnail( $listing\_id, $attachmentIds[0] ); |
  |  | 553 | } |
  | 514 | 554 | } |
  | 515 | 555 | wp\_send\_json\_success(); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3073754)
* [Zip Archive](?format=zip&new=3073754)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

