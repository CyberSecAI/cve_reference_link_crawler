
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F11936)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F11936)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.8k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  65](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Implement a content type allow list for URL previews #11936

 Merged

[dkasak](/dkasak)
merged 12 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[dkasak/no-previews-for-audio-video](/matrix-org/synapse/tree/dkasak/no-previews-for-audio-video "matrix-org/synapse:dkasak/no-previews-for-audio-video")

Feb 10, 2022

 Merged

# [Implement a content type allow list for URL previews](#top) #11936

[dkasak](/dkasak)
merged 12 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[dkasak/no-previews-for-audio-video](/matrix-org/synapse/tree/dkasak/no-previews-for-audio-video "matrix-org/synapse:dkasak/no-previews-for-audio-video")

Feb 10, 2022

[Conversation
20](/matrix-org/synapse/pull/11936)
[Commits
12](/matrix-org/synapse/pull/11936/commits)
[Checks
0](/matrix-org/synapse/pull/11936/checks)
[Files changed](/matrix-org/synapse/pull/11936/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![dkasak](https://avatars.githubusercontent.com/u/463342?s=60&v=4)](/dkasak)

Copy link

Member

### @dkasak **[dkasak](/dkasak)** commented [Feb 8, 2022](#issue-1127106061) • edited Loading

This prevents Synapse from attempting to construct URL previews for URLs to resources with content types that aren't on an allow list. This makes sense given that Synapse will never generate a URL preview for such files in the first place, and will help prevent issues with streaming media servers, such as [#8302](https://github.com/matrix-org/synapse/issues/8302).

Signed-off-by: Denis Kasak dkasak@termina.org.uk

Sorry, something went wrong.

All reactions

 [dkasak](/dkasak)
added 2 commits
[February 8, 2022 11:27](#commits-pushed-ffcd5fb)

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)

`[Bail on generating URL previews for audio and video content types.](/matrix-org/synapse/pull/11936/commits/ffcd5fb0492c2f857603620c008bee30284c5fd7 "Bail on generating URL previews for audio and video content types.")`

`[ffcd5fb](/matrix-org/synapse/pull/11936/commits/ffcd5fb0492c2f857603620c008bee30284c5fd7)`

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)

`[Add test.](/matrix-org/synapse/pull/11936/commits/ac49e720006ed1771c1ebe8f3e27f0d28d5d0d4e "Add test.")`

`[ac49e72](/matrix-org/synapse/pull/11936/commits/ac49e720006ed1771c1ebe8f3e27f0d28d5d0d4e)`

 [![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&u=39d73e47728d2fc80f472acb7a3aa59facf7b54a&v=4)](/dkasak)
[dkasak](/dkasak)
requested a review
from a team
as a [code owner](/matrix-org/synapse/blob/3655585e85bfebd9165151d9d69fd907d65d6db0/.github/CODEOWNERS#L2)
[February 8, 2022 11:05](#event-6025901510)

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)

`[Add changelog.](/matrix-org/synapse/pull/11936/commits/59b39cea8c037218e1c762854761c912ae374aec "Add changelog.")`

`[59b39ce](/matrix-org/synapse/pull/11936/commits/59b39cea8c037218e1c762854761c912ae374aec)`

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

**[clokep](/clokep)**
reviewed
[Feb 8, 2022](#pullrequestreview-875945414)

 [View reviewed changes](/matrix-org/synapse/pull/11936/files/59b39cea8c037218e1c762854761c912ae374aec)

[changelog.d/11936.bugfix](/matrix-org/synapse/pull/11936/files/59b39cea8c037218e1c762854761c912ae374aec#diff-a601f6c685042b0277b81b6aeb9e74a7a4b32b182c2ef52b8d75b9320cbce917)
Outdated

Show resolved

Hide resolved

[synapse/http/client.py](/matrix-org/synapse/pull/11936/files/59b39cea8c037218e1c762854761c912ae374aec#diff-66444b92f547d9edb90914be0717bbe92d7b02ce10b65b4546b6c629af563ae9)
Outdated

Show resolved

Hide resolved

 [dkasak](/dkasak)
and others
added 2 commits
[February 8, 2022 13:44](#commits-pushed-8690277)

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak) [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Fix changelog style per review.](/matrix-org/synapse/pull/11936/commits/86902770d6cdbcfcfcb462025ae5794f2113f603 "Fix changelog style per review.

Co-authored-by: Patrick Cloke <clokep@users.noreply.github.com>")`
 …

`[8690277](/matrix-org/synapse/pull/11936/commits/86902770d6cdbcfcfcb462025ae5794f2113f603)`

```
Co-authored-by: Patrick Cloke <clokep@users.noreply.github.com>
```

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)

`[Specify allowed content types for get_file via a predicate.](/matrix-org/synapse/pull/11936/commits/fa58bccc036fc6fb586782163631c6473ed74004 "Specify allowed content types for get_file via a predicate.")`

`[fa58bcc](/matrix-org/synapse/pull/11936/commits/fa58bccc036fc6fb586782163631c6473ed74004)`

 [![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&u=39d73e47728d2fc80f472acb7a3aa59facf7b54a&v=4)](/dkasak)
[dkasak](/dkasak)
requested a review
from [clokep](/clokep)
[February 8, 2022 16:44](#event-6028299535)

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

**[clokep](/clokep)**
reviewed
[Feb 8, 2022](#pullrequestreview-876557195)

 [View reviewed changes](/matrix-org/synapse/pull/11936/files/fa58bccc036fc6fb586782163631c6473ed74004)

Copy link

Member

### @clokep **[clokep](/clokep)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Looks pretty good! I made a couple of suggestions for readability!

Sorry, something went wrong.

All reactions

[synapse/rest/media/v1/preview\_url\_resource.py](/matrix-org/synapse/pull/11936/files/fa58bccc036fc6fb586782163631c6473ed74004#diff-bab0f9e113994dc8e6d6dedc4e2d3ce8b5ff6e059dc181ccf4db4c3358d60b29)
Outdated

Show resolved

Hide resolved

[synapse/http/client.py](/matrix-org/synapse/pull/11936/files/fa58bccc036fc6fb586782163631c6473ed74004#diff-66444b92f547d9edb90914be0717bbe92d7b02ce10b65b4546b6c629af563ae9)
Outdated

Show resolved

Hide resolved

 [dkasak](/dkasak)
and others
added 3 commits
[February 9, 2022 10:19](#commits-pushed-5a97a08)

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak) [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Improve readability of _is_not_av_media.](/matrix-org/synapse/pull/11936/commits/5a97a0839ce75e5591d7b35c434c0f2f5ccb3c69 "Improve readability of `_is_not_av_media`.

Co-authored-by: Patrick Cloke <clokep@users.noreply.github.com>")`
 …

`[5a97a08](/matrix-org/synapse/pull/11936/commits/5a97a0839ce75e5591d7b35c434c0f2f5ccb3c69)`

```
Co-authored-by: Patrick Cloke <clokep@users.noreply.github.com>
```

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)

`[Make error message more general.](/matrix-org/synapse/pull/11936/commits/b035155505d3d4e76d21affcce618cd4f67a6bf3 "Make error message more general.")`

`[b035155](/matrix-org/synapse/pull/11936/commits/b035155505d3d4e76d21affcce618cd4f67a6bf3)`

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)

`[Formatting.](/matrix-org/synapse/pull/11936/commits/65dd4f1f0cc937bdc7c6637865896bebb02c4221 "Formatting.")`

`[65dd4f1](/matrix-org/synapse/pull/11936/commits/65dd4f1f0cc937bdc7c6637865896bebb02c4221)`

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
self-requested a review
[February 9, 2022 12:19](#event-6033919476)

[![anarcat](https://avatars.githubusercontent.com/u/796623?s=60&v=4)](/anarcat)

**[anarcat](/anarcat)**
reviewed
[Feb 9, 2022](#pullrequestreview-877616298)

 [View reviewed changes](/matrix-org/synapse/pull/11936/files/65dd4f1f0cc937bdc7c6637865896bebb02c4221)

[synapse/rest/media/v1/preview\_url\_resource.py](/matrix-org/synapse/pull/11936/files/65dd4f1f0cc937bdc7c6637865896bebb02c4221#diff-bab0f9e113994dc8e6d6dedc4e2d3ce8b5ff6e059dc181ccf4db4c3358d60b29)
Outdated

Show resolved

Hide resolved

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)

`[Switch to using an allow list for URL previewable content types.](/matrix-org/synapse/pull/11936/commits/2f3bb1f55aab57c48e8bce97b170fcf9615f9df8 "Switch to using an allow list for URL previewable content types.")`

`[2f3bb1f](/matrix-org/synapse/pull/11936/commits/2f3bb1f55aab57c48e8bce97b170fcf9615f9df8)`

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

**[clokep](/clokep)**
approved these changes
[Feb 10, 2022](#pullrequestreview-878835889)

 [View reviewed changes](/matrix-org/synapse/pull/11936/files/2f3bb1f55aab57c48e8bce97b170fcf9615f9df8)

Copy link

Member

### @clokep **[clokep](/clokep)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

LGTM! Left one minor comment, but I don't feel too strongly about it. Let me know if there are any other thoughts before we merge!

Sorry, something went wrong.

All reactions

[synapse/rest/media/v1/preview\_url\_resource.py](/matrix-org/synapse/pull/11936/files/2f3bb1f55aab57c48e8bce97b170fcf9615f9df8#diff-bab0f9e113994dc8e6d6dedc4e2d3ce8b5ff6e059dc181ccf4db4c3358d60b29)
Outdated

Show resolved

Hide resolved

 [dkasak](/dkasak)
added 2 commits
[February 10, 2022 15:05](#commits-pushed-4376a70)

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)

`[Reuse existing content type helpers.](/matrix-org/synapse/pull/11936/commits/4376a705f3b4fbd1c637b9e1ab8743e311926197 "Reuse existing content type helpers.")`

`[4376a70](/matrix-org/synapse/pull/11936/commits/4376a705f3b4fbd1c637b9e1ab8743e311926197)`

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)

`[Reword changelog to reflect change of approach.](/matrix-org/synapse/pull/11936/commits/1d031242eb7a7ac466dd6f4b8a2677abb6511621 "Reword changelog to reflect change of approach.")`

`[1d03124](/matrix-org/synapse/pull/11936/commits/1d031242eb7a7ac466dd6f4b8a2677abb6511621)`

 [![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&u=39d73e47728d2fc80f472acb7a3aa59facf7b54a&v=4)](/dkasak)
[dkasak](/dkasak)
[force-pushed](/matrix-org/synapse/compare/bb28c26393f3d4aa25ca8b91d95bce0050057c77..1d031242eb7a7ac466dd6f4b8a2677abb6511621)
the
dkasak/no-previews-for-audio-video

branch
from
[`bb28c26`](/matrix-org/synapse/commit/bb28c26393f3d4aa25ca8b91d95bce0050057c77) to
[`1d03124`](/matrix-org/synapse/commit/1d031242eb7a7ac466dd6f4b8a2677abb6511621)  [Compare](/matrix-org/synapse/compare/bb28c26393f3d4aa25ca8b91d95bce0050057c77..1d031242eb7a7ac466dd6f4b8a2677abb6511621)
[February 10, 2022 14:05](#event-6042473441)

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&u=39d73e47728d2fc80f472acb7a3aa59facf7b54a&v=4)](/dkasak)
[dkasak](/dkasak)
changed the title
~~Don't attempt URL previews for `audio/*` and `video/*` content types~~
Implement a content type allow list for URL previews
[Feb 10, 2022](#event-6042482716)

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)

`[Small refactoring.](/matrix-org/synapse/pull/11936/commits/d6edc9bc584906ccb236462d282be2e8294b68e0 "Small refactoring.")`

`[d6edc9b](/matrix-org/synapse/pull/11936/commits/d6edc9bc584906ccb236462d282be2e8294b68e0)`

[![@jvoisin](https://avatars.githubusercontent.com/u/325724?s=80&u=4446b76c0f4ebcbecb2678759f8d13817a67f85d&v=4)](/jvoisin)

Copy link

### **[jvoisin](/jvoisin)** commented [Feb 10, 2022](#issuecomment-1035041107)

| Stupid question, but how does that prevents an attacker from simply serving a supported content-type for their 10TB stream from `/dev/null` to DoS the server? |
| --- |

All reactions

Sorry, something went wrong.

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=80&u=39d73e47728d2fc80f472acb7a3aa59facf7b54a&v=4)](/dkasak)

Copy link

Member

Author

### **[dkasak](/dkasak)** commented [Feb 10, 2022](#issuecomment-1035044248)

| It doesn't, but the attacker will only be DoS-ing themselves in that case. How does that help them?  Note that there are separate time and size limits too. |
| --- |

All reactions

Sorry, something went wrong.

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&u=39d73e47728d2fc80f472acb7a3aa59facf7b54a&v=4)](/dkasak)
[dkasak](/dkasak)
enabled auto-merge (squash)
[February 10, 2022 15:23](#event-6043133154)

[![@anarcat](https://avatars.githubusercontent.com/u/796623?s=80&v=4)](/anarcat)

Copy link

### **[anarcat](/anarcat)** commented [Feb 10, 2022](#issuecomment-1035050068)

| It doesn't, but the attacker will only be DoS-ing themselves in that case. How does that help them?  there are two ends to a potential DoS attack... |
| --- |

All reactions

Sorry, something went wrong.

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&u=39d73e47728d2fc80f472acb7a3aa59facf7b54a&v=4)](/dkasak)
[dkasak](/dkasak)
merged commit [`337f38c`](/matrix-org/synapse/commit/337f38cac38bc57bc6a3cc8b319e3079c60c4549)
into
develop

[Feb 10, 2022](https://github.com/matrix-org/synapse/pull/11936#event-6043305014)

 [![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&u=39d73e47728d2fc80f472acb7a3aa59facf7b54a&v=4)](/dkasak)
[dkasak](/dkasak)
deleted the
dkasak/no-previews-for-audio-video

branch
[February 10, 2022 15:43](#event-6043305190)

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=80&u=39d73e47728d2fc80f472acb7a3aa59facf7b54a&v=4)](/dkasak)

Copy link

Member

Author

### **[dkasak](/dkasak)** commented [Feb 10, 2022](#issuecomment-1035216472)

| Sure, but that's another case which this PR isn't meant to handle. |
| --- |

All reactions

Sorry, something went wrong.

[squahtx](/squahtx)
pushed a commit
that referenced
this pull request
[Feb 15, 2022](#ref-commit-85e24d9)

`[Merge tag 'v1.53.0rc1' into develop](/matrix-org/synapse/commit/85e24d9d2bc29280ed3a9d6db3919ff30fc67104 "Merge tag 'v1.53.0rc1' into develop

Synapse 1.53.0rc1 (2022-02-15)
==============================

Features
--------

- Add experimental support for sending to-device messages to application services, as specified by [MSC2409](https://github.com/matrix-org/matrix-doc/pull/2409). ([\#11215](https://github.com/matrix-org/synapse/issues/11215), [\#11966](https://github.com/matrix-org/synapse/issues/11966))
- Remove account data (including client config, push rules and ignored users) upon user deactivation. ([\#11655](https://github.com/matrix-org/synapse/issues/11655))
- Experimental support for [MSC3666](https://github.com/matrix-org/matrix-doc/pull/3666): including bundled aggregations in server side search results. ([\#11837](https://github.com/matrix-org/synapse/issues/11837))
- Enable cache time-based expiry by default. The `expiry_time` config flag has been superseded by `expire_caches` and `cache_entry_ttl`. ([\#11849](https://github.com/matrix-org/synapse/issues/11849))
- Add a callback to allow modules to allow or forbid a 3PID (email address, phone number) from being associated to a local account. ([\#11854](https://github.com/matrix-org/synapse/issues/11854))
- Stabilize support and remove unstable endpoints for [MSC3231](https://github.com/matrix-org/matrix-doc/pull/3231). Clients must switch to the stable identifier and endpoint. See the [upgrade notes](https://matrix-org.github.io/synapse/develop/upgrade#stablisation-of-msc3231) for more information. ([\#11867](https://github.com/matrix-org/synapse/issues/11867))
- Allow modules to retrieve the current instance's server name and worker name. ([\#11868](https://github.com/matrix-org/synapse/issues/11868))
- Use a dedicated configurable rate limiter for 3PID invites. ([\#11892](https://github.com/matrix-org/synapse/issues/11892))
- Support the stable API endpoint for [MSC3283](https://github.com/matrix-org/matrix-doc/pull/3283): new settings in `/capabilities` endpoint. ([\#11933](https://github.com/matrix-org/synapse/issues/11933), [\#11989](https://github.com/matrix-org/synapse/issues/11989))
- Support the `dir` parameter on the `/relations` endpoint, per [MSC3715](https://github.com/matrix-org/matrix-doc/pull/3715). ([\#11941](https://github.com/matrix-org/synapse/issues/11941))
- Experimental implementation of [MSC3706](https://github.com/matrix-org/matrix-doc/pull/3706): extensions to `/send_join` to support reduced response size. ([\#11967](https://github.com/matrix-org/synapse/issues/11967))

Bugfixes
--------

- Fix [MSC2716](https://github.com/matrix-org/matrix-doc/pull/2716) historical messages backfilling in random order on remote homeservers. ([\#11114](https://github.com/matrix-org/synapse/issues/11114))
- Fix a bug introduced in Synapse 1.51.0 where incoming federation transactions containing at least one EDU would be dropped if debug logging was enabled for `synapse.8631_debug`. ([\#11890](https://github.com/matrix-org/synapse/issues/11890))
- Fix a long-standing bug where some unknown endpoints would return HTML error pages instead of JSON `M_UNRECOGNIZED` errors. ([\#11930](https://github.com/matrix-org/synapse/issues/11930))
- Implement an allow list of content types for which we will attempt to preview a URL. This prevents Synapse from making useless longer-lived connections to streaming media servers. ([\#11936](https://github.com/matrix-org/synapse/issues/11936))
- Fix a long-standing bug where pagination tokens from `/sync` and `/messages` could not be provided to the `/relations` API. ([\#11952](https://github.com/matrix-org/synapse/issues/11952))
- Require that modules register their callbacks using keyword arguments. ([\#11975](https://github.com/matrix-org/synapse/issues/11975))
- Fix a long-standing bug where `M_WRONG_ROOM_KEYS_VERSION` errors would not include the specced `current_version` field. ([\#11988](https://github.com/matrix-org/synapse/issues/11988))

Improved Documentation
----------------------

- Fix typo in User Admin API: unpind -> unbind. ([\#11859](https://github.com/matrix-org/synapse/issues/11859))
- Document images returned by the User List Media Admin API can include those generated by URL previews. ([\#11862](https://github.com/matrix-org/synapse/issues/11862))
- Remove outdated MSC1711 FAQ document. ([\#11907](https://github.com/matrix-org/synapse/issues/11907))
- Correct the structured logging configuration example. Contributed by Brad Jones. ([\#11946](https://github.com/matrix-org/synapse/issues/11946))
- Add information on the Synapse release cycle. ([\#11954](https://github.com/matrix-org/synapse/issues/11954))
- Fix broken link in the README to the admin API for password reset. ([\#11955](https://github.com/matrix-org/synapse/issues/11955))

Deprecations and Removals
-------------------------

- Drop support for `webclient` listeners and configuring `web_client_location` to a non-HTTP(S) URL. Deprecated configurations are a configuration error. ([\#11895](https://github.com/matrix-org/synapse/issues/11895))
- Remove deprecated `user_may_create_room_with_invites` spam checker callback. See the [upgrade notes](https://matrix-org.github.io/synapse/latest/upgrade.html#removal-of-user_may_create_room_with_invites) for more information. ([\#11950](https://github.com/matrix-org/synapse/issues/11950))
- No longer build `.deb` packages for Ubuntu 21.04 Hirsute Hippo, which has now EOLed. ([\#11961](https://github.com/matrix-org/synapse/issues/11961))

Internal Changes
----------------

- Enhance user registration test helpers to make them more useful for tests involving application services and devices. ([\#11615](https://github.com/matrix-org/synapse/issues/11615), [\#11616](https://github.com/matrix-org/synapse/issues/11616))
- Improve performance when fetching bundled aggregations for multiple events. ([\#11660](https://github.com/matrix-org/synapse/issues/11660), [\#11752](https://github.com/matrix-org/synapse/issues/11752))
- Fix type errors introduced by new annotations in the Prometheus Client library. ([\#11832](https://github.com/matrix-org/synapse/issues/11832))
- Add missing type hints to replication code. ([\#11856](https://github.com/matrix-org/synapse/issues/11856), [\#11938](https://github.com/matrix-org/synapse/issues/11938))
- Ensure that `opentracing` scopes are activated and closed at the right time. ([\#11869](https://github.com/matrix-org/synapse/issues/11869))
- Improve opentracing for incoming federation requests. ([\#11870](https://github.com/matrix-org/synapse/issues/11870))
- Improve internal docstrings in `synapse.util.caches`. ([\#11876](https://github.com/matrix-org/synapse/issues/11876))
- Do not needlessly clear the `get_users_in_room` and `get_users_in_room_with_profiles` caches when any room state changes. ([\#11878](https://github.com/matrix-org/synapse/issues/11878))
- Convert `ApplicationServiceTestCase` to use `simple_async_mock`. ([\#11880](https://github.com/matrix-org/synapse/issues/11880))
- Remove experimental changes to the default push rules which were introduced in Synapse 1.19.0 but never enabled. ([\#11884](https://github.com/matrix-org/synapse/issues/11884))
- Disable coverage calculation for olddeps build. ([\#11888](https://github.com/matrix-org/synapse/issues/11888))
- Preparation to support sending device list updates to application services. ([\#11905](https://github.com/matrix-org/synapse/issues/11905))
- Add a test that checks users receive their own device list updates down `/sync`. ([\#11909](https://github.com/matrix-org/synapse/issues/11909))
- Run Complement tests sequentially. ([\#11910](https://github.com/matrix-org/synapse/issues/11910))
- Various refactors to the application service notifier code. ([\#11911](https://github.com/matrix-org/synapse/issues/11911), [\#11912](https://github.com/matrix-org/synapse/issues/11912))
- Tests: replace mocked `Authenticator` with the real thing. ([\#11913](https://github.com/matrix-org/synapse/issues/11913))
- Various refactors to the typing notifications code. ([\#11914](https://github.com/matrix-org/synapse/issues/11914))
- Use the proper type for the `Content-Length` header in the `UploadResource`. ([\#11927](https://github.com/matrix-org/synapse/issues/11927))
- Remove an unnecessary ignoring of type hints due to fixes in upstream packages. ([\#11939](https://github.com/matrix-org/synapse/issues/11939))
- Add missing type hints. ([\#11953](https://github.com/matrix-org/synapse/issues/11953))
- Fix an import cycle in `synapse.event_auth`. ([\#11965](https://github.com/matrix-org/synapse/issues/11965))
- Unpin `frozendict` but exclude the known bad version 2.1.2. ([\#11969](https://github.com/matrix-org/synapse/issues/11969))
- Prepare for rename of default Complement branch. ([\#11971](https://github.com/matrix-org/synapse/issues/11971))
- Fetch Synapse's version using a helper from `matrix-common`. ([\#11979](https://github.com/matrix-org/synapse/issues/11979))")`
…

`[85e24d9](/matrix-org/synapse/commit/85e24d9d2bc29280ed3a9d6db3919ff30fc67104)`

```
Synapse 1.53.0rc1 (2022-02-15)
==============================

Features
--------

- Add experimental support for sending to-device messages to application services, as specified by [[MSC2409](https://github.com/matrix-org/matrix-spec-proposals/pull/2409)]([matrix-org/matrix-spec-proposals#2409](https://github.com/matrix-org/matrix-spec-proposals/pull/2409)). ([\[#11215](https://github.com/matrix-org/synapse/pull/11215)]([#11215](https://github.com/matrix-org/synapse/pull/11215)), [\[#11966](https://github.com/matrix-org/synapse/pull/11966)]([#11966](https://github.com/matrix-org/synapse/pull/11966)))
- Remove account data (including client config, push rules and ignored users) upon user deactivation. ([\[#11655](https://github.com/matrix-org/synapse/pull/11655)]([#11655](https://github.com/matrix-org/synapse/pull/11655)))
- Experimental support for [[MSC3666](https://github.com/matrix-org/matrix-spec-proposals/pull/3666)]([matrix-org/matrix-spec-proposals#3666](https://github.com/matrix-org/matrix-spec-proposals/pull/3666)): including bundled aggregations in server side search results. ([\[#11837](https://github.com/matrix-org/synapse/pull/11837)]([#11837](https://github.com/matrix-org/synapse/pull/11837)))
- Enable cache time-based expiry by default. The `expiry_time` config flag has been superseded by `expire_caches` and `cache_entry_ttl`. ([\[#11849](https://github.com/matrix-org/synapse/pull/11849)]([#11849](https://github.com/matrix-org/synapse/pull/11849)))
- Add a callback to allow modules to allow or forbid a 3PID (email address, phone number) from being associated to a local account. ([\[#11854](https://github.com/matrix-org/synapse/pull/11854)]([#11854](https://github.com/matrix-org/synapse/pull/11854)))
- Stabilize support and remove unstable endpoints for [[MSC3231](https://github.com/matrix-org/matrix-spec-proposals/pull/3231)]([matrix-org/matrix-spec-proposals#3231](https://github.com/matrix-org/matrix-spec-proposals/pull/3231)). Clients must switch to the stable identifier and endpoint. See the [upgrade notes](<https://matrix-org.github.io/synapse/develop/upgrade#stablisation-of-msc3231>) for more information. ([\[#11867](https://github.com/matrix-org/synapse/pull/11867)]([#11867](https://github.com/matrix-org/synapse/pull/11867)))
- Allow modules to retrieve the current instance's server name and worker name. ([\[#11868](https://github.com/matrix-org/synapse/pull/11868)]([#11868](https://github.com/matrix-org/synapse/pull/11868)))
- Use a dedicated configurable rate limiter for 3PID invites. ([\[#11892](https://github.com/matrix-org/synapse/pull/11892)]([#11892](https://github.com/matrix-org/synapse/pull/11892)))
- Support the stable API endpoint for [[MSC3283](https://github.com/matrix-org/matrix-spec-proposals/pull/3283)]([matrix-org/matrix-spec-proposals#3283](https://github.com/matrix-org/matrix-spec-proposals/pull/3283)): new settings in `/capabilities` endpoint. ([\[#11933](https://github.com/matrix-org/synapse/pull/11933)]([#11933](https://github.com/matrix-org/synapse/pull/11933)), [\[#11989](https://github.com/matrix-org/synapse/pull/11989)]([#11989](https://github.com/matrix-org/synapse/pull/11989)))
- Support the `dir` parameter on the `/relations` endpoint, per [[MSC3715](https://github.com/matrix-org/matrix-spec-proposals/pull/3715)]([matrix-org/matrix-spec-proposals#3715](https://github.com/matrix-org/matrix-spec-proposals/pull/3715)). ([\[#11941](https://github.com/matrix-org/synapse/pull/11941)]([#11941](https://github.com/matrix-org/synapse/pull/11941)))
- Experimental implementation of [[MSC3706](https://github.com/matrix-org/matrix-spec-proposals/pull/3706)]([matrix-org/matrix-spec-proposals#3706](https://github.com/matrix-org/matrix-spec-proposals/pull/3706)): extensions to `/send_join` to support reduced response size. ([\[#11967](https://github.com/matrix-org/synapse/pull/11967)]([#11967](https://github.com/matrix-org/synapse/pull/11967)))

Bugfixes
--------

- Fix [[MSC2716](https://github.com/matrix-org/matrix-spec-proposals/pull/2716)]([matrix-org/matrix-spec-proposals#2716](https://github.com/matrix-org/matrix-spec-proposals/pull/2716)) historical messages backfilling in random order on remote homeservers. ([\[#11114](https://github.com/matrix-org/synapse/pull/11114)]([#11114](https://github.com/matrix-org/synapse/pull/11114)))
- Fix a bug introduced in Synapse 1.51.0 where incoming federation transactions containing at least one EDU would be dropped if debug logging was enabled for `synapse.8631_debug`. ([\[#11890](https://github.com/matrix-org/synapse/pull/11890)]([#11890](https://github.com/matrix-org/synapse/pull/11890)))
- Fix a long-standing bug where some unknown endpoints would return HTML error pages instead of JSON `M_UNRECOGNIZED` errors. ([\[#11930](https://github.com/matrix-org/synapse/pull/11930)]([#11930](https://github.com/matrix-org/synapse/pull/11930)))
- Implement an allow list of content types for which we will attempt to preview a URL. This prevents Synapse from making useless longer-lived connections to streaming media servers. ([\[#11936](https://github.com/matrix-org/synapse/pull/11936)]([#11936](https://github.com/matrix-org/synapse/pull/11936)))
- Fix a long-standing bug where pagination tokens from `/sync` and `/messages` could not be provided to the `/relations` API. ([\[#11952](https://github.com/matrix-org/synapse/pull/11952)]([#11952](https://github.com/matrix-org/synapse/pull/11952)))
- Require that modules register their callbacks using keyword arguments. ([\[#11975](https://github.com/matrix-org/synapse/pull/11975)]([#11975](https://github.com/matrix-org/synapse/pull/11975)))
- Fix a long-standing bug where `M_WRONG_ROOM_KEYS_VERSION` errors would not include the specced `current_version` field. ([\[#11988](https://github.com/matrix-org/synapse/pull/11988)]([#11988](https://github.com/matrix-org/synapse/pull/11988)))

Improved Documentation
----------------------

- Fix typo in User Admin API: unpind -> unbind. ([\[#11859](https://github.com/matrix-org/synapse/pull/11859)]([#11859](https://github.com/matrix-org/synapse/pull/11859)))
- Document images returned by the User List Media Admin API can include those generated by URL previews. ([\[#11862](https://github.com/matrix-org/synapse/pull/11862)]([#11862](https://github.com/matrix-org/synapse/pull/11862)))
- Remove outdated [MSC1711](https://github.com/matrix-org/matrix-spec-proposals/pull/1711) FAQ document. ([\[#11907](https://github.com/matrix-org/synapse/pull/11907)]([#11907](https://github.com/matrix-org/synapse/pull/11907)))
- Correct the structured logging configuration example. Contributed by Brad Jones. ([\[#11946](https://github.com/matrix-org/synapse/pull/11946)]([#11946](https://github.com/matrix-org/synapse/pull/11946)))
- Add information on the Synapse release cycle. ([\[#11954](https://github.com/matrix-org/synapse/pull/11954)]([#11954](https://github.com/matrix-org/synapse/pull/11954)))
- Fix broken link in the README to the admin API for password reset. ([\[#11955](https://github.com/matrix-org/synapse/pull/11955)]([#11955](https://github.com/matrix-org/synapse/pull/11955)))

Deprecations and Removals
-------------------------

- Drop support for `webclient` listeners and configuring `web_client_location` to a non-HTTP(S) URL. Deprecated configurations are a configuration error. ([\[#11895](https://github.com/matrix-org/synapse/pull/11895)]([#11895](https://github.com/matrix-org/synapse/pull/11895)))
- Remove deprecated `user_may_create_room_with_invites` spam checker callback. See the [upgrade notes](<https://matrix-org.github.io/synapse/latest/upgrade.html#removal-of-user_may_create_room_with_invites>) for more information. ([\[#11950](https://github.com/matrix-org/synapse/pull/11950)]([#11950](https://github.com/matrix-org/synapse/pull/11950)))
- No longer build `.deb` packages for Ubuntu 21.04 Hirsute Hippo, which has now EOLed. ([\[#11961](https://github.com/matrix-org/synapse/pull/11961)]([#11961](https://github.com/matrix-org/synapse/pull/11961)))

Internal Changes
----------------

- Enhance user registration test helpers to make them more useful for tests involving application services and devices. ([\[#11615](https://github.com/matrix-org/synapse/pull/11615)]([#11615](https://github.com/matrix-org/synapse/pull/11615)), [\[#11616](https://github.com/matrix-org/synapse/pull/11616)]([#11616](https://github.com/matrix-org/synapse/pull/11616)))
- Improve performance when fetching bundled aggregations for multiple events. ([\[#11660](https://github.com/matrix-org/synapse/pull/11660)]([#11660](https://github.com/matrix-org/synapse/pull/11660)), [\[#11752](https://github.com/matrix-org/synapse/pull/11752)]([#11752](https://github.com/matrix-org/synapse/pull/11752)))
- Fix type errors introduced by new annotations in the Prometheus Client library. ([\[#11832](https://github.com/matrix-org/synapse/pull/11832)]([#11832](https://github.com/matrix-org/synapse/pull/11832)))
- Add missing type hints to replication code. ([\[#11856](https://github.com/matrix-org/synapse/pull/11856)]([#11856](https://github.com/matrix-org/synapse/pull/11856)), [\[#11938](https://github.com/matrix-org/synapse/pull/11938)]([#11938](https://github.com/matrix-org/synapse/pull/11938)))
- Ensure that `opentracing` scopes are activated and closed at the right time. ([\[#11869](https://github.com/matrix-org/synapse/pull/11869)]([#11869](https://github.com/matrix-org/synapse/pull/11869)))
- Improve opentracing for incoming federation requests. ([\[#11870](https://github.com/matrix-org/synapse/pull/11870)]([#11870](https://github.com/matrix-org/synapse/pull/11870)))
- Improve internal docstrings in `synapse.util.caches`. ([\[#11876](https://github.com/matrix-org/synapse/pull/11876)]([#11876](https://github.com/matrix-org/synapse/pull/11876)))
- Do not needlessly clear the `get_users_in_room` and `get_users_in_room_with_profiles` caches when any room state changes. ([\[#11878](https://github.com/matrix-org/synapse/pull/11878)]([#11878](https://github.com/matrix-org/synapse/pull/11878)))
- Convert `ApplicationServiceTestCase` to use `simple_async_mock`. ([\[#11880](https://github.com/matrix-org/synapse/pull/11880)]([#11880](https://github.com/matrix-org/synapse/pull/11880)))
- Remove experimental changes to the default push rules which were introduced in Synapse 1.19.0 but never enabled. ([\[#11884](https://github.com/matrix-org/synapse/pull/11884)]([#11884](https://github.com/matrix-org/synapse/pull/11884)))
- Disable coverage calculation for olddeps build. ([\[#11888](https://github.com/matrix-org/synapse/pull/11888)]([#11888](https://github.com/matrix-org/synapse/pull/11888)))
- Preparation to support sending device list updates to application services. ([\[#11905](https://github.com/matrix-org/synapse/pull/11905)]([#11905](https://github.com/matrix-org/synapse/pull/11905)))
- Add a test that checks users receive their own device list updates down `/sync`. ([\[#11909](https://github.com/matrix-org/synapse/pull/11909)]([#11909](https://github.com/matrix-org/synapse/pull/11909)))
- Run Complement tests sequentially. ([\[#11910](https://github.com/matrix-org/synapse/pull/11910)]([#11910](https://github.com/matrix-org/synapse/pull/11910)))
- Various refactors to the application service notifier code. ([\[#11911](https://github.com/matrix-org/synapse/pull/11911)]([#11911](https://github.com/matrix-org/synapse/pull/11911)), [\[#11912](https://github.com/matrix-org/synapse/pull/11912)]([#11912](https://github.com/matrix-org/synapse/pull/11912)))
- Tests: replace mocked `Authenticator` with the real thing. ([\[#11913](https://github.com/matrix-org/synapse/pull/11913)]([#11913](https://github.com/matrix-org/synapse/pull/11913)))
- Various refactors to the typing notifications code. ([\[#11914](https://github.com/matrix-org/synapse/pull/11914)]([#11914](https://github.com/matrix-org/synapse/pull/11914)))
- Use the proper type for the `Content-Length` header in the `UploadResource`. ([\[#11927](https://github.com/matrix-org/synapse/pull/11927)]([#11927](https://github.com/matrix-org/synapse/pull/11927)))
- Remove an unnecessary ignoring of type hints due to fixes in upstream packages. ([\[#11939](https://github.com/matrix-org/synapse/pull/11939)]([#11939](https://github.com/matrix-org/synapse/pull/11939)))
- Add missing type hints. ([\[#11953](https://github.com/matrix-org/synapse/pull/11953)]([#11953](https://github.com/matrix-org/synapse/pull/11953)))
- Fix an import cycle in `synapse.event_auth`. ([\[#11965](https://github.com/matrix-org/synapse/pull/11965)]([#11965](https://github.com/matrix-org/synapse/pull/11965)))
- Unpin `frozendict` but exclude the known bad version 2.1.2. ([\[#11969](https://github.com/matrix-org/synapse/pull/11969)]([#11969](https://github.com/matrix-org/synapse/pull/11969)))
- Prepare for rename of default Complement branch. ([\[#11971](https://github.com/matrix-org/synapse/pull/11971)]([#11971](https://github.com/matrix-org/synapse/pull/11971)))
- Fetch Synapse's version using a helper from `matrix-common`. ([\[#11979](https://github.com/matrix-org/synapse/pull/11979)]([#11979](https://github.com/matrix-org/synapse/pull/11979)))
```

[netbsd-srcmastr](/netbsd-srcmastr)
pushed a commit
to NetBSD/pkgsrc
that referenced
this pull request
[Feb 25, 2022](#ref-commit-7750a4e)
[![@Midar](https://avatars.githubusercontent.com/u/752237?s=40&u=81dfb9be718247c7664693c556bf3fdfb6715545&v=4)](/Midar)

`[Update chat/matrix-synapse to 1.53.0](/NetBSD/pkgsrc/commit/7750a4eb491d92446ff41bd9ab2c540846aa25f1 "Update chat/matrix-synapse to 1.53.0

Synapse 1.53.0 (2022-02-22)
===========================

No significant changes.

Synapse 1.53.0rc1 (2022-02-15)
==============================

Features
--------

- Add experimental support for sending to-device messages to application services, as specified by [MSC2409](https://github.com/matrix-org/matrix-doc/pull/2409). ([\#11215](https://github.com/matrix-org/synapse/issues/11215), [\#11966](https://github.com/matrix-org/synapse/issues/11966))
- Remove account data (including client config, push rules and ignored users) upon user deactivation. ([\#11655](https://github.com/matrix-org/synapse/issues/11655))
- Experimental support for [MSC3666](https://github.com/matrix-org/matrix-doc/pull/3666): including bundled aggregations in server side search results. ([\#11837](https://github.com/matrix-org/synapse/issues/11837))
- Enable cache time-based expiry by default. The `expiry_time` config flag has been superseded by `expire_caches` and `cache_entry_ttl`. ([\#11849](https://github.com/matrix-org/synapse/issues/11849))
- Add a callback to allow modules to allow or forbid a 3PID (email address, phone number) from being associated to a local account. ([\#11854](https://github.com/matrix-org/synapse/issues/11854))
- Stabilize support and remove unstable endpoints for [MSC3231](https://github.com/matrix-org/matrix-doc/pull/3231). Clients must switch to the stable identifier and endpoint. See the [upgrade notes](https://matrix-org.github.io/synapse/develop/upgrade#stablisation-of-msc3231) for more information. ([\#11867](https://github.com/matrix-org/synapse/issues/11867))
- Allow modules to retrieve the current instance's server name and worker name. ([\#11868](https://github.com/matrix-org/synapse/issues/11868))
- Use a dedicated configurable rate limiter for 3PID invites. ([\#11892](https://github.com/matrix-org/synapse/issues/11892))
- Support the stable API endpoint for [MSC3283](https://github.com/matrix-org/matrix-doc/pull/3283): new settings in `/capabilities` endpoint. ([\#11933](https://github.com/matrix-org/synapse/issues/11933), [\#11989](https://github.com/matrix-org/synapse/issues/11989))
- Support the `dir` parameter on the `/relations` endpoint, per [MSC3715](https://github.com/matrix-org/matrix-doc/pull/3715). ([\#11941](https://github.com/matrix-org/synapse/issues/11941))
- Experimental implementation of [MSC3706](https://github.com/matrix-org/matrix-doc/pull/3706): extensions to `/send_join` to support reduced response size. ([\#11967](https://github.com/matrix-org/synapse/issues/11967))

Bugfixes
--------

- Fix [MSC2716](https://github.com/matrix-org/matrix-doc/pull/2716) historical messages backfilling in random order on remote homeservers. ([\#11114](https://github.com/matrix-org/synapse/issues/11114))
- Fix a bug introduced in Synapse 1.51.0 where incoming federation transactions containing at least one EDU would be dropped if debug logging was enabled for `synapse.8631_debug`. ([\#11890](https://github.com/matrix-org/synapse/issues/11890))
- Fix a long-standing bug where some unknown endpoints would return HTML error pages instead of JSON `M_UNRECOGNIZED` errors. ([\#11930](https://github.com/matrix-org/synapse/issues/11930))
- Implement an allow list of content types for which we will attempt to preview a URL. This prevents Synapse from making useless longer-lived connections to streaming media servers. ([\#11936](https://github.com/matrix-org/synapse/issues/11936))
- Fix a long-standing bug where pagination tokens from `/sync` and `/messages` could not be provided to the `/relations` API. ([\#11952](https://github.com/matrix-org/synapse/issues/11952))
- Require that modules register their callbacks using keyword arguments. ([\#11975](https://github.com/matrix-org/synapse/issues/11975))
- Fix a long-standing bug where `M_WRONG_ROOM_KEYS_VERSION` errors would not include the specced `current_version` field. ([\#11988](https://github.com/matrix-org/synapse/issues/11988))

Improved Documentation
----------------------

- Fix typo in User Admin API: unpind -> unbind. ([\#11859](https://github.com/matrix-org/synapse/issues/11859))
- Document images returned by the User List Media Admin API can include those generated by URL previews. ([\#11862](https://github.com/matrix-org/synapse/issues/11862))
- Remove outdated MSC1711 FAQ document. ([\#11907](https://github.com/matrix-org/synapse/issues/11907))
- Correct the structured logging configuration example. Contributed by Brad Jones. ([\#11946](https://github.com/matrix-org/synapse/issues/11946))
- Add information on the Synapse release cycle. ([\#11954](https://github.com/matrix-org/synapse/issues/11954))
- Fix broken link in the README to the admin API for password reset. ([\#11955](https://github.com/matrix-org/synapse/issues/11955))

Deprecations and Removals
-------------------------

- Drop support for `webclient` listeners and configuring `web_client_location` to a non-HTTP(S) URL. Deprecated configurations are a configuration error. ([\#11895](https://github.com/matrix-org/synapse/issues/11895))
- Remove deprecated `user_may_create_room_with_invites` spam checker callback. See the [upgrade notes](https://matrix-org.github.io/synapse/latest/upgrade.html#removal-of-user_may_create_room_with_invites) for more information. ([\#11950](https://github.com/matrix-org/synapse/issues/11950))
- No longer build `.deb` packages for Ubuntu 21.04 Hirsute Hippo, which has now EOLed. ([\#11961](https://github.com/matrix-org/synapse/issues/11961))

Internal Changes
----------------

- Enhance user registration test helpers to make them more useful for tests involving application services and devices. ([\#11615](https://github.com/matrix-org/synapse/issues/11615), [\#11616](https://github.com/matrix-org/synapse/issues/11616))
- Improve performance when fetching bundled aggregations for multiple events. ([\#11660](https://github.com/matrix-org/synapse/issues/11660), [\#11752](https://github.com/matrix-org/synapse/issues/11752))
- Fix type errors introduced by new annotations in the Prometheus Client library. ([\#11832](https://github.com/matrix-org/synapse/issues/11832))
- Add missing type hints to replication code. ([\#11856](https://github.com/matrix-org/synapse/issues/11856), [\#11938](https://github.com/matrix-org/synapse/issues/11938))
- Ensure that `opentracing` scopes are activated and closed at the right time. ([\#11869](https://github.com/matrix-org/synapse/issues/11869))
- Improve opentracing for incoming federation requests. ([\#11870](https://github.com/matrix-org/synapse/issues/11870))
- Improve internal docstrings in `synapse.util.caches`. ([\#11876](https://github.com/matrix-org/synapse/issues/11876))
- Do not needlessly clear the `get_users_in_room` and `get_users_in_room_with_profiles` caches when any room state changes. ([\#11878](https://github.com/matrix-org/synapse/issues/11878))
- Convert `ApplicationServiceTestCase` to use `simple_async_mock`. ([\#11880](https://github.com/matrix-org/synapse/issues/11880))
- Remove experimental changes to the default push rules which were introduced in Synapse 1.19.0 but never enabled. ([\#11884](https://github.com/matrix-org/synapse/issues/11884))
- Disable coverage calculation for olddeps build. ([\#11888](https://github.com/matrix-org/synapse/issues/11888))
- Preparation to support sending device list updates to application services. ([\#11905](https://github.com/matrix-org/synapse/issues/11905))
- Add a test that checks users receive their own device list updates down `/sync`. ([\#11909](https://github.com/matrix-org/synapse/issues/11909))
- Run Complement tests sequentially. ([\#11910](https://github.com/matrix-org/synapse/issues/11910))
- Various refactors to the application service notifier code. ([\#11911](https://github.com/matrix-org/synapse/issues/11911), [\#11912](https://github.com/matrix-org/synapse/issues/11912))
- Tests: replace mocked `Authenticator` with the real thing. ([\#11913](https://github.com/matrix-org/synapse/issues/11913))
- Various refactors to the typing notifications code. ([\#11914](https://github.com/matrix-org/synapse/issues/11914))
- Use the proper type for the `Content-Length` header in the `UploadResource`. ([\#11927](https://github.com/matrix-org/synapse/issues/11927))
- Remove an unnecessary ignoring of type hints due to fixes in upstream packages. ([\#11939](https://github.com/matrix-org/synapse/issues/11939))
- Add missing type hints. ([\#11953](https://github.com/matrix-org/synapse/issues/11953))
- Fix an import cycle in `synapse.event_auth`. ([\#11965](https://github.com/matrix-org/synapse/issues/11965))
- Unpin `frozendict` but exclude the known bad version 2.1.2. ([\#11969](https://github.com/matrix-org/synapse/issues/11969))
- Prepare for rename of default Complement branch. ([\#11971](https://github.com/matrix-org/synapse/issues/11971))
- Fetch Synapse's version using a helper from `matrix-common`. ([\#11979](https://github.com/matrix-org/synapse/issues/11979))

Synapse 1.52.0 (2022-02-08)
===========================

No significant changes since 1.52.0rc1.

Note that [Twisted 22.1.0](https://github.com/twisted/twisted/releases/tag/twisted-22.1.0)
has recently been released, which fixes a [security issue](https://github.com/twisted/twisted/security/advisories/GHSA-92x2-jw7w-xvvx)
within the Twisted library. We do not believe Synapse is affected by this vulnerability,
though we advise server administrators who installed Synapse via pip to upgrade Twisted
with `pip install --upgrade Twisted` as a matter of good practice. The Docker image
`matrixdotorg/synapse` and the Debian packages from `packages.matrix.org` are using the
updated library.

Synapse 1.52.0rc1 (2022-02-01)
==============================

Features
--------

- Remove account data (including client config, push rules and ignored users) upon user deactivation. ([\#11621](https://github.com/matrix-org/synapse/issues/11621), [\#11788](https://github.com/matrix-org/synapse/issues/11788), [\#11789](https://github.com/matrix-org/synapse/issues/11789))
- Add an admin API to reset connection timeouts for remote server. ([\#11639](https://github.com/matrix-org/synapse/issues/11639))
- Add an admin API to get a list of rooms that federate with a given remote homeserver. ([\#11658](https://github.com/matrix-org/synapse/issues/11658))
- Add a config flag to inhibit `M_USER_IN_USE` during registration. ([\#11743](https://github.com/matrix-org/synapse/issues/11743))
- Add a module callback to set username at registration. ([\#11790](https://github.com/matrix-org/synapse/issues/11790))
- Allow configuring a maximum file size as well as a list of allowed content types for avatars. ([\#11846](https://github.com/matrix-org/synapse/issues/11846))

Bugfixes
--------

- Include the bundled aggregations in the `/sync` response, per [MSC2675](https://github.com/matrix-org/matrix-doc/pull/2675). ([\#11612](https://github.com/matrix-org/synapse/issues/11612))
- Fix a long-standing bug when previewing Reddit URLs which do not contain an image. ([\#11767](https://github.com/matrix-org/synapse/issues/11767))
- Fix a long-standing bug that media streams could cause long-lived connections when generating URL previews. ([\#11784](https://github.com/matrix-org/synapse/issues/11784))
- Include a `prev_content` field in state events sent to Application Services. Contributed by @totallynotvaishnav. ([\#11798](https://github.com/matrix-org/synapse/issues/11798))
- Fix a bug introduced in Synapse 0.33.3 causing requests to sometimes log strings such as `HTTPStatus.OK` instead of integer status codes. ([\#11827](https://github.com/matrix-org/synapse/issues/11827))

Improved Documentation
----------------------

- Update pypi installation docs to indicate that we now support Python 3.10. ([\#11820](https://github.com/matrix-org/synapse/issues/11820))
- Add missing steps to the contribution submission process in the documentation.  Contributed by @sequentialread. ([\#11821](https://github.com/matrix-org/synapse/issues/11821))
- Remove not needed old table of contents in documentation. ([\#11860](https://github.com/matrix-org/synapse/issues/11860))
- Consolidate the `access_token` information at the top of each relevant page in the Admin API documentation. ([\#11861](https://github.com/matrix-org/synapse/issues/11861))

Deprecations and Removals
-------------------------

- Drop support for Python 3.6, which is EOL. ([\#11683](https://github.com/matrix-org/synapse/issues/11683))
- Remove the `experimental_msc1849_support_enabled` flag as the features are now stable. ([\#11843](https://github.com/matrix-org/synapse/issues/11843))

Internal Changes
----------------

- Preparation for database schema simplifications: add `state_key` and `rejection_reason` columns to `events` table. ([\#11792](https://github.com/matrix-org/synapse/issues/11792))
- Add `FrozenEvent.get_state_key` and use it in a couple of places. ([\#11793](https://github.com/matrix-org/synapse/issues/11793))
- Preparation for database schema simplifications: stop reading from `event_reference_hashes`. ([\#11794](https://github.com/matrix-org/synapse/issues/11794))
- Drop unused table `public_room_list_stream`. ([\#11795](https://github.com/matrix-org/synapse/issues/11795))
- Preparation for reducing Postgres serialization errors: allow setting transaction isolation level. Contributed by Nick @ Beeper. ([\#11799](https://github.com/matrix-org/synapse/issues/11799), [\#11847](https://github.com/matrix-org/synapse/issues/11847))
- Docker: skip the initial amd64-only build and go straight to multiarch. ([\#11810](https://github.com/matrix-org/synapse/issues/11810))
- Run Complement on the Github Actions VM and not inside a Docker container. ([\#11811](https://github.com/matrix-org/synapse/issues/11811))
- Log module names at startup. ([\#11813](https://github.com/matrix-org/synapse/issues/11813))
- Improve type safety of bundled aggregations code. ([\#11815](https://github.com/matrix-org/synapse/issues/11815))
- Correct a type annotation in the event validation logic. ([\#11817](https://github.com/matrix-org/synapse/issues/11817), [\#11830](https://github.com/matrix-org/synapse/issues/11830))
- Minor updates and documentation for database schema delta files. ([\#11823](https://github.com/matrix-org/synapse/issues/11823))
- Workaround a type annotation problem in `prometheus_client` 0.13.0. ([\#11834](https://github.com/matrix-org/synapse/issues/11834))
- Minor performance improvement in room state lookup. ([\#11836](https://github.com/matrix-org/synapse/issues/11836))
- Fix some indentation inconsistencies in the sample config. ([\#11838](https://github.com/matrix-org/synapse/issues/11838))
- Add type hints to `tests/rest/admin`. ([\#11851](https://github.com/matrix-org/synapse/issues/11851))")`
…

`[7750a4e](/NetBSD/pkgsrc/commit/7750a4eb491d92446ff41bd9ab2c540846aa25f1)`

```
Synapse 1.53.0 (2022-02-22)
===========================

No significant changes.

Synapse 1.53.0rc1 (2022-02-15)
==============================

Features
--------

- Add experimental support for sending to-device messages to application services, as specified by [MSC2409]([matrix-org/matrix-spec-proposals#2409](https://github.com/matrix-org/matrix-spec-proposals/pull/2409)). ([\#11215]([matrix-org/synapse#11215](https://github.com/matrix-org/synapse/pull/11215)), [\#11966]([matrix-org/synapse#11966](https://github.com/matrix-org/synapse/pull/11966)))
- Remove account data (including client config, push rules and ignored users) upon user deactivation. ([\#11655]([matrix-org/synapse#11655](https://github.com/matrix-org/synapse/pull/11655)))
- Experimental support for [MSC3666]([matrix-org/matrix-spec-proposals#3666](https://github.com/matrix-org/matrix-spec-proposals/pull/3666)): including bundled aggregations in server side search results. ([\#11837]([matrix-org/synapse#11837](https://github.com/matrix-org/synapse/pull/11837)))
- Enable cache time-based expiry by default. The `expiry_time` config flag has been superseded by `expire_caches` and `cache_entry_ttl`. ([\#11849]([matrix-org/synapse#11849](https://github.com/matrix-org/synapse/pull/11849)))
- Add a callback to allow modules to allow or forbid a 3PID (email address, phone number) from being associated to a local account. ([\#11854]([matrix-org/synapse#11854](https://github.com/matrix-org/synapse/pull/11854)))
- Stabilize support and remove unstable endpoints for [MSC3231]([matrix-org/matrix-spec-proposals#3231](https://github.com/matrix-org/matrix-spec-proposals/pull/3231)). Clients must switch to the stable identifier and endpoint. See the [upgrade notes](<https://matrix-org.github.io/synapse/develop/upgrade#stablisation-of-msc3231>) for more information. ([\#11867]([matrix-org/synapse#11867](https://github.com/matrix-org/synapse/pull/11867)))
- Allow modules to retrieve the current instance's server name and worker name. ([\#11868]([matrix-org/synapse#11868](https://github.com/matrix-org/synapse/pull/11868)))
- Use a dedicated configurable rate limiter for 3PID invites. ([\#11892]([matrix-org/synapse#11892](https://github.com/matrix-org/synapse/pull/11892)))
- Support the stable API endpoint for [MSC3283]([matrix-org/matrix-spec-proposals#3283](https://github.com/matrix-org/matrix-spec-proposals/pull/3283)): new settings in `/capabilities` endpoint. ([\#11933]([matrix-org/synapse#11933](https://github.com/matrix-org/synapse/pull/11933)), [\#11989]([matrix-org/synapse#11989](https://github.com/matrix-org/synapse/pull/11989)))
- Support the `dir` parameter on the `/relations` endpoint, per [MSC3715]([matrix-org/matrix-spec-proposals#3715](https://github.com/matrix-org/matrix-spec-proposals/pull/3715)). ([\#11941]([matrix-org/synapse#11941](https://github.com/matrix-org/synapse/pull/11941)))
- Experimental implementation of [MSC3706]([matrix-org/matrix-spec-proposals#3706](https://github.com/matrix-org/matrix-spec-proposals/pull/3706)): extensions to `/send_join` to support reduced response size. ([\#11967]([matrix-org/synapse#11967](https://github.com/matrix-org/synapse/pull/11967)))

Bugfixes
--------

- Fix [MSC2716]([matrix-org/matrix-spec-proposals#2716](https://github.com/matrix-org/matrix-spec-proposals/pull/2716)) historical messages backfilling in random order on remote homeservers. ([\#11114]([matrix-org/synapse#11114](https://github.com/matrix-org/synapse/pull/11114)))
- Fix a bug introduced in Synapse 1.51.0 where incoming federation transactions containing at least one EDU would be dropped if debug logging was enabled for `synapse.8631_debug`. ([\#11890]([matrix-org/synapse#11890](https://github.com/matrix-org/synapse/pull/11890)))
- Fix a long-standing bug where some unknown endpoints would return HTML error pages instead of JSON `M_UNRECOGNIZED` errors. ([\#11930]([matrix-org/synapse#11930](https://github.com/matrix-org/synapse/pull/11930)))
- Implement an allow list of content types for which we will attempt to preview a URL. This prevents Synapse from making useless longer-lived connections to streaming media servers. ([\#11936]([matrix-org/synapse#11936](https://github.com/matrix-org/synapse/pull/11936)))
- Fix a long-standing bug where pagination tokens from `/sync` and `/messages` could not be provided to the `/relations` API. ([\#11952]([matrix-org/synapse#11952](https://github.com/matrix-org/synapse/pull/11952)))
- Require that modules register their callbacks using keyword arguments. ([\#11975]([matrix-org/synapse#11975](https://github.com/matrix-org/synapse/pull/11975)))
- Fix a long-standing bug where `M_WRONG_ROOM_KEYS_VERSION` errors would not include the specced `current_version` field. ([\#11988]([matrix-org/synapse#11988](https://github.com/matrix-org/synapse/pull/11988)))

Improved Documentation
----------------------

- Fix typo in User Admin API: unpind -> unbind. ([\#11859]([matrix-org/synapse#11859](https://github.com/matrix-org/synapse/pull/11859)))
- Document images returned by the User List Media Admin API can include those generated by URL previews. ([\#11862]([matrix-org/synapse#11862](https://github.com/matrix-org/synapse/pull/11862)))
- Remove outdated MSC1711 FAQ document. ([\#11907]([matrix-org/synapse#11907](https://github.com/matrix-org/synapse/pull/11907)))
- Correct the structured logging configuration example. Contributed by Brad Jones. ([\#11946]([matrix-org/synapse#11946](https://github.com/matrix-org/synapse/pull/11946)))
- Add information on the Synapse release cycle. ([\#11954]([matrix-org/synapse#11954](https://github.com/matrix-org/synapse/pull/11954)))
- Fix broken link in the README to the admin API for password reset. ([\#11955]([matrix-org/synapse#11955](https://github.com/matrix-org/synapse/pull/11955)))

Deprecations and Removals
-------------------------

- Drop support for `webclient` listeners and configuring `web_client_location` to a non-HTTP(S) URL. Deprecated configurations are a configuration error. ([\#11895]([matrix-org/synapse#11895](https://github.com/matrix-org/synapse/pull/11895)))
- Remove deprecated `user_may_create_room_with_invites` spam checker callback. See the [upgrade notes](<https://matrix-org.github.io/synapse/latest/upgrade.html#removal-of-user_may_create_room_with_invites>) for more information. ([\#11950]([matrix-org/synapse#11950](https://github.com/matrix-org/synapse/pull/11950)))
- No longer build `.deb` packages for Ubuntu 21.04 Hirsute Hippo, which has now EOLed. ([\#11961]([matrix-org/synapse#11961](https://github.com/matrix-org/synapse/pull/11961)))

Internal Changes
----------------

- Enhance user registration test helpers to make them more useful for tests involving application services and devices. ([\#11615]([matrix-org/synapse#11615](https://github.com/matrix-org/synapse/pull/11615)), [\#11616]([matrix-org/synapse#11616](https://github.com/matrix-org/synapse/pull/11616)))
- Improve performance when fetching bundled aggregations for multiple events. ([\#11660]([matrix-org/synapse#11660](https://github.com/matrix-org/synapse/pull/11660)), [\#11752]([matrix-org/synapse#11752](https://github.com/matrix-org/synapse/pull/11752)))
- Fix type errors introduced by new annotations in the Prometheus Client library. ([\#11832]([matrix-org/synapse#11832](https://github.com/matrix-org/synapse/pull/11832)))
- Add missing type hints to replication code. ([\#11856]([matrix-org/synapse#11856](https://github.com/matrix-org/synapse/pull/11856)), [\#11938]([matrix-org/synapse#11938](https://github.com/matrix-org/synapse/pull/11938)))
- Ensure that `opentracing` scopes are activated and closed at the right time. ([\#11869]([matrix-org/synapse#11869](https://github.com/matrix-org/synapse/pull/11869)))
- Improve opentracing for incoming federation requests. ([\#11870]([matrix-org/synapse#11870](https://github.com/matrix-org/synapse/pull/11870)))
- Improve internal docstrings in `synapse.util.caches`. ([\#11876]([matrix-org/synapse#11876](https://github.com/matrix-org/synapse/pull/11876)))
- Do not needlessly clear the `get_users_in_room` and `get_users_in_room_with_profiles` caches when any room state changes. ([\#11878]([matrix-org/synapse#11878](https://github.com/matrix-org/synapse/pull/11878)))
- Convert `ApplicationServiceTestCase` to use `simple_async_mock`. ([\#11880]([matrix-org/synapse#11880](https://github.com/matrix-org/synapse/pull/11880)))
- Remove experimental changes to the default push rules which were introduced in Synapse 1.19.0 but never enabled. ([\#11884]([matrix-org/synapse#11884](https://github.com/matrix-org/synapse/pull/11884)))
- Disable coverage calculation for olddeps build. ([\#11888]([matrix-org/synapse#11888](https://github.com/matrix-org/synapse/pull/11888)))
- Preparation to support sending device list updates to application services. ([\#11905]([matrix-org/synapse#11905](https://github.com/matrix-org/synapse/pull/11905)))
- Add a test that checks users receive their own device list updates down `/sync`. ([\#11909]([matrix-org/synapse#11909](https://github.com/matrix-org/synapse/pull/11909)))
- Run Complement tests sequentially. ([\#11910]([matrix-org/synapse#11910](https://github.com/matrix-org/synapse/pull/11910)))
- Various refactors to the application service notifier code. ([\#11911]([matrix-org/synapse#11911](https://github.com/matrix-org/synapse/pull/11911)), [\#11912]([matrix-org/synapse#11912](https://github.com/matrix-org/synapse/pull/11912)))
- Tests: replace mocked `Authenticator` with the real thing. ([\#11913]([matrix-org/synapse#11913](https://github.com/matrix-org/synapse/pull/11913)))
- Various refactors to the typing notifications code. ([\#11914]([matrix-org/synapse#11914](https://github.com/matrix-org/synapse/pull/11914)))
- Use the proper type for the `Content-Length` header in the `UploadResource`. ([\#11927]([matrix-org/synapse#11927](https://github.com/matrix-org/synapse/pull/11927)))
- Remove an unnecessary ignoring of type hints due to fixes in upstream packages. ([\#11939]([matrix-org/synapse#11939](https://github.com/matrix-org/synapse/pull/11939)))
- Add missing type hints. ([\#11953]([matrix-org/synapse#11953](https://github.com/matrix-org/synapse/pull/11953)))
- Fix an import cycle in `synapse.event_auth`. ([\#11965]([matrix-org/synapse#11965](https://github.com/matrix-org/synapse/pull/11965)))
- Unpin `frozendict` but exclude the known bad version 2.1.2. ([\#11969]([matrix-org/synapse#11969](https://github.com/matrix-org/synapse/pull/11969)))
- Prepare for rename of default Complement branch. ([\#11971]([matrix-org/synapse#11971](https://github.com/matrix-org/synapse/pull/11971)))
- Fetch Synapse's version using a helper from `matrix-common`. ([\#11979]([matrix-org/synapse#11979](https://github.com/matrix-org/synapse/pull/11979)))

Synapse 1.52.0 (2022-02-08)
===========================

No significant changes since 1.52.0rc1.

Note that [Twisted 22.1.0](<https://github.com/twisted/twisted/releases/tag/twisted-22.1.0>)
has recently been released, which fixes a [security issue]([GHSA-92x2-jw7w-xvvx](https://github.com/twisted/twisted/security/advisories/GHSA-92x2-jw7w-xvvx "GHSA-92x2-jw7w-xvvx"))
within the Twisted library. We do not believe Synapse is affected by this vulnerability,
though we advise server administrators who installed Synapse via pip to upgrade Twisted
with `pip install --upgrade Twisted` as a matter of good practice. The Docker image
`matrixdotorg/synapse` and the Debian packages from `packages.matrix.org` are using the
updated library.

Synapse 1.52.0rc1 (2022-02-01)
==============================

Features
--------

- Remove account data (including client config, push rules and ignored users) upon user deactivation. ([\#11621]([matrix-org/synapse#11621](https://github.com/matrix-org/synapse/pull/11621)), [\#11788]([matrix-org/synapse#11788](https://github.com/matrix-org/synapse/pull/11788)), [\#11789]([matrix-org/synapse#11789](https://github.com/matrix-org/synapse/pull/11789)))
- Add an admin API to reset connection timeouts for remote server. ([\#11639]([matrix-org/synapse#11639](https://github.com/matrix-org/synapse/pull/11639)))
- Add an admin API to get a list of rooms that federate with a given remote homeserver. ([\#11658]([matrix-org/synapse#11658](https://github.com/matrix-org/synapse/pull/11658)))
- Add a config flag to inhibit `M_USER_IN_USE` during registration. ([\#11743]([matrix-org/synapse#11743](https://github.com/matrix-org/synapse/pull/11743)))
- Add a module callback to set username at registration. ([\#11790]([matrix-org/synapse#11790](https://github.com/matrix-org/synapse/pull/11790)))
- Allow configuring a maximum file size as well as a list of allowed content types for avatars. ([\#11846]([matrix-org/synapse#11846](https://github.com/matrix-org/synapse/pull/11846)))

Bugfixes
--------

- Include the bundled aggregations in the `/sync` response, per [MSC2675]([matrix-org/matrix-spec-proposals#2675](https://github.com/matrix-org/matrix-spec-proposals/pull/2675)). ([\#11612]([matrix-org/synapse#11612](https://github.com/matrix-org/synapse/pull/11612)))
- Fix a long-standing bug when previewing Reddit URLs which do not contain an image. ([\#11767]([matrix-org/synapse#11767](https://github.com/matrix-org/synapse/pull/11767)))
- Fix a long-standing bug that media streams could cause long-lived connections when generating URL previews. ([\#11784]([matrix-org/synapse#11784](https://github.com/matrix-org/synapse/pull/11784)))
- Include a `prev_content` field in state events sent to Application Services. Contributed by [@totallynotvaishnav](https://github.com/totallynotvaishnav). ([\#11798]([matrix-org/synapse#11798](https://github.com/matrix-org/synapse/pull/11798)))
- Fix a bug introduced in Synapse 0.33.3 causing requests to sometimes log strings such as `HTTPStatus.OK` instead of integer status codes. ([\#11827]([matrix-org/synapse#11827](https://github.com/matrix-org/synapse/pull/11827)))

Improved Documentation
----------------------

- Update pypi installation docs to indicate that we now support Python 3.10. ([\#11820]([matrix-org/synapse#11820](https://github.com/matrix-org/synapse/pull/11820)))
- Add missing steps to the contribution submission process in the documentation.  Contributed by [@sequentialread](https://github.com/sequentialread). ([\#11821]([matrix-org/synapse#11821](https://github.com/matrix-org/synapse/pull/11821)))
- Remove not needed old table of contents in documentation. ([\#11860]([matrix-org/synapse#11860](https://github.com/matrix-org/synapse/pull/11860)))
- Consolidate the `access_token` information at the top of each relevant page in the Admin API documentation. ([\#11861]([matrix-org/synapse#11861](https://github.com/matrix-org/synapse/pull/11861)))

Deprecations and Removals
-------------------------

- Drop support for Python 3.6, which is EOL. ([\#11683]([matrix-org/synapse#11683](https://github.com/matrix-org/synapse/pull/11683)))
- Remove the `experimental_msc1849_support_enabled` flag as the features are now stable. ([\#11843]([matrix-org/synapse#11843](https://github.com/matrix-org/synapse/pull/11843)))

Internal Changes
----------------

- Preparation for database schema simplifications: add `state_key` and `rejection_reason` columns to `events` table. ([\#11792]([matrix-org/synapse#11792](https://github.com/matrix-org/synapse/pull/11792)))
- Add `FrozenEvent.get_state_key` and use it in a couple of places. ([\#11793]([matrix-org/synapse#11793](https://github.com/matrix-org/synapse/pull/11793)))
- Preparation for database schema simplifications: stop reading from `event_reference_hashes`. ([\#11794]([matrix-org/synapse#11794](https://github.com/matrix-org/synapse/pull/11794)))
- Drop unused table `public_room_list_stream`. ([\#11795]([matrix-org/synapse#11795](https://github.com/matrix-org/synapse/pull/11795)))
- Preparation for reducing Postgres serialization errors: allow setting transaction isolation level. Contributed by Nick @ Beeper. ([\#11799]([matrix-org/synapse#11799](https://github.com/matrix-org/synapse/pull/11799)), [\#11847]([matrix-org/synapse#11847](https://github.com/matrix-org/synapse/pull/11847)))
- Docker: skip the initial amd64-only build and go straight to multiarch. ([\#11810]([matrix-org/synapse#11810](https://github.com/matrix-org/synapse/pull/11810)))
- Run Complement on the Github Actions VM and not inside a Docker container. ([\#11811]([matrix-org/synapse#11811](https://github.com/matrix-org/synapse/pull/11811)))
- Log module names at startup. ([\#11813]([matrix-org/synapse#11813](https://github.com/matrix-org/synapse/pull/11813)))
- Improve type safety of bundled aggregations code. ([\#11815]([matrix-org/synapse#11815](https://github.com/matrix-org/synapse/pull/11815)))
- Correct a type annotation in the event validation logic. ([\#11817]([matrix-org/synapse#11817](https://github.com/matrix-org/synapse/pull/11817)), [\#11830]([matrix-org/synapse#11830](https://github.com/matrix-org/synapse/pull/11830)))
- Minor updates and documentation for database schema delta files. ([\#11823]([matrix-org/synapse#11823](https://github.com/matrix-org/synapse/pull/11823)))
- Workaround a type annotation problem in `prometheus_client` 0.13.0. ([\#11834]([matrix-org/synapse#11834](https://github.com/matrix-org/synapse/pull/11834)))
- Minor performance improvement in room state lookup. ([\#11836]([matrix-org/synapse#11836](https://github.com/matrix-org/synapse/pull/11836)))
- Fix some indentation inconsistencies in the sample config. ([\#11838]([matrix-org/synapse#11838](https://github.com/matrix-org/synapse/pull/11838)))
- Add type hints to `tests/rest/admin`. ([\#11851]([matrix-org/synapse#11851](https://github.com/matrix-org/synapse/pull/11851)))
```

[Fizzadar](/Fizzadar)
added a commit
to Fizzadar/synapse
that referenced
this pull request
[Mar 7, 2022](#ref-commit-2c92316)
[![@Fizzadar](https://avatars.githubusercontent.com/u/1026154?s=40&u=cf88c4d140704f56347ca70c0812610b99a3365b&v=4)](/Fizzadar)

`[Merge tag 'v1.53.0' into beeper-master](/Fizzadar/synapse/commit/2c92316b4f3c5f7cfa0015d2fd39efde66ddb7ad "Merge tag 'v1.53.0' into beeper-master

Synapse 1.53.0 (2022-02-22)
===========================

No significant changes.

Synapse 1.53.0rc1 (2022-02-15)
==============================

Features
--------

- Add experimental support for sending to-device messages to application services, as specified by [MSC2409](https://github.com/matrix-org/matrix-doc/pull/2409). ([\#11215](https://github.com/matrix-org/synapse/issues/11215), [\#11966](https://github.com/matrix-org/synapse/issues/11966))
- Remove account data (including client config, push rules and ignored users) upon user deactivation. ([\#11655](https://github.com/matrix-org/synapse/issues/11655))
- Experimental support for [MSC3666](https://github.com/matrix-org/matrix-doc/pull/3666): including bundled aggregations in server side search results. ([\#11837](https://github.com/matrix-org/synapse/issues/11837))
- Enable cache time-based expiry by default. The `expiry_time` config flag has been superseded by `expire_caches` and `cache_entry_ttl`. ([\#11849](https://github.com/matrix-org/synapse/issues/11849))
- Add a callback to allow modules to allow or forbid a 3PID (email address, phone number) from being associated to a local account. ([\#11854](https://github.com/matrix-org/synapse/issues/11854))
- Stabilize support and remove unstable endpoints for [MSC3231](https://github.com/matrix-org/matrix-doc/pull/3231). Clients must switch to the stable identifier and endpoint. See the [upgrade notes](https://matrix-org.github.io/synapse/develop/upgrade#stablisation-of-msc3231) for more information. ([\#11867](https://github.com/matrix-org/synapse/issues/11867))
- Allow modules to retrieve the current instance's server name and worker name. ([\#11868](https://github.com/matrix-org/synapse/issues/11868))
- Use a dedicated configurable rate limiter for 3PID invites. ([\#11892](https://github.com/matrix-org/synapse/issues/11892))
- Support the stable API endpoint for [MSC3283](https://github.com/matrix-org/matrix-doc/pull/3283): new settings in `/capabilities` endpoint. ([\#11933](https://github.com/matrix-org/synapse/issues/11933), [\#11989](https://github.com/matrix-org/synapse/issues/11989))
- Support the `dir` parameter on the `/relations` endpoint, per [MSC3715](https://github.com/matrix-org/matrix-doc/pull/3715). ([\#11941](https://github.com/matrix-org/synapse/issues/11941))
- Experimental implementation of [MSC3706](https://github.com/matrix-org/matrix-doc/pull/3706): extensions to `/send_join` to support reduced response size. ([\#11967](https://github.com/matrix-org/synapse/issues/11967))

Bugfixes
--------

- Fix [MSC2716](https://github.com/matrix-org/matrix-doc/pull/2716) historical messages backfilling in random order on remote homeservers. ([\#11114](https://github.com/matrix-org/synapse/issues/11114))
- Fix a bug introduced in Synapse 1.51.0 where incoming federation transactions containing at least one EDU would be dropped if debug logging was enabled for `synapse.8631_debug`. ([\#11890](https://github.com/matrix-org/synapse/issues/11890))
- Fix a long-standing bug where some unknown endpoints would return HTML error pages instead of JSON `M_UNRECOGNIZED` errors. ([\#11930](https://github.com/matrix-org/synapse/issues/11930))
- Implement an allow list of content types for which we will attempt to preview a URL. This prevents Synapse from making useless longer-lived connections to streaming media servers. ([\#11936](https://github.com/matrix-org/synapse/issues/11936))
- Fix a long-standing bug where pagination tokens from `/sync` and `/messages` could not be provided to the `/relations` API. ([\#11952](https://github.com/matrix-org/synapse/issues/11952))
- Require that modules register their callbacks using keyword arguments. ([\#11975](https://github.com/matrix-org/synapse/issues/11975))
- Fix a long-standing bug where `M_WRONG_ROOM_KEYS_VERSION` errors would not include the specced `current_version` field. ([\#11988](https://github.com/matrix-org/synapse/issues/11988))

Improved Documentation
----------------------

- Fix typo in User Admin API: unpind -> unbind. ([\#11859](https://github.com/matrix-org/synapse/issues/11859))
- Document images returned by the User List Media Admin API can include those generated by URL previews. ([\#11862](https://github.com/matrix-org/synapse/issues/11862))
- Remove outdated MSC1711 FAQ document. ([\#11907](https://github.com/matrix-org/synapse/issues/11907))
- Correct the structured logging configuration example. Contributed by Brad Jones. ([\#11946](https://github.com/matrix-org/synapse/issues/11946))
- Add information on the Synapse release cycle. ([\#11954](https://github.com/matrix-org/synapse/issues/11954))
- Fix broken link in the README to the admin API for password reset. ([\#11955](https://github.com/matrix-org/synapse/issues/11955))

Deprecations and Removals
-------------------------

- Drop support for `webclient` listeners and configuring `web_client_location` to a non-HTTP(S) URL. Deprecated configurations are a configuration error. ([\#11895](https://github.com/matrix-org/synapse/issues/11895))
- Remove deprecated `user_may_create_room_with_invites` spam checker callback. See the [upgrade notes](https://matrix-org.github.io/synapse/latest/upgrade.html#removal-of-user_may_create_room_with_invites) for more information. ([\#11950](https://github.com/matrix-org/synapse/issues/11950))
- No longer build `.deb` packages for Ubuntu 21.04 Hirsute Hippo, which has now EOLed. ([\#11961](https://github.com/matrix-org/synapse/issues/11961))

Internal Changes
----------------

- Enhance user registration test helpers to make them more useful for tests involving application services and devices. ([\#11615](https://github.com/matrix-org/synapse/issues/11615), [\#11616](https://github.com/matrix-org/synapse/issues/11616))
- Improve performance when fetching bundled aggregations for multiple events. ([\#11660](https://github.com/matrix-org/synapse/issues/11660), [\#11752](https://github.com/matrix-org/synapse/issues/11752))
- Fix type errors introduced by new annotations in the Prometheus Client library. ([\#11832](https://github.com/matrix-org/synapse/issues/11832))
- Add missing type hints to replication code. ([\#11856](https://github.com/matrix-org/synapse/issues/11856), [\#11938](https://github.com/matrix-org/synapse/issues/11938))
- Ensure that `opentracing` scopes are activated and closed at the right time. ([\#11869](https://github.com/matrix-org/synapse/issues/11869))
- Improve opentracing for incoming federation requests. ([\#11870](https://github.com/matrix-org/synapse/issues/11870))
- Improve internal docstrings in `synapse.util.caches`. ([\#11876](https://github.com/matrix-org/synapse/issues/11876))
- Do not needlessly clear the `get_users_in_room` and `get_users_in_room_with_profiles` caches when any room state changes. ([\#11878](https://github.com/matrix-org/synapse/issues/11878))
- Convert `ApplicationServiceTestCase` to use `simple_async_mock`. ([\#11880](https://github.com/matrix-org/synapse/issues/11880))
- Remove experimental changes to the default push rules which were introduced in Synapse 1.19.0 but never enabled. ([\#11884](https://github.com/matrix-org/synapse/issues/11884))
- Disable coverage calculation for olddeps build. ([\#11888](https://github.com/matrix-org/synapse/issues/11888))
- Preparation to support sending device list updates to application services. ([\#11905](https://github.com/matrix-org/synapse/issues/11905))
- Add a test that checks users receive their own device list updates down `/sync`. ([\#11909](https://github.com/matrix-org/synapse/issues/11909))
- Run Complement tests sequentially. ([\#11910](https://github.com/matrix-org/synapse/issues/11910))
- Various refactors to the application service notifier code. ([\#11911](https://github.com/matrix-org/synapse/issues/11911), [\#11912](https://github.com/matrix-org/synapse/issues/11912))
- Tests: replace mocked `Authenticator` with the real thing. ([\#11913](https://github.com/matrix-org/synapse/issues/11913))
- Various refactors to the typing notifications code. ([\#11914](https://github.com/matrix-org/synapse/issues/11914))
- Use the proper type for the `Content-Length` header in the `UploadResource`. ([\#11927](https://github.com/matrix-org/synapse/issues/11927))
- Remove an unnecessary ignoring of type hints due to fixes in upstream packages. ([\#11939](https://github.com/matrix-org/synapse/issues/11939))
- Add missing type hints. ([\#11953](https://github.com/matrix-org/synapse/issues/11953))
- Fix an import cycle in `synapse.event_auth`. ([\#11965](https://github.com/matrix-org/synapse/issues/11965))
- Unpin `frozendict` but exclude the known bad version 2.1.2. ([\#11969](https://github.com/matrix-org/synapse/issues/11969))
- Prepare for rename of default Complement branch. ([\#11971](https://github.com/matrix-org/synapse/issues/11971))
- Fetch Synapse's version using a helper from `matrix-common`. ([\#11979](https://github.com/matrix-org/synapse/issues/11979))")`
…

`[2c92316](/Fizzadar/synapse/commit/2c92316b4f3c5f7cfa0015d2fd39efde66ddb7ad)`

```
Synapse 1.53.0 (2022-02-22)
===========================

No significant changes.

Synapse 1.53.0rc1 (2022-02-15)
==============================

Features
--------

- Add experimental support for sending to-device messages to application services, as specified by [MSC2409]([matrix-org/matrix-spec-proposals#2409](https://github.com/matrix-org/matrix-spec-proposals/pull/2409)). ([\[matrix-org#11215](https://github.com/matrix-org/synapse/pull/11215)]([matrix-org#11215](https://github.com/matrix-org/synapse/pull/11215)), [\[matrix-org#11966](https://github.com/matrix-org/synapse/pull/11966)]([matrix-org#11966](https://github.com/matrix-org/synapse/pull/11966)))
- Remove account data (including client config, push rules and ignored users) upon user deactivation. ([\[matrix-org#11655](https://github.com/matrix-org/synapse/pull/11655)]([matrix-org#11655](https://github.com/matrix-org/synapse/pull/11655)))
- Experimental support for [MSC3666]([matrix-org/matrix-spec-proposals#3666](https://github.com/matrix-org/matrix-spec-proposals/pull/3666)): including bundled aggregations in server side search results. ([\[matrix-org#11837](https://github.com/matrix-org/synapse/pull/11837)]([matrix-org#11837](https://github.com/matrix-org/synapse/pull/11837)))
- Enable cache time-based expiry by default. The `expiry_time` config flag has been superseded by `expire_caches` and `cache_entry_ttl`. ([\[matrix-org#11849](https://github.com/matrix-org/synapse/pull/11849)]([matrix-org#11849](https://github.com/matrix-org/synapse/pull/11849)))
- Add a callback to allow modules to allow or forbid a 3PID (email address, phone number) from being associated to a local account. ([\[matrix-org#11854](https://github.com/matrix-org/synapse/pull/11854)]([matrix-org#11854](https://github.com/matrix-org/synapse/pull/11854)))
- Stabilize support and remove unstable endpoints for [MSC3231]([matrix-org/matrix-spec-proposals#3231](https://github.com/matrix-org/matrix-spec-proposals/pull/3231)). Clients must switch to the stable identifier and endpoint. See the [upgrade notes](<https://matrix-org.github.io/synapse/develop/upgrade#stablisation-of-msc3231>) for more information. ([\[matrix-org#11867](https://github.com/matrix-org/synapse/pull/11867)]([matrix-org#11867](https://github.com/matrix-org/synapse/pull/11867)))
- Allow modules to retrieve the current instance's server name and worker name. ([\[matrix-org#11868](https://github.com/matrix-org/synapse/pull/11868)]([matrix-org#11868](https://github.com/matrix-org/synapse/pull/11868)))
- Use a dedicated configurable rate limiter for 3PID invites. ([\[matrix-org#11892](https://github.com/matrix-org/synapse/pull/11892)]([matrix-org#11892](https://github.com/matrix-org/synapse/pull/11892)))
- Support the stable API endpoint for [MSC3283]([matrix-org/matrix-spec-proposals#3283](https://github.com/matrix-org/matrix-spec-proposals/pull/3283)): new settings in `/capabilities` endpoint. ([\[matrix-org#11933](https://github.com/matrix-org/synapse/pull/11933)]([matrix-org#11933](https://github.com/matrix-org/synapse/pull/11933)), [\[matrix-org#11989](https://github.com/matrix-org/synapse/pull/11989)]([matrix-org#11989](https://github.com/matrix-org/synapse/pull/11989)))
- Support the `dir` parameter on the `/relations` endpoint, per [MSC3715]([matrix-org/matrix-spec-proposals#3715](https://github.com/matrix-org/matrix-spec-proposals/pull/3715)). ([\[matrix-org#11941](https://github.com/matrix-org/synapse/pull/11941)]([matrix-org#11941](https://github.com/matrix-org/synapse/pull/11941)))
- Experimental implementation of [MSC3706]([matrix-org/matrix-spec-proposals#3706](https://github.com/matrix-org/matrix-spec-proposals/pull/3706)): extensions to `/send_join` to support reduced response size. ([\[matrix-org#11967](https://github.com/matrix-org/synapse/pull/11967)]([matrix-org#11967](https://github.com/matrix-org/synapse/pull/11967)))

Bugfixes
--------

- Fix [MSC2716]([matrix-org/matrix-spec-proposals#2716](https://github.com/matrix-org/matrix-spec-proposals/pull/2716)) historical messages backfilling in random order on remote homeservers. ([\[matrix-org#11114](https://github.com/matrix-org/synapse/pull/11114)]([matrix-org#11114](https://github.com/matrix-org/synapse/pull/11114)))
- Fix a bug introduced in Synapse 1.51.0 where incoming federation transactions containing at least one EDU would be dropped if debug logging was enabled for `synapse.8631_debug`. ([\[matrix-org#11890](https://github.com/matrix-org/synapse/pull/11890)]([matrix-org#11890](https://github.com/matrix-org/synapse/pull/11890)))
- Fix a long-standing bug where some unknown endpoints would return HTML error pages instead of JSON `M_UNRECOGNIZED` errors. ([\[matrix-org#11930](https://github.com/matrix-org/synapse/pull/11930)]([matrix-org#11930](https://github.com/matrix-org/synapse/pull/11930)))
- Implement an allow list of content types for which we will attempt to preview a URL. This prevents Synapse from making useless longer-lived connections to streaming media servers. ([\[matrix-org#11936](https://github.com/matrix-org/synapse/pull/11936)]([matrix-org#11936](https://github.com/matrix-org/synapse/pull/11936)))
- Fix a long-standing bug where pagination tokens from `/sync` and `/messages` could not be provided to the `/relations` API. ([\[matrix-org#11952](https://github.com/matrix-org/synapse/pull/11952)]([matrix-org#11952](https://github.com/matrix-org/synapse/pull/11952)))
- Require that modules register their callbacks using keyword arguments. ([\[matrix-org#11975](https://github.com/matrix-org/synapse/pull/11975)]([matrix-org#11975](https://github.com/matrix-org/synapse/pull/11975)))
- Fix a long-standing bug where `M_WRONG_ROOM_KEYS_VERSION` errors would not include the specced `current_version` field. ([\[matrix-org#11988](https://github.com/matrix-org/synapse/pull/11988)]([matrix-org#11988](https://github.com/matrix-org/synapse/pull/11988)))

Improved Documentation
----------------------

- Fix typo in User Admin API: unpind -> unbind. ([\[matrix-org#11859](https://github.com/matrix-org/synapse/pull/11859)]([matrix-org#11859](https://github.com/matrix-org/synapse/pull/11859)))
- Document images returned by the User List Media Admin API can include those generated by URL previews. ([\[matrix-org#11862](https://github.com/matrix-org/synapse/pull/11862)]([matrix-org#11862](https://github.com/matrix-org/synapse/pull/11862)))
- Remove outdated MSC1711 FAQ document. ([\[matrix-org#11907](https://github.com/matrix-org/synapse/pull/11907)]([matrix-org#11907](https://github.com/matrix-org/synapse/pull/11907)))
- Correct the structured logging configuration example. Contributed by Brad Jones. ([\[matrix-org#11946](https://github.com/matrix-org/synapse/pull/11946)]([matrix-org#11946](https://github.com/matrix-org/synapse/pull/11946)))
- Add information on the Synapse release cycle. ([\[matrix-org#11954](https://github.com/matrix-org/synapse/pull/11954)]([matrix-org#11954](https://github.com/matrix-org/synapse/pull/11954)))
- Fix broken link in the README to the admin API for password reset. ([\[matrix-org#11955](https://github.com/matrix-org/synapse/pull/11955)]([matrix-org#11955](https://github.com/matrix-org/synapse/pull/11955)))

Deprecations and Removals
-------------------------

- Drop support for `webclient` listeners and configuring `web_client_location` to a non-HTTP(S) URL. Deprecated configurations are a configuration error. ([\[matrix-org#11895](https://github.com/matrix-org/synapse/pull/11895)]([matrix-org#11895](https://github.com/matrix-org/synapse/pull/11895)))
- Remove deprecated `user_may_create_room_with_invites` spam checker callback. See the [upgrade notes](<https://matrix-org.github.io/synapse/latest/upgrade.html#removal-of-user_may_create_room_with_invites>) for more information. ([\[matrix-org#11950](https://github.com/matrix-org/synapse/pull/11950)]([matrix-org#11950](https://github.com/matrix-org/synapse/pull/11950)))
- No longer build `.deb` packages for Ubuntu 21.04 Hirsute Hippo, which has now EOLed. ([\[matrix-org#11961](https://github.com/matrix-org/synapse/pull/11961)]([matrix-org#11961](https://github.com/matrix-org/synapse/pull/11961)))

Internal Changes
----------------

- Enhance user registration test helpers to make them more useful for tests involving application services and devices. ([\[matrix-org#11615](https://github.com/matrix-org/synapse/pull/11615)]([matrix-org#11615](https://github.com/matrix-org/synapse/pull/11615)), [\[matrix-org#11616](https://github.com/matrix-org/synapse/pull/11616)]([matrix-org#11616](https://github.com/matrix-org/synapse/pull/11616)))
- Improve performance when fetching bundled aggregations for multiple events. ([\[matrix-org#11660](https://github.com/matrix-org/synapse/pull/11660)]([matrix-org#11660](https://github.com/matrix-org/synapse/pull/11660)), [\[matrix-org#11752](https://github.com/matrix-org/synapse/pull/11752)]([matrix-org#11752](https://github.com/matrix-org/synapse/pull/11752)))
- Fix type errors introduced by new annotations in the Prometheus Client library. ([\[matrix-org#11832](https://github.com/matrix-org/synapse/pull/11832)]([matrix-org#11832](https://github.com/matrix-org/synapse/pull/11832)))
- Add missing type hints to replication code. ([\[matrix-org#11856](https://github.com/matrix-org/synapse/pull/11856)]([matrix-org#11856](https://github.com/matrix-org/synapse/pull/11856)), [\[matrix-org#11938](https://github.com/matrix-org/synapse/pull/11938)]([matrix-org#11938](https://github.com/matrix-org/synapse/pull/11938)))
- Ensure that `opentracing` scopes are activated and closed at the right time. ([\[matrix-org#11869](https://github.com/matrix-org/synapse/pull/11869)]([matrix-org#11869](https://github.com/matrix-org/synapse/pull/11869)))
- Improve opentracing for incoming federation requests. ([\[matrix-org#11870](https://github.com/matrix-org/synapse/pull/11870)]([matrix-org#11870](https://github.com/matrix-org/synapse/pull/11870)))
- Improve internal docstrings in `synapse.util.caches`. ([\[matrix-org#11876](https://github.com/matrix-org/synapse/pull/11876)]([matrix-org#11876](https://github.com/matrix-org/synapse/pull/11876)))
- Do not needlessly clear the `get_users_in_room` and `get_users_in_room_with_profiles` caches when any room state changes. ([\[matrix-org#11878](https://github.com/matrix-org/synapse/pull/11878)]([matrix-org#11878](https://github.com/matrix-org/synapse/pull/11878)))
- Convert `ApplicationServiceTestCase` to use `simple_async_mock`. ([\[matrix-org#11880](https://github.com/matrix-org/synapse/pull/11880)]([matrix-org#11880](https://github.com/matrix-org/synapse/pull/11880)))
- Remove experimental changes to the default push rules which were introduced in Synapse 1.19.0 but never enabled. ([\[matrix-org#11884](https://github.com/matrix-org/synapse/pull/11884)]([matrix-org#11884](https://github.com/matrix-org/synapse/pull/11884)))
- Disable coverage calculation for olddeps build. ([\[matrix-org#11888](https://github.com/matrix-org/synapse/pull/11888)]([matrix-org#11888](https://github.com/matrix-org/synapse/pull/11888)))
- Preparation to support sending device list updates to application services. ([\[matrix-org#11905](https://github.com/matrix-org/synapse/pull/11905)]([matrix-org#11905](https://github.com/matrix-org/synapse/pull/11905)))
- Add a test that checks users receive their own device list updates down `/sync`. ([\[matrix-org#11909](https://github.com/matrix-org/synapse/pull/11909)]([matrix-org#11909](https://github.com/matrix-org/synapse/pull/11909)))
- Run Complement tests sequentially. ([\[matrix-org#11910](https://github.com/matrix-org/synapse/pull/11910)]([matrix-org#11910](https://github.com/matrix-org/synapse/pull/11910)))
- Various refactors to the application service notifier code. ([\[matrix-org#11911](https://github.com/matrix-org/synapse/pull/11911)]([matrix-org#11911](https://github.com/matrix-org/synapse/pull/11911)), [\[matrix-org#11912](https://github.com/matrix-org/synapse/pull/11912)]([matrix-org#11912](https://github.com/matrix-org/synapse/pull/11912)))
- Tests: replace mocked `Authenticator` with the real thing. ([\[matrix-org#11913](https://github.com/matrix-org/synapse/pull/11913)]([matrix-org#11913](https://github.com/matrix-org/synapse/pull/11913)))
- Various refactors to the typing notifications code. ([\[matrix-org#11914](https://github.com/matrix-org/synapse/pull/11914)]([matrix-org#11914](https://github.com/matrix-org/synapse/pull/11914)))
- Use the proper type for the `Content-Length` header in the `UploadResource`. ([\[matrix-org#11927](https://github.com/matrix-org/synapse/pull/11927)]([matrix-org#11927](https://github.com/matrix-org/synapse/pull/11927)))
- Remove an unnecessary ignoring of type hints due to fixes in upstream packages. ([\[matrix-org#11939](https://github.com/matrix-org/synapse/pull/11939)]([matrix-org#11939](https://github.com/matrix-org/synapse/pull/11939)))
- Add missing type hints. ([\[matrix-org#11953](https://github.com/matrix-org/synapse/pull/11953)]([matrix-org#11953](https://github.com/matrix-org/synapse/pull/11953)))
- Fix an import cycle in `synapse.event_auth`. ([\[matrix-org#11965](https://github.com/matrix-org/synapse/pull/11965)]([matrix-org#11965](https://github.com/matrix-org/synapse/pull/11965)))
- Unpin `frozendict` but exclude the known bad version 2.1.2. ([\[matrix-org#11969](https://github.com/matrix-org/synapse/pull/11969)]([matrix-org#11969](https://github.com/matrix-org/synapse/pull/11969)))
- Prepare for rename of default Complement branch. ([\[matrix-org#11971](https://github.com/matrix-org/synapse/pull/11971)]([matrix-org#11971](https://github.com/matrix-org/synapse/pull/11971)))
- Fetch Synapse's version using a helper from `matrix-common`. ([\[matrix-org#11979](https://github.com/matrix-org/synapse/pull/11979)]([matrix-org#11979](https://github.com/matrix-org/synapse/pull/11979)))
```

[babolivier](/babolivier)
added a commit
to matrix-org/synapse-dinsic
that referenced
this pull request
[Apr 28, 2022](#ref-commit-c3ee93e)
[![@babolivier](https://avatars.githubusercontent.com/u/5547783?s=40&u=f8390e1de97d5774bfa58788553a8cb987c53f98&v=4)](/babolivier)

`[Merge tag 'v1.53.0' into babolivier/dinsic_1.58](/matrix-org/synapse-dinsic/commit/c3ee93e2a81e985deb2b34aac88b0e40d8b3aff3 "Merge tag 'v1.53.0' into babolivier/dinsic_1.58

Synapse 1.53.0 (2022-02-22)
===========================

No significant changes.

Synapse 1.53.0rc1 (2022-02-15)
==============================

Features
--------

- Add experimental support for sending to-device messages to application services, as specified by [MSC2409](https://github.com/matrix-org/matrix-doc/pull/2409). ([\#11215](https://github.com/matrix-org/synapse/issues/11215), [\#11966](https://github.com/matrix-org/synapse/issues/11966))
- Remove account data (including client config, push rules and ignored users) upon user deactivation. ([\#11655](https://github.com/matrix-org/synapse/issues/11655))
- Experimental support for [MSC3666](https://github.com/matrix-org/matrix-doc/pull/3666): including bundled aggregations in server side search results. ([\#11837](https://github.com/matrix-org/synapse/issues/11837))
- Enable cache time-based expiry by default. The `expiry_time` config flag has been superseded by `expire_caches` and `cache_entry_ttl`. ([\#11849](https://github.com/matrix-org/synapse/issues/11849))
- Add a callback to allow modules to allow or forbid a 3PID (email address, phone number) from being associated to a local account. ([\#11854](https://github.com/matrix-org/synapse/issues/11854))
- Stabilize support and remove unstable endpoints for [MSC3231](https://github.com/matrix-org/matrix-doc/pull/3231). Clients must switch to the stable identifier and endpoint. See the [upgrade notes](https://matrix-org.github.io/synapse/develop/upgrade#stablisation-of-msc3231) for more information. ([\#11867](https://github.com/matrix-org/synapse/issues/11867))
- Allow modules to retrieve the current instance's server name and worker name. ([\#11868](https://github.com/matrix-org/synapse/issues/11868))
- Use a dedicated configurable rate limiter for 3PID invites. ([\#11892](https://github.com/matrix-org/synapse/issues/11892))
- Support the stable API endpoint for [MSC3283](https://github.com/matrix-org/matrix-doc/pull/3283): new settings in `/capabilities` endpoint. ([\#11933](https://github.com/matrix-org/synapse/issues/11933), [\#11989](https://github.com/matrix-org/synapse/issues/11989))
- Support the `dir` parameter on the `/relations` endpoint, per [MSC3715](https://github.com/matrix-org/matrix-doc/pull/3715). ([\#11941](https://github.com/matrix-org/synapse/issues/11941))
- Experimental implementation of [MSC3706](https://github.com/matrix-org/matrix-doc/pull/3706): extensions to `/send_join` to support reduced response size. ([\#11967](https://github.com/matrix-org/synapse/issues/11967))

Bugfixes
--------

- Fix [MSC2716](https://github.com/matrix-org/matrix-doc/pull/2716) historical messages backfilling in random order on remote homeservers. ([\#11114](https://github.com/matrix-org/synapse/issues/11114))
- Fix a bug introduced in Synapse 1.51.0 where incoming federation transactions containing at least one EDU would be dropped if debug logging was enabled for `synapse.8631_debug`. ([\#11890](https://github.com/matrix-org/synapse/issues/11890))
- Fix a long-standing bug where some unknown endpoints would return HTML error pages instead of JSON `M_UNRECOGNIZED` errors. ([\#11930](https://github.com/matrix-org/synapse/issues/11930))
- Implement an allow list of content types for which we will attempt to preview a URL. This prevents Synapse from making useless longer-lived connections to streaming media servers. ([\#11936](https://github.com/matrix-org/synapse/issues/11936))
- Fix a long-standing bug where pagination tokens from `/sync` and `/messages` could not be provided to the `/relations` API. ([\#11952](https://github.com/matrix-org/synapse/issues/11952))
- Require that modules register their callbacks using keyword arguments. ([\#11975](https://github.com/matrix-org/synapse/issues/11975))
- Fix a long-standing bug where `M_WRONG_ROOM_KEYS_VERSION` errors would not include the specced `current_version` field. ([\#11988](https://github.com/matrix-org/synapse/issues/11988))

Improved Documentation
----------------------

- Fix typo in User Admin API: unpind -> unbind. ([\#11859](https://github.com/matrix-org/synapse/issues/11859))
- Document images returned by the User List Media Admin API can include those generated by URL previews. ([\#11862](https://github.com/matrix-org/synapse/issues/11862))
- Remove outdated MSC1711 FAQ document. ([\#11907](https://github.com/matrix-org/synapse/issues/11907))
- Correct the structured logging configuration example. Contributed by Brad Jones. ([\#11946](https://github.com/matrix-org/synapse/issues/11946))
- Add information on the Synapse release cycle. ([\#11954](https://github.com/matrix-org/synapse/issues/11954))
- Fix broken link in the README to the admin API for password reset. ([\#11955](https://github.com/matrix-org/synapse/issues/11955))

Deprecations and Removals
-------------------------

- Drop support for `webclient` listeners and configuring `web_client_location` to a non-HTTP(S) URL. Deprecated configurations are a configuration error. ([\#11895](https://github.com/matrix-org/synapse/issues/11895))
- Remove deprecated `user_may_create_room_with_invites` spam checker callback. See the [upgrade notes](https://matrix-org.github.io/synapse/latest/upgrade.html#removal-of-user_may_create_room_with_invites) for more information. ([\#11950](https://github.com/matrix-org/synapse/issues/11950))
- No longer build `.deb` packages for Ubuntu 21.04 Hirsute Hippo, which has now EOLed. ([\#11961](https://github.com/matrix-org/synapse/issues/11961))

Internal Changes
----------------

- Enhance user registration test helpers to make them more useful for tests involving application services and devices. ([\#11615](https://github.com/matrix-org/synapse/issues/11615), [\#11616](https://github.com/matrix-org/synapse/issues/11616))
- Improve performance when fetching bundled aggregations for multiple events. ([\#11660](https://github.com/matrix-org/synapse/issues/11660), [\#11752](https://github.com/matrix-org/synapse/issues/11752))
- Fix type errors introduced by new annotations in the Prometheus Client library. ([\#11832](https://github.com/matrix-org/synapse/issues/11832))
- Add missing type hints to replication code. ([\#11856](https://github.com/matrix-org/synapse/issues/11856), [\#11938](https://github.com/matrix-org/synapse/issues/11938))
- Ensure that `opentracing` scopes are activated and closed at the right time. ([\#11869](https://github.com/matrix-org/synapse/issues/11869))
- Improve opentracing for incoming federation requests. ([\#11870](https://github.com/matrix-org/synapse/issues/11870))
- Improve internal docstrings in `synapse.util.caches`. ([\#11876](https://github.com/matrix-org/synapse/issues/11876))
- Do not needlessly clear the `get_users_in_room` and `get_users_in_room_with_profiles` caches when any room state changes. ([\#11878](https://github.com/matrix-org/synapse/issues/11878))
- Convert `ApplicationServiceTestCase` to use `simple_async_mock`. ([\#11880](https://github.com/matrix-org/synapse/issues/11880))
- Remove experimental changes to the default push rules which were introduced in Synapse 1.19.0 but never enabled. ([\#11884](https://github.com/matrix-org/synapse/issues/11884))
- Disable coverage calculation for olddeps build. ([\#11888](https://github.com/matrix-org/synapse/issues/11888))
- Preparation to support sending device list updates to application services. ([\#11905](https://github.com/matrix-org/synapse/issues/11905))
- Add a test that checks users receive their own device list updates down `/sync`. ([\#11909](https://github.com/matrix-org/synapse/issues/11909))
- Run Complement tests sequentially. ([\#11910](https://github.com/matrix-org/synapse/issues/11910))
- Various refactors to the application service notifier code. ([\#11911](https://github.com/matrix-org/synapse/issues/11911), [\#11912](https://github.com/matrix-org/synapse/issues/11912))
- Tests: replace mocked `Authenticator` with the real thing. ([\#11913](https://github.com/matrix-org/synapse/issues/11913))
- Various refactors to the typing notifications code. ([\#11914](https://github.com/matrix-org/synapse/issues/11914))
- Use the proper type for the `Content-Length` header in the `UploadResource`. ([\#11927](https://github.com/matrix-org/synapse/issues/11927))
- Remove an unnecessary ignoring of type hints due to fixes in upstream packages. ([\#11939](https://github.com/matrix-org/synapse/issues/11939))
- Add missing type hints. ([\#11953](https://github.com/matrix-org/synapse/issues/11953))
- Fix an import cycle in `synapse.event_auth`. ([\#11965](https://github.com/matrix-org/synapse/issues/11965))
- Unpin `frozendict` but exclude the known bad version 2.1.2. ([\#11969](https://github.com/matrix-org/synapse/issues/11969))
- Prepare for rename of default Complement branch. ([\#11971](https://github.com/matrix-org/synapse/issues/11971))
- Fetch Synapse's version using a helper from `matrix-common`. ([\#11979](https://github.com/matrix-org/synapse/issues/11979))")`
…

`[c3ee93e](/matrix-org/synapse-dinsic/commit/c3ee93e2a81e985deb2b34aac88b0e40d8b3aff3)`

```
Synapse 1.53.0 (2022-02-22)
===========================

No significant changes.

Synapse 1.53.0rc1 (2022-02-15)
==============================

Features
--------

- Add experimental support for sending to-device messages to application services, as specified by [MSC2409]([matrix-org/matrix-spec-proposals#2409](https://github.com/matrix-org/matrix-spec-proposals/pull/2409)). ([\#11215]([matrix-org/synapse#11215](https://github.com/matrix-org/synapse/pull/11215)), [\#11966]([matrix-org/synapse#11966](https://github.com/matrix-org/synapse/pull/11966)))
- Remove account data (including client config, push rules and ignored users) upon user deactivation. ([\#11655]([matrix-org/synapse#11655](https://github.com/matrix-org/synapse/pull/11655)))
- Experimental support for [MSC3666]([matrix-org/matrix-spec-proposals#3666](https://github.com/matrix-org/matrix-spec-proposals/pull/3666)): including bundled aggregations in server side search results. ([\#11837]([matrix-org/synapse#11837](https://github.com/matrix-org/synapse/pull/11837)))
- Enable cache time-based expiry by default. The `expiry_time` config flag has been superseded by `expire_caches` and `cache_entry_ttl`. ([\#11849]([matrix-org/synapse#11849](https://github.com/matrix-org/synapse/pull/11849)))
- Add a callback to allow modules to allow or forbid a 3PID (email address, phone number) from being associated to a local account. ([\#11854]([matrix-org/synapse#11854](https://github.com/matrix-org/synapse/pull/11854)))
- Stabilize support and remove unstable endpoints for [MSC3231]([matrix-org/matrix-spec-proposals#3231](https://github.com/matrix-org/matrix-spec-proposals/pull/3231)). Clients must switch to the stable identifier and endpoint. See the [upgrade notes](<https://matrix-org.github.io/synapse/develop/upgrade#stablisation-of-msc3231>) for more information. ([\#11867]([matrix-org/synapse#11867](https://github.com/matrix-org/synapse/pull/11867)))
- Allow modules to retrieve the current instance's server name and worker name. ([\#11868]([matrix-org/synapse#11868](https://github.com/matrix-org/synapse/pull/11868)))
- Use a dedicated configurable rate limiter for 3PID invites. ([\#11892]([matrix-org/synapse#11892](https://github.com/matrix-org/synapse/pull/11892)))
- Support the stable API endpoint for [MSC3283]([matrix-org/matrix-spec-proposals#3283](https://github.com/matrix-org/matrix-spec-proposals/pull/3283)): new settings in `/capabilities` endpoint. ([\#11933]([matrix-org/synapse#11933](https://github.com/matrix-org/synapse/pull/11933)), [\#11989]([matrix-org/synapse#11989](https://github.com/matrix-org/synapse/pull/11989)))
- Support the `dir` parameter on the `/relations` endpoint, per [MSC3715]([matrix-org/matrix-spec-proposals#3715](https://github.com/matrix-org/matrix-spec-proposals/pull/3715)). ([\#11941]([matrix-org/synapse#11941](https://github.com/matrix-org/synapse/pull/11941)))
- Experimental implementation of [MSC3706]([matrix-org/matrix-spec-proposals#3706](https://github.com/matrix-org/matrix-spec-proposals/pull/3706)): extensions to `/send_join` to support reduced response size. ([\#11967]([matrix-org/synapse#11967](https://github.com/matrix-org/synapse/pull/11967)))

Bugfixes
--------

- Fix [MSC2716]([matrix-org/matrix-spec-proposals#2716](https://github.com/matrix-org/matrix-spec-proposals/pull/2716)) historical messages backfilling in random order on remote homeservers. ([\#11114]([matrix-org/synapse#11114](https://github.com/matrix-org/synapse/pull/11114)))
- Fix a bug introduced in Synapse 1.51.0 where incoming federation transactions containing at least one EDU would be dropped if debug logging was enabled for `synapse.8631_debug`. ([\#11890]([matrix-org/synapse#11890](https://github.com/matrix-org/synapse/pull/11890)))
- Fix a long-standing bug where some unknown endpoints would return HTML error pages instead of JSON `M_UNRECOGNIZED` errors. ([\#11930]([matrix-org/synapse#11930](https://github.com/matrix-org/synapse/pull/11930)))
- Implement an allow list of content types for which we will attempt to preview a URL. This prevents Synapse from making useless longer-lived connections to streaming media servers. ([\#11936]([matrix-org/synapse#11936](https://github.com/matrix-org/synapse/pull/11936)))
- Fix a long-standing bug where pagination tokens from `/sync` and `/messages` could not be provided to the `/relations` API. ([\#11952]([matrix-org/synapse#11952](https://github.com/matrix-org/synapse/pull/11952)))
- Require that modules register their callbacks using keyword arguments. ([\#11975]([matrix-org/synapse#11975](https://github.com/matrix-org/synapse/pull/11975)))
- Fix a long-standing bug where `M_WRONG_ROOM_KEYS_VERSION` errors would not include the specced `current_version` field. ([\#11988]([matrix-org/synapse#11988](https://github.com/matrix-org/synapse/pull/11988)))

Improved Documentation
----------------------

- Fix typo in User Admin API: unpind -> unbind. ([\#11859]([matrix-org/synapse#11859](https://github.com/matrix-org/synapse/pull/11859)))
- Document images returned by the User List Media Admin API can include those generated by URL previews. ([\#11862]([matrix-org/synapse#11862](https://github.com/matrix-org/synapse/pull/11862)))
- Remove outdated MSC1711 FAQ document. ([\#11907]([matrix-org/synapse#11907](https://github.com/matrix-org/synapse/pull/11907)))
- Correct the structured logging configuration example. Contributed by Brad Jones. ([\#11946]([matrix-org/synapse#11946](https://github.com/matrix-org/synapse/pull/11946)))
- Add information on the Synapse release cycle. ([\#11954]([matrix-org/synapse#11954](https://github.com/matrix-org/synapse/pull/11954)))
- Fix broken link in the README to the admin API for password reset. ([\#11955]([matrix-org/synapse#11955](https://github.com/matrix-org/synapse/pull/11955)))

Deprecations and Removals
-------------------------

- Drop support for `webclient` listeners and configuring `web_client_location` to a non-HTTP(S) URL. Deprecated configurations are a configuration error. ([\#11895]([matrix-org/synapse#11895](https://github.com/matrix-org/synapse/pull/11895)))
- Remove deprecated `user_may_create_room_with_invites` spam checker callback. See the [upgrade notes](<https://matrix-org.github.io/synapse/latest/upgrade.html#removal-of-user_may_create_room_with_invites>) for more information. ([\#11950]([matrix-org/synapse#11950](https://github.com/matrix-org/synapse/pull/11950)))
- No longer build `.deb` packages for Ubuntu 21.04 Hirsute Hippo, which has now EOLed. ([\#11961]([matrix-org/synapse#11961](https://github.com/matrix-org/synapse/pull/11961)))

Internal Changes
----------------

- Enhance user registration test helpers to make them more useful for tests involving application services and devices. ([\#11615]([matrix-org/synapse#11615](https://github.com/matrix-org/synapse/pull/11615)), [\#11616]([matrix-org/synapse#11616](https://github.com/matrix-org/synapse/pull/11616)))
- Improve performance when fetching bundled aggregations for multiple events. ([\#11660]([matrix-org/synapse#11660](https://github.com/matrix-org/synapse/pull/11660)), [\#11752]([matrix-org/synapse#11752](https://github.com/matrix-org/synapse/pull/11752)))
- Fix type errors introduced by new annotations in the Prometheus Client library. ([\#11832]([matrix-org/synapse#11832](https://github.com/matrix-org/synapse/pull/11832)))
- Add missing type hints to replication code. ([\#11856]([matrix-org/synapse#11856](https://github.com/matrix-org/synapse/pull/11856)), [\#11938]([matrix-org/synapse#11938](https://github.com/matrix-org/synapse/pull/11938)))
- Ensure that `opentracing` scopes are activated and closed at the right time. ([\#11869]([matrix-org/synapse#11869](https://github.com/matrix-org/synapse/pull/11869)))
- Improve opentracing for incoming federation requests. ([\#11870]([matrix-org/synapse#11870](https://github.com/matrix-org/synapse/pull/11870)))
- Improve internal docstrings in `synapse.util.caches`. ([\#11876]([matrix-org/synapse#11876](https://github.com/matrix-org/synapse/pull/11876)))
- Do not needlessly clear the `get_users_in_room` and `get_users_in_room_with_profiles` caches when any room state changes. ([\#11878]([matrix-org/synapse#11878](https://github.com/matrix-org/synapse/pull/11878)))
- Convert `ApplicationServiceTestCase` to use `simple_async_mock`. ([\#11880]([matrix-org/synapse#11880](https://github.com/matrix-org/synapse/pull/11880)))
- Remove experimental changes to the default push rules which were introduced in Synapse 1.19.0 but never enabled. ([\#11884]([matrix-org/synapse#11884](https://github.com/matrix-org/synapse/pull/11884)))
- Disable coverage calculation for olddeps build. ([\#11888]([matrix-org/synapse#11888](https://github.com/matrix-org/synapse/pull/11888)))
- Preparation to support sending device list updates to application services. ([\#11905]([matrix-org/synapse#11905](https://github.com/matrix-org/synapse/pull/11905)))
- Add a test that checks users receive their own device list updates down `/sync`. ([\#11909]([matrix-org/synapse#11909](https://github.com/matrix-org/synapse/pull/11909)))
- Run Complement tests sequentially. ([\#11910]([matrix-org/synapse#11910](https://github.com/matrix-org/synapse/pull/11910)))
- Various refactors to the application service notifier code. ([\#11911]([matrix-org/synapse#11911](https://github.com/matrix-org/synapse/pull/11911)), [\#11912]([matrix-org/synapse#11912](https://github.com/matrix-org/synapse/pull/11912)))
- Tests: replace mocked `Authenticator` with the real thing. ([\#11913]([matrix-org/synapse#11913](https://github.com/matrix-org/synapse/pull/11913)))
- Various refactors to the typing notifications code. ([\#11914]([matrix-org/synapse#11914](https://github.com/matrix-org/synapse/pull/11914)))
- Use the proper type for the `Content-Length` header in the `UploadResource`. ([\#11927]([matrix-org/synapse#11927](https://github.com/matrix-org/synapse/pull/11927)))
- Remove an unnecessary ignoring of type hints due to fixes in upstream packages. ([\#11939]([matrix-org/synapse#11939](https://github.com/matrix-org/synapse/pull/11939)))
- Add missing type hints. ([\#11953]([matrix-org/synapse#11953](https://github.com/matrix-org/synapse/pull/11953)))
- Fix an import cycle in `synapse.event_auth`. ([\#11965]([matrix-org/synapse#11965](https://github.com/matrix-org/synapse/pull/11965)))
- Unpin `frozendict` but exclude the known bad version 2.1.2. ([\#11969]([matrix-org/synapse#11969](https://github.com/matrix-org/synapse/pull/11969)))
- Prepare for rename of default Complement branch. ([\#11971]([matrix-org/synapse#11971](https://github.com/matrix-org/synapse/pull/11971)))
- Fetch Synapse's version using a helper from `matrix-common`. ([\#11979]([matrix-org/synapse#11979](https://github.com/matrix-org/synapse/pull/11979)))
```

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F11936).

Reviewers

[![@anarcat](https://avatars.githubusercontent.com/u/796623?s=40&v=4)](/anarcat) [anarcat](/anarcat)

anarcat left review comments

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep) [clokep](/clokep)

clokep approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=52&v=4)](/dkasak) [![@jvoisin](https://avatars.githubusercontent.com/u/325724?s=52&v=4)](/jvoisin) [![@anarcat](https://avatars.githubusercontent.com/u/796623?s=52&v=4)](/anarcat) [![@clokep](https://avatars.githubusercontent.com/u/517124?s=52&v=4)](/clokep)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

