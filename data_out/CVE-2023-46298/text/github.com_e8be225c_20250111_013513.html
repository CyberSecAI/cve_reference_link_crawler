
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fissues%2F45301)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fissues%2F45301)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=vercel%2Fnext.js)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vercel](/vercel)
/
**[next.js](/vercel/next.js)**
Public

* [Notifications](/login?return_to=%2Fvercel%2Fnext.js) You must be signed in to change notification settings
* [Fork
  27.4k](/login?return_to=%2Fvercel%2Fnext.js)
* [Star
   128k](/login?return_to=%2Fvercel%2Fnext.js)

* [Code](/vercel/next.js)
* [Issues
  3.1k](/vercel/next.js/issues)
* [Pull requests
  614](/vercel/next.js/pulls)
* [Discussions](/vercel/next.js/discussions)
* [Actions](/vercel/next.js/actions)
* [Security](/vercel/next.js/security)
* [Insights](/vercel/next.js/pulse)

Additional navigation options

* [Code](/vercel/next.js)
* [Issues](/vercel/next.js/issues)
* [Pull requests](/vercel/next.js/pulls)
* [Discussions](/vercel/next.js/discussions)
* [Actions](/vercel/next.js/actions)
* [Security](/vercel/next.js/security)
* [Insights](/vercel/next.js/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fvercel%2Fnext.js%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fvercel%2Fnext.js%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Missing cache control directive for server side props response when using middleware and prefetch #45301

Closed

1 task done

[muntamala](/muntamala) opened this issue
Jan 26, 2023
¬∑ 2 comments
 ¬∑ Fixed by [#54732](https://github.com/vercel/next.js/pull/54732)

Closed

1 task done

# [Missing cache control directive for server side props response when using middleware and prefetch](#top) #45301

[muntamala](/muntamala) opened this issue
Jan 26, 2023
¬∑ 2 comments
 ¬∑ Fixed by [#54732](https://github.com/vercel/next.js/pull/54732)

Labels
[bug](/vercel/next.js/labels/bug)
Issue was opened via the bug report template.
[locked](/vercel/next.js/labels/locked)

## Comments

[![@muntamala](https://avatars.githubusercontent.com/u/5222232?s=80&u=d67eb15c3c976775c9860851782e0f4abc6872a5&v=4)](/muntamala)

Copy link

### **[muntamala](/muntamala)** commented [Jan 26, 2023](#issue-1558118133)

| Verify canary release  * I verified that the issue exists in the latest Next.js canary release  Provide environment information ``` Operating System:   Platform: darwin   Arch: arm64   Version: Darwin Kernel Version 22.2.0: Fri Nov 11 02:03:51 PST 2022; root:xnu-8792.61.2~4/RELEASE_ARM64_T6000 Binaries:   Node: 16.19.0   npm: 9.4.0   Yarn: 1.22.19   pnpm: 7.26.0 Relevant packages:   next: 13.1.6-canary.1   eslint-config-next: 13.1.5   react: 18.2.0   react-dom: 18.2.0  ``` Which area(s) of Next.js are affected? (leave empty if unsure) Data fetching (gS(S)P, getInitialProps) Link to the code that reproduces this issue <https://github.com/muntamala/nextjs-no-cache-issue> To Reproduce Run the server in production mode  ``` yarn yarn build yarn start  ```  and navigate to <http://localhost:3000/>. Observer the network for example with chrome developer tools. When loading the static home page the app also prefetches the ssr pages json. What the response for the SSR page json is missing is cache-control no-cache directive. Navigating to the ssr page results in the ssr pages json being re-fetched and this time it does include the no-cache directive but if there would be a caching element in between like a CDN then we would not hit the actual api until the empty cached response expires. Describe the Bug Prefetch of data for SSR pages returning empty object without a cache-control header having no-cache directive. This can potentially cause issues with CDNs as it did in our case. For example CloudFront having a default TTL value of higher than 0, which by default is 24h, would result in the CDN caching the empty response. The empty cached response would then be served by the CDN when user navigates to the SSR page and the page tries to fetch server side props using the same URL (.../ssr.json)  The enabler for this behaviour seems to be using a middleware. If a middleware (middleware.ts) is present then the prefetch for pages is done separately for each page whose path is present on the page via Link component (prefetch true). Expected Behavior I'd expect next.js to behave sensibly in terms of cache control and set no-cache directive for getServerSideProps as stated in next.js documentation:  ``` If the page uses getServerSideProps or getInitialProps, it will use the default Cache-Control header set by next start in order to prevent accidental caching of responses that cannot be cached. If you want a different cache behavior while  using getServerSideProps, use res.setHeader('Cache-Control', 'value_you_prefer') inside of the function as shown above.  ``` Which browser are you using? (if relevant) Google Chrome 109.0.5414.119 (Official Build) (arm64) How are you deploying your application? (if relevant) yarn build, yarn start |
| --- |
| The text was updated successfully, but these errors were encountered: |

 üëç
5
 ttristan, Threefields, casperiv0, mattvb91, and remorses reacted with thumbs up emoji

All reactions

* üëç
  5 reactions

[![@muntamala](https://avatars.githubusercontent.com/u/5222232?s=40&u=d67eb15c3c976775c9860851782e0f4abc6872a5&v=4)](/muntamala)
[muntamala](/muntamala)
added
the
[bug](/vercel/next.js/labels/bug)
Issue was opened via the bug report template.
label
[Jan 26, 2023](#event-8363893349)

[![@mattvb91](https://avatars.githubusercontent.com/u/11991564?s=80&u=6ba28aaeebf45ab3e05021cf1cd353678f759c9b&v=4)](/mattvb91)

Copy link

### **[mattvb91](/mattvb91)** commented [Jul 22, 2023](#issuecomment-1646555925)

| have you managed to find a fix for this? This is a massive issue that next is taking away header control |
| --- |

 üëÄ
1
 dbo reacted with eyes emoji

All reactions

* üëÄ
  1 reaction

Sorry, something went wrong.

[![@remorses](https://avatars.githubusercontent.com/u/31321188?s=40&v=4)](/remorses)
[remorses](/remorses)
mentioned this issue
[Aug 29, 2023](#ref-pullrequest-1872182656)

[Add cache control header for prefetch empty responses
#54732](/vercel/next.js/pull/54732)
 Merged

[![@kodiakhq](https://avatars.githubusercontent.com/in/29196?s=40&v=4)](/apps/kodiakhq)
[kodiakhq](/apps/kodiakhq)
bot
closed this as [completed](/vercel/next.js/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#54732](/vercel/next.js/pull/54732)
[Aug 29, 2023](#event-10225446483)

[kodiakhq](/apps/kodiakhq) bot
pushed a commit
that referenced
this issue
[Aug 29, 2023](#ref-commit-20d0595)
[![@remorses](https://avatars.githubusercontent.com/u/31321188?s=40&u=98d0726a329d89e8486ec9eb4ff8085dcb220110&v=4)](/remorses)

`[Add cache control header for prefetch empty responses (](/vercel/next.js/commit/20d05958ff853e9c9e42139ffec294336881c648 "Add cache control header for prefetch empty responses (#54732)

Fix #45301

If you deploy Next.js with in front Cloudflare, empty prefetch responses will be cached because there is no `cache-control` header and the extension is .json, Cloudflare considers these requests cacheable assets

If you want a test for this I would like to know if there is an existing one where I can add the header check")[#54732](https://github.com/vercel/next.js/pull/54732)[)](/vercel/next.js/commit/20d05958ff853e9c9e42139ffec294336881c648 "Add cache control header for prefetch empty responses (#54732)

Fix #45301

If you deploy Next.js with in front Cloudflare, empty prefetch responses will be cached because there is no `cache-control` header and the extension is .json, Cloudflare considers these requests cacheable assets

If you want a test for this I would like to know if there is an existing one where I can add the header check")`
‚Ä¶

`[20d0595](/vercel/next.js/commit/20d05958ff853e9c9e42139ffec294336881c648)`

```
Fix [#45301](https://github.com/vercel/next.js/issues/45301)

If you deploy Next.js with in front Cloudflare, empty prefetch responses will be cached because there is no `cache-control` header and the extension is .json, Cloudflare considers these requests cacheable assets

If you want a test for this I would like to know if there is an existing one where I can add the header check
```

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=80&v=4)](/apps/github-actions)

Copy link

Contributor

### **[github-actions](/apps/github-actions) bot** commented [Sep 13, 2023](#issuecomment-1716740176)

| This closed issue has been automatically locked because it had no new activity for 2 weeks. If you are running into a similar issue, please create a new issue with the steps to reproduce. Thank you. |
| --- |

All reactions

Sorry, something went wrong.

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
added
the
[locked](/vercel/next.js/labels/locked)
label
[Sep 13, 2023](#event-10353225529)

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
locked as **resolved** and limited conversation to collaborators
[Sep 13, 2023](#event-10353225556)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fissues%2F45301).

Assignees

No one assigned

Labels

[bug](/vercel/next.js/labels/bug)
Issue was opened via the bug report template.
[locked](/vercel/next.js/labels/locked)

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [Add cache control header for prefetch empty responses](/vercel/next.js/pull/54732)
 [remorses/next.js](/remorses/next.js)

2 participants

[![@muntamala](https://avatars.githubusercontent.com/u/5222232?s=52&v=4)](/muntamala) [![@mattvb91](https://avatars.githubusercontent.com/u/11991564?s=52&v=4)](/mattvb91)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.

