Page Menu[HomeMiraheze](/)

* SearchConfigure Global Search

[Log In](https://issue-tracker.miraheze.org/auth/start/?next=%2FT11993)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T11993
# CreateWiki suppression is brokenClosed, Resolved[Public](/policy/explain/PHID-TASK-h2fpqn62cbvwt2twoxn3/view/)Actions

* [Edit Task](/maniphest/task/edit/11993/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/11993/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-h2fpqn62cbvwt2twoxn3/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-h2fpqn62cbvwt2twoxn3/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-h2fpqn62cbvwt2twoxn3/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-h2fpqn62cbvwt2twoxn3/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-h2fpqn62cbvwt2twoxn3/)
* [Edit Revisions](/search/rel/task.has-revision/PHID-TASK-h2fpqn62cbvwt2twoxn3/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-h2fpqn62cbvwt2twoxn3/)
* [Flag For Later](/flag/edit/PHID-TASK-h2fpqn62cbvwt2twoxn3/)
* [Award Token](/token/give/PHID-TASK-h2fpqn62cbvwt2twoxn3/)

Assigned To

|  | [OrangeStar](/p/OrangeStar/) |
| --- | --- |

Authored By

|  | [OrangeStar](/p/OrangeStar/) |
| --- | --- |
| Mar 26 2024, 10:542024-03-26 10:54:34 (UTC+0) |

Tags

* [Security](/tag/security/) [(Backlog)](/project/board/58/)
* [OrangeStar](/tag/orangestar/) [(Radar)](/project/board/88/)
* [CreateWiki](/tag/createwiki/) [(Backlog)](/project/board/4/)
* [Technology-Team (MediaWiki)](/tag/technology-team_mediawiki/) [(Backlog)](/project/board/62/)
Referenced FilesNoneSubscribers

|  | [AmandaCath](/p/AmandaCath/) |
| --- | --- |

|  | [BrandonWM](/p/BrandonWM/) |
| --- | --- |

|  | [Joritochip](/p/Joritochip/) |
| --- | --- |

|  | [OrangeStar](/p/OrangeStar/) |
| --- | --- |

|  | [Void](/p/Void/) |
| --- | --- |

# Description

Suppression of wiki requests is broken and does not work as intended. It is not possible to suppress requests beyond (createwiki), and restricting visibility to those with (read) permissions, which is effectively the same as making public the request, does not work.

This is due to CreateWiki basing the visibility of requests of of visibility from the form data:

<https://github.com/miraheze/CreateWiki/blob/dc9286a2a930048a4453ef6815ac8c39500661c3/includes/RequestWiki/RequestWikiRequestViewer.php#L33C1-L38C5>

```
$visibilityConds = [
  0 => 'read',
  1 => 'createwiki',
  2 => 'delete',
  3 => 'suppressrevision',
];
```

This is a mapping of user right required to view a suppressed request to their value on cw\_wikis' cw\_visibility column. Note how 1 is mapped to (createwiki).

Here is the section of code that CreateWiki runs to set request visibility when someone suppresses a request (<https://github.com/miraheze/CreateWiki/blob/dc9286a2a930048a4453ef6815ac8c39500661c3/includes/RequestWiki/RequestWikiRequestViewer.php#L394C1-L396C1>):

```
elseif ( isset( $formData['submit-handle'] ) ) {
  $request->visibility = $formData['visibility'];
```

$request->visibility here will be stored on this request's row as cw\_visibility. The issue here is that visibility on the form descriptor is an element that is set to 1 whenever ones clicks the "Set visibility restrictions" button. The actual suppression settings chosen by the handler of the wiki request is on the [visibility-options](https://github.com/miraheze/CreateWiki/blob/dc9286a2a930048a4453ef6815ac8c39500661c3/includes/RequestWiki/RequestWikiRequestViewer.php#L263C5-L271C7) key on the form data. So, regardless of which suppression setting one chooses, cw\_visibility will always be set to one (only users with (createwiki) permission).

This is an issue because suppression is normally used to redact PII, and this bug may expose PII to users who are not allowed to view it.

### Event Timeline

[OrangeStar](/p/OrangeStar/) created this task.[Mar 26 2024, 10:542024-03-26 10:54:34 (UTC+0)](#240240)[Herald](/herald/) added subscribers: Unknown Object (User), [Void](/p/Void/).  · [View Herald Transcript](/herald/transcript/152585/)[Mar 26 2024, 10:542024-03-26 10:54:34 (UTC+0)](#240250)[OrangeStar](/p/OrangeStar/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-szkvpxtxskdrkd4/)[Mar 26 2024, 10:552024-03-26 10:55:39 (UTC+0)](#240251)

[OrangeStar](/p/OrangeStar/) added a comment.[Mar 26 2024, 11:062024-03-26 11:06:11 (UTC+0)](#240252)Comment Actions

<https://github.com/miraheze/CreateWiki/security/advisories/GHSA-8wjf-mxjg-j8p9>

[OrangeStar](/p/OrangeStar/) added a comment.[Mar 26 2024, 11:502024-03-26 11:50:19 (UTC+0)](#240254)Comment Actions

Fixed. GHSA will be published shortly.

[OrangeStar](/p/OrangeStar/) closed this task as Resolved.[Mar 26 2024, 11:502024-03-26 11:50:25 (UTC+0)](#240255)[OrangeStar](/p/OrangeStar/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-pluq554yqrrlkab/)" to "Public (No Login Required)".[Mar 26 2024, 12:202024-03-26 12:20:35 (UTC+0)](#240256)[OrangeStar](/p/OrangeStar/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-e7kihyu7hocinnz/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-e7kihyu7hocinnz/)".[Herald](/herald/) added a subscriber: [BrandonWM](/p/BrandonWM/).  · [View Herald Transcript](/herald/transcript/152591/)[Mar 26 2024, 12:202024-03-26 12:20:35 (UTC+0)](#240258)[OrangeStar](/p/OrangeStar/) added projects: [OrangeStar](/tag/orangestar/), [CreateWiki](/tag/createwiki/), [Technology-Team (MediaWiki)](/tag/technology-team_mediawiki/).[Mar 26 2024, 12:242024-03-26 12:24:12 (UTC+0)](#240259)[Herald](/herald/) added subscribers: [AmandaCath](/p/AmandaCath/), [Joritochip](/p/Joritochip/).  · [View Herald Transcript](/herald/transcript/152592/)[Mar 26 2024, 12:242024-03-26 12:24:13 (UTC+0)](#240260)

[OrangeStar](/p/OrangeStar/) added a comment.[Mar 26 2024, 13:112024-03-26 13:11:26 (UTC+0)](#240261)Comment Actions

GHSA published, CVE ID CVE-2024-29883 has been assigned to it.

[Log In to Comment](/login/?next=%2FT11993)