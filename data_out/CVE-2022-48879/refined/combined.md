=== Content from git.kernel.org_01f36e12_20250110_105527.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=585a0b2b3ae7903c6abee3087d09c69e955a7794)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=585a0b2b3ae7903c6abee3087d09c69e955a7794)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=585a0b2b3ae7903c6abee3087d09c69e955a7794)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=585a0b2b3ae7903c6abee3087d09c69e955a7794)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan+linaro@kernel.org> | 2022-12-19 10:10:04 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-01-18 11:30:56 +0100 |
| commit | [585a0b2b3ae7903c6abee3087d09c69e955a7794](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=585a0b2b3ae7903c6abee3087d09c69e955a7794) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=585a0b2b3ae7903c6abee3087d09c69e955a7794)) | |
| tree | [15094db0f511281b4b74fe6fde7fa4de08b88a1a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=585a0b2b3ae7903c6abee3087d09c69e955a7794) | |
| parent | [6ad3636bd8419b29dc85fadb3e50caa8f91cbc79](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6ad3636bd8419b29dc85fadb3e50caa8f91cbc79) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=585a0b2b3ae7903c6abee3087d09c69e955a7794&id2=6ad3636bd8419b29dc85fadb3e50caa8f91cbc79)) | |
| download | [linux-585a0b2b3ae7903c6abee3087d09c69e955a7794.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-585a0b2b3ae7903c6abee3087d09c69e955a7794.tar.gz) | |

efi: fix NULL-deref in init error path[ Upstream commit 703c13fe3c9af557d312f5895ed6a5fda2711104 ]
In cases where runtime services are not supported or have been disabled,
the runtime services workqueue will never have been allocated.
Do not try to destroy the workqueue unconditionally in the unlikely
event that EFI initialisation fails to avoid dereferencing a NULL
pointer.
Fixes: 98086df8b70c ("efi: add missed destroy\_workqueue when efisubsys\_init fails")
Cc: stable@vger.kernel.org
Cc: Li Heng <liheng40@huawei.com>
Signed-off-by: Johan Hovold <johan+linaro@kernel.org>
Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=585a0b2b3ae7903c6abee3087d09c69e955a7794)

| -rw-r--r-- | [drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/firmware/efi/efi.c?id=585a0b2b3ae7903c6abee3087d09c69e955a7794) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 3 deletions

| diff --git a/drivers/firmware/efi/efi.c b/drivers/firmware/efi/efi.cindex f0ef2643b70ed0..c966a23de85d51 100644--- a/[drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/efi.c?id=6ad3636bd8419b29dc85fadb3e50caa8f91cbc79)+++ b/[drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/efi.c?id=585a0b2b3ae7903c6abee3087d09c69e955a7794)@@ -359,8 +359,8 @@ static int \_\_init efisubsys\_init(void) efi\_kobj = kobject\_create\_and\_add("efi", firmware\_kobj); if (!efi\_kobj) { pr\_err("efi: Firmware registration failed.\n");- destroy\_workqueue(efi\_rts\_wq);- return -ENOMEM;+ error = -ENOMEM;+ goto err\_destroy\_wq; }  error = generic\_ops\_register();@@ -396,7 +396,10 @@ err\_unregister: generic\_ops\_unregister(); err\_put: kobject\_put(efi\_kobj);- destroy\_workqueue(efi\_rts\_wq);+err\_destroy\_wq:+ if (efi\_rts\_wq)+ destroy\_workqueue(efi\_rts\_wq);+ return error; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:54:04 +0000



=== Content from git.kernel.org_5456fb79_20250110_105528.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=703c13fe3c9af557d312f5895ed6a5fda2711104)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=703c13fe3c9af557d312f5895ed6a5fda2711104)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=703c13fe3c9af557d312f5895ed6a5fda2711104)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=703c13fe3c9af557d312f5895ed6a5fda2711104)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan+linaro@kernel.org> | 2022-12-19 10:10:04 +0100 |
| --- | --- | --- |
| committer | Ard Biesheuvel <ardb@kernel.org> | 2023-01-03 10:52:15 +0100 |
| commit | [703c13fe3c9af557d312f5895ed6a5fda2711104](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=703c13fe3c9af557d312f5895ed6a5fda2711104) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=703c13fe3c9af557d312f5895ed6a5fda2711104)) | |
| tree | [d160ac839ccc9d17d8e259b7ffae4ea3438789f4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=703c13fe3c9af557d312f5895ed6a5fda2711104) | |
| parent | [88603b6dc419445847923fcb7fe5080067a30f98](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=88603b6dc419445847923fcb7fe5080067a30f98) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=703c13fe3c9af557d312f5895ed6a5fda2711104&id2=88603b6dc419445847923fcb7fe5080067a30f98)) | |
| download | [linux-703c13fe3c9af557d312f5895ed6a5fda2711104.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-703c13fe3c9af557d312f5895ed6a5fda2711104.tar.gz) | |

efi: fix NULL-deref in init error pathIn cases where runtime services are not supported or have been disabled,
the runtime services workqueue will never have been allocated.
Do not try to destroy the workqueue unconditionally in the unlikely
event that EFI initialisation fails to avoid dereferencing a NULL
pointer.
Fixes: 98086df8b70c ("efi: add missed destroy\_workqueue when efisubsys\_init fails")
Cc: stable@vger.kernel.org
Cc: Li Heng <liheng40@huawei.com>
Signed-off-by: Johan Hovold <johan+linaro@kernel.org>
Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=703c13fe3c9af557d312f5895ed6a5fda2711104)

| -rw-r--r-- | [drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/firmware/efi/efi.c?id=703c13fe3c9af557d312f5895ed6a5fda2711104) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 3 deletions

| diff --git a/drivers/firmware/efi/efi.c b/drivers/firmware/efi/efi.cindex 09716eebe8ac3a..a2b0cbc8741c2f 100644--- a/[drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/efi.c?id=88603b6dc419445847923fcb7fe5080067a30f98)+++ b/[drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/efi.c?id=703c13fe3c9af557d312f5895ed6a5fda2711104)@@ -394,8 +394,8 @@ static int \_\_init efisubsys\_init(void) efi\_kobj = kobject\_create\_and\_add("efi", firmware\_kobj); if (!efi\_kobj) { pr\_err("efi: Firmware registration failed.\n");- destroy\_workqueue(efi\_rts\_wq);- return -ENOMEM;+ error = -ENOMEM;+ goto err\_destroy\_wq; }  if (efi\_rt\_services\_supported(EFI\_RT\_SUPPORTED\_GET\_VARIABLE |@@ -443,7 +443,10 @@ err\_unregister: err\_put: kobject\_put(efi\_kobj); efi\_kobj = NULL;- destroy\_workqueue(efi\_rts\_wq);+err\_destroy\_wq:+ if (efi\_rts\_wq)+ destroy\_workqueue(efi\_rts\_wq);+ return error; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:54:05 +0000



=== Content from git.kernel.org_72cf223c_20250110_105530.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e2ea55564229e4bea1474af15b111b3a3043b76f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e2ea55564229e4bea1474af15b111b3a3043b76f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2ea55564229e4bea1474af15b111b3a3043b76f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2ea55564229e4bea1474af15b111b3a3043b76f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan+linaro@kernel.org> | 2022-12-19 10:10:04 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-01-18 11:48:58 +0100 |
| commit | [e2ea55564229e4bea1474af15b111b3a3043b76f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2ea55564229e4bea1474af15b111b3a3043b76f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e2ea55564229e4bea1474af15b111b3a3043b76f)) | |
| tree | [c8dbe691b523c268a151f84e30f1a9068a54839b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e2ea55564229e4bea1474af15b111b3a3043b76f) | |
| parent | [94b6cf84db42c518ad46fba6e678d884410ac49c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=94b6cf84db42c518ad46fba6e678d884410ac49c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2ea55564229e4bea1474af15b111b3a3043b76f&id2=94b6cf84db42c518ad46fba6e678d884410ac49c)) | |
| download | [linux-e2ea55564229e4bea1474af15b111b3a3043b76f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e2ea55564229e4bea1474af15b111b3a3043b76f.tar.gz) | |

efi: fix NULL-deref in init error path[ Upstream commit 703c13fe3c9af557d312f5895ed6a5fda2711104 ]
In cases where runtime services are not supported or have been disabled,
the runtime services workqueue will never have been allocated.
Do not try to destroy the workqueue unconditionally in the unlikely
event that EFI initialisation fails to avoid dereferencing a NULL
pointer.
Fixes: 98086df8b70c ("efi: add missed destroy\_workqueue when efisubsys\_init fails")
Cc: stable@vger.kernel.org
Cc: Li Heng <liheng40@huawei.com>
Signed-off-by: Johan Hovold <johan+linaro@kernel.org>
Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2ea55564229e4bea1474af15b111b3a3043b76f)

| -rw-r--r-- | [drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/firmware/efi/efi.c?id=e2ea55564229e4bea1474af15b111b3a3043b76f) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 3 deletions

| diff --git a/drivers/firmware/efi/efi.c b/drivers/firmware/efi/efi.cindex ba03f5a4b30ce3..a2765d668856e0 100644--- a/[drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/efi.c?id=94b6cf84db42c518ad46fba6e678d884410ac49c)+++ b/[drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/efi.c?id=e2ea55564229e4bea1474af15b111b3a3043b76f)@@ -385,8 +385,8 @@ static int \_\_init efisubsys\_init(void) efi\_kobj = kobject\_create\_and\_add("efi", firmware\_kobj); if (!efi\_kobj) { pr\_err("efi: Firmware registration failed.\n");- destroy\_workqueue(efi\_rts\_wq);- return -ENOMEM;+ error = -ENOMEM;+ goto err\_destroy\_wq; }  if (efi\_rt\_services\_supported(EFI\_RT\_SUPPORTED\_GET\_VARIABLE |@@ -429,7 +429,10 @@ err\_unregister: generic\_ops\_unregister(); err\_put: kobject\_put(efi\_kobj);- destroy\_workqueue(efi\_rts\_wq);+err\_destroy\_wq:+ if (efi\_rts\_wq)+ destroy\_workqueue(efi\_rts\_wq);+ return error; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:54:07 +0000



=== Content from git.kernel.org_918a808a_20250110_105526.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4ca71bc0e1995d15486cd7b60845602a28399cb5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4ca71bc0e1995d15486cd7b60845602a28399cb5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4ca71bc0e1995d15486cd7b60845602a28399cb5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4ca71bc0e1995d15486cd7b60845602a28399cb5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan+linaro@kernel.org> | 2022-12-19 10:10:04 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-01-18 11:45:01 +0100 |
| commit | [4ca71bc0e1995d15486cd7b60845602a28399cb5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4ca71bc0e1995d15486cd7b60845602a28399cb5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4ca71bc0e1995d15486cd7b60845602a28399cb5)) | |
| tree | [f9d21477448bf87db237f4c13f16c5b6151d52bd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4ca71bc0e1995d15486cd7b60845602a28399cb5) | |
| parent | [057f5ddfbc13749bdeb417c2133431075a64946c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=057f5ddfbc13749bdeb417c2133431075a64946c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4ca71bc0e1995d15486cd7b60845602a28399cb5&id2=057f5ddfbc13749bdeb417c2133431075a64946c)) | |
| download | [linux-4ca71bc0e1995d15486cd7b60845602a28399cb5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4ca71bc0e1995d15486cd7b60845602a28399cb5.tar.gz) | |

efi: fix NULL-deref in init error path[ Upstream commit 703c13fe3c9af557d312f5895ed6a5fda2711104 ]
In cases where runtime services are not supported or have been disabled,
the runtime services workqueue will never have been allocated.
Do not try to destroy the workqueue unconditionally in the unlikely
event that EFI initialisation fails to avoid dereferencing a NULL
pointer.
Fixes: 98086df8b70c ("efi: add missed destroy\_workqueue when efisubsys\_init fails")
Cc: stable@vger.kernel.org
Cc: Li Heng <liheng40@huawei.com>
Signed-off-by: Johan Hovold <johan+linaro@kernel.org>
Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4ca71bc0e1995d15486cd7b60845602a28399cb5)

| -rw-r--r-- | [drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/firmware/efi/efi.c?id=4ca71bc0e1995d15486cd7b60845602a28399cb5) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 3 deletions

| diff --git a/drivers/firmware/efi/efi.c b/drivers/firmware/efi/efi.cindex ba03f5a4b30ce3..a2765d668856e0 100644--- a/[drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/efi.c?id=057f5ddfbc13749bdeb417c2133431075a64946c)+++ b/[drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/efi.c?id=4ca71bc0e1995d15486cd7b60845602a28399cb5)@@ -385,8 +385,8 @@ static int \_\_init efisubsys\_init(void) efi\_kobj = kobject\_create\_and\_add("efi", firmware\_kobj); if (!efi\_kobj) { pr\_err("efi: Firmware registration failed.\n");- destroy\_workqueue(efi\_rts\_wq);- return -ENOMEM;+ error = -ENOMEM;+ goto err\_destroy\_wq; }  if (efi\_rt\_services\_supported(EFI\_RT\_SUPPORTED\_GET\_VARIABLE |@@ -429,7 +429,10 @@ err\_unregister: generic\_ops\_unregister(); err\_put: kobject\_put(efi\_kobj);- destroy\_workqueue(efi\_rts\_wq);+err\_destroy\_wq:+ if (efi\_rts\_wq)+ destroy\_workqueue(efi\_rts\_wq);+ return error; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:54:03 +0000



=== Content from git.kernel.org_13528fc8_20250110_105528.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5fcf75a8a4c3e7ee9122d143684083c9faf20452)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5fcf75a8a4c3e7ee9122d143684083c9faf20452)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5fcf75a8a4c3e7ee9122d143684083c9faf20452)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5fcf75a8a4c3e7ee9122d143684083c9faf20452)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan+linaro@kernel.org> | 2022-12-19 10:10:04 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-01-18 11:42:06 +0100 |
| commit | [5fcf75a8a4c3e7ee9122d143684083c9faf20452](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5fcf75a8a4c3e7ee9122d143684083c9faf20452) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5fcf75a8a4c3e7ee9122d143684083c9faf20452)) | |
| tree | [b7005724d81704afc620dcf1a5009658c19c7506](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5fcf75a8a4c3e7ee9122d143684083c9faf20452) | |
| parent | [b30e5dd0778e847d90c2349126b373f4ef346e28](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b30e5dd0778e847d90c2349126b373f4ef346e28) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5fcf75a8a4c3e7ee9122d143684083c9faf20452&id2=b30e5dd0778e847d90c2349126b373f4ef346e28)) | |
| download | [linux-5fcf75a8a4c3e7ee9122d143684083c9faf20452.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5fcf75a8a4c3e7ee9122d143684083c9faf20452.tar.gz) | |

efi: fix NULL-deref in init error path[ Upstream commit 703c13fe3c9af557d312f5895ed6a5fda2711104 ]
In cases where runtime services are not supported or have been disabled,
the runtime services workqueue will never have been allocated.
Do not try to destroy the workqueue unconditionally in the unlikely
event that EFI initialisation fails to avoid dereferencing a NULL
pointer.
Fixes: 98086df8b70c ("efi: add missed destroy\_workqueue when efisubsys\_init fails")
Cc: stable@vger.kernel.org
Cc: Li Heng <liheng40@huawei.com>
Signed-off-by: Johan Hovold <johan+linaro@kernel.org>
Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5fcf75a8a4c3e7ee9122d143684083c9faf20452)

| -rw-r--r-- | [drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/firmware/efi/efi.c?id=5fcf75a8a4c3e7ee9122d143684083c9faf20452) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 3 deletions

| diff --git a/drivers/firmware/efi/efi.c b/drivers/firmware/efi/efi.cindex ac9fb336c80ffa..eb98018ab420e3 100644--- a/[drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/efi.c?id=b30e5dd0778e847d90c2349126b373f4ef346e28)+++ b/[drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/efi.c?id=5fcf75a8a4c3e7ee9122d143684083c9faf20452)@@ -345,8 +345,8 @@ static int \_\_init efisubsys\_init(void) efi\_kobj = kobject\_create\_and\_add("efi", firmware\_kobj); if (!efi\_kobj) { pr\_err("efi: Firmware registration failed.\n");- destroy\_workqueue(efi\_rts\_wq);- return -ENOMEM;+ error = -ENOMEM;+ goto err\_destroy\_wq; }  error = generic\_ops\_register();@@ -382,7 +382,10 @@ err\_unregister: generic\_ops\_unregister(); err\_put: kobject\_put(efi\_kobj);- destroy\_workqueue(efi\_rts\_wq);+err\_destroy\_wq:+ if (efi\_rts\_wq)+ destroy\_workqueue(efi\_rts\_wq);+ return error; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:54:05 +0000



=== Content from git.kernel.org_bb93a68d_20250110_105529.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=adc96d30f6503d30dc68670c013716f1d9fcc747)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=adc96d30f6503d30dc68670c013716f1d9fcc747)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=adc96d30f6503d30dc68670c013716f1d9fcc747)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=adc96d30f6503d30dc68670c013716f1d9fcc747)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan+linaro@kernel.org> | 2022-12-19 10:10:04 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-01-18 11:58:32 +0100 |
| commit | [adc96d30f6503d30dc68670c013716f1d9fcc747](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=adc96d30f6503d30dc68670c013716f1d9fcc747) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=adc96d30f6503d30dc68670c013716f1d9fcc747)) | |
| tree | [0074bae1abb9ed693ed8413e6a072a1bde5b2883](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=adc96d30f6503d30dc68670c013716f1d9fcc747) | |
| parent | [a474d4ad59cd4642d1b7e3a6c08cef9eca0992c8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a474d4ad59cd4642d1b7e3a6c08cef9eca0992c8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=adc96d30f6503d30dc68670c013716f1d9fcc747&id2=a474d4ad59cd4642d1b7e3a6c08cef9eca0992c8)) | |
| download | [linux-adc96d30f6503d30dc68670c013716f1d9fcc747.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-adc96d30f6503d30dc68670c013716f1d9fcc747.tar.gz) | |

efi: fix NULL-deref in init error path[ Upstream commit 703c13fe3c9af557d312f5895ed6a5fda2711104 ]
In cases where runtime services are not supported or have been disabled,
the runtime services workqueue will never have been allocated.
Do not try to destroy the workqueue unconditionally in the unlikely
event that EFI initialisation fails to avoid dereferencing a NULL
pointer.
Fixes: 98086df8b70c ("efi: add missed destroy\_workqueue when efisubsys\_init fails")
Cc: stable@vger.kernel.org
Cc: Li Heng <liheng40@huawei.com>
Signed-off-by: Johan Hovold <johan+linaro@kernel.org>
Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=adc96d30f6503d30dc68670c013716f1d9fcc747)

| -rw-r--r-- | [drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/firmware/efi/efi.c?id=adc96d30f6503d30dc68670c013716f1d9fcc747) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 3 deletions

| diff --git a/drivers/firmware/efi/efi.c b/drivers/firmware/efi/efi.cindex f12cc29bd4b845..033aac6be7daa6 100644--- a/[drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/efi.c?id=a474d4ad59cd4642d1b7e3a6c08cef9eca0992c8)+++ b/[drivers/firmware/efi/efi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/efi.c?id=adc96d30f6503d30dc68670c013716f1d9fcc747)@@ -374,8 +374,8 @@ static int \_\_init efisubsys\_init(void) efi\_kobj = kobject\_create\_and\_add("efi", firmware\_kobj); if (!efi\_kobj) { pr\_err("efi: Firmware registration failed.\n");- destroy\_workqueue(efi\_rts\_wq);- return -ENOMEM;+ error = -ENOMEM;+ goto err\_destroy\_wq; }  if (efi\_rt\_services\_supported(EFI\_RT\_SUPPORTED\_GET\_VARIABLE |@@ -423,7 +423,10 @@ err\_unregister: generic\_ops\_unregister(); err\_put: kobject\_put(efi\_kobj);- destroy\_workqueue(efi\_rts\_wq);+err\_destroy\_wq:+ if (efi\_rts\_wq)+ destroy\_workqueue(efi\_rts\_wq);+ return error; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:54:06 +0000


