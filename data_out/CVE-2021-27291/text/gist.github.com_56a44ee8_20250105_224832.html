
[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fb-c-ds%2Fb1a2cc0c68a35c57188575eb496de5ce)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fb-c-ds%2Fb1a2cc0c68a35c57188575eb496de5ce&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fb-c-ds%2Fb1a2cc0c68a35c57188575eb496de5ce) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fb-c-ds%2Fb1a2cc0c68a35c57188575eb496de5ce&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@b-c-ds](https://avatars.githubusercontent.com/u/73827525?s=64&v=4)](/b-c-ds)

# [b-c-ds](/b-c-ds)/**[CVE-2021-27291-pygments.txt](/b-c-ds/b1a2cc0c68a35c57188575eb496de5ce)**

Created
March 16, 2021 19:28

Show Gist options

* [Download ZIP](/b-c-ds/b1a2cc0c68a35c57188575eb496de5ce/archive/6a71880145b015523889996541618a874f759c27.zip)

* [Star
  (2)
  2](/login?return_to=https%3A%2F%2Fgist.github.com%2Fb-c-ds%2Fb1a2cc0c68a35c57188575eb496de5ce)You must be signed in to star a gist
* [Fork
  (1)
  1](/login?return_to=https%3A%2F%2Fgist.github.com%2Fb-c-ds%2Fb1a2cc0c68a35c57188575eb496de5ce)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/b-c-ds/b1a2cc0c68a35c57188575eb496de5ce.js&quot;&gt;&lt;/script&gt;
* Save b-c-ds/b1a2cc0c68a35c57188575eb496de5ce to your computer and use it in GitHub Desktop.

[Code](/b-c-ds/b1a2cc0c68a35c57188575eb496de5ce)
[Revisions
1](/b-c-ds/b1a2cc0c68a35c57188575eb496de5ce/revisions)
[Stars
1](/b-c-ds/b1a2cc0c68a35c57188575eb496de5ce/stargazers)
[Forks
1](/b-c-ds/b1a2cc0c68a35c57188575eb496de5ce/forks)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/b-c-ds/b1a2cc0c68a35c57188575eb496de5ce.js&quot;&gt;&lt;/script&gt;

Save b-c-ds/b1a2cc0c68a35c57188575eb496de5ce to your computer and use it in GitHub Desktop.

[Download ZIP](/b-c-ds/b1a2cc0c68a35c57188575eb496de5ce/archive/6a71880145b015523889996541618a874f759c27.zip)

cve-2021-27291

 [Raw](/b-c-ds/b1a2cc0c68a35c57188575eb496de5ce/raw/6a71880145b015523889996541618a874f759c27/CVE-2021-27291-pygments.txt)

[**CVE-2021-27291-pygments.txt**](#file-cve-2021-27291-pygments-txt)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | Doyensec Vulnerability Advisory |
| --- | --- |
|  | CVE-2021-27291 |
|  | ======================================================================= |
|  | \* Regular Expression Denial of Service (REDoS) in pygments |
|  | \* Affected Product: pygments v1.1+, fixed in 2.7.4 |
|  | \* Vendor: https://github.com/pygments |
|  | \* Severity: Medium |
|  | \* Vulnerability Class: Denial of Service |
|  | \* Status: Fixed |
|  | \* Author(s): Ben Caller (Doyensec) |
|  | ======================================================================= |
|  |  |
|  | === SUMMARY === |
|  |  |
|  | In pygments, the lexers used to parse programming languages rely heavily on regular expressions. |
|  | Some of the regular expressions have exponential or cubic worst-case complexity and are vulnerable to Regular Expression Denial of Service (ReDoS). |
|  | By crafting malicious input, an attacker can cause Denial of Service. |
|  |  |
|  | === TECHNICAL DESCRIPTION === |
|  |  |
|  | The vulnerable regular expressions are below. Line numbers refer to pygments version 2.7.3. |
|  |  |
|  | pygments/lexers/archetype.py #61 |
|  | Pattern: [+-]?(\d+)\*\.\d+%? |
|  | Complexity: exponential |
|  | Example: '0' \* 3456 |
|  | Repeated character: \d |
|  | Languages: ODIN, CADL, ADL |
|  |  |
|  | The above shows that the python code |
|  |  |
|  | re.match(r"[+-]?(\d+)\*\.\d+%?", "0" \* 123) |
|  |  |
|  | will run approximately forever. |
|  |  |
|  | pygments/lexers/factor.py #268 |
|  | Pattern: """\s+(?:.|\n)\*?\s+""" |
|  | Complexity: cubic |
|  | Repeated character: \s |
|  | Example: '"""' + ' ' \* 3456 |
|  | Languages: Factor |
|  |  |
|  | pygments/lexers/factor.py #325 |
|  | Pattern: (\{\s+)(\S+)(\s+[^}]+\s+\}\s) |
|  | Complexity: cubic |
|  | Repeated character: \s |
|  | Example: '{ 0' + ' ' \* 3456 |
|  | Languages: Factor |
|  |  |
|  | pygments/lexers/jvm.py #984 |
|  | Pattern: ".\*``.\*``.\*" |
|  | Complexity: cubic |
|  | Repeated character: \x60 (`) |
|  | Example: '"' + '`' \* 3456 |
|  | Languages: Ceylon |
|  |  |
|  | pygments/lexers/matlab.py #140 |
|  | pygments/lexers/matlab.py #641 |
|  | pygments/lexers/matlab.py #713 |
|  | Pattern: (\s\*)(?:(.+)(\s\*)(=)(\s\*))?(.+)(\()(.\*)(\))(\s\*) |
|  | Complexity: cubic |
|  | Repeated character: \s |
|  | Example: ' ' \* 3456 |
|  | Languages: Matlab, Octave, Scilab |
|  |  |
|  | pygments/lexers/objective.py #264 |
|  | Pattern: (%config)(\s\*\(\s\*)(\w+)(\s\*=\s\*)(.\*?)(\s\*\)\s\*) |
|  | Complexity: cubic |
|  | Repeated character: \s |
|  | Example: '%config(a=' + ' ' \* 3456 |
|  | Languages: Logos |
|  |  |
|  | pygments/lexers/objective.py #268 |
|  | Pattern: (%new)(\s\*)(\()(\s\*.\*?\s\*)(\)) |
|  | Complexity: cubic |
|  | Repeated character: \s |
|  | Example: '%new(' + ' ' \* 3456 |
|  | Languages: Logos |
|  |  |
|  | pygments/lexers/templates.py #1408 |
|  | Pattern: (\$)(evoque|overlay)(\{(%)?)(\s\*[#\w\-"\'.]+[^=,%}]+?)?(.\*?)((?(4)%)\}) |
|  | Complexity: cubic |
|  | Repeated character: [22:",23:#,27:',aa,2d:-,2e:.,b5,ba,[f8-ff],[a-z],[A-Z],[c0-d6],[d8-f6]] |
|  | Example: '$evoque{' + 'a' \* 3456 |
|  | Languages: Evoque |
|  |  |
|  | pygments/lexers/varnish.py #64 |
|  | Pattern: (\.\w+\b)(\s\*=\s\*)([^;]\*)(\s\*;) |
|  | Complexity: cubic |
|  | Repeated character: \s |
|  | Example: '.a=' + ' ' \* 3456 |
|  |  |
|  |  |
|  | === REPRODUCTION STEPS === |
|  |  |
|  | In some cases, the lexer will only use the vulnerable regex when a prefix is added to the input. |
|  | As an example, causing REDoS via the ODIN / CADL lexer requires a '<' before the long string of digits. |
|  |  |
|  | Create a file redos.odin containing: |
|  |  |
|  | <000000000000000000000000000000 |
|  |  |
|  | Run `pygmentize redos.odin`. It will run for a very long time. |
|  | As the complexity is exponential, adding one extra digit will double the processing time. |
|  | For cubic complexity REDoS, doubling the length of the repeating section makes processing take 8 times as long. |
|  |  |
|  | Below are recipes for creating source code files which cause REDoS: |
|  |  |
|  | ADL: 'language\n <' + '0' \* 30 |
|  | CADL / ODIN: '<' + '0' \* 30 |
|  | Ceylon: '"' + '`' \* 3456 |
|  | Evoque: '$evoque{' + 'a' \* 3456 |
|  | Factor: '"""'+ " " \* 3456 |
|  | Logos: '%new(' + ' ' \* 3456 |
|  | Matlab: 'function' + ' ' \* 3456 |
|  | Varnish VCL: 'backend x{.a=' + ' ' \* 3456 |
|  |  |
|  |  |
|  | === REMEDIATION === |
|  |  |
|  | Fix the regular expressions to avoid overlapping capture groups. |
|  |  |
|  | === DISCLOSURE TIMELINE === |
|  |  |
|  | 2020-12-29: Vulnerability disclosed via email to maintainer |
|  | 2021-01-11: Fixed in https://github.com/pygments/pygments/commit/2e7e8c4a7b318f4032493773732754e418279a14 |
|  | 2021-01-12: Patched version 2.7.4 released |
|  |  |
|  | ======================================================================= |
|  |  |
|  | Doyensec (www.doyensec.com) is an independent security research |
|  | and development company focused on vulnerability discovery and |
|  | remediation. We work at the intersection of software development |
|  | and offensive engineering to help companies craft secure code. |
|  |  |
|  | Copyright 2020 by Doyensec LLC. All rights reserved. |
|  |  |
|  | Permission is hereby granted for the redistribution of this |
|  | advisory, provided that it is not altered except by reformatting |
|  | it, and that due credit is given. Permission is explicitly given |
|  | for insertion in vulnerability databases and similar, provided |
|  | that due credit is given. The information in the advisory is |
|  | believed to be accurate at the time of publishing based on |
|  | currently available information, and it is provided as-is, |
|  | as a free service to the community by Doyensec LLC. There are |
|  | no warranties with regard to this information, and Doyensec LLC |
|  | does not accept any liability for any direct, indirect, or |
|  | consequential loss or damage arising from use of, or reliance |
|  | on, this information. |

[![@b-c-ds](https://avatars.githubusercontent.com/u/73827525?s=80&v=4)](/b-c-ds)

Copy link

Author

### **[b-c-ds](/b-c-ds)** commented [May 11, 2021](/b-c-ds/b1a2cc0c68a35c57188575eb496de5ce?permalink_comment_id=3738491#gistcomment-3738491)

Discovered with [regexploit](https://github.com/doyensec/regexploit).

[Blog](https://blog.doyensec.com/2021/03/11/regexploit.html)

Sorry, something went wrong.

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fb-c-ds%2Fb1a2cc0c68a35c57188575eb496de5ce)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

