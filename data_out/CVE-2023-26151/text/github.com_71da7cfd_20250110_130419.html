
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFreeOpcUa%2Fopcua-asyncio%2Fissues%2F1013)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFreeOpcUa%2Fopcua-asyncio%2Fissues%2F1013)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=FreeOpcUa%2Fopcua-asyncio)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[FreeOpcUa](/FreeOpcUa)
/
**[opcua-asyncio](/FreeOpcUa/opcua-asyncio)**
Public

* [Notifications](/login?return_to=%2FFreeOpcUa%2Fopcua-asyncio) You must be signed in to change notification settings
* [Fork
  366](/login?return_to=%2FFreeOpcUa%2Fopcua-asyncio)
* [Star
   1.2k](/login?return_to=%2FFreeOpcUa%2Fopcua-asyncio)

* [Code](/FreeOpcUa/opcua-asyncio)
* [Issues
  150](/FreeOpcUa/opcua-asyncio/issues)
* [Pull requests
  29](/FreeOpcUa/opcua-asyncio/pulls)
* [Discussions](/FreeOpcUa/opcua-asyncio/discussions)
* [Actions](/FreeOpcUa/opcua-asyncio/actions)
* [Projects
  0](/FreeOpcUa/opcua-asyncio/projects)
* [Security](/FreeOpcUa/opcua-asyncio/security)
* [Insights](/FreeOpcUa/opcua-asyncio/pulse)

Additional navigation options

* [Code](/FreeOpcUa/opcua-asyncio)
* [Issues](/FreeOpcUa/opcua-asyncio/issues)
* [Pull requests](/FreeOpcUa/opcua-asyncio/pulls)
* [Discussions](/FreeOpcUa/opcua-asyncio/discussions)
* [Actions](/FreeOpcUa/opcua-asyncio/actions)
* [Projects](/FreeOpcUa/opcua-asyncio/projects)
* [Security](/FreeOpcUa/opcua-asyncio/security)
* [Insights](/FreeOpcUa/opcua-asyncio/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FFreeOpcUa%2Fopcua-asyncio%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FFreeOpcUa%2Fopcua-asyncio%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Denial of Service #1013

Closed

[artfire52](/artfire52) opened this issue
Aug 29, 2022
· 5 comments

Closed

# [Denial of Service](#top) #1013

[artfire52](/artfire52) opened this issue
Aug 29, 2022
· 5 comments

## Comments

[![@artfire52](https://avatars.githubusercontent.com/u/55203779?s=80&v=4)](/artfire52)

Copy link

### **[artfire52](/artfire52)** commented [Aug 29, 2022](#issue-1354397551) • edited Loading

| **The bug** It is possible to create a denial of service by sending a malformed packet. The server will be trap in an infinite loop and consume lot of memory. I create an issue instead of sending mail following instruction from [How to report a security issue? #902](https://github.com/FreeOpcUa/opcua-asyncio/issues/902)  **Reproduce** To reproduce the denial of service, you have to send a packet with a null size.  **Explanation** The function `data_received` in file binary\_server\_asyncio.py (opcua-asyncio/asyncua/server/binary\_server\_asyncio.py) continue to work on the same buffer.  ``` def data_received(self, data):         self._buffer += data         # try to parse the incoming data         while self._buffer:             try:                 buf = Buffer(self._buffer)                 try:                     header = header_from_binary(buf)                 except NotEnoughData:                     logger.debug('Not enough data while parsing header from client, waiting for more')                     return                 if len(buf) < header.body_size:                     logger.debug('We did not receive enough data from client. Need %s got %s', header.body_size,                                  len(buf))                     return                 # we have a complete message                 self.messages.put_nowait((header, buf))                 self._buffer = self._buffer[(header.header_size + header.body_size):]             except Exception:                 logger.exception('Exception raised while parsing message from client')                 return ```  The value of `(header.header_size + header.body_size)` is equal to zero. In the function `header_from_binary` in (opcua-asyncio/asyncua/ua/ua\_binary.py), the bod\_size is equal to zero at the beginning (due to our malformed packet). At the end `hdr.header_size` is equal to 12 and `hdr.body_size` is equal to -12.  ``` def header_from_binary(data):     hdr = ua.Header()     hdr.MessageType, hdr.ChunkType, hdr.packet_size = struct.unpack("<3scI", data.read(8))     hdr.body_size = hdr.packet_size - 8     if hdr.MessageType in (ua.MessageType.SecureOpen, ua.MessageType.SecureClose, ua.MessageType.SecureMessage):         hdr.body_size -= 4         hdr.ChannelId = Primitives.UInt32.unpack(data)         hdr.header_size = 12     return hdr ```  So in the function `data_received`, the buffer is never updated, then we are trapped in an infinite loop.  **Version** Python-Version:Python 3.8.10 opcua-asyncio Version (e.g. master branch, 0.9): branch master, commit [54e54fa](https://github.com/FreeOpcUa/opcua-asyncio/commit/54e54fa6b1383849fac4039f0e9c06902454297c) (last commit 29/08/2022) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@schroeder-](https://avatars.githubusercontent.com/u/1273483?s=40&v=4)](/schroeder-)
[schroeder-](/schroeder-)
mentioned this issue
[Aug 31, 2022](#ref-pullrequest-1357563250)

[Server: prevent denial of service from malformed packet
#1016](/FreeOpcUa/opcua-asyncio/pull/1016)
 Closed

[![@GoetzGoerisch](https://avatars.githubusercontent.com/u/47734341?s=80&u=eebfeb4f4c0fc21d1fbc44781f1a70da2f8160e5&v=4)](/GoetzGoerisch)

Copy link

### **[GoetzGoerisch](/GoetzGoerisch)** commented [Sep 1, 2022](#issuecomment-1234160597)

| Thank you [@artfire52](https://github.com/artfire52)  For reference this is [CVE-2022-25304](https://github.com/advisories/GHSA-mfpj-3qhm-976m "CVE-2022-25304") and [GHSA-mfpj-3qhm-976m](https://github.com/advisories/GHSA-mfpj-3qhm-976m "GHSA-mfpj-3qhm-976m")  GitHub already raised an alert in our sample server implementation. |
| --- |

All reactions

Sorry, something went wrong.

[![@artfire52](https://avatars.githubusercontent.com/u/55203779?s=80&v=4)](/artfire52)

Copy link

Author

### **[artfire52](/artfire52)** commented [Sep 1, 2022](#issuecomment-1234221193)

| Actually for this denial of service only one message is required, it is not exploiting sending several chunks without the final one. For the example, one opensecure channel request with a null size in the field size of OPC UA Connection Protocol Message header is sufficient to perform a denial of service. Sending a hello message is not required for instance. |
| --- |

All reactions

Sorry, something went wrong.

[![@schroeder-](https://avatars.githubusercontent.com/u/1273483?s=40&v=4)](/schroeder-)
[schroeder-](/schroeder-)
mentioned this issue
[Sep 7, 2022](#ref-issue-1364355536)

[CVE-2022-25304
#1023](/FreeOpcUa/opcua-asyncio/issues/1023)

Closed

[![@kohtala](https://avatars.githubusercontent.com/u/1055533?s=80&v=4)](/kohtala)

### This comment was marked as outdated.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2FFreeOpcUa%2Fopcua-asyncio%2Fissues%2F1013)

[![@kohtala](https://avatars.githubusercontent.com/u/1055533?s=80&v=4)](/kohtala)

Copy link

Contributor

### **[kohtala](/kohtala)** commented [Sep 19, 2022](#issuecomment-1250617303) • edited Loading

| [@GoetzGoerisch](https://github.com/GoetzGoerisch) , [@schroeder-](https://github.com/schroeder-) commented on [#1023](https://github.com/FreeOpcUa/opcua-asyncio/issues/1023) that this vulnerability is not [CVE-2022-25304](https://github.com/advisories/GHSA-mfpj-3qhm-976m "CVE-2022-25304"). Hence the [#1039](https://github.com/FreeOpcUa/opcua-asyncio/pull/1039) does not fix that vulnerability. |
| --- |

All reactions

Sorry, something went wrong.

[![@schroeder-](https://avatars.githubusercontent.com/u/1273483?s=80&v=4)](/schroeder-)

Copy link

Contributor

### **[schroeder-](/schroeder-)** commented [Sep 20, 2022](#issuecomment-1252378194)

| Closed via [#1039](https://github.com/FreeOpcUa/opcua-asyncio/pull/1039) |
| --- |

All reactions

Sorry, something went wrong.

[![@schroeder-](https://avatars.githubusercontent.com/u/1273483?s=40&v=4)](/schroeder-)
[schroeder-](/schroeder-)
closed this as [completed](/FreeOpcUa/opcua-asyncio/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Sep 20, 2022](#event-7422462677)

[![@schroeder-](https://avatars.githubusercontent.com/u/1273483?s=40&v=4)](/schroeder-)
[schroeder-](/schroeder-)
mentioned this issue
[Sep 23, 2022](#ref-pullrequest-1382549828)

[server: exit on malformed packet
#1046](/FreeOpcUa/opcua-asyncio/pull/1046)
 Merged

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FFreeOpcUa%2Fopcua-asyncio%2Fissues%2F1013)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

4 participants

[![@kohtala](https://avatars.githubusercontent.com/u/1055533?s=52&v=4)](/kohtala) [![@schroeder-](https://avatars.githubusercontent.com/u/1273483?s=52&v=4)](/schroeder-) [![@GoetzGoerisch](https://avatars.githubusercontent.com/u/47734341?s=52&v=4)](/GoetzGoerisch) [![@artfire52](https://avatars.githubusercontent.com/u/55203779?s=52&v=4)](/artfire52)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

