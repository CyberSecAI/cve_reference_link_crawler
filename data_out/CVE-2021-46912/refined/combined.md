=== Content from git.kernel.org_b9bcc433_20250111_122811.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1ccdf1bed140820240e383ba0accc474ffc7f006)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1ccdf1bed140820240e383ba0accc474ffc7f006)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1ccdf1bed140820240e383ba0accc474ffc7f006)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1ccdf1bed140820240e383ba0accc474ffc7f006)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jonathon Reinhart <jonathon.reinhart@gmail.com> | 2021-04-13 03:08:48 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-04-21 13:13:25 +0200 |
| commit | [1ccdf1bed140820240e383ba0accc474ffc7f006](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1ccdf1bed140820240e383ba0accc474ffc7f006) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1ccdf1bed140820240e383ba0accc474ffc7f006)) | |
| tree | [c0930bdcdd9697c5e773d7298d2210c279465d14](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1ccdf1bed140820240e383ba0accc474ffc7f006) | |
| parent | [93e2742631b19032283869e90e44cfb99bd2d2c6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=93e2742631b19032283869e90e44cfb99bd2d2c6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1ccdf1bed140820240e383ba0accc474ffc7f006&id2=93e2742631b19032283869e90e44cfb99bd2d2c6)) | |
| download | [linux-1ccdf1bed140820240e383ba0accc474ffc7f006.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1ccdf1bed140820240e383ba0accc474ffc7f006.tar.gz) | |

net: Make tcp\_allowed\_congestion\_control readonly in non-init netnscommit 97684f0970f6e112926de631fdd98d9693c7e5c1 upstream.
Currently, tcp\_allowed\_congestion\_control is global and writable;
writing to it in any net namespace will leak into all other net
namespaces.
tcp\_available\_congestion\_control and tcp\_allowed\_congestion\_control are
the only sysctls in ipv4\_net\_table (the per-netns sysctl table) with a
NULL data pointer; their handlers (proc\_tcp\_available\_congestion\_control
and proc\_allowed\_congestion\_control) have no other way of referencing a
struct net. Thus, they operate globally.
Because ipv4\_net\_table does not use designated initializers, there is no
easy way to fix up this one "bad" table entry. However, the data pointer
updating logic shouldn't be applied to NULL pointers anyway, so we
instead force these entries to be read-only.
These sysctls used to exist in ipv4\_table (init-net only), but they were
moved to the per-net ipv4\_net\_table, presumably without realizing that
tcp\_allowed\_congestion\_control was writable and thus introduced a leak.
Because the intent of that commit was only to know (i.e. read) "which
congestion algorithms are available or allowed", this read-only solution
should be sufficient.
The logic added in recent commit
31c4d2f160eb: ("net: Ensure net namespace isolation of sysctls")
does not and cannot check for NULL data pointers, because
other table entries (e.g. /proc/sys/net/netfilter/nf\_log/) have
.data=NULL but use other methods (.extra2) to access the struct net.
Fixes: 9cb8e048e5d9 ("net/ipv4/sysctl: show tcp\_{allowed, available}\_congestion\_control in non-initial netns")
Signed-off-by: Jonathon Reinhart <jonathon.reinhart@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1ccdf1bed140820240e383ba0accc474ffc7f006)

| -rw-r--r-- | [net/ipv4/sysctl\_net\_ipv4.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/ipv4/sysctl_net_ipv4.c?id=1ccdf1bed140820240e383ba0accc474ffc7f006) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 13 insertions, 3 deletions

| diff --git a/net/ipv4/sysctl\_net\_ipv4.c b/net/ipv4/sysctl\_net\_ipv4.cindex 3e5f4f2e705e84..08829809e88b76 100644--- a/[net/ipv4/sysctl\_net\_ipv4.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/sysctl_net_ipv4.c?id=93e2742631b19032283869e90e44cfb99bd2d2c6)+++ b/[net/ipv4/sysctl\_net\_ipv4.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/sysctl_net_ipv4.c?id=1ccdf1bed140820240e383ba0accc474ffc7f006)@@ -1369,9 +1369,19 @@ static \_\_net\_init int ipv4\_sysctl\_init\_net(struct net \*net) if (!table) goto err\_alloc; - /\* Update the variables to point into the current struct net \*/- for (i = 0; i < ARRAY\_SIZE(ipv4\_net\_table) - 1; i++)- table[i].data += (void \*)net - (void \*)&init\_net;+ for (i = 0; i < ARRAY\_SIZE(ipv4\_net\_table) - 1; i++) {+ if (table[i].data) {+ /\* Update the variables to point into+ \* the current struct net+ \*/+ table[i].data += (void \*)net - (void \*)&init\_net;+ } else {+ /\* Entries without data pointer are global;+ \* Make them read-only in non-init\_net ns+ \*/+ table[i].mode &= ~0222;+ }+ } }  net->ipv4.ipv4\_hdr = register\_net\_sysctl(net, "net/ipv4", table); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:26:48 +0000



=== Content from git.kernel.org_6ed305de_20250111_122812.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=35d7491e2f77ce480097cabcaf93ed409e916e12)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=35d7491e2f77ce480097cabcaf93ed409e916e12)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=35d7491e2f77ce480097cabcaf93ed409e916e12)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35d7491e2f77ce480097cabcaf93ed409e916e12)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jonathon Reinhart <jonathon.reinhart@gmail.com> | 2021-04-13 03:08:48 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-04-21 13:00:57 +0200 |
| commit | [35d7491e2f77ce480097cabcaf93ed409e916e12](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=35d7491e2f77ce480097cabcaf93ed409e916e12) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=35d7491e2f77ce480097cabcaf93ed409e916e12)) | |
| tree | [ede84fa5a4944c22cc2cd2abd5fe20f6f9d20af2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=35d7491e2f77ce480097cabcaf93ed409e916e12) | |
| parent | [76af8126a6e4d982c8f42dc2e64f0ffdf4b6255a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=76af8126a6e4d982c8f42dc2e64f0ffdf4b6255a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35d7491e2f77ce480097cabcaf93ed409e916e12&id2=76af8126a6e4d982c8f42dc2e64f0ffdf4b6255a)) | |
| download | [linux-35d7491e2f77ce480097cabcaf93ed409e916e12.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-35d7491e2f77ce480097cabcaf93ed409e916e12.tar.gz) | |

net: Make tcp\_allowed\_congestion\_control readonly in non-init netnscommit 97684f0970f6e112926de631fdd98d9693c7e5c1 upstream.
Currently, tcp\_allowed\_congestion\_control is global and writable;
writing to it in any net namespace will leak into all other net
namespaces.
tcp\_available\_congestion\_control and tcp\_allowed\_congestion\_control are
the only sysctls in ipv4\_net\_table (the per-netns sysctl table) with a
NULL data pointer; their handlers (proc\_tcp\_available\_congestion\_control
and proc\_allowed\_congestion\_control) have no other way of referencing a
struct net. Thus, they operate globally.
Because ipv4\_net\_table does not use designated initializers, there is no
easy way to fix up this one "bad" table entry. However, the data pointer
updating logic shouldn't be applied to NULL pointers anyway, so we
instead force these entries to be read-only.
These sysctls used to exist in ipv4\_table (init-net only), but they were
moved to the per-net ipv4\_net\_table, presumably without realizing that
tcp\_allowed\_congestion\_control was writable and thus introduced a leak.
Because the intent of that commit was only to know (i.e. read) "which
congestion algorithms are available or allowed", this read-only solution
should be sufficient.
The logic added in recent commit
31c4d2f160eb: ("net: Ensure net namespace isolation of sysctls")
does not and cannot check for NULL data pointers, because
other table entries (e.g. /proc/sys/net/netfilter/nf\_log/) have
.data=NULL but use other methods (.extra2) to access the struct net.
Fixes: 9cb8e048e5d9 ("net/ipv4/sysctl: show tcp\_{allowed, available}\_congestion\_control in non-initial netns")
Signed-off-by: Jonathon Reinhart <jonathon.reinhart@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35d7491e2f77ce480097cabcaf93ed409e916e12)

| -rw-r--r-- | [net/ipv4/sysctl\_net\_ipv4.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/ipv4/sysctl_net_ipv4.c?id=35d7491e2f77ce480097cabcaf93ed409e916e12) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 13 insertions, 3 deletions

| diff --git a/net/ipv4/sysctl\_net\_ipv4.c b/net/ipv4/sysctl\_net\_ipv4.cindex 3e5f4f2e705e84..08829809e88b76 100644--- a/[net/ipv4/sysctl\_net\_ipv4.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/sysctl_net_ipv4.c?id=76af8126a6e4d982c8f42dc2e64f0ffdf4b6255a)+++ b/[net/ipv4/sysctl\_net\_ipv4.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/sysctl_net_ipv4.c?id=35d7491e2f77ce480097cabcaf93ed409e916e12)@@ -1369,9 +1369,19 @@ static \_\_net\_init int ipv4\_sysctl\_init\_net(struct net \*net) if (!table) goto err\_alloc; - /\* Update the variables to point into the current struct net \*/- for (i = 0; i < ARRAY\_SIZE(ipv4\_net\_table) - 1; i++)- table[i].data += (void \*)net - (void \*)&init\_net;+ for (i = 0; i < ARRAY\_SIZE(ipv4\_net\_table) - 1; i++) {+ if (table[i].data) {+ /\* Update the variables to point into+ \* the current struct net+ \*/+ table[i].data += (void \*)net - (void \*)&init\_net;+ } else {+ /\* Entries without data pointer are global;+ \* Make them read-only in non-init\_net ns+ \*/+ table[i].mode &= ~0222;+ }+ } }  net->ipv4.ipv4\_hdr = register\_net\_sysctl(net, "net/ipv4", table); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:26:50 +0000



=== Content from git.kernel.org_69d622c6_20250111_122813.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=97684f0970f6e112926de631fdd98d9693c7e5c1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=97684f0970f6e112926de631fdd98d9693c7e5c1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=97684f0970f6e112926de631fdd98d9693c7e5c1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=97684f0970f6e112926de631fdd98d9693c7e5c1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jonathon Reinhart <jonathon.reinhart@gmail.com> | 2021-04-13 03:08:48 -0400 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2021-04-13 14:42:51 -0700 |
| commit | [97684f0970f6e112926de631fdd98d9693c7e5c1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=97684f0970f6e112926de631fdd98d9693c7e5c1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=97684f0970f6e112926de631fdd98d9693c7e5c1)) | |
| tree | [9ad8cbca70d7d7f89635fd6f78dac56f1e2b7c5f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=97684f0970f6e112926de631fdd98d9693c7e5c1) | |
| parent | [61aaa1aa9a8f83dbdc763c6939568952a2a30c90](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=61aaa1aa9a8f83dbdc763c6939568952a2a30c90) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=97684f0970f6e112926de631fdd98d9693c7e5c1&id2=61aaa1aa9a8f83dbdc763c6939568952a2a30c90)) | |
| download | [linux-97684f0970f6e112926de631fdd98d9693c7e5c1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-97684f0970f6e112926de631fdd98d9693c7e5c1.tar.gz) | |

net: Make tcp\_allowed\_congestion\_control readonly in non-init netnsCurrently, tcp\_allowed\_congestion\_control is global and writable;
writing to it in any net namespace will leak into all other net
namespaces.
tcp\_available\_congestion\_control and tcp\_allowed\_congestion\_control are
the only sysctls in ipv4\_net\_table (the per-netns sysctl table) with a
NULL data pointer; their handlers (proc\_tcp\_available\_congestion\_control
and proc\_allowed\_congestion\_control) have no other way of referencing a
struct net. Thus, they operate globally.
Because ipv4\_net\_table does not use designated initializers, there is no
easy way to fix up this one "bad" table entry. However, the data pointer
updating logic shouldn't be applied to NULL pointers anyway, so we
instead force these entries to be read-only.
These sysctls used to exist in ipv4\_table (init-net only), but they were
moved to the per-net ipv4\_net\_table, presumably without realizing that
tcp\_allowed\_congestion\_control was writable and thus introduced a leak.
Because the intent of that commit was only to know (i.e. read) "which
congestion algorithms are available or allowed", this read-only solution
should be sufficient.
The logic added in recent commit
31c4d2f160eb: ("net: Ensure net namespace isolation of sysctls")
does not and cannot check for NULL data pointers, because
other table entries (e.g. /proc/sys/net/netfilter/nf\_log/) have
.data=NULL but use other methods (.extra2) to access the struct net.
Fixes: 9cb8e048e5d9 ("net/ipv4/sysctl: show tcp\_{allowed, available}\_congestion\_control in non-initial netns")
Signed-off-by: Jonathon Reinhart <jonathon.reinhart@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=97684f0970f6e112926de631fdd98d9693c7e5c1)

| -rw-r--r-- | [net/ipv4/sysctl\_net\_ipv4.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/ipv4/sysctl_net_ipv4.c?id=97684f0970f6e112926de631fdd98d9693c7e5c1) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 13 insertions, 3 deletions

| diff --git a/net/ipv4/sysctl\_net\_ipv4.c b/net/ipv4/sysctl\_net\_ipv4.cindex f55095d3ed1656..60465f077497ed 100644--- a/[net/ipv4/sysctl\_net\_ipv4.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/sysctl_net_ipv4.c?id=61aaa1aa9a8f83dbdc763c6939568952a2a30c90)+++ b/[net/ipv4/sysctl\_net\_ipv4.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/sysctl_net_ipv4.c?id=97684f0970f6e112926de631fdd98d9693c7e5c1)@@ -1378,9 +1378,19 @@ static \_\_net\_init int ipv4\_sysctl\_init\_net(struct net \*net) if (!table) goto err\_alloc; - /\* Update the variables to point into the current struct net \*/- for (i = 0; i < ARRAY\_SIZE(ipv4\_net\_table) - 1; i++)- table[i].data += (void \*)net - (void \*)&init\_net;+ for (i = 0; i < ARRAY\_SIZE(ipv4\_net\_table) - 1; i++) {+ if (table[i].data) {+ /\* Update the variables to point into+ \* the current struct net+ \*/+ table[i].data += (void \*)net - (void \*)&init\_net;+ } else {+ /\* Entries without data pointer are global;+ \* Make them read-only in non-init\_net ns+ \*/+ table[i].mode &= ~0222;+ }+ } }  net->ipv4.ipv4\_hdr = register\_net\_sysctl(net, "net/ipv4", table); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:26:50 +0000


