<!DOCTYPE html>
<html lang='en'>
<head>
<title>scsi: stex: Properly zero out the passthrough command structure - kernel/git/torvalds/linux.git - Linux kernel source tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git' title='kernel/git/torvalds/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git' title='kernel/git/torvalds/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/torvalds/linux.git' title='kernel/git/torvalds/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/torvalds/linux.git/'>kernel/git/torvalds/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='6022f210461fef67e6e676fd8544ca02d1bcfa7a'/><select name='h' onchange='this.form.submit();'>
<option value='for-next'>for-next</option>
<option value='master' selected='selected'>master</option>
<option value='vsnprintf'>vsnprintf</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel source tree</td><td class='sub right'>Linus Torvalds</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a'>refs</a><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a'>commit</a><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a'>diff</a><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/torvalds/linux.git/log/'>
<input type='hidden' name='id' value='6022f210461fef67e6e676fd8544ca02d1bcfa7a'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='6022f210461fef67e6e676fd8544ca02d1bcfa7a'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Linus Torvalds &lt;torvalds@linux-foundation.org&gt;</td><td class='right'>2022-09-09 08:54:47 +0200</td></tr>
<tr><th>committer</th><td>Martin K. Petersen &lt;martin.petersen@oracle.com&gt;</td><td class='right'>2022-09-25 14:15:03 -0400</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a'>6022f210461fef67e6e676fd8544ca02d1bcfa7a</a> (<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a'>d334e4da26edc6f9681f97957862fc814a813bdb</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=f616efbee9d64cbd3b7b955914fea01cbdd95710'>f616efbee9d64cbd3b7b955914fea01cbdd95710</a> (<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a&amp;id2=f616efbee9d64cbd3b7b955914fea01cbdd95710'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-6022f210461fef67e6e676fd8544ca02d1bcfa7a.tar.gz'>linux-6022f210461fef67e6e676fd8544ca02d1bcfa7a.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>scsi: stex: Properly zero out the passthrough command structure</div><div class='commit-msg'>The passthrough structure is declared off of the stack, so it needs to be
set to zero before copied back to userspace to prevent any unintentional
data leakage.  Switch things to be statically allocated which will fill the
unused fields with 0 automatically.

Link: <a href="https://lore.kernel.org/r/YxrjN3OOw2HHl9tx@kroah.com">https://lore.kernel.org/r/YxrjN3OOw2HHl9tx@kroah.com</a>
Cc: stable@kernel.org
Cc: "James E.J. Bottomley" &lt;jejb@linux.ibm.com&gt;
Cc: "Martin K. Petersen" &lt;martin.petersen@oracle.com&gt;
Cc: Dan Carpenter &lt;dan.carpenter@oracle.com&gt;
Reported-by: hdthky &lt;hdthky0@gmail.com&gt;
Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;
Signed-off-by: Martin K. Petersen &lt;martin.petersen@oracle.com&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/scsi/stex.c?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a'>drivers/scsi/stex.c</a></td><td class='right'>17</td><td class='graph'><table summary='file diffstat' width='17%'><tr><td class='add' style='width: 52.9%;'/><td class='rem' style='width: 47.1%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/scsi/scsi_cmnd.h?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a'>include/scsi/scsi_cmnd.h</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='17%'><tr><td class='add' style='width: 5.9%;'/><td class='rem' style='width: 5.9%;'/><td class='none' style='width: 88.2%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>2 files changed, 10 insertions, 9 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/drivers/scsi/stex.c b/drivers/scsi/stex.c<br/>index e6420f2127ce1c..8def242675ef3f 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/scsi/stex.c?id=f616efbee9d64cbd3b7b955914fea01cbdd95710'>drivers/scsi/stex.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/scsi/stex.c?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a'>drivers/scsi/stex.c</a></div><div class='hunk'>@@ -665,16 +665,17 @@ static int stex_queuecommand_lck(struct scsi_cmnd *cmd)</div><div class='ctx'> 		return 0;</div><div class='ctx'> 	case PASSTHRU_CMD:</div><div class='ctx'> 		if (cmd-&gt;cmnd[1] == PASSTHRU_GET_DRVVER) {</div><div class='del'>-			struct st_drvver ver;</div><div class='add'>+			const struct st_drvver ver = {</div><div class='add'>+				.major = ST_VER_MAJOR,</div><div class='add'>+				.minor = ST_VER_MINOR,</div><div class='add'>+				.oem = ST_OEM,</div><div class='add'>+				.build = ST_BUILD_VER,</div><div class='add'>+				.signature[0] = PASSTHRU_SIGNATURE,</div><div class='add'>+				.console_id = host-&gt;max_id - 1,</div><div class='add'>+				.host_no = hba-&gt;host-&gt;host_no,</div><div class='add'>+			};</div><div class='ctx'> 			size_t cp_len = sizeof(ver);</div><div class='ctx'> </div><div class='del'>-			ver.major = ST_VER_MAJOR;</div><div class='del'>-			ver.minor = ST_VER_MINOR;</div><div class='del'>-			ver.oem = ST_OEM;</div><div class='del'>-			ver.build = ST_BUILD_VER;</div><div class='del'>-			ver.signature[0] = PASSTHRU_SIGNATURE;</div><div class='del'>-			ver.console_id = host-&gt;max_id - 1;</div><div class='del'>-			ver.host_no = hba-&gt;host-&gt;host_no;</div><div class='ctx'> 			cp_len = scsi_sg_copy_from_buffer(cmd, &amp;ver, cp_len);</div><div class='ctx'> 			if (sizeof(ver) == cp_len)</div><div class='ctx'> 				cmd-&gt;result = DID_OK &lt;&lt; 16;</div><div class='head'>diff --git a/include/scsi/scsi_cmnd.h b/include/scsi/scsi_cmnd.h<br/>index bac55decf900a8..7d3622db38edcc 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/scsi/scsi_cmnd.h?id=f616efbee9d64cbd3b7b955914fea01cbdd95710'>include/scsi/scsi_cmnd.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/scsi/scsi_cmnd.h?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a'>include/scsi/scsi_cmnd.h</a></div><div class='hunk'>@@ -201,7 +201,7 @@ static inline unsigned int scsi_get_resid(struct scsi_cmnd *cmd)</div><div class='ctx'> 	for_each_sg(scsi_sglist(cmd), sg, nseg, __i)</div><div class='ctx'> </div><div class='ctx'> static inline int scsi_sg_copy_from_buffer(struct scsi_cmnd *cmd,</div><div class='del'>-					   void *buf, int buflen)</div><div class='add'>+					   const void *buf, int buflen)</div><div class='ctx'> {</div><div class='ctx'> 	return sg_copy_from_buffer(scsi_sglist(cmd), scsi_sg_count(cmd),</div><div class='ctx'> 				   buf, buflen);</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-05 18:08:54 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
