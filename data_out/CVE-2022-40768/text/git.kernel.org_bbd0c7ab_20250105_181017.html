

| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Linus Torvalds <torvalds@linux-foundation.org> | 2022-09-09 08:54:47 +0200 |
| --- | --- | --- |
| committer | Martin K. Petersen <martin.petersen@oracle.com> | 2022-09-25 14:15:03 -0400 |
| commit | [6022f210461fef67e6e676fd8544ca02d1bcfa7a](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a)) | |
| tree | [d334e4da26edc6f9681f97957862fc814a813bdb](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a) | |
| parent | [f616efbee9d64cbd3b7b955914fea01cbdd95710](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=f616efbee9d64cbd3b7b955914fea01cbdd95710) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a&id2=f616efbee9d64cbd3b7b955914fea01cbdd95710)) | |
| download | [linux-6022f210461fef67e6e676fd8544ca02d1bcfa7a.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-6022f210461fef67e6e676fd8544ca02d1bcfa7a.tar.gz) | |

scsi: stex: Properly zero out the passthrough command structureThe passthrough structure is declared off of the stack, so it needs to be
set to zero before copied back to userspace to prevent any unintentional
data leakage. Switch things to be statically allocated which will fill the
unused fields with 0 automatically.
Link: [https://lore.kernel.org/r/YxrjN3OOw2HHl9tx@kroah.com](https://lore.kernel.org/r/YxrjN3OOw2HHl9tx%40kroah.com)
Cc: stable@kernel.org
Cc: "James E.J. Bottomley" <jejb@linux.ibm.com>
Cc: "Martin K. Petersen" <martin.petersen@oracle.com>
Cc: Dan Carpenter <dan.carpenter@oracle.com>
Reported-by: hdthky <hdthky0@gmail.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a)

| -rw-r--r-- | [drivers/scsi/stex.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/scsi/stex.c?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/scsi/scsi\_cmnd.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/scsi/scsi_cmnd.h?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 10 insertions, 9 deletions

| diff --git a/drivers/scsi/stex.c b/drivers/scsi/stex.cindex e6420f2127ce1c..8def242675ef3f 100644--- a/[drivers/scsi/stex.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/scsi/stex.c?id=f616efbee9d64cbd3b7b955914fea01cbdd95710)+++ b/[drivers/scsi/stex.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/scsi/stex.c?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a)@@ -665,16 +665,17 @@ static int stex\_queuecommand\_lck(struct scsi\_cmnd \*cmd) return 0; case PASSTHRU\_CMD: if (cmd->cmnd[1] == PASSTHRU\_GET\_DRVVER) {- struct st\_drvver ver;+ const struct st\_drvver ver = {+ .major = ST\_VER\_MAJOR,+ .minor = ST\_VER\_MINOR,+ .oem = ST\_OEM,+ .build = ST\_BUILD\_VER,+ .signature[0] = PASSTHRU\_SIGNATURE,+ .console\_id = host->max\_id - 1,+ .host\_no = hba->host->host\_no,+ }; size\_t cp\_len = sizeof(ver); - ver.major = ST\_VER\_MAJOR;- ver.minor = ST\_VER\_MINOR;- ver.oem = ST\_OEM;- ver.build = ST\_BUILD\_VER;- ver.signature[0] = PASSTHRU\_SIGNATURE;- ver.console\_id = host->max\_id - 1;- ver.host\_no = hba->host->host\_no; cp\_len = scsi\_sg\_copy\_from\_buffer(cmd, &ver, cp\_len); if (sizeof(ver) == cp\_len) cmd->result = DID\_OK << 16;diff --git a/include/scsi/scsi\_cmnd.h b/include/scsi/scsi\_cmnd.hindex bac55decf900a8..7d3622db38edcc 100644--- a/[include/scsi/scsi\_cmnd.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/scsi/scsi_cmnd.h?id=f616efbee9d64cbd3b7b955914fea01cbdd95710)+++ b/[include/scsi/scsi\_cmnd.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/scsi/scsi_cmnd.h?id=6022f210461fef67e6e676fd8544ca02d1bcfa7a)@@ -201,7 +201,7 @@ static inline unsigned int scsi\_get\_resid(struct scsi\_cmnd \*cmd) for\_each\_sg(scsi\_sglist(cmd), sg, nseg, \_\_i)  static inline int scsi\_sg\_copy\_from\_buffer(struct scsi\_cmnd \*cmd,- void \*buf, int buflen)+ const void \*buf, int buflen) { return sg\_copy\_from\_buffer(scsi\_sglist(cmd), scsi\_sg\_count(cmd), buf, buflen); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-05 18:08:54 +0000

