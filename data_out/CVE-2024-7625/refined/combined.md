=== Content from discuss.hashicorp.com_e45b581d_20250110_174712.html ===


[HashiCorp Discuss](/)

# [HCSEC-2024-17 - Nomad Vulnerable to Allocation Directory Escape On Non-Existing File Paths Through Archive Unpacking](/t/hcsec-2024-17-nomad-vulnerable-to-allocation-directory-escape-on-non-existing-file-paths-through-archive-unpacking/69293)

[Security](/c/security/52)

[security-nomad](https://discuss.hashicorp.com/tag/security-nomad)

[eastebry](https://discuss.hashicorp.com/u/eastebry)

August 14, 2024, 11:17pm

1

**Bulletin ID:** HCSEC-2024-17

**Affected Products / Versions:** Nomad and Nomad Enterprise from 0.6.1 up to 1.6.13, 1.7.10, and 1.8.2; fixed in Nomad Enterprise 1.6.14, 1.7.11, 1.8.3.

**Publication Date:** August 14, 2024

**Summary**

In HashiCorp Nomad and Nomad Enterprise from 0.6.1 up to 1.6.13, 1.7.10, and 1.8.2, the archive unpacking process is vulnerable to writes outside the allocation directory during migration of allocation directories when multiple archive headers target the same file. This vulnerability, CVE-2024-7625, is fixed in Nomad 1.6.14, 1.7.11, and 1.8.3.

*Access or compromise of the Nomad client agent at the source allocation first is a prerequisite for leveraging this vulnerability.*

**Background**

Nomad creates a [working directory](https://developer.hashicorp.com/nomad/docs/concepts/filesystem) for each [allocation](https://developer.hashicorp.com/nomad/docs/glossary#allocation) on a client. The allocation working directory is where Nomad creates task directories and directories shared between tasks, writes logs for tasks, and downloads artifacts or templates. The [migrate](https://developer.hashicorp.com/nomad/docs/job-specification/migrate) block specifies the group’s strategy for migrating allocations from draining nodes used for cluster operations such as server maintenance, operating system upgrades, etc.

**Details**

Internal testing by the Product Security and Nomad R&D team identified that streaming allocation directories did not properly remove existing files in paths within the same allocation directory during unpacking, allowing malicious actors to craft an archive that would unpack a file to paths outside of the intended allocation directory.

**Remediation**

Customers should evaluate the risk associated with this issue and consider upgrading to Nomad 1.6.14, 1.7.11, 1.8.3 or newer.

Please refer to [Upgrading Nomad](https://developer.hashicorp.com/nomad/docs/upgrade) for general guidance and the [Upgrade Guides](https://developer.hashicorp.com/nomad/docs/upgrade/upgrade-specific) for version-specific upgrade notes.

**Acknowledgement**

This issue was identified by HashiCorp’s Product Security and Nomad R&D teams.

*We deeply appreciate any effort to coordinate disclosure of security vulnerabilities. For information about security at HashiCorp and the reporting of security vulnerabilities, please see <https://hashicorp.com/security>.*

### Related topics

| Topic |  | Replies | Views | Activity |
| --- | --- | --- | --- | --- |
| [HCSEC-2024-15 - Nomad Vulnerable to Allocation Directory Path Escape Through Archive Unpacking](https://discuss.hashicorp.com/t/hcsec-2024-15-nomad-vulnerable-to-allocation-directory-path-escape-through-archive-unpacking/68781)  [Security](/c/security/52) [security-nomad](https://discuss.hashicorp.com/tag/security-nomad) | 0 | 1026 | July 22, 2024 |
| [HCSEC-2022-02 - Nomad alloc Filesystem and Container Escape](https://discuss.hashicorp.com/t/hcsec-2022-02-nomad-alloc-filesystem-and-container-escape/35560)  [Security](/c/security/52) [security-nomad](https://discuss.hashicorp.com/tag/security-nomad) | 0 | 7190 | February 11, 2022 |
| [HCSEC-2024-03 - Nomad Vulnerable to Arbitrary Write Through Symlink Attack](https://discuss.hashicorp.com/t/hcsec-2024-03-nomad-vulnerable-to-arbitrary-write-through-symlink-attack/62602)  [Security](/c/security/52) [security-nomad](https://discuss.hashicorp.com/tag/security-nomad) | 0 | 6350 | February 8, 2024 |
| [HCSEC-2020-21 - Nomad File Sandbox Escape via Template and Artifact Stanzas](https://discuss.hashicorp.com/t/hcsec-2020-21-nomad-file-sandbox-escape-via-template-and-artifact-stanzas/18106)  [Security](/c/security/52) [security-nomad](https://discuss.hashicorp.com/tag/security-nomad) | 0 | 4244 | November 25, 2020 |
| [HCSEC-2020-08 - Nomad's Raw File View Vulnerable to Cross-Site Scripting](https://discuss.hashicorp.com/t/hcsec-2020-08-nomads-raw-file-view-vulnerable-to-cross-site-scripting/18091)  [Security](/c/security/52) [security-nomad](https://discuss.hashicorp.com/tag/security-nomad) | 0 | 4096 | November 25, 2020 |

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](/tos)
* [Privacy Policy](https://meta.discourse.org/privacy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled


