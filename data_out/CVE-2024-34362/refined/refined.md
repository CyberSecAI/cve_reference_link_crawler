- **Root cause of vulnerability**: Use-after-free in `HttpConnectionManager` (HCM) with `EnvoyQuicServerStream` due to incorrect handling of `RESET_STREAM` frames. The `EnvoyQuicServerStream` does not run reset callbacks upon receiving `RESET_STREAM` if a `STOP_SENDING` frame was not received before or after. When a client sends a request without `FIN` and then sends a `RESET_STREAM` frame, the stream is not properly reset, and the `ActiveStream` in HCM still references the QUIC stream as the response encoder even after the QUIC stream is closed.
- **Weaknesses/vulnerabilities present**: Use-after-free vulnerability (CWE-416). The lack of proper reset callback execution upon receiving a `RESET_STREAM` frame without a prior or subsequent `STOP_SENDING` frame results in a dangling pointer.
- **Impact of exploitation**: A successful exploitation can lead to a crash of the Envoy proxy. Specifically, accessing the response encoder after the QUIC stream is destroyed leads to a use-after-free, triggering a crash.
- **Attack vectors**: A malicious client can trigger this vulnerability by sending a request without a `FIN` flag, followed by a `RESET_STREAM` frame.
- **Required attacker capabilities/position**: The attacker needs to be able to send QUIC packets to an Envoy instance, specifically crafted with the above mentioned sequence. No special privileges or user interaction is required.