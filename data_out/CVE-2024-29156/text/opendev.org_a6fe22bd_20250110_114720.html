
This website requires JavaScript.
[![Logo](/assets/img/logo.svg)](/)

[Explore](/explore/repos)
[Get Started](https://docs.opendev.org/opendev/infra-manual/latest/gettingstarted.html)

[openstack](/openstack)/[yaql](/openstack/yaql)

[Code](/openstack/yaql/src/branch/master)
[Issues](https://bugs.launchpad.net/yaql)
[Proposed changes](https://review.opendev.org/#/q/status:open+project:openstack/yaql)

### Remove format function

[Browse Source](/openstack/yaql/src/commit/83e28324e1a0ce3970dd854393d2431123a909d3)

```
The format function allowed too arbitrary access to the values being
formatted, and this behavior caused information leakage in some cases.

Closes-Bug: [#2048114](https://bugs.launchpad.net/yaql/%2Bbug/2048114)
Change-Id: Id7ec5f267314bb7166ca64802ab47d768bb5eb89
```
...

This commit is contained in:

![](/assets/img/avatar_default.png "kajinamit@oss.nttdata.com")
parent
[2a159b85ae](/openstack/yaql/commit/2a159b85ae02f74645b22822e40fcbccf495493f)

commit
83e28324e1

 **4 changed files** with **16 additions** and **40 deletions**

[Show all changes](?style=unified&whitespace=show-all&show-outdated=)
[Ignore whitespace when comparing lines](?style=unified&whitespace=ignore-all&show-outdated=)
[Ignore changes in amount of whitespace](?style=unified&whitespace=ignore-change&show-outdated=)
[Ignore changes in whitespace at EOL](?style=unified&whitespace=ignore-eol&show-outdated=)

Show Stats
[Download Patch File](/openstack/yaql/commit/83e28324e1a0ce3970dd854393d2431123a909d3.patch)
[Download Diff File](/openstack/yaql/commit/83e28324e1a0ce3970dd854393d2431123a909d3.diff)
Expand all files
Collapse all files

#### 12 [releasenotes/notes/bug-2048114-0968eea052838381.yaml](#diff-9a03ae5c8ec8b30318061e2c83687de453afd1f2 "releasenotes/notes/bug-2048114-0968eea052838381.yaml") Normal file Unescape Escape [View File](/openstack/yaql/src/commit/83e28324e1a0ce3970dd854393d2431123a909d3/releasenotes/notes/bug-2048114-0968eea052838381.yaml)

|  | |  |  | `@ -0,0 +1,12 @@` |
|  |  |  |  | `---` |
|  |  |  |  | `upgrade:` |
|  |  |  |  | `- |` |
|  |  |  |  | `The format YAQL function has been removed, because of its vulnability. See` |
|  |  |  |  | `the security section to find more details.` |
|  |  |  |  |  |
|  |  |  |  | `security:` |
|  |  |  |  | `- |` |
|  |  |  |  | ``<https://bugs.launchpad.net/murano/+bug/2048114>`_: The format YAQL` |
|  |  |  |  | `function has been removed, because it allowed too arbitrary data access` |
|  |  |  |  | `which results in data leak. Users can replace the format function by` |
|  |  |  |  | ```+`` operator and ``str`` YAQL function.` |

#### 33 [yaql/standard\_library/strings.py](#diff-0ac69c3fc791f8c1d8ff31e907641b7fa6232bcf "yaql/standard_library/strings.py") Unescape Escape [View File](/openstack/yaql/src/commit/83e28324e1a0ce3970dd854393d2431123a909d3/yaql/standard_library/strings.py)

|  | |  |  | `@ -564,38 +564,6 @@ def replace_with_dict(string, str_func, replacements, count=-1):` |
|  |  |  |  | `return string` |
|  |  |  |  |  |
|  |  |  |  |  |
|  |  |  |  | `@specs.parameter('__format_string', yaqltypes.String())` |
|  |  |  |  | `@specs.extension_method` |
|  |  |  |  | `def format_(__format_string, *args, **kwargs):` |
|  |  |  |  | `""":yaql:format` |
|  |  |  |  |  |
|  |  |  |  | `Returns a string formatted with positional and keyword arguments.` |
|  |  |  |  |  |
|  |  |  |  | `:signature: string.format([args], {kwargs})` |
|  |  |  |  | `:receiverArg string: input string for formatting. Can be passed only as` |
|  |  |  |  | `first positional argument if used as a function. Can contain literal` |
|  |  |  |  | `text or replacement fields marked by braces {}. Every replacement field` |
|  |  |  |  | `should contain either the numeric index of a positional argument or the` |
|  |  |  |  | `name of a keyword argument` |
|  |  |  |  | `:argType string: string` |
|  |  |  |  | `:arg [args]: values for replacements for numeric markers` |
|  |  |  |  | `:argType [args]: chain of strings` |
|  |  |  |  | `:arg {kwargs}: values for keyword replacements` |
|  |  |  |  | `:argType {kwargs}: chain of key-value arguments, where values are strings` |
|  |  |  |  | `:returnValue: string` |
|  |  |  |  |  |
|  |  |  |  | `.. code::` |
|  |  |  |  |  |
|  |  |  |  | `yaql> "abc{0}ab{1}abc".format(" ", ",")` |
|  |  |  |  | `"abc ab,abc"` |
|  |  |  |  | `yaql> "abc{foo}ab{bar}abc".format(foo => " ", bar => ",")` |
|  |  |  |  | `"abc ab,abc"` |
|  |  |  |  | `yaql> format("abc{0}ab{foo}abc", ' ', foo => ",")` |
|  |  |  |  | `"abc ab,abc"` |
|  |  |  |  | `"""` |
|  |  |  |  | `return __format_string.format(*args, **kwargs)` |
|  |  |  |  |  |
|  |  |  |  |  |
|  |  |  |  | `@specs.parameter('left', yaqltypes.String())` |
|  |  |  |  | `@specs.parameter('right', int)` |
|  |  |  |  | `@specs.name('#operator_*')` |
|  | |  |  | `@ -1045,7 +1013,6 @@ def register(context):` |
|  |  |  |  | `context.register_function(trim_right)` |
|  |  |  |  | `context.register_function(replace)` |
|  |  |  |  | `context.register_function(replace_with_dict)` |
|  |  |  |  | `context.register_function(format_)` |
|  |  |  |  | `context.register_function(is_empty)` |
|  |  |  |  | `context.register_function(string_by_int)` |
|  |  |  |  | `context.register_function(int_by_string)` |
|  | |  |  |  |

#### 7 [yaql/tests/test\_regex.py](#diff-d98b70de9f9283052a3e26b04e1755f7e59f584a "yaql/tests/test_regex.py") Unescape Escape [View File](/openstack/yaql/src/commit/83e28324e1a0ce3970dd854393d2431123a909d3/yaql/tests/test_regex.py)

|  | |  |  | `@ -50,9 +50,10 @@ class TestRegex(yaql.tests.TestCase):` |
|  |  |  |  | `'24.16 = 24(2-4) + 16(5-7)',` |
|  |  |  |  | `self.eval(` |
|  |  |  |  | `r"regex(`(\d+)\.?(\d+)?`).search("r"'aa24.16bb', "` |
|  |  |  |  | `r"format('{0} = {1}({2}-{3}) + {4}({5}-{6})', "` |
|  |  |  |  | `r"$.value, $2.value, $2.start, $2.end, "` |
|  |  |  |  | `r"$3.value, $3.start, $3.end))"))` |
|  |  |  |  | `r"$.value + ' = ' + "` |
|  |  |  |  | `r"$2.value + '(' + str($2.start) + '-' + str($2.end) + ') + ' "` |
|  |  |  |  | `r"+ $3.value + '(' + str($3.start) + '-' + str($3.end) + ')')"` |
|  |  |  |  | `))` |
|  |  |  |  |  |
|  |  |  |  | `def test_search_all(self):` |
|  |  |  |  | `self.assertEqual(` |
|  | |  |  |  |

#### 4 [yaql/tests/test\_strings.py](#diff-bde7400fd3fef391890ea56444a34b440cf08858 "yaql/tests/test_strings.py") Unescape Escape [View File](/openstack/yaql/src/commit/83e28324e1a0ce3970dd854393d2431123a909d3/yaql/tests/test_strings.py)

|  | |  |  | `@ -118,10 +118,6 @@ class TestStrings(yaql.tests.TestCase):` |
|  |  |  |  | `def test_concat_func(self):` |
|  |  |  |  | `self.assertEqual('abc', self.eval("concat(a, b, c)"))` |
|  |  |  |  |  |
|  |  |  |  | `def test_format(self):` |
|  |  |  |  | `self.assertEqual('a->b', self.eval("'{0}->{x}'.format(a, x => b)"))` |
|  |  |  |  | `self.assertEqual('a->b', self.eval("format('{0}->{x}', a, x => b)"))` |
|  |  |  |  |  |
|  |  |  |  | `def test_trim(self):` |
|  |  |  |  | `self.assertEqual('x', self.eval("' x '.trim()"))` |
|  |  |  |  | `self.assertEqual('x', self.eval("'abxba'.trim(ab)"))` |
|  | |  |  |  |

Write
Preview

Loading…

Cancel
Save

Reference in New Issue

**Repository**
openstack/yaql

**Title**

**Body**

Create Issue

Block a user
Blocking a user prevents them from interacting with repositories, such as opening or commenting on pull requests or issues. Learn more about blocking a user.

User to block:

Optional note:

The note is not visible to the blocked user.

Cancel
Block

[Powered by Gitea](https://about.gitea.com)
Version:
v1.22.6
Page: **128ms**
Template: **72ms**

 English
Bahasa Indonesia
Deutsch
English
Español
Français
Italiano
Latviešu
Magyar nyelv
Nederlands
Polski
Português de Portugal
Português do Brasil
Suomi
Svenska
Türkçe
Čeština
Ελληνικά
Български
Русский
Українська
فارسی
മലയാളം
日本語
简体中文
繁體中文（台灣）
繁體中文（香港）
한국어

[Licenses](/assets/licenses.txt)
[API](/api/swagger)

