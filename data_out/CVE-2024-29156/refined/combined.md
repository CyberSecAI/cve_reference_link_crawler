=== Content from opendev.org_c082fcdf_20250110_114720.html ===

This website requires JavaScript.
[![Logo](/assets/img/logo.svg)](/)

[Explore](/explore/repos)
[Get Started](https://docs.opendev.org/opendev/infra-manual/latest/gettingstarted.html)

[openstack](/openstack)/[murano](/openstack/murano)

[Code](/openstack/murano)
[Issues](https://bugs.launchpad.net/murano)
[Proposed changes](https://review.opendev.org/#/q/status:open+project:openstack/murano)

## [0 Releases](/openstack/murano/releases) [31 Tags](/openstack/murano/tags)

[RSS Feed](/openstack/murano/tags.rss)

#### Tags

| [zed-eol](/openstack/murano/releases/tag/zed-eol) 2024-11-28 10:48:28 +00:00 [6e16b0b638](/openstack/murano/src/commit/6e16b0b6388190b64c34de18322b46f1f0d5c430) [ZIP](/openstack/murano/archive/zed-eol.zip) [TAR.GZ](/openstack/murano/archive/zed-eol.tar.gz) |
| --- |
| [yoga-eol](/openstack/murano/releases/tag/yoga-eol) 2024-11-28 10:47:39 +00:00 [2d28f9e2af](/openstack/murano/src/commit/2d28f9e2affcb2dcff0508f70257605eaacf061a) [ZIP](/openstack/murano/archive/yoga-eol.zip) [TAR.GZ](/openstack/murano/archive/yoga-eol.tar.gz) |
| [2023.1-eol](/openstack/murano/releases/tag/2023.1-eol) 2024-11-28 10:46:58 +00:00 [602656efe0](/openstack/murano/src/commit/602656efe06fb266ad878267be74ddb906c6b9db) [ZIP](/openstack/murano/archive/2023.1-eol.zip) [TAR.GZ](/openstack/murano/archive/2023.1-eol.tar.gz) |
| [zed-eom](/openstack/murano/releases/tag/zed-eom) 2024-05-08 11:09:53 +00:00 [6e16b0b638](/openstack/murano/src/commit/6e16b0b6388190b64c34de18322b46f1f0d5c430) [ZIP](/openstack/murano/archive/zed-eom.zip) [TAR.GZ](/openstack/murano/archive/zed-eom.tar.gz) |
| [xena-eol](/openstack/murano/releases/tag/xena-eol) 2024-04-11 12:57:38 +00:00 [8de36ff8c9](/openstack/murano/src/commit/8de36ff8c95a8000bd3b82f639775ce4d06fd4a0) [ZIP](/openstack/murano/archive/xena-eol.zip) [TAR.GZ](/openstack/murano/archive/xena-eol.tar.gz) |
| [wallaby-eol](/openstack/murano/releases/tag/wallaby-eol) 2024-04-11 12:57:19 +00:00 [984536cf8d](/openstack/murano/src/commit/984536cf8d1ea89b5fb62e350e0f008cf0e8329d) [ZIP](/openstack/murano/archive/wallaby-eol.zip) [TAR.GZ](/openstack/murano/archive/wallaby-eol.tar.gz) |
| [victoria-eol](/openstack/murano/releases/tag/victoria-eol) 2024-04-11 12:57:01 +00:00 [dc4c4b79d2](/openstack/murano/src/commit/dc4c4b79d2772c854bfda3a142a4212b76059c30) [ZIP](/openstack/murano/archive/victoria-eol.zip) [TAR.GZ](/openstack/murano/archive/victoria-eol.tar.gz) |
| [yoga-eom](/openstack/murano/releases/tag/yoga-eom) 2024-02-21 14:08:33 +00:00 [2d28f9e2af](/openstack/murano/src/commit/2d28f9e2affcb2dcff0508f70257605eaacf061a) [ZIP](/openstack/murano/archive/yoga-eom.zip) [TAR.GZ](/openstack/murano/archive/yoga-eom.tar.gz) |
| [ussuri-eol](/openstack/murano/releases/tag/ussuri-eol) 2024-02-19 14:46:09 +00:00 [36079e0a5a](/openstack/murano/src/commit/36079e0a5ab10216d4f86be0794bbd8b7c5c757f) [ZIP](/openstack/murano/archive/ussuri-eol.zip) [TAR.GZ](/openstack/murano/archive/ussuri-eol.tar.gz) |
| [train-eol](/openstack/murano/releases/tag/train-eol) 2024-02-19 10:18:01 +00:00 [52a5fc3358](/openstack/murano/src/commit/52a5fc33587c2fbf6aa656b4e3fd9db927aa2bc8) [ZIP](/openstack/murano/archive/train-eol.zip) [TAR.GZ](/openstack/murano/archive/train-eol.tar.gz) |

First
Previous
1
[2](/openstack/murano/tags?page=2)
[3](/openstack/murano/tags?page=3)
[4](/openstack/murano/tags?page=4)
[Next](/openstack/murano/tags?page=2)
[Last](/openstack/murano/tags?page=4)

[Powered by Gitea](https://about.gitea.com)
Version:
v1.22.6
Page: **19ms**
Template: **4ms**

 English
Bahasa Indonesia
Deutsch
English
Español
Français
Italiano
Latviešu
Magyar nyelv
Nederlands
Polski
Português de Portugal
Português do Brasil
Suomi
Svenska
Türkçe
Čeština
Ελληνικά
Български
Русский
Українська
فارسی
മലയാളം
日本語
简体中文
繁體中文（台灣）
繁體中文（香港）
한국어

[Licenses](/assets/licenses.txt)
[API](/api/swagger)



=== Content from wiki.openstack.org_1d25c538_20250110_114721.html ===


* [![OpenStack](https://wiki.openstack.org/w/images/thumb/c/c4/OpenStack_Logo_-_notext.png/30px-OpenStack_Logo_-_notext.png)](/wiki/Main_Page "Visit the main page")

* Page
  + [Page](/wiki/OSSN/OSSN-0093 "View the content page [c]")
  + [Discussion](/w/index.php?title=Talk:OSSN/OSSN-0093&action=edit&redlink=1 "Discussion about the content page [t]")
  + [View source](/w/index.php?title=OSSN/OSSN-0093&action=edit "This page is protected.
    You can view its source [e]")
  + [History](/w/index.php?title=OSSN/OSSN-0093&action=history "Past revisions of this page [h]")

* Print/export
  + [Create a book](/w/index.php?title=Special:Book&bookcmd=book_creator&referer=OSSN%2FOSSN-0093)
  + [Download as PDF](/w/index.php?title=Special:Book&bookcmd=render_article&arttitle=OSSN%2FOSSN-0093&returnto=OSSN%2FOSSN-0093&oldid=184540&writer=rl)
  + [Printable version](/w/index.php?title=OSSN/OSSN-0093&printable=yes "Printable version of this page [p]")

* Tools
  + [Page information](/w/index.php?title=OSSN/OSSN-0093&action=info "More information about this page")
  + [Permanent link](/w/index.php?title=OSSN/OSSN-0093&oldid=184540 "Permanent link to this revision of the page")
  + [Special pages](/wiki/Special%3ASpecialPages "A list of all special pages [q]")
  + [Related changes](/wiki/Special%3ARecentChangesLinked/OSSN/OSSN-0093 "Recent changes in pages linked from this page [k]")
  + [What links here](/wiki/Special%3AWhatLinksHere/OSSN/OSSN-0093 "A list of all wiki pages that link here [j]")

* * [Create account](/w/index.php?title=Special:CreateAccount&returnto=OSSN%2FOSSN-0093 "You are encouraged to create an account and log in; however, it is not mandatory")
* * [Log in](/w/index.php?title=Special:UserLogin&returnto=OSSN%2FOSSN-0093 "You are encouraged to log in; however, it is not mandatory [o]")
* * [Log in / create account with OpenID](/w/index.php?title=Special:OpenIDLogin&returnto=OSSN/OSSN-0093)
* + English

* [Home](http://www.openstack.org)
* [Software](http://www.openstack.org/software)
* [User Stories](http://www.openstack.org/user-stories)
* [Community](http://www.openstack.org/community)
* [Profile](http://www.openstack.org/profile)
* [Blog](http://www.openstack.org/blog)
* [Wiki](http://wiki.openstack.org)
* [Documentation](http://docs.openstack.org)

Jump to: [navigation](#mw-head),
[search](#p-search)

# OSSN/OSSN-0093

< [OSSN](/wiki/OSSN "OSSN")

## Contents

* [1 Unsafe Environment Handling in MuranoPL](#Unsafe_Environment_Handling_in_MuranoPL)
  + [1.1 Summary](#Summary)
  + [1.2 Affected Services / Software](#Affected_Services_.2F_Software)
  + [1.3 Discussion](#Discussion)
  + [1.4 Recommended Actions](#Recommended_Actions)
  + [1.5 Credits](#Credits)
  + [1.6 Contacts / References](#Contacts_.2F_References)
## Unsafe Environment Handling in MuranoPL

### Summary

The Murano service's MuranoPL extension to the YAQL language fails to sanitize the supplied environment, leading to potential leakage of sensitive service account information. Murano is an inactive project, so no fix is currently under development for this vulnerability. It is strongly recommended that any OpenStack deployments disable or fully remove Murano, if installed, at the earliest opportunity.

### Affected Services / Software

Murano (all versions)

### Discussion

The YAQL interpreter project has released a new major version (3.0.0) which removes support for format strings, a feature necessary to exploit this condition in MuranoPL. Because Murano is not considered under active maintenance in OpenStack, its complete removal from all deployments is still strongly advised.

Note that this behavior change in YAQL means configurations relying on string formatting will no longer be interpreted the same after upgrading, which could cause them to not work as intended by their users in services which accept YAQL (including Heat and Mistral). Reliance on that feature is considered to be unusual, but users should be made aware in case it negatively impacts their configuration.

### Recommended Actions

Disable the Murano service in, or fully remove it from, all OpenStack deployments at the earliest opportunity.

### Credits

kirualawliet and Zhiniang Peng (@edwardzpeng) from Sangfor Security Research Team

### Contacts / References

**Author:**

* Jeremy Stanley, OpenStack Vulnerability Coordinator

This OSSN : <https://wiki.openstack.org/wiki/OSSN/OSSN-0093>

Original LaunchPad Bug : <https://launchpad.net/bugs/2048114>

Mailing List : [security-sig] openstack-discuss@lists.openstack.org

CVE: <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-29156>

Retrieved from "<https://wiki.openstack.org/w/index.php?title=OSSN/OSSN-0093&oldid=184540>"

* [Privacy policy](/wiki/OpenStack%3APrivacy_policy "OpenStack:Privacy policy")
* [About OpenStack](/wiki/OpenStack%3AAbout "OpenStack:About")
* [Disclaimers](/wiki/OpenStack%3AGeneral_disclaimer "OpenStack:General disclaimer")

* [![Attribution 3.0 Unported (CC BY 3.0)](/w/resources/assets/licenses/cc-by.png)](http://creativecommons.org/licenses/by/3.0/)
* [![Powered by MediaWiki](/w/resources/assets/poweredby_mediawiki_88x31.png)](//www.mediawiki.org/)



=== Content from launchpad.net_b2b541b5_20250110_114719.html ===

[Log in / Register](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Blogin)

[![](/@@/product-logo)](https://launchpad.net/murano)

## [Murano](https://launchpad.net/murano)

* [Overview](https://launchpad.net/murano)
* [Code](https://code.launchpad.net/murano)
* [Bugs](https://bugs.launchpad.net/murano)
* [Blueprints](https://blueprints.launchpad.net/murano)
* [Translations](https://translations.launchpad.net/murano)
* [Answers](https://answers.launchpad.net/murano)

# Unsafe Environment Handling in MuranoPL

Bug #2048114 reported by
[Jeremy Stanley](https://launchpad.net/~fungi)
on 2024-01-04

[276](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Murano](https://bugs.launchpad.net/murano) | New | Undecided | Unassigned |  |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Won't Fix | Undecided | Unassigned |  |
|  | [OpenStack Security Notes](https://bugs.launchpad.net/ossn) | Fix Released | High | [Jeremy Stanley](https://launchpad.net/~fungi) |  |
|  | [YAQL](https://bugs.launchpad.net/yaql) | Fix Released | Critical | [Takashi Kajinami](https://launchpad.net/~kajinamit) |  |

### Bug Description

Members of the VMT received the following report by E-mail from "kirualawliet l":

Title: OpenStack Murano Component Information Leakage

Reporter: lawliet and Zhiniang Peng (@edwardzpeng) from Sangfor Security Research Team

Products: OpenStack Murano Component

Affects: All versions of Murano Component

Description:

The Sangfor Security Research Team has identified a critical security vulnerability in the Murano component of OpenStack. This vulnerability allows ordinary users capable of importing and deploying app packages to access sensitive information within OpenStack services. Specifically, through this exploit, unauthorized users can obtain Murano service account credentials, potentially escalating their privileges to an administrator level. Subsequently, unauthorized users can gain complete control over various resources, including user roles, hosts, and networks.

The vulnerability stems from the Murano service's reliance on MuranoPL, an extension of the YAQL language. The YAQL library includes a 'format' function that mirrors Python's 'str.format' method, enabling attribute access.

```python

# code snippet from yaql-2.0.0\standard\_library\strings.py:569

@specs.parameter('\_\_format\_string', yaqltypes.String())

@specs.extension\_method

def format\_(\_\_format\_string, \*args, \*\*kwargs):

    ...

    return \_\_format\_string.format(\*args, \*\*kwargs)

```

An example of this vulnerability includes:

```

>>> secret\_key = "abcd1234"

>>> class Test:

... def \_\_init\_\_(self):

... pass

...

>>> t = Test()

>>> # Exploiting the vulnerability to expose sensitive data:

>>> malicious\_format\_string = '{0.\_\_class\_\_.\_\_init\_\_.\_\_globals\_\_[secret\_key]}'

>>> formatted\_output = malicious\_format\_string.format(t)

>>> print(formatted\_output) # This line reveals the value of secret\_key

'abcd1234'

```

This exploit allows access to Murano service's oslo configuration storage, thereby exposing critical Murano service account credentials, granting unauthorized users administrative privileges.

We believe no deployment mode is immune to this vulnerability. To ensure system security, we recommend immediate attention and remediation of this vulnerability within the OpenStack Murano component. Our team stands ready to offer assistance and collaboration in addressing and resolving this issue promptly.

Thank you for your prompt attention to this matter.

Sincerely,

kirualawliet

Sangfor Security Research Team

See [original description](comments/0)

## CVE References

* [2024-29156](/bugs/cve/2024-29156 "In OpenStack Murano through 16.0.0, w...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-01-04: |  |  | [#1](/murano/%2Bbug/2048114/comments/1) |
| --- | --- | --- | --- |

* [leaking murano account and password](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5736495/%2Bfiles/image.png)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5736495)
  (90.9 KiB,
  image/png)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-01-04: |  |  | [#2](/murano/%2Bbug/2048114/comments/2) |
| --- | --- | --- | --- |

* [logining with leakd murano credentials](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5736496/%2Bfiles/image.png)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5736496)
  (90.9 KiB,
  image/png)

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Won't Fix |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-01-04: |  |  | [#3](/murano/%2Bbug/2048114/comments/3) |
| --- | --- | --- | --- |

Please be aware that reports of suspected vulnerabilities in Murano's deliverables aren't officially overseen by the OpenStack VMT, and so won't be producing any public advisory, but we remain available to assist with coordination on a best effort basis at the Murano team's request. <https://security.openstack.org/repos-overseen.html#repositories-overseen>

Please be aware that reports of suspected vulnerabilities in Murano's deliverables aren't officially overseen by the OpenStack VMT, and so won't be producing any public advisory, but we remain available to assist with coordination on a best effort basis at the Murano team's request. https://security.openstack.org/repos-overseen.html#repositories-overseen

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-01-05: |  |  | [#4](/murano/%2Bbug/2048114/comments/4) |
| --- | --- | --- | --- |

I've also subscribed kirualawliet, the original reporter.

I've also subscribed kirualawliet, the original reporter.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [kirualawliet (kirualawliet)](https://launchpad.net/~kirualawliet) wrote on 2024-02-12:  [**Re: [Bug 2048114] Re: OpenStack Murano Component Information Leakage**](/murano/%2Bbug/2048114/comments/5) |  |  | [#5](/murano/%2Bbug/2048114/comments/5) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/murano/%2Bbug/2048114/comments/5/%2Bdownload) (3.5 KiB)

Hello Jeremy Stanley,

    I wanted to know whether the Murano team has received information

regarding the vulnerability. I haven't seen any progress on the

vulnerability fix on Launchpad and would like to understand the current

situation. Our plan is to disclose the technical details of the

vulnerability publicly one month from now if there are no intentions to

address it.

Best regards,

lawliet

On Sat, 6 Jan 2024 at 00:10, Jeremy Stanley <email address hidden>

wrote:

> I've also subscribed kirualawliet, the original reporter.

>

> --

> You received this bug notification because you are subscribed to the bug

> report.

> <https://bugs.launchpad.net/bugs/2048114>

>

> Title:

> OpenStack Murano Component Information Leakage

>

> Status in Murano:

> New

> Status in OpenStack Security Advisory:

> Won't Fix

>

> Bug description:

> Members of the VMT received the following report by E-mail from

> "kirualawliet l":

>

> Title: OpenStack Murano Component Information Leakage

>

> Reporter: lawliet and edwardpeng(@edwardzpeng) from Sangfor Security

> Research Team

>

> Products: OpenStack Murano Component

>

> Affects: All versions of Murano Component

>

> Description:

>

> The Sangfor Security Research Team has identified a critical security

> vulnerability in the Murano component of OpenStack. This vulnerability

> allows ordinary users capable of importing and deploying app packages

> to access sensitive information within OpenStack services.

> Specifically, through this exploit, unauthorized users can obtain

> Murano service account credentials, potentially escalating their

> privileges to an administrator level. Subsequently, unauthorized users

> can gain complete control over various resources, including user

> roles, hosts, and networks.

>

> The vulnerability stems from the Murano service's reliance on

> MuranoPL, an extension of the YAQL language. The YAQL library includes

> a 'format' function that mirrors Python's 'str.format' method,

> enabling attribute access.

>

> ```python

> # code snippet from yaql-2.0.0\standard\_library\strings.py:569

> @specs.parameter('\_\_format\_string', yaqltypes.String())

> @specs.extension\_method

> def format\_(\_\_format\_string, \*args, \*\*kwargs):

> ...

> return \_\_format\_string.format(\*args, \*\*kwargs)

> ```

>

> An example of this vulnerability includes:

>

> ```

> >>> secret\_key = "abcd1234"

> >>> class Test:

> ... def \_\_init\_\_(self):

> ... pass

> ...

> >>> t = Test()

> >>> # Exploiting the vulnerability to expose sensitive data:

> >>> malicious\_format\_string =

> '{0.\_\_class\_\_.\_\_init\_\_.\_\_globals\_\_[secret\_key]}'

> >>> formatted\_output = malicious\_format\_string.format(t)

> >>> print(formatted\_output) # This line reveals the value of secret\_key

> 'abcd1234'

> ```

>

> This exploit allows access to Murano service's oslo configuration

> storage, thereby exposing critical Murano service account credentials,

> granting unauthorized users administrative privileges.

>

> We believe no deployment mode is immune to this vulnerability. To

> ensure system security, we recommend immediate attention and

> remediation...

[Read more...](/murano/%2Bbug/2048114/comments/5)

Hello Jeremy Stanley,
I wanted to know whether the Murano team has received information
regarding the vulnerability. I haven't seen any progress on the
vulnerability fix on Launchpad and would like to understand the current
situation. Our plan is to disclose the technical details of the
vulnerability publicly one month from now if there are no intentions to
address it.
Best regards,
lawliet
On Sat, 6 Jan 2024 at 00:10, Jeremy Stanley <2048114@bugs.launchpad.net>
wrote:
> I've also subscribed kirualawliet, the original reporter.
>
> --
> You received this bug notification because you are subscribed to the bug
> report.
> https://bugs.launchpad.net/bugs/2048114
>
> Title:
> OpenStack Murano Component Information Leakage
>
> Status in Murano:
> New
> Status in OpenStack Security Advisory:
> Won't Fix
>
> Bug description:
> Members of the VMT received the following report by E-mail from
> "kirualawliet l":
>
> Title: OpenStack Murano Component Information Leakage
>
> Reporter: lawliet and edwardpeng(@edwardzpeng) from Sangfor Security
> Research Team
>
> Products: OpenStack Murano Component
>
> Affects: All versions of Murano Component
>
> Description:
>
> The Sangfor Security Research Team has identified a critical security
> vulnerability in the Murano component of OpenStack. This vulnerability
> allows ordinary users capable of importing and deploying app packages
> to access sensitive information within OpenStack services.
> Specifically, through this exploit, unauthorized users can obtain
> Murano service account credentials, potentially escalating their
> privileges to an administrator level. Subsequently, unauthorized users
> can gain complete control over various resources, including user
> roles, hosts, and networks.
>
> The vulnerability stems from the Murano service's reliance on
> MuranoPL, an extension of the YAQL language. The YAQL library includes
> a 'format' function that mirrors Python's 'str.format' method,
> enabling attribute access.
>
> ```python
> # code snippet from yaql-2.0.0\standard\_library\strings.py:569
> @specs.parameter('\_\_format\_string', yaqltypes.String())
> @specs.extension\_method
> def format\_(\_\_format\_string, \*args, \*\*kwargs):
> ...
> return \_\_format\_string.format(\*args, \*\*kwargs)
> ```
>
> An example of this vulnerability includes:
>
> ```
> >>> secret\_key = "abcd1234"
> >>> class Test:
> ... def \_\_init\_\_(self):
> ... pass
> ...
> >>> t = Test()
> >>> # Exploiting the vulnerability to expose sensitive data:
> >>> malicious\_format\_string =
> '{0.\_\_class\_\_.\_\_init\_\_.\_\_globals\_\_[secret\_key]}'
> >>> formatted\_output = malicious\_format\_string.format(t)
> >>> print(formatted\_output) # This line reveals the value of secret\_key
> 'abcd1234'
> ```
>
> This exploit allows access to Murano service's oslo configuration
> storage, thereby exposing critical Murano service account credentials,
> granting unauthorized users administrative privileges.
>
> We believe no deployment mode is immune to this vulnerability. To
> ensure system security, we recommend immediate attention and
> remediation of this vulnerability within the OpenStack Murano
> component. Our team stands ready to offer assistance and collaboration
> in addressing and resolving this issue promptly.
>
> Thank you for your prompt attention to this matter.
>
> Sincerely,
> kirualawliet
> Sangfor Security Research Team
>
> To manage notifications about this bug go to:
> https://bugs.launchpad.net/murano/+bug/2048114/+subscriptions
>
>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-02-20:  [**Re: OpenStack Murano Component Information Leakage**](/murano/%2Bbug/2048114/comments/6) |  |  | [#6](/murano/%2Bbug/2048114/comments/6) |
| --- | --- | --- | --- |

Sorry for the delay in responding. There was a bit of a leadership crisis for Murano, and nobody in the existing group authorized to see this report was around to look into the issue you reported. In the past 24 hours, some headway was made in adding an active contributor to that group, so hopefully they'll be able to weigh in on the associated scope and risk for this soon.

Sorry for the delay in responding. There was a bit of a leadership crisis for Murano, and nobody in the existing group authorized to see this report was around to look into the issue you reported. In the past 24 hours, some headway was made in adding an active contributor to that group, so hopefully they'll be able to weigh in on the associated scope and risk for this soon.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andy Botting (andybotting)](https://launchpad.net/~andybotting) wrote on 2024-02-20: |  |  | [#7](/murano/%2Bbug/2048114/comments/7) |
| --- | --- | --- | --- |

Thanks @kirualawliet for reporting this issue.

It does look quite serious if the oslo configuration context is able to be accessed from users own packages.

Your original post shows accessing the YAQL format method via a python shell, but can you demonstrate that the oslo configuration is able to be accessed from a Murano package?

Have you actually developed an app I can run against a running Murano service as a proof of concept?

Thanks,

Andy

Thanks @kirualawliet for reporting this issue.
It does look quite serious if the oslo configuration context is able to be accessed from users own packages.
Your original post shows accessing the YAQL format method via a python shell, but can you demonstrate that the oslo configuration is able to be accessed from a Murano package?
Have you actually developed an app I can run against a running Murano service as a proof of concept?
Thanks,
Andy

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [kirualawliet (kirualawliet)](https://launchpad.net/~kirualawliet) wrote on 2024-02-22: |  |  | [#8](/murano/%2Bbug/2048114/comments/8) |
| --- | --- | --- | --- |

* [app\_mysql\_murano\_leak\_info\_credit.zip](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5748292/%2Bfiles/app_mysql_murano_leak_info_credit.zip)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5748292)
  (11.8 KiB,
  application/zip)

Okay, please upload and deploy the zip file in the attachment to Murano. The deployment process will encounter errors. Please check the deployment logs. If everything goes smoothly, you should be able to see the leaked Oslo configuration in the deployment logs.

Okay, please upload and deploy the zip file in the attachment to Murano. The deployment process will encounter errors. Please check the deployment logs. If everything goes smoothly, you should be able to see the leaked Oslo configuration in the deployment logs.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andy Botting (andybotting)](https://launchpad.net/~andybotting) wrote on 2024-02-22: |  |  | [#9](/murano/%2Bbug/2048114/comments/9) |
| --- | --- | --- | --- |

Thanks @kirualawliet. I can confirm it does leak the server's oslo config.

I can see my Keystone auth, database and RabbitMQ passwords in there.

Looks like this is a serious one then.

Thanks @kirualawliet. I can confirm it does leak the server's oslo config.
I can see my Keystone auth, database and RabbitMQ passwords in there.
Looks like this is a serious one then.

[Andy Botting (andybotting)](https://launchpad.net/~andybotting)
on 2024-02-22

| **information type**: | Private Security → Private |
| --- | --- |
| **information type**: | Private → Private Security |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andy Botting (andybotting)](https://launchpad.net/~andybotting) wrote on 2024-02-22: |  |  | [#10](/murano/%2Bbug/2048114/comments/10) |
| --- | --- | --- | --- |

@jeremy Can you please add launchpad id: waipengyip to this bug?

@jeremy Can you please add launchpad id: waipengyip to this bug?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-02-22: |  |  | [#11](/murano/%2Bbug/2048114/comments/11) |
| --- | --- | --- | --- |

Added, but in future you should feel free to subscribe subject matter experts yourself when their input is needed on such bug reports.

Also, just to reiterate what I stated in comment #3, the VMT doesn't officially oversee or coordinate vulnerability reports for Murano, though we're happy to assist on a best-effort basis when requested.

Added, but in future you should feel free to subscribe subject matter experts yourself when their input is needed on such bug reports.
Also, just to reiterate what I stated in comment #3, the VMT doesn't officially oversee or coordinate vulnerability reports for Murano, though we're happy to assist on a best-effort basis when requested.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [kirualawliet (kirualawliet)](https://launchpad.net/~kirualawliet) wrote on 2024-02-23:  [**Re: [Bug 2048114] Re: OpenStack Murano Component Information Leakage**](/murano/%2Bbug/2048114/comments/12) |  |  | [#12](/murano/%2Bbug/2048114/comments/12) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/murano/%2Bbug/2048114/comments/12/%2Bdownload) (3.9 KiB)

Yes, I have reviewed the announcement and understand that Murano is

currently not overseen by VMT. However, I recently learned that a cloud

platform developed by a certain cloud provider based on OpenStack Murano is

also affected by this vulnerability, we had identified a few case in China.

The vulnerability poses a significant risk, in order to prevent users from

suffering losses, if possible, please apply for a CVE and try to issue a

security advisory to remind users to update security patches promptly.

On Thu, 22 Feb 2024 at 22:40, Jeremy Stanley <email address hidden>

wrote:

> Added, but in future you should feel free to subscribe subject matter

> experts yourself when their input is needed on such bug reports.

>

> Also, just to reiterate what I stated in comment #3, the VMT doesn't

> officially oversee or coordinate vulnerability reports for Murano,

> though we're happy to assist on a best-effort basis when requested.

>

> --

> You received this bug notification because you are subscribed to the bug

> report.

> <https://bugs.launchpad.net/bugs/2048114>

>

> Title:

> OpenStack Murano Component Information Leakage

>

> Status in Murano:

> New

> Status in OpenStack Security Advisory:

> Won't Fix

>

> Bug description:

> Members of the VMT received the following report by E-mail from

> "kirualawliet l":

>

> Title: OpenStack Murano Component Information Leakage

>

> Reporter: lawliet and edwardpeng(@edwardzpeng) from Sangfor Security

> Research Team

>

> Products: OpenStack Murano Component

>

> Affects: All versions of Murano Component

>

> Description:

>

> The Sangfor Security Research Team has identified a critical security

> vulnerability in the Murano component of OpenStack. This vulnerability

> allows ordinary users capable of importing and deploying app packages

> to access sensitive information within OpenStack services.

> Specifically, through this exploit, unauthorized users can obtain

> Murano service account credentials, potentially escalating their

> privileges to an administrator level. Subsequently, unauthorized users

> can gain complete control over various resources, including user

> roles, hosts, and networks.

>

> The vulnerability stems from the Murano service's reliance on

> MuranoPL, an extension of the YAQL language. The YAQL library includes

> a 'format' function that mirrors Python's 'str.format' method,

> enabling attribute access.

>

> ```python

> # code snippet from yaql-2.0.0\standard\_library\strings.py:569

> @specs.parameter('\_\_format\_string', yaqltypes.String())

> @specs.extension\_method

> def format\_(\_\_format\_string, \*args, \*\*kwargs):

> ...

> return \_\_format\_string.format(\*args, \*\*kwargs)

> ```

>

> An example of this vulnerability includes:

>

> ```

> >>> secret\_key = "abcd1234"

> >>> class Test:

> ... def \_\_init\_\_(self):

> ... pass

> ...

> >>> t = Test()

> >>> # Exploiting the vulnerability to expose sensitive data:

> >>> malicious\_format\_string =

> '{0.\_\_class\_\_.\_\_init\_\_.\_\_globals\_\_[secret\_key]}'

> >>> formatted\_output = malicious\_format\_string.format(t)

> >>> print(formatted\_output) # This line reveals ...

[Read more...](/murano/%2Bbug/2048114/comments/12)

Yes, I have reviewed the announcement and understand that Murano is
currently not overseen by VMT. However, I recently learned that a cloud
platform developed by a certain cloud provider based on OpenStack Murano is
also affected by this vulnerability, we had identified a few case in China.
The vulnerability poses a significant risk, in order to prevent users from
suffering losses, if possible, please apply for a CVE and try to issue a
security advisory to remind users to update security patches promptly.
On Thu, 22 Feb 2024 at 22:40, Jeremy Stanley <2048114@bugs.launchpad.net>
wrote:
> Added, but in future you should feel free to subscribe subject matter
> experts yourself when their input is needed on such bug reports.
>
> Also, just to reiterate what I stated in comment #3, the VMT doesn't
> officially oversee or coordinate vulnerability reports for Murano,
> though we're happy to assist on a best-effort basis when requested.
>
> --
> You received this bug notification because you are subscribed to the bug
> report.
> https://bugs.launchpad.net/bugs/2048114
>
> Title:
> OpenStack Murano Component Information Leakage
>
> Status in Murano:
> New
> Status in OpenStack Security Advisory:
> Won't Fix
>
> Bug description:
> Members of the VMT received the following report by E-mail from
> "kirualawliet l":
>
> Title: OpenStack Murano Component Information Leakage
>
> Reporter: lawliet and edwardpeng(@edwardzpeng) from Sangfor Security
> Research Team
>
> Products: OpenStack Murano Component
>
> Affects: All versions of Murano Component
>
> Description:
>
> The Sangfor Security Research Team has identified a critical security
> vulnerability in the Murano component of OpenStack. This vulnerability
> allows ordinary users capable of importing and deploying app packages
> to access sensitive information within OpenStack services.
> Specifically, through this exploit, unauthorized users can obtain
> Murano service account credentials, potentially escalating their
> privileges to an administrator level. Subsequently, unauthorized users
> can gain complete control over various resources, including user
> roles, hosts, and networks.
>
> The vulnerability stems from the Murano service's reliance on
> MuranoPL, an extension of the YAQL language. The YAQL library includes
> a 'format' function that mirrors Python's 'str.format' method,
> enabling attribute access.
>
> ```python
> # code snippet from yaql-2.0.0\standard\_library\strings.py:569
> @specs.parameter('\_\_format\_string', yaqltypes.String())
> @specs.extension\_method
> def format\_(\_\_format\_string, \*args, \*\*kwargs):
> ...
> return \_\_format\_string.format(\*args, \*\*kwargs)
> ```
>
> An example of this vulnerability includes:
>
> ```
> >>> secret\_key = "abcd1234"
> >>> class Test:
> ... def \_\_init\_\_(self):
> ... pass
> ...
> >>> t = Test()
> >>> # Exploiting the vulnerability to expose sensitive data:
> >>> malicious\_format\_string =
> '{0.\_\_class\_\_.\_\_init\_\_.\_\_globals\_\_[secret\_key]}'
> >>> formatted\_output = malicious\_format\_string.format(t)
> >>> print(formatted\_output) # This line reveals the value of secret\_key
> 'abcd1234'
> ```
>
> This exploit allows access to Murano service's oslo configuration
> storage, thereby exposing critical Murano service account credentials,
> granting unauthorized users administrative privileges.
>
> We believe no deployment mode is immune to this vulnerability. To
> ensure system security, we recommend immediate attention and
> remediation of this vulnerability within the OpenStack Murano
> component. Our team stands ready to offer assistance and collaboration
> in addressing and resolving this issue promptly.
>
> Thank you for your prompt attention to this matter.
>
> Sincerely,
> kirualawliet
> Sangfor Security Research Team
>
> To manage notifications about this bug go to:
> https://bugs.launchpad.net/murano/+bug/2048114/+subscriptions
>
>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andy Botting (andybotting)](https://launchpad.net/~andybotting) wrote on 2024-02-23:  [**Re: OpenStack Murano Component Information Leakage**](/murano/%2Bbug/2048114/comments/13) |  |  | [#13](/murano/%2Bbug/2048114/comments/13) |
| --- | --- | --- | --- |

With the lack of community participation in Murano, this may not get fixed. I hope to look into the code when I get time, but I'm not sure when that might be.

For our cloud, we're simply going to change the policy to prevent all users from uploading packages and that process will be performed by admins who can check the code first.

L

With the lack of community participation in Murano, this may not get fixed. I hope to look into the code when I get time, but I'm not sure when that might be.
For our cloud, we're simply going to change the policy to prevent all users from uploading packages and that process will be performed by admins who can check the code first.
L

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jake Yip (waipengyip)](https://launchpad.net/~waipengyip) wrote on 2024-02-23: |  |  | [#14](/murano/%2Bbug/2048114/comments/14) |
| --- | --- | --- | --- |

Sorry Jeremy, I had mistakenly thought that only you can add people to security bugs, as my previous access to security bugs were all added by you. Now I know anyone already watching can add.

- Jake

Sorry Jeremy, I had mistakenly thought that only you can add people to security bugs, as my previous access to security bugs were all added by you. Now I know anyone already watching can add.
- Jake

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-02-26: |  |  | [#15](/murano/%2Bbug/2048114/comments/15) |
| --- | --- | --- | --- |

Given this seems to be a serious confirmed vulnerability for any deployment which allows users to upload apps, and it has been spotted by one independent researcher already, it could easily be known to others with more nefarious intentions as well.

The responsible course of action, if there is currently nobody with time to prioritize immediate development and backporting of a fix, is to switch this report to public and that way at least operators of the service can be informed so that they have the opportunity to disable app uploads or or remove Murano from their networks entirely. Leaving this private in hopes one of the few people who are aware of it will find time to eventually work on a patch is, unfortunately, not a viable strategy. Bringing it to the wider community might also help avoid releasing OpenStack 2024.1 with this known vulnerability.

Given this seems to be a serious confirmed vulnerability for any deployment which allows users to upload apps, and it has been spotted by one independent researcher already, it could easily be known to others with more nefarious intentions as well.
The responsible course of action, if there is currently nobody with time to prioritize immediate development and backporting of a fix, is to switch this report to public and that way at least operators of the service can be informed so that they have the opportunity to disable app uploads or or remove Murano from their networks entirely. Leaving this private in hopes one of the few people who are aware of it will find time to eventually work on a patch is, unfortunately, not a viable strategy. Bringing it to the wider community might also help avoid releasing OpenStack 2024.1 with this known vulnerability.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [kirualawliet (kirualawliet)](https://launchpad.net/~kirualawliet) wrote on 2024-03-01: |  |  | [#16](/murano/%2Bbug/2048114/comments/16) |
| --- | --- | --- | --- |

Agreeing with @Jeremy, therefore, if the vulnerability remains unresolved, according to openstack vulnerability management process and our plans, the vulnerability information will be disclosed 90 days after it was submitted, starting from January 4, 2024, namely, after April 4, 2024, to alert users of the Murano project to take preventive actions to avoid potential exploitation by malicious attackers resulting in losses.

Agreeing with @Jeremy, therefore, if the vulnerability remains unresolved, according to openstack vulnerability management process and our plans, the vulnerability information will be disclosed 90 days after it was submitted, starting from January 4, 2024, namely, after April 4, 2024, to alert users of the Murano project to take preventive actions to avoid potential exploitation by malicious attackers resulting in losses.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-03-06: |  |  | [#17](/murano/%2Bbug/2048114/comments/17) |
| --- | --- | --- | --- |

I've subscribed Jay Faulkner and Dan Smith from the OpenStack Technical Committee, at their request.

I've subscribed Jay Faulkner and Dan Smith from the OpenStack Technical Committee, at their request.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jay Faulkner (jason-oldos)](https://launchpad.net/~jason-oldos) wrote on 2024-03-06: |  |  | [#18](/murano/%2Bbug/2048114/comments/18) |
| --- | --- | --- | --- |

We are planning to take the following actions:

- Coordinate an OSSN, notifying users of a major Murano vulnerability with no immediate intention to fix, and that we recommend uninstalling Murano from the cloud. It will include a date when the bug will be opened and details provided.

- At that date, file an unredacted OSSN, detailing the vulnerability, and open this bug.

- Hope that users took us seriously and uninstalled Murano :(

We are planning to take the following actions:
- Coordinate an OSSN, notifying users of a major Murano vulnerability with no immediate intention to fix, and that we recommend uninstalling Murano from the cloud. It will include a date when the bug will be opened and details provided.
- At that date, file an unredacted OSSN, detailing the vulnerability, and open this bug.
- Hope that users took us seriously and uninstalled Murano :(

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-03-06: |  |  | [#19](/murano/%2Bbug/2048114/comments/19) |
| --- | --- | --- | --- |

Clark (now subscribed) pointed out to me that Heat and Mistral also appear to allow users to submit custom YAQL. It would be good to loop in representatives from those projects to perform a cursory check for whether they're also affected by similar issues that need addressing before we disclose this.

Clark (now subscribed) pointed out to me that Heat and Mistral also appear to allow users to submit custom YAQL. It would be good to loop in representatives from those projects to perform a cursory check for whether they're also affected by similar issues that need addressing before we disclose this.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-03-07: |  |  | [#20](/murano/%2Bbug/2048114/comments/20) |
| --- | --- | --- | --- |

I've subscribed Takashi Kajinami (Heat PTL) and Axel Vanzaghi (Mistral PTL) in hopes they have time to take a look and determine whether those services may have similar unsafe handling of user-supplied YAQL. Please feel free to subscribe other subject matter experts as needed in order to make the determination.

I've subscribed Takashi Kajinami (Heat PTL) and Axel Vanzaghi (Mistral PTL) in hopes they have time to take a look and determine whether those services may have similar unsafe handling of user-supplied YAQL. Please feel free to subscribe other subject matter experts as needed in order to make the determination.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Takashi Kajinami (kajinamit)](https://launchpad.net/~kajinamit) wrote on 2024-03-07: |  |  | [#21](/murano/%2Bbug/2048114/comments/21) |
| --- | --- | --- | --- |

So I checked the example murano resources and it seems we can reproduce a similar behavior in heat. (example template and the resource show result are being attached).

One key difference is that in heat we explicitly pass a dictionary value[1], which makes yaql create a new frozendict instance[2]. So \_\_globals\_\_ does not get access to code in heat, but only instances available in [2] which do not contain severely sensitive information such as CONF.

[1] <https://github.com/openstack/heat/blob/9da45ab44bb985c633d246ba9132f1ccc5831cfd/heat/engine/hot/functions.py#L1238>

[2] <https://github.com/openstack/yaql/blob/0d63eb1346c829c0ce818dd2e00590af6330a0f3/yaql/language/utils.py#L75-L76>

However it still leaks a few system information like python versions or python path. What we can probably attempt here is to update yaql to reject a specific pattern like '{\s+.\_\_\s+\_\_\s+}' to avoid access to built-in functions. It should not break any existing valid usage in heat, at least.

So I checked the example murano resources and it seems we can reproduce a similar behavior in heat. (example template and the resource show result are being attached).
One key difference is that in heat we explicitly pass a dictionary value[1], which makes yaql create a new frozendict instance[2]. So \_\_globals\_\_ does not get access to code in heat, but only instances available in [2] which do not contain severely sensitive information such as CONF.
[1] https://github.com/openstack/heat/blob/9da45ab44bb985c633d246ba9132f1ccc5831cfd/heat/engine/hot/functions.py#L1238
[2] https://github.com/openstack/yaql/blob/0d63eb1346c829c0ce818dd2e00590af6330a0f3/yaql/language/utils.py#L75-L76
However it still leaks a few system information like python versions or python path. What we can probably attempt here is to update yaql to reject a specific pattern like '{\s+.\_\_\s+\_\_\s+}' to avoid access to built-in functions. It should not break any existing valid usage in heat, at least.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Takashi Kajinami (kajinamit)](https://launchpad.net/~kajinamit) wrote on 2024-03-07: |  |  | [#22](/murano/%2Bbug/2048114/comments/22) |
| --- | --- | --- | --- |

* [Example heat template with yaql format function](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5753786/%2Bfiles/yaqltest.yaml)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5753786)
  (241 bytes,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Takashi Kajinami (kajinamit)](https://launchpad.net/~kajinamit) wrote on 2024-03-07: |  |  | [#23](/murano/%2Bbug/2048114/comments/23) |
| --- | --- | --- | --- |

* [Example heat template with yaql format function](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5753787/%2Bfiles/yaqltest.yaml)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5753787)
  (241 bytes,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Takashi Kajinami (kajinamit)](https://launchpad.net/~kajinamit) wrote on 2024-03-07: |  |  | [#24](/murano/%2Bbug/2048114/comments/24) |
| --- | --- | --- | --- |

* [Result of openstack resource show which contains format function result](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5753788/%2Bfiles/console.log)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5753788)
  (10.5 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-03-07: |  |  | [#25](/murano/%2Bbug/2048114/comments/25) |
| --- | --- | --- | --- |

I'll readily admit I got a bit lost trying to trace through YAQL's overloaded eval() replacement, but my concern is that making it safe to pass user-supplied strings through eval() is like trying to plug holes in a leaky boat at sea. This article gives some great examples: <https://nedbatchelder.com/blog/201206/eval_really_is_dangerous.html>

I'll readily admit I got a bit lost trying to trace through YAQL's overloaded eval() replacement, but my concern is that making it safe to pass user-supplied strings through eval() is like trying to plug holes in a leaky boat at sea. This article gives some great examples: https://nedbatchelder.com/blog/201206/eval\_really\_is\_dangerous.html

| Changed in ossn: | |
| --- | --- |
| **status**: | New → Confirmed |
| **importance**: | Undecided → High |
| **assignee**: | nobody → Jeremy Stanley (fungi) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2024-03-07: |  |  | [#26](/murano/%2Bbug/2048114/comments/26) |
| --- | --- | --- | --- |

Yeah, agree. I think you might be able to prevent certain behaviors, but I think it would be hard to call this fixed if you're still using eval in any way in code that processes user-supplied input.

Yeah, agree. I think you might be able to prevent certain behaviors, but I think it would be hard to call this fixed if you're still using eval in any way in code that processes user-supplied input.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Takashi Kajinami (kajinamit)](https://launchpad.net/~kajinamit) wrote on 2024-03-08 (last edit on 2024-03-08): |  |  | [#27](/murano/%2Bbug/2048114/comments/27) |
| --- | --- | --- | --- |

The overall problem is caused by the format method which internally does eval... I'm unsure if we can restrict the behavior in format or replace it without breaking the existing usage such as "{0}\_{1}" or "{foo}\_{bar}".

As a safe guard we can introduce an option to disable the format function completely. However it may affect any deployment, where a user is using the format yaql function with valid "safe" usage.

<https://github.com/openstack/yaql/blob/0d63eb1346c829c0ce818dd2e00590af6330a0f3/yaql/standard_library/strings.py#L567-L596>

The overall problem is caused by the format method which internally does eval... I'm unsure if we can restrict the behavior in format or replace it without breaking the existing usage such as "{0}\_{1}" or "{foo}\_{bar}".
As a safe guard we can introduce an option to disable the format function completely. However it may affect any deployment, where a user is using the format yaql function with valid "safe" usage.
https://github.com/openstack/yaql/blob/0d63eb1346c829c0ce818dd2e00590af6330a0f3/yaql/standard\_library/strings.py#L567-L596

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Takashi Kajinami (kajinamit)](https://launchpad.net/~kajinamit) wrote on 2024-03-08: |  |  | [#28](/murano/%2Bbug/2048114/comments/28) |
| --- | --- | --- | --- |

So there a few options I can think of

1. Drop format function

 - This breaks existing usage with format function and thus causes user impact

  - If you run public cloud with heat enable, you have to tell all of your users to modify their template when you update yaql

2. Make format function optional and let components enable it with understanding its risk

 - This but enabling the feature is not feasibly possible with the certain vulnerability exist

3. Add validation in format function to prohibit unsafe usage

 - Limiting characters within {} to 0-9a-zA-Z would be the most strict validation I can think of

 - Loosing limitation may still leave certain patterns

4. Any other smart way to replace format with keeping the existing base usage

I'm leaning towards 3, with validation which is as much strict as possible (ex. reject "{[0-9a-zA-Z]\*[^0-9a-zA-Z}]" )

So there a few options I can think of
1. Drop format function
- This breaks existing usage with format function and thus causes user impact
- If you run public cloud with heat enable, you have to tell all of your users to modify their template when you update yaql
2. Make format function optional and let components enable it with understanding its risk
- This but enabling the feature is not feasibly possible with the certain vulnerability exist
3. Add validation in format function to prohibit unsafe usage
- Limiting characters within {} to 0-9a-zA-Z would be the most strict validation I can think of
- Loosing limitation may still leave certain patterns
4. Any other smart way to replace format with keeping the existing base usage
I'm leaning towards 3, with validation which is as much strict as possible (ex. reject "{[0-9a-zA-Z]\*[^0-9a-zA-Z}]" )

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2024-03-08: |  |  | [#29](/murano/%2Bbug/2048114/comments/29) |
| --- | --- | --- | --- |

Yep, I think we're clear on the "no suitable replacement" for eval. It's why I think ever using eval for something should be avoided and I'm surprised to see it here.

To me, this is not solved without removing that functionality. Hampering it is mere mitigation. I agree that #3 seems like it should be un-bypassable, but the thing you're trying to gate off is pretty dangerous and once this gets disclosed, anyone who didn't think to try leveraging that vulnerability will surely be on the case.

To me #2 is the minimum mitigation to even proceed, with default to off. Perhaps #2 where enabled gets you #3 would be better. Honestly, #1 is the approach I'd take. Any of the three will require users to modify their templates I think, so you might as well go for the gold.

Just MHO.

Yep, I think we're clear on the "no suitable replacement" for eval. It's why I think ever using eval for something should be avoided and I'm surprised to see it here.
To me, this is not solved without removing that functionality. Hampering it is mere mitigation. I agree that #3 seems like it should be un-bypassable, but the thing you're trying to gate off is pretty dangerous and once this gets disclosed, anyone who didn't think to try leveraging that vulnerability will surely be on the case.
To me #2 is the minimum mitigation to even proceed, with default to off. Perhaps #2 where enabled gets you #3 would be better. Honestly, #1 is the approach I'd take. Any of the three will require users to modify their templates I think, so you might as well go for the gold.
Just MHO.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jay Faulkner (jason-oldos)](https://launchpad.net/~jason-oldos) wrote on 2024-03-08: |  |  | [#30](/murano/%2Bbug/2048114/comments/30) |
| --- | --- | --- | --- |

I agree with Dan that #2+#3 is the reasonable route forward if we want to leave this functionality enabled or leave a "soft landing" for people while they work on different results.

I do not thing #3 by itself would be enough to mitigate the concern entirely for all threat models (e.g.; a public cloud).

I agree with Dan that #2+#3 is the reasonable route forward if we want to leave this functionality enabled or leave a "soft landing" for people while they work on different results.
I do not thing #3 by itself would be enough to mitigate the concern entirely for all threat models (e.g.; a public cloud).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-03-08: |  |  | [#31](/murano/%2Bbug/2048114/comments/31) |
| --- | --- | --- | --- |

Since Axel hasn't been available, I've also subscribed James Slagle, who's been recommended for looking into the impact of this on Mistral's use of YAQL.

Since Axel hasn't been available, I've also subscribed James Slagle, who's been recommended for looking into the impact of this on Mistral's use of YAQL.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-03-08: |  |  | [#32](/murano/%2Bbug/2048114/comments/32) |
| --- | --- | --- | --- |

If we're going with a backward-incompatible breaking behavior change to YAQL, we should ideally do that in a 3.0.0 release before OpenStack 2024.1 happens. At this point we're already a week into the requirements freeze, and will need a freeze exception, which means merging and tagging the "fix" as soon as possible.

If we're going with a backward-incompatible breaking behavior change to YAQL, we should ideally do that in a 3.0.0 release before OpenStack 2024.1 happens. At this point we're already a week into the requirements freeze, and will need a freeze exception, which means merging and tagging the "fix" as soon as possible.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [James Slagle (james-slagle)](https://launchpad.net/~james-slagle) wrote on 2024-03-08: |  |  | [#33](/murano/%2Bbug/2048114/comments/33) |
| --- | --- | --- | --- |

My exposure to Mistral is from a user/deployer perspective given that TripleO used Mistral on the undercloud up through train. TripleO itself does not have any usage of yaql's format function, with either Mistral or Heat templates.

That being said, Mistral does allow users to upload any YAML that may contain yaql, including usage of format. Given that, it will need a similar fix as Heat/Murano, and other services that may allow a similar behavior.

My exposure to Mistral is from a user/deployer perspective given that TripleO used Mistral on the undercloud up through train. TripleO itself does not have any usage of yaql's format function, with either Mistral or Heat templates.
That being said, Mistral does allow users to upload any YAML that may contain yaql, including usage of format. Given that, it will need a similar fix as Heat/Murano, and other services that may allow a similar behavior.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Takashi Kajinami (kajinamit)](https://launchpad.net/~kajinamit) wrote on 2024-03-09: |  |  | [#34](/murano/%2Bbug/2048114/comments/34) |
| --- | --- | --- | --- |

* [bug-2048114.patch](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5754210/%2Bfiles/bug-2048114.patch)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5754210)
  (5.1 KiB,
  text/plain)

OK so I created a patch based on #2 and #3. Can anyone here review this or I may need to invite a few heat cores to ask them to review the change.

I'll add a config option to heat to restore the format function, once this is merged and we get this version in u-c.

Note that the latest yaql requires python >= 3.8, so the fix can't be backported to older versions which still support 3.6/3.7 (stable/zed requires python >= 3.8 so this may not be a problem).

OK so I created a patch based on #2 and #3. Can anyone here review this or I may need to invite a few heat cores to ask them to review the change.
I'll add a config option to heat to restore the format function, once this is merged and we get this version in u-c.
Note that the latest yaql requires python >= 3.8, so the fix can't be backported to older versions which still support 3.6/3.7 (stable/zed requires python >= 3.8 so this may not be a problem).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [James Slagle (james-slagle)](https://launchpad.net/~james-slagle) wrote on 2024-03-11: |  |  | [#35](/murano/%2Bbug/2048114/comments/35) |
| --- | --- | --- | --- |

I've added Rabi Mishra who can also review from the Heat side

I've added Rabi Mishra who can also review from the Heat side

[Takashi Kajinami (kajinamit)](https://launchpad.net/~kajinamit)
on 2024-03-12

| Changed in yaql: | |
| --- | --- |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Takashi Kajinami (kajinamit)](https://launchpad.net/~kajinamit) wrote on 2024-03-12: |  |  | [#36](/murano/%2Bbug/2048114/comments/36) |
| --- | --- | --- | --- |

* [bug-2048114-v2.patch](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5755306/%2Bfiles/bug-2048114-v2.patch)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5755306)
  (4.1 KiB,
  text/plain)

I discussed this problem with Rabi and we agreed with removing the function now because it's a huge risk to maintain the function, and if we aim to remove it in the future then removing it now does not make much difference.

We also learned that we can replace the format function relatively easily. For example, if you have

format("{0}-{1}", a b)

then you can replace it by

str(a) + '-' + str(b)

using + and str function in YAQL.

I've updated the patch to remove the function directly. I'm hoping to hear any feedback from Mistral (or Murano) but if I hear nothing in a few days then I'll push this change and merge it (then request a new release of YAQL)

I discussed this problem with Rabi and we agreed with removing the function now because it's a huge risk to maintain the function, and if we aim to remove it in the future then removing it now does not make much difference.
We also learned that we can replace the format function relatively easily. For example, if you have
format("{0}-{1}", a b)
then you can replace it by
str(a) + '-' + str(b)
using + and str function in YAQL.
I've updated the patch to remove the function directly. I'm hoping to hear any feedback from Mistral (or Murano) but if I hear nothing in a few days then I'll push this change and merge it (then request a new release of YAQL)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andy Botting (andybotting)](https://launchpad.net/~andybotting) wrote on 2024-03-12: |  |  | [#37](/murano/%2Bbug/2048114/comments/37) |
| --- | --- | --- | --- |

I like this approach.

With an easy replacement for the format() function, I'll look to update my Murano apps and see how that goes in our environment and I'll post my feedback shortly.

Thanks Takashi and Rabi!

I like this approach.
With an easy replacement for the format() function, I'll look to update my Murano apps and see how that goes in our environment and I'll post my feedback shortly.
Thanks Takashi and Rabi!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Rabi Mishra (rabi)](https://launchpad.net/~rabi) wrote on 2024-03-13: |  |  | [#38](/murano/%2Bbug/2048114/comments/38) |
| --- | --- | --- | --- |

Takashi,

Thanks for the yaql patch attachment. It looks good to me. I've also proposed patches downstream to replace/fix the usage of it in TripleO.

Takashi,
Thanks for the yaql patch attachment. It looks good to me. I've also proposed patches downstream to replace/fix the usage of it in TripleO.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Takashi Kajinami (kajinamit)](https://launchpad.net/~kajinamit) wrote on 2024-03-13 (last edit on 2024-03-13): |  |  | [#39](/murano/%2Bbug/2048114/comments/39) |
| --- | --- | --- | --- |

Based on the review done by Rabi I'll move ahead to submit and merge the patch later today. Please leave any concerns before that.

One note is that we have an unrelease change which removed Python 3.6/7 support and it will be part of the security fix release we may have. In case someone has opinion about it (especially if anyone think we should remove the change so that users using older releases (<zed) can upgrade yaql) then let me know.

Based on the review done by Rabi I'll move ahead to submit and merge the patch later today. Please leave any concerns before that.
One note is that we have an unrelease change which removed Python 3.6/7 support and it will be part of the security fix release we may have. In case someone has opinion about it (especially if anyone think we should remove the change so that users using older releases (<zed) can upgrade yaql) then let me know.

| Changed in yaql: | |
| --- | --- |
| **assignee**: | nobody → Takashi Kajinami (kajinamit) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-03-13: |  |  | [#40](/murano/%2Bbug/2048114/comments/40) |
| --- | --- | --- | --- |

Avoiding dropping earlier Python interpreter support in order to be able to use the new YAQL with OpenStack Zed (which does still have an officially maintained stable branch at the moment) would be preferable. For unbranched libraries, it's usually best to avoid dropping support for maintained stable branches of consumers, as without stable branches in the library and care taken with leaving gaps in version numbering we have no way to backport such fixes.

I have no objection to opening this bug immediately if the fix is ready to be pushed, but if anyone else participating in this discussion objects please speak up now.

As soon as the change (and associated reverts to restore Python 3.6/3.7 support assuming you agree to those) merges, we need to request an expedited release and then immediately post a requirements freeze exception request. Since the only services participating in the upcoming 2024.1/Caracal coordinated release with YAQL dependencies are Heat and Mistral, the impact on release efforts will hopefully be minimized.

Avoiding dropping earlier Python interpreter support in order to be able to use the new YAQL with OpenStack Zed (which does still have an officially maintained stable branch at the moment) would be preferable. For unbranched libraries, it's usually best to avoid dropping support for maintained stable branches of consumers, as without stable branches in the library and care taken with leaving gaps in version numbering we have no way to backport such fixes.
I have no objection to opening this bug immediately if the fix is ready to be pushed, but if anyone else participating in this discussion objects please speak up now.
As soon as the change (and associated reverts to restore Python 3.6/3.7 support assuming you agree to those) merges, we need to request an expedited release and then immediately post a requirements freeze exception request. Since the only services participating in the upcoming 2024.1/Caracal coordinated release with YAQL dependencies are Heat and Mistral, the impact on release efforts will hopefully be minimized.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Takashi Kajinami (kajinamit)](https://launchpad.net/~kajinamit) wrote on 2024-03-13: |  |  | [#41](/murano/%2Bbug/2048114/comments/41) |
| --- | --- | --- | --- |

Zed no longer supports Python 3.6/7 so the point is whether we want to care yoga and older.

<https://governance.openstack.org/tc/reference/runtimes/zed.html>

However, I think lowering the minimum bound in setup.cfg does not much harm, so I'll restore Python 3.6/3.7 support temporally when I submit/merge the fix for this bug and then revert it once release is done.

Zed no longer supports Python 3.6/7 so the point is whether we want to care yoga and older.
https://governance.openstack.org/tc/reference/runtimes/zed.html
However, I think lowering the minimum bound in setup.cfg does not much harm, so I'll restore Python 3.6/3.7 support temporally when I submit/merge the fix for this bug and then revert it once release is done.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-03-13: |  |  | [#42](/murano/%2Bbug/2048114/comments/42) |
| --- | --- | --- | --- |

Oh, thanks, I missed that it was okay as far back as Zed. While we don't (from an upstream testing perspective) need new YAQL versions to work in the unmaintained/yoga branch (its test constraints are permanently frozen), it's still nice for downstream consumers of that unmaintained release in cases where they don't have someone like a curated distribution to backport the patch to a contemporary YAQL version.

Oh, thanks, I missed that it was okay as far back as Zed. While we don't (from an upstream testing perspective) need new YAQL versions to work in the unmaintained/yoga branch (its test constraints are permanently frozen), it's still nice for downstream consumers of that unmaintained release in cases where they don't have someone like a curated distribution to backport the patch to a contemporary YAQL version.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-03-14: |  |  | [#43](/murano/%2Bbug/2048114/comments/43) |
| --- | --- | --- | --- |

As there were no objections raised, I've switched this to Public Security now in preparation for Takashi's YAQL patch upload to Gerrit.

As there were no objections raised, I've switched this to Public Security now in preparation for Takashi's YAQL patch upload to Gerrit.

| **information type**: | Private Security → Public Security |
| --- | --- |

[Takashi Kajinami (kajinamit)](https://launchpad.net/~kajinamit)
on 2024-03-14

| Changed in yaql: | |
| --- | --- |
| **importance**: | High → Critical |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2024-03-14:  [**Fix proposed to yaql (master)**](/murano/%2Bbug/2048114/comments/44) |  |  | [#44](/murano/%2Bbug/2048114/comments/44) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/yaql/+/913228](https://review.opendev.org/c/openstack/yaql/%2B/913228)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/yaql/+/913228

| Changed in yaql: | |
| --- | --- |
| **status**: | New → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2024-03-14:  [**Fix merged to yaql (master)**](/murano/%2Bbug/2048114/comments/45) |  |  | [#45](/murano/%2Bbug/2048114/comments/45) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/yaql/+/913228](https://review.opendev.org/c/openstack/yaql/%2B/913228)

Committed: <https://opendev.org/openstack/yaql/commit/83e28324e1a0ce3970dd854393d2431123a909d3>

Submitter: "Zuul (22348)"

Branch: master

commit 83e28324e1a0ce3970dd854393d2431123a909d3

Author: Takashi Kajinami <email address hidden>

Date: Tue Mar 12 23:38:54 2024 +0900

Remove format function

The format function allowed too arbitrary access to the values being

    formatted, and this behavior caused information leakage in some cases.

Closes-Bug: #2048114

    Change-Id: Id7ec5f267314bb7166ca64802ab47d768bb5eb89

Reviewed: https://review.opendev.org/c/openstack/yaql/+/913228
Committed: https://opendev.org/openstack/yaql/commit/83e28324e1a0ce3970dd854393d2431123a909d3
Submitter: "Zuul (22348)"
Branch: master
commit 83e28324e1a0ce3970dd854393d2431123a909d3
Author: Takashi Kajinami <kajinamit@oss.nttdata.com>
Date: Tue Mar 12 23:38:54 2024 +0900
Remove format function
The format function allowed too arbitrary access to the values being
formatted, and this behavior caused information leakage in some cases.
Closes-Bug: #2048114
Change-Id: Id7ec5f267314bb7166ca64802ab47d768bb5eb89

| Changed in yaql: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-03-14: |  |  | [#46](/murano/%2Bbug/2048114/comments/46) |
| --- | --- | --- | --- |

I've proposed a WIP update for OSSN-0093 with details about this bug now that it's public. Please review at your earliest opportunity as I'm hoping to update the canonical copy on the wiki and send it to mailing lists later today: [https://review.opendev.org/c/openstack/security-doc/+/913239](https://review.opendev.org/c/openstack/security-doc/%2B/913239)

I've proposed a WIP update for OSSN-0093 with details about this bug now that it's public. Please review at your earliest opportunity as I'm hoping to update the canonical copy on the wiki and send it to mailing lists later today: https://review.opendev.org/c/openstack/security-doc/+/913239

| **summary**: | - OpenStack Murano Component Information Leakage+ Unsafe Environment Handling in MuranoPL |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2024-03-14:  [**Fix included in openstack/yaql 3.0.0**](/murano/%2Bbug/2048114/comments/47) |  |  | [#47](/murano/%2Bbug/2048114/comments/47) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/yaql 3.0.0 release.

This issue was fixed in the openstack/yaql 3.0.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-03-14: |  |  | [#48](/murano/%2Bbug/2048114/comments/48) |
| --- | --- | --- | --- |

<https://wiki.openstack.org/wiki/OSSN/OSSN-0093> has now been announced to the usual mailing lists.

https://wiki.openstack.org/wiki/OSSN/OSSN-0093 has now been announced to the usual mailing lists.

| Changed in ossn: | |
| --- | --- |
| **status**: | Confirmed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Avinash Hanwate (ahanwate)](https://launchpad.net/~ahanwate) wrote on 2024-03-15: |  |  | [#49](/murano/%2Bbug/2048114/comments/49) |
| --- | --- | --- | --- |

Anyone requested a CVE for this issue yet?

Anyone requested a CVE for this issue yet?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-03-15: |  |  | [#50](/murano/%2Bbug/2048114/comments/50) |
| --- | --- | --- | --- |

Normally the OpenStack VMT only reaches out to MITRE for CVE assignments on flaws in repositories we oversee, but as this is a somewhat exceptional case I'm happy to go ahead and begin the CVE request process for it with the details from the OSSN.

Normally the OpenStack VMT only reaches out to MITRE for CVE assignments on flaws in repositories we oversee, but as this is a somewhat exceptional case I'm happy to go ahead and begin the CVE request process for it with the details from the OSSN.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [kirualawliet (kirualawliet)](https://launchpad.net/~kirualawliet) wrote on 2024-03-16:  [**Re: [Bug 2048114] Re: Unsafe Environment Handling in MuranoPL**](/murano/%2Bbug/2048114/comments/51) |  |  | [#51](/murano/%2Bbug/2048114/comments/51) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/murano/%2Bbug/2048114/comments/51/%2Bdownload) (3.9 KiB)

Sorry for being so late to notice this review request. My bad, I made a

mistake earlier in the bug report mail by mi

sspelling my teammate's name. Can you please change 'edwardpeng' to

'Zhiniang Peng (@edwardzpeng) in OSSN-0093 and any other references'?

On Fri, 15 Mar 2024 at 01:49, Jeremy Stanley <email address hidden>

wrote:

> I've proposed a WIP update for OSSN-0093 with details about this bug now

> that it's public. Please review at your earliest opportunity as I'm

> hoping to update the canonical copy on the wiki and send it to mailing

> lists later today: <https://review.opendev.org/c/openstack/security->

> doc/+/913239

> <[https://review.opendev.org/c/openstack/security-doc/+/913239](https://review.opendev.org/c/openstack/security-doc/%2B/913239)>

>

> \*\* Summary changed:

>

> - OpenStack Murano Component Information Leakage

> + Unsafe Environment Handling in MuranoPL

>

> --

> You received this bug notification because you are subscribed to the bug

> report.

> <https://bugs.launchpad.net/bugs/2048114>

>

> Title:

> Unsafe Environment Handling in MuranoPL

>

> Status in Murano:

> New

> Status in OpenStack Security Advisory:

> Won't Fix

> Status in OpenStack Security Notes:

> Confirmed

> Status in YAQL:

> Fix Released

>

> Bug description:

> Members of the VMT received the following report by E-mail from

> "kirualawliet l":

>

> Title: OpenStack Murano Component Information Leakage

>

> Reporter: lawliet and edwardpeng(@edwardzpeng) from Sangfor Security

> Research Team

>

> Products: OpenStack Murano Component

>

> Affects: All versions of Murano Component

>

> Description:

>

> The Sangfor Security Research Team has identified a critical security

> vulnerability in the Murano component of OpenStack. This vulnerability

> allows ordinary users capable of importing and deploying app packages

> to access sensitive information within OpenStack services.

> Specifically, through this exploit, unauthorized users can obtain

> Murano service account credentials, potentially escalating their

> privileges to an administrator level. Subsequently, unauthorized users

> can gain complete control over various resources, including user

> roles, hosts, and networks.

>

> The vulnerability stems from the Murano service's reliance on

> MuranoPL, an extension of the YAQL language. The YAQL library includes

> a 'format' function that mirrors Python's 'str.format' method,

> enabling attribute access.

>

> ```python

> # code snippet from yaql-2.0.0\standard\_library\strings.py:569

> @specs.parameter('\_\_format\_string', yaqltypes.String())

> @specs.extension\_method

> def format\_(\_\_format\_string, \*args, \*\*kwargs):

> ...

> return \_\_format\_string.format(\*args, \*\*kwargs)

> ```

>

> An example of this vulnerability includes:

>

> ```

> >>> secret\_key = "abcd1234"

> >>> class Test:

> ... def \_\_init\_\_(self):

> ... pass

> ...

> >>> t = Test()

> >>> # Exploiting the vulnerability to expose sensitive data:

> >>> malicious\_format\_string =

> '{0.\_\_class\_\_.\_\_init\_\_.\_\_globals\_\_[secret\_key]}'

> >>> formatted\_output = malicious\_format\_string.format(t)

> >>> print(formatted\_output) # This line reveals the value of secret\_key

> 'abcd1234'...

[Read more...](/murano/%2Bbug/2048114/comments/51)

Sorry for being so late to notice this review request. My bad, I made a
mistake earlier in the bug report mail by mi
sspelling my teammate's name. Can you please change 'edwardpeng' to
'Zhiniang Peng (@edwardzpeng) in OSSN-0093 and any other references'?
On Fri, 15 Mar 2024 at 01:49, Jeremy Stanley <2048114@bugs.launchpad.net>
wrote:
> I've proposed a WIP update for OSSN-0093 with details about this bug now
> that it's public. Please review at your earliest opportunity as I'm
> hoping to update the canonical copy on the wiki and send it to mailing
> lists later today: https://review.opendev.org/c/openstack/security-
> doc/+/913239
> <https://review.opendev.org/c/openstack/security-doc/+/913239>
>
> \*\* Summary changed:
>
> - OpenStack Murano Component Information Leakage
> + Unsafe Environment Handling in MuranoPL
>
> --
> You received this bug notification because you are subscribed to the bug
> report.
> https://bugs.launchpad.net/bugs/2048114
>
> Title:
> Unsafe Environment Handling in MuranoPL
>
> Status in Murano:
> New
> Status in OpenStack Security Advisory:
> Won't Fix
> Status in OpenStack Security Notes:
> Confirmed
> Status in YAQL:
> Fix Released
>
> Bug description:
> Members of the VMT received the following report by E-mail from
> "kirualawliet l":
>
> Title: OpenStack Murano Component Information Leakage
>
> Reporter: lawliet and edwardpeng(@edwardzpeng) from Sangfor Security
> Research Team
>
> Products: OpenStack Murano Component
>
> Affects: All versions of Murano Component
>
> Description:
>
> The Sangfor Security Research Team has identified a critical security
> vulnerability in the Murano component of OpenStack. This vulnerability
> allows ordinary users capable of importing and deploying app packages
> to access sensitive information within OpenStack services.
> Specifically, through this exploit, unauthorized users can obtain
> Murano service account credentials, potentially escalating their
> privileges to an administrator level. Subsequently, unauthorized users
> can gain complete control over various resources, including user
> roles, hosts, and networks.
>
> The vulnerability stems from the Murano service's reliance on
> MuranoPL, an extension of the YAQL language. The YAQL library includes
> a 'format' function that mirrors Python's 'str.format' method,
> enabling attribute access.
>
> ```python
> # code snippet from yaql-2.0.0\standard\_library\strings.py:569
> @specs.parameter('\_\_format\_string', yaqltypes.String())
> @specs.extension\_method
> def format\_(\_\_format\_string, \*args, \*\*kwargs):
> ...
> return \_\_format\_string.format(\*args, \*\*kwargs)
> ```
>
> An example of this vulnerability includes:
>
> ```
> >>> secret\_key = "abcd1234"
> >>> class Test:
> ... def \_\_init\_\_(self):
> ... pass
> ...
> >>> t = Test()
> >>> # Exploiting the vulnerability to expose sensitive data:
> >>> malicious\_format\_string =
> '{0.\_\_class\_\_.\_\_init\_\_.\_\_globals\_\_[secret\_key]}'
> >>> formatted\_output = malicious\_format\_string.format(t)
> >>> print(formatted\_output) # This line reveals the value of secret\_key
> 'abcd1234'
> ```
>
> This exploit allows access to Murano service's oslo configuration
> storage, thereby exposing critical Murano service account credentials,
> granting unauthorized users administrative privileges.
>
> We believe no deployment mode is immune to this vulnerability. To
> ensure system security, we recommend immediate attention and
> remediation of this vulnerability within the OpenStack Murano
> component. Our team stands ready to offer assistance and collaboration
> in addressing and resolving this issue promptly.
>
> Thank you for your prompt attention to this matter.
>
> Sincerely,
> kirualawliet
> Sangfor Security Research Team
>
> To manage notifications about this bug go to:
> https://bugs.launchpad.net/murano/+bug/2048114/+subscriptions
>
>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Avinash Hanwate (ahanwate)](https://launchpad.net/~ahanwate) wrote on 2024-03-18: |  |  | [#52](/murano/%2Bbug/2048114/comments/52) |
| --- | --- | --- | --- |

@jeremy, Thanks! If you would like, you can be your own CNA to assign CVEs for Openstack related vulnerabilities under Red Hat as a Root CNA instead of reaching out to MITRE every time. Do let me know your thoughts.

@jeremy, Thanks! If you would like, you can be your own CNA to assign CVEs for Openstack related vulnerabilities under Red Hat as a Root CNA instead of reaching out to MITRE every time. Do let me know your thoughts.

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2024-03-18

| **description**: | updated |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-03-18: |  |  | [#53](/murano/%2Bbug/2048114/comments/53) |
| --- | --- | --- | --- |

MITRE has assigned CVE-2024-29156 for this bug in Murano.

kirualawliet: I have adjusted the reference to your colleague's name as requested in the bug description, OSSN publication, and submitted an update request to MITRE to adjust it in the CVE metadata they have. Note that I can't correct it in mailing list posts which have already been sent, but hopefully this is sufficient.

Avinash Hanwate: The OpenStack VMT prefers to avoid notifying downstream distribution security teams early in the discussion of suspected vulnerabilities under embargo, which is why we follow a process to request CVE assignments for our advisories directly from MITRE when we're drafting them rather than Red Hat or similar CNAs. We've also got consensus among the VMT that we don't issue advisories often enough to warrant becoming our own CNA, though we do revisit that decision from time to time. As mentioned, this isn't an official security advisory issued by the OpenStack VMT anyway, but I followed a similar CVE request process to what we normally use for the sake of consistency. Thanks for the offer of assistance though!

MITRE has assigned CVE-2024-29156 for this bug in Murano.
kirualawliet: I have adjusted the reference to your colleague's name as requested in the bug description, OSSN publication, and submitted an update request to MITRE to adjust it in the CVE metadata they have. Note that I can't correct it in mailing list posts which have already been sent, but hopefully this is sufficient.
Avinash Hanwate: The OpenStack VMT prefers to avoid notifying downstream distribution security teams early in the discussion of suspected vulnerabilities under embargo, which is why we follow a process to request CVE assignments for our advisories directly from MITRE when we're drafting them rather than Red Hat or similar CNAs. We've also got consensus among the VMT that we don't issue advisories often enough to warrant becoming our own CNA, though we do revisit that decision from time to time. As mentioned, this isn't an official security advisory issued by the OpenStack VMT anyway, but I followed a similar CVE request process to what we normally use for the sake of consistency. Thanks for the offer of assistance though!

[See full activity log](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/murano/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/murano/%2Bbug/2048114/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [bug-2048114.patch](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5754210/%2Bfiles/bug-2048114.patch)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5754210 "Change patch details")
* [bug-2048114-v2.patch](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5755306/%2Bfiles/bug-2048114-v2.patch)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5755306 "Change patch details")

* [Add patch](/murano/%2Bbug/2048114/%2Baddcomment?field.patch=on)

## Bug attachments

* [leaking murano account and password](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5736495/%2Bfiles/image.png)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5736495 "Change attachment details")
* [logining with leakd murano credentials](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5736496/%2Bfiles/image.png)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5736496 "Change attachment details")
* [app\_mysql\_murano\_leak\_info\_credit.zip](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5748292/%2Bfiles/app_mysql_murano_leak_info_credit.zip)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5748292 "Change attachment details")
* [Example heat template with yaql format function](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5753786/%2Bfiles/yaqltest.yaml)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5753786 "Change attachment details")
* [Example heat template with yaql format function](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5753787/%2Bfiles/yaqltest.yaml)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5753787 "Change attachment details")
* [Result of openstack resource show which contains format function result](https://bugs.launchpad.net/murano/%2Bbug/2048114/%2Battachment/5753788/%2Bfiles/console.log)
  [Edit](/murano/%2Bbug/2048114/%2Battachment/5753788 "Change attachment details")

* [Add attachment](/murano/%2Bbug/2048114/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from opendev.org_a6fe22bd_20250110_114720.html ===

This website requires JavaScript.
[![Logo](/assets/img/logo.svg)](/)

[Explore](/explore/repos)
[Get Started](https://docs.opendev.org/opendev/infra-manual/latest/gettingstarted.html)

[openstack](/openstack)/[yaql](/openstack/yaql)

[Code](/openstack/yaql/src/branch/master)
[Issues](https://bugs.launchpad.net/yaql)
[Proposed changes](https://review.opendev.org/#/q/status:open+project:openstack/yaql)

### Remove format function

[Browse Source](/openstack/yaql/src/commit/83e28324e1a0ce3970dd854393d2431123a909d3)

```
The format function allowed too arbitrary access to the values being
formatted, and this behavior caused information leakage in some cases.

Closes-Bug: [#2048114](https://bugs.launchpad.net/yaql/%2Bbug/2048114)
Change-Id: Id7ec5f267314bb7166ca64802ab47d768bb5eb89
```
...

This commit is contained in:

![](/assets/img/avatar_default.png "kajinamit@oss.nttdata.com")
parent
[2a159b85ae](/openstack/yaql/commit/2a159b85ae02f74645b22822e40fcbccf495493f)

commit
83e28324e1

 **4 changed files** with **16 additions** and **40 deletions**

[Show all changes](?style=unified&whitespace=show-all&show-outdated=)
[Ignore whitespace when comparing lines](?style=unified&whitespace=ignore-all&show-outdated=)
[Ignore changes in amount of whitespace](?style=unified&whitespace=ignore-change&show-outdated=)
[Ignore changes in whitespace at EOL](?style=unified&whitespace=ignore-eol&show-outdated=)

Show Stats
[Download Patch File](/openstack/yaql/commit/83e28324e1a0ce3970dd854393d2431123a909d3.patch)
[Download Diff File](/openstack/yaql/commit/83e28324e1a0ce3970dd854393d2431123a909d3.diff)
Expand all files
Collapse all files

#### 12 [releasenotes/notes/bug-2048114-0968eea052838381.yaml](#diff-9a03ae5c8ec8b30318061e2c83687de453afd1f2 "releasenotes/notes/bug-2048114-0968eea052838381.yaml") Normal file Unescape Escape [View File](/openstack/yaql/src/commit/83e28324e1a0ce3970dd854393d2431123a909d3/releasenotes/notes/bug-2048114-0968eea052838381.yaml)

|  | |  |  | `@ -0,0 +1,12 @@` |
|  |  |  |  | `---` |
|  |  |  |  | `upgrade:` |
|  |  |  |  | `- |` |
|  |  |  |  | `The format YAQL function has been removed, because of its vulnability. See` |
|  |  |  |  | `the security section to find more details.` |
|  |  |  |  |  |
|  |  |  |  | `security:` |
|  |  |  |  | `- |` |
|  |  |  |  | ``<https://bugs.launchpad.net/murano/+bug/2048114>`_: The format YAQL` |
|  |  |  |  | `function has been removed, because it allowed too arbitrary data access` |
|  |  |  |  | `which results in data leak. Users can replace the format function by` |
|  |  |  |  | ```+`` operator and ``str`` YAQL function.` |

#### 33 [yaql/standard\_library/strings.py](#diff-0ac69c3fc791f8c1d8ff31e907641b7fa6232bcf "yaql/standard_library/strings.py") Unescape Escape [View File](/openstack/yaql/src/commit/83e28324e1a0ce3970dd854393d2431123a909d3/yaql/standard_library/strings.py)

|  | |  |  | `@ -564,38 +564,6 @@ def replace_with_dict(string, str_func, replacements, count=-1):` |
|  |  |  |  | `return string` |
|  |  |  |  |  |
|  |  |  |  |  |
|  |  |  |  | `@specs.parameter('__format_string', yaqltypes.String())` |
|  |  |  |  | `@specs.extension_method` |
|  |  |  |  | `def format_(__format_string, *args, **kwargs):` |
|  |  |  |  | `""":yaql:format` |
|  |  |  |  |  |
|  |  |  |  | `Returns a string formatted with positional and keyword arguments.` |
|  |  |  |  |  |
|  |  |  |  | `:signature: string.format([args], {kwargs})` |
|  |  |  |  | `:receiverArg string: input string for formatting. Can be passed only as` |
|  |  |  |  | `first positional argument if used as a function. Can contain literal` |
|  |  |  |  | `text or replacement fields marked by braces {}. Every replacement field` |
|  |  |  |  | `should contain either the numeric index of a positional argument or the` |
|  |  |  |  | `name of a keyword argument` |
|  |  |  |  | `:argType string: string` |
|  |  |  |  | `:arg [args]: values for replacements for numeric markers` |
|  |  |  |  | `:argType [args]: chain of strings` |
|  |  |  |  | `:arg {kwargs}: values for keyword replacements` |
|  |  |  |  | `:argType {kwargs}: chain of key-value arguments, where values are strings` |
|  |  |  |  | `:returnValue: string` |
|  |  |  |  |  |
|  |  |  |  | `.. code::` |
|  |  |  |  |  |
|  |  |  |  | `yaql> "abc{0}ab{1}abc".format(" ", ",")` |
|  |  |  |  | `"abc ab,abc"` |
|  |  |  |  | `yaql> "abc{foo}ab{bar}abc".format(foo => " ", bar => ",")` |
|  |  |  |  | `"abc ab,abc"` |
|  |  |  |  | `yaql> format("abc{0}ab{foo}abc", ' ', foo => ",")` |
|  |  |  |  | `"abc ab,abc"` |
|  |  |  |  | `"""` |
|  |  |  |  | `return __format_string.format(*args, **kwargs)` |
|  |  |  |  |  |
|  |  |  |  |  |
|  |  |  |  | `@specs.parameter('left', yaqltypes.String())` |
|  |  |  |  | `@specs.parameter('right', int)` |
|  |  |  |  | `@specs.name('#operator_*')` |
|  | |  |  | `@ -1045,7 +1013,6 @@ def register(context):` |
|  |  |  |  | `context.register_function(trim_right)` |
|  |  |  |  | `context.register_function(replace)` |
|  |  |  |  | `context.register_function(replace_with_dict)` |
|  |  |  |  | `context.register_function(format_)` |
|  |  |  |  | `context.register_function(is_empty)` |
|  |  |  |  | `context.register_function(string_by_int)` |
|  |  |  |  | `context.register_function(int_by_string)` |
|  | |  |  |  |

#### 7 [yaql/tests/test\_regex.py](#diff-d98b70de9f9283052a3e26b04e1755f7e59f584a "yaql/tests/test_regex.py") Unescape Escape [View File](/openstack/yaql/src/commit/83e28324e1a0ce3970dd854393d2431123a909d3/yaql/tests/test_regex.py)

|  | |  |  | `@ -50,9 +50,10 @@ class TestRegex(yaql.tests.TestCase):` |
|  |  |  |  | `'24.16 = 24(2-4) + 16(5-7)',` |
|  |  |  |  | `self.eval(` |
|  |  |  |  | `r"regex(`(\d+)\.?(\d+)?`).search("r"'aa24.16bb', "` |
|  |  |  |  | `r"format('{0} = {1}({2}-{3}) + {4}({5}-{6})', "` |
|  |  |  |  | `r"$.value, $2.value, $2.start, $2.end, "` |
|  |  |  |  | `r"$3.value, $3.start, $3.end))"))` |
|  |  |  |  | `r"$.value + ' = ' + "` |
|  |  |  |  | `r"$2.value + '(' + str($2.start) + '-' + str($2.end) + ') + ' "` |
|  |  |  |  | `r"+ $3.value + '(' + str($3.start) + '-' + str($3.end) + ')')"` |
|  |  |  |  | `))` |
|  |  |  |  |  |
|  |  |  |  | `def test_search_all(self):` |
|  |  |  |  | `self.assertEqual(` |
|  | |  |  |  |

#### 4 [yaql/tests/test\_strings.py](#diff-bde7400fd3fef391890ea56444a34b440cf08858 "yaql/tests/test_strings.py") Unescape Escape [View File](/openstack/yaql/src/commit/83e28324e1a0ce3970dd854393d2431123a909d3/yaql/tests/test_strings.py)

|  | |  |  | `@ -118,10 +118,6 @@ class TestStrings(yaql.tests.TestCase):` |
|  |  |  |  | `def test_concat_func(self):` |
|  |  |  |  | `self.assertEqual('abc', self.eval("concat(a, b, c)"))` |
|  |  |  |  |  |
|  |  |  |  | `def test_format(self):` |
|  |  |  |  | `self.assertEqual('a->b', self.eval("'{0}->{x}'.format(a, x => b)"))` |
|  |  |  |  | `self.assertEqual('a->b', self.eval("format('{0}->{x}', a, x => b)"))` |
|  |  |  |  |  |
|  |  |  |  | `def test_trim(self):` |
|  |  |  |  | `self.assertEqual('x', self.eval("' x '.trim()"))` |
|  |  |  |  | `self.assertEqual('x', self.eval("'abxba'.trim(ab)"))` |
|  | |  |  |  |

Write
Preview

Loading…

Cancel
Save

Reference in New Issue

**Repository**
openstack/yaql

**Title**

**Body**

Create Issue

Block a user
Blocking a user prevents them from interacting with repositories, such as opening or commenting on pull requests or issues. Learn more about blocking a user.

User to block:

Optional note:

The note is not visible to the blocked user.

Cancel
Block

[Powered by Gitea](https://about.gitea.com)
Version:
v1.22.6
Page: **128ms**
Template: **72ms**

 English
Bahasa Indonesia
Deutsch
English
Español
Français
Italiano
Latviešu
Magyar nyelv
Nederlands
Polski
Português de Portugal
Português do Brasil
Suomi
Svenska
Türkçe
Čeština
Ελληνικά
Български
Русский
Українська
فارسی
മലയാളം
日本語
简体中文
繁體中文（台灣）
繁體中文（香港）
한국어

[Licenses](/assets/licenses.txt)
[API](/api/swagger)


