
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgrpc%2Fgrpc%2Fissues%2F36245)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgrpc%2Fgrpc%2Fissues%2F36245)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=grpc%2Fgrpc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[grpc](/grpc)
/
**[grpc](/grpc/grpc)**
Public

* [Notifications](/login?return_to=%2Fgrpc%2Fgrpc) You must be signed in to change notification settings
* [Fork
  10.6k](/login?return_to=%2Fgrpc%2Fgrpc)
* [Star
   42.3k](/login?return_to=%2Fgrpc%2Fgrpc)

* [Code](/grpc/grpc)
* [Issues
  648](/grpc/grpc/issues)
* [Pull requests
  356](/grpc/grpc/pulls)
* [Actions](/grpc/grpc/actions)
* [Projects
  0](/grpc/grpc/projects)
* [Security](/grpc/grpc/security)
* [Insights](/grpc/grpc/pulse)

Additional navigation options

* [Code](/grpc/grpc)
* [Issues](/grpc/grpc/issues)
* [Pull requests](/grpc/grpc/pulls)
* [Actions](/grpc/grpc/actions)
* [Projects](/grpc/grpc/projects)
* [Security](/grpc/grpc/security)
* [Insights](/grpc/grpc/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgrpc%2Fgrpc%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgrpc%2Fgrpc%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Unparseable metadata error desperately needs better error response #36245

Open

[ravenblackx](/ravenblackx) opened this issue
Apr 3, 2024
· 7 comments

Open

# [Unparseable metadata error desperately needs better error response](#top) #36245

[ravenblackx](/ravenblackx) opened this issue
Apr 3, 2024
· 7 comments

Assignees
[![@yashykt](https://avatars.githubusercontent.com/u/4181124?s=40&v=4)](/yashykt)

Labels
[kind/enhancement](/grpc/grpc/labels/kind/enhancement)
[lang/c++](/grpc/grpc/labels/lang/c%2B%2B)
[priority/P2](/grpc/grpc/labels/priority/P2)
[untriaged](/grpc/grpc/labels/untriaged)

## Comments

[![@ravenblackx](https://avatars.githubusercontent.com/u/1923229?s=80&u=075619ff5dcfb73af73db080a9c1a5e781e7d402&v=4)](/ravenblackx)

Copy link

### **[ravenblackx](/ravenblackx)** commented [Apr 3, 2024](#issue-2223589358)

| What version of gRPC and what language are you using? 1.59.4 (but it's not fixed later), C++ What did you do? Send an http-based grpc request with (for example) header `x-bin: $$$` What did you expect to see? At least one of:   * InvalidArgument status code * error message describing the problem * log message describing the problem * grpc message works anyway and just doesn't parse this header as binary  What did you see instead?  * UnknownError status code (2) * "Stream removed" as the error message * other end of connection just sees stream reset and doesn't even get "Stream removed". * no log messages at all. * even with debug logging turned on, there is no log message associated with the problem header directly, there is only messages like this logged on *every* subsequent header of the request.   ```   hpack_parser.cc:705]                  HTTP:8439:HDR:SVR: x-forwarded-proto: https (parse error: INTERNAL: Error parsing 'x-bin' metadata: illegal base64 encoding [type.googleapis.com/grpc.status.int.stream_id='0'])      ```   Error message content comes from [here](https://github.com/grpc/grpc/blob/da43a613221b61864dbfc9d4e521ce2d6ecf9d7b/src/core/ext/transport/chttp2/transport/hpack_parse_result.cc#L133-L135) and it only gets logged [here](https://github.com/grpc/grpc/blob/8e78a0a2cfa5ccc684b2298db24b787bc6535f7f/src/core/ext/transport/chttp2/transport/hpack_parser.cc#L704-L711), in the debug log of the next header - there is no error/warn/info log when the actual error occurs in or around the call to [ParseBinary](https://github.com/grpc/grpc/blob/8e78a0a2cfa5ccc684b2298db24b787bc6535f7f/src/core/ext/transport/chttp2/transport/hpack_parser.cc#L950-L952).  This inadequate error response caused a 6 week long debugging process in production trying to find what was causing these unexpected failures, with the team that owns the service believing that the client/proxy closed the connection (because "Stream removed" as an error sounds like something someone else did, not a confession) and the team that owned the proxy confident that it was the server that closed it. The onset of these failures approximately coincided with an update to grpc 1.59.4 from, I think, 1.56, so it might be that an older grpc version didn't abort on unparseable `-bin` headers, but it also might just be that no clients were sending them until after the update and the timing was a coincidence. |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@ravenblackx](https://avatars.githubusercontent.com/u/1923229?s=40&u=075619ff5dcfb73af73db080a9c1a5e781e7d402&v=4)](/ravenblackx)
[ravenblackx](/ravenblackx)
added
[kind/bug](/grpc/grpc/labels/kind/bug)
[lang/c++](/grpc/grpc/labels/lang/c%2B%2B)
[priority/P2](/grpc/grpc/labels/priority/P2)
[untriaged](/grpc/grpc/labels/untriaged)
labels
[Apr 3, 2024](#event-12346259871)

[![@grpc-bot](https://avatars.githubusercontent.com/u/33466630?s=40&v=4)](/grpc-bot)
[grpc-bot](/grpc-bot)
assigned [yijiem](/yijiem)
[Apr 3, 2024](#event-12346928060)

[![@dfawley](https://avatars.githubusercontent.com/u/26072277?s=80&u=68fb9090ab0db6d14ff92e82f5d10ea18bb556b7&v=4)](/dfawley)

Copy link

Member

### **[dfawley](/dfawley)** commented [Apr 4, 2024](#issuecomment-2038318784)

| This situation is not covered in <https://github.com/grpc/grpc/blob/master/doc/statuscodes.md>, but INTERNAL seems most appropriate since it looks very similar to: "Error parsing request proto". Go would do the following:  <https://github.com/grpc/grpc-go/blob/c31cec33dd5d1b524a010acbef9d6932dfc791dc/internal/transport/http2_server.go#L454-L457>  That is, INTERNAL with a `grpc-message` header indicating the key/value of the header that was problematic and the error from decoding (presuming the client is using an `application/grpc` `content-type`), and also HTTP status 400 (Bad Request). |
| --- |

All reactions

Sorry, something went wrong.

[![@ravenblackx](https://avatars.githubusercontent.com/u/1923229?s=80&u=075619ff5dcfb73af73db080a9c1a5e781e7d402&v=4)](/ravenblackx)

Copy link

Author

### **[ravenblackx](/ravenblackx)** commented [Apr 8, 2024](#issuecomment-2043520221) • edited Loading

| Additional variations on the same problem - a header with a `|` character in the key, causing `Illegal header key: [key]` which, in the same way, only logs in the debug logs of subsequent headers, not any kind of directly related or higher-priority log message, and with the same unhelpful "stream removed" message logged (and literally just closing the stream with no message, from the client/proxy perspective).  And we haven't seen happening, but I noticed while looking through the code for the one which was happening, that similarly, a non-bin header with value containing any ascii characters <32 would provoke the exact same kind of unhelpful failure state. |
| --- |

All reactions

Sorry, something went wrong.

[![@yashykt](https://avatars.githubusercontent.com/u/4181124?s=80&u=d01e19aac5b914472071993c71f2548df57548af&v=4)](/yashykt)

Copy link

Member

### **[yashykt](/yashykt)** commented [Apr 9, 2024](#issuecomment-2045940420)

| This is unfortunate. Can you tell me what the `error_details` field seen is? |
| --- |

All reactions

Sorry, something went wrong.

[![@ravenblackx](https://avatars.githubusercontent.com/u/1923229?s=80&u=075619ff5dcfb73af73db080a9c1a5e781e7d402&v=4)](/ravenblackx)

Copy link

Author

### **[ravenblackx](/ravenblackx)** commented [Apr 9, 2024](#issuecomment-2046104480)

| I think you're asking about the error sent to the client? If so, there is none, because the server just closes the stream. |
| --- |

All reactions

Sorry, something went wrong.

[![@yashykt](https://avatars.githubusercontent.com/u/4181124?s=40&u=d01e19aac5b914472071993c71f2548df57548af&v=4)](/yashykt)
[yashykt](/yashykt)
assigned [ctiller](/ctiller) and unassigned [yijiem](/yijiem)
[Aug 6, 2024](#event-13783241667)

[![@ravenblackx](https://avatars.githubusercontent.com/u/1923229?s=80&u=075619ff5dcfb73af73db080a9c1a5e781e7d402&v=4)](/ravenblackx)

Copy link

Author

### **[ravenblackx](/ravenblackx)** commented [Aug 6, 2024](#issuecomment-2272068911)

| I think this was resolved as part of the fix in <https://www.cve.org/cverecord?id=CVE-2024-7246>, which upgraded a debug log in this path to an info log. |
| --- |

All reactions

Sorry, something went wrong.

[![@yashykt](https://avatars.githubusercontent.com/u/4181124?s=80&u=d01e19aac5b914472071993c71f2548df57548af&v=4)](/yashykt)

Copy link

Member

### **[yashykt](/yashykt)** commented [Aug 13, 2024](#issuecomment-2287017273) • edited Loading

| I think we'll want the error to be plumbed up as part of the RPC error message instead of just a log. I'm gonna keep this open till I fix it.  [@ravenblackx](https://github.com/ravenblackx) I highly appreciate your effort digging into this. |
| --- |

All reactions

Sorry, something went wrong.

[![@yashykt](https://avatars.githubusercontent.com/u/4181124?s=40&u=d01e19aac5b914472071993c71f2548df57548af&v=4)](/yashykt)
[yashykt](/yashykt)
assigned [yashykt](/yashykt) and unassigned [ctiller](/ctiller)
[Aug 13, 2024](#event-13868464057)

[![@yashykt](https://avatars.githubusercontent.com/u/4181124?s=40&u=d01e19aac5b914472071993c71f2548df57548af&v=4)](/yashykt)
[yashykt](/yashykt)
added
[kind/enhancement](/grpc/grpc/labels/kind/enhancement)
and removed
[kind/bug](/grpc/grpc/labels/kind/bug)
labels
[Sep 10, 2024](#event-14204876744)

[![@arjan-bal](https://avatars.githubusercontent.com/u/46515553?s=40&v=4)](/arjan-bal)
[arjan-bal](/arjan-bal)
mentioned this issue
[Oct 1, 2024](#ref-issue-2550527312)

[is grpc-go V1.59.0 affected by "CVE-2024-7246"
grpc/grpc-go#7673](/grpc/grpc-go/issues/7673)

Closed

[![@Libo-at-windriver](https://avatars.githubusercontent.com/u/111361392?s=80&v=4)](/Libo-at-windriver)

Copy link

### **[Libo-at-windriver](/Libo-at-windriver)** commented [Nov 7, 2024](#issuecomment-2461250303)

| [@yashykt](https://github.com/yashykt) Per the link <https://nvd.nist.gov/vuln/detail/CVE-2024-7246>, [CVE-2024-7246](https://github.com/advisories/GHSA-ghwg-gpp4-w4x3 "CVE-2024-7246") has been fixed in 1.60.2. Would you please confirm the fix is the commit "88b1244fd4 [v1.60] [chttp2] Fix a bug in hpack error handling ([#37361](https://github.com/grpc/grpc/pull/37361))"? Thanks. |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fgrpc%2Fgrpc%2Fissues%2F36245)

Assignees

[![@yashykt](https://avatars.githubusercontent.com/u/4181124?s=40&v=4)](/yashykt) [yashykt](/yashykt)

Labels

[kind/enhancement](/grpc/grpc/labels/kind/enhancement)
[lang/c++](/grpc/grpc/labels/lang/c%2B%2B)
[priority/P2](/grpc/grpc/labels/priority/P2)
[untriaged](/grpc/grpc/labels/untriaged)

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

6 participants

[![@ravenblackx](https://avatars.githubusercontent.com/u/1923229?s=52&v=4)](/ravenblackx) [![@yashykt](https://avatars.githubusercontent.com/u/4181124?s=52&v=4)](/yashykt) [![@yijiem](https://avatars.githubusercontent.com/u/5663878?s=52&v=4)](/yijiem) [![@ctiller](https://avatars.githubusercontent.com/u/10120821?s=52&v=4)](/ctiller) [![@dfawley](https://avatars.githubusercontent.com/u/26072277?s=52&v=4)](/dfawley) [![@Libo-at-windriver](https://avatars.githubusercontent.com/u/111361392?s=52&v=4)](/Libo-at-windriver)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

