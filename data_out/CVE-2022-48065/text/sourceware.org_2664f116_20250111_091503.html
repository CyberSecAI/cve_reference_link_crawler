

Sourceware Bugzilla – Bug 29925
Memory leak in find\_abstract\_instance
Last modified: 2022-12-21 21:53:34 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=29925&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=29925&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 29925**](show_bug.cgi?id=29925)
- Memory leak in find\_abstract\_instance

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
Memory leak in find\_abstract\_instance

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | binutils | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=binutils "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | binutils ([show other bugs](buglist.cgi?component=binutils&product=binutils&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 2.39 | |  | | | [Importance](page.cgi?id=fields.html#importance): | P2 normal | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | 2.40 | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Alan Modra | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2022-12-21 08:10 UTC by 邓朋 | | --- | --- | | Modified: | 2022-12-21 21:53 UTC ([History](show_activity.cgi?id=29925)) | | CC List: | 0 users | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Host:](page.cgi?id=fields.html#cf_gcchost "A custom Free Text field in this installation of Bugzilla.") |  | | [Target:](page.cgi?id=fields.html#cf_gcctarget "A custom Free Text field in this installation of Bugzilla.") |  | | [Build:](page.cgi?id=fields.html#cf_gccbuild "A custom Free Text field in this installation of Bugzilla.") |  | | [Last reconfirmed:](page.cgi?id=fields.html#cf_reconfirmed_on "A custom Date/Time field in this installation of Bugzilla.") | 2022-12-21 00:00:00 | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**PoC to replay the vulnerability**](attachment.cgi?id=14534 "View the content of the attachment") (7.80 KB, application/x-object)  [2022-12-21 08:10 UTC](#attach_14534 "Go to the comment associated with the attachment"), 邓朋 | [Details](attachment.cgi?id=14534&action=edit) | | [View All](attachment.cgi?bugid=29925&action=viewall)  [Add an attachment](attachment.cgi?bugid=29925&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=29925&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=29925#c0)  邓朋    2022-12-21 08:10:12 UTC  ``` Created [attachment 14534](attachment.cgi?id=14534 "PoC to replay the vulnerability") [[details]](attachment.cgi?id=14534&action=edit "PoC to replay the vulnerability") PoC to replay the vulnerability  #Summary There is a memory leak vulnerability in nm-new, which can be triggered by a craft elf file.  #Verification git clone git://sourceware.org/git/binutils-gdb.git CC="clang -fsanitize=address" CXX="clang++ -fsanitize=address" ./configure --disable-shared && make -j$(nproc) ./binutils/nm-new -A -a -l -S -s --special-syms --synthetic --with-symbol-versions -D poc  #ASAN poc:0000000000001948 t ./binutils/nm-new: BFD (GNU Binutils) 2.39.50.20221221 assertion fail ./dwarf2.c:5044  poc:0000000000000000 0000000000000064 d __afl_area_ptr./binutils/nm-new: DWARF error: offset (4278190080) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (25115) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (1612316672) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (472973653) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (8192596) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (72417564) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (4278190080) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (16973824) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (355469056) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: could not find abbrev number 126975 ./binutils/nm-new: DWARF error: could not find variable specification at offset 0x113 ./binutils/nm-new: DWARF error: could not find abbrev number 991 ./binutils/nm-new: DWARF error: could not find variable specification at offset 0x114 ./binutils/nm-new: DWARF error: offset (25115) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (1612316672) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (472973653) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (8192596) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (72417564) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (4278190080) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (25115) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (1612316672) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (472973653) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (8192596) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (72417564) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (4278190080) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (16973824) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (355469056) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: could not find abbrev number 126975 ./binutils/nm-new: DWARF error: could not find variable specification at offset 0x113 ./binutils/nm-new: DWARF error: could not find abbrev number 991 ./binutils/nm-new: DWARF error: could not find variable specification at offset 0x114 ./binutils/nm-new: DWARF error: offset (25115) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (1612316672) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (472973653) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (8192596) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (72417564) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (4278190080) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (25115) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (1612316672) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (472973653) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (8192596) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (72417564) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (4278190080) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (16973824) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (355469056) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: could not find abbrev number 126975 ./binutils/nm-new: DWARF error: could not find variable specification at offset 0x113 ./binutils/nm-new: DWARF error: could not find abbrev number 991 ./binutils/nm-new: DWARF error: could not find variable specification at offset 0x114 ./binutils/nm-new: DWARF error: offset (25115) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (1612316672) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (472973653) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (8192596) greater than or equal to .debug_str size (1224) ./binutils/nm-new: DWARF error: offset (72417564) greater than or equal to .debug_str size (1224)  poc:0000000000001c2e t __afl_die poc:0000000000000010 0000000000000004 d __afl_fork_pid poc:0000000000001b49 t __afl_fork_resume poc:0000000000001a8b t __afl_forkserver poc:0000000000001ab1 0000000000000064 t __afl_fork_wait_loop poc:0000000000000008 0000000000000008 C __afl_global_area_ptr poc:0000000000001920 t __afl_maybe_log poc:e900000000000008 0000000000000007 d __afl_prev_loc poc:0000000000001950 t __afl_setup poc:0000000000000018 0000000000000001 d __afl_setup_failure poc:0000000000001971 t __afl_setup_first poc:0000000000001d07 t .AFL_SHM_ENV poc:0000000000001930 t __afl_store poc:0000000000000014 0000000000000004 d __afl_temp poc:0000000000001d07 t .AFL_VARS poc:                 U atoi poc:0000000000001750 00000000000001c9 T CatPath poc:                 U close poc:0000000000000000 d .data poc:0000000000000000 N .debug_abbrev    st_rdev/paths.c:25 poc:0000000000000000 N .debug_aranges   st_rdev/paths.c:25 poc:0000000000000000 N .debug_info      st_rdev/paths.c:25 poc:0000000000000000 N .debug_info poc:0000000000000000 N .debug_info poc:0000000000000000 N .debug_line      st_rdev/paths.c:25 poc:0000000000000000 N .debug_str       st_rdev/paths.c:25 poc:0000000000000000 0000000000001741 T EnsurePathExists        st_rdev/paths.c:25 poc:                 U etenv poc:                 U _exit poc:                 U __fprintf_chk poc:                 U getenv poc:                 U _GLOBAL_OFFSET_TABLE_ poc:0000000000000000 b .gnu.linkonce.wi..8      st_rdev/paths.c:36 poc:0000000000001c36 t I~afl_setup_abort poc:                 U intf_chk poc:0000000000000000 r linkonce.wi..8 poc:0000000000000080 t linkonce.wi..8 poc:                 U mkdi� poc:0000000000000000 n .note.GNU-stack  st_rdev/paths.c:25 poc:0000000000000000 a paths.c poc:0000000000000000 A read poc:0000000000000000 N .rela.debug_aranges      st_rdev/paths.c:25 poc:0000000000000000 a .rela.debug_line poc:                 U __stack_chk_fail poc:                 U stderr poc:                 U __stpcpy_chk poc:                 U strcat poc:                 U strcpy poc:                 U strlen poc:0000000000000000 t .text    st_rdev/paths.c:25 poc:                 U waitpid poc:                 U write poc:                 U __xstat  ================================================================= ==40988==ERROR: LeakSanitizer: detected memory leaks  Direct leak of 63 byte(s) in 3 object(s) allocated from:     #0 0x493fed in malloc (/binutils-gdb/binutils/nm-new+0x493fed)     #1 0x4e3683 in bfd_malloc /binutils-gdb/bfd/libbfd.c:289:9     #2 0x5f7141 in comp_unit_find_line /binutils-gdb/bfd/./dwarf2.c:4733:8  SUMMARY: AddressSanitizer: 63 byte(s) leaked in 3 allocation(s).  #Envieonment Ubuntu 18.04 clang 10.0.0 ```  [Comment 1](show_bug.cgi?id=29925#c1)  Sourceware Commits    2022-12-21 21:28:40 UTC  ``` The master branch has been updated by Alan Modra <amodra@sourceware.org>:  <https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;h=d28fbc7197ba0e021a43f873eff90b05dcdcff6a>  commit d28fbc7197ba0e021a43f873eff90b05dcdcff6a Author: Alan Modra <amodra@gmail.com> Date:   Wed Dec 21 21:40:12 2022 +1030      [PR29925](show_bug.cgi?id=29925 "RESOLVED FIXED - Memory leak in find_abstract_instance"), Memory leak in find_abstract_instance          The testcase in the PR had a variable with both DW_AT_decl_file and     DW_AT_specification, where the DW_AT_specification also specified     DW_AT_decl_file.  This leads to a memory leak as the file name is     malloced and duplicates are not expected.          I've also changed find_abstract_instance to not use a temp for "name",     because that can result in a change in behaviour from the usual last     of duplicate attributes wins.                  [PR 29925](show_bug.cgi?id=29925 "RESOLVED FIXED - Memory leak in find_abstract_instance")             * dwarf2.c (find_abstract_instance): Delete "name" variable.             Free *filename_ptr before assigning new file name.             (scan_unit_for_symbols): Similarly free func->file and             var->file before assigning. ```  [Comment 2](show_bug.cgi?id=29925#c2)  Alan Modra    2022-12-21 21:53:34 UTC  ``` Fixed ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=29925)
* - [XML](show_bug.cgi?ctype=xml&id=29925)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=29925)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=29925&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=29925&GoAheadAndLogIn=1#forgot)
    Login:

    [x]

