

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3037773%2540restrict-user-access%252Ftrunk%26old%3D3010745%2540restrict-user-access%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3010745/restrict-user-access/trunk?old=3037773&old_path=%2Frestrict-user-access%2Ftrunk)

---

# Changes in [restrict-user-access/trunk](/browser/restrict-user-access/trunk?rev=3037773 "Show entry in browser") [[3010745:3037773]](/log/restrict-user-access/trunk?rev=3037773&stop_rev=3010745 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[restrict-user-access/trunk](/browser/restrict-user-access/trunk?rev=3037773)
Files:

2 added
44 edited

* [admin/admin.php](/browser/restrict-user-access/trunk/admin/admin.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [admin/admin\_bar.php](/browser/restrict-user-access/trunk/admin/admin_bar.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [admin/level-edit.php](/browser/restrict-user-access/trunk/admin/level-edit.php?rev=3037773 "Show entry in browser")
  (modified)
  ([4 diffs](#file2 "Show differences"))
* [admin/level-list-table.php](/browser/restrict-user-access/trunk/admin/level-list-table.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [admin/level-overview.php](/browser/restrict-user-access/trunk/admin/level-overview.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [admin/nav-menu.php](/browser/restrict-user-access/trunk/admin/nav-menu.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [admin/settings.php](/browser/restrict-user-access/trunk/admin/settings.php?rev=3037773 "Show entry in browser")
  (modified)
  ([12 diffs](#file6 "Show differences"))
* [admin/walker-nav-menu.php](/browser/restrict-user-access/trunk/admin/walker-nav-menu.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))
* [api/deprecated.php](/browser/restrict-user-access/trunk/api/deprecated.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [api/functions.php](/browser/restrict-user-access/trunk/api/functions.php?rev=3037773 "Show entry in browser")
  (modified)
  ([4 diffs](#file9 "Show differences"))
* [app.php](/browser/restrict-user-access/trunk/app.php?rev=3037773 "Show entry in browser")
  (modified)
  ([5 diffs](#file10 "Show differences"))
* [assets/css/style.css](/browser/restrict-user-access/trunk/assets/css/style.css?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file11 "Show differences"))
* [assets/js/edit.min.js](/browser/restrict-user-access/trunk/assets/js/edit.min.js?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file12 "Show differences"))
* [assets/js/suggest-levels.min.js](/browser/restrict-user-access/trunk/assets/js/suggest-levels.min.js?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file13 "Show differences"))
* [automators/base.php](/browser/restrict-user-access/trunk/automators/base.php?rev=3037773 "Show entry in browser")
  (modified)
  ([2 diffs](#file14 "Show differences"))
* [automators/bp\_member\_type.php](/browser/restrict-user-access/trunk/automators/bp_member_type.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file15 "Show differences"))
* [automators/edd\_product.php](/browser/restrict-user-access/trunk/automators/edd_product.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file16 "Show differences"))
* [automators/givewp\_donation.php](/browser/restrict-user-access/trunk/automators/givewp_donation.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file17 "Show differences"))
* [automators/login.php](/browser/restrict-user-access/trunk/automators/login.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file18 "Show differences"))
* [automators/user\_role.php](/browser/restrict-user-access/trunk/automators/user_role.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file19 "Show differences"))
* [automators/user\_role\_sync.php](/browser/restrict-user-access/trunk/automators/user_role_sync.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file20 "Show differences"))
* [automators/woo\_product.php](/browser/restrict-user-access/trunk/automators/woo_product.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file21 "Show differences"))
* [content-mode.php](/browser/restrict-user-access/trunk/content-mode.php?rev=3037773 "Show entry in browser")
  (added)
* [db\_updates.php](/browser/restrict-user-access/trunk/db_updates.php?rev=3037773 "Show entry in browser")
  (modified)
  ([3 diffs](#file23 "Show differences"))
* [freemius.php](/browser/restrict-user-access/trunk/freemius.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file24 "Show differences"))
* [helpers/collection.php](/browser/restrict-user-access/trunk/helpers/collection.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file25 "Show differences"))
* [interfaces/level.php](/browser/restrict-user-access/trunk/interfaces/level.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file26 "Show differences"))
* [interfaces/user.php](/browser/restrict-user-access/trunk/interfaces/user.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file27 "Show differences"))
* [interfaces/user\_level.php](/browser/restrict-user-access/trunk/interfaces/user_level.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file28 "Show differences"))
* [level.php](/browser/restrict-user-access/trunk/level.php?rev=3037773 "Show entry in browser")
  (modified)
  ([2 diffs](#file29 "Show differences"))
* [lib/wp-content-aware-engine/module/bp\_member.php](/browser/restrict-user-access/trunk/lib/wp-content-aware-engine/module/bp_member.php?rev=3037773 "Show entry in browser")
  (modified)
  ([4 diffs](#file30 "Show differences"))
* [list-capabilities.php](/browser/restrict-user-access/trunk/list-capabilities.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file31 "Show differences"))
* [list-members.php](/browser/restrict-user-access/trunk/list-members.php?rev=3037773 "Show entry in browser")
  (modified)
  ([3 diffs](#file32 "Show differences"))
* [models/level.php](/browser/restrict-user-access/trunk/models/level.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file33 "Show differences"))
* [models/user.php](/browser/restrict-user-access/trunk/models/user.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file34 "Show differences"))
* [models/user\_level.php](/browser/restrict-user-access/trunk/models/user_level.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file35 "Show differences"))
* [readme.txt](/browser/restrict-user-access/trunk/readme.txt?rev=3037773 "Show entry in browser")
  (modified)
  ([7 diffs](#file36 "Show differences"))
* [restrict-user-access.php](/browser/restrict-user-access/trunk/restrict-user-access.php?rev=3037773 "Show entry in browser")
  (modified)
  ([2 diffs](#file37 "Show differences"))
* [view/meta\_box\_caps.php](/browser/restrict-user-access/trunk/view/meta_box_caps.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file38 "Show differences"))
* [view/meta\_box\_member\_triggers.php](/browser/restrict-user-access/trunk/view/meta_box_member_triggers.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file39 "Show differences"))
* [view/meta\_box\_members.php](/browser/restrict-user-access/trunk/view/meta_box_members.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file40 "Show differences"))
* [view/meta\_box\_options.php](/browser/restrict-user-access/trunk/view/meta_box_options.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file41 "Show differences"))
* [view/meta\_box\_publish.php](/browser/restrict-user-access/trunk/view/meta_box_publish.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file42 "Show differences"))
* [view/meta\_box\_support.php](/browser/restrict-user-access/trunk/view/meta_box_support.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file43 "Show differences"))
* [view/top\_bar.php](/browser/restrict-user-access/trunk/view/top_bar.php?rev=3037773 "Show entry in browser")
  (modified)
  ([1 diff](#file44 "Show differences"))
* [wpml-config.xml](/browser/restrict-user-access/trunk/wpml-config.xml?rev=3037773 "Show entry in browser")
  (added)

### Legend:

Unmodified
Added
Removed

* ## [restrict-user-access/trunk/admin/admin.php](/changeset/3037773/restrict-user-access/trunk/admin/admin.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fadmin%2Fadmin.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/admin/admin.php")

  | [r3010745](/browser/restrict-user-access/trunk/admin/admin.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/admin/admin.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/admin/admin\_bar.php](/changeset/3037773/restrict-user-access/trunk/admin/admin_bar.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fadmin%2Fadmin_bar.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/admin/admin_bar.php")

  | [r3010745](/browser/restrict-user-access/trunk/admin/admin_bar.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/admin/admin_bar.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/admin/level-edit.php](/changeset/3037773/restrict-user-access/trunk/admin/level-edit.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fadmin%2Flevel-edit.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/admin/level-edit.php")

  | [r3010745](/browser/restrict-user-access/trunk/admin/level-edit.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/admin/level-edit.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
  | […](/browser/restrict-user-access/trunk/admin/level-edit.php?rev=3010745#L512) | […](/browser/restrict-user-access/trunk/admin/level-edit.php?rev=3037773#L512) |  |
  | 512 | 512 | $sendback |
  | 513 | 513 | ); |
  | 514 |  | if (~~isset($\_REQUEST['\_rua\_section']) && $\_REQUEST['\_rua\_section']~~) { |
  |  | 514 | if (!empty($\_REQUEST['\_rua\_section']) && $\_REQUEST['\_rua\_section'][0] === '#') { |
  | 515 | 515 | $sendback .= $\_REQUEST['\_rua\_section']; |
  | 516 | 516 | } |
  | […](/browser/restrict-user-access/trunk/admin/level-edit.php?rev=3010745#L616) | […](/browser/restrict-user-access/trunk/admin/level-edit.php?rev=3037773#L616) |  |
  | 616 | 616 | if (isset($\_REQUEST['user'])) { |
  | 617 | 617 | $users = is\_array($\_REQUEST['user']) ? $\_REQUEST['user'] : [$\_REQUEST['user']]; |
  | 618 |  | $post\_id = ~~isset($\_REQUEST['post']) ? $\_REQUEST['post'] : $\_REQUEST['post\_ID']~~; |
  |  | 618 | $post\_id = (int) (isset($\_REQUEST['post']) ? $\_REQUEST['post'] : $\_REQUEST['post\_ID']); |
  | 619 | 619 | foreach ($users as $user\_id) { |
  | 620 | 620 | rua\_get\_user((int)$user\_id)->remove\_level($post\_id); |
  | […](/browser/restrict-user-access/trunk/admin/level-edit.php?rev=3010745#L686) | […](/browser/restrict-user-access/trunk/admin/level-edit.php?rev=3037773#L686) |  |
  | 686 | 686 | wp\_nonce\_field('update-post\_' . $post\_ID); |
  | 687 | 687 | echo '<input type="hidden" id="user-id" name="user\_ID" value="' . (int)get\_current\_user\_id() . '" />'; |
  | 688 |  | echo '<input type="hidden" id="\_rua\_section" name="\_rua\_section" value="' . (isset($\_POST['\_rua\_section']) ? ~~$\_POST['\_rua\_section']~~ : '') . '" />'; |
  |  | 688 | echo '<input type="hidden" id="\_rua\_section" name="\_rua\_section" value="' . (isset($\_POST['\_rua\_section']) ? esc\_attr($\_POST['\_rua\_section']) : '') . '" />'; |
  | 689 | 689 | echo '<input type="hidden" id="hiddenaction" name="action" value="editpost" />'; |
  | 690 | 690 | echo '<input type="hidden" id="post\_author" name="post\_author" value="' . esc\_attr($post->post\_author) . '" />'; |
* ## [restrict-user-access/trunk/admin/level-list-table.php](/changeset/3037773/restrict-user-access/trunk/admin/level-list-table.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fadmin%2Flevel-list-table.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/admin/level-list-table.php")

  | [r3010745](/browser/restrict-user-access/trunk/admin/level-list-table.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/admin/level-list-table.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/admin/level-overview.php](/changeset/3037773/restrict-user-access/trunk/admin/level-overview.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fadmin%2Flevel-overview.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/admin/level-overview.php")

  | [r3010745](/browser/restrict-user-access/trunk/admin/level-overview.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/admin/level-overview.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/admin/nav-menu.php](/changeset/3037773/restrict-user-access/trunk/admin/nav-menu.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fadmin%2Fnav-menu.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/admin/nav-menu.php")

  | [r3010745](/browser/restrict-user-access/trunk/admin/nav-menu.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/admin/nav-menu.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/admin/settings.php](/changeset/3037773/restrict-user-access/trunk/admin/settings.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fadmin%2Fsettings.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/admin/settings.php")

  | [r3010745](/browser/restrict-user-access/trunk/admin/settings.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/admin/settings.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
  | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3010745#L11) | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3037773#L11) |  |
  | 11 | 11 | final class RUA\_Settings\_Page extends RUA\_Admin |
  | 12 | 12 | { |
  |  | 13 | const PREFIX = 'rua\_'; |
  | 13 | 14 | /\*\* |
  | 14 | 15 | \* Settings slug |
  | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3010745#L26) | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3037773#L27) |  |
  | 26 | 27 | \* Settings prefix |
  | 27 | 28 | \* @var string |
  |  | 29 | \* @deprecated |
  | 28 | 30 | \*/ |
  | 29 | 31 | private $prefix = 'rua-'; |
  | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3010745#L153) | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3037773#L155) |  |
  | 153 | 155 | public function add\_scripts\_styles() |
  | 154 | 156 | { |
  |  | 157 | WPCACore::enqueue\_scripts\_styles(RUA\_App::TYPE\_RESTRICT); |
  | 155 | 158 | } |
  | 156 | 159 |  |
  | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3010745#L163) | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3037773#L166) |  |
  | 163 | 166 | 'callback' => '', |
  | 164 | 167 | 'fields'   => [] |
  |  | 168 | ], |
  |  | 169 | 'security' => [ |
  |  | 170 | 'name'     => 'security', |
  |  | 171 | 'title'    => \_\_('Security', 'restrict-user-access'), |
  |  | 172 | 'callback' => '', |
  |  | 173 | 'fields'   => [] |
  | 165 | 174 | ] |
  | 166 | 175 | ]; |
  | 167 | 176 |  |
  |  | 177 | $levels = [ |
  |  | 178 | 0 => \_\_('-- None --') |
  |  | 179 | ]; |
  |  | 180 | foreach (RUA\_App::instance()->get\_levels() as $id => $level) { |
  |  | 181 | $levels[$level->ID] = $level->post\_title; |
  |  | 182 | } |
  |  | 183 |  |
  | 168 | 184 | $this->settings['general']['fields'][] = [ |
  | 169 |  | 'name'     => 'registration-level', |
  |  | 185 | 'name'     => 'rua-registration-level', |
  | 170 | 186 | 'title'    => \_\_('New User Default Level', 'restrict-user-access'), |
  | 171 |  | 'callback' => [$this,'dropdown~~\_levels~~'], |
  | 172 |  | 'args'     => [ |
  | 173 |  | '~~label\_for' => $this->prefix . 'registration-level'~~ |
  |  | 187 | 'callback' => [$this,'dropdown'], |
  |  | 188 | 'args'     => [ |
  |  | 189 | 'options' => $levels |
  | 174 | 190 | ] |
  | 175 | 191 | ]; |
  | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3010745#L178) | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3037773#L194) |  |
  | 178 | 194 | $roles = get\_editable\_roles(); |
  | 179 | 195 | $this->settings['general']['fields'][] = [ |
  | 180 |  | 'name'     => 'registration-role', |
  |  | 196 | 'name'     => 'rua-registration-role', |
  | 181 | 197 | 'title'    => \_\_('New User Default Role'), |
  | 182 | 198 | 'callback' => [$this,'setting\_moved'], |
  | 183 | 199 | 'args'     => [ |
  | 184 |  | 'option' => !empty($roles[$default\_role]) ? $roles[$default\_role]['name'] : $default\_role, |
  | 185 |  | '~~title'~~  => \_\_('General Settings'), |
  | 186 |  | 'url'    => 'options-general.php' |
  |  | 200 | 'option'   => !empty($roles[$default\_role]) ? $roles[$default\_role]['name'] : $default\_role, |
  |  | 201 | 'wp\_title' => \_\_('General Settings'), |
  |  | 202 | 'url'      => 'options-general.php' |
  | 187 | 203 | ], |
  | 188 | 204 | 'register' => false |
  | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3010745#L190) | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3037773#L206) |  |
  | 190 | 206 |  |
  | 191 | 207 | $this->settings['general']['fields'][] = [ |
  | 192 |  | 'name'     => 'registration', |
  |  | 208 | 'name'     => 'rua-registration', |
  | 193 | 209 | 'title'    => \_\_('Enable Registration', 'restrict-user-access'), |
  | 194 | 210 | 'callback' => [$this,'setting\_moved'], |
  | 195 | 211 | 'args'     => [ |
  | 196 |  | 'option' => get\_option('users\_can\_register') ? \_\_('Yes') : \_\_('No'), |
  | 197 |  | '~~title'~~  => \_\_('General Settings'), |
  | 198 |  | 'url'    => 'options-general.php' |
  |  | 212 | 'option'   => get\_option('users\_can\_register') ? \_\_('Yes') : \_\_('No'), |
  |  | 213 | 'wp\_title' => \_\_('General Settings'), |
  |  | 214 | 'url'      => 'options-general.php' |
  | 199 | 215 | ], |
  | 200 | 216 | 'register' => false |
  |  | 217 | ]; |
  |  | 218 |  |
  |  | 219 | $this->settings['security']['fields'][] = [ |
  |  | 220 | 'name'     => self::PREFIX . 'rest\_api\_access', |
  |  | 221 | 'title'    => \_\_('REST API Content Protection', 'restrict-user-access'), |
  |  | 222 | 'callback' => [$this,'checkbox'], |
  |  | 223 | 'args'     => [ |
  |  | 224 | 'default\_value' => 1, |
  |  | 225 | 'recommended'   => \_\_('Enabled'), |
  |  | 226 | 'description'   => \_\_('Deny access to content in REST API for users without legitimate a purpose.', 'restrict-user-access') . |
  |  | 227 | ' <a target="\_blank" rel="noopener" href="https://dev.institute/docs/restrict-user-access/faq/restricted-content-not-hidden/">' . \_\_('Learn more') . '</a>' |
  |  | 228 | ], |
  |  | 229 | ]; |
  |  | 230 | $this->settings['security']['fields'][] = [ |
  |  | 231 | 'name'     => self::PREFIX . 'list\_content\_mode', |
  |  | 232 | 'title'    => \_\_('How to display content in lists', 'restrict-user-access'), |
  |  | 233 | 'callback' => [$this,'radio'], |
  |  | 234 | 'args'     => [ |
  |  | 235 | 'options' => [ |
  |  | 236 | 0 => \_\_('Let theme decide') . ' (' . \_\_('Default') . ')', |
  |  | 237 | 1 => \_\_('Excerpt only'), |
  |  | 238 | 2 => \_\_('Hide content') |
  |  | 239 | ], |
  |  | 240 | 'default\_value' => 0, |
  |  | 241 | 'recommended'   => \_\_('Excerpt only'), |
  |  | 242 | 'description'   => \_\_('Determines how content is displayed in blog, archives, search results, etc.', 'restrict-user-access') . |
  |  | 243 | ' <a target="\_blank" rel="noopener" href="https://dev.institute/docs/restrict-user-access/faq/restricted-content-not-hidden/">' . \_\_('Learn more') . '</a>' |
  |  | 244 | ], |
  | 201 | 245 | ]; |
  | 202 | 246 |  |
  | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3010745#L209) | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3037773#L253) |  |
  | 209 | 253 | ); |
  | 210 | 254 | foreach ($section['fields'] as $field) { |
  |  | 255 | $field['args']['title'] = $field['title']; |
  |  | 256 | $field['args']['label\_for'] = $field['name']; |
  | 211 | 257 | add\_settings\_field( |
  | 212 |  | $~~this->prefix . $~~field['name'], |
  |  | 258 | $field['name'], |
  | 213 | 259 | $field['title'], |
  | 214 | 260 | $field['callback'], |
  | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3010745#L218) | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3037773#L264) |  |
  | 218 | 264 | ); |
  | 219 | 265 | if (!isset($field['register']) || $field['register']) { |
  | 220 |  | register\_setting($this->option\_group, $~~this->prefix . $~~field['name']); |
  |  | 266 | register\_setting($this->option\_group, $field['name']); |
  | 221 | 267 | } |
  | 222 | 268 | } |
  | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3010745#L225) | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3037773#L271) |  |
  | 225 | 271 |  |
  | 226 | 272 | /\*\* |
  | 227 |  | ~~\* Render levels dropdown~~ |
  | 228 |  | ~~\* Skip synchronized levels~~ |
  | 229 |  | ~~\*~~ |
  | 230 |  | ~~\* @since  0.17~~ |
  | 231 |  | ~~\* @param  array  $args~~ |
  | 232 |  | ~~\* @return void~~ |
  | 233 |  | ~~\*/~~ |
  | 234 |  | ~~public function dropdown\_levels($args)~~ |
  | 235 |  | ~~{~~ |
  | 236 |  | ~~echo '<select name="' . $this->prefix . 'registration-level" id="' . $this->prefix . 'registration-level">';~~ |
  | 237 |  | ~~echo '<option value="0">' . \_\_('-- None --') . '</option>';~~ |
  | 238 |  | ~~foreach (RUA\_App::instance()->get\_levels() as $id => $level) {~~ |
  | 239 |  | ~~echo '<option value="' . $level->ID . '" ' . selected($level->ID, get\_option($this->prefix . 'registration-level'), false) . '>' . $level->post\_title . '</option>';~~ |
  | 240 |  | ~~}~~ |
  | 241 |  | ~~echo '</select>';~~ |
  | 242 |  | ~~}~~ |
  | 243 |  |  |
  | 244 |  | ~~/\*\*~~ |
  | 245 | 273 | \* Render checkbox |
  | 246 | 274 | \* |
  | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3010745#L251) | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3037773#L279) |  |
  | 251 | 279 | public function checkbox($args) |
  | 252 | 280 | { |
  | 253 |  | $option = get\_option($args['label\_for']); |
  | 254 |  | echo '<input type="checkbox" name="' . $args['label\_for'] . '" value="1" ' . checked($option, 1, 0) . '/>'; |
  |  | 281 | $option = $this->get\_setting\_value($args); |
  |  | 282 |  |
  |  | 283 | echo '<label class="cae-toggle">'; |
  |  | 284 | echo '<input type="checkbox" name="' . $args['label\_for'] . '" value="1"' . checked($option, 1, 0) . '>'; |
  |  | 285 | echo '<div class="cae-toggle-bar"></div>'; |
  |  | 286 | echo '</label>'; |
  |  | 287 | if (isset($args['description'])) { |
  |  | 288 | echo '<p class="description">' . $args['description'] . '</p>'; |
  |  | 289 | } |
  |  | 290 | if (isset($args['recommended'])) { |
  |  | 291 | echo '<p class="description">Recommended: <code>' . $args['recommended'] . '</code></p>'; |
  |  | 292 | } |
  |  | 293 | } |
  |  | 294 |  |
  |  | 295 | /\*\* |
  |  | 296 | \* @param $args |
  |  | 297 | \* @return void |
  |  | 298 | \*/ |
  |  | 299 | public function radio($args) |
  |  | 300 | { |
  |  | 301 | $current\_value = $this->get\_setting\_value($args); |
  |  | 302 |  |
  |  | 303 | echo '<fieldset>'; |
  |  | 304 | echo '<legend class="screen-reader-text">' . $args['title'] . '</legend>'; |
  |  | 305 | echo '<p>'; |
  |  | 306 | foreach ($this->get\_options($args) as $option\_value => $label) { |
  |  | 307 | echo '<label>'; |
  |  | 308 | echo '<input type="radio" name="' . $args['label\_for'] . '" value="' . $option\_value . '"' . checked($current\_value, $option\_value, false) . '> ' . $label; |
  |  | 309 | echo '</label><br />'; |
  |  | 310 | } |
  |  | 311 | echo '</p>'; |
  |  | 312 | if (isset($args['description'])) { |
  |  | 313 | echo '<p class="description">' . $args['description'] . '</p>'; |
  |  | 314 | } |
  |  | 315 | if (isset($args['recommended'])) { |
  |  | 316 | echo '<p class="description">Recommended: <code>' . $args['recommended'] . '</code></p>'; |
  |  | 317 | } |
  |  | 318 | echo '</fieldset>'; |
  |  | 319 | } |
  |  | 320 |  |
  |  | 321 | /\*\* |
  |  | 322 | \* @param $args |
  |  | 323 | \* @return void |
  |  | 324 | \*/ |
  |  | 325 | public function dropdown($args) |
  |  | 326 | { |
  |  | 327 | $current\_value = $this->get\_setting\_value($args); |
  |  | 328 |  |
  |  | 329 | echo '<select name="' . $args['label\_for'] . '" id="' . $args['label\_for'] . '">'; |
  |  | 330 | foreach ($this->get\_options($args) as $option\_value => $label) { |
  |  | 331 | echo '<option value="' . $option\_value . '" ' . selected($option\_value, $current\_value, false) . '>' . $label . '</option>'; |
  |  | 332 | } |
  |  | 333 | echo '</select>'; |
  |  | 334 | if (isset($args['recommended'])) { |
  |  | 335 | echo '<p class="description">Recommended: <code>' . $args['recommended'] . '</code></p>'; |
  |  | 336 | } |
  | 255 | 337 | } |
  | 256 | 338 |  |
  | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3010745#L267) | […](/browser/restrict-user-access/trunk/admin/settings.php?rev=3037773#L349) |  |
  | 267 | 349 | echo '<p class="description">' . sprintf( |
  | 268 | 350 | \_\_('Setting can be changed in %s', 'restrict-user-access'), |
  | 269 |  | '<a href="' . admin\_url($args['url']) . '">' . $args['title'] . '</a>' |
  |  | 351 | '<a href="' . admin\_url($args['url']) . '">' . $args['wp\_title'] . '</a>' |
  | 270 | 352 | ) . '</p>'; |
  | 271 | 353 | } |
  |  | 354 |  |
  |  | 355 | private function get\_setting\_value($args) |
  |  | 356 | { |
  |  | 357 | return get\_option($args['label\_for'], isset($args['default\_value']) ? $args['default\_value'] : false); |
  |  | 358 | } |
  |  | 359 |  |
  |  | 360 | private function get\_options($args) |
  |  | 361 | { |
  |  | 362 | return isset($args['options']) ? $args['options'] : []; |
  |  | 363 | } |
  | 272 | 364 | } |
* ## [restrict-user-access/trunk/admin/walker-nav-menu.php](/changeset/3037773/restrict-user-access/trunk/admin/walker-nav-menu.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fadmin%2Fwalker-nav-menu.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/admin/walker-nav-menu.php")

  | [r3010745](/browser/restrict-user-access/trunk/admin/walker-nav-menu.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/admin/walker-nav-menu.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/api/deprecated.php](/changeset/3037773/restrict-user-access/trunk/api/deprecated.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fapi%2Fdeprecated.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/api/deprecated.php")

  | [r3010745](/browser/restrict-user-access/trunk/api/deprecated.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/api/deprecated.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
* ## [restrict-user-access/trunk/api/functions.php](/changeset/3037773/restrict-user-access/trunk/api/functions.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fapi%2Ffunctions.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/api/functions.php")

  | [r3010745](/browser/restrict-user-access/trunk/api/functions.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/api/functions.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
  | […](/browser/restrict-user-access/trunk/api/functions.php?rev=3010745#L74) | […](/browser/restrict-user-access/trunk/api/functions.php?rev=3037773#L74) |  |
  | 74 | 74 | } |
  | 75 | 75 |  |
  | 76 |  | $entities = get\_comments([ |
  |  | 76 | $entities = \_rua\_get\_comments([ |
  | 77 | 77 | 'type'    => 'rua\_member', |
  | 78 | 78 | 'status'  => [RUA\_User\_Level::STATUS\_ACTIVE, RUA\_User\_Level::STATUS\_EXPIRED], |
  | […](/browser/restrict-user-access/trunk/api/functions.php?rev=3010745#L104) | […](/browser/restrict-user-access/trunk/api/functions.php?rev=3037773#L104) |  |
  | 104 | 104 | $query['status'] = [RUA\_User\_Level::STATUS\_ACTIVE, RUA\_User\_Level::STATUS\_EXPIRED]; |
  | 105 | 105 | $query['post\_id'] = $level->get\_id(); |
  | 106 |  | $entities = get\_comments($query); |
  |  | 106 | $entities = \_rua\_get\_comments($query); |
  | 107 | 107 |  |
  | 108 | 108 | $user\_levels = new RUA\_Collection(); |
  | […](/browser/restrict-user-access/trunk/api/functions.php?rev=3010745#L141) | […](/browser/restrict-user-access/trunk/api/functions.php?rev=3037773#L141) |  |
  | 141 | 141 | return $caps; |
  | 142 | 142 | } |
  |  | 143 |  |
  |  | 144 | /\*\* |
  |  | 145 | \* @internal |
  |  | 146 | \* @param $args |
  |  | 147 | \* @return int|int[]|WP\_Comment[] |
  |  | 148 | \*/ |
  |  | 149 | function \_rua\_get\_comments($args) |
  |  | 150 | { |
  |  | 151 | if (defined('POLYLANG\_VERSION')) { |
  |  | 152 | $args['post\_type'] = RUA\_App::TYPE\_RESTRICT; |
  |  | 153 | } |
  |  | 154 | add\_filter('wpml\_is\_comment\_query\_filtered', '\_\_return\_false', PHP\_INT\_MAX); |
  |  | 155 | $comments = get\_comments($args); |
  |  | 156 | remove\_filter('wpml\_is\_comment\_query\_filtered', '\_\_return\_false', PHP\_INT\_MAX); |
  |  | 157 | return $comments; |
  |  | 158 | } |
* ## [restrict-user-access/trunk/app.php](/changeset/3037773/restrict-user-access/trunk/app.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fapp.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/app.php")

  | [r3010745](/browser/restrict-user-access/trunk/app.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/app.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
  | […](/browser/restrict-user-access/trunk/app.php?rev=3010745#L14) | […](/browser/restrict-user-access/trunk/app.php?rev=3037773#L14) |  |
  | 14 | 14 | \* Plugin version |
  | 15 | 15 | \*/ |
  | 16 |  | const PLUGIN\_VERSION = '2.~~5~~'; |
  |  | 16 | const PLUGIN\_VERSION = '2.6'; |
  | 17 | 17 |  |
  | 18 | 18 | /\*\* |
  | […](/browser/restrict-user-access/trunk/app.php?rev=3010745#L141) | […](/browser/restrict-user-access/trunk/app.php?rev=3037773#L141) |  |
  | 141 | 141 | } else { |
  | 142 | 142 | new RUA\_Admin\_Bar(); |
  |  | 143 | new RUA\_Content\_Mode(); |
  | 143 | 144 | } |
  | 144 | 145 |  |
  | […](/browser/restrict-user-access/trunk/app.php?rev=3010745#L153) | […](/browser/restrict-user-access/trunk/app.php?rev=3037773#L154) |  |
  | 153 | 154 | 'cas/user\_visibility', |
  | 154 | 155 | [$this,'sidebars\_check\_levels'] |
  |  | 156 | ); |
  |  | 157 |  |
  |  | 158 | add\_filter( |
  |  | 159 | 'rest\_authentication\_errors', |
  |  | 160 | [$this, 'rest\_api\_access'] |
  | 155 | 161 | ); |
  | 156 | 162 | } |
  | […](/browser/restrict-user-access/trunk/app.php?rev=3010745#L665) | […](/browser/restrict-user-access/trunk/app.php?rev=3037773#L671) |  |
  | 665 | 671 | } |
  | 666 | 672 | } |
  |  | 673 |  |
  |  | 674 | public function rest\_api\_access($result) |
  |  | 675 | { |
  |  | 676 | //bail if auth has been handled elsewhere |
  |  | 677 | if ($result === true || is\_wp\_error($result)) { |
  |  | 678 | return $result; |
  |  | 679 | } |
  |  | 680 |  |
  |  | 681 | if (rua\_get\_user()->has\_global\_access()) { |
  |  | 682 | return $result; |
  |  | 683 | } |
  |  | 684 |  |
  |  | 685 | if (!get\_option('rua\_rest\_api\_access', 1)) { |
  |  | 686 | return $result; |
  |  | 687 | } |
  |  | 688 |  |
  |  | 689 | //Contributor is the lowest role that should have access, |
  |  | 690 | //since they can see content in admin area |
  |  | 691 | if (current\_user\_can('edit\_posts')) { |
  |  | 692 | return $result; |
  |  | 693 | } |
  |  | 694 |  |
  |  | 695 | $restricted = [ |
  |  | 696 | '/wp/v2/search' => true, |
  |  | 697 | '/wp/v2/users'  => true |
  |  | 698 | ]; |
  |  | 699 |  |
  |  | 700 | $ignored\_post\_types = [ |
  |  | 701 | 'nav\_menu\_item'    => true, |
  |  | 702 | 'wp\_block'         => true, |
  |  | 703 | 'wp\_template'      => true, |
  |  | 704 | 'wp\_template\_part' => true, |
  |  | 705 | 'wp\_navigation'    => true |
  |  | 706 | ]; |
  |  | 707 | foreach (get\_post\_types(['show\_in\_rest' => true], 'objects') as $post\_type) { |
  |  | 708 | if (empty($post\_type->rest\_base)) { |
  |  | 709 | continue; |
  |  | 710 | } |
  |  | 711 | if (isset($ignored\_post\_types[$post\_type->name])) { |
  |  | 712 | continue; |
  |  | 713 | } |
  |  | 714 | $restricted['/' . $post\_type->rest\_namespace . '/' . $post\_type->rest\_base] = true; |
  |  | 715 | } |
  |  | 716 | $ignored\_taxonomies = [ |
  |  | 717 | 'menu' => true, |
  |  | 718 | ]; |
  |  | 719 | foreach (get\_taxonomies(['show\_in\_rest' => true], 'objects') as $taxonomy) { |
  |  | 720 | if (empty($taxonomy->rest\_base)) { |
  |  | 721 | continue; |
  |  | 722 | } |
  |  | 723 | if (isset($ignored\_taxonomies[$post\_type->name])) { |
  |  | 724 | continue; |
  |  | 725 | } |
  |  | 726 | $restricted['/' . $taxonomy->rest\_namespace . '/' . $taxonomy->rest\_base] = true; |
  |  | 727 | } |
  |  | 728 |  |
  |  | 729 | global $wp; |
  |  | 730 |  |
  |  | 731 | $route = $wp->query\_vars['rest\_route']; |
  |  | 732 | $route = preg\_replace('/(\/\d+)$/', '', $route, 1); |
  |  | 733 |  |
  |  | 734 | if (!isset($restricted[$route])) { |
  |  | 735 | return $result; |
  |  | 736 | } |
  |  | 737 |  |
  |  | 738 | return new WP\_Error( |
  |  | 739 | 'rest\_forbidden', |
  |  | 740 | \_\_('Sorry, you are not allowed to do that.'), |
  |  | 741 | ['status' => rest\_authorization\_required\_code()] |
  |  | 742 | ); |
  |  | 743 | } |
  | 667 | 744 | } |
* ## [restrict-user-access/trunk/assets/css/style.css](/changeset/3037773/restrict-user-access/trunk/assets/css/style.css?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fassets%2Fcss%2Fstyle.css "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/assets/css/style.css")

  | [r3010745](/browser/restrict-user-access/trunk/assets/css/style.css?rev=3010745#L3 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/assets/css/style.css?rev=3037773#L3 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 4 | 4 | \* @license GPLv3 |
  | 5 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 5 | \* @copyright 2024 by Joachim Jensen |
  | 6 | 6 | \*/.rua-navbar{margin-left:-20px;padding:4px 20px;background:#fff;border-bottom:1px solid #ccd0d4;font-size:14px}.rua-navbar h2{display:inline-block;font-size:inherit;margin:0;vertical-align:middle}.rua-navbar img{border-radius:5px;vertical-align:middle}.rua-badge{padding:3px 8px;border-radius:4px;background:rgba(0,0,0,.07);color:#50575e;margin-right:2px;margin-bottom:2px;display:inline-block}.rua-badge.rua-badge-danger{color:#b32d2e;background:#ffd6d6}.rua-badge.rua-badge-success{color:#017d5c;background:#e5f5f0}.rua-badge.rua-badge-info{color:#2271b1;background:#ddecf4}.rua-section{display:none}.nav-tab-active:focus{box-shadow:none}.cas-nav-link,.nav-tab-wrapper a{transition-property:background-color,color;transition-duration:.2s}#submitdiv .handlediv,#submitdiv .hndle,#submitdiv .postbox-header{display:none!important}#submitdiv .cas-save{background:#f5f5f5;border-bottom:1px solid #ddd;overflow:hidden;padding:7px 10px}.rua-metabox-holder .hndle{cursor:auto!important}.rua-metabox-holder .handle-actions,.rua-metabox-holder .handlediv{display:none!important}#rua-plugin-links.postbox{background-color:#ddecf4;border-color:#9fcadf;box-shadow:0 0 0 1px #fff inset,0 1px 1px rgba(0,0,0,.04)}#rua-plugin-links .hndle{border-bottom-color:#9fcadf;box-shadow:0 -1px #fff inset}.rua-input-md{width:250px}.rua-input-sm{width:80px}.rua-form-table{width:97%;margin:0 auto}.rua-form-table tr td:first-child{min-width:30%}.rua-form-table tr td{border-bottom:1px solid #eee}.rua-member-automations{padding-top:6px}.rua-member-trigger{padding:12px;border-radius:4px;margin-bottom:10px;box-shadow:0 1px 1px 1px rgba(0,0,0,.04);line-height:1;border:1px solid #c3c4c7}.rua-member-trigger .rua-member-trigger-icon{color:#aaa;vertical-align:middle;padding-right:12px}.rua-member-trigger .rua-member-trigger-value{padding:8px 10px;border-radius:4px;background:#ddecf4;display:inline-block;color:#2271b1;margin:0;font-weight:700}.rua-member-trigger .rua-member-trigger-value.rua-badge-danger{color:#b32d2e;background:#ffd6d6}.rua-member-trigger .rua-member-trigger-value.rua-badge-success{color:#017d5c;background:#e5f5f0}.rua-member-trigger .rua-member-trigger-value.rua-badge-info{color:#2271b1;background:#ddecf4}#rua-capabilities.postbox,#rua-members.postbox{background:0 0;border:none;box-shadow:none}#rua-capabilities .postbox-header,#rua-members .postbox-header{display:none}#rua-capabilities .inside,#rua-members .inside{margin:0;padding:0}.wp-list-table.capabilities thead{z-index:1000;background-color:#fff}.wp-list-table.capabilities .rua-cb:checked+.rua-cb-label-0{background-color:rgba(252,155,164,.35)}.wp-list-table.capabilities .rua-cb:checked+.rua-cb-label-1{background-color:rgba(143,227,163,.4)}.wp-list-table.capabilities .rua-cb:checked+.rua-cb-label--1{background-color:rgba(221,236,244,.5)}@media screen and (max-width:600px){.rua-navbar{display:none}}@media screen and (min-width:601px){.wp-list-table.capabilities thead{position:sticky;top:46px}}@media screen and (min-width:783px){.wp-list-table.capabilities thead{top:32px}.wp-list-table.capabilities td.column-name{border-right:1px solid #ccd0d4}}.column-deny,.column-permit,.column-unset,.rua-cb{position:relative;text-align:center!important}.rua-cb{z-index:1}.rua-cb-label{position:absolute;width:100%;height:100%;top:0;left:0}.wp-list-table.fixed.striped>tbody>:nth-child(2n+1){background-color:#f9f9f9}.wp-list-table.fixed .column-name{width:14%}.wp-list-table.fixed .column-role{width:15%}.wp-list-table.fixed .column-caps,.wp-list-table.fixed .column-duration{width:9%}.wp-list-table.fixed .column-handle{width:16%}.wp-list-table.fixed .column-deny,.wp-list-table.fixed .column-permit,.wp-list-table.fixed .column-unset{width:7%} |
* ## [restrict-user-access/trunk/assets/js/edit.min.js](/changeset/3037773/restrict-user-access/trunk/assets/js/edit.min.js?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fassets%2Fjs%2Fedit.min.js "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/assets/js/edit.min.js")

  | [r3010745](/browser/restrict-user-access/trunk/assets/js/edit.min.js?rev=3010745#L3 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/assets/js/edit.min.js?rev=3037773#L3 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 4 | 4 | \* @license GPLv3 |
  | 5 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 5 | \* @copyright 2024 by Joachim Jensen |
  | 6 | 6 | \*/ |
  | 7 | 7 | !function($,RUA,WPCA,e){"use strict";var r={current\_section:0,sections:[],alert:null,init:function(){this.alert=new e.Views.Alert({model:new e.Models.Alert}),this.suggestUsers(),this.suggestPages(),this.tabController(),this.capController(),this.automationController(),this.extensionController()},extensionController:function(){var n=$("#extend\_member"),a=$(".js-rua-extend-date"),t=$(".js-rua-extend-type");$(".wp-list-table.members").on("click",".js-rua-member-extend",function(e){e.preventDefault();var e=$(this),t=e.data("expiration");t.length?(a.val(t),$(".js-rua-extend-type-1").prop("checked",!0)):(a.val(""),$(".js-rua-extend-type-0").prop("checked",!0)),n.data("userid",e.data("userid"))}),n.on("click",function(e){e.preventDefault(),$.ajax({url:ajaxurl,data:{user\_id:$(this).data("userid"),post\_id:$("#post\_ID").val(),action:"rua/membership/extend",nonce:RUA.nonce,extend\_date:a.val(),extend\_type:t.filter(":checked").first().val()},dataType:"JSON",type:"POST",success:function(e){window.location.reload()},error:function(e,t,n){r.alert.failure(e.responseJSON.data)}})})},automationController:function(){var r=$(".js-rua-member-automations"),s=r.children().length;r.on("click",".js-rua-member-trigger-remove",function(e){e.preventDefault(),$(this).closest(".rua-member-trigger").remove()}),$(".js-rua-add-member-automator").on("change",function(e){e.preventDefault();var t,a,n=e.target.options[e.target.selectedIndex];""!==n.value&&(t=$('<div data-no="'+s+'" class="rua-member-trigger"><span class="rua-member-trigger-icon dashicons '+n.getAttribute("data-icon")+'"></span> '+n.getAttribute("data-sentence")+' <input type="hidden" name="member\_automations['+s+'][name]" value="'+n.value+'" /></div>'),a=$("<select></select>"),t.append(a),r.append(t),a.select2({cachedResults:{},quietMillis:400,searchTimer:null,type:n.value,theme:"wpca",dir:WPCA.text\_direction,minimumInputLength:0,closeOnSelect:!0,width:"250px",language:{noResults:function(){return WPCA.noResults},searching:function(){return WPCA.searching+"..."},loadingMore:function(){return WPCA.loadingMore+"..."}},data:[],dataAdapter:$.fn.select2.amd.require("select2/rua/automatorData"),ajax:{}}).on("select2:select",function(e){e.preventDefault();var t=e.target.options[e.target.selectedIndex],n=$(e.target).parent();""!==t.value&&(n.append('<input type="hidden" name="member\_automations['+n.data("no")+'][value]" value="'+t.value+'" /><span class="rua-member-trigger-value">'+t.text+'</span><span class="js-rua-member-trigger-remove wpca-condition-remove wpca-pull-right dashicons dashicons-trash"></span>'),a.select2("destroy"),e.target.remove())}),s++,e.target.value="")})},suggestPages:function(){var e=$(".js-rua-page"),t=e.data("rua-url");e.select2({theme:"wpca",dir:WPCA.text\_direction,minimumInputLength:0,closeOnSelect:!0,allowClear:!1,width:"250px",ajax:{delay:400,url:ajaxurl,data:function(e){return{search:e.term||"",action:"rua/page/suggest",paged:e.page||1,nonce:RUA.nonce}},dataType:"JSON",type:"POST",processResults:function(e,t){return{results:e,pagination:{more:!(e.length<20)}}}},createTag:function(e){e=$.trim(e.term.replace(t,""));return""===e?null:(-1===(e="/"!==e[0]?"/"+e:e).indexOf(".")&&"/"!==e[e.length-1]&&(e+="/"),{id:e,text:e,new:!0})},templateResult:function(e){return e.new?$("<i>"+t+"</i><b>"+e.text+"</b>"):e.text},language:{noResults:function(){return t},inputTooShort:function(){return"Search for pages or enter custom link"}}})},suggestUsers:function(){var t=$("#post\_ID").val();$(".js-rua-user-suggest").select2({theme:"wpca",dir:WPCA.text\_direction,cachedResults:{},quietMillis:400,searchTimer:null,post\_id:t,placeholder:"Add Members",minimumInputLength:1,closeOnSelect:!1,allowClear:!1,width:"250px",ajax:{delay:400,url:ajaxurl,data:function(e){return{q:e.term||"",action:"rua/user/suggest",post\_id:t,nonce:RUA.nonce}},dataType:"JSON",type:"POST",processResults:function(e){for(var t=[],n=e.length-1;0<=n;n--)t.push({id:e[n].ID,text:e[n].user\_login+" ("+e[n].user\_email+")"});return{results:t}}},nextSearchTerm:function(e,t){return t},language:{noResults:function(){return WPCA.noResults},searching:function(){return WPCA.searching+"..."},inputTooShort:function(){return"Search users by name or email"}}})},initTabSections:function(){$(".js-rua-tabs").find(".nav-tab").each(function(){var e=this.href.lastIndexOf("#");0<=e&&(e=this.href.substr(e),r.sections.push(e),$(e).hide())})},tabController:function(){this.initTabSections();var e=$("#\_rua\_section").val();this.setCurrentSection(e||window.location.hash),$("#poststuff").on("click",".js-nav-link",function(e){r.setCurrentSection(this.href)})},findSectionByURL:function(e){e=this.sections.indexOf(e.substring(e.lastIndexOf("#")));return 0<=e?e:null},setCurrentSection:function(e){var e=this.findSectionByURL(e)||0,t=$(".js-rua-tabs").find(".nav-tab");t.eq(e).is(":visible")&&($(this.sections[this.current\_section]).hide(),t.eq(this.current\_section).removeClass("nav-tab-active"),this.current\_section=e,$(this.sections[this.current\_section]).show(),t.eq(this.current\_section).addClass("nav-tab-active"),$("#\_rua\_section").val("#top"+this.sections[this.current\_section]))},capController:function(){function r(e){e.sum.text(e.checkboxes.not(".js-rua-cb-all").filter(":checked").length)}var e,s=[{value:0,sum:$(".sum-0").first(),checkboxes:$(".column-deny").find("input.rua-cb")},{value:1,sum:$(".sum-1").first(),checkboxes:$(".column-permit").find("input.rua-cb")},{value:-1,sum:$(".sum--1").first(),checkboxes:$(".column-unset").find("input.rua-cb")}],t=$("input.js-rua-cb-all");for(e in s)r(s[e]);$("input.js-rua-cb-all").on("change",function(){var e,t=$(this),n=t.prop("checked"),a=t.val();for(e in s)s[e].checkboxes.prop("checked",s[e].value==a?n:!n),r(s[e])}),$("td input.rua-cb").on("change",function(){for(var e in s)r(s[e]);t.prop("checked",!1)})}};$.fn.select2.amd.define("select2/rua/automatorData",["select2/data/array","select2/utils"],function(e,t){function n(e,t){n.\_\_super\_\_.constructor.call(this,e,t)}return t.Extend(n,e),n.prototype.query=function(n,a){n.term=n.term||"";var r=this.options.options,s=r.cachedResults[n.term],i=n.page||1;if(s&&s.page>=i){if(!(1<i))return void a({results:s.items,pagination:{more:s.more}});i=s.page}clearTimeout(r.searchTimer),r.searchTimer=setTimeout(function(){$.ajax({url:ajaxurl,data:{search:n.term,paged:i,limit:20,action:"rua/automator/"+r.type,nonce:RUA.nonce},dataType:"JSON",type:"POST",success:function(e){var t=20<=e.length;r.cachedResults[n.term]={page:i,more:t,items:s?r.cachedResults[n.term].items.concat(e):e},a({results:e,pagination:{more:t}})}})},r.quietMillis)},n}),$(document).ready(function(){r.init()})}(jQuery,RUA,WPCA,CAE); |
* ## [restrict-user-access/trunk/assets/js/suggest-levels.min.js](/changeset/3037773/restrict-user-access/trunk/assets/js/suggest-levels.min.js?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fassets%2Fjs%2Fsuggest-levels.min.js "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/assets/js/suggest-levels.min.js")

  | [r3010745](/browser/restrict-user-access/trunk/assets/js/suggest-levels.min.js?rev=3010745#L3 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/assets/js/suggest-levels.min.js?rev=3037773#L3 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 4 | 4 | \* @license GPLv3 |
  | 5 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 5 | \* @copyright 2024 by Joachim Jensen |
  | 6 | 6 | \*/ |
  | 7 | 7 | !function($){"use strict";var n={init:function(){this.suggestLevels(),this.lazyInitsuggestLevels()},suggestLevels:function(){$(".js-rua-levels").each(function(){n.createDropdown($(this))})},lazyInitsuggestLevels:function(){$("#menu-to-edit").on("click",".item-edit",function(e){var t=$(this).closest(".menu-item");t.hasClass("menu-item-edit-inactive")&&!(t=t.find(".js-rua-levels")).data("select2")&&n.createDropdown(t)})},createDropdown:function(t){t.select2({theme:"wpca",placeholder:RUA.search,minimumInputLength:0,closeOnSelect:!0,allowClear:!1,data:RUA.levels}).on("select2:selecting",function(e){t.data("forceOpen",!0)}).on("select2:close",function(e){t.data("forceOpen")&&(e.preventDefault(),t.select2("open"),t.data("forceOpen",!1))}),t.data("value")&&t.val(t.data("value").toString().split(",")).trigger("change.select2")}};$(document).ready(function(){n.init()})}(jQuery); |
* ## [restrict-user-access/trunk/automators/base.php](/changeset/3037773/restrict-user-access/trunk/automators/base.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fautomators%2Fbase.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/automators/base.php")

  | [r3010745](/browser/restrict-user-access/trunk/automators/base.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/automators/base.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
  | […](/browser/restrict-user-access/trunk/automators/base.php?rev=3010745#L67) | […](/browser/restrict-user-access/trunk/automators/base.php?rev=3037773#L67) |  |
  | 67 | 67 | $response = $this->search\_content( |
  | 68 | 68 | isset($\_POST['search']) ? $\_POST['search'] : null, |
  | 69 |  | isset($\_POST['paged']) ? $\_POST['paged'] : 1, |
  | 70 |  | isset($\_POST['limit']) ? $\_POST['limit'] : 20 |
  |  | 69 | isset($\_POST['paged']) ? (int) $\_POST['paged'] : 1, |
  |  | 70 | isset($\_POST['limit']) ? (int) $\_POST['limit'] : 20 |
  | 71 | 71 | ); |
  | 72 | 72 |  |
* ## [restrict-user-access/trunk/automators/bp\_member\_type.php](/changeset/3037773/restrict-user-access/trunk/automators/bp_member_type.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fautomators%2Fbp_member_type.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/automators/bp_member_type.php")

  | [r3010745](/browser/restrict-user-access/trunk/automators/bp_member_type.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/automators/bp_member_type.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/automators/edd\_product.php](/changeset/3037773/restrict-user-access/trunk/automators/edd_product.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fautomators%2Fedd_product.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/automators/edd_product.php")

  | [r3010745](/browser/restrict-user-access/trunk/automators/edd_product.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/automators/edd_product.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/automators/givewp\_donation.php](/changeset/3037773/restrict-user-access/trunk/automators/givewp_donation.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fautomators%2Fgivewp_donation.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/automators/givewp_donation.php")

  | [r3010745](/browser/restrict-user-access/trunk/automators/givewp_donation.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/automators/givewp_donation.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/automators/login.php](/changeset/3037773/restrict-user-access/trunk/automators/login.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fautomators%2Flogin.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/automators/login.php")

  | [r3010745](/browser/restrict-user-access/trunk/automators/login.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/automators/login.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/automators/user\_role.php](/changeset/3037773/restrict-user-access/trunk/automators/user_role.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fautomators%2Fuser_role.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/automators/user_role.php")

  | [r3010745](/browser/restrict-user-access/trunk/automators/user_role.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/automators/user_role.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/automators/user\_role\_sync.php](/changeset/3037773/restrict-user-access/trunk/automators/user_role_sync.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fautomators%2Fuser_role_sync.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/automators/user_role_sync.php")

  | [r3010745](/browser/restrict-user-access/trunk/automators/user_role_sync.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/automators/user_role_sync.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/automators/woo\_product.php](/changeset/3037773/restrict-user-access/trunk/automators/woo_product.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fautomators%2Fwoo_product.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/automators/woo_product.php")

  | [r3010745](/browser/restrict-user-access/trunk/automators/woo_product.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/automators/woo_product.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/db\_updates.php](/changeset/3037773/restrict-user-access/trunk/db_updates.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fdb_updates.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/db_updates.php")

  | [r3010745](/browser/restrict-user-access/trunk/db_updates.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/db_updates.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
  | […](/browser/restrict-user-access/trunk/db_updates.php?rev=3010745#L20) | […](/browser/restrict-user-access/trunk/db_updates.php?rev=3037773#L20) |  |
  | 20 | 20 | $rua\_db\_updater->register\_version\_update('2.4.2', 'rua\_update\_to\_242'); |
  | 21 | 21 | $rua\_db\_updater->register\_version\_update('2.5', 'rua\_update\_to\_25'); |
  | 22 |  |  |
  | 23 |  | function rua\_update\_to\_25() |
  | 24 |  | { |
  | 25 |  | global $wpdb; |
  |  | 22 | $rua\_db\_updater->register\_version\_update('2.6', 'rua\_update\_to\_26'); |
  |  | 23 |  |
  |  | 24 | function rua\_update\_to\_26() |
  |  | 25 | { |
  |  | 26 | if (!(defined('ICL\_SITEPRESS\_VERSION') || defined('POLYLANG\_VERSION'))) { |
  |  | 27 | return true; |
  |  | 28 | } |
  |  | 29 |  |
  |  | 30 | global $wpdb; |
  |  | 31 |  |
  |  | 32 | $wpdb->query("UPDATE $wpdb->comments SET comment\_type = 'rua\_member\_bkup' where comment\_type = 'rua\_member'"); |
  | 26 | 33 |  |
  | 27 | 34 | $level\_id\_lookup = array\_flip((array)$wpdb->get\_col(" |
  | […](/browser/restrict-user-access/trunk/db_updates.php?rev=3010745#L89) | […](/browser/restrict-user-access/trunk/db_updates.php?rev=3037773#L96) |  |
  | 89 | 96 | wp\_update\_comment\_count($level\_id); |
  | 90 | 97 | } |
  |  | 98 |  |
  |  | 99 | return true; |
  |  | 100 | } |
  |  | 101 |  |
  |  | 102 | function rua\_update\_to\_25() |
  |  | 103 | { |
  |  | 104 | if (defined('ICL\_SITEPRESS\_VERSION') || defined('POLYLANG\_VERSION')) { |
  |  | 105 | return true; |
  |  | 106 | } |
  |  | 107 |  |
  |  | 108 | global $wpdb; |
  |  | 109 |  |
  |  | 110 | $level\_id\_lookup = array\_flip((array)$wpdb->get\_col(" |
  |  | 111 | SELECT ID FROM $wpdb->posts WHERE post\_type = 'restriction' |
  |  | 112 | ")); |
  |  | 113 | $existing\_user\_level\_lookup = array\_flip((array)$wpdb->get\_col(" |
  |  | 114 | SELECT CONCAT(user\_id, ':', comment\_post\_ID) FROM $wpdb->comments WHERE comment\_type = 'rua\_member' |
  |  | 115 | ")); |
  |  | 116 |  |
  |  | 117 | $blog\_prefix = $wpdb->get\_blog\_prefix(); |
  |  | 118 | $query = <<<QUERY |
  |  | 119 | SELECT um.user\_id, um.meta\_key, um.meta\_value |
  |  | 120 | FROM $wpdb->usermeta um |
  |  | 121 | INNER JOIN $wpdb->usermeta u ON um.user\_id = u.user\_id AND u.meta\_key = '{$blog\_prefix}capabilities' |
  |  | 122 | WHERE um.meta\_key LIKE '\_ca\_level%' |
  |  | 123 | QUERY; |
  |  | 124 |  |
  |  | 125 | $usermeta = $wpdb->get\_results($query); |
  |  | 126 |  |
  |  | 127 | $data\_new = []; |
  |  | 128 | $data\_meta\_map = []; |
  |  | 129 |  |
  |  | 130 | foreach ($usermeta as $meta) { |
  |  | 131 | if ($meta->meta\_key === '\_ca\_level') { |
  |  | 132 | if (!isset($level\_id\_lookup[$meta->meta\_value])) { |
  |  | 133 | continue; |
  |  | 134 | } |
  |  | 135 | //prevent dupe |
  |  | 136 | if (isset($existing\_user\_level\_lookup[$meta->user\_id . ':' . $meta->meta\_value])) { |
  |  | 137 | continue; |
  |  | 138 | } |
  |  | 139 |  |
  |  | 140 | $data\_new[] = [ |
  |  | 141 | 'comment\_approved' => 'active', |
  |  | 142 | 'comment\_date'     => '', |
  |  | 143 | 'comment\_type'     => 'rua\_member', |
  |  | 144 | 'user\_id'          => $meta->user\_id, |
  |  | 145 | 'comment\_post\_ID'  => $meta->meta\_value, |
  |  | 146 | 'comment\_meta'     => [], |
  |  | 147 | ]; |
  |  | 148 | } else { |
  |  | 149 | $data\_meta\_map[$meta->user\_id . ':' . $meta->meta\_key] = $meta->meta\_value; |
  |  | 150 | } |
  |  | 151 | } |
  |  | 152 |  |
  |  | 153 | foreach ($data\_new as $data) { |
  |  | 154 | $user\_id = $data['user\_id']; |
  |  | 155 | $level\_id = $data['comment\_post\_ID']; |
  |  | 156 | $insert = $data; |
  |  | 157 |  |
  |  | 158 | //start date |
  |  | 159 | if (isset($data\_meta\_map[$user\_id . ':\_ca\_level\_' . $level\_id])) { |
  |  | 160 | $insert['comment\_date'] = date\_i18n('Y-m-d H:i:s', $data\_meta\_map[$user\_id . ':\_ca\_level\_' . $level\_id]); |
  |  | 161 | } |
  |  | 162 | //status |
  |  | 163 | if (isset($data\_meta\_map[$user\_id . ':\_ca\_level\_status\_' . $level\_id])) { |
  |  | 164 | $insert['comment\_approved'] = $data\_meta\_map[$user\_id . ':\_ca\_level\_status\_' . $level\_id]; |
  |  | 165 | } |
  |  | 166 | //expiry date |
  |  | 167 | if (isset($data\_meta\_map[$user\_id . ':\_ca\_level\_expiry\_' . $level\_id])) { |
  |  | 168 | $insert['comment\_meta']['\_ca\_member\_expiry'] = $data\_meta\_map[$user\_id . ':\_ca\_level\_expiry\_' . $level\_id]; |
  |  | 169 | } |
  |  | 170 |  |
  |  | 171 | wp\_insert\_comment($insert); |
  |  | 172 | wp\_update\_comment\_count($level\_id); |
  |  | 173 | } |
  |  | 174 |  |
  |  | 175 | return true; |
  | 91 | 176 | } |
  | 92 | 177 |  |
* ## [restrict-user-access/trunk/freemius.php](/changeset/3037773/restrict-user-access/trunk/freemius.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Ffreemius.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/freemius.php")

  | [r3010745](/browser/restrict-user-access/trunk/freemius.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/freemius.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/helpers/collection.php](/changeset/3037773/restrict-user-access/trunk/helpers/collection.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fhelpers%2Fcollection.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/helpers/collection.php")

  | [r3010745](/browser/restrict-user-access/trunk/helpers/collection.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/helpers/collection.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/interfaces/level.php](/changeset/3037773/restrict-user-access/trunk/interfaces/level.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Finterfaces%2Flevel.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/interfaces/level.php")

  | [r3010745](/browser/restrict-user-access/trunk/interfaces/level.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/interfaces/level.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/interfaces/user.php](/changeset/3037773/restrict-user-access/trunk/interfaces/user.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Finterfaces%2Fuser.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/interfaces/user.php")

  | [r3010745](/browser/restrict-user-access/trunk/interfaces/user.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/interfaces/user.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/interfaces/user\_level.php](/changeset/3037773/restrict-user-access/trunk/interfaces/user_level.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Finterfaces%2Fuser_level.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/interfaces/user_level.php")

  | [r3010745](/browser/restrict-user-access/trunk/interfaces/user_level.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/interfaces/user_level.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/level.php](/changeset/3037773/restrict-user-access/trunk/level.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Flevel.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/level.php")

  | [r3010745](/browser/restrict-user-access/trunk/level.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/level.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
  | […](/browser/restrict-user-access/trunk/level.php?rev=3010745#L525) | […](/browser/restrict-user-access/trunk/level.php?rev=3037773#L525) |  |
  | 525 | 525 | 'parent\_item\_colon'  => \_\_('Extend Level', 'restrict-user-access'), |
  | 526 | 526 | //wp-content-aware-engine specific |
  | 527 |  | 'ca\_title' => \_\_('~~Members-Only Acces~~s', 'content-aware-sidebars') |
  |  | 527 | 'ca\_title' => \_\_('Only members can visit these pages', 'content-aware-sidebars') |
  | 528 | 528 | ], |
  | 529 | 529 | 'capabilities' => [ |
* ## [restrict-user-access/trunk/lib/wp-content-aware-engine/module/bp\_member.php](/changeset/3037773/restrict-user-access/trunk/lib/wp-content-aware-engine/module/bp_member.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Flib%2Fwp-content-aware-engine%2Fmodule%2Fbp_member.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/lib/wp-content-aware-engine/module/bp_member.php")

  | [r3010745](/browser/restrict-user-access/trunk/lib/wp-content-aware-engine/module/bp_member.php?rev=3010745#L59 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/lib/wp-content-aware-engine/module/bp_member.php?rev=3037773#L59 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 59 | 59 | protected function \_get\_content($args = []) |
  | 60 | 60 | { |
  | 61 |  | ~~global $bp;~~ |
  | 62 |  |  |
  | 63 | 61 | if (isset($args['paged']) && $args['paged'] > 1) { |
  | 64 | 62 | return []; |
  | 65 | 63 | } |
  | 66 | 64 |  |
  |  | 65 | $bp = buddypress(); |
  | 67 | 66 | $content = []; |
  | 68 | 67 | $is\_search = isset($args['search']) && $args['search']; |
  |  | 68 | $is\_include = !empty($args['include']); |
  | 69 | 69 |  |
  | 70 |  | if (isset($bp->members->nav)) { |
  | 71 |  | foreach ($bp->members->nav->get\_item\_nav() as $item) { |
  |  | 70 | //BP <12.0 and Classic BP |
  |  | 71 | if (isset($bp->members->nav) && $bp->members->nav->get\_item\_nav() !== false) { |
  |  | 72 | foreach ((array) $bp->members->nav->get\_item\_nav() as $item) { |
  | 72 | 73 | $content[$item->slug] = [ |
  | 73 | 74 | 'id'   => $item->slug, |
  | […](/browser/restrict-user-access/trunk/lib/wp-content-aware-engine/module/bp_member.php?rev=3010745#L85) | […](/browser/restrict-user-access/trunk/lib/wp-content-aware-engine/module/bp_member.php?rev=3037773#L86) |  |
  | 85 | 86 | } |
  | 86 | 87 | } |
  |  | 88 | } elseif (function\_exists('bp\_get\_component\_navigations')) { |
  |  | 89 | foreach (bp\_get\_component\_navigations() as $navs) { |
  |  | 90 | if (!isset($navs['main\_nav']['rewrite\_id']) || !$navs['main\_nav']['rewrite\_id']) { |
  |  | 91 | continue; |
  |  | 92 | } |
  |  | 93 | $content[$navs['main\_nav']['slug']] = [ |
  |  | 94 | 'id'   => $navs['main\_nav']['slug'], |
  |  | 95 | 'text' => strip\_tags($navs['main\_nav']['name']) |
  |  | 96 | ]; |
  |  | 97 | if (isset($navs['sub\_nav'])) { |
  |  | 98 | $level = $is\_search ? 0 : 1; |
  |  | 99 | foreach ($navs['sub\_nav'] as $sub\_nav) { |
  |  | 100 | $content[$sub\_nav['parent\_slug'] . '-' . $sub\_nav['slug']] = [ |
  |  | 101 | 'text' => $is\_search || $is\_include |
  |  | 102 | ? strip\_tags($navs['main\_nav']['name'] . ': ' . $sub\_nav['name']) |
  |  | 103 | : strip\_tags($sub\_nav['name']), |
  |  | 104 | 'id'    => $sub\_nav['parent\_slug'] . '-' . $sub\_nav['slug'], |
  |  | 105 | 'level' => $level |
  |  | 106 | ]; |
  |  | 107 | } |
  |  | 108 | } |
  |  | 109 | } |
  | 87 | 110 | } |
  | 88 | 111 |  |
  | 89 |  | if (~~!empty($args['include'])~~) { |
  |  | 112 | if ($is\_include) { |
  | 90 | 113 | $content = array\_intersect\_key($content, array\_flip($args['include'])); |
  | 91 | 114 | } elseif ($is\_search) { |
  | […](/browser/restrict-user-access/trunk/lib/wp-content-aware-engine/module/bp_member.php?rev=3010745#L103) | […](/browser/restrict-user-access/trunk/lib/wp-content-aware-engine/module/bp_member.php?rev=3037773#L126) |  |
  | 103 | 126 | public function in\_context() |
  | 104 | 127 | { |
  | 105 |  | ~~global $bp~~; |
  |  | 128 | $bp = buddypress(); |
  | 106 | 129 | return isset($bp->displayed\_user->domain) && $bp->displayed\_user->domain; |
  | 107 | 130 | } |
  | […](/browser/restrict-user-access/trunk/lib/wp-content-aware-engine/module/bp_member.php?rev=3010745#L112) | […](/browser/restrict-user-access/trunk/lib/wp-content-aware-engine/module/bp_member.php?rev=3037773#L135) |  |
  | 112 | 135 | public function get\_context\_data() |
  | 113 | 136 | { |
  | 114 |  | ~~global $bp~~; |
  |  | 137 | $bp = buddypress(); |
  | 115 | 138 | $data = [$this->default\_value]; |
  | 116 | 139 | if (isset($bp->current\_component)) { |
* ## [restrict-user-access/trunk/list-capabilities.php](/changeset/3037773/restrict-user-access/trunk/list-capabilities.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Flist-capabilities.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/list-capabilities.php")

  | [r3010745](/browser/restrict-user-access/trunk/list-capabilities.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/list-capabilities.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/list-members.php](/changeset/3037773/restrict-user-access/trunk/list-members.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Flist-members.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/list-members.php")

  | [r3010745](/browser/restrict-user-access/trunk/list-members.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/list-members.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
  | […](/browser/restrict-user-access/trunk/list-members.php?rev=3010745#L126) | […](/browser/restrict-user-access/trunk/list-members.php?rev=3037773#L126) |  |
  | 126 | 126 | $title = '<strong>' . $membership->user()->get\_attribute('user\_login') . '</strong>'; |
  | 127 | 127 | $admin\_url = admin\_url(sprintf( |
  | 128 |  | 'admin.php?page=wprua-level&post=%~~s&user=%s~~', |
  |  | 128 | 'admin.php?page=wprua-level&post=%d&user=%d', |
  | 129 | 129 | $\_REQUEST['post'], |
  | 130 | 130 | $membership->get\_user\_id() |
  | […](/browser/restrict-user-access/trunk/list-members.php?rev=3010745#L346) | […](/browser/restrict-user-access/trunk/list-members.php?rev=3037773#L346) |  |
  | 346 | 346 |  |
  | 347 | 347 | if (!isset($total\_items)) { |
  | 348 |  | $total\_items = get\_comments([ |
  |  | 348 | $total\_items = \_rua\_get\_comments([ |
  | 349 | 349 | 'number'  => 0, |
  | 350 | 350 | 'offset'  => 0, |
* ## [restrict-user-access/trunk/models/level.php](/changeset/3037773/restrict-user-access/trunk/models/level.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fmodels%2Flevel.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/models/level.php")

  | [r3010745](/browser/restrict-user-access/trunk/models/level.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/models/level.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/models/user.php](/changeset/3037773/restrict-user-access/trunk/models/user.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fmodels%2Fuser.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/models/user.php")

  | [r3010745](/browser/restrict-user-access/trunk/models/user.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/models/user.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/models/user\_level.php](/changeset/3037773/restrict-user-access/trunk/models/user_level.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fmodels%2Fuser_level.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/models/user_level.php")

  | [r3010745](/browser/restrict-user-access/trunk/models/user_level.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/models/user_level.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/readme.txt](/changeset/3037773/restrict-user-access/trunk/readme.txt?old=3010745&old_path=restrict-user-access%2Ftrunk%2Freadme.txt "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/readme.txt")

  | [r3010745](/browser/restrict-user-access/trunk/readme.txt?rev=3010745#L6 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/readme.txt?rev=3037773#L6 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | Requires PHP: 5.6 |
  | 7 | 7 | Tested up to: 6.4 |
  | 8 |  | Stable tag: 2.~~5~~ |
  |  | 8 | Stable tag: 2.6 |
  | 9 | 9 | License: GPLv3 |
  | 10 | 10 |  |
  | […](/browser/restrict-user-access/trunk/readme.txt?rev=3010745#L34) | […](/browser/restrict-user-access/trunk/readme.txt?rev=3037773#L34) |  |
  | 34 | 34 | ###🔒 Contextual Content Protection |
  | 35 | 35 |  |
  | 36 |  | Restrict access to your posts, pages, or categories. You can even combine the conditions: protect all posts tagged "Premium" written by a select author. |
  |  | 36 | Prevent unauthorized users from visiting your posts, pages, or categories. You can even combine the conditions: protect all posts tagged "Premium" written by a select author. |
  | 37 | 37 |  |
  | 38 | 38 | The following Access Conditions are available out of the box: |
  | […](/browser/restrict-user-access/trunk/readme.txt?rev=3010745#L51) | […](/browser/restrict-user-access/trunk/readme.txt?rev=3037773#L51) |  |
  | 51 | 51 | \* Pods Pages |
  | 52 | 52 |  |
  |  | 53 | Note that Access Conditions do not apply to content displayed in lists. |
  |  | 54 |  |
  | 53 | 55 | ###✅ Grant & Deny Capabilities |
  | 54 | 56 |  |
  | 55 | 57 | The easy-to-use WordPress User Manager gives you full control over the capabilities the members should or shouldn't have. Access Level Capabilities will override the permissions set by roles or other plugins. |
  | 56 | 58 |  |
  | 57 |  | ###~~⚙~~️ Hide Admin Bar & Nav Menu Visibility |
  | 58 |  |  |
  | 59 |  | Disable the admin bar for select levels and control what menu items members can see. You can even hide any widget area created with [Content Aware Sidebars](https://dev.institute/wordpress-sidebars/) |
  |  | 59 | ###👁️ Hide Admin Bar & Nav Menu Visibility |
  |  | 60 |  |
  |  | 61 | Disable the admin bar for select levels and control what menu items members can see. You can even hide any widget area created with [Content Aware Sidebars](https://dev.institute/wordpress-sidebars/?utm\_source=readme&utm\_medium=referral&utm\_content=section&utm\_campaign=rua) |
  | 60 | 62 |  |
  | 61 | 63 | ###🤖 Restrict Content from Other Plugins |
  | […](/browser/restrict-user-access/trunk/readme.txt?rev=3010745#L66) | […](/browser/restrict-user-access/trunk/readme.txt?rev=3037773#L68) |  |
  | 66 | 68 | \* BuddyPress |
  | 67 | 69 | \* Easy Digital Downloads |
  | 68 |  | ~~\* qTranslate X~~ |
  | 69 | 70 | \* Pods |
  | 70 | 71 | \* Polylang |
  | 71 | 72 | \* TranslatePress |
  | 72 |  | ~~\* Transposh Translation Filter~~ |
  | 73 | 73 | \* WooCommerce |
  | 74 | 74 | \* Weglot |
  | 75 | 75 | \* WPML |
  |  | 76 | \* and more ... |
  |  | 77 |  |
  |  | 78 | ###🛡️ WordPress Security Enhancements |
  |  | 79 |  |
  |  | 80 | \* \*\*WP REST API Content Protection\*\* |
  |  | 81 | Enforces PoLA to minimize attack surfaces and stop threat actors from harvesting your data |
  |  | 82 | \* \*\*How to display content in lists\*\* |
  |  | 83 | Display excerpts only or hide content when post types are displayed in blog, archives, search results, lists, etc. |
  | 76 | 84 |  |
  | 77 | 85 | ###📑 Restrict Content with Shortcodes |
  | […](/browser/restrict-user-access/trunk/readme.txt?rev=3010745#L116) | […](/browser/restrict-user-access/trunk/readme.txt?rev=3037773#L124) |  |
  | 116 | 124 | ` |
  | 117 | 125 |  |
  | 118 |  | [View full documentation](https://dev.institute/docs/restrict-user-access/developer-api/) |
  |  | 126 | [View full RUA PHP API documentation here.](https://dev.institute/docs/restrict-user-access/developer-api/?utm\_source=readme&utm\_medium=referral&utm\_content=section&utm\_campaign=rua) |
  |  | 127 |  |
  |  | 128 | ###🎛️ Premium Add-ons for Restrict User Access |
  |  | 129 |  |
  |  | 130 | Complete your WordPress membership site with these powerful extensions |
  |  | 131 |  |
  |  | 132 | \* \*\*[ACF Restriction](https://dev.institute/products/category/restrict-user-access/?utm\_source=readme&utm\_medium=referral&utm\_content=acf&utm\_campaign=rua)\*\* |
  |  | 133 | Restrict content that contain data from Advanced Custom Fields plugin |
  |  | 134 | \* \*\*[Date Restriction](https://dev.institute/products/category/restrict-user-access/?utm\_source=readme&utm\_medium=referral&utm\_content=date&utm\_campaign=rua)\*\* |
  |  | 135 | Restrict content based on the time it was published |
  |  | 136 | \* \*\*[Meta Box Restriction](https://dev.institute/products/category/restrict-user-access/?utm\_source=readme&utm\_medium=referral&utm\_content=metabox&utm\_campaign=rua)\*\* |
  |  | 137 | Restrict content that contain data from Meta Box plugin |
  |  | 138 | \* \*\*[Timelock](https://dev.institute/products/category/restrict-user-access/?utm\_source=readme&utm\_medium=referral&utm\_content=timelock&utm\_campaign=rua)\*\* |
  |  | 139 | Determine when to enable or disable select Access Conditions |
  |  | 140 | \* \*\*[URL Restriction](https://dev.institute/products/category/restrict-user-access/?utm\_source=readme&utm\_medium=referral&utm\_content=url&utm\_campaign=rua)\*\* |
  |  | 141 | Restrict content based on the WordPress URL, with wildcard support |
  |  | 142 | \* \*\*[Visibility Control](https://dev.institute/products/category/restrict-user-access/?utm\_source=readme&utm\_medium=referral&utm\_content=visibility&utm\_campaign=rua)\*\* |
  |  | 143 | Hide content from blog, search results, archives, custom lists, WP REST API, and more |
  | 119 | 144 |  |
  | 120 | 145 | == Installation == |
  | […](/browser/restrict-user-access/trunk/readme.txt?rev=3010745#L146) | […](/browser/restrict-user-access/trunk/readme.txt?rev=3037773#L171) |  |
  | 146 | 171 | = I added a level to a user, but it can still access other content? = |
  | 147 | 172 |  |
  | 148 |  | When you ~~create an Access Level to restrict some content, only members of this level will be able to access that content, but they can still access other content~~ too. |
  |  | 173 | When you use Access Conditions to restrict some pages, only members of this level will be able to visit those pages, but they can still visit other pages too. |
  | 149 | 174 |  |
  | 150 | 175 | You can change this behavior from the Options tab by toggling "Deny Access to Unprotected Content" to ON. |
  | 151 | 176 |  |
  | 152 |  | With this option enabled, members can only ~~access the content that has been restricted to this level~~. |
  |  | 177 | With this option enabled, members can only visit the pages selected as Access Conditions. |
  | 153 | 178 |  |
  | 154 | 179 | To prevent lockout, Administrators will have access to all content regardless of your levels. |
  | 155 | 180 |  |
  | 156 |  | = Restricted content is still ~~being displayed on archive pages or in widgets~~? = |
  | 157 |  |  |
  | 158 |  | By default, ~~Restrict User Access will not hide single items from archive pages, search results, widgets~~ or custom lists. |
  | 159 |  |  |
  | 160 |  | [~~This is possible with the Visibility Control add-on](https://dev.institute/products/category/restrict-user-access/~~) |
  |  | 181 | = Restricted content is still displayed in blog, archives, search results, etc? = |
  |  | 182 |  |
  |  | 183 | By default, Access Conditions do not apply to items in archive pages, search results, widgets, WP REST API, or custom lists. |
  |  | 184 |  |
  |  | 185 | [Learn more about how to completely hide content here.](https://dev.institute/docs/restrict-user-access/faq/restricted-content-not-hidden/?utm\_source=readme&utm\_medium=referral&utm\_content=faq&utm\_campaign=rua) |
  | 161 | 186 |  |
  | 162 | 187 | = Restricted file is still accessible with deep link? = |
  | […](/browser/restrict-user-access/trunk/readme.txt?rev=3010745#L191) | […](/browser/restrict-user-access/trunk/readme.txt?rev=3037773#L216) |  |
  | 191 | 216 |  |
  | 192 | 217 | ####Highlights |
  |  | 218 |  |
  |  | 219 | = 2.6 = |
  |  | 220 |  |
  |  | 221 | \* [new] rest api content protection |
  |  | 222 | \* [new] control how content is displayed in lists |
  |  | 223 | \* [updated] buddypress 12 compatibility |
  |  | 224 | \* [fixed] compatibility with polylang and wpml |
  |  | 225 | \* [fixed] xss vulnerability when editing levels |
  | 193 | 226 |  |
  | 194 | 227 | = 2.5 = |
* ## [restrict-user-access/trunk/restrict-user-access.php](/changeset/3037773/restrict-user-access/trunk/restrict-user-access.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Frestrict-user-access.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/restrict-user-access.php")

  | [r3010745](/browser/restrict-user-access/trunk/restrict-user-access.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/restrict-user-access.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \* |
  | 8 | 8 | \* Plugin Name:       Restrict User Access |
  | 9 | 9 | \* Plugin URI:        https://dev.institute/wordpress-memberships/ |
  | 10 | 10 | \* Description:       Easily restrict content and contexts to provide exclusive access for specific Access Levels. |
  | 11 |  | \* Version:           2.~~5~~ |
  |  | 11 | \* Version:           2.6 |
  | 12 | 12 | \* Author:            DEV Institute |
  | 13 | 13 | \* Author URI:        https://dev.institute |
  | […](/browser/restrict-user-access/trunk/restrict-user-access.php?rev=3010745#L69) | […](/browser/restrict-user-access/trunk/restrict-user-access.php?rev=3037773#L69) |  |
  | 69 | 69 | require $rua\_plugin\_path . '/list-capabilities.php'; |
  | 70 | 70 | require $rua\_plugin\_path . '/app.php'; |
  |  | 71 | require $rua\_plugin\_path . '/content-mode.php'; |
  | 71 | 72 | require $rua\_plugin\_path . '/level.php'; |
  | 72 | 73 | require $rua\_plugin\_path . '/api/deprecated.php'; |
* ## [restrict-user-access/trunk/view/meta\_box\_caps.php](/changeset/3037773/restrict-user-access/trunk/view/meta_box_caps.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fview%2Fmeta_box_caps.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/view/meta_box_caps.php")

  | [r3010745](/browser/restrict-user-access/trunk/view/meta_box_caps.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/view/meta_box_caps.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/view/meta\_box\_member\_triggers.php](/changeset/3037773/restrict-user-access/trunk/view/meta_box_member_triggers.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fview%2Fmeta_box_member_triggers.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/view/meta_box_member_triggers.php")

  | [r3010745](/browser/restrict-user-access/trunk/view/meta_box_member_triggers.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/view/meta_box_member_triggers.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/view/meta\_box\_members.php](/changeset/3037773/restrict-user-access/trunk/view/meta_box_members.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fview%2Fmeta_box_members.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/view/meta_box_members.php")

  | [r3010745](/browser/restrict-user-access/trunk/view/meta_box_members.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/view/meta_box_members.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/view/meta\_box\_options.php](/changeset/3037773/restrict-user-access/trunk/view/meta_box_options.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fview%2Fmeta_box_options.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/view/meta_box_options.php")

  | [r3010745](/browser/restrict-user-access/trunk/view/meta_box_options.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/view/meta_box_options.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/view/meta\_box\_publish.php](/changeset/3037773/restrict-user-access/trunk/view/meta_box_publish.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fview%2Fmeta_box_publish.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/view/meta_box_publish.php")

  | [r3010745](/browser/restrict-user-access/trunk/view/meta_box_publish.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/view/meta_box_publish.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/view/meta\_box\_support.php](/changeset/3037773/restrict-user-access/trunk/view/meta_box_support.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fview%2Fmeta_box_support.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/view/meta_box_support.php")

  | [r3010745](/browser/restrict-user-access/trunk/view/meta_box_support.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/view/meta_box_support.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
* ## [restrict-user-access/trunk/view/top\_bar.php](/changeset/3037773/restrict-user-access/trunk/view/top_bar.php?old=3010745&old_path=restrict-user-access%2Ftrunk%2Fview%2Ftop_bar.php "Show the [3010745:3037773] differences restricted to restrict-user-access/trunk/view/top_bar.php")

  | [r3010745](/browser/restrict-user-access/trunk/view/top_bar.php?rev=3010745#L4 "Show revision 3010745 of this file in browser") | [r3037773](/browser/restrict-user-access/trunk/view/top_bar.php?rev=3037773#L4 "Show revision 3037773 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* @author Joachim Jensen <joachim@dev.institute> |
  | 5 | 5 | \* @license GPLv3 |
  | 6 |  | \* @copyright 202~~3~~ by Joachim Jensen |
  |  | 6 | \* @copyright 2024 by Joachim Jensen |
  | 7 | 7 | \*/ |
  | 8 | 8 | ?> |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3037773&old=3010745&new_path=%2Frestrict-user-access%2Ftrunk&old_path=%2Frestrict-user-access%2Ftrunk)
* [Zip Archive](?format=zip&new=3037773&old=3010745&new_path=%2Frestrict-user-access%2Ftrunk&old_path=%2Frestrict-user-access%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

