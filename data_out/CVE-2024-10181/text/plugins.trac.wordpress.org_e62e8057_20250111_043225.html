

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3175816)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3175815 "Changeset 3175815")
* [Next Changeset](/changeset/3175817 "Changeset 3175817") →

---

# Changeset 3175816

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/25/2024 06:17:48 PM
([3 months](/timeline?from=2024-10-25T18%3A17%3A48Z&precision=second "See timeline at 10/25/2024 06:17:48 PM") ago)

Author:
mohsenr1
Message:

v 4.9.9.5

Location:
[newsletters-lite/trunk](/browser/newsletters-lite/trunk?rev=3175816)
Files:

11 edited

* [helpers/shortcode.php](/browser/newsletters-lite/trunk/helpers/shortcode.php?rev=3175816 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))
* [models/click.php](/browser/newsletters-lite/trunk/models/click.php?rev=3175816 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [readme.txt](/browser/newsletters-lite/trunk/readme.txt?rev=3175816 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [vendors/processing/wp-background-process.php](/browser/newsletters-lite/trunk/vendors/processing/wp-background-process.php?rev=3175816 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [vendors/processing/wp-queue-process.php](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process.php?rev=3175816 "Show entry in browser")
  (modified)
  ([3 diffs](#file4 "Show differences"))
* [vendors/processing/wp-queue-process\_2.php](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process_2.php?rev=3175816 "Show entry in browser")
  (modified)
  ([2 diffs](#file5 "Show differences"))
* [vendors/processing/wp-queue-process\_3.php](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process_3.php?rev=3175816 "Show entry in browser")
  (modified)
  ([2 diffs](#file6 "Show differences"))
* [views/admin/head.php](/browser/newsletters-lite/trunk/views/admin/head.php?rev=3175816 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))
* [views/admin/queues/index.php](/browser/newsletters-lite/trunk/views/admin/queues/index.php?rev=3175816 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [wp-mailinglist-plugin.php](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816 "Show entry in browser")
  (modified)
  ([13 diffs](#file9 "Show differences"))
* [wp-mailinglist.php](/browser/newsletters-lite/trunk/wp-mailinglist.php?rev=3175816 "Show entry in browser")
  (modified)
  ([1 diff](#file10 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [newsletters-lite/trunk/helpers/shortcode.php](/changeset/3175816/newsletters-lite/trunk/helpers/shortcode.php "Show the changeset 3175816 restricted to newsletters-lite/trunk/helpers/shortcode.php")

  | [r2973116](/browser/newsletters-lite/trunk/helpers/shortcode.php?rev=2973116#L213 "Show revision 2973116 of this file in browser") | [r3175816](/browser/newsletters-lite/trunk/helpers/shortcode.php?rev=3175816#L213 "Show revision 3175816 of this file in browser") |  |
  | --- | --- | --- |
  | 213 | 213 | ); |
  | 214 | 214 |  |
  |  | 215 | // Escape all attributes |
  |  | 216 | foreach ($atts as $key => $value) { |
  |  | 217 | $atts[$key] = esc\_attr($value); |
  |  | 218 | } |
  |  | 219 |  |
  | 215 | 220 | extract(shortcode\_atts($defaults, $atts)); |
  | 216 | 221 |  |
  | […](/browser/newsletters-lite/trunk/helpers/shortcode.php?rev=2973116#L698) | […](/browser/newsletters-lite/trunk/helpers/shortcode.php?rev=3175816#L703) |  |
  | 698 | 703 | case 'newsletters\_post\_link'    : |
  | 699 | 704 | if (!empty($shortcode\_post)) { |
  | 700 |  | return do\_shortcode($this -> direct\_post\_permalink(~~esc\_html($shortcode\_post -> ID)~~)); |
  |  | 705 | return do\_shortcode($this -> direct\_post\_permalink($shortcode\_post -> ID)); |
  | 701 | 706 | } |
  | 702 | 707 | break; |
* ## [newsletters-lite/trunk/models/click.php](/changeset/3175816/newsletters-lite/trunk/models/click.php "Show the changeset 3175816 restricted to newsletters-lite/trunk/models/click.php")

  | [r2773174](/browser/newsletters-lite/trunk/models/click.php?rev=2773174#L79 "Show revision 2773174 of this file in browser") | [r3175816](/browser/newsletters-lite/trunk/models/click.php?rev=3175816#L79 "Show revision 3175816 of this file in browser") |  |
  | --- | --- | --- |
  | 79 | 79 | } |
  | 80 | 80 |  |
  |  | 81 | public function count($conditions = [], $sum = false, $sumcol = null){ |
  |  | 82 | $count = 0; |
  |  | 83 |  |
  |  | 84 | if (!empty($this -> model)) { |
  |  | 85 | global $wpdb, ${$this -> model}; |
  |  | 86 |  |
  |  | 87 | $object = $this -> getobject($this -> model); |
  |  | 88 |  |
  |  | 89 | if (!empty($sum) && !empty($sumcol)) { |
  |  | 90 | $query = "SELECT SUM(`" . $sumcol . "`) FROM `" . $wpdb -> prefix . $object -> table . "`"; |
  |  | 91 | } else { |
  |  | 92 | $query = "SELECT COUNT(DISTINCT CASE |
  |  | 93 | WHEN user\_id != 0 THEN user\_id |
  |  | 94 | ELSE subscriber\_id |
  |  | 95 | END) AS unique\_clicks FROM `" . $wpdb -> prefix . $object -> table . "`"; |
  |  | 96 | } |
  |  | 97 |  |
  |  | 98 | $conditions = apply\_filters('newsletters\_db\_count\_conditions', $conditions, $object -> model); |
  |  | 99 |  |
  |  | 100 | if (!empty($conditions) && is\_array($conditions)) { |
  |  | 101 | $query .= " WHERE"; |
  |  | 102 | $c = 1; |
  |  | 103 |  |
  |  | 104 | foreach ($conditions as $ckey => $cval) { |
  |  | 105 | if (preg\_match("/[>]\s?(.\*)?/si", $cval, $cmatches)) { |
  |  | 106 | if (!empty($cmatches[1]) || $cmatches[1] == "0") { |
  |  | 107 | $query .= " `" . $ckey . "` > " . esc\_sql($cmatches[1]) . ""; |
  |  | 108 | } |
  |  | 109 | } elseif (preg\_match("/[<]\s?(.\*)?/si", $cval, $cmatches)) { |
  |  | 110 | if (!empty($cmatches[1]) || $cmatches[1] == "0") { |
  |  | 111 | $query .= " `" . $ckey . "` < " . esc\_sql($cmatches[1]) . ""; |
  |  | 112 | } |
  |  | 113 | } elseif (preg\_match("/^(!=)\s?(.\*)?/si", $cval, $cmatches)) { |
  |  | 114 | if (!empty($cmatches[2]) || $cmatches[2] == 0) { |
  |  | 115 | $query .= " `" . $ckey . "` != " . esc\_sql($cmatches[2]) . ""; |
  |  | 116 | } |
  |  | 117 | } elseif (preg\_match("/(NOT IN)/si", $cval)) { |
  |  | 118 | $query .= " " . $ckey . " " . ($cval) . ""; |
  |  | 119 | $countquery .= " " . $ckey . " " . esc\_sql($cval) . ""; |
  |  | 120 | } elseif (preg\_match("/(IN \()/si", $cval)) { |
  |  | 121 | $query .= " " . $ckey . " " . ($cval) . ""; |
  |  | 122 | $countquery .= " " . $ckey . " " . esc\_sql($cval); |
  |  | 123 | } elseif (preg\_match("/(LIKE)/", $cval, $cmatches)) { |
  |  | 124 | $query .= " `" . $ckey . "` " . ($cval); |
  |  | 125 | } else { |
  |  | 126 | $query .= " `" . $ckey . "` = '" . esc\_sql($cval) . "'"; |
  |  | 127 | } |
  |  | 128 |  |
  |  | 129 | if ($c < count($conditions)) { |
  |  | 130 | $query .= " AND"; |
  |  | 131 | } |
  |  | 132 |  |
  |  | 133 | $c++; |
  |  | 134 | } |
  |  | 135 | } |
  |  | 136 | $query\_hash = md5($query); |
  |  | 137 | if ($ob\_count = $this -> get\_cache($query\_hash)) { |
  |  | 138 | return $ob\_count; |
  |  | 139 | } else { |
  |  | 140 | $count = $wpdb -> get\_var($query); |
  |  | 141 | $this -> set\_cache($query\_hash, $count); |
  |  | 142 | return $count; |
  |  | 143 | } |
  |  | 144 | } |
  |  | 145 |  |
  |  | 146 | return $count; |
  |  | 147 | } |
  |  | 148 |  |
  |  | 149 |  |
  | 81 | 150 | function validate($data = array()) |
  | 82 | 151 | { |
* ## [newsletters-lite/trunk/readme.txt](/changeset/3175816/newsletters-lite/trunk/readme.txt "Show the changeset 3175816 restricted to newsletters-lite/trunk/readme.txt")

  | [r3162959](/browser/newsletters-lite/trunk/readme.txt?rev=3162959#L5 "Show revision 3162959 of this file in browser") | [r3175816](/browser/newsletters-lite/trunk/readme.txt?rev=3175816#L5 "Show revision 3175816 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires at least: 3.8 |
  | 6 | 6 | Tested up to: 6.6.2 |
  | 7 |  | Stable tag: 4.9.9.~~4~~ |
  |  | 7 | Stable tag: 4.9.9.5 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: https://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/newsletters-lite/trunk/readme.txt?rev=3162959#L224) | […](/browser/newsletters-lite/trunk/readme.txt?rev=3175816#L224) |  |
  | 224 | 224 |  |
  | 225 | 225 | See all <a href="https://tribulant.com/docs/wordpress-mailing-list-plugin/31/#doc6">releases and full changelogs</a> in our docs. |
  |  | 226 |  |
  |  | 227 | = 4.9.9.5 = |
  |  | 228 | \* IMPROVE: Changed the number of clicks to number of unique clicks everywhere. |
  |  | 229 | \* FIX: Safari 18+ classic editor post box move to right issue. |
  |  | 230 | \* FIX: Schedule interval by more than 50 minutes was not working. |
  |  | 231 | \* FIX: Batches display in the queue issue. |
  |  | 232 | \* FIX: XSS vulnerability on newsletters\_video shortcode. |
  |  | 233 | \* FIX: newsletters\_post\_link escaping issue (always wrapped in HTML special characters). |
  | 226 | 234 |  |
  | 227 | 235 | = 4.9.9.4 = |
* ## [newsletters-lite/trunk/vendors/processing/wp-background-process.php](/changeset/3175816/newsletters-lite/trunk/vendors/processing/wp-background-process.php "Show the changeset 3175816 restricted to newsletters-lite/trunk/vendors/processing/wp-background-process.php")

  | [r2931916](/browser/newsletters-lite/trunk/vendors/processing/wp-background-process.php?rev=2931916#L499 "Show revision 2931916 of this file in browser") | [r3175816](/browser/newsletters-lite/trunk/vendors/processing/wp-background-process.php?rev=3175816#L499 "Show revision 3175816 of this file in browser") |  |
  | --- | --- | --- |
  | 499 | 499 | } |
  | 500 | 500 |  |
  |  | 501 | public function translate\_scheule\_interval ($schedule2 = null) |
  |  | 502 | { |
  |  | 503 | if(empty($schedule2)) |
  |  | 504 | { |
  |  | 505 | return  array( |
  |  | 506 | "interval" => 0, |
  |  | 507 | "display" => "Invalid interval. Please set  through Newsletters configurations." |
  |  | 508 | ); |
  |  | 509 | } |
  |  | 510 |  |
  |  | 511 | $schedules = array( |
  |  | 512 | "1minutes" => array( |
  |  | 513 | "interval" => 60, |
  |  | 514 | "display" => "Every Minute" |
  |  | 515 | ), |
  |  | 516 | "2minutes" => array( |
  |  | 517 | "interval" => 120, |
  |  | 518 | "display" => "Every 2 Minutes" |
  |  | 519 | ), |
  |  | 520 | "5minutes" => array( |
  |  | 521 | "interval" => 300, |
  |  | 522 | "display" => "Every 5 Minutes" |
  |  | 523 | ), |
  |  | 524 | "10minutes" => array( |
  |  | 525 | "interval" => 600, |
  |  | 526 | "display" => "Every 10 Minutes" |
  |  | 527 | ), |
  |  | 528 | "20minutes" => array( |
  |  | 529 | "interval" => 1200, |
  |  | 530 | "display" => "Every 20 Minutes" |
  |  | 531 | ), |
  |  | 532 | "30minutes" => array( |
  |  | 533 | "interval" => 1800, |
  |  | 534 | "display" => "Every 30 Minutes" |
  |  | 535 | ), |
  |  | 536 | "40minutes" => array( |
  |  | 537 | "interval" => 2400, |
  |  | 538 | "display" => "Every 40 Minutes" |
  |  | 539 | ), |
  |  | 540 | "50minutes" => array( |
  |  | 541 | "interval" => 3000, |
  |  | 542 | "display" => "Every 50 minutes" |
  |  | 543 | ), |
  |  | 544 | "hourly" => array( |
  |  | 545 | "interval" => 3600, |
  |  | 546 | "display" => "Once Hourly" |
  |  | 547 | ), |
  |  | 548 | "twicedaily" => array( |
  |  | 549 | "interval" => 43200, |
  |  | 550 | "display" => "Twice Daily" |
  |  | 551 | ), |
  |  | 552 | "daily" => array( |
  |  | 553 | "interval" => 86400, |
  |  | 554 | "display" => "Once Daily" |
  |  | 555 | ), |
  |  | 556 | "weekly" => array( |
  |  | 557 | "interval" => 604800, |
  |  | 558 | "display" => "Once Weekly" |
  |  | 559 | ), |
  |  | 560 | "monthly" => array( |
  |  | 561 | "interval" => 2664000, |
  |  | 562 | "display" => "Once Monthly" |
  |  | 563 | ) |
  |  | 564 |  |
  |  | 565 | ); |
  |  | 566 |  |
  |  | 567 | return $schedules[$schedule2]; |
  |  | 568 | } |
  |  | 569 |  |
  | 501 | 570 | } |
  | 502 | 571 | } |
* ## [newsletters-lite/trunk/vendors/processing/wp-queue-process.php](/changeset/3175816/newsletters-lite/trunk/vendors/processing/wp-queue-process.php "Show the changeset 3175816 restricted to newsletters-lite/trunk/vendors/processing/wp-queue-process.php")

  | [r2933075](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process.php?rev=2933075#L68 "Show revision 2933075 of this file in browser") | [r3175816](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process.php?rev=3175816#L68 "Show revision 3175816 of this file in browser") |  |
  | --- | --- | --- |
  | 68 | 68 | return false; |
  | 69 | 69 | } |
  | 70 |  |  |
  | 71 |  | ~~function get\_batches($onlykeys = false, $onlyerrors = false, $number = false~~) { |
  |  | 70 |  |
  |  | 71 | function get\_batches($onlykeys = false, $onlyerrors = false, $number = false, $key = null) { |
  | 72 | 72 | global $wpdb; |
  | 73 | 73 |  |
  | […](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process.php?rev=2933075#L129) | […](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process.php?rev=3175816#L129) |  |
  | 129 | 129 | return $batches; |
  | 130 | 130 | } |
  | 131 |  |  |
  | 132 |  | function get\_queued\_count($key = null) { |
  |  | 131 |  |
  |  | 132 | function get\_batches\_show($onlykeys = false, $onlyerrors = false, $number = false, $key = null) { |
  |  | 133 | global $wpdb; |
  |  | 134 |  |
  |  | 135 | $table        = $wpdb -> options; |
  |  | 136 | $column       = 'option\_name'; |
  |  | 137 | $key\_column   = 'option\_id'; |
  |  | 138 | $value\_column = 'option\_value'; |
  |  | 139 |  |
  |  | 140 | $query = "SELECT \* |
  |  | 141 | FROM {$table} |
  |  | 142 | WHERE {$column} = '%s'  "; |
  |  | 143 |  |
  |  | 144 | $query = $wpdb -> prepare($query, $key); |
  |  | 145 |  |
  |  | 146 | $results = $wpdb -> get\_results($query); |
  |  | 147 |  |
  |  | 148 | $batches = array(); |
  |  | 149 |  |
  |  | 150 | if (!empty($results)) { |
  |  | 151 | foreach ($results as $result) { |
  |  | 152 | $batch = new stdClass(); |
  |  | 153 | $batch -> key = $result -> {$column}; |
  |  | 154 |  |
  |  | 155 | if (empty($onlykeys)) { |
  |  | 156 | $data = maybe\_unserialize($result -> {$value\_column}); |
  |  | 157 |  |
  |  | 158 | if (empty($onlyerrors)) { |
  |  | 159 | $batch -> data = $data; |
  |  | 160 | } else { |
  |  | 161 | foreach ($data as $dkey => $dval) { |
  |  | 162 | if (empty($dval['error'])) { |
  |  | 163 | unset($data[$dkey]); |
  |  | 164 | } |
  |  | 165 | } |
  |  | 166 |  |
  |  | 167 | $batch -> data = $data; |
  |  | 168 | } |
  |  | 169 |  |
  |  | 170 | if (!empty($batch -> data)) { |
  |  | 171 | $batches[] = $batch; |
  |  | 172 | } |
  |  | 173 | } else { |
  |  | 174 | $batches[] = $batch; |
  |  | 175 | } |
  |  | 176 |  |
  |  | 177 | if ($this -> memory\_exceeded()) { |
  |  | 178 | $this -> memory\_exceeded = true; |
  |  | 179 | return $batches; |
  |  | 180 | } |
  |  | 181 | } |
  |  | 182 | } |
  |  | 183 |  |
  |  | 184 | return $batches; |
  |  | 185 | } |
  |  | 186 |  |
  |  | 187 |  |
  |  | 188 | function get\_queued\_count($key = null) { |
  | 133 | 189 | global $wpdb, $wpMail; |
  | 134 | 190 |  |
  | […](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process.php?rev=2933075#L277) | […](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process.php?rev=3175816#L333) |  |
  | 277 | 333 | if (!empty($schedules[$scheduleinterval])) { |
  | 278 | 334 | $schedules[$this -> identifier . '\_cron\_interval'] = $schedules[$scheduleinterval]; |
  | 279 |  | } else { |
  | 280 |  | // Adds every 2 minutes to the existing schedules. |
  | 281 |  | $schedules[$this -> identifier . '\_cron\_interval'] = array( |
  | 282 |  | 'interval' => MINUTE\_IN\_SECONDS \* $interval, |
  | 283 |  | 'display'  => sprintf( \_\_( 'Every %d Minutes' ), $interval ), |
  | 284 |  | ); |
  | 285 |  | } |
  |  | 335 | } else { |
  |  | 336 | $seconds = $this->translate\_scheule\_interval($scheduleinterval); |
  |  | 337 | // Adds every 2 minutes to the existing schedules. |
  |  | 338 | $schedules[$this -> identifier . '\_cron\_interval'] = $seconds; |
  |  | 339 |  |
  |  | 340 | } |
  | 286 | 341 |  |
  | 287 | 342 | return $schedules; |
* ## [newsletters-lite/trunk/vendors/processing/wp-queue-process\_2.php](/changeset/3175816/newsletters-lite/trunk/vendors/processing/wp-queue-process_2.php "Show the changeset 3175816 restricted to newsletters-lite/trunk/vendors/processing/wp-queue-process_2.php")

  | [r2931916](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process_2.php?rev=2931916#L67 "Show revision 2931916 of this file in browser") | [r3175816](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process_2.php?rev=3175816#L67 "Show revision 3175816 of this file in browser") |  |
  | --- | --- | --- |
  | 67 | 67 | return false; |
  | 68 | 68 | } |
  | 69 |  |  |
  | 70 |  | ~~function get\_batches($onlykeys = false, $onlyerrors = false, $number = false~~) { |
  |  | 69 |  |
  |  | 70 | function get\_batches($onlykeys = false, $onlyerrors = false, $number = false, $key = null) { |
  | 71 | 71 | global $wpdb; |
  | 72 | 72 |  |
  | […](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process_2.php?rev=2931916#L276) | […](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process_2.php?rev=3175816#L276) |  |
  | 276 | 276 | $schedules[$this -> identifier . '\_cron\_interval'] = $schedules[$scheduleinterval]; |
  | 277 | 277 | } else { |
  | 278 |  | // Adds every 2 minutes to the existing schedules. |
  | 279 |  | $schedules[$this -> identifier . '\_cron\_interval'] = array( |
  | 280 |  | 'interval' => MINUTE\_IN\_SECONDS \* $interval, |
  | 281 |  | 'display'  => sprintf( \_\_( 'Every %d Minutes' ), $interval ), |
  | 282 |  | ); |
  | 283 |  | } |
  |  | 278 | $seconds = $this->translate\_scheule\_interval($scheduleinterval); |
  |  | 279 |  |
  |  | 280 | // Adds every 2 minutes to the existing schedules. |
  |  | 281 | $schedules[$this -> identifier . '\_cron\_interval'] = $seconds; |
  |  | 282 | } |
  | 284 | 283 |  |
  | 285 | 284 | return $schedules; |
* ## [newsletters-lite/trunk/vendors/processing/wp-queue-process\_3.php](/changeset/3175816/newsletters-lite/trunk/vendors/processing/wp-queue-process_3.php "Show the changeset 3175816 restricted to newsletters-lite/trunk/vendors/processing/wp-queue-process_3.php")

  | [r2931916](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process_3.php?rev=2931916#L67 "Show revision 2931916 of this file in browser") | [r3175816](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process_3.php?rev=3175816#L67 "Show revision 3175816 of this file in browser") |  |
  | --- | --- | --- |
  | 67 | 67 | return false; |
  | 68 | 68 | } |
  | 69 |  |  |
  | 70 |  | ~~function get\_batches($onlykeys = false, $onlyerrors = false, $number = false~~) { |
  |  | 69 |  |
  |  | 70 | function get\_batches($onlykeys = false, $onlyerrors = false, $number = false, $key = null) { |
  | 71 | 71 | global $wpdb; |
  | 72 | 72 |  |
  | […](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process_3.php?rev=2931916#L275) | […](/browser/newsletters-lite/trunk/vendors/processing/wp-queue-process_3.php?rev=3175816#L275) |  |
  | 275 | 275 | if (!empty($schedules[$scheduleinterval])) { |
  | 276 | 276 | $schedules[$this -> identifier . '\_cron\_interval'] = $schedules[$scheduleinterval]; |
  | 277 |  | } else { |
  | 278 |  | // Adds every 2 minutes to the existing schedules. |
  | 279 |  | $schedules[$this -> identifier . '\_cron\_interval'] = array( |
  | 280 |  | 'interval' => MINUTE\_IN\_SECONDS \* $interval, |
  | 281 |  | 'display'  => sprintf( \_\_( 'Every %d Minutes' ), $interval ), |
  | 282 |  | ); |
  | 283 |  | } |
  |  | 277 | } else { |
  |  | 278 | $seconds = $this->translate\_scheule\_interval($scheduleinterval); |
  |  | 279 |  |
  |  | 280 | // Adds every 2 minutes to the existing schedules. |
  |  | 281 | $schedules[$this -> identifier . '\_cron\_interval'] = $seconds; |
  |  | 282 | } |
  | 284 | 283 |  |
  | 285 | 284 | return $schedules; |
* ## [newsletters-lite/trunk/views/admin/head.php](/changeset/3175816/newsletters-lite/trunk/views/admin/head.php "Show the changeset 3175816 restricted to newsletters-lite/trunk/views/admin/head.php")

  | [r2773174](/browser/newsletters-lite/trunk/views/admin/head.php?rev=2773174#L131 "Show revision 2773174 of this file in browser") | [r3175816](/browser/newsletters-lite/trunk/views/admin/head.php?rev=3175816#L131 "Show revision 3175816 of this file in browser") |  |
  | --- | --- | --- |
  | 131 | 131 | <?php endif; ?> |
  | 132 | 132 | </script> |
  |  | 133 |  |
  |  | 134 |  |
  |  | 135 | <style id="classic-editor-safari-18-temp-fix"> |
  |  | 136 | \_::-webkit-full-page-media, \_:future, :root #post-body #postbox-container-2 { |
  |  | 137 | clear: left; |
  |  | 138 | } |
  |  | 139 | </style> |
* ## [newsletters-lite/trunk/views/admin/queues/index.php](/changeset/3175816/newsletters-lite/trunk/views/admin/queues/index.php "Show the changeset 3175816 restricted to newsletters-lite/trunk/views/admin/queues/index.php")

  | [r2931916](/browser/newsletters-lite/trunk/views/admin/queues/index.php?rev=2931916#L164 "Show revision 2931916 of this file in browser") | [r3175816](/browser/newsletters-lite/trunk/views/admin/queues/index.php?rev=3175816#L164 "Show revision 3175816 of this file in browser") |  |
  | --- | --- | --- |
  | 164 | 164 |  |
  | 165 | 165 | ?> |
  | 166 |  |  |
  | 167 |  | ~~<?php if ($batches = $this -> qp\_get\_batches(false, false, $batchnumber~~)) : ?> |
  | 168 |  | <br class="clear" /> |
  |  | 166 |  |
  |  | 167 | <?php if ($batches = $this -> qp\_get\_batches\_show(false, false, $batchnumber, $batches[$batchnumber-1]->key)) : ?> |
  |  | 168 | <br class="clear" /> |
  | 169 | 169 | <h2><?php esc\_html\_e('Batches and Emails', 'wp-mailinglist'); ?></h2> |
  | 170 | 170 | <p> |
* ## [newsletters-lite/trunk/wp-mailinglist-plugin.php](/changeset/3175816/newsletters-lite/trunk/wp-mailinglist-plugin.php "Show the changeset 3175816 restricted to newsletters-lite/trunk/wp-mailinglist-plugin.php")

  | [r3162959](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3162959#L9 "Show revision 3162959 of this file in browser") | [r3175816](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816#L9 "Show revision 3175816 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | var $plugin\_base; |
  | 10 | 10 | var $pre = 'wpml'; |
  | 11 |  | var $version = '4.9.9.~~4~~'; |
  |  | 11 | var $version = '4.9.9.5'; |
  | 12 | 12 | var $dbversion = '1.2.3'; |
  | 13 | 13 | var $debugging = false;         //set to "true" to turn on debugging |
  | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3162959#L347) | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816#L347) |  |
  | 347 | 347 | } |
  | 348 | 348 | } |
  | 349 |  |  |
  | 350 |  | ~~function qp\_get\_batches($onlykeys = false, $onlyerrors = false, $number = false~~) { |
  |  | 349 |  |
  |  | 350 | function qp\_get\_batches($onlykeys = false, $onlyerrors = false, $number = false, $key = null) { |
  | 351 | 351 | $batches = array(); |
  | 352 | 352 | for ($q = 1; $q <= 3; $q++) { |
  | 353 |  | $newbatches = $this -> {'queue\_process\_' . $q} -> get\_batches($onlykeys, $onlyerrors, $number); |
  |  | 353 | $newbatches = $this -> {'queue\_process\_' . $q} -> get\_batches($onlykeys, $onlyerrors, $number, $key); |
  | 354 | 354 | $batches = array\_merge($batches, $newbatches); |
  | 355 | 355 | } |
  | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3162959#L357) | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816#L357) |  |
  | 357 | 357 | return $batches; |
  | 358 | 358 | } |
  | 359 |  |  |
  | 360 |  | function qp\_scheduling() { |
  |  | 359 |  |
  |  | 360 | function qp\_get\_batches\_show($onlykeys = false, $onlyerrors = false, $number = false, $key = null) { |
  |  | 361 | $batches = array(); |
  |  | 362 |  |
  |  | 363 | $newbatches = $this -> {'queue\_process\_1'} -> get\_batches\_show($onlykeys, $onlyerrors, $number, $key); |
  |  | 364 | $batches = array\_merge($batches, $newbatches); |
  |  | 365 |  |
  |  | 366 | return $batches; |
  |  | 367 | } |
  |  | 368 |  |
  |  | 369 |  |
  |  | 370 | function qp\_scheduling() { |
  | 361 | 371 | for ($q = 1; $q <= 3; $q++) { |
  | 362 | 372 | $this -> {'queue\_process\_' . $q} -> scheduling(); |
  | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3162959#L1334) | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816#L1344) |  |
  | 1334 | 1344 |  |
  | 1335 | 1345 | // Clicks |
  | 1336 |  | $query = "SELECT COUNT(~~`id`~~) as `clickscount`, DATE(`created`) as `date` FROM `" . $wpdb -> prefix . $this -> Click() -> table . "` WHERE" . $history\_condition . " CAST(`created` AS DATE) BETWEEN '" . $fromdate . "' AND '" . $todate . "' GROUP BY DATE(`created`)"; |
  |  | 1346 | $query = "SELECT COUNT(DISTINCT CASE WHEN user\_id != 0 THEN user\_id ELSE subscriber\_id END) as `clickscount`, DATE(`created`) as `date` FROM `" . $wpdb -> prefix . $this -> Click() -> table . "` WHERE" . $history\_condition . " CAST(`created` AS DATE) BETWEEN '" . $fromdate . "' AND '" . $todate . "' GROUP BY DATE(`created`)"; |
  | 1337 | 1347 | $records = $wpdb -> get\_results($query); |
  | 1338 | 1348 |  |
  | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3162959#L1495) | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816#L1505) |  |
  | 1495 | 1505 |  |
  | 1496 | 1506 | // Clicks |
  | 1497 |  | $query = "SELECT COUNT(~~`id`~~) as `clickscount`, DATE(`created`) as `date` FROM `" . $wpdb -> prefix . $this -> Click() -> table . "` WHERE" . $history\_condition . " CAST(`created` AS DATE) BETWEEN '" . $fromdate . "' AND '" . $todate . "' GROUP BY DATE(`created`)"; |
  |  | 1507 | $query = "SELECT COUNT(DISTINCT CASE WHEN user\_id != 0 THEN user\_id ELSE subscriber\_id END) as `clickscount`, DATE(`created`) as `date` FROM `" . $wpdb -> prefix . $this -> Click() -> table . "` WHERE" . $history\_condition . " CAST(`created` AS DATE) BETWEEN '" . $fromdate . "' AND '" . $todate . "' GROUP BY DATE(`created`)"; |
  | 1498 | 1508 | $records = $wpdb -> get\_results($query); |
  | 1499 | 1509 |  |
  | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3162959#L1660) | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816#L1670) |  |
  | 1660 | 1670 |  |
  | 1661 | 1671 | // Clicks |
  | 1662 |  | $query = "SELECT COUNT(~~`id`~~) as `clickscount`, DATE(`created`) as `date` FROM `" . $wpdb -> prefix . $this -> Click() -> table . "` WHERE " . $clicks\_condition . " " . $history\_condition . " CAST(`created` AS DATE) BETWEEN '" . $fromdate . "' AND '" . $todate . "' GROUP BY DATE(`created`)"; |
  |  | 1672 | $query = "SELECT COUNT(DISTINCT CASE WHEN user\_id != 0 THEN user\_id ELSE subscriber\_id END) as `clickscount`, DATE(`created`) as `date` FROM `" . $wpdb -> prefix . $this -> Click() -> table . "` WHERE " . $clicks\_condition . " " . $history\_condition . " CAST(`created` AS DATE) BETWEEN '" . $fromdate . "' AND '" . $todate . "' GROUP BY DATE(`created`)"; |
  | 1663 | 1673 | $records = $wpdb -> get\_results($query); |
  | 1664 | 1674 |  |
  | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3162959#L9366) | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816#L9376) |  |
  | 9366 | 9376 |  |
  | 9367 | 9377 | $namesplit = explode("|", $atts['name']); |
  | 9368 |  | // error\_log('hahaha'); |
  | 9369 |  | // error\_log(json\_encode($namesplit)); |
  |  | 9378 |  |
  | 9370 | 9379 | //if(is\_array()) |
  | 9371 | 9380 |  |
  | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3162959#L12943) | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816#L12952) |  |
  | 12943 | 12952 | $message = $this -> language\_use($language, $template, false); |
  | 12944 | 12953 | } else { |
  | 12945 |  | $message = ~~esc\_html($template)~~; |
  |  | 12954 | $message = $template; |
  | 12946 | 12955 | } |
  | 12947 | 12956 | break; |
  | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3162959#L12950) | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816#L12959) |  |
  | 12950 | 12959 | $message = wpautop($this -> language\_use($language, $template, false)); |
  | 12951 | 12960 | } else { |
  | 12952 |  | $message = wpautop(~~esc\_html($template)~~); |
  |  | 12961 | $message = wpautop($template); |
  | 12953 | 12962 | } |
  | 12954 | 12963 |  |
  | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3162959#L13404) | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816#L13413) |  |
  | 13404 | 13413 | $body = str\_replace("$", "&#36;", $body); |
  | 13405 | 13414 | $body = preg\_replace('/\$(\d)/', '\\\$$1', $body); |
  | 13406 |  |  |
  | 13407 | 13415 | $themeintextversion = $this -> get\_option('themeintextversion'); |
  | 13408 | 13416 | if (empty($themeintextversion)) { |
  | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3162959#L13458) | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816#L13466) |  |
  | 13458 | 13466 | $body = do\_shortcode(wp\_unslash($head)) . wp\_unslash($body) . do\_shortcode(wp\_unslash($foot)); |
  | 13459 | 13467 | } |
  | 13460 |  |  |
  | 13461 | 13468 | // Parse the content areas |
  | 13462 | 13469 | $pattern = "/\[(\[?)(newsletters\_content)(?![\w-])([^\]\/]\*(?:\/(?!\])[^\]\/]\*)\*?)(?:(\/)\]|\](?:([^\[]\*+(?:\[(?!\/\2\])[^\[]\*+)\*+)\[\/\2\])?)(\]?)/s"; |
  | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3162959#L13471) | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816#L13478) |  |
  | 13471 | 13478 | // Convert Relative urls to Absolute |
  | 13472 | 13479 | $body = $this -> convert\_relative\_urls\_to\_absolute($body); |
  | 13473 |  |  |
  | 13474 | 13480 | /\*$preheader = 'This is my custom preheader text that will show up in the auto preview on the email client to capture the attention of the reader reading the email.'; |
  | 13475 | 13481 |  |
  | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3162959#L13547) | […](/browser/newsletters-lite/trunk/wp-mailinglist-plugin.php?rev=3175816#L13553) |  |
  | 13547 | 13553 | $absolute\_url = WP\_Http::make\_absolute\_url($href, $base\_url); |
  | 13548 | 13554 | $a->setAttribute('href', $absolute\_url); |
  | 13549 |  | ~~error\_log('test . ' . $absolute\_url);~~ |
  | 13550 | 13555 | } |
  | 13551 | 13556 | } |
* ## [newsletters-lite/trunk/wp-mailinglist.php](/changeset/3175816/newsletters-lite/trunk/wp-mailinglist.php "Show the changeset 3175816 restricted to newsletters-lite/trunk/wp-mailinglist.php")

  | [r3162959](/browser/newsletters-lite/trunk/wp-mailinglist.php?rev=3162959#L4 "Show revision 3162959 of this file in browser") | [r3175816](/browser/newsletters-lite/trunk/wp-mailinglist.php?rev=3175816#L4 "Show revision 3175816 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Plugin Name: Newsletters |
  | 5 | 5 | Plugin URI: https://tribulant.com/plugins/view/1/ |
  | 6 |  | Version: 4.9.9.~~4~~ |
  |  | 6 | Version: 4.9.9.5 |
  | 7 | 7 | Description: This newsletter software by Tribulant allows users to subscribe to multiple mailing lists on your WordPress website. Send newsletters manually or from posts, manage newsletter templates, view a complete history with tracking, import/export subscribers, accept paid subscriptions and much more. Remove limits by buying PRO. Once purchased, to avoid future issues, remove this version and install and use the paid version in its stead. No data will be lost. |
  | 8 | 8 | Author: Tribulant |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3175816)
* [Zip Archive](?format=zip&new=3175816)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

