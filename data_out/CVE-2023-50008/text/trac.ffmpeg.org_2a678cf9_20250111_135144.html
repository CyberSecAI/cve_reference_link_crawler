

[![FFmpeg](/ffmpeg-logo.png)](https://ffmpeg.org)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/report)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ![Up-vote](/chrome/vote/aupgray.png)+0![Down-vote](/chrome/vote/adowngray.png)
* ← [Previous Ticket](/ticket/10700 "Ticket #10700")
* [Next Ticket](/ticket/10702 "Ticket #10702") →

---

Opened [14 months ago](/timeline?from=2023-11-27T01%3A01%3A18Z&precision=second "See timeline at Nov 27, 2023, 1:01:18 AM")

Closed [14 months ago](/timeline?from=2023-11-27T11%3A03%3A55Z&precision=second "See timeline at Nov 27, 2023, 11:03:55 AM")

## [#10701](/ticket/10701) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# memory leaks at ffmpeg6-1/libavutil/mem.c:105:9 in av\_malloc in FFmpeg

| Reported by: | [ZengYunxiang](/query?reporter=frankZ&status=!closed) | Owned by: |  |
| --- | --- | --- | --- |
| Priority: | [normal](/query?priority=normal&status=!closed) | Component: | [avutil](/query?component=avutil&status=!closed) |
| Version: | [git-master](/query?status=!closed&version=git-master) | Keywords: | [bugs](/query?keywords=~bugs&status=!closed) |
| Cc: | [ZengYunxiang](/query?cc=~frankZ&status=!closed) | Blocked By: |  |
| Blocking: |  | Reproduced by developer: | [no](/query?reproduced=0&status=!closed) |
| Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |  |  |

## Description

Summary of the bug:

Dear developers,

I found the following memory leaks on FFmpeg6.1 when using colorcorrect filter, please confirm.

The poc file(poc8ffmpeg) will be attached to this ticket.

How to reproduce:

```
git clone https://github.com/FFmpeg/FFmpeg.git ffmpeg6-1
cd ffmpeg6-1
git checkout 466799d
./configure --cc=clang --cxx=clang++ --ld=clang --enable-debug --toolchain=clang-asan
make -j30

./ffmpeg_g -y -i poc8ffmpeg -filter_complex colorcorrect tmp.mp4

```

ASAN Log:

```
=================================================================
==1141095==ERROR: LeakSanitizer: detected memory leaks

Direct leak of 1024 byte(s) in 1 object(s) allocated from:
    #0 0x560cd4de6ab7 in __interceptor_posix_memalign (/afltest/ffmpeg6-1/ffmpeg_g+0x925ab7) (BuildId: 235e8d23658b9f137a6f44e3f2d1bddad7c9bf95)
    #1 0x560cd841f753 in av_malloc /afltest/ffmpeg6-1/libavutil/mem.c:105:9
    #2 0x560cd841f753 in av_mallocz /afltest/ffmpeg6-1/libavutil/mem.c:256:17
    #3 0x560cd841f753 in av_calloc /afltest/ffmpeg6-1/libavutil/mem.c:267:12
    #4 0x560cd4bde02f in config_input /afltest/ffmpeg6-1/libavfilter/vf_colorcorrect.c:461:21

Direct leak of 1024 byte(s) in 1 object(s) allocated from:
    #0 0x560cd4de6ab7 in __interceptor_posix_memalign (/afltest/ffmpeg6-1/ffmpeg_g+0x925ab7) (BuildId: 235e8d23658b9f137a6f44e3f2d1bddad7c9bf95)
    #1 0x560cd841f753 in av_malloc /afltest/ffmpeg6-1/libavutil/mem.c:105:9
    #2 0x560cd841f753 in av_mallocz /afltest/ffmpeg6-1/libavutil/mem.c:256:17
    #3 0x560cd841f753 in av_calloc /afltest/ffmpeg6-1/libavutil/mem.c:267:12
    #4 0x560cd4bddfc9 in config_input /afltest/ffmpeg6-1/libavfilter/vf_colorcorrect.c:457:21

SUMMARY: AddressSanitizer: 2048 byte(s) leaked in 2 allocation(s).

```

ffmpeg version:

```
# ./ffmpeg -version
ffmpeg version n6.1-3-g466799d4f5 Copyright (c) 2000-2023 the FFmpeg developers
built with clang version 9.0.0 (https://github.com/llvm-mirror/llvm c62b24f070c9a4bb1a76409e623042a740cac4cd)
configuration: --cc=clang --cxx=clang++ --ld=clang --enable-debug --toolchain=clang-asan
libavutil      58. 29.100 / 58. 29.100
libavcodec     60. 31.102 / 60. 31.102
libavformat    60. 16.100 / 60. 16.100
libavdevice    60.  3.100 / 60.  3.100
libavfilter     9. 12.100 /  9. 12.100
libswscale      7.  5.100 /  7.  5.100
libswresample   4. 12.100 /  4. 12.100

```

Credit:

```
Zeng Yunxiang
Song Jiaxuan

```

Thanks for your time!

### Attachments (1)

[poc8ffmpeg](/attachment/ticket/10701/poc8ffmpeg "View attachment")[​](/raw-attachment/ticket/10701/poc8ffmpeg "Download")
(13.4 KB
) - added by ZengYunxiang [14 months ago](/timeline?from=2023-11-27T01%3A10%3A38Z&precision=second "See timeline at Nov 27, 2023, 1:10:38 AM").
POC file

Download all attachments as:
[.zip](/zip-attachment/ticket/10701/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (2)

### by ZengYunxiang, [14 months ago](/timeline?from=2023-11-27T01%3A10%3A38Z&precision=second "See timeline at Nov 27, 2023, 1:10:38 AM")

| Attachment: | [*poc8ffmpeg*](/attachment/ticket/10701/poc8ffmpeg)[​](/raw-attachment/ticket/10701/poc8ffmpeg "Download") added |
| --- | --- |

POC file

### [comment:1](#comment:1) by Elon Musk, [14 months ago](/timeline?from=2023-11-27T11%3A03%3A55Z&precision=second "See timeline at Nov 27, 2023, 11:03:55 AM")

| Resolution: | → fixed |
| --- | --- |
| Status: | new → closed |

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/10701?format=rss)
* [Comma-delimited Text](/ticket/10701?format=csv)
* [Tab-delimited Text](/ticket/10701?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>

