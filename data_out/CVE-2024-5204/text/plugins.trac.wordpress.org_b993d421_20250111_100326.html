

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3091913%2Fswiss-toolkit-for-wp)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3077000/swiss-toolkit-for-wp "Changeset 3077000 for swiss-toolkit-for-wp")
* [Next Change](/changeset/3092431/swiss-toolkit-for-wp "Changeset 3092431 for swiss-toolkit-for-wp") →

---

# Changeset [3091913](/changeset/3091913 "Show full changeset") for [swiss-toolkit-for-wp](/browser/swiss-toolkit-for-wp?rev=3091913 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
05/24/2024 07:05:25 AM
([8 months](/timeline?from=2024-05-24T07%3A05%3A25Z&precision=second "See timeline at 05/24/2024 07:05:25 AM") ago)

Author:
boomdevs
Message:

Fixed a vulnerability and security issue related to unauthorized access.

Location:
[swiss-toolkit-for-wp/trunk](/browser/swiss-toolkit-for-wp/trunk?rev=3091913)
Files:

6 edited

* [README.txt](/browser/swiss-toolkit-for-wp/trunk/README.txt?rev=3091913 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))
* [boomdevs-swiss-toolkit.php](/browser/swiss-toolkit-for-wp/trunk/boomdevs-swiss-toolkit.php?rev=3091913 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [changelog.txt](/browser/swiss-toolkit-for-wp/trunk/changelog.txt?rev=3091913 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [generate-url/class-boomdevs-swiss-toolkit-generate-url.php](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3091913 "Show entry in browser")
  (modified)
  ([9 diffs](#file3 "Show differences"))
* [includes/class-boomdevs-swiss-toolkit.php](/browser/swiss-toolkit-for-wp/trunk/includes/class-boomdevs-swiss-toolkit.php?rev=3091913 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [includes/plugins/class-boomdevs-swiss-toolkit-generate-login-url.php](/browser/swiss-toolkit-for-wp/trunk/includes/plugins/class-boomdevs-swiss-toolkit-generate-login-url.php?rev=3091913 "Show entry in browser")
  (modified)
  ([4 diffs](#file5 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [swiss-toolkit-for-wp/trunk/README.txt](/changeset/3091913/swiss-toolkit-for-wp/trunk/README.txt "Show the changeset 3091913 restricted to swiss-toolkit-for-wp/trunk/README.txt")

  | [r3077000](/browser/swiss-toolkit-for-wp/trunk/README.txt?rev=3077000#L5 "Show revision 3077000 of this file in browser") | [r3091913](/browser/swiss-toolkit-for-wp/trunk/README.txt?rev=3091913#L5 "Show revision 3091913 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires at least: 5.2 |
  | 6 | 6 | Tested up to: 6.5.2 |
  | 7 |  | Stable tag: 1.0.~~7~~ |
  |  | 7 | Stable tag: 1.0.8 |
  | 8 | 8 | Requires PHP: 7.4 |
  | 9 | 9 | License: GPLv2 or later |
  | […](/browser/swiss-toolkit-for-wp/trunk/README.txt?rev=3077000#L141) | […](/browser/swiss-toolkit-for-wp/trunk/README.txt?rev=3091913#L141) |  |
  | 141 | 141 | == Changelog == |
  | 142 | 142 |  |
  |  | 143 | = 1.0.8 = |
  |  | 144 | Fixed a vulnerability and security issue related to unauthorized access. |
  |  | 145 |  |
  |  | 146 |  |
  | 143 | 147 | = 1.0.7 = |
  | 144 | 148 | New: WP Admin Login URL Changer |
* ## [swiss-toolkit-for-wp/trunk/boomdevs-swiss-toolkit.php](/changeset/3091913/swiss-toolkit-for-wp/trunk/boomdevs-swiss-toolkit.php "Show the changeset 3091913 restricted to swiss-toolkit-for-wp/trunk/boomdevs-swiss-toolkit.php")

  | [r3077000](/browser/swiss-toolkit-for-wp/trunk/boomdevs-swiss-toolkit.php?rev=3077000#L17 "Show revision 3077000 of this file in browser") | [r3091913](/browser/swiss-toolkit-for-wp/trunk/boomdevs-swiss-toolkit.php?rev=3091913#L17 "Show revision 3091913 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \* Plugin URI:        https://boomdevs.com |
  | 18 | 18 | \* Description:       Say Goodbye to Plugin Overload - WP Swiss Toolkit Has It All |
  | 19 |  | \* Version:           1.0.~~7~~ |
  |  | 19 | \* Version:           1.0.8 |
  | 20 | 20 | \* Requires at least: 5.2 |
  | 21 | 21 | \* Requires PHP:      7.4 |
  | […](/browser/swiss-toolkit-for-wp/trunk/boomdevs-swiss-toolkit.php?rev=3077000#L38) | […](/browser/swiss-toolkit-for-wp/trunk/boomdevs-swiss-toolkit.php?rev=3091913#L38) |  |
  | 38 | 38 | \* Rename this for your plugin and update it as you release new versions. |
  | 39 | 39 | \*/ |
  | 40 |  | define('BDSTFW\_SWISS\_TOOLKIT\_VERSION', '1.0.~~6~~'); |
  |  | 40 | define('BDSTFW\_SWISS\_TOOLKIT\_VERSION', '1.0.8'); |
  | 41 | 41 | define('BDSTFW\_SWISS\_TOOLKIT\_PATH', plugin\_dir\_path(\_\_FILE\_\_)); |
  | 42 | 42 | define('BDSTFW\_SWISS\_TOOLKIT\_URL', plugin\_dir\_url(\_\_FILE\_\_)); |
* ## [swiss-toolkit-for-wp/trunk/changelog.txt](/changeset/3091913/swiss-toolkit-for-wp/trunk/changelog.txt "Show the changeset 3091913 restricted to swiss-toolkit-for-wp/trunk/changelog.txt")

  | [r3077000](/browser/swiss-toolkit-for-wp/trunk/changelog.txt?rev=3077000#L1 "Show revision 3077000 of this file in browser") | [r3091913](/browser/swiss-toolkit-for-wp/trunk/changelog.txt?rev=3091913#L1 "Show revision 3091913 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | == Changelog == |
  |  | 2 |  |
  |  | 3 | = 1.0.8 = |
  |  | 4 | Fixed a vulnerability and security issue related to unauthorized access. |
  | 2 | 5 |  |
  | 3 | 6 | = 1.0.7 = |
* ## [swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php](/changeset/3091913/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php "Show the changeset 3091913 restricted to swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php")

  | [r3048449](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3048449#L143 "Show revision 3048449 of this file in browser") | [r3091913](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3091913#L143 "Show revision 3091913 of this file in browser") |  |
  | --- | --- | --- |
  | 143 | 143 | { |
  | 144 | 144 | if ($column === 'generate\_url') { |
  | 145 |  | $custom\_data = get\_post\_meta(intval($post\_id), 'bdstfw\_encrypted\_token', true); |
  |  | 145 | $custom\_data = get\_post\_meta(intval($post\_id), '\_bdstfw\_encrypted\_token', true); |
  | 146 | 146 | if (!empty($custom\_data)) { |
  | 147 | 147 | $login\_url = home\_url('?sk=') . $custom\_data; |
  | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3048449#L153) | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3091913#L153) |  |
  | 153 | 153 | } |
  | 154 | 154 | } elseif ($column === 'status' || $column === 'expire') { |
  | 155 |  | $expiration\_time = get\_post\_meta(intval($post\_id), 'bdstfw\_swiss\_expiration\_time', true); |
  | 156 |  | $usage\_count = get\_post\_meta(intval($post\_id), 'bdstfw\_swiss\_usage\_count', true); |
  |  | 155 | $expiration\_time = get\_post\_meta(intval($post\_id), '\_bdstfw\_swiss\_expiration\_time', true); |
  |  | 156 | $usage\_count = get\_post\_meta(intval($post\_id), '\_bdstfw\_swiss\_usage\_count', true); |
  | 157 | 157 | $expiration\_limit = get\_post\_meta(intval($post\_id), 'bdstfw\_swiss\_usage\_limitation', true); |
  | 158 | 158 |  |
  | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3048449#L194) | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3091913#L194) |  |
  | 194 | 194 | { |
  | 195 | 195 | if (isset($\_GET['post'])) { |
  | 196 |  | $token = home\_url() . '?sk=' . get\_post\_meta(intval($\_GET['post']), 'bdstfw\_encrypted\_token', true); |
  |  | 196 | $token = home\_url() . '?sk=' . get\_post\_meta(intval($\_GET['post']), '\_bdstfw\_encrypted\_token', true); |
  | 197 | 197 |  |
  | 198 | 198 | Redux\_Metaboxes::set\_box( |
  | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3048449#L254) | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3091913#L254) |  |
  | 254 | 254 | ), |
  | 255 | 255 | array( |
  | 256 |  | 'id' => 'swiss\_usage\_limitation', |
  |  | 256 | 'id' => '\_swiss\_usage\_limitation', |
  | 257 | 257 | 'type' => 'select', |
  | 258 | 258 | 'title' => esc\_html\_\_('Usage Limitation', 'swiss-toolkit-for-wp'), |
  | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3048449#L266) | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3091913#L266) |  |
  | 266 | 266 | ), |
  | 267 | 267 | array( |
  | 268 |  | 'id' => 'swiss\_usage\_custom\_limitation', |
  |  | 268 | 'id' => '\_swiss\_usage\_custom\_limitation', |
  | 269 | 269 | 'type' => 'text', |
  | 270 | 270 | 'min' => 1, |
  | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3048449#L272) | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3091913#L272) |  |
  | 272 | 272 | 'placeholder' => esc\_html\_\_('Select Limitation Date', 'swiss-toolkit-for-wp'), |
  | 273 | 273 | 'validate' => array( 'numeric' ), |
  | 274 |  | 'required' => array('swiss\_usage\_limitation', 'equals', 'custom') |
  |  | 274 | 'required' => array('\_swiss\_usage\_limitation', 'equals', 'custom') |
  | 275 | 275 | ), |
  | 276 | 276 | ); |
  | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3048449#L423) | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3091913#L423) |  |
  | 423 | 423 | public function save\_swiss\_generate\_url\_post($post\_id) |
  | 424 | 424 | { |
  |  | 425 |  |
  |  | 426 | // Capability check |
  |  | 427 | if (!current\_user\_can('edit\_posts')) { |
  |  | 428 | return; |
  |  | 429 | } |
  |  | 430 |  |
  | 425 | 431 | // Generate and save encrypted text |
  | 426 | 432 | $encrypted\_token = $this->generate\_encrypted\_token($post\_id); |
  | 427 |  | if (!get\_post\_meta(intval($post\_id), 'bdstfw\_encrypted\_token', true)) { |
  | 428 |  | update\_post\_meta(intval($post\_id), 'bdstfw\_encrypted\_token', $encrypted\_token); |
  |  | 433 | if (!get\_post\_meta(intval($post\_id), '\_bdstfw\_encrypted\_token', true)) { |
  |  | 434 | update\_post\_meta(intval($post\_id), '\_bdstfw\_encrypted\_token', $encrypted\_token); |
  | 429 | 435 | } |
  | 430 | 436 |  |
  | 431 | 437 | // Update user ID |
  | 432 |  | update\_post\_meta(intval($post\_id), 'bdstfw\_current\_login\_userId', get\_current\_user\_id()); |
  |  | 438 | update\_post\_meta(intval($post\_id), '\_bdstfw\_current\_login\_userId', get\_current\_user\_id()); |
  | 433 | 439 |  |
  | 434 | 440 | // Handle expiration date |
  | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3048449#L445) | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3091913#L451) |  |
  | 445 | 451 |  |
  | 446 | 452 | // Handle expiration limit |
  | 447 |  | $expiration\_limitation = isset($\_POST['swiss-toolkit-for-wp']['~~swiss\_usage\_limitation']) ? sanitize\_text\_field($\_POST['swiss-toolkit-for-wp']['~~swiss\_usage\_limitation']) : ''; |
  |  | 453 | $expiration\_limitation = isset($\_POST['swiss-toolkit-for-wp']['\_swiss\_usage\_limitation']) ? sanitize\_text\_field($\_POST['swiss-toolkit-for-wp']['\_swiss\_usage\_limitation']) : ''; |
  | 448 | 454 | $pro\_global\_settings = apply\_filters('wp\_swiss\_toolkit\_generate\_login\_url\_premium\_settings', []); |
  | 449 | 455 |  |
  | 450 | 456 | if (!$pro\_global\_settings) { |
  | 451 | 457 | $expiration\_time = strtotime('+1 days'); |
  | 452 |  | update\_post\_meta(intval($post\_id), 'bdstfw\_swiss\_expiration\_time', $expiration\_time); |
  |  | 458 | update\_post\_meta(intval($post\_id), '\_bdstfw\_swiss\_expiration\_time', $expiration\_time); |
  | 453 | 459 | update\_post\_meta(intval($post\_id), 'bdstfw\_swiss\_usage\_limitation', 3); |
  | 454 | 460 | } else { |
  | 455 |  | update\_post\_meta(intval($post\_id), 'bdstfw\_swiss\_expiration\_time', $expiration\_time); |
  |  | 461 | update\_post\_meta(intval($post\_id), '\_bdstfw\_swiss\_expiration\_time', $expiration\_time); |
  | 456 | 462 |  |
  | 457 | 463 | if ($expiration\_limitation === 'custom') { |
  | 458 |  | $custom\_expiration\_limit = isset($\_POST['swiss-toolkit-for-wp']['~~swiss\_usage\_custom\_limitation']) ? sanitize\_text\_field($\_POST['swiss-toolkit-for-wp']['~~swiss\_usage\_custom\_limitation']) : ''; |
  |  | 464 | $custom\_expiration\_limit = isset($\_POST['swiss-toolkit-for-wp']['\_swiss\_usage\_custom\_limitation']) ? sanitize\_text\_field($\_POST['swiss-toolkit-for-wp']['\_swiss\_usage\_custom\_limitation']) : ''; |
  | 459 | 465 | $expiration\_limit = $custom\_expiration\_limit; |
  | 460 | 466 | } elseif ($expiration\_limitation === 'unlimited') { |
  | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3048449#L468) | […](/browser/swiss-toolkit-for-wp/trunk/generate-url/class-boomdevs-swiss-toolkit-generate-url.php?rev=3091913#L474) |  |
  | 468 | 474 |  |
  | 469 | 475 | // Increase count |
  | 470 |  | $usage\_count = get\_post\_meta(intval($post\_id), 'bdstfw\_swiss\_usage\_count', true); |
  |  | 476 | $usage\_count = get\_post\_meta(intval($post\_id), '\_bdstfw\_swiss\_usage\_count', true); |
  | 471 | 477 | if ($usage\_count === '') { |
  | 472 | 478 | // If it doesn't exist, set it to 0 |
  | 473 | 479 | $usage\_count = 0; |
  | 474 |  | update\_post\_meta(intval($post\_id), 'bdstfw\_swiss\_usage\_count', $usage\_count); |
  |  | 480 | update\_post\_meta(intval($post\_id), '\_bdstfw\_swiss\_usage\_count', $usage\_count); |
  | 475 | 481 | } |
  | 476 | 482 |  |
* ## [swiss-toolkit-for-wp/trunk/includes/class-boomdevs-swiss-toolkit.php](/changeset/3091913/swiss-toolkit-for-wp/trunk/includes/class-boomdevs-swiss-toolkit.php "Show the changeset 3091913 restricted to swiss-toolkit-for-wp/trunk/includes/class-boomdevs-swiss-toolkit.php")

  | [r3077000](/browser/swiss-toolkit-for-wp/trunk/includes/class-boomdevs-swiss-toolkit.php?rev=3077000#L68 "Show revision 3077000 of this file in browser") | [r3091913](/browser/swiss-toolkit-for-wp/trunk/includes/class-boomdevs-swiss-toolkit.php?rev=3091913#L68 "Show revision 3091913 of this file in browser") |  |
  | --- | --- | --- |
  | 68 | 68 | $this->version = BDSTFW\_SWISS\_TOOLKIT\_VERSION; |
  | 69 | 69 | } else { |
  | 70 |  | $this->version = '1.0.~~7~~'; |
  |  | 70 | $this->version = '1.0.8'; |
  | 71 | 71 | } |
  | 72 | 72 | $this->plugin\_name = 'swiss-toolkit-for-wp'; |
* ## [swiss-toolkit-for-wp/trunk/includes/plugins/class-boomdevs-swiss-toolkit-generate-login-url.php](/changeset/3091913/swiss-toolkit-for-wp/trunk/includes/plugins/class-boomdevs-swiss-toolkit-generate-login-url.php "Show the changeset 3091913 restricted to swiss-toolkit-for-wp/trunk/includes/plugins/class-boomdevs-swiss-toolkit-generate-login-url.php")

  | [r3048449](/browser/swiss-toolkit-for-wp/trunk/includes/plugins/class-boomdevs-swiss-toolkit-generate-login-url.php?rev=3048449#L51 "Show revision 3048449 of this file in browser") | [r3091913](/browser/swiss-toolkit-for-wp/trunk/includes/plugins/class-boomdevs-swiss-toolkit-generate-login-url.php?rev=3091913#L51 "Show revision 3091913 of this file in browser") |  |
  | --- | --- | --- |
  | 51 | 51 | { |
  | 52 | 52 | if (isset($\_GET['sk'])) { |
  | 53 |  | $data = Translator::decode($\_GET['sk']); |
  |  | 53 |  |
  |  | 54 | // $data = Translator::decode($\_GET['sk']); |
  |  | 55 | // $post\_id = absint($data[0]); |
  |  | 56 |  |
  |  | 57 | // Sanitize input |
  |  | 58 | $sk = sanitize\_text\_field($\_GET['sk']); // Updated |
  |  | 59 |  |
  |  | 60 | $data = Translator::decode($sk); |
  | 54 | 61 | $post\_id = absint($data[0]); |
  | 55 | 62 |  |
  | 56 |  | if ($post\_id === '') { |
  |  | 63 |  |
  |  | 64 | // if ($post\_id === '') { |
  |  | 65 | //     include\_once(BDSTFW\_SWISS\_TOOLKIT\_PATH . '/template-part/generate-url-token-warning.php'); |
  |  | 66 | // } |
  |  | 67 |  |
  |  | 68 | if (empty($post\_id)) { // Updated |
  | 57 | 69 | include\_once(BDSTFW\_SWISS\_TOOLKIT\_PATH . '/template-part/generate-url-token-warning.php'); |
  |  | 70 | return; |
  | 58 | 71 | } |
  | 59 | 72 |  |
  | 60 |  | $swiss\_usage\_limitation = get\_post\_meta($post\_id, 'swiss\_usage\_limitation', true); |
  | 61 |  | $swiss\_usage\_custom\_limitation = get\_post\_meta($post\_id, 'swiss\_usage\_custom\_limitation', true); |
  | 62 |  | $usage\_count = get\_post\_meta($post\_id, 'bdstfw\_swiss\_usage\_count', true); |
  | 63 |  | $expiration\_time = get\_post\_meta($post\_id, 'bdstfw\_swiss\_expiration\_time', true); |
  |  | 73 | // Capability check |
  |  | 74 | if (!current\_user\_can('edit\_posts')) { // Updated |
  |  | 75 | wp\_die(\_\_('You do not have sufficient permissions to access this page.')); // Updated |
  |  | 76 | } |
  |  | 77 |  |
  |  | 78 | $swiss\_usage\_limitation = get\_post\_meta($post\_id, '\_swiss\_usage\_limitation', true); |
  |  | 79 | $swiss\_usage\_custom\_limitation = get\_post\_meta($post\_id, '\_swiss\_usage\_custom\_limitation', true); |
  |  | 80 | $usage\_count = get\_post\_meta($post\_id, '\_bdstfw\_swiss\_usage\_count', true); |
  |  | 81 | $expiration\_time = get\_post\_meta($post\_id, '\_bdstfw\_swiss\_expiration\_time', true); |
  | 64 | 82 |  |
  | 65 | 83 | if (!($data[2] === 'administrator')) { |
  | […](/browser/swiss-toolkit-for-wp/trunk/includes/plugins/class-boomdevs-swiss-toolkit-generate-login-url.php?rev=3048449#L74) | […](/browser/swiss-toolkit-for-wp/trunk/includes/plugins/class-boomdevs-swiss-toolkit-generate-login-url.php?rev=3091913#L92) |  |
  | 74 | 92 | } else { |
  | 75 | 93 | if ($expiration\_time && $expiration\_time > time()) { |
  | 76 |  | $storedToken = get\_post\_meta($post\_id, 'bdstfw\_encrypted\_token', true); |
  |  | 94 | $storedToken = get\_post\_meta($post\_id, '\_bdstfw\_encrypted\_token', true); |
  | 77 | 95 |  |
  | 78 |  | if ($\_GET['sk'] === $storedToken) { |
  | 79 |  | $user\_id = get\_post\_meta($post\_id, 'bdstfw\_current\_login\_userId', true); |
  | 80 |  | wp\_set\_auth\_cookie(intval($user\_id), 1, is\_ssl()); |
  |  | 96 | if (hash\_equals($sk, $storedToken)) { |
  |  | 97 | $user\_id = get\_post\_meta($post\_id, '\_bdstfw\_current\_login\_userId', true); |
  |  | 98 | // wp\_set\_auth\_cookie(intval($user\_id), 1, is\_ssl()); |
  |  | 99 | wp\_set\_auth\_cookie(intval($user\_id), true, is\_ssl()); |
  | 81 | 100 | include\_once(BDSTFW\_SWISS\_TOOLKIT\_PATH . '/template-part/generate-url-login-success.php'); |
  | 82 | 101 | echo '<script> |
  | […](/browser/swiss-toolkit-for-wp/trunk/includes/plugins/class-boomdevs-swiss-toolkit-generate-login-url.php?rev=3048449#L85) | […](/browser/swiss-toolkit-for-wp/trunk/includes/plugins/class-boomdevs-swiss-toolkit-generate-login-url.php?rev=3091913#L104) |  |
  | 85 | 104 | }, 1000); |
  | 86 | 105 | </script>'; |
  | 87 |  | $current\_value = get\_post\_meta($post\_id, 'bdstfw\_swiss\_usage\_count', true); |
  |  | 106 | $current\_value = get\_post\_meta($post\_id, '\_bdstfw\_swiss\_usage\_count', true); |
  | 88 | 107 | $new\_value = sanitize\_text\_field(intval($current\_value) + intval(1)); |
  | 89 |  | update\_post\_meta($post\_id, 'bdstfw\_swiss\_usage\_count', $new\_value); |
  |  | 108 | update\_post\_meta($post\_id, '\_bdstfw\_swiss\_usage\_count', $new\_value); |
  | 90 | 109 | exit(); |
  | 91 | 110 | } else { |
  | […](/browser/swiss-toolkit-for-wp/trunk/includes/plugins/class-boomdevs-swiss-toolkit-generate-login-url.php?rev=3048449#L98) | […](/browser/swiss-toolkit-for-wp/trunk/includes/plugins/class-boomdevs-swiss-toolkit-generate-login-url.php?rev=3091913#L117) |  |
  | 98 | 117 | } else { |
  | 99 | 118 | if ($expiration\_time && $expiration\_time > time()) { |
  | 100 |  | $storedToken = get\_post\_meta($post\_id, 'bdstfw\_encrypted\_token', true); |
  |  | 119 | $storedToken = get\_post\_meta($post\_id, '\_bdstfw\_encrypted\_token', true); |
  | 101 | 120 |  |
  | 102 |  | if ($\_GET['sk'] === $storedToken) { |
  | 103 |  | $user\_id = get\_post\_meta($post\_id, 'bdstfw\_current\_login\_userId', true); |
  | 104 |  | wp\_set\_auth\_cookie(intval($user\_id), 1, is\_ssl()); |
  |  | 121 | if (hash\_equals($sk, $storedToken)) { |
  |  | 122 | $user\_id = get\_post\_meta($post\_id, '\_bdstfw\_current\_login\_userId', true); |
  |  | 123 | // wp\_set\_auth\_cookie(intval($user\_id), 1, is\_ssl()); |
  |  | 124 | wp\_set\_auth\_cookie(intval($user\_id), true, is\_ssl()); |
  | 105 | 125 | include\_once(BDSTFW\_SWISS\_TOOLKIT\_PATH . '/template-part/generate-url-login-success.php'); |
  | 106 | 126 | echo '<script> |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3091913)
* [Zip Archive](?format=zip&new=3091913)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

