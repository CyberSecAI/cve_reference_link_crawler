

[![Foregenix](https://www.foregenix.com/hs-fs/hubfs/Images/Logos/logo-foregenix.png?width=808&height=191&name=logo-foregenix.png)](https://www.foregenix.com/blog "Foregenix")
##### Blog

* [Back to Foregenix.com](https://www.foregenix.com "Go Back")
* Categories
  + [##### Cybersecurity](https://www.foregenix.com/blog/topic/cybersecurity "Cybersecurity")
  + [##### Web Security](https://www.foregenix.com/blog/topic/web-security "Web Security")
  + [##### Website Security](https://www.foregenix.com/blog/topic/website-security "Website Security")
  + [##### Magento](https://www.foregenix.com/blog/topic/magento "Magento")
  + [##### PCI, PA-DSS and P2PE](https://www.foregenix.com/blog/topic/pci-pa-dss-and-p2pe "PCI, PA-DSS and P2PE")
  + [##### Forensics and Incident Response](https://www.foregenix.com/blog/topic/forensics-and-incident-response "Forensics and Incident Response")
  + [##### Malware](https://www.foregenix.com/blog/topic/malware "Malware")
  + [##### eCommerce](https://www.foregenix.com/blog/topic/ecommerce "eCommerce")
  + [##### Foregenix](https://www.foregenix.com/blog/topic/foregenix "Foregenix")
  + [##### Indicators of compromise](https://www.foregenix.com/blog/topic/indicators-of-compromise "Indicators of compromise")
  + [##### Penetration Testing](https://www.foregenix.com/blog/topic/penetration-testing "Penetration Testing")
  + [##### News](https://www.foregenix.com/blog/topic/news "News")
  + [##### Compliance](https://www.foregenix.com/blog/topic/compliance "Compliance")
  + [##### Hack](https://www.foregenix.com/blog/topic/hack "Hack")
  + [##### Vulnerability](https://www.foregenix.com/blog/topic/vulnerability "Vulnerability")
  + [##### GDPR](https://www.foregenix.com/blog/topic/gdpr "GDPR")
  + [##### Web Scan](https://www.foregenix.com/blog/topic/web-scan "Web Scan")
  + [##### DFIR](https://www.foregenix.com/blog/topic/dfir "DFIR")
  + [##### Encryption](https://www.foregenix.com/blog/topic/encryption "Encryption")
  + [##### Fraud](https://www.foregenix.com/blog/topic/fraud "Fraud")
* [Free Resources](https://www.foregenix.com/resources "Free Resources")
* SearchClose

SUBSCRIBE

[Back to articles](https://www.foregenix.com/blog "Back to articles")

# How Printer Passwords Led to Domain Compromise in Penetration Test

[Penetration Testing,](https://www.foregenix.com/blog/topic/penetration-testing "Penetration Testing") [Vulnerability,](https://www.foregenix.com/blog/topic/vulnerability "Vulnerability") [Cybersecurity](https://www.foregenix.com/blog/topic/cybersecurity "Cybersecurity")

###### 21 April, 2022

##### Giuliano Fasto

19 min read

SHARE

SUBSCRIBE

A few months ago, during an internal infrastructure penetration test, the network printers played a very important role in the assessment. What initially looked like a not-so-important low severity finding turned out to be the key to fully compromising the Windows domain the printers were attached to.

## The Hidden Dangers of Default Printer Passwords in Pentesting

To set the scene - once we performed the initial reconnaissance on the in-scope network, we identified a few network multifunction printers - the ones you typically expect to find in an office network. They may not be the most critical components, but in a typical Foregenix spirit of leaving no stone unturned, we set off to identify any vulnerabilities these devices may expose.

## **Access to the configuration portal**

As is usually the case, we identified that the management password was still the default on one of those printers, which gave us access to the web based configuration portal.

The printer offered a number of features and was fully configured for use in the environment it was placed in. For example, a contact list on the printer contained a few valid emails related to the employees so that scanned documents could be sent directly to someone’s email- useful for day-to-day office life and interesting for the penetration tester.

Even more interesting was the fact that some of the entries were not listed as “*email*” type, but rather as “*server*”. These were service accounts' credentials that the printer would use to store the scanned document within a network location, i.e. FTP servers or SMB folders. A penetration tester’s first reaction would be to click the ‘*Edit*’ button hoping to get some juicy information about those credentials stored within the printer - but things were not going to be that simple.

## **Next Step: catching an early flight**

A deeper look into the other features offered by the printer identified a data export functionality that provides a CSV file containing the contact list. Things got interesting when we noticed two columns in this extract -  MFUSER and MFPASSWD. Both columns were filled in with a cleartext username, the same we could get from the web interface, and an encrypted password.

We obviously won’t show the real credentials in this blog post of course, but this is more or less what we discovered:

| **MFUSER Column value** | **MFPASSWD Column value** |
| --- | --- |
| user | pTSmpj== |
| admin | Mz9lMJqyozy4 |

A bit of Googling rendered a plaintext-ciphertext pair courtesy of a curious user in a support forum who wanted to know more information about the encrypted fields of the exported file of his printer, using the following example:

| **Plaintext Password** | **Ciphertext Password** |
| --- | --- |
| xerox | rTIlo3t= |

Source: https://community.spiceworks.com/topic/535776-fuji-xerox-printer-password-encryption-in-address-book

If you are familiar with basic cryptography, it’s likely you noticed two suspicious things by now: these don’t look like classic strong hashes and the length of the ‘encrypted passwords’ is different.

Around that time we were getting close to the end of the day (or rather end of the night since this was an overnight engagement) and we had a flight to catch first thing the next morning: there is nothing like a bit of offline time to rest the eyes and the brain, right? Well…no.

We knew that testing wouldn’t start again till that night, plus we had the whole flight to keep ourselves entertained. So, in the absence of Sudoku, we decided to have a crack at those encrypted passwords again from the comforts of economy class.

The first step we took was to decode them from BASE64 and see whether the decoded text corresponded to the plaintext password - ok, we had already tried this the night before and we knew they were not:

![Hexdump of encoded ASCII ](https://lh5.googleusercontent.com/xDXBfo-JQV04jjPGzXIp-2z4VHU0ta-PtWvTjUmUrjNu6Bp8L6ZyW1zpZ5JLuZC-ysH_8pJ4z5WWsVQ-bRjENKIPYpII486r21ux9VH3h2rQOT2CMR_Eh4_I5JxP8PNxDTvwIwth)

Well, those are not even printable characters so it definitely wasn’t a simple BASE64 encoding.

It was a good thing we had the known plaintext-ciphertext tuple since that allowed us to perform some basic analysis and test a few different scenarios. So here we go:

To start with, we looked at the hex representation of the ASCII characters of the BASE64 encrypted password: rTIlo3t=

72 54 49 6c 6f 33 74 3d

| **ASCII** | r | T | I | l | o | 3 | t | = |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| **HEX** | 72 | 54 | 49 | 6c | 6f | 33 | 74 | 3d |

If we simply decoded it using BASE64 we got the following:

ad 32 25 a3 ab

The above BASE64 decoding actually contained non printable characters but could still play some role in trying to “crack” this encryption method.

From our Googling above, we knew the plaintext password was 'xerox', which when BASE64-encoded becomes '65 47 56 79 62 33 67 3d'.

While we were trying to define the next step, we noticed that each character of the BASE64 values (the actual ciphertext and simple BASE64 encoding) were suspiciously close together. So the next step was naturally to define exactly what the distance between the 2 was, and to make things easier to the human eye, we transformed each value from HEX to DEC:

| **ASCII** | **Hexadecimal** | **Decimal** |
| --- | --- | --- |
| rTIlo3t= | 72 54 49 6c 6f 33 74 3d | 114 84 73 108 111 51 116 61 |
| xerox | 65 47 56 79 62 33 67 3d | 101 71 86 121  98 51 103 61 |

When converted to a base 10 system, our eyes could easily confirm that each plaintext value was very close to the ciphertext one, so, let’s subtract one from the other:

114 84  73 108 111 51 116 61 -
101 71  86 121  98 51 103 61
----------------------------
 13 13 -13 -13  13  0  13  0

Bingo! There was definitely a correlation here, it looked like a simple algorithm with a key=13 and a few rules applied.

With this information in hand, we tried to decrypt the other two passwords extracted from the CSV file, by adding or subtracting the value of 'D', which is 13 in hexadecimal (we decided to ignore the BASE64 padding). So starting with the password 'pTSmpj==' we have:

| **ASCII** | p | T | S | m | p | j | = | = |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| **HEX** | 70 | 54 | 53 | 6D | 70 | 6A | 3D | 3D |
| **HEX - D** | 63 | 47 | 46 | 60 | 63 | 5D | 3D | 3D |
| **HEX + D** | 7D | 61 | 60 | 7A | 7D | 77 | 3D | 3D |

We were still not sure when the key was added and when it was subtracted, but we noticed that the first row, obtained by subtracting the key, printed the following content when decoded in BASE64:

pa\

This was because only the values highlighted below correspond to valid BASE64 characters:

HEX -D:  63 47 46 60 63 5D 3D 3D

We had two incorrect values there and we needed to do something about it. If we look at the other row (obtained by adding the key) we noticed that they actually had valid BASE64 in those positions!

HEX +D: 7D 61 60 7A 7D 77 3D 3D

So we decided to merge the two (why not?!):

63 47 46 7A 63 77 3D 3D

Which in ASCII is 'cGFzcw==', and this is now valid BASE64 content that, when decoded, gives us: 'pass'

We made it! First password was recovered!

So let’s do the same with the second one (the 'admin' user) - we moved each character to its HEX equivalent, we added and subtracted 13 (D in HEX) and picked up valid BASE64 values:

| **ASCII** | M | z | 9 | 1 | M | J | q | y | o | z | y | 4 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| **HEX** | 4D | 7A | 39 | 6C | 4D | 4A | 71 | 79 | 6F | 7A | 79 | 34 |
| **HEX - D** | 40 | **6D** | 2C | 5F | 40 | 3D | **64** | **6C** | **62** | **6D** | **6C** | 27 |
| **HEX + D** | **5A** | 87 | **46** | **79** | **5A** | **57** | 7E | 86 | 7C | 87 | 86 | **41** |

Handpicking the valid BASE64 values (highlighted in blue above) and converting to ASCII  we obtain 'ZmFyZWdlbmlA', that, when BASE64-decoded, gives us: 'faregeni@'

This could actually be the password! But it looked more like a word we know very well: 'foregenix', which in BASE64 encoding becomes 'Zm9yZWdlbml4' (differences highlighted in red).

So an interesting finding was that in the algorithm used, two instances the character in the encrypted password were not modified.

(Remember, this is just a working example with a fictitious password to protect the innocent)

Anyway, we had our 2 passwords and we couldn’t wait for the testing to resume so that we could try them out...

## **From the printer to the domain**

Testing resumed and we tried the passwords - we were correct! The two passwords worked and the icing on the cake was that one of those was a Domain Administrator - jackpot!

The client was completely surprised and finally happy to have this bomb defused before someone else could take advantage of it.

The encryption algorithm was later identified as a ROT13, which simply shifts characters of 13 positions and does not provide any real protection in terms of confidentiality. A small script was developed to help in identifying and exploiting the issue in future tests (link below).

We also communicated with the vendor who quickly addressed the matter, identified all of their affected products and released a patch, which you can find linked below as well.

## **Conclusion**

We often hear how every small detail matters when speaking about security and we think this was a nice and fun example to demonstrate it. A number of small issues were identified and chained together to ultimately reach a full domain compromise and it all started with an often overlooked default password on a printer.

We hope you enjoyed a bit of rather simple cryptoanalysis - we had a lot of fun testing and sharing this.

Vendor reference:

<https://www.fujifilm.com/fbglobal/eng/company/news/notice/2022/0302_addressbook_announce.html>

CVE ID Reference:

<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-43774>

Below is the python script to automate the process of obtaining valid credentials from a vulnerable printer: <https://github.com/foregenix/defuji>

#### Subscribe to our Blog

###### Contact Us

### Access cybersecurity advisory services

[Speak With Us](https://www.foregenix.com/about-us/contact-us "Speak With Us")

#### TAGS:

#### [Penetration Testing](https://www.foregenix.com/blog/topic/penetration-testing "Penetration Testing") [Vulnerability](https://www.foregenix.com/blog/topic/vulnerability "Vulnerability") [Cybersecurity](https://www.foregenix.com/blog/topic/cybersecurity "Cybersecurity")

![Giuliano Fasto](https://www.foregenix.com/hs-fs/hubfs/orionx/img/Giuliano%20Fasto.jpeg?noresize&width=500&height=500&name=Giuliano%20Fasto.jpeg)

##### Giuliano Fasto

Giuliano is an experienced penetration tester who has worked in the security consultancy field for more than 10 years across several countries in Europe on a wide range of systems and products. His expertise ranges from web applications to mobile and infrastructures, including specific hardware and software testing when collaborating on PCI P2PE assessments.

[See All Articles](https://www.foregenix.com/blog/author/giuliano-fasto "See All Articles")

### Related Content

[SEE ALL ARTICLES](https://www.foregenix.com/blog "SEE ALL ARTICLES")

[##### Changes to the Foregenix commercial team MEA

Nov 28, 2024](https://www.foregenix.com/blog/foregenix-commercial-team-mea "Changes to the Foregenix commercial team MEA")

[##### Introduction of new requirements (6.4.3 and 11.6.1) for PCI DSS v4.0

Sep 10, 2024](https://www.foregenix.com/blog/introduction-of-new-requirements-6.4.3-and-11.6.1-for-pci-dss-v4.0 "Introduction of new requirements (6.4.3 and 11.6.1) for PCI DSS v4.0")

[##### ASV Scanning guide for PCI DSS V4.0 Compliance: New requirements 11.3.2. and 11.3.2.1

Sep 03, 2024](https://www.foregenix.com/blog/pci-dss-v4.0-asv-scanning-guide-for-compliance "ASV Scanning guide for PCI DSS V4.0 Compliance: New requirements 11.3.2. and 11.3.2.1")

Don't miss out on our insights! Receive exclusive updates and invaluable cybersecurity advice from our experts directly in your inbox

Subscribe   Subscribe   Subscribe
Subscribe   Subscribe   Subscribe

###### SUBSCRIBE

#### Subscribe to our blog

Security never stops. Get the most up-to-date information by subscribing to the Foregenix blog.

###

[![Foregenix](https://www.foregenix.com/hs-fs/hubfs/Images/Logos/logo-foregenix-w.png?width=770&height=183&name=logo-foregenix-w.png)](https://www.foregenix.com "Foregenix")

Making cyberspace safe for everyone

###### Join our Newsletter

###

###### Services

* [![Compliance & Consulting](https://www.foregenix.com/hs-fs/hubfs/Images/Icons/icon-compliance.png?noresize&width=535&name=icon-compliance.png)Compliance & Consulting](https://www.foregenix.com/services#COMPLIANCESERVICES)
  + [PCI DSS - Data Security Standard](https://www.foregenix.com/services/compliance-and-risk/pci-dss)
  + [PCI SSF - Software Security Framework](https://www.foregenix.com/services/compliance-and-risk/software-security-framework)
  + [PCI P2PE - Point-To-Point Encryption](https://www.foregenix.com/services/compliance-and-risk/p2pe-3ds-pin)
  + [PCI PIN Security](https://www.foregenix.com/services/compliance-and-risk/p2pe-3ds-pin)
  + [PCI 3DS](https://www.foregenix.com/services/compliance-and-risk/p2pe-3ds-pin)
  + [PCI CPP Card Production & Provisioning](https://www.foregenix.com/services/compliance-and-risk/pci-cpp)
  + [PCI TSP](https://www.foregenix.com/services/compliance-and-risk/p2pe-3ds-pin)
  + [PCI DSS Technical Training Course](https://www.foregenix.com/services/compliance-and-risk/pci-dss)
  + [VISA Ready Site Security](https://www.foregenix.com/services/compliance-and-risk/pci-cpp)
  + [PCI Travel Agent Program](https://www.foregenix.com/services/compliance-and-risk/travel-agent-program)
  + [SWIFT Customer Security Programme](https://www.foregenix.com/services/compliance-and-risk/swift-csp)
  + [US CMMC/DFARS](https://www.foregenix.com/services/compliance-and-risk/cmmc)
  + [US HIPAA Consulting](https://www.foregenix.com/services/compliance-and-risk/cmmc)
  + [Virtual CISO](https://www.foregenix.com/services/compliance-and-risk/cybersecurity-consulting)
  + [Cybersecurity Due Diligence](https://www.foregenix.com/services/compliance-and-risk/cybersecurity-consulting)
  + [Cybersecurity Risk Assessments](https://www.foregenix.com/services/compliance-and-risk/cybersecurity-consulting)
* [![Digital Forensics & Incident response](https://www.foregenix.com/hs-fs/hubfs/Images/Icons/icon-forensics.png?noresize&width=535&name=icon-forensics.png)Digital Forensics & Incidents response](https://www.foregenix.com/services/dfir)
  + [Digital Forensics](https://www.foregenix.com/services/dfir#portfolio)
  + [PCI Forensic Investigations](https://www.foregenix.com/services/dfir#DFIRPCIPFI)
  + [Acquirer Led Investigation ALI / AAI](https://www.foregenix.com/services/dfir#DFIRALI)
  + [Incident Response](https://www.foregenix.com/services/dfir#DFIRIR)
  + [Incident Response Retainer](https://www.foregenix.com/services/dfir#DFIRRETAINER)
  + [Blue Team Extension Services](https://www.foregenix.com/services/dfir#DFIRBLUETEAM)
  + [Incident Response Planning](https://www.foregenix.com/services/dfir#DFIRTRAINING)
  + [Incident Readiness Assessments](https://www.foregenix.com/services/dfir#DFIRTRAINING)
* [![Offensive Operations](https://www.foregenix.com/hs-fs/hubfs/Images/Icons/icon-offensive.png?noresize&width=535&name=icon-offensive.png)Offensive Operations](https://orionx.foregenix.com)
  + [Network penetration testing](https://orionx.foregenix.com/services/penetration-testing)
  + [Web Applications penetration testing](https://orionx.foregenix.com/services/penetration-testing)
  + [Mobile Applications testing](https://orionx.foregenix.com/services/penetration-testing)
  + [Wireless penetration testing](https://orionx.foregenix.com/services/penetration-testing)
  + [Cloud penetration testing](https://orionx.foregenix.com/services/penetration-testing)
  + [Red & Purple Teaming](https://orionx.foregenix.com/services/attack-simulation)
  + [Social Engineering Attacks](https://orionx.foregenix.com/services/attack-simulation)
  + [OT/IoT Penetration testing](https://orionx.foregenix.com/services/bespoke-security-assessment)
  + [Payment-related Hardware testing](https://orionx.foregenix.com/services/bespoke-security-assessment)
  + [ATM Penetration testing](https://orionx.foregenix.com/services/bespoke-security-assessment)
  + [Custom hardware design testing](https://orionx.foregenix.com/services/bespoke-security-assessment)
  + [Secure Development Testing - Source Code Review](https://orionx.foregenix.com/services/secure-coding)
  + [Secure Coding Training](https://orionx.foregenix.com/services/secure-coding)
* ![Cybersecurity Solutions](https://www.foregenix.com/hs-fs/hubfs/Images/Icons/icon-intel.png?noresize&width=535&name=icon-intel.png)Cybersecurity Solutions
  + [ThreatView - Website Security Monitoring](https://www.foregenix.com/solutions/threatview)
  + [eCommerce Portfolio Risk - Proactive Merchant Risk Management](https://www.foregenix.com/solutions/ecommerce-portfolio-risk)

* Challenges
  + [Protect your website/eCommerce from criminals](https://www.foregenix.com/solutions/technology/threatview-website-security-scan)
  + [Conduct a Forensic Investigation](https://www.foregenix.com/services/dfir)
  + [Achieve PCI Compliance](https://www.foregenix.com/services/compliance-and-risk/pci-dss)
* [Industries](https://www.foregenix.com)
  + [Payment Services](https://www.foregenix.com#Industries)
  + [Financial Services](https://www.foregenix.com#Industries)
  + [Government, Legal & Law Enforcement](https://www.foregenix.com#Industries)
  + [Franchises, Retail & eCommerce](https://www.foregenix.com#Industries)
  + [Travel & Hospitality](https://www.foregenix.com#Industries)
  + [Software Development](https://www.foregenix.com#Industries)
  + [Manufacturing](https://www.foregenix.com#Industries)
  + [Technology](https://www.foregenix.com#Industries)
  + [Healthcare](https://www.foregenix.com#Industries)
* Resources
  + [Blog](https://www.foregenix.com/blog)
  + [Webinars](https://www.foregenix.com/resources/events-and-webinars)
  + [Case Studies](https://www.foregenix.com/resources/case-studies)
  + [Knowledge Base](https://support.foregenix.com/kb)
* About Us
  + [Who we are](https://www.foregenix.com/about-us#whoweare)
  + [History](https://www.foregenix.com/about-us#history)
  + [Awards & Recognition](https://www.foregenix.com/about-us#awards)
  + [Leadership](https://www.foregenix.com/about-us#whoweare)
  + [Who we are](https://www.foregenix.com/about-us)
  + [News & Press](https://www.foregenix.com/resources/news-and-press)
  + [Careers](https://www.foregenix.com/about-us/careers)

###### Follow us

[Legal Documentation](https://www.foregenix.com/legal "Legal Documentation")

[Terms & Conditions](https://www.foregenix.com/legal/terms-and-conditions "Terms & Conditions")

Foregenix Ltd. 2025
© All rights reserved

Change the language

* English
  + [Español](/es?hsLang=es)
  + [Português](/pt?hsLang=pt)

Detect.  Secure.  Prevent.
Detect.  Secure.  Prevent.
Detect.  Secure.  Prevent.

