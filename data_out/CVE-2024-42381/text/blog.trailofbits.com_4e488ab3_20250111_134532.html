
# [Trail of Bits Blog](https://blog.trailofbits.com/ "Trail of Bits Blog")

##

# Menu

[Skip to content](#content "Skip to content")

* [Home](https://blog.trailofbits.com/)

# Our audit of Homebrew

* Post
* [July 30, 2024](https://blog.trailofbits.com/2024/07/30/our-audit-of-homebrew/ "9:00 am")
* [Leave a comment](https://blog.trailofbits.com/2024/07/30/our-audit-of-homebrew/#respond)

*By William Woodruff*

This is a joint post with the Homebrew maintainers; [read their announcement here](https://brew.sh/2024/07/30/homebrew-security-audit/)!

Last summer, we performed an audit of [Homebrew](https://brew.sh/). Our audit’s scope included [Homebrew/brew](https://github.com/Homebrew/brew) itself (home of the brew CLI), and three adjacent repositories responsible for various security-relevant aspects of Homebrew’s operation:

* [Homebrew/actions](https://github.com/Homebrew/actions): a repository of custom GitHub Actions used throughout Homebrew’s CI/CD;
* [Homebrew/formulae.brew.sh](https://github.com/Homebrew/formulae.brew.sh): the codebase responsible for Homebrew’s JSON index of installable packages;
* [Homebrew/homebrew-test-bot](https://github.com/Homebrew/homebrew-test-bot): Homebrew’s core CI/CD orchestration and lifecycle management routines.

We found issues within Homebrew that, while not critical, could allow an attacker to load executable code at unexpected points and undermine the integrity guarantees intended by Homebrew’s use of sandboxing. Similarly, we found issues in Homebrew’s CI/CD that could allow an attacker to surreptitiously modify binary (“[bottle](https://docs.brew.sh/Bottles)”) builds of formulae and potentially pivot from triggering CI/CD workflows to controlling the execution of CI/CD workflows and exfiltrating their secrets.

This audit was sponsored by the [Open Tech Fund](https://www.opentech.fund/) as part of their larger mission to secure critical pieces of internet infrastructure. You can read the full report in [our publications repository](https://github.com/trailofbits/publications#technology-product-reviews).

### Homebrew

Homebrew is the self-described “missing package manager for macOS (or Linux).” It serves as the *de facto* standard package manager for software developers on macOS, and [serves hundreds of millions of package installs](https://formulae.brew.sh/analytics/install/365d/) annually. These installations include “keystone” packages such as [Golang](https://formulae.brew.sh/formula/go#default), [Node.js](https://formulae.brew.sh/formula/node#default), and [OpenSSL](https://formulae.brew.sh/formula/openssl%403#default), making Homebrew’s security (and the integrity of its builds) critical to the security of downstream software ecosystems as a whole. Homebrew’s core (not to be confused with [homebrew-core](https://github.com/Homebrew/homebrew-core)) is a Ruby monolith responsible for providing the [`brew` CLI](https://docs.brew.sh/Manpage) to users along with an [importable Ruby API](https://rubydoc.brew.sh/).

Since its inception in 2009, Homebrew has undergone several architectural shifts aimed at improving the reliability and usability of packages delivered to users: binary builds (bottles) were implemented, made into the default installation mechanism (replacing local source builds), and subsequently built solely on CI/CD to limit the risk of a compromised developer machine. Despite this increasingly static approach, Homebrew’s core codebase is fundamentally dynamic and, in many places, reflects Homebrew’s historical need for dynamic loading of [DSL-specified formulae](https://docs.brew.sh/Formula-Cookbook) via user-controlled Ruby code.

### Scope

Homebrew is both a user-installable package manager (the `brew` CLI) and a packaging ecosystem, with an extensive and bespoke CI/CD configuration for reviewing, building, and distributing bottles to end users. Our audit focused on aspects of both of these, and aimed to answer questions like (but not limited to) the following:

* Can a local actor induce unexpected execution of a formula’s DSL, e.g. without an explicit invocation of `brew install`?
* Can a local actor induce unexpected evaluation of a tap’s formulae, e.g. from just `brew tap` with no subsequent user actions?
* Can a local actor induce namespace confusions or conflicts within brew, resulting in `brew install foo` installing an unexpected formula?
* Can a locally installed formula surreptitiously subvert or bypass Homebrew’s build isolation mechanisms?
* Can an unprivileged or low-privilege CI/CD actor (such as a third-party contributor) pivot to a higher privilege in Homebrew’s CI/CD?
* Can an unprivileged or low-privilege CI/CD actor surreptitiously taint or compromise a bottle build?
* Can an unprivileged or low-privilege CI/CD actor establish persistence in Homebrew’s CI/CD?

### Highlighted findings

#### brew

During our review of the `brew` CLI’s codebase, we uncovered a number of findings that, while not critical, could potentially undermine Homebrew’s per-formula integrity and isolation properties. We also uncovered findings that could allow loading of formulae (i.e., executable code) from surprising sources, such as remote URLs.

Some findings of interest include:

* TOB-BREW-2, wherein a formula can influence the construction of its sandbox through string injection, resulting in a sandbox escape.
* TOB-BREW-5, wherein Homebrew used a collision-prone hash function (MD5) for a synthetic namespace (`FormulaNamespace`) could allow an attacker to induce runtime confusion between formulae.
* TOB-BREW-8, wherein a formula can surreptitiously include networked resources in its build without explicitly listing them via `resource` stanzas.
* TOB-BREW-11, wherein a formula can potentially use a socket pivot to escape its build sandbox on macOS.
* TOB-BREW-12, wherein a formula could opportunistically perform a privilege escalation through a user’s previously activated `sudo` token.
* TOB-BREW-13, wherein `brew install` can be induced to install formulae from non-local URLs for any protocol supported by the version of `curl` being used, such as SFTP or SCP.

Our overall evaluation of [Homebrew/brew](https://github.com/Homebrew/brew) is reflected in our report: while extensively tested, Homebrew’s large API and CLI surface and informal local behavioral contract offer a large variety of avenues for unsandboxed, local code execution to an opportunistic attacker. These avenues do not necessarily violate Homebrew’s core security assumptions (which assume trustworthy formulae), but may be subverted either by malicious formulae or through unexpected sources of formula loading (such as insufficiently sanitized inputs).

#### Homebrew’s CI/CD

Our review of Homebrew’s CI/CD workflows and actions uncovered findings that, while not critical, could undermine the integrity of Homebrew’s CI/CD runs and allow a less-privileged user to pivot to a position of higher privilege or even obtain persistence on Homebrew’s self-hosted GitHub Actions runners.

Some findings of interest include:

* TOB-BREW-18, wherein multiple CI/CD workflows use the `pull_request_target` trigger to allow third-party pull requests to run code in the context of Homebrew’s upstream repository, potentially enabling either credential disclosure or tampering with Homebrew’s bottle builds.
* TOB-BREW-23, wherein multiple CI/CD workflows inadvertently allow shell injection via unsanitized `workflow_dispatch` inputs, potentially enabling vertical movement by a less-privileged user (i.e., one who can dispatch workflows but not modify them).

Beyond CI/CD-specific findings, many brew findings are also salient in the CI/CD setting:

* TOB-BREW-6, which describes a lack of sandboxing/isolation during archive extraction, could be used by a less-privileged CI actor to pivot into a higher-privileged context by inducing extraction of a formula or other executable code that gets auto-loaded and executed during the CI’s lifecycle.
* TOB-BREW-13, described above, could be used by a less-privileged CI actor to pivot into a higher-privileged context, by inducing arbitrary code execution through `brew install` of a formula not present in the CI’s pre-configured (presumed trusted) context.

Our report concludes that Homebrew’s CI/CD, while mature and effective at reducing the number of human touch-points in Homebrew’s package lifecycle, is complex and relies on misuse-prone patterns common in GitHub Actions workflows (such as dangerous workflow triggers and mixing of configuration, code, and data via template expansion). These patterns do not necessarily enable persistence or pivoting by a fully external actor, but may be leveraged by a lower-privileged insider (such as a rogue maintainer) to undermine the integrity and isolation assumptions made by Homebrew’s CI/CD.

### Takeaways

Auditing a package management ecosystem such as Homebrew poses unique challenges. Local package management tools install and execute arbitrary third-party code by design and, as such, typically have informal and loosely defined boundaries between expected and unexpected code execution. This is especially true in packaging ecosystems like Homebrew, where the “carrier” format for packages (formulae) is itself executable code (Ruby scripts, in Homebrew’s case).

Throughout the audit, we worked closely with the [Homebrew maintainers](https://github.com/Homebrew/brew?tab=readme-ov-file#who-we-are) and the [Homebrew PLC](https://docs.brew.sh/Homebrew-Governance) and would like to thank them for sharing their extensive knowledge and expertise. We would also like to thank [Patrick Linnane](https://github.com/p-linnane), Homebrew’s security manager, in particular for his triage and coordination efforts on behalf of Homebrew.

### Share this:

* [Twitter](https://blog.trailofbits.com/2024/07/30/our-audit-of-homebrew/?share=twitter "Click to share on Twitter")
* [LinkedIn](https://blog.trailofbits.com/2024/07/30/our-audit-of-homebrew/?share=linkedin "Click to share on LinkedIn")
* [Reddit](https://blog.trailofbits.com/2024/07/30/our-audit-of-homebrew/?share=reddit "Click to share on Reddit")
* [Telegram](https://blog.trailofbits.com/2024/07/30/our-audit-of-homebrew/?share=telegram "Click to share on Telegram")
* [Facebook](https://blog.trailofbits.com/2024/07/30/our-audit-of-homebrew/?share=facebook "Click to share on Facebook")
* [Pocket](https://blog.trailofbits.com/2024/07/30/our-audit-of-homebrew/?share=pocket "Click to share on Pocket")
* Email
* [Print](https://blog.trailofbits.com/2024/07/30/our-audit-of-homebrew/#print "Click to print")
### Like this:

Like Loading...
### *Related*

By Trail of Bits

Posted in [Research Practice](https://blog.trailofbits.com/category/research-practice/)

# Post navigation

[← Our crypto experts answer 10 key questions](https://blog.trailofbits.com/2024/07/25/our-crypto-experts-answer-10-key-questions/) [Cloud cryptography demystified: Google Cloud Platform →](https://blog.trailofbits.com/2024/08/05/cloud-cryptography-demystified-google-cloud-platform/)

### Leave a Reply[Cancel reply](/2024/07/30/our-audit-of-homebrew/#respond)

Search

# About Us

Since 2012, Trail of Bits has helped secure some of the world’s most targeted organizations and products. We combine high-­end security research with a real­ world attacker mentality to reduce risk and fortify code.

Read more at [www.trailofbits.com](https://www.trailofbits.com)

# Subscribe via RSS

[![RSS feed](https://blog.trailofbits.com/wp-content/plugins/jetpack/images/rss/red-small.png) RSS - Posts](https://blog.trailofbits.com/feed/ "Subscribe to posts")

# Recent Posts

* [Auditing the Ruby ecosystem’s central package repository](https://blog.trailofbits.com/2024/12/11/auditing-the-ruby-ecosystems-central-package-repository/)
* [35 more Semgrep rules: infrastructure, supply chain, and Ruby](https://blog.trailofbits.com/2024/12/09/35-more-semgrep-rules-infrastructure-supply-chain-and-ruby/)
* [Evaluating Solidity support in AI coding assistants](https://blog.trailofbits.com/2024/11/19/evaluating-solidity-support-in-ai-coding-assistants/)
* [Attestations: A new generation of signatures on PyPI](https://blog.trailofbits.com/2024/11/14/attestations-a-new-generation-of-signatures-on-pypi/)
* [Killing Filecoin nodes](https://blog.trailofbits.com/2024/11/13/killing-filecoin-nodes/)
* [Fuzzing between the lines in popular barcode software](https://blog.trailofbits.com/2024/10/31/fuzzing-between-the-lines-in-popular-barcode-software/)
* [A deep dive into Linux’s new mseal syscall](https://blog.trailofbits.com/2024/10/25/a-deep-dive-into-linuxs-new-mseal-syscall/)
* [Auditing Gradio 5, Hugging Face’s ML GUI framework](https://blog.trailofbits.com/2024/10/10/auditing-gradio-5-hugging-faces-ml-gui-framework/)
* [Securing the software supply chain with the SLSA framework](https://blog.trailofbits.com/2024/10/01/securing-the-software-supply-chain-with-the-slsa-framework/)
* [A few notes on AWS Nitro Enclaves: Attack surface](https://blog.trailofbits.com/2024/09/24/notes-on-aws-nitro-enclaves-attack-surface/)
* [Announcing the Trail of Bits and Semgrep partnership](https://blog.trailofbits.com/2024/09/19/announcing-the-trail-of-bits-and-semgrep-partnership/)
* [Inside DEF CON: Michael Brown on how AI/ML is revolutionizing cybersecurity](https://blog.trailofbits.com/2024/09/17/inside-def-con-michael-brown-on-how-ai-ml-is-revolutionizing-cybersecurity/)
* [Friends don’t let friends reuse nonces](https://blog.trailofbits.com/2024/09/13/friends-dont-let-friends-reuse-nonces/)
* [Sanitize your C++ containers: ASan annotations step-by-step](https://blog.trailofbits.com/2024/09/10/sanitize-your-c-containers-asan-annotations-step-by-step/)
* [“Unstripping” binaries: Restoring debugging information in GDB with Pwndbg](https://blog.trailofbits.com/2024/09/06/unstripping-binaries-restoring-debugging-information-in-gdb-with-pwndbg/)
# Yearly Archive

* [2023](https://blog.trailofbits.com/2023)
* [2022](https://blog.trailofbits.com/2022)
* [2021](https://blog.trailofbits.com/2021)
* [2020](https://blog.trailofbits.com/2020)
* [2019](https://blog.trailofbits.com/2019)
* [2018](https://blog.trailofbits.com/2018)
* [2017](https://blog.trailofbits.com/2017)
* [2016](https://blog.trailofbits.com/2016)
* [2015](https://blog.trailofbits.com/2015)
* [2014](https://blog.trailofbits.com/2014)
* [2013](https://blog.trailofbits.com/2013)
* [2012](https://blog.trailofbits.com/2012)

# Categories

* [AIxCC](https://blog.trailofbits.com/category/aixcc/) (6)
* [Apple](https://blog.trailofbits.com/category/apple/) (13)
* [Application Security](https://blog.trailofbits.com/category/application-security/) (15)
* [Artificial Intelligence](https://blog.trailofbits.com/category/artificial-intelligence/) (1)
* [Attacks](https://blog.trailofbits.com/category/attacks/) (13)
* [Audits](https://blog.trailofbits.com/category/audits/) (11)
* [Authentication](https://blog.trailofbits.com/category/authentication/) (6)
* [Binary Ninja](https://blog.trailofbits.com/category/binary-ninja/) (15)
* [Blockchain](https://blog.trailofbits.com/category/blockchain/) (69)
* [C/C++](https://blog.trailofbits.com/category/c-c/) (1)
* [Capture the Flag](https://blog.trailofbits.com/category/capture-the-flag/) (11)
* [Careers](https://blog.trailofbits.com/category/careers/) (2)
* [CodeQL](https://blog.trailofbits.com/category/codeql/) (6)
* [Compilers](https://blog.trailofbits.com/category/compilers/) (30)
* [Conferences](https://blog.trailofbits.com/category/conferences/) (33)
* [Confidential Computing](https://blog.trailofbits.com/category/confidential-computing/) (1)
* [Containers](https://blog.trailofbits.com/category/containers/) (3)
* [Cryptography](https://blog.trailofbits.com/category/cryptography/) (68)
* [Crytic](https://blog.trailofbits.com/category/crytic/) (4)
* [Cyber Grand Challenge](https://blog.trailofbits.com/category/cyber-grand-challenge/) (8)
* [DARPA](https://blog.trailofbits.com/category/darpa/) (25)
* [Design Review](https://blog.trailofbits.com/category/design-review/) (1)
* [Dynamic Analysis](https://blog.trailofbits.com/category/dynamic-analysis/) (14)
* [eBPF](https://blog.trailofbits.com/category/ebpf/) (6)
* [Echidna](https://blog.trailofbits.com/category/echidna/) (1)
* [Ecosystem Security](https://blog.trailofbits.com/category/ecosystem-security/) (5)
* [Education](https://blog.trailofbits.com/category/education/) (17)
* [Empire Hacking](https://blog.trailofbits.com/category/empire-hacking/) (7)
* [Engineering Practice](https://blog.trailofbits.com/category/engineering-practice/) (16)
* [Events](https://blog.trailofbits.com/category/events/) (8)
* [Exploits](https://blog.trailofbits.com/category/exploits/) (30)
* [Fuzzing](https://blog.trailofbits.com/category/fuzzing/) (45)
* [Go](https://blog.trailofbits.com/category/go/) (8)
* [Guides](https://blog.trailofbits.com/category/guides/) (15)
* [Internship Projects](https://blog.trailofbits.com/category/internship-projects/) (38)
* [Invariant Development](https://blog.trailofbits.com/category/invariant-development/) (1)
* [iVerify](https://blog.trailofbits.com/category/iverify/) (5)
* [Kubernetes](https://blog.trailofbits.com/category/kubernetes/) (3)
* [Linux](https://blog.trailofbits.com/category/linux/) (8)
* [LLVM](https://blog.trailofbits.com/category/llvm/) (4)
* [Machine Learning](https://blog.trailofbits.com/category/machine-learning/) (27)
* [Malware](https://blog.trailofbits.com/category/malware/) (7)
* [Manticore](https://blog.trailofbits.com/category/manticore/) (17)
* [McSema](https://blog.trailofbits.com/category/mcsema/) (11)
* [Memory Safety](https://blog.trailofbits.com/category/memory-safety/) (2)
* [Meta](https://blog.trailofbits.com/category/meta/) (12)
* [Mitigations](https://blog.trailofbits.com/category/mitigations/) (11)
* [MLIR](https://blog.trailofbits.com/category/mlir/) (2)
* [Open Source](https://blog.trailofbits.com/category/open-source/) (14)
* [osquery](https://blog.trailofbits.com/category/osquery/) (23)
* [Paper Review](https://blog.trailofbits.com/category/paper-review/) (11)
* [People](https://blog.trailofbits.com/category/people/) (6)
* [Podcast](https://blog.trailofbits.com/category/podcast/) (1)
* [Policy](https://blog.trailofbits.com/category/policy/) (11)
* [Press Release](https://blog.trailofbits.com/category/press-release/) (30)
* [Privacy](https://blog.trailofbits.com/category/privacy/) (9)
* [Products](https://blog.trailofbits.com/category/products/) (8)
* [Program Analysis](https://blog.trailofbits.com/category/program-analysis/) (18)
* [Recruitment](https://blog.trailofbits.com/category/recruitment/) (1)
* [Remote Work](https://blog.trailofbits.com/category/remote-work/) (1)
* [Research Practice](https://blog.trailofbits.com/category/research-practice/) (30)
* [Reversing](https://blog.trailofbits.com/category/reversing/) (16)
* [Rust](https://blog.trailofbits.com/category/rust/) (7)
* [SafeDocs](https://blog.trailofbits.com/category/safedocs/) (1)
* [Semgrep](https://blog.trailofbits.com/category/semgrep/) (9)
* [Sinter](https://blog.trailofbits.com/category/sinter/) (1)
* [Slither](https://blog.trailofbits.com/category/slither/) (4)
* [Sponsorships](https://blog.trailofbits.com/category/sponsorships/) (12)
* [Static Analysis](https://blog.trailofbits.com/category/static-analysis/) (34)
* [Supply Chain](https://blog.trailofbits.com/category/supply-chain/) (3)
* [Symbolic Execution](https://blog.trailofbits.com/category/symbolic-execution/) (18)
* [Testing Handbook](https://blog.trailofbits.com/category/testing-handbook/) (5)
* [Threshold Signatures](https://blog.trailofbits.com/category/threshold-signatures/) (1)
* [Tool Release](https://blog.trailofbits.com/category/tool-release/) (5)
* [Training](https://blog.trailofbits.com/category/training/) (3)
* [Uncategorized](https://blog.trailofbits.com/category/uncategorized/) (33)
* [VAST](https://blog.trailofbits.com/category/vast/) (2)
* [Vulnerability Disclosure](https://blog.trailofbits.com/category/vulnerability-disclosure/) (20)
* [Windows](https://blog.trailofbits.com/category/windows/) (3)
* [Working at Trail of Bits](https://blog.trailofbits.com/category/working-at-trail-of-bits/) (2)
* [Year in Review](https://blog.trailofbits.com/category/year-in-review/) (6)
* [Zero Knowledge](https://blog.trailofbits.com/category/zero-knowledge/) (11)
[My Tweets](https://twitter.com/trailofbits)

## Discover more from Trail of Bits Blog

Subscribe now to keep reading and get access to the full archive.

Type your email…

Subscribe

Continue reading

%d

