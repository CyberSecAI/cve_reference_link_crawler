

RUSTSEC-2024-0378: pyo3: Risk of use-after-free in `borrowed` reads from Python weak references › RustSec Advisory Database

#

[About](/)
[Advisories](/advisories/)
[Report Vulnerabilities](/contributing.html)

[History](https://github.com/RustSec/advisory-db/commits/main/crates/pyo3/RUSTSEC-2024-0378.md) ⋅
[Edit](https://github.com/RustSec/advisory-db/edit/main/crates/pyo3/RUSTSEC-2024-0378.md) ⋅
[JSON (OSV)](https://api.osv.dev/v1/vulns/RUSTSEC-2024-0378)

# RUSTSEC-2024-0378

Risk of use-after-free in `borrowed` reads from Python weak references

Reported
October 12, 2024

Issued
October 14, 2024

Package
[pyo3](/packages/pyo3.html)
([crates.io](https://crates.io/crates/pyo3))

Type
Vulnerability

Categories

* [memory-corruption](/categories/memory-corruption.html)

Keywords
[#use-after-free](/keywords/use-after-free.html)

References

* <https://github.com/PyO3/pyo3/pull/4590>

Patched

* `>=0.22.4`

Unaffected

* `<0.22.0`

Affected Functions
Version
`pyo3::types::PyWeakrefMethods::get_object_borrowed`

* `<0.22.4, >=0.22.0`

`pyo3::types::PyWeakrefMethods::upgrade_borrowed`

* `<0.22.4, >=0.22.0`

`pyo3::types::PyWeakrefMethods::upgrade_borrowed_as`

* `<0.22.4, >=0.22.0`

`pyo3::types::PyWeakrefMethods::upgrade_borrowed_as_exact`

* `<0.22.4, >=0.22.0`

`pyo3::types::PyWeakrefMethods::upgrade_borrowed_as_unchecked`

* `<0.22.4, >=0.22.0`

### Description

The family of functions to read "borrowed" values from Python weak references
were fundamentally unsound, because the weak reference does itself not have
ownership of the value. At any point the last strong reference could
be cleared and the borrowed value would become dangling.

In PyO3 0.22.4 these functions have all been deprecated and patched to leak a
strong reference as a mitigation. PyO3 0.23 will remove these functions entirely.

Advisory available under [CC0-1.0](https://spdx.org/licenses/CC0-1.0.html)
license.

