
[Skip to content](#main)
[![Stack Diary](https://stackdiary.com/wp-content/uploads/2024/06/sdlogo.svg)
![Stack Diary](https://stackdiary.com/wp-content/uploads/2024/06/sdlogov.svg)](https://stackdiary.com/)

* [Home](https://stackdiary.com/)
* [Tech](https://stackdiary.com/category/tech/)
* [AI](https://stackdiary.com/category/ai/)
* [Security](https://stackdiary.com/category/security/)
* [Privacy](https://stackdiary.com/category/privacy/)

Light

Dark

System

Search for:

Category
[Security](https://stackdiary.com/category/security/)
# OpenSSH: race condition in sshd allows remote code execution

Successful exploitation has been demonstrated on 32-bit Linux systems using the GNU C Library (glibc) with Address Space Layout Randomization (ASLR) enabled.

By [Alex Ivanovs](https://stackdiary.com/author/alex/)

Published
July 1, 2024

3 min read

Share with friends

Link copied

![OpenSSH flaw in sshd allows remote code execution](https://stackdiary.com/wp-content/uploads/2024/07/OpenSSH-flaw-in-sshd-allows-remote-code-execution.jpg)

A severe vulnerability in OpenSSH, dubbed “[regreSSHion](https://blog.qualys.com/vulnerabilities-threat-research/2024/07/01/regresshion-remote-unauthenticated-code-execution-vulnerability-in-openssh-server)” ([CVE-2024-6387](https://www.cve.org/CVERecord?id=CVE-2024-6387)), has been discovered by the Qualys Threat Research Unit, potentially exposing millions of systems to remote code execution attacks. This flaw, in versions [8.5p1 through 9.7p1](https://www.openssh.com/txt/release-9.8) of Portable OpenSSH, allows an unauthenticated attacker to execute code on a remote Linux machine with root privileges.

According to Qualys, over 14 million OpenSSH server instances exposed to the internet could be vulnerable. Their analysis of anonymized data reveals that approximately 700,000 external internet-facing instances within their global customer base are at risk, accounting for 31% of all internet-facing instances with OpenSSH. Bharat Jogi, Senior Director of Threat Research at Qualys, noted that this flaw affects sshd in its default configuration on glibc-based Linux systems.

Qualys decided not to publicly publish a working prototype of the exploit until the vulnerability is widely fixed. However, [a detailed description of the vulnerability is available](https://www.qualys.com/2024/07/01/cve-2024-6387/regresshion.txt), making the development of third-party exploits likely a matter of time.

*(Update: The said [exploits are now circulating](https://stackdiary.com/regresshion-exploits-are-already-out-in-the-wild/) the open web.)*

The vulnerability stems from a signal handler race condition in the OpenSSH server (sshd).

> A critical vulnerability in sshd(8) was present in Portable OpenSSH versions between 8.5p1 and 9.7p1 (inclusive) that may allow arbitrary code execution with root privileges. Successful exploitation has been demonstrated on 32-bit Linux/glibc systems with ASLR. Under lab conditions, the attack requires on average 6-8 hours of continuous connections up to the maximum the server will accept.
>
> The OpenSSH Team

Race conditions occur when multiple processes or threads compete to access and manipulate shared data concurrently, potentially leading to unpredictable and erroneous results. In the context of this vulnerability, the race condition involves the signal handler, a critical component responsible for managing system interrupts. This particular flaw allows an attacker to exploit the brief window of time between when a signal is received and when it’s processed, potentially manipulating the system’s state to execute malicious code.

While such vulnerabilities are notoriously difficult to consistently exploit due to their timing-dependent nature, the potential for root-level access makes this a severe security risk, especially given the widespread use of OpenSSH in enterprise environments.

## How it happened & fixes

The vulnerability stems from a regression [introduced in OpenSSH 8.5](https://github.com/openssh/openssh-portable/commit/752250caabda3dd24635503c4cd689b32a650794), causing a race condition in the sshd signal handling code. This regression removed protection against the old [CVE-2006-5051](https://www.cve.org/CVERecord?id=CVE-2006-5051) vulnerability, which existed in [OpenSSH versions before 4.4](https://www.openssh.com/txt/release-4.4) (2006) and was considered “theoretical”. The issue occurred when the “#ifdef DO\_LOG\_SAFE\_IN\_SIGHAND” block was mistakenly removed from the sigdie() function during OpenSSH 8.5 development. The SIGALRM handler directly calls this function.

The SIGALRM handler in sshd is triggered asynchronously if the client fails to authenticate within the connection timeout (LoginGraceTime, set to 120 seconds by default).

The vulnerability arises because the signal handler calls functions that are unsafe for asynchronous signal handling, such as syslog(). In Glibc, syslog() is not designed for use in asynchronous signal handlers since it calls malloc() and free(). When the SIGALRM signal interrupts sshd code execution, it can disrupt the execution state. An exploit leverages this by timing the interruption of critical code. Notably, OpenBSD is unaffected because it uses syslog\_r() in the SIGALRM handler, which is specifically designed for asynchronous operation.

While exploitation on 64-bit systems is believed to be possible, it has not yet been demonstrated. The OpenSSH team warns that attack methods will likely improve over time, potentially increasing the risk to vulnerable systems.

OpenSSH also said that systems running non-glibc libraries or those with modified ASLR settings may be at higher risk. Interestingly, they also pointed out that some downstream Linux distributions have altered OpenSSH to disable per-connection ASLR re-randomization, a practice they described as puzzling.

The OpenSSH team has released [version 9.8](https://lists.mindrot.org/pipermail/openssh-unix-dev/2024-July/041430.html) to address this vulnerability and make other security improvements. You can track the release of package updates in distributions on these pages: [Debian](https://security-tracker.debian.org/tracker/CVE-2024-6387), [Ubuntu](https://people.canonical.com/~ubuntu-security/cve/CVE-2024-6387), [RHEL](https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2024-6387), [SUSE/openSUSE](https://bodhi.fedoraproject.org/updates/?releases=F40&type=security), [Fedora](https://bodhi.fedoraproject.org/updates/?releases=F40&type=security), [Arch](https://security.archlinux.org/CVE-2024-6387), and [FreeBSD](https://www.freebsd.org/security/advisories/FreeBSD-SA-24%3A04.openssh.asc) .

To mitigate the vulnerability ([according to this patch](https://lists.mindrot.org/pipermail/openssh-unix-dev/2024-July/041431.html)), you can set the “LoginGraceTime=0” parameter in sshd\_config. However, disabling this timeout can make initiating a denial of service attack easier by establishing numerous connections that exceed the MaxStartups parameter limits. A common sign of such an attack is the frequent appearance of “Timeout before authentication” entries in the log.

## Tags

[CVE](https://stackdiary.com/tag/cve/)[News](https://stackdiary.com/tag/news/)[OpenSSH](https://stackdiary.com/tag/openssh/)[Security](https://stackdiary.com/tag/security/)

[![Alex Ivanovs](https://secure.gravatar.com/avatar/765cc0df81be2f1a6ec61cd8a8e29bdd?s=96&r=g)](https://stackdiary.com/author/alex/)
## Posted by [Alex Ivanovs](https://stackdiary.com/author/alex/)

Alex is the lead editor at *Stack Diary* and covers stories on tech, artificial intelligence, security, privacy and web development. He previously worked as a lead contributor for Huffington Post for their *Code* column.

### You might also like

[![AI companies use YouTube videos without permission to train models](https://stackdiary.com/wp-content/uploads/2024/07/AI-companies-use-YouTube-videos-without-permission-to-train-models-1120x630.png)](https://stackdiary.com/ai-companies-used-youtube-videos-without-permission-to-train-models/)
Category
[Artificial Intelligence](https://stackdiary.com/category/ai/)
[## AI companies used YouTube videos without permission to train models

An investigation by Proof News has found that several top AI companies, including Apple, Nvidia, and Anthropic, have used transcripts…](https://stackdiary.com/ai-companies-used-youtube-videos-without-permission-to-train-models/)
Published
July 16, 2024

3 min read

[![webkit private browsing](https://stackdiary.com/wp-content/uploads/2024/07/webkit-private-browsing-1120x630.jpg)](https://stackdiary.com/webkit-enhances-safari-privacy-with-private-browsing-2-0/)
Category
[Privacy](https://stackdiary.com/category/privacy/)
[## WebKit enhances Safari privacy with Private Browsing 2.0

Apple’s WebKit team has published a blog post on Private Browsing 2.0 – a collection of changes they have introduced…](https://stackdiary.com/webkit-enhances-safari-privacy-with-private-browsing-2-0/)
Published
July 16, 2024

3 min read

[![XBOW](https://stackdiary.com/wp-content/uploads/2024/07/XBOW-1120x630.jpg)](https://stackdiary.com/xbow-is-an-offensive-security-ai-created-by-github-copilot-pioneers/)
Category
[Security](https://stackdiary.com/category/security/)
[## XBOW is an offensive security AI created by GitHub Copilot pioneers

When ChatGPT first launched, and I got to try it for the first time, two immediate thoughts rushed through my…](https://stackdiary.com/xbow-is-an-offensive-security-ai-created-by-github-copilot-pioneers/)
Published
July 15, 2024

3 min read

* [About](https://stackdiary.com/about/)
* [Terms](https://stackdiary.com/terms-conditions/)
* [Privacy](https://stackdiary.com/privacy-policy/)
* [Contact](https://stackdiary.com/contact/)

© 2024 Stack Diary - All Rights Reserved.

