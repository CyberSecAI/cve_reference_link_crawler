=== Content from research.splunk.com_1297ed71_20250111_102733.html ===

[![Splunk Security Content Logo](https://research.splunk.com/images/logo.svg)](https://research.splunk.com/)

* [Analytic Stories](https://research.splunk.com/stories/)
* [Detections](https://research.splunk.com/detections/)
* [Playbooks](https://research.splunk.com/playbooks/)
* [Data Sources](https://research.splunk.com/sources/)
* [Blog](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)
* [About](http://splunk.com/threat-research)
* [![GitHub Repo](https://research.splunk.com/images/GitHubMarkLight.svg)](https://github.com/splunk/security_content)

## Table of Contents

* + [Description](#description)
  + [Search](#search)
  + [Data Source](#data-source)
  + [Macros Used](#macros-used)
  + [Annotations](#annotations)
  + [Default Configuration](#default-configuration)
  + [Implementation](#implementation)
  + [Known False Positives](#known-false-positives)
  + [Associated Analytic Story](#associated-analytic-story)
  + [Risk Based Analytics (RBA)](#risk-based-analytics-rba)
  + [References](#references)
  + [Detection Testing](#detection-testing)

# Detection: Splunk Enterprise KV Store Incorrect Authorization

Updated Date: 2024-10-17
ID: 8f0e8380-a835-4f2b-b749-9ce119364df0
Author: Rod Soto, Eric McGinnis, Chase Franklin
[Type: Hunting](#default-configuration)
[Product: Splunk Enterprise Security](https://www.splunk.com/en_us/products/enterprise-security.html)
### Description

The following analytic detects unauthorized attempts to reload Splunk KV Store collections via the REST API. It leverages internal index logs to identify POST requests to the `/servicesNS/nobody/search/admin/collections-conf/_reload` endpoint, focusing on status codes starting with '2'. This activity is significant as it may indicate improper permission handling, potentially leading to unauthorized deletion of KV Store collections. If confirmed malicious, this could result in data loss or unauthorized data manipulation, impacting the integrity and availability of critical Splunk data.

### Search

```
1`splunkda` uri=/servicesNS/nobody/search/admin/collections-conf/_reload status=2* method="POST" user=* file=_reload
2| stats count min(_time) as firstTime max(_time) as lastTime values(status) as status by host clientip file method
3| `security_content_ctime(firstTime)`
4| `security_content_ctime(lastTime)`
5| `splunk_enterprise_kv_store_incorrect_authorization_filter`

```
### Data Source

| Name | Platform | Sourcetype | Source |
| --- | --- | --- | --- |
| [Splunk](/sources/d8a2c791-460b-4756-a8e5-ecade77b21e3) | Splunk icon [Splunk](/platform/splunk) | `'splunkd_ui_access'` | `'splunkd_ui_access.log'` |

### Macros Used

| Name | Value |
| --- | --- |
| [security\_content\_ctime](https://github.com/splunk/security_content/blob/develop/macros/security_content_ctime.yml) | `convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)` |
| splunk\_enterprise\_kv\_store\_incorrect\_authorization\_filter | `search *` |

`splunk_enterprise_kv_store_incorrect_authorization_filter` is an empty macro by default. It allows the user to filter out any results (false positives) without editing the SPL.
### Annotations

- MITRE ATT&CK

+ Kill Chain Phases

+ NIST

+ CIS

- Threat Actors

| ID | Technique | Tactic |
| --- | --- | --- |
| [T1548](https://attack.mitre.org/techniques/T1548/) | Abuse Elevation Control Mechanism | Defense Evasion |

KillChainPhase.EXPLOITAITON

NistCategory.DE\_AE

Cis18Value.CIS\_10

### Default Configuration

This detection is configured by default in Splunk Enterprise Security to run with the following settings:

| Setting | Value |
| --- | --- |
| Disabled | true |
| Cron Schedule | `0 * * * *` |
| Earliest Time | `-70m@m` |
| Latest Time | `-10m@m` |
| Schedule Window | `auto` |
| Creates Risk Event | False |

This configuration file applies to all detections of type hunting.
### Implementation

Requires access to internal indexes and REST API enabled instances.

### Known False Positives

This is a hunting search and will produce false positives. Operator must follow results into instances where curl requests coming from actual users may indicate intent of exploitation.

### Associated Analytic Story

* [Splunk Vulnerabilities](/stories/splunk_vulnerabilities/)

### Risk Based Analytics (RBA)

| Risk Message | Risk Score | Impact | Confidence |
| --- | --- | --- | --- |
| Possible attempt to access KV Store collections at $host$ | 25 | 50 | 50 |

The Risk Score is calculated by the following formula: Risk Score = (Impact \* Confidence/100). Initial Confidence and Impact is set by the analytic author.
### References

* <https://advisory.splunk.com/advisories/SVD-2024-0105>

### Detection Testing

| Test Type | Status | Dataset | Source | Sourcetype |
| --- | --- | --- | --- | --- |
| Validation | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | N/A | N/A | N/A |
| Unit | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1548/splunk/splunk_enterprise_kv_store_incorrect_authorization_splunkd_access.log) | `/opt/splunk/var/log/splunk/splunkd_access.log` | `splunkd_access` |
| Integration | â Passing | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1548/splunk/splunk_enterprise_kv_store_incorrect_authorization_splunkd_access.log) | `/opt/splunk/var/log/splunk/splunkd_access.log` | `splunkd_access` |

Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)

---

Source: [GitHub](https://github.com/splunk/security_content/tree/develop/detections/application/splunk_enterprise_kv_store_incorrect_authorization.yml) |
Version: **3**

[Detection: Splunk Enterprise Information Disclosure](https://research.splunk.com/deprecated/f6a26b7b-7e80-4963-a9a8-d836e7534ebd/ "Detection: Splunk Enterprise Information Disclosure")

[Detection: Splunk HTTP Response Splitting Via Rest SPL Command](https://research.splunk.com/application/e615a0e1-a1b2-4196-9865-8aa646e1708c/ "Detection: Splunk HTTP Response Splitting Via Rest SPL Command")

Â© 2005 - 2024 Splunk LLC All rights reserved.



=== Content from advisory.splunk.com_a6e1b0d1_20250111_102733.html ===
 [![ ](/assets/img/logo.svg)](https://www.splunk.com/)

* [Home](/)
* [Report a Vulnerability](/report)
* [FAQs](/faqs)
* [Mailing List](https://www.splunk.com/en_us/form/splunk-security-advisories-notification.html)

 Toggle menu

* [Home](/)
* [Report a Vulnerability](/report)
* [FAQs](/faqs)
* [Mailing List](https://www.splunk.com/en_us/form/splunk-security-advisories-notification.html)
# Splunk App Key Value Store (KV Store) Improper Handling of Permissions Leads to KV Store Collection Deletion

**Advisory ID:** SVD-2024-0105

**CVE ID:** [CVE-2024-23675](https://www.cve.org/CVERecord?id=CVE-2024-23675)

**Published:** 2024-01-22

**Last Update:** 2024-01-30

**CVSSv3.1 Score:** 6.5, Medium

**CVSSv3.1 Vector:** [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:N)

**CWE:** [CWE-284](https://cwe.mitre.org/data/definitions/284.html)

**Bug ID:** SPL-246067

## Description

In Splunk Enterprise versions below 9.0.8 and 9.1.3, Splunk app key value store (KV Store) improperly handles permissions for users that use the REST application programming interface (API). This can potentially result in the deletion of KV Store collections.

## Solution

Upgrade Splunk Enterprise to 9.0.8, 9.1.3, or higher.

Splunk is actively monitoring and patching Splunk Cloud Platform instances.

## Product Status

| Product | Version | Component | Affected Version | Fix Version |
| --- | --- | --- | --- | --- |
| Splunk Enterprise | 9.0 | Splunk REST API | 9.0.0 to 9.0.7 | 9.0.8 |
| Splunk Enterprise | 9.1 | Splunk REST API | 9.1.0 to 9.1.2 | 9.1.3 |
| Splunk Cloud | - | Splunk REST API | Versions below 9.1.2312.100 | 9.1.2312.100 |

## Mitigations and Workarounds

Remove the `list_all_objects` capability from users that do not require it. See [Define roles on the Splunk platform with capabilities](https://docs.splunk.com/Documentation/Splunk/latest/Security/Rolesandcapabilities) for more information. If you are not using KV Store, you can disable it. See [Disable the KV store](https://docs.splunk.com/Documentation/Splunk/latest/Admin/AboutKVstore) for more information. Note: removing the list\_all\_objects capability may significantly impair user functionality.

## Detections

* [Splunk Enterprise KV Store Incorrect Authorization](https://research.splunk.com/application/8f0e8380-a835-4f2b-b749-9ce119364df0/)

## Severity

Splunk rates this vulnerability a 6.5, Medium, with a CVSSv3.1 vector of CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:N.

## Acknowledgments

Julian Kaufmann

## Changelog

* 2024-01-26: Added warning to removing list\_all\_objects.

* Email
* [RSS Feed](/feed.xml)
* [Support](https://login.splunk.com/page/sso_redirect?type=portal)
© 2005 - 2025 Splunk Inc. All rights reserved.[Legal](https://www.splunk.com/en_us/legal.html)     [Privacy     [Website Terms of Use](https://www.splunk.com/en_us/legal/terms/terms-of-use.html)](https://www.splunk.com/en_us/legal/privacy/privacy-policy.html)
