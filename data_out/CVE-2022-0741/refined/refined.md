```
{
  "CVE_data_meta": {
    "ID": "CVE-2022-0741",
    "ASSIGNER": "cve@gitlab.com",
    "STATE": "PUBLIC"
  },
  "affects": {
    "vendor": {
      "vendor_data": [
        {
          "vendor_name": "Gitlab",
          "product": {
            "product_data": [
              {
                "product_name": "Gitlab",
                "version": {
                  "version_data": [
                    {
                      "version_value": ">=13.8, <14.8.6"
                    },
                    {
                      "version_value": ">=14.9, <14.9.5"
                    },
					{
                      "version_value": ">=14.10, <14.10.1"
                    }
                  ]
                }
              }
            ]
          }
        }
      ]
    }
  },
  "data_format": "MITRE",
  "data_type": "CVE",
  "data_version": "4.0",
  "description": {
    "description_data": [
      {
        "lang": "eng",
        "value": "An arbitrary command execution vulnerability exists in the mail gem < 2.7.1 and is used in GitLab when configured to use sendmail for email delivery. When sendmail is used as the delivery method, the email address is not properly sanitized and an attacker can use a specially crafted email address with an embedded environment variable which will be expanded by bash. This issue was fixed in versions 14.8.6, 14.9.5, and 14.10.1."
      }
    ]
  },
  "impact": {
    "cvss": {
      "vectorString": "AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N",
      "attackComplexity": "LOW",
      "attackVector": "NETWORK",
      "availabilityImpact": "NONE",
      "confidentialityImpact": "HIGH",
      "integrityImpact": "NONE",
      "privilegesRequired": "LOW",
      "scope": "UNCHANGED",
      "userInteraction": "NONE",
      "version": "3.1",
      "baseScore": 6.5,
      "baseSeverity": "MEDIUM"
    }
  },
  "problemtype": {
    "problemtype_data": [
      {
        "description": [
          {
            "lang": "eng",
            "value": "CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')"
          }
        ]
      }
    ]
  },
  "references": {
    "reference_data": [
      {
        "name": "https://gitlab.com/gitlab-org/cves/-/blob/master/2022/CVE-2022-0741.json",
        "url": "https://gitlab.com/gitlab-org/cves/-/blob/master/2022/CVE-2022-0741.json"
      },
      {
        "name": "https://hackerone.com/reports/1286317",
        "url": "https://hackerone.com/reports/1286317"
      }
    ]
  }
}
```

**Root cause of vulnerability:**
The vulnerability stems from insufficient sanitization of email addresses when the `:sendmail` delivery method is used in the mail gem (version < 2.7.1). Specifically, when the email address is passed to the `sendmail` command, it is processed using `IO.popen` which uses bash if it's the default shell. A specially crafted email address containing a backslash followed by `\001` and a `$` symbol, allows for environment variable expansion by bash.

**Weaknesses/vulnerabilities present:**
- Improper neutralization of special elements used in an OS command (CWE-78) leading to command injection.
- Lack of proper sanitization/validation of email addresses.
- Passing a string to `IO.popen` which causes a shell to be used.

**Impact of exploitation:**
- An attacker can read arbitrary environment variables from the server, if bash is the default shell.
- Exposure of sensitive data like `SECRET_KEY_BASE` or AWS credentials potentially leading to further compromise.

**Attack vectors:**
- Network based attack.
- Attacker injects a crafted email address through the application's email functionality.
- Exploits the default shell being set to bash.

**Required attacker capabilities/position:**
- Requires a low privileged user account in the affected GitLab instance.
- Ability to trigger email functionality within GitLab, e.g. through push notifications.
- Knowledge of the specific format of the malicious email address string.
- Needs to send the email to an attacker-controlled server to capture the leaked variable.