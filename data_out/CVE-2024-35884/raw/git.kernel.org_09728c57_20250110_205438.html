<!DOCTYPE html>
<html lang='en'>
<head>
<title>udp: do not accept non-tunnel GSO skbs landing in a tunnel - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='3001e7aa43d6691db2a878b0745b854bf12ddd19'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='3001e7aa43d6691db2a878b0745b854bf12ddd19'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='3001e7aa43d6691db2a878b0745b854bf12ddd19'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Antoine Tenart &lt;atenart@kernel.org&gt;</td><td class='right'>2024-03-26 12:33:58 +0100</td></tr>
<tr><th>committer</th><td>Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;</td><td class='right'>2024-04-10 16:35:53 +0200</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>3001e7aa43d6691db2a878b0745b854bf12ddd19</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>2c2610242cc2e71e307739c1b1d2dc8d192d2e5e</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a5eae74f39c094af13f98daa49c09149a8f83daa'>a5eae74f39c094af13f98daa49c09149a8f83daa</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3001e7aa43d6691db2a878b0745b854bf12ddd19&amp;id2=a5eae74f39c094af13f98daa49c09149a8f83daa'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3001e7aa43d6691db2a878b0745b854bf12ddd19.tar.gz'>linux-3001e7aa43d6691db2a878b0745b854bf12ddd19.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>udp: do not accept non-tunnel GSO skbs landing in a tunnel</div><div class='commit-msg'>commit 3d010c8031e39f5fa1e8b13ada77e0321091011f upstream.

When rx-udp-gro-forwarding is enabled UDP packets might be GROed when
being forwarded. If such packets might land in a tunnel this can cause
various issues and udp_gro_receive makes sure this isn't the case by
looking for a matching socket. This is performed in
udp4/6_gro_lookup_skb but only in the current netns. This is an issue
with tunneled packets when the endpoint is in another netns. In such
cases the packets will be GROed at the UDP level, which leads to various
issues later on. The same thing can happen with rx-gro-list.

We saw this with geneve packets being GROed at the UDP level. In such
case gso_size is set; later the packet goes through the geneve rx path,
the geneve header is pulled, the offset are adjusted and frag_list skbs
are not adjusted with regard to geneve. When those skbs hit
skb_fragment, it will misbehave. Different outcomes are possible
depending on what the GROed skbs look like; from corrupted packets to
kernel crashes.

One example is a BUG_ON[1] triggered in skb_segment while processing the
frag_list. Because gso_size is wrong (geneve header was pulled)
skb_segment thinks there is "geneve header size" of data in frag_list,
although it's in fact the next packet. The BUG_ON itself has nothing to
do with the issue. This is only one of the potential issues.

Looking up for a matching socket in udp_gro_receive is fragile: the
lookup could be extended to all netns (not speaking about performances)
but nothing prevents those packets from being modified in between and we
could still not find a matching socket. It's OK to keep the current
logic there as it should cover most cases but we also need to make sure
we handle tunnel packets being GROed too early.

This is done by extending the checks in udp_unexpected_gso: GSO packets
lacking the SKB_GSO_UDP_TUNNEL/_CSUM bits and landing in a tunnel must
be segmented.

[1] kernel BUG at net/core/skbuff.c:4408!
    RIP: 0010:skb_segment+0xd2a/0xf70
    __udp_gso_segment+0xaa/0x560

Fixes: 9fd1ff5d2ac7 ("udp: Support UDP fraglist GRO/GSO.")
Fixes: 36707061d6ba ("udp: allow forwarding of plain (non-fraglisted) UDP GRO packets")
Signed-off-by: Antoine Tenart &lt;atenart@kernel.org&gt;
Reviewed-by: Willem de Bruijn &lt;willemb@google.com&gt;
Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;
Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/udp.h?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>include/linux/udp.h</a></td><td class='right'>28</td><td class='graph'><table summary='file diffstat' width='28%'><tr><td class='add' style='width: 100.0%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/ipv4/udp.c?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>net/ipv4/udp.c</a></td><td class='right'>7</td><td class='graph'><table summary='file diffstat' width='28%'><tr><td class='add' style='width: 25.0%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 75.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/ipv4/udp_offload.c?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>net/ipv4/udp_offload.c</a></td><td class='right'>6</td><td class='graph'><table summary='file diffstat' width='28%'><tr><td class='add' style='width: 14.3%;'/><td class='rem' style='width: 7.1%;'/><td class='none' style='width: 78.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/ipv6/udp.c?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>net/ipv6/udp.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='28%'><tr><td class='add' style='width: 3.6%;'/><td class='rem' style='width: 3.6%;'/><td class='none' style='width: 92.9%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>4 files changed, 40 insertions, 3 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/include/linux/udp.h b/include/linux/udp.h<br/>index d04188714dca14..94e63b2695406f 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/udp.h?id=a5eae74f39c094af13f98daa49c09149a8f83daa'>include/linux/udp.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/udp.h?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>include/linux/udp.h</a></div><div class='hunk'>@@ -140,6 +140,24 @@ static inline void udp_cmsg_recv(struct msghdr *msg, struct sock *sk,</div><div class='ctx'> 	}</div><div class='ctx'> }</div><div class='ctx'> </div><div class='add'>+DECLARE_STATIC_KEY_FALSE(udp_encap_needed_key);</div><div class='add'>+#if IS_ENABLED(CONFIG_IPV6)</div><div class='add'>+DECLARE_STATIC_KEY_FALSE(udpv6_encap_needed_key);</div><div class='add'>+#endif</div><div class='add'>+</div><div class='add'>+static inline bool udp_encap_needed(void)</div><div class='add'>+{</div><div class='add'>+	if (static_branch_unlikely(&amp;udp_encap_needed_key))</div><div class='add'>+		return true;</div><div class='add'>+</div><div class='add'>+#if IS_ENABLED(CONFIG_IPV6)</div><div class='add'>+	if (static_branch_unlikely(&amp;udpv6_encap_needed_key))</div><div class='add'>+		return true;</div><div class='add'>+#endif</div><div class='add'>+</div><div class='add'>+	return false;</div><div class='add'>+}</div><div class='add'>+</div><div class='ctx'> static inline bool udp_unexpected_gso(struct sock *sk, struct sk_buff *skb)</div><div class='ctx'> {</div><div class='ctx'> 	if (!skb_is_gso(skb))</div><div class='hunk'>@@ -153,6 +171,16 @@ static inline bool udp_unexpected_gso(struct sock *sk, struct sk_buff *skb)</div><div class='ctx'> 	    !udp_test_bit(ACCEPT_FRAGLIST, sk))</div><div class='ctx'> 		return true;</div><div class='ctx'> </div><div class='add'>+	/* GSO packets lacking the SKB_GSO_UDP_TUNNEL/_CSUM bits might still</div><div class='add'>+	 * land in a tunnel as the socket check in udp_gro_receive cannot be</div><div class='add'>+	 * foolproof.</div><div class='add'>+	 */</div><div class='add'>+	if (udp_encap_needed() &amp;&amp;</div><div class='add'>+	    READ_ONCE(udp_sk(sk)-&gt;encap_rcv) &amp;&amp;</div><div class='add'>+	    !(skb_shinfo(skb)-&gt;gso_type &amp;</div><div class='add'>+	      (SKB_GSO_UDP_TUNNEL | SKB_GSO_UDP_TUNNEL_CSUM)))</div><div class='add'>+		return true;</div><div class='add'>+</div><div class='ctx'> 	return false;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='head'>diff --git a/net/ipv4/udp.c b/net/ipv4/udp.c<br/>index 848072793fa98e..70a9a4a48216e4 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/udp.c?id=a5eae74f39c094af13f98daa49c09149a8f83daa'>net/ipv4/udp.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/udp.c?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>net/ipv4/udp.c</a></div><div class='hunk'>@@ -584,6 +584,13 @@ static inline bool __udp_is_mcast_sock(struct net *net, const struct sock *sk,</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> DEFINE_STATIC_KEY_FALSE(udp_encap_needed_key);</div><div class='add'>+EXPORT_SYMBOL(udp_encap_needed_key);</div><div class='add'>+</div><div class='add'>+#if IS_ENABLED(CONFIG_IPV6)</div><div class='add'>+DEFINE_STATIC_KEY_FALSE(udpv6_encap_needed_key);</div><div class='add'>+EXPORT_SYMBOL(udpv6_encap_needed_key);</div><div class='add'>+#endif</div><div class='add'>+</div><div class='ctx'> void udp_encap_enable(void)</div><div class='ctx'> {</div><div class='ctx'> 	static_branch_inc(&amp;udp_encap_needed_key);</div><div class='head'>diff --git a/net/ipv4/udp_offload.c b/net/ipv4/udp_offload.c<br/>index 0064c9c1c6ead3..4515c3a3d4bb36 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/udp_offload.c?id=a5eae74f39c094af13f98daa49c09149a8f83daa'>net/ipv4/udp_offload.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/udp_offload.c?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>net/ipv4/udp_offload.c</a></div><div class='hunk'>@@ -552,8 +552,10 @@ struct sk_buff *udp_gro_receive(struct list_head *head, struct sk_buff *skb,</div><div class='ctx'> 	unsigned int off = skb_gro_offset(skb);</div><div class='ctx'> 	int flush = 1;</div><div class='ctx'> </div><div class='del'>-	/* we can do L4 aggregation only if the packet can't land in a tunnel</div><div class='del'>-	 * otherwise we could corrupt the inner stream</div><div class='add'>+	/* We can do L4 aggregation only if the packet can't land in a tunnel</div><div class='add'>+	 * otherwise we could corrupt the inner stream. Detecting such packets</div><div class='add'>+	 * cannot be foolproof and the aggregation might still happen in some</div><div class='add'>+	 * cases. Such packets should be caught in udp_unexpected_gso later.</div><div class='ctx'> 	 */</div><div class='ctx'> 	NAPI_GRO_CB(skb)-&gt;is_flist = 0;</div><div class='ctx'> 	if (!sk || !udp_sk(sk)-&gt;gro_receive) {</div><div class='head'>diff --git a/net/ipv6/udp.c b/net/ipv6/udp.c<br/>index 438476a31313cc..d31beb65db08f2 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv6/udp.c?id=a5eae74f39c094af13f98daa49c09149a8f83daa'>net/ipv6/udp.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv6/udp.c?id=3001e7aa43d6691db2a878b0745b854bf12ddd19'>net/ipv6/udp.c</a></div><div class='hunk'>@@ -450,7 +450,7 @@ csum_copy_err:</div><div class='ctx'> 	goto try_again;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='del'>-DEFINE_STATIC_KEY_FALSE(udpv6_encap_needed_key);</div><div class='add'>+DECLARE_STATIC_KEY_FALSE(udpv6_encap_needed_key);</div><div class='ctx'> void udpv6_encap_enable(void)</div><div class='ctx'> {</div><div class='ctx'> 	static_branch_inc(&amp;udpv6_encap_needed_key);</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-10 20:53:15 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
