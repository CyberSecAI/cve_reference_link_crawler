```
{
  "vulnerability": {
    "root_cause": "When rx-udp-gro-forwarding is enabled, UDP packets might be GROed when being forwarded. If such packets land in a tunnel, it can cause issues because udp_gro_receive only checks for matching sockets in the current network namespace (netns). This is problematic with tunneled packets where the endpoint is in a different netns. Packets might be GROed prematurely at the UDP level, leading to issues later on. Specifically, when geneve packets are GROed, the gso_size is set. Later, in the geneve rx path, after the geneve header is pulled and offsets are adjusted, frag_list skbs aren't adjusted relative to the geneve header. When these skbs reach skb_fragment, it causes misbehavior.",
    "weaknesses": [
      "Incorrect handling of GRO packets in tunnels",
      "Lack of netns awareness in udp_gro_receive",
      "Inconsistent offset handling for GRO frag_list skbs in tunnel scenarios"
    ],
    "impact": "Corrupted packets and kernel crashes, including triggering a BUG_ON in skb_segment due to incorrect gso_size.",
    "attack_vectors": "Forwarding of UDP packets, specifically those that could be GROed and then land in a tunnel where the endpoint is in a different netns. The vulnerability is triggered during the processing of GRO'd packets when they hit `skb_fragment` after the tunnel header has been processed.",
    "required_capabilities": "The attacker needs to be able to send or cause UDP packets to be forwarded in a way that triggers GRO and then have them enter a tunnel with an endpoint in another netns. This could involve manipulating network configurations or traffic flows."
  },
  "fix": {
    "description": "The fix extends the checks in udp_unexpected_gso. Now, GSO packets lacking the SKB_GSO_UDP_TUNNEL or SKB_GSO_UDP_TUNNEL_CSUM bits that land in a tunnel are segmented to prevent the described issues.",
        "changes": [
      "Modified `include/linux/udp.h` to include `udp_encap_needed` and extended checks in `udp_unexpected_gso` to segment non-tunnel GSO packets landing in a tunnel.",
      "Modified `net/ipv4/udp.c` to define and export the static keys `udp_encap_needed_key` and `udpv6_encap_needed_key` and included a call to `udp_encap_enable()`. Also, conditional definition and export of udpv6_encap_needed_key for IPv6.",
       "Modified `net/ipv4/udp_offload.c` to prevent L4 aggregation if packets can land in a tunnel.",
      "Modified `net/ipv6/udp.c` to declare the static key `udpv6_encap_needed_key` and included a call to `udpv6_encap_enable()`."
    ]
  }
}
```