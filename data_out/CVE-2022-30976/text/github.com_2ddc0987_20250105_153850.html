
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgpac%2Fgpac%2Fissues%2F2179)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgpac%2Fgpac%2Fissues%2F2179)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=gpac%2Fgpac)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gpac](/gpac)
/
**[gpac](/gpac/gpac)**
Public

* [Notifications](/login?return_to=%2Fgpac%2Fgpac) You must be signed in to change notification settings
* [Fork
  539](/login?return_to=%2Fgpac%2Fgpac)
* [Star
   2.8k](/login?return_to=%2Fgpac%2Fgpac)

* [Code](/gpac/gpac)
* [Issues
  69](/gpac/gpac/issues)
* [Pull requests
  9](/gpac/gpac/pulls)
* [Actions](/gpac/gpac/actions)
* [Wiki](/gpac/gpac/wiki)
* [Security](/gpac/gpac/security)
* [Insights](/gpac/gpac/pulse)

Additional navigation options

* [Code](/gpac/gpac)
* [Issues](/gpac/gpac/issues)
* [Pull requests](/gpac/gpac/pulls)
* [Actions](/gpac/gpac/actions)
* [Wiki](/gpac/gpac/wiki)
* [Security](/gpac/gpac/security)
* [Insights](/gpac/gpac/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgpac%2Fgpac%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgpac%2Fgpac%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [BUG] heap buffer overflow in gf\_utf8\_wcslen, utils/utf.c:442 #2179

Closed

3 tasks done

[kdsjZh](/kdsjZh) opened this issue
Apr 25, 2022
· 4 comments

Closed

3 tasks done

# [[BUG] heap buffer overflow in gf\_utf8\_wcslen, utils/utf.c:442](#top) #2179

[kdsjZh](/kdsjZh) opened this issue
Apr 25, 2022
· 4 comments

## Comments

[![@kdsjZh](https://avatars.githubusercontent.com/u/35988108?s=80&v=4)](/kdsjZh)

Copy link

### **[kdsjZh](/kdsjZh)** commented [Apr 25, 2022](#issue-1214594854) • edited Loading

| Thanks for reporting your issue. Please make sure these boxes are checked before submitting your issue - thank you!   * I looked for a similar issue and couldn't find any. * I tried with the latest version of GPAC. Installers available at <http://gpac.io/downloads/gpac-nightly-builds/> * I give enough information for contributors to reproduce my issue (meaningful title, github labels, platform and compiler, command-line ...). I can share files anonymously with this dropbox: <https://www.mediafire.com/filedrop/filedrop_hosted.php?drop=eec9e058a9486fe4e99c33021481d9e1826ca9dbc242a6cfaab0fe95da5e5d95>   Detailed guidelines: <http://gpac.io/2013/07/16/how-to-file-a-bug-properly/> Describe the bug There is a heap-overflow bug in gf\_utf8\_wcslen, utils/utf.c:442, can be triggered via MP4Box+ ASan Step to reproduce ./configure --enable-sanitizer && make -j$(nproc) ./MP4Box -diso poc Sanitizer output ``` [isom] invalid tag size in Xtra ! [isom] not enough bytes in box Xtra: 4 left, reading 8 (file isomedia/box_code_base.c, line 12849), skipping box [iso file] Box "Xtra" (start 24) has 4 extra bytes [iso file] Read Box type 00000001 (0x00000001) at position 92 has size 0 but is not at root/file level. Forbidden, skipping end of parent box ! [iso file] Box "moof" (start 84) has 8 extra bytes [iso file] Movie fragment but no moov (yet) - possibly broken parsing! [iso file] Box "vwid" (start 204) has 5 extra bytes [iso file] Unknown top-level box type 00000B01 [iso file] Incomplete box 00000B01 - start 264 size 34164724 [iso file] Incomplete file while reading for dump - aborting parsing ================================================================= ==2183542==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6020000011d6 at pc 0x7f95a4f4ec68 bp 0x7ffdfa692370 sp 0x7ffdfa692360 READ of size 2 at 0x6020000011d6 thread T0     #0 0x7f95a4f4ec67 in gf_utf8_wcslen utils/utf.c:442     #1 0x7f95a4f4ec67 in gf_utf8_wcslen utils/utf.c:438     #2 0x7f95a542a073 in xtra_box_dump isomedia/box_dump.c:6471     #3 0x7f95a543161d in gf_isom_box_dump isomedia/box_funcs.c:2108     #4 0x7f95a53f7dd9 in gf_isom_dump isomedia/box_dump.c:138     #5 0x55aea7254fbc in dump_isom_xml /home/hzheng/real-validate/gpac/applications/mp4box/filedump.c:2053     #6 0x55aea7239707 in mp4boxMain /home/hzheng/real-validate/gpac/applications/mp4box/main.c:6177     #7 0x7f95a2a160b2 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x270b2)     #8 0x55aea7215aed in _start (/home/hzheng/real-validate/gpac/bin/gcc/MP4Box+0xa9aed)  0x6020000011d6 is located 0 bytes to the right of 6-byte region [0x6020000011d0,0x6020000011d6) allocated by thread T0 here:     #0 0x7f95a8767bc8 in malloc (/lib/x86_64-linux-gnu/libasan.so.5+0x10dbc8)     #1 0x7f95a53dc17b in xtra_box_read isomedia/box_code_base.c:12875     #2 0x7f95a542d3c3 in gf_isom_box_read isomedia/box_funcs.c:1860     #3 0x7f95a542d3c3 in gf_isom_box_parse_ex isomedia/box_funcs.c:271     #4 0x7f95a542e815 in gf_isom_parse_root_box isomedia/box_funcs.c:38     #5 0x7f95a545789c in gf_isom_parse_movie_boxes_internal isomedia/isom_intern.c:373     #6 0x7f95a545da0f in gf_isom_parse_movie_boxes isomedia/isom_intern.c:860     #7 0x7f95a545da0f in gf_isom_open_file isomedia/isom_intern.c:980     #8 0x55aea723f1ed in mp4boxMain /home/hzheng/real-validate/gpac/applications/mp4box/main.c:5990     #9 0x7f95a2a160b2 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x270b2)  SUMMARY: AddressSanitizer: heap-buffer-overflow utils/utf.c:442 in gf_utf8_wcslen Shadow bytes around the buggy address:   0x0c047fff81e0: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd   0x0c047fff81f0: fa fa 00 07 fa fa 07 fa fa fa fd fa fa fa 04 fa   0x0c047fff8200: fa fa 00 02 fa fa fd fa fa fa 00 07 fa fa 00 00   0x0c047fff8210: fa fa 00 00 fa fa 00 fa fa fa fd fa fa fa 00 04   0x0c047fff8220: fa fa 00 00 fa fa 00 fa fa fa 00 00 fa fa 01 fa =>0x0c047fff8230: fa fa 06 fa fa fa 01 fa fa fa[06]fa fa fa 00 00   0x0c047fff8240: fa fa fd fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8250: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8260: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8270: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07   Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==2183542==ABORTING  ``` version system: ubuntu 20.04.3 LTS compiler: gcc 9.3.0 gpac version: latest commit [a4015fa](https://github.com/gpac/gpac/commit/a4015fa4fc99fd3e7a62be0fe6bd565e1dded030) Credit Han Zheng [NCNIPC of China](http://www.nipc.org.cn) [Hexhive](http://hexhive.epfl.ch/) POC [POC.zip](https://github.com/gpac/gpac/files/8555402/POC.zip) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@jeanlf](https://avatars.githubusercontent.com/u/7303785?s=40&u=ce6412ab09b4167cc0f18fd9617d6c17a5d3ce22&v=4)](/jeanlf)
[jeanlf](/jeanlf)
closed this as [completed](/gpac/gpac/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[915e2cb](/gpac/gpac/commit/915e2cba715f36b7cc29e28888117831ca143d78)`
[May 16, 2022](#event-6614923015)

[![@Kenurshan](https://avatars.githubusercontent.com/u/49789464?s=80&u=a499b732e450e1851020bf8fc33b5e37c10915a2&v=4)](/Kenurshan)

Copy link

### **[Kenurshan](/Kenurshan)** commented [Feb 21, 2023](#issuecomment-1438860210) • edited Loading

| [@jeanlf](https://github.com/jeanlf) [@kdsjZh](https://github.com/kdsjZh)   * I need to see the fixed code and vulnerable one. * This shows a different file and function.[915e2cb](https://github.com/gpac/gpac/commit/915e2cba715f36b7cc29e28888117831ca143d78). * But, the vulnerability in file "utils/utf.c" and "Unicode utf8\_wcslen" (renamed gf\_utf8\_wcslen) function. * So, please give a clarification, if I am wrong   [image](https://user-images.githubusercontent.com/49789464/220418566-1ca8a91d-70e9-44fa-aeed-b8c41ef38020.png) |
| --- |

All reactions

Sorry, something went wrong.

[![@rbouqueau](https://avatars.githubusercontent.com/u/1917976?s=80&u=cb4a34c6a8b16b5521943ea81279354b049be57b&v=4)](/rbouqueau)

Copy link

Member

### **[rbouqueau](/rbouqueau)** commented [Feb 22, 2023](#issuecomment-1439775431)

| The fix seems to fix the `xtra`bug but do not obviously address the heap-buffer-overflow in `gf_utf8_wcslen()`. Re-opening for further checks. |
| --- |

All reactions

Sorry, something went wrong.

[![@rbouqueau](https://avatars.githubusercontent.com/u/1917976?s=40&u=cb4a34c6a8b16b5521943ea81279354b049be57b&v=4)](/rbouqueau)
[rbouqueau](/rbouqueau)
reopened this
[Feb 22, 2023](#event-8579466028)

[![@Kenurshan](https://avatars.githubusercontent.com/u/49789464?s=80&u=a499b732e450e1851020bf8fc33b5e37c10915a2&v=4)](/Kenurshan)

Copy link

### **[Kenurshan](/Kenurshan)** commented [Feb 22, 2023](#issuecomment-1440073766) • edited Loading

| [@rbouqueau](https://github.com/rbouqueau) Thank you for your response!   * I also noticed, that the "wcslen" function in gpac/src/utils/utf.c:756, which is also referred as unsecured function by Microsoft. Some of the secured versions are [wcsnlen, wcsnlen\_s,](https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/strnlen-strnlen-s?view=msvc-170) |
| --- |

All reactions

Sorry, something went wrong.

[![@jeanlf](https://avatars.githubusercontent.com/u/7303785?s=80&u=ce6412ab09b4167cc0f18fd9617d6c17a5d3ce22&v=4)](/jeanlf)

Copy link

Member

### **[jeanlf](/jeanlf)** commented [Mar 7, 2023](#issuecomment-1458100295)

| [@Kenurshan](https://github.com/Kenurshan) [@rbouqueau](https://github.com/rbouqueau)  gf\_utf8\_wcslen is not memory guarded, it assumes the caller uses a properly allocated buffer of short with a terminating NULL (last 2 bytes at 0) which is supposed to be the case in libgpac - the issue was that xtra box was not following this, resulting in the crash.  same goes for gf\_wcs\_to\_utf8 (calling wcslen), caller has to make sure the string is properly formated.  Closing, if you see any other crash involving these please let us know.  If needed, we may introduce a gf\_utf16\_is\_legal at some point. |
| --- |

All reactions

Sorry, something went wrong.

[![@jeanlf](https://avatars.githubusercontent.com/u/7303785?s=40&u=ce6412ab09b4167cc0f18fd9617d6c17a5d3ce22&v=4)](/jeanlf)
[jeanlf](/jeanlf)
closed this as [completed](/gpac/gpac/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Mar 7, 2023](#event-8685246723)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fgpac%2Fgpac%2Fissues%2F2179)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

4 participants

[![@rbouqueau](https://avatars.githubusercontent.com/u/1917976?s=52&v=4)](/rbouqueau) [![@jeanlf](https://avatars.githubusercontent.com/u/7303785?s=52&v=4)](/jeanlf) [![@kdsjZh](https://avatars.githubusercontent.com/u/35988108?s=52&v=4)](/kdsjZh) [![@Kenurshan](https://avatars.githubusercontent.com/u/49789464?s=52&v=4)](/Kenurshan)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

