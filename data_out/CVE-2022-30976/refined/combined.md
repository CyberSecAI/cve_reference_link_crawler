=== Content from github.com_2ddc0987_20250108_111330.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgpac%2Fgpac%2Fissues%2F2179)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgpac%2Fgpac%2Fissues%2F2179)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=gpac%2Fgpac)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gpac](/gpac)
/
**[gpac](/gpac/gpac)**
Public

* [Notifications](/login?return_to=%2Fgpac%2Fgpac) You must be signed in to change notification settings
* [Fork
  539](/login?return_to=%2Fgpac%2Fgpac)
* [Star
   2.8k](/login?return_to=%2Fgpac%2Fgpac)

* [Code](/gpac/gpac)
* [Issues
  71](/gpac/gpac/issues)
* [Pull requests
  11](/gpac/gpac/pulls)
* [Actions](/gpac/gpac/actions)
* [Wiki](/gpac/gpac/wiki)
* [Security](/gpac/gpac/security)
* [Insights](/gpac/gpac/pulse)

Additional navigation options

* [Code](/gpac/gpac)
* [Issues](/gpac/gpac/issues)
* [Pull requests](/gpac/gpac/pulls)
* [Actions](/gpac/gpac/actions)
* [Wiki](/gpac/gpac/wiki)
* [Security](/gpac/gpac/security)
* [Insights](/gpac/gpac/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgpac%2Fgpac%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgpac%2Fgpac%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [BUG] heap buffer overflow in gf\_utf8\_wcslen, utils/utf.c:442 #2179

Closed

3 tasks done

[kdsjZh](/kdsjZh) opened this issue
Apr 25, 2022
· 4 comments

Closed

3 tasks done

# [[BUG] heap buffer overflow in gf\_utf8\_wcslen, utils/utf.c:442](#top) #2179

[kdsjZh](/kdsjZh) opened this issue
Apr 25, 2022
· 4 comments

## Comments

[![@kdsjZh](https://avatars.githubusercontent.com/u/35988108?s=80&v=4)](/kdsjZh)

Copy link

### **[kdsjZh](/kdsjZh)** commented [Apr 25, 2022](#issue-1214594854) • edited Loading

| Thanks for reporting your issue. Please make sure these boxes are checked before submitting your issue - thank you!   * I looked for a similar issue and couldn't find any. * I tried with the latest version of GPAC. Installers available at <http://gpac.io/downloads/gpac-nightly-builds/> * I give enough information for contributors to reproduce my issue (meaningful title, github labels, platform and compiler, command-line ...). I can share files anonymously with this dropbox: <https://www.mediafire.com/filedrop/filedrop_hosted.php?drop=eec9e058a9486fe4e99c33021481d9e1826ca9dbc242a6cfaab0fe95da5e5d95>   Detailed guidelines: <http://gpac.io/2013/07/16/how-to-file-a-bug-properly/> Describe the bug There is a heap-overflow bug in gf\_utf8\_wcslen, utils/utf.c:442, can be triggered via MP4Box+ ASan Step to reproduce ./configure --enable-sanitizer && make -j$(nproc) ./MP4Box -diso poc Sanitizer output ``` [isom] invalid tag size in Xtra ! [isom] not enough bytes in box Xtra: 4 left, reading 8 (file isomedia/box_code_base.c, line 12849), skipping box [iso file] Box "Xtra" (start 24) has 4 extra bytes [iso file] Read Box type 00000001 (0x00000001) at position 92 has size 0 but is not at root/file level. Forbidden, skipping end of parent box ! [iso file] Box "moof" (start 84) has 8 extra bytes [iso file] Movie fragment but no moov (yet) - possibly broken parsing! [iso file] Box "vwid" (start 204) has 5 extra bytes [iso file] Unknown top-level box type 00000B01 [iso file] Incomplete box 00000B01 - start 264 size 34164724 [iso file] Incomplete file while reading for dump - aborting parsing ================================================================= ==2183542==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6020000011d6 at pc 0x7f95a4f4ec68 bp 0x7ffdfa692370 sp 0x7ffdfa692360 READ of size 2 at 0x6020000011d6 thread T0     #0 0x7f95a4f4ec67 in gf_utf8_wcslen utils/utf.c:442     #1 0x7f95a4f4ec67 in gf_utf8_wcslen utils/utf.c:438     #2 0x7f95a542a073 in xtra_box_dump isomedia/box_dump.c:6471     #3 0x7f95a543161d in gf_isom_box_dump isomedia/box_funcs.c:2108     #4 0x7f95a53f7dd9 in gf_isom_dump isomedia/box_dump.c:138     #5 0x55aea7254fbc in dump_isom_xml /home/hzheng/real-validate/gpac/applications/mp4box/filedump.c:2053     #6 0x55aea7239707 in mp4boxMain /home/hzheng/real-validate/gpac/applications/mp4box/main.c:6177     #7 0x7f95a2a160b2 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x270b2)     #8 0x55aea7215aed in _start (/home/hzheng/real-validate/gpac/bin/gcc/MP4Box+0xa9aed)  0x6020000011d6 is located 0 bytes to the right of 6-byte region [0x6020000011d0,0x6020000011d6) allocated by thread T0 here:     #0 0x7f95a8767bc8 in malloc (/lib/x86_64-linux-gnu/libasan.so.5+0x10dbc8)     #1 0x7f95a53dc17b in xtra_box_read isomedia/box_code_base.c:12875     #2 0x7f95a542d3c3 in gf_isom_box_read isomedia/box_funcs.c:1860     #3 0x7f95a542d3c3 in gf_isom_box_parse_ex isomedia/box_funcs.c:271     #4 0x7f95a542e815 in gf_isom_parse_root_box isomedia/box_funcs.c:38     #5 0x7f95a545789c in gf_isom_parse_movie_boxes_internal isomedia/isom_intern.c:373     #6 0x7f95a545da0f in gf_isom_parse_movie_boxes isomedia/isom_intern.c:860     #7 0x7f95a545da0f in gf_isom_open_file isomedia/isom_intern.c:980     #8 0x55aea723f1ed in mp4boxMain /home/hzheng/real-validate/gpac/applications/mp4box/main.c:5990     #9 0x7f95a2a160b2 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x270b2)  SUMMARY: AddressSanitizer: heap-buffer-overflow utils/utf.c:442 in gf_utf8_wcslen Shadow bytes around the buggy address:   0x0c047fff81e0: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd   0x0c047fff81f0: fa fa 00 07 fa fa 07 fa fa fa fd fa fa fa 04 fa   0x0c047fff8200: fa fa 00 02 fa fa fd fa fa fa 00 07 fa fa 00 00   0x0c047fff8210: fa fa 00 00 fa fa 00 fa fa fa fd fa fa fa 00 04   0x0c047fff8220: fa fa 00 00 fa fa 00 fa fa fa 00 00 fa fa 01 fa =>0x0c047fff8230: fa fa 06 fa fa fa 01 fa fa fa[06]fa fa fa 00 00   0x0c047fff8240: fa fa fd fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8250: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8260: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8270: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07   Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==2183542==ABORTING  ``` version system: ubuntu 20.04.3 LTS compiler: gcc 9.3.0 gpac version: latest commit [a4015fa](https://github.com/gpac/gpac/commit/a4015fa4fc99fd3e7a62be0fe6bd565e1dded030) Credit Han Zheng [NCNIPC of China](http://www.nipc.org.cn) [Hexhive](http://hexhive.epfl.ch/) POC [POC.zip](https://github.com/gpac/gpac/files/8555402/POC.zip) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@jeanlf](https://avatars.githubusercontent.com/u/7303785?s=40&u=ce6412ab09b4167cc0f18fd9617d6c17a5d3ce22&v=4)](/jeanlf)
[jeanlf](/jeanlf)
closed this as [completed](/gpac/gpac/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[915e2cb](/gpac/gpac/commit/915e2cba715f36b7cc29e28888117831ca143d78)`
[May 16, 2022](#event-6614923015)

[![@Kenurshan](https://avatars.githubusercontent.com/u/49789464?s=80&u=a499b732e450e1851020bf8fc33b5e37c10915a2&v=4)](/Kenurshan)

Copy link

### **[Kenurshan](/Kenurshan)** commented [Feb 21, 2023](#issuecomment-1438860210) • edited Loading

| [@jeanlf](https://github.com/jeanlf) [@kdsjZh](https://github.com/kdsjZh)   * I need to see the fixed code and vulnerable one. * This shows a different file and function.[915e2cb](https://github.com/gpac/gpac/commit/915e2cba715f36b7cc29e28888117831ca143d78). * But, the vulnerability in file "utils/utf.c" and "Unicode utf8\_wcslen" (renamed gf\_utf8\_wcslen) function. * So, please give a clarification, if I am wrong   [image](https://user-images.githubusercontent.com/49789464/220418566-1ca8a91d-70e9-44fa-aeed-b8c41ef38020.png) |
| --- |

All reactions

Sorry, something went wrong.

[![@rbouqueau](https://avatars.githubusercontent.com/u/1917976?s=80&u=cb4a34c6a8b16b5521943ea81279354b049be57b&v=4)](/rbouqueau)

Copy link

Member

### **[rbouqueau](/rbouqueau)** commented [Feb 22, 2023](#issuecomment-1439775431)

| The fix seems to fix the `xtra`bug but do not obviously address the heap-buffer-overflow in `gf_utf8_wcslen()`. Re-opening for further checks. |
| --- |

All reactions

Sorry, something went wrong.

[![@rbouqueau](https://avatars.githubusercontent.com/u/1917976?s=40&u=cb4a34c6a8b16b5521943ea81279354b049be57b&v=4)](/rbouqueau)
[rbouqueau](/rbouqueau)
reopened this
[Feb 22, 2023](#event-8579466028)

[![@Kenurshan](https://avatars.githubusercontent.com/u/49789464?s=80&u=a499b732e450e1851020bf8fc33b5e37c10915a2&v=4)](/Kenurshan)

Copy link

### **[Kenurshan](/Kenurshan)** commented [Feb 22, 2023](#issuecomment-1440073766) • edited Loading

| [@rbouqueau](https://github.com/rbouqueau) Thank you for your response!   * I also noticed, that the "wcslen" function in gpac/src/utils/utf.c:756, which is also referred as unsecured function by Microsoft. Some of the secured versions are [wcsnlen, wcsnlen\_s,](https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/strnlen-strnlen-s?view=msvc-170) |
| --- |

All reactions

Sorry, something went wrong.

[![@jeanlf](https://avatars.githubusercontent.com/u/7303785?s=80&u=ce6412ab09b4167cc0f18fd9617d6c17a5d3ce22&v=4)](/jeanlf)

Copy link

Member

### **[jeanlf](/jeanlf)** commented [Mar 7, 2023](#issuecomment-1458100295)

| [@Kenurshan](https://github.com/Kenurshan) [@rbouqueau](https://github.com/rbouqueau)  gf\_utf8\_wcslen is not memory guarded, it assumes the caller uses a properly allocated buffer of short with a terminating NULL (last 2 bytes at 0) which is supposed to be the case in libgpac - the issue was that xtra box was not following this, resulting in the crash.  same goes for gf\_wcs\_to\_utf8 (calling wcslen), caller has to make sure the string is properly formated.  Closing, if you see any other crash involving these please let us know.  If needed, we may introduce a gf\_utf16\_is\_legal at some point. |
| --- |

All reactions

Sorry, something went wrong.

[![@jeanlf](https://avatars.githubusercontent.com/u/7303785?s=40&u=ce6412ab09b4167cc0f18fd9617d6c17a5d3ce22&v=4)](/jeanlf)
[jeanlf](/jeanlf)
closed this as [completed](/gpac/gpac/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Mar 7, 2023](#event-8685246723)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fgpac%2Fgpac%2Fissues%2F2179)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

4 participants

[![@rbouqueau](https://avatars.githubusercontent.com/u/1917976?s=52&v=4)](/rbouqueau) [![@jeanlf](https://avatars.githubusercontent.com/u/7303785?s=52&v=4)](/jeanlf) [![@kdsjZh](https://avatars.githubusercontent.com/u/35988108?s=52&v=4)](/kdsjZh) [![@Kenurshan](https://avatars.githubusercontent.com/u/49789464?s=52&v=4)](/Kenurshan)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_44f88a42_20250108_111327.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgpac%2Fgpac%2Fblob%2F105d67985ff3c3f4b98a98f312e3d84ae77a4463%2Fshare%2Fdoc%2Fman%2Fgpac.1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgpac%2Fgpac%2Fblob%2F105d67985ff3c3f4b98a98f312e3d84ae77a4463%2Fshare%2Fdoc%2Fman%2Fgpac.1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=gpac%2Fgpac)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gpac](/gpac)
/
**[gpac](/gpac/gpac)**
Public

* [Notifications](/login?return_to=%2Fgpac%2Fgpac) You must be signed in to change notification settings
* [Fork
  539](/login?return_to=%2Fgpac%2Fgpac)
* [Star
   2.8k](/login?return_to=%2Fgpac%2Fgpac)

* [Code](/gpac/gpac)
* [Issues
  71](/gpac/gpac/issues)
* [Pull requests
  11](/gpac/gpac/pulls)
* [Actions](/gpac/gpac/actions)
* [Wiki](/gpac/gpac/wiki)
* [Security](/gpac/gpac/security)
* [Insights](/gpac/gpac/pulse)

Additional navigation options

* [Code](/gpac/gpac)
* [Issues](/gpac/gpac/issues)
* [Pull requests](/gpac/gpac/pulls)
* [Actions](/gpac/gpac/actions)
* [Wiki](/gpac/gpac/wiki)
* [Security](/gpac/gpac/security)
* [Insights](/gpac/gpac/pulse)

## Files

 105d679
## Breadcrumbs

1. [gpac](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463)
2. /[share](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463/share)
3. /[doc](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463/share/doc)
4. /[man](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463/share/doc/man)
/
# gpac.1

 Blame  Blame
## Latest commit

## History

[History](/gpac/gpac/commits/105d67985ff3c3f4b98a98f312e3d84ae77a4463/share/doc/man/gpac.1)4710 lines (4556 loc) · 95.4 KB 105d679
## Breadcrumbs

1. [gpac](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463)
2. /[share](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463/share)
3. /[doc](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463/share/doc)
4. /[man](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463/share/doc/man)
/
# gpac.1

Top
## File metadata and controls

* Code
* Blame

4710 lines (4556 loc) · 95.4 KB[Raw](https://github.com/gpac/gpac/raw/105d67985ff3c3f4b98a98f312e3d84ae77a4463/share/doc/man/gpac.1)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000.TH gpac 1 2019 gpac GPAC..SH NAME.LPgpac \- GPAC command-line filter session manager.SH SYNOPSIS.LP.B gpac.RI [options] FILTER [LINK] FILTER [...].br.gpac is GPAC's command line tool for setting up and running filter chains..br
.brFILTER: a single filter declaration (e.g., -i file, -o dump, inspect, ...), see gpac -h doc..br[LINK]: a link instruction (e.g., @, @2, @2#StreamType=Visual, ...), see gpac -h doc..br[options]: one or more option strings, each starting with a - character..br - an option using a single - indicates an option of gpac (see gpac -hx) or of libgpac (see gpac -hx core).br - an option using -- indicates a global filter or meta-filter (e.g. FFMPEG) option, e.g. --block\_size=1000 or --profile=Baseline (see gpac -h doc).br .brFilter declaration order may impact the link resolver which will try linking in declaration order. Most of the time for simple graphs, this has no impact. However, for complex graphs with no link declarations, this can lead to different results. .brOptions do not require any specific order, and may be present anywhere, including between link statements or filter declarations. .brBoolean values do not need any value specified. Other types shall be formatted as opt=val, except .I -i, -src, .I -o, -dst and .I -h options..br
.brThe session can be interrupted at any time using ctrl+c, which can also be used to toggle global reporting..br
.brThe possible options for gpac are:.br
.br.TP.B \-mem-track.brenable memory tracker.br.TP.B \-mem-track-stack.brenable memory tracker with stack dumping.br.TP.B \-ltf.brload test-unit filters (used for for unit tests only).br.TP.B \-sloop (int).brloop execution of session, creating a session at each loop, mainly used for testing. If no value is given, loops forever.br.TP.B \-runfor (int).brrun for the given amount of milliseconds.br.TP.B \-runforx (int).brrun for the given amount of milliseconds and exit with no cleanup.br.TP.B \-runfors (int).brrun for the given amount of milliseconds and exit with segfault (tests).br.TP.B \-runforl (int).brrun for the given amount of milliseconds and wait forever at end (tests).br.TP.B \-stats.brprint stats after execution.br.TP.B \-graph.brprint graph after execution.br.TP.B \-k.brenable keyboard interaction from command line.br.TP.B \-r (string).brenable reporting.br\* r: runtime reporting.br\* r=FA[,FB]: runtime reporting but only print given filters, e.g. r=mp4mx for ISOBMFF multiplexer only.br\* r=: only print final report.br.TP.B \-seps (string, default: :=#,!@).brset the default character sets used to separate various arguments.br- the first char is used to separate argument names.br- the second char, if present, is used to separate names and values.br- the third char, if present, is used to separate fragments for PID sources.br- the fourth char, if present, is used for list separators (sourceIDs, gfreg, ...).br- the fifth char, if present, is used for boolean negation.br- the sixth char, if present, is used for LINK directives (see filters help (-h doc)).br.TP.B \-i,-src (string).brspecify an input file - see filters help (-h doc).br.TP.B \-o,-dst (string).brspecify an output file - see filters help (-h doc).br.TP.B \-ib (string).brspecify an input file to wrap as GF\_FileIO object (testing of GF\_FileIO).br.TP.B \-ob (string).brspecify an output file to wrap as GF\_FileIO object (testing of GF\_FileIO).br.TP.B \-cl.brforce complete mode when no link directive are set - see filters help (-h doc).br.TP.B \-step.brtest step mode in non-blocking session.br.TP.B \-h,-help,-ha,-hx,-hh (string).brprint help. Use -help or -h for basic options, -ha for advanced options, -hx for expert options and -hh for all. .brNote: The @ character can be used in place of the \* character. String parameter can be:.br\* empty: print command line options help.br\* doc: print the general filter info.br\* alias: print the gpac alias syntax.br\* log: print the log system help.br\* core: print the supported libgpac core options. Use -ha/-hx/-hh for advanced/expert options.br\* cfg: print the GPAC configuration help.br\* prompt: print the GPAC prompt help when running in interactive mode (see .I -k ).br\* modules: print available modules.br\* filters: print name of all available filters.br\* filters:\*: print name of all available filters, including meta filters.br\* codecs: print the supported builtin codecs - use -hx to include unmapped codecs (ffmpeg, ...).br\* props: print the supported builtin PID and packet properties.br\* props PNAME: print the supported builtin PID and packet properties mentioning PNAME.br\* colors: print the builtin color names and their values.br\* exts: print the builtin extensions and mime types - use -hx to include meta filters (ffmpeg, ...).br\* layouts: print the builtin CICP audio channel layout names and their values.br\* links: print possible connections between each supported filters (use -hx to view src->dst cap bundle detail).br\* links FNAME: print sources and sinks for filter FNAME (either builtin or JS filter).br\* FNAME: print filter FNAME info (multiple FNAME can be given).br - For meta-filters, use FNAME:INST, e.g. ffavin:avfoundation.br - Use \* to print info on all filters (big output!), \*:\* to print info on all filters including meta filter instances (really big output!).br - By default only basic filter options and description are shown. Use -ha to show advanced options capabilities, -hx for expert options, -hh for all options and filter capabilities including on filters disabled in this build.br\* FNAME.OPT: print option OPT in filter FNAME.br\* OPT: look in filter names and options for OPT and suggest possible matches if none found. Use -hx to look for keyword in all option descriptions.br
.br.TP.B \-p (string).bruse indicated profile for the global GPAC config. If not found, config file is created. If a file path is indicated, this will load profile from that file. Otherwise, this will create a directory of the specified name and store new config there. Reserved name 0 means a new profile, not stored to disk. Appending :reload to the profile name will force recreating a new configuration file.br.TP.B \-alias (string).brassign a new alias or remove an alias. Can be specified several times. See alias usage (-h alias).br.TP.B \-aliasdoc (string).brassign documentation for a given alias (optional). Can be specified several times.br.TP.B \-uncache.brrevert all items in GPAC cache directory to their original name and server path.br.TP.B \-js (string).brspecify javascript file to use as controller of filter session.br.TP.B \-wc.brwrite all core options in the config file unless already set.br.TP.B \-we.brwrite all file extensions in the config file unless already set (useful to change some default file extensions).br.TP.B \-wf.brwrite all filter options in the config file unless already set.br.TP.B \-wfx.brwrite all filter options and all meta filter arguments in the config file unless already set (large config file !).br.TP.B \-xopt.brunrecognized options and filters declaration following this option are ignored - used to pass arguments to GUI.br
.br .brThe following libgpac core options allow customizing the filter session:.br .br.TP.B \-dbg-edges.brlog edges status in filter graph before dijkstra resolution (for debug). Edges are logged as edge\_source(status, weight, src\_cap\_idx, dst\_cap\_idx).br.TP.B \-full-link.brthrow error if any PID in the filter graph cannot be linked.br.TP.B \-no-block (Enum, default: no).brdisable blocking mode of filters.br\* no: enable blocking mode.br\* fanout: disable blocking on fan-out, unblocking the PID as soon as one of its destinations requires a packet.br\* all: disable blocking.br.TP.B \-no-reg.brdisable regulation (no sleep) in session.br.TP.B \-no-reassign.brdisable source filter reassignment in PID graph resolution.br.TP.B \-sched (Enum, default: free).brset scheduler mode.br\* free: lock-free queues except for task list (default).br\* lock: mutexes for queues when several threads.br\* freex: lock-free queues including for task lists (experimental).br\* flock: mutexes for queues even when no thread (debug mode).br\* direct: no threads and direct dispatch of tasks whenever possible (debug mode).br.TP.B \-max-chain (int, default: 6).brset maximum chain length when resolving filter links. Default value covers for [ in -> ] dmx -> reframe -> decode -> encode -> reframe -> mx [ -> out]. Filter chains loaded for adaptation (e.g. pixel format change) are loaded after the link resolution. Setting the value to 0 disables dynamic link resolution. You will have to specify the entire chain manually.br.TP.B \-max-sleep (int, default: 50).brset maximum sleep time slot in milliseconds when regulation is enabled.br.TP.B \-threads (int).brset N extra thread for the session. -1 means use all available cores.br.TP.B \-no-probe.brdisable data probing on sources and relies on extension (faster load but more error-prone).br.TP.B \-no-argchk.brdisable tracking of argument usage (all arguments will be considered as used).br.TP.B \-blacklist (string).brblacklist the filters listed in the given string (comma-separated list). If first character is '-', this is a whitelist, i.e. only filters listed in the given string will be allowed.br.TP.B \-no-graph-cache.brdisable internal caching of filter graph connections. If disabled, the graph will be recomputed at each link resolution (lower memory usage but slower).br.TP.B \-no-reservoir.brdisable memory recycling for packets and properties. This uses much less memory but stresses the system memory allocator much more.br.SH Using Aliases.PLThe gpac command line can become quite complex when many sources or filters are used. In order to simplify this, an alias system is provided..br
.brTo assign an alias, use the syntax gpac -alias="NAME VALUE"..br\* `NAME`: shall be a single string, with no space..br\* `VALUE`: the list of argument this alias replaces. If not set, the alias is destroyed.br
.brWhen parsing arguments, the alias will be replace by its value..brExample.brgpac -alias="output aout vout".br
.brThis allows later audio and video playback using gpac -i src.mp4 output.br
.brAliases can use arguments from the command line. The allowed syntaxes are:.br\* `@{a}`: replaced by the value of the argument with index a after the alias.br\* `@{a,b}`: replaced by the value of the arguments with index a and b.br\* `@{a:b}`: replaced by the value of the arguments between index a and b.br\* `@{-a,b}`: replaced by the value of the arguments with index a and b, inserting a list separator (comma by default) between them.br\* `@{-a:b}`: replaced by the value of the arguments between index a and b, inserting a list separator (comma by default) between them.br\* `@{+a,b}`: clones the parent word in the alias for a and b, replacing this pattern in each clone by the corresponding argument.br\* `@{+a:b}`: clones the parent word in the alias for each argument between index a and b, replacing this pattern in each clone by the corresponding argument.br
.brThe specified index can be:.br\* forward index: a strictly positive integer, 1 being the first argument after the alias.br\* backward index: the value 'n' (or 'N') to indicate the last argument on the command line. This can be followed by -x to rewind arguments (e.g. @{n-1} is the before last argument).br
.brBefore solving aliases, all option arguments are moved at the beginning of the command line. This implies that alias arguments cannot be options..brArguments not used by any aliases are kept on the command line, other ones are removed.br
.brExample.br-alias="foo src=@{N} dst=test.mp4".br
.brThe command gpac foo f1 f2 expands to gpac src=f2 dst=test.mp4 f1.brExample.br-alias="list: inspect src=@{+:N}".br
.brThe command gpac list f1 f2 f3 expands to gpac inspect src=f1 src=f2 src=f3.brExample.br-alias="list inspect src=@{+2:N}".br
.brThe command gpac list f1 f2 f3 expands to gpac inspect src=f2 src=f3 f1.brExample.br-alias="plist aout vout flist:srcs=@{-,N}".br
.brThe command gpac plist f1 f2 f3 expands to gpac aout vout flist:srcs="f1,f2,f3" .br
.brAlias documentation can be set using gpac -aliasdoc="NAME VALUE", with NAME the alias name and VALUE the documentation..brAlias documentation will then appear in gpac help..br
.br.SH Configuration file.LP.brGPAC uses a configuration file to modify default options of libgpac and filters. This file is called GPAC.cfg and is located:.br- on Windows platforms, in C:\Users\FOO\AppData\Roaming\GPAC or in C:\Program Files\GPAC..br- on iOS platforms, in a .gpac folder in the app storage directory..br- on Android platforms, in /sdcard/GPAC/ if this directory exists, otherwise in /data/data/io.gpac.gpac/GPAC..br- on other platforms, in a $HOME/.gpac/..br
.brApplications in GPAC can also specify a different configuration file through the .I -p profile option. EX gpac -p=foo [].brThis will load configuration from $HOME/.gpac/foo/GPAC.cfg, creating it if needed..brThe reserved name 0 is used to disable configuration file writing..br
.brThe configuration file is structured in sections, each made of one or more keys:.br- section foo is declared as [foo]\n.br- key bar with value N is declared as bar=N\n. The key value N is not interpreted and always handled as ASCII text..br
.brBy default the configuration file only holds a few system specific options and directories. It is possible to serialize the entire set of options to the configuration file, using .I -wc .I -wf..brThis should be avoided as the resulting configuration file size will be quite large, hence larger memory usage for the applications..brThe options specified in the configuration file may be overridden by the values in restrict.cfg file located in GPAC share system directory (e.g. /usr/share/gpac or C:\Program Files\GPAC), if present; this allows enforcing system-wide configuration values..brNote: The methods describe in this section apply to any application in GPAC transferring their arguments to libgpac. This is the case for gpac and MP4Box..br
.br.SH Core options.LP.brThe options from libgpac core can also be assigned though the config file from section core using option name without initial dash as key name..brExample.br[core].brthreads=2.br
.brSetting this in the config file is equivalent to using -threads=2..brThe options specified at prompt overrides the value of the config file..br.SH Filter options in configuration.LP.brIt is possible to alter the default value of a filter option by modifying the configuration file. Filter foo options are stored in section [filter@foo], using option name and value as key-value pair. Options specified through the configuration file do not take precedence over options specified at prompt or through alias..brExample.br[filter@rtpin].brinterleave=yes.br
.brThis will force the rtp input filter to always request RTP over RTSP by default..brTo generate a configuration file with all filters options serialized, use .I -wf..br.SH Global filter options.LP.brIt is possible to specify options global to multiple filters using --OPTNAME=VAL. Global options do not override filter options but take precedence over options loaded from configuration file..brThis will set option OPTNAME, when present, to VAL in any loaded filter..brExample.br--buffer=100 -i file vout aout.br
.brThis is equivalent to specifying vout:buffer=100 aout:buffer=100..brExample.br--buffer=100 -i file vout aout:buffer=10.br
.brThis is equivalent to specifying vout:buffer=100 aout:buffer=10..brWarning: This syntax only applies to regular filter options. It cannot be used with builtin shortcuts (gfreg, enc, ...)..brMeta-filter options can be set in the same way using the syntax --OPT\_NAME=VAL..brExample.br--profile=Baseline -i file.cmp -o dump.264.br
.brThis is equivalent to specifying -o dump.264:profile=Baseline..br .brFor both syntaxes, it is possible to specify the filter registry name of the option, using --FNAME:OPTNAME=VAL or --FNAME@OPTNAME=VAL..brIn this case the option will only be set for filters which are instances of registry FNAME. This is used when several registries use same option names..brExample.br--flist@timescale=100 -i plist1 -i plist2 -o live.mpd.br
.brThis will set the timescale option on the playlists filters but not on the dasher filter..br.SH libgpac core options:.LP.br.TP.B \-noprog.brdisable progress messages.br.TP.B \-quiet.brdisable all messages, including errors.br.TP.B \-proglf.bruse new line at each progress messages.br.TP.B \-strict-error,-se.brexit after the first error is reported.br.TP.B \-store-dir (string).brset storage directory.br.TP.B \-mod-dirs (string list).brset additional module directories as a semi-colon ; separated list.br.TP.B \-js-dirs (string list).brset javascript directories.br.TP.B \-no-js-mods (string list).brdisable javascript module loading.br.TP.B \-ifce (string).brset default multicast interface through interface IP address (default is 127.0.0.1).br.TP.B \-lang (string).brset preferred language.br.TP.B \-cfg,-opt (string).brget or set configuration file value. The string parameter can be formatted as:.br\* `section:key=val`: set the key to a new value.br\* `section:key=null`, `section:key`: remove the key.br\* `section=null`: remove the section.br\* no argument: print the entire configuration file.br\* `section`: print the given section.br\* `section:key`: print the given key in section (section can be set to \*)- \*:key: print the given key in all sections.br.TP.B \-no-save.brdiscard any changes made to the config file upon exit.br.TP.B \-mod-reload.brunload / reload module shared libs when no longer used.br.TP.B \-for-test.brdisable all creation/modification dates and GPAC versions in files.br.TP.B \-old-arch.brenable compatibility with pre-filters versions of GPAC.br.TP.B \-ntp-shift (int).brshift NTP clock by given amount in seconds.br.TP.B \-bs-cache-size (int, default: 512).brcache size for bitstream read and write from file (0 disable cache, slower IOs).br.TP.B \-no-check.brdisable compliance tests for inputs (ISOBMFF for now). This will likely result in random crashes.br.TP.B \-unhandled-rejection.brdump unhandled promise rejections.br.TP.B \-startup-file (string).brstartup file of compositor in GUI mode.br.TP.B \-docs-dir (string).brdefault documents directoty (for GUI on iOS and Android).br.TP.B \-last-dir (string).brlast working directory (for GUI).br.TP.B \-cache (string).brcache directory location.br.TP.B \-proxy-on.brenable HTTP proxy.br.TP.B \-proxy-name (string).brset HTTP proxy address.br.TP.B \-proxy-port (int, default: 80).brset HTTP proxy port.br.TP.B \-maxrate (int).brset max HTTP download rate in bits per sec. 0 means unlimited.br.TP.B \-no-cache.brdisable HTTP caching.br.TP.B \-offline-cache.brenable offline HTTP caching (no re-validation of existing resource in cache).br.TP.B \-clean-cache.brindicate if HTTP cache should be clean upon launch/exit.br.TP.B \-cache-size (int, default: 100M).brspecify cache size in bytes.br.TP.B \-head-timeout (int, default: 5000).brset HTTP head request timeout in milliseconds.br.TP.B \-req-timeout (int, default: 20000).brset HTTP/RTSP request timeout in milliseconds.br.TP.B \-no-timeout.brignore HTTP 1.1 timeout in keep-alive.br.TP.B \-broken-cert.brenable accepting broken SSL certificates.br.TP.B \-user-agent,-ua (string).brset user agent name for HTTP/RTSP.br.TP.B \-user-profileid (string).brset user profile ID (through X-UserProfileID entity header) in HTTP requests.br.TP.B \-user-profile (string).brset user profile filename. Content of file is appended as body to HTTP HEAD/GET requests, associated Mime is text/xml.br.TP.B \-query-string (string).brinsert query string (without ?) to URL on requests.br.TP.B \-dm-threads.brforce using threads for async download requests rather than session scheduler.br.TP.B \-cte-rate-wnd (int, default: 20).brset window analysis length in milliseconds for chunk-transfer encoding rate estimation.br.TP.B \-no-h2.brdisable HTTP2.br.TP.B \-no-h2c.brdisable HTTP2 upgrade (i.e. over non-TLS).br.TP.B \-h2-copy.brenable intermediate copy of data in nghttp2 (default is disabled but may report as broken frames in wireshark).br.TP.B \-dbg-edges.brlog edges status in filter graph before dijkstra resolution (for debug). Edges are logged as edge\_source(status, weight, src\_cap\_idx, dst\_cap\_idx).br.TP.B \-full-link.brthrow error if any PID in the filter graph cannot be linked.br.TP.B \-no-block (Enum, default: no).brdisable blocking mode of filters.br\* no: enable blocking mode.br\* fanout: disable blocking on fan-out, unblocking the PID as soon as one of its destinations requires a packet.br\* all: disable blocking.br.TP.B \-no-reg.brdisable regulation (no sleep) in session.br.TP.B \-no-reassign.brdisable source filter reassignment in PID graph resolution.br.TP.B \-sched (Enum, default: free).brset scheduler mode.br\* free: lock-free queues except for task list (default).br\* lock: mutexes for queues when several threads.br\* freex: lock-free queues including for task lists (experimental).br\* flock: mutexes for queues even when no thread (debug mode).br\* direct: no threads and direct dispatch of tasks whenever possible (debug mode).br.TP.B \-max-chain (int, default: 6).brset maximum chain length when resolving filter links. Default value covers for [ in -> ] dmx -> reframe -> decode -> encode -> reframe -> mx [ -> out]. Filter chains loaded for adaptation (e.g. pixel format change) are loaded after the link resolution. Setting the value to 0 disables dynamic link resolution. You will have to specify the entire chain manually.br.TP.B \-max-sleep (int, default: 50).brset maximum sleep time slot in milliseconds when regulation is enabled.br.TP.B \-threads (int).brset N extra thread for the session. -1 means use all available cores.br.TP.B \-no-probe.brdisable data probing on sources and relies on extension (faster load but more error-prone).br.TP.B \-no-argchk.brdisable tracking of argument usage (all arguments will be considered as used).br.TP.B \-blacklist (string).brblacklist the filters listed in the given string (comma-separated list). If first character is '-', this is a whitelist, i.e. only filters listed in the given string will be allowed.br.TP.B \-no-graph-cache.brdisable internal caching of filter graph connections. If disabled, the graph will be recomputed at each link resolution (lower memory usage but slower).br.TP.B \-no-reservoir.brdisable memory recycling for packets and properties. This uses much less memory but stresses the system memory allocator much more.br.TP.B \-switch-vres.brselect smallest video resolution larger than scene size, otherwise use current video resolution.br.TP.B \-hwvmem (Enum, default: auto).brspecify (2D rendering only) memory type of main video backbuffer. Depending on the scene type, this may drastically change the playback speed.br\* always: always on hardware.br\* never: always on system memory.br\* auto: selected by GPAC based on content type (graphics or video).br.TP.B \-pref-yuv4cc (string).brset preferred YUV 4CC for overlays (used by DirectX only).br.TP.B \-offscreen-yuv.brindicate if offscreen yuv->rgb is enabled. can be set to false to force disabling.br.TP.B \-overlay-color-key (string).brcolor to use for overlay keying, hex format.br.TP.B \-gl-bits-comp (int, default: 8).brnumber of bits per color component in OpenGL.br.TP.B \-gl-bits-depth (int, default: 16).brnumber of bits for depth buffer in OpenGL.br.TP.B \-gl-doublebuf.brenable OpenGL double buffering.br.TP.B \-sdl-defer.bruse defer rendering for SDL.br.TP.B \-no-colorkey.brdisable color keying at the video output level.br.TP.B \-glfbo-txid (int).brset output texture ID when using glfbo output. The OpenGL context shall be initialized and gf\_term\_process shall be called with the OpenGL context active.br.TP.B \-video-output (string).brindicate the name of the video output module to use (see gpac -h modules). The reserved name glfbo is used in player mode to draw in the OpenGL texture identified by .I glfbo-txid. In this mode, the application is responsible for sending event to the compositor.br.TP.B \-dfb-sys (string, default: x11).brsystem DirectFB (x11, sdl, vnc, fbdev, osx ordevmem).br.TP.B \-dfb-flip (string, default: waitsync).brvsync mode for DirectFB (waitsync, wait, sync or swap).br.TP.B \-audio-output (string).brindicate the name of the audio output module to use.br.TP.B \-alsa-devname (string).brset ALSA dev name.br.TP.B \-force-alsarate (int).brforce ALSA and OSS output sample rate.br.TP.B \-ds-disable-notif.brdisable DirectSound audio buffer notifications when supported.br.TP.B \-font-reader (string).brindicate name of font reader module[View remainder of file in raw view](https://github.com/gpac/gpac/raw/105d67985ff3c3f4b98a98f312e3d84ae77a4463/share/doc/man/gpac.1)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_398cba4f_20250108_111329.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgpac%2Fgpac%2Fblob%2F105d67985ff3c3f4b98a98f312e3d84ae77a4463%2Fsrc%2Futils%2Futf.c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgpac%2Fgpac%2Fblob%2F105d67985ff3c3f4b98a98f312e3d84ae77a4463%2Fsrc%2Futils%2Futf.c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=gpac%2Fgpac)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gpac](/gpac)
/
**[gpac](/gpac/gpac)**
Public

* [Notifications](/login?return_to=%2Fgpac%2Fgpac) You must be signed in to change notification settings
* [Fork
  539](/login?return_to=%2Fgpac%2Fgpac)
* [Star
   2.8k](/login?return_to=%2Fgpac%2Fgpac)

* [Code](/gpac/gpac)
* [Issues
  71](/gpac/gpac/issues)
* [Pull requests
  11](/gpac/gpac/pulls)
* [Actions](/gpac/gpac/actions)
* [Wiki](/gpac/gpac/wiki)
* [Security](/gpac/gpac/security)
* [Insights](/gpac/gpac/pulse)

Additional navigation options

* [Code](/gpac/gpac)
* [Issues](/gpac/gpac/issues)
* [Pull requests](/gpac/gpac/pulls)
* [Actions](/gpac/gpac/actions)
* [Wiki](/gpac/gpac/wiki)
* [Security](/gpac/gpac/security)
* [Insights](/gpac/gpac/pulse)

## Files

 105d679
## Breadcrumbs

1. [gpac](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463)
2. /[src](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463/src)
3. /[utils](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463/src/utils)
/
# utf.c

 Blame  Blame
## Latest commit

## History

[History](/gpac/gpac/commits/105d67985ff3c3f4b98a98f312e3d84ae77a4463/src/utils/utf.c)770 lines (703 loc) · 20.4 KB 105d679
## Breadcrumbs

1. [gpac](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463)
2. /[src](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463/src)
3. /[utils](/gpac/gpac/tree/105d67985ff3c3f4b98a98f312e3d84ae77a4463/src/utils)
/
# utf.c

Top
## File metadata and controls

* Code
* Blame

770 lines (703 loc) · 20.4 KB[Raw](https://github.com/gpac/gpac/raw/105d67985ff3c3f4b98a98f312e3d84ae77a4463/src/utils/utf.c)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768/\* \* GPAC - Multimedia Framework C SDK \* \* Authors: Jean Le Feuvre \* Copyright (c) Telecom ParisTech 2007-2012 \* All rights reserved \* \* This file is part of GPAC / common tools sub-project \* \* GPAC is free software; you can redistribute it and/or modify \* it under the terms of the GNU Lesser General Public License as published by \* the Free Software Foundation; either version 2, or (at your option) \* any later version. \* \* GPAC is distributed in the hope that it will be useful, \* but WITHOUT ANY WARRANTY; without even the implied warranty of \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \* GNU Lesser General Public License for more details. \* \* You should have received a copy of the GNU Lesser General Public \* License along with this library; see the file COPYING. If not, write to \* the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA. \* \*/
#ifndef GPAC\_DISABLE\_CORE\_TOOLS
#include <gpac/utf.h>
#if 1
/\* \* Copyright 2001-2004 Unicode, Inc. \* \* Disclaimer \* \* This source code is provided as is by Unicode, Inc. No claims are \* made as to fitness for any particular purpose. No warranties of any \* kind are expressed or implied. The recipient agrees to determine \* applicability of information provided. If this file has been \* purchased on magnetic or optical media from Unicode, Inc., the \* sole remedy for any claim will be exchange of defective media \* within 90 days of receipt. \* \* Limitations on Rights to Redistribute This Code \* \* Unicode, Inc. hereby grants the right to freely use the information \* supplied in this file in the creation of products supporting the \* Unicode Standard, and to make copies of this file in any form \* for internal or external distribution as long as this notice \* remains attached. \*/
/\* ---------------------------------------------------------------------
 Conversions between UTF32, UTF-16, and UTF-8. Source code file. Author: Mark E. Davis, 1994. Rev History: Rick McGowan, fixes & updates May 2001. Sept 2001: fixed const & error conditions per mods suggested by S. Parent & A. Lillich. June 2002: Tim Dodd added detection and handling of incomplete source sequences, enhanced error detection, added casts to eliminate compiler warnings. July 2003: slight mods to back out aggressive FFFE detection. Jan 2004: updated switches in from-UTF8 conversions. Oct 2004: updated to use UNI\_MAX\_LEGAL\_UTF32 in UTF-32 conversions.
 See the header file "ConvertUTF.h" for complete documentation.
------------------------------------------------------------------------ \*/
typedef u32 UTF32; /\* at least 32 bits \*/typedef u16 UTF16; /\* at least 16 bits \*/typedef u8 UTF8; /\* typically 8 bits \*/typedef u8 Boolean; /\* 0 or 1 \*/
/\* Some fundamental constants \*/#define UNI\_REPLACEMENT\_CHAR (UTF32)0x0000FFFD#define UNI\_MAX\_BMP (UTF32)0x0000FFFF#define UNI\_MAX\_UTF16 (UTF32)0x0010FFFF#define UNI\_MAX\_UTF32 (UTF32)0x7FFFFFFF#define UNI\_MAX\_LEGAL\_UTF32 (UTF32)0x0010FFFF
typedef enum { conversionOK, /\* conversion successful \*/ sourceExhausted, /\* partial character in source, but hit end \*/ targetExhausted, /\* insuff. room in target for conversion \*/ sourceIllegal /\* source sequence is illegal/malformed \*/} ConversionResult;
typedef enum { strictConversion = 0, lenientConversion} ConversionFlags;
static const int halfShift = 10; /\* used for shifting by 10 bits \*/
static const UTF32 halfBase = 0x0010000UL;static const UTF32 halfMask = 0x3FFUL;
#define UNI\_SUR\_HIGH\_START (UTF32)0xD800#define UNI\_SUR\_HIGH\_END (UTF32)0xDBFF#define UNI\_SUR\_LOW\_START (UTF32)0xDC00#define UNI\_SUR\_LOW\_END (UTF32)0xDFFF#define false 0#define true 1
/\* \* Index into the table below with the first byte of a UTF-8 sequence to \* get the number of trailing bytes that are supposed to follow it. \* Note that \*legal\* UTF-8 values can't have 4 or 5-bytes. The table is \* left as-is for anyone who may want to do such conversion, which was \* allowed in earlier algorithms. \*/static const char trailingBytesForUTF8[256] = { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2, 3,3,3,3,3,3,3,3,4,4,4,4,5,5,5,5};
/\* \* Magic values subtracted from a buffer value during UTF8 conversion. \* This table contains as many values as there might be trailing bytes \* in a UTF-8 sequence. \*/static const UTF32 offsetsFromUTF8[6] = { 0x00000000UL, 0x00003080UL, 0x000E2080UL, 0x03C82080UL, 0xFA082080UL, 0x82082080UL };
/\* \* Once the bits are split out into bytes of UTF-8, this is a mask OR-ed \* into the first byte, depending on how many bytes follow. There are \* as many entries in this table as there are UTF-8 sequence types. \* (I.e., one byte sequence, two byte... etc.). Remember that sequencs \* for \*legal\* UTF-8 will be 4 or fewer bytes total. \*/static const UTF8 firstByteMark[7] = { 0x00, 0x00, 0xC0, 0xE0, 0xF0, 0xF8, 0xFC };
/\* --------------------------------------------------------------------- \*/
/\* The interface converts a whole buffer to avoid function-call overhead. \* Constants have been gathered. Loops & conditionals have been removed as \* much as possible for efficiency, in favor of drop-through switches. \* (See "Note A" at the bottom of the file for equivalent code.) \* If your compiler supports it, the "isLegalUTF8" call can be turned \* into an inline function. \*/
/\* --------------------------------------------------------------------- \*/
ConversionResult ConvertUTF16toUTF8 ( const UTF16\*\* sourceStart, const UTF16\* sourceEnd, UTF8\*\* targetStart, UTF8\* targetEnd, ConversionFlags flags) { ConversionResult result = conversionOK; const UTF16\* source = \*sourceStart; UTF8\* target = \*targetStart; while (source < sourceEnd) { UTF32 ch; unsigned short bytesToWrite = 0; const UTF32 byteMask = 0xBF; const UTF32 byteMark = 0x80; const UTF16\* oldSource = source; /\* In case we have to back up because of target overflow. \*/ ch = \*source++; /\* If we have a surrogate pair, convert to UTF32 first. \*/ if (ch >= UNI\_SUR\_HIGH\_START && ch <= UNI\_SUR\_HIGH\_END) { /\* If the 16 bits following the high surrogate are in the source buffer... \*/ if (source < sourceEnd) { UTF32 ch2 = \*source; /\* If it's a low surrogate, convert to UTF32. \*/ if (ch2 >= UNI\_SUR\_LOW\_START && ch2 <= UNI\_SUR\_LOW\_END) { ch = ((ch - UNI\_SUR\_HIGH\_START) << halfShift) + (ch2 - UNI\_SUR\_LOW\_START) + halfBase; ++source; } else if (flags == strictConversion) { /\* it's an unpaired high surrogate \*/ --source; /\* return to the illegal value itself \*/ result = sourceIllegal; break; } } else { /\* We don't have the 16 bits following the high surrogate. \*/ --source; /\* return to the high surrogate \*/ result = sourceExhausted; break; } } else if (flags == strictConversion) { /\* UTF-16 surrogate values are illegal in UTF-32 \*/ if (ch >= UNI\_SUR\_LOW\_START && ch <= UNI\_SUR\_LOW\_END) { --source; /\* return to the illegal value itself \*/ result = sourceIllegal; break; } } /\* Figure out how many bytes the result will require \*/ if (ch < (UTF32)0x80) { bytesToWrite = 1; } else if (ch < (UTF32)0x800) { bytesToWrite = 2; } else if (ch < (UTF32)0x10000) { bytesToWrite = 3; } else if (ch < (UTF32)0x110000) { bytesToWrite = 4; } else { bytesToWrite = 3; ch = UNI\_REPLACEMENT\_CHAR; }
 target += bytesToWrite; if (target > targetEnd) { source = oldSource; /\* Back up source pointer! \*/ target -= bytesToWrite; result = targetExhausted; break; } switch (bytesToWrite) { /\* note: everything falls through. \*/ case 4: \*--target = (UTF8)((ch | byteMark) & byteMask); ch >>= 6; case 3: \*--target = (UTF8)((ch | byteMark) & byteMask); ch >>= 6; case 2: \*--target = (UTF8)((ch | byteMark) & byteMask); ch >>= 6; case 1: \*--target = (UTF8)(ch | firstByteMark[bytesToWrite]); } target += bytesToWrite; } \*sourceStart = source; \*targetStart = target; return result;}
/\* \* Utility routine to tell whether a sequence of bytes is legal UTF-8. \* This must be called with the length pre-determined by the first byte. \* If not calling this from ConvertUTF8to\*, then the length can be set by: \* length = trailingBytesForUTF8[\*source]+1; \* and the sequence is illegal right away if there aren't that many bytes \* available. \* If presented with a length > 4, this returns false. The Unicode \* definition of UTF-8 goes up to 4-byte sequences. \*/
Boolean isLegalUTF8(const UTF8 \*source, int length) { UTF8 a; const UTF8 \*srcptr = source+length; switch (length) { default: return false; /\* Everything else falls through when "true"... \*/ case 4: if ((a = (\*--srcptr)) < 0x80 || a > 0xBF) return false; case 3: if ((a = (\*--srcptr)) < 0x80 || a > 0xBF) return false; case 2: if ((a = (\*--srcptr)) > 0xBF) return false;
 switch (\*source) { /\* no fall-through in this inner switch \*/ case 0xE0: if (a < 0xA0) return false; break; case 0xED: if (a > 0x9F) return false; break; case 0xF0: if (a < 0x90) return false; break; case 0xF4: if (a > 0x8F) return false; break; default: if (a < 0x80) return false; }
 case 1: if (\*source >= 0x80 && \*source < 0xC2) return false; } if (\*source > 0xF4) return false; return true;}
/\* --------------------------------------------------------------------- \*/
ConversionResult ConvertUTF8toUTF16 ( const UTF8\*\* sourceStart, const UTF8\* sourceEnd, UTF16\*\* targetStart, UTF16\* targetEnd, ConversionFlags flags) { ConversionResult result = conversionOK; const UTF8\* source = \*sourceStart; UTF16\* target = \*targetStart; while (source < sourceEnd) { UTF32 ch = 0; unsigned short extraBytesToRead = trailingBytesForUTF8[\*source]; if (source + extraBytesToRead >= sourceEnd) { result = sourceExhausted; break; } /\* Do this check whether lenient or strict \*/ if (! isLegalUTF8(source, extraBytesToRead+1)) { result = sourceIllegal; break; } /\* \* The cases all fall through. See "Note A" below. \*/ switch (extraBytesToRead) { case 5: ch += \*source++; ch <<= 6; /\* remember, illegal UTF-8 \*/ case 4: ch += \*source++; ch <<= 6; /\* remember, illegal UTF-8 \*/ case 3: ch += \*source++; ch <<= 6; case 2: ch += \*source++; ch <<= 6; case 1: ch += \*source++; ch <<= 6; case 0: ch += \*source++; } ch -= offsetsFromUTF8[extraBytesToRead];
 if (target >= targetEnd) { source -= (extraBytesToRead+1); /\* Back up source pointer! \*/ result = targetExhausted; break; } if (ch <= UNI\_MAX\_BMP) { /\* Target is a character <= 0xFFFF \*/ /\* UTF-16 surrogate values are illegal in UTF-32 \*/ if (ch >= UNI\_SUR\_HIGH\_START && ch <= UNI\_SUR\_LOW\_END) { if (flags == strictConversion) { source -= (extraBytesToRead+1); /\* return to the illegal value itself \*/ result = sourceIllegal; break; } else { \*target++ = UNI\_REPLACEMENT\_CHAR; } } else { \*target++ = (UTF16)ch; /\* normal case \*/ } } else if (ch > UNI\_MAX\_UTF16) { if (flags == strictConversion) { result = sourceIllegal; source -= (extraBytesToRead+1); /\* return to the start \*/ break; /\* Bail out; shouldn't continue \*/ } else { \*target++ = UNI\_REPLACEMENT\_CHAR; } } else { /\* target is a character in range 0xFFFF - 0x10FFFF. \*/ if (target + 1 >= targetEnd) { source -= (extraBytesToRead+1); /\* Back up source pointer! \*/ result = targetExhausted; break; } ch -= halfBase; \*target++ = (UTF16)((ch >> halfShift) + UNI\_SUR\_HIGH\_START); \*target++ = (UTF16)((ch & halfMask) + UNI\_SUR\_LOW\_START); } } \*sourceStart = source; \*targetStart = target; return result;}
GF\_EXPORTBool gf\_utf8\_is\_legal(const u8 \*data, u32 length){ //we simply run ConvertUTF8toUTF16 without target const UTF8\*\* sourceStart = (const UTF8\*\*) &data; const UTF8\* sourceEnd = (const UTF8\*) ( data + length ); ConversionResult result = conversionOK; const UTF8\* source = \*sourceStart;
 while (source < sourceEnd) { UTF32 ch = 0; unsigned short extraBytesToRead = trailingBytesForUTF8[\*source]; if (source + extraBytesToRead >= sourceEnd) { result = sourceExhausted; break; } /\* Do this check whether lenient or strict \*/ if (! isLegalUTF8(source, extraBytesToRead+1)) { result = sourceIllegal; break; } /\* \* The cases all fall through. See "Note A" below. \*/ switch (extraBytesToRead) { case 5: ch += \*source++; ch <<= 6; /\* remember, illegal UTF-8 \*/ case 4: ch += \*source++; ch <<= 6; /\* remember, illegal UTF-8 \*/ case 3: ch += \*source++; ch <<= 6; case 2: ch += \*source++; ch <<= 6; case 1: ch += \*source++; ch <<= 6; case 0: ch += \*source++; } ch -= offsetsFromUTF8[extraBytesToRead];
 if (ch <= UNI\_MAX\_BMP) { /\* Target is a character <= 0xFFFF \*/ /\* UTF-16 surrogate values are illegal in UTF-32 \*/ if (ch >= UNI\_SUR\_HIGH\_START && ch <= UNI\_SUR\_LOW\_END) { result = sourceIllegal; break; } } else if (ch > UNI\_MAX\_UTF16) { result = sourceIllegal; break; /\* Bail out; shouldn't continue \*/ } } return (result==conversionOK) ? GF\_TRUE : GF\_FALSE;}
GF\_EXPORTu32 gf\_utf8\_wcslen (const unsigned short \*s){ const unsigned short\* ptr; if (!s) return 0; for (ptr = s; \*ptr != (unsigned short)'\0'; ptr++) { } return (u32) ( ptr - s );}
GF\_EXPORTu32 gf\_utf8\_wcstombs(char\* dest, size\_t len, const unsigned short\*\* srcp){ if (!srcp || !\*srcp) return 0; else { const UTF16\*\* sourceStart = srcp; const UTF16\* sourceEnd = \*srcp + gf\_utf8\_wcslen(\*srcp); UTF8\* targetStart = (UTF8\*) dest; UTF8\* targetEnd = (UTF8\*) dest + len; ConversionFlags flags = strictConversion;
 ConversionResult res = ConvertUTF16toUTF8(sourceStart, sourceEnd, &targetStart, targetEnd, flags); if (res != conversionOK) return GF\_UTF8\_FAIL; \*targetStart = 0; \*srcp=NULL; return (u32) strlen(dest); }}
GF\_EXPORTu32 gf\_utf8\_mbstowcs(unsigned short\* dest, size\_t len, const char\*\* srcp){ if (!srcp || !\*srcp) return 0; else { const UTF8\*\* sourceStart = (const UTF8\*\*) srcp; const UTF8\* sourceEnd = (const UTF8\*) ( \*srcp + strlen( \*srcp) ); UTF16\* targetStart = (UTF16\* ) dest; UTF16\* targetEnd = (UTF16\* ) (dest + len); ConversionFlags flags = strictConversion; ConversionResult res = ConvertUTF8toUTF16(sourceStart, sourceEnd, &targetStart, targetEnd, flags); if (res != conversionOK) return GF\_UTF8\_FAIL; \*targetStart = 0; \*srcp=NULL; return gf\_utf8\_wcslen(dest); }}
#else
GF\_EXPORTu32 gf\_utf8\_wcslen (const unsigned short \*s){ const unsigned short\* ptr; for (ptr = s; \*ptr != (unsigned short)'\0'; ptr++) { } return (u32) (ptr - s);}
GF\_EXPORTu32 gf\_utf8\_wcstombs(char\* dest, size\_t len, const unsigned short\*\* srcp){ /\* \* Original code from the GNU UTF-8 Library \*/ size\_t count; const unsigned short \* src = \*srcp;
 if (dest != NULL) { char\* destptr = dest; for (;; src++) { unsigned char c; unsigned short wc = \*src; if (wc < 0x80) { if (wc == (wchar\_t)'\0') { if (len == 0) { \*srcp = src; break; } \*destptr = '\0'; \*srcp = NULL; break; } count = 0; c = (unsigned char) wc; } else if (wc < 0x800) { count = 1; c = (unsigned char) ((wc >> 6) | 0xC0); } else { count = 2; c = (unsigned char) ((wc >> 12) | 0xE0); } if (len <= count) { \*srcp = src; break; } len -= count+1; \*destptr++ = c; if (count > 0) do { \*destptr++ = (unsigned char)(((wc >> (6 \* --count)) & 0x3F) | 0x80); } while (count > 0); } return (u32) (destptr - dest); } else { /\* Ignore dest and len. \*/ size\_t totalcount = 0; for (;; src++) { unsigned short wc = \*src; size\_t count; if (wc < 0x80) { if (wc == (wchar\_t)'\0') { \*srcp = NULL; break; } count = 1; } else if (wc < 0x800) { count = 2; } else { count = 3; } totalcount += count; } return (u32) totalcount; }}
typedef struct{ u32 count : 16; /\* number of bytes remaining to be processed \*/ u32 value : 16; /\* if count > 0: partial wide character \*/ /\* If WCHAR\_T\_BITS == 16, need 2 bits for count, 12 bits for value (10 for mbstowcs direction, 12 for wcstombs direction). \*/} gf\_utf8\_mbstate\_t;
static gf\_utf8\_mbstate\_t internal;
GF\_EXPORTu32 gf\_utf8\_mbstowcs(unsigned short\* dest, size\_t len, const char\*\* srcp){ gf\_utf8\_mbstate\_t\* ps = &internal; const char \*src = \*srcp;
 unsigned short\* destptr = dest; for (; len > 0; destptr++, len--) { const char\* backup\_src = src; unsigned char c; unsigned short wc; size\_t count; if (ps->count == 0) { c = (unsigned char) \*src; if (c < 0x80) { \*destptr = (wchar\_t) c; if (c == 0) { src = NULL; break; } src++; continue; } else if (c < 0xC0) { /\* Spurious 10XXXXXX byte is invalid. \*/ goto bad\_input; } if (c < 0xE0) { wc = (wchar\_t)(c & 0x1F) << 6; count = 1; if (c < 0xC2) goto bad\_input; } else if (c < 0xF0) { wc = (wchar\_t)(c & 0x0F) << 12; count = 2; } else goto bad\_input; src++; } else { wc = ps->value << 6; count = ps->count; } for (;;) { c = (unsigned char) \*src++ ^ 0x80; if (!(c < 0x40)) goto bad\_input\_backup; wc |= (unsigned short) c << (6 \* --count); if (count == 0) break; /\* The following test is only necessary once for every character, but it would be too complicated to perform it once only, on the first pass through this loop. \*/ if ((unsigned short) wc < ((unsigned short) 1 << (5 \* count + 6))) goto bad\_input\_backup; } \*destptr = wc; ps->count = 0; continue;
bad\_input\_backup: src = backup\_src; goto bad\_input; } \*srcp = src; return (u32) (destptr - dest);
bad\_input: \*srcp = src; return GF\_UTF8\_FAIL;}
#endif
GF\_EXPORTGF\_Err gf\_utf\_get\_utf8\_string\_from\_bom(const u8 \*data, u32 size, char \*\*out\_ptr, char \*\*result){ u32 unicode\_type = 0; if (!out\_ptr || !result || !data) return GF\_BAD\_PARAM; \*out\_ptr = NULL; \*result = (char \*) data;
 if (size>=5) { /\*0: no unicode, 1: UTF-16BE, 2: UTF-16LE\*/ if ((data[0]==0xFF) && (data[1]==0xFE)) { if (!data[2] && !data[3]) { return GF\_OK; } else { unicode\_type = 2; } } else if ((data[0]==0xFE) && (data[1]==0xFF)) { if (!data[2] && !data[3]) { return GF\_OK; } else { unicode\_type = 1; } } else if ((data[0]==0xEF) && (data[1]==0xBB) && (data[2]==0xBF)) { \*result = (char \*) (data+4); return GF\_OK; } }
 if (!unicode\_type) { \*result = (char \*) data; return GF\_OK; }
 if (size%2) size--; u16 \*str\_wc = gf\_malloc(size+2); if (!str\_wc) return GF\_OUT\_OF\_MEM; u16 \*srcwc; char \*dst = gf\_malloc(size+2); if (!dst) { gf\_free(str\_wc); return GF\_OUT\_OF\_MEM; } \*out\_ptr = dst; u32 i; for (i=0; i<size; i+=2) { u16 wchar=0; u8 c1 = data[i]; u8 c2 = data[i+1];
 /\*Little-endian order\*/ if (unicode\_type==2) { if (c2) { wchar = c2; wchar <<=8; wchar |= c1; } else wchar = c1; } else { wchar = c1; if (c2) { wchar <<= 8; wchar |= c2; } } str\_wc[i/2] = wchar; } str\_wc[i/2] = 0; srcwc = str\_wc; u32 res = gf\_utf8\_wcstombs(dst, size, (const unsigned short \*\*) &srcwc); gf\_free(str\_wc); if (res==GF\_UTF8\_FAIL) { gf\_free(dst); \*out\_ptr = NULL; return GF\_IO\_ERR; } \*result = dst; return GF\_OK;}
#if defined(WIN32)
GF\_EXPORTwchar\_t\* gf\_utf8\_to\_wcs(const char\* str){ size\_t source\_len; wchar\_t\* result; if (str == 0) return 0; source\_len = strlen(str); result = gf\_calloc(source\_len + 1, sizeof(wchar\_t)); if (!result) return 0; if (gf\_utf8\_mbstowcs(result, source\_len, &str) == GF\_UTF8\_FAIL) { gf\_free(result); return 0; } return result;}
GF\_EXPORTchar\* gf\_wcs\_to\_utf8(const wchar\_t\* str){ size\_t source\_len; char\* result; if (str == 0) return 0; source\_len = wcslen(str); result = gf\_calloc(source\_len + 1, UTF8\_MAX\_BYTES\_PER\_CHAR); if (!result) return 0; if (gf\_utf8\_wcstombs(result, source\_len \* UTF8\_MAX\_BYTES\_PER\_CHAR, &str) == GF\_UTF8\_FAIL) { gf\_free(result); return 0; } return result;}#endif
#endif /\* GPAC\_DISABLE\_CORE\_TOOLS \*/

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


