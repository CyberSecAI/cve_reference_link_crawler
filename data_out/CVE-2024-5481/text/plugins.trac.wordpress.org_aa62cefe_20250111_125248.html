

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3098798)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3098797 "Changeset 3098797")
* [Next Changeset](/changeset/3098799 "Changeset 3098799") →

---

# Changeset 3098798

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
06/06/2024 03:45:45 PM
([7 months](/timeline?from=2024-06-06T15%3A45%3A45Z&precision=second "See timeline at 06/06/2024 03:45:45 PM") ago)

Author:
10web
Message:

Fixed: Security issue

Location:
[photo-gallery/trunk](/browser/photo-gallery/trunk?rev=3098798)
Files:

5 edited

* [filemanager/UploadHandler.php](/browser/photo-gallery/trunk/filemanager/UploadHandler.php?rev=3098798 "Show entry in browser")
  (modified)
  ([4 diffs](#file0 "Show differences"))
* [filemanager/controller.php](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3098798 "Show entry in browser")
  (modified)
  ([6 diffs](#file1 "Show differences"))
* [js/bwg.js](/browser/photo-gallery/trunk/js/bwg.js?rev=3098798 "Show entry in browser")
  (modified)
  ([3 diffs](#file2 "Show differences"))
* [photo-gallery.php](/browser/photo-gallery/trunk/photo-gallery.php?rev=3098798 "Show entry in browser")
  (modified)
  ([4 diffs](#file3 "Show differences"))
* [readme.txt](/browser/photo-gallery/trunk/readme.txt?rev=3098798 "Show entry in browser")
  (modified)
  ([2 diffs](#file4 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [photo-gallery/trunk/filemanager/UploadHandler.php](/changeset/3098798/photo-gallery/trunk/filemanager/UploadHandler.php "Show the changeset 3098798 restricted to photo-gallery/trunk/filemanager/UploadHandler.php")

  | [r3058445](/browser/photo-gallery/trunk/filemanager/UploadHandler.php?rev=3058445#L377 "Show revision 3058445 of this file in browser") | [r3098798](/browser/photo-gallery/trunk/filemanager/UploadHandler.php?rev=3098798#L377 "Show revision 3098798 of this file in browser") |  |
  | --- | --- | --- |
  | 377 | 377 | } |
  | 378 | 378 | } |
  | 379 |  |  |
  | 380 | 379 | return TRUE; |
  | 381 | 380 | } |
  | […](/browser/photo-gallery/trunk/filemanager/UploadHandler.php?rev=3058445#L480) | […](/browser/photo-gallery/trunk/filemanager/UploadHandler.php?rev=3098798#L479) |  |
  | 480 | 479 | $file->error = 'Failed to create scaled versions: ' . implode(', ', $failed\_versions); |
  | 481 | 480 | } |
  | 482 |  |  |
  | 483 | 481 | if ( !$file->error ) { |
  | 484 | 482 | global $wpdb; |
  | […](/browser/photo-gallery/trunk/filemanager/UploadHandler.php?rev=3058445#L541) | […](/browser/photo-gallery/trunk/filemanager/UploadHandler.php?rev=3098798#L539) |  |
  | 541 | 539 | $svg\_files = glob($target\_dir . '/\*.svg'); |
  | 542 | 540 | foreach ( $svg\_files as $svg ) { |
  | 543 |  | $file\_content = file\_get\_contents($svg); |
  | 544 |  | file\_put\_contents($svg, preg\_replace('#<script(.\*?)>(.\*?)</script>#is', '', $file\_content)); |
  |  | 541 | if( !$this->sanitize\_svg($svg) ) { |
  |  | 542 | unlink($svg); |
  |  | 543 | } |
  | 545 | 544 | } |
  | 546 | 545 | } |
  | […](/browser/photo-gallery/trunk/filemanager/UploadHandler.php?rev=3058445#L600) | […](/browser/photo-gallery/trunk/filemanager/UploadHandler.php?rev=3098798#L599) |  |
  | 600 | 599 | $file->error = FALSE; |
  | 601 | 600 | if ( $extension == 'svg' ) { |
  | 602 |  | $file\_content = file\_get\_contents($ex\_file); |
  | 603 |  | file\_put\_contents($ex\_file, preg\_replace('#<script(.\*?)>(.\*?)</script>#is', '', $file\_content)); |
  |  | 601 | if( !$this->sanitize\_svg($ex\_file) ) { |
  |  | 602 | continue; |
  |  | 603 | } |
  | 604 | 604 | } |
  | 605 | 605 | $this->handle\_image\_file($ex\_file, $file); |
* ## [photo-gallery/trunk/filemanager/controller.php](/changeset/3098798/photo-gallery/trunk/filemanager/controller.php "Show the changeset 3098798 restricted to photo-gallery/trunk/filemanager/controller.php")

  | [r3058445](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3058445#L177 "Show revision 3058445 of this file in browser") | [r3098798](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3098798#L177 "Show revision 3098798 of this file in browser") |  |
  | --- | --- | --- |
  | 177 | 177 | \*/ |
  | 178 | 178 | private function esc\_dir($dir) { |
  | 179 |  | $dir = str\_replace('../', '', $dir); |
  | 180 |  |  |
  |  | 179 | $dir = str\_replace(array('../', '.'), '', $dir); |
  | 181 | 180 | return $dir; |
  | 182 | 181 | } |
  | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3058445#L303) | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3098798#L302) |  |
  | 303 | 302 | $original\_file\_path = $cur\_dir\_path . '/.original/' . $file\_name; |
  | 304 | 303 | $msg = ''; |
  | 305 |  |  |
  | 306 | 304 | if (file\_exists($file\_path) == false) { |
  | 307 | 305 | $msg = \_\_("File doesn't exist.", 'photo-gallery'); |
  | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3058445#L390) | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3098798#L388) |  |
  | 390 | 388 | ); |
  | 391 | 389 |  |
  | 392 |  | $path = $input\_dir .'/'; |
  | 393 |  | $wpdb->update($wpdb->prefix . 'bwg\_file\_paths', |
  | 394 |  | array( |
  | 395 |  | 'name'      => $file\_new\_name . '.' . $file\_extension, |
  | 396 |  | 'filename'  => $file\_new\_name, |
  | 397 |  | 'thumb'     => 'thumb/'. $file\_new\_name . '.' . $file\_extension, |
  | 398 |  | 'alt'       => $file\_new\_name, |
  | 399 |  | 'date\_modified' => date('Y-m-d H:i:s') |
  | 400 |  | ), |
  | 401 |  | array('path' => $path, 'name' => $file\_name), |
  |  | 390 | $path = $input\_dir .'/'; |
  |  | 391 | $wpdb->update($wpdb->prefix . 'bwg\_file\_paths', |
  |  | 392 | array( |
  |  | 393 | 'name'      => $file\_new\_name . '.' . $file\_extension, |
  |  | 394 | 'filename'  => $file\_new\_name, |
  |  | 395 | 'thumb'     => 'thumb/'. $file\_new\_name . '.' . $file\_extension, |
  |  | 396 | 'alt'       => $file\_new\_name, |
  |  | 397 | 'date\_modified' => date('Y-m-d H:i:s') |
  |  | 398 | ), |
  |  | 399 | array('path' => $path, 'name' => $file\_name), |
  | 402 | 400 | array('%s','%s','%s','%s','%s'), |
  | 403 | 401 | array('%s','%s') |
  | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3058445#L511) | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3098798#L509) |  |
  | 511 | 509 | $src\_dir = htmlspecialchars\_decode($src\_dir, ENT\_COMPAT | ENT\_QUOTES); |
  | 512 | 510 | $src\_dir = $this->esc\_dir($src\_dir); |
  | 513 |  |  |
  | 514 | 511 | $dest\_dir = (isset($\_REQUEST['clipboard\_dest']) ? stripslashes(WDWLibrary::get('clipboard\_dest','','sanitize\_text\_field','REQUEST')) : ''); |
  | 515 | 512 | $dest\_dir = $dest\_dir == '' ? $this->uploads\_dir : $this->uploads\_dir . '/' . $dest\_dir; |
  | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3058445#L518) | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3098798#L515) |  |
  | 518 | 515 |  |
  | 519 | 516 | $path\_old = (isset($\_REQUEST['clipboard\_src']) ? stripslashes(WDWLibrary::get('clipboard\_src','','sanitize\_text\_field','REQUEST')) .'/' : '/'); |
  | 520 |  | $path\_new = (isset($\_REQUEST['clipboard\_dest']) ? stripslashes(WDWLibrary::get('clipboard\_dest','','sanitize\_text\_field','REQUEST')) .'/' : '/'); |
  | 521 |  | $file\_path\_tbl = $wpdb->prefix . 'bwg\_file\_paths'; |
  |  | 517 | $path\_old = $this->esc\_dir($path\_old); |
  |  | 518 | $path\_new = (isset($\_REQUEST['clipboard\_dest']) ? stripslashes(WDWLibrary::get('clipboard\_dest','','sanitize\_text\_field','REQUEST')) .'/' : '/'); |
  |  | 519 | $path\_new = $this->esc\_dir($path\_new); |
  |  | 520 | $file\_path\_tbl = $wpdb->prefix . 'bwg\_file\_paths'; |
  | 522 | 521 |  |
  | 523 | 522 | switch ((isset($\_REQUEST['clipboard\_task']) ? stripslashes(WDWLibrary::get('clipboard\_task','','sanitize\_text\_field','REQUEST')) : '')) { |
  | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3058445#L528) | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3098798#L527) |  |
  | 528 | 527 | $file\_name = htmlspecialchars\_decode($file\_name, ENT\_COMPAT | ENT\_QUOTES); |
  | 529 | 528 | $file\_name = str\_replace('../', '', $file\_name); |
  | 530 |  | $file\_name = ~~basename($file\_name~~); |
  |  | 529 | $file\_name = sanitize\_file\_name(basename($file\_name)); |
  | 531 | 530 | $allowed\_extensions\_list = array('jpg','jpeg', 'png','gif','svg'); |
  | 532 | 531 | $file\_extension = strtolower(substr($file\_name, strrpos($file\_name, '.') + 1)); |
* ## [photo-gallery/trunk/js/bwg.js](/changeset/3098798/photo-gallery/trunk/js/bwg.js "Show the changeset 3098798 restricted to photo-gallery/trunk/js/bwg.js")

  | [r2844248](/browser/photo-gallery/trunk/js/bwg.js?rev=2844248#L159 "Show revision 2844248 of this file in browser") | [r3098798](/browser/photo-gallery/trunk/js/bwg.js?rev=3098798#L159 "Show revision 3098798 of this file in browser") |  |
  | --- | --- | --- |
  | 159 | 159 |  |
  | 160 | 160 | jQuery( '#bwg\_image\_editor\_notice .notice-dismiss' ).on( 'click', function () { |
  | 161 |  | ~~var dismiss\_url = bwg\_ajax\_url + '=' + jQuery( '#bwg\_image\_editor\_notice' ).data( 'action' );~~ |
  | 162 | 161 | jQuery.ajax( { |
  | 163 | 162 | method: "POST", |
  | 164 |  | url: dismiss\_url, |
  |  | 163 | url: ajaxurl, |
  |  | 164 | data: { |
  |  | 165 | action: jQuery( '#bwg\_image\_editor\_notice' ).data( 'action' ), |
  |  | 166 | nonce: bwg.ajaxnonce, |
  |  | 167 | } |
  | 165 | 168 | } ); |
  | 166 | 169 | }); |
  | […](/browser/photo-gallery/trunk/js/bwg.js?rev=2844248#L1692) | […](/browser/photo-gallery/trunk/js/bwg.js?rev=3098798#L1695) |  |
  | 1692 | 1695 | for ( var image in attachment ) { |
  | 1693 | 1696 | var image\_url = attachment[ image ].url; |
  | 1694 |  | image\_url = image\_url.replace( bwg\_objectL10B.wp\_upload\_dir.baseurl + '/', '' ); |
  | 1695 |  | filesSelectedML.push( image\_url ); |
  |  | 1697 | if( image\_url ) { |
  |  | 1698 | image\_url = image\_url.replace(bwg\_objectL10B.wp\_upload\_dir.baseurl + '/', ''); |
  |  | 1699 | filesSelectedML.push(image\_url); |
  |  | 1700 | } |
  | 1696 | 1701 | } |
  | 1697 | 1702 | jQuery( '#loading\_div' ).show(); |
  | […](/browser/photo-gallery/trunk/js/bwg.js?rev=2844248#L2980) | […](/browser/photo-gallery/trunk/js/bwg.js?rev=3098798#L2985) |  |
  | 2980 | 2985 | var replace = ['', '', '', '']; |
  | 2981 | 2986 | for ( var i = 0; i < matchs.length; i++ ) { |
  | 2982 |  | str = str.replace(matchs[i], replace[i]); |
  |  | 2987 | if( str ) { |
  |  | 2988 | str = str.replace(matchs[i], replace[i]); |
  |  | 2989 | } |
  | 2983 | 2990 | } |
  | 2984 | 2991 | return str; |
* ## [photo-gallery/trunk/photo-gallery.php](/changeset/3098798/photo-gallery/trunk/photo-gallery.php "Show the changeset 3098798 restricted to photo-gallery/trunk/photo-gallery.php")

  | [r3071536](/browser/photo-gallery/trunk/photo-gallery.php?rev=3071536#L4 "Show revision 3071536 of this file in browser") | [r3098798](/browser/photo-gallery/trunk/photo-gallery.php?rev=3098798#L4 "Show revision 3098798 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://10web.io/plugins/wordpress-photo-gallery/?utm\_source=photo\_gallery&utm\_medium=free\_plugin |
  | 5 | 5 | \* Description: This plugin is a fully responsive gallery plugin with advanced functionality.  It allows having different image galleries for your posts and pages. You can create unlimited number of galleries, combine them into albums, and provide descriptions and tags. |
  | 6 |  | \* Version: 1.8.2~~3~~ |
  |  | 6 | \* Version: 1.8.24 |
  | 7 | 7 | \* Author: Photo Gallery Team |
  | 8 | 8 | \* Author URI: https://10web.io/plugins/?utm\_source=photo\_gallery&utm\_medium=free\_plugin |
  | […](/browser/photo-gallery/trunk/photo-gallery.php?rev=3071536#L109) | […](/browser/photo-gallery/trunk/photo-gallery.php?rev=3098798#L109) |  |
  | 109 | 109 | $this->front\_url = $this->plugin\_url; |
  | 110 | 110 | $this->main\_file = plugin\_basename(\_\_FILE\_\_); |
  | 111 |  | $this->plugin\_version = '1.8.2~~3~~'; |
  | 112 |  | $this->db\_version = '1.8.2~~3~~'; |
  |  | 111 | $this->plugin\_version = '1.8.24'; |
  |  | 112 | $this->db\_version = '1.8.24'; |
  | 113 | 113 | $this->prefix = 'bwg'; |
  | 114 | 114 | $this->nicename = \_\_('Photo Gallery', 'photo-gallery'); |
  | […](/browser/photo-gallery/trunk/photo-gallery.php?rev=3071536#L450) | […](/browser/photo-gallery/trunk/photo-gallery.php?rev=3098798#L450) |  |
  | 450 | 450 | \*/ |
  | 451 | 451 | public function dismiss\_notice() { |
  |  | 452 | $nonce = isset($\_POST['nonce']) ? sanitize\_text\_field($\_POST['nonce']) : ''; |
  |  | 453 | if ( ! wp\_verify\_nonce( $nonce, 'ajax-nonce' ) ) { |
  |  | 454 | return false; |
  |  | 455 | } |
  | 452 | 456 | $action = WDWLibrary::get('action'); |
  | 453 | 457 | $allowed\_pages = array( |
  | […](/browser/photo-gallery/trunk/photo-gallery.php?rev=3071536#L638) | […](/browser/photo-gallery/trunk/photo-gallery.php?rev=3098798#L642) |  |
  | 638 | 642 | 'google\_fonts' => WDWLibrary::get\_google\_fonts(), |
  | 639 | 643 | 'bwg\_premium\_text' => \_\_(' view is<br>available in Premium Version', 'photo-gallery'), |
  |  | 644 | 'ajaxnonce' => wp\_create\_nonce( 'ajax-nonce' ) |
  | 640 | 645 | )); |
  | 641 | 646 |  |
* ## [photo-gallery/trunk/readme.txt](/changeset/3098798/photo-gallery/trunk/readme.txt "Show the changeset 3098798 restricted to photo-gallery/trunk/readme.txt")

  | [r3071536](/browser/photo-gallery/trunk/readme.txt?rev=3071536#L4 "Show revision 3071536 of this file in browser") | [r3098798](/browser/photo-gallery/trunk/readme.txt?rev=3098798#L4 "Show revision 3098798 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 4.6 |
  | 5 | 5 | Tested up to: 6.5 |
  | 6 |  | Stable tag: 1.8.2~~3~~ |
  |  | 6 | Stable tag: 1.8.24 |
  | 7 | 7 | License: GPLv2 or later |
  | 8 | 8 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/photo-gallery/trunk/readme.txt?rev=3071536#L273) | […](/browser/photo-gallery/trunk/readme.txt?rev=3098798#L273) |  |
  | 273 | 273 |  |
  | 274 | 274 | == Changelog == |
  |  | 275 |  |
  |  | 276 | = 1.8.24 = |
  |  | 277 | \* Fixed: Security fix. |
  | 275 | 278 |  |
  | 276 | 279 | = 1.8.23 = |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3098798)
* [Zip Archive](?format=zip&new=3098798)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

