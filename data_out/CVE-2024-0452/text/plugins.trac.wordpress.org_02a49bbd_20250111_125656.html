

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3089461%2Fchatbot%2Ftrunk%2Fincludes%2Fopenai%2Fqcld-bot-openai.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3077619/chatbot/trunk/includes/openai/qcld-bot-openai.php "Changeset 3077619 for chatbot/trunk/includes/openai/qcld-bot-openai.php")
* [Next Change](/changeset/3102233/chatbot/trunk/includes/openai/qcld-bot-openai.php "Changeset 3102233 for chatbot/trunk/includes/openai/qcld-bot-openai.php") →

---

# Changeset [3089461](/changeset/3089461 "Show full changeset") for [chatbot/trunk/includes/openai/qcld-bot-openai.php](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3089461 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
05/20/2024 01:29:10 PM
([8 months](/timeline?from=2024-05-20T13%3A29%3A10Z&precision=second "See timeline at 05/20/2024 01:29:10 PM") ago)

Author:
quantumcloud
Message:

# Removed unnecessary functions

# Improved security

File:

1 edited

* [chatbot/trunk/includes/openai/qcld-bot-openai.php](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3089461 "Show entry in browser")
  (modified)
  ([6 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [chatbot/trunk/includes/openai/qcld-bot-openai.php](/changeset/3089461/chatbot/trunk/includes/openai/qcld-bot-openai.php "Show the changeset 3089461 restricted to chatbot/trunk/includes/openai/qcld-bot-openai.php")

  | [r3077619](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3077619#L62 "Show revision 3077619 of this file in browser") | [r3089461](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3089461#L62 "Show revision 3089461 of this file in browser") |  |
  | --- | --- | --- |
  | 62 | 62 | add\_action('wp\_ajax\_openai\_settings\_option', [$this, 'openai\_settings\_option\_callback']); |
  | 63 | 63 | add\_action('wp\_ajax\_openai\_response',[$this,'openai\_response\_callback']); |
  | 64 |  | add\_action('wp\_ajax\_openai\_file\_list',[$this,'openai\_file\_list\_callback']); |
  | 65 |  | add\_action('wp\_ajax\_openai\_file\_upload',[$this,'openai\_file\_upload\_callback']); |
  | 66 |  | add\_action('wp\_ajax\_openai\_file\_delete',[$this,'openai\_file\_delete\_callback']); |
  |  | 64 | // add\_action('wp\_ajax\_openai\_file\_list',[$this,'openai\_file\_list\_callback']); |
  |  | 65 | // add\_action('wp\_ajax\_openai\_file\_upload',[$this,'openai\_file\_upload\_callback']); |
  |  | 66 | // add\_action('wp\_ajax\_openai\_file\_delete',[$this,'openai\_file\_delete\_callback']); |
  | 67 | 67 | add\_action('wp\_ajax\_nopriv\_openai\_response', [$this, 'openai\_response\_callback']); |
  | 68 |  | add\_action('wp\_ajax\_qcld\_openai\_file\_dowload',[$this,'qcld\_openai\_file\_dowload']); |
  |  | 68 | // add\_action('wp\_ajax\_qcld\_openai\_file\_dowload',[$this,'qcld\_openai\_file\_dowload']); |
  | 69 | 69 |  |
  | 70 | 70 | if (is\_admin() && !empty($\_GET["page"]) && (($\_GET["page"] == "openai-panel\_dashboard") || ($\_GET["page"] == "openai-panel\_file") || ($\_GET["page"] == "openai-panel\_help"))) { |
  | […](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3077619#L131) | […](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3089461#L131) |  |
  | 131 | 131 |  |
  | 132 | 132 | } |
  | 133 |  | public function openai\_file\_delete\_callback(){ |
  | 134 |  | $file\_id = sanitize\_text\_field($\_POST['file\_id']); |
  | 135 |  | $url = 'https://api.openai.com/v1/files/'. $file\_id; |
  | 136 |  | $apt\_key = "Authorization: Bearer ". get\_option('open\_ai\_api\_key'); |
  | 137 |  | $ch = curl\_init(); |
  | 138 |  | curl\_setopt($ch, CURLOPT\_URL, $url); |
  | 139 |  | curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, 1); |
  | 140 |  | curl\_setopt($ch, CURLOPT\_CUSTOMREQUEST, 'DELETE'); |
  | 141 |  | $headers = array( |
  | 142 |  | $apt\_key, |
  | 143 |  | ); |
  | 144 |  | curl\_setopt($ch, CURLOPT\_HTTPHEADER, $headers); |
  | 145 |  | $result = curl\_exec($ch); |
  | 146 |  | if (curl\_errno($ch)) { |
  | 147 |  | echo 'Error:' . curl\_error($ch); |
  | 148 |  | } |
  | 149 |  | curl\_close($ch); |
  | 150 |  | wp\_send\_json( json\_decode($result)); |
  | 151 |  | wp\_die(); |
  | 152 |  | } |
  |  | 133 | // public function openai\_file\_delete\_callback(){ |
  |  | 134 | //     $file\_id = sanitize\_text\_field($\_POST['file\_id']); |
  |  | 135 | //     $url = 'https://api.openai.com/v1/files/'. $file\_id; |
  |  | 136 | //     $apt\_key = "Authorization: Bearer ". get\_option('open\_ai\_api\_key'); |
  |  | 137 | //     $ch = curl\_init(); |
  |  | 138 | //     curl\_setopt($ch, CURLOPT\_URL, $url); |
  |  | 139 | //     curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, 1); |
  |  | 140 | //     curl\_setopt($ch, CURLOPT\_CUSTOMREQUEST, 'DELETE'); |
  |  | 141 | //     $headers = array( |
  |  | 142 | //         $apt\_key, |
  |  | 143 | //     ); |
  |  | 144 | //     curl\_setopt($ch, CURLOPT\_HTTPHEADER, $headers); |
  |  | 145 | //     $result = curl\_exec($ch); |
  |  | 146 | //     if (curl\_errno($ch)) { |
  |  | 147 | //         echo 'Error:' . curl\_error($ch); |
  |  | 148 | //     } |
  |  | 149 | //     curl\_close($ch); |
  |  | 150 | //    wp\_send\_json( json\_decode($result)); |
  |  | 151 | //    wp\_die(); |
  |  | 152 | // } |
  | 153 | 153 |  |
  | 154 | 154 | public function buildFormBody( $fields, $boundary ) |
  | […](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3077619#L173) | […](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3089461#L173) |  |
  | 173 | 173 | } |
  | 174 | 174 |  |
  | 175 |  | public function openai\_file\_list\_callback(){ |
  | 176 |  | $url = 'https://api.openai.com/v1/files'; |
  | 177 |  | $apt\_key = "Authorization: Bearer ". get\_option('open\_ai\_api\_key'); |
  | 178 |  | $curl = curl\_init(); |
  | 179 |  | curl\_setopt($curl, CURLOPT\_URL, $url); |
  | 180 |  | $headers = array( |
  | 181 |  | "Content-Type: application/json", |
  | 182 |  | $apt\_key, |
  | 183 |  | ); |
  | 184 |  | curl\_setopt($curl, CURLOPT\_HTTPHEADER, $headers); |
  | 185 |  | curl\_setopt($curl, CURLOPT\_RETURNTRANSFER, true); |
  | 186 |  | $response = curl\_exec($curl); |
  | 187 |  | curl\_close($curl); |
  | 188 |  | wp\_send\_json( json\_decode($response)); |
  | 189 |  | wp\_die(); |
  | 190 |  | } |
  |  | 175 | // public function openai\_file\_list\_callback(){ |
  |  | 176 | //     $url = 'https://api.openai.com/v1/files'; |
  |  | 177 | //     $apt\_key = "Authorization: Bearer ". get\_option('open\_ai\_api\_key'); |
  |  | 178 | //     $curl = curl\_init(); |
  |  | 179 | //     curl\_setopt($curl, CURLOPT\_URL, $url); |
  |  | 180 | //     $headers = array( |
  |  | 181 | //         "Content-Type: application/json", |
  |  | 182 | //         $apt\_key, |
  |  | 183 | //     ); |
  |  | 184 | //     curl\_setopt($curl, CURLOPT\_HTTPHEADER, $headers); |
  |  | 185 | //     curl\_setopt($curl, CURLOPT\_RETURNTRANSFER, true); |
  |  | 186 | //     $response = curl\_exec($curl); |
  |  | 187 | //     curl\_close($curl); |
  |  | 188 | //     wp\_send\_json( json\_decode($response)); |
  |  | 189 | //     wp\_die(); |
  |  | 190 | // } |
  | 191 | 191 | public function qcld\_sanitize\_text\_or\_array\_field($array\_or\_string) { |
  | 192 | 192 | if( is\_string($array\_or\_string) ){ |
  | […](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3077619#L206) | […](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3089461#L206) |  |
  | 206 | 206 | } |
  | 207 | 207 |  |
  | 208 |  | public function openai\_file\_upload\_callback(){ |
  | 209 |  | $uploadedfile = $\_FILES['file']; |
  | 210 |  | $url = 'https://api.openai.com/v1/files'; |
  | 211 |  | $apt\_key = "Authorization: Bearer ". get\_option('open\_ai\_api\_key'); |
  | 212 |  | $curl = curl\_init($url); |
  | 213 |  | curl\_setopt($curl, CURLOPT\_URL, $url); |
  | 214 |  | curl\_setopt($curl, CURLOPT\_POST, true); |
  | 215 |  | $headers = array( |
  | 216 |  | "Content-Type: multipart/form-data", |
  | 217 |  | $apt\_key, |
  | 218 |  | ); |
  | 219 |  | if (function\_exists('curl\_file\_create')) { |
  | 220 |  | $tmp\_file = curl\_file\_create($uploadedfile['tmp\_name'], 'jsonl', $uploadedfile['name']); |
  | 221 |  | } else { |
  | 222 |  | $tmp\_file = open($uploadedfile['tmp\_name']); |
  | 223 |  | } |
  | 224 |  | $data = array('file'=> $tmp\_file,'purpose'=> 'fine-tune'); |
  | 225 |  | $init = curl\_init(); |
  | 226 |  | //function parameteres |
  | 227 |  | curl\_setopt($init, CURLOPT\_URL,$url); |
  | 228 |  | curl\_setopt($init, CURLOPT\_HTTPHEADER, $headers); |
  | 229 |  | curl\_setopt($init, CURLOPT\_POSTFIELDS, $data); |
  | 230 |  | curl\_setopt($init, CURLOPT\_RETURNTRANSFER, true); |
  | 231 |  | $res = json\_decode(curl\_exec ($init)); |
  | 232 |  |  |
  | 233 |  | curl\_close ($init); |
  | 234 |  | if(!empty($res->error)){ |
  | 235 |  | $response['status'] = 'error'; |
  | 236 |  | $response['message'] = $res->error->message; |
  | 237 |  | } |
  | 238 |  |  |
  | 239 |  | if(!empty($res->status)){ |
  | 240 |  | $response['status'] = 'success'; |
  | 241 |  | $response['message'] = 'Successfully Created file' . $res->id ; |
  | 242 |  |  |
  | 243 |  | } |
  | 244 |  | echo wp\_send\_json([$response]); |
  | 245 |  | wp\_die(); |
  | 246 |  | } |
  |  | 208 | // public function openai\_file\_upload\_callback(){ |
  |  | 209 | //     $uploadedfile = $\_FILES['file']; |
  |  | 210 | //     $url = 'https://api.openai.com/v1/files'; |
  |  | 211 | //     $apt\_key = "Authorization: Bearer ". get\_option('open\_ai\_api\_key'); |
  |  | 212 | //     $curl = curl\_init($url); |
  |  | 213 | //     curl\_setopt($curl, CURLOPT\_URL, $url); |
  |  | 214 | //     curl\_setopt($curl, CURLOPT\_POST, true); |
  |  | 215 | //     $headers = array( |
  |  | 216 | //         "Content-Type: multipart/form-data", |
  |  | 217 | //         $apt\_key, |
  |  | 218 | //     ); |
  |  | 219 | //     if (function\_exists('curl\_file\_create')) { |
  |  | 220 | //         $tmp\_file = curl\_file\_create($uploadedfile['tmp\_name'], 'jsonl', $uploadedfile['name']); |
  |  | 221 | //     } else { |
  |  | 222 | //         $tmp\_file = open($uploadedfile['tmp\_name']); |
  |  | 223 | //     } |
  |  | 224 | //     $data = array('file'=> $tmp\_file,'purpose'=> 'fine-tune'); |
  |  | 225 | //     $init = curl\_init(); |
  |  | 226 | //     //function parameteres |
  |  | 227 | //     curl\_setopt($init, CURLOPT\_URL,$url); |
  |  | 228 | //     curl\_setopt($init, CURLOPT\_HTTPHEADER, $headers); |
  |  | 229 | //     curl\_setopt($init, CURLOPT\_POSTFIELDS, $data); |
  |  | 230 | //     curl\_setopt($init, CURLOPT\_RETURNTRANSFER, true); |
  |  | 231 | //     $res = json\_decode(curl\_exec ($init)); |
  |  | 232 |  |
  |  | 233 | //     curl\_close ($init); |
  |  | 234 | //     if(!empty($res->error)){ |
  |  | 235 | //         $response['status'] = 'error'; |
  |  | 236 | //         $response['message'] = $res->error->message; |
  |  | 237 | //     } |
  |  | 238 |  |
  |  | 239 | //     if(!empty($res->status)){ |
  |  | 240 | //         $response['status'] = 'success'; |
  |  | 241 | //         $response['message'] = 'Successfully Created file' . $res->id ; |
  |  | 242 |  |
  |  | 243 | //     } |
  |  | 244 | //     echo wp\_send\_json([$response]); |
  |  | 245 | //     wp\_die(); |
  |  | 246 | // } |
  | 247 | 247 | public function openai\_finetune\_create($file\_id,$ft\_suffix,$ft\_engines){ |
  | 248 | 248 | $apt\_key = "Authorization: Bearer ". get\_option('open\_ai\_api\_key'); |
  | […](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3077619#L326) | […](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3089461#L326) |  |
  | 326 | 326 | return $result; |
  | 327 | 327 | if (curl\_errno($ch)) { |
  |  | 328 | // phpcs:ignore |
  | 328 | 329 | echo 'Error:' . curl\_error($ch); |
  | 329 | 330 | } |
  | […](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3077619#L557) | […](/browser/chatbot/trunk/includes/openai/qcld-bot-openai.php?rev=3089461#L558) |  |
  | 557 | 558 | setcookie('qcld\_threads\_id',$threads\_id  , time() + (60000), "/"); |
  | 558 | 559 | if (curl\_errno($ch)) { |
  |  | 560 | // phpcs:ignore |
  | 559 | 561 | echo 'Error: ' . curl\_error($ch); |
  | 560 | 562 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3089461)
* [Zip Archive](?format=zip&new=3089461)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

