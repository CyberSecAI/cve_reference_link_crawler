The provided content is related to CVE-2024-49195.

**Root cause of vulnerability:**
The functions `mbedtls_pk_write_key_der()` and `mbedtls_pk_write_key_pem()` can cause a buffer underrun when the output buffer is too small in certain cases. This occurs when the code writes data to an intermediate buffer and then copies it to the output buffer without verifying if the output buffer is large enough.

**Weaknesses/vulnerabilities present:**
- Buffer underrun in `mbedtls_pk_write_key_der()` and `mbedtls_pk_write_key_pem()`.
- Insufficient output buffer size check when writing an opaque key pair.

**Impact of exploitation:**
- Stack or heap corruption due to buffer underrun.

**Attack vectors:**
- Calling the vulnerable functions with an output buffer that is too small.

**Required attacker capabilities/position:**
- Ability to call `mbedtls_pk_write_key_der()` or `mbedtls_pk_write_key_pem()` with a crafted output buffer and a PK context containing an opaque key.
- The compile-time option `MBEDTLS_USE_PSA_CRYPTO` must be enabled.
- For elliptic curve keys, `MBEDTLS_ECP_C` must be enabled, and the output buffer must be smaller than the uncompressed public key representation.
- For RSA keys with `mbedtls_pk_write_key_der()`, the buffer must be smaller than the actual output.
- For RSA keys with `mbedtls_pk_write_key_pem()`, `MBEDTLS_MPI_MAX_SIZE` must be less than or equal to 420.