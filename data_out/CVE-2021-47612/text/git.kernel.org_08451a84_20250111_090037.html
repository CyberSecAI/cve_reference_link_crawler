

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d731ecc6f2eaec68f4ad1542283bbc7d07bd0112)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d731ecc6f2eaec68f4ad1542283bbc7d07bd0112)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d731ecc6f2eaec68f4ad1542283bbc7d07bd0112)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d731ecc6f2eaec68f4ad1542283bbc7d07bd0112)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tadeusz Struk <tadeusz.struk@linaro.org> | 2021-12-08 10:27:42 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-17 10:12:23 +0100 |
| commit | [d731ecc6f2eaec68f4ad1542283bbc7d07bd0112](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d731ecc6f2eaec68f4ad1542283bbc7d07bd0112) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d731ecc6f2eaec68f4ad1542283bbc7d07bd0112)) | |
| tree | [27902f5ee49ff0ae76d3de7ebc938b6edb592936](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d731ecc6f2eaec68f4ad1542283bbc7d07bd0112) | |
| parent | [c32c40ff80928cfcea7435e27330cb995f6bfb67](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c32c40ff80928cfcea7435e27330cb995f6bfb67) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d731ecc6f2eaec68f4ad1542283bbc7d07bd0112&id2=c32c40ff80928cfcea7435e27330cb995f6bfb67)) | |
| download | [linux-d731ecc6f2eaec68f4ad1542283bbc7d07bd0112.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d731ecc6f2eaec68f4ad1542283bbc7d07bd0112.tar.gz) | |

nfc: fix segfault in nfc\_genl\_dump\_devices\_donecommit fd79a0cbf0b2e34bcc45b13acf962e2032a82203 upstream.
When kmalloc in nfc\_genl\_dump\_devices() fails then
nfc\_genl\_dump\_devices\_done() segfaults as below
KASAN: null-ptr-deref in range [0x0000000000000008-0x000000000000000f]
CPU: 0 PID: 25 Comm: kworker/0:1 Not tainted 5.16.0-rc4-01180-g2a987e65025e-dirty #5
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.14.0-6.fc35 04/01/2014
Workqueue: events netlink\_sock\_destruct\_work
RIP: 0010:klist\_iter\_exit+0x26/0x80
Call Trace:
<TASK>
class\_dev\_iter\_exit+0x15/0x20
nfc\_genl\_dump\_devices\_done+0x3b/0x50
genl\_lock\_done+0x84/0xd0
netlink\_sock\_destruct+0x8f/0x270
\_\_sk\_destruct+0x64/0x3b0
sk\_destruct+0xa8/0xd0
\_\_sk\_free+0x2e8/0x3d0
sk\_free+0x51/0x90
netlink\_sock\_destruct\_work+0x1c/0x20
process\_one\_work+0x411/0x710
worker\_thread+0x6fd/0xa80
Link: <https://syzkaller.appspot.com/bug?id=fc0fa5a53db9edd261d56e74325419faf18bd0df>
Reported-by: syzbot+f9f76f4a0766420b4a02@syzkaller.appspotmail.com
Signed-off-by: Tadeusz Struk <tadeusz.struk@linaro.org>
Reviewed-by: Krzysztof Kozlowski <krzysztof.kozlowski@canonical.com>
Link: [https://lore.kernel.org/r/20211208182742.340542-1-tadeusz.struk@linaro.org](https://lore.kernel.org/r/20211208182742.340542-1-tadeusz.struk%40linaro.org)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d731ecc6f2eaec68f4ad1542283bbc7d07bd0112)

| -rw-r--r-- | [net/nfc/netlink.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/nfc/netlink.c?id=d731ecc6f2eaec68f4ad1542283bbc7d07bd0112) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/net/nfc/netlink.c b/net/nfc/netlink.cindex 0f61dad7256b8d..4d90cbdc083b5e 100644--- a/[net/nfc/netlink.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/nfc/netlink.c?id=c32c40ff80928cfcea7435e27330cb995f6bfb67)+++ b/[net/nfc/netlink.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/nfc/netlink.c?id=d731ecc6f2eaec68f4ad1542283bbc7d07bd0112)@@ -644,8 +644,10 @@ static int nfc\_genl\_dump\_devices\_done(struct netlink\_callback \*cb) { struct class\_dev\_iter \*iter = (struct class\_dev\_iter \*) cb->args[0]; - nfc\_device\_iter\_exit(iter);- kfree(iter);+ if (iter) {+ nfc\_device\_iter\_exit(iter);+ kfree(iter);+ }  return 0; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 08:59:14 +0000

