Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT361448)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T361448
# CVE-2024-40599: GuMaxDD skin: stored XSS via MediaWiki:SidebarClosed, Resolved[Public](/policy/explain/PHID-TASK-xptuohn6xr7kltoqxpkg/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/361448/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/361448/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-xptuohn6xr7kltoqxpkg/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-xptuohn6xr7kltoqxpkg/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-xptuohn6xr7kltoqxpkg/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-xptuohn6xr7kltoqxpkg/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-xptuohn6xr7kltoqxpkg/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-xptuohn6xr7kltoqxpkg/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-xptuohn6xr7kltoqxpkg/)
* [Protect as security issue](/wmf/escalate-task/361448/)
* [Award Token](/token/give/PHID-TASK-xptuohn6xr7kltoqxpkg/)
* [Flag For Later](/flag/edit/PHID-TASK-xptuohn6xr7kltoqxpkg/)

Assigned To

|  | [ashley](/p/ashley/) |
| --- | --- |

Authored By

|  | [ashley](/p/ashley/) |
| --- | --- |
| Mar 31 2024, 7:09 PM2024-03-31 19:09:50 (UTC+0) |

Tags

* [Security](/tag/security/)
* [Vuln-XSS](/tag/vuln-xss/)
* [MediaWiki-skins-GuMaxDD](/tag/mediawiki-skins-gumaxdd/) [(Backlog)](/project/board/5131/)
* [SecTeam-Processed](/tag/secteam-processed/) [(Completed)](/project/board/5180/)
* [security-bug](/tag/security-bug/)
Referenced FilesNoneSubscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [ashley](/p/ashley/) |
| --- | --- |

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |

|  | [sbassett](/p/sbassett/) |
| --- | --- |

# Description

Top-level menu entries from MediaWiki:Sidebar are not properly escaped in the [MediaWiki-skins-GuMaxDD](/tag/mediawiki-skins-gumaxdd/) skin, resulting in classic stored XSS.

Minimal test case:

1. As an (interface) administrator or other similarly privileged (editinterface) user, create a top level menu entry "named" "><script>alert('XSS')</script> in MediaWiki:Sidebar
2. Load a page with the GuMaxDD skin

Expected result:

No alert.

Actual result:

The alertruns not once but twice (!).

Proposed & tested patch:

```
diff --git a/GuMaxDD.skin.php b/GuMaxDD.skin.php
index 52c4997..d9bfa89 100644
--- a/GuMaxDD.skin.php
+++ b/GuMaxDD.skin.php
@@ -302,7 +302,7 @@ class GuMaxDDTemplate extends BaseTemplate {
                                default:
                                        $out = $skin->msg( $bar );
                                        if ( $out->isDisabled() ) {
-                                               $txtOut = $bar;
+                                               $txtOut = htmlspecialchars( $bar, ENT_QUOTES );
                                        } else {
                                                $txtOut = $out->escaped();
                                        }
@@ -315,7 +315,7 @@ class GuMaxDDTemplate extends BaseTemplate {
                                // "in other languages" menu on NS_SPECIAL and that'd be ugly.
                                if ( $txtOut && !( $isSpecial && $bar === 'LANGUAGES' ) ) {
 ?>
-                       <li><a class="gumax-nav-heading gumax-nav-heading-<?php echo mb_strtolower( Sanitizer::escapeIdForAttribute( $bar ) ) ?>" href="#"><?php echo $txtOut; ?> &raquo;</a>
+                       <li><a class="gumax-nav-heading gumax-nav-heading-<?php echo mb_strtolower( htmlspecialchars( Sanitizer::escapeIdForAttribute( $bar ), ENT_QUOTES ) ) ?>" href="#"><?php echo $txtOut; ?> &raquo;</a>
 <?php
                        # XXX JaTu fix
                        if ( $bar == 'SEARCH' ) { ?>
```
# Details

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [SECURITY: avoid stored XSS via MediaWiki:Sidebar](https://gerrit.wikimedia.org/r/c/1051769) | [mediawiki/skins/GuMaxDD](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/skins/GuMaxDD) | [REL1\_41](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/skins/GuMaxDD/%2B/REL1_41) | +2 -2 |
|  | [SECURITY: avoid stored XSS via MediaWiki:Sidebar](https://gerrit.wikimedia.org/r/c/1051771) | [mediawiki/skins/GuMaxDD](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/skins/GuMaxDD) | [REL1\_39](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/skins/GuMaxDD/%2B/REL1_39) | +2 -2 |
|  | [SECURITY: avoid stored XSS via MediaWiki:Sidebar](https://gerrit.wikimedia.org/r/c/1051770) | [mediawiki/skins/GuMaxDD](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/skins/GuMaxDD) | [REL1\_40](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/skins/GuMaxDD/%2B/REL1_40) | +2 -2 |
|  | [SECURITY: avoid stored XSS via MediaWiki:Sidebar](https://gerrit.wikimedia.org/r/c/1016851) | [mediawiki/skins/GuMaxDD](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/skins/GuMaxDD) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/skins/GuMaxDD/%2B/master) | +2 -2 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T361448)
# Related Objects

* Mentions

Mentioned In [rSGMDfba7f18fd02c: SECURITY: avoid stored XSS via MediaWiki:Sidebar](/rSGMDfba7f18fd02ca9c12953d902d774fac50d3f86eb)
[rSGMD8557f829f0f1: SECURITY: avoid stored XSS via MediaWiki:Sidebar](/rSGMD8557f829f0f10b8deb7c74676c321cdb2b852b8b)
[rSGMDd83c0a04e676: SECURITY: avoid stored XSS via MediaWiki:Sidebar](/rSGMDd83c0a04e676d8cf832e029ad5648c300f2d5637)
[T361321: Write and send supplementary release announcement for extensions and skins with security patches (1.39.8/1.40.4/1.41.2/1.42.0)](/T361321)
[T361452: CVE-2024-40605: Foreground skin: stored XSS via MediaWiki:Sidebar](/T361452)
[T361451: CVE-2024-40602: Tempo skin: stored XSS via MediaWiki:Sidebar](/T361451)
[T361450: CVE-2024-40604: Nimbus skin: stored XSS via MediaWiki:Nimbus-sidebar](/T361450) Mentioned Here [T361321: Write and send supplementary release announcement for extensions and skins with security patches (1.39.8/1.40.4/1.41.2/1.42.0)](/T361321)
### Event Timeline

[ashley](/p/ashley/) created this task.[Mar 31 2024, 7:09 PM2024-03-31 19:09:50 (UTC+0)](#9675108)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/5856631/)[Mar 31 2024, 7:09 PM2024-03-31 19:09:51 (UTC+0)](#9675118)[ashley](/p/ashley/) claimed this task.[Mar 31 2024, 7:10 PM2024-03-31 19:10:16 (UTC+0)](#9675119)[ashley](/p/ashley/) added projects: [Vuln-XSS](/tag/vuln-xss/), [MediaWiki-skins-GuMaxDD](/tag/mediawiki-skins-gumaxdd/).[ashley](/p/ashley/) mentioned this in [T361450: CVE-2024-40604: Nimbus skin: stored XSS via MediaWiki:Nimbus-sidebar](/T361450).[Mar 31 2024, 7:42 PM2024-03-31 19:42:32 (UTC+0)](#9675149)[ashley](/p/ashley/) mentioned this in [T361451: CVE-2024-40602: Tempo skin: stored XSS via MediaWiki:Sidebar](/T361451).[Mar 31 2024, 8:08 PM2024-03-31 20:08:15 (UTC+0)](#9675175)[ashley](/p/ashley/) mentioned this in [T361452: CVE-2024-40605: Foreground skin: stored XSS via MediaWiki:Sidebar](/T361452).[Mar 31 2024, 9:25 PM2024-03-31 21:25:08 (UTC+0)](#9675211)[sbassett](/p/sbassett/) mentioned this in [T361321: Write and send supplementary release announcement for extensions and skins with security patches (1.39.8/1.40.4/1.41.2/1.42.0)](/T361321).[Apr 2 2024, 5:56 PM2024-04-02 17:56:49 (UTC+0)](#9681773)[sbassett](/p/sbassett/) edited projects, added [SecTeam-Processed](/tag/secteam-processed/); removed [Security-Team](/tag/security-team/).[sbassett](/p/sbassett/) subscribed.Comment Actions

Since this skin isn't deployed or bundled, the proposed patch can go through gerrit at any time. It will be (re)announced via the next supplemental security release: [T361321](/T361321).

[sbassett](/p/sbassett/) added a project: [security-bug](/tag/security-bug/).[Apr 2 2024, 7:00 PM2024-04-02 19:00:55 (UTC+0)](#9681977)[Bawolff](/p/Bawolff/) subscribed.[Apr 3 2024, 9:03 PM2024-04-03 21:03:41 (UTC+0)](#9686142)Comment Actions

lgtm

[ashley](/p/ashley/) mentioned this in [rSGMDd83c0a04e676: SECURITY: avoid stored XSS via MediaWiki:Sidebar](/rSGMDd83c0a04e676d8cf832e029ad5648c300f2d5637).[Apr 3 2024, 9:24 PM2024-04-03 21:24:04 (UTC+0)](#9686206)[Bawolff](/p/Bawolff/) closed this task as Resolved.[Apr 16 2024, 4:59 AM2024-04-16 04:59:01 (UTC+0)](#9716248)[Bawolff](/p/Bawolff/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-m3zfpuisdgbvmkt/)" to "Public (No Login Required)".[Bawolff](/p/Bawolff/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-rkcmz6lstpgteju/)" to "All Users".[gerritbot](/p/gerritbot/) added a comment.[Jul 3 2024, 2:45 PM2024-07-03 14:45:10 (UTC+0)](#9949880)Comment Actions

Change #1051769 had a related patch set uploaded (by Mmartorana; author: Jack Phoenix):

[mediawiki/skins/GuMaxDD@REL1\_41] SECURITY: avoid stored XSS via MediaWiki:Sidebar

<https://gerrit.wikimedia.org/r/1051769>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Jul 3 2024, 2:45 PM2024-07-03 14:45:11 (UTC+0)](#9949881)Comment Actions

Change #1051770 had a related patch set uploaded (by Mmartorana; author: Jack Phoenix):

[mediawiki/skins/GuMaxDD@REL1\_40] SECURITY: avoid stored XSS via MediaWiki:Sidebar

<https://gerrit.wikimedia.org/r/1051770>

[gerritbot](/p/gerritbot/) added a comment.[Jul 3 2024, 2:46 PM2024-07-03 14:46:10 (UTC+0)](#9949889)Comment Actions

Change #1051771 had a related patch set uploaded (by Mmartorana; author: Jack Phoenix):

[mediawiki/skins/GuMaxDD@REL1\_39] SECURITY: avoid stored XSS via MediaWiki:Sidebar

<https://gerrit.wikimedia.org/r/1051771>

[gerritbot](/p/gerritbot/) added a comment.[Jul 5 2024, 7:38 PM2024-07-05 19:38:26 (UTC+0)](#9957554)Comment Actions

Change #1051770 **abandoned** by Umherirrender:

[mediawiki/skins/GuMaxDD@REL1\_40] SECURITY: avoid stored XSS via MediaWiki:Sidebar

Reason:

REL1\_40 is end of life

<https://gerrit.wikimedia.org/r/1051770>

[gerritbot](/p/gerritbot/) added a comment.[Jul 5 2024, 7:49 PM2024-07-05 19:49:07 (UTC+0)](#9957583)Comment Actions

Change #1051771 **merged** by jenkins-bot:

[mediawiki/skins/GuMaxDD@REL1\_39] SECURITY: avoid stored XSS via MediaWiki:Sidebar

<https://gerrit.wikimedia.org/r/1051771>

[gerritbot](/p/gerritbot/) added a comment.[Jul 5 2024, 7:49 PM2024-07-05 19:49:27 (UTC+0)](#9957584)Comment Actions

Change #1051769 **merged** by jenkins-bot:

[mediawiki/skins/GuMaxDD@REL1\_41] SECURITY: avoid stored XSS via MediaWiki:Sidebar

<https://gerrit.wikimedia.org/r/1051769>

[mmartorana](/p/mmartorana/) mentioned this in [rSGMD8557f829f0f1: SECURITY: avoid stored XSS via MediaWiki:Sidebar](/rSGMD8557f829f0f10b8deb7c74676c321cdb2b852b8b).[Jul 5 2024, 7:51 PM2024-07-05 19:51:40 (UTC+0)](#9957589)[mmartorana](/p/mmartorana/) mentioned this in [rSGMDfba7f18fd02c: SECURITY: avoid stored XSS via MediaWiki:Sidebar](/rSGMDfba7f18fd02ca9c12953d902d774fac50d3f86eb).[mmartorana](/p/mmartorana/) renamed this task from GuMaxDD skin: stored XSS via MediaWiki:Sidebar to CVE-2024-40599: GuMaxDD skin: stored XSS via MediaWiki:Sidebar.[Jul 8 2024, 5:35 PM2024-07-08 17:35:35 (UTC+0)](#9962223)[Maintenance\_bot](/p/Maintenance_bot/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[Jul 9 2024, 7:52 PM2024-07-09 19:52:44 (UTC+0)](#9966886)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)