
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty-incubator-codec-ohttp%2Fsecurity%2Fadvisories%2FGHSA-q8f2-hxq5-cp4h)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty-incubator-codec-ohttp%2Fsecurity%2Fadvisories%2FGHSA-q8f2-hxq5-cp4h)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=netty%2Fnetty-incubator-codec-ohttp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[netty](/netty)
/
**[netty-incubator-codec-ohttp](/netty/netty-incubator-codec-ohttp)**
Public

* [Notifications](/login?return_to=%2Fnetty%2Fnetty-incubator-codec-ohttp) You must be signed in to change notification settings
* [Fork
  3](/login?return_to=%2Fnetty%2Fnetty-incubator-codec-ohttp)
* [Star
   3](/login?return_to=%2Fnetty%2Fnetty-incubator-codec-ohttp)

* [Code](/netty/netty-incubator-codec-ohttp)
* [Issues
  0](/netty/netty-incubator-codec-ohttp/issues)
* [Pull requests
  0](/netty/netty-incubator-codec-ohttp/pulls)
* [Actions](/netty/netty-incubator-codec-ohttp/actions)
* [Projects
  0](/netty/netty-incubator-codec-ohttp/projects)
* [Security](/netty/netty-incubator-codec-ohttp/security)
* [Insights](/netty/netty-incubator-codec-ohttp/pulse)

Additional navigation options

* [Code](/netty/netty-incubator-codec-ohttp)
* [Issues](/netty/netty-incubator-codec-ohttp/issues)
* [Pull requests](/netty/netty-incubator-codec-ohttp/pulls)
* [Actions](/netty/netty-incubator-codec-ohttp/actions)
* [Projects](/netty/netty-incubator-codec-ohttp/projects)
* [Security](/netty/netty-incubator-codec-ohttp/security)
* [Insights](/netty/netty-incubator-codec-ohttp/pulse)

# Absent Input Validation in BinaryHttpParser

High

[normanmaurer](/normanmaurer)
published
GHSA-q8f2-hxq5-cp4h
Jul 18, 2024

## Package

maven

io.netty.incubator.codec.bhttp
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

< 0.0.13.Final

## Patched versions

0.0.13.Final

## Description

### Summary

`BinaryHttpParser` does not properly validate input values thus giving attackers almost complete control over the HTTP requests constructed from the parsed output. Attackers can abuse several issues individually to perform various injection attacks including HTTP request smuggling, desync attacks, HTTP header injections, request queue poisoning, caching attacks and Server Side Request Forgery (SSRF). Attacker could also combine several issues to create well-formed messages for other text-based protocols which may result in attacks beyond the HTTP protocol.

### Details

**Path, Authority, Scheme**

The BinaryHttpParser class implements the readRequestHead method which performs most of the relevant parsing of the received request. The data structure prefixes values with a variable length integer value. The algorithm to create a variable length integer value is below:

```
def encode_int(n):
    if n < 64:
        base = 0x00
        l = 1
    elif n in range(64, 16384):
        base = 0x4000
        l = 2
    elif n in range(16384, 1073741824):
        base = 0x80000000
        l = 4
    else:
        base = 0xc000000000000000
        l = 8
   encoded = base | n
   return encoded.to_bytes()

```

The parsing code below first gets the lengths of the values from the prefixed variable length integer. After it has all of the lengths and calculates all of the indices, the parser casts the applicable slices of the ByteBuf to String. Finally, it passes these values into a new `DefaultBinaryHttpRequest` object where no further parsing or validation occurs.

```
//netty-incubator-codec-ohttp/codec-bhttp/src/main/java/io/netty/incubator/codec/bhttp/BinaryHttpParser.java

public final class BinaryHttpParser {
   ...
    private static BinaryHttpRequest readRequestHead(ByteBuf in, boolean knownLength, int maxFieldSectionSize) {
        ...
        final long pathLength = getVariableLengthInteger(in, pathLengthIdx, pathLengthBytes);
        ...
        final int pathIdx = pathLengthIdx + pathLengthBytes;
        ...
/*417*/ String method = in.toString(methodIdx, (int) methodLength, StandardCharsets.US_ASCII);
/*418*/ String scheme = in.toString(schemeIdx, (int) schemeLength, StandardCharsets.US_ASCII);
/*419*/ String authority = in.toString(authorityIdx, (int) authorityLength, StandardCharsets.US_ASCII);
/*420*/ String path = in.toString(pathIdx, (int) pathLength, StandardCharsets.US_ASCII);

/*422*/ BinaryHttpRequest request = new DefaultBinaryHttpRequest(HttpVersion.HTTP_1_1, HttpMethod.valueOf(method),
                scheme, authority, path, headers);
        in.skipBytes(sumBytes);
        return request;
    }
   ...
}

```

**Request Method**

On line 422 above, the parsed method value is passed into `HttpMethod.valueOf` method. The return value from this is passed to the `DefaultBinaryHttpRequest` constructor.

Below is the code for HttpMethod.valueOf:

```
    public static HttpMethod valueOf(String name) {
        // fast-path
        if (name == HttpMethod.GET.name()) {
            return HttpMethod.GET;
        }
        if (name == HttpMethod.POST.name()) {
            return HttpMethod.POST;
        }
        // "slow"-path
        HttpMethod result = methodMap.get(name);
        return result != null ? result : new HttpMethod(name);
    }

```

If the result of `methodMap.get` is not `null`, then a new arbitrary `HttpMethod` instance will be returned using the provided name value.

`methodMap` is an instance of type `EnumNameMap` which is also defined within the `HttpMethod` class:

```
        EnumNameMap(Node<T>... nodes) {
            this.values = (Node[])(new Node[MathUtil.findNextPositivePowerOfTwo(nodes.length)]);
            this.valuesMask = this.values.length - 1;
            Node[] var2 = nodes;
            int var3 = nodes.length;

            for(int var4 = 0; var4 < var3; ++var4) {
                Node<T> node = var2[var4];
                int i = hashCode(node.key) & this.valuesMask;
                if (this.values[i] != null) {
                    throw new IllegalArgumentException("index " + i + " collision between values: [" + this.values[i].key + ", " + node.key + ']');
                }

                this.values[i] = node;
            }

        }

        T get(String name) {
            Node<T> node = this.values[hashCode(name) & this.valuesMask];
            return node != null && node.key.equals(name) ? node.value : null;
        }

```

Note that `EnumNameMap.get()` returns a boolean value, which is not `null`. Therefore, any arbitrary http verb used within a `BinaryHttpRequest` will yield a valid `HttpMethod` object. When the `HttpMethod` object is constructed, the name is checked for whitespace and similar characters. Therefore, we cannot perform complete injection attacks using the HTTP verb alone. However, when combined with the other input validation issues, such as that in the path field, we can construct somewhat arbitrary data blobs that satisfy text-based protocol message formats.

### Impact

Method is partially validated while other values are not validated at all. Software that relies on netty to apply input validation for binary HTTP data may be vulnerable to various injection and protocol based attacks.

### Severity

High

### CVE ID

CVE-2024-40642

### Weaknesses

[CWE-20](/advisories?query=cwe%3A20)

### Credits

* [![@shombo](https://avatars.githubusercontent.com/u/10076478?s=40&v=4)](/shombo)
  [shombo](/shombo)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

