=== Content from github.com_22e285e6_20250111_064223.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty-incubator-codec-ohttp%2Fsecurity%2Fadvisories%2FGHSA-q8f2-hxq5-cp4h)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty-incubator-codec-ohttp%2Fsecurity%2Fadvisories%2FGHSA-q8f2-hxq5-cp4h)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=netty%2Fnetty-incubator-codec-ohttp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[netty](/netty)
/
**[netty-incubator-codec-ohttp](/netty/netty-incubator-codec-ohttp)**
Public

* [Notifications](/login?return_to=%2Fnetty%2Fnetty-incubator-codec-ohttp) You must be signed in to change notification settings
* [Fork
  3](/login?return_to=%2Fnetty%2Fnetty-incubator-codec-ohttp)
* [Star
   3](/login?return_to=%2Fnetty%2Fnetty-incubator-codec-ohttp)

* [Code](/netty/netty-incubator-codec-ohttp)
* [Issues
  0](/netty/netty-incubator-codec-ohttp/issues)
* [Pull requests
  0](/netty/netty-incubator-codec-ohttp/pulls)
* [Actions](/netty/netty-incubator-codec-ohttp/actions)
* [Projects
  0](/netty/netty-incubator-codec-ohttp/projects)
* [Security](/netty/netty-incubator-codec-ohttp/security)
* [Insights](/netty/netty-incubator-codec-ohttp/pulse)

Additional navigation options

* [Code](/netty/netty-incubator-codec-ohttp)
* [Issues](/netty/netty-incubator-codec-ohttp/issues)
* [Pull requests](/netty/netty-incubator-codec-ohttp/pulls)
* [Actions](/netty/netty-incubator-codec-ohttp/actions)
* [Projects](/netty/netty-incubator-codec-ohttp/projects)
* [Security](/netty/netty-incubator-codec-ohttp/security)
* [Insights](/netty/netty-incubator-codec-ohttp/pulse)

# Absent Input Validation in BinaryHttpParser

High

[normanmaurer](/normanmaurer)
published
GHSA-q8f2-hxq5-cp4h
Jul 18, 2024

## Package

maven

io.netty.incubator.codec.bhttp
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

< 0.0.13.Final

## Patched versions

0.0.13.Final

## Description

### Summary

`BinaryHttpParser` does not properly validate input values thus giving attackers almost complete control over the HTTP requests constructed from the parsed output. Attackers can abuse several issues individually to perform various injection attacks including HTTP request smuggling, desync attacks, HTTP header injections, request queue poisoning, caching attacks and Server Side Request Forgery (SSRF). Attacker could also combine several issues to create well-formed messages for other text-based protocols which may result in attacks beyond the HTTP protocol.

### Details

**Path, Authority, Scheme**

The BinaryHttpParser class implements the readRequestHead method which performs most of the relevant parsing of the received request. The data structure prefixes values with a variable length integer value. The algorithm to create a variable length integer value is below:

```
def encode_int(n):
    if n < 64:
        base = 0x00
        l = 1
    elif n in range(64, 16384):
        base = 0x4000
        l = 2
    elif n in range(16384, 1073741824):
        base = 0x80000000
        l = 4
    else:
        base = 0xc000000000000000
        l = 8
   encoded = base | n
   return encoded.to_bytes()

```

The parsing code below first gets the lengths of the values from the prefixed variable length integer. After it has all of the lengths and calculates all of the indices, the parser casts the applicable slices of the ByteBuf to String. Finally, it passes these values into a new `DefaultBinaryHttpRequest` object where no further parsing or validation occurs.

```
//netty-incubator-codec-ohttp/codec-bhttp/src/main/java/io/netty/incubator/codec/bhttp/BinaryHttpParser.java

public final class BinaryHttpParser {
   ...
    private static BinaryHttpRequest readRequestHead(ByteBuf in, boolean knownLength, int maxFieldSectionSize) {
        ...
        final long pathLength = getVariableLengthInteger(in, pathLengthIdx, pathLengthBytes);
        ...
        final int pathIdx = pathLengthIdx + pathLengthBytes;
        ...
/*417*/ String method = in.toString(methodIdx, (int) methodLength, StandardCharsets.US_ASCII);
/*418*/ String scheme = in.toString(schemeIdx, (int) schemeLength, StandardCharsets.US_ASCII);
/*419*/ String authority = in.toString(authorityIdx, (int) authorityLength, StandardCharsets.US_ASCII);
/*420*/ String path = in.toString(pathIdx, (int) pathLength, StandardCharsets.US_ASCII);

/*422*/ BinaryHttpRequest request = new DefaultBinaryHttpRequest(HttpVersion.HTTP_1_1, HttpMethod.valueOf(method),
                scheme, authority, path, headers);
        in.skipBytes(sumBytes);
        return request;
    }
   ...
}

```

**Request Method**

On line 422 above, the parsed method value is passed into `HttpMethod.valueOf` method. The return value from this is passed to the `DefaultBinaryHttpRequest` constructor.

Below is the code for HttpMethod.valueOf:

```
    public static HttpMethod valueOf(String name) {
        // fast-path
        if (name == HttpMethod.GET.name()) {
            return HttpMethod.GET;
        }
        if (name == HttpMethod.POST.name()) {
            return HttpMethod.POST;
        }
        // "slow"-path
        HttpMethod result = methodMap.get(name);
        return result != null ? result : new HttpMethod(name);
    }

```

If the result of `methodMap.get` is not `null`, then a new arbitrary `HttpMethod` instance will be returned using the provided name value.

`methodMap` is an instance of type `EnumNameMap` which is also defined within the `HttpMethod` class:

```
        EnumNameMap(Node<T>... nodes) {
            this.values = (Node[])(new Node[MathUtil.findNextPositivePowerOfTwo(nodes.length)]);
            this.valuesMask = this.values.length - 1;
            Node[] var2 = nodes;
            int var3 = nodes.length;

            for(int var4 = 0; var4 < var3; ++var4) {
                Node<T> node = var2[var4];
                int i = hashCode(node.key) & this.valuesMask;
                if (this.values[i] != null) {
                    throw new IllegalArgumentException("index " + i + " collision between values: [" + this.values[i].key + ", " + node.key + ']');
                }

                this.values[i] = node;
            }

        }

        T get(String name) {
            Node<T> node = this.values[hashCode(name) & this.valuesMask];
            return node != null && node.key.equals(name) ? node.value : null;
        }

```

Note that `EnumNameMap.get()` returns a boolean value, which is not `null`. Therefore, any arbitrary http verb used within a `BinaryHttpRequest` will yield a valid `HttpMethod` object. When the `HttpMethod` object is constructed, the name is checked for whitespace and similar characters. Therefore, we cannot perform complete injection attacks using the HTTP verb alone. However, when combined with the other input validation issues, such as that in the path field, we can construct somewhat arbitrary data blobs that satisfy text-based protocol message formats.

### Impact

Method is partially validated while other values are not validated at all. Software that relies on netty to apply input validation for binary HTTP data may be vulnerable to various injection and protocol based attacks.

### Severity

High

### CVE ID

CVE-2024-40642

### Weaknesses

[CWE-20](/advisories?query=cwe%3A20)

### Credits

* [![@shombo](https://avatars.githubusercontent.com/u/10076478?s=40&v=4)](/shombo)
  [shombo](/shombo)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a61f24bf_20250111_064223.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty-incubator-codec-ohttp%2Fcommit%2Fb687a0cf6ea1030232ea204d73bce82f2698e571)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty-incubator-codec-ohttp%2Fcommit%2Fb687a0cf6ea1030232ea204d73bce82f2698e571)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=netty%2Fnetty-incubator-codec-ohttp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[netty](/netty)
/
**[netty-incubator-codec-ohttp](/netty/netty-incubator-codec-ohttp)**
Public

* [Notifications](/login?return_to=%2Fnetty%2Fnetty-incubator-codec-ohttp) You must be signed in to change notification settings
* [Fork
  3](/login?return_to=%2Fnetty%2Fnetty-incubator-codec-ohttp)
* [Star
   3](/login?return_to=%2Fnetty%2Fnetty-incubator-codec-ohttp)

* [Code](/netty/netty-incubator-codec-ohttp)
* [Issues
  0](/netty/netty-incubator-codec-ohttp/issues)
* [Pull requests
  0](/netty/netty-incubator-codec-ohttp/pulls)
* [Actions](/netty/netty-incubator-codec-ohttp/actions)
* [Projects
  0](/netty/netty-incubator-codec-ohttp/projects)
* [Security](/netty/netty-incubator-codec-ohttp/security)
* [Insights](/netty/netty-incubator-codec-ohttp/pulse)

Additional navigation options

* [Code](/netty/netty-incubator-codec-ohttp)
* [Issues](/netty/netty-incubator-codec-ohttp/issues)
* [Pull requests](/netty/netty-incubator-codec-ohttp/pulls)
* [Actions](/netty/netty-incubator-codec-ohttp/actions)
* [Projects](/netty/netty-incubator-codec-ohttp/projects)
* [Security](/netty/netty-incubator-codec-ohttp/security)
* [Insights](/netty/netty-incubator-codec-ohttp/pulse)

## Commit

[Permalink](/netty/netty-incubator-codec-ohttp/commit/b687a0cf6ea1030232ea204d73bce82f2698e571)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/netty/netty-incubator-codec-ohttp/tree/b687a0cf6ea1030232ea204d73bce82f2698e571)
Browse the repository at this point in the history

```
Motivation:

We need to validate the various parts of the http request head before constructing it to guard against things like injections.

Modifications:

- Validate method, scheme, authority and path
- Unit tests

Result:

No injection possible anymore
```

* Loading branch information

[![@normanmaurer](https://avatars.githubusercontent.com/u/439362?s=40&v=4)](/normanmaurer)

[normanmaurer](/netty/netty-incubator-codec-ohttp/commits?author=normanmaurer "View all commits by normanmaurer")
authored
Jul 18, 2024

1 parent
[8940b7a](/netty/netty-incubator-codec-ohttp/commit/8940b7a4fc6ac609e8cf9579be8d7f459e73b15f)

commit b687a0c

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**150 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* codec-bhttp/src

  + main/java/io/netty/incubator/codec/bhttp

    - codec-bhttp/src/main/java/io/netty/incubator/codec/bhttp/BinaryHttpParser.java
      [BinaryHttpParser.java](#diff-7559d6d93195af3134d2603e335350b3c7c8ea604a0005f608cac2e663c94d6a)
  + test/java/io/netty/incubator/codec/bhttp

    - codec-bhttp/src/test/java/io/netty/incubator/codec/bhttp/BinaryHttpParserTest.java
      [BinaryHttpParserTest.java](#diff-b5965cfcb98941fec30b8e706574ad5b56a740428ebb306bd0acd2fbd80f3126)

## There are no files selected for viewing

49 changes: 48 additions & 1 deletion

49
[codec-bhttp/src/main/java/io/netty/incubator/codec/bhttp/BinaryHttpParser.java](#diff-7559d6d93195af3134d2603e335350b3c7c8ea604a0005f608cac2e663c94d6a "codec-bhttp/src/main/java/io/netty/incubator/codec/bhttp/BinaryHttpParser.java")

Show comments

[View file](/netty/netty-incubator-codec-ohttp/blob/b687a0cf6ea1030232ea204d73bce82f2698e571/codec-bhttp/src/main/java/io/netty/incubator/codec/bhttp/BinaryHttpParser.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -73,12 +73,51 @@ private enum State { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private static final boolean[] ALLOWED\_TOKEN; |
|  |  | private static final boolean[] ALLOWED\_SCHEME; |
|  |  |  |
|  |  | static { |
|  |  | ALLOWED\_TOKEN = new boolean[256]; |
|  |  | for (byte b = Byte.MIN\_VALUE; b < Byte.MAX\_VALUE; b++) { |
|  |  | ALLOWED\_TOKEN[128 + b] = !Character.isWhitespace(b); |
|  |  | } |
|  |  |  |
|  |  | // See https://www.rfc-editor.org/rfc/rfc3986.html |
|  |  | // scheme = ALPHA \*( ALPHA / DIGIT / "+" / "-" / "." ) |
|  |  | ALLOWED\_SCHEME = new boolean[256]; |
|  |  | for (byte b = Byte.MIN\_VALUE; b < Byte.MAX\_VALUE; b++) { |
|  |  | ALLOWED\_SCHEME[128 + b] = Character.isAlphabetic(b) || Character.isDigit(b) || |
|  |  | b == (byte) '+' || b == (byte) '-' || b == (byte) '.'; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // See https://www.rfc-editor.org/rfc/rfc9110.html#section-5.6.2 |
|  |  | private static final ByteProcessor TOKEN\_VALIDATOR = b -> { |
|  |  | // Is whitespace will match whitespaces and delimiters. |
|  |  | if (ALLOWED\_TOKEN[b + 128]) { |
|  |  | return true; |
|  |  | } |
|  |  | throw new IllegalArgumentException( |
|  |  | "Invalid char in token received: '" + b + "' (0x" + Integer.toHexString(b) + ")"); |
|  |  | }; |
|  |  |  |
|  |  | // See https://www.rfc-editor.org/rfc/rfc3986.html |
|  |  | private static final ByteProcessor SCHEME\_VALIDATOR = b -> { |
|  |  | // Is whitespace will match whitespaces and delimiters. |
|  |  | if (ALLOWED\_SCHEME[b + 128]) { |
|  |  | return true; |
|  |  | } |
|  |  | throw new IllegalArgumentException( |
|  |  | "Invalid char in scheme received : '" + b + "' (0x" + Integer.toHexString(b) + ")"); |
|  |  | }; |
|  |  |  |
|  |  | private static final ByteProcessor PADDING\_VALIDATOR = b -> { |
|  |  | // Let's validate that only 0 is used for padding. While this is not strictly required |
|  |  | // it can't harm to enforce it. |
|  |  | // See https://www.rfc-editor.org/rfc/rfc9292.html#section-3.8 |
|  |  | if (b != 0) { |
|  |  | throw new CorruptedFrameException("Invalid byte used for padding: " + b); |
|  |  | throw new CorruptedFrameException( |
|  |  | "Invalid byte used for padding: '" + b + "' (0x" + Integer.toHexString(b) + ")"); |
|  |  | } |
|  |  | return true; |
|  |  | }; |
| Expand Down  Expand Up | | @@ -418,6 +457,14 @@ private static BinaryHttpRequest readRequestHead(ByteBuf in, boolean knownLength |
|  |  | // Add the bytes of the field section as well. |
|  |  | sumBytes += fieldSectionReadableBytes - fieldSectionSlice.readableBytes(); |
|  |  |  |
|  |  | // Let's validate method, scheme, authority and path. |
|  |  | in.forEachByte(methodIdx, (int) methodLength, TOKEN\_VALIDATOR); |
|  |  | in.forEachByte(schemeIdx, (int) schemeLength, SCHEME\_VALIDATOR); |
|  |  |  |
|  |  | // We only do very limited validation for these to ensure there can nothing be injected. |
|  |  | in.forEachByte(authorityIdx, (int) authorityLength, TOKEN\_VALIDATOR); |
|  |  | in.forEachByte(pathIdx, (int) pathLength, TOKEN\_VALIDATOR); |
|  |  |  |
|  |  | String method = in.toString(methodIdx, (int) methodLength, StandardCharsets.US\_ASCII); |
|  |  | String scheme = in.toString(schemeIdx, (int) schemeLength, StandardCharsets.US\_ASCII); |
|  |  | String authority = in.toString(authorityIdx, (int) authorityLength, StandardCharsets.US\_ASCII); |
| Expand Down | |  |

102 changes: 102 additions & 0 deletions

102
[codec-bhttp/src/test/java/io/netty/incubator/codec/bhttp/BinaryHttpParserTest.java](#diff-b5965cfcb98941fec30b8e706574ad5b56a740428ebb306bd0acd2fbd80f3126 "codec-bhttp/src/test/java/io/netty/incubator/codec/bhttp/BinaryHttpParserTest.java")

Show comments

[View file](/netty/netty-incubator-codec-ohttp/blob/b687a0cf6ea1030232ea204d73bce82f2698e571/codec-bhttp/src/test/java/io/netty/incubator/codec/bhttp/BinaryHttpParserTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,102 @@ |
|  |  | /\* |
|  |  | \* Copyright 2024 The Netty Project |
|  |  | \* |
|  |  | \* The Netty Project licenses this file to you under the Apache License, |
|  |  | \* version 2.0 (the "License"); you may not use this file except in compliance |
|  |  | \* with the License. You may obtain a copy of the License at: |
|  |  | \* |
|  |  | \* https://www.apache.org/licenses/LICENSE-2.0 |
|  |  | \* |
|  |  | \* Unless required by applicable law or agreed to in writing, software |
|  |  | \* distributed under the License is distributed on an "AS IS" BASIS, WITHOUT |
|  |  | \* WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the |
|  |  | \* License for the specific language governing permissions and limitations |
|  |  | \* under the License. |
|  |  | \*/ |
|  |  | package io.netty.incubator.codec.bhttp; |
|  |  |  |
|  |  | import io.netty.buffer.ByteBuf; |
|  |  | import io.netty.buffer.Unpooled; |
|  |  | import io.netty.util.CharsetUtil; |
|  |  | import org.junit.jupiter.api.Assertions; |
|  |  | import org.junit.jupiter.params.ParameterizedTest; |
|  |  | import org.junit.jupiter.params.provider.Arguments; |
|  |  | import org.junit.jupiter.params.provider.MethodSource; |
|  |  |  |
|  |  | import java.util.ArrayList; |
|  |  | import java.util.List; |
|  |  | import java.util.stream.Stream; |
|  |  |  |
|  |  | public class BinaryHttpParserTest { |
|  |  |  |
|  |  | @ParameterizedTest(name = "{index} => {0}, {1}, {2}") |
|  |  | @MethodSource("invalidChars") |
|  |  | void testInvalidMethodSuffix(Position p, Part part, String hexString, Character c) { |
|  |  | ByteBuf buffer = Unpooled.buffer(); |
|  |  | VarIntCodecUtils.writeVariableLengthInteger(buffer, 0); |
|  |  |  |
|  |  | writeString(Part.METHOD, "GET", buffer, p, part, c); |
|  |  | writeString(Part.SCHEME, "HTTPS", buffer, p, part, c); |
|  |  | writeString(Part.AUTHORITY, "something", buffer, p, part, c); |
|  |  | writeString(Part.PATH, "/somepath", buffer, p, part, c); |
|  |  | VarIntCodecUtils.writeVariableLengthInteger(buffer, 0); |
|  |  | testInvalidHead(buffer); |
|  |  | } |
|  |  |  |
|  |  | private void writeString(Part currentPart, String str, ByteBuf out, Position p, Part part, Character c) { |
|  |  | if (currentPart == part) { |
|  |  | switch (p) { |
|  |  | case PREFIX: |
|  |  | writeString(out, c + str); |
|  |  | break; |
|  |  | case SUFFIX: |
|  |  | writeString(out, str + c); |
|  |  | break; |
|  |  | case MIDDLE: |
|  |  | writeString(out, str.substring(0, 1) + c + str.substring(1)); |
|  |  | break; |
|  |  | } |
|  |  | } else { |
|  |  | writeString(out, str); |
|  |  | } |
|  |  | } |
|  |  | private static Stream<Arguments> invalidChars() { |
|  |  | List<Arguments> invalid = new ArrayList<>(); |
|  |  | for (int i = Byte.MIN\_VALUE; i < Byte.MAX\_VALUE; i++) { |
|  |  | char c = (char) i; |
|  |  | if (Character.isWhitespace(c)) { |
|  |  | for (Position p: Position.values()) { |
|  |  | for (Part part: Part.values()) { |
|  |  | invalid.add(Arguments.of(p, part, "0x" + Integer.toHexString(c), c)); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | return invalid.stream(); |
|  |  | } |
|  |  |  |
|  |  | private static void writeString(ByteBuf out, String str) { |
|  |  | byte[] bytes = str.getBytes(CharsetUtil.US\_ASCII); |
|  |  | VarIntCodecUtils.writeVariableLengthInteger(out, bytes.length); |
|  |  | out.writeBytes(bytes); |
|  |  | } |
|  |  |  |
|  |  | private static void testInvalidHead(ByteBuf input) { |
|  |  | BinaryHttpParser parser = new BinaryHttpParser(8192); |
|  |  | Assertions.assertThrows(IllegalArgumentException.class, () -> parser.parse(input, false)); |
|  |  | input.release(); |
|  |  | } |
|  |  |  |
|  |  | private enum Position { |
|  |  | PREFIX, |
|  |  | MIDDLE, |
|  |  | SUFFIX; |
|  |  | } |
|  |  |  |
|  |  | private enum Part { |
|  |  | METHOD, |
|  |  | SCHEME, |
|  |  | AUTHORITY, |
|  |  | PATH |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `b687a0c`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty-incubator-codec-ohttp%2Fcommit%2Fb687a0cf6ea1030232ea204d73bce82f2698e571) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


