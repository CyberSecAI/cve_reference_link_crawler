=== Content from github.com_d49b6d21_20250110_222054.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjumpserver%2Fjumpserver%2Fsecurity%2Fadvisories%2FGHSA-633x-3f4f-v9rw)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjumpserver%2Fjumpserver%2Fsecurity%2Fadvisories%2FGHSA-633x-3f4f-v9rw)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=jumpserver%2Fjumpserver)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jumpserver](/jumpserver)
/
**[jumpserver](/jumpserver/jumpserver)**
Public

* [Notifications](/login?return_to=%2Fjumpserver%2Fjumpserver) You must be signed in to change notification settings
* [Fork
  5.4k](/login?return_to=%2Fjumpserver%2Fjumpserver)
* [Star
   25.9k](/login?return_to=%2Fjumpserver%2Fjumpserver)

* [Code](/jumpserver/jumpserver)
* [Issues
  54](/jumpserver/jumpserver/issues)
* [Pull requests
  1](/jumpserver/jumpserver/pulls)
* [Actions](/jumpserver/jumpserver/actions)
* [Projects
  0](/jumpserver/jumpserver/projects)
* [Security](/jumpserver/jumpserver/security)
* [Insights](/jumpserver/jumpserver/pulse)

Additional navigation options

* [Code](/jumpserver/jumpserver)
* [Issues](/jumpserver/jumpserver/issues)
* [Pull requests](/jumpserver/jumpserver/pulls)
* [Actions](/jumpserver/jumpserver/actions)
* [Projects](/jumpserver/jumpserver/projects)
* [Security](/jumpserver/jumpserver/security)
* [Insights](/jumpserver/jumpserver/pulse)

# Session replays download without authentication

High

[ibuler](/ibuler)
published
GHSA-633x-3f4f-v9rw
Sep 15, 2023

## Package

pip

jumpserver
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

v3.0.0 - v3.6.3

## Patched versions

v3.6.4, v3.5.5

## Description

### Impact

Session replays can download without authentication。

The affected versions: v3.0.0 - v3.6.3.

If Your session replays store in S3 or OSS or other cloud storage，not affected.

### Details

The api `/api/v1/terminal/sessions/` permission control is broken and can be accessed anonymously.

```
# https://github.com/jumpserver/jumpserver/blob/v3.6.1/apps/terminal/api/session/session.py#L91
...
class SessionViewSet(OrgBulkModelViewSet):
     permission_classes = [RBACPermission | IsSessionAssignee]
...

# https://github.com/jumpserver/jumpserver/blob/v3.6.1/apps/terminal/permissions.py#L10
class IsSessionAssignee(permissions.BasePermission):
    def has_object_permission(self, request, view, obj):
         ...

class BasePermission:
    def has_permission(self, request, view):
          return True

```

**SessionViewSet** permission classes set to **[RBACPermission | IsSessionAssignee]**, relation is or, so any permission matched will be allowed. **IsSessionAssignee** inherit from **BasePermission**, BasePermission default has\_permission set to True，and not awared this at that time.

To prevent the vulnerability from being exploited, the more details are withheld for now.

### Patches

Safe versions: v3.6.4，v3.5.5

### Workarounds

It is recommended to upgrade the safe versions.

After upgrade, visit the api `$HOST/api/v1/terminal/sessions/?limit=1`, the expected http response code is 401 (not\_authenticated).

### Severity

High

8.2

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
Low

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:H

### CVE ID

CVE-2023-42442

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_86b7451d_20250110_222053.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjumpserver%2Fjumpserver%2Fblob%2Fv3.6.1%2Fapps%2Fterminal%2Fapi%2Fsession%2Fsession.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjumpserver%2Fjumpserver%2Fblob%2Fv3.6.1%2Fapps%2Fterminal%2Fapi%2Fsession%2Fsession.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=jumpserver%2Fjumpserver)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jumpserver](/jumpserver)
/
**[jumpserver](/jumpserver/jumpserver)**
Public

* [Notifications](/login?return_to=%2Fjumpserver%2Fjumpserver) You must be signed in to change notification settings
* [Fork
  5.4k](/login?return_to=%2Fjumpserver%2Fjumpserver)
* [Star
   25.9k](/login?return_to=%2Fjumpserver%2Fjumpserver)

* [Code](/jumpserver/jumpserver/tree/v3.6.1)
* [Issues
  54](/jumpserver/jumpserver/issues)
* [Pull requests
  1](/jumpserver/jumpserver/pulls)
* [Actions](/jumpserver/jumpserver/actions)
* [Projects
  0](/jumpserver/jumpserver/projects)
* [Security](/jumpserver/jumpserver/security)
* [Insights](/jumpserver/jumpserver/pulse)

Additional navigation options

* [Code](/jumpserver/jumpserver/tree/v3.6.1)
* [Issues](/jumpserver/jumpserver/issues)
* [Pull requests](/jumpserver/jumpserver/pulls)
* [Actions](/jumpserver/jumpserver/actions)
* [Projects](/jumpserver/jumpserver/projects)
* [Security](/jumpserver/jumpserver/security)
* [Insights](/jumpserver/jumpserver/pulse)

## Files

 v3.6.1
## Breadcrumbs

1. [jumpserver](/jumpserver/jumpserver/tree/v3.6.1)
2. /[apps](/jumpserver/jumpserver/tree/v3.6.1/apps)
3. /[terminal](/jumpserver/jumpserver/tree/v3.6.1/apps/terminal)
4. /[api](/jumpserver/jumpserver/tree/v3.6.1/apps/terminal/api)
5. /[session](/jumpserver/jumpserver/tree/v3.6.1/apps/terminal/api/session)
/
# session.py

Copy path Blame  Blame
## Latest commit

## History

[History](/jumpserver/jumpserver/commits/v3.6.1/apps/terminal/api/session/session.py)270 lines (230 loc) · 9.85 KB v3.6.1
## Breadcrumbs

1. [jumpserver](/jumpserver/jumpserver/tree/v3.6.1)
2. /[apps](/jumpserver/jumpserver/tree/v3.6.1/apps)
3. /[terminal](/jumpserver/jumpserver/tree/v3.6.1/apps/terminal)
4. /[api](/jumpserver/jumpserver/tree/v3.6.1/apps/terminal/api)
5. /[session](/jumpserver/jumpserver/tree/v3.6.1/apps/terminal/api/session)
/
# session.py

Top
## File metadata and controls

* Code
* Blame

270 lines (230 loc) · 9.85 KB[Raw](https://github.com/jumpserver/jumpserver/raw/refs/tags/v3.6.1/apps/terminal/api/session/session.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270# -\*- coding: utf-8 -\*-#import osimport tarfile
from django.core.files.storage import default\_storagefrom django.db.models import Ffrom django.http import FileResponsefrom django.shortcuts import get\_object\_or\_404, reversefrom django.utils.encoding import escape\_uri\_pathfrom django.utils.translation import gettext as \_from django\_filters import rest\_framework as filtersfrom rest\_framework import genericsfrom rest\_framework import viewsets, viewsfrom rest\_framework.decorators import actionfrom rest\_framework.permissions import IsAuthenticatedfrom rest\_framework.response import Response
from common.api import AsyncApiMixinfrom common.const.http import GETfrom common.drf.filters import BaseFilterSetfrom common.drf.filters import DatetimeRangeFilterfrom common.drf.renders import PassthroughRendererfrom common.storage.replay import ReplayStorageHandlerfrom common.utils import data\_to\_json, is\_uuidfrom common.utils import get\_logger, get\_object\_or\_nonefrom orgs.mixins.api import OrgBulkModelViewSetfrom orgs.utils import tmp\_to\_root\_org, tmp\_to\_orgfrom rbac.permissions import RBACPermissionfrom terminal import serializersfrom terminal.const import TerminalTypefrom terminal.models import Sessionfrom terminal.permissions import IsSessionAssigneefrom terminal.utils import is\_session\_approverfrom users.models import User
\_\_all\_\_ = [ 'SessionViewSet', 'SessionReplayViewSet', 'SessionJoinValidateAPI', 'MySessionAPIView',]
logger = get\_logger(\_\_name\_\_)
class MySessionAPIView(generics.ListAPIView): permission\_classes = (IsAuthenticated,) serializer\_class = serializers.SessionSerializer
 def get\_queryset(self): user = self.request.user qs = Session.objects.filter(user\_id=user.id) return qs
class SessionFilterSet(BaseFilterSet): terminal = filters.CharFilter(method='filter\_terminal')
 class Meta: model = Session fields = [ "user", "asset", "account", "remote\_addr", "protocol", "is\_finished", 'login\_from', 'terminal' ]
 @staticmethod def filter\_terminal(queryset, name, value): if is\_uuid(value): return queryset.filter(terminal\_\_id=value) else: return queryset.filter(terminal\_\_name=value)
class SessionViewSet(OrgBulkModelViewSet): model = Session serializer\_classes = { 'default': serializers.SessionSerializer, 'display': serializers.SessionDisplaySerializer, } search\_fields = [ "user", "asset", "account", "remote\_addr", "protocol", "is\_finished", 'login\_from', ] filterset\_class = SessionFilterSet date\_range\_filter\_fields = [ ('date\_start', ('date\_from', 'date\_to')) ] extra\_filter\_backends = [DatetimeRangeFilter] rbac\_perms = { 'download': ['terminal.download\_sessionreplay'] } permission\_classes = [RBACPermission | IsSessionAssignee]
 @staticmethod def prepare\_offline\_file(session, local\_path): replay\_path = default\_storage.path(local\_path) current\_dir = os.getcwd() dir\_path = os.path.dirname(replay\_path) replay\_filename = os.path.basename(replay\_path) meta\_filename = '{}.json'.format(session.id) offline\_filename = '{}.tar'.format(session.id) os.chdir(dir\_path)
 with open(meta\_filename, 'wt') as f: serializer = serializers.SessionDisplaySerializer(session) data = data\_to\_json(serializer.data) f.write(data)
 with tarfile.open(offline\_filename, 'w') as f: f.add(replay\_filename) f.add(meta\_filename) file = open(offline\_filename, 'rb') os.chdir(current\_dir) return file
 def get\_storage(self): return ReplayStorageHandler(self.get\_object())
 @action(methods=[GET], detail=True, renderer\_classes=(PassthroughRenderer,), url\_path='replay/download', url\_name='replay-download') def download(self, request, \*args, \*\*kwargs): storage = self.get\_storage() local\_path, url = storage.get\_file\_path\_url() if local\_path is None: # url => error message return Response({'error': url}, status=404)
 file = self.prepare\_offline\_file(storage.obj, local\_path) response = FileResponse(file) response['Content-Type'] = 'application/octet-stream' # 这里要注意哦，网上查到的方法都是response['Content-Disposition']='attachment;filename="filename.py"', # 但是如果文件名是英文名没问题，如果文件名包含中文，下载下来的文件名会被改为url中的path。 filename = escape\_uri\_path('{}.tar'.format(storage.obj.id)) disposition = "attachment; filename\*=UTF-8''{}".format(filename) response["Content-Disposition"] = disposition return response
 def get\_queryset(self): queryset = super().get\_queryset().prefetch\_related('terminal') \ .annotate(terminal\_display=F('terminal\_\_name')) return queryset
 def filter\_queryset(self, queryset): queryset = super().filter\_queryset(queryset) # 解决guacamole更新session时并发导致幽灵会话的问题，暂不处理 if self.request.method in ('PATCH',): queryset = queryset.select\_for\_update() return queryset
 def perform\_create(self, serializer): if hasattr(self.request.user, 'terminal'): serializer.validated\_data["terminal"] = self.request.user.terminal return super().perform\_create(serializer)
class SessionReplayViewSet(AsyncApiMixin, viewsets.ViewSet): serializer\_class = serializers.ReplaySerializer download\_cache\_key = "SESSION\_REPLAY\_DOWNLOAD\_{}" session = None rbac\_perms = { 'create': 'terminal.upload\_sessionreplay', 'retrieve': 'terminal.view\_sessionreplay', }
 def create(self, request, \*args, \*\*kwargs): session\_id = kwargs.get('pk') session = get\_object\_or\_404(Session, id=session\_id) serializer = self.serializer\_class(data=request.data)
 if serializer.is\_valid(): file = serializer.validated\_data['file'] # 兼容旧版本 API 未指定 version 为 2 的情况 version = serializer.validated\_data.get('version', 2) name, err = session.save\_replay\_to\_storage\_with\_version(file, version) if not name: msg = "Failed save replay `{}`: {}".format(session\_id, err) logger.error(msg) return Response({'msg': str(err)}, status=400) url = default\_storage.url(name) return Response({'url': url}, status=201) else: msg = 'Upload data invalid: {}'.format(serializer.errors) logger.error(msg) return Response({'msg': serializer.errors}, status=401)
 @staticmethod def get\_replay\_data(session, url): all\_guacamole\_types = ( TerminalType.lion, TerminalType.guacamole, TerminalType.razor, TerminalType.xrdp )
 if url.endswith('.cast.gz'): tp = 'asciicast' elif url.endswith('.replay.mp4'): tp = 'mp4' elif (getattr(session.terminal, 'type', None) in all\_guacamole\_types) or \ (session.protocol in ('rdp', 'vnc')): tp = 'guacamole' else: tp = 'json'
 download\_url = reverse('api-terminal:session-replay-download', kwargs={'pk': session.id}) data = { 'type': tp, 'src': url, 'user': session.user, 'asset': session.asset, 'account': session.account, 'date\_start': session.date\_start, 'date\_end': session.date\_end, 'download\_url': download\_url, } return data
 def is\_need\_async(self): if self.action != 'retrieve': return False return True
 def retrieve(self, request, \*args, \*\*kwargs): session\_id = kwargs.get('pk') session = get\_object\_or\_404(Session, id=session\_id)
 storage = ReplayStorageHandler(session) local\_path, url = storage.get\_file\_path\_url() if local\_path is None: # url => error message return Response({"error": url}, status=404) data = self.get\_replay\_data(session, url) return Response(data)
class SessionJoinValidateAPI(views.APIView): """ 监控用 """ serializer\_class = serializers.SessionJoinValidateSerializer rbac\_perms = { 'POST': 'terminal.validate\_sessionactionperm' }
 def post(self, request, \*args, \*\*kwargs): serializer = self.serializer\_class(data=request.data) if not serializer.is\_valid(): msg = str(serializer.errors) return Response({'ok': False, 'msg': msg}, status=401) user\_id = serializer.validated\_data['user\_id'] session\_id = serializer.validated\_data['session\_id']
 with tmp\_to\_root\_org(): session = get\_object\_or\_none(Session, pk=session\_id) if not session: msg = \_('Session does not exist: {}'.format(session\_id)) return Response({'ok': False, 'msg': msg}, status=401) if not session.can\_join: msg = \_('Session is finished or the protocol not supported') return Response({'ok': False, 'msg': msg}, status=401)
 user = get\_object\_or\_none(User, pk=user\_id) if not user: msg = \_('User does not exist: {}'.format(user\_id)) return Response({'ok': False, 'msg': msg}, status=401)
 with tmp\_to\_org(session.org): if is\_session\_approver(session\_id, user\_id): return Response({'ok': True, 'msg': ''}, status=200)
 if not user.has\_perm('terminal.monitor\_session'): msg = \_('User does not have permission') return Response({'ok': False, 'msg': msg}, status=401)
 return Response({'ok': True, 'msg': ''}, status=200)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4e293758_20250110_222053.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjumpserver%2Fjumpserver%2Fcommit%2F0a58bba59cd275bab8e0ae58bf4b359fbc5eb74a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjumpserver%2Fjumpserver%2Fcommit%2F0a58bba59cd275bab8e0ae58bf4b359fbc5eb74a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=jumpserver%2Fjumpserver)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jumpserver](/jumpserver)
/
**[jumpserver](/jumpserver/jumpserver)**
Public

* [Notifications](/login?return_to=%2Fjumpserver%2Fjumpserver) You must be signed in to change notification settings
* [Fork
  5.4k](/login?return_to=%2Fjumpserver%2Fjumpserver)
* [Star
   25.9k](/login?return_to=%2Fjumpserver%2Fjumpserver)

* [Code](/jumpserver/jumpserver)
* [Issues
  54](/jumpserver/jumpserver/issues)
* [Pull requests
  1](/jumpserver/jumpserver/pulls)
* [Actions](/jumpserver/jumpserver/actions)
* [Projects
  0](/jumpserver/jumpserver/projects)
* [Security](/jumpserver/jumpserver/security)
* [Insights](/jumpserver/jumpserver/pulse)

Additional navigation options

* [Code](/jumpserver/jumpserver)
* [Issues](/jumpserver/jumpserver/issues)
* [Pull requests](/jumpserver/jumpserver/pulls)
* [Actions](/jumpserver/jumpserver/actions)
* [Projects](/jumpserver/jumpserver/projects)
* [Security](/jumpserver/jumpserver/security)
* [Insights](/jumpserver/jumpserver/pulse)

## Commit

[Permalink](/jumpserver/jumpserver/commit/0a58bba59cd275bab8e0ae58bf4b359fbc5eb74a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix: 修复 private storage permission

[Browse files](/jumpserver/jumpserver/tree/0a58bba59cd275bab8e0ae58bf4b359fbc5eb74a)
Browse the repository at this point in the history

* Loading branch information

[![@ibuler](https://avatars.githubusercontent.com/u/17382885?s=40&v=4)](/ibuler) [![@BaiJiangJie](https://avatars.githubusercontent.com/u/32935519?s=40&v=4)](/BaiJiangJie)

[ibuler](/jumpserver/jumpserver/commits?author=ibuler "View all commits by ibuler")
authored and
[BaiJiangJie](/jumpserver/jumpserver/commits?author=BaiJiangJie "View all commits by BaiJiangJie")
committed
Sep 11, 2023

1 parent
[c5102e5](/jumpserver/jumpserver/commit/c5102e567ae40c0f898d5d9a905b94e363d6f5eb)

commit 0a58bba

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**10 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* apps

  + common

    - apps/common/permissions.py
      [permissions.py](#diff-38fd0ac593229b9056b350bfad5d7e56268bd8f7c86ebd2d8d86ffb2fafc587e)
  + jumpserver/rewriting/storage

    - apps/jumpserver/rewriting/storage/permissions.py
      [permissions.py](#diff-483273694af9ca05a943ee0dec83196ba0498312de9dea8e4d2ef4ff6d319af1)
  + terminal

    - apps/terminal/permissions.py
      [permissions.py](#diff-c79ed7b2ff1780ea246557fb7c72eb8269a6e49596262f9e6da97b9f96b88c6e)
  + tickets/permissions

    - apps/tickets/permissions/ticket.py
      [ticket.py](#diff-263fae9c40ada7255e483719f683d6b17941d05c9220d123f1339b970edc1538)
  + users

    - apps/users/permissions.py
      [permissions.py](#diff-e7cda410d62ed68f5c4f8dc4ca96e96d2e3f4f4bb1ba0aa28e0309df1bd00d4c)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[apps/common/permissions.py](#diff-38fd0ac593229b9056b350bfad5d7e56268bd8f7c86ebd2d8d86ffb2fafc587e "apps/common/permissions.py")

Show comments

[View file](/jumpserver/jumpserver/blob/0a58bba59cd275bab8e0ae58bf4b359fbc5eb74a/apps/common/permissions.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,7 +12,7 @@ |
|  |  | from orgs.utils import tmp\_to\_root\_org |
|  |  |  |
|  |  |  |
|  |  | class IsValidUser(permissions.IsAuthenticated, permissions.BasePermission): |
|  |  | class IsValidUser(permissions.IsAuthenticated): |
|  |  | """Allows access to valid user, is active and not expired""" |
|  |  |  |
|  |  | def has\_permission(self, request, view): |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[apps/jumpserver/rewriting/storage/permissions.py](#diff-483273694af9ca05a943ee0dec83196ba0498312de9dea8e4d2ef4ff6d319af1 "apps/jumpserver/rewriting/storage/permissions.py")

Show comments

[View file](/jumpserver/jumpserver/blob/0a58bba59cd275bab8e0ae58bf4b359fbc5eb74a/apps/jumpserver/rewriting/storage/permissions.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,6 +16,8 @@ def allow\_access(private\_file): |
|  |  | path\_base = path\_list[1] if len(path\_list) > 1 else None |
|  |  | path\_perm = path\_perms\_map.get(path\_base, None) |
|  |  |  |
|  |  | if ".." in request\_path: |
|  |  | return False |
|  |  | if not path\_perm: |
|  |  | return False |
|  |  | if path\_perm == '\*' or request.user.has\_perms([path\_perm]): |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[apps/terminal/permissions.py](#diff-c79ed7b2ff1780ea246557fb7c72eb8269a6e49596262f9e6da97b9f96b88c6e "apps/terminal/permissions.py")

Show comments

[View file](/jumpserver/jumpserver/blob/0a58bba59cd275bab8e0ae58bf4b359fbc5eb74a/apps/terminal/permissions.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,13 +1,15 @@ |
|  |  | from rest\_framework import permissions |
|  |  |  |
|  |  | from common.utils import get\_logger |
|  |  |  |
|  |  | logger = get\_logger(\_\_file\_\_) |
|  |  |  |
|  |  |  |
|  |  | \_\_all\_\_ = ['IsSessionAssignee'] |
|  |  |  |
|  |  |  |
|  |  | class IsSessionAssignee(permissions.BasePermission): |
|  |  | class IsSessionAssignee(permissions.IsAuthenticated): |
|  |  | def has\_permission(self, request, view): |
|  |  | return False |
|  |  |  |
|  |  | def has\_object\_permission(self, request, view, obj): |
|  |  | try: |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[apps/tickets/permissions/ticket.py](#diff-263fae9c40ada7255e483719f683d6b17941d05c9220d123f1339b970edc1538 "apps/tickets/permissions/ticket.py")

Show comments

[View file](/jumpserver/jumpserver/blob/0a58bba59cd275bab8e0ae58bf4b359fbc5eb74a/apps/tickets/permissions/ticket.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,12 +1,12 @@ |
|  |  | from rest\_framework import permissions |
|  |  |  |
|  |  |  |
|  |  | class IsAssignee(permissions.BasePermission): |
|  |  | class IsAssignee(permissions.IsAuthenticated): |
|  |  | def has\_object\_permission(self, request, view, obj): |
|  |  | return obj.has\_current\_assignee(request.user) |
|  |  |  |
|  |  |  |
|  |  | class IsApplicant(permissions.BasePermission): |
|  |  | class IsApplicant(permissions.IsAuthenticated): |
|  |  |  |
|  |  | def has\_object\_permission(self, request, view, obj): |
|  |  | return obj.applicant == request.user |

3 changes: 1 addition & 2 deletions

3
[apps/users/permissions.py](#diff-e7cda410d62ed68f5c4f8dc4ca96e96d2e3f4f4bb1ba0aa28e0309df1bd00d4c "apps/users/permissions.py")

Show comments

[View file](/jumpserver/jumpserver/blob/0a58bba59cd275bab8e0ae58bf4b359fbc5eb74a/apps/users/permissions.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,5 @@ |
|  |  | from rest\_framework import permissions |
|  |  |  |
|  |  | from rbac.builtin import BuiltinRole |
|  |  | from .utils import is\_auth\_password\_time\_valid |
|  |  |  |
|  |  |  |
| Expand All | | @@ -11,7 +10,7 @@ def has\_permission(self, request, view): |
|  |  | and is\_auth\_password\_time\_valid(request.session) |
|  |  |  |
|  |  |  |
|  |  | class UserObjectPermission(permissions.BasePermission): |
|  |  | class UserObjectPermission(permissions.IsAuthenticated): |
|  |  |  |
|  |  | def has\_object\_permission(self, request, view, obj): |
|  |  | if view.action not in ['update', 'partial\_update', 'destroy']: |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0a58bba`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjumpserver%2Fjumpserver%2Fcommit%2F0a58bba59cd275bab8e0ae58bf4b359fbc5eb74a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


