

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vasileios Amoiridis <vassilisamir@gmail.com> | 2024-06-06 23:22:55 +0200 |
| --- | --- | --- |
| committer | Jonathan Cameron <Jonathan.Cameron@huawei.com> | 2024-06-09 12:02:13 +0100 |
| commit | [fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)) | |
| tree | [e43bf69485e8b871df5131019a3edff9d5eb4cf1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8) | |
| parent | [b47c0fee73a810c4503c4a94ea34858a1d865bba](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b47c0fee73a810c4503c4a94ea34858a1d865bba) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8&id2=b47c0fee73a810c4503c4a94ea34858a1d865bba)) | |
| download | [linux-fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8.tar.gz) | |

iio: chemical: bme680: Fix overflows in compensate() functionsThere are cases in the compensate functions of the driver that
there could be overflows of variables due to bit shifting ops.
These implications were initially discussed here [1] and they
were mentioned in log message of Commit 1b3bd8592780 ("iio:
chemical: Add support for Bosch BME680 sensor").
[1]: https://lore.kernel.org/linux-iio/20180728114028.3c1bbe81@archlinux/
Fixes: 1b3bd8592780 ("iio: chemical: Add support for Bosch BME680 sensor")
Signed-off-by: Vasileios Amoiridis <vassilisamir@gmail.com>
Link: [https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir@gmail.com](https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir%40gmail.com)
Cc: <Stable@vger.kernel.org>
Signed-off-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)

| -rw-r--r-- | [drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/iio/chemical/bme680_core.c?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/drivers/iio/chemical/bme680\_core.c b/drivers/iio/chemical/bme680\_core.cindex 812829841733bd..5db48f6d646c1d 100644--- a/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=b47c0fee73a810c4503c4a94ea34858a1d865bba)+++ b/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)@@ -342,10 +342,10 @@ static s16 bme680\_compensate\_temp(struct bme680\_data \*data, if (!calib->par\_t2) bme680\_read\_calib(data, calib); - var1 = (adc\_temp >> 3) - (calib->par\_t1 << 1);+ var1 = (adc\_temp >> 3) - ((s32)calib->par\_t1 << 1); var2 = (var1 \* calib->par\_t2) >> 11; var3 = ((var1 >> 1) \* (var1 >> 1)) >> 12;- var3 = (var3 \* (calib->par\_t3 << 4)) >> 14;+ var3 = (var3 \* ((s32)calib->par\_t3 << 4)) >> 14; data->t\_fine = var2 + var3; calc\_temp = (data->t\_fine \* 5 + 128) >> 8; @@ -368,9 +368,9 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var1 = (data->t\_fine >> 1) - 64000; var2 = ((((var1 >> 2) \* (var1 >> 2)) >> 11) \* calib->par\_p6) >> 2; var2 = var2 + (var1 \* calib->par\_p5 << 1);- var2 = (var2 >> 2) + (calib->par\_p4 << 16);+ var2 = (var2 >> 2) + ((s32)calib->par\_p4 << 16); var1 = (((((var1 >> 2) \* (var1 >> 2)) >> 13) \*- (calib->par\_p3 << 5)) >> 3) ++ ((s32)calib->par\_p3 << 5)) >> 3) + ((calib->par\_p2 \* var1) >> 1); var1 = var1 >> 18; var1 = ((32768 + var1) \* calib->par\_p1) >> 15;@@ -388,7 +388,7 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var3 = ((press\_comp >> 8) \* (press\_comp >> 8) \* (press\_comp >> 8) \* calib->par\_p10) >> 17; - press\_comp += (var1 + var2 + var3 + (calib->par\_p7 << 7)) >> 4;+ press\_comp += (var1 + var2 + var3 + ((s32)calib->par\_p7 << 7)) >> 4;  return press\_comp; }@@ -414,7 +414,7 @@ static u32 bme680\_compensate\_humid(struct bme680\_data \*data, (((temp\_scaled \* ((temp\_scaled \* calib->par\_h5) / 100)) >> 6) / 100) + (1 << 14))) >> 10; var3 = var1 \* var2;- var4 = calib->par\_h6 << 7;+ var4 = (s32)calib->par\_h6 << 7; var4 = (var4 + ((temp\_scaled \* calib->par\_h7) / 100)) >> 4; var5 = ((var3 >> 14) \* (var3 >> 14)) >> 10; var6 = (var4 \* var5) >> 1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:02:21 +0000

