=== Content from git.kernel.org_8f6d58d4_20250111_150344.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vasileios Amoiridis <vassilisamir@gmail.com> | 2024-06-06 23:22:55 +0200 |
| --- | --- | --- |
| committer | Jonathan Cameron <Jonathan.Cameron@huawei.com> | 2024-06-09 12:02:13 +0100 |
| commit | [fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)) | |
| tree | [e43bf69485e8b871df5131019a3edff9d5eb4cf1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8) | |
| parent | [b47c0fee73a810c4503c4a94ea34858a1d865bba](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b47c0fee73a810c4503c4a94ea34858a1d865bba) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8&id2=b47c0fee73a810c4503c4a94ea34858a1d865bba)) | |
| download | [linux-fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8.tar.gz) | |

iio: chemical: bme680: Fix overflows in compensate() functionsThere are cases in the compensate functions of the driver that
there could be overflows of variables due to bit shifting ops.
These implications were initially discussed here [1] and they
were mentioned in log message of Commit 1b3bd8592780 ("iio:
chemical: Add support for Bosch BME680 sensor").
[1]: https://lore.kernel.org/linux-iio/20180728114028.3c1bbe81@archlinux/
Fixes: 1b3bd8592780 ("iio: chemical: Add support for Bosch BME680 sensor")
Signed-off-by: Vasileios Amoiridis <vassilisamir@gmail.com>
Link: [https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir@gmail.com](https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir%40gmail.com)
Cc: <Stable@vger.kernel.org>
Signed-off-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)

| -rw-r--r-- | [drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/iio/chemical/bme680_core.c?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/drivers/iio/chemical/bme680\_core.c b/drivers/iio/chemical/bme680\_core.cindex 812829841733bd..5db48f6d646c1d 100644--- a/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=b47c0fee73a810c4503c4a94ea34858a1d865bba)+++ b/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8)@@ -342,10 +342,10 @@ static s16 bme680\_compensate\_temp(struct bme680\_data \*data, if (!calib->par\_t2) bme680\_read\_calib(data, calib); - var1 = (adc\_temp >> 3) - (calib->par\_t1 << 1);+ var1 = (adc\_temp >> 3) - ((s32)calib->par\_t1 << 1); var2 = (var1 \* calib->par\_t2) >> 11; var3 = ((var1 >> 1) \* (var1 >> 1)) >> 12;- var3 = (var3 \* (calib->par\_t3 << 4)) >> 14;+ var3 = (var3 \* ((s32)calib->par\_t3 << 4)) >> 14; data->t\_fine = var2 + var3; calc\_temp = (data->t\_fine \* 5 + 128) >> 8; @@ -368,9 +368,9 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var1 = (data->t\_fine >> 1) - 64000; var2 = ((((var1 >> 2) \* (var1 >> 2)) >> 11) \* calib->par\_p6) >> 2; var2 = var2 + (var1 \* calib->par\_p5 << 1);- var2 = (var2 >> 2) + (calib->par\_p4 << 16);+ var2 = (var2 >> 2) + ((s32)calib->par\_p4 << 16); var1 = (((((var1 >> 2) \* (var1 >> 2)) >> 13) \*- (calib->par\_p3 << 5)) >> 3) ++ ((s32)calib->par\_p3 << 5)) >> 3) + ((calib->par\_p2 \* var1) >> 1); var1 = var1 >> 18; var1 = ((32768 + var1) \* calib->par\_p1) >> 15;@@ -388,7 +388,7 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var3 = ((press\_comp >> 8) \* (press\_comp >> 8) \* (press\_comp >> 8) \* calib->par\_p10) >> 17; - press\_comp += (var1 + var2 + var3 + (calib->par\_p7 << 7)) >> 4;+ press\_comp += (var1 + var2 + var3 + ((s32)calib->par\_p7 << 7)) >> 4;  return press\_comp; }@@ -414,7 +414,7 @@ static u32 bme680\_compensate\_humid(struct bme680\_data \*data, (((temp\_scaled \* ((temp\_scaled \* calib->par\_h5) / 100)) >> 6) / 100) + (1 << 14))) >> 10; var3 = var1 \* var2;- var4 = calib->par\_h6 << 7;+ var4 = (s32)calib->par\_h6 << 7; var4 = (var4 + ((temp\_scaled \* calib->par\_h7) / 100)) >> 4; var5 = ((var3 >> 14) \* (var3 >> 14)) >> 10; var6 = (var4 \* var5) >> 1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:02:21 +0000



=== Content from git.kernel.org_34df802f_20250111_150343.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b5967393d50e3c6e632efda3ea3fdde14c1bfd0e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b5967393d50e3c6e632efda3ea3fdde14c1bfd0e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b5967393d50e3c6e632efda3ea3fdde14c1bfd0e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5967393d50e3c6e632efda3ea3fdde14c1bfd0e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vasileios Amoiridis <vassilisamir@gmail.com> | 2024-06-06 23:22:55 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-05 09:33:57 +0200 |
| commit | [b5967393d50e3c6e632efda3ea3fdde14c1bfd0e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b5967393d50e3c6e632efda3ea3fdde14c1bfd0e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b5967393d50e3c6e632efda3ea3fdde14c1bfd0e)) | |
| tree | [f4293280453c02fee1357793ad06b7a518452cc7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b5967393d50e3c6e632efda3ea3fdde14c1bfd0e) | |
| parent | [93709966cec95809cf05b3ead2dc553ad35df381](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=93709966cec95809cf05b3ead2dc553ad35df381) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5967393d50e3c6e632efda3ea3fdde14c1bfd0e&id2=93709966cec95809cf05b3ead2dc553ad35df381)) | |
| download | [linux-b5967393d50e3c6e632efda3ea3fdde14c1bfd0e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b5967393d50e3c6e632efda3ea3fdde14c1bfd0e.tar.gz) | |

iio: chemical: bme680: Fix overflows in compensate() functionscommit fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8 upstream.
There are cases in the compensate functions of the driver that
there could be overflows of variables due to bit shifting ops.
These implications were initially discussed here [1] and they
were mentioned in log message of Commit 1b3bd8592780 ("iio:
chemical: Add support for Bosch BME680 sensor").
[1]: https://lore.kernel.org/linux-iio/20180728114028.3c1bbe81@archlinux/
Fixes: 1b3bd8592780 ("iio: chemical: Add support for Bosch BME680 sensor")
Signed-off-by: Vasileios Amoiridis <vassilisamir@gmail.com>
Link: [https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir@gmail.com](https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir%40gmail.com)
Cc: <Stable@vger.kernel.org>
Signed-off-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5967393d50e3c6e632efda3ea3fdde14c1bfd0e)

| -rw-r--r-- | [drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/iio/chemical/bme680_core.c?id=b5967393d50e3c6e632efda3ea3fdde14c1bfd0e) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/drivers/iio/chemical/bme680\_core.c b/drivers/iio/chemical/bme680\_core.cindex 812829841733bd..5db48f6d646c1d 100644--- a/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=93709966cec95809cf05b3ead2dc553ad35df381)+++ b/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=b5967393d50e3c6e632efda3ea3fdde14c1bfd0e)@@ -342,10 +342,10 @@ static s16 bme680\_compensate\_temp(struct bme680\_data \*data, if (!calib->par\_t2) bme680\_read\_calib(data, calib); - var1 = (adc\_temp >> 3) - (calib->par\_t1 << 1);+ var1 = (adc\_temp >> 3) - ((s32)calib->par\_t1 << 1); var2 = (var1 \* calib->par\_t2) >> 11; var3 = ((var1 >> 1) \* (var1 >> 1)) >> 12;- var3 = (var3 \* (calib->par\_t3 << 4)) >> 14;+ var3 = (var3 \* ((s32)calib->par\_t3 << 4)) >> 14; data->t\_fine = var2 + var3; calc\_temp = (data->t\_fine \* 5 + 128) >> 8; @@ -368,9 +368,9 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var1 = (data->t\_fine >> 1) - 64000; var2 = ((((var1 >> 2) \* (var1 >> 2)) >> 11) \* calib->par\_p6) >> 2; var2 = var2 + (var1 \* calib->par\_p5 << 1);- var2 = (var2 >> 2) + (calib->par\_p4 << 16);+ var2 = (var2 >> 2) + ((s32)calib->par\_p4 << 16); var1 = (((((var1 >> 2) \* (var1 >> 2)) >> 13) \*- (calib->par\_p3 << 5)) >> 3) ++ ((s32)calib->par\_p3 << 5)) >> 3) + ((calib->par\_p2 \* var1) >> 1); var1 = var1 >> 18; var1 = ((32768 + var1) \* calib->par\_p1) >> 15;@@ -388,7 +388,7 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var3 = ((press\_comp >> 8) \* (press\_comp >> 8) \* (press\_comp >> 8) \* calib->par\_p10) >> 17; - press\_comp += (var1 + var2 + var3 + (calib->par\_p7 << 7)) >> 4;+ press\_comp += (var1 + var2 + var3 + ((s32)calib->par\_p7 << 7)) >> 4;  return press\_comp; }@@ -414,7 +414,7 @@ static u32 bme680\_compensate\_humid(struct bme680\_data \*data, (((temp\_scaled \* ((temp\_scaled \* calib->par\_h5) / 100)) >> 6) / 100) + (1 << 14))) >> 10; var3 = var1 \* var2;- var4 = calib->par\_h6 << 7;+ var4 = (s32)calib->par\_h6 << 7; var4 = (var4 + ((temp\_scaled \* calib->par\_h7) / 100)) >> 4; var5 = ((var3 >> 14) \* (var3 >> 14)) >> 10; var6 = (var4 \* var5) >> 1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:02:20 +0000



=== Content from git.kernel.org_95410ae3_20250111_150343.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vasileios Amoiridis <vassilisamir@gmail.com> | 2024-06-06 23:22:55 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-05 09:31:54 +0200 |
| commit | [ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a)) | |
| tree | [c8fbddc1776a3809fa7a266d6c6b037f3ca5bccd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a) | |
| parent | [94f303ed7b63dd47b43cf0b842b2c980288c4e81](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=94f303ed7b63dd47b43cf0b842b2c980288c4e81) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a&id2=94f303ed7b63dd47b43cf0b842b2c980288c4e81)) | |
| download | [linux-ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a.tar.gz) | |

iio: chemical: bme680: Fix overflows in compensate() functionscommit fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8 upstream.
There are cases in the compensate functions of the driver that
there could be overflows of variables due to bit shifting ops.
These implications were initially discussed here [1] and they
were mentioned in log message of Commit 1b3bd8592780 ("iio:
chemical: Add support for Bosch BME680 sensor").
[1]: https://lore.kernel.org/linux-iio/20180728114028.3c1bbe81@archlinux/
Fixes: 1b3bd8592780 ("iio: chemical: Add support for Bosch BME680 sensor")
Signed-off-by: Vasileios Amoiridis <vassilisamir@gmail.com>
Link: [https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir@gmail.com](https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir%40gmail.com)
Cc: <Stable@vger.kernel.org>
Signed-off-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a)

| -rw-r--r-- | [drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/iio/chemical/bme680_core.c?id=ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/drivers/iio/chemical/bme680\_core.c b/drivers/iio/chemical/bme680\_core.cindex 812829841733bd..5db48f6d646c1d 100644--- a/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=94f303ed7b63dd47b43cf0b842b2c980288c4e81)+++ b/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=ba1bb3e2a38a7fef1c1818dd4f2d9abbfdde553a)@@ -342,10 +342,10 @@ static s16 bme680\_compensate\_temp(struct bme680\_data \*data, if (!calib->par\_t2) bme680\_read\_calib(data, calib); - var1 = (adc\_temp >> 3) - (calib->par\_t1 << 1);+ var1 = (adc\_temp >> 3) - ((s32)calib->par\_t1 << 1); var2 = (var1 \* calib->par\_t2) >> 11; var3 = ((var1 >> 1) \* (var1 >> 1)) >> 12;- var3 = (var3 \* (calib->par\_t3 << 4)) >> 14;+ var3 = (var3 \* ((s32)calib->par\_t3 << 4)) >> 14; data->t\_fine = var2 + var3; calc\_temp = (data->t\_fine \* 5 + 128) >> 8; @@ -368,9 +368,9 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var1 = (data->t\_fine >> 1) - 64000; var2 = ((((var1 >> 2) \* (var1 >> 2)) >> 11) \* calib->par\_p6) >> 2; var2 = var2 + (var1 \* calib->par\_p5 << 1);- var2 = (var2 >> 2) + (calib->par\_p4 << 16);+ var2 = (var2 >> 2) + ((s32)calib->par\_p4 << 16); var1 = (((((var1 >> 2) \* (var1 >> 2)) >> 13) \*- (calib->par\_p3 << 5)) >> 3) ++ ((s32)calib->par\_p3 << 5)) >> 3) + ((calib->par\_p2 \* var1) >> 1); var1 = var1 >> 18; var1 = ((32768 + var1) \* calib->par\_p1) >> 15;@@ -388,7 +388,7 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var3 = ((press\_comp >> 8) \* (press\_comp >> 8) \* (press\_comp >> 8) \* calib->par\_p10) >> 17; - press\_comp += (var1 + var2 + var3 + (calib->par\_p7 << 7)) >> 4;+ press\_comp += (var1 + var2 + var3 + ((s32)calib->par\_p7 << 7)) >> 4;  return press\_comp; }@@ -414,7 +414,7 @@ static u32 bme680\_compensate\_humid(struct bme680\_data \*data, (((temp\_scaled \* ((temp\_scaled \* calib->par\_h5) / 100)) >> 6) / 100) + (1 << 14))) >> 10; var3 = var1 \* var2;- var4 = calib->par\_h6 << 7;+ var4 = (s32)calib->par\_h6 << 7; var4 = (var4 + ((temp\_scaled \* calib->par\_h7) / 100)) >> 4; var5 = ((var3 >> 14) \* (var3 >> 14)) >> 10; var6 = (var4 \* var5) >> 1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:02:21 +0000



=== Content from git.kernel.org_1f04cb53_20250111_150341.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6fa31bbe2ea8665ee970258eb8320cbf231dbe9e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6fa31bbe2ea8665ee970258eb8320cbf231dbe9e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6fa31bbe2ea8665ee970258eb8320cbf231dbe9e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6fa31bbe2ea8665ee970258eb8320cbf231dbe9e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vasileios Amoiridis <vassilisamir@gmail.com> | 2024-06-06 23:22:55 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-05 09:00:33 +0200 |
| commit | [6fa31bbe2ea8665ee970258eb8320cbf231dbe9e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6fa31bbe2ea8665ee970258eb8320cbf231dbe9e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6fa31bbe2ea8665ee970258eb8320cbf231dbe9e)) | |
| tree | [dc723c566357116bd1f6f0cf6db5d43f48f6ea04](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6fa31bbe2ea8665ee970258eb8320cbf231dbe9e) | |
| parent | [d17f26afde5039c30297e9c6ffc273689e595154](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d17f26afde5039c30297e9c6ffc273689e595154) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6fa31bbe2ea8665ee970258eb8320cbf231dbe9e&id2=d17f26afde5039c30297e9c6ffc273689e595154)) | |
| download | [linux-6fa31bbe2ea8665ee970258eb8320cbf231dbe9e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6fa31bbe2ea8665ee970258eb8320cbf231dbe9e.tar.gz) | |

iio: chemical: bme680: Fix overflows in compensate() functionscommit fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8 upstream.
There are cases in the compensate functions of the driver that
there could be overflows of variables due to bit shifting ops.
These implications were initially discussed here [1] and they
were mentioned in log message of Commit 1b3bd8592780 ("iio:
chemical: Add support for Bosch BME680 sensor").
[1]: https://lore.kernel.org/linux-iio/20180728114028.3c1bbe81@archlinux/
Fixes: 1b3bd8592780 ("iio: chemical: Add support for Bosch BME680 sensor")
Signed-off-by: Vasileios Amoiridis <vassilisamir@gmail.com>
Link: [https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir@gmail.com](https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir%40gmail.com)
Cc: <Stable@vger.kernel.org>
Signed-off-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6fa31bbe2ea8665ee970258eb8320cbf231dbe9e)

| -rw-r--r-- | [drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/iio/chemical/bme680_core.c?id=6fa31bbe2ea8665ee970258eb8320cbf231dbe9e) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/drivers/iio/chemical/bme680\_core.c b/drivers/iio/chemical/bme680\_core.cindex 08fb2f8a04d5fd..4b0487e5d2fc80 100644--- a/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=d17f26afde5039c30297e9c6ffc273689e595154)+++ b/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=6fa31bbe2ea8665ee970258eb8320cbf231dbe9e)@@ -348,10 +348,10 @@ static s16 bme680\_compensate\_temp(struct bme680\_data \*data, if (!calib->par\_t2) bme680\_read\_calib(data, calib); - var1 = (adc\_temp >> 3) - (calib->par\_t1 << 1);+ var1 = (adc\_temp >> 3) - ((s32)calib->par\_t1 << 1); var2 = (var1 \* calib->par\_t2) >> 11; var3 = ((var1 >> 1) \* (var1 >> 1)) >> 12;- var3 = (var3 \* (calib->par\_t3 << 4)) >> 14;+ var3 = (var3 \* ((s32)calib->par\_t3 << 4)) >> 14; data->t\_fine = var2 + var3; calc\_temp = (data->t\_fine \* 5 + 128) >> 8; @@ -374,9 +374,9 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var1 = (data->t\_fine >> 1) - 64000; var2 = ((((var1 >> 2) \* (var1 >> 2)) >> 11) \* calib->par\_p6) >> 2; var2 = var2 + (var1 \* calib->par\_p5 << 1);- var2 = (var2 >> 2) + (calib->par\_p4 << 16);+ var2 = (var2 >> 2) + ((s32)calib->par\_p4 << 16); var1 = (((((var1 >> 2) \* (var1 >> 2)) >> 13) \*- (calib->par\_p3 << 5)) >> 3) ++ ((s32)calib->par\_p3 << 5)) >> 3) + ((calib->par\_p2 \* var1) >> 1); var1 = var1 >> 18; var1 = ((32768 + var1) \* calib->par\_p1) >> 15;@@ -394,7 +394,7 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var3 = ((press\_comp >> 8) \* (press\_comp >> 8) \* (press\_comp >> 8) \* calib->par\_p10) >> 17; - press\_comp += (var1 + var2 + var3 + (calib->par\_p7 << 7)) >> 4;+ press\_comp += (var1 + var2 + var3 + ((s32)calib->par\_p7 << 7)) >> 4;  return press\_comp; }@@ -420,7 +420,7 @@ static u32 bme680\_compensate\_humid(struct bme680\_data \*data, (((temp\_scaled \* ((temp\_scaled \* calib->par\_h5) / 100)) >> 6) / 100) + (1 << 14))) >> 10; var3 = var1 \* var2;- var4 = calib->par\_h6 << 7;+ var4 = (s32)calib->par\_h6 << 7; var4 = (var4 + ((temp\_scaled \* calib->par\_h7) / 100)) >> 4; var5 = ((var3 >> 14) \* (var3 >> 14)) >> 10; var6 = (var4 \* var5) >> 1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:02:19 +0000



=== Content from git.kernel.org_9a84e40b_20250111_150344.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c326551e99f5416986074ce78bef94f6a404b517)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c326551e99f5416986074ce78bef94f6a404b517)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c326551e99f5416986074ce78bef94f6a404b517)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c326551e99f5416986074ce78bef94f6a404b517)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vasileios Amoiridis <vassilisamir@gmail.com> | 2024-06-06 23:22:55 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-05 09:12:52 +0200 |
| commit | [c326551e99f5416986074ce78bef94f6a404b517](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c326551e99f5416986074ce78bef94f6a404b517) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c326551e99f5416986074ce78bef94f6a404b517)) | |
| tree | [bb5640195bbc6ea387391fdfa96974378b4f21eb](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c326551e99f5416986074ce78bef94f6a404b517) | |
| parent | [3d78fc351bee7228a6e625d92d718e86e67a2a3c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3d78fc351bee7228a6e625d92d718e86e67a2a3c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c326551e99f5416986074ce78bef94f6a404b517&id2=3d78fc351bee7228a6e625d92d718e86e67a2a3c)) | |
| download | [linux-c326551e99f5416986074ce78bef94f6a404b517.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c326551e99f5416986074ce78bef94f6a404b517.tar.gz) | |

iio: chemical: bme680: Fix overflows in compensate() functionscommit fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8 upstream.
There are cases in the compensate functions of the driver that
there could be overflows of variables due to bit shifting ops.
These implications were initially discussed here [1] and they
were mentioned in log message of Commit 1b3bd8592780 ("iio:
chemical: Add support for Bosch BME680 sensor").
[1]: https://lore.kernel.org/linux-iio/20180728114028.3c1bbe81@archlinux/
Fixes: 1b3bd8592780 ("iio: chemical: Add support for Bosch BME680 sensor")
Signed-off-by: Vasileios Amoiridis <vassilisamir@gmail.com>
Link: [https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir@gmail.com](https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir%40gmail.com)
Cc: <Stable@vger.kernel.org>
Signed-off-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c326551e99f5416986074ce78bef94f6a404b517)

| -rw-r--r-- | [drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/iio/chemical/bme680_core.c?id=c326551e99f5416986074ce78bef94f6a404b517) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/drivers/iio/chemical/bme680\_core.c b/drivers/iio/chemical/bme680\_core.cindex 08087faf93a256..282f3ea91e4fd5 100644--- a/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=3d78fc351bee7228a6e625d92d718e86e67a2a3c)+++ b/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=c326551e99f5416986074ce78bef94f6a404b517)@@ -342,10 +342,10 @@ static s16 bme680\_compensate\_temp(struct bme680\_data \*data, if (!calib->par\_t2) bme680\_read\_calib(data, calib); - var1 = (adc\_temp >> 3) - (calib->par\_t1 << 1);+ var1 = (adc\_temp >> 3) - ((s32)calib->par\_t1 << 1); var2 = (var1 \* calib->par\_t2) >> 11; var3 = ((var1 >> 1) \* (var1 >> 1)) >> 12;- var3 = (var3 \* (calib->par\_t3 << 4)) >> 14;+ var3 = (var3 \* ((s32)calib->par\_t3 << 4)) >> 14; data->t\_fine = var2 + var3; calc\_temp = (data->t\_fine \* 5 + 128) >> 8; @@ -368,9 +368,9 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var1 = (data->t\_fine >> 1) - 64000; var2 = ((((var1 >> 2) \* (var1 >> 2)) >> 11) \* calib->par\_p6) >> 2; var2 = var2 + (var1 \* calib->par\_p5 << 1);- var2 = (var2 >> 2) + (calib->par\_p4 << 16);+ var2 = (var2 >> 2) + ((s32)calib->par\_p4 << 16); var1 = (((((var1 >> 2) \* (var1 >> 2)) >> 13) \*- (calib->par\_p3 << 5)) >> 3) ++ ((s32)calib->par\_p3 << 5)) >> 3) + ((calib->par\_p2 \* var1) >> 1); var1 = var1 >> 18; var1 = ((32768 + var1) \* calib->par\_p1) >> 15;@@ -388,7 +388,7 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var3 = ((press\_comp >> 8) \* (press\_comp >> 8) \* (press\_comp >> 8) \* calib->par\_p10) >> 17; - press\_comp += (var1 + var2 + var3 + (calib->par\_p7 << 7)) >> 4;+ press\_comp += (var1 + var2 + var3 + ((s32)calib->par\_p7 << 7)) >> 4;  return press\_comp; }@@ -414,7 +414,7 @@ static u32 bme680\_compensate\_humid(struct bme680\_data \*data, (((temp\_scaled \* ((temp\_scaled \* calib->par\_h5) / 100)) >> 6) / 100) + (1 << 14))) >> 10; var3 = var1 \* var2;- var4 = calib->par\_h6 << 7;+ var4 = (s32)calib->par\_h6 << 7; var4 = (var4 + ((temp\_scaled \* calib->par\_h7) / 100)) >> 4; var5 = ((var3 >> 14) \* (var3 >> 14)) >> 10; var6 = (var4 \* var5) >> 1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:02:21 +0000



=== Content from git.kernel.org_cc875d5c_20250111_150342.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b0af334616ed425024bf220adda0f004806b5feb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b0af334616ed425024bf220adda0f004806b5feb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b0af334616ed425024bf220adda0f004806b5feb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b0af334616ed425024bf220adda0f004806b5feb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vasileios Amoiridis <vassilisamir@gmail.com> | 2024-06-06 23:22:55 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-05 09:08:29 +0200 |
| commit | [b0af334616ed425024bf220adda0f004806b5feb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b0af334616ed425024bf220adda0f004806b5feb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b0af334616ed425024bf220adda0f004806b5feb)) | |
| tree | [ccce3268fd3bf61a58417f38db7d4a5afd4d100e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b0af334616ed425024bf220adda0f004806b5feb) | |
| parent | [0e3d3ca4997c1a26886701fbfcbc41242ef899cb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0e3d3ca4997c1a26886701fbfcbc41242ef899cb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b0af334616ed425024bf220adda0f004806b5feb&id2=0e3d3ca4997c1a26886701fbfcbc41242ef899cb)) | |
| download | [linux-b0af334616ed425024bf220adda0f004806b5feb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b0af334616ed425024bf220adda0f004806b5feb.tar.gz) | |

iio: chemical: bme680: Fix overflows in compensate() functionscommit fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8 upstream.
There are cases in the compensate functions of the driver that
there could be overflows of variables due to bit shifting ops.
These implications were initially discussed here [1] and they
were mentioned in log message of Commit 1b3bd8592780 ("iio:
chemical: Add support for Bosch BME680 sensor").
[1]: https://lore.kernel.org/linux-iio/20180728114028.3c1bbe81@archlinux/
Fixes: 1b3bd8592780 ("iio: chemical: Add support for Bosch BME680 sensor")
Signed-off-by: Vasileios Amoiridis <vassilisamir@gmail.com>
Link: [https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir@gmail.com](https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir%40gmail.com)
Cc: <Stable@vger.kernel.org>
Signed-off-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b0af334616ed425024bf220adda0f004806b5feb)

| -rw-r--r-- | [drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/iio/chemical/bme680_core.c?id=b0af334616ed425024bf220adda0f004806b5feb) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/drivers/iio/chemical/bme680\_core.c b/drivers/iio/chemical/bme680\_core.cindex 178d1b72ce4308..2f8c51654ee0d4 100644--- a/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=0e3d3ca4997c1a26886701fbfcbc41242ef899cb)+++ b/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=b0af334616ed425024bf220adda0f004806b5feb)@@ -334,10 +334,10 @@ static s16 bme680\_compensate\_temp(struct bme680\_data \*data, if (!calib->par\_t2) bme680\_read\_calib(data, calib); - var1 = (adc\_temp >> 3) - (calib->par\_t1 << 1);+ var1 = (adc\_temp >> 3) - ((s32)calib->par\_t1 << 1); var2 = (var1 \* calib->par\_t2) >> 11; var3 = ((var1 >> 1) \* (var1 >> 1)) >> 12;- var3 = (var3 \* (calib->par\_t3 << 4)) >> 14;+ var3 = (var3 \* ((s32)calib->par\_t3 << 4)) >> 14; data->t\_fine = var2 + var3; calc\_temp = (data->t\_fine \* 5 + 128) >> 8; @@ -360,9 +360,9 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var1 = (data->t\_fine >> 1) - 64000; var2 = ((((var1 >> 2) \* (var1 >> 2)) >> 11) \* calib->par\_p6) >> 2; var2 = var2 + (var1 \* calib->par\_p5 << 1);- var2 = (var2 >> 2) + (calib->par\_p4 << 16);+ var2 = (var2 >> 2) + ((s32)calib->par\_p4 << 16); var1 = (((((var1 >> 2) \* (var1 >> 2)) >> 13) \*- (calib->par\_p3 << 5)) >> 3) ++ ((s32)calib->par\_p3 << 5)) >> 3) + ((calib->par\_p2 \* var1) >> 1); var1 = var1 >> 18; var1 = ((32768 + var1) \* calib->par\_p1) >> 15;@@ -380,7 +380,7 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var3 = ((press\_comp >> 8) \* (press\_comp >> 8) \* (press\_comp >> 8) \* calib->par\_p10) >> 17; - press\_comp += (var1 + var2 + var3 + (calib->par\_p7 << 7)) >> 4;+ press\_comp += (var1 + var2 + var3 + ((s32)calib->par\_p7 << 7)) >> 4;  return press\_comp; }@@ -406,7 +406,7 @@ static u32 bme680\_compensate\_humid(struct bme680\_data \*data, (((temp\_scaled \* ((temp\_scaled \* calib->par\_h5) / 100)) >> 6) / 100) + (1 << 14))) >> 10; var3 = var1 \* var2;- var4 = calib->par\_h6 << 7;+ var4 = (s32)calib->par\_h6 << 7; var4 = (var4 + ((temp\_scaled \* calib->par\_h7) / 100)) >> 4; var5 = ((var3 >> 14) \* (var3 >> 14)) >> 10; var6 = (var4 \* var5) >> 1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:02:20 +0000



=== Content from git.kernel.org_5f52f5ad_20250111_150342.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vasileios Amoiridis <vassilisamir@gmail.com> | 2024-06-06 23:22:55 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-05 09:14:46 +0200 |
| commit | [7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9)) | |
| tree | [b550e8a74f11661524923a0605aea68c873fdee8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9) | |
| parent | [2edd0078e368090d44979778d24c4da2d32ba34d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2edd0078e368090d44979778d24c4da2d32ba34d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9&id2=2edd0078e368090d44979778d24c4da2d32ba34d)) | |
| download | [linux-7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9.tar.gz) | |

iio: chemical: bme680: Fix overflows in compensate() functionscommit fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8 upstream.
There are cases in the compensate functions of the driver that
there could be overflows of variables due to bit shifting ops.
These implications were initially discussed here [1] and they
were mentioned in log message of Commit 1b3bd8592780 ("iio:
chemical: Add support for Bosch BME680 sensor").
[1]: https://lore.kernel.org/linux-iio/20180728114028.3c1bbe81@archlinux/
Fixes: 1b3bd8592780 ("iio: chemical: Add support for Bosch BME680 sensor")
Signed-off-by: Vasileios Amoiridis <vassilisamir@gmail.com>
Link: [https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir@gmail.com](https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir%40gmail.com)
Cc: <Stable@vger.kernel.org>
Signed-off-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9)

| -rw-r--r-- | [drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/iio/chemical/bme680_core.c?id=7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/drivers/iio/chemical/bme680\_core.c b/drivers/iio/chemical/bme680\_core.cindex c37d32e4d8598c..1108419056091e 100644--- a/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=2edd0078e368090d44979778d24c4da2d32ba34d)+++ b/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=7a13d1357658d3a3c1cd7b3b9543c805a6e5e6e9)@@ -342,10 +342,10 @@ static s16 bme680\_compensate\_temp(struct bme680\_data \*data, if (!calib->par\_t2) bme680\_read\_calib(data, calib); - var1 = (adc\_temp >> 3) - (calib->par\_t1 << 1);+ var1 = (adc\_temp >> 3) - ((s32)calib->par\_t1 << 1); var2 = (var1 \* calib->par\_t2) >> 11; var3 = ((var1 >> 1) \* (var1 >> 1)) >> 12;- var3 = (var3 \* (calib->par\_t3 << 4)) >> 14;+ var3 = (var3 \* ((s32)calib->par\_t3 << 4)) >> 14; data->t\_fine = var2 + var3; calc\_temp = (data->t\_fine \* 5 + 128) >> 8; @@ -368,9 +368,9 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var1 = (data->t\_fine >> 1) - 64000; var2 = ((((var1 >> 2) \* (var1 >> 2)) >> 11) \* calib->par\_p6) >> 2; var2 = var2 + (var1 \* calib->par\_p5 << 1);- var2 = (var2 >> 2) + (calib->par\_p4 << 16);+ var2 = (var2 >> 2) + ((s32)calib->par\_p4 << 16); var1 = (((((var1 >> 2) \* (var1 >> 2)) >> 13) \*- (calib->par\_p3 << 5)) >> 3) ++ ((s32)calib->par\_p3 << 5)) >> 3) + ((calib->par\_p2 \* var1) >> 1); var1 = var1 >> 18; var1 = ((32768 + var1) \* calib->par\_p1) >> 15;@@ -388,7 +388,7 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var3 = ((press\_comp >> 8) \* (press\_comp >> 8) \* (press\_comp >> 8) \* calib->par\_p10) >> 17; - press\_comp += (var1 + var2 + var3 + (calib->par\_p7 << 7)) >> 4;+ press\_comp += (var1 + var2 + var3 + ((s32)calib->par\_p7 << 7)) >> 4;  return press\_comp; }@@ -414,7 +414,7 @@ static u32 bme680\_compensate\_humid(struct bme680\_data \*data, (((temp\_scaled \* ((temp\_scaled \* calib->par\_h5) / 100)) >> 6) / 100) + (1 << 14))) >> 10; var3 = var1 \* var2;- var4 = calib->par\_h6 << 7;+ var4 = (s32)calib->par\_h6 << 7; var4 = (var4 + ((temp\_scaled \* calib->par\_h7) / 100)) >> 4; var5 = ((var3 >> 14) \* (var3 >> 14)) >> 10; var6 = (var4 \* var5) >> 1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:02:19 +0000



=== Content from git.kernel.org_a036e3ba_20250111_150341.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3add41bbda92938e9a528d74659dfc552796be4e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3add41bbda92938e9a528d74659dfc552796be4e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3add41bbda92938e9a528d74659dfc552796be4e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3add41bbda92938e9a528d74659dfc552796be4e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vasileios Amoiridis <vassilisamir@gmail.com> | 2024-06-06 23:22:55 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-05 09:38:08 +0200 |
| commit | [3add41bbda92938e9a528d74659dfc552796be4e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3add41bbda92938e9a528d74659dfc552796be4e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3add41bbda92938e9a528d74659dfc552796be4e)) | |
| tree | [62e3a0b83af7f3165ff0ac21f573378af988e3fd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3add41bbda92938e9a528d74659dfc552796be4e) | |
| parent | [ec3fc446ec23c8a4552d9f3a978392ee217a7fd8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ec3fc446ec23c8a4552d9f3a978392ee217a7fd8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3add41bbda92938e9a528d74659dfc552796be4e&id2=ec3fc446ec23c8a4552d9f3a978392ee217a7fd8)) | |
| download | [linux-3add41bbda92938e9a528d74659dfc552796be4e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3add41bbda92938e9a528d74659dfc552796be4e.tar.gz) | |

iio: chemical: bme680: Fix overflows in compensate() functionscommit fdd478c3ae98c3f13628e110dce9b6cfb0d9b3c8 upstream.
There are cases in the compensate functions of the driver that
there could be overflows of variables due to bit shifting ops.
These implications were initially discussed here [1] and they
were mentioned in log message of Commit 1b3bd8592780 ("iio:
chemical: Add support for Bosch BME680 sensor").
[1]: https://lore.kernel.org/linux-iio/20180728114028.3c1bbe81@archlinux/
Fixes: 1b3bd8592780 ("iio: chemical: Add support for Bosch BME680 sensor")
Signed-off-by: Vasileios Amoiridis <vassilisamir@gmail.com>
Link: [https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir@gmail.com](https://lore.kernel.org/r/20240606212313.207550-4-vassilisamir%40gmail.com)
Cc: <Stable@vger.kernel.org>
Signed-off-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3add41bbda92938e9a528d74659dfc552796be4e)

| -rw-r--r-- | [drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/iio/chemical/bme680_core.c?id=3add41bbda92938e9a528d74659dfc552796be4e) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/drivers/iio/chemical/bme680\_core.c b/drivers/iio/chemical/bme680\_core.cindex 812829841733bd..5db48f6d646c1d 100644--- a/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=ec3fc446ec23c8a4552d9f3a978392ee217a7fd8)+++ b/[drivers/iio/chemical/bme680\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/chemical/bme680_core.c?id=3add41bbda92938e9a528d74659dfc552796be4e)@@ -342,10 +342,10 @@ static s16 bme680\_compensate\_temp(struct bme680\_data \*data, if (!calib->par\_t2) bme680\_read\_calib(data, calib); - var1 = (adc\_temp >> 3) - (calib->par\_t1 << 1);+ var1 = (adc\_temp >> 3) - ((s32)calib->par\_t1 << 1); var2 = (var1 \* calib->par\_t2) >> 11; var3 = ((var1 >> 1) \* (var1 >> 1)) >> 12;- var3 = (var3 \* (calib->par\_t3 << 4)) >> 14;+ var3 = (var3 \* ((s32)calib->par\_t3 << 4)) >> 14; data->t\_fine = var2 + var3; calc\_temp = (data->t\_fine \* 5 + 128) >> 8; @@ -368,9 +368,9 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var1 = (data->t\_fine >> 1) - 64000; var2 = ((((var1 >> 2) \* (var1 >> 2)) >> 11) \* calib->par\_p6) >> 2; var2 = var2 + (var1 \* calib->par\_p5 << 1);- var2 = (var2 >> 2) + (calib->par\_p4 << 16);+ var2 = (var2 >> 2) + ((s32)calib->par\_p4 << 16); var1 = (((((var1 >> 2) \* (var1 >> 2)) >> 13) \*- (calib->par\_p3 << 5)) >> 3) ++ ((s32)calib->par\_p3 << 5)) >> 3) + ((calib->par\_p2 \* var1) >> 1); var1 = var1 >> 18; var1 = ((32768 + var1) \* calib->par\_p1) >> 15;@@ -388,7 +388,7 @@ static u32 bme680\_compensate\_press(struct bme680\_data \*data, var3 = ((press\_comp >> 8) \* (press\_comp >> 8) \* (press\_comp >> 8) \* calib->par\_p10) >> 17; - press\_comp += (var1 + var2 + var3 + (calib->par\_p7 << 7)) >> 4;+ press\_comp += (var1 + var2 + var3 + ((s32)calib->par\_p7 << 7)) >> 4;  return press\_comp; }@@ -414,7 +414,7 @@ static u32 bme680\_compensate\_humid(struct bme680\_data \*data, (((temp\_scaled \* ((temp\_scaled \* calib->par\_h5) / 100)) >> 6) / 100) + (1 << 14))) >> 10; var3 = var1 \* var2;- var4 = calib->par\_h6 << 7;+ var4 = (s32)calib->par\_h6 << 7; var4 = (var4 + ((temp\_scaled \* calib->par\_h7) / 100)) >> 4; var5 = ((var3 >> 14) \* (var3 >> 14)) >> 10; var6 = (var4 \* var5) >> 1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:02:18 +0000


