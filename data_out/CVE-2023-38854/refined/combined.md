=== Content from github.com_6efde5e3_20250111_004241.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibxls%2Flibxls%2Fissues%2F124)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibxls%2Flibxls%2Fissues%2F124)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=libxls%2Flibxls)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libxls](/libxls)
/
**[libxls](/libxls/libxls)**
Public

* [Notifications](/login?return_to=%2Flibxls%2Flibxls) You must be signed in to change notification settings
* [Fork
  129](/login?return_to=%2Flibxls%2Flibxls)
* [Star
   448](/login?return_to=%2Flibxls%2Flibxls)

* [Code](/libxls/libxls)
* [Issues
  7](/libxls/libxls/issues)
* [Pull requests
  4](/libxls/libxls/pulls)
* [Actions](/libxls/libxls/actions)
* [Security](/libxls/libxls/security)
* [Insights](/libxls/libxls/pulse)

Additional navigation options

* [Code](/libxls/libxls)
* [Issues](/libxls/libxls/issues)
* [Pull requests](/libxls/libxls/pulls)
* [Actions](/libxls/libxls/actions)
* [Security](/libxls/libxls/security)
* [Insights](/libxls/libxls/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Flibxls%2Flibxls%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Flibxls%2Flibxls%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# There are multiple heap-buffer-overflow vulnerability found in libxls #124

Closed

[mondaylord](/mondaylord) opened this issue
Jul 13, 2023
· 0 comments
 · Fixed by [#129](https://github.com/libxls/libxls/pull/129)

Closed

# [There are multiple heap-buffer-overflow vulnerability found in libxls](#top) #124

[mondaylord](/mondaylord) opened this issue
Jul 13, 2023
· 0 comments
 · Fixed by [#129](https://github.com/libxls/libxls/pull/129)

## Comments

[![@mondaylord](https://avatars.githubusercontent.com/u/22017455?s=80&u=81269c040bb362cedf9e4afda613ceda2f9fc801&v=4)](/mondaylord)

Copy link

### **[mondaylord](/mondaylord)** commented [Jul 13, 2023](#issue-1802290400) • edited Loading

| Hi, developers of libxls: In the test of the binary `test2_libxls` instrumented with ASAN. There are 6 heap-buffer-overflow and 1 SEGV vulnerabilities in `src/xls.c:1015`, `src/xls.c:1018`, `src/xlstool.c:266`, `src/xlstool.c:411`, `src/xlstool.c:395`, and `src/xlstool.c:296`. Here is the ASAN mode output (I omit some unnecessary messages): Vulnerability 1, src/xls.c:1015 ================================================================= ==54038==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x602000001070 at pc 0x0000004cf305 bp 0x7fff55151350 sp 0x7fff55151348 READ of size 2 at 0x602000001070 thread T0 #0 0x4cf304 in xls\_parseWorkBook /libxls/src/xls.c:1015:37 [#1](https://github.com/libxls/libxls/issues/1) 0x4d7ee5 in xls\_open\_ole /libxls/src/xls.c:1480:14 [#2](https://github.com/libxls/libxls/issues/2) 0x4c5b4d in main /libxls/test/test2.c:60:9 [#3](https://github.com/libxls/libxls/issues/3) 0x7f7fd826bc86 in \_\_libc\_start\_main /build/glibc-CVJwZb/glibc-2.27/csu/../csu/libc-start.c:310 [#4](https://github.com/libxls/libxls/issues/4) 0x41c109 in \_start (/libxls/test2\_libxls+0x41c109)  0x602000001071 is located 0 bytes to the right of 1-byte region [0x602000001070,0x602000001071) allocated by thread T0 here: #0 0x4960f9 in realloc (/libxls/test2\_libxls+0x4960f9) [#1](https://github.com/libxls/libxls/issues/1) 0x4cb76a in xls\_parseWorkBook /libxls/src/xls.c:860:24 [#2](https://github.com/libxls/libxls/issues/2) 0x4d7ee5 in xls\_open\_ole /libxls/src/xls.c:1480:14  SUMMARY: AddressSanitizer: heap-buffer-overflow /libxls/src/xls.c:1015:37 in xls\_parseWorkBook Shadow bytes around the buggy address: 0x0c047fff81b0: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fa 0x0c047fff81c0: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fd 0x0c047fff81d0: fa fa fd fa fa fa fd fd fa fa fd fd fa fa fd fd 0x0c047fff81e0: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd 0x0c047fff81f0: fa fa fd fd fa fa fd fd fa fa fd fa fa fa fd fd =>0x0c047fff8200: fa fa fd fd fa fa fd fd fa fa fd fa fa fa[01]fa 0x0c047fff8210: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c047fff8220: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c047fff8230: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c047fff8240: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c047fff8250: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb Shadow gap: cc ==54038==ABORTING Vulnerability 2, src/xls.c:1018 ================================================================= ==24506==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x602000000533 at pc 0x0000004ceb06 bp 0x7fffbc197e90 sp 0x7fffbc197e88 READ of size 1 at 0x602000000533 thread T0 #0 0x4ceb05 in xls\_parseWorkBook /libxls/src/xls.c:1018:38 [#1](https://github.com/libxls/libxls/issues/1) 0x4d7ee5 in xls\_open\_ole /libxls/src/xls.c:1480:14 [#2](https://github.com/libxls/libxls/issues/2) 0x4c5b4d in main /libxls/test/test2.c:60:9 [#3](https://github.com/libxls/libxls/issues/3) 0x7ffb26d5bc86 in \_\_libc\_start\_main /build/glibc-CVJwZb/glibc-2.27/csu/../csu/libc-start.c:310 [#4](https://github.com/libxls/libxls/issues/4) 0x41c109 in \_start (/libxls/test2\_libxls+0x41c109)  0x602000000533 is located 0 bytes to the right of 3-byte region [0x602000000530,0x602000000533) allocated by thread T0 here: #0 0x4960f9 in realloc (/libxls/test2\_libxls+0x4960f9) [#1](https://github.com/libxls/libxls/issues/1) 0x4cb76a in xls\_parseWorkBook /libxls/src/xls.c:860:24 [#2](https://github.com/libxls/libxls/issues/2) 0x4d7ee5 in xls\_open\_ole /libxls/src/xls.c:1480:14  SUMMARY: AddressSanitizer: heap-buffer-overflow /libxls/src/xls.c:1018:38 in xls\_parseWorkBook Vulnerability 3, src/xlstool.c:266 ================================================================= ==22361==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x603000000954 at pc 0x0000004c6ec4 bp 0x7ffd36438770 sp 0x7ffd36438768 READ of size 1 at 0x603000000954 thread T0 #0 0x4c6ec3 in unicode\_decode\_wcstombs /libxls/src/xlstool.c:266:38 [#1](https://github.com/libxls/libxls/issues/1) 0x4cc9a1 in xls\_parseWorkBook /libxls/src/xls.c:1020:16 [#2](https://github.com/libxls/libxls/issues/2) 0x4d7ee5 in xls\_open\_ole /libxls/src/xls.c:1480:14 [#3](https://github.com/libxls/libxls/issues/3) 0x4c5b4d in main /libxls/test/test2.c:60:9 [#4](https://github.com/libxls/libxls/issues/4) 0x7f0ca9da0c86 in \_\_libc\_start\_main /build/glibc-CVJwZb/glibc-2.27/csu/../csu/libc-start.c:310 [#5](https://github.com/libxls/libxls/issues/5) 0x41c109 in \_start (/libxls/test2\_libxls+0x41c109)  0x603000000954 is located 0 bytes to the right of 20-byte region [0x603000000940,0x603000000954) allocated by thread T0 here: #0 0x4960f9 in realloc (/libxls/test2\_libxls+0x4960f9) [#1](https://github.com/libxls/libxls/issues/1) 0x4cb76a in xls\_parseWorkBook /libxls/src/xls.c:860:24 [#2](https://github.com/libxls/libxls/issues/2) 0x4d7ee5 in xls\_open\_ole /libxls/src/xls.c:1480:14  SUMMARY: AddressSanitizer: heap-buffer-overflow /libxls/src/xlstool.c:266:38 in unicode\_decode\_wcstombs Vulnerability 4, src/xlstool.c:411 ================================================================= ==27366==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x602000000514 at pc 0x0000004c7363 bp 0x7ffc82ab3a00 sp 0x7ffc82ab39f8 READ of size 1 at 0x602000000514 thread T0 #0 0x4c7362 in get\_string /libxls/src/xlstool.c:411:8 [#1](https://github.com/libxls/libxls/issues/1) 0x4cc9a1 in xls\_parseWorkBook /libxls/src/xls.c:1020:16 [#2](https://github.com/libxls/libxls/issues/2) 0x4d7ee5 in xls\_open\_ole /libxls/src/xls.c:1480:14 [#3](https://github.com/libxls/libxls/issues/3) 0x4c5b4d in main /libxls/test/test2.c:60:9 [#4](https://github.com/libxls/libxls/issues/4) 0x7fd80a51ac86 in \_\_libc\_start\_main /build/glibc-CVJwZb/glibc-2.27/csu/../csu/libc-start.c:310 [#5](https://github.com/libxls/libxls/issues/5) 0x41c109 in \_start (/libxls/test2\_libxls+0x41c109)  0x602000000514 is located 0 bytes to the right of 4-byte region [0x602000000510,0x602000000514) allocated by thread T0 here: #0 0x4960f9 in realloc (/libxls/test2\_libxls+0x4960f9) [#1](https://github.com/libxls/libxls/issues/1) 0x4cb76a in xls\_parseWorkBook /libxls/src/xls.c:860:24 [#2](https://github.com/libxls/libxls/issues/2) 0x4d7ee5 in xls\_open\_ole /libxls/src/xls.c:1480:14  SUMMARY: AddressSanitizer: heap-buffer-overflow /libxls/src/xlstool.c:411:8 in get\_string Vulnerability 5, src/xlstool.c:296 ================================================================= ==19616==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x616000000888 at pc 0x0000004c6a11 bp 0x7fff62de6cc0 sp 0x7fff62de6cb8 READ of size 4 at 0x616000000888 thread T0 #0 0x4c6a10 in transcode\_latin1\_to\_utf8 /libxls/src/xlstool.c:296:12 [#1](https://github.com/libxls/libxls/issues/1) 0x4c6a10 in codepage\_decode /src/xlstool.c:321:16 [#2](https://github.com/libxls/libxls/issues/2) 0x4cc9a1 in xls\_parseWorkBook /libxls/src/xls.c:1020:16 [#3](https://github.com/libxls/libxls/issues/3) 0x4d7ee5 in xls\_open\_ole /libxls/src/xls.c:1480:14 [#4](https://github.com/libxls/libxls/issues/4) 0x4c5b4d in main /libxls/test/test2.c:60:9 [#5](https://github.com/libxls/libxls/issues/5) 0x7f8d9df3ac86 in \_\_libc\_start\_main /build/glibc-CVJwZb/glibc-2.27/csu/../csu/libc-start.c:310 [#6](https://github.com/libxls/libxls/issues/6) 0x41c109 in \_start (/libxls/test2\_libxls+0x41c109)  0x616000000888 is located 0 bytes to the right of 520-byte region [0x616000000680,0x616000000888) allocated by thread T0 here: #0 0x4960f9 in realloc (/libxls/test2\_libxls+0x4960f9) [#1](https://github.com/libxls/libxls/issues/1) 0x4cb76a in xls\_parseWorkBook /libxls/src/xls.c:860:24 [#2](https://github.com/libxls/libxls/issues/2) 0x4d7ee5 in xls\_open\_ole /libxls/src/xls.c:1480:14  SUMMARY: AddressSanitizer: heap-buffer-overflow /libxls/src/xlstool.c:296:12 in transcode\_latin1\_to\_utf8 Vulnerability 6, src/xlstool.c:395 ================================================================= ==43284==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6020000005d2 at pc 0x0000004c7329 bp 0x7fffc6505260 sp 0x7fffc6505258 READ of size 1 at 0x6020000005d2 thread T0 #0 0x4c7328 in get\_string /libxls/src/xlstool.c:395:13 [#1](https://github.com/libxls/libxls/issues/1) 0x4cc9a1 in xls\_parseWorkBook /libxls/src/xls.c:1020:16 [#2](https://github.com/libxls/libxls/issues/2) 0x4d7ee5 in xls\_open\_ole /libxls/src/xls.c:1480:14 [#3](https://github.com/libxls/libxls/issues/3) 0x4c5b4d in main /libxls/test/test2.c:60:9 [#4](https://github.com/libxls/libxls/issues/4) 0x7fa1da3bcc86 in \_\_libc\_start\_main /build/glibc-CVJwZb/glibc-2.27/csu/../csu/libc-start.c:310 [#5](https://github.com/libxls/libxls/issues/5) 0x41c109 in \_start (/libxls/test2\_libxls+0x41c109)  0x6020000005d2 is located 0 bytes to the right of 2-byte region [0x6020000005d0,0x6020000005d2) allocated by thread T0 here: #0 0x4960f9 in realloc (/libxls/test2\_libxls+0x4960f9) [#1](https://github.com/libxls/libxls/issues/1) 0x4cb76a in xls\_parseWorkBook /libxls/src/xls.c:860:24 [#2](https://github.com/libxls/libxls/issues/2) 0x4d7ee5 in xls\_open\_ole /libxls/src/xls.c:1480:14  SUMMARY: AddressSanitizer: heap-buffer-overflow /libxls/src/xlstool.c:395:13 in get\_string Vulnerability 7 ================================================================= ==38465==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000000 (pc 0x0000004cc923 bp 0x7ffee6e50330 sp 0x7ffee6e501a0 T0) ==38465==The signal is caused by a READ memory access. ==38465==Hint: address points to the zero page. #0 0x4cc923 in xls\_parseWorkBook /libxls/src/xls.c:1015:41 [#1](https://github.com/libxls/libxls/issues/1) 0x4d7ee5 in xls\_open\_ole /libxls/src/xls.c:1480:14 [#2](https://github.com/libxls/libxls/issues/2) 0x4c5b4d in main /libxls/test/test2.c:60:9 [#3](https://github.com/libxls/libxls/issues/3) 0x7f032a36dc86 in \_\_libc\_start\_main /build/glibc-CVJwZb/glibc-2.27/csu/../csu/libc-start.c:310 [#4](https://github.com/libxls/libxls/issues/4) 0x41c109 in \_start (/libxls/test2\_libxls+0x41c109)  AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV /libxls/src/xls.c:1015:41 in xls\_parseWorkBook ==38465==ABORTING Crash input <https://github.com/17ssDP/fuzzer_crashes/tree/main/libxls> Code Location `xls.c:1010-1025`  ``` case XLS_RECORD_STYLE: 			if(xls_debug) { 				struct { unsigned short idx; unsigned char ident; unsigned char lvl; } *styl; 				styl = (void *)buf;  				printf("    idx: 0x%x\n", styl->idx & 0x07FF); <---------- 				if(styl->idx & 0x8000) { 					printf("  ident: 0x%x\n", styl->ident); 					printf("  level: 0x%x\n", styl->lvl); <--------- 				} else { 					char *s = get_string((char *)&buf[2], bof1.size - 2, 1, pWB); 					printf("  name=%s\n", s);                     free(s); 				} 			} 			break;  ```  `xlstool.c:264-267`  ``` for(i=0; i<len/2; i++)     {         w[i] = (BYTE)s[2*i] + ((BYTE)s[2*i+1] << 8); <----------     }   ```  `xlstool.c:406-413`  ``` if(!pWB->is5ver) { 		// unicode strings have a format byte before the string         if (ofs + 1 > len) {             return NULL;         } 		flag=*(BYTE*)(str+ofs); <----------- 		ofs++; 	}  ```  `xlstool.c:392-296`  ``` if (ofs + 2 > len) {             return NULL;         }         ln= ((BYTE*)str)[0] + (((BYTE*)str)[1] << 8); <------------         ofs+=2;   ```  `xlstool.c:295-299`  ``` for(i=0; i<len; ++i) {         if(str[i] & (BYTE)0x80) { <-------------             ++utf8_chars;         }     }   ``` Environment Ubuntu 16.04 Clang 10.0.1 gcc 5.5 |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@mondaylord](https://avatars.githubusercontent.com/u/22017455?s=40&u=81269c040bb362cedf9e4afda613ceda2f9fc801&v=4)](/mondaylord)
[mondaylord](/mondaylord)
changed the title
~~Three heap-buffer-overflow vulnerability found in libxls~~
There are multiple heap-buffer-overflow vulnerability found in libxls
[Jul 14, 2023](#event-9818318759)

[![@michaelquinn32](https://avatars.githubusercontent.com/u/3473921?s=40&v=4)](/michaelquinn32)
[michaelquinn32](/michaelquinn32)
mentioned this issue
[Nov 27, 2023](#ref-issue-2012928802)

[Multible unaddressed libxls vulnerabilities
tidyverse/readxl#739](/tidyverse/readxl/issues/739)

Open

[gaborcsardi](/gaborcsardi)
added a commit
to gaborcsardi/libxls
that referenced
this issue
[Feb 3, 2024](#ref-commit-8b025da)
[![@gaborcsardi](https://avatars.githubusercontent.com/u/660288?s=40&u=677db9b09ed7b9ca76a2fc24622a9ca433ce05d5&v=4)](/gaborcsardi)

`[Fix buffer overflows when parsing style records](/gaborcsardi/libxls/commit/8b025da4c5073b3038257e1c5d2dd3c704bb1e00 "Fix buffer overflows when parsing style records

Closes #124, #126.")`
…

`[8b025da](/gaborcsardi/libxls/commit/8b025da4c5073b3038257e1c5d2dd3c704bb1e00)`

```
Closes [libxls#124](https://github.com/libxls/libxls/issues/124), [libxls#126](https://github.com/libxls/libxls/issues/126).
```

[gaborcsardi](/gaborcsardi)
added a commit
to gaborcsardi/libxls
that referenced
this issue
[Feb 4, 2024](#ref-commit-c009fa8)
[![@gaborcsardi](https://avatars.githubusercontent.com/u/660288?s=40&u=677db9b09ed7b9ca76a2fc24622a9ca433ce05d5&v=4)](/gaborcsardi)

`[Fix buffer overflows when parsing style records](/gaborcsardi/libxls/commit/c009fa87fc775f8cc63e85d2018223143cb200e6 "Fix buffer overflows when parsing style records

Closes #124, #126.

According to https://download.microsoft.com/download/5/0/1/501ED102-E53F-4CE0-AA6B-B0F93629DDC6/Office/Excel97-2007BinaryFileFormat(xls)Specification.pdf
a \"STYLE: Style Information (293h)\" record might be 4 or 3+ bytes
long, depending on the first word.

We need to check that we've read enough bytes for the whole
record, so
- first we check that we have a word at least,
- then we check the subtype of the record.
- If it is a built-in style, then it has 4 bytes, so we check that.
- Otherwise the length of the name is in byte 3, so the whole record
  is 3 + buf[3] bytes long. So we need at least three bytes before we
  check the length in byte 3. Then we check if we have 3 + buf[3]
  bytes.")`
…

`[c009fa8](/gaborcsardi/libxls/commit/c009fa87fc775f8cc63e85d2018223143cb200e6)`

```
Closes [libxls#124](https://github.com/libxls/libxls/issues/124), [libxls#126](https://github.com/libxls/libxls/issues/126).

According to [https://download.microsoft.com/download/5/0/1/501ED102-E53F-4CE0-AA6B-B0F93629DDC6/Office/Excel97-2007BinaryFileFormat(xls)Specification.pdf](https://download.microsoft.com/download/5/0/1/501ED102-E53F-4CE0-AA6B-B0F93629DDC6/Office/Excel97-2007BinaryFileFormat%28xls%29Specification.pdf)
a "STYLE: Style Information (293h)" record might be 4 or 3+ bytes
long, depending on the first word.

We need to check that we've read enough bytes for the whole
record, so
- first we check that we have a word at least,
- then we check the subtype of the record.
- If it is a built-in style, then it has 4 bytes, so we check that.
- Otherwise the length of the name is in byte 3, so the whole record
  is 3 + buf[3] bytes long. So we need at least three bytes before we
  check the length in byte 3. Then we check if we have 3 + buf[3]
  bytes.
```

[![@gaborcsardi](https://avatars.githubusercontent.com/u/660288?s=40&u=677db9b09ed7b9ca76a2fc24622a9ca433ce05d5&v=4)](/gaborcsardi)
[gaborcsardi](/gaborcsardi)
mentioned this issue
[Feb 4, 2024](#ref-pullrequest-2116906108)

[Fix buffer overflows when parsing style records
#129](/libxls/libxls/pull/129)
 Merged

[![@evanmiller](https://avatars.githubusercontent.com/u/134711?s=40&u=ced7c04c05d96008fc74408187bb9e7d17e3b998&v=4)](/evanmiller)
[evanmiller](/evanmiller)
closed this as [completed](/libxls/libxls/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#129](/libxls/libxls/pull/129)
[Feb 4, 2024](#event-11695747332)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Flibxls%2Flibxls%2Fissues%2F124)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [Fix buffer overflows when parsing style records](/libxls/libxls/pull/129)
 [gaborcsardi/libxls](/gaborcsardi/libxls)

1 participant

[![@mondaylord](https://avatars.githubusercontent.com/u/22017455?s=52&v=4)](/mondaylord)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


