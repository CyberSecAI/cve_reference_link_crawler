=== Content from gitlab.com_fa6c560f_20250111_064932.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# User Application OAuth flow allows for "cross window forgery" due to ID on accept button, leading to full API access as victim

âš  **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #2383443](https://hackerone.com/reports/2383443)** by `joaxcar` on 2024-02-21, assigned to [@truegreg](/truegreg "Greg Alfaro"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

First of all, I did check, and `clickjacking` is not out of scope if the issue is on a sensitive page.

Secondly, I understand if the attack here could be considered in a gray area when it comes to user interaction, but as I build the POC I thought I might just report it and the team can decide what to do with it :)

I read this blog post about "cross window forgery" [link](https://www.paulosyibelo.com/2024/02/cross-window-forgery-web-attack-vector.html). The researcher describes two attack scenarios that would both work on GitLab.com. I decided to check if I could make a POC of the attack against gitlab.com for `user application` permissions.

The idea is that a sensitive page such as the permission prompt for user applications

[![Screenshot_2024-02-21_at_11.50.32.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/a8cc469191c98b109695f38a862a5b776e4c37ae/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f32306438326337632d393466352d346164382d393861662d6663663062633639303931322f53637265656e73686f745f323032342d30322d32315f61745f31312e35302e33322e706e67)

If a user clicks the "Authorize" button, the "Attacker application" will get hold of an access token with full access as the victim in the GitLab API. This page does not require any additional actions more than a click of that button. The problematic part that makes the attack possible is that the button has a HTML `id` attribute

[![Screenshot_2024-02-21_at_11.53.55.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/50dbc654767eef89de4f2c533903fddd608ae930/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f34636437373831652d316361352d343632302d393932652d3166643439383936613335302f53637265656e73686f745f323032342d30322d32315f61745f31312e35332e35352e706e67)

This allows for the usage of a `fragment identifier` to target the button on page load. An URL like this `https://gitlab.com/oauth/authorize?client=...#commit-changes` will have the button selected on load.

An attacker can then use this (see blog for details) to highjack a `enter` press from another site to accept this auto-selected button. The attacker creates a site that somehow tricks the victim into holding down `enter` for 1-3 seconds. The attacker page opens a small popup targeting the auth page and the button will get pressed. The attacker page then closes the popup, and the victim will not know that they have accepted the application and given away full API access to their account.

There are multiple ways to get victims to press down the enter key. Two options are to either create a small game (say flappy bird) or create a fake "captcha" page that the user interacts with. A downside of "prove you are a human" captchas are that they have made users of sites less restrictive on what types of actions they make. Drag and drop to solve puzzles or clicking buttons have become "standard".

Here is a video of how the attack looks. Note that the victim had no applications accepted when the video started. After visiting the attacker page, the attacker has full access. You can see some flickering but won't know what happened.

[Screen\_Recording\_2024-02-21\_at\_11.39.29.mov](https://user-content.gitlab-static.net/c6ccf8b0fbc4befe9c252750ca911c0e5189a6e8/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f66346663313264392d363334662d343966332d623132622d3363376432366363616231662f53637265656e5f5265636f7264696e675f323032342d30322d32315f61745f31312e33392e32392e6d6f76 "Download 'Screen_Recording_2024-02-21_at_11.39.29.mov'")

The remediation for this kind of attack is to remove the ID from the `Authorize` button. This will make it impossible to target the button on page load.

##### Steps to reproduce

**Simple POC using my attack site**

1. Log into gitlab.com with a "burner" account
2. Visit <https://joaxcar.com/gitlab/click_attack_poc.html> and press and hold enter for 3 seconds
3. Go to <https://gitlab.com/-/user_settings/applications> and see that you have my attacker application in the `Authorized applications` list.
4. Revoke my access by clicking revoke

**Using your own application**

1. Log into gitlab.com
2. Go to <https://gitlab.com/-/user_settings/applications>
3. Click "add new application"
4. Fill out the form and make sure to point the redirect URL to a place where you will host a "catch page". (you can always change this later). click `api` as scope
5. Take note of `Application ID`(this is `client_id` in oauth), `Secret` and `redirect URL`
6. Host two web pages (my POC is written in PHP and HTML), the files are here

[![poc_ato_click.php](data:image/gif;base64...)](https://user-content.gitlab-static.net/b27ac212f3564a8877bb7870286a5d10f635b01d/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f35323834306435302d323738362d346136322d396635352d3631303764363635616333642f706f635f61746f5f636c69636b2e706870)

[![click_attack_poc.html](data:image/gif;base64...)](https://user-content.gitlab-static.net/b78fe10a93791bd896ce98e6895b47679751b609/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f34633266313435322d303433642d346666382d623562372d6665323939626231316462642f636c69636b5f61747461636b5f706f632e68746d6c)

7. Make sure to update these files with the appropriate IDs and secrets. Search for `client_id` and replace the value with `Application ID`, search for `client_secret` and replace it with your secret, and search for `redirect_url` and replace it with your URL. NOTE the redirect URL is the URL to the hosted .PHP file
8. Now visit the hosted POC and it should work just as my example

##### Impact

The attacker gains full access to victim's account through API (read and write)

##### What is the current *bug* behavior?

The `Authorize` button has an ID and can thus be the target of a fragment identifier. This allows for the "cross window forgery" attack

##### What is the expected *correct* behavior?

Removing the ID from the button will stop the attack

##### Output of checks

This bug happens on GitLab.com

#### Impact

Full access to victim's account through API (read and write)

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [Screenshot\_2024-02-21\_at\_11.50.32.png](https://h1.sec.gitlab.net/a/20d82c7c-94f5-4ad8-98af-fcf0bc690912/Screenshot_2024-02-21_at_11.50.32.png)
* [Screenshot\_2024-02-21\_at\_11.53.55.png](https://h1.sec.gitlab.net/a/4cd7781e-1ca5-4620-992e-1fd49896a350/Screenshot_2024-02-21_at_11.53.55.png)
* [Screen\_Recording\_2024-02-21\_at\_11.39.29.mov](https://h1.sec.gitlab.net/a/f4fc12d9-634f-49f3-b12b-3c7d26ccab1f/Screen_Recording_2024-02-21_at_11.39.29.mov)
* [poc\_ato\_click.php](https://h1.sec.gitlab.net/a/52840d50-2786-4a62-9f55-6107d665ac3d/poc_ato_click.php)
* [click\_attack\_poc.html](https://h1.sec.gitlab.net/a/4c2f1452-043d-4ff8-b5b7-fe299bb11dbd/click_attack_poc.html)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


