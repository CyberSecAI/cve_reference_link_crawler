=== Content from git.kernel.org_86c4250a_20250111_041215.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5cb36e35bc10ea334810937990c2b9023dacb1b0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5cb36e35bc10ea334810937990c2b9023dacb1b0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5cb36e35bc10ea334810937990c2b9023dacb1b0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5cb36e35bc10ea334810937990c2b9023dacb1b0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeff Layton <jlayton@kernel.org> | 2024-07-02 18:44:48 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-18 13:18:32 +0200 |
| commit | [5cb36e35bc10ea334810937990c2b9023dacb1b0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5cb36e35bc10ea334810937990c2b9023dacb1b0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5cb36e35bc10ea334810937990c2b9023dacb1b0)) | |
| tree | [ea6d6be6dd8a3c0472227dd270152527f44b6cb7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5cb36e35bc10ea334810937990c2b9023dacb1b0) | |
| parent | [97cfd5e20ddc2e33e16ce369626ce76c9a475fd7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=97cfd5e20ddc2e33e16ce369626ce76c9a475fd7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5cb36e35bc10ea334810937990c2b9023dacb1b0&id2=97cfd5e20ddc2e33e16ce369626ce76c9a475fd7)) | |
| download | [linux-5cb36e35bc10ea334810937990c2b9023dacb1b0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5cb36e35bc10ea334810937990c2b9023dacb1b0.tar.gz) | |

filelock: fix potential use-after-free in posix\_lock\_inode[ Upstream commit 1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92 ]
Light Hsieh reported a KASAN UAF warning in trace\_posix\_lock\_inode().
The request pointer had been changed earlier to point to a lock entry
that was added to the inode's list. However, before the tracepoint could
fire, another task raced in and freed that lock.
Fix this by moving the tracepoint inside the spinlock, which should
ensure that this doesn't happen.
Fixes: 74f6f5912693 ("locks: fix KASAN: use-after-free in trace\_event\_raw\_event\_filelock\_lock")
Link: [https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel@kernel.org/](https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel%40kernel.org/)
Reported-by: Light Hsieh (謝明燈) <Light.Hsieh@mediatek.com>
Signed-off-by: Jeff Layton <jlayton@kernel.org>
Link: [https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98@kernel.org](https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98%40kernel.org)
Reviewed-by: Alexander Aring <aahringo@redhat.com>
Signed-off-by: Christian Brauner <brauner@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5cb36e35bc10ea334810937990c2b9023dacb1b0)

| -rw-r--r-- | [fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/locks.c?id=5cb36e35bc10ea334810937990c2b9023dacb1b0) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/locks.c b/fs/locks.cindex 7d0918b8fe5d61..c23bcfe9b0fddf 100644--- a/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=97cfd5e20ddc2e33e16ce369626ce76c9a475fd7)+++ b/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=5cb36e35bc10ea334810937990c2b9023dacb1b0)@@ -1298,9 +1298,9 @@ retry: locks\_wake\_up\_blocks(left); } out:+ trace\_posix\_lock\_inode(inode, request, error); spin\_unlock(&ctx->flc\_lock); percpu\_up\_read(&file\_rwsem);- trace\_posix\_lock\_inode(inode, request, error); /\* \* Free any unused locks. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:10:52 +0000



=== Content from git.kernel.org_3a4609f1_20250111_041213.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeff Layton <jlayton@kernel.org> | 2024-07-02 18:44:48 -0400 |
| --- | --- | --- |
| committer | Christian Brauner <brauner@kernel.org> | 2024-07-05 18:40:44 +0200 |
| commit | [1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92)) | |
| tree | [bcb611bcaf879bc05baff2528c8ea0a7660390af](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92) | |
| parent | [eeb17984e88858a5a324844083709f1c6425333c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eeb17984e88858a5a324844083709f1c6425333c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92&id2=eeb17984e88858a5a324844083709f1c6425333c)) | |
| download | [linux-1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92.tar.gz) | |

filelock: fix potential use-after-free in posix\_lock\_inodeLight Hsieh reported a KASAN UAF warning in trace\_posix\_lock\_inode().
The request pointer had been changed earlier to point to a lock entry
that was added to the inode's list. However, before the tracepoint could
fire, another task raced in and freed that lock.
Fix this by moving the tracepoint inside the spinlock, which should
ensure that this doesn't happen.
Fixes: 74f6f5912693 ("locks: fix KASAN: use-after-free in trace\_event\_raw\_event\_filelock\_lock")
Link: [https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel@kernel.org/](https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel%40kernel.org/)
Reported-by: Light Hsieh (謝明燈) <Light.Hsieh@mediatek.com>
Signed-off-by: Jeff Layton <jlayton@kernel.org>
Link: [https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98@kernel.org](https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98%40kernel.org)
Reviewed-by: Alexander Aring <aahringo@redhat.com>
Signed-off-by: Christian Brauner <brauner@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92)

| -rw-r--r-- | [fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/locks.c?id=1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/locks.c b/fs/locks.cindex 90c8746874dedb..2a445776dae3c8 100644--- a/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=eeb17984e88858a5a324844083709f1c6425333c)+++ b/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92)@@ -1367,9 +1367,9 @@ retry: locks\_wake\_up\_blocks(&left->c); } out:+ trace\_posix\_lock\_inode(inode, request, error); spin\_unlock(&ctx->flc\_lock); percpu\_up\_read(&file\_rwsem);- trace\_posix\_lock\_inode(inode, request, error); /\* \* Free any unused locks. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:10:50 +0000



=== Content from git.kernel.org_fe8aa4fb_20250111_041215.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7d4c14f4b511fd4c0dc788084ae59b4656ace58b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7d4c14f4b511fd4c0dc788084ae59b4656ace58b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7d4c14f4b511fd4c0dc788084ae59b4656ace58b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7d4c14f4b511fd4c0dc788084ae59b4656ace58b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeff Layton <jlayton@kernel.org> | 2024-07-02 18:44:48 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-18 13:05:45 +0200 |
| commit | [7d4c14f4b511fd4c0dc788084ae59b4656ace58b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7d4c14f4b511fd4c0dc788084ae59b4656ace58b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7d4c14f4b511fd4c0dc788084ae59b4656ace58b)) | |
| tree | [b865bf087a09d8e569c3bb0ac7a5ace99b110c49](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7d4c14f4b511fd4c0dc788084ae59b4656ace58b) | |
| parent | [0100aeb8a12d51950418e685f879cc80cb8e5982](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0100aeb8a12d51950418e685f879cc80cb8e5982) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7d4c14f4b511fd4c0dc788084ae59b4656ace58b&id2=0100aeb8a12d51950418e685f879cc80cb8e5982)) | |
| download | [linux-7d4c14f4b511fd4c0dc788084ae59b4656ace58b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7d4c14f4b511fd4c0dc788084ae59b4656ace58b.tar.gz) | |

filelock: fix potential use-after-free in posix\_lock\_inode[ Upstream commit 1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92 ]
Light Hsieh reported a KASAN UAF warning in trace\_posix\_lock\_inode().
The request pointer had been changed earlier to point to a lock entry
that was added to the inode's list. However, before the tracepoint could
fire, another task raced in and freed that lock.
Fix this by moving the tracepoint inside the spinlock, which should
ensure that this doesn't happen.
Fixes: 74f6f5912693 ("locks: fix KASAN: use-after-free in trace\_event\_raw\_event\_filelock\_lock")
Link: [https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel@kernel.org/](https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel%40kernel.org/)
Reported-by: Light Hsieh (謝明燈) <Light.Hsieh@mediatek.com>
Signed-off-by: Jeff Layton <jlayton@kernel.org>
Link: [https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98@kernel.org](https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98%40kernel.org)
Reviewed-by: Alexander Aring <aahringo@redhat.com>
Signed-off-by: Christian Brauner <brauner@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7d4c14f4b511fd4c0dc788084ae59b4656ace58b)

| -rw-r--r-- | [fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/locks.c?id=7d4c14f4b511fd4c0dc788084ae59b4656ace58b) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/locks.c b/fs/locks.cindex b0753c8871fb2d..843fa3d3375d40 100644--- a/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=0100aeb8a12d51950418e685f879cc80cb8e5982)+++ b/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=7d4c14f4b511fd4c0dc788084ae59b4656ace58b)@@ -1392,9 +1392,9 @@ retry: locks\_wake\_up\_blocks(left); } out:+ trace\_posix\_lock\_inode(inode, request, error); spin\_unlock(&ctx->flc\_lock); percpu\_up\_read(&file\_rwsem);- trace\_posix\_lock\_inode(inode, request, error); /\* \* Free any unused locks. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:10:53 +0000



=== Content from git.kernel.org_50472386_20250111_041214.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=432b06b69d1d354a171f7499141116536579eb6a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=432b06b69d1d354a171f7499141116536579eb6a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=432b06b69d1d354a171f7499141116536579eb6a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=432b06b69d1d354a171f7499141116536579eb6a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeff Layton <jlayton@kernel.org> | 2024-07-02 18:44:48 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-18 13:21:11 +0200 |
| commit | [432b06b69d1d354a171f7499141116536579eb6a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=432b06b69d1d354a171f7499141116536579eb6a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=432b06b69d1d354a171f7499141116536579eb6a)) | |
| tree | [d58cf0da054283d1f381da5b574466972d590370](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=432b06b69d1d354a171f7499141116536579eb6a) | |
| parent | [cae91b5cf9b8cc2315debc865daf86f88d8fc5b7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cae91b5cf9b8cc2315debc865daf86f88d8fc5b7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=432b06b69d1d354a171f7499141116536579eb6a&id2=cae91b5cf9b8cc2315debc865daf86f88d8fc5b7)) | |
| download | [linux-432b06b69d1d354a171f7499141116536579eb6a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-432b06b69d1d354a171f7499141116536579eb6a.tar.gz) | |

filelock: fix potential use-after-free in posix\_lock\_inode[ Upstream commit 1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92 ]
Light Hsieh reported a KASAN UAF warning in trace\_posix\_lock\_inode().
The request pointer had been changed earlier to point to a lock entry
that was added to the inode's list. However, before the tracepoint could
fire, another task raced in and freed that lock.
Fix this by moving the tracepoint inside the spinlock, which should
ensure that this doesn't happen.
Fixes: 74f6f5912693 ("locks: fix KASAN: use-after-free in trace\_event\_raw\_event\_filelock\_lock")
Link: [https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel@kernel.org/](https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel%40kernel.org/)
Reported-by: Light Hsieh (謝明燈) <Light.Hsieh@mediatek.com>
Signed-off-by: Jeff Layton <jlayton@kernel.org>
Link: [https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98@kernel.org](https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98%40kernel.org)
Reviewed-by: Alexander Aring <aahringo@redhat.com>
Signed-off-by: Christian Brauner <brauner@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=432b06b69d1d354a171f7499141116536579eb6a)

| -rw-r--r-- | [fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/locks.c?id=432b06b69d1d354a171f7499141116536579eb6a) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/locks.c b/fs/locks.cindex 76ad05f8070ad9..fb717dae902977 100644--- a/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=cae91b5cf9b8cc2315debc865daf86f88d8fc5b7)+++ b/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=432b06b69d1d354a171f7499141116536579eb6a)@@ -1314,9 +1314,9 @@ retry: locks\_wake\_up\_blocks(left); } out:+ trace\_posix\_lock\_inode(inode, request, error); spin\_unlock(&ctx->flc\_lock); percpu\_up\_read(&file\_rwsem);- trace\_posix\_lock\_inode(inode, request, error); /\* \* Free any unused locks. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:10:51 +0000



=== Content from git.kernel.org_6f6b681a_20250111_041214.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1cbbb3d9475c403ebedc327490c7c2b991398197)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1cbbb3d9475c403ebedc327490c7c2b991398197)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1cbbb3d9475c403ebedc327490c7c2b991398197)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1cbbb3d9475c403ebedc327490c7c2b991398197)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeff Layton <jlayton@kernel.org> | 2024-07-02 18:44:48 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-18 11:40:52 +0200 |
| commit | [1cbbb3d9475c403ebedc327490c7c2b991398197](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1cbbb3d9475c403ebedc327490c7c2b991398197) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1cbbb3d9475c403ebedc327490c7c2b991398197)) | |
| tree | [b671bdec2e55b063d498804c667357663481d236](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1cbbb3d9475c403ebedc327490c7c2b991398197) | |
| parent | [4380b1af286a3584b7999427247dfaee43166bbe](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4380b1af286a3584b7999427247dfaee43166bbe) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1cbbb3d9475c403ebedc327490c7c2b991398197&id2=4380b1af286a3584b7999427247dfaee43166bbe)) | |
| download | [linux-1cbbb3d9475c403ebedc327490c7c2b991398197.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1cbbb3d9475c403ebedc327490c7c2b991398197.tar.gz) | |

filelock: fix potential use-after-free in posix\_lock\_inode[ Upstream commit 1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92 ]
Light Hsieh reported a KASAN UAF warning in trace\_posix\_lock\_inode().
The request pointer had been changed earlier to point to a lock entry
that was added to the inode's list. However, before the tracepoint could
fire, another task raced in and freed that lock.
Fix this by moving the tracepoint inside the spinlock, which should
ensure that this doesn't happen.
Fixes: 74f6f5912693 ("locks: fix KASAN: use-after-free in trace\_event\_raw\_event\_filelock\_lock")
Link: [https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel@kernel.org/](https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel%40kernel.org/)
Reported-by: Light Hsieh (謝明燈) <Light.Hsieh@mediatek.com>
Signed-off-by: Jeff Layton <jlayton@kernel.org>
Link: [https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98@kernel.org](https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98%40kernel.org)
Reviewed-by: Alexander Aring <aahringo@redhat.com>
Signed-off-by: Christian Brauner <brauner@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1cbbb3d9475c403ebedc327490c7c2b991398197)

| -rw-r--r-- | [fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/locks.c?id=1cbbb3d9475c403ebedc327490c7c2b991398197) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/locks.c b/fs/locks.cindex 90f92784aa5547..bafe11deea56b0 100644--- a/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=4380b1af286a3584b7999427247dfaee43166bbe)+++ b/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=1cbbb3d9475c403ebedc327490c7c2b991398197)@@ -1336,9 +1336,9 @@ static int posix\_lock\_inode(struct inode \*inode, struct file\_lock \*request, locks\_wake\_up\_blocks(left); } out:+ trace\_posix\_lock\_inode(inode, request, error); spin\_unlock(&ctx->flc\_lock); percpu\_up\_read(&file\_rwsem);- trace\_posix\_lock\_inode(inode, request, error); /\* \* Free any unused locks. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:10:51 +0000



=== Content from git.kernel.org_e4c3a73d_20250111_041212.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=02a8964260756c70b20393ad4006948510ac9967)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=02a8964260756c70b20393ad4006948510ac9967)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=02a8964260756c70b20393ad4006948510ac9967)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=02a8964260756c70b20393ad4006948510ac9967)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeff Layton <jlayton@kernel.org> | 2024-07-02 18:44:48 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-18 13:07:36 +0200 |
| commit | [02a8964260756c70b20393ad4006948510ac9967](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=02a8964260756c70b20393ad4006948510ac9967) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=02a8964260756c70b20393ad4006948510ac9967)) | |
| tree | [0b14ae6b7761414cd4e8b3c25b3f586bf31d6693](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=02a8964260756c70b20393ad4006948510ac9967) | |
| parent | [bc17f2377818dca643a74499c3f5333500c90503](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bc17f2377818dca643a74499c3f5333500c90503) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=02a8964260756c70b20393ad4006948510ac9967&id2=bc17f2377818dca643a74499c3f5333500c90503)) | |
| download | [linux-02a8964260756c70b20393ad4006948510ac9967.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-02a8964260756c70b20393ad4006948510ac9967.tar.gz) | |

filelock: fix potential use-after-free in posix\_lock\_inode[ Upstream commit 1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92 ]
Light Hsieh reported a KASAN UAF warning in trace\_posix\_lock\_inode().
The request pointer had been changed earlier to point to a lock entry
that was added to the inode's list. However, before the tracepoint could
fire, another task raced in and freed that lock.
Fix this by moving the tracepoint inside the spinlock, which should
ensure that this doesn't happen.
Fixes: 74f6f5912693 ("locks: fix KASAN: use-after-free in trace\_event\_raw\_event\_filelock\_lock")
Link: [https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel@kernel.org/](https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel%40kernel.org/)
Reported-by: Light Hsieh (謝明燈) <Light.Hsieh@mediatek.com>
Signed-off-by: Jeff Layton <jlayton@kernel.org>
Link: [https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98@kernel.org](https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98%40kernel.org)
Reviewed-by: Alexander Aring <aahringo@redhat.com>
Signed-off-by: Christian Brauner <brauner@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=02a8964260756c70b20393ad4006948510ac9967)

| -rw-r--r-- | [fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/locks.c?id=02a8964260756c70b20393ad4006948510ac9967) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/locks.c b/fs/locks.cindex 77781b71bcaab8..360c348ae6c8fc 100644--- a/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=bc17f2377818dca643a74499c3f5333500c90503)+++ b/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=02a8964260756c70b20393ad4006948510ac9967)@@ -1392,9 +1392,9 @@ retry: locks\_wake\_up\_blocks(left); } out:+ trace\_posix\_lock\_inode(inode, request, error); spin\_unlock(&ctx->flc\_lock); percpu\_up\_read(&file\_rwsem);- trace\_posix\_lock\_inode(inode, request, error); /\* \* Free any unused locks. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:10:49 +0000



=== Content from git.kernel.org_13e4c6a5_20250111_041212.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=116599f6a26906cf33f67975c59f0692ecf7e9b2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=116599f6a26906cf33f67975c59f0692ecf7e9b2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=116599f6a26906cf33f67975c59f0692ecf7e9b2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=116599f6a26906cf33f67975c59f0692ecf7e9b2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeff Layton <jlayton@kernel.org> | 2024-07-02 18:44:48 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-18 13:22:37 +0200 |
| commit | [116599f6a26906cf33f67975c59f0692ecf7e9b2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=116599f6a26906cf33f67975c59f0692ecf7e9b2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=116599f6a26906cf33f67975c59f0692ecf7e9b2)) | |
| tree | [176f98129291fc56f7b1085d3ece2c6484c60855](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=116599f6a26906cf33f67975c59f0692ecf7e9b2) | |
| parent | [41bd6af4ca307d1b0fefd5784fe3e27ffac77140](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=41bd6af4ca307d1b0fefd5784fe3e27ffac77140) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=116599f6a26906cf33f67975c59f0692ecf7e9b2&id2=41bd6af4ca307d1b0fefd5784fe3e27ffac77140)) | |
| download | [linux-116599f6a26906cf33f67975c59f0692ecf7e9b2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-116599f6a26906cf33f67975c59f0692ecf7e9b2.tar.gz) | |

filelock: fix potential use-after-free in posix\_lock\_inode[ Upstream commit 1b3ec4f7c03d4b07bad70697d7e2f4088d2cfe92 ]
Light Hsieh reported a KASAN UAF warning in trace\_posix\_lock\_inode().
The request pointer had been changed earlier to point to a lock entry
that was added to the inode's list. However, before the tracepoint could
fire, another task raced in and freed that lock.
Fix this by moving the tracepoint inside the spinlock, which should
ensure that this doesn't happen.
Fixes: 74f6f5912693 ("locks: fix KASAN: use-after-free in trace\_event\_raw\_event\_filelock\_lock")
Link: [https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel@kernel.org/](https://lore.kernel.org/linux-fsdevel/724ffb0a2962e912ea62bb0515deadf39c325112.camel%40kernel.org/)
Reported-by: Light Hsieh (謝明燈) <Light.Hsieh@mediatek.com>
Signed-off-by: Jeff Layton <jlayton@kernel.org>
Link: [https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98@kernel.org](https://lore.kernel.org/r/20240702-filelock-6-10-v1-1-96e766aadc98%40kernel.org)
Reviewed-by: Alexander Aring <aahringo@redhat.com>
Signed-off-by: Christian Brauner <brauner@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=116599f6a26906cf33f67975c59f0692ecf7e9b2)

| -rw-r--r-- | [fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/locks.c?id=116599f6a26906cf33f67975c59f0692ecf7e9b2) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/locks.c b/fs/locks.cindex c360d1992d21f9..bdd94c32256f52 100644--- a/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=41bd6af4ca307d1b0fefd5784fe3e27ffac77140)+++ b/[fs/locks.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/locks.c?id=116599f6a26906cf33f67975c59f0692ecf7e9b2)@@ -1367,9 +1367,9 @@ retry: locks\_wake\_up\_blocks(&left->c); } out:+ trace\_posix\_lock\_inode(inode, request, error); spin\_unlock(&ctx->flc\_lock); percpu\_up\_read(&file\_rwsem);- trace\_posix\_lock\_inode(inode, request, error); /\* \* Free any unused locks. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:10:50 +0000


