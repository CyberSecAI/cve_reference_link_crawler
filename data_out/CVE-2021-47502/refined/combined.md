=== Content from git.kernel.org_8b91c79a_20250110_152331.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=23ba28616d3063bd4c4953598ed5e439ca891101)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=23ba28616d3063bd4c4953598ed5e439ca891101)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=23ba28616d3063bd4c4953598ed5e439ca891101)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=23ba28616d3063bd4c4953598ed5e439ca891101)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Srinivas Kandagatla <srinivas.kandagatla@linaro.org> | 2021-11-30 16:05:04 +0000 |
| --- | --- | --- |
| committer | Mark Brown <broonie@kernel.org> | 2021-12-01 14:13:49 +0000 |
| commit | [23ba28616d3063bd4c4953598ed5e439ca891101](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=23ba28616d3063bd4c4953598ed5e439ca891101) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=23ba28616d3063bd4c4953598ed5e439ca891101)) | |
| tree | [0ba0998a53607339c9b53cc1aa4c85b976b175a9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=23ba28616d3063bd4c4953598ed5e439ca891101) | |
| parent | [4739d88ad8e1900f809f8a5c98f3c1b65bf76220](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4739d88ad8e1900f809f8a5c98f3c1b65bf76220) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=23ba28616d3063bd4c4953598ed5e439ca891101&id2=4739d88ad8e1900f809f8a5c98f3c1b65bf76220)) | |
| download | [linux-23ba28616d3063bd4c4953598ed5e439ca891101.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-23ba28616d3063bd4c4953598ed5e439ca891101.tar.gz) | |

ASoC: codecs: wcd934x: handle channel mappping list correctlyCurrently each channel is added as list to dai channel list, however
there is danger of adding same channel to multiple dai channel list
which endups corrupting the other list where its already added.
This patch ensures that the channel is actually free before adding to
the dai channel list and also ensures that the channel is on the list
before deleting it.
This check was missing previously, and we did not hit this issue as
we were testing very simple usecases with sequence of amixer commands.
Fixes: a70d9245759a ("ASoC: wcd934x: add capture dapm widgets")
Fixes: dd9eb19b5673 ("ASoC: wcd934x: add playback dapm widgets")
Signed-off-by: Srinivas Kandagatla <srinivas.kandagatla@linaro.org>
Link: [https://lore.kernel.org/r/20211130160507.22180-2-srinivas.kandagatla@linaro.org](https://lore.kernel.org/r/20211130160507.22180-2-srinivas.kandagatla%40linaro.org)
Signed-off-by: Mark Brown <broonie@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=23ba28616d3063bd4c4953598ed5e439ca891101)

| -rw-r--r-- | [sound/soc/codecs/wcd934x.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/codecs/wcd934x.c?id=23ba28616d3063bd4c4953598ed5e439ca891101) | 119 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 88 insertions, 31 deletions

| diff --git a/sound/soc/codecs/wcd934x.c b/sound/soc/codecs/wcd934x.cindex 4f568abd59e24a..eb4e2f2a24aecc 100644--- a/[sound/soc/codecs/wcd934x.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/codecs/wcd934x.c?id=4739d88ad8e1900f809f8a5c98f3c1b65bf76220)+++ b/[sound/soc/codecs/wcd934x.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/codecs/wcd934x.c?id=23ba28616d3063bd4c4953598ed5e439ca891101)@@ -3326,6 +3326,31 @@ static int slim\_rx\_mux\_get(struct snd\_kcontrol \*kc, return 0; } +static int slim\_rx\_mux\_to\_dai\_id(int mux)+{+ int aif\_id;++ switch (mux) {+ case 1:+ aif\_id = AIF1\_PB;+ break;+ case 2:+ aif\_id = AIF2\_PB;+ break;+ case 3:+ aif\_id = AIF3\_PB;+ break;+ case 4:+ aif\_id = AIF4\_PB;+ break;+ default:+ aif\_id = -1;+ break;+ }++ return aif\_id;+}+ static int slim\_rx\_mux\_put(struct snd\_kcontrol \*kc, struct snd\_ctl\_elem\_value \*ucontrol) {@@ -3333,43 +3358,59 @@ static int slim\_rx\_mux\_put(struct snd\_kcontrol \*kc, struct wcd934x\_codec \*wcd = dev\_get\_drvdata(w->dapm->dev); struct soc\_enum \*e = (struct soc\_enum \*)kc->private\_value; struct snd\_soc\_dapm\_update \*update = NULL;+ struct wcd934x\_slim\_ch \*ch, \*c; u32 port\_id = w->shift;+ bool found = false;+ int mux\_idx;+ int prev\_mux\_idx = wcd->rx\_port\_value[port\_id];+ int aif\_id; - if (wcd->rx\_port\_value[port\_id] == ucontrol->value.enumerated.item[0])- return 0;+ mux\_idx = ucontrol->value.enumerated.item[0]; - wcd->rx\_port\_value[port\_id] = ucontrol->value.enumerated.item[0];+ if (mux\_idx == prev\_mux\_idx)+ return 0; - switch (wcd->rx\_port\_value[port\_id]) {+ switch(mux\_idx) { case 0:- list\_del\_init(&wcd->rx\_chs[port\_id].list);- break;- case 1:- list\_add\_tail(&wcd->rx\_chs[port\_id].list,- &wcd->dai[AIF1\_PB].slim\_ch\_list);- break;- case 2:- list\_add\_tail(&wcd->rx\_chs[port\_id].list,- &wcd->dai[AIF2\_PB].slim\_ch\_list);- break;- case 3:- list\_add\_tail(&wcd->rx\_chs[port\_id].list,- &wcd->dai[AIF3\_PB].slim\_ch\_list);+ aif\_id = slim\_rx\_mux\_to\_dai\_id(prev\_mux\_idx);+ if (aif\_id < 0)+ return 0;++ list\_for\_each\_entry\_safe(ch, c, &wcd->dai[aif\_id].slim\_ch\_list, list) {+ if (ch->port == port\_id + WCD934X\_RX\_START) {+ found = true;+ list\_del\_init(&ch->list);+ break;+ }+ }+ if (!found)+ return 0;+ break;- case 4:- list\_add\_tail(&wcd->rx\_chs[port\_id].list,- &wcd->dai[AIF4\_PB].slim\_ch\_list);+ case 1 ... 4:+ aif\_id = slim\_rx\_mux\_to\_dai\_id(mux\_idx);+ if (aif\_id < 0)+ return 0;++ if (list\_empty(&wcd->rx\_chs[port\_id].list)) {+ list\_add\_tail(&wcd->rx\_chs[port\_id].list,+ &wcd->dai[aif\_id].slim\_ch\_list);+ } else {+ dev\_err(wcd->dev ,"SLIM\_RX%d PORT is busy\n", port\_id);+ return 0;+ } break;+ default:- dev\_err(wcd->dev, "Unknown AIF %d\n",- wcd->rx\_port\_value[port\_id]);+ dev\_err(wcd->dev, "Unknown AIF %d\n", mux\_idx); goto err; } + wcd->rx\_port\_value[port\_id] = mux\_idx; snd\_soc\_dapm\_mux\_update\_power(w->dapm, kc, wcd->rx\_port\_value[port\_id], e, update); - return 0;+ return 1; err: return -EINVAL; }@@ -3815,6 +3856,7 @@ static int slim\_tx\_mixer\_put(struct snd\_kcontrol \*kc, struct soc\_mixer\_control \*mixer = (struct soc\_mixer\_control \*)kc->private\_value; int enable = ucontrol->value.integer.value[0];+ struct wcd934x\_slim\_ch \*ch, \*c; int dai\_id = widget->shift; int port\_id = mixer->shift; @@ -3822,17 +3864,32 @@ static int slim\_tx\_mixer\_put(struct snd\_kcontrol \*kc, if (enable == wcd->tx\_port\_value[port\_id]) return 0; - wcd->tx\_port\_value[port\_id] = enable;-- if (enable)- list\_add\_tail(&wcd->tx\_chs[port\_id].list,- &wcd->dai[dai\_id].slim\_ch\_list);- else- list\_del\_init(&wcd->tx\_chs[port\_id].list);+ if (enable) {+ if (list\_empty(&wcd->tx\_chs[port\_id].list)) {+ list\_add\_tail(&wcd->tx\_chs[port\_id].list,+ &wcd->dai[dai\_id].slim\_ch\_list);+ } else {+ dev\_err(wcd->dev ,"SLIM\_TX%d PORT is busy\n", port\_id);+ return 0;+ }+ } else {+ bool found = false;++ list\_for\_each\_entry\_safe(ch, c, &wcd->dai[dai\_id].slim\_ch\_list, list) {+ if (ch->port == port\_id) {+ found = true;+ list\_del\_init(&wcd->tx\_chs[port\_id].list);+ break;+ }+ }+ if (!found)+ return 0;+ } + wcd->tx\_port\_value[port\_id] = enable; snd\_soc\_dapm\_mixer\_update\_power(widget->dapm, kc, enable, update); - return 0;+ return 1; }  static const struct snd\_kcontrol\_new aif1\_slim\_cap\_mixer[] = { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:22:08 +0000



=== Content from git.kernel.org_a74e9411_20250110_152333.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=339ffb5b56005582aacc860524d2d208604049d1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=339ffb5b56005582aacc860524d2d208604049d1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=339ffb5b56005582aacc860524d2d208604049d1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=339ffb5b56005582aacc860524d2d208604049d1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Srinivas Kandagatla <srinivas.kandagatla@linaro.org> | 2021-11-30 16:05:04 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 10:57:17 +0100 |
| commit | [339ffb5b56005582aacc860524d2d208604049d1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=339ffb5b56005582aacc860524d2d208604049d1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=339ffb5b56005582aacc860524d2d208604049d1)) | |
| tree | [29fcd26507c2b4f4dfa74b075ef8130143f27ae1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=339ffb5b56005582aacc860524d2d208604049d1) | |
| parent | [71272640d459c9efe2380d43d4d899782bb225a0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=71272640d459c9efe2380d43d4d899782bb225a0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=339ffb5b56005582aacc860524d2d208604049d1&id2=71272640d459c9efe2380d43d4d899782bb225a0)) | |
| download | [linux-339ffb5b56005582aacc860524d2d208604049d1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-339ffb5b56005582aacc860524d2d208604049d1.tar.gz) | |

ASoC: codecs: wcd934x: handle channel mappping list correctlycommit 23ba28616d3063bd4c4953598ed5e439ca891101 upstream.
Currently each channel is added as list to dai channel list, however
there is danger of adding same channel to multiple dai channel list
which endups corrupting the other list where its already added.
This patch ensures that the channel is actually free before adding to
the dai channel list and also ensures that the channel is on the list
before deleting it.
This check was missing previously, and we did not hit this issue as
we were testing very simple usecases with sequence of amixer commands.
Fixes: a70d9245759a ("ASoC: wcd934x: add capture dapm widgets")
Fixes: dd9eb19b5673 ("ASoC: wcd934x: add playback dapm widgets")
Signed-off-by: Srinivas Kandagatla <srinivas.kandagatla@linaro.org>
Link: [https://lore.kernel.org/r/20211130160507.22180-2-srinivas.kandagatla@linaro.org](https://lore.kernel.org/r/20211130160507.22180-2-srinivas.kandagatla%40linaro.org)
Signed-off-by: Mark Brown <broonie@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=339ffb5b56005582aacc860524d2d208604049d1)

| -rw-r--r-- | [sound/soc/codecs/wcd934x.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/codecs/wcd934x.c?id=339ffb5b56005582aacc860524d2d208604049d1) | 119 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 88 insertions, 31 deletions

| diff --git a/sound/soc/codecs/wcd934x.c b/sound/soc/codecs/wcd934x.cindex 4f568abd59e24a..eb4e2f2a24aecc 100644--- a/[sound/soc/codecs/wcd934x.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/codecs/wcd934x.c?id=71272640d459c9efe2380d43d4d899782bb225a0)+++ b/[sound/soc/codecs/wcd934x.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/codecs/wcd934x.c?id=339ffb5b56005582aacc860524d2d208604049d1)@@ -3326,6 +3326,31 @@ static int slim\_rx\_mux\_get(struct snd\_kcontrol \*kc, return 0; } +static int slim\_rx\_mux\_to\_dai\_id(int mux)+{+ int aif\_id;++ switch (mux) {+ case 1:+ aif\_id = AIF1\_PB;+ break;+ case 2:+ aif\_id = AIF2\_PB;+ break;+ case 3:+ aif\_id = AIF3\_PB;+ break;+ case 4:+ aif\_id = AIF4\_PB;+ break;+ default:+ aif\_id = -1;+ break;+ }++ return aif\_id;+}+ static int slim\_rx\_mux\_put(struct snd\_kcontrol \*kc, struct snd\_ctl\_elem\_value \*ucontrol) {@@ -3333,43 +3358,59 @@ static int slim\_rx\_mux\_put(struct snd\_kcontrol \*kc, struct wcd934x\_codec \*wcd = dev\_get\_drvdata(w->dapm->dev); struct soc\_enum \*e = (struct soc\_enum \*)kc->private\_value; struct snd\_soc\_dapm\_update \*update = NULL;+ struct wcd934x\_slim\_ch \*ch, \*c; u32 port\_id = w->shift;+ bool found = false;+ int mux\_idx;+ int prev\_mux\_idx = wcd->rx\_port\_value[port\_id];+ int aif\_id; - if (wcd->rx\_port\_value[port\_id] == ucontrol->value.enumerated.item[0])- return 0;+ mux\_idx = ucontrol->value.enumerated.item[0]; - wcd->rx\_port\_value[port\_id] = ucontrol->value.enumerated.item[0];+ if (mux\_idx == prev\_mux\_idx)+ return 0; - switch (wcd->rx\_port\_value[port\_id]) {+ switch(mux\_idx) { case 0:- list\_del\_init(&wcd->rx\_chs[port\_id].list);- break;- case 1:- list\_add\_tail(&wcd->rx\_chs[port\_id].list,- &wcd->dai[AIF1\_PB].slim\_ch\_list);- break;- case 2:- list\_add\_tail(&wcd->rx\_chs[port\_id].list,- &wcd->dai[AIF2\_PB].slim\_ch\_list);- break;- case 3:- list\_add\_tail(&wcd->rx\_chs[port\_id].list,- &wcd->dai[AIF3\_PB].slim\_ch\_list);+ aif\_id = slim\_rx\_mux\_to\_dai\_id(prev\_mux\_idx);+ if (aif\_id < 0)+ return 0;++ list\_for\_each\_entry\_safe(ch, c, &wcd->dai[aif\_id].slim\_ch\_list, list) {+ if (ch->port == port\_id + WCD934X\_RX\_START) {+ found = true;+ list\_del\_init(&ch->list);+ break;+ }+ }+ if (!found)+ return 0;+ break;- case 4:- list\_add\_tail(&wcd->rx\_chs[port\_id].list,- &wcd->dai[AIF4\_PB].slim\_ch\_list);+ case 1 ... 4:+ aif\_id = slim\_rx\_mux\_to\_dai\_id(mux\_idx);+ if (aif\_id < 0)+ return 0;++ if (list\_empty(&wcd->rx\_chs[port\_id].list)) {+ list\_add\_tail(&wcd->rx\_chs[port\_id].list,+ &wcd->dai[aif\_id].slim\_ch\_list);+ } else {+ dev\_err(wcd->dev ,"SLIM\_RX%d PORT is busy\n", port\_id);+ return 0;+ } break;+ default:- dev\_err(wcd->dev, "Unknown AIF %d\n",- wcd->rx\_port\_value[port\_id]);+ dev\_err(wcd->dev, "Unknown AIF %d\n", mux\_idx); goto err; } + wcd->rx\_port\_value[port\_id] = mux\_idx; snd\_soc\_dapm\_mux\_update\_power(w->dapm, kc, wcd->rx\_port\_value[port\_id], e, update); - return 0;+ return 1; err: return -EINVAL; }@@ -3815,6 +3856,7 @@ static int slim\_tx\_mixer\_put(struct snd\_kcontrol \*kc, struct soc\_mixer\_control \*mixer = (struct soc\_mixer\_control \*)kc->private\_value; int enable = ucontrol->value.integer.value[0];+ struct wcd934x\_slim\_ch \*ch, \*c; int dai\_id = widget->shift; int port\_id = mixer->shift; @@ -3822,17 +3864,32 @@ static int slim\_tx\_mixer\_put(struct snd\_kcontrol \*kc, if (enable == wcd->tx\_port\_value[port\_id]) return 0; - wcd->tx\_port\_value[port\_id] = enable;-- if (enable)- list\_add\_tail(&wcd->tx\_chs[port\_id].list,- &wcd->dai[dai\_id].slim\_ch\_list);- else- list\_del\_init(&wcd->tx\_chs[port\_id].list);+ if (enable) {+ if (list\_empty(&wcd->tx\_chs[port\_id].list)) {+ list\_add\_tail(&wcd->tx\_chs[port\_id].list,+ &wcd->dai[dai\_id].slim\_ch\_list);+ } else {+ dev\_err(wcd->dev ,"SLIM\_TX%d PORT is busy\n", port\_id);+ return 0;+ }+ } else {+ bool found = false;++ list\_for\_each\_entry\_safe(ch, c, &wcd->dai[dai\_id].slim\_ch\_list, list) {+ if (ch->port == port\_id) {+ found = true;+ list\_del\_init(&wcd->tx\_chs[port\_id].list);+ break;+ }+ }+ if (!found)+ return 0;+ } + wcd->tx\_port\_value[port\_id] = enable; snd\_soc\_dapm\_mixer\_update\_power(widget->dapm, kc, enable, update); - return 0;+ return 1; }  static const struct snd\_kcontrol\_new aif1\_slim\_cap\_mixer[] = { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:22:10 +0000


