<!DOCTYPE html>
<html lang='en'>
<head>
<title>ASoC: codecs: wcd934x: handle channel mappping list correctly - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='339ffb5b56005582aacc860524d2d208604049d1'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=339ffb5b56005582aacc860524d2d208604049d1'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=339ffb5b56005582aacc860524d2d208604049d1'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=339ffb5b56005582aacc860524d2d208604049d1'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=339ffb5b56005582aacc860524d2d208604049d1'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='339ffb5b56005582aacc860524d2d208604049d1'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='339ffb5b56005582aacc860524d2d208604049d1'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Srinivas Kandagatla &lt;srinivas.kandagatla@linaro.org&gt;</td><td class='right'>2021-11-30 16:05:04 +0000</td></tr>
<tr><th>committer</th><td>Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;</td><td class='right'>2021-12-14 10:57:17 +0100</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=339ffb5b56005582aacc860524d2d208604049d1'>339ffb5b56005582aacc860524d2d208604049d1</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=339ffb5b56005582aacc860524d2d208604049d1'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=339ffb5b56005582aacc860524d2d208604049d1'>29fcd26507c2b4f4dfa74b075ef8130143f27ae1</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=71272640d459c9efe2380d43d4d899782bb225a0'>71272640d459c9efe2380d43d4d899782bb225a0</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=339ffb5b56005582aacc860524d2d208604049d1&amp;id2=71272640d459c9efe2380d43d4d899782bb225a0'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-339ffb5b56005582aacc860524d2d208604049d1.tar.gz'>linux-339ffb5b56005582aacc860524d2d208604049d1.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>ASoC: codecs: wcd934x: handle channel mappping list correctly</div><div class='commit-msg'>commit 23ba28616d3063bd4c4953598ed5e439ca891101 upstream.

Currently each channel is added as list to dai channel list, however
there is danger of adding same channel to multiple dai channel list
which endups corrupting the other list where its already added.

This patch ensures that the channel is actually free before adding to
the dai channel list and also ensures that the channel is on the list
before deleting it.

This check was missing previously, and we did not hit this issue as
we were testing very simple usecases with sequence of amixer commands.

Fixes: a70d9245759a ("ASoC: wcd934x: add capture dapm widgets")
Fixes: dd9eb19b5673 ("ASoC: wcd934x: add playback dapm widgets")
Signed-off-by: Srinivas Kandagatla &lt;srinivas.kandagatla@linaro.org&gt;
Link: <a href="https://lore.kernel.org/r/20211130160507.22180-2-srinivas.kandagatla@linaro.org">https://lore.kernel.org/r/20211130160507.22180-2-srinivas.kandagatla@linaro.org</a>
Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;
Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=339ffb5b56005582aacc860524d2d208604049d1'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/codecs/wcd934x.c?id=339ffb5b56005582aacc860524d2d208604049d1'>sound/soc/codecs/wcd934x.c</a></td><td class='right'>119</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 73.9%;'/><td class='rem' style='width: 26.1%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>1 files changed, 88 insertions, 31 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/sound/soc/codecs/wcd934x.c b/sound/soc/codecs/wcd934x.c<br/>index 4f568abd59e24a..eb4e2f2a24aecc 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/codecs/wcd934x.c?id=71272640d459c9efe2380d43d4d899782bb225a0'>sound/soc/codecs/wcd934x.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/codecs/wcd934x.c?id=339ffb5b56005582aacc860524d2d208604049d1'>sound/soc/codecs/wcd934x.c</a></div><div class='hunk'>@@ -3326,6 +3326,31 @@ static int slim_rx_mux_get(struct snd_kcontrol *kc,</div><div class='ctx'> 	return 0;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='add'>+static int slim_rx_mux_to_dai_id(int mux)</div><div class='add'>+{</div><div class='add'>+	int aif_id;</div><div class='add'>+</div><div class='add'>+	switch (mux) {</div><div class='add'>+	case 1:</div><div class='add'>+		aif_id = AIF1_PB;</div><div class='add'>+		break;</div><div class='add'>+	case 2:</div><div class='add'>+		aif_id = AIF2_PB;</div><div class='add'>+		break;</div><div class='add'>+	case 3:</div><div class='add'>+		aif_id = AIF3_PB;</div><div class='add'>+		break;</div><div class='add'>+	case 4:</div><div class='add'>+		aif_id = AIF4_PB;</div><div class='add'>+		break;</div><div class='add'>+	default:</div><div class='add'>+		aif_id = -1;</div><div class='add'>+		break;</div><div class='add'>+	}</div><div class='add'>+</div><div class='add'>+	return aif_id;</div><div class='add'>+}</div><div class='add'>+</div><div class='ctx'> static int slim_rx_mux_put(struct snd_kcontrol *kc,</div><div class='ctx'> 			   struct snd_ctl_elem_value *ucontrol)</div><div class='ctx'> {</div><div class='hunk'>@@ -3333,43 +3358,59 @@ static int slim_rx_mux_put(struct snd_kcontrol *kc,</div><div class='ctx'> 	struct wcd934x_codec *wcd = dev_get_drvdata(w-&gt;dapm-&gt;dev);</div><div class='ctx'> 	struct soc_enum *e = (struct soc_enum *)kc-&gt;private_value;</div><div class='ctx'> 	struct snd_soc_dapm_update *update = NULL;</div><div class='add'>+	struct wcd934x_slim_ch *ch, *c;</div><div class='ctx'> 	u32 port_id = w-&gt;shift;</div><div class='add'>+	bool found = false;</div><div class='add'>+	int mux_idx;</div><div class='add'>+	int prev_mux_idx = wcd-&gt;rx_port_value[port_id];</div><div class='add'>+	int aif_id;</div><div class='ctx'> </div><div class='del'>-	if (wcd-&gt;rx_port_value[port_id] == ucontrol-&gt;value.enumerated.item[0])</div><div class='del'>-		return 0;</div><div class='add'>+	mux_idx = ucontrol-&gt;value.enumerated.item[0];</div><div class='ctx'> </div><div class='del'>-	wcd-&gt;rx_port_value[port_id] = ucontrol-&gt;value.enumerated.item[0];</div><div class='add'>+	if (mux_idx == prev_mux_idx)</div><div class='add'>+		return 0;</div><div class='ctx'> </div><div class='del'>-	switch (wcd-&gt;rx_port_value[port_id]) {</div><div class='add'>+	switch(mux_idx) {</div><div class='ctx'> 	case 0:</div><div class='del'>-		list_del_init(&amp;wcd-&gt;rx_chs[port_id].list);</div><div class='del'>-		break;</div><div class='del'>-	case 1:</div><div class='del'>-		list_add_tail(&amp;wcd-&gt;rx_chs[port_id].list,</div><div class='del'>-			      &amp;wcd-&gt;dai[AIF1_PB].slim_ch_list);</div><div class='del'>-		break;</div><div class='del'>-	case 2:</div><div class='del'>-		list_add_tail(&amp;wcd-&gt;rx_chs[port_id].list,</div><div class='del'>-			      &amp;wcd-&gt;dai[AIF2_PB].slim_ch_list);</div><div class='del'>-		break;</div><div class='del'>-	case 3:</div><div class='del'>-		list_add_tail(&amp;wcd-&gt;rx_chs[port_id].list,</div><div class='del'>-			      &amp;wcd-&gt;dai[AIF3_PB].slim_ch_list);</div><div class='add'>+		aif_id = slim_rx_mux_to_dai_id(prev_mux_idx);</div><div class='add'>+		if (aif_id &lt; 0)</div><div class='add'>+			return 0;</div><div class='add'>+</div><div class='add'>+		list_for_each_entry_safe(ch, c, &amp;wcd-&gt;dai[aif_id].slim_ch_list, list) {</div><div class='add'>+			if (ch-&gt;port == port_id + WCD934X_RX_START) {</div><div class='add'>+				found = true;</div><div class='add'>+				list_del_init(&amp;ch-&gt;list);</div><div class='add'>+				break;</div><div class='add'>+			}</div><div class='add'>+		}</div><div class='add'>+		if (!found)</div><div class='add'>+			return 0;</div><div class='add'>+</div><div class='ctx'> 		break;</div><div class='del'>-	case 4:</div><div class='del'>-		list_add_tail(&amp;wcd-&gt;rx_chs[port_id].list,</div><div class='del'>-			      &amp;wcd-&gt;dai[AIF4_PB].slim_ch_list);</div><div class='add'>+	case 1 ... 4:</div><div class='add'>+		aif_id = slim_rx_mux_to_dai_id(mux_idx);</div><div class='add'>+		if (aif_id &lt; 0)</div><div class='add'>+			return 0;</div><div class='add'>+</div><div class='add'>+		if (list_empty(&amp;wcd-&gt;rx_chs[port_id].list)) {</div><div class='add'>+			list_add_tail(&amp;wcd-&gt;rx_chs[port_id].list,</div><div class='add'>+				      &amp;wcd-&gt;dai[aif_id].slim_ch_list);</div><div class='add'>+		} else {</div><div class='add'>+			dev_err(wcd-&gt;dev ,"SLIM_RX%d PORT is busy\n", port_id);</div><div class='add'>+			return 0;</div><div class='add'>+		}</div><div class='ctx'> 		break;</div><div class='add'>+</div><div class='ctx'> 	default:</div><div class='del'>-		dev_err(wcd-&gt;dev, "Unknown AIF %d\n",</div><div class='del'>-			wcd-&gt;rx_port_value[port_id]);</div><div class='add'>+		dev_err(wcd-&gt;dev, "Unknown AIF %d\n", mux_idx);</div><div class='ctx'> 		goto err;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='add'>+	wcd-&gt;rx_port_value[port_id] = mux_idx;</div><div class='ctx'> 	snd_soc_dapm_mux_update_power(w-&gt;dapm, kc, wcd-&gt;rx_port_value[port_id],</div><div class='ctx'> 				      e, update);</div><div class='ctx'> </div><div class='del'>-	return 0;</div><div class='add'>+	return 1;</div><div class='ctx'> err:</div><div class='ctx'> 	return -EINVAL;</div><div class='ctx'> }</div><div class='hunk'>@@ -3815,6 +3856,7 @@ static int slim_tx_mixer_put(struct snd_kcontrol *kc,</div><div class='ctx'> 	struct soc_mixer_control *mixer =</div><div class='ctx'> 			(struct soc_mixer_control *)kc-&gt;private_value;</div><div class='ctx'> 	int enable = ucontrol-&gt;value.integer.value[0];</div><div class='add'>+	struct wcd934x_slim_ch *ch, *c;</div><div class='ctx'> 	int dai_id = widget-&gt;shift;</div><div class='ctx'> 	int port_id = mixer-&gt;shift;</div><div class='ctx'> </div><div class='hunk'>@@ -3822,17 +3864,32 @@ static int slim_tx_mixer_put(struct snd_kcontrol *kc,</div><div class='ctx'> 	if (enable == wcd-&gt;tx_port_value[port_id])</div><div class='ctx'> 		return 0;</div><div class='ctx'> </div><div class='del'>-	wcd-&gt;tx_port_value[port_id] = enable;</div><div class='del'>-</div><div class='del'>-	if (enable)</div><div class='del'>-		list_add_tail(&amp;wcd-&gt;tx_chs[port_id].list,</div><div class='del'>-			      &amp;wcd-&gt;dai[dai_id].slim_ch_list);</div><div class='del'>-	else</div><div class='del'>-		list_del_init(&amp;wcd-&gt;tx_chs[port_id].list);</div><div class='add'>+	if (enable) {</div><div class='add'>+		if (list_empty(&amp;wcd-&gt;tx_chs[port_id].list)) {</div><div class='add'>+			list_add_tail(&amp;wcd-&gt;tx_chs[port_id].list,</div><div class='add'>+				      &amp;wcd-&gt;dai[dai_id].slim_ch_list);</div><div class='add'>+		} else {</div><div class='add'>+			dev_err(wcd-&gt;dev ,"SLIM_TX%d PORT is busy\n", port_id);</div><div class='add'>+			return 0;</div><div class='add'>+		}</div><div class='add'>+	 } else {</div><div class='add'>+		bool found = false;</div><div class='add'>+</div><div class='add'>+		list_for_each_entry_safe(ch, c, &amp;wcd-&gt;dai[dai_id].slim_ch_list, list) {</div><div class='add'>+			if (ch-&gt;port == port_id) {</div><div class='add'>+				found = true;</div><div class='add'>+				list_del_init(&amp;wcd-&gt;tx_chs[port_id].list);</div><div class='add'>+				break;</div><div class='add'>+			}</div><div class='add'>+		}</div><div class='add'>+		if (!found)</div><div class='add'>+			return 0;</div><div class='add'>+	 }</div><div class='ctx'> </div><div class='add'>+	wcd-&gt;tx_port_value[port_id] = enable;</div><div class='ctx'> 	snd_soc_dapm_mixer_update_power(widget-&gt;dapm, kc, enable, update);</div><div class='ctx'> </div><div class='del'>-	return 0;</div><div class='add'>+	return 1;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static const struct snd_kcontrol_new aif1_slim_cap_mixer[] = {</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-10 15:22:10 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
