=== Content from research.splunk.com_d83b5ffd_20250111_144148.html ===

[![Splunk Security Content Logo](https://research.splunk.com/images/logo.svg)](https://research.splunk.com/)

* [Analytic Stories](https://research.splunk.com/stories/)
* [Detections](https://research.splunk.com/detections/)
* [Playbooks](https://research.splunk.com/playbooks/)
* [Data Sources](https://research.splunk.com/sources/)
* [Blog](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)
* [About](http://splunk.com/threat-research)
* [![GitHub Repo](https://research.splunk.com/images/GitHubMarkLight.svg)](https://github.com/splunk/security_content)

## Table of Contents

* + [Description](#description)
  + [Search](#search)
  + [Data Source](#data-source)
  + [Macros Used](#macros-used)
  + [Annotations](#annotations)
  + [Default Configuration](#default-configuration)
  + [Implementation](#implementation)
  + [Known False Positives](#known-false-positives)
  + [Associated Analytic Story](#associated-analytic-story)
  + [Risk Based Analytics (RBA)](#risk-based-analytics-rba)
  + [References](#references)
  + [Detection Testing](#detection-testing)

# Detection: Splunk Command and Scripting Interpreter Risky Commands

Updated Date: 2024-10-17
ID: 1cf58ae1-9177-40b8-a26c-8966040f11ae
Author: Michael Haag, Splunk
[Type: Hunting](#default-configuration)
[Product: Splunk Enterprise Security](https://www.splunk.com/en_us/products/enterprise-security.html)
### Description

The following analytic identifies the execution of risky commands within the Splunk platform, such as `runshellscript`, `delete`, and `sendemail`. It leverages the Search\_Activity data model to detect ad hoc searches containing these commands, excluding those run by the splunk-system-user. This activity is significant because it may indicate attempts at data exfiltration, deletion, or other unauthorized actions by a malicious user. If confirmed malicious, this could lead to data loss, unauthorized data transfer, or system compromise, severely impacting the organization's security posture.

### Search

```
 1
 2| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Splunk_Audit.Search_Activity where Search_Activity.search IN ("*
 3| runshellscript *", "*
 4| collect *","*
 5| delete *", "*
 6| fit *", "*
 7| outputcsv *", "*
 8| outputlookup *", "*
 9| run *", "*
10| script *", "*
11| sendalert *", "*
12| sendemail *", "*
13| tscolle*") Search_Activity.search_type=adhoc Search_Activity.user!=splunk-system-user by Search_Activity.search Search_Activity.info Search_Activity.total_run_time Search_Activity.user Search_Activity.search_type
14| `drop_dm_object_name(Search_Activity)`
15| `security_content_ctime(firstTime)`
16| `security_content_ctime(lastTime)`
17| `splunk_command_and_scripting_interpreter_risky_commands_filter`

```
### Data Source

| Name | Platform | Sourcetype | Source |
| --- | --- | --- | --- |
| [Splunk](/sources/d8a2c791-460b-4756-a8e5-ecade77b21e3) | Splunk icon [Splunk](/platform/splunk) | `'splunkd_ui_access'` | `'splunkd_ui_access.log'` |

### Macros Used

| Name | Value |
| --- | --- |
| [security\_content\_ctime](https://github.com/splunk/security_content/blob/develop/macros/security_content_ctime.yml) | `convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)` |
| splunk\_command\_and\_scripting\_interpreter\_risky\_commands\_filter | `search *` |

`splunk_command_and_scripting_interpreter_risky_commands_filter` is an empty macro by default. It allows the user to filter out any results (false positives) without editing the SPL.
### Annotations

- MITRE ATT&CK

+ Kill Chain Phases

+ NIST

+ CIS

- Threat Actors

| ID | Technique | Tactic |
| --- | --- | --- |
| [T1059](https://attack.mitre.org/techniques/T1059/) | Command and Scripting Interpreter | Execution |

KillChainPhase.INSTALLATION

NistCategory.DE\_AE

Cis18Value.CIS\_10

APT19
APT32
APT37
APT39
Dragonfly
FIN5
FIN6
FIN7
Fox Kitten
Ke3chang
OilRig
Saint Bear
Stealth Falcon
Whitefly
Windigo
Winter Vivern

### Default Configuration

This detection is configured by default in Splunk Enterprise Security to run with the following settings:

| Setting | Value |
| --- | --- |
| Disabled | true |
| Cron Schedule | `0 * * * *` |
| Earliest Time | `-70m@m` |
| Latest Time | `-10m@m` |
| Schedule Window | `auto` |
| Creates Risk Event | False |

This configuration file applies to all detections of type hunting.
### Implementation

To successfully implement this search acceleration is recommended against the Search\_Activity datamodel that runs against the splunk \_audit index. In addition, this analytic requires the Common Information Model App which includes the Splunk Audit Datamodel <https://splunkbase.splunk.com/app/1621/>. Splunk SOAR customers can find a SOAR workbook that walks an analyst through the process of running these hunting searches in the references list of this detection. In order to use this workbook, a user will need to run a curl command to post the file to their SOAR instance such as "curl -u username:password <https://soar.instance.name/rest/rest/workbook_template> -d @splunk\_psa\_0622.json". A user should then create an empty container or case, attach the workbook, and begin working through the tasks.

### Known False Positives

False positives will be present until properly filtered by Username and search name.

### Associated Analytic Story

* [Splunk Vulnerabilities](/stories/splunk_vulnerabilities/)

### Risk Based Analytics (RBA)

| Risk Message | Risk Score | Impact | Confidence |
| --- | --- | --- | --- |
| A risky Splunk command has ran by $user$ and should be reviewed. | 20 | 50 | 40 |

The Risk Score is calculated by the following formula: Risk Score = (Impact \* Confidence/100). Initial Confidence and Impact is set by the analytic author.
### References

* <https://docs.splunk.com/Documentation/Splunk/latest/Security/SPLsafeguards#Commands_that_trigger_the_warning>
* <https://www.github.com/splunk/security_content/blob/develop/workbooks/splunk_psa_0622.json>
* <https://advisory.splunk.com/advisories/SVD-2024-0302>

### Detection Testing

| Test Type | Status | Dataset | Source | Sourcetype |
| --- | --- | --- | --- | --- |
| Validation | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | N/A | N/A | N/A |
| Unit | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1213/audittrail/audittrail.log) | `audittrail` | `audittrail` |
| Integration | â Passing | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1213/audittrail/audittrail.log) | `audittrail` | `audittrail` |

Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)

---

Source: [GitHub](https://github.com/splunk/security_content/tree/develop/detections/application/splunk_command_and_scripting_interpreter_risky_commands.yml) |
Version: **3**

[Detection: Splunk Code Injection via custom dashboard leading to RCE](https://research.splunk.com/application/b06b41d7-9570-4985-8137-0784f582a1b3/ "Detection: Splunk Code Injection via custom dashboard leading to RCE")

[Detection: Splunk Data exfiltration from Analytics Workspace using sid query](https://research.splunk.com/application/b6d77c6c-f011-4b03-8650-8f10edb7c4a8/ "Detection: Splunk Data exfiltration from Analytics Workspace using sid query")

Â© 2005 - 2024 Splunk LLC All rights reserved.



=== Content from advisory.splunk.com_e1e242a4_20250111_144148.html ===
 [![ ](/assets/img/logo.svg)](https://www.splunk.com/)

* [Home](/)
* [Report a Vulnerability](/report)
* [FAQs](/faqs)
* [Mailing List](https://www.splunk.com/en_us/form/splunk-security-advisories-notification.html)

 Toggle menu

* [Home](/)
* [Report a Vulnerability](/report)
* [FAQs](/faqs)
* [Mailing List](https://www.splunk.com/en_us/form/splunk-security-advisories-notification.html)
# Risky command safeguards bypass in Dashboard Examples Hub

**Advisory ID:** SVD-2024-0302

**CVE ID:** [CVE-2024-29946](https://www.cve.org/CVERecord?id=CVE-2024-29946)

**Published:** 2024-03-27

**Last Update:** 2024-04-09

**CVSSv3.1 Score:** 8.1, High

**CVSSv3.1 Vector:** [CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N)

**CWE:** [CWE-20](https://cwe.mitre.org/data/definitions/20.html)

**Bug ID:** SPL-250341

## Description

In Splunk Enterprise versions below 9.2.1, 9.1.4 and 9.0.9, and Splunk Cloud Platform versions below 9.1.2312.104 and 9.1.2308.205, the Dashboard Examples Hub in the Splunk Dashboard Studio app lacks protections for risky SPL commands, which could allow an attacker to bypass SPL safeguards for risky commands.

The vulnerability requires the attacker to phish the victim by tricking them into initiating a request within their browser (and in the case of Splunk Enterprise, also if Splunk Web is on).

For more information on risky commands and potential impacts, see [SPL safeguards for risky commands](https://docs.splunk.com/Documentation/SplunkCloud/latest/Security/SPLsafeguards).

## Solution

For Splunk Enterprise, upgrade versions to 9.2.1, 9.1.4, 9.0.9, or higher.

For Splunk Cloud Platform, Splunk has put in place a mitigation, and is actively monitoring and rolling out patches across Splunk Cloud Platform instances.

## Product Status

| Product | Version | Component | Affected Version | Fix Version |
| --- | --- | --- | --- | --- |
| Splunk Enterprise | 9.2 | Splunk Dashboard Studio | 9.2.0 to 9.2.0.1 | 9.2.1 |
| Splunk Enterprise | 9.1 | Splunk Dashboard Studio | 9.1.0 to 9.1.3 | 9.1.4 |
| Splunk Enterprise | 9.0 | Splunk Dashboard Studio | 9.0.0 to 9.0.8 | 9.0.9 |
| Splunk Cloud Platform | - | Splunk Dashboard Studio | 9.1.2312.100 to 9.1.2312.103 | 9.1.2312.104 |
| Splunk Cloud Platform | - | Splunk Dashboard Studio | Below 9.1.2308.205 | 9.1.2308.205 |

## Mitigations and Workarounds

On Splunk Cloud Platform only, Splunk implemented network-level changes that fully mitigate the vulnerability.

On Splunk Enterprise only:

You can mitigate the vulnerability by removing the template file for the Splunk Dashboard Studio Examples Hub. This file is located at `$SPLUNK_HOME/etc/apps/splunk-dashboard-studio/appserver/templates/example-hub.html`. This mitigation prevents the Dashboard Examples Hub from rendering.

The vulnerability affects instances with [Splunk Web](https://docs.splunk.com/Documentation/Splunk/latest/Security/DisableunnecessarySplunkcomponents) turned on. You can turn Splunk Web off as a possible workaround. See [Disable unnecessary Splunk Enterprise components](https://docs.splunk.com/Documentation/Splunk/latest/Security/DisableunnecessarySplunkcomponents) and the [web.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Webconf) configuration specification file for more information on turning Splunk Web off.

The Splunk-built Splunk Dashboard Studio app comes with Splunk Enterprise and uses the Dashboard Examples Hub. You can disable the app as a possible workaround for instances that do not run as Search Heads. See [Manage app and add-on objects - Splunk Documentation](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Managingappobjects) for more information.

**Note:** In Splunk Enterprise versions below 9.2 and Splunk Cloud Platform versions below 9.0.2205, disabling the Splunk Dashboard Studio app disables Dashboard Studio dashboard functionality. In all Splunk Enterprise and Splunk Cloud Platform versions, disabling the Splunk Dashboard Studio app breaks images and icons for Dashboard Studio dashboards and might also cause unintended problems with other Dashboard Studio functionality.

## Detections

* [Splunk Command and Scripting Interpreter Risky Commands](https://research.splunk.com/application/1cf58ae1-9177-40b8-a26c-8966040f11ae/)

## Severity

The severity of this vulnerability varies based on certain conditions.

On Splunk Enterprise:

If the Splunk Enterprise environment meets the conditions that appear in the “Description” section, Splunk rates the vulnerability as High, 8.1, with a CVSSv3.1 Vector of CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N.

If the Splunk Enterprise instance does not run Splunk Web or Splunk Dashboard Studio, there is no impact and the severity is Informational.

On Splunk Cloud Platform:

Splunk implemented network-level changes that fully mitigate the vulnerability. There is no impact and the severity is Informational.

## Changelog

* 2024-04-09: Revised Splunk Cloud fixed version from 9.1.2312.200 to 9.1.2312.104 and added fix version 9.1.2308.205. Clarified Splunk Cloud Platform mitigations. Clarified mitigation of “Disabling Dashboard Studio” because this mitigation may cause unforeseen impact to customer instances. Added mitigation to remove vulnerable template file.
* 2024-04-04: Revised Splunk Cloud fixed version from 9.1.2312.100 to 9.1.2312.200

* Email
* [RSS Feed](/feed.xml)
* [Support](https://login.splunk.com/page/sso_redirect?type=portal)
© 2005 - 2025 Splunk Inc. All rights reserved.[Legal](https://www.splunk.com/en_us/legal.html)     [Privacy     [Website Terms of Use](https://www.splunk.com/en_us/legal/terms/terms-of-use.html)](https://www.splunk.com/en_us/legal/privacy/privacy-policy.html)
