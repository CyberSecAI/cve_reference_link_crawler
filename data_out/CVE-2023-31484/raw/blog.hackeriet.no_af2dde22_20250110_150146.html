<!DOCTYPE html>
<html>
  <head>
<!--    <title>Perl HTTP::Tiny has insecure TLS default, affecting CPAN.pm and other modules â Hackeriet Blog â Ikke akkurat NRK Beta</title> -->
    <title>Perl HTTP::Tiny has insecure TLS default, affecting CPAN.pm and other modules â Hackeriet Blog</title> 

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="UPDATE 2023-06-12: v0.083-TRIAL has been released with a fix.  [CVE-2023-31486] HTTP::Tiny v0.082, is a http client included in Perl (since v5.13.9) and also..." />
    <meta property="og:description" content="UPDATE 2023-06-12: v0.083-TRIAL has been released with a fix.  [CVE-2023-31486] HTTP::Tiny v0.082, is a http client included in Perl (since v5.13.9) and also..." />
    
    <meta name="author" content="Hackeriet Blog" />

    
    <meta property="og:title" content="Perl HTTP::Tiny has insecure TLS default, affecting CPAN.pm and other modules" />
    <meta property="twitter:title" content="Perl HTTP::Tiny has insecure TLS default, affecting CPAN.pm and other modules" />
    


    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Hackeriet Blog - Ikke akkurat NRK Beta" href="/feed.xml" />



    <script type="text/javascript">
     // From https://github.com/odyniec/tinyAgo-js
     function ago(val) {
       val = 0 | (Date.now() - val) / 1000;
       var unit, length = { second: 60, minute: 60, hour: 24, day: 7, week: 4.35,
                            month: 12, year: 10000 }, result;
       for (unit in length) {
         result = val % length[unit];
         if (!(val = 0 | val / length[unit]))
           return result + ' ' + (result-1 ? unit + 's' : unit);
       }
     }
     document.addEventListener("DOMContentLoaded", function(event) {
       let times = document.getElementsByClassName('ago')
       for (let t of times) {
         let datetime = t.getAttribute('datetime')
         if (!datetime) continue;
         let date = new Date(datetime);
         t.innerHTML = "&middot; " + ago(date) + " ago"
       }
     });


      </script>
    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="/images/hackeriet-logo.png" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Hackeriet Blog</a></h1>
            <p class="site-description">Ikke akkurat NRK Beta</p>
          </div>

          <nav>
<!--            <a href="/">Blog</a> --> 
            <a href="http://hackeriet.no/">About</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <h1>Perl HTTP::Tiny has insecure TLS default, affecting CPAN.pm and other modules</h1>
  <div class="author">
      15/04/23 â sgo
  </div>

  <div class="entry">
    <p><strong>UPDATE 2023-06-12:</strong> <a href="https://metacpan.org/release/DAGOLDEN/HTTP-Tiny-0.083-TRIAL/">v0.083-TRIAL</a> has been released with a fix.</p>

<p>[CVE-2023-31486] <a href="https://metacpan.org/pod/HTTP::Tiny">HTTP::Tiny</a> v0.082, is a http client included in
Perl (since v5.13.9) and also a standalone CPAN module. It <a href="https://metacpan.org/pod/HTTP::Tiny#SSL-SUPPORT">does not verify TLS
certificates by default</a> requiring users to opt-in with the <code class="language-plaintext highlighter-rouge">verify_SSL=&gt;1</code> flag to verify the identity of the HTTPS server they are communicating with.</p>

<p>The module is used by
<a href="https://hackeriet.github.io/cpan-http-tiny-overview/">many</a> distributions on
CPAN, and likely other open source and proprietary software.</p>

<blockquote>
  <p><strong>NOTE:</strong> This post summarizes security problems caused by the insecure default
and how it affects code relying on it for https. For a
discussion on how this is being addressed upstream, please see
<a href="https://github.com/chansen/p5-http-tiny/issues/152">RFC: Making SSL_verify safer</a></p>
</blockquote>

<h2 id="affected-cpan-modules">Affected CPAN Modules</h2>

<p>After 
<a href="https://www.reddit.com/r/perl/comments/111tadi/psa_httptiny_disabled_ssl_verification_by_default/">PSA: HTTP::Tiny disabled SSL verification by
default!</a> was posted on Reddit, we were reminded that this might be a bigger problem than first thought.</p>

<p>So we searched trough
<a href="https://github.com/metacpan/metacpan-cpan-extracted">metacpan-cpan-extracted</a>
to find distributions using HTTP::Tiny without specifying the cert verification
behaviour. Distros using it without mentioning <code class="language-plaintext highlighter-rouge">verify_SSL</code> somewhere in the code was flagged. See <a href="https://hackeriet.github.io/cpan-http-tiny-overview/">hackeriet.github.io/cpan-http-tiny-overview</a> for the full list.</p>

<p>Most distributions we found did not enable the certificate verification feature, potentially exposing users to <a href="https://www.internetsociety.org/resources/doc/2020/fact-sheet-machine-in-the-middle-attacks/Machine-in-the-middle">machine-in-the-middle</a> attacks via a <a href="https://cwe.mitre.org/data/definitions/295.html">CWE-295: Improper Certificate Validation</a> weakness.</p>

<ul>
  <li>[CVE-2023-31484] <a href="https://metacpan.org/pod/CPAN">CPAN.pm</a> v2.34 downloads and executes code from
<code class="language-plaintext highlighter-rouge">https://cpan.org</code> without verifying server certs. Fixed in <a href="https://metacpan.org/release/ANDK/CPAN-2.35-TRIAL">v2.35-TRIAL</a>.
(<a href="https://github.com/andk/cpanpm/commit/9c98370287f4e709924aee7c58ef21c85289a7f0">patch</a>)</li>
  <li>[CVE-2023-31485] <a href="https://metacpan.org/dist/GitLab-API-v4">GitLab::API::v4</a> v0.26 exposes API
secrets to a network attacker. Fixed in <a href="https://metacpan.org/release/BLUEFEET/GitLab-API-v4-0.27">v0.27</a>
(<a href="https://github.com/bluefeet/GitLab-API-v4/pull/57">patch</a>)</li>
  <li><a href="https://metacpan.org/dist/Finance-Robinhood">Finance::Robinhood</a> v0.21 is
maybe exposing API secrets and financial information to a network
attacker. (<a href="https://github.com/sanko/Finance-Robinhood/pull/6">patch</a>)</li>
  <li><a href="https://metacpan.org/pod/Paws">Paws (aws-sdk-perl)</a> v0.44 is
maybe exposing API secrets to a network attacker. (<a href="https://github.com/pplu/aws-sdk-perl/pull/426">patch</a>)</li>
  <li><a href="https://metacpan.org/pod/CloudHealth::API">CloudHealth::API</a> v0.01 is maybe
exposing API secrets to a network attacker.
(<a href="https://github.com/pplu/cloudhealth-api-perl/pull/2">patch</a>)</li>
</ul>

<p>â¦ and more. We have done a search of CPAN and generated a list of <a href="https://hackeriet.github.io/cpan-http-tiny-overview/">381 potentially problematic distributions</a>.</p>

<h2 id="mitigations">Mitigations</h2>

<p><del>Upstream for <code class="language-plaintext highlighter-rouge">HTTP::Tiny</code> has not provided a patch or mitigation. Suggestions to change the insecure default has been turned down several times over the years due to backwards compatibility concerns</del>.</p>

<p>Upstream for <code class="language-plaintext highlighter-rouge">HTTP::Tiny</code> has <a href="https://github.com/chansen/p5-http-tiny/pull/153">merged a patch</a> that changes the insecure default from <code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">1</code>. It is available in the development version <a href="https://metacpan.org/release/DAGOLDEN/HTTP-Tiny-0.083-TRIAL/">HTTP::Tiny v0.083-TRIAL</a> on CPAN, and the change is <a href="https://blogs.perl.org/users/psc/2023/06/this-week-in-psc-109.html">planned to be included in perl-5.38.0</a>.</p>

<blockquote>
  <p>An escape hatch environment variable <code class="language-plaintext highlighter-rouge">PERL_HTTP_TINY_SSL_INSECURE_BY_DEFAULT=1</code> has been provided for users who need to restore the previous insecure default after updating.</p>
</blockquote>

<p>For additional information, please see the upstream discussion in <a href="https://github.com/chansen/p5-http-tiny/issues/152">RFC: Making SSL_verify safer</a>.</p>

<p>To mitigate the risk caused by the <a href="https://cwe.mitre.org/data/definitions/1188.html">CWE-1188: Insecure Default Initialization of Resource</a> weakness, you have some options:</p>

<ul>
  <li>
    <p>Ensure that <code class="language-plaintext highlighter-rouge">HTTP::Tiny</code> in your include path is <a href="https://metacpan.org/release/DAGOLDEN/HTTP-Tiny-0.083-TRIAL/">v0.083-TRIAL</a> or newer.</p>
  </li>
  <li>
    <p>Modify affected code using <code class="language-plaintext highlighter-rouge">HTTP::Tiny</code> and set <code class="language-plaintext highlighter-rouge">verify_SSL=&gt;1</code>.</p>
  </li>
  <li>
    <p>Modify affected code to use a http client with secure defaults, like
<code class="language-plaintext highlighter-rouge">Mojo::UserAgent</code> or <code class="language-plaintext highlighter-rouge">LWP::UserAgent</code>.</p>
  </li>
  <li>
    <p>Patch <code class="language-plaintext highlighter-rouge">HTTP::Tiny</code> on your system with <a href="https://github.com/chansen/p5-http-tiny/commit/77f557ef84698efeb6eed04e4a9704eaf85b741d.patch">a patch</a> that changes the default to <code class="language-plaintext highlighter-rouge">verify_SSL=&gt;1</code>.</p>
  </li>
</ul>

<blockquote>
  <p>Itâs recommended that users update <a href="https://metacpan.org/pod/Mozilla::CA">Mozilla::CA</a> as well, since <code class="language-plaintext highlighter-rouge">HTTP::Tiny</code> defaults to trusting certificates provided by that module. Alternatively the environment variable <code class="language-plaintext highlighter-rouge">SSL_CERT_FILE</code> can be set to point to the system trust store.</p>
</blockquote>

<h2 id="links">Links</h2>
<ul>
  <li><a href="https://github.com/chansen/p5-http-tiny/pull/153">chansen/p5-http-tiny: Change verify_SSL default to 1, add ENV var to enable insecure default [CVE-2023-31486] #153</a></li>
  <li><a href="https://github.com/chansen/p5-http-tiny/issues/152">chansen/p5-http-tiny: RFC: Making SSL_verify  safer #152</a></li>
  <li><a href="https://github.com/chansen/p5-http-tiny/pull/151">chansen/p5-http-tiny: SSL environment controls, and warn about insecure connections #151</a></li>
  <li><a href="https://hackeriet.github.io/cpan-http-tiny-overview/">hackeriet: cpan-http-tiny-overview</a></li>
  <li><a href="https://www.reddit.com/r/perl/comments/111tadi/psa_httptiny_disabled_ssl_verification_by_default/">reddit: PSA: HTTP::Tiny disabled SSL verification by default!</a></li>
  <li><a href="https://github.com/NixOS/nixpkgs/pull/187480">NixOS/nixpkgs: perl: verify_SSL=&gt;1 by default in HTTP::Tiny #187480</a></li>
  <li><a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=962407">Debian Bug #962407: libhttp-tiny-perl: Default to verifying SSL certificates</a></li>
  <li><a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=954089">Debian Bug #954089: perl: Default HTTP::Tiny to verifying SSL certificates</a></li>
  <li><a href="https://salsa.debian.org/perl-team/interpreter/perl/-/commit/1490431e40e22052f75a0b3449f1f53cbd27ba92.patch">Debian Proposed Patch: [PATCH] Enable SSL by default in HTTP::Tiny</a></li>
  <li><a href="https://github.com/chansen/p5-http-tiny/issues/134">chansen/p5-http-tiny: verify_SSL being true by default (redux) #134</a></li>
  <li><a href="https://github.com/chansen/p5-http-tiny/issues/68">chansen/p5-http-tiny: Shouldnât verify_SSL be true by default? #68</a></li>
</ul>

<h2 id="changes">Changes</h2>
<ul>
  <li>2023-04-18: Add reference to fixed CPAN.pm v2.35-TRIAL</li>
  <li>2023-04-29: Add CVE identifiers CVE-2023-31484, CVE-2023-31485, CVE-2023-31486</li>
  <li>2023-06-12: Add references to fix applied to HTTP::Tiny, GitLab::API::v4, and suggestion to update Mozilla::CA</li>
</ul>


  </div>

  
</article>

    </div>

    
    

    

    

    

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          

<a href="https://www.facebook.com/hackeriet"><i class="svg-icon facebook"></i></a>

<a href="https://github.com/hackeriet"><i class="svg-icon github"></i></a>



<a href="/feed.xml"><i class="svg-icon rss"></i></a>
<a href="https://www.twitter.com/hackeriet"><i class="svg-icon twitter"></i></a>



        </footer>
      </div>
    </div>

    

  </body>
</html>
