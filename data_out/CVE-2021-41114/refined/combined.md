=== Content from github.com_126fade3_20250108_140032.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fcommit%2F5cbff85506cebe343e5ae59228977547cf8e3cf4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fcommit%2F5cbff85506cebe343e5ae59228977547cf8e3cf4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=TYPO3%2Ftypo3)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TYPO3](/TYPO3)
/
**[typo3](/TYPO3/typo3)**
Public

* [Notifications](/login?return_to=%2FTYPO3%2Ftypo3) You must be signed in to change notification settings
* [Fork
  673](/login?return_to=%2FTYPO3%2Ftypo3)
* [Star
   1.1k](/login?return_to=%2FTYPO3%2Ftypo3)

* [Code](/TYPO3/typo3)
* [Pull requests
  0](/TYPO3/typo3/pulls)
* [Actions](/TYPO3/typo3/actions)
* [Projects
  0](/TYPO3/typo3/projects)
* [Security](/TYPO3/typo3/security)
* [Insights](/TYPO3/typo3/pulse)

Additional navigation options

* [Code](/TYPO3/typo3)
* [Pull requests](/TYPO3/typo3/pulls)
* [Actions](/TYPO3/typo3/actions)
* [Projects](/TYPO3/typo3/projects)
* [Security](/TYPO3/typo3/security)
* [Insights](/TYPO3/typo3/pulse)

## Commit

[Permalink](/TYPO3/typo3/commit/5cbff85506cebe343e5ae59228977547cf8e3cf4)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[SECURITY] Verify HTTP\_HOST via FE/BE middleware

[Browse files](/TYPO3/typo3/tree/5cbff85506cebe343e5ae59228977547cf8e3cf4)
Browse the repository at this point in the history

```
Avoid a dependency cycle between HTTP_HOST generation
and verification.
As $GLOBALS['TYPO3_REQUEST'] is not available
during ServerRequestFactory::fromGlobals(), HTTP_HOST
verification can not be performed at that point.
It is therefore delayed into a context aware middleware
instead of being skipped because of missing $GLOBALS.

Positive advantage of moving the verification into
frontend and backend middlewares, is that context
checks to exclude CLI/installtool can be dropped.

As a side effect this also fixes the frontend to installtool
redirect if TYPO3 is not yet configured and running with
an invalid SERVER_NAME, as ServerRequestFactory::fromGlobals()
doesn't fail.

Releases: master
Resolves: #95395
Change-Id: Idd3a3449a878cd625dad0d04892d9f0e710ca1a9
Security-Bulletin: TYPO3-CORE-SA-2021-015
Security-References: [CVE-2021-41114](https://github.com/advisories/GHSA-m2jh-fxw4-gphm "CVE-2021-41114")
Reviewed-on: [https://review.typo3.org/c/Packages/TYPO3.CMS/+/71438](https://review.typo3.org/c/Packages/TYPO3.CMS/%2B/71438)
Tested-by: Oliver Hader <oliver.hader@typo3.org>
Reviewed-by: Oliver Hader <oliver.hader@typo3.org>
```

* Loading branch information

[![@bnf](https://avatars.githubusercontent.com/u/473155?s=40&v=4)](/bnf) [![@ohader](https://avatars.githubusercontent.com/u/402145?s=40&v=4)](/ohader)

[bnf](/TYPO3/typo3/commits?author=bnf "View all commits by bnf")
authored and
[ohader](/TYPO3/typo3/commits?author=ohader "View all commits by ohader")
committed
Oct 5, 2021

1 parent
[fa51999](/TYPO3/typo3/commit/fa51999203c5e5d913ecae5ea843ccb2b95fa33f)

commit 5cbff85

 Show file tree

 Hide file tree

Showing
**17 changed files**
with
**531 additions**
and
**387 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* typo3/sysext

  + backend/Configuration

    - typo3/sysext/backend/Configuration/RequestMiddlewares.php
      [RequestMiddlewares.php](#diff-51a7d71fa68c2bd478ab5f2ef2128597906a021dda382d1b7e63d3a09ec82fe1)
  + core

    - Classes

      * Http

        + typo3/sysext/core/Classes/Http/NormalizedParams.php
          [NormalizedParams.php](#diff-b2d3fe7548e27729d76bd4bab72fe94c6c1c25e3aa642b7c2bccd48e13bd3523)
      * Middleware

        + typo3/sysext/core/Classes/Middleware/VerifyHostHeader.php
          [VerifyHostHeader.php](#diff-ba5ce32cdf6bceb88ff02ec3db9f06032bf87cffeb4775cede505e0d7a8a8819)
      * typo3/sysext/core/Classes/ServiceProvider.php
        [ServiceProvider.php](#diff-f82a537e06577d1574c0d8e4e80519b844f982d1337a965b638bcc18ffecf270)
      * Utility

        + typo3/sysext/core/Classes/Utility/GeneralUtility.php
          [GeneralUtility.php](#diff-ecd93e69fd98828ae7d0d7dd66900a8c0ac22ed8850a5dcba20a2b4d9fd4d8a5)
    - Documentation/Changelog/11.5

      * typo3/sysext/core/Documentation/Changelog/11.5/Deprecation-95395-GeneralUtilityIsAllowedHostHeaderValueAndTrustedHostsPatternConstants.rst
        [Deprecation-95395-GeneralUtilityIsAllowedHostHeaderValueAndTrustedHostsPatternConstants.rst](#diff-e6e72d9d14be4a355551d643d535cc3e0164d65ab5d17b979d3055e22cde2f28)
    - Tests

      * Acceptance/Application/InstallTool

        + typo3/sysext/core/Tests/Acceptance/Application/InstallTool/UpgradeCest.php
          [UpgradeCest.php](#diff-e46467edd79f2c67f00b554a76e552acad004d73865210a76152712fa6fdcc9b)
      * Unit

        + Middleware

          - typo3/sysext/core/Tests/Unit/Middleware/VerifyHostHeaderTest.php
            [VerifyHostHeaderTest.php](#diff-a1dc737a2eb65921debf68a98b7fc31ba5bd053a6e523eeb006783d9e80a7df3)
        + Utility

          - Fixtures

            * typo3/sysext/core/Tests/Unit/Utility/Fixtures/GeneralUtilityFixture.php
              [GeneralUtilityFixture.php](#diff-92739d16665d0c751967f2db0e8202965299c4cafc47e8523597c676f586ab7e)
          - typo3/sysext/core/Tests/Unit/Utility/GeneralUtilityTest.php
            [GeneralUtilityTest.php](#diff-849df2855baaf3e5e0f9bcfcfff6254db71993e0a3e6f879b02dcabb9162e8f3)
  + frontend/Configuration

    - typo3/sysext/frontend/Configuration/RequestMiddlewares.php
      [RequestMiddlewares.php](#diff-4c45fc51854a7376e84e58090b32b459b44e40e5cffc4d39d4bc5a57fba963de)
  + install

    - Classes

      * Controller

        + typo3/sysext/install/Classes/Controller/InstallerController.php
          [InstallerController.php](#diff-eede99b5fae140b7800744a63d79c1c8649a978a5ea581ddff8b2e712d455854)
      * typo3/sysext/install/Classes/ServiceProvider.php
        [ServiceProvider.php](#diff-ea39779803dc649c0d061a79a3328fcb28174dae73548f60667a2eb4f8943286)
      * SystemEnvironment

        + typo3/sysext/install/Classes/SystemEnvironment/SetupCheck.php
          [SetupCheck.php](#diff-73eb6e81bfd024baf81d7fc5e132b9d5bcbed5bba76fb244396a1b8657a5b097)
    - Configuration/ExtensionScanner/Php

      * typo3/sysext/install/Configuration/ExtensionScanner/Php/ClassConstantMatcher.php
        [ClassConstantMatcher.php](#diff-b6e7d615ceb5a24bda90112828b7a6fd2e1d45bf6a4dcfe56ef344e6bfa5c3cf)
      * typo3/sysext/install/Configuration/ExtensionScanner/Php/MethodCallStaticMatcher.php
        [MethodCallStaticMatcher.php](#diff-598150452facb7e21a29e3d759c28061e524a9d5656fbed95969fee63715715d)
  + reports/Classes/Report/Status

    - typo3/sysext/reports/Classes/Report/Status/SecurityStatus.php
      [SecurityStatus.php](#diff-3b68816dcc2a9fe9748cece1a1f101821aa85150f96b53420933f945b6013465)

## There are no files selected for viewing

7 changes: 7 additions & 0 deletions

7
[typo3/sysext/backend/Configuration/RequestMiddlewares.php](#diff-51a7d71fa68c2bd478ab5f2ef2128597906a021dda382d1b7e63d3a09ec82fe1 "typo3/sysext/backend/Configuration/RequestMiddlewares.php")

Show comments

[View file](/TYPO3/typo3/blob/5cbff85506cebe343e5ae59228977547cf8e3cf4/typo3/sysext/backend/Configuration/RequestMiddlewares.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,9 +11,16 @@ |
|  |  | \*/ |
|  |  | return [ |
|  |  | 'backend' => [ |
|  |  | /\*\* internal: do not use or reference this middleware in your own code \*/ |
|  |  | 'typo3/cms-core/verify-host-header' => [ |
|  |  | 'target' => \TYPO3\CMS\Core\Middleware\VerifyHostHeader::class, |
|  |  | ], |
|  |  | /\*\* internal: do not use or reference this middleware in your own code \*/ |
|  |  | 'typo3/cms-core/normalized-params-attribute' => [ |
|  |  | 'target' => \TYPO3\CMS\Core\Middleware\NormalizedParamsAttribute::class, |
|  |  | 'after' => [ |
|  |  | 'typo3/cms-core/verify-host-header', |
|  |  | ], |
|  |  | ], |
|  |  | 'typo3/cms-backend/locked-backend' => [ |
|  |  | 'target' => \TYPO3\CMS\Backend\Middleware\LockedBackendGuard::class, |
| Expand Down | |  |

13 changes: 2 additions & 11 deletions

13
[typo3/sysext/core/Classes/Http/NormalizedParams.php](#diff-b2d3fe7548e27729d76bd4bab72fe94c6c1c25e3aa642b7c2bccd48e13bd3523 "typo3/sysext/core/Classes/Http/NormalizedParams.php")

Show comments

[View file](/TYPO3/typo3/blob/5cbff85506cebe343e5ae59228977547cf8e3cf4/typo3/sysext/core/Classes/Http/NormalizedParams.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -548,13 +548,12 @@ public function getQueryString(): string |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Sanitize HTTP\_HOST, take proxy configuration into account and |
|  |  | \* verify allowed hosts with configured trusted hosts pattern. |
|  |  | \* Normalize HTTP\_HOST by taking proxy configuration into account. |
|  |  | \* |
|  |  | \* @param array $serverParams Basically the $\_SERVER, but from $request object |
|  |  | \* @param array $configuration $TYPO3\_CONF\_VARS['SYS'] array |
|  |  | \* @param bool $isBehindReverseProxy True if reverse proxy setup is detected |
|  |  | \* @return string Sanitized HTTP\_HOST |
|  |  | \* @return string Normalized HTTP\_HOST |
|  |  | \*/ |
|  |  | protected static function determineHttpHost( |
|  |  | array $serverParams, |
| Expand Down  Expand Up | | @@ -585,14 +584,6 @@ protected static function determineHttpHost( |
|  |  | $httpHost = $xForwardedHost; |
|  |  | } |
|  |  | } |
|  |  | if (!GeneralUtility::isAllowedHostHeaderValue($httpHost)) { |
|  |  | throw new \UnexpectedValueException( |
|  |  | 'The current host header value does not match the configured trusted hosts pattern!' |
|  |  | . ' Check the pattern defined in $GLOBALS[\'TYPO3\_CONF\_VARS\'][\'SYS\'][\'trustedHostsPattern\']' |
|  |  | . ' and adapt it, if you want to allow the current host header \'' . $httpHost . '\' for your installation.', |
|  |  | 1396795886 |
|  |  | ); |
|  |  | } |
|  |  | return $httpHost; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

126 changes: 126 additions & 0 deletions

126
[typo3/sysext/core/Classes/Middleware/VerifyHostHeader.php](#diff-ba5ce32cdf6bceb88ff02ec3db9f06032bf87cffeb4775cede505e0d7a8a8819 "typo3/sysext/core/Classes/Middleware/VerifyHostHeader.php")

Show comments

[View file](/TYPO3/typo3/blob/5cbff85506cebe343e5ae59228977547cf8e3cf4/typo3/sysext/core/Classes/Middleware/VerifyHostHeader.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,126 @@ |
|  |  | <?php |
|  |  |  |
|  |  | declare(strict\_types=1); |
|  |  |  |
|  |  | /\* |
|  |  | \* This file is part of the TYPO3 CMS project. |
|  |  | \* |
|  |  | \* It is free software; you can redistribute it and/or modify it under |
|  |  | \* the terms of the GNU General Public License, either version 2 |
|  |  | \* of the License, or any later version. |
|  |  | \* |
|  |  | \* For the full copyright and license information, please read the |
|  |  | \* LICENSE.txt file that was distributed with this source code. |
|  |  | \* |
|  |  | \* The TYPO3 project - inspiring people to share! |
|  |  | \*/ |
|  |  |  |
|  |  | namespace TYPO3\CMS\Core\Middleware; |
|  |  |  |
|  |  | use Psr\Http\Message\ResponseInterface; |
|  |  | use Psr\Http\Message\ServerRequestInterface; |
|  |  | use Psr\Http\Server\MiddlewareInterface; |
|  |  | use Psr\Http\Server\RequestHandlerInterface; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Checks if the provided host header value matches the trusted hosts pattern. |
|  |  | \* |
|  |  | \* @internal |
|  |  | \*/ |
|  |  | class VerifyHostHeader implements MiddlewareInterface |
|  |  | { |
|  |  | public const ENV\_TRUSTED\_HOSTS\_PATTERN\_ALLOW\_ALL = '.\*'; |
|  |  | public const ENV\_TRUSTED\_HOSTS\_PATTERN\_SERVER\_NAME = 'SERVER\_NAME'; |
|  |  |  |
|  |  | protected string $trustedHostsPattern; |
|  |  |  |
|  |  | public function \_\_construct(string $trustedHostsPattern) |
|  |  | { |
|  |  | $this->trustedHostsPattern = $trustedHostsPattern; |
|  |  | } |
|  |  |  |
|  |  | public function process(ServerRequestInterface $request, RequestHandlerInterface $handler): ResponseInterface |
|  |  | { |
|  |  | $serverParams = $request->getServerParams(); |
|  |  | $httpHost = $serverParams['HTTP\_HOST'] ?? ''; |
|  |  | if (!$this->isAllowedHostHeaderValue($httpHost, $serverParams)) { |
|  |  | throw new \UnexpectedValueException( |
|  |  | 'The current host header value does not match the configured trusted hosts pattern!' |
|  |  | . ' Check the pattern defined in $GLOBALS[\'TYPO3\_CONF\_VARS\'][\'SYS\'][\'trustedHostsPattern\']' |
|  |  | . ' and adapt it, if you want to allow the current host header \'' . $httpHost . '\' for your installation.', |
|  |  | 1396795884 |
|  |  | ); |
|  |  | } |
|  |  |  |
|  |  | return $handler->handle($request); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Checks if the provided host header value matches the trusted hosts pattern. |
|  |  | \* |
|  |  | \* @param string $hostHeaderValue HTTP\_HOST header value as sent during the request (may include port) |
|  |  | \* @return bool |
|  |  | \*/ |
|  |  | public function isAllowedHostHeaderValue(string $hostHeaderValue, array $serverParams): bool |
|  |  | { |
|  |  | // Deny the value if trusted host patterns is empty, which means configuration is invalid. |
|  |  | if ($this->trustedHostsPattern === '') { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | if ($this->trustedHostsPattern === self::ENV\_TRUSTED\_HOSTS\_PATTERN\_ALLOW\_ALL) { |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | return $this->hostHeaderValueMatchesTrustedHostsPattern($hostHeaderValue, $serverParams); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Checks if the provided host header value matches the trusted hosts pattern without any preprocessing. |
|  |  | \*/ |
|  |  | protected function hostHeaderValueMatchesTrustedHostsPattern(string $hostHeaderValue, array $serverParams): bool |
|  |  | { |
|  |  | if ($this->trustedHostsPattern === self::ENV\_TRUSTED\_HOSTS\_PATTERN\_SERVER\_NAME) { |
|  |  | $host = strtolower($hostHeaderValue); |
|  |  | // Default port to be verified if HTTP\_HOST does not contain explicit port information. |
|  |  | // Deriving from raw/local webserver HTTPS information (not taking possible proxy configurations into account) |
|  |  | // as we compare against the raw/local server information (SERVER\_PORT). |
|  |  | $port = self::webserverUsesHttps($serverParams) ? '443' : '80'; |
|  |  |  |
|  |  | $parsedHostValue = parse\_url('http://' . $host); |
|  |  | if (isset($parsedHostValue['port'])) { |
|  |  | $host = $parsedHostValue['host']; |
|  |  | $port = (string)$parsedHostValue['port']; |
|  |  | } |
|  |  |  |
|  |  | // Allow values that equal the server name |
|  |  | // Note that this is only secure if name base virtual host are configured correctly in the webserver |
|  |  | $hostMatch = $host === strtolower($serverParams['SERVER\_NAME']) && $port === $serverParams['SERVER\_PORT']; |
|  |  | } else { |
|  |  | // In case name based virtual hosts are not possible, we allow setting a trusted host pattern |
|  |  | // See https://typo3.org/teams/security/security-bulletins/typo3-core/typo3-core-sa-2014-001/ for further details |
|  |  | $hostMatch = (bool)preg\_match('/^' . $this->trustedHostsPattern . '$/i', $hostHeaderValue); |
|  |  | } |
|  |  |  |
|  |  | return $hostMatch; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Determine if the webserver uses HTTPS. |
|  |  | \* |
|  |  | \* HEADS UP: This does not check if the client performed a |
|  |  | \* HTTPS request, as possible proxies are not taken into |
|  |  | \* account. It provides raw information about the current |
|  |  | \* webservers configuration only. |
|  |  | \*/ |
|  |  | protected function webserverUsesHttps(array $serverParams): bool |
|  |  | { |
|  |  | if (!empty($serverParams['SSL\_SESSION\_ID'])) { |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | // https://secure.php.net/manual/en/reserved.variables.server.php |
|  |  | // "Set to a non-empty value if the script was queried through the HTTPS protocol." |
|  |  | return !empty($serverParams['HTTPS']) && strtolower($serverParams['HTTPS']) !== 'off'; |
|  |  | } |
|  |  | } |

8 changes: 8 additions & 0 deletions

8
[typo3/sysext/core/Classes/ServiceProvider.php](#diff-f82a537e06577d1574c0d8e4e80519b844f982d1337a965b638bcc18ffecf270 "typo3/sysext/core/Classes/ServiceProvider.php")

Show comments

[View file](/TYPO3/typo3/blob/5cbff85506cebe343e5ae59228977547cf8e3cf4/typo3/sysext/core/Classes/ServiceProvider.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -70,6 +70,7 @@ public function getFactories(): array |
|  |  | Mail\TransportFactory::class => [ static::class, 'getMailTransportFactory' ], |
|  |  | Messaging\FlashMessageService::class => [ static::class, 'getFlashMessageService' ], |
|  |  | Middleware\ResponsePropagation::class => [ static::class, 'getResponsePropagationMiddleware' ], |
|  |  | Middleware\VerifyHostHeader::class => [ static::class, 'getVerifyHostHeaderMiddleware' ], |
|  |  | Package\FailsafePackageManager::class => [ static::class, 'getFailsafePackageManager' ], |
|  |  | Package\Cache\PackageDependentCacheIdentifier::class => [ static::class, 'getPackageDependentCacheIdentifier' ], |
|  |  | Registry::class => [ static::class, 'getRegistry' ], |
| Expand Down  Expand Up | | @@ -369,6 +370,13 @@ public static function getResponsePropagationMiddleware(ContainerInterface $cont |
|  |  | return self::new($container, Middleware\ResponsePropagation::class); |
|  |  | } |
|  |  |  |
|  |  | public static function getVerifyHostHeaderMiddleware(ContainerInterface $container): Middleware\VerifyHostHeader |
|  |  | { |
|  |  | return self::new($container, Middleware\VerifyHostHeader::class, [ |
|  |  | $GLOBALS['TYPO3\_CONF\_VARS']['SYS']['trustedHostsPattern'] ?? '', |
|  |  | ]); |
|  |  | } |
|  |  |  |
|  |  | public static function getFailsafePackageManager(ContainerInterface $container): Package\FailsafePackageManager |
|  |  | { |
|  |  | $packageManager = $container->get(Package\PackageManager::class); |
| Expand Down | |  |

94 changes: 7 additions & 87 deletions

94
[typo3/sysext/core/Classes/Utility/GeneralUtility.php](#diff-ecd93e69fd98828ae7d0d7dd66900a8c0ac22ed8850a5dcba20a2b4d9fd4d8a5 "typo3/sysext/core/Classes/Utility/GeneralUtility.php")

Show comments

[View file](/TYPO3/typo3/blob/5cbff85506cebe343e5ae59228977547cf8e3cf4/typo3/sysext/core/Classes/Utility/GeneralUtility.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,6 +30,7 @@ |
|  |  | use TYPO3\CMS\Core\Http\ApplicationType; |
|  |  | use TYPO3\CMS\Core\Http\RequestFactory; |
|  |  | use TYPO3\CMS\Core\Log\LogManager; |
|  |  | use TYPO3\CMS\Core\Middleware\VerifyHostHeader; |
|  |  | use TYPO3\CMS\Core\Package\Exception as PackageException; |
|  |  | use TYPO3\CMS\Core\SingletonInterface; |
|  |  |  |
| Expand All | | @@ -46,17 +47,11 @@ |
|  |  | \*/ |
|  |  | class GeneralUtility |
|  |  | { |
|  |  | /\* @deprecated since v11, will be removed in v12. \*/ |
|  |  | const ENV\_TRUSTED\_HOSTS\_PATTERN\_ALLOW\_ALL = '.\*'; |
|  |  | /\* @deprecated since v11, will be removed in v12. \*/ |
|  |  | const ENV\_TRUSTED\_HOSTS\_PATTERN\_SERVER\_NAME = 'SERVER\_NAME'; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* State of host header value security check |
|  |  | \* in order to avoid unnecessary multiple checks during one request |
|  |  | \* |
|  |  | \* @var bool |
|  |  | \*/ |
|  |  | protected static $allowHostHeaderValue = false; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @var ContainerInterface|null |
|  |  | \*/ |
| Expand Down  Expand Up | | @@ -2563,12 +2558,6 @@ public static function getIndpEnv($getEnvName) |
|  |  | $retVal = $host; |
|  |  | } |
|  |  | } |
|  |  | if (!static::isAllowedHostHeaderValue($retVal)) { |
|  |  | throw new \UnexpectedValueException( |
|  |  | 'The current host header value does not match the configured trusted hosts pattern! Check the pattern defined in $GLOBALS[\'TYPO3\_CONF\_VARS\'][\'SYS\'][\'trustedHostsPattern\'] and adapt it, if you want to allow the current host header \'' . $retVal . '\' for your installation.', |
|  |  | 1396795884 |
|  |  | ); |
|  |  | } |
|  |  | break; |
|  |  | case 'HTTP\_REFERER': |
|  |  |  |
| Expand Down  Expand Up | | @@ -2695,68 +2684,17 @@ public static function getIndpEnv($getEnvName) |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Checks if the provided host header value matches the trusted hosts pattern. |
|  |  | \* If the pattern is not defined (which only can happen early in the bootstrap), deny any value. |
|  |  | \* The result is saved, so the check needs to be executed only once. |
|  |  | \* |
|  |  | \* @param string $hostHeaderValue HTTP\_HOST header value as sent during the request (may include port) |
|  |  | \* @return bool |
|  |  | \* @deprecated will be removed in TYPO3 v12.0. |
|  |  | \*/ |
|  |  | public static function isAllowedHostHeaderValue($hostHeaderValue) |
|  |  | { |
|  |  | if (static::$allowHostHeaderValue === true) { |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | if (static::isInternalRequestType()) { |
|  |  | return static::$allowHostHeaderValue = true; |
|  |  | } |
|  |  |  |
|  |  | // Deny the value if trusted host patterns is empty, which means we are early in the bootstrap |
|  |  | if (empty($GLOBALS['TYPO3\_CONF\_VARS']['SYS']['trustedHostsPattern'])) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | if ($GLOBALS['TYPO3\_CONF\_VARS']['SYS']['trustedHostsPattern'] === self::ENV\_TRUSTED\_HOSTS\_PATTERN\_ALLOW\_ALL) { |
|  |  | static::$allowHostHeaderValue = true; |
|  |  | } else { |
|  |  | static::$allowHostHeaderValue = static::hostHeaderValueMatchesTrustedHostsPattern($hostHeaderValue); |
|  |  | } |
|  |  |  |
|  |  | return static::$allowHostHeaderValue; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Checks if the provided host header value matches the trusted hosts pattern without any preprocessing. |
|  |  | \* |
|  |  | \* @param string $hostHeaderValue |
|  |  | \* @return bool |
|  |  | \* @internal |
|  |  | \*/ |
|  |  | public static function hostHeaderValueMatchesTrustedHostsPattern($hostHeaderValue) |
|  |  | { |
|  |  | if ($GLOBALS['TYPO3\_CONF\_VARS']['SYS']['trustedHostsPattern'] === self::ENV\_TRUSTED\_HOSTS\_PATTERN\_SERVER\_NAME) { |
|  |  | $host = strtolower($hostHeaderValue); |
|  |  | // Default port to be verified if HTTP\_HOST does not contain explicit port information. |
|  |  | // Deriving from raw/local webserver HTTPS information (not taking possible proxy configurations into account) |
|  |  | // as we compare against the raw/local server information (SERVER\_PORT). |
|  |  | $port = self::webserverUsesHttps() ? '443' : '80'; |
|  |  |  |
|  |  | $parsedHostValue = parse\_url('http://' . $host); |
|  |  | if (isset($parsedHostValue['port'])) { |
|  |  | $host = $parsedHostValue['host']; |
|  |  | $port = (string)$parsedHostValue['port']; |
|  |  | } |
|  |  |  |
|  |  | // Allow values that equal the server name |
|  |  | // Note that this is only secure if name base virtual host are configured correctly in the webserver |
|  |  | $hostMatch = $host === strtolower($\_SERVER['SERVER\_NAME']) && $port === $\_SERVER['SERVER\_PORT']; |
|  |  | } else { |
|  |  | // In case name based virtual hosts are not possible, we allow setting a trusted host pattern |
|  |  | // See https://typo3.org/teams/security/security-bulletins/typo3-core/typo3-core-sa-2014-001/ for further details |
|  |  | $hostMatch = (bool)preg\_match('/^' . $GLOBALS['TYPO3\_CONF\_VARS']['SYS']['trustedHostsPattern'] . '$/i', $hostHeaderValue); |
|  |  | } |
|  |  | trigger\_error('GeneralUtility::isAllowedHostHeaderValue() will be removed in TYPO3 v12.0. Host header is verified by frontend and backend middlewares.', E\_USER\_DEPRECATED); |
|  |  |  |
|  |  | return $hostMatch; |
|  |  | $verifyHostHeader = new VerifyHostHeader($GLOBALS['TYPO3\_CONF\_VARS']['SYS']['trustedHostsPattern'] ?? ''); |
|  |  | return $verifyHostHeader->isAllowedHostHeaderValue($hostHeaderValue, $\_SERVER); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -2780,24 +2718,6 @@ protected static function webserverUsesHttps() |
|  |  | return !empty($\_SERVER['HTTPS']) && strtolower($\_SERVER['HTTPS']) !== 'off'; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Allows internal requests to the install tool and from the command line. |
|  |  | \* We accept this risk to have the install tool always available. |
|  |  | \* Also CLI needs to be allowed as unfortunately AbstractUserAuthentication::getAuthInfoArray() |
|  |  | \* accesses HTTP\_HOST without reason on CLI |
|  |  | \* Additionally, allows requests when no REQUESTTYPE is set, which can happen quite early in the |
|  |  | \* Bootstrap. See Application.php in EXT:backend/Classes/Http/. |
|  |  | \* |
|  |  | \* @return bool |
|  |  | \*/ |
|  |  | protected static function isInternalRequestType() |
|  |  | { |
|  |  | return Environment::isCli() |
|  |  | || !isset($GLOBALS['TYPO3\_REQUEST']) |
|  |  | || !($GLOBALS['TYPO3\_REQUEST'] instanceof ServerRequestInterface) |
|  |  | || (bool)((int)($GLOBALS['TYPO3\_REQUEST'])->getAttribute('applicationType') & TYPO3\_REQUESTTYPE\_INSTALL); |
|  |  | } |
|  |  |  |
|  |  | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
|  |  | \* |
|  |  | \* TYPO3 SPECIFIC FUNCTIONS |
| Expand Down | |  |

53 changes: 53 additions & 0 deletions

53
[...95395-GeneralUtilityIsAllowedHostHeaderValueAndTrustedHostsPatternConstants.rst](#diff-e6e72d9d14be4a355551d643d535cc3e0164d65ab5d17b979d3055e22cde2f28 "typo3/sysext/core/Documentation/Changelog/11.5/Deprecation-95395-GeneralUtilityIsAllowedHostHeaderValueAndTrustedHostsPatternConstants.rst")

Show comments

[View file](/TYPO3/typo3/blob/5cbff85506cebe343e5ae59228977547cf8e3cf4/typo3/sysext/core/Documentation/Changelog/11.5/Deprecation-95395-GeneralUtilityIsAllowedHostHeaderValueAndTrustedHostsPatternConstants.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,53 @@ |
|  |  | .. include:: ../../Includes.txt |
|  |  |  |
|  |  | ==================================================================================================== |
|  |  | Deprecation: #95395 - GeneralUtility::isAllowedHostHeaderValue() and TRUSTED\_HOSTS\_PATTERN constants |
|  |  | ==================================================================================================== |
|  |  |  |
|  |  | See :issue:`95395` |
|  |  |  |
|  |  | Description |
|  |  | =========== |
|  |  |  |
|  |  | The PHP method |
|  |  | :php:`TYPO3\CMS\Core\Utility\GeneralUtility::isAllowedHostHeaderValue()` |
|  |  | and the PHP constants |
|  |  | :php:`TYPO3\CMS\Core\Utility\GeneralUtility::ENV\_TRUSTED\_HOSTS\_PATTERN\_ALLOW\_ALL` |
|  |  | and |
|  |  | :php:`TYPO3\CMS\Core\Utility\GeneralUtility::ENV\_TRUSTED\_HOSTS\_PATTERN\_SERVER\_NAME` |
|  |  | have been deprecated. |
|  |  |  |
|  |  |  |
|  |  | Impact |
|  |  | ====== |
|  |  |  |
|  |  | A deprecation will be logged in TYPO3 v11 if |
|  |  | :php:`TYPO3\CMS\Core\Utility\GeneralUtility::isAllowedHostHeaderValue()` is |
|  |  | used. It is unlikely for extensions to have used this as the host header |
|  |  | is checked for every frontend and backend request anyway. |
|  |  |  |
|  |  | Usage of the constants will cause a PHP error "Undefined class constant" in |
|  |  | TYPO3 v12, the method |
|  |  | :php:`TYPO3\CMS\Core\Utility\GeneralUtility::isAllowedHostHeaderValue()` will be |
|  |  | dropped without replacement. |
|  |  |  |
|  |  |  |
|  |  | Affected Installations |
|  |  | ====================== |
|  |  |  |
|  |  | Installations using the constants instead of static strings or |
|  |  | call the method explictily – which is unlikely. |
|  |  |  |
|  |  |  |
|  |  | Migration |
|  |  | ========= |
|  |  |  |
|  |  | Use :php:`'.\*'` instead of |
|  |  | :php:`TYPO3\CMS\Core\Utility\GeneralUtility::ENV\_TRUSTED\_HOSTS\_PATTERN\_ALLOW\_ALL` |
|  |  | and :php:`'SERVER\_NAME'` instead of |
|  |  | :php:`TYPO3\CMS\Core\Utility\GeneralUtility::ENV\_TRUSTED\_HOSTS\_PATTERN\_SERVER\_NAME`. |
|  |  |  |
|  |  | Don't use :php:`TYPO3\CMS\Core\Utility\GeneralUtility::isAllowedHostHeaderValue()`. |
|  |  |  |
|  |  |  |
|  |  | .. index:: PHP-API, FullyScanned, ext:core |

3 changes: 1 addition & 2 deletions

3
[typo3/sysext/core/Tests/Acceptance/Application/InstallTool/UpgradeCest.php](#diff-e46467edd79f2c67f00b554a76e552acad004d73865210a76152712fa6fdcc9b "typo3/sysext/core/Tests/Acceptance/Application/InstallTool/UpgradeCest.php")

Show comments

[View file](/TYPO3/typo3/blob/5cbff85506cebe343e5ae59228977547cf8e3cf4/typo3/sysext/core/Tests/Acceptance/Application/InstallTool/UpgradeCest.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -85,8 +85,7 @@ public function seeViewUpgradeDocumentation(ApplicationTester $I, ModalDialog $m |
|  |  | $I->click($versionPanel . ' a[data-bs-toggle="collapse"]'); |
|  |  | $I->click($versionPanel . ' .t3js-upgradeDocs-markRead'); |
|  |  |  |
|  |  | $textNewFirstPanelHeading = $I->grabTextFrom($versionPanel . ' .panel-heading'); |
|  |  | $I->assertNotEquals($textCurrentFirstPanelHeading, $textNewFirstPanelHeading); |
|  |  | $I->dontSee($textCurrentFirstPanelHeading, '#version-1'); |
|  |  |  |
|  |  | $I->amGoingTo('mark an item as unread'); |
|  |  | $I->click('#heading-read'); |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `5cbff85`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fcommit%2F5cbff85506cebe343e5ae59228977547cf8e3cf4) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_975d4b8d_20250108_140032.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fsecurity%2Fadvisories%2FGHSA-m2jh-fxw4-gphm)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fsecurity%2Fadvisories%2FGHSA-m2jh-fxw4-gphm)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=TYPO3%2Ftypo3)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TYPO3](/TYPO3)
/
**[typo3](/TYPO3/typo3)**
Public

* [Notifications](/login?return_to=%2FTYPO3%2Ftypo3) You must be signed in to change notification settings
* [Fork
  673](/login?return_to=%2FTYPO3%2Ftypo3)
* [Star
   1.1k](/login?return_to=%2FTYPO3%2Ftypo3)

* [Code](/TYPO3/typo3)
* [Pull requests
  0](/TYPO3/typo3/pulls)
* [Actions](/TYPO3/typo3/actions)
* [Projects
  0](/TYPO3/typo3/projects)
* [Security](/TYPO3/typo3/security)
* [Insights](/TYPO3/typo3/pulse)

Additional navigation options

* [Code](/TYPO3/typo3)
* [Pull requests](/TYPO3/typo3/pulls)
* [Actions](/TYPO3/typo3/actions)
* [Projects](/TYPO3/typo3/projects)
* [Security](/TYPO3/typo3/security)
* [Insights](/TYPO3/typo3/pulse)

# HTTP Host Header Injection in Request Handling

Low

[ohader](/ohader)
published
GHSA-m2jh-fxw4-gphm
Oct 5, 2021

## Package

composer

typo3/cms-core
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

11.0.0-11.4.0

## Patched versions

11.5.0

## Description

> ### Meta
>
> * CVSS: `CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:N/E:F/RL:O/RC:C` (3.5)

### Problem

It has been discovered that TYPO3 CMS is susceptible to host spoofing due to improper validation of the HTTP *Host* header. TYPO3 uses the HTTP *Host* header, for example, to generate absolute URLs during the frontend rendering process. Since the host header itself is provided by the client, it can be forged to any value, even in a name-based virtual hosts environment.

This vulnerability is the same as described in [TYPO3-CORE-SA-2014-001 (CVE-2014-3941)](https://typo3.org/security/advisory/typo3-core-sa-2014-001/). A regression, introduced during TYPO3 v11 development, led to this situation. The already existing setting *$GLOBALS['TYPO3\_CONF\_VARS']['SYS']['trustedHostsPattern']* (used as an effective mitigation strategy in previous TYPO3 versions) was not evaluated anymore, and reintroduced the vulnerability.

### Solution

Update your instance to TYPO3 version 11.5.0 which addresses the problem described.

### Credits

Thanks to TYPO3 framework merger Benjamin Franzke who reported and fixed the issue.

### References

* [TYPO3-CORE-SA-2021-015](https://typo3.org/security/advisory/typo3-core-sa-2021-015)
* [CVE-2014-3941](https://nvd.nist.gov/vuln/detail/CVE-2014-3941) reintroduced in TYPO3 v11.0.0

### Severity

Low

### CVE ID

CVE-2021-41114

### Weaknesses

[CWE-20](/advisories?query=cwe%3A20) [CWE-644](/advisories?query=cwe%3A644)

### Credits

* [![@bnf](https://avatars.githubusercontent.com/u/473155?s=40&v=4)](/bnf)
  [bnf](/bnf)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from typo3.org_1637799b_20250108_140033.html ===


![](//piwik.typo3.org/piwik.php?idsite=2&rec=1)

![](/_assets/a686d4200d36973f64d48f0547522f58/Images/typo3_logo.svg)

[![TYPO3 Logo](/_assets/a686d4200d36973f64d48f0547522f58/Images/Template/typo3_nomargins.svg "Go to the start page")](/ "Go to the start page")

* [TYPO3 CMS](/cms "Open menu for TYPO3 CMS")
  + [Features](/cms/features "TYPO3 delivers flexible fast content powered by an enterprise open-source CMS. It’s backed by a vibrant professional community and commercial ecosystem.")
    - [Smart Content Management](/cms/features/smart-content-management)
    - [Secure Performant Scalable](/cms/features/secure-performant-scalable)
    - [Universal Frontend User Experience](/cms/features/frontend-experience)
    - [Professional Open Source](/cms/features/professional-open-source)
    - [Open Extensible Customizable](/cms/features/open-extensible-customizable)
    - [Digital Marketing Enabled](/cms/features/digital-marketing-enabled)
    - [Massively Multisite Multilingual](/cms/features/massively-multisite-multilingual)
  + [Development Roadmap](/cms/roadmap "The TYPO3 CMS development roadmap follows an 18-month release cycle for Long Term Support versions. ")
    - [TYPO3 Development Roadmap](/cms/roadmap)
    - [Maintenance Releases Schedule](/cms/roadmap/maintenance-releases)
  + [Strategy](/cms/strategy)
  + [Core Development](/community/teams/typo3-development)
  + [Release News](/cms/release-news)
    - [TYPO3 11 Release Notes](/cms/release-news/typo3-11-release-notes)
    - [TYPO3 10 Release Notes](/cms/release-news/typo3-10-release-notes)
    - [TYPO3 9 Release Notes](/cms/release-news/typo3-9-release-notes)
    - [TYPO3 8 Release Notes](/cms/release-news/typo3-8-release-notes)
    - [TYPO3 7 Release Notes](/cms/roadmap/typo3-7-release-notes)
  + [Documentation](/help/documentation)
  + [Comparison Cards](/cms/comparison-cards "Super charge your sales presentations with fact-based comparisons between TYPO3 and other products and features.")
  + [System Requirements](https://get.typo3.org/version/#system-requirements "It doesn't take a degree in engineering to get TYPO3 up an running. Find the facts and figures you need to get started with your first project.")
  + [Download & Install](https://get.typo3.org "To test the TYPO3 Introduction Package on your local computer, download the sources and install the Introduction Package from a distribution.")
  + [Getting Started](https://docs.typo3.org/Home/GettingStarted.html)
  + [Fluid Template Engine](/fluid)
* [Community](/community "Open menu for Community")
  + [Events](/community/events "You can take part in official events organized by the TYPO3 Association, events organized by the TYPO3 community, and events where TYPO3 participates.")
  + [Meet the Community](/community/meet "Online, at events, or in user groups. There are many ways to meet us.")
    - [Communicate: Where and how](/community/meet/communicate)
    - [User Groups](/community/meet/user-groups)
    - [StackOverflow](https://stackoverflow.com/questions/tagged/typo3)
    - [Forum](https://talk.typo3.org)
    - [Chat (Slack)](/community/meet/chat-slack)
    - [how to use Slack](/community/meet/how-to-use-slack-in-the-typo3-community)
    - [Regular Open Sprints](/community/meet/regular-open-sprints)
    - [You, me, and TYPO3!](/community/meet/you-me-and-typo3)
  + [Contribute / Get Involved](/community/contribute)
    - [TYPO3 remote days](/community/contribute/typo3-remote-days)
    - [Become an Association Member](/project/association/membership)
    - [Get your My TYPO3 account](/community/contribute/get-your-typo3org-community-account)
    - [Donate](/community/contribute/donate)
    - [Mentorship](/community/contribute/mentorship)
    - [Community Writers Program](/community/contribute/community-writers)
  + [Teams & Committees](/community/teams "The teams and committees of the TYPO3 community take on tasks within specific areas, such as core development, education, communication and security. ")
    - [TYPO3 Development](/community/teams/typo3-development)
    - [Academic](/community/teams/academic-committee)
    - [Accessibility](/community/teams/accessibility)
    - [Best Practices](/community/teams/best-practices)
    - [Communication Coordination](/community/teams/communication-coordination)
    - [Community Expansion](/community/teams/community-expansion)
    - [Content](/community/teams/content)
    - [Content Types](/community/teams/structured-content)
    - [Documentation](/community/teams/documentation)
    - [Education & Certification](/community/teams/education-certification)
    - [Localization](/community/teams/localization)
    - [Marketing](/community/teams/marketing)
    - [Ombudsperson](/community/teams/ombudsperson)
    - [Security](/community/teams/security)
    - [Server](/community/teams/server-team)
    - [TYPO3 CMS Product Strategy Group](/community/teams/typo3-cms-strategy-group)
    - [typo3.org website](/community/teams/typo3org)
    - [User Experience (UX)](/community/teams/user-experience-ux)
  + [Values and Proceedings](/community/values "TYPO3 is more than just a piece of software. It is a community. Our values guide our work and make sure the community is a great place for everyone.")
    - [Code of Conduct](/community/values/code-of-conduct)
    - [Community Mediation](/community/values/mediation)
    - [Conflict of Interest Policy](/community/values/conflict-of-interest-policy)
    - [Social Media Guidelines](/community/values/social-media-guidelines)
    - [Decision-Making Processes, Contribution and Participation](/community/values/decision-making-processes-contribution-and-participation)
    - [Open Web Manifesto](/community/values/open-web-manifesto)
    - [Policy for Committees & Official Teams](/community/values/policy-for-committees-official-teams)
    - [Usage of Titles](/community/values/usage-of-titles)
    - [Vision, Mission, Purpose](/community/values/vision-mission-purpose/project)
  + [Team Leader Meetings](/community/team-leader-meetings)
  + [Data Protection Corner](/community/dataprotection-corner)
    - [Training for the TYPO3 teams](/community/dataprotection-corner/training-for-the-typo3-teams)
  + [Services](/community/services "Get an overview about our TYPO3 services for our community (Git, trouble ticketsystems, infrastructure, LDAP, OTRS, Gerrit). ")
    - [e-mail-addresses](/community/services/e-mail-addresses)
* [The Project](/project "Open menu for The Project")
  + [News](/project/news "Read the latest news about TYPO3 CMS and the association and community supporting the word's most popular enterprise-level content management system.")
    - [RSS feed](https://typo3.org/rss)
    - [Security Advisories](/help/security-advisories)
    - [This Month in TYPO3](/project/news/this-month-in-typo3)
    - [Podcast](/project/news/podcast)
  + [Our Products](/project/products "TYPO3 CMS is our most important product. Fluid is a templating engine and Surf a deployment tool. They help deliver groundbreaking technology in TYPO3 CMS.")
  + [TYPO3 Association](/project/association "The TYPO3 Association is a not-for-profit membership organization that coordinates and funds the long-term development of the TYPO3 CMS platform. ")
    - [Become a Member](/project/association/membership)
    - [Our Members](/project/association/members)
    - [Structure](/project/association/structure)
    - [Association News](/project/association/association-news)
    - [Partnerships](/project/association/partnerships)
    - [Funding & Finances](/project/association/funding-finances)
    - [General Assembly](/project/association/structure/general-assembly)
    - [By-Laws & proceedings](/project/association/by-laws)
    - [Contact](/project/association/contact)
    - [Association Strategy](/project/association/strategy)
  + [The Brand](/project/brand "Find information about how to use the brand and trademark rules, and learn how (not) to spell “TYPO3”.")
    - [Trademarks](/project/brand/trademarks)
    - [Style Guide](https://styleguide.typo3.com)
    - [TYPO3 slidedeck](/project/brand/typo3-slidedeck)
    - [Spelling TYPO3](/project/brand/spelling-typo3)
  + [History](/project/history "TYPO3 was developed from scratch by Kasper Skårhøj in 1997. Separating design and content was a smart solution to an emerging problem.")
  + [Press](/project/press "The TYPO3 Association is a not-for-profit organization, founded in 2004 to ensure the long-term development of the web-based content management system TYPO3 CMS. ")
    - [Press Releases](/project/press/press-releases)
    - [TYPO3 v9 Release Material](/project/press/typo3-v9-release-material)
    - [TYPO3 v10 Release Material](/project/press/v10-release-material)
    - [TYPO3 v11 Release Material](/project/press/typo3-v11-release-material)
    - [TYPO3 v12 Release Material](/project/press/typo3-v12-release-material)
    - [TYPO3 v13 Release Material](/project/press/typo3-v13-release-material)
  + [Licenses](/project/licenses "TYPO3 products and extensions use GNU General Public License, where you are allowed to sell the extension as long as you do not change the license terms.")
  + [Technology Supporters](/project/technology-supporters "This section is dedicated to our supporters offering their tools and services for free in the scope of open source software.")
* [Certification](https://typo3.com/services/certifications "Open menu for Certification")
* [Help & Support](/help "Open menu for Help & Support")
  + [Documentation](/help/documentation "TYPO3 CMS has more than ten thousand features. Becoming an expert takes time, but the process will be rewarding. Find your topic of interest or introductions.")
    - [Getting Started](https://docs.typo3.org/Home/GettingStarted.html)
    - [Video Tutorials](/help/documentation/video-tutorials)
    - [What's New](/help/documentation/whats-new)
  + [Security Advisories](/help/security-advisories)
    - [TYPO3 CMS](/help/security-advisories/typo3-cms)
    - [TYPO3 Extensions](/help/security-advisories/typo3-extensions)
    - [Public Service Announcements](/help/security-advisories/public-service-announcements)
    - [Security Advisories (RSS Feed)](https://typo3.org/?type=101)
  + [Professional Services](https://typo3.com/partners/professional-service-listing)
  + [Official TYPO3 Forum](https://talk.typo3.org/)
  + [TYPO3 LTS Extended Support](https://typo3.com/products/extended-support)
  + [Stack Overflow](https://stackoverflow.com/search?q=typo3)
* [Search](/search "Open menu for Search")
* [Login](/login "Login with your typo3.org user account")

* [Overview](/cms "Free and open source, TYPO3 CMS is a leading content management system with a feature set eclipsing that of our commercial and proprietary competitors.")
* [Features](/cms/features "TYPO3 delivers flexible fast content powered by an enterprise open-source CMS. It’s backed by a vibrant professional community and commercial ecosystem.")
  [+](/cms/features "TYPO3 delivers flexible fast content powered by an enterprise open-source CMS. It’s backed by a vibrant professional community and commercial ecosystem.")
* [Development Roadmap](/cms/roadmap "The TYPO3 CMS development roadmap follows an 18-month release cycle for Long Term Support versions. ")
  [+](/cms/roadmap "The TYPO3 CMS development roadmap follows an 18-month release cycle for Long Term Support versions. ")
* [Strategy](/cms/strategy)
* [Core Development](/community/teams/typo3-development)
* [Release News](/cms/release-news)
  [+](/cms/release-news)
* [Documentation](/help/documentation)
* [Comparison Cards](/cms/comparison-cards "Super charge your sales presentations with fact-based comparisons between TYPO3 and other products and features.")
* [System Requirements](https://get.typo3.org/version/#system-requirements "It doesn't take a degree in engineering to get TYPO3 up an running. Find the facts and figures you need to get started with your first project.")
* [Download & Install](https://get.typo3.org "To test the TYPO3 Introduction Package on your local computer, download the sources and install the Introduction Package from a distribution.")
* [Getting Started](https://docs.typo3.org/Home/GettingStarted.html)
* [Fluid Template Engine](/fluid)

* [Smart Content Management](/cms/features/smart-content-management "Make your content management smart without depending on IT. Control user rights easily, use the best tools for SEO and DAM and get great results.")
* [Secure Performant Scalable](/cms/features/secure-performant-scalable "Build digital experiences that load fast and perform well at any scale, within a secure and reliable CMS. Handle the whole installation from a central point")
* [Universal Frontend User Experience](/cms/features/frontend-experience "TYPO3 CMS has endless frontend flexibility and a seamless mobile user experience. Use TYPO3 headless as a powerful middleware.")
* [Professional Open Source](/cms/features/professional-open-source "TYPO3’s vibrant professional ecosystem, focus on quality and security, and its strong commercial vendor set the CMS apart from the crowd.
  ")
* [Open Extensible Customizable](/cms/features/open-extensible-customizable "Build the project you need without sacrificing flexibility and enhancement in the future. TYPO3 gives you the freedom and flexibility of open source.")
* [Digital Marketing Enabled](/cms/features/digital-marketing-enabled "Take advantage of TYPO3’s extensions and integration possibilities of all digital marketing solutions – including everything you know and love.")
* [Massively Multisite Multilingual](/cms/features/massively-multisite-multilingual "Use TYPO3 CMS to reach global audiences with multilingual sites, localized content, and smooth translation workflows.")

* [TYPO3 Development Roadmap](/cms/roadmap)
* [Maintenance Releases Schedule](/cms/roadmap/maintenance-releases)

* [TYPO3 11 Release Notes](/cms/release-news/typo3-11-release-notes "Learn more about the main features of TYPO3 version 11.")
* [TYPO3 10 Release Notes](/cms/release-news/typo3-10-release-notes "Learn more about the main features of TYPO3 version 10.")
* [TYPO3 9 Release Notes](/cms/release-news/typo3-9-release-notes)
* [TYPO3 8 Release Notes](/cms/release-news/typo3-8-release-notes)
* [TYPO3 7 Release Notes](/cms/roadmap/typo3-7-release-notes)

![](/fileadmin/_processed_/2/7/csm_typo3-pagetree-screenshot-mock-up_984f8f3795.jpg)

* [TYPO3 Community](/community "The TYPO3 Community is growing, and we do more than just developing software. Everyone is welcome. Offer your skills and contribute to TYPO3.")
* [Events](/community/events "You can take part in official events organized by the TYPO3 Association, events organized by the TYPO3 community, and events where TYPO3 participates.")
* [Meet the Community](/community/meet "Online, at events, or in user groups. There are many ways to meet us.")
  [+](/community/meet "Online, at events, or in user groups. There are many ways to meet us.")
* [Contribute / Get Involved](/community/contribute)
  [+](/community/contribute)
* [Teams & Committees](/community/teams "The teams and committees of the TYPO3 community take on tasks within specific areas, such as core development, education, communication and security. ")
  [+](/community/teams "The teams and committees of the TYPO3 community take on tasks within specific areas, such as core development, education, communication and security. ")
* [Values and Proceedings](/community/values "TYPO3 is more than just a piece of software. It is a community. Our values guide our work and make sure the community is a great place for everyone.")
  [+](/community/values "TYPO3 is more than just a piece of software. It is a community. Our values guide our work and make sure the community is a great place for everyone.")
* [Team Leader Meetings](/community/team-leader-meetings)
* [Data Protection Corner](/community/dataprotection-corner)
  [+](/community/dataprotection-corner)
* [Services](/community/services "Get an overview about our TYPO3 services for our community (Git, trouble ticketsystems, infrastructure, LDAP, OTRS, Gerrit). ")
  [+](/community/services "Get an overview about our TYPO3 services for our community (Git, trouble ticketsystems, infrastructure, LDAP, OTRS, Gerrit). ")

* [Communicate: Where and how](/community/meet/communicate "Get an overview about our communication channels and learn to choose the right communication channel - Slack, Forum, Support, Decisions ...
  ")
* [User Groups](/community/meet/user-groups "Many users would like to get in personal contact with other TYPO3 enthusiasts. This is how local TYPO3 User Groups (TUG) are formed and knowledge happens.")
* [StackOverflow](https://stackoverflow.com/questions/tagged/typo3)
* [Forum](https://talk.typo3.org)
* [Chat (Slack)](/community/meet/chat-slack)
* [how to use Slack](/community/meet/how-to-use-slack-in-the-typo3-community "Find important channels for the TYPO3 community and learn how to get you started.")
* [Regular Open Sprints](/community/meet/regular-open-sprints)
* [You, me, and TYPO3!](/community/meet/you-me-and-typo3 "You, me, and TYPO3 is a fresh take on young people that make our TYPO3 community so unique.")

* [TYPO3 remote days](/community/contribute/typo3-remote-days)
* [Become an Association Member](/project/association/membership)
* [Get your My TYPO3 account](/community/contribute/get-your-typo3org-community-account "Create login for the online services. Find out which are the main services we are providing for our community.")
* [Donate](/community/contribute/donate "TYPO3 is an Open Source project, dependent in large parts on donations. This page is for those who want to donate money")
* [Mentorship](/community/contribute/mentorship "Local web developers and agencies learn how to use TYPO3, a performant, secure, and flexible CMS, for their projects. All through one-on-on mentorship.")
* [Community Writers Program](/community/contribute/community-writers "Join the Community Writers Program to improve your skills and confidence in writing and content marketing to boost TYPO3’s signal and reach new audiences.")

* [TYPO3 Development](/community/teams/typo3-development "The TYPO3 Core Development Team is dedicated to develop and maintain the central parts of TYPO3 CMS.")
* [Academic](/community/teams/academic-committee "The TYPO3 Academic Committee is made up of TYPO3 Association members from universities that use TYPO3-CMS for their homepages. ")
* [Accessibility](/community/teams/accessibility "The Accessibility Team assists to improve and maintain the accessibility in TYPO3. Therefore we share our accessibility expertise with TYPO3 developers.")
* [Best Practices](/community/teams/best-practices "Focusing on establishing and communicating best practices around TYPO3.")
* [Communication Coordination](/community/teams/communication-coordination "The Committee coordinates the communication and marketing of the TYPO3 Company and Association, through a unified workflow and pipeline.")
* [Community Expansion](/community/teams/community-expansion "The TYPO3 Community Expansion Committee (T3CEC) has the goal to foster the use of TYPO3 all over the world. Find out about its Activities on this page.")
* [Content](/community/teams/content "Write, Translate, Proofread. No coding skills are required. You can support us on a regular basis or when you have time.")
* [Content Types](/community/teams/structured-content "Team to build better, native support for custom, semantically
  structured content for TYPO3.
  ")
* [Documentation](/community/teams/documentation "The documentation team provides exhaustive, quality documentation about TYPO3 products for all users, with the help of the community.")
* [Education & Certification](/community/teams/education-certification "The committee is responsible for the TYPO3 education strategy, enabling easy access to learning materials, as well as official certifications.")
* [Localization](/community/teams/localization)
* [Marketing](/community/teams/marketing "Create. Communicate. Contribute.
  Support us with sharing your knowledge and help us to spread the word about TYPO3.")
* [Ombudsperson](/community/teams/ombudsperson "A TYPO3 committee ensuring the wellbeing of everyone in the community through education about and enforcement of the Code of Conduct.")
* [Security](/community/teams/security)
* [Server](/community/teams/server-team "We are in charge of the TYPO3 IT infrastructure. About a dozen core applications are run and managed by our team directly, additionaly we provide services to other teams within the TYPO3 universe for their own use.")
* [TYPO3 CMS Product Strategy Group](/community/teams/typo3-cms-strategy-group)
* [typo3.org website](/community/teams/typo3org "The typo3.org website team develops and maintains the typo3.org website, the Extension Repository, Events and Certification Listings, and much more.")
* [User Experience (UX)](/community/teams/user-experience-ux "The main goal of this team is to work on TYPO3 existing features UX improvments and also to collaborate on building any new feature during the concept process if help is wanted.")

* [Code of Conduct](/community/values/code-of-conduct "Be constructive and considerate, respect other people's boundaries.
  Consider your actions—are they OK?")
* [Community Mediation](/community/values/mediation)
* [Conflict of Interest Policy](/community/values/conflict-of-interest-policy)
* [Social Media Guidelines](/community/values/social-media-guidelines "These are the official guidelines for participating in social media for the TYPO3 Project.")
* [Decision-Making Processes, Contribution and Participation](/community/values/decision-making-processes-contribution-and-participation "This policy outlines the difference between groups, as well describing the decision-making, Contribution and Participation")
* [Open Web Manifesto](/community/values/open-web-manifesto)
* [Policy for Committees & Official Teams](/community/values/policy-for-committees-official-teams "The TYPO3 Association’s Policy for Committees and Official Teams outlines the structure for teams, committees and initiatives. It is describing empowerment and disbanding processes.
  ")
* [Usage of Titles](/community/values/usage-of-titles "Learn how to use an official title within the TYPO3 Community and Association")
* [Vision, Mission, Purpose](/community/values/vision-mission-purpose/project)

* [Training for the TYPO3 teams](/community/dataprotection-corner/training-for-the-typo3-teams)

* [e-mail-addresses](/community/services/e-mail-addresses)

![](/fileadmin/_processed_/4/3/csm_6932872980_d788451b65_o_4e84bb9425.jpg)
### Inspire people to share

Offer your skills and [contribute to the project](/community/contribute). The community is growing and does more than just coding.

* [The TYPO3 Project](/project "TYPO3 CMS is an open source CMS. The project is international and fully community-driven, and the long-term development is managed by the TYPO3 Association.")
* [News](/project/news "Read the latest news about TYPO3 CMS and the association and community supporting the word's most popular enterprise-level content management system.")
  [+](/project/news "Read the latest news about TYPO3 CMS and the association and community supporting the word's most popular enterprise-level content management system.")
* [Our Products](/project/products "TYPO3 CMS is our most important product. Fluid is a templating engine and Surf a deployment tool. They help deliver groundbreaking technology in TYPO3 CMS.")
* [TYPO3 Association](/project/association "The TYPO3 Association is a not-for-profit membership organization that coordinates and funds the long-term development of the TYPO3 CMS platform. ")
  [+](/project/association "The TYPO3 Association is a not-for-profit membership organization that coordinates and funds the long-term development of the TYPO3 CMS platform. ")
* [The Brand](/project/brand "Find information about how to use the brand and trademark rules, and learn how (not) to spell “TYPO3”.")
  [+](/project/brand "Find information about how to use the brand and trademark rules, and learn how (not) to spell “TYPO3”.")
* [History](/project/history "TYPO3 was developed from scratch by Kasper Skårhøj in 1997. Separating design and content was a smart solution to an emerging problem.")
* [Press](/project/press "The TYPO3 Association is a not-for-profit organization, founded in 2004 to ensure the long-term development of the web-based content management system TYPO3 CMS. ")
  [+](/project/press "The TYPO3 Association is a not-for-profit organization, founded in 2004 to ensure the long-term development of the web-based content management system TYPO3 CMS. ")
* [Licenses](/project/licenses "TYPO3 products and extensions use GNU General Public License, where you are allowed to sell the extension as long as you do not change the license terms.")
* [Technology Supporters](/project/technology-supporters "This section is dedicated to our supporters offering their tools and services for free in the scope of open source software.")

* [RSS feed](https://typo3.org/rss)
* [Security Advisories](/help/security-advisories)
* [This Month in TYPO3](/project/news/this-month-in-typo3 "A report of what happened in the TYPO3 community and in the ecosystem in the recent weeks. Enter interesting articles and everything else what might fit.")
* [Podcast](/project/news/podcast "Inside TYPO3 gives you updates, expert insights, and community stories. Available on Spotify, Apple Podcasts, Amazon Music, and YouTube.")

* [Become a Member](/project/association/membership "Members of the TYPO3 Association support the development of TYPO3 CMS and take part in shaping the future of TYPO3 CMS.")
* [Our Members](/project/association/members "This is a list of personal and organizational members of the TYPO3 Association.")
* [Structure](/project/association/structure "The TYPO3 Association has four main bodies: the General Assembly, the Board, the Expert Advisory Board (EAB), and the Business Control Committee (BCC).")
* [Association News](/project/association/association-news "Get the latest news of the TYPO3 Association. Stay up to date and inform yourself about the TYPO3 project.")
* [Partnerships](/project/association/partnerships)
* [Funding & Finances](/project/association/funding-finances "Most of the Association's income comes from membership fees, donations, and events. €650,000 is funneled back into core development and community projects.")
* [General Assembly](/project/association/structure/general-assembly)
* [By-Laws & proceedings](/project/association/by-laws)
* [Contact](/project/association/contact "For general enquiries, coordination, community involvement and sponsorship feel free to contact: info@typo3.org")
* [Association Strategy](/project/association/strategy)

* [Trademarks](/project/brand/trademarks "The word “TYPO3” is one of the trademarks owned by the TYPO3 Association. We have created guidelines to help people understand what is (and is not) OK.")
* [Style Guide](https://styleguide.typo3.com)
* [TYPO3 slidedeck](/project/brand/typo3-slidedeck)
* [Spelling TYPO3](/project/brand/spelling-typo3 "TYPO3 is always written in uppercase, with no spaces. This rule covers all products under the TYPO3 project. URLs are the only exception to this rule.")

* [Press Releases](/project/press/press-releases)
* [TYPO3 v9 Release Material](/project/press/typo3-v9-release-material)
* [TYPO3 v10 Release Material](/project/press/v10-release-material)
* [TYPO3 v11 Release Material](/project/press/typo3-v11-release-material)
* [TYPO3 v12 Release Material](/project/press/typo3-v12-release-material)
* [TYPO3 v13 Release Material](/project/press/typo3-v13-release-material)

![](/fileadmin/_processed_/1/6/csm_26276623101_a436d2f07a_o_270a7b2c42.jpg)
### A Community Effort

TYPO3 CMS is an Open Source project managed by the TYPO3 Association.

[The Project](/project/association)

* [Getting Help & Support](/help "Ask an editor or developer in the community free help with your TYPO3 questions or pay an agency or freelancer to give you the support you need.")
* [Documentation](/help/documentation "TYPO3 CMS has more than ten thousand features. Becoming an expert takes time, but the process will be rewarding. Find your topic of interest or introductions.")
  [+](/help/documentation "TYPO3 CMS has more than ten thousand features. Becoming an expert takes time, but the process will be rewarding. Find your topic of interest or introductions.")
* [Security Advisories](/help/security-advisories)
  [+](/help/security-advisories)
* [Professional Services](https://typo3.com/partners/professional-service-listing)
* [Official TYPO3 Forum](https://talk.typo3.org/)
* [TYPO3 LTS Extended Support](https://typo3.com/products/extended-support)
* [Stack Overflow](https://stackoverflow.com/search?q=typo3)

* [Getting Started](https://docs.typo3.org/Home/GettingStarted.html)
* [Video Tutorials](/help/documentation/video-tutorials)
* [What's New](/help/documentation/whats-new "The TYPO3 CMS What's New Slides summarise new features, significant improvements, important changes and key facts of new TYPO3 releases.")

* [TYPO3 CMS](/help/security-advisories/typo3-cms)
* [TYPO3 Extensions](/help/security-advisories/typo3-extensions)
* [Public Service Announcements](/help/security-advisories/public-service-announcements)
* [Security Advisories (RSS Feed)](https://typo3.org/?type=101)

![](/fileadmin/_processed_/9/c/csm_startup-photos_3680a49e5f.jpg)
### Do you have a question?

[Ask the community](https://talk.typo3.org) or a [professional partner](https://typo3.com/partners/professional-service-listing).

Tue. 5th October, 2021

# TYPO3-CORE-SA-2021-015: HTTP Host Header Injection in Request Handling

Categories:
[Development](/help/security-advisories/development "Development"),

[Security](/help/security-advisories/security "Security")

Created by Oliver Hader

It has been discovered that TYPO3 CMS is vulnerable to HTTP header injection.

* **Component Type:** TYPO3 CMS
* **Subcomponent:** Request Handling (ext:core)
* **Release Date:** October 5, 2021
* **Vulnerability Type:** HTTP Header Injection
* **Affected Versions:** 11.0.0-11.4.0
* **Severity:** Low
* **Suggested CVSS:** [CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:N/E:F/RL:O/RC:C](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:N/E:F/RL:O/RC:C&version=3.1)
* **References:** [CVE-2021-41114](https://nvd.nist.gov/vuln/detail/CVE-2021-41114), [CWE-20](https://cwe.mitre.org/data/definitions/20.html), [CWE-644](https://cwe.mitre.org/data/definitions/644.html)

### Problem Description

It has been discovered that TYPO3 CMS is susceptible to host spoofing due to improper validation of the HTTP *Host* header. TYPO3 uses the HTTP *Host* header, for example, to generate absolute URLs during the frontend rendering process. Since the host header itself is provided by the client, it can be forged to any value, even in a name-based virtual hosts environment.

This vulnerability is the same as described in [TYPO3-CORE-SA-2014-001 (CVE-2014-3941)](https://typo3.org/security/advisory/typo3-core-sa-2014-001/). A regression, introduced during TYPO3 v11 development, led to this situation. The already existing setting *$GLOBALS['TYPO3\_CONF\_VARS']['SYS']['trustedHostsPattern']* (used as an effective mitigation strategy in previous TYPO3 versions) was not evaluated anymore, and reintroduced the vulnerability.

### Solution

Update your instance to TYPO3 version 11.5.0 which addresses the problem described.

### Credits

Thanks to TYPO3 framework merger Benjamin Franzke who reported and fixed the issue.

### General Advice

Follow the recommendations that are given in the [TYPO3 Security Guide](https://docs.typo3.org/typo3cms/CoreApiReference/Security/Index.html#security). Please subscribe to the [typo3-announce](http://lists.typo3.org/cgi-bin/mailman/listinfo/typo3-announce) mailing list.

### General Note

All security related code changes are tagged so that you can easily look them up in our [review system](https://review.typo3.org/#/q/status:merged+project:Packages/TYPO3.CMS+topic:security,n,z).

Ready to get started?

Download TYPO3 CMS for free!

[Download](https://get.typo3.org/)
[Get
more info](https://typo3.org/typo3-cms/overview/)

![TYPO3](/_assets/a686d4200d36973f64d48f0547522f58/Images/Template/typo3_nomargins.svg)

#### Information

* [Decision makers](https://typo3.com/typo3-cms/why-typo3/typo3-for-decision-makers "Why use TYPO3? - Because TYPO3 is the CMS for you!")
* [Users](https://typo3.com/typo3-cms/why-typo3/typo3-for-editing-publishing)
* [Developers](https://typo3.com/typo3-cms/why-typo3/typo3-for-developers)
* [Contact form](/contact)

#### Downloads

* [TYPO3 CMS](https://get.typo3.org "Download and install TYPO3")
* [Extensions for TYPO3](https://extensions.typo3.org "Extend TYPO3 with extensions")

#### Community

* [my.typo3.org](https://my.typo3.org "Log into our community")
* [Slack for TYPO3 community](https://typo3.slack.com "Chat with our community")
* [TYPO3 Code of Conduct](/community/values/code-of-conduct)

#### Popular links

* [Legal Notice](/legal-notice "Legal Notice")
* [TYPO3.com](https://typo3.com "TYPO3.com")
* [TYPO3 Association](/project/association "TYPO3 Association")
* [Privacy Policy](/privacy-policy "Privacy Policy")
* [Social Media Privacy Policy](/social-media-privacy-policy "Social Media Privacy Policy")



=== Content from github.com_567c4cdc_20250108_161527.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-m2jh-fxw4-gphm)

**CVE-2021-41114**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-m2jh-fxw4-gphm)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2021-41114](/advisories/GHSA-m2jh-fxw4-gphm)

## HTTP Host Header Injection

Moderate severity

GitHub Reviewed

Published
Oct 5, 2021
in
[TYPO3/typo3](/TYPO3/typo3)
•
Updated Feb 5, 2024

[Vulnerability details](/advisories/GHSA-m2jh-fxw4-gphm)
[Dependabot alerts
0](/advisories/GHSA-m2jh-fxw4-gphm/dependabot)

## Package

composer

typo3/cms
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

>= 11.0.0, < 11.5.0

## Patched versions

11.5.0

composer

typo3/cms-core
([Composer](/advisories?query=ecosystem%3Acomposer))

>= 11.0.0, < 11.5.0

11.5.0

## Description

### Meta

* CVSS: `CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:N/E:F/RL:O/RC:C` (3.5)

### Problem

It has been discovered that TYPO3 CMS is susceptible to host spoofing due to improper validation of the HTTP *Host* header. TYPO3 uses the HTTP *Host* header, for example, to generate absolute URLs during the frontend rendering process. Since the host header itself is provided by the client, it can be forged to any value, even in a name-based virtual hosts environment.

This vulnerability is the same as described in [TYPO3-CORE-SA-2014-001 (CVE-2014-3941)](https://typo3.org/security/advisory/typo3-core-sa-2014-001/). A regression, introduced during TYPO3 v11 development, led to this situation. The already existing setting *$GLOBALS['TYPO3\_CONF\_VARS']['SYS']['trustedHostsPattern']* (used as an effective mitigation strategy in previous TYPO3 versions) was not evaluated anymore, and reintroduced the vulnerability.

### Solution

Update your instance to TYPO3 version 11.5.0 which addresses the problem described.

### Credits

Thanks to TYPO3 framework merger Benjamin Franzke who reported and fixed the issue.

### References

* [TYPO3-CORE-SA-2021-015](https://typo3.org/security/advisory/typo3-core-sa-2021-015)
* [CVE-2014-3941](https://nvd.nist.gov/vuln/detail/CVE-2014-3941) reintroduced in TYPO3 v11.0.0

### References

* [GHSA-m2jh-fxw4-gphm](https://github.com/TYPO3/typo3/security/advisories/GHSA-m2jh-fxw4-gphm "GHSA-m2jh-fxw4-gphm")
* <https://nvd.nist.gov/vuln/detail/CVE-2014-3941>
* [TYPO3/typo3@5cbff85](https://github.com/TYPO3/typo3/commit/5cbff85506cebe343e5ae59228977547cf8e3cf4)
* <https://typo3.org/security/advisory/typo3-core-sa-2021-015>
* <https://nvd.nist.gov/vuln/detail/CVE-2021-41114>
* <https://github.com/FriendsOfPHP/security-advisories/blob/master/typo3/cms-core/CVE-2021-41114.yaml>
* <https://github.com/FriendsOfPHP/security-advisories/blob/master/typo3/cms/CVE-2021-41114.yaml>

[![@ohader](https://avatars.githubusercontent.com/u/402145?s=40&v=4)](/ohader)
[ohader](/ohader)
published to
[TYPO3/typo3](/TYPO3/typo3/security/advisories/GHSA-m2jh-fxw4-gphm)
Oct 5, 2021

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2021-41114)
Oct 5, 2021

Reviewed
Oct 5, 2021

Published to the GitHub Advisory Database
Oct 5, 2021

Last updated
Feb 5, 2024

### Severity

Moderate

4.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
Low

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:L

### [EPSS score](https://www.first.org/epss/user-guide)

0.086%
 (38th percentile)

### Weaknesses

[CWE-20](/advisories?query=cwe%3A20) [CWE-644](/advisories?query=cwe%3A644)

### CVE ID

CVE-2021-41114

### GHSA ID

GHSA-m2jh-fxw4-gphm

### Source code

[TYPO3/typo3](https://github.com/TYPO3/typo3)

### Credits

* [![@bnf](https://avatars.githubusercontent.com/u/473155?s=40&v=4)](/bnf)
  [bnf](/bnf)
  Analyst

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-m2jh-fxw4-gphm/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


