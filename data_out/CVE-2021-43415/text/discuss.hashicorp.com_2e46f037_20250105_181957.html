

![HashiCorp Discuss](data:image/svg;base64...)
Loading

[HashiCorp Discuss](/)

# [HCSEC-2021-31 - Nomad QEMU Task Driver Allowed Paths Bypass with Job Args](/t/hcsec-2021-31-nomad-qemu-task-driver-allowed-paths-bypass-with-job-args/32288)

[Security](/c/security/52)

[security-nomad](https://discuss.hashicorp.com/tag/security-nomad)

[jfinnigan](https://discuss.hashicorp.com/u/jfinnigan)

November 23, 2021, 1:47am

1

**Bulletin ID:** HCSEC-2021-31

**Affected Products / Versions:** Nomad and Nomad Enterprise up to 1.0.13, 1.1.7, and 1.2.0; fixed in 1.0.14, 1.1.8, and 1.2.1.

**Publication Date:** November 22, 2021

**Summary**

Nomad and Nomad Enterprise (“Nomad”), with the QEMU task driver enabled, allowed authenticated users with job submission capabilities to bypass the configured allowed paths for images. This vulnerability, CVE-2021-43415, was fixed in Nomad 1.0.14, 1.1.8, and 1.2.1.

**Background**

Nomad provides first-class support for the [QEMU task driver](https://www.nomadproject.io/docs/drivers/qemu) to run virtual machines, which has a client agent configuration option to restrict the allowed [image paths](https://www.nomadproject.io/docs/drivers/qemu#image_paths) that can be used in a job, preventing arbitrary access to the underlying host filesystem.

**Details**

An external party reported that a Nomad job using the QEMU task driver could be crafted to bypass intended restrictions on the source of the image on the host by using QEMUs `-drive` CLI flag as an argument in the submitted job.

On investigation, the issue described was found to present possible additional exposure, as the QEMU task driver’s args may facilitate further access to resources on the host. To address this, Nomad’s QEMU task driver configuration logic has been modified to provide an operator with increased control over access to host resources, restricting the QEMU CLI flags available to a job submitter with a new `args_allowlist` option.

**Remediation**

Customers using Nomad’s QEMU task driver should evaluate the risk associated with this issue and consider upgrading to Nomad or Nomad Enterprise 1.0.14, 1.1.8, and 1.2.1, or newer. Please refer to [Upgrading Nomad](https://www.nomadproject.io/docs/upgrade) for general guidance and version-specific upgrade notes.

After upgrading, operators will need to configure client agents with the new [args\_allowlist](https://www.nomadproject.io/docs/drivers/qemu#args_allowlist) option, permitting only the QEMU CLI flags necessary for their environment. For example:

```
plugin "qemu" {
  config {
    image_paths = ["/mnt/image/paths"]
    args_allowlist = ["-drive", "-usbdevice"]
  }
}

```

Alternatively, the QEMU task driver may be disabled using the the following client agent configuration snippet:

```
plugin "qemu" {
enabled = false
}

```

**Acknowledgement**

This issue was identified by an external party who reported it to HashiCorp.

*We deeply appreciate any effort to coordinate disclosure of security vulnerabilities. For information about security at HashiCorp and the reporting of security vulnerabilities, please see [Security at HashiCorp](https://hashicorp.com/security).*

### Related topics

| Topic |  | Replies | Views | Activity |
| --- | --- | --- | --- | --- |
| [Nomad 1.2.1, 1.1.8, and 1.0.14 Released](https://discuss.hashicorp.com/t/nomad-1-2-1-1-1-8-and-1-0-14-released/32262)  [Release Notifications](/c/release-notifications/57) [nomad-release](https://discuss.hashicorp.com/tag/nomad-release) | 0 | 407 | November 22, 2021 |
| [HCSEC-2021-01 - Nomad’s Exec and Java Task Drivers Did Not Isolate Processes](https://discuss.hashicorp.com/t/hcsec-2021-01-nomad-s-exec-and-java-task-drivers-did-not-isolate-processes/20332)  [Security](/c/security/52) [security-nomad](https://discuss.hashicorp.com/tag/security-nomad) | 0 | 7301 | January 29, 2021 |
| [HCSEC-2022-14 - Nomad Impacted by go-getter Vulnerabilities](https://discuss.hashicorp.com/t/hcsec-2022-14-nomad-impacted-by-go-getter-vulnerabilities/39932)  [Security](/c/security/52) [security-nomad](https://discuss.hashicorp.com/tag/security-nomad) | 0 | 6839 | May 24, 2022 |
| [HCSEC-2020-21 - Nomad File Sandbox Escape via Template and Artifact Stanzas](https://discuss.hashicorp.com/t/hcsec-2020-21-nomad-file-sandbox-escape-via-template-and-artifact-stanzas/18106)  [Security](/c/security/52) [security-nomad](https://discuss.hashicorp.com/tag/security-nomad) | 0 | 4244 | November 25, 2020 |
| [HCSEC-2020-23 - Nomad File Sandbox Escape via Container Volume Mount](https://discuss.hashicorp.com/t/hcsec-2020-23-nomad-file-sandbox-escape-via-container-volume-mount/18108)  [Security](/c/security/52) [security-nomad](https://discuss.hashicorp.com/tag/security-nomad) | 0 | 4337 | November 25, 2020 |

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](/tos)
* [Privacy Policy](https://meta.discourse.org/privacy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled

