=== Content from github.com_cea7e50a_20250110_211954.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffranciscop%2Ftranslate%2Fcommit%2Fcc1ba03078102f83e0503a96f1a081489bb865d3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffranciscop%2Ftranslate%2Fcommit%2Fcc1ba03078102f83e0503a96f1a081489bb865d3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=franciscop%2Ftranslate)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[franciscop](/franciscop)
/
**[translate](/franciscop/translate)**
Public

* [Notifications](/login?return_to=%2Ffranciscop%2Ftranslate) You must be signed in to change notification settings
* [Fork
  45](/login?return_to=%2Ffranciscop%2Ftranslate)
* [Star
   292](/login?return_to=%2Ffranciscop%2Ftranslate)

* [Code](/franciscop/translate)
* [Issues
  1](/franciscop/translate/issues)
* [Pull requests
  0](/franciscop/translate/pulls)
* [Actions](/franciscop/translate/actions)
* [Security](/franciscop/translate/security)
* [Insights](/franciscop/translate/pulse)

Additional navigation options

* [Code](/franciscop/translate)
* [Issues](/franciscop/translate/issues)
* [Pull requests](/franciscop/translate/pulls)
* [Actions](/franciscop/translate/actions)
* [Security](/franciscop/translate/security)
* [Insights](/franciscop/translate/pulse)

## Commit

[Permalink](/franciscop/translate/commit/cc1ba03078102f83e0503a96f1a081489bb865d3)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Made the usage options much simpler so that there's no chance of writ…

[Browse files](/franciscop/translate/tree/cc1ba03078102f83e0503a96f1a081489bb865d3)
Browse the repository at this point in the history

```
…ing runtime vulnerabilities. Favored instances. Fixed types
```

* Loading branch information

[![@franciscop](https://avatars.githubusercontent.com/u/2801252?s=40&v=4)](/franciscop)

[franciscop](/franciscop/translate/commits?author=franciscop "View all commits by franciscop")
committed
Mar 21, 2024

1 parent
[7a2bf8b](/franciscop/translate/commit/7a2bf8b9f05f7c45c09683973ef4d8e995804aa4)

commit cc1ba03

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**173 additions**
and
**63 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* README.md
  [README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5)
* index.d.ts
  [index.d.ts](#diff-7aa4473ede4abd9ec099e87fec67fd57afafaf39e05d493ab4533acc38547eb8)
* index.min.js
  [index.min.js](#diff-4756d91bf214842c0bd331fa1076eea263df7ed4c8ce892e23ff0fb4316f5b16)
* src

  + src/index.js
    [index.js](#diff-bfe9874d239014961b1ae4e89875a6155667db834a410aaaa2ebe3cf89820556)
* test

  + test/index.types.ts
    [index.types.ts](#diff-4ef368eb6ffed4517e8d50a750b4b43ff586aa372e8cf889a3423f61a4547091)

## There are no files selected for viewing

80 changes: 47 additions & 33 deletions

80
[README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5 "README.md")

Show comments

[View file](/franciscop/translate/blob/cc1ba03078102f83e0503a96f1a081489bb865d3/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -32,7 +32,7 @@ Alternatively for the browser you can use [Jsdelivr \*\*CDN\*\*](https://www.jsdeliv |
|  |  | ```html |
|  |  | <script |
|  |  | type="module" |
|  |  | src="https://cdn.jsdelivr.net/npm/translate@2/index.min.js" |
|  |  | src="https://cdn.jsdelivr.net/npm/translate/index.min.js" |
|  |  | ></script> |
|  |  | ``` |
|  |  |  |
| Expand All | | @@ -43,7 +43,7 @@ translate.engine = "deepl"; // "google", "yandex", "libre", "deepl" |
|  |  | translate.key = process.env.DEEPL\_KEY; |
|  |  | ``` |
|  |  |  |
|  |  | Then you can finally use it. Putting it all together: |
|  |  | Then you can use it. Putting it all together: |
|  |  |  |
|  |  | ```js |
|  |  | // Omit this line if loading form a CDN |
| Expand All | | @@ -59,18 +59,23 @@ console.log(text); |
|  |  |  |
|  |  | ## Options |
|  |  |  |
|  |  | The first parameter is the \*\*string\*\* that you want to translate. Right now only a single string of text is accepted. |
|  |  | Here is a list of all the options. They all can be set on the root instance like `translate[key] = value` and when creating a new instance `const t = Translate({ ... })`. The function has this signature: |
|  |  |  |
|  |  | The second parameter is the options. It accepts either a `String` of the language to translate \*\*to\*\* or a simple `Object` with the keys `to` and `from`. However, in total there are more options, so here is a list of all of them: |
|  |  | ```js |
|  |  | translate(text: string, to: string): Promise<string> |
|  |  | translate(text: string, { to: string, from: string }): Promise<string> |
|  |  | ``` |
|  |  |  |
|  |  | These are all of the options: |
|  |  |  |
|  |  | - \*\*`to`\*\*: the string of the language to translate to. It can be in any of the two ISO 639 (1 or 2) or the full name in English like `Spanish`. Defaults to \*\*en\*\*. |
|  |  | - \*\*`from`\*\*: the string of the language to translate to. It can be in any of the two ISO 639 (1 or 2) or the full name in English like `Spanish`. Also defaults to \*\*en\*\*. |
|  |  | - \*\*`cache`\*\* [instance]: a `Number` with the milliseconds that each translation should be cached. Leave it undefined to cache it indefinitely (until a server/browser restart). |
|  |  | - \*\*`engine`\*\* [instance]: a `String` containing the name of the engine to use for translation. Right now it defaults to `google`. Read more [in the engine section](#engines). |
|  |  | - \*\*`key`\*\* [instance]: the API Key for the engine of your choice. Read more [in the engine section](#engines). |
|  |  | - \*\*`url`\*\* [instance]: only available for those engines that you can install on your own server (like Libretranslate), allows you to specify a custom endpoint for the translations. [See this issue](https://github.com/franciscop/translate/issues/26#issuecomment-845038821) for more info. |
|  |  | - \*\*`cache`\*\* \\*: a `Number` with the milliseconds that each translation should be cached. Leave it undefined to cache it indefinitely (until a server/browser restart). |
|  |  | - \*\*`engine`\*\* \\* (& `engines`): a `String` containing the name of the engine to use for translation. Right now it defaults to `google`. Read more [in the engine section](#engines). |
|  |  | - \*\*`key`\*\* \\* (& `keys`): the API Key for the engine of your choice. Read more [in the engine section](#engines). |
|  |  | - \*\*`url`\*\* \\*: only available for those engines that you can install on your own server (like Libretranslate), allows you to specify a custom endpoint for the translations. [See this issue](https://github.com/franciscop/translate/issues/26#issuecomment-845038821) for more info. |
|  |  |  |
|  |  | > The options marked as [instance] can only be set to the root `translate.cache = 1000` or when creating a new instance `const myDeepL = translate.Translate()` |
|  |  | > \\* The options marked as can only be set to the root `translate.cache = 1000` or when creating a new instance `const myDeepL = translate.Translate()`, but not as the second parameter. |
|  |  |  |
|  |  | Examples: |
|  |  |  |
| Expand All | | @@ -80,27 +85,43 @@ const foo = await translate("Hello world", "es"); |
|  |  |  |
|  |  | // Same as this: |
|  |  | const bar = await translate("Hello world", { to: "es" }); |
|  |  |  |
|  |  | // INVALID: |
|  |  | const bar = await translate("Hello world", { to: "es", engine: "google" }); |
|  |  | ``` |
|  |  |  |
|  |  | > On both `to` and `from` defaulting to `en`: while I \_am\_ Spanish and was quite tempted to set this as one of those, English is the main language of the Internet and the main secondary language for those who have a different native language. This is why most of the translations will happen either to or from English. |
|  |  |  |
|  |  | ### Default options |
|  |  |  |
|  |  | You can change the default options for anything by calling the root library and the option name: |
|  |  | You can change the options in 3 ways. First, for the simple `from` and `to` options, set them as the second argument: |
|  |  |  |
|  |  | ```js |
|  |  | import translate from "translate"; |
|  |  |  |
|  |  | translate("Hello world", "es"); |
|  |  | translate("Hola mundo", { from: "en", to: "es" }); |
|  |  | ``` |
|  |  |  |
|  |  | You can also change the default options straight on the base instance, which should be common for the shared options such as the API key, engine, etc: |
|  |  |  |
|  |  | ```js |
|  |  | import translate from "translate"; |
|  |  |  |
|  |  | // Configure it, setting the "from" to "Spanish" as default! |
|  |  | translate.from = "es"; |
|  |  | translate.engine = "deepl"; |
|  |  | translate.key = process.env.DEEPL\_KEY; |
|  |  |  |
|  |  | // Use it |
|  |  | await translate("Hola mundo", "ja"); |
|  |  | ``` |
|  |  |  |
|  |  | You can also create a new instance with different default options: |
|  |  | Finally, you can combine multiple instances of Translate, which is useful to have different caches, or use different engines at the same time: |
|  |  |  |
|  |  | ```js |
|  |  | const myLib = translate.Translate({ engine: 'deepl', from: 'es', ... }); |
|  |  | // Import the constructor |
|  |  | import { Translate } from 'translate'; |
|  |  |  |
|  |  | // Create an instance |
|  |  | const myLib = Translate({ engine: 'deepl', from: 'es', ... }); |
|  |  |  |
|  |  | // Use it |
|  |  | await myLib("Hola mundo", "ja" ); |
|  |  | ``` |
|  |  |  |
| Expand All | | @@ -118,7 +139,7 @@ Several translating engines are available to translate your text: |
|  |  | Once you get the API key and if you are only going to be using one engine (very likely), we recommend setting this globally for your whole project: |
|  |  |  |
|  |  | ```js |
|  |  | // ... include translate |
|  |  | import translate from "translate"; |
|  |  |  |
|  |  | translate.engine = "deepl"; |
|  |  | translate.key = "YOUR-KEY-HERE"; |
| Expand All | | @@ -129,7 +150,7 @@ translate.key = "YOUR-KEY-HERE"; |
|  |  | If you are in Node.js, this likely comes from an environment variable: |
|  |  |  |
|  |  | ```js |
|  |  | // ... include translate |
|  |  | import translate from "translate"; |
|  |  |  |
|  |  | translate.engine = "deepl"; |
|  |  | translate.key = process.env.TRANSLATE\_KEY; |
| Expand All | | @@ -140,18 +161,11 @@ translate.key = process.env.TRANSLATE\_KEY; |
|  |  | You can create different instances if you want to combine different engines: |
|  |  |  |
|  |  | ```js |
|  |  | const gTranslate = translate.Translate({ |
|  |  | engine: "google", |
|  |  | key: "YOUR-KEY-HERE", |
|  |  | }); |
|  |  | const dTranslate = translate.Translate({ |
|  |  | engine: "deepl", |
|  |  | key: "YOUR-KEY-HERE", |
|  |  | }); |
|  |  | const lTranslate = translate.Translate({ |
|  |  | engine: "libre", |
|  |  | key: "YOUR-KEY-HERE", |
|  |  | }); |
|  |  | import { Translate } from "translate"; |
|  |  |  |
|  |  | const gTranslate = Translate({ engine: "google", key: "..." }); |
|  |  | const dTranslate = Translate({ engine: "deepl", key: "..." }); |
|  |  | const lTranslate = Translate({ engine: "libre", key: "..." }); |
|  |  | ``` |
|  |  |  |
|  |  | Specifically in Libretranslate, you can also add a `url` parameter if you install it on your own server: |
| Expand All | | @@ -162,7 +176,7 @@ translate.key = process.env.TRANSLATE\_KEY; |
|  |  |  |
|  |  | // or |
|  |  |  |
|  |  | const lTranslate = translate.Translate({ |
|  |  | const lTranslate = Translate({ |
|  |  | engine: "libre", |
|  |  | url: "...", |
|  |  | key: "YOUR-KEY-HERE", |
| Expand All | | @@ -171,7 +185,7 @@ const lTranslate = translate.Translate({ |
|  |  |  |
|  |  | ## Promises |
|  |  |  |
|  |  | Working with Promises and specially with [async/await](https://ponyfoo.com/articles/understanding-javascript-async-await) reduces [Callback Hell](http://callbackhell.com/). To see it in action, first you'll need an `async` function. Then put your `await` calls inside: |
|  |  | This library uses promises which need to be awaited for the translated result: |
|  |  |  |
|  |  | ```js |
|  |  | // Browser; jQuery for demonstration purposes |
| Expand Down | |  |

61 changes: 42 additions & 19 deletions

61
[index.d.ts](#diff-7aa4473ede4abd9ec099e87fec67fd57afafaf39e05d493ab4533acc38547eb8 "index.d.ts")

Show comments

[View file](/franciscop/translate/blob/cc1ba03078102f83e0503a96f1a081489bb865d3/index.d.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -9,22 +9,45 @@ type Engine = { |
|  |  | parse: (res: { [key: string]: any }) => string; |
|  |  | }; |
|  |  |  |
|  |  | type Options = |
|  |  | | string |
|  |  | | { |
|  |  | // Basic types expected for everyday use |
|  |  | from?: string; |
|  |  | to?: string; |
|  |  | key?: string; |
|  |  | engine?: "google" | "deepl" | "libre" | "yandex"; |
|  |  |  |
|  |  | // More advanced types when tweaking the library |
|  |  | keys?: { [name: string]: string }; |
|  |  | cache?: number; |
|  |  | engines?: { [name: string]: Engine }; |
|  |  | }; |
|  |  |  |
|  |  | export default function Translate( |
|  |  | text: string, |
|  |  | options?: Options |
|  |  | ): Promise<string>; |
|  |  | type Options = string | { from?: string; to?: string }; |
|  |  |  |
|  |  | declare const translate: { |
|  |  | (text: string, opts?: Options): Promise<string>; |
|  |  |  |
|  |  | key?: string; |
|  |  | engine?: "google" | "deepl" | "libre" | "yandex"; |
|  |  |  |
|  |  | // More advanced types when tweaking the library |
|  |  | keys?: { [name: string]: string }; |
|  |  | cache?: number; |
|  |  | engines?: { [name: string]: Engine }; |
|  |  |  |
|  |  | Translate({}: { |
|  |  | from?: string; |
|  |  | to?: string; |
|  |  |  |
|  |  | key?: string; |
|  |  | engine?: "google" | "deepl" | "libre" | "yandex"; |
|  |  |  |
|  |  | // More advanced types when tweaking the library |
|  |  | keys?: { [name: string]: string }; |
|  |  | cache?: number; |
|  |  | engines?: { [name: string]: Engine }; |
|  |  | }): typeof translate; |
|  |  | }; |
|  |  |  |
|  |  | declare const Translate: ({}: { |
|  |  | from?: string; |
|  |  | to?: string; |
|  |  |  |
|  |  | key?: string; |
|  |  | engine?: "google" | "deepl" | "libre" | "yandex"; |
|  |  |  |
|  |  | // More advanced types when tweaking the library |
|  |  | keys?: { [name: string]: string }; |
|  |  | cache?: number; |
|  |  | engines?: { [name: string]: Engine }; |
|  |  | }) => typeof translate; |
|  |  |  |
|  |  | export default translate; |
|  |  | export { Translate }; |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `cc1ba03`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffranciscop%2Ftranslate%2Fcommit%2Fcc1ba03078102f83e0503a96f1a081489bb865d3) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f89b4518_20250110_211954.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffranciscop%2Ftranslate%2Fsecurity%2Fadvisories%2FGHSA-882j-4vj5-7vmj)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffranciscop%2Ftranslate%2Fsecurity%2Fadvisories%2FGHSA-882j-4vj5-7vmj)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=franciscop%2Ftranslate)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[franciscop](/franciscop)
/
**[translate](/franciscop/translate)**
Public

* [Notifications](/login?return_to=%2Ffranciscop%2Ftranslate) You must be signed in to change notification settings
* [Fork
  45](/login?return_to=%2Ffranciscop%2Ftranslate)
* [Star
   292](/login?return_to=%2Ffranciscop%2Ftranslate)

* [Code](/franciscop/translate)
* [Issues
  1](/franciscop/translate/issues)
* [Pull requests
  0](/franciscop/translate/pulls)
* [Actions](/franciscop/translate/actions)
* [Security](/franciscop/translate/security)
* [Insights](/franciscop/translate/pulse)

Additional navigation options

* [Code](/franciscop/translate)
* [Issues](/franciscop/translate/issues)
* [Pull requests](/franciscop/translate/pulls)
* [Actions](/franciscop/translate/actions)
* [Security](/franciscop/translate/security)
* [Insights](/franciscop/translate/pulse)

# Cache Poisoning Vulnerability

Moderate

[franciscop](/franciscop)
published
GHSA-882j-4vj5-7vmj
Mar 22, 2024

## Package

npm

translate
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

<2.0.2

## Patched versions

None

## Description

### Summary

An attacker controlling the second variable of the `translate` function is able to perform a cache poisoning attack. They can change the outcome of translation requests made by subsequent users.

### Details

The `opt.id` parameter allows the overwriting of the cache key. If an attacker sets the `id` variable to the cache key that would be generated by another user, they can choose the response that user gets served.

### PoC

Take the following simple server allowing users to supply text and the language to translate to.

```
import translate from "translate";
import express from 'express';

const app = express();
app.use(express.json());

app.post('/translate', async (req, res) => {
  const { text, language } = req.body;
  const result = await translate(text, language);
  return res.json(result);
});

const port = 3000;
app.listen(port, () => {
  console.log(`Server is running on port ${port}`);
});
```

We can send the following request to poison the cache:

```
{"text":"I hate you", "language":{"to":"nl","id":"undefined:en:nl:google:I love you"}}

```

[![Poisoning the cache](https://user-images.githubusercontent.com/44903767/285421743-ccfa3d9d-24cf-47b7-b805-0e4034cec82e.png)](https://user-images.githubusercontent.com/44903767/285421743-ccfa3d9d-24cf-47b7-b805-0e4034cec82e.png)

Now, any user that attempts to translate "I love you" to Dutch, will get "I hate you" in Dutch as the response.

[![The victim gets our poisoned data](https://user-images.githubusercontent.com/44903767/285422033-b3853ca2-8a5a-4875-91e8-ba2ef0258bc6.png)](https://user-images.githubusercontent.com/44903767/285422033-b3853ca2-8a5a-4875-91e8-ba2ef0258bc6.png)

### Impact

An attacker can control the results other users may get

### Severity

Moderate

5.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N

### CVE ID

CVE-2024-29042

### Weaknesses

[CWE-20](/advisories?query=cwe%3A20)

### Credits

* [![@PinkDraconian](https://avatars.githubusercontent.com/u/44903767?s=40&v=4)](/PinkDraconian)
  [PinkDraconian](/PinkDraconian)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c928dbd6_20250110_211953.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffranciscop%2Ftranslate%2Fcommit%2F7a2bf8b9f05f7c45c09683973ef4d8e995804aa4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffranciscop%2Ftranslate%2Fcommit%2F7a2bf8b9f05f7c45c09683973ef4d8e995804aa4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=franciscop%2Ftranslate)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[franciscop](/franciscop)
/
**[translate](/franciscop/translate)**
Public

* [Notifications](/login?return_to=%2Ffranciscop%2Ftranslate) You must be signed in to change notification settings
* [Fork
  45](/login?return_to=%2Ffranciscop%2Ftranslate)
* [Star
   292](/login?return_to=%2Ffranciscop%2Ftranslate)

* [Code](/franciscop/translate)
* [Issues
  1](/franciscop/translate/issues)
* [Pull requests
  0](/franciscop/translate/pulls)
* [Actions](/franciscop/translate/actions)
* [Security](/franciscop/translate/security)
* [Insights](/franciscop/translate/pulse)

Additional navigation options

* [Code](/franciscop/translate)
* [Issues](/franciscop/translate/issues)
* [Pull requests](/franciscop/translate/pulls)
* [Actions](/franciscop/translate/actions)
* [Security](/franciscop/translate/security)
* [Insights](/franciscop/translate/pulse)

## Commit

[Permalink](/franciscop/translate/commit/7a2bf8b9f05f7c45c09683973ef4d8e995804aa4)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Made the usage options much simpler so that there's no chance of writ…

[Browse files](/franciscop/translate/tree/7a2bf8b9f05f7c45c09683973ef4d8e995804aa4)
Browse the repository at this point in the history

```
…ing runtime vulnerabilities
```

* Loading branch information

[![@franciscop](https://avatars.githubusercontent.com/u/2801252?s=40&v=4)](/franciscop)

[franciscop](/franciscop/translate/commits?author=franciscop "View all commits by franciscop")
committed
Mar 21, 2024

1 parent
[e6b831c](/franciscop/translate/commit/e6b831c84203c642520560dc122bfdebc476a74a)

commit 7a2bf8b

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**115 additions**
and
**67 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* README.md
  [README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5)
* index.min.js
  [index.min.js](#diff-4756d91bf214842c0bd331fa1076eea263df7ed4c8ce892e23ff0fb4316f5b16)
* package.json
  [package.json](#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519)
* src

  + src/cache.test.js
    [cache.test.js](#diff-11a641eb8b13b6624abd88651893f1dd7aec600c1c4165fba57cd435da2459a0)
  + engines

    - src/engines/deepl.js
      [deepl.js](#diff-07ed248e445fe7a69cdd3ebf6b93524f16a2453cd3c5dedd74af2eba41c97b1b)
    - src/engines/google.test.js
      [google.test.js](#diff-845f7d7909ff46a9b40557de83d8ba3a0edc1915fd4ce6fe1185730daeec48ad)
    - src/engines/libre.test.js
      [libre.test.js](#diff-e89fc3d3b21af0a00e3eed5c46ae95a2d5ad30aa6ed0741fa8ce4e1ec6821caa)
    - src/engines/yandex.test.js
      [yandex.test.js](#diff-058e6c8f26d3ab322708bb6fd71541341f68c3a8ce98eb30ea00637aff1b2a19)
  + src/index.js
    [index.js](#diff-bfe9874d239014961b1ae4e89875a6155667db834a410aaaa2ebe3cf89820556)
  + src/translate.test.js
    [translate.test.js](#diff-723903fd3d48cef9b6baf2665474f3fa83eabe3803862d972f40f690c619946f)
* test

  + test/index.types.ts
    [index.types.ts](#diff-4ef368eb6ffed4517e8d50a750b4b43ff586aa372e8cf889a3423f61a4547091)
  + test/mock.js
    [mock.js](#diff-a247fc588bc2bf52323d99f618649316ebae5314fca0e97da9e2c28340087348)

## There are no files selected for viewing

46 changes: 38 additions & 8 deletions

46
[README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5 "README.md")

Show comments

[View file](/franciscop/translate/blob/7a2bf8b9f05f7c45c09683973ef4d8e995804aa4/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -61,14 +61,16 @@ console.log(text); |
|  |  |  |
|  |  | The first parameter is the \*\*string\*\* that you want to translate. Right now only a single string of text is accepted. |
|  |  |  |
|  |  | The second parameter is the options. It accepts either a `String` of the language to translate \*\*to\*\* or a simple `Object` with these options: |
|  |  | The second parameter is the options. It accepts either a `String` of the language to translate \*\*to\*\* or a simple `Object` with the keys `to` and `from`. However, in total there are more options, so here is a list of all of them: |
|  |  |  |
|  |  | - \*\*`to`\*\*: the string of the language to translate to. It can be in any of the two ISO 639 (1 or 2) or the full name in English like `Spanish`. Defaults to \*\*en\*\*. |
|  |  | - \*\*`from`\*\*: the string of the language to translate to. It can be in any of the two ISO 639 (1 or 2) or the full name in English like `Spanish`. Also defaults to \*\*en\*\*. |
|  |  | - \*\*`cache`\*\*: a `Number` with the milliseconds that each translation should be cached. Leave it undefined to cache it indefinitely (until a server/browser restart). |
|  |  | - \*\*`engine`\*\*: a `String` containing the name of the engine to use for translation. Right now it defaults to `google`. Read more [in the engine section](#engines). |
|  |  | - \*\*`key`\*\*: the API Key for the engine of your choice. Read more [in the engine section](#engines). |
|  |  | - \*\*`url`\*\*: only available for those engines that you can install on your own server (like Libretranslate), allows you to specify a custom endpoint for the translations. [See this issue](https://github.com/franciscop/translate/issues/26#issuecomment-845038821) for more info. |
|  |  | - \*\*`cache`\*\* [instance]: a `Number` with the milliseconds that each translation should be cached. Leave it undefined to cache it indefinitely (until a server/browser restart). |
|  |  | - \*\*`engine`\*\* [instance]: a `String` containing the name of the engine to use for translation. Right now it defaults to `google`. Read more [in the engine section](#engines). |
|  |  | - \*\*`key`\*\* [instance]: the API Key for the engine of your choice. Read more [in the engine section](#engines). |
|  |  | - \*\*`url`\*\* [instance]: only available for those engines that you can install on your own server (like Libretranslate), allows you to specify a custom endpoint for the translations. [See this issue](https://github.com/franciscop/translate/issues/26#issuecomment-845038821) for more info. |
|  |  |  |
|  |  | > The options marked as [instance] can only be set to the root `translate.cache = 1000` or when creating a new instance `const myDeepL = translate.Translate()` |
|  |  |  |
|  |  | Examples: |
|  |  |  |
| Expand All | | @@ -78,6 +80,9 @@ const foo = await translate("Hello world", "es"); |
|  |  |  |
|  |  | // Same as this: |
|  |  | const bar = await translate("Hello world", { to: "es" }); |
|  |  |  |
|  |  | // INVALID: |
|  |  | const bar = await translate("Hello world", { to: "es", engine: "google" }); |
|  |  | ``` |
|  |  |  |
|  |  | > On both `to` and `from` defaulting to `en`: while I \_am\_ Spanish and was quite tempted to set this as one of those, English is the main language of the Internet and the main secondary language for those who have a different native language. This is why most of the translations will happen either to or from English. |
| Expand All | | @@ -89,9 +94,15 @@ You can change the default options for anything by calling the root library and |
|  |  | ```js |
|  |  | translate.from = "es"; |
|  |  | translate.engine = "deepl"; |
|  |  | await translate("Hola mundo", "ja"); |
|  |  | ``` |
|  |  |  |
|  |  | This can be applied to any of the options enumerated above. |
|  |  | You can also create a new instance with different default options: |
|  |  |  |
|  |  | ```js |
|  |  | const myLib = translate.Translate({ engine: 'deepl', from: 'es', ... }); |
|  |  | await myLib("Hola mundo", "ja" ); |
|  |  | ``` |
|  |  |  |
|  |  | ## Engines |
|  |  |  |
| Expand Down  Expand Up | | @@ -126,17 +137,36 @@ translate.key = process.env.TRANSLATE\_KEY; |
|  |  | // ... use translate() |
|  |  | ``` |
|  |  |  |
|  |  | To pass it per-translation, you can add it to your arguments: |
|  |  | You can create different instances if you want to combine different engines: |
|  |  |  |
|  |  | ```js |
|  |  | translate("Hello world", { to: "en", engine: "deepl", key: "YOUR-KEY-HERE" }); |
|  |  | const gTranslate = translate.Translate({ |
|  |  | engine: "google", |
|  |  | key: "YOUR-KEY-HERE", |
|  |  | }); |
|  |  | const dTranslate = translate.Translate({ |
|  |  | engine: "deepl", |
|  |  | key: "YOUR-KEY-HERE", |
|  |  | }); |
|  |  | const lTranslate = translate.Translate({ |
|  |  | engine: "libre", |
|  |  | key: "YOUR-KEY-HERE", |
|  |  | }); |
|  |  | ``` |
|  |  |  |
|  |  | Specifically in Libretranslate, you can also add a `url` parameter if you install it on your own server: |
|  |  |  |
|  |  | ```js |
|  |  | translate.url = "https://example.com/"; |
|  |  | translate.key = process.env.TRANSLATE\_KEY; |
|  |  |  |
|  |  | // or |
|  |  |  |
|  |  | const lTranslate = translate.Translate({ |
|  |  | engine: "libre", |
|  |  | url: "...", |
|  |  | key: "YOUR-KEY-HERE", |
|  |  | }); |
|  |  | ``` |
|  |  |  |
|  |  | ## Promises |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[index.min.js](#diff-4756d91bf214842c0bd331fa1076eea263df7ed4c8ce892e23ff0fb4316f5b16 "index.min.js")

Show comments

[View file](/franciscop/translate/blob/7a2bf8b9f05f7c45c09683973ef4d8e995804aa4/index.min.js)
Edit file

Delete file

Load diff

Large diffs are not rendered by default.

Oops, something went wrong.

Retry

4 changes: 2 additions & 2 deletions

4
[package.json](#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519 "package.json")

Show comments

[View file](/franciscop/translate/blob/7a2bf8b9f05f7c45c09683973ef4d8e995804aa4/package.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,14 +2,14 @@ |
|  |  | "name": "translate", |
|  |  | "version": "2.0.2", |
|  |  | "description": "Translate text to different languages on node.js and the browser", |
|  |  | "author": "Francisco Presencia <public@francisco.io> (https://francisco.io/)", |
|  |  | "homepage": "https://github.com/franciscop/translate#readme", |
|  |  | "repository": "https://github.com/franciscop/translate.git", |
|  |  | "bugs": "https://github.com/franciscop/translate/issues", |
|  |  | "funding": "https://www.paypal.me/franciscopresencia/19", |
|  |  | "author": "Francisco Presencia <public@francisco.io> (https://francisco.io/)", |
|  |  | "license": "MIT", |
|  |  | "scripts": { |
|  |  | "start": "npm run watch # Start ~= Start dev", |
|  |  | "start": "node --experimental-vm-modules node\_modules/jest/bin/jest.js --watch", |
|  |  | "build": "rollup src/index.js --name translate --output.format esm | terser --compress --mangle -o index.min.js", |
|  |  | "size": "gzip -c index.min.js | wc -c && echo 'bytes' # Only for Unix", |
|  |  | "test": "node --experimental-vm-modules node\_modules/jest/bin/jest.js --coverage --collectCoverageFrom=src/\*\*/\*.js && npx check-dts", |
| Expand Down | |  |

5 changes: 3 additions & 2 deletions

5
[src/cache.test.js](#diff-11a641eb8b13b6624abd88651893f1dd7aec600c1c4165fba57cd435da2459a0 "src/cache.test.js")

Show comments

[View file](/franciscop/translate/blob/7a2bf8b9f05f7c45c09683973ef4d8e995804aa4/src/cache.test.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -35,12 +35,13 @@ describe("cache", () => { |
|  |  | }); |
|  |  |  |
|  |  | it("removes cache after the time is out", async () => { |
|  |  | const t = translate.Translate({ cache: 1000 }); |
|  |  | const before = new Date(); |
|  |  | await translate("Is this also cached?", { to: "es", cache: 1000 }); |
|  |  | await t("Is this also cached?", { to: "es" }); |
|  |  | const mid = new Date(); |
|  |  | await delay(1100); |
|  |  | mock(/googleapis.\*tl=es/, [[["Hola mundo"]]]); |
|  |  | await translate("Is this also cached?", { to: "es" }); |
|  |  | await t("Is this also cached?", { to: "es" }); |
|  |  | const after = new Date(); |
|  |  | expect(mid - before).toBeLessThan(10000); |
|  |  | expect(mid - before).toBeGreaterThan(100); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/engines/deepl.js](#diff-07ed248e445fe7a69cdd3ebf6b93524f16a2453cd3c5dedd74af2eba41c97b1b "src/engines/deepl.js")

Show comments

[View file](/franciscop/translate/blob/7a2bf8b9f05f7c45c09683973ef4d8e995804aa4/src/engines/deepl.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,7 @@ |
|  |  | export default { |
|  |  | needkey: true, |
|  |  | fetch: ({ key, from, to, text }) => { |
|  |  | const suffix = /:fx$/.test(key) ? "-free" : ""; |
|  |  | const suffix = key.endsWith(":fx") ? "-free" : ""; |
|  |  | text = encodeURIComponent(text); |
|  |  | return [ |
|  |  | `https://api${suffix}.deepl.com/v2/translate?auth\_key=${key}&source\_lang=${from}&target\_lang=${to}&text=${text}`, |
| Expand Down | |  |

11 changes: 7 additions & 4 deletions

11
[src/engines/google.test.js](#diff-845f7d7909ff46a9b40557de83d8ba3a0edc1915fd4ce6fe1185730daeec48ad "src/engines/google.test.js")

Show comments

[View file](/franciscop/translate/blob/7a2bf8b9f05f7c45c09683973ef4d8e995804aa4/src/engines/google.test.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,10 @@ |
|  |  | import "dotenv/config"; |
|  |  | import translate from "../../src"; |
|  |  |  |
|  |  | import t from "../../src"; |
|  |  | import mock from "../../test/mock.js"; |
|  |  |  |
|  |  | const translate = t.Translate({ engine: "google" }); |
|  |  |  |
|  |  | describe("google mocked responses", () => { |
|  |  | afterEach(() => mock.end()); |
|  |  |  |
| Expand Down  Expand Up | | @@ -39,17 +42,17 @@ describe("google full requests", () => { |
|  |  | }); |
|  |  |  |
|  |  | it("calls Google to translate to Japanese", async () => { |
|  |  | const opts = { to: "ja", engine: "google" }; |
|  |  | const opts = { to: "ja" }; |
|  |  | expect(await translate("Hello world", opts)).toBe("こんにちは世界"); |
|  |  | }); |
|  |  |  |
|  |  | it("calls Google to translate to Spanish", async () => { |
|  |  | const opts = { to: "es", engine: "google" }; |
|  |  | const opts = { to: "es" }; |
|  |  | expect(await translate("Hello world", opts)).toMatch(/Hola mundo/i); |
|  |  | }); |
|  |  |  |
|  |  | it("works with punctuation", async () => { |
|  |  | const opts = { to: "pt", engine: "google" }; |
|  |  | const opts = { to: "pt" }; |
|  |  | const text = await translate( |
|  |  | "What do you call a pig that knows karate? A pork chop!", |
|  |  | opts |
| Expand Down | |  |

22 changes: 12 additions & 10 deletions

22
[src/engines/libre.test.js](#diff-e89fc3d3b21af0a00e3eed5c46ae95a2d5ad30aa6ed0741fa8ce4e1ec6821caa "src/engines/libre.test.js")

Show comments

[View file](/franciscop/translate/blob/7a2bf8b9f05f7c45c09683973ef4d8e995804aa4/src/engines/libre.test.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,9 @@ |
|  |  | import "dotenv/config"; |
|  |  | import translate from "../../src"; |
|  |  |  |
|  |  | import t from "../../src"; |
|  |  | import mock from "../../test/mock"; |
|  |  |  |
|  |  | const translate = t.Translate({ engine: "libre" }); |
|  |  | translate.keys.libre = process.env.LIBRE\_KEY || "xxx"; |
|  |  |  |
|  |  | describe("Libre mocked requests", () => { |
| Expand All | | @@ -10,27 +12,27 @@ describe("Libre mocked requests", () => { |
|  |  |  |
|  |  | it("works with libretranslate", async () => { |
|  |  | mock.libre("Hola mundo"); |
|  |  | const text = await translate("Hello world", { to: "es", engine: "libre" }); |
|  |  | const text = await translate("Hello world", { to: "es" }); |
|  |  | expect(text).toMatch(/Hola mundo/i); |
|  |  | }); |
|  |  |  |
|  |  | it("will throw with a wrong language", async () => { |
|  |  | const opts = { to: "adgdfnj", engine: "libre" }; |
|  |  | const opts = { to: "adgdfnj" }; |
|  |  | await expect(translate("Hello world", opts)).rejects.toMatchObject({ |
|  |  | message: `The language "adgdfnj" is not part of the ISO 639-1`, |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | it("will throw with an empty result", async () => { |
|  |  | mock.libre(""); |
|  |  | const opts = { to: "es", engine: "libre" }; |
|  |  | const opts = { to: "es" }; |
|  |  | await expect(translate("What's going on?", opts)).rejects.toMatchObject({ |
|  |  | message: "No response found", |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | it("requires an API key", async () => { |
|  |  | const opts = { to: "es", engine: "libre" }; |
|  |  | const opts = { to: "es" }; |
|  |  | await expect(translate("What's going on?", opts)).rejects.toMatchObject({ |
|  |  | message: "Visit https://portal.libretranslate.com to get an API key", |
|  |  | }); |
| Expand All | | @@ -40,7 +42,7 @@ describe("Libre mocked requests", () => { |
|  |  | mock(/example\.\*/, new Error("no domain"), { throws: true }); |
|  |  |  |
|  |  | translate.url = "https://example.com/"; |
|  |  | const opts = { to: "es", engine: "libre" }; |
|  |  | const opts = { to: "es" }; |
|  |  | await expect(translate("Hello world", opts)).rejects.toMatchObject({ |
|  |  | message: "no domain", |
|  |  | }); |
| Expand All | | @@ -59,23 +61,23 @@ describe("libre full requests", () => { |
|  |  | } |
|  |  |  |
|  |  | it("calls Libre to translate to Japanese", async () => { |
|  |  | const opts = { to: "ja", engine: "libre" }; |
|  |  | const opts = { to: "ja" }; |
|  |  | expect(await translate("Hello world", opts)).toBe("ハローワールド"); |
|  |  | }); |
|  |  |  |
|  |  | it("calls Libre to translate to Spanish", async () => { |
|  |  | const opts = { to: "es", engine: "libre" }; |
|  |  | const opts = { to: "es" }; |
|  |  | expect(await translate("Hello world", opts)).toBe("Hola mundo"); |
|  |  | }); |
|  |  |  |
|  |  | it("requires a valid key", async () => { |
|  |  | const opts = { to: "ru", engine: "libre", key: "abc" }; |
|  |  | const opts = { to: "ru", key: "abc" }; |
|  |  | await expect(translate("Hello world", opts)).rejects.toThrow(); |
|  |  | }); |
|  |  |  |
|  |  | it("can set a custom URL", async () => { |
|  |  | translate.url = "https://example.com/"; |
|  |  | const opts = { to: "es", engine: "libre" }; |
|  |  | const opts = { to: "es" }; |
|  |  | const text = await translate("libre custom url", opts); |
|  |  | delete translate.url; |
|  |  | expect(text).toBe("Url personalizada de libre"); |
| Expand Down | |  |

19 changes: 9 additions & 10 deletions

19
[src/engines/yandex.test.js](#diff-058e6c8f26d3ab322708bb6fd71541341f68c3a8ce98eb30ea00637aff1b2a19 "src/engines/yandex.test.js")

Show comments

[View file](/franciscop/translate/blob/7a2bf8b9f05f7c45c09683973ef4d8e995804aa4/src/engines/yandex.test.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,9 @@ |
|  |  | import "dotenv/config"; |
|  |  | import translate from "../../src"; |
|  |  |  |
|  |  | import t from "../../src"; |
|  |  | import mock from "../../test/mock.js"; |
|  |  |  |
|  |  | const translate = t.Translate({ engine: "yandex" }); |
|  |  | translate.keys.yandex = process.env.YANDEX\_KEY || "xxx"; |
|  |  |  |
|  |  | describe("yandex mocked requests", () => { |
| Expand All | | @@ -18,20 +20,17 @@ describe("yandex mocked requests", () => { |
|  |  |  |
|  |  | it("works with a simple request", async () => { |
|  |  | mock.yandex("Hola de Yandex"); |
|  |  | const spanish = await translate("Hello from Yandex", { |
|  |  | to: "es", |
|  |  | engine: "yandex", |
|  |  | }); |
|  |  | const spanish = await translate("Hello from Yandex", { to: "es" }); |
|  |  | expect(spanish).toMatch(/Hola de Yandex/i); |
|  |  | }); |
|  |  |  |
|  |  | it("can handle errors from the API", async () => { |
|  |  | const prom = translate("error", { to: "es", engine: "yandex" }); |
|  |  | const prom = translate("error", { to: "es" }); |
|  |  | await expect(prom).rejects.toHaveProperty("message", "it fails"); |
|  |  | }); |
|  |  |  |
|  |  | it("can handle errors thrown by fetch()", async () => { |
|  |  | const prom = translate("throw", { to: "es", engine: "yandex" }); |
|  |  | const prom = translate("throw", { to: "es" }); |
|  |  | await expect(prom).rejects.toHaveProperty("message", "also fails harder"); |
|  |  | }); |
|  |  | }); |
| Expand All | | @@ -46,17 +45,17 @@ describe("yandex full requests", () => { |
|  |  | } |
|  |  |  |
|  |  | it("calls Yandex to translate to Japanese", async () => { |
|  |  | const opts = { to: "ja", engine: "yandex" }; |
|  |  | const opts = { to: "ja" }; |
|  |  | expect(await translate("Hello world", opts)).toBe("こんにちは世界"); |
|  |  | }); |
|  |  |  |
|  |  | it("calls Yandex to translate to Spanish", async () => { |
|  |  | const opts = { to: "es", engine: "yandex" }; |
|  |  | const opts = { to: "es" }; |
|  |  | expect(await translate("Hello world", opts)).toBe("Hola mundo"); |
|  |  | }); |
|  |  |  |
|  |  | it("requires a valid key", async () => { |
|  |  | const opts = { to: "ru", engine: "yandex", key: "abc" }; |
|  |  | const opts = { to: "ru", key: "abc" }; |
|  |  | await expect(translate("Hello world", opts)).rejects.toThrow(); |
|  |  | }); |
|  |  | }); |

31 changes: 17 additions & 14 deletions

31
[src/index.js](#diff-bfe9874d239014961b1ae4e89875a6155667db834a410aaaa2ebe3cf89820556 "src/index.js")

Show comments

[View file](/franciscop/translate/blob/7a2bf8b9f05f7c45c09683973ef4d8e995804aa4/src/index.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,13 +1,11 @@ |
|  |  | // translate.js |
|  |  | // Translate text into different languages; |
|  |  |  |
|  |  | // Load a language parser to allow for more flexibility in the language choice |
|  |  | import languages from "./languages/index.js"; |
|  |  |  |
|  |  | // Cache the different translations to avoid resending requests |
|  |  | import cache from "./cache.js"; |
|  |  |  |
|  |  | import engines from "./engines/index.js"; |
|  |  | // Load a language parser to allow for more flexibility in the language choice |
|  |  | import languages from "./languages/index.js"; |
|  |  |  |
|  |  | // Main function |
|  |  | const Translate = function (options = {}) { |
| Expand All | | @@ -19,35 +17,40 @@ const Translate = function (options = {}) { |
|  |  | from: "en", |
|  |  | to: "en", |
|  |  | cache: undefined, |
|  |  | engine: "google", |
|  |  | key: undefined, |
|  |  | url: undefined, |
|  |  | languages: languages, |
|  |  | engines: engines, |
|  |  | engine: "google", |
|  |  | keys: {}, |
|  |  | }; |
|  |  |  |
|  |  | const translate = async (text, opts = {}) => { |
|  |  | // Load all of the appropriate options (verbose but fast) |
|  |  | // Note: not all of those \*should\* be documented since some are internal only |
|  |  | if (typeof opts === "string") opts = { to: opts }; |
|  |  | const invalidKey = Object.keys(opts).find( |
|  |  | (k) => k !== "from" && k !== "to" |
|  |  | ); |
|  |  | if (invalidKey) { |
|  |  | throw new Error(`Invalid option with the name '${invalidKey}'`); |
|  |  | } |
|  |  | opts.text = text; |
|  |  | opts.from = languages(opts.from || translate.from); |
|  |  | opts.to = languages(opts.to || translate.to); |
|  |  | opts.cache = opts.cache || translate.cache; |
|  |  | opts.engines = opts.engines || {}; |
|  |  | opts.engine = opts.engine || translate.engine; |
|  |  | opts.url = opts.url || translate.url; |
|  |  | opts.id = |
|  |  | opts.id || |
|  |  | `${opts.url}:${opts.from}:${opts.to}:${opts.engine}:${opts.text}`; |
|  |  | opts.keys = opts.keys || translate.keys || {}; |
|  |  | opts.cache = translate.cache; |
|  |  | opts.engine = translate.engine; |
|  |  | opts.url = translate.url; |
|  |  | opts.id = `${opts.url}:${opts.from}:${opts.to}:${opts.engine}:${opts.text}`; |
|  |  | opts.keys = translate.keys || {}; |
|  |  | for (let name in translate.keys) { |
|  |  | // The options has stronger preference than the global value |
|  |  | opts.keys[name] = opts.keys[name] || translate.keys[name]; |
|  |  | } |
|  |  | opts.key = opts.key || translate.key || opts.keys[opts.engine]; |
|  |  |  |
|  |  | // Use the desired engine |
|  |  | const engine = opts.engines[opts.engine] || translate.engines[opts.engine]; |
|  |  | const engine = translate.engines[opts.engine]; |
|  |  |  |
|  |  | // If it is cached return ASAP |
|  |  | const cached = cache.get(opts.id); |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `7a2bf8b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffranciscop%2Ftranslate%2Fcommit%2F7a2bf8b9f05f7c45c09683973ef4d8e995804aa4) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


