

| Get Updates: | [Via Atom](/atom.xml) |  | [On Twitter](https://twitter.com/rubysec) |  | [On GitHub](https://github.com/rubysec/ruby-advisory-db) |
| --- | --- | --- | --- | --- | --- |

# RubySec

Providing security resources for the Ruby community

* [Home](/)
* [Advisories](/advisories/archives)

# CVE-2022-21831 (activestorage): Possible code injection vulnerability in Rails / Active Storage

March 8th, 2022

### ADVISORIES

* [CVE-2022-21831](https://www.cve.org/CVERecord?id=CVE-2022-21831)
  ([NVD](https://nvd.nist.gov/vuln/detail/CVE-2022-21831))
* [GHSA-w749-p3v6-hccq](https://github.com/advisories/GHSA-w749-p3v6-hccq)
* [Vendor Advisory](https://groups.google.com/g/rubyonrails-security/c/n-p-W1yxatI)

### GEM

[activestorage](https://rubygems.org/gems/activestorage)

### FRAMEWORK

[Ruby on Rails](https://rubyonrails.org/)

### SEVERITY

[CVSS v3.x](https://www.first.org/cvss/): 9.8 (**Critical**)

### UNAFFECTED VERSIONS

* `< 5.2.0`

### PATCHED VERSIONS

* `~> 5.2.6, >= 5.2.6.3`
* `~> 6.0.4, >= 6.0.4.7`
* `~> 6.1.4, >= 6.1.4.7`
* `>= 7.0.2.3`

### DESCRIPTION

There is a possible code injection vulnerability in the Active Storage module
of Rails. This vulnerability has been assigned the CVE identifier
CVE-2022-21831.

Versions Affected: >= 5.2.0
Not affected: < 5.2.0
Fixed Versions: 7.0.2.3, 6.1.4.7, 6.0.4.7, 5.2.6.3

## Impact

There is a possible code injection vulnerability in the Active Storage module
of Rails. This vulnerability impacts applications that use Active Storage
with the image\_processing processing in addition to the mini\_magick back end
for image\_processing.

Vulnerable code will look something similar to this:

```
&lt;%= image_tag blob.variant(params[:t] =&gt; params[:v]) %&gt;

```

Where the transformation method or its arguments are untrusted arbitrary
input.

All users running an affected release should either upgrade or use one of the
workarounds immediately.

## Workarounds

To work around this issue, applications should implement a strict allow-list
on accepted transformation methods or arguments. Additionally, a strict image
magick security policy will help mitigate this issue.

https://imagemagick.org/script/security-policy.php

Posted by RubySec
March 8th, 2022

•

[« GHSA-fmx4-26r3-wxpf (commonmarker): Integer overflow in cmark-gfm table parsing extension leads to heap memory corruption](/advisories/GHSA-fmx4-26r3-wxpf/ "Previous Post: GHSA-fmx4-26r3-wxpf (commonmarker): Integer overflow in cmark-gfm table parsing extension leads to heap memory corruption")
[CVE-2021-3589 (foreman\_ansible): Missing Authentication for Critical Function in Foreman Ansible »](/advisories/CVE-2021-3589/ "Next Post: CVE-2021-3589 (foreman_ansible): Missing Authentication for Critical Function in Foreman Ansible")

Contact us [@rubysec](https://twitter.com/rubysec) or [open an issue on our GitHub repository](https://github.com/rubysec/ruby-advisory-db).

## Recent Advisories

* [CVE-2024-56733 (pwpush): Password Pusher Allows Session Token Interception Leading to Potential Hijacking](/advisories/CVE-2024-56733/)
* [CVE-2024-54133 (actionpack): Possible Content Security Policy bypass in Action Dispatch](/advisories/CVE-2024-54133/)
* [CVE-2024-53989 (rails-html-sanitizer): rails-html-sanitizer has XSS vulnerability with certain configurations](/advisories/CVE-2024-53989/)
* [CVE-2024-53988 (rails-html-sanitizer): rails-html-sanitizer has XSS vulnerability with certain configurations](/advisories/CVE-2024-53988/)
* [CVE-2024-53987 (rails-html-sanitizer): rails-html-sanitizer has XSS vulnerability with certain configurations](/advisories/CVE-2024-53987/)

Copyright © 2024 - RubySec

This domain was graciously donated by Jordi Massaguer.

