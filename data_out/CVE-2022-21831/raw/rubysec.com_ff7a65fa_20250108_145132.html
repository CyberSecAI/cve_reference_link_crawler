
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CVE-2022-21831 (activestorage): Possible code injection vulnerability in Rails / Active Storage - RubySec</title>
  <meta name="author" content="RubySec">

  
  <meta name="description" content="
  
  
    
  
    
      CVE-2022-21831 (activestorage): Possible code injection vulnerability in Rails / Active Storage
    
    
      
        ...">
  

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://rubysec.com/advisories/CVE-2022-21831/">
  <link href="/favicon.ico" rel="icon" sizes="any">
  <link href="/apple-touch-icon.png" rel="apple-touch-icon">
  <link href="/site.webmanifest" rel="manifest">
  
  <link href="/assets/bootstrap/css/spacelab.min.css" rel="stylesheet" type="text/css">
  <link href="/assets/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css">
  <link href="/assets/bootstrap/css/custom.css" rel="stylesheet" type="text/css">
  <link href="/assets/font-awesome/css/font-awesome.css" rel="stylesheet" type="text/css">
  
  <link href="/atom.xml" rel="alternate" title="RubySec" type="application/atom+xml">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-P90QEESFMF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-P90QEESFMF');
  </script>
</head>

<body    data-spy="scroll">

  <div class="container">
    <header class="jumbotron subhead" id="overview">
      <section class="header">
  <div class="subscribe">
    <table>
      <tr>
        <td><span>Get Updates: &nbsp;</span></td>
        
        <td><a href="/atom.xml" class="btn"><i class="icon-cog"></i> Via Atom</a></td>
        
        <td>&nbsp;</td>
        
        <td><a href="https://twitter.com/rubysec" class="btn"><i class="icon-twitter-sign"></i> On Twitter</a></td>
        
        <td>&nbsp;</td>
        
        <td><a href="https://github.com/rubysec/ruby-advisory-db" class="btn"><i class="icon-github-sign"></i> On GitHub</a></td>
        
      </tr>
    </table>
  </div>

  <div>
    <h1 class="title">
      <a href="/"><img src="https://rubysec.com/images/rubysec-logo.png" width="80" height="80"></a>
      RubySec
    </h1>
    
      <p class="lead">Providing security resources for the Ruby community</p>
    
  </div>
</section>

      <div class="navbar">
  <div class="navbar-inner">
    <div class="container" style="width: auto;">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <div class="nav-collapse">
        <ul class="nav">
          <li><a href="/">Home</a></li>
          <li><a href="/advisories/archives">Advisories</a></li>
        </ul>
        
          <form action="https://www.google.com/search" method="get" class="navbar-search pull-left">
            <fieldset role="search">
              <input type="hidden" name="q" value="site:https://rubysec.com" />
              <input type="text" name="q" placeholder="Search" class="search-query span2" />
            </fieldset>
          </form>
        
        
      </div><!-- /.nav-collapse -->
    </div>
  </div><!-- /navbar-inner -->
</div>

    </header>
    <div id="main">
      <div id="content">
        <div class="row">
  
  <div class="span8">
    
  <header>
    
      <h1 class="entry-title">CVE-2022-21831 (activestorage): Possible code injection vulnerability in Rails / Active Storage</h1>
    
    
      <p class="meta">
        












<time datetime="2022-03-08T00:00:00+00:00" data-updated="true">

March 8th, 2022

</time>
      </p>
    
  </header>


  <div class="entry-content"><h3>ADVISORIES</h3>

<ul>

<li>
  <a href="https://www.cve.org/CVERecord?id=CVE-2022-21831">CVE-2022-21831</a>
  (<a href="https://nvd.nist.gov/vuln/detail/CVE-2022-21831">NVD</a>)
</li>



<li>
  <a href="https://github.com/advisories/GHSA-w749-p3v6-hccq">GHSA-w749-p3v6-hccq</a>
</li>





<li>
  <a href="https://groups.google.com/g/rubyonrails-security/c/n-p-W1yxatI">Vendor Advisory</a>
</li>

</ul>

<h3>GEM</h3>

<p>
<a href="https://rubygems.org/gems/activestorage">activestorage</a>
</p>




<h3>FRAMEWORK</h3>

<p>

  <a href="https://rubyonrails.org/">Ruby on Rails</a>

</p>





<h3>SEVERITY</h3>



<p><a href="https://www.first.org/cvss/">CVSS v3.x</a>: 9.8 (<span style="color: #D5011B;"><strong>Critical</strong></span>)</p>





<h3>UNAFFECTED VERSIONS</h3>

<ul>
  
  <li><kbd>&lt; 5.2.0</kbd></li>
  
</ul>


<h3>PATCHED VERSIONS</h3>


<ul>
  
  <li><kbd>~&gt; 5.2.6, &gt;= 5.2.6.3</kbd></li>
  
  <li><kbd>~&gt; 6.0.4, &gt;= 6.0.4.7</kbd></li>
  
  <li><kbd>~&gt; 6.1.4, &gt;= 6.1.4.7</kbd></li>
  
  <li><kbd>&gt;= 7.0.2.3</kbd></li>
  
</ul>


<h3>DESCRIPTION</h3>

<p>There is a possible code injection vulnerability in the Active Storage module
of Rails. This vulnerability has been assigned the CVE identifier
CVE-2022-21831.</p>

<p>Versions Affected:  &gt;= 5.2.0
Not affected:       &lt; 5.2.0
Fixed Versions:     7.0.2.3, 6.1.4.7, 6.0.4.7, 5.2.6.3</p>

<h2 id="impact">Impact</h2>
<p>There is a possible code injection vulnerability in the Active Storage module
of Rails.  This vulnerability impacts applications that use Active Storage
with the image_processing processing in addition to the mini_magick back end
for image_processing.</p>

<p>Vulnerable code will look something similar to this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="sx">%= image_tag blob.variant(params[:t] =</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">params</span><span class="p">[</span><span class="ss">:v</span><span class="p">])</span> <span class="o">%&amp;</span><span class="n">gt</span><span class="p">;</span>
</code></pre></div></div>

<p>Where the transformation method or its arguments are untrusted arbitrary
input.</p>

<p>All users running an affected release should either upgrade or use one of the
workarounds immediately.</p>

<h2 id="workarounds">Workarounds</h2>
<p>To work around this issue, applications should implement a strict allow-list
on accepted transformation methods or arguments.  Additionally, a strict image
magick security policy will help mitigate this issue.</p>

<p>https://imagemagick.org/script/security-policy.php</p>



</div>


    <footer>
      <p class="meta">
        
<span class="byline author vcard">Posted by <span class="fn">RubySec</span></span>

        












<time datetime="2022-03-08T00:00:00+00:00" data-updated="true">

March 8th, 2022

</time>
        
<span class="categories">
  
     â€¢
  
    
    
  
    
    
  
    
    
  




  
</span>


      </p>
      
        

<div class="sharing">
  <br/>
  <a rel="noopener noreferrer" href="https://twitter.com/intent/tweet/?text=CVE-2022-21831%20(activestorage):%20Possible%20code%20injection%20vulnerability%20in%20Rails%20/%20Active%20Storage&amp;url=https://rubysec.com/advisories/CVE-2022-21831/&quest;utm_source=advisory" target="_blank"><span aria-label="Twitter icon" role="img" class="icon-twitter-sign"></span></a>
  <a rel="noopener noreferrer" href="https://facebook.com/sharer/sharer.php?u=https://rubysec.com/advisories/CVE-2022-21831/&quest;utm_source=advisory" target="_blank"><span aria-label="Facebook icon" role="img" class="icon-facebook-sign"></span></a>
  <a rel="noopener noreferrer" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://rubysec.com/advisories/CVE-2022-21831/&quest;utm_source=advisory&amp;title=CVE-2022-21831%20(activestorage):%20Possible%20code%20injection%20vulnerability%20in%20Rails%20/%20Active%20Storage&amp;source=https://rubysec.com" target="_blank"><span aria-label="Linkedin icon" role="img" class="icon-linkedin-sign"></span></a>
  <a rel="noopener noreferrer" href="mailto:?subject=RubySec&amp;body=CVE-2022-21831%20(activestorage):%20Possible%20code%20injection%20vulnerability%20in%20Rails%20/%20Active%20Storage%20https://rubysec.com/advisories/CVE-2022-21831/&quest;utm_source=advisory" target="_blank"><span aria-label="Email icon" role="img" class="icon-envelope"></span></a>
</div>

      
      <p class="meta">
        
          <a class="basic-alignment pull-left" href="/advisories/GHSA-fmx4-26r3-wxpf/" title="Previous Post: GHSA-fmx4-26r3-wxpf (commonmarker): Integer overflow in cmark-gfm table parsing extension leads to heap memory corruption">&laquo; GHSA-fmx4-26r3-wxpf (commonmarker): Integer overflow in cmark-gfm table parsing extension leads to heap memory corruption</a>
        
        
          <a class="basic-alignment pull-right" href="/advisories/CVE-2021-3589/" title="Next Post: CVE-2021-3589 (foreman_ansible): Missing Authentication for Critical Function in Foreman Ansible">CVE-2021-3589 (foreman_ansible): Missing Authentication for Critical Function in Foreman Ansible &raquo;</a>
        
      </p>
    </footer>
  </div>

  
    
  <div class="span4 sidebar">
    <div class="well">
      Contact us <a href="https://twitter.com/rubysec">@rubysec</a> or <a href="https://github.com/rubysec/ruby-advisory-db">open an issue on our GitHub repository</a>.
    </div>
    <div class="well">
      <section>
        <h2>Recent Advisories</h2>
        <ul id="recent_posts">
          
            <li class="post">
              <a href="/advisories/CVE-2024-56733/">CVE-2024-56733 (pwpush): Password Pusher Allows Session Token Interception Leading to Potential Hijacking</a>
            </li>
          
            <li class="post">
              <a href="/advisories/CVE-2024-54133/">CVE-2024-54133 (actionpack): Possible Content Security Policy bypass in Action Dispatch</a>
            </li>
          
            <li class="post">
              <a href="/advisories/CVE-2024-53989/">CVE-2024-53989 (rails-html-sanitizer): rails-html-sanitizer has XSS vulnerability with certain configurations</a>
            </li>
          
            <li class="post">
              <a href="/advisories/CVE-2024-53988/">CVE-2024-53988 (rails-html-sanitizer): rails-html-sanitizer has XSS vulnerability with certain configurations</a>
            </li>
          
            <li class="post">
              <a href="/advisories/CVE-2024-53987/">CVE-2024-53987 (rails-html-sanitizer): rails-html-sanitizer has XSS vulnerability with certain configurations</a>
            </li>
          
        </ul>
      </section>
    </div>
  </div>


  
</div>

      </div>
    </div>
    <footer class="footer"><section class="footer">
  <div class="disclaimer">
    <p>Copyright &copy; 2024 - RubySec</p>
    <p class="acknowledgement">This domain was graciously donated by Jordi Massaguer.</p>
  </div>
</section>
</footer>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script src="/assets/bootstrap/js/bootstrap.min.js"></script>

  </div>
</body>
</html>
