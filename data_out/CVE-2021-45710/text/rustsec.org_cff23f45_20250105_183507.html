

RUSTSEC-2021-0124: tokio: Data race when sending and receiving after closing a `oneshot` channel › RustSec Advisory Database

#

[About](/)
[Advisories](/advisories/)
[Report Vulnerabilities](/contributing.html)

[History](https://github.com/RustSec/advisory-db/commits/main/crates/tokio/RUSTSEC-2021-0124.md) ⋅
[Edit](https://github.com/RustSec/advisory-db/edit/main/crates/tokio/RUSTSEC-2021-0124.md) ⋅
[JSON (OSV)](https://api.osv.dev/v1/vulns/RUSTSEC-2021-0124)

# RUSTSEC-2021-0124

Data race when sending and receiving after closing a `oneshot` channel

Reported
November 16, 2021

Issued
November 17, 2021

(last modified: June 13, 2023)

Package
[tokio](/packages/tokio.html)
([crates.io](https://crates.io/crates/tokio))

Type
Vulnerability

Categories

* [memory-corruption](/categories/memory-corruption.html)
* [thread-safety](/categories/thread-safety.html)

Keywords
[#race-condition](/keywords/race-condition.html)

Aliases

* [CVE-2021-45710](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45710)
* [GHSA-fg7r-2g4j-5cgr](https://github.com/advisories/GHSA-fg7r-2g4j-5cgr)

References

* <https://github.com/tokio-rs/tokio/issues/4225>

Patched

* `>=1.8.4, <1.9.0`
* `>=1.13.1`

Unaffected

* `<0.1.14`

Affected Functions
Version
`tokio::sync::oneshot::Receiver::close`

* `<=1.13.0, >=0.1.14`

### Description

If a `tokio::sync::oneshot` channel is closed (via the
[`oneshot::Receiver::close`](https://docs.rs/tokio/1.14.0/tokio/sync/oneshot/struct.Receiver.html#method.close) method), a data race may occur if the
`oneshot::Sender::send` method is called while the corresponding
`oneshot::Receiver` is `await`ed or calling `try_recv`.

When these methods are called concurrently on a closed channel, the two halves
of the channel can concurrently access a shared memory location, resulting in a
data race. This has been observed to [cause memory corruption](https://github.com/tokio-rs/tokio/issues/4225#issuecomment-967434847).

Note that the race only occurs when **both** halves of the channel are used
after the `Receiver` half has called `close`. Code where `close` is not used, or where the
`Receiver` is not `await`ed and `try_recv` is not called after calling `close`,
is not affected.

See [tokio#4225](https://github.com/tokio-rs/tokio/issues/4225) for more details.

Advisory available under [CC0-1.0](https://spdx.org/licenses/CC0-1.0.html)
license.

