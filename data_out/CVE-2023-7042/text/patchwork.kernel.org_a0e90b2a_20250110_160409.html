
Toggle navigation

[Patchwork](/)
Linux Wireless Mailing List

* [Patches](/project/linux-wireless/list/)
* [Bundles](/project/linux-wireless/bundles/)
* [About this project](/project/linux-wireless/)

* [Login](/user/login/)
* [Register](/register/)
* [Mail settings](/mail/)

13484758

[diff](/project/linux-wireless/patch/20231208043433.271449-1-hdthky0%40gmail.com/raw/ "Download patch diff")
[mbox](/project/linux-wireless/patch/20231208043433.271449-1-hdthky0%40gmail.com/mbox/ "Download patch mbox")
[series](/series/808099/mbox/ "Download patch mbox with dependencies")
# [v2] wifi: ath10k: fix NULL pointer dereference in ath10k\_wmi\_tlv\_op\_pull\_mgmt\_tx\_compl\_ev()

| Message ID | 20231208043433.271449-1-hdthky0@gmail.com ([mailing list archive](https://lore.kernel.org/linux-wireless/20231208043433.271449-1-hdthky0%40gmail.com/)) |
| --- | --- |
| State | Accepted |
| Commit | ad25ee36f00172f7d53242dc77c69fff7ced0755 |
| Delegated to: | Kalle Valo |
| Headers | show ``` Authentication-Results: smtp.subspace.kernel.org; 	dkim=pass (2048-bit key) header.d=gmail.com header.i=@gmail.com  header.b="l87m/mI8" Received: from mail-oo1-xc44.google.com (mail-oo1-xc44.google.com  [IPv6:2607:f8b0:4864:20::c44]) 	by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 2B1A0D54 	for <linux-wireless@vger.kernel.org>; Thu,  7 Dec 2023 20:34:41 -0800 (PST) Received: by mail-oo1-xc44.google.com with SMTP id  006d021491bc7-58d08497aa1so839894eaf.0         for <linux-wireless@vger.kernel.org>;  Thu, 07 Dec 2023 20:34:41 -0800 (PST) DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;         d=gmail.com; s=20230601; t=1702010080; x=1702614880;  darn=vger.kernel.org;         h=content-transfer-encoding:mime-version:message-id:date:subject:cc          :to:from:from:to:cc:subject:date:message-id:reply-to;         bh=MzdoGtdHZLEcq5pMBvJRDZhfXWWnoZDZDt/RPy/Z6xs=;         b=l87m/mI8PcZXZ0x2CFILn+q0LkL2M0RSj47bxlCFmbRPTfM0Lh9qusU/Cg+etqtgEa          Rkkqx1KVe6pDQL2wjCRcgy1PlrfKbtEvGPwzfNVFiqcNhQ4WxvqGJ/1jZiXhHphU/piU          lzj0WS7B/LFhgyyu0VWqCGoUH/YXgN2MrQog1wUgcgJvvfNQt0KSK/aHO5s/J/uUvl4o          LgQOm8Tdhd/XFERa2+QQ/ComwfJARZxtmH0rdk7flvfT5GgLD1INFNYiTWwPJ4eH2s8x          IyOyicfjeQnZa/KcvUyTFJVrfGldDZJoOkI1GUWAHKKahYfVC33v4+shkfwxgXOi5CGF          bD1Q== X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;         d=1e100.net; s=20230601; t=1702010080; x=1702614880;         h=content-transfer-encoding:mime-version:message-id:date:subject:cc          :to:from:x-gm-message-state:from:to:cc:subject:date:message-id          :reply-to;         bh=MzdoGtdHZLEcq5pMBvJRDZhfXWWnoZDZDt/RPy/Z6xs=;         b=HN4VwgKKgYmOg+S94xMT/eh82ZNhXdQTMqt1SxAXIJeuTwqAzwTG0g5GSsOkLxq8Rj          H8m+cjddivpi0i6AoebZTLMtwafi3jJ6IVc9wvGshGw8cWdcn1nbO38dacL7yv4PYzbq          bq9/fS4Lg7Tk61N4p9mT1/MZQC/H5uppamQWCPPiqOMiTC0SEmSOxtcMI69E9bNVDYt4          QFahMYBmUZ0q9JeSl53VWHW5nVGpDAIlf6Io5qAnQUh7Iu2xR/cvaNXo7rlD8rHOedjy          lFOkv3kRtWgR+x+HThGcgfrpCSOiiAZ5yolc4jWBMm4Ky6s0PZdvjrrryQo9EcXAVFlT          HuyA== X-Gm-Message-State: AOJu0Yxst4SCChZOSfQ18vq8g4KhHELgZxfv1ORgW5wZpCc85QpxtZDG 	3iteG3OFS4hEqzliy1HAIzk= X-Google-Smtp-Source:   AGHT+IHwbZG0kRlAsNtdu+0sGh4J/wEBGtXiM5SFj7ehSi0/JEn2pS/DRM/JW/QkcFKYJdOOCfAmRg== X-Received: by 2002:a05:6358:60c1:b0:170:8da:1f50 with SMTP id  i1-20020a05635860c100b0017008da1f50mr4060520rwi.20.1702010080287;         Thu, 07 Dec 2023 20:34:40 -0800 (PST) Received: from localhost ([113.88.15.172])         by smtp.gmail.com with ESMTPSA id  ff16-20020a056a002f5000b006ce65bf5376sm613293pfb.75.2023.12.07.20.34.39         (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);         Thu, 07 Dec 2023 20:34:39 -0800 (PST) From: Xingyuan Mo <hdthky0@gmail.com> To: Kalle Valo <kvalo@kernel.org>, 	Jeff Johnson <quic_jjohnson@quicinc.com>, 	ath10k@lists.infradead.org (open list:QUALCOMM ATHEROS ATH10K WIRELESS  DRIVER) Cc: linux-wireless@vger.kernel.org (open list:NETWORKING DRIVERS (WIRELESS)), 	Xingyuan Mo <hdthky0@gmail.com> Subject: [PATCH v2] wifi: ath10k: fix NULL pointer dereference in  ath10k_wmi_tlv_op_pull_mgmt_tx_compl_ev() Date: Fri,  8 Dec 2023 12:34:33 +0800 Message-Id: <20231208043433.271449-1-hdthky0@gmail.com> X-Mailer: git-send-email 2.34.1 Precedence: bulk X-Mailing-List: linux-wireless@vger.kernel.org List-Id: <linux-wireless.vger.kernel.org> List-Subscribe: <mailto:linux-wireless+subscribe@vger.kernel.org> List-Unsubscribe: <mailto:linux-wireless+unsubscribe@vger.kernel.org> MIME-Version: 1.0 Content-Transfer-Encoding: 8bit ``` |
| Series | [[v2] wifi: ath10k: fix NULL pointer dereference in ath10k\_wmi\_tlv\_op\_pull\_mgmt\_tx\_compl\_ev()](/project/linux-wireless/list/?series=808099) | expand   * [v2] wifi: ath10k: fix NULL pointer dereference in ath10k\_wmi\_tlv\_op\_pull\_mgmt\_tx\_compl\_ev() |

## Commit Message

[Xingyuan Mo](/project/linux-wireless/list/?submitter=208072)
Dec. 8, 2023, 4:34 a.m. UTC
```

We should check whether the WMI_TLV_TAG_STRUCT_MGMT_TX_COMPL_EVENT tlv is
present before accessing it, otherwise a null pointer deference error will
occur.

Fixes: dc405152bb64 ("ath10k: handle mgmt tx completion event")
Signed-off-by: Xingyuan Mo <hdthky0@gmail.com>
---
Compared with the previous version, Signed-off-by and Fixes tags are added.

 drivers/net/wireless/ath/ath10k/wmi-tlv.c | 4 ++++
 1 file changed, 4 insertions(+)

```
## Comments

[Jeff Johnson](/project/linux-wireless/list/?submitter=202839)
Dec. 11, 2023, 5:37 p.m. UTC | [#1](/comment/25632406/)
```

On 12/7/2023 8:34 PM, Xingyuan Mo wrote:
> We should check whether the WMI_TLV_TAG_STRUCT_MGMT_TX_COMPL_EVENT tlv is
> present before accessing it, otherwise a null pointer deference error will
> occur.
>
> Fixes: dc405152bb64 ("ath10k: handle mgmt tx completion event")
> Signed-off-by: Xingyuan Mo <hdthky0@gmail.com>
Acked-by: Jeff Johnson <quic_jjohnson@quicinc.com>

```

[Kalle Valo](/project/linux-wireless/list/?submitter=203753)
Dec. 18, 2023, 6:41 p.m. UTC | [#2](/comment/25643866/)
```

Xingyuan Mo <hdthky0@gmail.com> wrote:
> We should check whether the WMI_TLV_TAG_STRUCT_MGMT_TX_COMPL_EVENT tlv is
> present before accessing it, otherwise a null pointer deference error will
> occur.
>
> Fixes: dc405152bb64 ("ath10k: handle mgmt tx completion event")
> Signed-off-by: Xingyuan Mo <hdthky0@gmail.com>
> Acked-by: Jeff Johnson <quic_jjohnson@quicinc.com>
> Signed-off-by: Kalle Valo <quic_kvalo@quicinc.com>

Patch applied to ath-next branch of ath.git, thanks.

ad25ee36f001 wifi: ath10k: fix NULL pointer dereference in ath10k_wmi_tlv_op_pull_mgmt_tx_compl_ev()

```

13484758

[diff](/project/linux-wireless/patch/20231208043433.271449-1-hdthky0%40gmail.com/raw/ "Download patch diff")
[mbox](/project/linux-wireless/patch/20231208043433.271449-1-hdthky0%40gmail.com/mbox/ "Download patch mbox")
[series](/series/808099/mbox/ "Download patch mbox with dependencies")
## Patch

```

diff --git a/drivers/net/wireless/ath/ath10k/wmi-tlv.c b/drivers/net/wireless/ath/ath10k/wmi-tlv.c
index 6b6aa3c36744..0ce08e9a0a3d 100644
--- a/drivers/net/wireless/ath/ath10k/wmi-tlv.c
+++ b/drivers/net/wireless/ath/ath10k/wmi-tlv.c
@@ -851,6 +851,10 @@  ath10k_wmi_tlv_op_pull_mgmt_tx_compl_ev(struct ath10k *ar, struct sk_buff *skb,
 	}

 	ev = tb[WMI_TLV_TAG_STRUCT_MGMT_TX_COMPL_EVENT];
+	if (!ev) {
+		kfree(tb);
+		return -EPROTO;
+	}

 	arg->desc_id = ev->desc_id;
 	arg->status = ev->status;

```

[patchwork](http://jk.ozlabs.org/projects/patchwork/)
patch tracking system | version v2.2.6 | [about patchwork](/about/)

