=== Content from git.kernel.org_e1d58cda_20250111_190213.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2e0e072e62fdaf7816220af08e05c020f0fcb77a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2e0e072e62fdaf7816220af08e05c020f0fcb77a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2e0e072e62fdaf7816220af08e05c020f0fcb77a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2e0e072e62fdaf7816220af08e05c020f0fcb77a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jianglei Nie <niejianglei2021@163.com> | 2021-12-09 14:15:11 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 14:49:00 +0100 |
| commit | [2e0e072e62fdaf7816220af08e05c020f0fcb77a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2e0e072e62fdaf7816220af08e05c020f0fcb77a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2e0e072e62fdaf7816220af08e05c020f0fcb77a)) | |
| tree | [7b345cd4d4fb6c20a01391df561c9cbfe5865554](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2e0e072e62fdaf7816220af08e05c020f0fcb77a) | |
| parent | [3db6482523eabf7f3011e5cce3ceb8b7433417b7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3db6482523eabf7f3011e5cce3ceb8b7433417b7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2e0e072e62fdaf7816220af08e05c020f0fcb77a&id2=3db6482523eabf7f3011e5cce3ceb8b7433417b7)) | |
| download | [linux-2e0e072e62fdaf7816220af08e05c020f0fcb77a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2e0e072e62fdaf7816220af08e05c020f0fcb77a.tar.gz) | |

nfp: Fix memory leak in nfp\_cpp\_area\_cache\_add()commit c56c96303e9289cc34716b1179597b6f470833de upstream.
In line 800 (#1), nfp\_cpp\_area\_alloc() allocates and initializes a
CPP area structure. But in line 807 (#2), when the cache is allocated
failed, this CPP area structure is not freed, which will result in
memory leak.
We can fix it by freeing the CPP area when the cache is allocated
failed (#2).
792 int nfp\_cpp\_area\_cache\_add(struct nfp\_cpp \*cpp, size\_t size)
793 {
794 struct nfp\_cpp\_area\_cache \*cache;
795 struct nfp\_cpp\_area \*area;
800 area = nfp\_cpp\_area\_alloc(cpp, NFP\_CPP\_ID(7, NFP\_CPP\_ACTION\_RW, 0),
801 0, size);
// #1: allocates and initializes
802 if (!area)
803 return -ENOMEM;
805 cache = kzalloc(sizeof(\*cache), GFP\_KERNEL);
806 if (!cache)
807 return -ENOMEM; // #2: missing free
817 return 0;
818 }
Fixes: 4cb584e0ee7d ("nfp: add CPP access core")
Signed-off-by: Jianglei Nie <niejianglei2021@163.com>
Acked-by: Simon Horman <simon.horman@corigine.com>
Link: [https://lore.kernel.org/r/20211209061511.122535-1-niejianglei2021@163.com](https://lore.kernel.org/r/20211209061511.122535-1-niejianglei2021%40163.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2e0e072e62fdaf7816220af08e05c020f0fcb77a)

| -rw-r--r-- | [drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=2e0e072e62fdaf7816220af08e05c020f0fcb77a) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c b/drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.cindex 94994a939277b6..6ef48eb3a77d43 100644--- a/[drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=3db6482523eabf7f3011e5cce3ceb8b7433417b7)+++ b/[drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=2e0e072e62fdaf7816220af08e05c020f0fcb77a)@@ -803,8 +803,10 @@ int nfp\_cpp\_area\_cache\_add(struct nfp\_cpp \*cpp, size\_t size) return -ENOMEM;  cache = kzalloc(sizeof(\*cache), GFP\_KERNEL);- if (!cache)+ if (!cache) {+ nfp\_cpp\_area\_free(area); return -ENOMEM;+ }  cache->id = 0; cache->addr = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 19:00:51 +0000



=== Content from git.kernel.org_25761287_20250111_190216.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=484069b5de9d223cc1c64c6f80389a99cfef51f1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=484069b5de9d223cc1c64c6f80389a99cfef51f1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=484069b5de9d223cc1c64c6f80389a99cfef51f1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=484069b5de9d223cc1c64c6f80389a99cfef51f1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jianglei Nie <niejianglei2021@163.com> | 2021-12-09 14:15:11 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 11:32:36 +0100 |
| commit | [484069b5de9d223cc1c64c6f80389a99cfef51f1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=484069b5de9d223cc1c64c6f80389a99cfef51f1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=484069b5de9d223cc1c64c6f80389a99cfef51f1)) | |
| tree | [2c0fd094f3a87abaeb775d08eb9afa578e509894](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=484069b5de9d223cc1c64c6f80389a99cfef51f1) | |
| parent | [b1830ede16f87009671760f8248b48f5a92431a9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b1830ede16f87009671760f8248b48f5a92431a9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=484069b5de9d223cc1c64c6f80389a99cfef51f1&id2=b1830ede16f87009671760f8248b48f5a92431a9)) | |
| download | [linux-484069b5de9d223cc1c64c6f80389a99cfef51f1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-484069b5de9d223cc1c64c6f80389a99cfef51f1.tar.gz) | |

nfp: Fix memory leak in nfp\_cpp\_area\_cache\_add()commit c56c96303e9289cc34716b1179597b6f470833de upstream.
In line 800 (#1), nfp\_cpp\_area\_alloc() allocates and initializes a
CPP area structure. But in line 807 (#2), when the cache is allocated
failed, this CPP area structure is not freed, which will result in
memory leak.
We can fix it by freeing the CPP area when the cache is allocated
failed (#2).
792 int nfp\_cpp\_area\_cache\_add(struct nfp\_cpp \*cpp, size\_t size)
793 {
794 struct nfp\_cpp\_area\_cache \*cache;
795 struct nfp\_cpp\_area \*area;
800 area = nfp\_cpp\_area\_alloc(cpp, NFP\_CPP\_ID(7, NFP\_CPP\_ACTION\_RW, 0),
801 0, size);
// #1: allocates and initializes
802 if (!area)
803 return -ENOMEM;
805 cache = kzalloc(sizeof(\*cache), GFP\_KERNEL);
806 if (!cache)
807 return -ENOMEM; // #2: missing free
817 return 0;
818 }
Fixes: 4cb584e0ee7d ("nfp: add CPP access core")
Signed-off-by: Jianglei Nie <niejianglei2021@163.com>
Acked-by: Simon Horman <simon.horman@corigine.com>
Link: [https://lore.kernel.org/r/20211209061511.122535-1-niejianglei2021@163.com](https://lore.kernel.org/r/20211209061511.122535-1-niejianglei2021%40163.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=484069b5de9d223cc1c64c6f80389a99cfef51f1)

| -rw-r--r-- | [drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=484069b5de9d223cc1c64c6f80389a99cfef51f1) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c b/drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.cindex 94994a939277b6..6ef48eb3a77d43 100644--- a/[drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=b1830ede16f87009671760f8248b48f5a92431a9)+++ b/[drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=484069b5de9d223cc1c64c6f80389a99cfef51f1)@@ -803,8 +803,10 @@ int nfp\_cpp\_area\_cache\_add(struct nfp\_cpp \*cpp, size\_t size) return -ENOMEM;  cache = kzalloc(sizeof(\*cache), GFP\_KERNEL);- if (!cache)+ if (!cache) {+ nfp\_cpp\_area\_free(area); return -ENOMEM;+ }  cache->id = 0; cache->addr = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 19:00:53 +0000



=== Content from git.kernel.org_d2b44d1e_20250111_190217.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c56c96303e9289cc34716b1179597b6f470833de)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c56c96303e9289cc34716b1179597b6f470833de)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c56c96303e9289cc34716b1179597b6f470833de)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c56c96303e9289cc34716b1179597b6f470833de)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jianglei Nie <niejianglei2021@163.com> | 2021-12-09 14:15:11 +0800 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2021-12-09 07:53:33 -0800 |
| commit | [c56c96303e9289cc34716b1179597b6f470833de](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c56c96303e9289cc34716b1179597b6f470833de) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c56c96303e9289cc34716b1179597b6f470833de)) | |
| tree | [160e5833a78edd84b92625bd6cc7a4f45e144240](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c56c96303e9289cc34716b1179597b6f470833de) | |
| parent | [4cd8371a234d051f9c9557fcbb1f8c523b1c0d10](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4cd8371a234d051f9c9557fcbb1f8c523b1c0d10) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c56c96303e9289cc34716b1179597b6f470833de&id2=4cd8371a234d051f9c9557fcbb1f8c523b1c0d10)) | |
| download | [linux-c56c96303e9289cc34716b1179597b6f470833de.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c56c96303e9289cc34716b1179597b6f470833de.tar.gz) | |

nfp: Fix memory leak in nfp\_cpp\_area\_cache\_add()In line 800 (#1), nfp\_cpp\_area\_alloc() allocates and initializes a
CPP area structure. But in line 807 (#2), when the cache is allocated
failed, this CPP area structure is not freed, which will result in
memory leak.
We can fix it by freeing the CPP area when the cache is allocated
failed (#2).
792 int nfp\_cpp\_area\_cache\_add(struct nfp\_cpp \*cpp, size\_t size)
793 {
794 struct nfp\_cpp\_area\_cache \*cache;
795 struct nfp\_cpp\_area \*area;
800 area = nfp\_cpp\_area\_alloc(cpp, NFP\_CPP\_ID(7, NFP\_CPP\_ACTION\_RW, 0),
801 0, size);
// #1: allocates and initializes
802 if (!area)
803 return -ENOMEM;
805 cache = kzalloc(sizeof(\*cache), GFP\_KERNEL);
806 if (!cache)
807 return -ENOMEM; // #2: missing free
817 return 0;
818 }
Fixes: 4cb584e0ee7d ("nfp: add CPP access core")
Signed-off-by: Jianglei Nie <niejianglei2021@163.com>
Acked-by: Simon Horman <simon.horman@corigine.com>
Link: [https://lore.kernel.org/r/20211209061511.122535-1-niejianglei2021@163.com](https://lore.kernel.org/r/20211209061511.122535-1-niejianglei2021%40163.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c56c96303e9289cc34716b1179597b6f470833de)

| -rw-r--r-- | [drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=c56c96303e9289cc34716b1179597b6f470833de) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c b/drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.cindex d7ac0307797fd8..34c0d2ddf9ef6a 100644--- a/[drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=4cd8371a234d051f9c9557fcbb1f8c523b1c0d10)+++ b/[drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=c56c96303e9289cc34716b1179597b6f470833de)@@ -803,8 +803,10 @@ int nfp\_cpp\_area\_cache\_add(struct nfp\_cpp \*cpp, size\_t size) return -ENOMEM;  cache = kzalloc(sizeof(\*cache), GFP\_KERNEL);- if (!cache)+ if (!cache) {+ nfp\_cpp\_area\_free(area); return -ENOMEM;+ }  cache->id = 0; cache->addr = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 19:00:54 +0000



=== Content from git.kernel.org_085af893_20250111_190219.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f707820c09239d6f67699d9b2ff57863cc7905b0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f707820c09239d6f67699d9b2ff57863cc7905b0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f707820c09239d6f67699d9b2ff57863cc7905b0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f707820c09239d6f67699d9b2ff57863cc7905b0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jianglei Nie <niejianglei2021@163.com> | 2021-12-09 14:15:11 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 10:57:09 +0100 |
| commit | [f707820c09239d6f67699d9b2ff57863cc7905b0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f707820c09239d6f67699d9b2ff57863cc7905b0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f707820c09239d6f67699d9b2ff57863cc7905b0)) | |
| tree | [c3bd9bacb05823f731c72021811914ac4c291743](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f707820c09239d6f67699d9b2ff57863cc7905b0) | |
| parent | [6dada2646a0abd81f4c1141a47f2786db6f85cd2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6dada2646a0abd81f4c1141a47f2786db6f85cd2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f707820c09239d6f67699d9b2ff57863cc7905b0&id2=6dada2646a0abd81f4c1141a47f2786db6f85cd2)) | |
| download | [linux-f707820c09239d6f67699d9b2ff57863cc7905b0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f707820c09239d6f67699d9b2ff57863cc7905b0.tar.gz) | |

nfp: Fix memory leak in nfp\_cpp\_area\_cache\_add()commit c56c96303e9289cc34716b1179597b6f470833de upstream.
In line 800 (#1), nfp\_cpp\_area\_alloc() allocates and initializes a
CPP area structure. But in line 807 (#2), when the cache is allocated
failed, this CPP area structure is not freed, which will result in
memory leak.
We can fix it by freeing the CPP area when the cache is allocated
failed (#2).
792 int nfp\_cpp\_area\_cache\_add(struct nfp\_cpp \*cpp, size\_t size)
793 {
794 struct nfp\_cpp\_area\_cache \*cache;
795 struct nfp\_cpp\_area \*area;
800 area = nfp\_cpp\_area\_alloc(cpp, NFP\_CPP\_ID(7, NFP\_CPP\_ACTION\_RW, 0),
801 0, size);
// #1: allocates and initializes
802 if (!area)
803 return -ENOMEM;
805 cache = kzalloc(sizeof(\*cache), GFP\_KERNEL);
806 if (!cache)
807 return -ENOMEM; // #2: missing free
817 return 0;
818 }
Fixes: 4cb584e0ee7d ("nfp: add CPP access core")
Signed-off-by: Jianglei Nie <niejianglei2021@163.com>
Acked-by: Simon Horman <simon.horman@corigine.com>
Link: [https://lore.kernel.org/r/20211209061511.122535-1-niejianglei2021@163.com](https://lore.kernel.org/r/20211209061511.122535-1-niejianglei2021%40163.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f707820c09239d6f67699d9b2ff57863cc7905b0)

| -rw-r--r-- | [drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=f707820c09239d6f67699d9b2ff57863cc7905b0) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c b/drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.cindex d7ac0307797fd8..34c0d2ddf9ef6a 100644--- a/[drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=6dada2646a0abd81f4c1141a47f2786db6f85cd2)+++ b/[drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=f707820c09239d6f67699d9b2ff57863cc7905b0)@@ -803,8 +803,10 @@ int nfp\_cpp\_area\_cache\_add(struct nfp\_cpp \*cpp, size\_t size) return -ENOMEM;  cache = kzalloc(sizeof(\*cache), GFP\_KERNEL);- if (!cache)+ if (!cache) {+ nfp\_cpp\_area\_free(area); return -ENOMEM;+ }  cache->id = 0; cache->addr = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 19:00:57 +0000



=== Content from git.kernel.org_49ea016b_20250111_190215.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3e93abcdcec0436fbf0b6a88ae806902426895a2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3e93abcdcec0436fbf0b6a88ae806902426895a2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3e93abcdcec0436fbf0b6a88ae806902426895a2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3e93abcdcec0436fbf0b6a88ae806902426895a2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jianglei Nie <niejianglei2021@163.com> | 2021-12-09 14:15:11 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 10:16:54 +0100 |
| commit | [3e93abcdcec0436fbf0b6a88ae806902426895a2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3e93abcdcec0436fbf0b6a88ae806902426895a2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3e93abcdcec0436fbf0b6a88ae806902426895a2)) | |
| tree | [28de6f7c9e60ed035a131cd78a089f6ee6831865](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3e93abcdcec0436fbf0b6a88ae806902426895a2) | |
| parent | [e0d837ac05701a1a05c76f50647cf249d4871362](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e0d837ac05701a1a05c76f50647cf249d4871362) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3e93abcdcec0436fbf0b6a88ae806902426895a2&id2=e0d837ac05701a1a05c76f50647cf249d4871362)) | |
| download | [linux-3e93abcdcec0436fbf0b6a88ae806902426895a2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3e93abcdcec0436fbf0b6a88ae806902426895a2.tar.gz) | |

nfp: Fix memory leak in nfp\_cpp\_area\_cache\_add()commit c56c96303e9289cc34716b1179597b6f470833de upstream.
In line 800 (#1), nfp\_cpp\_area\_alloc() allocates and initializes a
CPP area structure. But in line 807 (#2), when the cache is allocated
failed, this CPP area structure is not freed, which will result in
memory leak.
We can fix it by freeing the CPP area when the cache is allocated
failed (#2).
792 int nfp\_cpp\_area\_cache\_add(struct nfp\_cpp \*cpp, size\_t size)
793 {
794 struct nfp\_cpp\_area\_cache \*cache;
795 struct nfp\_cpp\_area \*area;
800 area = nfp\_cpp\_area\_alloc(cpp, NFP\_CPP\_ID(7, NFP\_CPP\_ACTION\_RW, 0),
801 0, size);
// #1: allocates and initializes
802 if (!area)
803 return -ENOMEM;
805 cache = kzalloc(sizeof(\*cache), GFP\_KERNEL);
806 if (!cache)
807 return -ENOMEM; // #2: missing free
817 return 0;
818 }
Fixes: 4cb584e0ee7d ("nfp: add CPP access core")
Signed-off-by: Jianglei Nie <niejianglei2021@163.com>
Acked-by: Simon Horman <simon.horman@corigine.com>
Link: [https://lore.kernel.org/r/20211209061511.122535-1-niejianglei2021@163.com](https://lore.kernel.org/r/20211209061511.122535-1-niejianglei2021%40163.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3e93abcdcec0436fbf0b6a88ae806902426895a2)

| -rw-r--r-- | [drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=3e93abcdcec0436fbf0b6a88ae806902426895a2) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c b/drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.cindex 04dd5758ecf542..62ee0bcf241306 100644--- a/[drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=e0d837ac05701a1a05c76f50647cf249d4871362)+++ b/[drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=3e93abcdcec0436fbf0b6a88ae806902426895a2)@@ -787,8 +787,10 @@ int nfp\_cpp\_area\_cache\_add(struct nfp\_cpp \*cpp, size\_t size) return -ENOMEM;  cache = kzalloc(sizeof(\*cache), GFP\_KERNEL);- if (!cache)+ if (!cache) {+ nfp\_cpp\_area\_free(area); return -ENOMEM;+ }  cache->id = 0; cache->addr = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 19:00:52 +0000



=== Content from git.kernel.org_559960d5_20250111_190218.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=eb51f639ef3fd5498b7def290ed8681b6aadd9a7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=eb51f639ef3fd5498b7def290ed8681b6aadd9a7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eb51f639ef3fd5498b7def290ed8681b6aadd9a7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eb51f639ef3fd5498b7def290ed8681b6aadd9a7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jianglei Nie <niejianglei2021@163.com> | 2021-12-09 14:15:11 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 10:18:05 +0100 |
| commit | [eb51f639ef3fd5498b7def290ed8681b6aadd9a7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eb51f639ef3fd5498b7def290ed8681b6aadd9a7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=eb51f639ef3fd5498b7def290ed8681b6aadd9a7)) | |
| tree | [6964b659324d647f0cdda21496fbca09bc0bde2f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=eb51f639ef3fd5498b7def290ed8681b6aadd9a7) | |
| parent | [f1a3e17508065beb32ab53aedbe21eb0e7ac7fad](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f1a3e17508065beb32ab53aedbe21eb0e7ac7fad) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eb51f639ef3fd5498b7def290ed8681b6aadd9a7&id2=f1a3e17508065beb32ab53aedbe21eb0e7ac7fad)) | |
| download | [linux-eb51f639ef3fd5498b7def290ed8681b6aadd9a7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-eb51f639ef3fd5498b7def290ed8681b6aadd9a7.tar.gz) | |

nfp: Fix memory leak in nfp\_cpp\_area\_cache\_add()commit c56c96303e9289cc34716b1179597b6f470833de upstream.
In line 800 (#1), nfp\_cpp\_area\_alloc() allocates and initializes a
CPP area structure. But in line 807 (#2), when the cache is allocated
failed, this CPP area structure is not freed, which will result in
memory leak.
We can fix it by freeing the CPP area when the cache is allocated
failed (#2).
792 int nfp\_cpp\_area\_cache\_add(struct nfp\_cpp \*cpp, size\_t size)
793 {
794 struct nfp\_cpp\_area\_cache \*cache;
795 struct nfp\_cpp\_area \*area;
800 area = nfp\_cpp\_area\_alloc(cpp, NFP\_CPP\_ID(7, NFP\_CPP\_ACTION\_RW, 0),
801 0, size);
// #1: allocates and initializes
802 if (!area)
803 return -ENOMEM;
805 cache = kzalloc(sizeof(\*cache), GFP\_KERNEL);
806 if (!cache)
807 return -ENOMEM; // #2: missing free
817 return 0;
818 }
Fixes: 4cb584e0ee7d ("nfp: add CPP access core")
Signed-off-by: Jianglei Nie <niejianglei2021@163.com>
Acked-by: Simon Horman <simon.horman@corigine.com>
Link: [https://lore.kernel.org/r/20211209061511.122535-1-niejianglei2021@163.com](https://lore.kernel.org/r/20211209061511.122535-1-niejianglei2021%40163.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eb51f639ef3fd5498b7def290ed8681b6aadd9a7)

| -rw-r--r-- | [drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=eb51f639ef3fd5498b7def290ed8681b6aadd9a7) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c b/drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.cindex 73de57a09800d7..4e417f839c3f08 100644--- a/[drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=f1a3e17508065beb32ab53aedbe21eb0e7ac7fad)+++ b/[drivers/net/ethernet/netronome/nfp/nfpcore/nfp\_cppcore.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cppcore.c?id=eb51f639ef3fd5498b7def290ed8681b6aadd9a7)@@ -803,8 +803,10 @@ int nfp\_cpp\_area\_cache\_add(struct nfp\_cpp \*cpp, size\_t size) return -ENOMEM;  cache = kzalloc(sizeof(\*cache), GFP\_KERNEL);- if (!cache)+ if (!cache) {+ nfp\_cpp\_area\_free(area); return -ENOMEM;+ }  cache->id = 0; cache->addr = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 19:00:55 +0000


