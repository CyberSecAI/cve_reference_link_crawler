

[Skip to main content](#content)

#### Stack Exchange Network

Stack Exchange network consists of 183 Q&A communities including [Stack Overflow](https://stackoverflow.com), the largest, most trusted online community for developers to learn, share their knowledge, and build their careers.

[Visit Stack Exchange](https://stackexchange.com)

Loading…

* [Tour
  Start here for a quick overview of the site](/tour)
* [Help Center
  Detailed answers to any questions you might have](/help)
* [Meta
  Discuss the workings and policies of this site](https://robotics.meta.stackexchange.com)
* [About Us
  Learn more about Stack Overflow the company, and our products](https://stackoverflow.co/)

4. ### [current community](https://robotics.stackexchange.com)

   * [Robotics](https://robotics.stackexchange.com)

     [help](https://robotics.stackexchange.com/help)
     [chat](https://chat.stackexchange.com?tab=site&host=robotics.stackexchange.com)
   * [Robotics Meta](https://robotics.meta.stackexchange.com)
   ### your communities

   [Sign up](https://robotics.stackexchange.com/users/signup?ssrc=site_switcher&returnurl=https%3a%2f%2frobotics.stackexchange.com%2fquestions%2f106008%2fros2nav2-user-misconfiguration-of-parameters-may-bring-abnormal-memory-usage) or [log in](https://robotics.stackexchange.com/users/login?ssrc=site_switcher&returnurl=https%3a%2f%2frobotics.stackexchange.com%2fquestions%2f106008%2fros2nav2-user-misconfiguration-of-parameters-may-bring-abnormal-memory-usage) to customize your list.

   ### [more stack exchange communities](https://stackexchange.com/sites)

   [company blog](https://stackoverflow.blog)
6. [Log in](https://robotics.stackexchange.com/users/login?ssrc=head&returnurl=https%3a%2f%2frobotics.stackexchange.com%2fquestions%2f106008%2fros2nav2-user-misconfiguration-of-parameters-may-bring-abnormal-memory-usage)
7. [Sign up](https://robotics.stackexchange.com/users/signup?ssrc=head&returnurl=https%3a%2f%2frobotics.stackexchange.com%2fquestions%2f106008%2fros2nav2-user-misconfiguration-of-parameters-may-bring-abnormal-memory-usage)

[Robotics](https://robotics.stackexchange.com)

1. 1. [Home](/)
   2. [Questions](/questions)
   3. [Tags](/tags)
   5. [Users](/users)
   6. [Jobs](/jobs?source=so-left-nav)
   7. [Companies](https://stackoverflow.com/jobs/companies?so_medium=robotics&so_source=SiteNav)
   8. [Unanswered](/unanswered)
2. Teams
   ![](https://cdn.sstatic.net/Img/teams/teams-promo.svg?v=e507948b81bf)

   Ask questions, find answers and collaborate at work with Stack Overflow for Teams.

   [Try Teams for free](https://stackoverflowteams.com/teams/create/free/?utm_medium=referral&utm_source=robotics-community&utm_campaign=side-bar&utm_content=explore-teams)
   [Explore Teams](https://stackoverflow.co/teams/?utm_medium=referral&utm_source=robotics-community&utm_campaign=side-bar&utm_content=explore-teams)
3. Teams
4. Ask questions, find answers and collaborate at work with Stack Overflow for Teams.
   [Explore Teams](https://stackoverflow.co/teams/?utm_medium=referral&utm_source=robotics-community&utm_campaign=side-bar&utm_content=explore-teams-compact)

**Teams**

Q&A for work

Connect and share knowledge within a single location that is structured and easy to search.

[Learn more about Teams](https://stackoverflow.co/teams/)

# [[ROS2][NAV2] User misconfiguration of parameters may bring abnormal memory usage](/questions/106008/ros2nav2-user-misconfiguration-of-parameters-may-bring-abnormal-memory-usage)

[Ask Question](/questions/ask)

Asked
1 year, 1 month ago

Modified
[1 year ago](?lastactivity "2023-12-13 09:14:28Z")

Viewed
370 times

0

$\begingroup$
## Description

#### Based on:

* Operating System:
  + Ubuntu 22.04
* ROS2 Version:
  + humble
* Nav2 Version:
  + humble

#### Steps to reproduce issue

launch the navigation2 within defaulted `tb3_simulation_launch.py` as following commands

```
source install/setup.bash
source /opt/ros/humble/setup.bash
export TURTLEBOT3_MODEL=waffle
export GAZEBO_MODEL_PATH=$GAZEBO_MODEL_PATH:/opt/ros/humble/share/turtlebot3_gazebo/models
ros2 launch nav2_bringup tb3_simulation_launch.py params_file:=my_nav2_params.yaml

```

there's the content of `my_nav2_params.yaml`

```
amcl:
  ros__parameters:
    alpha1: 0.2
    alpha2: 0.2
    alpha3: 0.2
    alpha4: 0.2
    alpha5: 0.2
    base_frame_id: "base_footprint"
    beam_skip_distance: 0.5
    beam_skip_error_threshold: 0.9
    beam_skip_threshold: 0.3
    do_beamskip: false
    global_frame_id: "map"
    lambda_short: 0.1
    laser_likelihood_max_dist: 2.0
    laser_max_range: 100.0
    laser_min_range: -1.0
    laser_model_type: "likelihood_field"
    max_beams: 60
    max_particles: 2000
    min_particles: 500
    odom_frame_id: "odom"
    pf_err: 0.05
    pf_z: 0.99
    recovery_alpha_fast: 0.0
    recovery_alpha_slow: 0.0
    resample_interval: 1
    robot_model_type: "nav2_amcl::DifferentialMotionModel"
    save_pose_rate: 0.5
    sigma_hit: 0.2
    tf_broadcast: true
    transform_tolerance: 1.0
    update_min_a: 0.2
    update_min_d: 0.25
    z_hit: 0.5
    z_max: 0.05
    z_rand: 0.5
    z_short: 0.05
    scan_topic: scan

bt_navigator:
  ros__parameters:
    global_frame: map
    robot_base_frame: base_link
    odom_topic: /odom
    bt_loop_duration: 10
    default_server_timeout: 20
    wait_for_service_timeout: 1000
    action_server_result_timeout: 900.0
    navigators: ["navigate_to_pose", "navigate_through_poses"]
    navigate_to_pose:
      plugin: "nav2_bt_navigator/NavigateToPoseNavigator"
    navigate_through_poses:
      plugin: "nav2_bt_navigator/NavigateThroughPosesNavigator"
    # 'default_nav_through_poses_bt_xml' and 'default_nav_to_pose_bt_xml' are use defaults:
    # nav2_bt_navigator/navigate_to_pose_w_replanning_and_recovery.xml
    # nav2_bt_navigator/navigate_through_poses_w_replanning_and_recovery.xml
    # They can be set here or via a RewrittenYaml remap from a parent launch file to Nav2.
    plugin_lib_names:
      - nav2_compute_path_to_pose_action_bt_node
      - nav2_compute_path_through_poses_action_bt_node
      - nav2_smooth_path_action_bt_node
      - nav2_follow_path_action_bt_node
      - nav2_spin_action_bt_node
      - nav2_wait_action_bt_node
      - nav2_assisted_teleop_action_bt_node
      - nav2_back_up_action_bt_node
      - nav2_drive_on_heading_bt_node
      - nav2_clear_costmap_service_bt_node
      - nav2_is_stuck_condition_bt_node
      - nav2_goal_reached_condition_bt_node
      - nav2_goal_updated_condition_bt_node
      - nav2_globally_updated_goal_condition_bt_node
      - nav2_is_path_valid_condition_bt_node
      - nav2_are_error_codes_active_condition_bt_node
      - nav2_would_a_controller_recovery_help_condition_bt_node
      - nav2_would_a_planner_recovery_help_condition_bt_node
      - nav2_would_a_smoother_recovery_help_condition_bt_node
      - nav2_initial_pose_received_condition_bt_node
      - nav2_reinitialize_global_localization_service_bt_node
      - nav2_rate_controller_bt_node
      - nav2_distance_controller_bt_node
      - nav2_speed_controller_bt_node
      - nav2_truncate_path_action_bt_node
      - nav2_truncate_path_local_action_bt_node
      - nav2_goal_updater_node_bt_node
      - nav2_recovery_node_bt_node
      - nav2_pipeline_sequence_bt_node
      - nav2_round_robin_node_bt_node
      - nav2_transform_available_condition_bt_node
      - nav2_time_expired_condition_bt_node
      - nav2_path_expiring_timer_condition
      - nav2_distance_traveled_condition_bt_node
      - nav2_single_trigger_bt_node
      - nav2_goal_updated_controller_bt_node
      - nav2_is_battery_low_condition_bt_node
      - nav2_navigate_through_poses_action_bt_node
      - nav2_navigate_to_pose_action_bt_node
      - nav2_remove_passed_goals_action_bt_node
      - nav2_planner_selector_bt_node
      - nav2_controller_selector_bt_node
      - nav2_goal_checker_selector_bt_node
      - nav2_controller_cancel_bt_node
      - nav2_path_longer_on_approach_bt_node
      - nav2_wait_cancel_bt_node
      - nav2_spin_cancel_bt_node
      - nav2_back_up_cancel_bt_node
      - nav2_assisted_teleop_cancel_bt_node
      - nav2_drive_on_heading_cancel_bt_node
      - nav2_is_battery_charging_condition_bt_node
    error_code_names:
      - compute_path_error_code
      - follow_path_error_code

controller_server:
  ros__parameters:
    controller_frequency: 20.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    failure_tolerance: 0.3
    progress_checker_plugins: ["progress_checker"]
    goal_checker_plugins: ["general_goal_checker"] # "precise_goal_checker"
    controller_plugins: ["FollowPath"]
    use_realtime_priority: false

    # Progress checker parameters
    progress_checker:
      plugin: "nav2_controller::SimpleProgressChecker"
      required_movement_radius: 0.5
      movement_time_allowance: 10.0
    # Goal checker parameters
    #precise_goal_checker:
    #  plugin: "nav2_controller::SimpleGoalChecker"
    #  xy_goal_tolerance: 0.25
    #  yaw_goal_tolerance: 0.25
    #  stateful: True
    general_goal_checker:
      stateful: True
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.25
      yaw_goal_tolerance: 0.25
    # DWB parameters
    FollowPath:
      plugin: "dwb_core::DWBLocalPlanner"
      debug_trajectory_details: True
      min_vel_x: 0.0
      min_vel_y: 0.0
      max_vel_x: 0.26
      max_vel_y: 0.0
      max_vel_theta: 1.0
      min_speed_xy: 0.0
      max_speed_xy: 0.26
      min_speed_theta: 0.0
      # Add high threshold velocity for turtlebot 3 issue.
      # https://github.com/ROBOTIS-GIT/turtlebot3_simulations/issues/75
      acc_lim_x: 2.5
      acc_lim_y: 0.0
      acc_lim_theta: 3.2
      decel_lim_x: -2.5
      decel_lim_y: 0.0
      decel_lim_theta: -3.2
      vx_samples: 20
      vy_samples: 5
      vtheta_samples: 20
      sim_time: 1.7
      linear_granularity: 0.05
      angular_granularity: 0.025
      transform_tolerance: 0.2
      xy_goal_tolerance: 0.25
      trans_stopped_velocity: 0.25
      short_circuit_trajectory_evaluation: True
      stateful: True
      critics: ["RotateToGoal", "Oscillation", "BaseObstacle", "GoalAlign", "PathAlign", "PathDist", "GoalDist"]
      BaseObstacle.scale: 0.02
      PathAlign.scale: 32.0
      PathAlign.forward_point_distance: 0.1
      GoalAlign.scale: 24.0
      GoalAlign.forward_point_distance: 0.1
      PathDist.scale: 32.0
      GoalDist.scale: 24.0
      RotateToGoal.scale: 32.0
      RotateToGoal.slowing_factor: 5.0
      RotateToGoal.lookahead_time: -1.0

local_costmap:
  local_costmap:
    ros__parameters:
      update_frequency: 5.0
      publish_frequency: 2.0
      global_frame: odom
      robot_base_frame: base_link
      rolling_window: true
      width: 3
      height: -20
      resolution: 0.05
      robot_radius: 0.22
      plugins: ["voxel_layer", "inflation_layer"]
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        cost_scaling_factor: 3.0
        inflation_radius: 0.55
      voxel_layer:
        plugin: "nav2_costmap_2d::VoxelLayer"
        enabled: True
        publish_voxel_map: True
        origin_z: 0.0
        z_resolution: 0.05
        z_voxels: 16
        max_obstacle_height: 2.0
        mark_threshold: 0
        observation_sources: scan
        scan:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: True
          marking: True
          data_type: "LaserScan"
          raytrace_max_range: 3.0
          raytrace_min_range: 0.0
          obstacle_max_range: 2.5
          obstacle_min_range: 0.0
      static_layer:
        plugin: "nav2_costmap_2d::StaticLayer"
        map_subscribe_transient_local: True
      always_send_full_costmap: True

global_costmap:
  global_costmap:
    ros__parameters:
      update_frequency: 1.0
      publish_frequency: 1.0
      global_frame: map
      robot_base_frame: base_link
      robot_radius: 0.22
      resolution: 0.05
      track_unknown_space: true
      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]
      obstacle_layer:
        plugin: "nav2_costmap_2d::ObstacleLayer"
        enabled: True
        observation_sources: scan
        scan:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: True
          marking: True
          data_type: "LaserScan"
          raytrace_max_range: 3.0
          raytrace_min_range: 0.0
          obstacle_max_range: 2.5
          obstacle_min_range: 0.0
      static_layer:
        plugin: "nav2_costmap_2d::StaticLayer"
        map_subscribe_transient_local: True
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        cost_scaling_factor: 3.0
        inflation_radius: 0.55
      always_send_full_costmap: True

# The yaml_filename does not need to be specified since it going to be set by defaults in launch.
# If you'd rather set it in the yaml, remove the default "map" value in the tb3_simulation_launch.py
# file & provide full path to map below. If CLI map configuration or launch default is provided, that will be used.
# map_server:
#   ros__parameters:
#     yaml_filename: ""

map_saver:
  ros__parameters:
    save_map_timeout: 5.0
    free_thresh_default: 0.25
    occupied_thresh_default: 0.65
    map_subscribe_transient_local: True

planner_server:
  ros__parameters:
    expected_planner_frequency: 20.0
    planner_plugins: ["GridBased"]
    GridBased:
      plugin: "nav2_navfn_planner/NavfnPlanner"
      tolerance: 0.5
      use_astar: false
      allow_unknown: true

smoother_server:
  ros__parameters:
    smoother_plugins: ["simple_smoother"]
    simple_smoother:
      plugin: "nav2_smoother::SimpleSmoother"
      tolerance: 1.0e-10
      max_its: 1000
      do_refinement: True

behavior_server:
  ros__parameters:
    local_costmap_topic: local_costmap/costmap_raw
    global_costmap_topic: global_costmap/costmap_raw
    local_footprint_topic: local_costmap/published_footprint
    global_footprint_topic: global_costmap/published_footprint
    cycle_frequency: 10.0
    behavior_plugins: ["spin", "backup", "drive_on_heading", "assisted_teleop", "wait"]
    spin:
      plugin: "nav2_behaviors/Spin"
    backup:
      plugin: "nav2_behaviors/BackUp"
    drive_on_heading:
      plugin: "nav2_behaviors/DriveOnHeading"
    wait:
      plugin: "nav2_behaviors/Wait"
    assisted_teleop:
      plugin: "nav2_behaviors/AssistedTeleop"
    local_frame: odom
    global_frame: map
    robot_base_frame: base_link
    transform_tolerance: 0.1
    simulate_ahead_time: 2.0
    max_rotational_vel: 1.0
    min_rotational_vel: 0.4
    rotational_acc_lim: 3.2

waypoint_follower:
  ros__parameters:
    loop_rate: 20
    stop_on_failure: false
    action_server_result_timeout: 900.0
    waypoint_task_executor_plugin: "wait_at_waypoint"
    wait_at_waypoint:
      plugin: "nav2_waypoint_follower::WaitAtWaypoint"
      enabled: True
      waypoint_pause_duration: 200

velocity_smoother:
  ros__parameters:
    smoothing_frequency: 20.0
    scale_velocities: False
    feedback: "OPEN_LOOP"
    max_velocity: [0.26, 0.0, 1.0]
    min_velocity: [-0.26, 0.0, -1.0]
    max_accel: [2.5, 0.0, 3.2]
    max_decel: [-2.5, 0.0, -3.2]
    odom_topic: "odom"
    odom_duration: 0.1
    deadband_velocity: [0.0, 0.0, 0.0]
    velocity_timeout: 1.0

collision_monitor:
  ros__parameters:
    base_frame_id: "base_footprint"
    odom_frame_id: "odom"
    cmd_vel_in_topic: "cmd_vel_smoothed"
    cmd_vel_out_topic: "cmd_vel"
    state_topic: "collision_monitor_state"
    transform_tolerance: 0.2
    source_timeout: 1.0
    base_shift_correction: True
    stop_pub_timeout: 2.0
    # Polygons represent zone around the robot for "stop", "slowdown" and "limit" action types,
    # and robot footprint for "approach" action type.
    polygons: ["FootprintApproach"]
    FootprintApproach:
      type: "polygon"
      action_type: "approach"
      footprint_topic: "/local_costmap/published_footprint"
      time_before_collision: 2.0
      simulation_time_step: 0.1
      min_points: 6
      visualize: False
      enabled: True
    observation_sources: ["scan"]
    scan:
      type: "scan"
      topic: "scan"
      min_height: 0.15
      max_height: 2.0
      enabled: True

```

and then , try to send a message into topic /initial\_pose or use the `2D_estimate_pose` option in rviz.

#### Unexpected Result: abnormal memory usage

we found that nav2\_controller process occupies a very large amount of memory (up to 10G, sometimes even exceeding 20G, which is very abnormal), as following:
![db3537365059f4ae705cd6d092537db](https://github.com/ros-planning/navigation2/assets/130988564/7a088ebb-4e78-464d-a539-8362ed3537ac)

there's the content of defaulted `nav2_params.yaml`:

```
amcl:
  ros__parameters:
    alpha1: 0.2
    alpha2: 0.2
    alpha3: 0.2
    alpha4: 0.2
    alpha5: 0.2
    base_frame_id: "base_footprint"
    beam_skip_distance: 0.5
    beam_skip_error_threshold: 0.9
    beam_skip_threshold: 0.3
    do_beamskip: false
    global_frame_id: "map"
    lambda_short: 0.1
    laser_likelihood_max_dist: 2.0
    laser_max_range: 100.0
    laser_min_range: -1.0
    laser_model_type: "likelihood_field"
    max_beams: 60
    max_particles: 2000
    min_particles: 500
    odom_frame_id: "odom"
    pf_err: 0.05
    pf_z: 0.99
    recovery_alpha_fast: 0.0
    recovery_alpha_slow: 0.0
    resample_interval: 1
    robot_model_type: "nav2_amcl::DifferentialMotionModel"
    save_pose_rate: 0.5
    sigma_hit: 0.2
    tf_broadcast: true
    transform_tolerance: 1.0
    update_min_a: 0.2
    update_min_d: 0.25
    z_hit: 0.5
    z_max: 0.05
    z_rand: 0.5
    z_short: 0.05
    scan_topic: scan

bt_navigator:
  ros__parameters:
    global_frame: map
    robot_base_frame: base_link
    odom_topic: /odom
    bt_loop_duration: 10
    default_server_timeout: 20
    wait_for_service_timeout: 1000
    action_server_result_timeout: 900.0
    navigators: ["navigate_to_pose", "navigate_through_poses"]
    navigate_to_pose:
      plugin: "nav2_bt_navigator/NavigateToPoseNavigator"
    navigate_through_poses:
      plugin: "nav2_bt_navigator/NavigateThroughPosesNavigator"
    # 'default_nav_through_poses_bt_xml' and 'default_nav_to_pose_bt_xml' are use defaults:
    # nav2_bt_navigator/navigate_to_pose_w_replanning_and_recovery.xml
    # nav2_bt_navigator/navigate_through_poses_w_replanning_and_recovery.xml
    # They can be set here or via a RewrittenYaml remap from a parent launch file to Nav2.
    plugin_lib_names:
      - nav2_compute_path_to_pose_action_bt_node
      - nav2_compute_path_through_poses_action_bt_node
      - nav2_smooth_path_action_bt_node
      - nav2_follow_path_action_bt_node
      - nav2_spin_action_bt_node
      - nav2_wait_action_bt_node
      - nav2_assisted_teleop_action_bt_node
      - nav2_back_up_action_bt_node
      - nav2_drive_on_heading_bt_node
      - nav2_clear_costmap_service_bt_node
      - nav2_is_stuck_condition_bt_node
      - nav2_goal_reached_condition_bt_node
      - nav2_goal_updated_condition_bt_node
      - nav2_globally_updated_goal_condition_bt_node
      - nav2_is_path_valid_condition_bt_node
      - nav2_are_error_codes_active_condition_bt_node
      - nav2_would_a_controller_recovery_help_condition_bt_node
      - nav2_would_a_planner_recovery_help_condition_bt_node
      - nav2_would_a_smoother_recovery_help_condition_bt_node
      - nav2_initial_pose_received_condition_bt_node
      - nav2_reinitialize_global_localization_service_bt_node
      - nav2_rate_controller_bt_node
      - nav2_distance_controller_bt_node
      - nav2_speed_controller_bt_node
      - nav2_truncate_path_action_bt_node
      - nav2_truncate_path_local_action_bt_node
      - nav2_goal_updater_node_bt_node
      - nav2_recovery_node_bt_node
      - nav2_pipeline_sequence_bt_node
      - nav2_round_robin_node_bt_node
      - nav2_transform_available_condition_bt_node
      - nav2_time_expired_condition_bt_node
      - nav2_path_expiring_timer_condition
      - nav2_distance_traveled_condition_bt_node
      - nav2_single_trigger_bt_node
      - nav2_goal_updated_controller_bt_node
      - nav2_is_battery_low_condition_bt_node
      - nav2_navigate_through_poses_action_bt_node
      - nav2_navigate_to_pose_action_bt_node
      - nav2_remove_passed_goals_action_bt_node
      - nav2_planner_selector_bt_node
      - nav2_controller_selector_bt_node
      - nav2_goal_checker_selector_bt_node
      - nav2_controller_cancel_bt_node
      - nav2_path_longer_on_approach_bt_node
      - nav2_wait_cancel_bt_node
      - nav2_spin_cancel_bt_node
      - nav2_back_up_cancel_bt_node
      - nav2_assisted_teleop_cancel_bt_node
      - nav2_drive_on_heading_cancel_bt_node
      - nav2_is_battery_charging_condition_bt_node
    error_code_names:
      - compute_path_error_code
      - follow_path_error_code

controller_server:
  ros__parameters:
    controller_frequency: 20.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    failure_tolerance: 0.3
    progress_checker_plugins: ["progress_checker"]
    goal_checker_plugins: ["general_goal_checker"] # "precise_goal_checker"
    controller_plugins: ["FollowPath"]
    use_realtime_priority: false

    # Progress checker parameters
    progress_checker:
      plugin: "nav2_controller::SimpleProgressChecker"
      required_movement_radius: 0.5
      movement_time_allowance: 10.0
    # Goal checker parameters
    #precise_goal_checker:
    #  plugin: "nav2_controller::SimpleGoalChecker"
    #  xy_goal_tolerance: 0.25
    #  yaw_goal_tolerance: 0.25
    #  stateful: True
    general_goal_checker:
      stateful: True
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.25
      yaw_goal_tolerance: 0.25
    # DWB parameters
    FollowPath:
      plugin: "dwb_core::DWBLocalPlanner"
      debug_trajectory_details: True
      min_vel_x: 0.0
      min_vel_y: 0.0
      max_vel_x: 0.26
      max_vel_y: 0.0
      max_vel_theta: 1.0
      min_speed_xy: 0.0
      max_speed_xy: 0.26
      min_speed_theta: 0.0
      # Add high threshold velocity for turtlebot 3 issue.
      # https://github.com/ROBOTIS-GIT/turtlebot3_simulations/issues/75
      acc_lim_x: 2.5
      acc_lim_y: 0.0
      acc_lim_theta: 3.2
      decel_lim_x: -2.5
      decel_lim_y: 0.0
      decel_lim_theta: -3.2
      vx_samples: 20
      vy_samples: 5
      vtheta_samples: 20
      sim_time: 1.7
      linear_granularity: 0.05
      angular_granularity: 0.025
      transform_tolerance: 0.2
      xy_goal_tolerance: 0.25
      trans_stopped_velocity: 0.25
      short_circuit_trajectory_evaluation: True
      stateful: True
      critics: ["RotateToGoal", "Oscillation", "BaseObstacle", "GoalAlign", "PathAlign", "PathDist", "GoalDist"]
      BaseObstacle.scale: 0.02
      PathAlign.scale: 32.0
      PathAlign.forward_point_distance: 0.1
      GoalAlign.scale: 24.0
      GoalAlign.forward_point_distance: 0.1
      PathDist.scale: 32.0
      GoalDist.scale: 24.0
      RotateToGoal.scale: 32.0
      RotateToGoal.slowing_factor: 5.0
      RotateToGoal.lookahead_time: -1.0

local_costmap:
  local_costmap:
    ros__parameters:
      update_frequency: 5.0
      publish_frequency: 2.0
      global_frame: odom
      robot_base_frame: base_link
      rolling_window: true
      width: 3
      height: 3
      resolution: 0.05
      robot_radius: 0.22
      plugins: ["voxel_layer", "inflation_layer"]
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        cost_scaling_factor: 3.0
        inflation_radius: 0.55
      voxel_layer:
        plugin: "nav2_costmap_2d::VoxelLayer"
        enabled: True
        publish_voxel_map: True
        origin_z: 0.0
        z_resolution: 0.05
        z_voxels: 16
        max_obstacle_height: 2.0
        mark_threshold: 0
        observation_sources: scan
        scan:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: True
          marking: True
          data_type: "LaserScan"
          raytrace_max_range: 3.0
          raytrace_min_range: 0.0
          obstacle_max_range: 2.5
          obstacle_min_range: 0.0
      static_layer:
        plugin: "nav2_costmap_2d::StaticLayer"
        map_subscribe_transient_local: True
      always_send_full_costmap: True

global_costmap:
  global_costmap:
    ros__parameters:
      update_frequency: 1.0
      publish_frequency: 1.0
      global_frame: map
      robot_base_frame: base_link
      robot_radius: 0.22
      resolution: 0.05
      track_unknown_space: true
      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]
      obstacle_layer:
        plugin: "nav2_costmap_2d::ObstacleLayer"
        enabled: True
        observation_sources: scan
        scan:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: True
          marking: True
          data_type: "LaserScan"
          raytrace_max_range: 3.0
          raytrace_min_range: 0.0
          obstacle_max_range: 2.5
          obstacle_min_range: 0.0
      static_layer:
        plugin: "nav2_costmap_2d::StaticLayer"
        map_subscribe_transient_local: True
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        cost_scaling_factor: 3.0
        inflation_radius: 0.55
      always_send_full_costmap: True

# The yaml_filename does not need to be specified since it going to be set by defaults in launch.
# If you'd rather set it in the yaml, remove the default "map" value in the tb3_simulation_launch.py
# file & provide full path to map below. If CLI map configuration or launch default is provided, that will be used.
# map_server:
#   ros__parameters:
#     yaml_filename: ""

map_saver:
  ros__parameters:
    save_map_timeout: 5.0
    free_thresh_default: 0.25
    occupied_thresh_default: 0.65
    map_subscribe_transient_local: True

planner_server:
  ros__parameters:
    expected_planner_frequency: 20.0
    planner_plugins: ["GridBased"]
    GridBased:
      plugin: "nav2_navfn_planner/NavfnPlanner"
      tolerance: 0.5
      use_astar: false
      allow_unknown: true

smoother_server:
  ros__parameters:
    smoother_plugins: ["simple_smoother"]
    simple_smoother:
      plugin: "nav2_smoother::SimpleSmoother"
      tolerance: 1.0e-10
      max_its: 1000
      do_refinement: True

behavior_server:
  ros__parameters:
    local_costmap_topic: local_costmap/costmap_raw
    global_costmap_topic: global_costmap/costmap_raw
    local_footprint_topic: local_costmap/published_footprint
    global_footprint_topic: global_costmap/published_footprint
    cycle_frequency: 10.0
    behavior_plugins: ["spin", "backup", "drive_on_heading", "assisted_teleop", "wait"]
    spin:
      plugin: "nav2_behaviors/Spin"
    backup:
      plugin: "nav2_behaviors/BackUp"
    drive_on_heading:
      plugin: "nav2_behaviors/DriveOnHeading"
    wait:
      plugin: "nav2_behaviors/Wait"
    assisted_teleop:
      plugin: "nav2_behaviors/AssistedTeleop"
    local_frame: odom
    global_frame: map
    robot_base_frame: base_link
    transform_tolerance: 0.1
    simulate_ahead_time: 2.0
    max_rotational_vel: 1.0
    min_rotational_vel: 0.4
    rotational_acc_lim: 3.2

waypoint_follower:
  ros__parameters:
    loop_rate: 20
    stop_on_failure: false
    action_server_result_timeout: 900.0
    waypoint_task_executor_plugin: "wait_at_waypoint"
    wait_at_waypoint:
      plugin: "nav2_waypoint_follower::WaitAtWaypoint"
      enabled: True
      waypoint_pause_duration: 200

velocity_smoother:
  ros__parameters:
    smoothing_frequency: 20.0
    scale_velocities: False
    feedback: "OPEN_LOOP"
    max_velocity: [0.26, 0.0, 1.0]
    min_velocity: [-0.26, 0.0, -1.0]
    max_accel: [2.5, 0.0, 3.2]
    max_decel: [-2.5, 0.0, -3.2]
    odom_topic: "odom"
    odom_duration: 0.1
    deadband_velocity: [0.0, 0.0, 0.0]
    velocity_timeout: 1.0

collision_monitor:
  ros__parameters:
    base_frame_id: "base_footprint"
    odom_frame_id: "odom"
    cmd_vel_in_topic: "cmd_vel_smoothed"
    cmd_vel_out_topic: "cmd_vel"
    state_topic: "collision_monitor_state"
    transform_tolerance: 0.2
    source_timeout: 1.0
    base_shift_correction: True
    stop_pub_timeout: 2.0
    # Polygons represent zone around the robot for "stop", "slowdown" and "limit" action types,
    # and robot footprint for "approach" action type.
    polygons: ["FootprintApproach"]
    FootprintApproach:
      type: "polygon"
      action_type: "approach"
      footprint_topic: "/local_costmap/published_footprint"
      time_before_collision: 2.0
      simulation_time_step: 0.1
      min_points: 6
      visualize: False
      enabled: True
    observation_sources: ["scan"]
    scan:
      type: "scan"
      topic: "scan"
      min_height: 0.15
      max_height: 2.0
      enabled: True

```

in short, here's only one difference between two `params.yaml` file:
the height of local costmap is set as `-20` or `3`

* [ros2](/questions/tagged/ros2 "show questions tagged 'ros2'")
* [costmap](/questions/tagged/costmap "show questions tagged 'costmap'")
* [nav2](/questions/tagged/nav2 "show questions tagged 'nav2'")
* [local-costmap](/questions/tagged/local-costmap "show questions tagged 'local-costmap'")

[Share](/q/106008 "Short permalink to this question")

[Improve this question](/posts/106008/edit)

Follow

[edited Dec 13, 2023 at 9:14](/posts/106008/revisions "show all edits to this post")

GoesM

asked Dec 12, 2023 at 7:47

[![GoesM's user avatar](https://i.sstatic.net/dKohq.jpg?s=64)](/users/37693/goesm)

[GoesM](/users/37693/goesm)GoesM
133 bronze badges

$\endgroup$

2

* $\begingroup$
  A bug report would be better served in the [nav2 repository](https://github.com/ros-planning/navigation2). You'd have more people who work with the development of nav2 there. I suggest you cross post this as an issue on Nav2's GitHub repository
  $\endgroup$
  – [ssarkar](/users/21163/ssarkar "734 reputation")

  Commented
  Dec 12, 2023 at 8:51
* $\begingroup$
  Oh please instead remove the general -20 stuff we discussed in the ticket -- and lets focus on the memory issues. You didn't include your parameter files for comparison!
  $\endgroup$
  – [Steve Macenski](/users/30979/steve-macenski "6,402 reputation")

  Commented
  Dec 12, 2023 at 18:39

Add a comment
 |

## 0

Sorted by:

[Reset to default](/questions/106008/ros2nav2-user-misconfiguration-of-parameters-may-bring-abnormal-memory-usage?answertab=scoredesc#tab-top)

Highest score (default)

Date modified (newest first)

Date created (oldest first)

## Know someone who can answer? Share a link to this [question](https://robotics.stackexchange.com/questions/106008/ros2nav2-user-misconfiguration-of-parameters-may-bring-abnormal-memory-usage) via [email](/cdn-cgi/l/email-protection#bf80cccaddd5dadccb82edd0ddd0cbd6dccc9a8d8feccbdedcd49a8d8ffac7dcd7ded1d8da9a8d8feecadacccbd6d0d199ded2cf84ddd0dbc6829a8addedf0ec8d9a8adb9a8addf1fee98d9a8adb9a8d8feaccdacd9a8d8fd2d6ccdcd0d1d9d6d8cacddecbd6d0d19a8d8fd0d99a8d8fcfdecdded2dacbdacdcc9a8d8fd2dec69a8d8fddcdd6d1d89a8d8fdeddd1d0cdd2ded39a8d8fd2dad2d0cdc69a8d8fcaccded8da9a8ffed7cbcbcfcc9a8cde9a8dd99a8dd9cdd0ddd0cbd6dccc91cccbdedcd4dac7dcd7ded1d8da91dcd0d29a8dd9ce9a8dd98e8f898f8f879a8cd9ccdad29a8cdb8d), [Twitter](https://twitter.com/share?url=https%3a%2f%2frobotics.stackexchange.com%2fq%2f106008%3fstw%3d2), or [Facebook](https://www.facebook.com/sharer.php?u=https%3a%2f%2frobotics.stackexchange.com%2fq%2f106008%3fsfb%3d2).

## Your Answer

Thanks for contributing an answer to Robotics Stack Exchange!

* Please be sure to *answer the question*. Provide details and share your research!

But *avoid* …

* Asking for help, clarification, or responding to other answers.
* Making statements based on opinion; back them up with references or personal experience.

Use MathJax to format equations. [MathJax reference](https://robotics.meta.stackexchange.com/questions/130/how-can-i-format-mathematical-expressions-here-using-mathjax).

To learn more, see our [tips on writing great answers](/help/how-to-answer).

Draft saved
Draft discarded

### Sign up or [log in](/users/login?ssrc=question_page&returnurl=https%3a%2f%2frobotics.stackexchange.com%2fquestions%2f106008%2fros2nav2-user-misconfiguration-of-parameters-may-bring-abnormal-memory-usage%23new-answer)

 Sign up using Google

 Sign up using Email and Password

Submit
### Post as a guest

Name

Email

Required, but never shown

### Post as a guest

Name

Email

Required, but never shown

Post Your Answer

Discard

By clicking “Post Your Answer”, you agree to our [terms of service](https://stackoverflow.com/legal/terms-of-service/public) and acknowledge you have read our [privacy policy](https://stackoverflow.com/legal/privacy-policy).

## Browse other questions tagged * [ros2](/questions/tagged/ros2 "show questions tagged 'ros2'") * [costmap](/questions/tagged/costmap "show questions tagged 'costmap'") * [nav2](/questions/tagged/nav2 "show questions tagged 'nav2'") * [local-costmap](/questions/tagged/local-costmap "show questions tagged 'local-costmap'") or [ask your own question](/questions/ask).

* The Overflow Blog
* [Failing fast at scale: Rapid prototyping at Intuit](https://stackoverflow.blog/2025/01/08/failing-fast-at-scale-rapid-prototyping-at-intuit/)
* [“Data is the key”: Twilio’s Head of R&D on the need for good data](https://stackoverflow.blog/2025/01/10/data-is-the-key-twilio-s-head-of-r-and-d-on-the-need-for-good-data/)
* Featured on Meta
* [The December 2024 Community Asks Sprint has been moved to March 2025 (and...](https://meta.stackexchange.com/questions/404724/the-december-2024-community-asks-sprint-has-been-moved-to-march-2025-and-length "The December 2024 Community Asks Sprint has been moved to March 2025 (and lengthened to 2 weeks to compensate)")

#### Related

[0](/q/54356 "Question score (upvotes - downvotes)")
[Global Costmap not visualized](/questions/54356/global-costmap-not-visualized)

[0](/q/57665 "Question score (upvotes - downvotes)")
[Problem with ros navigation](/questions/57665/problem-with-ros-navigation)

[0](/q/68718 "Question score (upvotes - downvotes)")
[Local costmap not centered on robot](/questions/68718/local-costmap-not-centered-on-robot)

[0](/q/78596 "Question score (upvotes - downvotes)")
[Problem with loading social navigation layer plugins on costmap](/questions/78596/problem-with-loading-social-navigation-layer-plugins-on-costmap)

[0](/q/80078 "Question score (upvotes - downvotes)")
[local\_cosmap remark but can't clear](/questions/80078/local-cosmap-remark-but-cant-clear)

[0](/q/95203 "Question score (upvotes - downvotes)")
[[solved] help needed: move\_base planner not publishing](/questions/95203/solved-help-needed-move-base-planner-not-publishing)

[0](/q/95845 "Question score (upvotes - downvotes)")
[Clearing the obstacles form local costmap](/questions/95845/clearing-the-obstacles-form-local-costmap)

[0](/q/101978 "Question score (upvotes - downvotes)")
[The obstacle is not on my cost map](/questions/101978/the-obstacle-is-not-on-my-cost-map)

[0](/q/105504 "Question score (upvotes - downvotes)")
[Nav2 bring up doesn't render turtlebot3](/questions/105504/nav2-bring-up-doesnt-render-turtlebot3)

[0](/q/111767 "Question score (upvotes - downvotes)")
[Tune Nav2 parameters - Ackermann vehicle](/questions/111767/tune-nav2-parameters-ackermann-vehicle)

#### [Hot Network Questions](https://stackexchange.com/questions?tab=hot)

* [Why am I not able to see mounted folder with Docker-Desktop with WSL2?](https://superuser.com/questions/1869971/why-am-i-not-able-to-see-mounted-folder-with-docker-desktop-with-wsl2)
* [How is heat loss related to heat source?](https://diy.stackexchange.com/questions/312774/how-is-heat-loss-related-to-heat-source)
* [Did the term "irrational number" initially have any derogatory intent?](https://hsm.stackexchange.com/questions/18201/did-the-term-irrational-number-initially-have-any-derogatory-intent)
* [Rail splitter with LM324](https://electronics.stackexchange.com/questions/735538/rail-splitter-with-lm324)
* [In a single elimination tournament, each match can end with 1 loser or two losers. What's the probability the tournament ends with no winner?](https://math.stackexchange.com/questions/5021105/in-a-single-elimination-tournament-each-match-can-end-with-1-loser-or-two-loser)
* [The Random Skipping Sequential (RSS) Monte Carlo algorithm](https://codereview.stackexchange.com/questions/294999/the-random-skipping-sequential-rss-monte-carlo-algorithm)
* [Slang「詰んだ」 and its source 「詰む」's pitch](https://japanese.stackexchange.com/questions/106881/slang-%E8%A9%B0%E3%82%93%E3%81%A0-and-its-source-%E8%A9%B0%E3%82%80-s-pitch)
* [Can I use an A or D string on my violin in place of a G string?](https://music.stackexchange.com/questions/138533/can-i-use-an-a-or-d-string-on-my-violin-in-place-of-a-g-string)
* [After Joseph was accused of seducing Potiphar's wife, why was he sentenced to jail (for over 2 years) rather than executed?](https://judaism.stackexchange.com/questions/146929/after-joseph-was-accused-of-seducing-potiphars-wife-why-was-he-sentenced-to-ja)
* [Does a magnetic transducer buzzer need a resistor in series?](https://electronics.stackexchange.com/questions/735464/does-a-magnetic-transducer-buzzer-need-a-resistor-in-series)
* [Is it idiomatic to say "I just played" or "I was just playing" in response to the question "What did you do this morning"?](https://ell.stackexchange.com/questions/361067/is-it-idiomatic-to-say-i-just-played-or-i-was-just-playing-in-response-to-th)
* [Can I add a wood burning stove to radiant heat boiler system?](https://diy.stackexchange.com/questions/312654/can-i-add-a-wood-burning-stove-to-radiant-heat-boiler-system)
* [Is it possible to make a flight simulator that can model aerobatics and stalls accurately?](https://aviation.stackexchange.com/questions/107669/is-it-possible-to-make-a-flight-simulator-that-can-model-aerobatics-and-stalls-a)
* [Can equipment used in Alcohol distillation be used for the small-scale distillation of crude oil](https://chemistry.stackexchange.com/questions/186751/can-equipment-used-in-alcohol-distillation-be-used-for-the-small-scale-distillat)
* [How to understand structure of sentences in probability](https://stats.stackexchange.com/questions/659651/how-to-understand-structure-of-sentences-in-probability)
* [Would Canada be one of the poorer states if inducted into the United States?](https://skeptics.stackexchange.com/questions/57603/would-canada-be-one-of-the-poorer-states-if-inducted-into-the-united-states)
* [Possible Error in Mathematical Physics by Robert Geroch? (or critical misunderstanding by me)](https://math.stackexchange.com/questions/5021537/possible-error-in-mathematical-physics-by-robert-geroch-or-critical-misunderst)
* [Why do the A-4 Skyhawk and T-38 Talon have high roll rates?](https://aviation.stackexchange.com/questions/107667/why-do-the-a-4-skyhawk-and-t-38-talon-have-high-roll-rates)
* [Arduino Mega: is there a way to have additional interrupt pins?](https://arduino.stackexchange.com/questions/97248/arduino-mega-is-there-a-way-to-have-additional-interrupt-pins)
* [Are mathematics and science algorithmic?](https://philosophy.stackexchange.com/questions/121420/are-mathematics-and-science-algorithmic)
* [How to insert a monospace character-width space character in math mode?](https://tex.stackexchange.com/questions/734631/how-to-insert-a-monospace-character-width-space-character-in-math-mode)
* [How to interact with Dead Magic demiplane?](https://rpg.stackexchange.com/questions/214361/how-to-interact-with-dead-magic-demiplane)
* [How would you put a window screen here?](https://diy.stackexchange.com/questions/312771/how-would-you-put-a-window-screen-here)
* [What do you call the equivalent of "Cardinal directions" in a hex-grid?](https://boardgames.stackexchange.com/questions/61696/what-do-you-call-the-equivalent-of-cardinal-directions-in-a-hex-grid)

more hot questions

[Question feed](/feeds/question/106008 "Feed of this question and its answers")

# Subscribe to RSS

Question feed

To subscribe to this RSS feed, copy and paste this URL into your RSS reader.

![](/posts/106008/ivc/7873?prg=16a08a2f-e07c-4b46-9cc8-2145d8c70cfb)

##### [Robotics](/)

* [Tour](/tour)
* [Help](/help)
* [Chat](https://chat.stackexchange.com?tab=site&host=robotics.stackexchange.com)
* [Contact](/contact)
* [Feedback](https://robotics.meta.stackexchange.com)

##### [Company](https://stackoverflow.co/)

* [Stack Overflow](https://stackoverflow.com)
* [Teams](https://stackoverflow.co/teams/)
* [Advertising](https://stackoverflow.co/advertising/)
* [Talent](https://stackoverflow.co/advertising/employer-branding/)
* [About](https://stackoverflow.co/)
* [Press](https://stackoverflow.co/company/press/)
* [Legal](https://stackoverflow.com/legal)
* [Privacy Policy](https://stackoverflow.com/legal/privacy-policy)
* [Terms of Service](https://stackoverflow.com/legal/terms-of-service/public)
* Cookie Settings
* [Cookie Policy](https://stackoverflow.com/legal/cookie-policy)

##### [Stack Exchange Network](https://stackexchange.com)

* [Technology](https://stackexchange.com/sites#technology)
* [Culture & recreation](https://stackexchange.com/sites#culturerecreation)
* [Life & arts](https://stackexchange.com/sites#lifearts)
* [Science](https://stackexchange.com/sites#science)
* [Professional](https://stackexchange.com/sites#professional)
* [Business](https://stackexchange.com/sites#business)
* [API](https://api.stackexchange.com/)
* [Data](https://data.stackexchange.com/)

* [Blog](https://stackoverflow.blog?blb=1)
* [Facebook](https://www.facebook.com/officialstackoverflow/)
* [Twitter](https://twitter.com/stackoverflow)
* [LinkedIn](https://linkedin.com/company/stack-overflow)
* [Instagram](https://www.instagram.com/thestackoverflow)

Site design / logo © 2025 Stack Exchange Inc;
user contributions licensed under
[CC BY-SA](https://stackoverflow.com/help/licensing)
.
rev 2025.1.7.20880

