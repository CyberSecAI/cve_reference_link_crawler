=== Content from github.com_fdbe0b72_20250110_212028.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Foauthenticator%2Fsecurity%2Fadvisories%2FGHSA-gprj-3p75-f996)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Foauthenticator%2Fsecurity%2Fadvisories%2FGHSA-gprj-3p75-f996)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=jupyterhub%2Foauthenticator)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jupyterhub](/jupyterhub)
/
**[oauthenticator](/jupyterhub/oauthenticator)**
Public

* [Notifications](/login?return_to=%2Fjupyterhub%2Foauthenticator) You must be signed in to change notification settings
* [Fork
  367](/login?return_to=%2Fjupyterhub%2Foauthenticator)
* [Star
   418](/login?return_to=%2Fjupyterhub%2Foauthenticator)

* [Code](/jupyterhub/oauthenticator)
* [Issues
  44](/jupyterhub/oauthenticator/issues)
* [Pull requests
  7](/jupyterhub/oauthenticator/pulls)
* [Actions](/jupyterhub/oauthenticator/actions)
* [Projects
  0](/jupyterhub/oauthenticator/projects)
* [Wiki](/jupyterhub/oauthenticator/wiki)
* [Security](/jupyterhub/oauthenticator/security)
* [Insights](/jupyterhub/oauthenticator/pulse)

Additional navigation options

* [Code](/jupyterhub/oauthenticator)
* [Issues](/jupyterhub/oauthenticator/issues)
* [Pull requests](/jupyterhub/oauthenticator/pulls)
* [Actions](/jupyterhub/oauthenticator/actions)
* [Projects](/jupyterhub/oauthenticator/projects)
* [Wiki](/jupyterhub/oauthenticator/wiki)
* [Security](/jupyterhub/oauthenticator/security)
* [Insights](/jupyterhub/oauthenticator/pulse)

# Globus `identity\_provider` restriction ignored when used with `allow\_all` in JupyterHub 5.0

High

[yuvipanda](/yuvipanda)
published
GHSA-gprj-3p75-f996
Jun 11, 2024

## Package

pip

oauthenticator
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<=16.3.0

## Patched versions

16.3.1

## Description

### Impact

JupyterHub < 5.0, when used with `GlobusOAuthenticator`, could be configured to allow all users from a particular institution only. The configuration for this would look like:

```
# Require users to be using the "foo.horse" identity provider, often an institution or university
c.GlobusAuthenticator.identity_provider = "foo.horse"
# Allow everyone who has that identity provider to log in
c.GlobusAuthenticator.allow_all = True
```

This worked fine prior to JupyterHub 5.0, because `allow_all` *did not* take precedence over `identity_provider`.

Since JupyterHub 5.0, `allow_all` *does* take precedence over `identity_provider`. On a hub with the same config, now **all** users will be allowed to login, regardless of `identity_provider`. `identity_provider` will basically be ignored.

This is a [documented change](https://jupyterhub.readthedocs.io/en/stable/howto/upgrading-v5.html#authenticator-allow-all-and-allow-existing-users) in JupyterHub 5.0,

but is likely to catch many users by surprise.

### Patches

OAuthenticator 16.3.1 fixes the issue with JupyterHub 5.0, and does not affect previous versions.

### Workarounds

Do not upgrade to JupyterHub 5.0 when using `GlobusOAuthenticator` in the prior configuration.

### Severity

High

### CVE ID

CVE-2024-37300

### Weaknesses

No CWEs

### Credits

* [![@minrk](https://avatars.githubusercontent.com/u/151929?s=40&v=4)](/minrk)
  [minrk](/minrk)
  Finder
* [![@yuvipanda](https://avatars.githubusercontent.com/u/30430?s=40&v=4)](/yuvipanda)
  [yuvipanda](/yuvipanda)
  Coordinator
* [![@manics](https://avatars.githubusercontent.com/u/1644105?s=40&v=4)](/manics)
  [manics](/manics)
  Remediation reviewer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a7fe25d3_20250110_212028.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Foauthenticator%2Fcommit%2Fd1aea05fa89f2beae15ab0fa0b0d071030f79654)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Foauthenticator%2Fcommit%2Fd1aea05fa89f2beae15ab0fa0b0d071030f79654)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=jupyterhub%2Foauthenticator)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jupyterhub](/jupyterhub)
/
**[oauthenticator](/jupyterhub/oauthenticator)**
Public

* [Notifications](/login?return_to=%2Fjupyterhub%2Foauthenticator) You must be signed in to change notification settings
* [Fork
  367](/login?return_to=%2Fjupyterhub%2Foauthenticator)
* [Star
   418](/login?return_to=%2Fjupyterhub%2Foauthenticator)

* [Code](/jupyterhub/oauthenticator)
* [Issues
  44](/jupyterhub/oauthenticator/issues)
* [Pull requests
  7](/jupyterhub/oauthenticator/pulls)
* [Actions](/jupyterhub/oauthenticator/actions)
* [Projects
  0](/jupyterhub/oauthenticator/projects)
* [Wiki](/jupyterhub/oauthenticator/wiki)
* [Security](/jupyterhub/oauthenticator/security)
* [Insights](/jupyterhub/oauthenticator/pulse)

Additional navigation options

* [Code](/jupyterhub/oauthenticator)
* [Issues](/jupyterhub/oauthenticator/issues)
* [Pull requests](/jupyterhub/oauthenticator/pulls)
* [Actions](/jupyterhub/oauthenticator/actions)
* [Projects](/jupyterhub/oauthenticator/projects)
* [Wiki](/jupyterhub/oauthenticator/wiki)
* [Security](/jupyterhub/oauthenticator/security)
* [Insights](/jupyterhub/oauthenticator/pulse)

## Commit

[Permalink](/jupyterhub/oauthenticator/commit/d1aea05fa89f2beae15ab0fa0b0d071030f79654)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-gprj-3p75-f996](https://github.com/advisories/GHSA-gprj-3p75-f996 "GHSA-gprj-3p75-f996")

[Browse files](/jupyterhub/oauthenticator/tree/d1aea05fa89f2beae15ab0fa0b0d071030f79654)
Browse the repository at this point in the history

```
globus: apply identity_provider restriction in `check_blocked_users`
```

* Loading branch information

[![@yuvipanda](https://avatars.githubusercontent.com/u/30430?s=40&v=4)](/yuvipanda)

[yuvipanda](/jupyterhub/oauthenticator/commits?author=yuvipanda "View all commits by yuvipanda")
authored
Jun 11, 2024

2 parents
[79db03c](/jupyterhub/oauthenticator/commit/79db03cb901da09301e942daeebd0f9b6f383446)
+
[04d11f8](/jupyterhub/oauthenticator/commit/04d11f83fea09cdbcdd8169956ba56f9744e3d05)

commit d1aea05

Showing
**1 changed file**
with
**21 additions**
and
**12 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

33 changes: 21 additions & 12 deletions

33
[oauthenticator/globus.py](#diff-ea14670b1ce0873d1c059abf399f4688f4f82a8320f1750c7b3680714b57f540 "oauthenticator/globus.py")

Show comments

[View file](/jupyterhub/oauthenticator/blob/d1aea05fa89f2beae15ab0fa0b0d071030f79654/oauthenticator/globus.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -297,30 +297,39 @@ async def check\_allowed(self, username, auth\_model): |
|  |  | if auth\_model is None: |
|  |  | return True |
|  |  |  |
|  |  | if await super().check\_allowed(username, auth\_model): |
|  |  | return True |
|  |  |  |
|  |  | if self.allowed\_globus\_groups: |
|  |  | user\_groups = set(auth\_model["auth\_state"]["globus\_groups"]) |
|  |  | if user\_groups & self.allowed\_globus\_groups: |
|  |  | return True |
|  |  | self.log.warning(f"{username} not in an allowed Globus Group") |
|  |  |  |
|  |  | # users should be explicitly allowed via config, otherwise they aren't |
|  |  | return False |
|  |  |  |
|  |  | async def check\_blocked\_users(self, username, authentication): |
|  |  | """Check if the user should be blocked |
|  |  |  |
|  |  | Called \_before\_ checking if the user should be allowed |
|  |  | """ |
|  |  | # any restrictions on access go here - allow config only \_grants\_ access, |
|  |  | # restrictions belong in the `block` stage |
|  |  | # before considering allowing a username by being recognized in a list |
|  |  | # of usernames or similar, we must ensure that the authenticated user is |
|  |  | # from an allowed identity provider domain. |
|  |  | if self.identity\_provider: |
|  |  | # It's possible for identity provider domains to be namespaced |
|  |  | # https://docs.globus.org/api/auth/specification/#identity\_provider\_namespaces |
|  |  | user\_info = auth\_model["auth\_state"][self.user\_auth\_state\_key] |
|  |  | user\_info = authentication["auth\_state"][self.user\_auth\_state\_key] |
|  |  | user\_domain = user\_info.get(self.username\_claim).split('@', 1)[-1] |
|  |  | if user\_domain != self.identity\_provider: |
|  |  | message = f"This site is restricted to {self.identity\_provider} accounts. Link your account at app.globus.org/account." |
|  |  | self.log.warning(message) |
|  |  | raise web.HTTPError(403, message) |
|  |  |  |
|  |  | if await super().check\_allowed(username, auth\_model): |
|  |  | return True |
|  |  |  |
|  |  | if self.allowed\_globus\_groups: |
|  |  | user\_groups = set(auth\_model["auth\_state"]["globus\_groups"]) |
|  |  | if user\_groups & self.allowed\_globus\_groups: |
|  |  | return True |
|  |  | self.log.warning(f"{username} not in an allowed Globus Group") |
|  |  |  |
|  |  | # users should be explicitly allowed via config, otherwise they aren't |
|  |  | return False |
|  |  | return super().check\_blocked\_users(username, authentication) |
|  |  |  |
|  |  | async def update\_auth\_model(self, auth\_model): |
|  |  | """ |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d1aea05`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Foauthenticator%2Fcommit%2Fd1aea05fa89f2beae15ab0fa0b0d071030f79654) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from jupyterhub.readthedocs.io_fbd233ad_20250110_212029.html ===

[Skip to main content](#main-content)

Back to top

`Ctrl`+`K`

[![JupyterHub  documentation - Home](../_static/logo.png)](../index.html)

* [Tutorials](../tutorial/index.html)
* [How-to](index.html)
* [Explanation](../explanation/index.html)
* [Reference](../reference/index.html)
* [FAQs](../faq/index.html)
* More
  + [Contributing](../contributing/index.html)

* [GitHub](https://github.com/jupyterhub/jupyterhub "GitHub")
* [Discourse](https://discourse.jupyter.org/ "Discourse")
* [Team Compass](https://jupyterhub-team-compass.readthedocs.io/en/latest/ "Team Compass")

* [Tutorials](../tutorial/index.html)
* [How-to](index.html)
* [Explanation](../explanation/index.html)
* [Reference](../reference/index.html)
* [FAQs](../faq/index.html)
* [Contributing](../contributing/index.html)

* [GitHub](https://github.com/jupyterhub/jupyterhub "GitHub")
* [Discourse](https://discourse.jupyter.org/ "Discourse")
* [Team Compass](https://jupyterhub-team-compass.readthedocs.io/en/latest/ "Team Compass")

Section Navigation

* [Deploying JupyterHub in “API only mode”](api-only.html)
* [Writing a custom Proxy implementation](proxy.html)
* [Using JupyterHub’s REST API](rest.html)
* [Running proxy separately from the hub](separate-proxy.html)
* [Working with templates and UI](templates.html)
* [Upgrading JupyterHub](upgrading.html)
  + Upgrading to JupyterHub 5
* [Interpreting common log messages](log-messages.html)

* [Configuring user environments](configuration/config-user-env.html)
* [Configure GitHub OAuth](configuration/config-ghoauth.html)
* [Using a reverse proxy](configuration/config-proxy.html)
* [Run JupyterHub without root privileges using `sudo`](configuration/config-sudo.html)

* [How-to](index.html)
* [Upgrading JupyterHub](upgrading.html)
* Upgrading...

# Upgrading to JupyterHub 5[#](#upgrading-to-jupyterhub-5 "Link to this heading")

This document describes the specific considerations.
For general upgrading tips, see the [docs on upgrading jupyterhub](upgrading.html).

You can see the [changelog](../reference/changelog.html#changelog) for more detailed information.

## Python version[#](#python-version "Link to this heading")

JupyterHub 5 requires Python 3.8.
Make sure you have at least Python 3.8 in your user and hub environments before upgrading.

## Database upgrades[#](#database-upgrades "Link to this heading")

JupyterHub 5 does have a database schema upgrade,
so you should backup your database and run `jupyterhub upgrade-db` after upgrading and before starting JupyterHub.
The updated schema only adds some columns, so is one that should be not too disruptive to roll back if you need to.

## User subdomains[#](#user-subdomains "Link to this heading")

All JupyterHub deployments which care about protecting users from each other are encouraged to enable per-user domains, if possible,
as this provides the best isolation between user servers.

To enable subdomains, set:

```
c.JupyterHub.subdomain_host = "https://myjupyterhub.example.org"

```

If you were using subdomains before, some user servers and all services will be on different hosts in the default configuration.

JupyterHub 5 allows complete customization of the subdomain scheme via the new [`JupyterHub.subdomain_hook`](../reference/api/app.html#jupyterhub.app.JupyterHub.subdomain_hook "jupyterhub.app.JupyterHub.subdomain_hook"),
and changes the default subdomain scheme.
.

You can provide a completely custom subdomain scheme, or select one of two default implementations by name: `idna` or `legacy`. `idna` is the default.

The new default behavior can be selected explicitly via:

```
c.JupyterHub.subdomain_hook = "idna"

```

Or to delay any changes to URLs for your users, you can opt-in to the pre-5.0 behavior with:

```
c.JupyterHub.subdomain_hook = "legacy"

```

The key differences of the new `idna` scheme:

* It should always produce valid domains, regardless of username (not true for the legacy scheme when using characters that might need escaping or usernames that are long)
* each Service gets its own subdomain on `service--` rather than sharing `services.`

Below is a table of examples of users and services with their domains with the old and new scheme, assuming the configuration:

```
c.JupyterHub.subdomain_host = "https://jupyter.example.org"

```

| kind | name | legacy | idna |
| --- | --- | --- | --- |
| user | laudna | `laudna.jupyter.example.org` | `laudna.jupyter.example.org` |
| service | bells | `services.jupyter.example.org` | `bells--service.jupyter.example.org` |
| user | jester@mighty.nein | `jester_40mighty.nein.jupyter.example.org` (may not work!) | `u-jestermi--8037680.jupyter.example.org` (not as pretty, but guaranteed to be valid and not collide) |

## Tokens in URLs[#](#tokens-in-urls "Link to this heading")

JupyterHub 5 does not accept `?token=...` URLs by default in single-user servers.
These URLs allow one user to force another to login as them,
which can be the start of an inter-user attack.

There is a valid use case for producing links which allow starting a fully authenticated session,
so you may still opt in to this behavior by setting:

```
c.Spawner.environment.update({"JUPYTERHUB_ALLOW_TOKEN_IN_URL": "1"})

```

if you are not concerned about protecting your users from each other.
If you have subdomains enabled, the threat is substantially reduced.

## Sharing[#](#sharing "Link to this heading")

The big new feature in JupyterHub 5.0 is sharing.
Check it out in [the sharing docs](../tutorial/sharing.html#sharing-tutorial).

## Authenticator.allow\_all and allow\_existing\_users[#](#authenticator-allow-all-and-allow-existing-users "Link to this heading")

Prior to JupyterHub 5, JupyterHub Authenticators had the *implicit* default behavior to allow any user who successfully authenticates to login **if no users are explicitly allowed** (i.e. `allowed_users` is empty on the base class).
This behavior was considered a too-permissive default in Authenticators that source large user pools like OAuthenticator, which would accept e.g. all users with a Google account by default.
As a result, OAuthenticator 16 introduced two configuration options: `allow_all` and `allow_existing_users`.

JupyterHub 5 adopts these options for all Authenticators:

1. `Authenticator.allow_all` (default: False)
2. `Authenticator.allow_existing_users` (default: True if allowed\_users is non-empty, False otherwise)

having the effect that *some* allow configuration is required for anyone to be able to login.
If you want to preserve the pre-5.0 behavior with no explicit `allow` configuration, set:

```
c.Authenticator.allow_all = True

```

`allow_existing_users` defaults are meant to be backward-compatible, but you can now *explicitly* allow or not based on presence in the database by setting `Authenticator.allow_existing_users` to True or False.

See also

[Authenticator config docs](../tutorial/getting-started/authenticators-users-basics.html#authenticators) for details on these and other Authenticator options.

## Bootstrap 5[#](#bootstrap-5 "Link to this heading")

JupyterHub uses the CSS framework [bootstrap](https://getbootstrap.com), which is upgraded from 3.4 to 5.3.
If you don’t have any custom HTML templates, you are likely to only see relatively minor aesthetic changes.
If you have custom HTML templates or spawner options forms, they may need some updating to look right.

See the bootstrap documentation. Since we upgraded two major versions, you might need to look at both v4 and v5 documentation for what has changed since 3.x:

* [migrating to v4](https://getbootstrap.com/docs/4.6/migration/)
* [migrating to v5](https://getbootstrap.com/docs/5.3/migration/)

If you customized the JupyterHub CSS by recompiling from LESS files, bootstrap migrated to SCSS.
You can start by autoconverting your LESS to SCSS (it’s not that different) with [less2sass](https://github.com/ekryski/less2sass):

```
npm install --global less2scss
# converts less/foo.less to scss/foo.scss
less2scss --src ./less --dst ./scss

```

Bootstrap also allows configuring things with [CSS variables](https://getbootstrap.com/docs/5.3/customize/css-variables/), so depending on what you have customized, you may be able to get away with just adding a CSS file defining variables without rebuilding the whole SCSS.

## groups required with Authenticator.manage\_groups[#](#groups-required-with-authenticator-manage-groups "Link to this heading")

Setting `Authenticator.manage_groups = True` allows the Authenticator to manage group membership by returning `groups` from the authentication model.
However, this option is available even on Authenticators that do not support it, which led to confusion.
Starting with JupyterHub 5, if `manage_groups` is True `authenticate` *must* return a groups field, otherwise an error is raised.
This prevents confusion when users enable managed groups that is not implemented.

If an Authenticator *does* support managing groups but was not providing a `groups` field in order to leave membership unmodified, it must specify `"groups": None` to make this explicit instead of implicit (this is backward-compatible).

[previous

Upgrading JupyterHub](upgrading.html "previous page")
[next

Interpreting common log messages](log-messages.html "next page")

 On this page

* [Python version](#python-version)
* [Database upgrades](#database-upgrades)
* [User subdomains](#user-subdomains)
* [Tokens in URLs](#tokens-in-urls)
* [Sharing](#sharing)
* [Authenticator.allow\_all and allow\_existing\_users](#authenticator-allow-all-and-allow-existing-users)
* [Bootstrap 5](#bootstrap-5)
* [groups required with Authenticator.manage\_groups](#groups-required-with-authenticator-manage-groups)

[Edit on GitHub](https://github.com/jupyterhub/jupyterhub/edit/main/docs/source/howto/upgrading-v5.md)

[Show Source](../_sources/howto/upgrading-v5.md.txt)

© Copyright 2024, Project Jupyter Contributors.

Created using [Sphinx](https://www.sphinx-doc.org/) 8.1.3.

Built with the [PyData Sphinx Theme](https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html) 0.15.4.


