
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Upgrading to JupyterHub 5" />
<meta property="og:type" content="website" />
<meta property="og:url" content="howto/upgrading-v5.html" />
<meta property="og:site_name" content="JupyterHub" />
<meta property="og:description" content="This document describes the specific considerations. For general upgrading tips, see the docs on upgrading jupyterhub. You can see the changelog for more detailed information. Python version: Jupyt..." />
<meta property="og:image" content="_static/logo.png" />
<meta property="og:image:alt" content="JupyterHub" />
<meta name="description" content="This document describes the specific considerations. For general upgrading tips, see the docs on upgrading jupyterhub. You can see the changelog for more detailed information. Python version: Jupyt..." />

    <title>Upgrading to JupyterHub 5 &#8212; JupyterHub  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/jupyterhub-sphinx-theme.css?v=ce704f48" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=bc57d99e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'howto/upgrading-v5';</script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Interpreting common log messages" href="log-messages.html" />
    <link rel="prev" title="Upgrading JupyterHub" href="upgrading.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <script async type="text/javascript" src="/_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="jupyterhub" /><meta name="readthedocs-version-slug" content="stable" /><meta name="readthedocs-resolver-filename" content="/howto/upgrading-v5.html" /><meta name="readthedocs-http-status" content="200" /></head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="JupyterHub  documentation - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="JupyterHub  documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorial/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    How-to
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../explanation/index.html">
    Explanation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../faq/index.html">
    FAQs
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../contributing/index.html">
    Contributing
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/jupyterhub/jupyterhub" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discourse.jupyter.org/" title="Discourse" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discourse</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://jupyterhub-team-compass.readthedocs.io/en/latest/" title="Team Compass" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-compass fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Team Compass</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorial/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    How-to
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../explanation/index.html">
    Explanation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../faq/index.html">
    FAQs
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contributing/index.html">
    Contributing
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/jupyterhub/jupyterhub" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discourse.jupyter.org/" title="Discourse" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discourse</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://jupyterhub-team-compass.readthedocs.io/en/latest/" title="Team Compass" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-compass fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Team Compass</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="api-only.html">Deploying JupyterHub in “API only mode”</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxy.html">Writing a custom Proxy implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest.html">Using JupyterHub’s REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="separate-proxy.html">Running proxy separately from the hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">Working with templates and UI</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="upgrading.html">Upgrading JupyterHub</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Upgrading to JupyterHub 5</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="log-messages.html">Interpreting common log messages</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="configuration/config-user-env.html">Configuring user environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration/config-ghoauth.html">Configure GitHub OAuth</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration/config-proxy.html">Using a reverse proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration/config-sudo.html">Run JupyterHub without root privileges using <code class="docutils literal notranslate"><span class="pre">sudo</span></code></a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">How-to</a></li>
    
    
    <li class="breadcrumb-item"><a href="upgrading.html" class="nav-link">Upgrading JupyterHub</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Upgrading...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="upgrading-to-jupyterhub-5">
<span id="howto-upgrading-v5"></span><h1>Upgrading to JupyterHub 5<a class="headerlink" href="#upgrading-to-jupyterhub-5" title="Link to this heading">#</a></h1>
<p>This document describes the specific considerations.
For general upgrading tips, see the <a class="reference internal" href="upgrading.html"><span class="doc std std-doc">docs on upgrading jupyterhub</span></a>.</p>
<p>You can see the <a class="reference internal" href="../reference/changelog.html#changelog"><span class="std std-ref">changelog</span></a> for more detailed information.</p>
<section id="python-version">
<h2>Python version<a class="headerlink" href="#python-version" title="Link to this heading">#</a></h2>
<p>JupyterHub 5 requires Python 3.8.
Make sure you have at least Python 3.8 in your user and hub environments before upgrading.</p>
</section>
<section id="database-upgrades">
<h2>Database upgrades<a class="headerlink" href="#database-upgrades" title="Link to this heading">#</a></h2>
<p>JupyterHub 5 does have a database schema upgrade,
so you should backup your database and run <code class="docutils literal notranslate"><span class="pre">jupyterhub</span> <span class="pre">upgrade-db</span></code> after upgrading and before starting JupyterHub.
The updated schema only adds some columns, so is one that should be not too disruptive to roll back if you need to.</p>
</section>
<section id="user-subdomains">
<h2>User subdomains<a class="headerlink" href="#user-subdomains" title="Link to this heading">#</a></h2>
<p>All JupyterHub deployments which care about protecting users from each other are encouraged to enable per-user domains, if possible,
as this provides the best isolation between user servers.</p>
<p>To enable subdomains, set:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">JupyterHub</span><span class="o">.</span><span class="n">subdomain_host</span> <span class="o">=</span> <span class="s2">&quot;https://myjupyterhub.example.org&quot;</span>
</pre></div>
</div>
<p>If you were using subdomains before, some user servers and all services will be on different hosts in the default configuration.</p>
<p>JupyterHub 5 allows complete customization of the subdomain scheme via the new <a class="reference internal" href="../reference/api/app.html#jupyterhub.app.JupyterHub.subdomain_hook" title="jupyterhub.app.JupyterHub.subdomain_hook"><code class="xref py py-attr docutils literal notranslate"><span class="pre">JupyterHub.subdomain_hook</span></code></a>,
and changes the default subdomain scheme.
.</p>
<p>You can provide a completely custom subdomain scheme, or select one of two default implementations by name: <code class="docutils literal notranslate"><span class="pre">idna</span></code> or <code class="docutils literal notranslate"><span class="pre">legacy</span></code>. <code class="docutils literal notranslate"><span class="pre">idna</span></code> is the default.</p>
<p>The new default behavior can be selected explicitly via:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">JupyterHub</span><span class="o">.</span><span class="n">subdomain_hook</span> <span class="o">=</span> <span class="s2">&quot;idna&quot;</span>
</pre></div>
</div>
<p>Or to delay any changes to URLs for your users, you can opt-in to the pre-5.0 behavior with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">JupyterHub</span><span class="o">.</span><span class="n">subdomain_hook</span> <span class="o">=</span> <span class="s2">&quot;legacy&quot;</span>
</pre></div>
</div>
<p>The key differences of the new <code class="docutils literal notranslate"><span class="pre">idna</span></code> scheme:</p>
<ul class="simple">
<li><p>It should always produce valid domains, regardless of username (not true for the legacy scheme when using characters that might need escaping or usernames that are long)</p></li>
<li><p>each Service gets its own subdomain on <code class="docutils literal notranslate"><span class="pre">service--</span></code> rather than sharing <code class="docutils literal notranslate"><span class="pre">services.</span></code></p></li>
</ul>
<p>Below is a table of examples of users and services with their domains with the old and new scheme, assuming the configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">JupyterHub</span><span class="o">.</span><span class="n">subdomain_host</span> <span class="o">=</span> <span class="s2">&quot;https://jupyter.example.org&quot;</span>
</pre></div>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>kind</p></th>
<th class="head"><p>name</p></th>
<th class="head"><p>legacy</p></th>
<th class="head"><p>idna</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>user</p></td>
<td><p>laudna</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">laudna.jupyter.example.org</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">laudna.jupyter.example.org</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>service</p></td>
<td><p>bells</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">services.jupyter.example.org</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bells--service.jupyter.example.org</span></code></p></td>
</tr>
<tr class="row-even"><td><p>user</p></td>
<td><p>jester&#64;mighty.nein</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">jester_40mighty.nein.jupyter.example.org</span></code> (may not work!)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u-jestermi--8037680.jupyter.example.org</span></code> (not as pretty, but guaranteed to be valid and not collide)</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="tokens-in-urls">
<h2>Tokens in URLs<a class="headerlink" href="#tokens-in-urls" title="Link to this heading">#</a></h2>
<p>JupyterHub 5 does not accept <code class="docutils literal notranslate"><span class="pre">?token=...</span></code> URLs by default in single-user servers.
These URLs allow one user to force another to login as them,
which can be the start of an inter-user attack.</p>
<p>There is a valid use case for producing links which allow starting a fully authenticated session,
so you may still opt in to this behavior by setting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">Spawner</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;JUPYTERHUB_ALLOW_TOKEN_IN_URL&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>if you are not concerned about protecting your users from each other.
If you have subdomains enabled, the threat is substantially reduced.</p>
</section>
<section id="sharing">
<h2>Sharing<a class="headerlink" href="#sharing" title="Link to this heading">#</a></h2>
<p>The big new feature in JupyterHub 5.0 is sharing.
Check it out in <a class="reference internal" href="../tutorial/sharing.html#sharing-tutorial"><span class="std std-ref">the sharing docs</span></a>.</p>
</section>
<section id="authenticator-allow-all-and-allow-existing-users">
<h2>Authenticator.allow_all and allow_existing_users<a class="headerlink" href="#authenticator-allow-all-and-allow-existing-users" title="Link to this heading">#</a></h2>
<p>Prior to JupyterHub 5, JupyterHub Authenticators had the <em>implicit</em> default behavior to allow any user who successfully authenticates to login <strong>if no users are explicitly allowed</strong> (i.e. <code class="docutils literal notranslate"><span class="pre">allowed_users</span></code> is empty on the base class).
This behavior was considered a too-permissive default in Authenticators that source large user pools like OAuthenticator, which would accept e.g. all users with a Google account by default.
As a result, OAuthenticator 16 introduced two configuration options: <code class="docutils literal notranslate"><span class="pre">allow_all</span></code> and <code class="docutils literal notranslate"><span class="pre">allow_existing_users</span></code>.</p>
<p>JupyterHub 5 adopts these options for all Authenticators:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Authenticator.allow_all</span></code> (default: False)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Authenticator.allow_existing_users</span></code> (default: True if allowed_users is non-empty, False otherwise)</p></li>
</ol>
<p>having the effect that <em>some</em> allow configuration is required for anyone to be able to login.
If you want to preserve the pre-5.0 behavior with no explicit <code class="docutils literal notranslate"><span class="pre">allow</span></code> configuration, set:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">Authenticator</span><span class="o">.</span><span class="n">allow_all</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">allow_existing_users</span></code> defaults are meant to be backward-compatible, but you can now <em>explicitly</em> allow or not based on presence in the database by setting <code class="docutils literal notranslate"><span class="pre">Authenticator.allow_existing_users</span></code> to True or False.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../tutorial/getting-started/authenticators-users-basics.html#authenticators"><span class="std std-ref">Authenticator config docs</span></a> for details on these and other Authenticator options.</p>
</div>
</section>
<section id="bootstrap-5">
<h2>Bootstrap 5<a class="headerlink" href="#bootstrap-5" title="Link to this heading">#</a></h2>
<p>JupyterHub uses the CSS framework <a class="reference external" href="https://getbootstrap.com">bootstrap</a>, which is upgraded from 3.4 to 5.3.
If you don’t have any custom HTML templates, you are likely to only see relatively minor aesthetic changes.
If you have custom HTML templates or spawner options forms, they may need some updating to look right.</p>
<p>See the bootstrap documentation. Since we upgraded two major versions, you might need to look at both v4 and v5 documentation for what has changed since 3.x:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://getbootstrap.com/docs/4.6/migration/">migrating to v4</a></p></li>
<li><p><a class="reference external" href="https://getbootstrap.com/docs/5.3/migration/">migrating to v5</a></p></li>
</ul>
<p>If you customized the JupyterHub CSS by recompiling from LESS files, bootstrap migrated to SCSS.
You can start by autoconverting your LESS to SCSS (it’s not that different) with <a class="reference external" href="https://github.com/ekryski/less2sass">less2sass</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>install<span class="w"> </span>--global<span class="w"> </span>less2scss
<span class="c1"># converts less/foo.less to scss/foo.scss</span>
less2scss<span class="w"> </span>--src<span class="w"> </span>./less<span class="w"> </span>--dst<span class="w"> </span>./scss
</pre></div>
</div>
<p>Bootstrap also allows configuring things with <a class="reference external" href="https://getbootstrap.com/docs/5.3/customize/css-variables/">CSS variables</a>, so depending on what you have customized, you may be able to get away with just adding a CSS file defining variables without rebuilding the whole SCSS.</p>
</section>
<section id="groups-required-with-authenticator-manage-groups">
<h2>groups required with Authenticator.manage_groups<a class="headerlink" href="#groups-required-with-authenticator-manage-groups" title="Link to this heading">#</a></h2>
<p>Setting <code class="docutils literal notranslate"><span class="pre">Authenticator.manage_groups</span> <span class="pre">=</span> <span class="pre">True</span></code> allows the Authenticator to manage group membership by returning <code class="docutils literal notranslate"><span class="pre">groups</span></code> from the authentication model.
However, this option is available even on Authenticators that do not support it, which led to confusion.
Starting with JupyterHub 5, if <code class="docutils literal notranslate"><span class="pre">manage_groups</span></code> is True <code class="docutils literal notranslate"><span class="pre">authenticate</span></code> <em>must</em> return a groups field, otherwise an error is raised.
This prevents confusion when users enable managed groups that is not implemented.</p>
<p>If an Authenticator <em>does</em> support managing groups but was not providing a <code class="docutils literal notranslate"><span class="pre">groups</span></code> field in order to leave membership unmodified, it must specify <code class="docutils literal notranslate"><span class="pre">&quot;groups&quot;:</span> <span class="pre">None</span></code> to make this explicit instead of implicit (this is backward-compatible).</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="upgrading.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Upgrading JupyterHub</p>
      </div>
    </a>
    <a class="right-next"
       href="log-messages.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Interpreting common log messages</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-version">Python version</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#database-upgrades">Database upgrades</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#user-subdomains">User subdomains</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tokens-in-urls">Tokens in URLs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sharing">Sharing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#authenticator-allow-all-and-allow-existing-users">Authenticator.allow_all and allow_existing_users</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrap-5">Bootstrap 5</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#groups-required-with-authenticator-manage-groups">groups required with Authenticator.manage_groups</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/jupyterhub/jupyterhub/edit/main/docs/source/howto/upgrading-v5.md">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/howto/upgrading-v5.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Project Jupyter Contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>