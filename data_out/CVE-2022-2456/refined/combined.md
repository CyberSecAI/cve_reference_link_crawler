=== Content from gitlab.com_dcd6efb3_20250108_144519.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-2456.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-2456.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-2456.json)
[Permalink](/gitlab-org/cves/-/blob/c6a6f86828227186d5080abce4d5f88d42571ec9/2022/CVE-2022-2456.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Aug 03, 2022

  [3120704f](/gitlab-org/cves/-/commit/3120704ff815a595941923b151b113f79bcb30da)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/3120704ff815a595941923b151b113f79bcb30da)
  ·
  3120704f

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Aug 03, 2022

  3120704f

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/3120704ff815a595941923b151b113f79bcb30da)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Aug 03, 2022

Loading



=== Content from gitlab.com_ae1f624a_20250108_144520.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Maintainer can change the visibility of Project and Group

**[HackerOne report #1536559](https://hackerone.com/reports/1536559)** by `suruli` on 2022-04-10, assigned to `GitLab Team`:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

Hi, According to gitlab docs, api and web\_ui, a maintainer of a project is restricted from changing its visibility. The check for user permission is done after making sure the new\_visibility is different from current\_visibilty level of the project.

```
###  gitlab-development-kit/gitlab/app/services/concerns/update_visibility_level.rb

def valid_visibility_level_change?(target, new_visibility)
    return true unless new_visibility

    new_visibility_level = Gitlab::VisibilityLevel.level_value(new_visibility)

    if new_visibility_level != target.visibility_level_value   #target.visibility_level_value is 0 for private projects and groups
      unless can?(current_user, :change_visibility_level, target) &&
          Gitlab::VisibilityLevel.allowed_for?(current_user, new_visibility_level)

        deny_visibility_level(target, new_visibility_level)
        return false
      end
    end

    true
 end
```

```
###  gitlab-development-kit/gitlab/lib/gitlab/visibility_level.rb

PRIVATE  = 0 unless const_defined?(:PRIVATE)
INTERNAL = 10 unless const_defined?(:INTERNAL)
PUBLIC   = 20 unless const_defined?(:PUBLIC)

 def string_options
        {
          'private'  => PRIVATE,
          'internal' => INTERNAL,
          'public'   => PUBLIC
        }
end

def level_value(level)
        return level.to_i if level.to_i.to_s == level.to_s && string_options.key(level.to_i)

        string_options[level] || PRIVATE
 end
```

The `level_value` method returns 0 (the value of PRIVATE) for any input except `10, 20, 'internal', 'public'`. For a private project or group, passing the new\_visibility as `20r` to the method `level_value` will return 0 that bypasses the check for user permission and then `'20r'.to_i` is 20 (PUBLIC) will be assigned as project visibility.

##### Requirements:

1. Two gitlab accounts (Eg, victim\_account and attacker\_account).
2. Burp or similar.

# Steps to reproduce

##### Victim:

1. Login to victim\_account and goto `New project`>`Create blank project`
2. Give any `Project name`. Make sure `Project URL` has victim's username and click `Create project`

[![new_project_form.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/f7acba902f9678db6fc63c635837000f5d093d9d/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f39323661356330392d373736622d346663322d616238612d3032336532343366636130382f6e65775f70726f6a6563745f666f726d2e706e67)

3. Visit the created project and goto `Project Information`>`Members` from the side menu. Click `invite members`.
4. Enter the attacker\_account's username or email address. Select the role `Maintainer` and click `Invite`.

[![invite_attacker.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/4f737a36ed363786868ddaf7fc9ac64f053c1a38/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f66333733373534302d613433622d343961352d613365332d3937643932653038306463372f696e766974655f61747461636b65722e706e67)

##### Attacker:

5. Visit the victim's project from attacker\_account.
6. Goto `Settings`>`General` from side menu.
7. Expand `Visibility, project features, permissions` section.
8. Turn the Burp intercept on and click `Save changes` at the bottom of that section.

   [![save_changes.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/249aaf640fd5803962a8bf7849a0bace2679853f/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f65633561633066362d366535362d346633652d613531352d3563623966333166656633382f736176655f6368616e6765732e706e67)

Example Request

```
POST /victim-namespace/victim-project-slug HTTP/2
.
.
.
.
.
-----------------------------31179005449602053611562110226
Content-Disposition: form-data; name="_method"

patch
-----------------------------31179005449602053611562110226
Content-Disposition: form-data; name="update_section"

js-shared-permissions
-----------------------------31179005449602053611562110226
Content-Disposition: form-data; name="project[request_access_enabled]"

true
-----------------------------31179005449602053611562110226
Content-Disposition: form-data; name="project[project_feature_attributes][issues_access_level]"

20
-----------------------------31179005449602053611562110226
.
.
.
-----------------------------31179005449602053611562110226--
```

9. Add the following value to the request along with the form boundary and `Send` the request.

```
Content-Disposition: form-data; name="project[visibility_level]"

20r
```

Other visibility levels can also be set by replacing the value `20r` with following values.

##### current visibility > input > resulting visibility

private>`20r`>public

private>`10r`>internal

public > `public` > private

internal > `internal` > private

10. Refresh the page to see the change of `Project visibility` .

The same steps can be repeated for Groups as well.

##### What is the current *bug* behavior?

user permission is checked after the check for inequality of new and current visibility level.

##### What is the expected *correct* behavior?

user permission should be checked before the check for inequality.

Installed fresh gitlab instance from <https://about.gitlab.com/install/#ubuntu> on the date of the report.

#### Impact

A Maintainer can change:

Visibility of Projects and Groups in Self-managed Gitlab instance.

Visibility of Projects in gitlab.com.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [new\_project\_form.png](https://h1.sec.gitlab.net/a/926a5c09-776b-4fc2-ab8a-023e243fca08/new_project_form.png)
* [invite\_attacker.png](https://h1.sec.gitlab.net/a/f3737540-a43b-49a5-a3e3-97d92e080dc7/invite_attacker.png)
* [save\_changes.png](https://h1.sec.gitlab.net/a/ec5ac0f6-6e56-4f3e-a515-5cb9f31fef38/save_changes.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


