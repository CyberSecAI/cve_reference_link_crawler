
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fpull%2F9638)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fpull%2F9638)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=DSpace%2FDSpace)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[DSpace](/DSpace)
/
**[DSpace](/DSpace/DSpace)**
Public

* [Notifications](/login?return_to=%2FDSpace%2FDSpace) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2FDSpace%2FDSpace)
* [Star
   919](/login?return_to=%2FDSpace%2FDSpace)

* [Code](/DSpace/DSpace)
* [Issues
  591](/DSpace/DSpace/issues)
* [Pull requests
  164](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects
  0](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

Additional navigation options

* [Code](/DSpace/DSpace)
* [Issues](/DSpace/DSpace/issues)
* [Pull requests](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FDSpace%2FDSpace%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FDSpace%2FDSpace%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Update configuration to always download HTML/JS/XML Bitstreams (no inline display) #9638

 Merged

[kshepherd](/kshepherd)
merged 6 commits into
[DSpace:main](/DSpace/DSpace/tree/main "DSpace/DSpace:main")
from
[tdonohue:avoid\_inline\_js](/tdonohue/DSpace/tree/avoid_inline_js "tdonohue/DSpace:avoid_inline_js")

Jun 17, 2024

 Merged

# [Update configuration to always download HTML/JS/XML Bitstreams (no inline display)](#top) #9638

[kshepherd](/kshepherd)
merged 6 commits into
[DSpace:main](/DSpace/DSpace/tree/main "DSpace/DSpace:main")
from
[tdonohue:avoid\_inline\_js](/tdonohue/DSpace/tree/avoid_inline_js "tdonohue/DSpace:avoid_inline_js")

Jun 17, 2024

[Conversation
19](/DSpace/DSpace/pull/9638)
[Commits
6](/DSpace/DSpace/pull/9638/commits)
[Checks
23](/DSpace/DSpace/pull/9638/checks)
[Files changed](/DSpace/DSpace/pull/9638/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![tdonohue](https://avatars.githubusercontent.com/u/483997?s=60&v=4)](/tdonohue)

Copy link

Member

### @tdonohue **[tdonohue](/tdonohue)** commented [Jun 6, 2024](#issue-2338743911) • edited Loading

## Description

This PR updates our default settings for `webui.content_disposition_format` to include HTML, JavaScript, XML and RDF by default.

The changes in this PR are the equivalent of these settings in `dspace.cfg`. These settings will work in any DSpace 7.6 or 7.6.1 installation to provide the same fixes as this PR.

```
webui.content_disposition_format = text/html
webui.content_disposition_format = text/javascript
webui.content_disposition_format = text/xml
webui.content_disposition_format = rdf

```

This ensures that bitstreams of these formats are always downloaded and never opened inline by a user's browser. Opening these formats inline *may* cause the browser to execute any JavaScript contained within them. (Execution of embedded JavaScript may not always occur for all sites, but it is possible.)

**New Wildcard Option**

This PR also provides sites the ability to force *all* formats to download only. This means that no files will ever be opened inline in a user's browser. To force all formats to download only, use a wildcard/asterisk:

```
webui.content_disposition_format = *

```

**Add JavaScript to Format Registry**

This PR also adds JavaScript to the list of default formats in the Bitstream Format Registry to ensure it is a recognized format (by default).

## Instructions for Reviewers

* Deploy this PR
* Upload one or more HTML or JS or XML or RDF bitstreams to a new or existing Item
* Attempt to download those bitstreams. Ensure do *not* open in your browser window. Instead, they should download directly to your machine.
* Test the new wildcard option.
  + Set `webui.content_disposition_format = *` in your local.cfg or dspace.cfg
  + Ensure all file formats will now **only download**.
  + For example, your browser should no longer attempt to open PDFs or image files in the browser window. These will all be downloaded.

## Related work

For more on `webui.content_disposition_format` see [#8891](https://github.com/DSpace/DSpace/pull/8891)

Sorry, something went wrong.

All reactions

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
added
[bug](/DSpace/DSpace/labels/bug)
[high priority](/DSpace/DSpace/labels/high%20priority)
[interface: REST API v7+](/DSpace/DSpace/labels/interface%3A%20REST%20API%20v7%2B)
REST API for v7 and later (dspace-server-webapp module)
[1 APPROVAL](/DSpace/DSpace/labels/1%20APPROVAL)
pull request only requires a single approval to merge.
[port to dspace-7\_x](/DSpace/DSpace/labels/port%20to%20dspace-7_x)
This PR needs to be ported to `dspace-7\_x` branch for next bug-fix release
labels
[Jun 6, 2024](#event-13069714884)

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
added this to the [8.0](/DSpace/DSpace/milestone/63) milestone
[Jun 6, 2024](#event-13069714913)

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
assigned [tdonohue](/tdonohue)
[Jun 6, 2024](#event-13069716809)

[![mwoodiupui](https://avatars.githubusercontent.com/u/697642?s=60&v=4)](/mwoodiupui)

**[mwoodiupui](/mwoodiupui)**
reviewed
[Jun 6, 2024](#pullrequestreview-2102994600)

 [View reviewed changes](/DSpace/DSpace/pull/9638/files)

Copy link

Member

### @mwoodiupui **[mwoodiupui](/mwoodiupui)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Looks right but seems to be failing integration tests.

Sorry, something went wrong.

All reactions

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=80&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)

Copy link

Member

Author

### **[tdonohue](/tdonohue)** commented [Jun 6, 2024](#issuecomment-2153234349)

| [@mwoodiupui](https://github.com/mwoodiupui) : Thanks for the note! It appears we have an IT which is still *hardcoding* a specific count of BitstreamFormats (sigh). Since this PR added a single new BitstreamFormat those counts all failed. So, it's really a flawed test & not a sign of an issue in this PR.  Nonetheless, I'll get the test fixed (hopefully later today) so that it succeeds. (If I can figure out a way to easily remove the hardcoded numbers, I'll do so...but not sure how much effort that'd be) |
| --- |

All reactions

Sorry, something went wrong.

[![abollini](https://avatars.githubusercontent.com/u/1537527?s=60&v=4)](/abollini)

**[abollini](/abollini)**
requested changes
[Jun 6, 2024](#pullrequestreview-2103267106)

 [View reviewed changes](/DSpace/DSpace/pull/9638/files)

Copy link

Member

### @abollini **[abollini](/abollini)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I'm ok with this PR except for the IT fix that I would recommend to fix keeping the number of types hardcoded

Sorry, something went wrong.

All reactions

[dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamFormatRestRepositoryIT.java](/DSpace/DSpace/pull/9638/files#diff-bbd351a7e7de0e5a0899f02139a2833f6260a61a6efae497f099a903e0376a60)
Outdated

Show resolved

Hide resolved

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=80&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)

Copy link

Member

Author

### **[tdonohue](/tdonohue)** commented [Jun 6, 2024](#issuecomment-2153457907) • edited Loading

| [@mwoodiupui](https://github.com/mwoodiupui) : ~~I fixed the failing tests by ensure the `BitstreamFormatRestRepositoryIT` no longer hardcodes the number of BitstreamFormats. The updated code now loads that count from the BitstreamFormatService before tests run, ensuring it will update dynamically for the future.~~  Nevermind, I changed it to update the hardcoded value per [@abollini](https://github.com/abollini) 's feedback above. See [8d81c14](https://github.com/DSpace/DSpace/pull/9638/commits/8d81c144bba435a5b515ae6e54cd65582f343eda) |
| --- |

All reactions

Sorry, something went wrong.

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
[force-pushed](/DSpace/DSpace/compare/1b16836a3c0f1d5d347a7653b0a86761bcf15d61..8d81c144bba435a5b515ae6e54cd65582f343eda)
the
avoid\_inline\_js

branch
2 times, most recently
from
[`1b16836`](/DSpace/DSpace/commit/1b16836a3c0f1d5d347a7653b0a86761bcf15d61) to
[`8d81c14`](/DSpace/DSpace/commit/8d81c144bba435a5b515ae6e54cd65582f343eda)  [Compare](/DSpace/DSpace/compare/1b16836a3c0f1d5d347a7653b0a86761bcf15d61..8d81c144bba435a5b515ae6e54cd65582f343eda)
[June 6, 2024 21:50](#event-13072613009)

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
requested review from
[abollini](/abollini) and
[mwoodiupui](/mwoodiupui)
[June 6, 2024 21:51](#event-13072616888)

[![@mwoodiupui](https://avatars.githubusercontent.com/u/697642?s=80&v=4)](/mwoodiupui)

Copy link

Member

### **[mwoodiupui](/mwoodiupui)** commented [Jun 7, 2024](#issuecomment-2155217175)

| Perhaps, **separate from this issue**, we should have a discussion about why the test should depend on a magic number that has to be changed when unrelated improvements are made. |
| --- |

All reactions

Sorry, something went wrong.

[![mwoodiupui](https://avatars.githubusercontent.com/u/697642?s=60&v=4)](/mwoodiupui)

**[mwoodiupui](/mwoodiupui)**
approved these changes
[Jun 7, 2024](#pullrequestreview-2105401986)

 [View reviewed changes](/DSpace/DSpace/pull/9638/files)

Copy link

Member

### @mwoodiupui **[mwoodiupui](/mwoodiupui)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

+1 by inspection

Sorry, something went wrong.

All reactions

[![@Xib3rR4dAr](https://avatars.githubusercontent.com/u/24238512?s=80&v=4)](/Xib3rR4dAr)

Copy link

### **[Xib3rR4dAr](/Xib3rR4dAr)** commented [Jun 8, 2024](#issuecomment-2155987162) • edited Loading

| XML files (text/xml) also allow JavaScript execution. |
| --- |

 👍
1
 tdonohue reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

 [tdonohue](/tdonohue)
added 4 commits
[June 10, 2024 09:37](#commits-pushed-356a028)

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue)

`[Avoid inline display of HTML/JS bitstreams. Add JS to list of known f…](/DSpace/DSpace/pull/9638/commits/356a0281867989cd1bf6345f9d369f9c992791c8 "Avoid inline display of HTML/JS bitstreams.  Add JS to list of known formats so that it can be recognized by DSpace.")`
 …

`[356a028](/DSpace/DSpace/pull/9638/commits/356a0281867989cd1bf6345f9d369f9c992791c8)`

```
…ormats so that it can be recognized by DSpace.
```

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue)

`[Fix failing IT by increasing number of formats by one](/DSpace/DSpace/pull/9638/commits/c61b7033f2ce63ceec6d867679216cccdaf10aec "Fix failing IT by increasing number of formats by one")`

`[c61b703](/DSpace/DSpace/pull/9638/commits/c61b7033f2ce63ceec6d867679216cccdaf10aec)`

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue)

`[Add XML to the list of formats to always download](/DSpace/DSpace/pull/9638/commits/39975e45cfff8aa70c7c0896c6f1cdff8d3e6fbf "Add XML to the list of formats to always download")`

`[39975e4](/DSpace/DSpace/pull/9638/commits/39975e45cfff8aa70c7c0896c6f1cdff8d3e6fbf)`

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue)

`[Add a test to prove the default settings are to always download these…](/DSpace/DSpace/pull/9638/commits/e6bfb833eed8228aa8f9ab66ec3277284d747b0d "Add a test to prove the default settings are to always download these formats")`
 …

`[e6bfb83](/DSpace/DSpace/pull/9638/commits/e6bfb833eed8228aa8f9ab66ec3277284d747b0d)`

```
… formats
```

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
[force-pushed](/DSpace/DSpace/compare/8d81c144bba435a5b515ae6e54cd65582f343eda..e6bfb833eed8228aa8f9ab66ec3277284d747b0d)
the
avoid\_inline\_js

branch
from
[`8d81c14`](/DSpace/DSpace/commit/8d81c144bba435a5b515ae6e54cd65582f343eda) to
[`e6bfb83`](/DSpace/DSpace/commit/e6bfb833eed8228aa8f9ab66ec3277284d747b0d)  [Compare](/DSpace/DSpace/compare/8d81c144bba435a5b515ae6e54cd65582f343eda..e6bfb833eed8228aa8f9ab66ec3277284d747b0d)
[June 10, 2024 15:10](#event-13103174430)

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
changed the title
~~Update configuration to always download HTML/JS Bitstreams (no inline display)~~
Update configuration to always download HTML/JS/XML Bitstreams (no inline display)
[Jun 10, 2024](#event-13103184197)

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=80&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)

Copy link

Member

Author

### **[tdonohue](/tdonohue)** commented [Jun 10, 2024](#issuecomment-2158628995)

| I've updated this PR today to include the following:   * Added XML (text/xml) to the list of formats to always download * Added automated tests to `BitstreamRestControllerIT` to verify that HTML, JS & XML are all downloaded by default. (This is to simply protect us and other sites from removing these configs in the future) |
| --- |

All reactions

Sorry, something went wrong.

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue)

`[For additional security, ensure "unknown" formats are always download…](/DSpace/DSpace/pull/9638/commits/6da072de9e43d52e43eb9b312446a9359638f3c7 "For additional security, ensure \"unknown\" formats are always downloaded. Update test to prove behavior.")`
 …

`[6da072d](/DSpace/DSpace/pull/9638/commits/6da072de9e43d52e43eb9b312446a9359638f3c7)`

```
…ed. Update test to prove behavior.
```

[![@mwoodiupui](https://avatars.githubusercontent.com/u/697642?s=80&v=4)](/mwoodiupui)

Copy link

Member

### **[mwoodiupui](/mwoodiupui)** commented [Jun 10, 2024](#issuecomment-2159167402)

| I hate to drag this out further, but if we list `text/xml` then we probably also need `application/xml`. <https://stackoverflow.com/q/4832357/2916377> |
| --- |

All reactions

Sorry, something went wrong.

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue)

`[To avoid misconfiguration, hardcode HTML, XML, RDF, JS to download on…](/DSpace/DSpace/pull/9638/commits/a091d343b9c1e491ca0fc005fd18bc1c75f8e830 "To avoid misconfiguration, hardcode HTML, XML, RDF, JS to download only. Add a new wildcard setting to allow sites to force all files to download only.")`
 …

`[a091d34](/DSpace/DSpace/pull/9638/commits/a091d343b9c1e491ca0fc005fd18bc1c75f8e830)`

```
…ly. Add a new wildcard setting to allow sites to force all files to download only.
```

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
requested a review
from [mwoodiupui](/mwoodiupui)
[June 10, 2024 20:03](#event-13106829383)

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=80&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)

Copy link

Member

Author

### **[tdonohue](/tdonohue)** commented [Jun 10, 2024](#issuecomment-2159195056)

| [@abollini](https://github.com/abollini) and [@mwoodiupui](https://github.com/mwoodiupui) : I've made some changes to this PR today which I hope are improvements, so I'd appreciate a re-review. See the updated PR description for all the details...but here are the highlights:   * I've hardcoded some file formats into Java code to avoid misconfiguration. While I don't tend to like hardcoded settings, I think it may be best to do so in this situation. For example, I cannot think of a use case where these settings should NOT be in place. * I've added a new wildcard (asterisk: `*`) option to disable inline opening for **all files**. * I've added more automated tests to verify everything is working as it should. |
| --- |

All reactions

Sorry, something went wrong.

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=80&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)

Copy link

Member

Author

### **[tdonohue](/tdonohue)** commented [Jun 10, 2024](#issuecomment-2159200093) • edited Loading

| [@mwoodiupui](https://github.com/mwoodiupui) : Per [your comment](https://github.com/DSpace/DSpace/pull/9638#issuecomment-2159167402), we don't need to include `application/xml` in this PR as that's not a format in our DSpace Format Registry: <https://github.com/DSpace/DSpace/blob/main/dspace/config/registries/bitstream-formats.xml>  Any file format that is NOT in that registry will be downloaded as `application/octet-stream`. Browsers seem to **always** download `application/octet-stream` by default (regardless of what the actual file format is). But, I've also added some automated tests & minor code cleanup in my last few commits to force anything that comes back as `application/octet-stream` to use `content-disposition: attachment` (just to formally tell the browser we want it to keep downloading this unrecognized format) |
| --- |

 👍
1
 mwoodiupui reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=80&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)

Copy link

Member

Author

### **[tdonohue](/tdonohue)** commented [Jun 10, 2024](#issuecomment-2159237907)

| Final note for today: Because everything that comes back as `application/octet-stream` now uses `content-disposition: attachment`, we *could* now **remove** `text/javascript` from the registry (i.e. revert those changes from this PR). I don't believe it is needed anymore. But, I'll wait to do anything like that until I have further feedback on the directions of this PR.  (We could also wait until this week's Developer's Meeting to discuss all this in greater detail together.) |
| --- |

All reactions

Sorry, something went wrong.

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
requested a review
from [kshepherd](/kshepherd)
[June 13, 2024 14:14](#event-13147642488)

[![pnbecker](https://avatars.githubusercontent.com/u/6109314?s=60&v=4)](/pnbecker)

**[pnbecker](/pnbecker)**
approved these changes
[Jun 13, 2024](#pullrequestreview-2116006152)

 [View reviewed changes](/DSpace/DSpace/pull/9638/files/a091d343b9c1e491ca0fc005fd18bc1c75f8e830)

Copy link

Member

### @pnbecker **[pnbecker](/pnbecker)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I did a code review. It looks good to me. I have one comment: while I understand why we have a hard-coded restriction on html, javascript and xml, we do not have a way to override this. There are probably repositories that want to be able to show html after properly reviewing it or by allowing very trusted users to submit anything. I think it would be less than one hour to introduce a new configuration property that allows to switch off this hardcoded list.

Seeing the timeline for DSpace 8 and the importance of this patch I'm +1.

Sorry, something went wrong.

All reactions

[![abollini](https://avatars.githubusercontent.com/u/1537527?s=60&v=4)](/abollini)

**[abollini](/abollini)**
approved these changes
[Jun 16, 2024](#pullrequestreview-2121472806)

 [View reviewed changes](/DSpace/DSpace/pull/9638/files/a091d343b9c1e491ca0fc005fd18bc1c75f8e830)

Copy link

Member

### @abollini **[abollini](/abollini)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I'm ok with the current PR. Unfortunately, in DSpace 7+ we loose the possibility to serve properly html content that wourl require relative url to work to download css and additional content in the same item. So force the download is the safer and easier solution at this time. We could reconsider it when we have a full functional html support

Sorry, something went wrong.

All reactions

[![kshepherd](https://avatars.githubusercontent.com/u/194773?s=60&v=4)](/kshepherd)

**[kshepherd](/kshepherd)**
approved these changes
[Jun 17, 2024](#pullrequestreview-2122067585)

 [View reviewed changes](/DSpace/DSpace/pull/9638/files/a091d343b9c1e491ca0fc005fd18bc1c75f8e830)

Copy link

Member

### @kshepherd **[kshepherd](/kshepherd)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

+1 tested successfully and the code looks good to me.

Yes, it is a 'hard-coded' fix, but sets the safest defaults, and I think any implementer who is willing to take the risk (perhaps they have extra validation of uploaded html/xml/js) of serving this content inline could reasonably be expected to apply a patch that reverts this change for DSpace 8.x

Sorry, something went wrong.

All reactions

 Hide details
View details

[![@kshepherd](https://avatars.githubusercontent.com/u/194773?s=40&u=3cecc3a98c89fce6b8a48699e4964d86b3dfe88b&v=4)](/kshepherd)
[kshepherd](/kshepherd)
merged commit [`f1059b4`](/DSpace/DSpace/commit/f1059b4340857cca3dc4c45b1ebbadce6bb61c0b)
into
DSpace:main

[Jun 17, 2024](https://github.com/DSpace/DSpace/pull/9638#event-13180851011)
22 checks passed

[![@dspace-bot](https://avatars.githubusercontent.com/u/68393067?s=40&u=19b09a9707f8f9c5a6217bea7926296f7e105a7e&v=4)](/dspace-bot)
[dspace-bot](/dspace-bot)
mentioned this pull request
[Jun 17, 2024](#ref-pullrequest-2356589780)

[[Port dspace-7\_x] Update configuration to always download HTML/JS/XML Bitstreams (no inline display)
#9651](/DSpace/DSpace/pull/9651)
 Merged

[![@dspace-bot](https://avatars.githubusercontent.com/u/68393067?s=80&u=19b09a9707f8f9c5a6217bea7926296f7e105a7e&v=4)](/dspace-bot)

Copy link

Contributor

### **[dspace-bot](/dspace-bot)** commented [Jun 17, 2024](#issuecomment-2172488265)

| Successfully created backport PR for `dspace-7_x`:   * [[Port dspace-7\_x] Update configuration to always download HTML/JS/XML Bitstreams (no inline display) #9651](https://github.com/DSpace/DSpace/pull/9651) |
| --- |

All reactions

Sorry, something went wrong.

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
removed
the
[port to dspace-7\_x](/DSpace/DSpace/labels/port%20to%20dspace-7_x)
This PR needs to be ported to `dspace-7\_x` branch for next bug-fix release
label
[Jun 17, 2024](#event-13186788651)

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
deleted the
avoid\_inline\_js

branch
[June 17, 2024 14:28](#event-13186791236)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fpull%2F9638)

Reviewers

[![@pnbecker](https://avatars.githubusercontent.com/u/6109314?s=40&v=4)](/pnbecker) [pnbecker](/pnbecker)

pnbecker approved these changes

[![@abollini](https://avatars.githubusercontent.com/u/1537527?s=40&v=4)](/abollini) [abollini](/abollini)

abollini approved these changes

[![@kshepherd](https://avatars.githubusercontent.com/u/194773?s=40&v=4)](/kshepherd) [kshepherd](/kshepherd)

kshepherd approved these changes

[![@mwoodiupui](https://avatars.githubusercontent.com/u/697642?s=40&v=4)](/mwoodiupui) [mwoodiupui](/mwoodiupui)

 Awaiting requested review from mwoodiupui

Assignees

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue) [tdonohue](/tdonohue)

Labels

[1 APPROVAL](/DSpace/DSpace/labels/1%20APPROVAL)
pull request only requires a single approval to merge.
[bug](/DSpace/DSpace/labels/bug)
[high priority](/DSpace/DSpace/labels/high%20priority)
[interface: REST API v7+](/DSpace/DSpace/labels/interface%3A%20REST%20API%20v7%2B)
REST API for v7 and later (dspace-server-webapp module)

Projects

No open projects
1 closed project

[DSpace 8.0 Release](/orgs/DSpace/projects/27)
Status: ✅ Done

Milestone

 [**8.0**](/DSpace/DSpace/milestone/63 "8.0")

Development

Successfully merging this pull request may close these issues.

7 participants

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=52&v=4)](/tdonohue) [![@mwoodiupui](https://avatars.githubusercontent.com/u/697642?s=52&v=4)](/mwoodiupui) [![@Xib3rR4dAr](https://avatars.githubusercontent.com/u/24238512?s=52&v=4)](/Xib3rR4dAr) [![@dspace-bot](https://avatars.githubusercontent.com/u/68393067?s=52&v=4)](/dspace-bot) [![@kshepherd](https://avatars.githubusercontent.com/u/194773?s=52&v=4)](/kshepherd) [![@abollini](https://avatars.githubusercontent.com/u/1537527?s=52&v=4)](/abollini) [![@pnbecker](https://avatars.githubusercontent.com/u/6109314?s=52&v=4)](/pnbecker)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

