=== Content from github.com_d70a9457_20250111_013736.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fpull%2F9638)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fpull%2F9638)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=DSpace%2FDSpace)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[DSpace](/DSpace)
/
**[DSpace](/DSpace/DSpace)**
Public

* [Notifications](/login?return_to=%2FDSpace%2FDSpace) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2FDSpace%2FDSpace)
* [Star
   919](/login?return_to=%2FDSpace%2FDSpace)

* [Code](/DSpace/DSpace)
* [Issues
  591](/DSpace/DSpace/issues)
* [Pull requests
  164](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects
  0](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

Additional navigation options

* [Code](/DSpace/DSpace)
* [Issues](/DSpace/DSpace/issues)
* [Pull requests](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FDSpace%2FDSpace%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FDSpace%2FDSpace%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Update configuration to always download HTML/JS/XML Bitstreams (no inline display) #9638

 Merged

[kshepherd](/kshepherd)
merged 6 commits into
[DSpace:main](/DSpace/DSpace/tree/main "DSpace/DSpace:main")
from
[tdonohue:avoid\_inline\_js](/tdonohue/DSpace/tree/avoid_inline_js "tdonohue/DSpace:avoid_inline_js")

Jun 17, 2024

 Merged

# [Update configuration to always download HTML/JS/XML Bitstreams (no inline display)](#top) #9638

[kshepherd](/kshepherd)
merged 6 commits into
[DSpace:main](/DSpace/DSpace/tree/main "DSpace/DSpace:main")
from
[tdonohue:avoid\_inline\_js](/tdonohue/DSpace/tree/avoid_inline_js "tdonohue/DSpace:avoid_inline_js")

Jun 17, 2024

[Conversation
19](/DSpace/DSpace/pull/9638)
[Commits
6](/DSpace/DSpace/pull/9638/commits)
[Checks
23](/DSpace/DSpace/pull/9638/checks)
[Files changed](/DSpace/DSpace/pull/9638/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![tdonohue](https://avatars.githubusercontent.com/u/483997?s=60&v=4)](/tdonohue)

Copy link

Member

### @tdonohue **[tdonohue](/tdonohue)** commented [Jun 6, 2024](#issue-2338743911) • edited Loading

## Description

This PR updates our default settings for `webui.content_disposition_format` to include HTML, JavaScript, XML and RDF by default.

The changes in this PR are the equivalent of these settings in `dspace.cfg`. These settings will work in any DSpace 7.6 or 7.6.1 installation to provide the same fixes as this PR.

```
webui.content_disposition_format = text/html
webui.content_disposition_format = text/javascript
webui.content_disposition_format = text/xml
webui.content_disposition_format = rdf

```

This ensures that bitstreams of these formats are always downloaded and never opened inline by a user's browser. Opening these formats inline *may* cause the browser to execute any JavaScript contained within them. (Execution of embedded JavaScript may not always occur for all sites, but it is possible.)

**New Wildcard Option**

This PR also provides sites the ability to force *all* formats to download only. This means that no files will ever be opened inline in a user's browser. To force all formats to download only, use a wildcard/asterisk:

```
webui.content_disposition_format = *

```

**Add JavaScript to Format Registry**

This PR also adds JavaScript to the list of default formats in the Bitstream Format Registry to ensure it is a recognized format (by default).

## Instructions for Reviewers

* Deploy this PR
* Upload one or more HTML or JS or XML or RDF bitstreams to a new or existing Item
* Attempt to download those bitstreams. Ensure do *not* open in your browser window. Instead, they should download directly to your machine.
* Test the new wildcard option.
  + Set `webui.content_disposition_format = *` in your local.cfg or dspace.cfg
  + Ensure all file formats will now **only download**.
  + For example, your browser should no longer attempt to open PDFs or image files in the browser window. These will all be downloaded.

## Related work

For more on `webui.content_disposition_format` see [#8891](https://github.com/DSpace/DSpace/pull/8891)

Sorry, something went wrong.

All reactions

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
added
[bug](/DSpace/DSpace/labels/bug)
[high priority](/DSpace/DSpace/labels/high%20priority)
[interface: REST API v7+](/DSpace/DSpace/labels/interface%3A%20REST%20API%20v7%2B)
REST API for v7 and later (dspace-server-webapp module)
[1 APPROVAL](/DSpace/DSpace/labels/1%20APPROVAL)
pull request only requires a single approval to merge.
[port to dspace-7\_x](/DSpace/DSpace/labels/port%20to%20dspace-7_x)
This PR needs to be ported to `dspace-7\_x` branch for next bug-fix release
labels
[Jun 6, 2024](#event-13069714884)

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
added this to the [8.0](/DSpace/DSpace/milestone/63) milestone
[Jun 6, 2024](#event-13069714913)

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
assigned [tdonohue](/tdonohue)
[Jun 6, 2024](#event-13069716809)

[![mwoodiupui](https://avatars.githubusercontent.com/u/697642?s=60&v=4)](/mwoodiupui)

**[mwoodiupui](/mwoodiupui)**
reviewed
[Jun 6, 2024](#pullrequestreview-2102994600)

 [View reviewed changes](/DSpace/DSpace/pull/9638/files)

Copy link

Member

### @mwoodiupui **[mwoodiupui](/mwoodiupui)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Looks right but seems to be failing integration tests.

Sorry, something went wrong.

All reactions

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=80&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)

Copy link

Member

Author

### **[tdonohue](/tdonohue)** commented [Jun 6, 2024](#issuecomment-2153234349)

| [@mwoodiupui](https://github.com/mwoodiupui) : Thanks for the note! It appears we have an IT which is still *hardcoding* a specific count of BitstreamFormats (sigh). Since this PR added a single new BitstreamFormat those counts all failed. So, it's really a flawed test & not a sign of an issue in this PR.  Nonetheless, I'll get the test fixed (hopefully later today) so that it succeeds. (If I can figure out a way to easily remove the hardcoded numbers, I'll do so...but not sure how much effort that'd be) |
| --- |

All reactions

Sorry, something went wrong.

[![abollini](https://avatars.githubusercontent.com/u/1537527?s=60&v=4)](/abollini)

**[abollini](/abollini)**
requested changes
[Jun 6, 2024](#pullrequestreview-2103267106)

 [View reviewed changes](/DSpace/DSpace/pull/9638/files)

Copy link

Member

### @abollini **[abollini](/abollini)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I'm ok with this PR except for the IT fix that I would recommend to fix keeping the number of types hardcoded

Sorry, something went wrong.

All reactions

[dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamFormatRestRepositoryIT.java](/DSpace/DSpace/pull/9638/files#diff-bbd351a7e7de0e5a0899f02139a2833f6260a61a6efae497f099a903e0376a60)
Outdated

Show resolved

Hide resolved

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=80&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)

Copy link

Member

Author

### **[tdonohue](/tdonohue)** commented [Jun 6, 2024](#issuecomment-2153457907) • edited Loading

| [@mwoodiupui](https://github.com/mwoodiupui) : ~~I fixed the failing tests by ensure the `BitstreamFormatRestRepositoryIT` no longer hardcodes the number of BitstreamFormats. The updated code now loads that count from the BitstreamFormatService before tests run, ensuring it will update dynamically for the future.~~  Nevermind, I changed it to update the hardcoded value per [@abollini](https://github.com/abollini) 's feedback above. See [8d81c14](https://github.com/DSpace/DSpace/pull/9638/commits/8d81c144bba435a5b515ae6e54cd65582f343eda) |
| --- |

All reactions

Sorry, something went wrong.

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
[force-pushed](/DSpace/DSpace/compare/1b16836a3c0f1d5d347a7653b0a86761bcf15d61..8d81c144bba435a5b515ae6e54cd65582f343eda)
the
avoid\_inline\_js

branch
2 times, most recently
from
[`1b16836`](/DSpace/DSpace/commit/1b16836a3c0f1d5d347a7653b0a86761bcf15d61) to
[`8d81c14`](/DSpace/DSpace/commit/8d81c144bba435a5b515ae6e54cd65582f343eda)  [Compare](/DSpace/DSpace/compare/1b16836a3c0f1d5d347a7653b0a86761bcf15d61..8d81c144bba435a5b515ae6e54cd65582f343eda)
[June 6, 2024 21:50](#event-13072613009)

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
requested review from
[abollini](/abollini) and
[mwoodiupui](/mwoodiupui)
[June 6, 2024 21:51](#event-13072616888)

[![@mwoodiupui](https://avatars.githubusercontent.com/u/697642?s=80&v=4)](/mwoodiupui)

Copy link

Member

### **[mwoodiupui](/mwoodiupui)** commented [Jun 7, 2024](#issuecomment-2155217175)

| Perhaps, **separate from this issue**, we should have a discussion about why the test should depend on a magic number that has to be changed when unrelated improvements are made. |
| --- |

All reactions

Sorry, something went wrong.

[![mwoodiupui](https://avatars.githubusercontent.com/u/697642?s=60&v=4)](/mwoodiupui)

**[mwoodiupui](/mwoodiupui)**
approved these changes
[Jun 7, 2024](#pullrequestreview-2105401986)

 [View reviewed changes](/DSpace/DSpace/pull/9638/files)

Copy link

Member

### @mwoodiupui **[mwoodiupui](/mwoodiupui)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

+1 by inspection

Sorry, something went wrong.

All reactions

[![@Xib3rR4dAr](https://avatars.githubusercontent.com/u/24238512?s=80&v=4)](/Xib3rR4dAr)

Copy link

### **[Xib3rR4dAr](/Xib3rR4dAr)** commented [Jun 8, 2024](#issuecomment-2155987162) • edited Loading

| XML files (text/xml) also allow JavaScript execution. |
| --- |

 👍
1
 tdonohue reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

 [tdonohue](/tdonohue)
added 4 commits
[June 10, 2024 09:37](#commits-pushed-356a028)

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue)

`[Avoid inline display of HTML/JS bitstreams. Add JS to list of known f…](/DSpace/DSpace/pull/9638/commits/356a0281867989cd1bf6345f9d369f9c992791c8 "Avoid inline display of HTML/JS bitstreams.  Add JS to list of known formats so that it can be recognized by DSpace.")`
 …

`[356a028](/DSpace/DSpace/pull/9638/commits/356a0281867989cd1bf6345f9d369f9c992791c8)`

```
…ormats so that it can be recognized by DSpace.
```

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue)

`[Fix failing IT by increasing number of formats by one](/DSpace/DSpace/pull/9638/commits/c61b7033f2ce63ceec6d867679216cccdaf10aec "Fix failing IT by increasing number of formats by one")`

`[c61b703](/DSpace/DSpace/pull/9638/commits/c61b7033f2ce63ceec6d867679216cccdaf10aec)`

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue)

`[Add XML to the list of formats to always download](/DSpace/DSpace/pull/9638/commits/39975e45cfff8aa70c7c0896c6f1cdff8d3e6fbf "Add XML to the list of formats to always download")`

`[39975e4](/DSpace/DSpace/pull/9638/commits/39975e45cfff8aa70c7c0896c6f1cdff8d3e6fbf)`

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue)

`[Add a test to prove the default settings are to always download these…](/DSpace/DSpace/pull/9638/commits/e6bfb833eed8228aa8f9ab66ec3277284d747b0d "Add a test to prove the default settings are to always download these formats")`
 …

`[e6bfb83](/DSpace/DSpace/pull/9638/commits/e6bfb833eed8228aa8f9ab66ec3277284d747b0d)`

```
… formats
```

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
[force-pushed](/DSpace/DSpace/compare/8d81c144bba435a5b515ae6e54cd65582f343eda..e6bfb833eed8228aa8f9ab66ec3277284d747b0d)
the
avoid\_inline\_js

branch
from
[`8d81c14`](/DSpace/DSpace/commit/8d81c144bba435a5b515ae6e54cd65582f343eda) to
[`e6bfb83`](/DSpace/DSpace/commit/e6bfb833eed8228aa8f9ab66ec3277284d747b0d)  [Compare](/DSpace/DSpace/compare/8d81c144bba435a5b515ae6e54cd65582f343eda..e6bfb833eed8228aa8f9ab66ec3277284d747b0d)
[June 10, 2024 15:10](#event-13103174430)

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
changed the title
~~Update configuration to always download HTML/JS Bitstreams (no inline display)~~
Update configuration to always download HTML/JS/XML Bitstreams (no inline display)
[Jun 10, 2024](#event-13103184197)

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=80&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)

Copy link

Member

Author

### **[tdonohue](/tdonohue)** commented [Jun 10, 2024](#issuecomment-2158628995)

| I've updated this PR today to include the following:   * Added XML (text/xml) to the list of formats to always download * Added automated tests to `BitstreamRestControllerIT` to verify that HTML, JS & XML are all downloaded by default. (This is to simply protect us and other sites from removing these configs in the future) |
| --- |

All reactions

Sorry, something went wrong.

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue)

`[For additional security, ensure "unknown" formats are always download…](/DSpace/DSpace/pull/9638/commits/6da072de9e43d52e43eb9b312446a9359638f3c7 "For additional security, ensure \"unknown\" formats are always downloaded. Update test to prove behavior.")`
 …

`[6da072d](/DSpace/DSpace/pull/9638/commits/6da072de9e43d52e43eb9b312446a9359638f3c7)`

```
…ed. Update test to prove behavior.
```

[![@mwoodiupui](https://avatars.githubusercontent.com/u/697642?s=80&v=4)](/mwoodiupui)

Copy link

Member

### **[mwoodiupui](/mwoodiupui)** commented [Jun 10, 2024](#issuecomment-2159167402)

| I hate to drag this out further, but if we list `text/xml` then we probably also need `application/xml`. <https://stackoverflow.com/q/4832357/2916377> |
| --- |

All reactions

Sorry, something went wrong.

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue)

`[To avoid misconfiguration, hardcode HTML, XML, RDF, JS to download on…](/DSpace/DSpace/pull/9638/commits/a091d343b9c1e491ca0fc005fd18bc1c75f8e830 "To avoid misconfiguration, hardcode HTML, XML, RDF, JS to download only. Add a new wildcard setting to allow sites to force all files to download only.")`
 …

`[a091d34](/DSpace/DSpace/pull/9638/commits/a091d343b9c1e491ca0fc005fd18bc1c75f8e830)`

```
…ly. Add a new wildcard setting to allow sites to force all files to download only.
```

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
requested a review
from [mwoodiupui](/mwoodiupui)
[June 10, 2024 20:03](#event-13106829383)

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=80&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)

Copy link

Member

Author

### **[tdonohue](/tdonohue)** commented [Jun 10, 2024](#issuecomment-2159195056)

| [@abollini](https://github.com/abollini) and [@mwoodiupui](https://github.com/mwoodiupui) : I've made some changes to this PR today which I hope are improvements, so I'd appreciate a re-review. See the updated PR description for all the details...but here are the highlights:   * I've hardcoded some file formats into Java code to avoid misconfiguration. While I don't tend to like hardcoded settings, I think it may be best to do so in this situation. For example, I cannot think of a use case where these settings should NOT be in place. * I've added a new wildcard (asterisk: `*`) option to disable inline opening for **all files**. * I've added more automated tests to verify everything is working as it should. |
| --- |

All reactions

Sorry, something went wrong.

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=80&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)

Copy link

Member

Author

### **[tdonohue](/tdonohue)** commented [Jun 10, 2024](#issuecomment-2159200093) • edited Loading

| [@mwoodiupui](https://github.com/mwoodiupui) : Per [your comment](https://github.com/DSpace/DSpace/pull/9638#issuecomment-2159167402), we don't need to include `application/xml` in this PR as that's not a format in our DSpace Format Registry: <https://github.com/DSpace/DSpace/blob/main/dspace/config/registries/bitstream-formats.xml>  Any file format that is NOT in that registry will be downloaded as `application/octet-stream`. Browsers seem to **always** download `application/octet-stream` by default (regardless of what the actual file format is). But, I've also added some automated tests & minor code cleanup in my last few commits to force anything that comes back as `application/octet-stream` to use `content-disposition: attachment` (just to formally tell the browser we want it to keep downloading this unrecognized format) |
| --- |

 👍
1
 mwoodiupui reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=80&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)

Copy link

Member

Author

### **[tdonohue](/tdonohue)** commented [Jun 10, 2024](#issuecomment-2159237907)

| Final note for today: Because everything that comes back as `application/octet-stream` now uses `content-disposition: attachment`, we *could* now **remove** `text/javascript` from the registry (i.e. revert those changes from this PR). I don't believe it is needed anymore. But, I'll wait to do anything like that until I have further feedback on the directions of this PR.  (We could also wait until this week's Developer's Meeting to discuss all this in greater detail together.) |
| --- |

All reactions

Sorry, something went wrong.

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
requested a review
from [kshepherd](/kshepherd)
[June 13, 2024 14:14](#event-13147642488)

[![pnbecker](https://avatars.githubusercontent.com/u/6109314?s=60&v=4)](/pnbecker)

**[pnbecker](/pnbecker)**
approved these changes
[Jun 13, 2024](#pullrequestreview-2116006152)

 [View reviewed changes](/DSpace/DSpace/pull/9638/files/a091d343b9c1e491ca0fc005fd18bc1c75f8e830)

Copy link

Member

### @pnbecker **[pnbecker](/pnbecker)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I did a code review. It looks good to me. I have one comment: while I understand why we have a hard-coded restriction on html, javascript and xml, we do not have a way to override this. There are probably repositories that want to be able to show html after properly reviewing it or by allowing very trusted users to submit anything. I think it would be less than one hour to introduce a new configuration property that allows to switch off this hardcoded list.

Seeing the timeline for DSpace 8 and the importance of this patch I'm +1.

Sorry, something went wrong.

All reactions

[![abollini](https://avatars.githubusercontent.com/u/1537527?s=60&v=4)](/abollini)

**[abollini](/abollini)**
approved these changes
[Jun 16, 2024](#pullrequestreview-2121472806)

 [View reviewed changes](/DSpace/DSpace/pull/9638/files/a091d343b9c1e491ca0fc005fd18bc1c75f8e830)

Copy link

Member

### @abollini **[abollini](/abollini)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I'm ok with the current PR. Unfortunately, in DSpace 7+ we loose the possibility to serve properly html content that wourl require relative url to work to download css and additional content in the same item. So force the download is the safer and easier solution at this time. We could reconsider it when we have a full functional html support

Sorry, something went wrong.

All reactions

[![kshepherd](https://avatars.githubusercontent.com/u/194773?s=60&v=4)](/kshepherd)

**[kshepherd](/kshepherd)**
approved these changes
[Jun 17, 2024](#pullrequestreview-2122067585)

 [View reviewed changes](/DSpace/DSpace/pull/9638/files/a091d343b9c1e491ca0fc005fd18bc1c75f8e830)

Copy link

Member

### @kshepherd **[kshepherd](/kshepherd)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

+1 tested successfully and the code looks good to me.

Yes, it is a 'hard-coded' fix, but sets the safest defaults, and I think any implementer who is willing to take the risk (perhaps they have extra validation of uploaded html/xml/js) of serving this content inline could reasonably be expected to apply a patch that reverts this change for DSpace 8.x

Sorry, something went wrong.

All reactions

 Hide details
View details

[![@kshepherd](https://avatars.githubusercontent.com/u/194773?s=40&u=3cecc3a98c89fce6b8a48699e4964d86b3dfe88b&v=4)](/kshepherd)
[kshepherd](/kshepherd)
merged commit [`f1059b4`](/DSpace/DSpace/commit/f1059b4340857cca3dc4c45b1ebbadce6bb61c0b)
into
DSpace:main

[Jun 17, 2024](https://github.com/DSpace/DSpace/pull/9638#event-13180851011)
22 checks passed

[![@dspace-bot](https://avatars.githubusercontent.com/u/68393067?s=40&u=19b09a9707f8f9c5a6217bea7926296f7e105a7e&v=4)](/dspace-bot)
[dspace-bot](/dspace-bot)
mentioned this pull request
[Jun 17, 2024](#ref-pullrequest-2356589780)

[[Port dspace-7\_x] Update configuration to always download HTML/JS/XML Bitstreams (no inline display)
#9651](/DSpace/DSpace/pull/9651)
 Merged

[![@dspace-bot](https://avatars.githubusercontent.com/u/68393067?s=80&u=19b09a9707f8f9c5a6217bea7926296f7e105a7e&v=4)](/dspace-bot)

Copy link

Contributor

### **[dspace-bot](/dspace-bot)** commented [Jun 17, 2024](#issuecomment-2172488265)

| Successfully created backport PR for `dspace-7_x`:   * [[Port dspace-7\_x] Update configuration to always download HTML/JS/XML Bitstreams (no inline display) #9651](https://github.com/DSpace/DSpace/pull/9651) |
| --- |

All reactions

Sorry, something went wrong.

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
removed
the
[port to dspace-7\_x](/DSpace/DSpace/labels/port%20to%20dspace-7_x)
This PR needs to be ported to `dspace-7\_x` branch for next bug-fix release
label
[Jun 17, 2024](#event-13186788651)

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
deleted the
avoid\_inline\_js

branch
[June 17, 2024 14:28](#event-13186791236)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fpull%2F9638)

Reviewers

[![@pnbecker](https://avatars.githubusercontent.com/u/6109314?s=40&v=4)](/pnbecker) [pnbecker](/pnbecker)

pnbecker approved these changes

[![@abollini](https://avatars.githubusercontent.com/u/1537527?s=40&v=4)](/abollini) [abollini](/abollini)

abollini approved these changes

[![@kshepherd](https://avatars.githubusercontent.com/u/194773?s=40&v=4)](/kshepherd) [kshepherd](/kshepherd)

kshepherd approved these changes

[![@mwoodiupui](https://avatars.githubusercontent.com/u/697642?s=40&v=4)](/mwoodiupui) [mwoodiupui](/mwoodiupui)

 Awaiting requested review from mwoodiupui

Assignees

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue) [tdonohue](/tdonohue)

Labels

[1 APPROVAL](/DSpace/DSpace/labels/1%20APPROVAL)
pull request only requires a single approval to merge.
[bug](/DSpace/DSpace/labels/bug)
[high priority](/DSpace/DSpace/labels/high%20priority)
[interface: REST API v7+](/DSpace/DSpace/labels/interface%3A%20REST%20API%20v7%2B)
REST API for v7 and later (dspace-server-webapp module)

Projects

No open projects
1 closed project

[DSpace 8.0 Release](/orgs/DSpace/projects/27)
Status: ✅ Done

Milestone

 [**8.0**](/DSpace/DSpace/milestone/63 "8.0")

Development

Successfully merging this pull request may close these issues.

7 participants

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=52&v=4)](/tdonohue) [![@mwoodiupui](https://avatars.githubusercontent.com/u/697642?s=52&v=4)](/mwoodiupui) [![@Xib3rR4dAr](https://avatars.githubusercontent.com/u/24238512?s=52&v=4)](/Xib3rR4dAr) [![@dspace-bot](https://avatars.githubusercontent.com/u/68393067?s=52&v=4)](/dspace-bot) [![@kshepherd](https://avatars.githubusercontent.com/u/194773?s=52&v=4)](/kshepherd) [![@abollini](https://avatars.githubusercontent.com/u/1537527?s=52&v=4)](/abollini) [![@pnbecker](https://avatars.githubusercontent.com/u/6109314?s=52&v=4)](/pnbecker)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e3a90107_20250111_013734.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fpull%2F8891)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fpull%2F8891)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=DSpace%2FDSpace)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[DSpace](/DSpace)
/
**[DSpace](/DSpace/DSpace)**
Public

* [Notifications](/login?return_to=%2FDSpace%2FDSpace) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2FDSpace%2FDSpace)
* [Star
   919](/login?return_to=%2FDSpace%2FDSpace)

* [Code](/DSpace/DSpace)
* [Issues
  591](/DSpace/DSpace/issues)
* [Pull requests
  164](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects
  0](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

Additional navigation options

* [Code](/DSpace/DSpace)
* [Issues](/DSpace/DSpace/issues)
* [Pull requests](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FDSpace%2FDSpace%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FDSpace%2FDSpace%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Configuration for opening bitstream formats as attachment #8891

 Merged

[tdonohue](/tdonohue)
merged 13 commits into
[DSpace:main](/DSpace/DSpace/tree/main "DSpace/DSpace:main")
from
[atmire:w2p-102124\_bitstream-formats-download-attachment-main](/atmire/DSpace/tree/w2p-102124_bitstream-formats-download-attachment-main "atmire/DSpace:w2p-102124_bitstream-formats-download-attachment-main")

Jun 15, 2023

 Merged

# [Configuration for opening bitstream formats as attachment](#top) #8891

[tdonohue](/tdonohue)
merged 13 commits into
[DSpace:main](/DSpace/DSpace/tree/main "DSpace/DSpace:main")
from
[atmire:w2p-102124\_bitstream-formats-download-attachment-main](/atmire/DSpace/tree/w2p-102124_bitstream-formats-download-attachment-main "atmire/DSpace:w2p-102124_bitstream-formats-download-attachment-main")

Jun 15, 2023

[Conversation
9](/DSpace/DSpace/pull/8891)
[Commits
13](/DSpace/DSpace/pull/8891/commits)
[Checks
0](/DSpace/DSpace/pull/8891/checks)
[Files changed](/DSpace/DSpace/pull/8891/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=60&v=4)](/nona-luypaert)

Copy link

Contributor

### @nona-luypaert **[nona-luypaert](/nona-luypaert)** commented [Jun 7, 2023](#issue-1745252532) • edited Loading

## Description

This PR makes it possible to configure which files should always be downloaded, based on file format. Adding the mimetype/extension of a format to the configuration will ensure the browser will NOT open these files inline.

## Instructions for Reviewers

#### Changes

* Added new property to dspace.cfg: `webui.content_disposition_format`. By default this only contains the RTF-format.
* Edited `retrieve` method in BitstreamRestController to set `content-disposition: attachment` in the Response Headers if the file's mimetype or extension appears in the config property.
* Added extra test to BitstreamRestControllerIT, along with some extra configured formats in local.cfg.

#### Intructions

* First, build DSpace without any values in `webui.content_disposition_format`.
* Create an Item and add some files to it, e.g. a PDF- and RTF-file.
* Try to download them and verify the files are opened inline.
* Build DSpace again, this time with `webui.content_disposition_format = text/richtext, pdf`

  (`rtf, pdf` ; `rtf, application/pdf` ; `text/richtext, application/pdf` would also work).
* Try to download the same files, and verify they get indeed downloaded.

## Checklist

* My PR is small in size (e.g. less than 1,000 lines of code, not including comments & integration tests). Exceptions may be made if previously agreed upon.
* My PR passes Checkstyle validation based on the [Code Style Guide](https://wiki.lyrasis.org/display/DSPACE/Code%2BStyle%2BGuide).
* My PR includes Javadoc for *all new (or modified) public methods and classes*. It also includes Javadoc for large or complex private methods.
* My PR passes all tests and includes new/updated Unit or Integration Tests based on the [Code Testing Guide](https://wiki.lyrasis.org/display/DSPACE/Code%2BTesting%2BGuide).
* If my PR includes new libraries/dependencies (in any `pom.xml`), I've made sure their licenses align with the [DSpace BSD License](https://github.com/DSpace/DSpace/blob/main/LICENSE) based on the [Licensing of Contributions](https://wiki.lyrasis.org/display/DSPACE/Code%2BContribution%2BGuidelines#CodeContributionGuidelines-LicensingofContributions) documentation.
* If my PR modifies REST API endpoints, I've opened a separate [REST Contract](https://github.com/DSpace/RestContract/blob/main/README.md) PR related to this change.
* If my PR includes new configurations, I've provided basic technical documentation in the PR itself.
* If my PR fixes an issue ticket, I've [linked them together](https://docs.github.com/en/issues/tracking-your-work-with-issues/linking-a-pull-request-to-an-issue).

Sorry, something went wrong.

All reactions

 [nona-luypaert](/nona-luypaert)
added 6 commits
[June 5, 2023 16:02](#commits-pushed-9a49998)

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert)

`[102124: Add config for opening formats as attachment + IT](/DSpace/DSpace/pull/8891/commits/9a49998ea0bf8955ebb3063ce11e2f22a2bc06eb "102124: Add config for opening formats as attachment + IT")`

`[9a49998](/DSpace/DSpace/pull/8891/commits/9a49998ea0bf8955ebb3063ce11e2f22a2bc06eb)`

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert)

`[Merge branch 'w2p-102124_bitstream-formats-download-attachment-7.2' i…](/DSpace/DSpace/pull/8891/commits/826f393e337d4734c382899d295bdc66d0d579eb "Merge branch 'w2p-102124_bitstream-formats-download-attachment-7.2' into w2p-102124_bitstream-formats-download-attachment-main

Conflicts:
	dspace-api/src/test/data/dspaceFolder/config/local.cfg
	dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamRestControllerIT.java")`
 …

`[826f393](/DSpace/DSpace/pull/8891/commits/826f393e337d4734c382899d295bdc66d0d579eb)`

```
…nto w2p-102124_bitstream-formats-download-attachment-main

Conflicts:
	dspace-api/src/test/data/dspaceFolder/config/local.cfg
	dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamRestControllerIT.java
```

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert)

`[102124: Fix BitstreamRestController after merge](/DSpace/DSpace/pull/8891/commits/04161a0c4d33cb4c2ab9b64699127a34abc7287e "102124: Fix BitstreamRestController after merge")`

`[04161a0](/DSpace/DSpace/pull/8891/commits/04161a0c4d33cb4c2ab9b64699127a34abc7287e)`

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert)

`[102124: Don't loop over extensions if mimetype was already found](/DSpace/DSpace/pull/8891/commits/bca98cd8f4e2ffda872a30341f0c951f509d2eb5 "102124: Don't loop over extensions if mimetype was already found")`

`[bca98cd](/DSpace/DSpace/pull/8891/commits/bca98cd8f4e2ffda872a30341f0c951f509d2eb5)`

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert)

`[Merge branch 'w2p-102124_bitstream-formats-download-attachment-7.2' i…](/DSpace/DSpace/pull/8891/commits/da48803d3db2923c1e90b6837d2abb606aafa1f5 "Merge branch 'w2p-102124_bitstream-formats-download-attachment-7.2' into w2p-102124_bitstream-formats-download-attachment-main")`
 …

`[da48803](/DSpace/DSpace/pull/8891/commits/da48803d3db2923c1e90b6837d2abb606aafa1f5)`

```
…nto w2p-102124_bitstream-formats-download-attachment-main
```

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert)

`[Merge branch 'main' into w2p-102124_bitstream-formats-download-attach…](/DSpace/DSpace/pull/8891/commits/c7375acf3914af1a334b512d4254f90692dbc5b0 "Merge branch 'main' into w2p-102124_bitstream-formats-download-attachment-main")`
 …

`[c7375ac](/DSpace/DSpace/pull/8891/commits/c7375acf3914af1a334b512d4254f90692dbc5b0)`

```
…ment-main
```

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&u=cd81a1b05933f086d4c9cd9d699c29f963923527&v=4)](/nona-luypaert)
[nona-luypaert](/nona-luypaert)
self-assigned this
[Jun 7, 2023](#event-9455070443)

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&u=cd81a1b05933f086d4c9cd9d699c29f963923527&v=4)](/nona-luypaert)
[nona-luypaert](/nona-luypaert)
added
[improvement](/DSpace/DSpace/labels/improvement)
[interface: REST API v7+](/DSpace/DSpace/labels/interface%3A%20REST%20API%20v7%2B)
REST API for v7 and later (dspace-server-webapp module)
[configuration](/DSpace/DSpace/labels/configuration)
Related to out-of-the-box configuration
labels
[Jun 7, 2023](#event-9456664129)

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&u=cd81a1b05933f086d4c9cd9d699c29f963923527&v=4)](/nona-luypaert)
[nona-luypaert](/nona-luypaert)
added this to the  [7.6](/DSpace/DSpace/milestone/68) milestone
[Jun 7, 2023](#event-9456666129)

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
requested a review
from [abollini](/abollini)
[June 8, 2023 14:14](#event-9473110706)

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
added
the
[1 APPROVAL](/DSpace/DSpace/labels/1%20APPROVAL)
pull request only requires a single approval to merge.
label
[Jun 8, 2023](#event-9473113860)

 [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
self-requested a review
[June 8, 2023 14:15](#event-9473117560)

[![abollini](https://avatars.githubusercontent.com/u/1537527?s=60&v=4)](/abollini)

**[abollini](/abollini)**
requested changes
[Jun 8, 2023](#pullrequestreview-1470049474)

 [View reviewed changes](/DSpace/DSpace/pull/8891/files/c7375acf3914af1a334b512d4254f90692dbc5b0)

Copy link

Member

### @abollini **[abollini](/abollini)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

thanks for this contribution [@nona-luypaert](https://github.com/nona-luypaert) it looks to be very useful and I recommend to try at our best to have it in 7.6

I spot a NPE in an edge scenario that should be fixed (it would be also nice to have a specific test for that... but if you are short of time it is ok to skip for me)

Sorry, something went wrong.

All reactions

[dspace-server-webapp/src/main/java/org/dspace/app/rest/BitstreamRestController.java](/DSpace/DSpace/pull/8891/files/c7375acf3914af1a334b512d4254f90692dbc5b0#diff-d4c4749e07f739485d1e18cd9c670aa47cde58427f66778f50e87f595c7ad00d)

Show resolved

Hide resolved

 [nona-luypaert](/nona-luypaert)
added 2 commits
[June 8, 2023 20:47](#commits-pushed-a00dd83)

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert)

`[102124: Avoid null pointer when checking disposition](/DSpace/DSpace/pull/8891/commits/a00dd83a0c9a3272ff3004c40bfcf03691664296 "102124: Avoid null pointer when checking disposition")`

`[a00dd83](/DSpace/DSpace/pull/8891/commits/a00dd83a0c9a3272ff3004c40bfcf03691664296)`

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert)

`[Merge branch 'w2p-102124_bitstream-formats-download-attachment-7.2' i…](/DSpace/DSpace/pull/8891/commits/377e22eb65535bf23c9cc55b85111bdad3d0a9fb "Merge branch 'w2p-102124_bitstream-formats-download-attachment-7.2' into w2p-102124_bitstream-formats-download-attachment-main")`
 …

`[377e22e](/DSpace/DSpace/pull/8891/commits/377e22eb65535bf23c9cc55b85111bdad3d0a9fb)`

```
…nto w2p-102124_bitstream-formats-download-attachment-main
```

 [![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&u=cd81a1b05933f086d4c9cd9d699c29f963923527&v=4)](/nona-luypaert)
[nona-luypaert](/nona-luypaert)
requested a review
from [abollini](/abollini)
[June 8, 2023 19:37](#event-9476190638)

[![@alanorth](https://avatars.githubusercontent.com/u/191754?s=80&v=4)](/alanorth)

Copy link

Contributor

### **[alanorth](/alanorth)** commented [Jun 9, 2023](#issuecomment-1584989179)

| Currently has merge conflicts against `main`.  Regarding the proposed functionality, it looks like this might fix a related bug with content disposition. In previous DSpace releases, bitstreams would *always* be opened inline *unless they were larger than `webui.content_disposition_threshold`*. In 7.6-snapshot this is true right now for bitstreams like PDFs, but I've noticed that image bitstreams *always* download due to a null `Content-Disposition` header, for example a PDF thumbnail that I tried to open in a new tab in Firefox:  ``` content-disposition 	null;filename="=?UTF-8?Q?AfricaRISING=5FWA=5FTechnical_Report_USAID-IITA_(?= =?UTF-8?Q?October_2021_=E2=80=93_31_March_2022)=5FPJ-1503.pdf.jpg?="  ```  I will test once [@nona-luypaert](https://github.com/nona-luypaert) rebases the patch. |
| --- |

 👍
1
 nona-luypaert reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@alanorth](https://avatars.githubusercontent.com/u/191754?s=40&v=4)](/alanorth)
[alanorth](/alanorth)
added
the
[merge conflict](/DSpace/DSpace/labels/merge%20conflict)
PR has a merge conflict that needs resolution
label
[Jun 9, 2023](#event-9487223916)

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert)

`[Merge branch 'main' into w2p-102124_bitstream-formats-download-attach…](/DSpace/DSpace/pull/8891/commits/504bc1a61bda557d6fd4c49ad1fdf25325f22577 "Merge branch 'main' into w2p-102124_bitstream-formats-download-attachment-main")`
 …

`[504bc1a](/DSpace/DSpace/pull/8891/commits/504bc1a61bda557d6fd4c49ad1fdf25325f22577)`

```
…ment-main
```

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
removed
the
[merge conflict](/DSpace/DSpace/labels/merge%20conflict)
PR has a merge conflict that needs resolution
label
[Jun 9, 2023](#event-9487250578)

 [![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&u=cd81a1b05933f086d4c9cd9d699c29f963923527&v=4)](/nona-luypaert)
[nona-luypaert](/nona-luypaert)
requested a review
from [alanorth](/alanorth)
[June 9, 2023 18:45](#event-9487274379)

[![@alanorth](https://avatars.githubusercontent.com/u/191754?s=80&v=4)](/alanorth)

Copy link

Contributor

### **[alanorth](/alanorth)** commented [Jun 11, 2023](#issuecomment-1586298008)

| Reviewed by testing before and after adding `application/pdf` to the new `webui.content_disposition_format` setting:   * Before: PDF opens inline * After: PDF is downloaded   So this works as advertised. 👍  I would suggest adding a few more words to the comment for the new `webui.content_disposition_format` setting in dspace.cfg, perhaps:  ``` # Set which mimetypes, file extensions will NOT be opened inline. # Files with these mimetypes/extensions will always be downloaded # regardless of the threshold above. webui.content_disposition_format = text/richtext ```   ---   Also note, this \*does not\* fix the issue with images being forced to download when doing right click → open in new tab. That is unrelated to this PR, but I had hoped it might fix it as a bonus. I will open a new issue for that. |
| --- |

All reactions

Sorry, something went wrong.

[![alanorth](https://avatars.githubusercontent.com/u/191754?s=60&v=4)](/alanorth)

**[alanorth](/alanorth)**
reviewed
[Jun 11, 2023](#pullrequestreview-1473797668)

 [View reviewed changes](/DSpace/DSpace/pull/8891/files/504bc1a61bda557d6fd4c49ad1fdf25325f22577)

[dspace/config/dspace.cfg](/DSpace/DSpace/pull/8891/files/504bc1a61bda557d6fd4c49ad1fdf25325f22577#diff-39220e4ec26d2bc963fa3162bda3fbe3a9076354cb73efc5525c89f57033a1f6)
Outdated

Show resolved

Hide resolved

[![alanorth](https://avatars.githubusercontent.com/u/191754?s=60&v=4)](/alanorth)

**[alanorth](/alanorth)**
approved these changes
[Jun 11, 2023](#pullrequestreview-1473797766)

 [View reviewed changes](/DSpace/DSpace/pull/8891/files/504bc1a61bda557d6fd4c49ad1fdf25325f22577)

[![@alanorth](https://avatars.githubusercontent.com/u/191754?s=40&v=4)](/alanorth)
[alanorth](/alanorth)
mentioned this pull request
[Jun 11, 2023](#ref-issue-1751572041)

[Image bitstreams are downloaded as attachments intead of opening inline
#8900](/DSpace/DSpace/issues/8900)

Open

 [nona-luypaert](/nona-luypaert)
added 2 commits
[June 12, 2023 11:41](#commits-pushed-af8cf86)

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert)

`[102124: Update webui.content_disposition_format comment](/DSpace/DSpace/pull/8891/commits/af8cf8671bdf99bf6390aa29c1fb1da275b7327a "102124: Update webui.content_disposition_format comment")`

`[af8cf86](/DSpace/DSpace/pull/8891/commits/af8cf8671bdf99bf6390aa29c1fb1da275b7327a)`

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert)

`[Merge branch 'w2p-102124_bitstream-formats-download-attachment-7.2' i…](/DSpace/DSpace/pull/8891/commits/c0239cf1742c4ebff5e69aa1b574e7e450e2f4ce "Merge branch 'w2p-102124_bitstream-formats-download-attachment-7.2' into w2p-102124_bitstream-formats-download-attachment-main")`
 …

`[c0239cf](/DSpace/DSpace/pull/8891/commits/c0239cf1742c4ebff5e69aa1b574e7e450e2f4ce)`

```
…nto w2p-102124_bitstream-formats-download-attachment-main
```

[![tdonohue](https://avatars.githubusercontent.com/u/483997?s=60&v=4)](/tdonohue)

**[tdonohue](/tdonohue)**
reviewed
[Jun 14, 2023](#pullrequestreview-1480193122)

 [View reviewed changes](/DSpace/DSpace/pull/8891/files/c0239cf1742c4ebff5e69aa1b574e7e450e2f4ce)

Copy link

Member

### @tdonohue **[tdonohue](/tdonohue)** left a comment • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@nona-luypaert](https://github.com/nona-luypaert) : Overall this looks great & it works well. I tested a small PDF beforehand and saw it opened inline. But, when setting the new config to simply `webui.content_disposition_format = pdf` the same PDF downloaded. (As a bonus, I noticed that you don't even need to restart Tomcat after changing this config... the new settings reload immediately)

My only comments are on the test configuration. I think it's cleaner to move your test configs to the method that needs them. That way they are not used by every other test. See inline comments below for how to do that. Overall, I'm +1, but I'd appreciate it if the test configs could be moved.

Sorry, something went wrong.

All reactions

[dspace-api/src/test/data/dspaceFolder/config/local.cfg](/DSpace/DSpace/pull/8891/files/c0239cf1742c4ebff5e69aa1b574e7e450e2f4ce#diff-149be94f1c3a09a2cfb2d872e5a462e05cea52c352e3e9596732f4f24a333579)
Outdated

Show resolved

Hide resolved

[dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamRestControllerIT.java](/DSpace/DSpace/pull/8891/files/c0239cf1742c4ebff5e69aa1b574e7e450e2f4ce#diff-9a7da4550f9adaa181c6aafbbec5aad03ae6becd42f83e40496a69a777f2fad1)

Show resolved

Hide resolved

 [nona-luypaert](/nona-luypaert)
added 2 commits
[June 14, 2023 23:47](#commits-pushed-7c7f3e2)

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert)

`[102124: Move content-disposition test config from local.cfg to IT itself](/DSpace/DSpace/pull/8891/commits/7c7f3e2853bf6f27c09686684b83c0a798a45211 "102124: Move content-disposition test config from local.cfg to IT itself")`

`[7c7f3e2](/DSpace/DSpace/pull/8891/commits/7c7f3e2853bf6f27c09686684b83c0a798a45211)`

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert)

`[Merge branch 'w2p-102124_bitstream-formats-download-attachment-7.2' i…](/DSpace/DSpace/pull/8891/commits/dd951407a71f06e4cdccfc729da9a9b7333e4371 "Merge branch 'w2p-102124_bitstream-formats-download-attachment-7.2' into w2p-102124_bitstream-formats-download-attachment-main

 Conflicts:
	dspace-api/src/test/data/dspaceFolder/config/local.cfg")`
 …

`[dd95140](/DSpace/DSpace/pull/8891/commits/dd951407a71f06e4cdccfc729da9a9b7333e4371)`

```
…nto w2p-102124_bitstream-formats-download-attachment-main

 Conflicts:
	dspace-api/src/test/data/dspaceFolder/config/local.cfg
```

 [![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&u=cd81a1b05933f086d4c9cd9d699c29f963923527&v=4)](/nona-luypaert)
[nona-luypaert](/nona-luypaert)
requested a review
from [tdonohue](/tdonohue)
[June 15, 2023 07:30](#event-9536708059)

[![tdonohue](https://avatars.githubusercontent.com/u/483997?s=60&v=4)](/tdonohue)

**[tdonohue](/tdonohue)**
approved these changes
[Jun 15, 2023](#pullrequestreview-1482143853)

 [View reviewed changes](/DSpace/DSpace/pull/8891/files/dd951407a71f06e4cdccfc729da9a9b7333e4371)

Copy link

Member

### @tdonohue **[tdonohue](/tdonohue)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

👍 Thanks [@nona-luypaert](https://github.com/nona-luypaert) ! This looks good to me now & works well.

Sorry, something went wrong.

All reactions

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
merged commit [`f216f4c`](/DSpace/DSpace/commit/f216f4c7fc376a45bf9054d057bff454f45d1301)
into
DSpace:main

[Jun 15, 2023](https://github.com/DSpace/DSpace/pull/8891#event-9543479247)

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&u=f8023be771db9ad6334ef6787ef4e379119b5039&v=4)](/tdonohue)
[tdonohue](/tdonohue)
mentioned this pull request
[Jun 6, 2024](#ref-pullrequest-2338743911)

[Update configuration to always download HTML/JS/XML Bitstreams (no inline display)
#9638](/DSpace/DSpace/pull/9638)
 Merged

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fpull%2F8891)

Reviewers

[![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=40&v=4)](/tdonohue) [tdonohue](/tdonohue)

tdonohue approved these changes

[![@alanorth](https://avatars.githubusercontent.com/u/191754?s=40&v=4)](/alanorth) [alanorth](/alanorth)

alanorth approved these changes

[![@abollini](https://avatars.githubusercontent.com/u/1537527?s=40&v=4)](/abollini) [abollini](/abollini)

 Awaiting requested review from abollini

Assignees

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=40&v=4)](/nona-luypaert) [nona-luypaert](/nona-luypaert)

Labels

[1 APPROVAL](/DSpace/DSpace/labels/1%20APPROVAL)
pull request only requires a single approval to merge.
[configuration](/DSpace/DSpace/labels/configuration)
Related to out-of-the-box configuration
[improvement](/DSpace/DSpace/labels/improvement)
[interface: REST API v7+](/DSpace/DSpace/labels/interface%3A%20REST%20API%20v7%2B)
REST API for v7 and later (dspace-server-webapp module)

Projects

No open projects
1 closed project

[DSpace 7.6 Release](/orgs/DSpace/projects/23)
Status: ✅ Done

Milestone

 [**7.6**](/DSpace/DSpace/milestone/68 " 7.6")

Development

Successfully merging this pull request may close these issues.

4 participants

[![@nona-luypaert](https://avatars.githubusercontent.com/u/55390408?s=52&v=4)](/nona-luypaert) [![@alanorth](https://avatars.githubusercontent.com/u/191754?s=52&v=4)](/alanorth) [![@tdonohue](https://avatars.githubusercontent.com/u/483997?s=52&v=4)](/tdonohue) [![@abollini](https://avatars.githubusercontent.com/u/1537527?s=52&v=4)](/abollini)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_67819a2e_20250111_013736.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fsecurity%2Fadvisories%2FGHSA-94cc-xjxr-pwvf)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fsecurity%2Fadvisories%2FGHSA-94cc-xjxr-pwvf)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=DSpace%2FDSpace)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[DSpace](/DSpace)
/
**[DSpace](/DSpace/DSpace)**
Public

* [Notifications](/login?return_to=%2FDSpace%2FDSpace) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2FDSpace%2FDSpace)
* [Star
   919](/login?return_to=%2FDSpace%2FDSpace)

* [Code](/DSpace/DSpace)
* [Issues
  591](/DSpace/DSpace/issues)
* [Pull requests
  164](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects
  0](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

Additional navigation options

* [Code](/DSpace/DSpace)
* [Issues](/DSpace/DSpace/issues)
* [Pull requests](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

# Cross Site Scripting (XSS) possible via a deposited HTML/XML document with embedded JavaScript

Low

[tdonohue](/tdonohue)
published
GHSA-94cc-xjxr-pwvf
Jun 25, 2024

## Package

maven

dspace-server-webapp
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

7.0 <= 7.6.1

## Patched versions

8.0, 7.6.2

## Description

### Impact

In DSpace 7.0 through 7.6.1, when an HTML, XML or JavaScript Bitstream is downloaded, the user's browser *may* execute any embedded JavaScript. If that embedded JavaScript is malicious, there is a risk of an XSS attack.

This attack may only be initialized by a user who already has Submitter privileges in the repository. The submitter must upload the malicious HTML/XML/JavaScript file themselves. The attack itself would not occur until a visitor or logged-in user downloads the file or clicks on a download link shared by the attacker.

If your site is running the frontend and backend from separate domains, CORS and CSRF protection built into DSpace help to limit the impact of the attack.

If the repository is configured to only download HTML / XML / JavaScript Bitstreams using the [`Content-Disposition: attachment`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition) header, then the attack is no longer possible. See "Workarounds" below.

### Patches

The fix is included in both 8.0 and 7.6.2. Please upgrade to one of these versions, or manually apply one of the "Workarounds" below.

If you are already running 7.6 or 7.6.1, then this vulnerability can be fixed via a configuration update in your `dspace.cfg` configuration file. See details in below.

### Workarounds

**DSpace sites running 7.6 or 7.6.1** can fix this issue by adding the following `webui.content_disposition_format` settings to their `dspace.cfg` (or `local.cfg`). These settings force all HTML, XML, RDF & JavaScript files to always be downloaded to a user's machine, blocking the attack. For more details see [PR #9638](https://github.com/DSpace/DSpace/pull/9638)

```
webui.content_disposition_format = text/html
webui.content_disposition_format = text/javascript
webui.content_disposition_format = text/xml
webui.content_disposition_format = rdf

```

These settings will take effect immediately. There is no need to restart Tomcat.

To verify the settings are working: upload an HTML or XML file to an in-progress submission. Attempt to download the file. The file should *not* open in your browser window. Instead, it should download to your local computer.

**DSpace sites running 7.0 through 7.5** will need to **either** (CHOOSE ONE):

* Upgrade to 7.6.2 or 8.0
* Or, upgrade to 7.6 or 7.6.1 and then apply the configuration change mentioned above
* Or, manually add the `webui.content_disposition_format` setting (which was first released in 7.6), and then apply the configuration changes mentioned above.
  + The `webui.content_disposition_format` setting can be added by applying the changes in [PR #8891](https://github.com/DSpace/DSpace/pull/8891). A [`patch` file](https://github.com/DSpace/DSpace/pull/8891.patch) is also available.
  + Please be aware this patch may not apply cleanly to all prior versions of 7.x. In that scenario, you would need to find a way to manually apply the changes or consider a different workaround.
* Or, find a way in your Apache or NGinx proxy to force the `Content-Disposition: attachment` header to be sent for **all files** downloaded via `/server/api/core/bitstreams/[uuid]/content` in the REST API.
  + NOTE: This workaround will patch the vulnerability. However, it does so by no longer allowing users to open *any* downloaded files in their browser window. (This behavior may or may not be desirable in the long term, so you may wish to remove it in the future, once you have upgraded.)
  + For example, in Apache, using "mod\_headers", you may add a configuration similar to this in your `<VirtualHost>`:
    ```
    # Set "Content-Disposition: attachment" whenever path is /server/api/core/bitstreams/[uuid]/content
    Header set Content-Disposition attachment "expr=%{REQUEST_URI} =~ m#^/server/api/core/bitstreams/.*/content$#"

    ```

### References

Discovered and reported by Muhammad Zeeshan ([Xib3rR4dAr](https://github.com/Xib3rR4dAr))

### For more information

If you have any questions or comments about this advisory:

* Email us at security@dspace.org

### Severity

Low

### CVE ID

CVE-2024-38364

### Weaknesses

[CWE-79](/advisories?query=cwe%3A79)

### Credits

* [![@Xib3rR4dAr](https://avatars.githubusercontent.com/u/24238512?s=40&v=4)](/Xib3rR4dAr)
  [Xib3rR4dAr](/Xib3rR4dAr)
  Finder

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e94b59b9_20250111_013733.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fcommit%2Ff1059b4340857cca3dc4c45b1ebbadce6bb61c0b)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fcommit%2Ff1059b4340857cca3dc4c45b1ebbadce6bb61c0b)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=DSpace%2FDSpace)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[DSpace](/DSpace)
/
**[DSpace](/DSpace/DSpace)**
Public

* [Notifications](/login?return_to=%2FDSpace%2FDSpace) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2FDSpace%2FDSpace)
* [Star
   919](/login?return_to=%2FDSpace%2FDSpace)

* [Code](/DSpace/DSpace)
* [Issues
  591](/DSpace/DSpace/issues)
* [Pull requests
  164](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects
  0](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

Additional navigation options

* [Code](/DSpace/DSpace)
* [Issues](/DSpace/DSpace/issues)
* [Pull requests](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

## Commit

[Permalink](/DSpace/DSpace/commit/f1059b4340857cca3dc4c45b1ebbadce6bb61c0b)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#9638](https://github.com/DSpace/DSpace/pull/9638) from tdonohue/avoid\_inline\_js

[Browse files](/DSpace/DSpace/tree/f1059b4340857cca3dc4c45b1ebbadce6bb61c0b)
Browse the repository at this point in the history

```
Update configuration to always download HTML/JS/XML Bitstreams (no inline display)
```

* Loading branch information

[![@kshepherd](https://avatars.githubusercontent.com/u/194773?s=40&v=4)](/kshepherd)

[kshepherd](/DSpace/DSpace/commits?author=kshepherd "View all commits by kshepherd")
authored
Jun 17, 2024

2 parents
[2af0509](/DSpace/DSpace/commit/2af0509a4c739e2a4b64753744f58c81d610fb14)
+
[a091d34](/DSpace/DSpace/commit/a091d343b9c1e491ca0fc005fd18bc1c75f8e830)

commit f1059b4

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**142 additions**
and
**17 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* dspace-server-webapp/src

  + main/java/org/dspace/app/rest

    - dspace-server-webapp/src/main/java/org/dspace/app/rest/BitstreamRestController.java
      [BitstreamRestController.java](#diff-d4c4749e07f739485d1e18cd9c670aa47cde58427f66778f50e87f595c7ad00d)
  + test/java/org/dspace/app/rest

    - dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamFormatRestRepositoryIT.java
      [BitstreamFormatRestRepositoryIT.java](#diff-bbd351a7e7de0e5a0899f02139a2833f6260a61a6efae497f099a903e0376a60)
    - dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamRestControllerIT.java
      [BitstreamRestControllerIT.java](#diff-9a7da4550f9adaa181c6aafbbec5aad03ae6becd42f83e40496a69a777f2fad1)
* dspace/config

  + dspace/config/dspace.cfg
    [dspace.cfg](#diff-39220e4ec26d2bc963fa3162bda3fbe3a9076354cb73efc5525c89f57033a1f6)
  + registries

    - dspace/config/registries/bitstream-formats.xml
      [bitstream-formats.xml](#diff-e5533b36207b7f811ee50b4efed67becf929f570af40ef3b2674445c6e260781)

## There are no files selected for viewing

36 changes: 32 additions & 4 deletions

36
[dspace-server-webapp/src/main/java/org/dspace/app/rest/BitstreamRestController.java](#diff-d4c4749e07f739485d1e18cd9c670aa47cde58427f66778f50e87f595c7ad00d "dspace-server-webapp/src/main/java/org/dspace/app/rest/BitstreamRestController.java")

Show comments

[View file](/DSpace/DSpace/blob/f1059b4340857cca3dc4c45b1ebbadce6bb61c0b/dspace-server-webapp/src/main/java/org/dspace/app/rest/BitstreamRestController.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,6 +20,7 @@ |
|  |  | import jakarta.servlet.http.HttpServletResponse; |
|  |  | import jakarta.ws.rs.core.Response; |
|  |  | import org.apache.catalina.connector.ClientAbortException; |
|  |  | import org.apache.commons.collections4.ListUtils; |
|  |  | import org.apache.commons.lang3.StringUtils; |
|  |  | import org.apache.logging.log4j.Logger; |
|  |  | import org.dspace.app.rest.converter.ConverterService; |
| Expand Down  Expand Up | | @@ -204,12 +205,39 @@ private boolean isNotAnErrorResponse(HttpServletResponse response) { |
|  |  | || responseCode.equals(Response.Status.Family.REDIRECTION); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if a Bitstream of the specified format should always be downloaded (i.e. "content-disposition: attachment") |
|  |  | \* or can be opened inline (i.e. "content-disposition: inline"). |
|  |  | \* <P> |
|  |  | \* NOTE that downloading via "attachment" is more secure, as the user's browser will not attempt to process or |
|  |  | \* display the file. But, downloading via "inline" may be seen as more user-friendly for common formats. |
|  |  | \* @param format BitstreamFormat |
|  |  | \* @return true if always download ("attachment"). false if can be opened inline ("inline") |
|  |  | \*/ |
|  |  | private boolean checkFormatForContentDisposition(BitstreamFormat format) { |
|  |  | // never automatically download undefined formats |
|  |  | if (format == null) { |
|  |  | return false; |
|  |  | // Undefined or Unknown formats should ALWAYS be downloaded for additional security. |
|  |  | if (format == null || format.getSupportLevel() == BitstreamFormat.UNKNOWN) { |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | // Load additional formats configured to require download |
|  |  | List<String> configuredFormats = List.of(configurationService. |
|  |  | getArrayProperty("webui.content\_disposition\_format")); |
|  |  |  |
|  |  | // If configuration includes "\*", then all formats will always be downloaded. |
|  |  | if (configuredFormats.contains("\*")) { |
|  |  | return true; |
|  |  | } |
|  |  | List<String> formats = List.of((configurationService.getArrayProperty("webui.content\_disposition\_format"))); |
|  |  |  |
|  |  | // Define a download list of formats which DSpace forces to ALWAYS be downloaded. |
|  |  | // These formats can embed JavaScript which may be run in the user's browser if the file is opened inline. |
|  |  | // Therefore, DSpace blocks opening these formats inline as it could be used for an XSS attack. |
|  |  | List<String> downloadOnlyFormats = List.of("text/html", "text/javascript", "text/xml", "rdf"); |
|  |  |  |
|  |  | // Combine our two lists |
|  |  | List<String> formats = ListUtils.union(downloadOnlyFormats, configuredFormats); |
|  |  |  |
|  |  | // See if the passed in format's MIME type or file extension is listed. |
|  |  | boolean download = formats.contains(format.getMIMEType()); |
|  |  | if (!download) { |
|  |  | for (String ext : format.getExtensions()) { |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamFormatRestRepositoryIT.java](#diff-bbd351a7e7de0e5a0899f02139a2833f6260a61a6efae497f099a903e0376a60 "dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamFormatRestRepositoryIT.java")

Show comments

[View file](/DSpace/DSpace/blob/f1059b4340857cca3dc4c45b1ebbadce6bb61c0b/dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamFormatRestRepositoryIT.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -56,7 +56,7 @@ public class BitstreamFormatRestRepositoryIT extends AbstractControllerIntegrati |
|  |  | @Autowired |
|  |  | private BitstreamFormatConverter bitstreamFormatConverter; |
|  |  |  |
|  |  | private final int DEFAULT\_AMOUNT\_FORMATS = 85; |
|  |  | private final int DEFAULT\_AMOUNT\_FORMATS = 86; |
|  |  |  |
|  |  | @Test |
|  |  | public void findAllPaginationTest() throws Exception { |
| Expand Down | |  |

101 changes: 92 additions & 9 deletions

101
[dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamRestControllerIT.java](#diff-9a7da4550f9adaa181c6aafbbec5aad03ae6becd42f83e40496a69a777f2fad1 "dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamRestControllerIT.java")

Show comments

[View file](/DSpace/DSpace/blob/f1059b4340857cca3dc4c45b1ebbadce6bb61c0b/dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamRestControllerIT.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1248,7 +1248,6 @@ public void closeInputStreamsDownloadWithCoverPage() throws Exception { |
|  |  | Mockito.verify(inputStreamSpy, times(1)).close(); |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | @Test |
|  |  | public void checkContentDispositionOfFormats() throws Exception { |
|  |  | configurationService.setProperty("webui.content\_disposition\_format", new String[] { |
| Expand All | | @@ -1265,16 +1264,16 @@ public void checkContentDispositionOfFormats() throws Exception { |
|  |  | Bitstream rtf; |
|  |  | Bitstream xml; |
|  |  | Bitstream txt; |
|  |  | Bitstream html; |
|  |  | Bitstream csv; |
|  |  | try (InputStream is = IOUtils.toInputStream(content, CharEncoding.UTF\_8)) { |
|  |  | rtf = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("text/richtext").build(); |
|  |  | xml = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("text/xml").build(); |
|  |  | txt = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("text/plain").build(); |
|  |  | html = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("text/html").build(); |
|  |  | csv = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("text/csv").build(); |
|  |  | } |
|  |  | context.restoreAuthSystemState(); |
|  |  |  |
| Expand All | | @@ -1283,9 +1282,89 @@ public void checkContentDispositionOfFormats() throws Exception { |
|  |  | verifyBitstreamDownload(xml, "text/xml;charset=UTF-8", true); |
|  |  | verifyBitstreamDownload(txt, "text/plain;charset=UTF-8", true); |
|  |  | // this format is not configured and should open inline |
|  |  | verifyBitstreamDownload(html, "text/html;charset=UTF-8", false); |
|  |  | verifyBitstreamDownload(csv, "text/csv;charset=UTF-8", false); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | public void checkHardcodedContentDispositionFormats() throws Exception { |
|  |  | // This test is similar to the above test, but it verifies that our \*hardcoded settings\* for |
|  |  | // webui.content\_disposition\_format are protecting us from loading specific formats \*inline\*. |
|  |  | context.turnOffAuthorisationSystem(); |
|  |  | Community community = CommunityBuilder.createCommunity(context).build(); |
|  |  | Collection collection = CollectionBuilder.createCollection(context, community).build(); |
|  |  | Item item = ItemBuilder.createItem(context, collection).build(); |
|  |  | String content = "Test Content"; |
|  |  | Bitstream html; |
|  |  | Bitstream js; |
|  |  | Bitstream rdf; |
|  |  | Bitstream xml; |
|  |  | Bitstream unknown; |
|  |  | Bitstream svg; |
|  |  | try (InputStream is = IOUtils.toInputStream(content, CharEncoding.UTF\_8)) { |
|  |  | html = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("text/html").build(); |
|  |  | js = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("text/javascript").build(); |
|  |  | // NOTE: RDF has a MIME Type with a "charset" in our bitstream-formats.xml |
|  |  | rdf = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("application/rdf+xml; charset=utf-8").build(); |
|  |  | xml = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("text/xml").build(); |
|  |  | unknown = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("application/octet-stream").build(); |
|  |  | svg = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("image/svg+xml").build(); |
|  |  |  |
|  |  | } |
|  |  | context.restoreAuthSystemState(); |
|  |  |  |
|  |  | // By default, HTML, JS & XML should all download. This protects us from possible XSS attacks, as |
|  |  | // each of these formats can embed JavaScript which may execute when the file is loaded \*inline\*. |
|  |  | verifyBitstreamDownload(html, "text/html;charset=UTF-8", true); |
|  |  | verifyBitstreamDownload(js, "text/javascript;charset=UTF-8", true); |
|  |  | verifyBitstreamDownload(rdf, "application/rdf+xml;charset=UTF-8", true); |
|  |  | verifyBitstreamDownload(xml, "text/xml;charset=UTF-8", true); |
|  |  | // Unknown file formats should also always download |
|  |  | verifyBitstreamDownload(unknown, "application/octet-stream;charset=UTF-8", true); |
|  |  | // SVG does NOT currently exist as a recognized format in DSpace's bitstream-formats.xml, but it's another |
|  |  | // format that allows embedded JavaScript. This test is a reminder that SVGs should NOT be opened inline. |
|  |  | verifyBitstreamDownload(svg, "application/octet-stream;charset=UTF-8", true); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | public void checkWildcardContentDispositionFormats() throws Exception { |
|  |  | // Setting "\*" should result in all formats being downloaded (nothing will be opened inline) |
|  |  | configurationService.setProperty("webui.content\_disposition\_format", "\*"); |
|  |  |  |
|  |  | context.turnOffAuthorisationSystem(); |
|  |  | Community community = CommunityBuilder.createCommunity(context).build(); |
|  |  | Collection collection = CollectionBuilder.createCollection(context, community).build(); |
|  |  | Item item = ItemBuilder.createItem(context, collection).build(); |
|  |  | String content = "Test Content"; |
|  |  | Bitstream csv; |
|  |  | Bitstream jpg; |
|  |  | Bitstream mpg; |
|  |  | Bitstream pdf; |
|  |  | try (InputStream is = IOUtils.toInputStream(content, CharEncoding.UTF\_8)) { |
|  |  | csv = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("text/csv").build(); |
|  |  | jpg = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("image/jpeg").build(); |
|  |  | mpg = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("video/mpeg").build(); |
|  |  | pdf = BitstreamBuilder.createBitstream(context, item, is) |
|  |  | .withMimeType("application/pdf").build(); |
|  |  | } |
|  |  | context.restoreAuthSystemState(); |
|  |  |  |
|  |  | // All formats should be download only |
|  |  | verifyBitstreamDownload(csv, "text/csv;charset=UTF-8", true); |
|  |  | verifyBitstreamDownload(jpg, "image/jpeg;charset=UTF-8", true); |
|  |  | verifyBitstreamDownload(mpg, "video/mpeg;charset=UTF-8", true); |
|  |  | verifyBitstreamDownload(pdf, "application/pdf;charset=UTF-8", true); |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | private void verifyBitstreamDownload(Bitstream file, String contentType, boolean shouldDownload) throws Exception { |
|  |  | String token = getAuthToken(admin.getEmail(), password); |
|  |  | String header = getClient(token).perform(get("/api/core/bitstreams/" + file.getID() + "/content") |
| Expand All | | @@ -1294,11 +1373,15 @@ private void verifyBitstreamDownload(Bitstream file, String contentType, boolean |
|  |  | .andExpect(content().contentType(contentType)) |
|  |  | .andReturn().getResponse().getHeader("content-disposition"); |
|  |  | if (shouldDownload) { |
|  |  | assertTrue(header.contains("attachment")); |
|  |  | assertFalse(header.contains("inline")); |
|  |  | assertTrue("Content-Disposition should contain 'attachment' for " + contentType, |
|  |  | header.contains("attachment")); |
|  |  | assertFalse("Content-Disposition should NOT contain 'inline' for " + contentType, |
|  |  | header.contains("inline")); |
|  |  | } else { |
|  |  | assertTrue(header.contains("inline")); |
|  |  | assertFalse(header.contains("attachment")); |
|  |  | assertTrue("Content-Disposition should contain 'inline' for " + contentType, |
|  |  | header.contains("inline")); |
|  |  | assertFalse("Content-Disposition should NOT contain 'attachment' for " + contentType, |
|  |  | header.contains("attachment")); |
|  |  | } |
|  |  | } |
|  |  | } |

11 changes: 8 additions & 3 deletions

11
[dspace/config/dspace.cfg](#diff-39220e4ec26d2bc963fa3162bda3fbe3a9076354cb73efc5525c89f57033a1f6 "dspace/config/dspace.cfg")

Show comments

[View file](/DSpace/DSpace/blob/f1059b4340857cca3dc4c45b1ebbadce6bb61c0b/dspace/config/dspace.cfg)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1384,9 +1384,14 @@ webui.content\_disposition\_threshold = 8388608 |
|  |  |  |
|  |  | #### Content Attachment Disposition Formats #### |
|  |  | # |
|  |  | # Set which mimetypes, file extensions will NOT be opened inline |
|  |  | # Files with these mimetypes/extensions will always be downloaded, |
|  |  | # regardless of the threshold above |
|  |  | # Set which mimetypes or file extensions will NOT be opened inline. |
|  |  | # Files with these mimetypes/extensions will always be downloaded, regardless of the threshold above. |
|  |  | # NOTE: For security reasons, some file formats (e.g. HTML, XML, RDF, JS) will always be downloaded regardless |
|  |  | # of the settings here. This blocks these formats from executing embedded JavaScript when opened inline. |
|  |  | # For additional security, you may choose to set this to "\*" to force all formats to always be downloaded |
|  |  | # (i.e. disables all formats from opening inline within the user's browser). |
|  |  | # |
|  |  | # By default, RTF is always downloaded because most browsers attempt to display it as plain text. |
|  |  | webui.content\_disposition\_format = text/richtext |
|  |  |  |
|  |  | #### Multi-file HTML document/site settings ##### |
| Expand Down | |  |

9 changes: 9 additions & 0 deletions

9
[dspace/config/registries/bitstream-formats.xml](#diff-e5533b36207b7f811ee50b4efed67becf929f570af40ef3b2674445c6e260781 "dspace/config/registries/bitstream-formats.xml")

Show comments

[View file](/DSpace/DSpace/blob/f1059b4340857cca3dc4c45b1ebbadce6bb61c0b/dspace/config/registries/bitstream-formats.xml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -827,4 +827,13 @@ |
|  |  | <extension>avif</extension> |
|  |  | </bitstream-type> |
|  |  |  |
|  |  | <bitstream-type> |
|  |  | <mimetype>text/javascript</mimetype> |
|  |  | <short\_description>JavaScript</short\_description> |
|  |  | <description>JavaScript</description> |
|  |  | <support\_level>1</support\_level> |
|  |  | <internal>false</internal> |
|  |  | <extension>js</extension> |
|  |  | </bitstream-type> |
|  |  |  |
|  |  | </dspace-bitstream-types> |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f1059b4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fcommit%2Ff1059b4340857cca3dc4c45b1ebbadce6bb61c0b) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


