From c60cfd8727da77b9db10297148eadd697ebec353 Mon Sep 17 00:00:00 2001
From: Dan Garner <dan@xibosignage.com>
Date: Thu, 11 Jul 2024 20:25:30 +0100
Subject: [PATCH] Proof of Play: validate sortBy parameter has an expected
 value.  relates to xibosignageltd/xibo#798

---
 lib/Report/ProofOfPlay.php | 18 ++++++++++++++++--
 1 file changed, 16 insertions(+), 2 deletions(-)

diff --git a/lib/Report/ProofOfPlay.php b/lib/Report/ProofOfPlay.php
index 01a3eec4fd..b46c8ea4c0 100644
--- a/lib/Report/ProofOfPlay.php
+++ b/lib/Report/ProofOfPlay.php
@@ -398,8 +398,22 @@ public function getResults($filterCriteria)
             $start = 0;
             $length = -1;
             $sortBy = $this->getSanitizer()->getString('sortBy', $filterCriteria);
-
-            $columns = ($sortBy == '') ? ['widgetId'] : [$sortBy];
+            if (empty($sortBy)) {
+                $sortBy = 'widgetId';
+            }
+            if (!in_array($sortBy, [
+                'widgetId',
+                'type',
+                'display',
+                'displayId',
+                'media',
+                'layout',
+                'layoutId',
+                'tag',
+            ])) {
+                throw new InvalidArgumentException(__('Invalid Sort By'), 'sortBy');
+            }
+            $columns = [$sortBy];
         }
 
         //
