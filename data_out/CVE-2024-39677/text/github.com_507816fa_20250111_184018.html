
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnhibernate%2Fnhibernate-core%2Fissues%2F3516)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnhibernate%2Fnhibernate-core%2Fissues%2F3516)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fissues%2Fshow&source=header-repo&source_repo=nhibernate%2Fnhibernate-core)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nhibernate](/nhibernate)
/
**[nhibernate-core](/nhibernate/nhibernate-core)**
Public

* [Notifications](/login?return_to=%2Fnhibernate%2Fnhibernate-core) You must be signed in to change notification settings
* [Fork
  932](/login?return_to=%2Fnhibernate%2Fnhibernate-core)
* [Star
   2.1k](/login?return_to=%2Fnhibernate%2Fnhibernate-core)

* [Code](/nhibernate/nhibernate-core)
* [Issues
  614](/nhibernate/nhibernate-core/issues)
* [Pull requests
  66](/nhibernate/nhibernate-core/pulls)
* [Discussions](/nhibernate/nhibernate-core/discussions)
* [Actions](/nhibernate/nhibernate-core/actions)
* [Security](/nhibernate/nhibernate-core/security)
* [Insights](/nhibernate/nhibernate-core/pulse)

Additional navigation options

* [Code](/nhibernate/nhibernate-core)
* [Issues](/nhibernate/nhibernate-core/issues)
* [Pull requests](/nhibernate/nhibernate-core/pulls)
* [Discussions](/nhibernate/nhibernate-core/discussions)
* [Actions](/nhibernate/nhibernate-core/actions)
* [Security](/nhibernate/nhibernate-core/security)
* [Insights](/nhibernate/nhibernate-core/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fnhibernate%2Fnhibernate-core%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fnhibernate%2Fnhibernate-core%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# ObjectToSQLString implementations are problematic #3516

Open

[gliljas](/gliljas) opened this issue
Apr 2, 2024
· 10 comments

Open

# [ObjectToSQLString implementations are problematic](#top) #3516

[gliljas](/gliljas) opened this issue
Apr 2, 2024
· 10 comments

## Comments

[![@gliljas](https://avatars.githubusercontent.com/u/290294?s=80&u=38404a90b98b2a0106a91d46b99446865d7a1dd3&v=4)](/gliljas)

Copy link

Member

### **[gliljas](/gliljas)** commented [Apr 2, 2024](#issue-2220019103)

| While working with DateOnly and TimeOnly support I realized that the ObjectToSQLString method of ILiteralType is quite problematic.  **AbstractStringType**: `"'" + (string)value + "'"`   * SQL injection * No N-prefix for unicode (required in SQL server when the string is outside ANSI)   **AbstractCharType**: `'\'' + value.ToString() + '\''`   * SQL injection * No N-prefix for unicode (required in SQL server when the string is outside ANSI)   **AbstractDateTimeType**: `"'" + (DateTime) value + "'"`   * No guarantee that the stringified DateTime will be a supported datetime syntax   **DateTimeOffsetType**: `"'" + ((DateTimeOffset) value) + "'"`   * No guarantee that the stringified DateTimeOffset will be a supported datetimeoffset syntax   **DateType**: `"\'" + ((DateTime)value).ToShortDateString() + "\'"`   * No guarantee that the stringified DateTime will be a supported datetime syntax   **DecimalType**: `value.ToString()`   * Could very well be a decimal with the wrong kind of decimal separator   And there are more.  Since the method has access to the dialect, maybe more formatting should be moved there. |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@fredericDelaporte](https://avatars.githubusercontent.com/u/12201973?s=80&u=ffbfa114ecbea03cc10f8fa2810f8e2598604674&v=4)](/fredericDelaporte)

Copy link

Member

### **[fredericDelaporte](/fredericDelaporte)** commented [Apr 2, 2024](#issuecomment-2031710807) • edited Loading

| From my viewpoint, this method should be obsoleted and no more used. Building string fragments of literal values is a bad practice. Parameters should be used instead.  I can find three usages:   * To handle discriminators. I have neither investigated why does it not use parameters, nor how much work would it involve. * A seemingly unused `AddColumn` overload on `SqlInsertBuilder` and `SqlUpdateBuilder`: why not obsoleting these methods? |
| --- |

All reactions

Sorry, something went wrong.

[![@gliljas](https://avatars.githubusercontent.com/u/290294?s=80&u=38404a90b98b2a0106a91d46b99446865d7a1dd3&v=4)](/gliljas)

Copy link

Member

Author

### **[gliljas](/gliljas)** commented [Apr 2, 2024](#issuecomment-2031801260)

| Using literal values in SQL does have some value. E.g. filtered indexes rely on the filtered columns **not** being supplied as parameters. And filtered indexes are really useful, e.g in scenarios where discriminators are being used. It makes it easy to create indexes tailor made for the sub classes in a class hierarchy. We use that functionality, and I'm certain others do as well.  We could probably "re-enable" such things with query rewriting if the literals were removed, but it's something to take into account. Making them into parameters is likely to cause performance degradation for some users. |
| --- |

All reactions

Sorry, something went wrong.

[![@fredericDelaporte](https://avatars.githubusercontent.com/u/12201973?s=40&u=ffbfa114ecbea03cc10f8fa2810f8e2598604674&v=4)](/fredericDelaporte)
[fredericDelaporte](/fredericDelaporte)
mentioned this issue
[Apr 2, 2024](#ref-pullrequest-2220296904)

[Obsolete vulnerable literal AddColumn
#3517](/nhibernate/nhibernate-core/pull/3517)
 Merged

[![@fredericDelaporte](https://avatars.githubusercontent.com/u/12201973?s=80&u=ffbfa114ecbea03cc10f8fa2810f8e2598604674&v=4)](/fredericDelaporte)

Copy link

Member

### **[fredericDelaporte](/fredericDelaporte)** commented [Apr 3, 2024](#issuecomment-2034376439) • edited Loading

| At least with discriminators, the injection risk is very slim, their values being not dynamic but hard-coded in the mappings. Since NHibernate does not actually use those `ObjectToSQLString` for anything else (`AddColumn` being not used), the security vulnerabilities of their implementation is currently not practical to exploit.  Still, we should not let there security vulnerabilities there. If we cannot simply obsolete these methods and cease using them, they would have to be fixed. But I am not sure the dialects currently allow for robust literal SQL fragment generation. It may even be bound to the server or connection locales, like mdy vs dmy troubles on strings representing dates with SQL Server. (Which can be dodged by using an ISO format, but will we have this kind of solution with every vendor?) |
| --- |

All reactions

Sorry, something went wrong.

[![@hazzik](https://avatars.githubusercontent.com/u/144791?s=80&u=07544198e555f35f0c036ae399aba65fbf714c99&v=4)](/hazzik)

Copy link

Member

### **[hazzik](/hazzik)** commented [Apr 4, 2024](#issuecomment-2037054865)

| Would someone want to write this up? <https://github.com/nhibernate/nhibernate-core/security/advisories/new> |
| --- |

 👀
1
 fredericDelaporte reacted with eyes emoji

All reactions

* 👀
  1 reaction

Sorry, something went wrong.

[![@fredericDelaporte](https://avatars.githubusercontent.com/u/12201973?s=80&u=ffbfa114ecbea03cc10f8fa2810f8e2598604674&v=4)](/fredericDelaporte)

Copy link

Member

### **[fredericDelaporte](/fredericDelaporte)** commented [Apr 14, 2024](#issuecomment-2054105265)

| I now see it is used in HQL too, for `JavaConstantNode`, `BooleanLiteralNode` and `BinaryLogicOperatorNode`. As I understand it, the `JavaConstantNode` may be used in case of a reference to a static field of a class in the HQL. `BooleanLiteralNode` should not have issues. And `BinaryLogicOperatorNode` uses it in case it has to resolve a discriminator, so, we are back to the discriminator case for this one. |
| --- |

All reactions

Sorry, something went wrong.

[![@fredericDelaporte](https://avatars.githubusercontent.com/u/12201973?s=80&u=ffbfa114ecbea03cc10f8fa2810f8e2598604674&v=4)](/fredericDelaporte)

Copy link

Member

### **[fredericDelaporte](/fredericDelaporte)** commented [Apr 14, 2024](#issuecomment-2054116438) • edited Loading

| It is hard to evaluate the impact of the flaw, since the vulnerable methods take an object as a value and do not, in most case, check it is of the expected type. So, with `DecimalType` (and most number types), if the value happen to be a string like `; drop database nhibernate;`, it will be yielded identically by the method current implementation.  The question is then, is it possible to get `DecimalType.ObjectToSQLString` called with such a value? Definitely yes with `SqlInsertBuilder` and `SqlUpdateBuilder`, since they expect both the value and the type as arguments. But that would most likely be a programming error. With `JavaConstantNode`, on principle yes too, since the class is public and can be constructed with a "wicked token". Otherwise that depends on `TypeFactory.HeuristicType(value.GetType().Name);` yielding the adequate type. With the discriminator case, that would be a very explicit programming error.  On Hibernate side, these `ObjectToSQLString` methods do not look to exist. I find instead [`JdbcLiteralFormatter<T> getJdbcLiteralFormatter`](https://github.com/hibernate/hibernate-orm/blob/6695617210b6a1abdd8930871db1b76f938d5f4c/hibernate-core/src/main/java/org/hibernate/type/AbstractStandardBasicType.java#L91C9-L91C56). |
| --- |

All reactions

Sorry, something went wrong.

[![@deAtog](https://avatars.githubusercontent.com/u/739582?s=80&u=fdc5382f4b8edd0396a533a96522e26c8b90b7a6&v=4)](/deAtog)

Copy link

Contributor

### **[deAtog](/deAtog)** commented [Apr 30, 2024](#issuecomment-2085672161)

| [SQLiteDialect: FormatException due to string conversion of DateTime fields](https://github.com/nhibernate/nhibernate-core/issues/3530) seems to be related to this issue which demonstrates what happens when you carelessly convert to/from a string without using the appropriate locale for the conversion. |
| --- |

All reactions

Sorry, something went wrong.

[![@fredericDelaporte](https://avatars.githubusercontent.com/u/12201973?s=80&u=ffbfa114ecbea03cc10f8fa2810f8e2598604674&v=4)](/fredericDelaporte)

Copy link

Member

### **[fredericDelaporte](/fredericDelaporte)** commented [May 5, 2024](#issuecomment-2094873800)

| No it is not related to `ObjectToSQLString`. SQLite lax typing causes issues of its own, without involving that method. [#3530](https://github.com/nhibernate/nhibernate-core/issues/3530) does not involve it. |
| --- |

All reactions

Sorry, something went wrong.

[![@fredericDelaporte](https://avatars.githubusercontent.com/u/12201973?s=80&u=ffbfa114ecbea03cc10f8fa2810f8e2598604674&v=4)](/fredericDelaporte)

Copy link

Member

### **[fredericDelaporte](/fredericDelaporte)** commented [May 5, 2024](#issuecomment-2094874770)

| The advisory was drafted a few weeks ago but I have not seen reactions to it. <https://github.com/nhibernate/nhibernate-core/security/advisories> I am not used to the security framework for estimating the severity. I have used the classification to estimate it but many things were not making much sense for the case. |
| --- |

 👍
1
 hazzik reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@fredericDelaporte](https://avatars.githubusercontent.com/u/12201973?s=40&u=ffbfa114ecbea03cc10f8fa2810f8e2598604674&v=4)](/fredericDelaporte)
[fredericDelaporte](/fredericDelaporte)
mentioned this issue
[May 12, 2024](#ref-pullrequest-2291431648)

[Handle SQL injection vulnerabilities within ObjectToSQLString
#3547](/nhibernate/nhibernate-core/pull/3547)
 Merged

[![@fredericDelaporte](https://avatars.githubusercontent.com/u/12201973?s=40&u=ffbfa114ecbea03cc10f8fa2810f8e2598604674&v=4)](/fredericDelaporte)
[fredericDelaporte](/fredericDelaporte)
mentioned this issue
[Jun 9, 2024](#ref-issue-2342364151)

[Invalid ObjectToSQLString in EnumStringType
#3563](/nhibernate/nhibernate-core/issues/3563)

Open

[![@fredericDelaporte](https://avatars.githubusercontent.com/u/12201973?s=80&u=ffbfa114ecbea03cc10f8fa2810f8e2598604674&v=4)](/fredericDelaporte)

Copy link

Member

### **[fredericDelaporte](/fredericDelaporte)** commented [Jul 6, 2024](#issuecomment-2211705918)

| The security concerns raised here have now been addressed. Bugs remain. |
| --- |

All reactions

Sorry, something went wrong.

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Jan 2, 2025](#ref-pullrequest-2766511510)

[[ODS-6481] 7.2 Patch Release for Nhibernate Upgrade
Ed-Fi-Alliance-OSS/Ed-Fi-ODS-Implementation#1199](/Ed-Fi-Alliance-OSS/Ed-Fi-ODS-Implementation/pull/1199)
 Merged

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fnhibernate%2Fnhibernate-core%2Fissues%2F3516)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

4 participants

[![@hazzik](https://avatars.githubusercontent.com/u/144791?s=52&v=4)](/hazzik) [![@gliljas](https://avatars.githubusercontent.com/u/290294?s=52&v=4)](/gliljas) [![@deAtog](https://avatars.githubusercontent.com/u/739582?s=52&v=4)](/deAtog) [![@fredericDelaporte](https://avatars.githubusercontent.com/u/12201973?s=52&v=4)](/fredericDelaporte)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

