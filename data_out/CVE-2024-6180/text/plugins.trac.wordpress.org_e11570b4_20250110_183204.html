

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Feventon-lite%2Ftrunk%2Fincludes%2Fcalendar%2Fclass-calendar-event-structure.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php?rev=3129747 "Revision 3129747")
* Next Revision →
* [Blame](/browser/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php)

---

# [source:](/browser?order=name "Go to repository root") [eventon-lite](/browser/eventon-lite?order=name "View eventon-lite")/[trunk](/browser/eventon-lite/trunk?order=name "View trunk")/[includes](/browser/eventon-lite/trunk/includes?order=name "View includes")/[calendar](/browser/eventon-lite/trunk/includes/calendar?order=name "View calendar")/[class-calendar-event-structure.php](/browser/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php?order=name "View class-calendar-event-structure.php")

View diff against:

View revision:

| [Last change](/changeset/3147272/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php "View differences") on this file was [3147272](/changeset/3147272/ "View changeset 3147272"), checked in by ashanjay, [4 months ago](/timeline?from=2024-09-05T20%3A34%3A42Z&precision=second "See timeline at 09/05/2024 08:34:42 PM") |
| --- |
| 2.2.21 (2024-9-5) FIXED: event list with tiles layout styles FIXED: ssl check for google fonts loading in admin FIXED: live now events breaking the view FIXED: backend button styles UPDATED: eventtop layout design  UPDATED: how the evo\_helper() is called |
| * Property **svn:eol-style** set to   *`native`* | |
| **File size:** 45.0 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Calendar single event's html structure |
| [4](#L4) | \* @version L 2.2.21 |
| [5](#L5) | \*/ |
| [6](#L6) |  |
| [7](#L7) | class EVO\_Cal\_Event\_Structure{ |
| [8](#L8) | private $EVENT; |
| [9](#L9) | private $timezone = ''; |
| [10](#L10) | private $ev\_tz = ''; |
| [11](#L11) | private $timezone\_data = array(); |
| [12](#L12) | public $helper, $help; |
| [13](#L13) |  |
| [14](#L14) | private $OO = array(); |
| [15](#L15) | private $OO2 = array(); |
| [16](#L16) |  |
| [17](#L17) | public function \_\_construct($EVENT=''){ |
| [18](#L18) |  |
| [19](#L19) | $this->timezone\_data = array( |
| [20](#L20) | '\_\_f'=>'YYYY-MM-DD h:mm:a', |
| [21](#L21) | '\_\_df'=> 'YYYY-MM-DD', |
| [22](#L22) | '\_\_tf'=> 'h:mm:a', |
| [23](#L23) | '\_\_t'=> evo\_lang('View in my time') |
| [24](#L24) | ); |
| [25](#L25) |  |
| [26](#L26) | if(!empty($EVENT)) $this->EVENT = $EVENT; |
| [27](#L27) |  |
| [28](#L28) | $this->timezone = get\_option('gmt\_offset', 0); |
| [29](#L29) | $this->ev\_tz = $EVENT->get\_timezone\_key(); |
| [30](#L30) |  |
| [31](#L31) | $this->helper = $this->help = EVO()->helper; |
| [32](#L32) | } |
| [33](#L33) |  |
| [34](#L34) |  |
| [35](#L35) | // HTML EventTop |
| [36](#L36) | function get\_event\_top($array, $EventData, $eventtop\_fields, $evOPT, $evOPT2){ |
| [37](#L37) |  |
| [38](#L38) | $EVENT = $this->EVENT; |
| [39](#L39) | $SC = EVO()->calendar->shortcode\_args; |
| [40](#L40) | $OT = ''; |
| [41](#L41) | $\_additions = apply\_filters('evo\_eventtop\_adds' , array()); |
| [42](#L42) |  |
| [43](#L43) | $is\_array\_eventtop\_fields = is\_array($eventtop\_fields)? true:false; |
| [44](#L44) |  |
| [45](#L45) | extract($EventData); |
| [46](#L46) |  |
| [47](#L47) | if(!is\_array($array)) return $OT; |
| [48](#L48) |  |
| [49](#L49) | EVO()->cal->set\_cur('evcal\_1'); |
| [50](#L50) |  |
| [51](#L51) |  |
| [52](#L52) | foreach($array as $element =>$elm){ |
| [53](#L53) |  |
| [54](#L54) | if(!is\_array($elm)) continue; |
| [55](#L55) |  |
| [56](#L56) |  |
| [57](#L57) | // convert to an object |
| [58](#L58) | $object = new stdClass(); |
| [59](#L59) | foreach ($elm as $key => $value){ |
| [60](#L60) | $object->$key = $value; |
| [61](#L61) | } |
| [62](#L62) |  |
| [63](#L63) | $boxname = (in\_array($element, $\_additions))? $element: null; |
| [64](#L64) |  |
| [65](#L65) | switch($element){ |
| [66](#L66) | case has\_filter("eventon\_eventtop\_{$boxname}"): |
| [67](#L67) | $helpers = array( |
| [68](#L68) | 'evOPT'=>$evOPT, |
| [69](#L69) | 'evoOPT2'=>$evOPT2, |
| [70](#L70) | ); |
| [71](#L71) |  |
| [72](#L72) | $OT.= apply\_filters("eventon\_eventtop\_{$boxname}", $object, $helpers, $EVENT); |
| [73](#L73) | break; |
| [74](#L74) | case 'ft\_img': |
| [75](#L75) | $url = !empty($object->url\_med)? $object->url\_med: $object->url; |
| [76](#L76) | //$url = !empty($object->url\_full)? $object->url\_full[0]: $url; |
| [77](#L77) | $url = apply\_filters('eventon\_eventtop\_image\_url', $url); |
| [78](#L78) |  |
| [79](#L79) | $time\_vals = ( $object->show\_time) ? '<span class="evo\_img\_time"></span>':''; |
| [80](#L80) |  |
| [81](#L81) | $OT .= "<span class='evoet\_c1 evoet\_cx '>"; |
| [82](#L82) | $OT.= "<span class='ev\_ftImg' data-img='".(!empty($object->url\_full)? $object->url\_full: '')."' data-thumb='".$url."' style='background-image:url(\"".$url."\")' >{$time\_vals}</span>"; |
| [83](#L83) | $OT .= "</span>"; |
| [84](#L84) |  |
| [85](#L85) | break; |
| [86](#L86) | case 'day\_block': |
| [87](#L87) |  |
| [88](#L88) | if(!empty($object->include) && !$object->include) break; |
| [89](#L89) | if(!is\_array( $object->start )) break; |
| [90](#L90) |  |
| [91](#L91) | // if event hide\_et\_dn |
| [92](#L92) | if( isset($SC['hide\_et\_dn']) && $SC['hide\_et\_dn'] == 'yes') break; |
| [93](#L93) |  |
| [94](#L94) | $OT .= "<span class='evoet\_c2 evoet\_cx '>"; |
| [95](#L95) | $OT.="<span class='evoet\_dayblock evcal\_cblock ".( $year\_long?'yrl ':null).( $month\_long?'mnl ':null)."' data-bgcolor='".$color."' data-smon='".$object->start['F']."' data-syr='".$object->start['Y']."'>"; |
| [96](#L96) |  |
| [97](#L97) | // include dayname if allowed via settings |
| [98](#L98) | $daynameS = $daynameE = ''; |
| [99](#L99) | if( is\_array($eventtop\_fields) && in\_array('dayname', $eventtop\_fields)){ |
| [100](#L100) | $daynameS = (!empty($object->html['start']['day'])? $object->html['start']['day']:''); |
| [101](#L101) | $daynameE = (!empty($object->html['end']['day'])? $object->html['end']['day']:''); |
| [102](#L102) | } |
| [103](#L103) |  |
| [104](#L104) | $time\_data = apply\_filters('evo\_eventtop\_dates', array( |
| [105](#L105) | 'start'=>array( |
| [106](#L106) | 'year'=>        ($object->show\_start\_year=='yes'? $object->html['start']['year']:''), |
| [107](#L107) | 'day'=>         $daynameS, |
| [108](#L108) | 'date'=>        (!empty($object->html['start']['date'])?$object->html['start']['date']:''), |
| [109](#L109) | 'month'=>       (!empty($object->html['start']['month'])?$object->html['start']['month']:''), |
| [110](#L110) | 'time'=>        (!empty($object->html['start']['time'])?$object->html['start']['time']:''), |
| [111](#L111) | ), |
| [112](#L112) | 'end'=>array( |
| [113](#L113) | 'year'=>        (($object->show\_end\_year=='yes' && !empty($object->html['end']['year']) )? $object->html['end']['year']:''), |
| [114](#L114) | 'day'=>         $daynameE, |
| [115](#L115) | 'date'=>        (!empty($object->html['end']['date'])?$object->html['end']['date']:''), |
| [116](#L116) | 'month'=>       (!empty($object->html['end']['month'])? $object->html['end']['month']:''), |
| [117](#L117) | 'time'=>        (!empty($object->html['end']['time'])? $object->html['end']['time']:''), |
| [118](#L118) | ), |
| [119](#L119) | ), $object->show\_start\_year, $object ); |
| [120](#L120) |  |
| [121](#L121) | $class\_add = ''; |
| [122](#L122) | foreach($time\_data as $type=>$data){ |
| [123](#L123) | $end\_content = ''; |
| [124](#L124) | foreach($data as $field=>$value){ |
| [125](#L125) | if(empty($value)) continue; |
| [126](#L126) | $end\_content .= "<em class='{$field}'>{$value}</em>"; |
| [127](#L127) | } |
| [128](#L128) |  |
| [129](#L129) | if($type == 'end' && empty($data['year']) && empty($data['month']) && empty($data['date']) && !empty($data['time'])){ |
| [130](#L130) | $class\_add = 'only\_time'; |
| [131](#L131) | } |
| [132](#L132) | if(empty($end\_content)) continue; |
| [133](#L133) | $OT .= "<span class='evo\_{$type} {$class\_add}'>"; |
| [134](#L134) | $OT .= $end\_content; |
| [135](#L135) | $OT .= "</span>"; |
| [136](#L136) | } |
| [137](#L137) |  |
| [138](#L138) | $OT .= "</span>"; |
| [139](#L139) | $OT .= "</span>"; |
| [140](#L140) |  |
| [141](#L141) | break; |
| [142](#L142) |  |
| [143](#L143) | // title section of the event top |
| [144](#L144) | case 'titles': |
| [145](#L145) |  |
| [146](#L146) | // location attributes |
| [147](#L147) | $event\_location\_variables = ''; |
| [148](#L148) | if(!empty($location\_name) && (!empty($location\_address) || !empty($location\_latlng))){ |
| [149](#L149) | $LL = !empty($location\_latlng)? $location\_latlng:false; |
| [150](#L150) |  |
| [151](#L151) | if(!empty($location\_address)) $event\_location\_variables .= ' data-location\_address="'.$location\_address.'" '; |
| [152](#L152) | $event\_location\_variables .= ($LL)? 'data-location\_type="lonlat"': 'data-location\_type="address"'; |
| [153](#L153) | $event\_location\_variables .= ' data-location\_name="'.$location\_name.'"'; |
| [154](#L154) | if(isset($location\_url))        $event\_location\_variables .= ' data-location\_url="'.$location\_url.'"'; |
| [155](#L155) | $event\_location\_variables .= ' data-location\_status="true"'; |
| [156](#L156) |  |
| [157](#L157) | if( $LL){ |
| [158](#L158) | $event\_location\_variables .= ' data-latlng="'.$LL.'"'; |
| [159](#L159) | } |
| [160](#L160) |  |
| [161](#L161) | $OT.= "<span class='event\_location\_attrs' {$event\_location\_variables}></span>"; |
| [162](#L162) | } |
| [163](#L163) |  |
| [164](#L164) | $OT.= "<span class='evoet\_c3 evoet\_cx evcal\_desc evo\_info ". ( $year\_long?'yrl ':null).( $month\_long?'mnl ':null)."' >"; |
| [165](#L165) |  |
| [166](#L166) |  |
| [167](#L167) |  |
| [168](#L168) | // above title inserts |
| [169](#L169) | if( isset($SC['hide\_et\_tags']) && $SC['hide\_et\_tags'] == 'yes'): else: |
| [170](#L170) |  |
| [171](#L171) | $OT.= "<span class='evoet\_tags evo\_above\_title'>"; |
| [172](#L172) |  |
| [173](#L173) | // live now virtual event 2.2.14 |
| [174](#L174) | if($EVENT && !$EVENT->is\_cancelled() && $EVENT->is\_event\_live\_now() && !EVO()->cal->check\_yn('evo\_hide\_live') ){ |
| [175](#L175) | $OT.= "<span class='evo\_live\_now' title='".( evo\_lang('Live Now')  )."'>". EVO()->elements->get\_icon('live') ."</span>"; |
| [176](#L176) | } |
| [177](#L177) |  |
| [178](#L178) |  |
| [179](#L179) | // get set to hide event top tags |
| [180](#L180) | $eventtop\_hidden\_tags = isset($evOPT['evo\_etop\_tags']) ? $evOPT['evo\_etop\_tags'] : array(); |
| [181](#L181) |  |
| [182](#L182) | $OT .= apply\_filters("eventon\_eventtop\_abovetitle", '', $object, $EVENT, $eventtop\_hidden\_tags); |
| [183](#L183) |  |
| [184](#L184) | $eventtop\_tags = apply\_filters('eventon\_eventtop\_abovetitle\_tags', array()); |
| [185](#L185) |  |
| [186](#L186) | // status |
| [187](#L187) | if( $\_status && $\_status != 'scheduled'){ |
| [188](#L188) | $eventtop\_tags['status'] = array( |
| [189](#L189) | $EVENT->get\_event\_status\_lang(), |
| [190](#L190) | $\_status |
| [191](#L191) | ); |
| [192](#L192) | } |
| [193](#L193) |  |
| [194](#L194) | // featured |
| [195](#L195) | if(!empty($featured) && $featured){ |
| [196](#L196) | $eventtop\_tags['featured'] = array(evo\_lang('Featured') ); |
| [197](#L197) | } |
| [198](#L198) |  |
| [199](#L199) | // virtual |
| [200](#L200) | if( $EVENT && $EVENT->is\_virtual() ){ |
| [201](#L201) | if( $EVENT->is\_mixed\_attendance()){ |
| [202](#L202) | $eventtop\_tags['virtual\_physical'] = |
| [203](#L203) | array(evo\_lang('Virtual/ Physical Event'), 'vir'        ); |
| [204](#L204) | }else{ |
| [205](#L205) | $eventtop\_tags['virtual'] = array(evo\_lang('Virtual Event'), 'vir'      ); |
| [206](#L206) | } |
| [207](#L207) |  |
| [208](#L208) | } |
| [209](#L209) |  |
| [210](#L210) |  |
| [211](#L211) | foreach($eventtop\_tags as $ff=>$vv){ |
| [212](#L212) |  |
| [213](#L213) | if(in\_array($ff, $eventtop\_hidden\_tags)) continue; |
| [214](#L214) |  |
| [215](#L215) | $v1 = isset($vv[1]) ? ' '.$vv[1]:''; |
| [216](#L216) | $OT.= "<span class='evo\_event\_headers {$ff}{$v1}'>". $vv[0] . "</span>"; |
| [217](#L217) | } |
| [218](#L218) |  |
| [219](#L219) |  |
| [220](#L220) |  |
| [221](#L221) | $OT.="</span>"; |
| [222](#L222) |  |
| [223](#L223) | endif; |
| [224](#L224) |  |
| [225](#L225) |  |
| [226](#L226) | $OT.= "<span class='evoet\_title evcal\_desc2 evcal\_event\_title' itemprop='name'>". apply\_filters('eventon\_eventtop\_maintitle',$EVENT->get\_title() ) ."</span>"; |
| [227](#L227) |  |
| [228](#L228) | // below title inserts |
| [229](#L229) | $OT.= "<span class='evoet\_subtitle evo\_below\_title'>"; |
| [230](#L230) | if($ST = $EVENT->get\_subtitle()){ |
| [231](#L231) | $OT.= "<span class='evcal\_event\_subtitle' >" . apply\_filters('eventon\_eventtop\_subtitle' , $ST) ."</span>"; |
| [232](#L232) | } |
| [233](#L233) |  |
| [234](#L234) | // event status reason |
| [235](#L235) | if( $reason = $EVENT->get\_status\_reason()){ |
| [236](#L236) | $OT.= '<span class="status\_reason">'. $reason .'</span>'; |
| [237](#L237) | } |
| [238](#L238) |  |
| [239](#L239) | $OT.="</span>"; |
| [240](#L240) | break; |
| [241](#L241) |  |
| [242](#L242) | case 'belowtitle': |
| [243](#L243) |  |
| [244](#L244) | if(!$object->include) break; |
| [245](#L245) |  |
| [246](#L246) |  |
| [247](#L247) | if( isset($SC['hide\_et\_tl']) && $SC['hide\_et\_tl'] == 'yes'):else: |
| [248](#L248) |  |
| [249](#L249) | $OT.= "<span class='evoet\_time\_expand level\_3 evcal\_desc\_info' >"; |
| [250](#L250) |  |
| [251](#L251) | // time |
| [252](#L252) | if($is\_array\_eventtop\_fields && in\_array('time', $eventtop\_fields) && isset($object->html)){ |
| [253](#L253) |  |
| [254](#L254) | // time |
| [255](#L255) | $timezone\_text = (!empty($object->timezone)? ' <em class="evo\_etop\_timezone">'.$object->timezone. '</em>':null); |
| [256](#L256) |  |
| [257](#L257) | //print\_r($object); |
| [258](#L258) | $tzo = $tzo\_box = ''; |
| [259](#L259) |  |
| [260](#L260) | // custom timezone text |
| [261](#L261) | if( !EVO()->cal->check\_yn('evo\_gmt\_hide','evcal\_1') && !empty($this->ev\_tz) ){ |
| [262](#L262) |  |
| [263](#L263) | $GMT\_text = $this->help->get\_timezone\_gmt( $this->ev\_tz , $EVENT->start\_unix); |
| [264](#L264) | $timezone\_text .= "<span class='evo\_tz'>(". $GMT\_text .")</span>"; |
| [265](#L265) | } |
| [266](#L266) |  |
| [267](#L267) | // event time |
| [268](#L268) | $OT.= "<em class='evcal\_time evo\_tz\_time level\_4'>". apply\_filters('evoeventtop\_belowtitle\_datetime', $object->html['html\_fromto'], $object->html, $object) . $timezone\_text ."</em> "; |
| [269](#L269) |  |
| [270](#L270) | // view in my time - local time |
| [271](#L271) | if( !empty($this->ev\_tz) && EVO()->cal->check\_yn('evo\_show\_localtime','evcal\_1') ){ |
| [272](#L272) |  |
| [273](#L273) | $OT.= $this->get\_view\_my\_time\_content( $this->timezone\_data , $EVENT->start\_unix, $EVENT->end\_unix); |
| [274](#L274) | } |
| [275](#L275) |  |
| [276](#L276) | // manual timezone text |
| [277](#L277) | if( empty($object->\_evo\_tz)) $OT.= "<em class='evcal\_local\_time' data-s='{$event\_start\_unix}' data-e='{$event\_end\_unix}' data-tz='". $EVENT->get\_prop('\_evo\_tz') ."'></em>"; |
| [278](#L278) | } |
| [279](#L279) |  |
| [280](#L280) |  |
| [281](#L281) | // location information |
| [282](#L282) | if($is\_array\_eventtop\_fields){ |
| [283](#L283) | // location name |
| [284](#L284) | $LOCname = (in\_array('locationame',$eventtop\_fields) && !empty($location\_name) )? $location\_name: false; |
| [285](#L285) |  |
| [286](#L286) | // location address |
| [287](#L287) | $LOCadd = (in\_array('location',$eventtop\_fields) && !empty($location\_address))? stripslashes($location\_address): false; |
| [288](#L288) |  |
| [289](#L289) | if($LOCname || $LOCadd){ |
| [290](#L290) | $OT.= "<span class='evoet\_location level\_4'>"; |
| [291](#L291) | $OT.= '<em class="evcal\_location" '.( !empty($location\_latlng)? ' data-latlng="'.$location\_latlng.'"':null ).' data-add\_str="'.$LOCadd.'">'.($LOCname? '<em class="event\_location\_name">'.$LOCname.'</em>':''). |
| [292](#L292) | ( ($LOCname && $LOCadd)?', ':''). |
| [293](#L293) | $LOCadd.'</em>'; |
| [294](#L294) | $OT.= "</span>"; |
| [295](#L295) | } |
| [296](#L296) | } |
| [297](#L297) |  |
| [298](#L298) | $OT.="</span>"; |
| [299](#L299) | endif; |
| [300](#L300) |  |
| [301](#L301) |  |
| [302](#L302) | if( isset($SC['hide\_et\_extra']) && $SC['hide\_et\_extra'] == 'yes'):else: |
| [303](#L303) | $OT.="<span class='evcal\_desc3'>"; |
| [304](#L304) |  |
| [305](#L305) | //organizer |
| [306](#L306) | if($object->fields\_ && in\_array('organizer',$object->fields) && !empty($event\_organizer) |
| [307](#L307) | ){ |
| [308](#L308) |  |
| [309](#L309) | $OT.="<span class='evcal\_oganizer level\_4'> |
| [310](#L310) | <em><i>".( eventon\_get\_custom\_language( $evOPT2,'evcal\_evcard\_org', 'Event Organized By')  ).':</i></em> |
| [311](#L311) | <em class="evoet\_dataval">'.$event\_organizer->name."</em> |
| [312](#L312) | </span>"; |
| [313](#L313) | } |
| [314](#L314) | //event type |
| [315](#L315) | if($object->tax) |
| [316](#L316) | $OT.= $object->tax; |
| [317](#L317) |  |
| [318](#L318) | // event tags |
| [319](#L319) | if($is\_array\_eventtop\_fields && in\_array('tags',$eventtop\_fields) && !empty($object->tags) ){ |
| [320](#L320) | $OT.="<span class='evo\_event\_tags level\_4'> |
| [321](#L321) | <em><i>".eventon\_get\_custom\_language( $evOPT2,'evo\_lang\_eventtags', 'Event Tags')."</i></em>"; |
| [322](#L322) |  |
| [323](#L323) | $count = count($object->tags); |
| [324](#L324) | $i = 1; |
| [325](#L325) | foreach($object->tags as $tag){ |
| [326](#L326) | $OT.="<em class='evoet\_dataval' data-tagid='{$tag->term\_id}'>{$tag->name}".( ($count==$i)?'':',')."</em>"; |
| [327](#L327) | $i++; |
| [328](#L328) | } |
| [329](#L329) | $OT.="</span>"; |
| [330](#L330) | } |
| [331](#L331) |  |
| [332](#L332) |  |
| [333](#L333) | // event progress bar |
| [334](#L334) | if( !EVO()->cal->check\_yn('evo\_eventtop\_progress\_hide','evcal\_1')  && $EVENT->is\_event\_live\_now() && !$EVENT->is\_cancelled() |
| [335](#L335) | && !$EVENT->echeck\_yn('hide\_progress') |
| [336](#L336) | && $EVENT->get\_event\_status() != 'postponed' |
| [337](#L337) | ){ |
| [338](#L338) |  |
| [339](#L339) |  |
| [340](#L340) | $livenow\_bar\_sc = isset($SC['livenow\_bar']) ? $SC['livenow\_bar'] : 'yes'; |
| [341](#L341) |  |
| [342](#L342) | // check if shortcode livenow\_bar is set to hide live bar |
| [343](#L343) | if($livenow\_bar\_sc == 'yes'): |
| [344](#L344) |  |
| [345](#L345) | $OT.= "<span class='evo\_event\_progress evo\_event\_progress' >"; |
| [346](#L346) |  |
| [347](#L347) | //$OT.= "<span class='evo\_ep\_pre'>". evo\_lang('Live Now') ."</span>"; |
| [348](#L348) |  |
| [349](#L349) | $now =  EVO()->calendar->utc\_time; |
| [350](#L350) | $duration = $EVENT->duration; |
| [351](#L351) | $end\_utc = $EVENT->get\_end\_time( true); |
| [352](#L352) | $gap = $end\_utc - $now; // how far event has progressed |
| [353](#L353) |  |
| [354](#L354) | $perc = $duration == 0? 0: ($duration - $gap) / $duration; |
| [355](#L355) | $perc = (int)( $perc\*100); |
| [356](#L356) | if( $perc > 100) $perc = 100; |
| [357](#L357) |  |
| [358](#L358) | // action on expire |
| [359](#L359) | $exp\_act = $nonce = ''; |
| [360](#L360) | if( isset($SC['cal\_now']) && $SC['cal\_now'] == 'yes'){ |
| [361](#L361) | $exp\_act = 'runajax\_refresh\_now\_cal'; |
| [362](#L362) | $nonce = wp\_create\_nonce('evo\_calendar\_now'); |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) |  |
| [366](#L366) | $OT.= "<span class='evo\_epbar\_o'><span class='evo\_ep\_bar'><b style='width:{$perc}%'></b></span></span>"; |
| [367](#L367) | $OT.= "<span class='evo\_ep\_time evo\_countdowner' data-endutc='{$end\_utc}' data-gap='{$gap}' data-dur='{$duration}' data-exp\_act='". $exp\_act ."' data-n='{$nonce}' data-ds='".evo\_lang('Days')."' data-d='".evo\_lang('Day')."' data-t='". evo\_lang('Time Left')."'></span>"; |
| [368](#L368) |  |
| [369](#L369) | $OT.= "</span>"; |
| [370](#L370) |  |
| [371](#L371) | endif; |
| [372](#L372) |  |
| [373](#L373) | } |
| [374](#L374) |  |
| [375](#L375) | endif; |
| [376](#L376) |  |
| [377](#L377) | break; |
| [378](#L378) |  |
| [379](#L379) | case 'close1': |
| [380](#L380) | $OT.="</span>";// span.evcal\_desc3 |
| [381](#L381) | break; |
| [382](#L382) |  |
| [383](#L383) | case 'close2': |
| [384](#L384) | $OT.= "</span>";// span.evcal\_desc |
| [385](#L385) |  |
| [386](#L386) | $data = array( |
| [387](#L387) | 'bgc'=> $color, |
| [388](#L388) | 'bggrad'=> ( !empty($bggrad)? $bggrad:''), |
| [389](#L389) | ); |
| [390](#L390) |  |
| [391](#L391) | $OT.="<em class='evoet\_data' style='display:none' ". $this->help->array\_to\_html\_data( $data ) ."></em>"; |
| [392](#L392) | //$OT.="<em class='clear'></em>"; |
| [393](#L393) | break; |
| [394](#L394) | } |
| [395](#L395) | } |
| [396](#L396) |  |
| [397](#L397) | return $OT; |
| [398](#L398) | } |
| [399](#L399) |  |
| [400](#L400) |  |
| [401](#L401) |  |
| [402](#L402) | // EvnetCard HTML |
| [403](#L403) | public function print\_event\_card($array, $EventData, $evOPT, $evoOPT2, $ep\_fields = ''){ |
| [404](#L404) | // INIT |
| [405](#L405) | $EVENT = $this->EVENT; |
| [406](#L406) | $ED = $EventData; |
| [407](#L407) | $evoOPT2 = (!empty($evoOPT2))? $evoOPT2: ''; |
| [408](#L408) | $this->OO = $evOPT; |
| [409](#L409) | $this->OO2 = $evoOPT2; |
| [410](#L410) |  |
| [411](#L411) | $OT =''; |
| [412](#L412) | $count = 1; |
| [413](#L413) | $items = count($array); |
| [414](#L414) |  |
| [415](#L415) | extract($EventData); |
| [416](#L416) |  |
| [417](#L417) | $ep\_fields = !empty($ep\_fields)? explode(',', $ep\_fields): false; |
| [418](#L418) |  |
| [419](#L419) | // close button |
| [420](#L420) | $close = "<div class='evcal\_evdata\_row evcal\_close' title='".eventon\_get\_custom\_language($evoOPT2, 'evcal\_lang\_close','Close')."'></div>"; |
| [421](#L421) |  |
| [422](#L422) | // additional fields array |
| [423](#L423) | $array = apply\_filters('evo\_eventcard\_adds' , $array); |
| [424](#L424) |  |
| [425](#L425) |  |
| [426](#L426) |  |
| [427](#L427) | $RR = ''; |
| [428](#L428) |  |
| [429](#L429) |  |
| [430](#L430) | // get event card designer fields |
| [431](#L431) | $eventcard\_fields = EVO()->calendar->helper->get\_eventcard\_fields\_array(); |
| [432](#L432) |  |
| [433](#L433) | $already\_printed\_boxes = array(); |
| [434](#L434) |  |
| [435](#L435) | if( !is\_array($eventcard\_fields)) return; |
| [436](#L436) |  |
| [437](#L437) | $processed\_fields = array(); |
| [438](#L438) |  |
| [439](#L439) | $rows = count($eventcard\_fields); |
| [440](#L440) | $i = 1; |
| [441](#L441) | foreach( $eventcard\_fields as $R=>$boxes){ |
| [442](#L442) |  |
| [443](#L443) | $CC = ''; |
| [444](#L444) | $box\_count = 0; |
| [445](#L445) |  |
| [446](#L446) | $opened = false; |
| [447](#L447) |  |
| [448](#L448) | foreach( $boxes as $B=>$box){ |
| [449](#L449) |  |
| [450](#L450) | if( !isset($box['n'])) continue; |
| [451](#L451) | $NN = $box['n']; |
| [452](#L452) | if( isset($box['h']) && $box['h'] =='y' ) continue; |
| [453](#L453) |  |
| [454](#L454) | // record printed boxes to avoid duplicate |
| [455](#L455) | if( in\_array($box['n'], $already\_printed\_boxes)) continue; |
| [456](#L456) | if(!in\_array($box['n'], $already\_printed\_boxes)) $already\_printed\_boxes[] = $box['n']; |
| [457](#L457) |  |
| [458](#L458) | // get box data |
| [459](#L459) | if( !array\_key\_exists($NN, $array)) continue; |
| [460](#L460) |  |
| [461](#L461) | $BD = $array[ $NN ]; |
| [462](#L462) | // convert to an object |
| [463](#L463) | $BDO = new stdClass(); |
| [464](#L464) | foreach ($BD as $key => $value){ |
| [465](#L465) | $BDO->$key = $value; |
| [466](#L466) | } |
| [467](#L467) |  |
| [468](#L468) | // if only specific fields set |
| [469](#L469) | if( $ep\_fields && !in\_array($NN, $ep\_fields) ) continue; |
| [470](#L470) |  |
| [471](#L471) | // if already processed |
| [472](#L472) | if( in\_array( $NN, $processed\_fields)) continue; |
| [473](#L473) | $processed\_fields[] = $NN; |
| [474](#L474) |  |
| [475](#L475) | // box content |
| [476](#L476) | $BCC = $this->get\_eventcard\_box\_content( $NN, $BDO, $EVENT , $EventData); |
| [477](#L477) |  |
| [478](#L478) | if( empty($BCC)) continue; |
| [479](#L479) |  |
| [480](#L480) | $color = isset($box['c']) ? $box['c']:''; |
| [481](#L481) |  |
| [482](#L482) | if( $B == 'L1' || $B == 'R1'){ |
| [483](#L483) | $CC .= "<div class='evocard\_box\_h'>"; |
| [484](#L484) | $opened = true; |
| [485](#L485) | } |
| [486](#L486) |  |
| [487](#L487) | $CC .= "<div class='evocard\_box ". esc\_attr( $NN )."' data-c='". esc\_attr( $color ) ."' |
| [488](#L488) | style='". (!empty($color) ? "background-color:#". esc\_attr( $color )."":'') ."'>". $BCC . "</div>"; |
| [489](#L489) |  |
| [490](#L490) | if( $B == 'L2' || $B == 'R2' && $opened){ |
| [491](#L491) | $CC .= "</div>"; $opened = false; |
| [492](#L492) | } |
| [493](#L493) | $box\_count++; |
| [494](#L494) | } |
| [495](#L495) |  |
| [496](#L496) | if( $opened ) $CC .= "</div>"; |
| [497](#L497) | if( empty($CC)) continue; |
| [498](#L498) |  |
| [499](#L499) | $row\_class = array('evocard\_row'); |
| [500](#L500) | if($box\_count>1) $row\_class[] ='bx'.$box\_count; |
| [501](#L501) | if($box\_count>1) $row\_class[] ='bx'; |
| [502](#L502) | if( array\_key\_exists('L1', $boxes)) $row\_class[] = 'L'; |
| [503](#L503) | if($i == $rows)  $row\_class[] = 'lastrow'; |
| [504](#L504) |  |
| [505](#L505) | $RR .= "<div class='". esc\_attr( implode(' ', $row\_class) ) ."'>"; |
| [506](#L506) | $RR .= $CC; |
| [507](#L507) | $RR .= "</div>"; |
| [508](#L508) | $i++; |
| [509](#L509) | } |
| [510](#L510) |  |
| [511](#L511) | $RR .= "<div class='evo\_card\_row\_end evcal\_close' title='".eventon\_get\_custom\_language($evoOPT2, 'evcal\_lang\_close','Close')."'></div>"; |
| [512](#L512) |  |
| [513](#L513) | echo  $RR; |
| [514](#L514) | } |
| [515](#L515) |  |
| [516](#L516) | // return box HTML content using box field name |
| [517](#L517) | function get\_eventcard\_box\_content($box\_name, $box\_data, $EVENT, $EventData){ |
| [518](#L518) |  |
| [519](#L519) | $OT = ''; |
| [520](#L520) | $evOPT = $this->OO; |
| [521](#L521) | $evoOPT2 = $this->OO2; |
| [522](#L522) | $object = $box\_data; |
| [523](#L523) | $end\_row\_class = $end = ''; |
| [524](#L524) | $ED = $EventData; |
| [525](#L525) |  |
| [526](#L526) | extract($EventData); |
| [527](#L527) |  |
| [528](#L528) |  |
| [529](#L529) | // each eventcard type |
| [530](#L530) | switch($box\_name){ |
| [531](#L531) |  |
| [532](#L532) | // addition |
| [533](#L533) | case has\_filter("eventon\_eventCard\_{$box\_name}"): |
| [534](#L534) |  |
| [535](#L535) | $helpers = array( |
| [536](#L536) | 'evOPT'=> $evOPT, |
| [537](#L537) | 'evoOPT2'=>$evoOPT2, |
| [538](#L538) | 'end\_row\_class'=> '','end'=>'', |
| [539](#L539) | ); |
| [540](#L540) |  |
| [541](#L541) | $OT.= apply\_filters("eventon\_eventCard\_{$box\_name}", $object, $helpers, $EVENT); |
| [542](#L542) | break; |
| [543](#L543) |  |
| [544](#L544) | // Event Details |
| [545](#L545) | case 'eventdetails': |
| [546](#L546) |  |
| [547](#L547) | $more\_code=''; $evo\_more\_active\_class = ''; |
| [548](#L548) |  |
| [549](#L549) | // check if character length of description is longer than X size |
| [550](#L550) | if( !empty($evOPT['evo\_morelass']) && $evOPT['evo\_morelass']!='yes' && (strlen($object->fulltext) )>600 ){ |
| [551](#L551) | $more\_code = |
| [552](#L552) | "<p class='eventon\_shad\_p' style='padding:5px 0 0; margin:0'> |
| [553](#L553) | <span class='evcal\_btn evo\_btn\_secondary evobtn\_details\_show\_more' content='less'> |
| [554](#L554) | <span class='ev\_more\_text' data-txt='".evo\_lang\_get('evcal\_lang\_less','less')."'>".evo\_lang\_get('evcal\_lang\_more','more')."</span><span class='ev\_more\_arrow ard'></span> |
| [555](#L555) | </span> |
| [556](#L556) | </p>"; |
| [557](#L557) | $evo\_more\_active\_class = 'shorter\_desc'; |
| [558](#L558) | } |
| [559](#L559) |  |
| [560](#L560) | $iconHTML = "<span class='evcal\_evdata\_icons'><i class='fa ". esc\_attr( get\_eventON\_icon('evcal\_\_fai\_001', 'fa-align-justify',$evOPT ) ) ."'></i></span>"; |
| [561](#L561) |  |
| [562](#L562) | $\_full\_event\_details = stripslashes( $object->fulltext ); |
| [563](#L563) |  |
| [564](#L564) |  |
| [565](#L565) | $OT.="<div class='evo\_metarow\_details evorow evcal\_evdata\_row evcal\_event\_details". esc\_attr( $end\_row\_class ) ."'> |
| [566](#L566) | ".$object->excerpt.$iconHTML." |
| [567](#L567) |  |
| [568](#L568) | <div class='evcal\_evdata\_cell ". esc\_attr( $evo\_more\_active\_class )."'> |
| [569](#L569) | <div class='eventon\_full\_description'> |
| [570](#L570) | <h3 class='padb5 evo\_h3'>".$iconHTML . evo\_lang\_get('evcal\_evcard\_details','Event Details')."</h3> |
| [571](#L571) | <div class='eventon\_desc\_in' itemprop='description'> |
| [572](#L572) | ". |
| [573](#L573) |  |
| [574](#L574) | apply\_filters('evo\_eventcard\_details',EVO()->frontend->filter\_evo\_content( $\_full\_event\_details )) |
| [575](#L575) |  |
| [576](#L576) | ."</div>"; |
| [577](#L577) |  |
| [578](#L578) | // pluggable inside event details |
| [579](#L579) | do\_action('eventon\_eventcard\_event\_details'); |
| [580](#L580) |  |
| [581](#L581) | $OT .= $more\_code; |
| [582](#L582) |  |
| [583](#L583) | $OT.="<div class='clear'></div> |
| [584](#L584) | </div> |
| [585](#L585) | </div> |
| [586](#L586) | </div>"; |
| [587](#L587) |  |
| [588](#L588) | break; |
| [589](#L589) |  |
| [590](#L590) | // TIME |
| [591](#L591) | case 'time': |
| [592](#L592) | $iconTime = "<span class='evcal\_evdata\_icons'><i class='fa ". esc\_attr( get\_eventON\_icon('evcal\_\_fai\_002', 'fa-clock-o',$evOPT ) ) ."'></i></span>"; |
| [593](#L593) |  |
| [594](#L594) |  |
| [595](#L595) | // time for event card |
| [596](#L596) | $timezone = (!empty($object->timezone)? ' <em class="evo\_eventcard\_tiemzone">'. $object->timezone.'</em>':null); |
| [597](#L597) |  |
| [598](#L598) | // event time |
| [599](#L599) | $evc\_time\_text = "<span class='evo\_eventcard\_time\_t'>". apply\_filters('evo\_eventcard\_time', $object->timetext. $timezone, $object) . "</span>"; |
| [600](#L600) |  |
| [601](#L601) | // custom timezone text |
| [602](#L602) | if( !EVO()->cal->check\_yn('evo\_gmt\_hide','evcal\_1') && !empty($this->ev\_tz) ){ |
| [603](#L603) |  |
| [604](#L604) | $GMT\_text = $this->help->get\_timezone\_gmt( $this->ev\_tz, $EVENT->start\_unix); |
| [605](#L605) | $evc\_time\_text .= "<span class='evo\_tz'>(". esc\_html( $GMT\_text ) .")</span>"; |
| [606](#L606) | } |
| [607](#L607) |  |
| [608](#L608) | // view in my time - local time |
| [609](#L609) | if( !empty($this->ev\_tz) && EVO()->cal->check\_yn('evo\_show\_localtime','evcal\_1') ){ |
| [610](#L610) |  |
| [611](#L611) | $evc\_time\_text.= $this->get\_view\_my\_time\_content( $this->timezone\_data , $EVENT->start\_unix, $EVENT->end\_unix); |
| [612](#L612) | } |
| [613](#L613) |  |
| [614](#L614) | $OT.="<div class='evo\_metarow\_time evorow evcal\_evdata\_row evcal\_evrow\_sm ". esc\_attr( $end\_row\_class ) ."'> |
| [615](#L615) | {$iconTime} |
| [616](#L616) | <div class='evcal\_evdata\_cell'> |
| [617](#L617) | <h3 class='evo\_h3'>".$iconTime . evo\_lang\_get('evcal\_lang\_time','Time')."</h3><p>".$evc\_time\_text."</p> |
| [618](#L618) | </div> |
| [619](#L619) | </div>"; |
| [620](#L620) | break; |
| [621](#L621) |  |
| [622](#L622) | // location |
| [623](#L623) | case 'location': |
| [624](#L624) | $iconLoc = "<span class='evcal\_evdata\_icons'><i class='fa ". esc\_attr( get\_eventON\_icon('evcal\_\_fai\_003', 'fa-map-marker',$evOPT ) ) ."'></i></span>"; |
| [625](#L625) |  |
| [626](#L626) | if(!empty($EventData['location\_name']) || !empty($EventData['location\_address'])){ |
| [627](#L627) |  |
| [628](#L628) | $locationLink = (!empty($location\_link))? '<a target="'. ($location\_link\_target=='yes'? '\_blank':'') .'" href="'. esc\_url( evo\_format\_link($location\_link) ).'">':false; |
| [629](#L629) |  |
| [630](#L630) | $OT.= |
| [631](#L631) | "<div class='evcal\_evdata\_row evo\_metarow\_time\_location evorow '> |
| [632](#L632) |  |
| [633](#L633) | {$iconLoc} |
| [634](#L634) | <div class='evcal\_evdata\_cell' data-loc\_tax\_id='". esc\_attr( $EventData['location\_term\_id'] )."'>"; |
| [635](#L635) |  |
| [636](#L636) | if( $location\_hide){ |
| [637](#L637) | $OT.= "<h3 class='evo\_h3'>".$iconLoc. evo\_lang\_get('evcal\_lang\_location','Location'). "</h3>"; |
| [638](#L638) | $OT .= "<p class='evo\_location\_name'>". EVO()->calendar->helper->get\_field\_login\_message() . "</p>"; |
| [639](#L639) | }else{ |
| [640](#L640) |  |
| [641](#L641) | $OT.= "<h3 class='evo\_h3'>".$iconLoc.($locationLink? $locationLink:''). evo\_lang\_get('evcal\_lang\_location','Location').($locationLink?'</a>':'')."</h3>"; |
| [642](#L642) |  |
| [643](#L643) | if( !empty($location\_name) && !$EVENT->check\_yn('evcal\_hide\_locname') ) |
| [644](#L644) | $OT.= "<p class='evo\_location\_name'>". $locationLink. $location\_name . ($locationLink? '</a>':'') ."</p>"; |
| [645](#L645) |  |
| [646](#L646) | // for virtual location |
| [647](#L647) | if( $location\_type == 'virtual'){ |
| [648](#L648) | if( $locationLink) |
| [649](#L649) | $OT.= "<p class='evo\_virtual\_location\_url'>" . evo\_lang('URL:'). $locationLink . ' '. $location\_link."</a></p>"; |
| [650](#L650) | }else{ |
| [651](#L651) |  |
| [652](#L652) | if(!empty($location\_address)){ |
| [653](#L653) | $OT .= "<p class='evo\_location\_address'>". $locationLink . stripslashes($location\_address) . ($locationLink? '</a>':'') ."</p>"; |
| [654](#L654) | } |
| [655](#L655) |  |
| [656](#L656) | } |
| [657](#L657) | } |
| [658](#L658) | $OT.= "</div> |
| [659](#L659) |  |
| [660](#L660) | </div>"; |
| [661](#L661) | } |
| [662](#L662) | break; |
| [663](#L663) |  |
| [664](#L664) | // REPEAT SERIES |
| [665](#L665) | case 'repeats': |
| [666](#L666) | $OT.="<div class='evo\_metarow\_repeats evorow evcal\_evdata\_row evcal\_evrow\_sm ". esc\_attr( $end\_row\_class ) ."'> |
| [667](#L667) | <span class='evcal\_evdata\_icons'><i class='fa ". esc\_attr( get\_eventON\_icon('evcal\_\_fai\_repeats', 'fa-repeat',$evOPT ) ) ."'></i></span> |
| [668](#L668) | <div class='evcal\_evdata\_cell'> |
| [669](#L669) | <h3 class='evo\_h3'>". esc\_html( eventon\_get\_custom\_language($evoOPT2, 'evcal\_lang\_repeats','Future Event Times in this Repeating Event Series') ) ."</h3> |
| [670](#L670) | <p class='evo\_repeat\_series\_dates ".($object->clickable?'clickable':'')."'' data-click='". esc\_attr( $object->clickable ) ."' data-event\_url='". esc\_url( $object->event\_permalink )."'>"; |
| [671](#L671) |  |
| [672](#L672) | $datetime = new evo\_datetime(); |
| [673](#L673) |  |
| [674](#L674) | // allow for custom date time format passing to repeat event times |
| [675](#L675) | $repeat\_start\_time\_format = apply\_filters('evo\_eventcard\_repeatseries\_start\_dtformat',''); |
| [676](#L676) | $repeat\_end\_time\_format = apply\_filters('evo\_eventcard\_repeatseries\_end\_dtformat',''); |
| [677](#L677) |  |
| [678](#L678) | foreach($object->future\_intervals as $key=>$interval){ |
| [679](#L679) | $OT .= "<span data-repeat='". esc\_attr( $key )."' data-l='". esc\_url( $EVENT->get\_permalink($key,$EVENT->l) ) ."' class='evo\_repeat\_series\_date'>"; |
| [680](#L680) |  |
| [681](#L681) |  |
| [682](#L682) | if($EVENT->is\_year\_long()){ |
| [683](#L683) | $OT .= gmdate('Y', $interval[0]); |
| [684](#L684) | }elseif( $EVENT->is\_month\_long()){ |
| [685](#L685) |  |
| [686](#L686) | $OT .= $EVENT->get\_readable\_formatted\_date( $interval[0], 'F, Y'); |
| [687](#L687) |  |
| [688](#L688) | }else{ |
| [689](#L689) |  |
| [690](#L690) | $OT .= $EVENT->get\_readable\_formatted\_date( $interval[0], $repeat\_start\_time\_format); |
| [691](#L691) |  |
| [692](#L692) | if( $object->showendtime && !empty($interval[1])){ |
| [693](#L693) |  |
| [694](#L694) | $OT .= ' - '.$EVENT->get\_readable\_formatted\_date( $interval[1], $repeat\_end\_time\_format); |
| [695](#L695) | } |
| [696](#L696) |  |
| [697](#L697) | } |
| [698](#L698) |  |
| [699](#L699) |  |
| [700](#L700) | $OT.= "</span>"; |
| [701](#L701) | } |
| [702](#L702) |  |
| [703](#L703) | $OT.="</p></div></div>"; |
| [704](#L704) | break; |
| [705](#L705) |  |
| [706](#L706) | // Location Image |
| [707](#L707) | case 'locImg': |
| [708](#L708) |  |
| [709](#L709) | if(empty($location\_img\_id)) break; |
| [710](#L710) | $img\_src = wp\_get\_attachment\_image\_src($location\_img\_id,'full'); |
| [711](#L711) | if(empty($img\_src)) break; |
| [712](#L712) |  |
| [713](#L713) | $fullheight = (int)EVO()->calendar->get\_opt1\_prop('evo\_locimgheight',400); |
| [714](#L714) |  |
| [715](#L715) | if(!empty($img\_src)){ |
| [716](#L716) |  |
| [717](#L717) | // text over location image |
| [718](#L718) | $inside = $inner = ''; |
| [719](#L719) | if(!empty($location\_name) && $EVENT->check\_yn('evcal\_name\_over\_img') ){ |
| [720](#L720) |  |
| [721](#L721) | if(!empty($location\_address)) |
| [722](#L722) | $inner .= '<span style="padding-bottom:10px">'. stripslashes($location\_address) .'</span>'; |
| [723](#L723) | if(!empty($location\_description)) |
| [724](#L724) | $inner .= '<span class="location\_description">'. wp\_kses\_post( $location\_description ) .'</span>'; |
| [725](#L725) |  |
| [726](#L726) | $inside = "<p class='evoLOCtxt'><span class='evo\_loc\_text\_title'>{$location\_name}</span>{$inner}</p>"; |
| [727](#L727) | } |
| [728](#L728) | $OT.="<div class='evcal\_evdata\_row evo\_metarow\_locImg evorow ".( !empty($inside)?'tvi':null)."' style='height:{$fullheight}px; background-image:url(". esc\_url( $img\_src[0] ).")' id='". esc\_attr( $location\_img\_id ) ."\_locimg' >{$inside}</div>"; |
| [729](#L729) | } |
| [730](#L730) | break; |
| [731](#L731) |  |
| [732](#L732) | // GOOGLE map |
| [733](#L733) | case 'gmap': |
| [734](#L734) |  |
| [735](#L735) | // since 4.5 |
| [736](#L736) | $is\_google\_map\_good = true; |
| [737](#L737) | if( !EVO()->cal->get\_prop('evo\_gmap\_api\_key','evcal\_1')) $is\_google\_map\_good = false; |
| [738](#L738) |  |
| [739](#L739) | if( !$is\_google\_map\_good ) break; |
| [740](#L740) |  |
| [741](#L741) | if( $EventData['location\_type'] != 'virtual' || !isset($EventData['location\_type'])){ |
| [742](#L742) | $OT.="<div class='evcal\_evdata\_row evo\_metarow\_gmap evorow evcal\_gmaps ". esc\_attr( $object->id ) ."\_gmap' id='". esc\_attr( $object->id ) ."\_gmap' style='max-width:none'></div>"; |
| [743](#L743) | } |
| [744](#L744) | break; |
| [745](#L745) |  |
| [746](#L746) | // Featured image |
| [747](#L747) | case 'ftimage': |
| [748](#L748) |  |
| [749](#L749) | $\_\_hoverclass = (!empty($object->hovereffect) && $object->hovereffect!='yes')? ' evo\_imghover':null; |
| [750](#L750) | $\_\_noclickclass = (!empty($object->clickeffect) && $object->clickeffect=='yes')? ' evo\_noclick':null; |
| [751](#L751) | $\_\_zoom\_cursor = (!empty($evOPT['evo\_ftim\_mag']) && $evOPT['evo\_ftim\_mag']=='yes')? ' evo\_imgCursor':null; |
| [752](#L752) |  |
| [753](#L753) | ob\_start(); |
| [754](#L754) |  |
| [755](#L755) |  |
| [756](#L756) | // if set to direct image |
| [757](#L757) | if(!empty($evOPT['evo\_ftimg\_height\_sty']) && $evOPT['evo\_ftimg\_height\_sty']=='direct'){ |
| [758](#L758) | // ALT Text for the image |
| [759](#L759) | $alt = !empty($object->img\_id)? get\_post\_meta($object->img\_id,'\_wp\_attachment\_image\_alt', true):false; |
| [760](#L760) | $alt = !empty($alt)? 'alt="'. esc\_html( $alt ) .'"': ''; |
| [761](#L761) | echo "<div class='evo\_metarow\_directimg evcal\_evdata\_row'><img class='evo\_event\_main\_img' src='". esc\_url( $object->img )."' ".  $alt ."/></div>"; |
| [762](#L762) | }else{ |
| [763](#L763) |  |
| [764](#L764) | // make sure image array object passed |
| [765](#L765) | if( $object->main\_image && is\_array($object->main\_image)){ |
| [766](#L766) |  |
| [767](#L767) | $main\_image = $object->main\_image; |
| [768](#L768) |  |
| [769](#L769) | $height = !empty($object->img[2])? $object->img[2]:''; |
| [770](#L770) | $width = !empty($object->img[1])? $object->img[1]:''; |
| [771](#L771) |  |
| [772](#L772) | echo "<div class='evo\_metarow\_fimg evorow evcal\_evdata\_img evcal\_evdata\_row ". esc\_attr( $end\_row\_class.$\_\_hoverclass.$\_\_zoom\_cursor.$\_\_noclickclass )."' data-imgheight='". esc\_attr( $main\_image['full\_h'] ) ."' data-imgwidth='". esc\_attr( $main\_image['full\_w'] ) ."'  style='background-image: url(\"". esc\_url( $object->img )."\")' data-imgstyle='". esc\_attr( $object->ftimg\_sty )."' data-minheight='". esc\_attr( $object->min\_height )."' data-status=''></div>"; |
| [773](#L773) | } |
| [774](#L774) | } |
| [775](#L775) |  |
| [776](#L776) |  |
| [777](#L777) | $OT .= ob\_get\_clean(); |
| [778](#L778) |  |
| [779](#L779) | break; |
| [780](#L780) |  |
| [781](#L781) | // event organizer |
| [782](#L782) | case 'organizer': |
| [783](#L783) |  |
| [784](#L784) | if(empty($ED['event\_organizer'])) break; |
| [785](#L785) | ob\_start(); |
| [786](#L786) | include('views/html-eventcard-organizer.php'); |
| [787](#L787) | return ob\_get\_clean(); |
| [788](#L788) |  |
| [789](#L789) | break; |
| [790](#L790) |  |
| [791](#L791) | // get directions |
| [792](#L792) | case 'getdirection': |
| [793](#L793) |  |
| [794](#L794) | $\_lang\_1 = evo\_lang\_get('evcalL\_getdir\_placeholder','Type your address to get directions'); |
| [795](#L795) | $\_lang\_2 = evo\_lang\_get('evcalL\_getdir\_title','Click here to get directions'); |
| [796](#L796) |  |
| [797](#L797) | $\_from\_address = false; |
| [798](#L798) | if(!empty($location\_address)) $\_from\_address = $location\_address; |
| [799](#L799) | if(!empty($location\_getdir\_latlng) && $location\_getdir\_latlng =='yes' && !empty($location\_latlng)){ |
| [800](#L800) | $\_from\_address = $location\_latlng; |
| [801](#L801) | } |
| [802](#L802) |  |
| [803](#L803) | if(!$\_from\_address) break; |
| [804](#L804) |  |
| [805](#L805) | $OT.="<div class='evo\_metarow\_getDr evorow evcal\_evdata\_row evcal\_evrow\_sm getdirections'> |
| [806](#L806) | <form action='https://maps.google.com/maps' method='get' target='\_blank'> |
| [807](#L807) | <input type='hidden' name='daddr' value=\"". esc\_attr( $\_from\_address )."\"/> |
| [808](#L808) | <p><input class='evoInput' type='text' name='saddr' placeholder='". esc\_html( $\_lang\_1 ) ."' value=''/> |
| [809](#L809) | <button type='submit' class='evcal\_evdata\_icons evcalicon\_9' title='". esc\_html( $\_lang\_2 ) ."'><i class='fa ".esc\_attr( get\_eventON\_icon('evcal\_\_fai\_008a', 'fa-road',$evOPT ) ) ."'></i></button> |
| [810](#L810) | </p></form> |
| [811](#L811) | </div>"; |
| [812](#L812) |  |
| [813](#L813) | break; |
| [814](#L814) |  |
| [815](#L815) | // learn more link |
| [816](#L816) | case "learnmore": |
| [817](#L817) | // learn more link with pluggability |
| [818](#L818) | $learnmore\_link = !empty($EVENT->get\_prop('evcal\_lmlink'))? apply\_filters('evo\_learnmore\_link', $EVENT->get\_prop('evcal\_lmlink'), $object): false; |
| [819](#L819) | $learnmore\_target = ($EVENT->get\_prop('evcal\_lmlink\_target')  && $EVENT->get\_prop('evcal\_lmlink\_target')=='yes')? 'target="\_blank"':null; |
| [820](#L820) |  |
| [821](#L821) | if(!$learnmore\_link) break; |
| [822](#L822) |  |
| [823](#L823) | $OT.= "<div class='evo\_metarow\_learnM evo\_metarow\_learnmore evorow'> |
| [824](#L824) | <a class='evcal\_evdata\_row evo\_clik\_row ' href='". esc\_url( $learnmore\_link ) ."' ".$learnmore\_target."> |
| [825](#L825) | <span class='evcal\_evdata\_icons'><i class='fa ". esc\_attr( get\_eventON\_icon('evcal\_\_fai\_006', 'fa-link',$evOPT ) ) ."'></i></span> |
| [826](#L826) | <h3 class='evo\_h3'>". esc\_html( eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_learnmore2','Learn More') ) ."</h3> |
| [827](#L827) | </a> |
| [828](#L828) | </div>"; |
| [829](#L829) | break; |
| [830](#L830) |  |
| [831](#L831) | case "addtocal": |
| [832](#L832) |  |
| [833](#L833) | $\_\_ics\_url = add\_query\_arg(array( |
| [834](#L834) | 'action' => 'eventon\_ics\_download', |
| [835](#L835) | 'event\_id'  => $EVENT->ID, |
| [836](#L836) | 'ri'        => $EVENT->ri, |
| [837](#L837) | 'nonce'=> wp\_create\_nonce('eventon\_ics\_oneevent') |
| [838](#L838) | ), admin\_url('admin-ajax.php')); |
| [839](#L839) |  |
| [840](#L840) |  |
| [841](#L841) | $O = (object)array( |
| [842](#L842) | 'location\_name'=> !empty($location\_name)?$location\_name:'', |
| [843](#L843) | 'location\_address'=> !empty($location\_address)?$location\_address:'', |
| [844](#L844) | 'etitle'=> $event\_title, |
| [845](#L845) | 'excerpt'=> $event\_excerpt\_txt |
| [846](#L846) | ); |
| [847](#L847) |  |
| [848](#L848) |  |
| [849](#L849) | $\_\_googlecal\_link = $EVENT->get\_addto\_googlecal\_link( |
| [850](#L850) | $O->location\_name, |
| [851](#L851) | $O->location\_address |
| [852](#L852) | ); |
| [853](#L853) |  |
| [854](#L854) |  |
| [855](#L855) | // which options to show for add to calendar |
| [856](#L856) | $addCaloptions = !empty($evOPT['evo\_addtocal'])? $evOPT['evo\_addtocal']: 'all'; |
| [857](#L857) | $addCalContent = ''; |
| [858](#L858) |  |
| [859](#L859) | // add to cal section |
| [860](#L860) | switch($addCaloptions){ |
| [861](#L861) | case 'ics': |
| [862](#L862) | $addCalContent = "<a href='{$\_\_ics\_url}' class='evo\_ics\_nCal' title='".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_addics','Add to your calendar')."'>".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_calncal','Calendar')."</a>"; |
| [863](#L863) | break; |
| [864](#L864) | case 'gcal': |
| [865](#L865) | $addCalContent = "<a href='". $\_\_googlecal\_link. "' target='\_blank' class='evo\_ics\_gCal' title='".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_addgcal','Add to google calendar')."'>".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_calgcal','GoogleCal')."</a>"; |
| [866](#L866) | break; |
| [867](#L867) | case 'all': |
| [868](#L868) | $addCalContent = "<a href='{$\_\_ics\_url}' class='evo\_ics\_nCal' title='".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_addics','Add to your calendar')."'>".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_calncal','Calendar')."</a>". |
| [869](#L869) | "<a href='{$\_\_googlecal\_link}' target='\_blank' class='evo\_ics\_gCal' title='".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_addgcal','Add to google calendar')."'>".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_calgcal','GoogleCal')."</a>"; |
| [870](#L870) | break; |
| [871](#L871) | } |
| [872](#L872) |  |
| [873](#L873) | if( $addCaloptions != 'none'){ |
| [874](#L874) | $OT .= "<div class='evo\_metarow\_ICS evorow evcal\_evdata\_row'> |
| [875](#L875) | <span class='evcal\_evdata\_icons'><i class='fa ".get\_eventON\_icon('evcal\_\_fai\_008', 'fa-calendar',$evOPT )."'></i></span> |
| [876](#L876) | <div class='evcal\_evdata\_cell'> |
| [877](#L877) | <p>{$addCalContent}</p> |
| [878](#L878) | </div> |
| [879](#L879) | </div>"; |
| [880](#L880) | } |
| [881](#L881) | break; |
| [882](#L882) |  |
| [883](#L883) | // Related Events u 2.2.13 |
| [884](#L884) | case 'relatedEvents': |
| [885](#L885) | $events = $EVENT->get\_prop('ev\_releated'); |
| [886](#L886) | if( !$events ) break; |
| [887](#L887) |  |
| [888](#L888) | $events = json\_decode($events, true); |
| [889](#L889) |  |
| [890](#L890) | if( !is\_array( $events )) break; |
| [891](#L891) |  |
| [892](#L892) |  |
| [893](#L893) | ob\_start(); |
| [894](#L894) | include('views/html-eventcard-related.php'); |
| [895](#L895) | return ob\_get\_clean(); |
| [896](#L896) | break; |
| [897](#L897) |  |
| [898](#L898) | // Virtual Event |
| [899](#L899) | case 'virtual': |
| [900](#L900) | if($EVENT->is\_virtual() && !$EVENT->is\_cancelled()): |
| [901](#L901) | ob\_start(); |
| [902](#L902) |  |
| [903](#L903) | $vir = new EVO\_Event\_Virtual($EVENT); |
| [904](#L904) | $vir->print\_eventcard\_cell\_html(); |
| [905](#L905) |  |
| [906](#L906) | $OT.= ob\_get\_clean(); |
| [907](#L907) | endif; |
| [908](#L908) | break; |
| [909](#L909) |  |
| [910](#L910) | // health guidance |
| [911](#L911) | case 'health': |
| [912](#L912) |  |
| [913](#L913) | if( !$EVENT->check\_yn('\_health')) break; |
| [914](#L914) |  |
| [915](#L915) | ob\_start(); |
| [916](#L916) | include('views/html-eventcard-health.php'); |
| [917](#L917) | return ob\_get\_clean(); |
| [918](#L918) |  |
| [919](#L919) |  |
| [920](#L920) | break; |
| [921](#L921) |  |
| [922](#L922) | // paypal link |
| [923](#L923) | case 'paypal': |
| [924](#L924) | $ev\_txt = $EVENT->get\_prop('evcal\_paypal\_text'); |
| [925](#L925) | $text = ($ev\_txt)? $ev\_txt: evo\_lang\_get('evcal\_evcard\_tix1','Buy ticket via Paypal'); |
| [926](#L926) |  |
| [927](#L927) | $currency = !empty($evOPT['evcal\_pp\_cur'])? $evOPT['evcal\_pp\_cur']: false; |
| [928](#L928) | $email = ($EVENT->get\_prop('evcal\_paypal\_email')? $EVENT->get\_prop('evcal\_paypal\_email'): $evOPT['evcal\_pp\_email']); |
| [929](#L929) |  |
| [930](#L930) | if($currency && $email): |
| [931](#L931) | $\_event\_time = $EVENT->get\_formatted\_smart\_time(); |
| [932](#L932) |  |
| [933](#L933) | ob\_start(); |
| [934](#L934) | ?> |
| [935](#L935) |  |
| [936](#L936) |  |
| [937](#L937) | <div class='evo\_metarow\_paypal evorow evcal\_evdata\_row evo\_paypal'> |
| [938](#L938) | <span class='evcal\_evdata\_icons'><i class='fa <?php echo esc\_html( get\_eventON\_icon('evcal\_\_fai\_007', 'fa-ticket',$evOPT ) );?>'></i></span> |
| [939](#L939) | <div class='evcal\_evdata\_cell'> |
| [940](#L940) | <p style='padding-bottom:5px;'><?php echo esc\_html( $text );?></p> |
| [941](#L941) | <form target="\_blank" name="\_xclick" action="https://www.paypal.com/us/cgi-bin/webscr" method="post"> |
| [942](#L942) | <input type="hidden" name="cmd" value="\_xclick"> |
| [943](#L943) | <input type="hidden" name="business" value="<?php echo esc\_html( $email );?>"> |
| [944](#L944) | <input type="hidden" name="currency\_code" value="<?php echo esc\_html( $currency );?>"> |
| [945](#L945) | <input type="hidden" name="item\_name" value="<?php echo esc\_html( $EVENT->post\_title.' '.$\_event\_time );?>"> |
| [946](#L946) | <input type="hidden" name="amount" value="<?php echo esc\_html( $EVENT->get\_prop('evcal\_paypal\_item\_price') );?>"> |
| [947](#L947) | <input type='submit' class='evcal\_btn' value='<?php echo esc\_html( evo\_lang\_get('evcal\_evcard\_btn1','Buy Now') );?>'/> |
| [948](#L948) | </form> |
| [949](#L949) | </div></div> |
| [950](#L950) | <?php $OT.= ob\_get\_clean(); |
| [951](#L951) | endif; |
| [952](#L952) |  |
| [953](#L953) | break; |
| [954](#L954) |  |
| [955](#L955) | // social share u2.2.13 |
| [956](#L956) | case 'evosocial': |
| [957](#L957) | ob\_start(); |
| [958](#L958) | include('views/html-eventcard-social.php'); |
| [959](#L959) | return ob\_get\_clean(); |
| [960](#L960) |  |
| [961](#L961) | break; |
| [962](#L962) |  |
| [963](#L963) | }// end switch |
| [964](#L964) |  |
| [965](#L965) | // for custom meta data fields |
| [966](#L966) | if(!empty($object->x) && $box\_name == 'customfield'.$object->x){ |
| [967](#L967) | $i18n\_name = eventon\_get\_custom\_language($evoOPT2,'evcal\_cmd\_'.$object->x , $evOPT['evcal\_ec\_f'.$object->x.'a1']); |
| [968](#L968) |  |
| [969](#L969) | // user role restriction access validation |
| [970](#L970) | if( |
| [971](#L971) | ($object->visibility\_type=='admin' && !current\_user\_can( 'manage\_options' ) ) || |
| [972](#L972) | ($object->visibility\_type=='loggedin' && !is\_user\_logged\_in() && empty($object->login\_needed\_message)) |
| [973](#L973) | ){}else{ |
| [974](#L974) |  |
| [975](#L975) | $OT .="<div class='evo\_metarow\_cusF". esc\_attr( $object->x )." evorow evcal\_evdata\_row evcal\_evrow\_sm '> |
| [976](#L976) | <span class='evcal\_evdata\_icons'><i class='fa ". esc\_attr( $object->imgurl ) ."'></i></span> |
| [977](#L977) | <div class='evcal\_evdata\_cell'> |
| [978](#L978) | <h3 class='evo\_h3'>". esc\_html( $i18n\_name ) ."</h3>"; |
| [979](#L979) |  |
| [980](#L980) | // if visible only to loggedin users and user is not logged in |
| [981](#L981) | if( !empty($object->login\_needed\_message)){ |
| [982](#L982) | $OT .="<div class='evo\_custom\_content evo\_data\_val'>". $object->login\_needed\_message . "</div>"; |
| [983](#L983) | }else{ |
| [984](#L984) | if($object->type=='button'){ |
| [985](#L985) | $\_target = (!empty($object->\_target) && $object->\_target=='yes')? 'target="\_blank"':null; |
| [986](#L986) | $OT .="<a href='". esc\_url( $object->valueL ) ."' {$\_target} class='evcal\_btn evo\_cusmeta\_btn'>". esc\_html( $object->value ) ."</a>"; |
| [987](#L987) | }else{ |
| [988](#L988) | $OT .="<div class='evo\_custom\_content evo\_data\_val'>". |
| [989](#L989) | (  EVO()->frontend->filter\_evo\_content($object->value) )."</div>"; |
| [990](#L990) | } |
| [991](#L991) | } |
| [992](#L992) |  |
| [993](#L993) | $OT .="</div></div>"; |
| [994](#L994) | } |
| [995](#L995) | } |
| [996](#L996) |  |
| [997](#L997) | return $OT; |
| [998](#L998) | } |
| [999](#L999) |  |
| [1000](#L1000) | // view in my time |
| [1001](#L1001) | public function get\_view\_my\_time\_content($timezone\_data, $start, $end){ |
| [1002](#L1002) | extract( $timezone\_data ); |
| [1003](#L1003) |  |
| [1004](#L1004) | $data = array( |
| [1005](#L1005) | '\_\_df'=> $\_\_df, |
| [1006](#L1006) | '\_\_tf'=> $\_\_tf, |
| [1007](#L1007) | '\_\_f'=> $\_\_f, |
| [1008](#L1008) | 'times'=> $start . '-' . $end, |
| [1009](#L1009) | 'tzo' => $this->help->get\_timezone\_offset( $this->ev\_tz,  $start) |
| [1010](#L1010) | ); |
| [1011](#L1011) |  |
| [1012](#L1012) | return "<em class='evcal\_tz\_time evo\_mytime tzo\_trig' title='". evo\_lang('My Time') ."'  ". $this->help->array\_to\_html\_data($data)."><i class='fa fa-globe-americas'></i> <b>{$\_\_t}</b></em>"; |
| [1013](#L1013) |  |
| [1014](#L1014) | } |
| [1015](#L1015) |  |
| [1016](#L1016) | // SEO Schema data |
| [1017](#L1017) | function get\_schema($EventData, $\_eventcard){ |
| [1018](#L1018) | extract($EventData); |
| [1019](#L1019) | $EVENT = $this->EVENT; |
| [1020](#L1020) |  |
| [1021](#L1021) | //print\_r($EventData); |
| [1022](#L1022) |  |
| [1023](#L1023) | $\_\_scheme\_data = '<div class="evo\_event\_schema" style="display:none" >'; |
| [1024](#L1024) |  |
| [1025](#L1025) | $tz = strpos($this->timezone, '-') === false? '+'. $this->timezone : $this->timezone; |
| [1026](#L1026) |  |
| [1027](#L1027) |  |
| [1028](#L1028) | // Start time |
| [1029](#L1029) | $\_schema\_starttime = $\_schema\_endtime = ''; |
| [1030](#L1030) | if(is\_array($start\_date\_data)) |
| [1031](#L1031) | $\_schema\_starttime = $start\_date\_data['Y'].'-'.$start\_date\_data['n'].'-'.$start\_date\_data['j'].( !$EVENT->is\_all\_day()? 'T'.$start\_date\_data['H'].':'.$start\_date\_data['i']. $tz. ':00' :''); |
| [1032](#L1032) | if(is\_array($end\_date\_data)) |
| [1033](#L1033) | $\_schema\_endtime = $end\_date\_data['Y'].'-'.$end\_date\_data['n'].'-'.$end\_date\_data['j']. ( !$EVENT->is\_all\_day()? 'T'.$end\_date\_data['H'].':'.$end\_date\_data['i'].$tz. ':00':''); |
| [1034](#L1034) |  |
| [1035](#L1035) | // Event Status |
| [1036](#L1036) | $ES = array( |
| [1037](#L1037) | 'cancelled'=>'https://schema.org/EventCancelled', |
| [1038](#L1038) | 'movedonline'=>'https://schema.org/EventMovedOnline', |
| [1039](#L1039) | 'postponed'=>'https://schema.org/EventPostponed', |
| [1040](#L1040) | 'rescheduled'=>'https://schema.org/EventRescheduled', |
| [1041](#L1041) | ); |
| [1042](#L1042) |  |
| [1043](#L1043) | $\_ES = isset($ES[$\_status])? $ES[$\_status]: 'https://schema.org/EventScheduled'; |
| [1044](#L1044) |  |
| [1045](#L1045) |  |
| [1046](#L1046) | // Event details |
| [1047](#L1047) | $\_\_schema\_desc = !empty($event\_excerpt\_txt)? $event\_excerpt\_txt : (isset($EVENT->post\_title)? '"'.$EVENT->post\_title.'"':''); |
| [1048](#L1048) | if(!empty($event\_details)) $\_\_schema\_desc = $event\_details; |
| [1049](#L1049) | $\_\_schema\_desc = str\_replace("'","'", $\_\_schema\_desc); |
| [1050](#L1050) | $\_\_schema\_desc = str\_replace('"',"", $\_\_schema\_desc); |
| [1051](#L1051) | $\_\_schema\_desc = preg\_replace( "/\r|\n/", " ", $\_\_schema\_desc ); |
| [1052](#L1052) |  |
| [1053](#L1053) | // attendence mode |
| [1054](#L1054) | $AM = ucfirst( $EVENT->get\_attendance\_mode() ); |
| [1055](#L1055) | $\_AM = 'https://schema.org/'. $AM .'EventAttendanceMode'; |
| [1056](#L1056) |  |
| [1057](#L1057) | if(!empty($schema) && $schema){ |
| [1058](#L1058) | // for each schema custom values |
| [1059](#L1059) | foreach(apply\_filters('evo\_event\_schema',array( |
| [1060](#L1060) | 'url'=>array( |
| [1061](#L1061) | 'type'=>'a', |
| [1062](#L1062) | 'attr'=>'href', |
| [1063](#L1063) | 'attrcontent'=> $EVENT->get\_permalink() |
| [1064](#L1064) | ), |
| [1065](#L1065) | 'image'=>array( |
| [1066](#L1066) | 'type'=>'meta', |
| [1067](#L1067) | 'content'=> (!empty($img\_src) &&!empty($img\_src)? $img\_src:'') |
| [1068](#L1068) | ), |
| [1069](#L1069) | 'startDate'=>array( |
| [1070](#L1070) | 'type'=>'meta', |
| [1071](#L1071) | 'content'=> $\_schema\_starttime |
| [1072](#L1072) | ), |
| [1073](#L1073) | 'endDate'=>array( |
| [1074](#L1074) | 'type'=>'meta', |
| [1075](#L1075) | 'content'=> $\_schema\_endtime |
| [1076](#L1076) | ), |
| [1077](#L1077) | 'eventStatus'=>array( |
| [1078](#L1078) | 'type'=>'meta', |
| [1079](#L1079) | 'content'=>  $\_ES |
| [1080](#L1080) | ), |
| [1081](#L1081) | ),$EVENT, $EVENT->ID) as $key=>$value){ |
| [1082](#L1082) | $\_\_scheme\_data .= "<".(!empty($value['type'])? $value['type']:'meta') ." itemprop='". esc\_attr( $key ) ."' ".(!empty($value['content'])? 'content="'. esc\_html( $value['content'] ).'"':'') ." ". ( !empty($value['attr'])? $value['attr']."='". esc\_html( $value['attrcontent'] )."'":''); |
| [1083](#L1083) |  |
| [1084](#L1084) | if(!empty($value['itemtype'])) $\_\_scheme\_data .= ' itemscope itemtype="'. esc\_html( $value['itemtype'] ) .'"'; |
| [1085](#L1085) |  |
| [1086](#L1086) | $\_\_scheme\_data .= ($value['type'] =='meta')? "/>": ">"; |
| [1087](#L1087) | $\_\_scheme\_data .= (!empty($value['html'])? $value['html'] :''); |
| [1088](#L1088) | $\_\_scheme\_data .= (isset($value['type']) && $value['type'] == 'meta')? '': |
| [1089](#L1089) | ( isset($value['type'])? "</". esc\_attr( $value['type'] ) .">" :'' ); |
| [1090](#L1090) | } |
| [1091](#L1091) |  |
| [1092](#L1092) | // location data |
| [1093](#L1093) | if( !empty($location\_type) && $location\_type =='virtual'){ |
| [1094](#L1094) | $\_\_scheme\_data .= '<item style="display:none" itemprop="location" itemscope itemtype="http://schema.org/VirtualLocation">'; |
| [1095](#L1095) | if(!empty($location\_link)) $\_\_scheme\_data .= '<span itemprop="url">'. esc\_url( $location\_link ) .'</span>'; |
| [1096](#L1096) | $\_\_scheme\_data .= "</item>"; |
| [1097](#L1097) |  |
| [1098](#L1098) | //$\_AM = 'https://schema.org/OnlineEventAttendanceMode'; |
| [1099](#L1099) |  |
| [1100](#L1100) | } |
| [1101](#L1101) |  |
| [1102](#L1102) | if(!empty($location\_address)){ |
| [1103](#L1103) |  |
| [1104](#L1104) | $\_\_scheme\_data .= '<item style="display:none" itemprop="location" itemscope itemtype="http://schema.org/Place">'. ( !empty($location\_name)? '<span itemprop="name">'.$location\_name.'</span>':'').'<span itemprop="address" itemscope itemtype="http://schema.org/PostalAddress"><item itemprop="streetAddress">'. stripslashes($location\_address) .'</item></span></item>'; |
| [1105](#L1105) | } |
| [1106](#L1106) |  |
| [1107](#L1107) | $\_\_scheme\_data .= '<item style="display:none" itemprop="eventAttendanceMode" itemscope itemtype="'.$\_AM.'"></item>'; |
| [1108](#L1108) |  |
| [1109](#L1109) | // offer data |
| [1110](#L1110) | if( $EVENT->get\_prop('\_seo\_offer\_price') && $EVENT->get\_prop('\_seo\_offer\_currency')){ |
| [1111](#L1111) | $\_\_scheme\_data .= '<div itemprop="offers" itemscope itemtype="http://schema.org/Offer"> |
| [1112](#L1112) | <div class="event-price" itemprop="price" content="'.$EVENT->get\_prop('\_seo\_offer\_price').'">'.$EVENT->get\_prop('\_seo\_offer\_price').'</div> |
| [1113](#L1113) | <meta itemprop="priceCurrency" content="'.$EVENT->get\_prop('\_seo\_offer\_currency').'"> |
| [1114](#L1114) | <meta itemprop="url" content="'.$EVENT->get\_permalink().'"> |
| [1115](#L1115) | <meta itemprop="availability" content="http://schema.org/InStock"> |
| [1116](#L1116) | <meta itemprop="validFrom" content="'.$\_schema\_starttime.'"> |
| [1117](#L1117) | </div>'; |
| [1118](#L1118) | } |
| [1119](#L1119) |  |
| [1120](#L1120) | // organizer data |
| [1121](#L1121) | if(!empty($organizer) && isset($organizer->name)){ |
| [1122](#L1122) | $\_\_scheme\_data .= '<div itemprop="organizer" itemscope="" itemtype="http://schema.org/Organization"> |
| [1123](#L1123) | <meta itemprop="name" content="'.$organizer->name.'"> |
| [1124](#L1124) | '. (!empty($organizer\_link)? '<meta itemprop="url" content="'.$organizer\_link.'">':''). |
| [1125](#L1125) | '</div>'; |
| [1126](#L1126) | } |
| [1127](#L1127) |  |
| [1128](#L1128) | // performer data using organizer data |
| [1129](#L1129) | if( $EVENT->get\_prop('evo\_event\_org\_as\_perf') && !empty($organizer) && isset($organizer->name)){ |
| [1130](#L1130) | $\_\_scheme\_data .= '<div itemprop="performer" itemscope="" itemtype="http://schema.org/Person"> |
| [1131](#L1131) | <meta itemprop="name" content="'.$organizer->name.'"> |
| [1132](#L1132) | </div>'; |
| [1133](#L1133) | } |
| [1134](#L1134) | }else{ |
| [1135](#L1135) | $\_\_scheme\_data .= '<a href="'.$event\_permalink.'"></a>'; |
| [1136](#L1136) | } |
| [1137](#L1137) |  |
| [1138](#L1138) | // JSON LD |
| [1139](#L1139) | if(!empty($schema\_jsonld) && $schema\_jsonld){ |
| [1140](#L1140) | $\_\_scheme\_data .= '<script type="application/ld+json">'; |
| [1141](#L1141) |  |
| [1142](#L1142) | // event status |
| [1143](#L1143) | $\_schema\_eventstatus = ',"eventStatus":"'. $\_ES .'"'; |
| [1144](#L1144) |  |
| [1145](#L1145) | // location |
| [1146](#L1146) | $\_schema\_location = ''; |
| [1147](#L1147) |  |
| [1148](#L1148) | if(!empty($location\_type) && $location\_type == 'virtual' || !empty($location\_address)){ |
| [1149](#L1149) | $\_schema\_location .= ',"location":'; |
| [1150](#L1150) | } |
| [1151](#L1151) |  |
| [1152](#L1152) | if(!empty($location\_type) && $location\_type == 'virtual' || !empty($location\_address)) |
| [1153](#L1153) | $\_schema\_location .= '['; |
| [1154](#L1154) |  |
| [1155](#L1155) | if(!empty($location\_type) && $location\_type == 'virtual'){ |
| [1156](#L1156) | $\_schema\_location .= '{"@type":"VirtualLocation"'; |
| [1157](#L1157) | if(!empty($location\_link)) $\_schema\_location .= ',"url":"'.$location\_link.'"'; |
| [1158](#L1158) | $\_schema\_location .= '}'; |
| [1159](#L1159) | } |
| [1160](#L1160) | if(!empty($location\_address)){ |
| [1161](#L1161) |  |
| [1162](#L1162) | if(!empty($location\_type) && $location\_type == 'virtual') |
| [1163](#L1163) | $\_schema\_location .= ','; |
| [1164](#L1164) |  |
| [1165](#L1165) | if( !empty($location\_name) ) |
| [1166](#L1166) | $location\_name = str\_replace('"', "", $location\_name); |
| [1167](#L1167) | $\_name = !empty($location\_name)? '"name":"'.$location\_name.'",':''; |
| [1168](#L1168) |  |
| [1169](#L1169) | $\_schema\_location .= '{"@type":"Place",'.$\_name.'"address":{"@type": "PostalAddress","streetAddress":"'. str\_replace("\,",",", stripslashes($location\_address) ).'"}}'; |
| [1170](#L1170) | } |
| [1171](#L1171) | if(!empty($location\_type) && $location\_type == 'virtual' || !empty($location\_address)){ |
| [1172](#L1172) | $\_schema\_location .= ']'; |
| [1173](#L1173) | } |
| [1174](#L1174) |  |
| [1175](#L1175) | // organizer |
| [1176](#L1176) | $\_schema\_performer = $\_schema\_organizer = ''; |
| [1177](#L1177) | if(!empty($organizer) && isset($organizer->name)){ |
| [1178](#L1178) | $\_schema\_organizer = ',"organizer":{"@type":"Organization","name":"'.$organizer->name.'"'. |
| [1179](#L1179) | ( !empty($organizer\_link)? ',"url":"'.$organizer\_link.'"':''). |
| [1180](#L1180) | '}'; |
| [1181](#L1181) | } |
| [1182](#L1182) |  |
| [1183](#L1183) | // perfomer data using organizer |
| [1184](#L1184) | if( $EVENT->get\_prop('evo\_event\_org\_as\_perf') && !empty($organizer) && isset($organizer->name) ){ |
| [1185](#L1185) | $\_schema\_performer = ',"performer":{"@type":"Person","name":"'.$organizer->name.'"}'; |
| [1186](#L1186) | } |
| [1187](#L1187) |  |
| [1188](#L1188) | // offers field |
| [1189](#L1189) | $\_schema\_offers = ''; |
| [1190](#L1190) | if( $EVENT->get\_prop('\_seo\_offer\_price') && $EVENT->get\_prop('\_seo\_offer\_currency')){ |
| [1191](#L1191) | $\_schema\_offers = ',"offers":{"@type":"Offer","price":"'. esc\_html( $EVENT->get\_prop('\_seo\_offer\_price') ) .'","priceCurrency":"'. esc\_html( $EVENT->get\_prop('\_seo\_offer\_currency') ).'","availability":"http://schema.org/InStock","validFrom":"'. esc\_html( $\_schema\_starttime ) .'","url":"'. esc\_url( $EVENT->get\_permalink() ).'"}'; |
| [1192](#L1192) | } |
| [1193](#L1193) |  |
| [1194](#L1194) | // build the schema content |
| [1195](#L1195) | $\_\_scheme\_data .= |
| [1196](#L1196) | '{"@context": "http://schema.org","@type": "Event", |
| [1197](#L1197) | "@id": "event\_'. esc\_html( $EVENT->get\_event\_uniqid() ).'", |
| [1198](#L1198) | "eventAttendanceMode":"'. $\_AM .'", |
| [1199](#L1199) | "name": '.(isset($EVENT->post\_title)? '"'.htmlspecialchars( $EVENT->post\_title, ENT\_QUOTES ) .'"' :'').', |
| [1200](#L1200) | "url": "'. $EVENT->get\_permalink() .'", |
| [1201](#L1201) | "startDate": "'.$\_schema\_starttime.'", |
| [1202](#L1202) | "endDate": "'.$\_schema\_endtime.'", |
| [1203](#L1203) | "image":'.(!empty($img\_src) &&!empty($img\_src)? '"'. esc\_url( $img\_src ).'"':'""').', |
| [1204](#L1204) | "description":"'.$\_\_schema\_desc.'"'. |
| [1205](#L1205) | $\_schema\_location. |
| [1206](#L1206) | $\_schema\_organizer. |
| [1207](#L1207) | $\_schema\_performer. |
| [1208](#L1208) | $\_schema\_offers. |
| [1209](#L1209) | $\_schema\_eventstatus. |
| [1210](#L1210) | apply\_filters('eventon\_event\_json\_schema\_adds', '', $EVENT, $EVENT->ID). |
| [1211](#L1211) | '}'; |
| [1212](#L1212) | $\_\_scheme\_data .= "</script>"; |
| [1213](#L1213) | } |
| [1214](#L1214) | $\_\_scheme\_data .= "</div>"; |
| [1215](#L1215) |  |
| [1216](#L1216) | return $\_\_scheme\_data; |
| [1217](#L1217) | } |
| [1218](#L1218) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php?format=txt)
* [Original Format](/export/3220385/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

