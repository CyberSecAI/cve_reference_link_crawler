

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Feventon-lite%2Ftrunk%2Fassets%2Fjs%2Fadmin%2Fwp_admin.js)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/eventon-lite/trunk/assets/js/admin/wp_admin.js?rev=2978856 "Revision 2978856")
* Next Revision →
* [Blame](/browser/eventon-lite/trunk/assets/js/admin/wp_admin.js?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/eventon-lite/trunk/assets/js/admin/wp_admin.js)

---

# [source:](/browser?order=name "Go to repository root") [eventon-lite](/browser/eventon-lite?order=name "View eventon-lite")/[trunk](/browser/eventon-lite/trunk?order=name "View trunk")/[assets](/browser/eventon-lite/trunk/assets?order=name "View assets")/[js](/browser/eventon-lite/trunk/assets/js?order=name "View js")/[admin](/browser/eventon-lite/trunk/assets/js/admin?order=name "View admin")/[wp\_admin.js](/browser/eventon-lite/trunk/assets/js/admin/wp_admin.js?order=name "View wp_admin.js")

View diff against:

View revision:

| [Last change](/changeset/3129747/eventon-lite/trunk/assets/js/admin/wp_admin.js "View differences") on this file was [3129747](/changeset/3129747/ "View changeset 3129747"), checked in by ashanjay, [5 months ago](/timeline?from=2024-08-01T21%3A33%3A29Z&precision=second "See timeline at 08/01/2024 09:33:29 PM") |
| --- |
| 2.2.17 (2024-8-1) FIXED: evo\_retrieve\_cmd\_count() undefined error FIXED: Known XSS with language fields FIXED: language selection not loading correct page FIXED: Live now calendar showing schema data on page REMOVED: Unused language fields UPDATED: get\_event\_ids() in shortcode generator to use wpdb to improve page load speed UPDATED: UI Design for event edit page |
| * Property **svn:eol-style** set to   *`native`* * Property **svn:executable** set to   *`*`* | |
| **File size:** 31.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | /\* |
| [2](#L2) | \* EventON Back end scripts for general backend of wordpress |
| [3](#L3) | \* @version L 2.0 |
| [4](#L4) | \*/ |
| [5](#L5) | jQuery(document).ready(function($){ |
| [6](#L6) |  |
| [7](#L7) | const BB = $('body'); |
| [8](#L8) |  |
| [9](#L9) | // color picker |
| [10](#L10) | if( $.isFunction($.fn.ColorPicker) ) { |
| [11](#L11) | $('body').on('click','.colorselector',function(){ |
| [12](#L12) | var EE = $(this); |
| [13](#L13) | EE.ColorPicker({ |
| [14](#L14) | onBeforeShow: function(){ |
| [15](#L15) | $(this).ColorPickerSetColor( $(this).attr('hex')); |
| [16](#L16) | }, |
| [17](#L17) | onChange:function(hsb, hex, rgb){ |
| [18](#L18) | //console.log(hex+' '+rgb); |
| [19](#L19) | CIRCLE = $('body').find('.colorpicker\_on'); |
| [20](#L20) | CIRCLE.css({'backgroundColor': '#' + hex}).attr({'title': '#' + hex, 'hex':hex}); |
| [21](#L21) |  |
| [22](#L22) | obj\_input = CIRCLE.siblings('input.evocolorp\_val'); |
| [23](#L23) | obj\_input.attr({'value':hex}); |
| [24](#L24) |  |
| [25](#L25) | $('body').trigger('evo\_color\_select\_changed',[ hex, rgb]); |
| [26](#L26) | }, |
| [27](#L27) | onSubmit: function(hsb, hex, rgb, el) { |
| [28](#L28) | var obj\_input = $(el).siblings('input.evocolorp\_val'); |
| [29](#L29) |  |
| [30](#L30) | if($(el).hasClass('rgb')){ |
| [31](#L31) | $(el).siblings('input.rgb').attr({'value':rgb.r+','+rgb.g+','+rgb.b}); |
| [32](#L32) | } |
| [33](#L33) |  |
| [34](#L34) | obj\_input.attr({'value':hex}); |
| [35](#L35) |  |
| [36](#L36) | $(el).css('backgroundColor', '#' + hex); |
| [37](#L37) | $(el).attr({'title': '#' + hex, 'hex':hex}); |
| [38](#L38) | $(el).ColorPickerHide(); |
| [39](#L39) |  |
| [40](#L40) | $('body').find('.colorpicker\_on').removeClass('colorpicker\_on') |
| [41](#L41) | .trigger('evo\_color\_select\_submitted',[el, hex, rgb]); |
| [42](#L42) | }, |
| [43](#L43) | onHide: function(colpkr){ |
| [44](#L44) | $('body').find('.colorpicker\_on').removeClass('colorpicker\_on'); |
| [45](#L45) | } |
| [46](#L46) | }).bind('click',function(){ |
| [47](#L47) | $(this).addClass('colorpicker\_on'); |
| [48](#L48) | }); |
| [49](#L49) |  |
| [50](#L50) | if( !EE.hasClass('clrO')){ |
| [51](#L51) | EE.trigger('click').addClass('clrO'); |
| [52](#L52) | } |
| [53](#L53) | }); |
| [54](#L54) |  |
| [55](#L55) | $('.colorselector').ColorPicker({ |
| [56](#L56) | onBeforeShow: function(){ |
| [57](#L57) | $(this).addClass('clrO'); |
| [58](#L58) | $(this).ColorPickerSetColor( $(this).attr('hex')); |
| [59](#L59) | }, |
| [60](#L60) | onChange:function(hsb, hex, rgb){ |
| [61](#L61) | //console.log(hex+' '+rgb); |
| [62](#L62) | CIRCLE = $('body').find('.colorpicker\_on'); |
| [63](#L63) | CIRCLE.css({'backgroundColor': '#' + hex}).attr({'title': '#' + hex, 'hex':hex}); |
| [64](#L64) |  |
| [65](#L65) | obj\_input = CIRCLE.siblings('input.evocolorp\_val'); |
| [66](#L66) | obj\_input.attr({'value':hex}); |
| [67](#L67) |  |
| [68](#L68) | $('body').trigger('evo\_color\_select\_changed',[hex, rgb]); |
| [69](#L69) | }, |
| [70](#L70) | onSubmit: function(hsb, hex, rgb, el) { |
| [71](#L71) | var obj\_input = $(el).siblings('input.evocolorp\_val'); |
| [72](#L72) |  |
| [73](#L73) | if($(el).hasClass('rgb')){ |
| [74](#L74) | $(el).siblings('input.rgb').attr({'value':rgb.r+','+rgb.g+','+rgb.b}); |
| [75](#L75) | } |
| [76](#L76) |  |
| [77](#L77) | obj\_input.attr({'value':hex}); |
| [78](#L78) |  |
| [79](#L79) | $(el).css('backgroundColor', '#' + hex); |
| [80](#L80) | $(el).attr({'title': '#' + hex, 'hex':hex}); |
| [81](#L81) | $(el).ColorPickerHide(); |
| [82](#L82) |  |
| [83](#L83) | $('body').find('.colorpicker\_on').removeClass('colorpicker\_on').trigger('evo\_color\_select\_submitted',[el, hex, rgb]); |
| [84](#L84) | }, |
| [85](#L85) | onHide: function(colpkr){ |
| [86](#L86) | $('body').find('.colorpicker\_on').removeClass('colorpicker\_on'); |
| [87](#L87) | } |
| [88](#L88) | }).bind('click',function(){ |
| [89](#L89) | $(this).addClass('colorpicker\_on'); |
| [90](#L90) | }); |
| [91](#L91) | } |
| [92](#L92) |  |
| [93](#L93) | function colorPickMulti(itemid, cp){} |
| [94](#L94) |  |
| [95](#L95) | // get location cordinates |
| [96](#L96) | $('body').on('click','.evo\_auto\_gen\_latlng', function(event){ |
| [97](#L97) |  |
| [98](#L98) | event.preventDefault(); |
| [99](#L99) |  |
| [100](#L100) | // validation |
| [101](#L101) | var O = $(this); |
| [102](#L102) |  |
| [103](#L103) | $('body').remove('.evo\_auto\_gen\_latlng\_m'); |
| [104](#L104) |  |
| [105](#L105) | var add = $('body').find('input[name="location\_address"]').val(); |
| [106](#L106) | if(!add) |
| [107](#L107) | var add = $('body').find('input[name="term\_meta[location\_address]"]').val(); |
| [108](#L108) |  |
| [109](#L109) |  |
| [110](#L110) | if( !add){ |
| [111](#L111) | O.after('<p class="evo\_auto\_gen\_latlng\_m" style="padding-top:5px;">Address Missing</p>'); |
| [112](#L112) | return; |
| [113](#L113) | } |
| [114](#L114) |  |
| [115](#L115) | // run ajax |
| [116](#L116) | var D = { |
| [117](#L117) | 'action': 'eventon\_get\_latlng', |
| [118](#L118) | 'address': add |
| [119](#L119) | }; |
| [120](#L120) | $.ajax({ |
| [121](#L121) | beforeSend: function(){ |
| [122](#L122) | O.parent().addClass('evo\_loader'); |
| [123](#L123) | }, |
| [124](#L124) | url: evo\_admin\_ajax\_handle.ajaxurl, type: 'POST',dataType:'json', |
| [125](#L125) | data: D, |
| [126](#L126) | success:function(data){ |
| [127](#L127) |  |
| [128](#L128) | if( data.status == 'good'){ |
| [129](#L129) |  |
| [130](#L130) | $('body').find('input[name="location\_lat"]').val( data.lat ); |
| [131](#L131) | $('body').find('input[name="location\_lon"]').val( data.lng ); |
| [132](#L132) |  |
| [133](#L133) | $('body').find('input[name="term\_meta[location\_lat]"]').val( data.lat ); |
| [134](#L134) | $('body').find('input[name="term\_meta[location\_lon]"]').val( data.lng ); |
| [135](#L135) | }else{ |
| [136](#L136) | if( 'm' in data){ |
| [137](#L137) | O.after('<p class="evo\_auto\_gen\_latlng\_m" style="padding-top:5px;">'+ data.m +'</p>'); |
| [138](#L138) | } |
| [139](#L139) | } |
| [140](#L140) |  |
| [141](#L141) | },complete:function(){ |
| [142](#L142) | O.parent().removeClass('evo\_loader'); |
| [143](#L143) | } |
| [144](#L144) | }); |
| [145](#L145) | }); |
| [146](#L146) |  |
| [147](#L147) | // Side Panel for admin |
| [148](#L148) | // @since 4.5.2 @updated 4.5.2 |
| [149](#L149) | $('body').on('click','.evosp\_trigger', function(event){ |
| [150](#L150) | if( event !== undefined ){ |
| [151](#L151) | event.preventDefault(); |
| [152](#L152) | event.stopPropagation(); |
| [153](#L153) | } |
| [154](#L154) |  |
| [155](#L155) | const el = $(this); |
| [156](#L156) |  |
| [157](#L157) | el.addClass('evo\_sp\_trig\_on'); |
| [158](#L158) |  |
| [159](#L159) | // spv = side panel values |
| [160](#L160) | el.evo\_open\_sidepanel( el.data('d') , el.data('spv') ); |
| [161](#L161) | }); |
| [162](#L162) | $('body').on('click','.evosp\_close', function(event){ |
| [163](#L163) | if( event !== undefined ){ |
| [164](#L164) | event.preventDefault(); |
| [165](#L165) | event.stopPropagation(); |
| [166](#L166) | } |
| [167](#L167) |  |
| [168](#L168) | $(this).evo\_close\_sidepanel(  ); |
| [169](#L169) | }); |
| [170](#L170) |  |
| [171](#L171) | $.fn.evo\_open\_sidepanel = function(opt, spv){ |
| [172](#L172) | var defs = { |
| [173](#L173) | 'uid':'', |
| [174](#L174) | 'end':'admin', // admin or client |
| [175](#L175) | 'hide\_sp':false, |
| [176](#L176) | 'hide\_message':false, |
| [177](#L177) | 'title':'', |
| [178](#L178) | 'sp\_title':'', |
| [179](#L179) | 'content\_id':'',  // only to load dynamic content |
| [180](#L180) | 'content\_load\_delay':0, |
| [181](#L181) | 'ajax':'no', |
| [182](#L182) | 'ajax\_data':'', |
| [183](#L183) | 'other\_data':{} |
| [184](#L184) | } |
| [185](#L185) | var OO = $.extend({}, defs, opt); |
| [186](#L186) | //console.log(OO); |
| [187](#L187) |  |
| [188](#L188) | const SP = $('body').find('.evo\_sp'); |
| [189](#L189) |  |
| [190](#L190) | // structure |
| [191](#L191) | const load\_html = "<div class='evo\_loading\_bar\_holder h100'><div class='evo\_loading\_bar wid\_50 hi\_50'></div><div class='evo\_loading\_bar hi\_100'></div><div class='evo\_loading\_bar'></div><div class='evo\_loading\_bar'></div><div class='evo\_loading\_bar hi\_50'></div></div>"; |
| [192](#L192) |  |
| [193](#L193) | SP.html("<div class='evosp\_in'><span class='evosp\_close'><i class='fa fa-multiply'></i></span><div class='evosp\_head'>"+OO.sp\_title+"</div><div id='evops\_content' class='evosp\_body'>"+load\_html+"</div><div class='evosp\_foot'><p class='message'></p></div></div>"); |
| [194](#L194) |  |
| [195](#L195) | SP.addClass('show'); |
| [196](#L196) |  |
| [197](#L197) | const SP\_body = SP.find('.evosp\_body'); |
| [198](#L198) | const SP\_head = SP.find('.evosp\_head'); |
| [199](#L199) | const SP\_foot = SP.find('.evosp\_foot'); |
| [200](#L200) |  |
| [201](#L201) | // load using content |
| [202](#L202) | if( OO.content\_id != ''){ |
| [203](#L203) | if( OO.content\_load\_delay > 0){ |
| [204](#L204) | setTimeout(function(){ |
| [205](#L205) | SP\_body.html( BB.find('#'+ OO.content\_id ).html() ); |
| [206](#L206) | }, OO.content\_load\_delay ); |
| [207](#L207) | }else{ |
| [208](#L208) | SP\_body.html( BB.find('#'+ OO.content\_id ).html() ); |
| [209](#L209) | } |
| [210](#L210) |  |
| [211](#L211) | } |
| [212](#L212) |  |
| [213](#L213) | // run ajax to load content for the lightbox inside |
| [214](#L214) | if( OO.ajax == 'yes' && OO.ajax\_data != ''){ |
| [215](#L215) |  |
| [216](#L216) | var passing\_data = { |
| [217](#L217) | ajaxdata: OO.ajax\_data, |
| [218](#L218) | uid: OO.uid , |
| [219](#L219) | end: OO.end, |
| [220](#L220) | load\_new\_content: true, |
| [221](#L221) | load\_new\_content\_id: 'evops\_content', |
| [222](#L222) | lightbox\_loader:false |
| [223](#L223) | }; |
| [224](#L224) |  |
| [225](#L225) | SP.evo\_admin\_get\_ajax( passing\_data ); |
| [226](#L226) | } |
| [227](#L227) |  |
| [228](#L228) | // populate new content with spv values |
| [229](#L229) | if( spv != ''){ |
| [230](#L230) | BB.on('evo\_ajax\_success\_'+ OO.uid , function(){ |
| [231](#L231) | $('#evops\_content').find('input, select').each(function(){ |
| [232](#L232) | var fel = $(this); |
| [233](#L233) | $.each(spv,function(index, val){ |
| [234](#L234) | if( fel.attr('name') == index){ |
| [235](#L235) |  |
| [236](#L236) | if( val == 'no' || val == 'yes') fel.evo\_elm\_change\_yn\_btn( val ); |
| [237](#L237) | fel.val( val ); |
| [238](#L238) | } |
| [239](#L239) | }); |
| [240](#L240) | }); |
| [241](#L241) | }); |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) | BB.trigger('evo\_sp\_opened\_'+OO.uid, OO); |
| [245](#L245) | BB.trigger('evo\_sp\_opened', OO); |
| [246](#L246) | } |
| [247](#L247) |  |
| [248](#L248) | $.fn.evo\_savevals\_sidepanel = function(spv){ |
| [249](#L249) | const el = BB.find('.evo\_sp\_trig\_on'); |
| [250](#L250) |  |
| [251](#L251) | el.data('spv', spv); |
| [252](#L252) | el.removeClass('evo\_sp\_trig\_on'); |
| [253](#L253) | } |
| [254](#L254) |  |
| [255](#L255) | // CLOSE sidepanel |
| [256](#L256) | $.fn.evo\_close\_sidepanel = function(opt){ |
| [257](#L257) | SP = BB.find('.evo\_sp'); |
| [258](#L258) |  |
| [259](#L259) | var defaults = { 'delay':500}; |
| [260](#L260) |  |
| [261](#L261) | if( !(SP.hasClass('show')) ) return; |
| [262](#L262) |  |
| [263](#L263) | var OO = $.extend({}, defaults, opt); |
| [264](#L264) |  |
| [265](#L265) | SP.removeClass('show'); |
| [266](#L266) | setTimeout(function(){  SP.html('');    }, OO.delay ); |
| [267](#L267) | } |
| [268](#L268) |  |
| [269](#L269) | $.fn.evo\_showmsg\_sidepanel = function(){ |
| [270](#L270) | var defaults = { |
| [271](#L271) | 'type':'good', |
| [272](#L272) | 'message':'', |
| [273](#L273) | 'hide\_message': false,// hide message after some time pass time or false |
| [274](#L274) | 'hide\_sp': false, // hide lightbox after some time of false |
| [275](#L275) | }; var OO = $.extend({}, defaults, opt); |
| [276](#L276) |  |
| [277](#L277) | const SP = $('body').find('#evo\_sp'); |
| [278](#L278) |  |
| [279](#L279) | SP.find('.message').removeClass('bad good').addClass( OO.type ).html( OO.message ).fadeIn(); |
| [280](#L280) |  |
| [281](#L281) | if( OO.hide\_message ) setTimeout(function(){  SP.evo\_hidemsg\_sidepanel() }, OO.hide\_message ); |
| [282](#L282) |  |
| [283](#L283) | if( OO.hide\_lightbox ) SP.evo\_close\_sidepanel({ delay: OO.hide\_lightbox }); |
| [284](#L284) | } |
| [285](#L285) | $.fn.evo\_hidemsg\_sidepanel = function(opt){ |
| [286](#L286) | SP = this; |
| [287](#L287) | SP.find('p.message').hide(); |
| [288](#L288) | } |
| [289](#L289) |  |
| [290](#L290) | // LIGHTBOX function |
| [291](#L291) | // since 4.2 moved to funtctions |
| [292](#L292) |  |
| [293](#L293) |  |
| [294](#L294) | // lightbox hide |
| [295](#L295) | $('body').on('click',' .ajde\_close\_pop\_trig',function(){ |
| [296](#L296) | hide\_popupwindowbox( $(this).closest('.ajde\_admin\_lightbox') ); |
| [297](#L297) | }); |
| [298](#L298) | $('body').on('click',' .ajde\_close\_pop\_btn',function(){ |
| [299](#L299) | var obj = $(this).parent(); |
| [300](#L300) | hide\_popupwindowbox( $(this).closest('.ajde\_admin\_lightbox') ); |
| [301](#L301) | }); |
| [302](#L302) |  |
| [303](#L303) | $(document).mouseup( function(event){ |
| [304](#L304) | if( |
| [305](#L305) | $(event.target).hasClass('evo\_content\_inin') |
| [306](#L306) | ){ |
| [307](#L307) | CONTAIN =       $(event.target).find('.ajde\_popup'); |
| [308](#L308) | if(!CONTAIN.hasClass('nooutside')){ |
| [309](#L309) | CONTAIN.find('.ajde\_close\_pop\_btn').trigger('click'); |
| [310](#L310) | } |
| [311](#L311) | } |
| [312](#L312) | }); |
| [313](#L313) |  |
| [314](#L314) | $('body').on('click','.ajde\_close\_btn',function(){ |
| [315](#L315) | $(this).closest('.ajde\_close\_elm').hide(); |
| [316](#L316) | if( $(this).data('remove') !== undefined && $(this).data('remove') == 'yes') |
| [317](#L317) | $(this).closest('.ajde\_close\_elm').remove(); |
| [318](#L318) | }); |
| [319](#L319) |  |
| [320](#L320) | // trigger hide popup |
| [321](#L321) | $('body').on('evoadmin\_lightbox\_hide',function(event, lightboxclass, delay){ |
| [322](#L322) | lightboxELM = $('.ajde\_admin\_lightbox.'+lightboxclass); |
| [323](#L323) | hide\_popupwindowbox( lightboxELM , delay); |
| [324](#L324) | }); |
| [325](#L325) | function hide\_popupwindowbox( lightboxELM , delay){ |
| [326](#L326) | if(! lightboxELM.hasClass('show')) return false; |
| [327](#L327) | Close = (lightboxELM.parent().find('.ajde\_admin\_lightbox.show').length == 1)? true: false; |
| [328](#L328) |  |
| [329](#L329) | // if set to remove the lightbox HTML from dom |
| [330](#L330) | var remove\_from\_DOM = ( lightboxELM.find('.ajde\_close\_pop\_btn').hasClass('remove\_from\_DOM') )? true:false; |
| [331](#L331) |  |
| [332](#L332) | // hide delays |
| [333](#L333) | var hide\_delay = (delay === null || delay == '' || delay === undefined) ?  500 : parseInt(delay); |
| [334](#L334) |  |
| [335](#L335) | if( hide\_delay > 500){ |
| [336](#L336) | setTimeout( function(){ |
| [337](#L337) | lightboxELM.removeClass('show'); |
| [338](#L338) | }, ( hide\_delay - 500  ) ); |
| [339](#L339) | }else{ |
| [340](#L340) | lightboxELM.removeClass('show'); |
| [341](#L341) | } |
| [342](#L342) |  |
| [343](#L343) | setTimeout( function(){ |
| [344](#L344) | if(Close){ |
| [345](#L345) | $('body').removeClass('evo\_overflow'); |
| [346](#L346) | $('html').removeClass('evo\_overflow'); |
| [347](#L347) | } |
| [348](#L348) | // remove lightbox HTML from DOM |
| [349](#L349) | if( remove\_from\_DOM){ |
| [350](#L350) | lightboxELM.remove(); |
| [351](#L351) | } |
| [352](#L352) | }, hide\_delay); |
| [353](#L353) | } |
| [354](#L354) |  |
| [355](#L355) | // OPEN POPUP BOX |
| [356](#L356) | // everywhere in wp-admin |
| [357](#L357) | $('body').on('click','.ajde\_popup\_trig', function(){ |
| [358](#L358) | ajde\_popup\_open( $(this)); |
| [359](#L359) | }); |
| [360](#L360) |  |
| [361](#L361) | // Loading animations |
| [362](#L362) | $('body').on('evo\_show\_loading\_animation', function(event, lb\_class, animation\_type){ |
| [363](#L363) | show\_loading\_animation(lb\_class, animation\_type); |
| [364](#L364) | }); |
| [365](#L365) | function show\_loading\_animation(lb\_class, animation\_type){ |
| [366](#L366) | LB = $('.ajde\_admin\_lightbox.'+lb\_class).eq(0); |
| [367](#L367) |  |
| [368](#L368) | var \_animation\_type = (animation\_type !='' && animation\_type !== undefined) ? |
| [369](#L369) | animation\_type: 'initial'; |
| [370](#L370) |  |
| [371](#L371) | if( \_animation\_type == 'initial') |
| [372](#L372) | LB.find('.ajde\_popup\_text').html('<div class="evo\_loading\_bar\_holder"><div class="evo\_loading\_bar wid\_40 hi\_50"></div><div class="evo\_loading\_bar"></div><div class="evo\_loading\_bar"></div><div class="evo\_loading\_bar"></div><div class="evo\_loading\_bar wid\_25"></div></div>'); |
| [373](#L373) |  |
| [374](#L374) | if( \_animation\_type == 'saving') |
| [375](#L375) | LB.find('.ajde\_popup\_text').addClass('loading'); |
| [376](#L376) | } |
| [377](#L377) | $('body').on('evo\_hide\_loading\_animation', function(event, lb\_class){ |
| [378](#L378) | hide\_loading\_aniation(lb\_class); |
| [379](#L379) | }); |
| [380](#L380) | function hide\_loading\_aniation( lb\_class){ |
| [381](#L381) | LB = $('.ajde\_admin\_lightbox.'+lb\_class).eq(0); |
| [382](#L382) | LB.find('.ajde\_popup\_text').removeClass('loading'); |
| [383](#L383) | } |
| [384](#L384) |  |
| [385](#L385) | // popup open |
| [386](#L386) | // 2.6.9 |
| [387](#L387) | $('body').on('evo\_open\_admin\_lightbox', function(event, lb\_class){ |
| [388](#L388) | ajde\_open\_any\_lightbox(lb\_class); |
| [389](#L389) | }); |
| [390](#L390) |  |
| [391](#L391) | function ajde\_open\_any\_lightbox(lb\_class){ |
| [392](#L392) | LIGHTBOX = $('.ajde\_admin\_lightbox.'+lb\_class).eq(0); |
| [393](#L393) |  |
| [394](#L394) | // if already open |
| [395](#L395) | if(LIGHTBOX.is("visible")===true) return false; |
| [396](#L396) |  |
| [397](#L397) |  |
| [398](#L398) | POPUP = LIGHTBOX.find('.ajde\_popup'); |
| [399](#L399) | POPUP.find('.message').removeClass('bad good').hide(); |
| [400](#L400) |  |
| [401](#L401) | // open lightbox |
| [402](#L402) | LIGHTBOX.addClass('show'); |
| [403](#L403) | $('body').addClass('evo\_overflow'); |
| [404](#L404) | $('html').addClass('evo\_overflow'); |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | // @version 4.1 |
| [408](#L408) | $('body').on('evo\_open\_dynamic\_admin\_lightbox', function(event, obj, obj\_data){ |
| [409](#L409) | ajde\_popup\_open(obj, obj\_data); |
| [410](#L410) | }); |
| [411](#L411) |  |
| [412](#L412) | function ajde\_popup\_open(obj, obj\_data){ |
| [413](#L413) |  |
| [414](#L414) | OD = obj\_data !== undefined ? obj\_data : obj.data(); |
| [415](#L415) |  |
| [416](#L416) | var popc = obj.data('popc'); |
| [417](#L417) |  |
| [418](#L418) | // check if specific lightbox requested |
| [419](#L419) | var LIGHTBOX = ('popc' in OD && OD.popc !== false && OD.popc != '')? |
| [420](#L420) | $('.ajde\_admin\_lightbox.'+ OD.popc).eq(0):$('.ajde\_admin\_lightbox.regular').eq(0); |
| [421](#L421) |  |
| [422](#L422) | // create lightbox HTML and add to page |
| [423](#L423) | if( OD.popc == 'print\_lightbox'){ |
| [424](#L424) | lightbox\_class\_name = OD.lb\_cl\_nm; |
| [425](#L425) | lightbox\_size = 'lb\_sz' in OD ? OD.lb\_sz: ''; |
| [426](#L426) | $('.ajde\_admin\_lightboxes').append('<div id="" class="ajde\_admin\_lightbox '+lightbox\_class\_name+'"><div class="evo\_content\_in"><div class="evo\_content\_inin"><div class="ajde\_popup '+lightbox\_class\_name+' '+lightbox\_size+'"><div class="ajde\_header"><a class="ajde\_backbtn" style="display:none"><i class="fa fa-angle-left"></i></a><p id="ajde\_title" class="ajde\_lightbox\_title"></p><a class="ajde\_close\_pop\_btn remove\_from\_DOM">X</a></div><div class="ajde\_popup\_text"></div><p class="message"></p></div></div></div></div>'); |
| [427](#L427) |  |
| [428](#L428) | show\_loading\_animation( lightbox\_class\_name ); |
| [429](#L429) |  |
| [430](#L430) | LIGHTBOX = $('.ajde\_admin\_lightbox.'+lightbox\_class\_name); |
| [431](#L431) | } |
| [432](#L432) |  |
| [433](#L433) | var POPUP = LIGHTBOX.find('.ajde\_popup'); |
| [434](#L434) |  |
| [435](#L435) | // alter lightbox title |
| [436](#L436) | if( obj.data('t') !== undefined){ |
| [437](#L437) | LIGHTBOX.find('.ajde\_lightbox\_title').html( obj.data('t') ); |
| [438](#L438) | } |
| [439](#L439) |  |
| [440](#L440) | if(LIGHTBOX.is("visible")===true) return false; |
| [441](#L441) |  |
| [442](#L442) | // append textbox id to popup if given |
| [443](#L443) | if(obj.attr('data-textbox')!==''){ |
| [444](#L444) | POPUP.attr({'data-textbox':obj.attr('data-textbox')}); |
| [445](#L445) | } |
| [446](#L446) |  |
| [447](#L447) | // dynamic content within the site |
| [448](#L448) | var dynamic\_c = obj.attr('data-dynamic\_c'); |
| [449](#L449) | if(typeof dynamic\_c !== 'undefined' && dynamic\_c !== false){ |
| [450](#L450) |  |
| [451](#L451) | var content\_id = obj.attr('data-content\_id'); |
| [452](#L452) | var content = $('#'+content\_id).html(); |
| [453](#L453) |  |
| [454](#L454) | LIGHTBOX.find('.ajde\_popup\_text').html( content); |
| [455](#L455) | } |
| [456](#L456) |  |
| [457](#L457) | // run ajax to load content for the lightbox inside |
| [458](#L458) | if( obj.data('ajax') == 'yes' && obj.data('d') !== 'undefined'){ |
| [459](#L459) |  |
| [460](#L460) | var D = {}; |
| [461](#L461) | D = obj.data('d'); |
| [462](#L462) |  |
| [463](#L463) | $.ajax({ |
| [464](#L464) | beforeSend: function(){ }, |
| [465](#L465) | url:    evo\_admin\_ajax\_handle.ajaxurl, type: 'POST',dataType:'json', |
| [466](#L466) | data: D, |
| [467](#L467) | success:function(data){ |
| [468](#L468) | LIGHTBOX.find('.ajde\_popup\_text').html( data.html); |
| [469](#L469) | },complete:function(){  hide\_pop\_loading();     } |
| [470](#L470) | }); |
| [471](#L471) | } |
| [472](#L472) |  |
| [473](#L473) | // if content coming from a AJAX file |
| [474](#L474) | var attr\_ajax\_url = obj.attr('ajax\_url'); |
| [475](#L475) | if(typeof attr\_ajax\_url !== 'undefined' && attr\_ajax\_url !== false){ |
| [476](#L476) | $.ajax({ |
| [477](#L477) | beforeSend: function(){ |
| [478](#L478) | show\_pop\_loading(); |
| [479](#L479) | }, |
| [480](#L480) | url:attr\_ajax\_url, |
| [481](#L481) | success:function(data){ |
| [482](#L482) | LIGHTBOX.find('.ajde\_popup\_text').html( data); |
| [483](#L483) | },complete:function(){ |
| [484](#L484) | hide\_pop\_loading(); |
| [485](#L485) | } |
| [486](#L486) | }); |
| [487](#L487) | } |
| [488](#L488) |  |
| [489](#L489) | // change title if present |
| [490](#L490) | var poptitle = obj.attr('poptitle'); |
| [491](#L491) | if(typeof poptitle !== 'undefined' && poptitle !== false){ |
| [492](#L492) | LIGHTBOX.find('.ajde\_header p').html(poptitle); |
| [493](#L493) | } |
| [494](#L494) |  |
| [495](#L495) | POPUP.find('.message').removeClass('bad good').hide(); |
| [496](#L496) |  |
| [497](#L497) | // open lightbox |
| [498](#L498) | setTimeout( function(){ |
| [499](#L499) | LIGHTBOX.addClass('show'); |
| [500](#L500) | $('body').addClass('evo\_overflow'); |
| [501](#L501) | $('html').addClass('evo\_overflow'); |
| [502](#L502) | },300); |
| [503](#L503) |  |
| [504](#L504) | } |
| [505](#L505) |  |
| [506](#L506) | // popup lightbox functions |
| [507](#L507) | // lightbox messages |
| [508](#L508) | $('body').on('ajde\_lightbox\_show\_msg',function(event,message, boxclassname, type, donthide, hideMsg){ |
| [509](#L509) | LIGHTBOX = $('.'+boxclassname+'.ajde\_admin\_lightbox'); |
| [510](#L510) | type = (type!='bad')? 'good':'bad'; |
| [511](#L511) | LIGHTBOX.find('p.message').removeClass('bad good').addClass(type).html(message).fadeIn(); |
| [512](#L512) |  |
| [513](#L513) | // hide lightbox if good after 2 seconds |
| [514](#L514) | dh = (donthide !='' && donthide == false ) ? true: false; |
| [515](#L515) |  |
| [516](#L516) | if(type=='good' && dh)  setTimeout(function(){  hide\_popupwindowbox(LIGHTBOX) }, 2000); |
| [517](#L517) |  |
| [518](#L518) | // hide the message only after 2 seconds |
| [519](#L519) | if( hideMsg)    setTimeout(function(){  LIGHTBOX.find('p.message').hide() }, 2000); |
| [520](#L520) | }); |
| [521](#L521) |  |
| [522](#L522) | // hide lightbox message |
| [523](#L523) | $('body').on('ajde\_lightbox\_hide\_msg',function(event,boxclassname){ |
| [524](#L524) | LIGHTBOX = $('.'+boxclassname+'.ajde\_admin\_lightbox'); |
| [525](#L525) | LIGHTBOX.find('p.message').fadeOut(); |
| [526](#L526) | }); |
| [527](#L527) |  |
| [528](#L528) | function show\_pop\_bad\_msg(msg){ |
| [529](#L529) | $('.ajde\_popup').find('.message').removeClass('bad good').addClass('bad').html(msg).fadeIn(); |
| [530](#L530) | } |
| [531](#L531) | function show\_pop\_good\_msg(msg){ |
| [532](#L532) | $('.ajde\_popup').find('.message').removeClass('bad good').addClass('good').html(msg).fadeIn(); |
| [533](#L533) | } |
| [534](#L534) |  |
| [535](#L535) | function show\_pop\_loading(){ |
| [536](#L536) | $('.ajde\_popup\_text').css({'opacity':0.3}); |
| [537](#L537) | $('#ajde\_loading').fadeIn(); |
| [538](#L538) | } |
| [539](#L539) | function hide\_pop\_loading(){ |
| [540](#L540) | $('.ajde\_popup\_text').css({'opacity':1}); |
| [541](#L541) | $('#ajde\_loading').fadeOut(20); |
| [542](#L542) | } |
| [543](#L543) |  |
| [544](#L544) |  |
| [545](#L545) | // TAXONOMY term form, NEW/ EDIT/ DELETE |
| [546](#L546) | $('body') |
| [547](#L547) |  |
| [548](#L548) | // get term list |
| [549](#L549) | .on('evo\_ajax\_success\_evo\_get\_tax\_list',function(event, OO, data){ |
| [550](#L550) | if(data.status=='good'){ |
| [551](#L551) | $('.evo\_config\_term').find('select.field').select2(); |
| [552](#L552) | } |
| [553](#L553) | }) |
| [554](#L554) | // save term edit settings |
| [555](#L555) | .on('evo\_ajax\_success\_evo\_save\_tax\_edit\_settings', function (event, OO, data){ |
| [556](#L556) | if(data.status=='good'){ |
| [557](#L557) | $('.evo\_singular\_tax\_for\_event.'+ data.tax ).html(data.htmldata); |
| [558](#L558) |  |
| [559](#L559) | // when setting event location |
| [560](#L560) | if(data.tax == 'event\_location' && evo\_admin\_ajax\_handle.setting\_evo\_gen\_map){ |
| [561](#L561) | var inp = $('body').find('input[name="evcal\_gmap\_gen"]'); |
| [562](#L562) | if( inp.val() == 'no') inp.siblings('span').trigger('click'); |
| [563](#L563) | } |
| [564](#L564) | } |
| [565](#L565) | }) |
| [566](#L566) | // save term from list |
| [567](#L567) | .on('evo\_ajax\_success\_evo\_save\_term\_list\_item', function (event, OO, data){ |
| [568](#L568) | if(data.status=='good'){ |
| [569](#L569) | $('.evo\_singular\_tax\_for\_event.'+ data.tax ).html(data.htmldata); |
| [570](#L570) |  |
| [571](#L571) | // when setting event location |
| [572](#L572) | if(data.tax == 'event\_location' && evo\_admin\_ajax\_handle.setting\_evo\_gen\_map){ |
| [573](#L573) | var inp = $('body').find('input[name="evcal\_gmap\_gen"]'); |
| [574](#L574) | if( inp.val() == 'no') inp.siblings('span').trigger('click'); |
| [575](#L575) | } |
| [576](#L576) | } |
| [577](#L577) | }) |
| [578](#L578) |  |
| [579](#L579) | // remove tax |
| [580](#L580) | .on('evo\_ajax\_beforesend\_evo\_remove\_tax\_term', function (event, OO){ |
| [581](#L581) | $('.evo\_singular\_tax\_for\_event.'+ OO.ajaxdata.tax ).addClass('evoloading'); |
| [582](#L582) |  |
| [583](#L583) | }) |
| [584](#L584) | .on('evo\_ajax\_success\_evo\_remove\_tax\_term', function (event, OO, data){ |
| [585](#L585) | if(data.status=='good'){ |
| [586](#L586) | $('.evo\_singular\_tax\_for\_event.'+ data.tax ).html(data.htmldata).removeClass('evoloading');; |
| [587](#L587) | } |
| [588](#L588) | }) |
| [589](#L589) | ; |
| [590](#L590) |  |
| [591](#L591) | // Upload custom images to eventon custom image meta fields |
| [592](#L592) | var file\_frame, |
| [593](#L593) | BOX; |
| [594](#L594) |  |
| [595](#L595) | $('body').on('click','.custom\_upload\_image\_button',function(event) { |
| [596](#L596) | var obj = jQuery(this); |
| [597](#L597) | BOX = obj.closest('.evo\_metafield\_image'); |
| [598](#L598) |  |
| [599](#L599) | IMG\_URL = ''; |
| [600](#L600) |  |
| [601](#L601) | // choose image |
| [602](#L602) | if(obj.hasClass('chooseimg')){ |
| [603](#L603) |  |
| [604](#L604) | event.preventDefault(); |
| [605](#L605) |  |
| [606](#L606) | // If the media frame already exists, reopen it. |
| [607](#L607) | if ( file\_frame ) { |
| [608](#L608) | file\_frame.open(); |
| [609](#L609) | return; |
| [610](#L610) | } |
| [611](#L611) | // Create the media frame. |
| [612](#L612) | file\_frame = wp.media.frames.downloadable\_file = wp.media({ |
| [613](#L613) | title: 'Choose an Image', |
| [614](#L614) | button: {text: 'Use Image',}, |
| [615](#L615) | multiple: false |
| [616](#L616) | }); |
| [617](#L617) |  |
| [618](#L618) | // When an image is selected, run a callback. |
| [619](#L619) | file\_frame.on( 'select', function() { |
| [620](#L620) | attachment = file\_frame.state().get('selection').first().toJSON(); |
| [621](#L621) |  |
| [622](#L622) | BOX.find('.evo\_meta\_img').val( attachment.id ); |
| [623](#L623) | BOX.find('.image\_src img').attr('src', attachment.url ).fadeIn(); |
| [624](#L624) | var old\_text = obj.attr('value'); |
| [625](#L625) | var new\_text = obj.data('txt'); |
| [626](#L626) |  |
| [627](#L627) | obj.attr({'value': new\_text, 'data-txt': old\_text, 'class': 'custom\_upload\_image\_button button removeimg'}); |
| [628](#L628) | }); |
| [629](#L629) |  |
| [630](#L630) | // Finally, open the modal. |
| [631](#L631) | file\_frame.open(); |
| [632](#L632) |  |
| [633](#L633) | }else{ |
| [634](#L634) |  |
| [635](#L635) | BOX.find('.evo\_meta\_img').val( '' ); |
| [636](#L636) | BOX.find('.image\_src img').fadeOut(function(){ |
| [637](#L637) | $(this).attr('src', '' ); |
| [638](#L638) | }); |
| [639](#L639) | var old\_text = obj.attr('value'); |
| [640](#L640) | var new\_text = obj.attr('data-txt'); |
| [641](#L641) |  |
| [642](#L642) | obj.attr({'value': new\_text, 'data-txt': old\_text, 'class': 'custom\_upload\_image\_button button chooseimg'}); |
| [643](#L643) |  |
| [644](#L644) | return false; |
| [645](#L645) | } |
| [646](#L646) | }); |
| [647](#L647) |  |
| [648](#L648) | // Add new tag field clearing after |
| [649](#L649) | $('#addtag #submit').click(function () { |
| [650](#L650) | // Look for a div WordPress produces for an invalid form element |
| [651](#L651) | if (!$('#addtag .form-invalid').length) { |
| [652](#L652) | var IF = $('#addtag').find('.evo\_metafield\_image'); |
| [653](#L653) |  |
| [654](#L654) | var INP = IF.find('.custom\_upload\_image\_button'); |
| [655](#L655) |  |
| [656](#L656) | var old\_text = INP.attr('value'); |
| [657](#L657) | var new\_text = INP.attr('data-txt'); |
| [658](#L658) |  |
| [659](#L659) |  |
| [660](#L660) | INP.removeClass('removeimg').addClass('chooseimg').attr({'value': new\_text, 'data-txt': old\_text}); |
| [661](#L661) | IF.find('img').fadeOut(function(){ |
| [662](#L662) | $(this).attr('src', '' ); |
| [663](#L663) | }); |
| [664](#L664) |  |
| [665](#L665) | } |
| [666](#L666) | }); |
| [667](#L667) |  |
| [668](#L668) | // settings |
| [669](#L669) | // themes section |
| [670](#L670) | $('.evo\_theme\_selection select').on('change',function(){ |
| [671](#L671) | var theme = $(this).val(); |
| [672](#L672) |  |
| [673](#L673) | // switch to default |
| [674](#L674) | if(theme =='default'){ |
| [675](#L675) | $('.colorselector ').each(function(){ |
| [676](#L676) | var item = $(this).siblings('input'); |
| [677](#L677) | item.attr({'value': item.attr('default') }); |
| [678](#L678) | $(this).attr({'style':'background-color:#'+item.attr('default'), 'hex':item.attr('default')}); |
| [679](#L679) | }); |
| [680](#L680) | $('.evo\_theme').find('span').each(function(){ |
| [681](#L681) | $(this).attr({'style':'background-color:#'+ $(this).attr('data-default')}); |
| [682](#L682) | }); |
| [683](#L683) |  |
| [684](#L684) | }else{ |
| [685](#L685) | themeSel = JSON.parse( $('#evo\_themejson').html()); |
| [686](#L686) |  |
| [687](#L687) | // each theme array |
| [688](#L688) | $.each(themeSel, function(i, item){ |
| [689](#L689) | if(item.name== theme){ |
| [690](#L690) | $.each(item.content, function(key, value){ |
| [691](#L691) | var thisItem = $('body').find('input[name='+key+']'); |
| [692](#L692) | thisItem.val(value); |
| [693](#L693) |  |
| [694](#L694) | if(!value.includes(',')) |
| [695](#L695) | thisItem.siblings('span.colorselector').attr({'style':'background-color:#'+value, 'hex':value}); |
| [696](#L696) |  |
| [697](#L697) | $('.evo\_theme').find('span[name='+key+']').attr({'style':'background-color:#'+value}); |
| [698](#L698) | }); |
| [699](#L699) | } |
| [700](#L700) | }); |
| [701](#L701) |  |
| [702](#L702) | } |
| [703](#L703) | }); |
| [704](#L704) |  |
| [705](#L705) | // Export settings |
| [706](#L706) | $('body').on('evo\_data\_uploader\_submitted', function(event, reader\_event, msg\_elm, upload\_box){ |
| [707](#L707) |  |
| [708](#L708) | if( $(upload\_box).data('id') != 'evo\_settings\_upload') return; |
| [709](#L709) |  |
| [710](#L710) | var jsonData = reader\_event.target.result ; |
| [711](#L711) |  |
| [712](#L712) | $.ajax({ |
| [713](#L713) | beforeSend: function(){ }, |
| [714](#L714) | type: 'POST', |
| [715](#L715) | url:evo\_admin\_ajax\_handle.ajaxurl, |
| [716](#L716) | data: { |
| [717](#L717) | action:'eventon\_import\_settings', |
| [718](#L718) | nonce: evo\_admin\_ajax\_handle.postnonce, |
| [719](#L719) | jsondata: $.parseJSON( jsonData) |
| [720](#L720) | }, |
| [721](#L721) | dataType:'json', |
| [722](#L722) | success:function(data){ |
| [723](#L723) | msg\_elm.html(data.msg); |
| [724](#L724) | },complete:function(){  } |
| [725](#L725) | }); |
| [726](#L726) | }); |
| [727](#L727) |  |
| [728](#L728) | // settings event card designer |
| [729](#L729) | // EventON v4.0 |
| [730](#L730) | $.fn.evo\_card\_designer = function (options) { |
| [731](#L731) | var designer = $(this); |
| [732](#L732) | var fields = $(designer).find('.evocard\_design\_holder'); |
| [733](#L733) | var selector = $(designer).find('#evo\_card\_field\_selector'); |
| [734](#L734) | var def\_color = designer.data('dc'); |
| [735](#L735) |  |
| [736](#L736) | var init = function(){ |
| [737](#L737) | interactions(); |
| [738](#L738) | field\_selector(); |
| [739](#L739) |  |
| [740](#L740) | if( fields.length> 0 ){ |
| [741](#L741) | fields.sortable({ |
| [742](#L742) | update: function(e, ul){ |
| [743](#L743) | run\_row\_numbering(); |
| [744](#L744) | } |
| [745](#L745) | }); |
| [746](#L746) | } |
| [747](#L747) |  |
| [748](#L748) | } |
| [749](#L749) |  |
| [750](#L750) | var interactions = function(){ |
| [751](#L751) | // new row |
| [752](#L752) | $('.ecd\_add\_rows').on('click',function(){ |
| [753](#L753) | var count = parseInt($(this).data('c')); |
| [754](#L754) | var holder\_boxes = parseInt($(this).data('hc')); |
| [755](#L755) | var holder\_location = $(this).data('hl'); |
| [756](#L756) |  |
| [757](#L757) | html = "<p class='ecd\_row "+ ( holder\_location ) +"' data-r=''><span class='ecd\_row\_in'>"; |
| [758](#L758) |  |
| [759](#L759) | // normal boxes |
| [760](#L760) | for (var i = 1; i <= count; i++) { |
| [761](#L761) | html += "<span class='ecd\_row\_box' data-b='"+ i +"'><span class='ecd\_set\_field'>+ Set Field</span></span>"; |
| [762](#L762) | } |
| [763](#L763) |  |
| [764](#L764) | // before after boxes count |
| [765](#L765) | if( holder\_boxes ){ |
| [766](#L766) | html += "<span class='ecd\_row\_box\_h'>"; |
| [767](#L767) | for (var i = 1; i <= holder\_boxes; i++) { |
| [768](#L768) | html += "<span class='ecd\_row\_box' data-b='"+ holder\_location + i +"'><span class='ecd\_set\_field'>+ Set Field</span></span>"; |
| [769](#L769) | } |
| [770](#L770) | html += "</span>"; |
| [771](#L771) | } |
| [772](#L772) |  |
| [773](#L773) |  |
| [774](#L774) | html +="</span><i class='fa fa-minus-circle ecd\_del\_row'></i></p>"; |
| [775](#L775) |  |
| [776](#L776) | $(fields).append( html ); |
| [777](#L777) | run\_row\_numbering(); |
| [778](#L778) | }); |
| [779](#L779) |  |
| [780](#L780) | // remove row |
| [781](#L781) | $(designer).on('click','.ecd\_del\_row', function(){ |
| [782](#L782) | // items in row |
| [783](#L783) | $(this).parent().find('.ecd\_row\_box').each(function(){ |
| [784](#L784) | if( $(this).data('n') !== undefined && $(this).data('n') != ''){ |
| [785](#L785) | add\_item\_to\_selector( $(this).data('n') , $(this).find('em').html() ); |
| [786](#L786) | } |
| [787](#L787) | }); |
| [788](#L788) |  |
| [789](#L789) | // remove row |
| [790](#L790) | $(this).closest('.ecd\_row').remove(); |
| [791](#L791) | run\_row\_numbering(); |
| [792](#L792) | }); |
| [793](#L793) |  |
| [794](#L794) | // remove a box |
| [795](#L795) | $(designer).on('click','.ecdad\_act .fa-minus-circle',function(){ |
| [796](#L796) | var row = $(this).closest('.ecd\_row'); |
| [797](#L797) | var box = $(this).closest('.ecd\_row\_box'); |
| [798](#L798) |  |
| [799](#L799) | add\_item\_to\_selector( box.data('n') , box.find('em').html() ); |
| [800](#L800) |  |
| [801](#L801) | box.html( "<span class='ecd\_set\_field'>+ Set Field</span>" ) |
| [802](#L802) | .data('n','').attr('data-n', '' ) |
| [803](#L803) | .data('h','').attr('data-h', '' ) |
| [804](#L804) | .data('c','').attr('data-c', '' ); |
| [805](#L805) | run\_row\_numbering(); |
| [806](#L806) | }); |
| [807](#L807) |  |
| [808](#L808) | // move row up down |
| [809](#L809) | $(designer).on('click','.fa-chevron-circle-up',function(){ |
| [810](#L810) | var RR = $(this).closest('.ecd\_row'); |
| [811](#L811) | PR = RR.prev(); |
| [812](#L812) | RR.insertBefore( PR ); |
| [813](#L813) | run\_row\_numbering(); |
| [814](#L814) | }); |
| [815](#L815) | $(designer).on('click','.fa-chevron-circle-down',function(){ |
| [816](#L816) | var RR = $(this).closest('.ecd\_row'); |
| [817](#L817) | PR = RR.next(); |
| [818](#L818) | RR.insertAfter( PR ); |
| [819](#L819) | run\_row\_numbering(); |
| [820](#L820) | }); |
| [821](#L821) |  |
| [822](#L822) | // toggle visibility |
| [823](#L823) | $(designer).on('click','.fa.vis',function(){ |
| [824](#L824) | if($(this).hasClass('fa-eye')){ |
| [825](#L825) | $(this).removeClass('fa-eye').addClass('fa-eye-slash'); |
| [826](#L826) | $(this).closest('.ecd\_row\_box').data('h','y').addClass('hidden'); |
| [827](#L827) | }else{ |
| [828](#L828) | $(this).removeClass('fa-eye-slash').addClass('fa-eye'); |
| [829](#L829) | $(this).closest('.ecd\_row\_box').data('h','').removeClass('hidden'); |
| [830](#L830) | } |
| [831](#L831) | run\_row\_numbering(); |
| [832](#L832) | }); |
| [833](#L833) |  |
| [834](#L834) | // color picker |
| [835](#L835) | $('body').on('evo\_color\_select\_submitted', function(event, el, hex, rgb){ |
| [836](#L836) | //console.log(hex); |
| [837](#L837) | if( $(el).hasClass('clr')){ |
| [838](#L838) | $(el).closest('.ecd\_row\_box').data('c', hex).attr('data-c', hex); |
| [839](#L839) | run\_row\_numbering(); |
| [840](#L840) | } |
| [841](#L841) | }); |
| [842](#L842) | $('body').on('evo\_color\_select\_changed',function(event, hex, rgb){ |
| [843](#L843) | var cO = $('body').find('.colorpicker\_on'); |
| [844](#L844) | if( cO.hasClass('clr')){ |
| [845](#L845) | if( hex != def\_color ) cO.siblings('.clr\_reset').removeClass('dn'); |
| [846](#L846) |  |
| [847](#L847) | cO.closest('.ecd\_row\_box').data('c', hex).attr('data-c', hex); |
| [848](#L848) | run\_row\_numbering(); |
| [849](#L849) | } |
| [850](#L850) | }); |
| [851](#L851) | // reset to default color |
| [852](#L852) | $(designer).on('click','.clr\_reset',function(){ |
| [853](#L853) | $(this).siblings('.clr') |
| [854](#L854) | .css('background-color', '#'+ def\_color) |
| [855](#L855) | .attr('hex', def\_color); |
| [856](#L856) | $(this).closest('.ecd\_row\_box').data('c', def\_color) |
| [857](#L857) | .attr('data-c', def\_color); |
| [858](#L858) | $(this).addClass('dn'); |
| [859](#L859) | run\_row\_numbering(); |
| [860](#L860) | }); |
| [861](#L861) |  |
| [862](#L862) | } |
| [863](#L863) |  |
| [864](#L864) |  |
| [865](#L865) | var field\_selector = function(){ |
| [866](#L866) | $(designer).on('click','.ecd\_set\_field', function(){ |
| [867](#L867) | $(designer).find('.adding\_field').removeClass('adding\_field'); |
| [868](#L868) | $(this).parent().addClass('adding\_field'); |
| [869](#L869) | selector.addClass('focus'); |
| [870](#L870) | }); |
| [871](#L871) | // selector > designer |
| [872](#L872) | $('#evo\_card\_field\_selector\_f').on('click','span',function(){ |
| [873](#L873) | if( !selector.hasClass('focus') ) return; |
| [874](#L874) |  |
| [875](#L875) | var html = "<span class='ecd\_act1'><i class='vis fa fa-eye'></i><span class='colorselector clr' hex='"+def\_color+"' style='background-color:#"+def\_color+"' title=''></span> <span class='clr\_reset dn' data-hex='"+def\_color+"' style='background-color:#"+def\_color+"' title=''></span> </span>"+ |
| [876](#L876) | "<em>"+ $(this).html() +"</em><span class='ecdad\_act'><i class='fa fa-minus-circle'></i></span>"; |
| [877](#L877) |  |
| [878](#L878) | var box = $(designer).find('.adding\_field'); |
| [879](#L879) |  |
| [880](#L880) | // append to the designer box |
| [881](#L881) | box.html( html ) |
| [882](#L882) | .data('n', $(this).data('n') ) |
| [883](#L883) | .attr('data-n', $(this).data('n') ) |
| [884](#L884) | .removeClass('adding\_field'); |
| [885](#L885) |  |
| [886](#L886) | // remove from selector and hide selector, show no fields message if |
| [887](#L887) | $(this).remove(); |
| [888](#L888) |  |
| [889](#L889) | if( $('#evo\_card\_field\_selector\_f').find('span').length == 0){ |
| [890](#L890) | selector.find('.nothing').show(); |
| [891](#L891) | } |
| [892](#L892) | selector.removeClass('focus'); |
| [893](#L893) |  |
| [894](#L894) | // load new fields |
| [895](#L895) | run\_row\_numbering(); |
| [896](#L896) | }); |
| [897](#L897) |  |
| [898](#L898) | // cancel selector |
| [899](#L899) | $('#evo\_card\_field\_selector\_c').on('click',function(){ |
| [900](#L900) | selector.removeClass('focus'); |
| [901](#L901) | $(designer).find('.adding\_field').removeClass('adding\_field'); |
| [902](#L902) | }); |
| [903](#L903) | } |
| [904](#L904) |  |
| [905](#L905) | var add\_item\_to\_selector = function(f, n){ |
| [906](#L906) | var HH = $('#evo\_card\_field\_selector\_f').html(); |
| [907](#L907) | HH +=  "<span data-n='"+ f +"'>"+ n +"</span>"; |
| [908](#L908) | $('#evo\_card\_field\_selector\_f').html( HH ); |
| [909](#L909) |  |
| [910](#L910) | // check if selector content to be shown |
| [911](#L911) | if( $('#evo\_card\_field\_selector\_f').html() == ''){ |
| [912](#L912) | selector.find('.nothing').show(); |
| [913](#L913) | }else{ |
| [914](#L914) | selector.find('.nothing').hide(); |
| [915](#L915) | } |
| [916](#L916) | } |
| [917](#L917) |  |
| [918](#L918) | var run\_row\_numbering = function(){ |
| [919](#L919) | var count = 1; |
| [920](#L920) | var ecl = {}; |
| [921](#L921) |  |
| [922](#L922) | var def\_color = designer.data('dc'); |
| [923](#L923) |  |
| [924](#L924) | $(designer).find('.ecd\_row').each(function(){ |
| [925](#L925) | $(this).data('r', count).attr('data-r', count); |
| [926](#L926) |  |
| [927](#L927) | ecl[ count ] = {}; |
| [928](#L928) | $(this).find('.ecd\_row\_box').each(function(){ |
| [929](#L929) | ecl[ count ][ $(this).data('b') ] = { |
| [930](#L930) | 'n': $(this).data('n'), |
| [931](#L931) | 'h': $(this).data('h'), |
| [932](#L932) | 'c': ( def\_color == $(this).data('c') ? '' : $(this).data('c')) |
| [933](#L933) | }; |
| [934](#L934) | }); |
| [935](#L935) |  |
| [936](#L936) | count++; |
| [937](#L937) | }); |
| [938](#L938) |  |
| [939](#L939) | $('#evo\_card\_fields').val( JSON.stringify(ecl) ); |
| [940](#L940) | } |
| [941](#L941) |  |
| [942](#L942) | init(); |
| [943](#L943) | }; |
| [944](#L944) |  |
| [945](#L945) | $('.evo\_card\_designer').evo\_card\_designer(); |
| [946](#L946) |  |
| [947](#L947) | // Settings > Support |
| [948](#L948) | $('.evotrouble\_left').on('click','h5',function(){ |
| [949](#L949) | $(this).next('p').toggle(); |
| [950](#L950) | }); |
| [951](#L951) |  |
| [952](#L952) | // LANGUAGE SETTINGS |
| [953](#L953) | // language tab |
| [954](#L954) | $('.eventon\_cl\_input').focus(function(){ |
| [955](#L955) | $(this).parent().addClass('onfocus'); |
| [956](#L956) | }); |
| [957](#L957) | $('.eventon\_cl\_input').blur(function(){ |
| [958](#L958) | $(this).parent().removeClass('onfocus'); |
| [959](#L959) | }); |
| [960](#L960) |  |
| [961](#L961) | // change language |
| [962](#L962) | $('#evo\_lang\_selection').change(function(){ |
| [963](#L963) | var val = $(this).val(); |
| [964](#L964) | var url = $(this).data('url'); |
| [965](#L965) |  |
| [966](#L966) | window.location.replace(url+'?page=eventon-lang&lang='+val); |
| [967](#L967) | }); |
| [968](#L968) |  |
| [969](#L969) | // duplicate editing |
| [970](#L970) | if( $('body').find('.eventon\_cl\_input').length>0){ |
| [971](#L971) | $('.eventon\_cl\_input').on('change paste keyup',function(){ |
| [972](#L972) | const n = $(this).data('n'); |
| [973](#L973) | $('body').find('.eventon\_cl\_input.'+ n).val( $(this).val() ); |
| [974](#L974) | }); |
| [975](#L975) | } |
| [976](#L976) |  |
| [977](#L977) | // toggeling language subheaders |
| [978](#L978) | $('.evo\_settings\_toghead').on('click',function(){ |
| [979](#L979) | $(this).next('.evo\_settings\_togbox').toggle(); |
| [980](#L980) | $(this).toggleClass('open'); |
| [981](#L981) | }); |
| [982](#L982) |  |
| [983](#L983) | // search |
| [984](#L984) | $('.evo\_lang\_search\_in').on('change keyup paste',function(){ |
| [985](#L985) | var searchval = $(this).val(); |
| [986](#L986) |  |
| [987](#L987) | $('#evcal\_2').find('.eventon\_cl\_input').each(function(){ |
| [988](#L988) | line = $(this).closest('.eventon\_custom\_lang\_line '); |
| [989](#L989) | box = $(this).closest('.evo\_settings\_togbox'); |
| [990](#L990) | bar = box.siblings('.evo\_settings\_toghead'); |
| [991](#L991) |  |
| [992](#L992) | if( searchval == ''){ |
| [993](#L993) | line.show(); |
| [994](#L994) | }else{ |
| [995](#L995) | line.hide(); |
| [996](#L996) | var thistext = $(this).data('n'); |
| [997](#L997) | if( thistext.indexOf( searchval ) != -1 ){ |
| [998](#L998) | line.show(); |
| [999](#L999) | box.toggle(); |
| [1000](#L1000) | bar.toggleClass('open'); |
| [1001](#L1001) | } |
| [1002](#L1002) | console.log(thistext+' '+searchval); |
| [1003](#L1003) | } |
| [1004](#L1004) | }); |
| [1005](#L1005) | }); |
| [1006](#L1006) |  |
| [1007](#L1007) | // export language |
| [1008](#L1008) | $('body').on('click','.evo\_lang\_export\_btn', function(){ |
| [1009](#L1009) | string = {}; |
| [1010](#L1010) | var tmpArr = []; |
| [1011](#L1011) | var tmpStr = ''; |
| [1012](#L1012) | var csvData = []; |
| [1013](#L1013) |  |
| [1014](#L1014) | type = $(this).data('t'); |
| [1015](#L1015) |  |
| [1016](#L1016) | if(type == 'var'){ |
| [1017](#L1017) | $('#evcal\_2').find('input').each(function(){ |
| [1018](#L1018) | csvData.push( $(this).attr('name')+','+ $(this).val()); |
| [1019](#L1019) | }); |
| [1020](#L1020) | }else{ |
| [1021](#L1021) | $('#evcal\_2').find('input').each(function(){ |
| [1022](#L1022) | field = $(this).attr('for'); |
| [1023](#L1023) | if( field === undefined) field = $(this).attr('name'); |
| [1024](#L1024) | csvData.push( field +','+ $(this).val()); |
| [1025](#L1025) | }); |
| [1026](#L1026) | } |
| [1027](#L1027) |  |
| [1028](#L1028) | var output = csvData.join('\n'); |
| [1029](#L1029) | var uri = 'data:application/csv;charset=UTF-8,' + encodeURIComponent(output); |
| [1030](#L1030) | //window.open(uri); |
| [1031](#L1031) | $(this).attr({ |
| [1032](#L1032) | 'download':'evo\_lang\_'+$('#evo\_lang\_selection').val()+'.csv', |
| [1033](#L1033) | 'href':uri, |
| [1034](#L1034) | 'target':'\_blank' |
| [1035](#L1035) | }); |
| [1036](#L1036) | }); |
| [1037](#L1037) |  |
| [1038](#L1038) | // import language |
| [1039](#L1039) | $('body').on('evo\_data\_uploader\_submitted', function(event, reader\_event, msg\_elm, upload\_box){ |
| [1040](#L1040) |  |
| [1041](#L1041) | if( $(upload\_box).data('id') != 'evo\_language\_upload') return; |
| [1042](#L1042) |  |
| [1043](#L1043) | var csvData = reader\_event.target.result; |
| [1044](#L1044) |  |
| [1045](#L1045) | var allTextLines = csvData.split(/\r\n|\n/); |
| [1046](#L1046) | //console.log(allTextLines[0]); |
| [1047](#L1047) | for (var i=0; i<allTextLines.length; i++) { |
| [1048](#L1048) | var data = allTextLines[i].split(','); |
| [1049](#L1049) |  |
| [1050](#L1050) | // update new values |
| [1051](#L1051) |  |
| [1052](#L1052) | $('#evcal\_2').find('input[name="'+data[0]+'"]').val(data[1]); // for vars |
| [1053](#L1053) | $('#evcal\_2').find('input[for="'+data[0]+'"]').val(data[1]); // for text strings |
| [1054](#L1054) |  |
| [1055](#L1055) | msg\_elm.html('Updating language values.'); |
| [1056](#L1056) | } |
| [1057](#L1057) |  |
| [1058](#L1058) | msg\_elm.html('Language fields updated. Please save changes.'); |
| [1059](#L1059) | }); |
| [1060](#L1060) |  |
| [1061](#L1061) |  |
| [1062](#L1062) |  |
| [1063](#L1063) | function processData(allText) { |
| [1064](#L1064) | var allTextLines = allText.split(/\r\n|\n/); |
| [1065](#L1065) | var headers = allTextLines[0].split(','); |
| [1066](#L1066) | var lines = []; |
| [1067](#L1067) |  |
| [1068](#L1068) | for (var i=1; i<allTextLines.length; i++) { |
| [1069](#L1069) | var data = allTextLines[i].split(','); |
| [1070](#L1070) | if (data.length == headers.length) { |
| [1071](#L1071) |  |
| [1072](#L1072) | var tarr = []; |
| [1073](#L1073) | for (var j=0; j<headers.length; j++) { |
| [1074](#L1074) | tarr.push(headers[j]+":"+data[j]); |
| [1075](#L1075) | } |
| [1076](#L1076) | lines.push(tarr); |
| [1077](#L1077) | } |
| [1078](#L1078) | } |
| [1079](#L1079) | console.log(lines); |
| [1080](#L1080) | } |
| [1081](#L1081) |  |
| [1082](#L1082) | }); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/eventon-lite/trunk/assets/js/admin/wp_admin.js?format=txt)
* [Original Format](/export/3220385/eventon-lite/trunk/assets/js/admin/wp_admin.js)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

