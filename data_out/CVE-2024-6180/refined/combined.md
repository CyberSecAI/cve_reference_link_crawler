=== Content from plugins.trac.wordpress.org_6761f329_20250110_183158.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Feventon-lite%2Ftrunk%2Fassets%2Fjs%2Fadmin%2Fwp_admin.js)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/eventon-lite/trunk/assets/js/admin/wp_admin.js?rev=2978856 "Revision 2978856")
* Next Revision →
* [Blame](/browser/eventon-lite/trunk/assets/js/admin/wp_admin.js?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/eventon-lite/trunk/assets/js/admin/wp_admin.js)

---

# [source:](/browser?order=name "Go to repository root") [eventon-lite](/browser/eventon-lite?order=name "View eventon-lite")/[trunk](/browser/eventon-lite/trunk?order=name "View trunk")/[assets](/browser/eventon-lite/trunk/assets?order=name "View assets")/[js](/browser/eventon-lite/trunk/assets/js?order=name "View js")/[admin](/browser/eventon-lite/trunk/assets/js/admin?order=name "View admin")/[wp\_admin.js](/browser/eventon-lite/trunk/assets/js/admin/wp_admin.js?order=name "View wp_admin.js")

View diff against:

View revision:

| [Last change](/changeset/3129747/eventon-lite/trunk/assets/js/admin/wp_admin.js "View differences") on this file was [3129747](/changeset/3129747/ "View changeset 3129747"), checked in by ashanjay, [5 months ago](/timeline?from=2024-08-01T21%3A33%3A29Z&precision=second "See timeline at 08/01/2024 09:33:29 PM") |
| --- |
| 2.2.17 (2024-8-1) FIXED: evo\_retrieve\_cmd\_count() undefined error FIXED: Known XSS with language fields FIXED: language selection not loading correct page FIXED: Live now calendar showing schema data on page REMOVED: Unused language fields UPDATED: get\_event\_ids() in shortcode generator to use wpdb to improve page load speed UPDATED: UI Design for event edit page |
| * Property **svn:eol-style** set to   *`native`* * Property **svn:executable** set to   *`*`* | |
| **File size:** 31.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | /\* |
| [2](#L2) | \* EventON Back end scripts for general backend of wordpress |
| [3](#L3) | \* @version L 2.0 |
| [4](#L4) | \*/ |
| [5](#L5) | jQuery(document).ready(function($){ |
| [6](#L6) |  |
| [7](#L7) | const BB = $('body'); |
| [8](#L8) |  |
| [9](#L9) | // color picker |
| [10](#L10) | if( $.isFunction($.fn.ColorPicker) ) { |
| [11](#L11) | $('body').on('click','.colorselector',function(){ |
| [12](#L12) | var EE = $(this); |
| [13](#L13) | EE.ColorPicker({ |
| [14](#L14) | onBeforeShow: function(){ |
| [15](#L15) | $(this).ColorPickerSetColor( $(this).attr('hex')); |
| [16](#L16) | }, |
| [17](#L17) | onChange:function(hsb, hex, rgb){ |
| [18](#L18) | //console.log(hex+' '+rgb); |
| [19](#L19) | CIRCLE = $('body').find('.colorpicker\_on'); |
| [20](#L20) | CIRCLE.css({'backgroundColor': '#' + hex}).attr({'title': '#' + hex, 'hex':hex}); |
| [21](#L21) |  |
| [22](#L22) | obj\_input = CIRCLE.siblings('input.evocolorp\_val'); |
| [23](#L23) | obj\_input.attr({'value':hex}); |
| [24](#L24) |  |
| [25](#L25) | $('body').trigger('evo\_color\_select\_changed',[ hex, rgb]); |
| [26](#L26) | }, |
| [27](#L27) | onSubmit: function(hsb, hex, rgb, el) { |
| [28](#L28) | var obj\_input = $(el).siblings('input.evocolorp\_val'); |
| [29](#L29) |  |
| [30](#L30) | if($(el).hasClass('rgb')){ |
| [31](#L31) | $(el).siblings('input.rgb').attr({'value':rgb.r+','+rgb.g+','+rgb.b}); |
| [32](#L32) | } |
| [33](#L33) |  |
| [34](#L34) | obj\_input.attr({'value':hex}); |
| [35](#L35) |  |
| [36](#L36) | $(el).css('backgroundColor', '#' + hex); |
| [37](#L37) | $(el).attr({'title': '#' + hex, 'hex':hex}); |
| [38](#L38) | $(el).ColorPickerHide(); |
| [39](#L39) |  |
| [40](#L40) | $('body').find('.colorpicker\_on').removeClass('colorpicker\_on') |
| [41](#L41) | .trigger('evo\_color\_select\_submitted',[el, hex, rgb]); |
| [42](#L42) | }, |
| [43](#L43) | onHide: function(colpkr){ |
| [44](#L44) | $('body').find('.colorpicker\_on').removeClass('colorpicker\_on'); |
| [45](#L45) | } |
| [46](#L46) | }).bind('click',function(){ |
| [47](#L47) | $(this).addClass('colorpicker\_on'); |
| [48](#L48) | }); |
| [49](#L49) |  |
| [50](#L50) | if( !EE.hasClass('clrO')){ |
| [51](#L51) | EE.trigger('click').addClass('clrO'); |
| [52](#L52) | } |
| [53](#L53) | }); |
| [54](#L54) |  |
| [55](#L55) | $('.colorselector').ColorPicker({ |
| [56](#L56) | onBeforeShow: function(){ |
| [57](#L57) | $(this).addClass('clrO'); |
| [58](#L58) | $(this).ColorPickerSetColor( $(this).attr('hex')); |
| [59](#L59) | }, |
| [60](#L60) | onChange:function(hsb, hex, rgb){ |
| [61](#L61) | //console.log(hex+' '+rgb); |
| [62](#L62) | CIRCLE = $('body').find('.colorpicker\_on'); |
| [63](#L63) | CIRCLE.css({'backgroundColor': '#' + hex}).attr({'title': '#' + hex, 'hex':hex}); |
| [64](#L64) |  |
| [65](#L65) | obj\_input = CIRCLE.siblings('input.evocolorp\_val'); |
| [66](#L66) | obj\_input.attr({'value':hex}); |
| [67](#L67) |  |
| [68](#L68) | $('body').trigger('evo\_color\_select\_changed',[hex, rgb]); |
| [69](#L69) | }, |
| [70](#L70) | onSubmit: function(hsb, hex, rgb, el) { |
| [71](#L71) | var obj\_input = $(el).siblings('input.evocolorp\_val'); |
| [72](#L72) |  |
| [73](#L73) | if($(el).hasClass('rgb')){ |
| [74](#L74) | $(el).siblings('input.rgb').attr({'value':rgb.r+','+rgb.g+','+rgb.b}); |
| [75](#L75) | } |
| [76](#L76) |  |
| [77](#L77) | obj\_input.attr({'value':hex}); |
| [78](#L78) |  |
| [79](#L79) | $(el).css('backgroundColor', '#' + hex); |
| [80](#L80) | $(el).attr({'title': '#' + hex, 'hex':hex}); |
| [81](#L81) | $(el).ColorPickerHide(); |
| [82](#L82) |  |
| [83](#L83) | $('body').find('.colorpicker\_on').removeClass('colorpicker\_on').trigger('evo\_color\_select\_submitted',[el, hex, rgb]); |
| [84](#L84) | }, |
| [85](#L85) | onHide: function(colpkr){ |
| [86](#L86) | $('body').find('.colorpicker\_on').removeClass('colorpicker\_on'); |
| [87](#L87) | } |
| [88](#L88) | }).bind('click',function(){ |
| [89](#L89) | $(this).addClass('colorpicker\_on'); |
| [90](#L90) | }); |
| [91](#L91) | } |
| [92](#L92) |  |
| [93](#L93) | function colorPickMulti(itemid, cp){} |
| [94](#L94) |  |
| [95](#L95) | // get location cordinates |
| [96](#L96) | $('body').on('click','.evo\_auto\_gen\_latlng', function(event){ |
| [97](#L97) |  |
| [98](#L98) | event.preventDefault(); |
| [99](#L99) |  |
| [100](#L100) | // validation |
| [101](#L101) | var O = $(this); |
| [102](#L102) |  |
| [103](#L103) | $('body').remove('.evo\_auto\_gen\_latlng\_m'); |
| [104](#L104) |  |
| [105](#L105) | var add = $('body').find('input[name="location\_address"]').val(); |
| [106](#L106) | if(!add) |
| [107](#L107) | var add = $('body').find('input[name="term\_meta[location\_address]"]').val(); |
| [108](#L108) |  |
| [109](#L109) |  |
| [110](#L110) | if( !add){ |
| [111](#L111) | O.after('<p class="evo\_auto\_gen\_latlng\_m" style="padding-top:5px;">Address Missing</p>'); |
| [112](#L112) | return; |
| [113](#L113) | } |
| [114](#L114) |  |
| [115](#L115) | // run ajax |
| [116](#L116) | var D = { |
| [117](#L117) | 'action': 'eventon\_get\_latlng', |
| [118](#L118) | 'address': add |
| [119](#L119) | }; |
| [120](#L120) | $.ajax({ |
| [121](#L121) | beforeSend: function(){ |
| [122](#L122) | O.parent().addClass('evo\_loader'); |
| [123](#L123) | }, |
| [124](#L124) | url: evo\_admin\_ajax\_handle.ajaxurl, type: 'POST',dataType:'json', |
| [125](#L125) | data: D, |
| [126](#L126) | success:function(data){ |
| [127](#L127) |  |
| [128](#L128) | if( data.status == 'good'){ |
| [129](#L129) |  |
| [130](#L130) | $('body').find('input[name="location\_lat"]').val( data.lat ); |
| [131](#L131) | $('body').find('input[name="location\_lon"]').val( data.lng ); |
| [132](#L132) |  |
| [133](#L133) | $('body').find('input[name="term\_meta[location\_lat]"]').val( data.lat ); |
| [134](#L134) | $('body').find('input[name="term\_meta[location\_lon]"]').val( data.lng ); |
| [135](#L135) | }else{ |
| [136](#L136) | if( 'm' in data){ |
| [137](#L137) | O.after('<p class="evo\_auto\_gen\_latlng\_m" style="padding-top:5px;">'+ data.m +'</p>'); |
| [138](#L138) | } |
| [139](#L139) | } |
| [140](#L140) |  |
| [141](#L141) | },complete:function(){ |
| [142](#L142) | O.parent().removeClass('evo\_loader'); |
| [143](#L143) | } |
| [144](#L144) | }); |
| [145](#L145) | }); |
| [146](#L146) |  |
| [147](#L147) | // Side Panel for admin |
| [148](#L148) | // @since 4.5.2 @updated 4.5.2 |
| [149](#L149) | $('body').on('click','.evosp\_trigger', function(event){ |
| [150](#L150) | if( event !== undefined ){ |
| [151](#L151) | event.preventDefault(); |
| [152](#L152) | event.stopPropagation(); |
| [153](#L153) | } |
| [154](#L154) |  |
| [155](#L155) | const el = $(this); |
| [156](#L156) |  |
| [157](#L157) | el.addClass('evo\_sp\_trig\_on'); |
| [158](#L158) |  |
| [159](#L159) | // spv = side panel values |
| [160](#L160) | el.evo\_open\_sidepanel( el.data('d') , el.data('spv') ); |
| [161](#L161) | }); |
| [162](#L162) | $('body').on('click','.evosp\_close', function(event){ |
| [163](#L163) | if( event !== undefined ){ |
| [164](#L164) | event.preventDefault(); |
| [165](#L165) | event.stopPropagation(); |
| [166](#L166) | } |
| [167](#L167) |  |
| [168](#L168) | $(this).evo\_close\_sidepanel(  ); |
| [169](#L169) | }); |
| [170](#L170) |  |
| [171](#L171) | $.fn.evo\_open\_sidepanel = function(opt, spv){ |
| [172](#L172) | var defs = { |
| [173](#L173) | 'uid':'', |
| [174](#L174) | 'end':'admin', // admin or client |
| [175](#L175) | 'hide\_sp':false, |
| [176](#L176) | 'hide\_message':false, |
| [177](#L177) | 'title':'', |
| [178](#L178) | 'sp\_title':'', |
| [179](#L179) | 'content\_id':'',  // only to load dynamic content |
| [180](#L180) | 'content\_load\_delay':0, |
| [181](#L181) | 'ajax':'no', |
| [182](#L182) | 'ajax\_data':'', |
| [183](#L183) | 'other\_data':{} |
| [184](#L184) | } |
| [185](#L185) | var OO = $.extend({}, defs, opt); |
| [186](#L186) | //console.log(OO); |
| [187](#L187) |  |
| [188](#L188) | const SP = $('body').find('.evo\_sp'); |
| [189](#L189) |  |
| [190](#L190) | // structure |
| [191](#L191) | const load\_html = "<div class='evo\_loading\_bar\_holder h100'><div class='evo\_loading\_bar wid\_50 hi\_50'></div><div class='evo\_loading\_bar hi\_100'></div><div class='evo\_loading\_bar'></div><div class='evo\_loading\_bar'></div><div class='evo\_loading\_bar hi\_50'></div></div>"; |
| [192](#L192) |  |
| [193](#L193) | SP.html("<div class='evosp\_in'><span class='evosp\_close'><i class='fa fa-multiply'></i></span><div class='evosp\_head'>"+OO.sp\_title+"</div><div id='evops\_content' class='evosp\_body'>"+load\_html+"</div><div class='evosp\_foot'><p class='message'></p></div></div>"); |
| [194](#L194) |  |
| [195](#L195) | SP.addClass('show'); |
| [196](#L196) |  |
| [197](#L197) | const SP\_body = SP.find('.evosp\_body'); |
| [198](#L198) | const SP\_head = SP.find('.evosp\_head'); |
| [199](#L199) | const SP\_foot = SP.find('.evosp\_foot'); |
| [200](#L200) |  |
| [201](#L201) | // load using content |
| [202](#L202) | if( OO.content\_id != ''){ |
| [203](#L203) | if( OO.content\_load\_delay > 0){ |
| [204](#L204) | setTimeout(function(){ |
| [205](#L205) | SP\_body.html( BB.find('#'+ OO.content\_id ).html() ); |
| [206](#L206) | }, OO.content\_load\_delay ); |
| [207](#L207) | }else{ |
| [208](#L208) | SP\_body.html( BB.find('#'+ OO.content\_id ).html() ); |
| [209](#L209) | } |
| [210](#L210) |  |
| [211](#L211) | } |
| [212](#L212) |  |
| [213](#L213) | // run ajax to load content for the lightbox inside |
| [214](#L214) | if( OO.ajax == 'yes' && OO.ajax\_data != ''){ |
| [215](#L215) |  |
| [216](#L216) | var passing\_data = { |
| [217](#L217) | ajaxdata: OO.ajax\_data, |
| [218](#L218) | uid: OO.uid , |
| [219](#L219) | end: OO.end, |
| [220](#L220) | load\_new\_content: true, |
| [221](#L221) | load\_new\_content\_id: 'evops\_content', |
| [222](#L222) | lightbox\_loader:false |
| [223](#L223) | }; |
| [224](#L224) |  |
| [225](#L225) | SP.evo\_admin\_get\_ajax( passing\_data ); |
| [226](#L226) | } |
| [227](#L227) |  |
| [228](#L228) | // populate new content with spv values |
| [229](#L229) | if( spv != ''){ |
| [230](#L230) | BB.on('evo\_ajax\_success\_'+ OO.uid , function(){ |
| [231](#L231) | $('#evops\_content').find('input, select').each(function(){ |
| [232](#L232) | var fel = $(this); |
| [233](#L233) | $.each(spv,function(index, val){ |
| [234](#L234) | if( fel.attr('name') == index){ |
| [235](#L235) |  |
| [236](#L236) | if( val == 'no' || val == 'yes') fel.evo\_elm\_change\_yn\_btn( val ); |
| [237](#L237) | fel.val( val ); |
| [238](#L238) | } |
| [239](#L239) | }); |
| [240](#L240) | }); |
| [241](#L241) | }); |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) | BB.trigger('evo\_sp\_opened\_'+OO.uid, OO); |
| [245](#L245) | BB.trigger('evo\_sp\_opened', OO); |
| [246](#L246) | } |
| [247](#L247) |  |
| [248](#L248) | $.fn.evo\_savevals\_sidepanel = function(spv){ |
| [249](#L249) | const el = BB.find('.evo\_sp\_trig\_on'); |
| [250](#L250) |  |
| [251](#L251) | el.data('spv', spv); |
| [252](#L252) | el.removeClass('evo\_sp\_trig\_on'); |
| [253](#L253) | } |
| [254](#L254) |  |
| [255](#L255) | // CLOSE sidepanel |
| [256](#L256) | $.fn.evo\_close\_sidepanel = function(opt){ |
| [257](#L257) | SP = BB.find('.evo\_sp'); |
| [258](#L258) |  |
| [259](#L259) | var defaults = { 'delay':500}; |
| [260](#L260) |  |
| [261](#L261) | if( !(SP.hasClass('show')) ) return; |
| [262](#L262) |  |
| [263](#L263) | var OO = $.extend({}, defaults, opt); |
| [264](#L264) |  |
| [265](#L265) | SP.removeClass('show'); |
| [266](#L266) | setTimeout(function(){  SP.html('');    }, OO.delay ); |
| [267](#L267) | } |
| [268](#L268) |  |
| [269](#L269) | $.fn.evo\_showmsg\_sidepanel = function(){ |
| [270](#L270) | var defaults = { |
| [271](#L271) | 'type':'good', |
| [272](#L272) | 'message':'', |
| [273](#L273) | 'hide\_message': false,// hide message after some time pass time or false |
| [274](#L274) | 'hide\_sp': false, // hide lightbox after some time of false |
| [275](#L275) | }; var OO = $.extend({}, defaults, opt); |
| [276](#L276) |  |
| [277](#L277) | const SP = $('body').find('#evo\_sp'); |
| [278](#L278) |  |
| [279](#L279) | SP.find('.message').removeClass('bad good').addClass( OO.type ).html( OO.message ).fadeIn(); |
| [280](#L280) |  |
| [281](#L281) | if( OO.hide\_message ) setTimeout(function(){  SP.evo\_hidemsg\_sidepanel() }, OO.hide\_message ); |
| [282](#L282) |  |
| [283](#L283) | if( OO.hide\_lightbox ) SP.evo\_close\_sidepanel({ delay: OO.hide\_lightbox }); |
| [284](#L284) | } |
| [285](#L285) | $.fn.evo\_hidemsg\_sidepanel = function(opt){ |
| [286](#L286) | SP = this; |
| [287](#L287) | SP.find('p.message').hide(); |
| [288](#L288) | } |
| [289](#L289) |  |
| [290](#L290) | // LIGHTBOX function |
| [291](#L291) | // since 4.2 moved to funtctions |
| [292](#L292) |  |
| [293](#L293) |  |
| [294](#L294) | // lightbox hide |
| [295](#L295) | $('body').on('click',' .ajde\_close\_pop\_trig',function(){ |
| [296](#L296) | hide\_popupwindowbox( $(this).closest('.ajde\_admin\_lightbox') ); |
| [297](#L297) | }); |
| [298](#L298) | $('body').on('click',' .ajde\_close\_pop\_btn',function(){ |
| [299](#L299) | var obj = $(this).parent(); |
| [300](#L300) | hide\_popupwindowbox( $(this).closest('.ajde\_admin\_lightbox') ); |
| [301](#L301) | }); |
| [302](#L302) |  |
| [303](#L303) | $(document).mouseup( function(event){ |
| [304](#L304) | if( |
| [305](#L305) | $(event.target).hasClass('evo\_content\_inin') |
| [306](#L306) | ){ |
| [307](#L307) | CONTAIN =       $(event.target).find('.ajde\_popup'); |
| [308](#L308) | if(!CONTAIN.hasClass('nooutside')){ |
| [309](#L309) | CONTAIN.find('.ajde\_close\_pop\_btn').trigger('click'); |
| [310](#L310) | } |
| [311](#L311) | } |
| [312](#L312) | }); |
| [313](#L313) |  |
| [314](#L314) | $('body').on('click','.ajde\_close\_btn',function(){ |
| [315](#L315) | $(this).closest('.ajde\_close\_elm').hide(); |
| [316](#L316) | if( $(this).data('remove') !== undefined && $(this).data('remove') == 'yes') |
| [317](#L317) | $(this).closest('.ajde\_close\_elm').remove(); |
| [318](#L318) | }); |
| [319](#L319) |  |
| [320](#L320) | // trigger hide popup |
| [321](#L321) | $('body').on('evoadmin\_lightbox\_hide',function(event, lightboxclass, delay){ |
| [322](#L322) | lightboxELM = $('.ajde\_admin\_lightbox.'+lightboxclass); |
| [323](#L323) | hide\_popupwindowbox( lightboxELM , delay); |
| [324](#L324) | }); |
| [325](#L325) | function hide\_popupwindowbox( lightboxELM , delay){ |
| [326](#L326) | if(! lightboxELM.hasClass('show')) return false; |
| [327](#L327) | Close = (lightboxELM.parent().find('.ajde\_admin\_lightbox.show').length == 1)? true: false; |
| [328](#L328) |  |
| [329](#L329) | // if set to remove the lightbox HTML from dom |
| [330](#L330) | var remove\_from\_DOM = ( lightboxELM.find('.ajde\_close\_pop\_btn').hasClass('remove\_from\_DOM') )? true:false; |
| [331](#L331) |  |
| [332](#L332) | // hide delays |
| [333](#L333) | var hide\_delay = (delay === null || delay == '' || delay === undefined) ?  500 : parseInt(delay); |
| [334](#L334) |  |
| [335](#L335) | if( hide\_delay > 500){ |
| [336](#L336) | setTimeout( function(){ |
| [337](#L337) | lightboxELM.removeClass('show'); |
| [338](#L338) | }, ( hide\_delay - 500  ) ); |
| [339](#L339) | }else{ |
| [340](#L340) | lightboxELM.removeClass('show'); |
| [341](#L341) | } |
| [342](#L342) |  |
| [343](#L343) | setTimeout( function(){ |
| [344](#L344) | if(Close){ |
| [345](#L345) | $('body').removeClass('evo\_overflow'); |
| [346](#L346) | $('html').removeClass('evo\_overflow'); |
| [347](#L347) | } |
| [348](#L348) | // remove lightbox HTML from DOM |
| [349](#L349) | if( remove\_from\_DOM){ |
| [350](#L350) | lightboxELM.remove(); |
| [351](#L351) | } |
| [352](#L352) | }, hide\_delay); |
| [353](#L353) | } |
| [354](#L354) |  |
| [355](#L355) | // OPEN POPUP BOX |
| [356](#L356) | // everywhere in wp-admin |
| [357](#L357) | $('body').on('click','.ajde\_popup\_trig', function(){ |
| [358](#L358) | ajde\_popup\_open( $(this)); |
| [359](#L359) | }); |
| [360](#L360) |  |
| [361](#L361) | // Loading animations |
| [362](#L362) | $('body').on('evo\_show\_loading\_animation', function(event, lb\_class, animation\_type){ |
| [363](#L363) | show\_loading\_animation(lb\_class, animation\_type); |
| [364](#L364) | }); |
| [365](#L365) | function show\_loading\_animation(lb\_class, animation\_type){ |
| [366](#L366) | LB = $('.ajde\_admin\_lightbox.'+lb\_class).eq(0); |
| [367](#L367) |  |
| [368](#L368) | var \_animation\_type = (animation\_type !='' && animation\_type !== undefined) ? |
| [369](#L369) | animation\_type: 'initial'; |
| [370](#L370) |  |
| [371](#L371) | if( \_animation\_type == 'initial') |
| [372](#L372) | LB.find('.ajde\_popup\_text').html('<div class="evo\_loading\_bar\_holder"><div class="evo\_loading\_bar wid\_40 hi\_50"></div><div class="evo\_loading\_bar"></div><div class="evo\_loading\_bar"></div><div class="evo\_loading\_bar"></div><div class="evo\_loading\_bar wid\_25"></div></div>'); |
| [373](#L373) |  |
| [374](#L374) | if( \_animation\_type == 'saving') |
| [375](#L375) | LB.find('.ajde\_popup\_text').addClass('loading'); |
| [376](#L376) | } |
| [377](#L377) | $('body').on('evo\_hide\_loading\_animation', function(event, lb\_class){ |
| [378](#L378) | hide\_loading\_aniation(lb\_class); |
| [379](#L379) | }); |
| [380](#L380) | function hide\_loading\_aniation( lb\_class){ |
| [381](#L381) | LB = $('.ajde\_admin\_lightbox.'+lb\_class).eq(0); |
| [382](#L382) | LB.find('.ajde\_popup\_text').removeClass('loading'); |
| [383](#L383) | } |
| [384](#L384) |  |
| [385](#L385) | // popup open |
| [386](#L386) | // 2.6.9 |
| [387](#L387) | $('body').on('evo\_open\_admin\_lightbox', function(event, lb\_class){ |
| [388](#L388) | ajde\_open\_any\_lightbox(lb\_class); |
| [389](#L389) | }); |
| [390](#L390) |  |
| [391](#L391) | function ajde\_open\_any\_lightbox(lb\_class){ |
| [392](#L392) | LIGHTBOX = $('.ajde\_admin\_lightbox.'+lb\_class).eq(0); |
| [393](#L393) |  |
| [394](#L394) | // if already open |
| [395](#L395) | if(LIGHTBOX.is("visible")===true) return false; |
| [396](#L396) |  |
| [397](#L397) |  |
| [398](#L398) | POPUP = LIGHTBOX.find('.ajde\_popup'); |
| [399](#L399) | POPUP.find('.message').removeClass('bad good').hide(); |
| [400](#L400) |  |
| [401](#L401) | // open lightbox |
| [402](#L402) | LIGHTBOX.addClass('show'); |
| [403](#L403) | $('body').addClass('evo\_overflow'); |
| [404](#L404) | $('html').addClass('evo\_overflow'); |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | // @version 4.1 |
| [408](#L408) | $('body').on('evo\_open\_dynamic\_admin\_lightbox', function(event, obj, obj\_data){ |
| [409](#L409) | ajde\_popup\_open(obj, obj\_data); |
| [410](#L410) | }); |
| [411](#L411) |  |
| [412](#L412) | function ajde\_popup\_open(obj, obj\_data){ |
| [413](#L413) |  |
| [414](#L414) | OD = obj\_data !== undefined ? obj\_data : obj.data(); |
| [415](#L415) |  |
| [416](#L416) | var popc = obj.data('popc'); |
| [417](#L417) |  |
| [418](#L418) | // check if specific lightbox requested |
| [419](#L419) | var LIGHTBOX = ('popc' in OD && OD.popc !== false && OD.popc != '')? |
| [420](#L420) | $('.ajde\_admin\_lightbox.'+ OD.popc).eq(0):$('.ajde\_admin\_lightbox.regular').eq(0); |
| [421](#L421) |  |
| [422](#L422) | // create lightbox HTML and add to page |
| [423](#L423) | if( OD.popc == 'print\_lightbox'){ |
| [424](#L424) | lightbox\_class\_name = OD.lb\_cl\_nm; |
| [425](#L425) | lightbox\_size = 'lb\_sz' in OD ? OD.lb\_sz: ''; |
| [426](#L426) | $('.ajde\_admin\_lightboxes').append('<div id="" class="ajde\_admin\_lightbox '+lightbox\_class\_name+'"><div class="evo\_content\_in"><div class="evo\_content\_inin"><div class="ajde\_popup '+lightbox\_class\_name+' '+lightbox\_size+'"><div class="ajde\_header"><a class="ajde\_backbtn" style="display:none"><i class="fa fa-angle-left"></i></a><p id="ajde\_title" class="ajde\_lightbox\_title"></p><a class="ajde\_close\_pop\_btn remove\_from\_DOM">X</a></div><div class="ajde\_popup\_text"></div><p class="message"></p></div></div></div></div>'); |
| [427](#L427) |  |
| [428](#L428) | show\_loading\_animation( lightbox\_class\_name ); |
| [429](#L429) |  |
| [430](#L430) | LIGHTBOX = $('.ajde\_admin\_lightbox.'+lightbox\_class\_name); |
| [431](#L431) | } |
| [432](#L432) |  |
| [433](#L433) | var POPUP = LIGHTBOX.find('.ajde\_popup'); |
| [434](#L434) |  |
| [435](#L435) | // alter lightbox title |
| [436](#L436) | if( obj.data('t') !== undefined){ |
| [437](#L437) | LIGHTBOX.find('.ajde\_lightbox\_title').html( obj.data('t') ); |
| [438](#L438) | } |
| [439](#L439) |  |
| [440](#L440) | if(LIGHTBOX.is("visible")===true) return false; |
| [441](#L441) |  |
| [442](#L442) | // append textbox id to popup if given |
| [443](#L443) | if(obj.attr('data-textbox')!==''){ |
| [444](#L444) | POPUP.attr({'data-textbox':obj.attr('data-textbox')}); |
| [445](#L445) | } |
| [446](#L446) |  |
| [447](#L447) | // dynamic content within the site |
| [448](#L448) | var dynamic\_c = obj.attr('data-dynamic\_c'); |
| [449](#L449) | if(typeof dynamic\_c !== 'undefined' && dynamic\_c !== false){ |
| [450](#L450) |  |
| [451](#L451) | var content\_id = obj.attr('data-content\_id'); |
| [452](#L452) | var content = $('#'+content\_id).html(); |
| [453](#L453) |  |
| [454](#L454) | LIGHTBOX.find('.ajde\_popup\_text').html( content); |
| [455](#L455) | } |
| [456](#L456) |  |
| [457](#L457) | // run ajax to load content for the lightbox inside |
| [458](#L458) | if( obj.data('ajax') == 'yes' && obj.data('d') !== 'undefined'){ |
| [459](#L459) |  |
| [460](#L460) | var D = {}; |
| [461](#L461) | D = obj.data('d'); |
| [462](#L462) |  |
| [463](#L463) | $.ajax({ |
| [464](#L464) | beforeSend: function(){ }, |
| [465](#L465) | url:    evo\_admin\_ajax\_handle.ajaxurl, type: 'POST',dataType:'json', |
| [466](#L466) | data: D, |
| [467](#L467) | success:function(data){ |
| [468](#L468) | LIGHTBOX.find('.ajde\_popup\_text').html( data.html); |
| [469](#L469) | },complete:function(){  hide\_pop\_loading();     } |
| [470](#L470) | }); |
| [471](#L471) | } |
| [472](#L472) |  |
| [473](#L473) | // if content coming from a AJAX file |
| [474](#L474) | var attr\_ajax\_url = obj.attr('ajax\_url'); |
| [475](#L475) | if(typeof attr\_ajax\_url !== 'undefined' && attr\_ajax\_url !== false){ |
| [476](#L476) | $.ajax({ |
| [477](#L477) | beforeSend: function(){ |
| [478](#L478) | show\_pop\_loading(); |
| [479](#L479) | }, |
| [480](#L480) | url:attr\_ajax\_url, |
| [481](#L481) | success:function(data){ |
| [482](#L482) | LIGHTBOX.find('.ajde\_popup\_text').html( data); |
| [483](#L483) | },complete:function(){ |
| [484](#L484) | hide\_pop\_loading(); |
| [485](#L485) | } |
| [486](#L486) | }); |
| [487](#L487) | } |
| [488](#L488) |  |
| [489](#L489) | // change title if present |
| [490](#L490) | var poptitle = obj.attr('poptitle'); |
| [491](#L491) | if(typeof poptitle !== 'undefined' && poptitle !== false){ |
| [492](#L492) | LIGHTBOX.find('.ajde\_header p').html(poptitle); |
| [493](#L493) | } |
| [494](#L494) |  |
| [495](#L495) | POPUP.find('.message').removeClass('bad good').hide(); |
| [496](#L496) |  |
| [497](#L497) | // open lightbox |
| [498](#L498) | setTimeout( function(){ |
| [499](#L499) | LIGHTBOX.addClass('show'); |
| [500](#L500) | $('body').addClass('evo\_overflow'); |
| [501](#L501) | $('html').addClass('evo\_overflow'); |
| [502](#L502) | },300); |
| [503](#L503) |  |
| [504](#L504) | } |
| [505](#L505) |  |
| [506](#L506) | // popup lightbox functions |
| [507](#L507) | // lightbox messages |
| [508](#L508) | $('body').on('ajde\_lightbox\_show\_msg',function(event,message, boxclassname, type, donthide, hideMsg){ |
| [509](#L509) | LIGHTBOX = $('.'+boxclassname+'.ajde\_admin\_lightbox'); |
| [510](#L510) | type = (type!='bad')? 'good':'bad'; |
| [511](#L511) | LIGHTBOX.find('p.message').removeClass('bad good').addClass(type).html(message).fadeIn(); |
| [512](#L512) |  |
| [513](#L513) | // hide lightbox if good after 2 seconds |
| [514](#L514) | dh = (donthide !='' && donthide == false ) ? true: false; |
| [515](#L515) |  |
| [516](#L516) | if(type=='good' && dh)  setTimeout(function(){  hide\_popupwindowbox(LIGHTBOX) }, 2000); |
| [517](#L517) |  |
| [518](#L518) | // hide the message only after 2 seconds |
| [519](#L519) | if( hideMsg)    setTimeout(function(){  LIGHTBOX.find('p.message').hide() }, 2000); |
| [520](#L520) | }); |
| [521](#L521) |  |
| [522](#L522) | // hide lightbox message |
| [523](#L523) | $('body').on('ajde\_lightbox\_hide\_msg',function(event,boxclassname){ |
| [524](#L524) | LIGHTBOX = $('.'+boxclassname+'.ajde\_admin\_lightbox'); |
| [525](#L525) | LIGHTBOX.find('p.message').fadeOut(); |
| [526](#L526) | }); |
| [527](#L527) |  |
| [528](#L528) | function show\_pop\_bad\_msg(msg){ |
| [529](#L529) | $('.ajde\_popup').find('.message').removeClass('bad good').addClass('bad').html(msg).fadeIn(); |
| [530](#L530) | } |
| [531](#L531) | function show\_pop\_good\_msg(msg){ |
| [532](#L532) | $('.ajde\_popup').find('.message').removeClass('bad good').addClass('good').html(msg).fadeIn(); |
| [533](#L533) | } |
| [534](#L534) |  |
| [535](#L535) | function show\_pop\_loading(){ |
| [536](#L536) | $('.ajde\_popup\_text').css({'opacity':0.3}); |
| [537](#L537) | $('#ajde\_loading').fadeIn(); |
| [538](#L538) | } |
| [539](#L539) | function hide\_pop\_loading(){ |
| [540](#L540) | $('.ajde\_popup\_text').css({'opacity':1}); |
| [541](#L541) | $('#ajde\_loading').fadeOut(20); |
| [542](#L542) | } |
| [543](#L543) |  |
| [544](#L544) |  |
| [545](#L545) | // TAXONOMY term form, NEW/ EDIT/ DELETE |
| [546](#L546) | $('body') |
| [547](#L547) |  |
| [548](#L548) | // get term list |
| [549](#L549) | .on('evo\_ajax\_success\_evo\_get\_tax\_list',function(event, OO, data){ |
| [550](#L550) | if(data.status=='good'){ |
| [551](#L551) | $('.evo\_config\_term').find('select.field').select2(); |
| [552](#L552) | } |
| [553](#L553) | }) |
| [554](#L554) | // save term edit settings |
| [555](#L555) | .on('evo\_ajax\_success\_evo\_save\_tax\_edit\_settings', function (event, OO, data){ |
| [556](#L556) | if(data.status=='good'){ |
| [557](#L557) | $('.evo\_singular\_tax\_for\_event.'+ data.tax ).html(data.htmldata); |
| [558](#L558) |  |
| [559](#L559) | // when setting event location |
| [560](#L560) | if(data.tax == 'event\_location' && evo\_admin\_ajax\_handle.setting\_evo\_gen\_map){ |
| [561](#L561) | var inp = $('body').find('input[name="evcal\_gmap\_gen"]'); |
| [562](#L562) | if( inp.val() == 'no') inp.siblings('span').trigger('click'); |
| [563](#L563) | } |
| [564](#L564) | } |
| [565](#L565) | }) |
| [566](#L566) | // save term from list |
| [567](#L567) | .on('evo\_ajax\_success\_evo\_save\_term\_list\_item', function (event, OO, data){ |
| [568](#L568) | if(data.status=='good'){ |
| [569](#L569) | $('.evo\_singular\_tax\_for\_event.'+ data.tax ).html(data.htmldata); |
| [570](#L570) |  |
| [571](#L571) | // when setting event location |
| [572](#L572) | if(data.tax == 'event\_location' && evo\_admin\_ajax\_handle.setting\_evo\_gen\_map){ |
| [573](#L573) | var inp = $('body').find('input[name="evcal\_gmap\_gen"]'); |
| [574](#L574) | if( inp.val() == 'no') inp.siblings('span').trigger('click'); |
| [575](#L575) | } |
| [576](#L576) | } |
| [577](#L577) | }) |
| [578](#L578) |  |
| [579](#L579) | // remove tax |
| [580](#L580) | .on('evo\_ajax\_beforesend\_evo\_remove\_tax\_term', function (event, OO){ |
| [581](#L581) | $('.evo\_singular\_tax\_for\_event.'+ OO.ajaxdata.tax ).addClass('evoloading'); |
| [582](#L582) |  |
| [583](#L583) | }) |
| [584](#L584) | .on('evo\_ajax\_success\_evo\_remove\_tax\_term', function (event, OO, data){ |
| [585](#L585) | if(data.status=='good'){ |
| [586](#L586) | $('.evo\_singular\_tax\_for\_event.'+ data.tax ).html(data.htmldata).removeClass('evoloading');; |
| [587](#L587) | } |
| [588](#L588) | }) |
| [589](#L589) | ; |
| [590](#L590) |  |
| [591](#L591) | // Upload custom images to eventon custom image meta fields |
| [592](#L592) | var file\_frame, |
| [593](#L593) | BOX; |
| [594](#L594) |  |
| [595](#L595) | $('body').on('click','.custom\_upload\_image\_button',function(event) { |
| [596](#L596) | var obj = jQuery(this); |
| [597](#L597) | BOX = obj.closest('.evo\_metafield\_image'); |
| [598](#L598) |  |
| [599](#L599) | IMG\_URL = ''; |
| [600](#L600) |  |
| [601](#L601) | // choose image |
| [602](#L602) | if(obj.hasClass('chooseimg')){ |
| [603](#L603) |  |
| [604](#L604) | event.preventDefault(); |
| [605](#L605) |  |
| [606](#L606) | // If the media frame already exists, reopen it. |
| [607](#L607) | if ( file\_frame ) { |
| [608](#L608) | file\_frame.open(); |
| [609](#L609) | return; |
| [610](#L610) | } |
| [611](#L611) | // Create the media frame. |
| [612](#L612) | file\_frame = wp.media.frames.downloadable\_file = wp.media({ |
| [613](#L613) | title: 'Choose an Image', |
| [614](#L614) | button: {text: 'Use Image',}, |
| [615](#L615) | multiple: false |
| [616](#L616) | }); |
| [617](#L617) |  |
| [618](#L618) | // When an image is selected, run a callback. |
| [619](#L619) | file\_frame.on( 'select', function() { |
| [620](#L620) | attachment = file\_frame.state().get('selection').first().toJSON(); |
| [621](#L621) |  |
| [622](#L622) | BOX.find('.evo\_meta\_img').val( attachment.id ); |
| [623](#L623) | BOX.find('.image\_src img').attr('src', attachment.url ).fadeIn(); |
| [624](#L624) | var old\_text = obj.attr('value'); |
| [625](#L625) | var new\_text = obj.data('txt'); |
| [626](#L626) |  |
| [627](#L627) | obj.attr({'value': new\_text, 'data-txt': old\_text, 'class': 'custom\_upload\_image\_button button removeimg'}); |
| [628](#L628) | }); |
| [629](#L629) |  |
| [630](#L630) | // Finally, open the modal. |
| [631](#L631) | file\_frame.open(); |
| [632](#L632) |  |
| [633](#L633) | }else{ |
| [634](#L634) |  |
| [635](#L635) | BOX.find('.evo\_meta\_img').val( '' ); |
| [636](#L636) | BOX.find('.image\_src img').fadeOut(function(){ |
| [637](#L637) | $(this).attr('src', '' ); |
| [638](#L638) | }); |
| [639](#L639) | var old\_text = obj.attr('value'); |
| [640](#L640) | var new\_text = obj.attr('data-txt'); |
| [641](#L641) |  |
| [642](#L642) | obj.attr({'value': new\_text, 'data-txt': old\_text, 'class': 'custom\_upload\_image\_button button chooseimg'}); |
| [643](#L643) |  |
| [644](#L644) | return false; |
| [645](#L645) | } |
| [646](#L646) | }); |
| [647](#L647) |  |
| [648](#L648) | // Add new tag field clearing after |
| [649](#L649) | $('#addtag #submit').click(function () { |
| [650](#L650) | // Look for a div WordPress produces for an invalid form element |
| [651](#L651) | if (!$('#addtag .form-invalid').length) { |
| [652](#L652) | var IF = $('#addtag').find('.evo\_metafield\_image'); |
| [653](#L653) |  |
| [654](#L654) | var INP = IF.find('.custom\_upload\_image\_button'); |
| [655](#L655) |  |
| [656](#L656) | var old\_text = INP.attr('value'); |
| [657](#L657) | var new\_text = INP.attr('data-txt'); |
| [658](#L658) |  |
| [659](#L659) |  |
| [660](#L660) | INP.removeClass('removeimg').addClass('chooseimg').attr({'value': new\_text, 'data-txt': old\_text}); |
| [661](#L661) | IF.find('img').fadeOut(function(){ |
| [662](#L662) | $(this).attr('src', '' ); |
| [663](#L663) | }); |
| [664](#L664) |  |
| [665](#L665) | } |
| [666](#L666) | }); |
| [667](#L667) |  |
| [668](#L668) | // settings |
| [669](#L669) | // themes section |
| [670](#L670) | $('.evo\_theme\_selection select').on('change',function(){ |
| [671](#L671) | var theme = $(this).val(); |
| [672](#L672) |  |
| [673](#L673) | // switch to default |
| [674](#L674) | if(theme =='default'){ |
| [675](#L675) | $('.colorselector ').each(function(){ |
| [676](#L676) | var item = $(this).siblings('input'); |
| [677](#L677) | item.attr({'value': item.attr('default') }); |
| [678](#L678) | $(this).attr({'style':'background-color:#'+item.attr('default'), 'hex':item.attr('default')}); |
| [679](#L679) | }); |
| [680](#L680) | $('.evo\_theme').find('span').each(function(){ |
| [681](#L681) | $(this).attr({'style':'background-color:#'+ $(this).attr('data-default')}); |
| [682](#L682) | }); |
| [683](#L683) |  |
| [684](#L684) | }else{ |
| [685](#L685) | themeSel = JSON.parse( $('#evo\_themejson').html()); |
| [686](#L686) |  |
| [687](#L687) | // each theme array |
| [688](#L688) | $.each(themeSel, function(i, item){ |
| [689](#L689) | if(item.name== theme){ |
| [690](#L690) | $.each(item.content, function(key, value){ |
| [691](#L691) | var thisItem = $('body').find('input[name='+key+']'); |
| [692](#L692) | thisItem.val(value); |
| [693](#L693) |  |
| [694](#L694) | if(!value.includes(',')) |
| [695](#L695) | thisItem.siblings('span.colorselector').attr({'style':'background-color:#'+value, 'hex':value}); |
| [696](#L696) |  |
| [697](#L697) | $('.evo\_theme').find('span[name='+key+']').attr({'style':'background-color:#'+value}); |
| [698](#L698) | }); |
| [699](#L699) | } |
| [700](#L700) | }); |
| [701](#L701) |  |
| [702](#L702) | } |
| [703](#L703) | }); |
| [704](#L704) |  |
| [705](#L705) | // Export settings |
| [706](#L706) | $('body').on('evo\_data\_uploader\_submitted', function(event, reader\_event, msg\_elm, upload\_box){ |
| [707](#L707) |  |
| [708](#L708) | if( $(upload\_box).data('id') != 'evo\_settings\_upload') return; |
| [709](#L709) |  |
| [710](#L710) | var jsonData = reader\_event.target.result ; |
| [711](#L711) |  |
| [712](#L712) | $.ajax({ |
| [713](#L713) | beforeSend: function(){ }, |
| [714](#L714) | type: 'POST', |
| [715](#L715) | url:evo\_admin\_ajax\_handle.ajaxurl, |
| [716](#L716) | data: { |
| [717](#L717) | action:'eventon\_import\_settings', |
| [718](#L718) | nonce: evo\_admin\_ajax\_handle.postnonce, |
| [719](#L719) | jsondata: $.parseJSON( jsonData) |
| [720](#L720) | }, |
| [721](#L721) | dataType:'json', |
| [722](#L722) | success:function(data){ |
| [723](#L723) | msg\_elm.html(data.msg); |
| [724](#L724) | },complete:function(){  } |
| [725](#L725) | }); |
| [726](#L726) | }); |
| [727](#L727) |  |
| [728](#L728) | // settings event card designer |
| [729](#L729) | // EventON v4.0 |
| [730](#L730) | $.fn.evo\_card\_designer = function (options) { |
| [731](#L731) | var designer = $(this); |
| [732](#L732) | var fields = $(designer).find('.evocard\_design\_holder'); |
| [733](#L733) | var selector = $(designer).find('#evo\_card\_field\_selector'); |
| [734](#L734) | var def\_color = designer.data('dc'); |
| [735](#L735) |  |
| [736](#L736) | var init = function(){ |
| [737](#L737) | interactions(); |
| [738](#L738) | field\_selector(); |
| [739](#L739) |  |
| [740](#L740) | if( fields.length> 0 ){ |
| [741](#L741) | fields.sortable({ |
| [742](#L742) | update: function(e, ul){ |
| [743](#L743) | run\_row\_numbering(); |
| [744](#L744) | } |
| [745](#L745) | }); |
| [746](#L746) | } |
| [747](#L747) |  |
| [748](#L748) | } |
| [749](#L749) |  |
| [750](#L750) | var interactions = function(){ |
| [751](#L751) | // new row |
| [752](#L752) | $('.ecd\_add\_rows').on('click',function(){ |
| [753](#L753) | var count = parseInt($(this).data('c')); |
| [754](#L754) | var holder\_boxes = parseInt($(this).data('hc')); |
| [755](#L755) | var holder\_location = $(this).data('hl'); |
| [756](#L756) |  |
| [757](#L757) | html = "<p class='ecd\_row "+ ( holder\_location ) +"' data-r=''><span class='ecd\_row\_in'>"; |
| [758](#L758) |  |
| [759](#L759) | // normal boxes |
| [760](#L760) | for (var i = 1; i <= count; i++) { |
| [761](#L761) | html += "<span class='ecd\_row\_box' data-b='"+ i +"'><span class='ecd\_set\_field'>+ Set Field</span></span>"; |
| [762](#L762) | } |
| [763](#L763) |  |
| [764](#L764) | // before after boxes count |
| [765](#L765) | if( holder\_boxes ){ |
| [766](#L766) | html += "<span class='ecd\_row\_box\_h'>"; |
| [767](#L767) | for (var i = 1; i <= holder\_boxes; i++) { |
| [768](#L768) | html += "<span class='ecd\_row\_box' data-b='"+ holder\_location + i +"'><span class='ecd\_set\_field'>+ Set Field</span></span>"; |
| [769](#L769) | } |
| [770](#L770) | html += "</span>"; |
| [771](#L771) | } |
| [772](#L772) |  |
| [773](#L773) |  |
| [774](#L774) | html +="</span><i class='fa fa-minus-circle ecd\_del\_row'></i></p>"; |
| [775](#L775) |  |
| [776](#L776) | $(fields).append( html ); |
| [777](#L777) | run\_row\_numbering(); |
| [778](#L778) | }); |
| [779](#L779) |  |
| [780](#L780) | // remove row |
| [781](#L781) | $(designer).on('click','.ecd\_del\_row', function(){ |
| [782](#L782) | // items in row |
| [783](#L783) | $(this).parent().find('.ecd\_row\_box').each(function(){ |
| [784](#L784) | if( $(this).data('n') !== undefined && $(this).data('n') != ''){ |
| [785](#L785) | add\_item\_to\_selector( $(this).data('n') , $(this).find('em').html() ); |
| [786](#L786) | } |
| [787](#L787) | }); |
| [788](#L788) |  |
| [789](#L789) | // remove row |
| [790](#L790) | $(this).closest('.ecd\_row').remove(); |
| [791](#L791) | run\_row\_numbering(); |
| [792](#L792) | }); |
| [793](#L793) |  |
| [794](#L794) | // remove a box |
| [795](#L795) | $(designer).on('click','.ecdad\_act .fa-minus-circle',function(){ |
| [796](#L796) | var row = $(this).closest('.ecd\_row'); |
| [797](#L797) | var box = $(this).closest('.ecd\_row\_box'); |
| [798](#L798) |  |
| [799](#L799) | add\_item\_to\_selector( box.data('n') , box.find('em').html() ); |
| [800](#L800) |  |
| [801](#L801) | box.html( "<span class='ecd\_set\_field'>+ Set Field</span>" ) |
| [802](#L802) | .data('n','').attr('data-n', '' ) |
| [803](#L803) | .data('h','').attr('data-h', '' ) |
| [804](#L804) | .data('c','').attr('data-c', '' ); |
| [805](#L805) | run\_row\_numbering(); |
| [806](#L806) | }); |
| [807](#L807) |  |
| [808](#L808) | // move row up down |
| [809](#L809) | $(designer).on('click','.fa-chevron-circle-up',function(){ |
| [810](#L810) | var RR = $(this).closest('.ecd\_row'); |
| [811](#L811) | PR = RR.prev(); |
| [812](#L812) | RR.insertBefore( PR ); |
| [813](#L813) | run\_row\_numbering(); |
| [814](#L814) | }); |
| [815](#L815) | $(designer).on('click','.fa-chevron-circle-down',function(){ |
| [816](#L816) | var RR = $(this).closest('.ecd\_row'); |
| [817](#L817) | PR = RR.next(); |
| [818](#L818) | RR.insertAfter( PR ); |
| [819](#L819) | run\_row\_numbering(); |
| [820](#L820) | }); |
| [821](#L821) |  |
| [822](#L822) | // toggle visibility |
| [823](#L823) | $(designer).on('click','.fa.vis',function(){ |
| [824](#L824) | if($(this).hasClass('fa-eye')){ |
| [825](#L825) | $(this).removeClass('fa-eye').addClass('fa-eye-slash'); |
| [826](#L826) | $(this).closest('.ecd\_row\_box').data('h','y').addClass('hidden'); |
| [827](#L827) | }else{ |
| [828](#L828) | $(this).removeClass('fa-eye-slash').addClass('fa-eye'); |
| [829](#L829) | $(this).closest('.ecd\_row\_box').data('h','').removeClass('hidden'); |
| [830](#L830) | } |
| [831](#L831) | run\_row\_numbering(); |
| [832](#L832) | }); |
| [833](#L833) |  |
| [834](#L834) | // color picker |
| [835](#L835) | $('body').on('evo\_color\_select\_submitted', function(event, el, hex, rgb){ |
| [836](#L836) | //console.log(hex); |
| [837](#L837) | if( $(el).hasClass('clr')){ |
| [838](#L838) | $(el).closest('.ecd\_row\_box').data('c', hex).attr('data-c', hex); |
| [839](#L839) | run\_row\_numbering(); |
| [840](#L840) | } |
| [841](#L841) | }); |
| [842](#L842) | $('body').on('evo\_color\_select\_changed',function(event, hex, rgb){ |
| [843](#L843) | var cO = $('body').find('.colorpicker\_on'); |
| [844](#L844) | if( cO.hasClass('clr')){ |
| [845](#L845) | if( hex != def\_color ) cO.siblings('.clr\_reset').removeClass('dn'); |
| [846](#L846) |  |
| [847](#L847) | cO.closest('.ecd\_row\_box').data('c', hex).attr('data-c', hex); |
| [848](#L848) | run\_row\_numbering(); |
| [849](#L849) | } |
| [850](#L850) | }); |
| [851](#L851) | // reset to default color |
| [852](#L852) | $(designer).on('click','.clr\_reset',function(){ |
| [853](#L853) | $(this).siblings('.clr') |
| [854](#L854) | .css('background-color', '#'+ def\_color) |
| [855](#L855) | .attr('hex', def\_color); |
| [856](#L856) | $(this).closest('.ecd\_row\_box').data('c', def\_color) |
| [857](#L857) | .attr('data-c', def\_color); |
| [858](#L858) | $(this).addClass('dn'); |
| [859](#L859) | run\_row\_numbering(); |
| [860](#L860) | }); |
| [861](#L861) |  |
| [862](#L862) | } |
| [863](#L863) |  |
| [864](#L864) |  |
| [865](#L865) | var field\_selector = function(){ |
| [866](#L866) | $(designer).on('click','.ecd\_set\_field', function(){ |
| [867](#L867) | $(designer).find('.adding\_field').removeClass('adding\_field'); |
| [868](#L868) | $(this).parent().addClass('adding\_field'); |
| [869](#L869) | selector.addClass('focus'); |
| [870](#L870) | }); |
| [871](#L871) | // selector > designer |
| [872](#L872) | $('#evo\_card\_field\_selector\_f').on('click','span',function(){ |
| [873](#L873) | if( !selector.hasClass('focus') ) return; |
| [874](#L874) |  |
| [875](#L875) | var html = "<span class='ecd\_act1'><i class='vis fa fa-eye'></i><span class='colorselector clr' hex='"+def\_color+"' style='background-color:#"+def\_color+"' title=''></span> <span class='clr\_reset dn' data-hex='"+def\_color+"' style='background-color:#"+def\_color+"' title=''></span> </span>"+ |
| [876](#L876) | "<em>"+ $(this).html() +"</em><span class='ecdad\_act'><i class='fa fa-minus-circle'></i></span>"; |
| [877](#L877) |  |
| [878](#L878) | var box = $(designer).find('.adding\_field'); |
| [879](#L879) |  |
| [880](#L880) | // append to the designer box |
| [881](#L881) | box.html( html ) |
| [882](#L882) | .data('n', $(this).data('n') ) |
| [883](#L883) | .attr('data-n', $(this).data('n') ) |
| [884](#L884) | .removeClass('adding\_field'); |
| [885](#L885) |  |
| [886](#L886) | // remove from selector and hide selector, show no fields message if |
| [887](#L887) | $(this).remove(); |
| [888](#L888) |  |
| [889](#L889) | if( $('#evo\_card\_field\_selector\_f').find('span').length == 0){ |
| [890](#L890) | selector.find('.nothing').show(); |
| [891](#L891) | } |
| [892](#L892) | selector.removeClass('focus'); |
| [893](#L893) |  |
| [894](#L894) | // load new fields |
| [895](#L895) | run\_row\_numbering(); |
| [896](#L896) | }); |
| [897](#L897) |  |
| [898](#L898) | // cancel selector |
| [899](#L899) | $('#evo\_card\_field\_selector\_c').on('click',function(){ |
| [900](#L900) | selector.removeClass('focus'); |
| [901](#L901) | $(designer).find('.adding\_field').removeClass('adding\_field'); |
| [902](#L902) | }); |
| [903](#L903) | } |
| [904](#L904) |  |
| [905](#L905) | var add\_item\_to\_selector = function(f, n){ |
| [906](#L906) | var HH = $('#evo\_card\_field\_selector\_f').html(); |
| [907](#L907) | HH +=  "<span data-n='"+ f +"'>"+ n +"</span>"; |
| [908](#L908) | $('#evo\_card\_field\_selector\_f').html( HH ); |
| [909](#L909) |  |
| [910](#L910) | // check if selector content to be shown |
| [911](#L911) | if( $('#evo\_card\_field\_selector\_f').html() == ''){ |
| [912](#L912) | selector.find('.nothing').show(); |
| [913](#L913) | }else{ |
| [914](#L914) | selector.find('.nothing').hide(); |
| [915](#L915) | } |
| [916](#L916) | } |
| [917](#L917) |  |
| [918](#L918) | var run\_row\_numbering = function(){ |
| [919](#L919) | var count = 1; |
| [920](#L920) | var ecl = {}; |
| [921](#L921) |  |
| [922](#L922) | var def\_color = designer.data('dc'); |
| [923](#L923) |  |
| [924](#L924) | $(designer).find('.ecd\_row').each(function(){ |
| [925](#L925) | $(this).data('r', count).attr('data-r', count); |
| [926](#L926) |  |
| [927](#L927) | ecl[ count ] = {}; |
| [928](#L928) | $(this).find('.ecd\_row\_box').each(function(){ |
| [929](#L929) | ecl[ count ][ $(this).data('b') ] = { |
| [930](#L930) | 'n': $(this).data('n'), |
| [931](#L931) | 'h': $(this).data('h'), |
| [932](#L932) | 'c': ( def\_color == $(this).data('c') ? '' : $(this).data('c')) |
| [933](#L933) | }; |
| [934](#L934) | }); |
| [935](#L935) |  |
| [936](#L936) | count++; |
| [937](#L937) | }); |
| [938](#L938) |  |
| [939](#L939) | $('#evo\_card\_fields').val( JSON.stringify(ecl) ); |
| [940](#L940) | } |
| [941](#L941) |  |
| [942](#L942) | init(); |
| [943](#L943) | }; |
| [944](#L944) |  |
| [945](#L945) | $('.evo\_card\_designer').evo\_card\_designer(); |
| [946](#L946) |  |
| [947](#L947) | // Settings > Support |
| [948](#L948) | $('.evotrouble\_left').on('click','h5',function(){ |
| [949](#L949) | $(this).next('p').toggle(); |
| [950](#L950) | }); |
| [951](#L951) |  |
| [952](#L952) | // LANGUAGE SETTINGS |
| [953](#L953) | // language tab |
| [954](#L954) | $('.eventon\_cl\_input').focus(function(){ |
| [955](#L955) | $(this).parent().addClass('onfocus'); |
| [956](#L956) | }); |
| [957](#L957) | $('.eventon\_cl\_input').blur(function(){ |
| [958](#L958) | $(this).parent().removeClass('onfocus'); |
| [959](#L959) | }); |
| [960](#L960) |  |
| [961](#L961) | // change language |
| [962](#L962) | $('#evo\_lang\_selection').change(function(){ |
| [963](#L963) | var val = $(this).val(); |
| [964](#L964) | var url = $(this).data('url'); |
| [965](#L965) |  |
| [966](#L966) | window.location.replace(url+'?page=eventon-lang&lang='+val); |
| [967](#L967) | }); |
| [968](#L968) |  |
| [969](#L969) | // duplicate editing |
| [970](#L970) | if( $('body').find('.eventon\_cl\_input').length>0){ |
| [971](#L971) | $('.eventon\_cl\_input').on('change paste keyup',function(){ |
| [972](#L972) | const n = $(this).data('n'); |
| [973](#L973) | $('body').find('.eventon\_cl\_input.'+ n).val( $(this).val() ); |
| [974](#L974) | }); |
| [975](#L975) | } |
| [976](#L976) |  |
| [977](#L977) | // toggeling language subheaders |
| [978](#L978) | $('.evo\_settings\_toghead').on('click',function(){ |
| [979](#L979) | $(this).next('.evo\_settings\_togbox').toggle(); |
| [980](#L980) | $(this).toggleClass('open'); |
| [981](#L981) | }); |
| [982](#L982) |  |
| [983](#L983) | // search |
| [984](#L984) | $('.evo\_lang\_search\_in').on('change keyup paste',function(){ |
| [985](#L985) | var searchval = $(this).val(); |
| [986](#L986) |  |
| [987](#L987) | $('#evcal\_2').find('.eventon\_cl\_input').each(function(){ |
| [988](#L988) | line = $(this).closest('.eventon\_custom\_lang\_line '); |
| [989](#L989) | box = $(this).closest('.evo\_settings\_togbox'); |
| [990](#L990) | bar = box.siblings('.evo\_settings\_toghead'); |
| [991](#L991) |  |
| [992](#L992) | if( searchval == ''){ |
| [993](#L993) | line.show(); |
| [994](#L994) | }else{ |
| [995](#L995) | line.hide(); |
| [996](#L996) | var thistext = $(this).data('n'); |
| [997](#L997) | if( thistext.indexOf( searchval ) != -1 ){ |
| [998](#L998) | line.show(); |
| [999](#L999) | box.toggle(); |
| [1000](#L1000) | bar.toggleClass('open'); |
| [1001](#L1001) | } |
| [1002](#L1002) | console.log(thistext+' '+searchval); |
| [1003](#L1003) | } |
| [1004](#L1004) | }); |
| [1005](#L1005) | }); |
| [1006](#L1006) |  |
| [1007](#L1007) | // export language |
| [1008](#L1008) | $('body').on('click','.evo\_lang\_export\_btn', function(){ |
| [1009](#L1009) | string = {}; |
| [1010](#L1010) | var tmpArr = []; |
| [1011](#L1011) | var tmpStr = ''; |
| [1012](#L1012) | var csvData = []; |
| [1013](#L1013) |  |
| [1014](#L1014) | type = $(this).data('t'); |
| [1015](#L1015) |  |
| [1016](#L1016) | if(type == 'var'){ |
| [1017](#L1017) | $('#evcal\_2').find('input').each(function(){ |
| [1018](#L1018) | csvData.push( $(this).attr('name')+','+ $(this).val()); |
| [1019](#L1019) | }); |
| [1020](#L1020) | }else{ |
| [1021](#L1021) | $('#evcal\_2').find('input').each(function(){ |
| [1022](#L1022) | field = $(this).attr('for'); |
| [1023](#L1023) | if( field === undefined) field = $(this).attr('name'); |
| [1024](#L1024) | csvData.push( field +','+ $(this).val()); |
| [1025](#L1025) | }); |
| [1026](#L1026) | } |
| [1027](#L1027) |  |
| [1028](#L1028) | var output = csvData.join('\n'); |
| [1029](#L1029) | var uri = 'data:application/csv;charset=UTF-8,' + encodeURIComponent(output); |
| [1030](#L1030) | //window.open(uri); |
| [1031](#L1031) | $(this).attr({ |
| [1032](#L1032) | 'download':'evo\_lang\_'+$('#evo\_lang\_selection').val()+'.csv', |
| [1033](#L1033) | 'href':uri, |
| [1034](#L1034) | 'target':'\_blank' |
| [1035](#L1035) | }); |
| [1036](#L1036) | }); |
| [1037](#L1037) |  |
| [1038](#L1038) | // import language |
| [1039](#L1039) | $('body').on('evo\_data\_uploader\_submitted', function(event, reader\_event, msg\_elm, upload\_box){ |
| [1040](#L1040) |  |
| [1041](#L1041) | if( $(upload\_box).data('id') != 'evo\_language\_upload') return; |
| [1042](#L1042) |  |
| [1043](#L1043) | var csvData = reader\_event.target.result; |
| [1044](#L1044) |  |
| [1045](#L1045) | var allTextLines = csvData.split(/\r\n|\n/); |
| [1046](#L1046) | //console.log(allTextLines[0]); |
| [1047](#L1047) | for (var i=0; i<allTextLines.length; i++) { |
| [1048](#L1048) | var data = allTextLines[i].split(','); |
| [1049](#L1049) |  |
| [1050](#L1050) | // update new values |
| [1051](#L1051) |  |
| [1052](#L1052) | $('#evcal\_2').find('input[name="'+data[0]+'"]').val(data[1]); // for vars |
| [1053](#L1053) | $('#evcal\_2').find('input[for="'+data[0]+'"]').val(data[1]); // for text strings |
| [1054](#L1054) |  |
| [1055](#L1055) | msg\_elm.html('Updating language values.'); |
| [1056](#L1056) | } |
| [1057](#L1057) |  |
| [1058](#L1058) | msg\_elm.html('Language fields updated. Please save changes.'); |
| [1059](#L1059) | }); |
| [1060](#L1060) |  |
| [1061](#L1061) |  |
| [1062](#L1062) |  |
| [1063](#L1063) | function processData(allText) { |
| [1064](#L1064) | var allTextLines = allText.split(/\r\n|\n/); |
| [1065](#L1065) | var headers = allTextLines[0].split(','); |
| [1066](#L1066) | var lines = []; |
| [1067](#L1067) |  |
| [1068](#L1068) | for (var i=1; i<allTextLines.length; i++) { |
| [1069](#L1069) | var data = allTextLines[i].split(','); |
| [1070](#L1070) | if (data.length == headers.length) { |
| [1071](#L1071) |  |
| [1072](#L1072) | var tarr = []; |
| [1073](#L1073) | for (var j=0; j<headers.length; j++) { |
| [1074](#L1074) | tarr.push(headers[j]+":"+data[j]); |
| [1075](#L1075) | } |
| [1076](#L1076) | lines.push(tarr); |
| [1077](#L1077) | } |
| [1078](#L1078) | } |
| [1079](#L1079) | console.log(lines); |
| [1080](#L1080) | } |
| [1081](#L1081) |  |
| [1082](#L1082) | }); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/eventon-lite/trunk/assets/js/admin/wp_admin.js?format=txt)
* [Original Format](/export/3220385/eventon-lite/trunk/assets/js/admin/wp_admin.js)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_e11570b4_20250110_183204.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Feventon-lite%2Ftrunk%2Fincludes%2Fcalendar%2Fclass-calendar-event-structure.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php?rev=3129747 "Revision 3129747")
* Next Revision →
* [Blame](/browser/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php)

---

# [source:](/browser?order=name "Go to repository root") [eventon-lite](/browser/eventon-lite?order=name "View eventon-lite")/[trunk](/browser/eventon-lite/trunk?order=name "View trunk")/[includes](/browser/eventon-lite/trunk/includes?order=name "View includes")/[calendar](/browser/eventon-lite/trunk/includes/calendar?order=name "View calendar")/[class-calendar-event-structure.php](/browser/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php?order=name "View class-calendar-event-structure.php")

View diff against:

View revision:

| [Last change](/changeset/3147272/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php "View differences") on this file was [3147272](/changeset/3147272/ "View changeset 3147272"), checked in by ashanjay, [4 months ago](/timeline?from=2024-09-05T20%3A34%3A42Z&precision=second "See timeline at 09/05/2024 08:34:42 PM") |
| --- |
| 2.2.21 (2024-9-5) FIXED: event list with tiles layout styles FIXED: ssl check for google fonts loading in admin FIXED: live now events breaking the view FIXED: backend button styles UPDATED: eventtop layout design  UPDATED: how the evo\_helper() is called |
| * Property **svn:eol-style** set to   *`native`* | |
| **File size:** 45.0 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Calendar single event's html structure |
| [4](#L4) | \* @version L 2.2.21 |
| [5](#L5) | \*/ |
| [6](#L6) |  |
| [7](#L7) | class EVO\_Cal\_Event\_Structure{ |
| [8](#L8) | private $EVENT; |
| [9](#L9) | private $timezone = ''; |
| [10](#L10) | private $ev\_tz = ''; |
| [11](#L11) | private $timezone\_data = array(); |
| [12](#L12) | public $helper, $help; |
| [13](#L13) |  |
| [14](#L14) | private $OO = array(); |
| [15](#L15) | private $OO2 = array(); |
| [16](#L16) |  |
| [17](#L17) | public function \_\_construct($EVENT=''){ |
| [18](#L18) |  |
| [19](#L19) | $this->timezone\_data = array( |
| [20](#L20) | '\_\_f'=>'YYYY-MM-DD h:mm:a', |
| [21](#L21) | '\_\_df'=> 'YYYY-MM-DD', |
| [22](#L22) | '\_\_tf'=> 'h:mm:a', |
| [23](#L23) | '\_\_t'=> evo\_lang('View in my time') |
| [24](#L24) | ); |
| [25](#L25) |  |
| [26](#L26) | if(!empty($EVENT)) $this->EVENT = $EVENT; |
| [27](#L27) |  |
| [28](#L28) | $this->timezone = get\_option('gmt\_offset', 0); |
| [29](#L29) | $this->ev\_tz = $EVENT->get\_timezone\_key(); |
| [30](#L30) |  |
| [31](#L31) | $this->helper = $this->help = EVO()->helper; |
| [32](#L32) | } |
| [33](#L33) |  |
| [34](#L34) |  |
| [35](#L35) | // HTML EventTop |
| [36](#L36) | function get\_event\_top($array, $EventData, $eventtop\_fields, $evOPT, $evOPT2){ |
| [37](#L37) |  |
| [38](#L38) | $EVENT = $this->EVENT; |
| [39](#L39) | $SC = EVO()->calendar->shortcode\_args; |
| [40](#L40) | $OT = ''; |
| [41](#L41) | $\_additions = apply\_filters('evo\_eventtop\_adds' , array()); |
| [42](#L42) |  |
| [43](#L43) | $is\_array\_eventtop\_fields = is\_array($eventtop\_fields)? true:false; |
| [44](#L44) |  |
| [45](#L45) | extract($EventData); |
| [46](#L46) |  |
| [47](#L47) | if(!is\_array($array)) return $OT; |
| [48](#L48) |  |
| [49](#L49) | EVO()->cal->set\_cur('evcal\_1'); |
| [50](#L50) |  |
| [51](#L51) |  |
| [52](#L52) | foreach($array as $element =>$elm){ |
| [53](#L53) |  |
| [54](#L54) | if(!is\_array($elm)) continue; |
| [55](#L55) |  |
| [56](#L56) |  |
| [57](#L57) | // convert to an object |
| [58](#L58) | $object = new stdClass(); |
| [59](#L59) | foreach ($elm as $key => $value){ |
| [60](#L60) | $object->$key = $value; |
| [61](#L61) | } |
| [62](#L62) |  |
| [63](#L63) | $boxname = (in\_array($element, $\_additions))? $element: null; |
| [64](#L64) |  |
| [65](#L65) | switch($element){ |
| [66](#L66) | case has\_filter("eventon\_eventtop\_{$boxname}"): |
| [67](#L67) | $helpers = array( |
| [68](#L68) | 'evOPT'=>$evOPT, |
| [69](#L69) | 'evoOPT2'=>$evOPT2, |
| [70](#L70) | ); |
| [71](#L71) |  |
| [72](#L72) | $OT.= apply\_filters("eventon\_eventtop\_{$boxname}", $object, $helpers, $EVENT); |
| [73](#L73) | break; |
| [74](#L74) | case 'ft\_img': |
| [75](#L75) | $url = !empty($object->url\_med)? $object->url\_med: $object->url; |
| [76](#L76) | //$url = !empty($object->url\_full)? $object->url\_full[0]: $url; |
| [77](#L77) | $url = apply\_filters('eventon\_eventtop\_image\_url', $url); |
| [78](#L78) |  |
| [79](#L79) | $time\_vals = ( $object->show\_time) ? '<span class="evo\_img\_time"></span>':''; |
| [80](#L80) |  |
| [81](#L81) | $OT .= "<span class='evoet\_c1 evoet\_cx '>"; |
| [82](#L82) | $OT.= "<span class='ev\_ftImg' data-img='".(!empty($object->url\_full)? $object->url\_full: '')."' data-thumb='".$url."' style='background-image:url(\"".$url."\")' >{$time\_vals}</span>"; |
| [83](#L83) | $OT .= "</span>"; |
| [84](#L84) |  |
| [85](#L85) | break; |
| [86](#L86) | case 'day\_block': |
| [87](#L87) |  |
| [88](#L88) | if(!empty($object->include) && !$object->include) break; |
| [89](#L89) | if(!is\_array( $object->start )) break; |
| [90](#L90) |  |
| [91](#L91) | // if event hide\_et\_dn |
| [92](#L92) | if( isset($SC['hide\_et\_dn']) && $SC['hide\_et\_dn'] == 'yes') break; |
| [93](#L93) |  |
| [94](#L94) | $OT .= "<span class='evoet\_c2 evoet\_cx '>"; |
| [95](#L95) | $OT.="<span class='evoet\_dayblock evcal\_cblock ".( $year\_long?'yrl ':null).( $month\_long?'mnl ':null)."' data-bgcolor='".$color."' data-smon='".$object->start['F']."' data-syr='".$object->start['Y']."'>"; |
| [96](#L96) |  |
| [97](#L97) | // include dayname if allowed via settings |
| [98](#L98) | $daynameS = $daynameE = ''; |
| [99](#L99) | if( is\_array($eventtop\_fields) && in\_array('dayname', $eventtop\_fields)){ |
| [100](#L100) | $daynameS = (!empty($object->html['start']['day'])? $object->html['start']['day']:''); |
| [101](#L101) | $daynameE = (!empty($object->html['end']['day'])? $object->html['end']['day']:''); |
| [102](#L102) | } |
| [103](#L103) |  |
| [104](#L104) | $time\_data = apply\_filters('evo\_eventtop\_dates', array( |
| [105](#L105) | 'start'=>array( |
| [106](#L106) | 'year'=>        ($object->show\_start\_year=='yes'? $object->html['start']['year']:''), |
| [107](#L107) | 'day'=>         $daynameS, |
| [108](#L108) | 'date'=>        (!empty($object->html['start']['date'])?$object->html['start']['date']:''), |
| [109](#L109) | 'month'=>       (!empty($object->html['start']['month'])?$object->html['start']['month']:''), |
| [110](#L110) | 'time'=>        (!empty($object->html['start']['time'])?$object->html['start']['time']:''), |
| [111](#L111) | ), |
| [112](#L112) | 'end'=>array( |
| [113](#L113) | 'year'=>        (($object->show\_end\_year=='yes' && !empty($object->html['end']['year']) )? $object->html['end']['year']:''), |
| [114](#L114) | 'day'=>         $daynameE, |
| [115](#L115) | 'date'=>        (!empty($object->html['end']['date'])?$object->html['end']['date']:''), |
| [116](#L116) | 'month'=>       (!empty($object->html['end']['month'])? $object->html['end']['month']:''), |
| [117](#L117) | 'time'=>        (!empty($object->html['end']['time'])? $object->html['end']['time']:''), |
| [118](#L118) | ), |
| [119](#L119) | ), $object->show\_start\_year, $object ); |
| [120](#L120) |  |
| [121](#L121) | $class\_add = ''; |
| [122](#L122) | foreach($time\_data as $type=>$data){ |
| [123](#L123) | $end\_content = ''; |
| [124](#L124) | foreach($data as $field=>$value){ |
| [125](#L125) | if(empty($value)) continue; |
| [126](#L126) | $end\_content .= "<em class='{$field}'>{$value}</em>"; |
| [127](#L127) | } |
| [128](#L128) |  |
| [129](#L129) | if($type == 'end' && empty($data['year']) && empty($data['month']) && empty($data['date']) && !empty($data['time'])){ |
| [130](#L130) | $class\_add = 'only\_time'; |
| [131](#L131) | } |
| [132](#L132) | if(empty($end\_content)) continue; |
| [133](#L133) | $OT .= "<span class='evo\_{$type} {$class\_add}'>"; |
| [134](#L134) | $OT .= $end\_content; |
| [135](#L135) | $OT .= "</span>"; |
| [136](#L136) | } |
| [137](#L137) |  |
| [138](#L138) | $OT .= "</span>"; |
| [139](#L139) | $OT .= "</span>"; |
| [140](#L140) |  |
| [141](#L141) | break; |
| [142](#L142) |  |
| [143](#L143) | // title section of the event top |
| [144](#L144) | case 'titles': |
| [145](#L145) |  |
| [146](#L146) | // location attributes |
| [147](#L147) | $event\_location\_variables = ''; |
| [148](#L148) | if(!empty($location\_name) && (!empty($location\_address) || !empty($location\_latlng))){ |
| [149](#L149) | $LL = !empty($location\_latlng)? $location\_latlng:false; |
| [150](#L150) |  |
| [151](#L151) | if(!empty($location\_address)) $event\_location\_variables .= ' data-location\_address="'.$location\_address.'" '; |
| [152](#L152) | $event\_location\_variables .= ($LL)? 'data-location\_type="lonlat"': 'data-location\_type="address"'; |
| [153](#L153) | $event\_location\_variables .= ' data-location\_name="'.$location\_name.'"'; |
| [154](#L154) | if(isset($location\_url))        $event\_location\_variables .= ' data-location\_url="'.$location\_url.'"'; |
| [155](#L155) | $event\_location\_variables .= ' data-location\_status="true"'; |
| [156](#L156) |  |
| [157](#L157) | if( $LL){ |
| [158](#L158) | $event\_location\_variables .= ' data-latlng="'.$LL.'"'; |
| [159](#L159) | } |
| [160](#L160) |  |
| [161](#L161) | $OT.= "<span class='event\_location\_attrs' {$event\_location\_variables}></span>"; |
| [162](#L162) | } |
| [163](#L163) |  |
| [164](#L164) | $OT.= "<span class='evoet\_c3 evoet\_cx evcal\_desc evo\_info ". ( $year\_long?'yrl ':null).( $month\_long?'mnl ':null)."' >"; |
| [165](#L165) |  |
| [166](#L166) |  |
| [167](#L167) |  |
| [168](#L168) | // above title inserts |
| [169](#L169) | if( isset($SC['hide\_et\_tags']) && $SC['hide\_et\_tags'] == 'yes'): else: |
| [170](#L170) |  |
| [171](#L171) | $OT.= "<span class='evoet\_tags evo\_above\_title'>"; |
| [172](#L172) |  |
| [173](#L173) | // live now virtual event 2.2.14 |
| [174](#L174) | if($EVENT && !$EVENT->is\_cancelled() && $EVENT->is\_event\_live\_now() && !EVO()->cal->check\_yn('evo\_hide\_live') ){ |
| [175](#L175) | $OT.= "<span class='evo\_live\_now' title='".( evo\_lang('Live Now')  )."'>". EVO()->elements->get\_icon('live') ."</span>"; |
| [176](#L176) | } |
| [177](#L177) |  |
| [178](#L178) |  |
| [179](#L179) | // get set to hide event top tags |
| [180](#L180) | $eventtop\_hidden\_tags = isset($evOPT['evo\_etop\_tags']) ? $evOPT['evo\_etop\_tags'] : array(); |
| [181](#L181) |  |
| [182](#L182) | $OT .= apply\_filters("eventon\_eventtop\_abovetitle", '', $object, $EVENT, $eventtop\_hidden\_tags); |
| [183](#L183) |  |
| [184](#L184) | $eventtop\_tags = apply\_filters('eventon\_eventtop\_abovetitle\_tags', array()); |
| [185](#L185) |  |
| [186](#L186) | // status |
| [187](#L187) | if( $\_status && $\_status != 'scheduled'){ |
| [188](#L188) | $eventtop\_tags['status'] = array( |
| [189](#L189) | $EVENT->get\_event\_status\_lang(), |
| [190](#L190) | $\_status |
| [191](#L191) | ); |
| [192](#L192) | } |
| [193](#L193) |  |
| [194](#L194) | // featured |
| [195](#L195) | if(!empty($featured) && $featured){ |
| [196](#L196) | $eventtop\_tags['featured'] = array(evo\_lang('Featured') ); |
| [197](#L197) | } |
| [198](#L198) |  |
| [199](#L199) | // virtual |
| [200](#L200) | if( $EVENT && $EVENT->is\_virtual() ){ |
| [201](#L201) | if( $EVENT->is\_mixed\_attendance()){ |
| [202](#L202) | $eventtop\_tags['virtual\_physical'] = |
| [203](#L203) | array(evo\_lang('Virtual/ Physical Event'), 'vir'        ); |
| [204](#L204) | }else{ |
| [205](#L205) | $eventtop\_tags['virtual'] = array(evo\_lang('Virtual Event'), 'vir'      ); |
| [206](#L206) | } |
| [207](#L207) |  |
| [208](#L208) | } |
| [209](#L209) |  |
| [210](#L210) |  |
| [211](#L211) | foreach($eventtop\_tags as $ff=>$vv){ |
| [212](#L212) |  |
| [213](#L213) | if(in\_array($ff, $eventtop\_hidden\_tags)) continue; |
| [214](#L214) |  |
| [215](#L215) | $v1 = isset($vv[1]) ? ' '.$vv[1]:''; |
| [216](#L216) | $OT.= "<span class='evo\_event\_headers {$ff}{$v1}'>". $vv[0] . "</span>"; |
| [217](#L217) | } |
| [218](#L218) |  |
| [219](#L219) |  |
| [220](#L220) |  |
| [221](#L221) | $OT.="</span>"; |
| [222](#L222) |  |
| [223](#L223) | endif; |
| [224](#L224) |  |
| [225](#L225) |  |
| [226](#L226) | $OT.= "<span class='evoet\_title evcal\_desc2 evcal\_event\_title' itemprop='name'>". apply\_filters('eventon\_eventtop\_maintitle',$EVENT->get\_title() ) ."</span>"; |
| [227](#L227) |  |
| [228](#L228) | // below title inserts |
| [229](#L229) | $OT.= "<span class='evoet\_subtitle evo\_below\_title'>"; |
| [230](#L230) | if($ST = $EVENT->get\_subtitle()){ |
| [231](#L231) | $OT.= "<span class='evcal\_event\_subtitle' >" . apply\_filters('eventon\_eventtop\_subtitle' , $ST) ."</span>"; |
| [232](#L232) | } |
| [233](#L233) |  |
| [234](#L234) | // event status reason |
| [235](#L235) | if( $reason = $EVENT->get\_status\_reason()){ |
| [236](#L236) | $OT.= '<span class="status\_reason">'. $reason .'</span>'; |
| [237](#L237) | } |
| [238](#L238) |  |
| [239](#L239) | $OT.="</span>"; |
| [240](#L240) | break; |
| [241](#L241) |  |
| [242](#L242) | case 'belowtitle': |
| [243](#L243) |  |
| [244](#L244) | if(!$object->include) break; |
| [245](#L245) |  |
| [246](#L246) |  |
| [247](#L247) | if( isset($SC['hide\_et\_tl']) && $SC['hide\_et\_tl'] == 'yes'):else: |
| [248](#L248) |  |
| [249](#L249) | $OT.= "<span class='evoet\_time\_expand level\_3 evcal\_desc\_info' >"; |
| [250](#L250) |  |
| [251](#L251) | // time |
| [252](#L252) | if($is\_array\_eventtop\_fields && in\_array('time', $eventtop\_fields) && isset($object->html)){ |
| [253](#L253) |  |
| [254](#L254) | // time |
| [255](#L255) | $timezone\_text = (!empty($object->timezone)? ' <em class="evo\_etop\_timezone">'.$object->timezone. '</em>':null); |
| [256](#L256) |  |
| [257](#L257) | //print\_r($object); |
| [258](#L258) | $tzo = $tzo\_box = ''; |
| [259](#L259) |  |
| [260](#L260) | // custom timezone text |
| [261](#L261) | if( !EVO()->cal->check\_yn('evo\_gmt\_hide','evcal\_1') && !empty($this->ev\_tz) ){ |
| [262](#L262) |  |
| [263](#L263) | $GMT\_text = $this->help->get\_timezone\_gmt( $this->ev\_tz , $EVENT->start\_unix); |
| [264](#L264) | $timezone\_text .= "<span class='evo\_tz'>(". $GMT\_text .")</span>"; |
| [265](#L265) | } |
| [266](#L266) |  |
| [267](#L267) | // event time |
| [268](#L268) | $OT.= "<em class='evcal\_time evo\_tz\_time level\_4'>". apply\_filters('evoeventtop\_belowtitle\_datetime', $object->html['html\_fromto'], $object->html, $object) . $timezone\_text ."</em> "; |
| [269](#L269) |  |
| [270](#L270) | // view in my time - local time |
| [271](#L271) | if( !empty($this->ev\_tz) && EVO()->cal->check\_yn('evo\_show\_localtime','evcal\_1') ){ |
| [272](#L272) |  |
| [273](#L273) | $OT.= $this->get\_view\_my\_time\_content( $this->timezone\_data , $EVENT->start\_unix, $EVENT->end\_unix); |
| [274](#L274) | } |
| [275](#L275) |  |
| [276](#L276) | // manual timezone text |
| [277](#L277) | if( empty($object->\_evo\_tz)) $OT.= "<em class='evcal\_local\_time' data-s='{$event\_start\_unix}' data-e='{$event\_end\_unix}' data-tz='". $EVENT->get\_prop('\_evo\_tz') ."'></em>"; |
| [278](#L278) | } |
| [279](#L279) |  |
| [280](#L280) |  |
| [281](#L281) | // location information |
| [282](#L282) | if($is\_array\_eventtop\_fields){ |
| [283](#L283) | // location name |
| [284](#L284) | $LOCname = (in\_array('locationame',$eventtop\_fields) && !empty($location\_name) )? $location\_name: false; |
| [285](#L285) |  |
| [286](#L286) | // location address |
| [287](#L287) | $LOCadd = (in\_array('location',$eventtop\_fields) && !empty($location\_address))? stripslashes($location\_address): false; |
| [288](#L288) |  |
| [289](#L289) | if($LOCname || $LOCadd){ |
| [290](#L290) | $OT.= "<span class='evoet\_location level\_4'>"; |
| [291](#L291) | $OT.= '<em class="evcal\_location" '.( !empty($location\_latlng)? ' data-latlng="'.$location\_latlng.'"':null ).' data-add\_str="'.$LOCadd.'">'.($LOCname? '<em class="event\_location\_name">'.$LOCname.'</em>':''). |
| [292](#L292) | ( ($LOCname && $LOCadd)?', ':''). |
| [293](#L293) | $LOCadd.'</em>'; |
| [294](#L294) | $OT.= "</span>"; |
| [295](#L295) | } |
| [296](#L296) | } |
| [297](#L297) |  |
| [298](#L298) | $OT.="</span>"; |
| [299](#L299) | endif; |
| [300](#L300) |  |
| [301](#L301) |  |
| [302](#L302) | if( isset($SC['hide\_et\_extra']) && $SC['hide\_et\_extra'] == 'yes'):else: |
| [303](#L303) | $OT.="<span class='evcal\_desc3'>"; |
| [304](#L304) |  |
| [305](#L305) | //organizer |
| [306](#L306) | if($object->fields\_ && in\_array('organizer',$object->fields) && !empty($event\_organizer) |
| [307](#L307) | ){ |
| [308](#L308) |  |
| [309](#L309) | $OT.="<span class='evcal\_oganizer level\_4'> |
| [310](#L310) | <em><i>".( eventon\_get\_custom\_language( $evOPT2,'evcal\_evcard\_org', 'Event Organized By')  ).':</i></em> |
| [311](#L311) | <em class="evoet\_dataval">'.$event\_organizer->name."</em> |
| [312](#L312) | </span>"; |
| [313](#L313) | } |
| [314](#L314) | //event type |
| [315](#L315) | if($object->tax) |
| [316](#L316) | $OT.= $object->tax; |
| [317](#L317) |  |
| [318](#L318) | // event tags |
| [319](#L319) | if($is\_array\_eventtop\_fields && in\_array('tags',$eventtop\_fields) && !empty($object->tags) ){ |
| [320](#L320) | $OT.="<span class='evo\_event\_tags level\_4'> |
| [321](#L321) | <em><i>".eventon\_get\_custom\_language( $evOPT2,'evo\_lang\_eventtags', 'Event Tags')."</i></em>"; |
| [322](#L322) |  |
| [323](#L323) | $count = count($object->tags); |
| [324](#L324) | $i = 1; |
| [325](#L325) | foreach($object->tags as $tag){ |
| [326](#L326) | $OT.="<em class='evoet\_dataval' data-tagid='{$tag->term\_id}'>{$tag->name}".( ($count==$i)?'':',')."</em>"; |
| [327](#L327) | $i++; |
| [328](#L328) | } |
| [329](#L329) | $OT.="</span>"; |
| [330](#L330) | } |
| [331](#L331) |  |
| [332](#L332) |  |
| [333](#L333) | // event progress bar |
| [334](#L334) | if( !EVO()->cal->check\_yn('evo\_eventtop\_progress\_hide','evcal\_1')  && $EVENT->is\_event\_live\_now() && !$EVENT->is\_cancelled() |
| [335](#L335) | && !$EVENT->echeck\_yn('hide\_progress') |
| [336](#L336) | && $EVENT->get\_event\_status() != 'postponed' |
| [337](#L337) | ){ |
| [338](#L338) |  |
| [339](#L339) |  |
| [340](#L340) | $livenow\_bar\_sc = isset($SC['livenow\_bar']) ? $SC['livenow\_bar'] : 'yes'; |
| [341](#L341) |  |
| [342](#L342) | // check if shortcode livenow\_bar is set to hide live bar |
| [343](#L343) | if($livenow\_bar\_sc == 'yes'): |
| [344](#L344) |  |
| [345](#L345) | $OT.= "<span class='evo\_event\_progress evo\_event\_progress' >"; |
| [346](#L346) |  |
| [347](#L347) | //$OT.= "<span class='evo\_ep\_pre'>". evo\_lang('Live Now') ."</span>"; |
| [348](#L348) |  |
| [349](#L349) | $now =  EVO()->calendar->utc\_time; |
| [350](#L350) | $duration = $EVENT->duration; |
| [351](#L351) | $end\_utc = $EVENT->get\_end\_time( true); |
| [352](#L352) | $gap = $end\_utc - $now; // how far event has progressed |
| [353](#L353) |  |
| [354](#L354) | $perc = $duration == 0? 0: ($duration - $gap) / $duration; |
| [355](#L355) | $perc = (int)( $perc\*100); |
| [356](#L356) | if( $perc > 100) $perc = 100; |
| [357](#L357) |  |
| [358](#L358) | // action on expire |
| [359](#L359) | $exp\_act = $nonce = ''; |
| [360](#L360) | if( isset($SC['cal\_now']) && $SC['cal\_now'] == 'yes'){ |
| [361](#L361) | $exp\_act = 'runajax\_refresh\_now\_cal'; |
| [362](#L362) | $nonce = wp\_create\_nonce('evo\_calendar\_now'); |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) |  |
| [366](#L366) | $OT.= "<span class='evo\_epbar\_o'><span class='evo\_ep\_bar'><b style='width:{$perc}%'></b></span></span>"; |
| [367](#L367) | $OT.= "<span class='evo\_ep\_time evo\_countdowner' data-endutc='{$end\_utc}' data-gap='{$gap}' data-dur='{$duration}' data-exp\_act='". $exp\_act ."' data-n='{$nonce}' data-ds='".evo\_lang('Days')."' data-d='".evo\_lang('Day')."' data-t='". evo\_lang('Time Left')."'></span>"; |
| [368](#L368) |  |
| [369](#L369) | $OT.= "</span>"; |
| [370](#L370) |  |
| [371](#L371) | endif; |
| [372](#L372) |  |
| [373](#L373) | } |
| [374](#L374) |  |
| [375](#L375) | endif; |
| [376](#L376) |  |
| [377](#L377) | break; |
| [378](#L378) |  |
| [379](#L379) | case 'close1': |
| [380](#L380) | $OT.="</span>";// span.evcal\_desc3 |
| [381](#L381) | break; |
| [382](#L382) |  |
| [383](#L383) | case 'close2': |
| [384](#L384) | $OT.= "</span>";// span.evcal\_desc |
| [385](#L385) |  |
| [386](#L386) | $data = array( |
| [387](#L387) | 'bgc'=> $color, |
| [388](#L388) | 'bggrad'=> ( !empty($bggrad)? $bggrad:''), |
| [389](#L389) | ); |
| [390](#L390) |  |
| [391](#L391) | $OT.="<em class='evoet\_data' style='display:none' ". $this->help->array\_to\_html\_data( $data ) ."></em>"; |
| [392](#L392) | //$OT.="<em class='clear'></em>"; |
| [393](#L393) | break; |
| [394](#L394) | } |
| [395](#L395) | } |
| [396](#L396) |  |
| [397](#L397) | return $OT; |
| [398](#L398) | } |
| [399](#L399) |  |
| [400](#L400) |  |
| [401](#L401) |  |
| [402](#L402) | // EvnetCard HTML |
| [403](#L403) | public function print\_event\_card($array, $EventData, $evOPT, $evoOPT2, $ep\_fields = ''){ |
| [404](#L404) | // INIT |
| [405](#L405) | $EVENT = $this->EVENT; |
| [406](#L406) | $ED = $EventData; |
| [407](#L407) | $evoOPT2 = (!empty($evoOPT2))? $evoOPT2: ''; |
| [408](#L408) | $this->OO = $evOPT; |
| [409](#L409) | $this->OO2 = $evoOPT2; |
| [410](#L410) |  |
| [411](#L411) | $OT =''; |
| [412](#L412) | $count = 1; |
| [413](#L413) | $items = count($array); |
| [414](#L414) |  |
| [415](#L415) | extract($EventData); |
| [416](#L416) |  |
| [417](#L417) | $ep\_fields = !empty($ep\_fields)? explode(',', $ep\_fields): false; |
| [418](#L418) |  |
| [419](#L419) | // close button |
| [420](#L420) | $close = "<div class='evcal\_evdata\_row evcal\_close' title='".eventon\_get\_custom\_language($evoOPT2, 'evcal\_lang\_close','Close')."'></div>"; |
| [421](#L421) |  |
| [422](#L422) | // additional fields array |
| [423](#L423) | $array = apply\_filters('evo\_eventcard\_adds' , $array); |
| [424](#L424) |  |
| [425](#L425) |  |
| [426](#L426) |  |
| [427](#L427) | $RR = ''; |
| [428](#L428) |  |
| [429](#L429) |  |
| [430](#L430) | // get event card designer fields |
| [431](#L431) | $eventcard\_fields = EVO()->calendar->helper->get\_eventcard\_fields\_array(); |
| [432](#L432) |  |
| [433](#L433) | $already\_printed\_boxes = array(); |
| [434](#L434) |  |
| [435](#L435) | if( !is\_array($eventcard\_fields)) return; |
| [436](#L436) |  |
| [437](#L437) | $processed\_fields = array(); |
| [438](#L438) |  |
| [439](#L439) | $rows = count($eventcard\_fields); |
| [440](#L440) | $i = 1; |
| [441](#L441) | foreach( $eventcard\_fields as $R=>$boxes){ |
| [442](#L442) |  |
| [443](#L443) | $CC = ''; |
| [444](#L444) | $box\_count = 0; |
| [445](#L445) |  |
| [446](#L446) | $opened = false; |
| [447](#L447) |  |
| [448](#L448) | foreach( $boxes as $B=>$box){ |
| [449](#L449) |  |
| [450](#L450) | if( !isset($box['n'])) continue; |
| [451](#L451) | $NN = $box['n']; |
| [452](#L452) | if( isset($box['h']) && $box['h'] =='y' ) continue; |
| [453](#L453) |  |
| [454](#L454) | // record printed boxes to avoid duplicate |
| [455](#L455) | if( in\_array($box['n'], $already\_printed\_boxes)) continue; |
| [456](#L456) | if(!in\_array($box['n'], $already\_printed\_boxes)) $already\_printed\_boxes[] = $box['n']; |
| [457](#L457) |  |
| [458](#L458) | // get box data |
| [459](#L459) | if( !array\_key\_exists($NN, $array)) continue; |
| [460](#L460) |  |
| [461](#L461) | $BD = $array[ $NN ]; |
| [462](#L462) | // convert to an object |
| [463](#L463) | $BDO = new stdClass(); |
| [464](#L464) | foreach ($BD as $key => $value){ |
| [465](#L465) | $BDO->$key = $value; |
| [466](#L466) | } |
| [467](#L467) |  |
| [468](#L468) | // if only specific fields set |
| [469](#L469) | if( $ep\_fields && !in\_array($NN, $ep\_fields) ) continue; |
| [470](#L470) |  |
| [471](#L471) | // if already processed |
| [472](#L472) | if( in\_array( $NN, $processed\_fields)) continue; |
| [473](#L473) | $processed\_fields[] = $NN; |
| [474](#L474) |  |
| [475](#L475) | // box content |
| [476](#L476) | $BCC = $this->get\_eventcard\_box\_content( $NN, $BDO, $EVENT , $EventData); |
| [477](#L477) |  |
| [478](#L478) | if( empty($BCC)) continue; |
| [479](#L479) |  |
| [480](#L480) | $color = isset($box['c']) ? $box['c']:''; |
| [481](#L481) |  |
| [482](#L482) | if( $B == 'L1' || $B == 'R1'){ |
| [483](#L483) | $CC .= "<div class='evocard\_box\_h'>"; |
| [484](#L484) | $opened = true; |
| [485](#L485) | } |
| [486](#L486) |  |
| [487](#L487) | $CC .= "<div class='evocard\_box ". esc\_attr( $NN )."' data-c='". esc\_attr( $color ) ."' |
| [488](#L488) | style='". (!empty($color) ? "background-color:#". esc\_attr( $color )."":'') ."'>". $BCC . "</div>"; |
| [489](#L489) |  |
| [490](#L490) | if( $B == 'L2' || $B == 'R2' && $opened){ |
| [491](#L491) | $CC .= "</div>"; $opened = false; |
| [492](#L492) | } |
| [493](#L493) | $box\_count++; |
| [494](#L494) | } |
| [495](#L495) |  |
| [496](#L496) | if( $opened ) $CC .= "</div>"; |
| [497](#L497) | if( empty($CC)) continue; |
| [498](#L498) |  |
| [499](#L499) | $row\_class = array('evocard\_row'); |
| [500](#L500) | if($box\_count>1) $row\_class[] ='bx'.$box\_count; |
| [501](#L501) | if($box\_count>1) $row\_class[] ='bx'; |
| [502](#L502) | if( array\_key\_exists('L1', $boxes)) $row\_class[] = 'L'; |
| [503](#L503) | if($i == $rows)  $row\_class[] = 'lastrow'; |
| [504](#L504) |  |
| [505](#L505) | $RR .= "<div class='". esc\_attr( implode(' ', $row\_class) ) ."'>"; |
| [506](#L506) | $RR .= $CC; |
| [507](#L507) | $RR .= "</div>"; |
| [508](#L508) | $i++; |
| [509](#L509) | } |
| [510](#L510) |  |
| [511](#L511) | $RR .= "<div class='evo\_card\_row\_end evcal\_close' title='".eventon\_get\_custom\_language($evoOPT2, 'evcal\_lang\_close','Close')."'></div>"; |
| [512](#L512) |  |
| [513](#L513) | echo  $RR; |
| [514](#L514) | } |
| [515](#L515) |  |
| [516](#L516) | // return box HTML content using box field name |
| [517](#L517) | function get\_eventcard\_box\_content($box\_name, $box\_data, $EVENT, $EventData){ |
| [518](#L518) |  |
| [519](#L519) | $OT = ''; |
| [520](#L520) | $evOPT = $this->OO; |
| [521](#L521) | $evoOPT2 = $this->OO2; |
| [522](#L522) | $object = $box\_data; |
| [523](#L523) | $end\_row\_class = $end = ''; |
| [524](#L524) | $ED = $EventData; |
| [525](#L525) |  |
| [526](#L526) | extract($EventData); |
| [527](#L527) |  |
| [528](#L528) |  |
| [529](#L529) | // each eventcard type |
| [530](#L530) | switch($box\_name){ |
| [531](#L531) |  |
| [532](#L532) | // addition |
| [533](#L533) | case has\_filter("eventon\_eventCard\_{$box\_name}"): |
| [534](#L534) |  |
| [535](#L535) | $helpers = array( |
| [536](#L536) | 'evOPT'=> $evOPT, |
| [537](#L537) | 'evoOPT2'=>$evoOPT2, |
| [538](#L538) | 'end\_row\_class'=> '','end'=>'', |
| [539](#L539) | ); |
| [540](#L540) |  |
| [541](#L541) | $OT.= apply\_filters("eventon\_eventCard\_{$box\_name}", $object, $helpers, $EVENT); |
| [542](#L542) | break; |
| [543](#L543) |  |
| [544](#L544) | // Event Details |
| [545](#L545) | case 'eventdetails': |
| [546](#L546) |  |
| [547](#L547) | $more\_code=''; $evo\_more\_active\_class = ''; |
| [548](#L548) |  |
| [549](#L549) | // check if character length of description is longer than X size |
| [550](#L550) | if( !empty($evOPT['evo\_morelass']) && $evOPT['evo\_morelass']!='yes' && (strlen($object->fulltext) )>600 ){ |
| [551](#L551) | $more\_code = |
| [552](#L552) | "<p class='eventon\_shad\_p' style='padding:5px 0 0; margin:0'> |
| [553](#L553) | <span class='evcal\_btn evo\_btn\_secondary evobtn\_details\_show\_more' content='less'> |
| [554](#L554) | <span class='ev\_more\_text' data-txt='".evo\_lang\_get('evcal\_lang\_less','less')."'>".evo\_lang\_get('evcal\_lang\_more','more')."</span><span class='ev\_more\_arrow ard'></span> |
| [555](#L555) | </span> |
| [556](#L556) | </p>"; |
| [557](#L557) | $evo\_more\_active\_class = 'shorter\_desc'; |
| [558](#L558) | } |
| [559](#L559) |  |
| [560](#L560) | $iconHTML = "<span class='evcal\_evdata\_icons'><i class='fa ". esc\_attr( get\_eventON\_icon('evcal\_\_fai\_001', 'fa-align-justify',$evOPT ) ) ."'></i></span>"; |
| [561](#L561) |  |
| [562](#L562) | $\_full\_event\_details = stripslashes( $object->fulltext ); |
| [563](#L563) |  |
| [564](#L564) |  |
| [565](#L565) | $OT.="<div class='evo\_metarow\_details evorow evcal\_evdata\_row evcal\_event\_details". esc\_attr( $end\_row\_class ) ."'> |
| [566](#L566) | ".$object->excerpt.$iconHTML." |
| [567](#L567) |  |
| [568](#L568) | <div class='evcal\_evdata\_cell ". esc\_attr( $evo\_more\_active\_class )."'> |
| [569](#L569) | <div class='eventon\_full\_description'> |
| [570](#L570) | <h3 class='padb5 evo\_h3'>".$iconHTML . evo\_lang\_get('evcal\_evcard\_details','Event Details')."</h3> |
| [571](#L571) | <div class='eventon\_desc\_in' itemprop='description'> |
| [572](#L572) | ". |
| [573](#L573) |  |
| [574](#L574) | apply\_filters('evo\_eventcard\_details',EVO()->frontend->filter\_evo\_content( $\_full\_event\_details )) |
| [575](#L575) |  |
| [576](#L576) | ."</div>"; |
| [577](#L577) |  |
| [578](#L578) | // pluggable inside event details |
| [579](#L579) | do\_action('eventon\_eventcard\_event\_details'); |
| [580](#L580) |  |
| [581](#L581) | $OT .= $more\_code; |
| [582](#L582) |  |
| [583](#L583) | $OT.="<div class='clear'></div> |
| [584](#L584) | </div> |
| [585](#L585) | </div> |
| [586](#L586) | </div>"; |
| [587](#L587) |  |
| [588](#L588) | break; |
| [589](#L589) |  |
| [590](#L590) | // TIME |
| [591](#L591) | case 'time': |
| [592](#L592) | $iconTime = "<span class='evcal\_evdata\_icons'><i class='fa ". esc\_attr( get\_eventON\_icon('evcal\_\_fai\_002', 'fa-clock-o',$evOPT ) ) ."'></i></span>"; |
| [593](#L593) |  |
| [594](#L594) |  |
| [595](#L595) | // time for event card |
| [596](#L596) | $timezone = (!empty($object->timezone)? ' <em class="evo\_eventcard\_tiemzone">'. $object->timezone.'</em>':null); |
| [597](#L597) |  |
| [598](#L598) | // event time |
| [599](#L599) | $evc\_time\_text = "<span class='evo\_eventcard\_time\_t'>". apply\_filters('evo\_eventcard\_time', $object->timetext. $timezone, $object) . "</span>"; |
| [600](#L600) |  |
| [601](#L601) | // custom timezone text |
| [602](#L602) | if( !EVO()->cal->check\_yn('evo\_gmt\_hide','evcal\_1') && !empty($this->ev\_tz) ){ |
| [603](#L603) |  |
| [604](#L604) | $GMT\_text = $this->help->get\_timezone\_gmt( $this->ev\_tz, $EVENT->start\_unix); |
| [605](#L605) | $evc\_time\_text .= "<span class='evo\_tz'>(". esc\_html( $GMT\_text ) .")</span>"; |
| [606](#L606) | } |
| [607](#L607) |  |
| [608](#L608) | // view in my time - local time |
| [609](#L609) | if( !empty($this->ev\_tz) && EVO()->cal->check\_yn('evo\_show\_localtime','evcal\_1') ){ |
| [610](#L610) |  |
| [611](#L611) | $evc\_time\_text.= $this->get\_view\_my\_time\_content( $this->timezone\_data , $EVENT->start\_unix, $EVENT->end\_unix); |
| [612](#L612) | } |
| [613](#L613) |  |
| [614](#L614) | $OT.="<div class='evo\_metarow\_time evorow evcal\_evdata\_row evcal\_evrow\_sm ". esc\_attr( $end\_row\_class ) ."'> |
| [615](#L615) | {$iconTime} |
| [616](#L616) | <div class='evcal\_evdata\_cell'> |
| [617](#L617) | <h3 class='evo\_h3'>".$iconTime . evo\_lang\_get('evcal\_lang\_time','Time')."</h3><p>".$evc\_time\_text."</p> |
| [618](#L618) | </div> |
| [619](#L619) | </div>"; |
| [620](#L620) | break; |
| [621](#L621) |  |
| [622](#L622) | // location |
| [623](#L623) | case 'location': |
| [624](#L624) | $iconLoc = "<span class='evcal\_evdata\_icons'><i class='fa ". esc\_attr( get\_eventON\_icon('evcal\_\_fai\_003', 'fa-map-marker',$evOPT ) ) ."'></i></span>"; |
| [625](#L625) |  |
| [626](#L626) | if(!empty($EventData['location\_name']) || !empty($EventData['location\_address'])){ |
| [627](#L627) |  |
| [628](#L628) | $locationLink = (!empty($location\_link))? '<a target="'. ($location\_link\_target=='yes'? '\_blank':'') .'" href="'. esc\_url( evo\_format\_link($location\_link) ).'">':false; |
| [629](#L629) |  |
| [630](#L630) | $OT.= |
| [631](#L631) | "<div class='evcal\_evdata\_row evo\_metarow\_time\_location evorow '> |
| [632](#L632) |  |
| [633](#L633) | {$iconLoc} |
| [634](#L634) | <div class='evcal\_evdata\_cell' data-loc\_tax\_id='". esc\_attr( $EventData['location\_term\_id'] )."'>"; |
| [635](#L635) |  |
| [636](#L636) | if( $location\_hide){ |
| [637](#L637) | $OT.= "<h3 class='evo\_h3'>".$iconLoc. evo\_lang\_get('evcal\_lang\_location','Location'). "</h3>"; |
| [638](#L638) | $OT .= "<p class='evo\_location\_name'>". EVO()->calendar->helper->get\_field\_login\_message() . "</p>"; |
| [639](#L639) | }else{ |
| [640](#L640) |  |
| [641](#L641) | $OT.= "<h3 class='evo\_h3'>".$iconLoc.($locationLink? $locationLink:''). evo\_lang\_get('evcal\_lang\_location','Location').($locationLink?'</a>':'')."</h3>"; |
| [642](#L642) |  |
| [643](#L643) | if( !empty($location\_name) && !$EVENT->check\_yn('evcal\_hide\_locname') ) |
| [644](#L644) | $OT.= "<p class='evo\_location\_name'>". $locationLink. $location\_name . ($locationLink? '</a>':'') ."</p>"; |
| [645](#L645) |  |
| [646](#L646) | // for virtual location |
| [647](#L647) | if( $location\_type == 'virtual'){ |
| [648](#L648) | if( $locationLink) |
| [649](#L649) | $OT.= "<p class='evo\_virtual\_location\_url'>" . evo\_lang('URL:'). $locationLink . ' '. $location\_link."</a></p>"; |
| [650](#L650) | }else{ |
| [651](#L651) |  |
| [652](#L652) | if(!empty($location\_address)){ |
| [653](#L653) | $OT .= "<p class='evo\_location\_address'>". $locationLink . stripslashes($location\_address) . ($locationLink? '</a>':'') ."</p>"; |
| [654](#L654) | } |
| [655](#L655) |  |
| [656](#L656) | } |
| [657](#L657) | } |
| [658](#L658) | $OT.= "</div> |
| [659](#L659) |  |
| [660](#L660) | </div>"; |
| [661](#L661) | } |
| [662](#L662) | break; |
| [663](#L663) |  |
| [664](#L664) | // REPEAT SERIES |
| [665](#L665) | case 'repeats': |
| [666](#L666) | $OT.="<div class='evo\_metarow\_repeats evorow evcal\_evdata\_row evcal\_evrow\_sm ". esc\_attr( $end\_row\_class ) ."'> |
| [667](#L667) | <span class='evcal\_evdata\_icons'><i class='fa ". esc\_attr( get\_eventON\_icon('evcal\_\_fai\_repeats', 'fa-repeat',$evOPT ) ) ."'></i></span> |
| [668](#L668) | <div class='evcal\_evdata\_cell'> |
| [669](#L669) | <h3 class='evo\_h3'>". esc\_html( eventon\_get\_custom\_language($evoOPT2, 'evcal\_lang\_repeats','Future Event Times in this Repeating Event Series') ) ."</h3> |
| [670](#L670) | <p class='evo\_repeat\_series\_dates ".($object->clickable?'clickable':'')."'' data-click='". esc\_attr( $object->clickable ) ."' data-event\_url='". esc\_url( $object->event\_permalink )."'>"; |
| [671](#L671) |  |
| [672](#L672) | $datetime = new evo\_datetime(); |
| [673](#L673) |  |
| [674](#L674) | // allow for custom date time format passing to repeat event times |
| [675](#L675) | $repeat\_start\_time\_format = apply\_filters('evo\_eventcard\_repeatseries\_start\_dtformat',''); |
| [676](#L676) | $repeat\_end\_time\_format = apply\_filters('evo\_eventcard\_repeatseries\_end\_dtformat',''); |
| [677](#L677) |  |
| [678](#L678) | foreach($object->future\_intervals as $key=>$interval){ |
| [679](#L679) | $OT .= "<span data-repeat='". esc\_attr( $key )."' data-l='". esc\_url( $EVENT->get\_permalink($key,$EVENT->l) ) ."' class='evo\_repeat\_series\_date'>"; |
| [680](#L680) |  |
| [681](#L681) |  |
| [682](#L682) | if($EVENT->is\_year\_long()){ |
| [683](#L683) | $OT .= gmdate('Y', $interval[0]); |
| [684](#L684) | }elseif( $EVENT->is\_month\_long()){ |
| [685](#L685) |  |
| [686](#L686) | $OT .= $EVENT->get\_readable\_formatted\_date( $interval[0], 'F, Y'); |
| [687](#L687) |  |
| [688](#L688) | }else{ |
| [689](#L689) |  |
| [690](#L690) | $OT .= $EVENT->get\_readable\_formatted\_date( $interval[0], $repeat\_start\_time\_format); |
| [691](#L691) |  |
| [692](#L692) | if( $object->showendtime && !empty($interval[1])){ |
| [693](#L693) |  |
| [694](#L694) | $OT .= ' - '.$EVENT->get\_readable\_formatted\_date( $interval[1], $repeat\_end\_time\_format); |
| [695](#L695) | } |
| [696](#L696) |  |
| [697](#L697) | } |
| [698](#L698) |  |
| [699](#L699) |  |
| [700](#L700) | $OT.= "</span>"; |
| [701](#L701) | } |
| [702](#L702) |  |
| [703](#L703) | $OT.="</p></div></div>"; |
| [704](#L704) | break; |
| [705](#L705) |  |
| [706](#L706) | // Location Image |
| [707](#L707) | case 'locImg': |
| [708](#L708) |  |
| [709](#L709) | if(empty($location\_img\_id)) break; |
| [710](#L710) | $img\_src = wp\_get\_attachment\_image\_src($location\_img\_id,'full'); |
| [711](#L711) | if(empty($img\_src)) break; |
| [712](#L712) |  |
| [713](#L713) | $fullheight = (int)EVO()->calendar->get\_opt1\_prop('evo\_locimgheight',400); |
| [714](#L714) |  |
| [715](#L715) | if(!empty($img\_src)){ |
| [716](#L716) |  |
| [717](#L717) | // text over location image |
| [718](#L718) | $inside = $inner = ''; |
| [719](#L719) | if(!empty($location\_name) && $EVENT->check\_yn('evcal\_name\_over\_img') ){ |
| [720](#L720) |  |
| [721](#L721) | if(!empty($location\_address)) |
| [722](#L722) | $inner .= '<span style="padding-bottom:10px">'. stripslashes($location\_address) .'</span>'; |
| [723](#L723) | if(!empty($location\_description)) |
| [724](#L724) | $inner .= '<span class="location\_description">'. wp\_kses\_post( $location\_description ) .'</span>'; |
| [725](#L725) |  |
| [726](#L726) | $inside = "<p class='evoLOCtxt'><span class='evo\_loc\_text\_title'>{$location\_name}</span>{$inner}</p>"; |
| [727](#L727) | } |
| [728](#L728) | $OT.="<div class='evcal\_evdata\_row evo\_metarow\_locImg evorow ".( !empty($inside)?'tvi':null)."' style='height:{$fullheight}px; background-image:url(". esc\_url( $img\_src[0] ).")' id='". esc\_attr( $location\_img\_id ) ."\_locimg' >{$inside}</div>"; |
| [729](#L729) | } |
| [730](#L730) | break; |
| [731](#L731) |  |
| [732](#L732) | // GOOGLE map |
| [733](#L733) | case 'gmap': |
| [734](#L734) |  |
| [735](#L735) | // since 4.5 |
| [736](#L736) | $is\_google\_map\_good = true; |
| [737](#L737) | if( !EVO()->cal->get\_prop('evo\_gmap\_api\_key','evcal\_1')) $is\_google\_map\_good = false; |
| [738](#L738) |  |
| [739](#L739) | if( !$is\_google\_map\_good ) break; |
| [740](#L740) |  |
| [741](#L741) | if( $EventData['location\_type'] != 'virtual' || !isset($EventData['location\_type'])){ |
| [742](#L742) | $OT.="<div class='evcal\_evdata\_row evo\_metarow\_gmap evorow evcal\_gmaps ". esc\_attr( $object->id ) ."\_gmap' id='". esc\_attr( $object->id ) ."\_gmap' style='max-width:none'></div>"; |
| [743](#L743) | } |
| [744](#L744) | break; |
| [745](#L745) |  |
| [746](#L746) | // Featured image |
| [747](#L747) | case 'ftimage': |
| [748](#L748) |  |
| [749](#L749) | $\_\_hoverclass = (!empty($object->hovereffect) && $object->hovereffect!='yes')? ' evo\_imghover':null; |
| [750](#L750) | $\_\_noclickclass = (!empty($object->clickeffect) && $object->clickeffect=='yes')? ' evo\_noclick':null; |
| [751](#L751) | $\_\_zoom\_cursor = (!empty($evOPT['evo\_ftim\_mag']) && $evOPT['evo\_ftim\_mag']=='yes')? ' evo\_imgCursor':null; |
| [752](#L752) |  |
| [753](#L753) | ob\_start(); |
| [754](#L754) |  |
| [755](#L755) |  |
| [756](#L756) | // if set to direct image |
| [757](#L757) | if(!empty($evOPT['evo\_ftimg\_height\_sty']) && $evOPT['evo\_ftimg\_height\_sty']=='direct'){ |
| [758](#L758) | // ALT Text for the image |
| [759](#L759) | $alt = !empty($object->img\_id)? get\_post\_meta($object->img\_id,'\_wp\_attachment\_image\_alt', true):false; |
| [760](#L760) | $alt = !empty($alt)? 'alt="'. esc\_html( $alt ) .'"': ''; |
| [761](#L761) | echo "<div class='evo\_metarow\_directimg evcal\_evdata\_row'><img class='evo\_event\_main\_img' src='". esc\_url( $object->img )."' ".  $alt ."/></div>"; |
| [762](#L762) | }else{ |
| [763](#L763) |  |
| [764](#L764) | // make sure image array object passed |
| [765](#L765) | if( $object->main\_image && is\_array($object->main\_image)){ |
| [766](#L766) |  |
| [767](#L767) | $main\_image = $object->main\_image; |
| [768](#L768) |  |
| [769](#L769) | $height = !empty($object->img[2])? $object->img[2]:''; |
| [770](#L770) | $width = !empty($object->img[1])? $object->img[1]:''; |
| [771](#L771) |  |
| [772](#L772) | echo "<div class='evo\_metarow\_fimg evorow evcal\_evdata\_img evcal\_evdata\_row ". esc\_attr( $end\_row\_class.$\_\_hoverclass.$\_\_zoom\_cursor.$\_\_noclickclass )."' data-imgheight='". esc\_attr( $main\_image['full\_h'] ) ."' data-imgwidth='". esc\_attr( $main\_image['full\_w'] ) ."'  style='background-image: url(\"". esc\_url( $object->img )."\")' data-imgstyle='". esc\_attr( $object->ftimg\_sty )."' data-minheight='". esc\_attr( $object->min\_height )."' data-status=''></div>"; |
| [773](#L773) | } |
| [774](#L774) | } |
| [775](#L775) |  |
| [776](#L776) |  |
| [777](#L777) | $OT .= ob\_get\_clean(); |
| [778](#L778) |  |
| [779](#L779) | break; |
| [780](#L780) |  |
| [781](#L781) | // event organizer |
| [782](#L782) | case 'organizer': |
| [783](#L783) |  |
| [784](#L784) | if(empty($ED['event\_organizer'])) break; |
| [785](#L785) | ob\_start(); |
| [786](#L786) | include('views/html-eventcard-organizer.php'); |
| [787](#L787) | return ob\_get\_clean(); |
| [788](#L788) |  |
| [789](#L789) | break; |
| [790](#L790) |  |
| [791](#L791) | // get directions |
| [792](#L792) | case 'getdirection': |
| [793](#L793) |  |
| [794](#L794) | $\_lang\_1 = evo\_lang\_get('evcalL\_getdir\_placeholder','Type your address to get directions'); |
| [795](#L795) | $\_lang\_2 = evo\_lang\_get('evcalL\_getdir\_title','Click here to get directions'); |
| [796](#L796) |  |
| [797](#L797) | $\_from\_address = false; |
| [798](#L798) | if(!empty($location\_address)) $\_from\_address = $location\_address; |
| [799](#L799) | if(!empty($location\_getdir\_latlng) && $location\_getdir\_latlng =='yes' && !empty($location\_latlng)){ |
| [800](#L800) | $\_from\_address = $location\_latlng; |
| [801](#L801) | } |
| [802](#L802) |  |
| [803](#L803) | if(!$\_from\_address) break; |
| [804](#L804) |  |
| [805](#L805) | $OT.="<div class='evo\_metarow\_getDr evorow evcal\_evdata\_row evcal\_evrow\_sm getdirections'> |
| [806](#L806) | <form action='https://maps.google.com/maps' method='get' target='\_blank'> |
| [807](#L807) | <input type='hidden' name='daddr' value=\"". esc\_attr( $\_from\_address )."\"/> |
| [808](#L808) | <p><input class='evoInput' type='text' name='saddr' placeholder='". esc\_html( $\_lang\_1 ) ."' value=''/> |
| [809](#L809) | <button type='submit' class='evcal\_evdata\_icons evcalicon\_9' title='". esc\_html( $\_lang\_2 ) ."'><i class='fa ".esc\_attr( get\_eventON\_icon('evcal\_\_fai\_008a', 'fa-road',$evOPT ) ) ."'></i></button> |
| [810](#L810) | </p></form> |
| [811](#L811) | </div>"; |
| [812](#L812) |  |
| [813](#L813) | break; |
| [814](#L814) |  |
| [815](#L815) | // learn more link |
| [816](#L816) | case "learnmore": |
| [817](#L817) | // learn more link with pluggability |
| [818](#L818) | $learnmore\_link = !empty($EVENT->get\_prop('evcal\_lmlink'))? apply\_filters('evo\_learnmore\_link', $EVENT->get\_prop('evcal\_lmlink'), $object): false; |
| [819](#L819) | $learnmore\_target = ($EVENT->get\_prop('evcal\_lmlink\_target')  && $EVENT->get\_prop('evcal\_lmlink\_target')=='yes')? 'target="\_blank"':null; |
| [820](#L820) |  |
| [821](#L821) | if(!$learnmore\_link) break; |
| [822](#L822) |  |
| [823](#L823) | $OT.= "<div class='evo\_metarow\_learnM evo\_metarow\_learnmore evorow'> |
| [824](#L824) | <a class='evcal\_evdata\_row evo\_clik\_row ' href='". esc\_url( $learnmore\_link ) ."' ".$learnmore\_target."> |
| [825](#L825) | <span class='evcal\_evdata\_icons'><i class='fa ". esc\_attr( get\_eventON\_icon('evcal\_\_fai\_006', 'fa-link',$evOPT ) ) ."'></i></span> |
| [826](#L826) | <h3 class='evo\_h3'>". esc\_html( eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_learnmore2','Learn More') ) ."</h3> |
| [827](#L827) | </a> |
| [828](#L828) | </div>"; |
| [829](#L829) | break; |
| [830](#L830) |  |
| [831](#L831) | case "addtocal": |
| [832](#L832) |  |
| [833](#L833) | $\_\_ics\_url = add\_query\_arg(array( |
| [834](#L834) | 'action' => 'eventon\_ics\_download', |
| [835](#L835) | 'event\_id'  => $EVENT->ID, |
| [836](#L836) | 'ri'        => $EVENT->ri, |
| [837](#L837) | 'nonce'=> wp\_create\_nonce('eventon\_ics\_oneevent') |
| [838](#L838) | ), admin\_url('admin-ajax.php')); |
| [839](#L839) |  |
| [840](#L840) |  |
| [841](#L841) | $O = (object)array( |
| [842](#L842) | 'location\_name'=> !empty($location\_name)?$location\_name:'', |
| [843](#L843) | 'location\_address'=> !empty($location\_address)?$location\_address:'', |
| [844](#L844) | 'etitle'=> $event\_title, |
| [845](#L845) | 'excerpt'=> $event\_excerpt\_txt |
| [846](#L846) | ); |
| [847](#L847) |  |
| [848](#L848) |  |
| [849](#L849) | $\_\_googlecal\_link = $EVENT->get\_addto\_googlecal\_link( |
| [850](#L850) | $O->location\_name, |
| [851](#L851) | $O->location\_address |
| [852](#L852) | ); |
| [853](#L853) |  |
| [854](#L854) |  |
| [855](#L855) | // which options to show for add to calendar |
| [856](#L856) | $addCaloptions = !empty($evOPT['evo\_addtocal'])? $evOPT['evo\_addtocal']: 'all'; |
| [857](#L857) | $addCalContent = ''; |
| [858](#L858) |  |
| [859](#L859) | // add to cal section |
| [860](#L860) | switch($addCaloptions){ |
| [861](#L861) | case 'ics': |
| [862](#L862) | $addCalContent = "<a href='{$\_\_ics\_url}' class='evo\_ics\_nCal' title='".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_addics','Add to your calendar')."'>".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_calncal','Calendar')."</a>"; |
| [863](#L863) | break; |
| [864](#L864) | case 'gcal': |
| [865](#L865) | $addCalContent = "<a href='". $\_\_googlecal\_link. "' target='\_blank' class='evo\_ics\_gCal' title='".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_addgcal','Add to google calendar')."'>".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_calgcal','GoogleCal')."</a>"; |
| [866](#L866) | break; |
| [867](#L867) | case 'all': |
| [868](#L868) | $addCalContent = "<a href='{$\_\_ics\_url}' class='evo\_ics\_nCal' title='".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_addics','Add to your calendar')."'>".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_calncal','Calendar')."</a>". |
| [869](#L869) | "<a href='{$\_\_googlecal\_link}' target='\_blank' class='evo\_ics\_gCal' title='".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_addgcal','Add to google calendar')."'>".eventon\_get\_custom\_language($evoOPT2, 'evcal\_evcard\_calgcal','GoogleCal')."</a>"; |
| [870](#L870) | break; |
| [871](#L871) | } |
| [872](#L872) |  |
| [873](#L873) | if( $addCaloptions != 'none'){ |
| [874](#L874) | $OT .= "<div class='evo\_metarow\_ICS evorow evcal\_evdata\_row'> |
| [875](#L875) | <span class='evcal\_evdata\_icons'><i class='fa ".get\_eventON\_icon('evcal\_\_fai\_008', 'fa-calendar',$evOPT )."'></i></span> |
| [876](#L876) | <div class='evcal\_evdata\_cell'> |
| [877](#L877) | <p>{$addCalContent}</p> |
| [878](#L878) | </div> |
| [879](#L879) | </div>"; |
| [880](#L880) | } |
| [881](#L881) | break; |
| [882](#L882) |  |
| [883](#L883) | // Related Events u 2.2.13 |
| [884](#L884) | case 'relatedEvents': |
| [885](#L885) | $events = $EVENT->get\_prop('ev\_releated'); |
| [886](#L886) | if( !$events ) break; |
| [887](#L887) |  |
| [888](#L888) | $events = json\_decode($events, true); |
| [889](#L889) |  |
| [890](#L890) | if( !is\_array( $events )) break; |
| [891](#L891) |  |
| [892](#L892) |  |
| [893](#L893) | ob\_start(); |
| [894](#L894) | include('views/html-eventcard-related.php'); |
| [895](#L895) | return ob\_get\_clean(); |
| [896](#L896) | break; |
| [897](#L897) |  |
| [898](#L898) | // Virtual Event |
| [899](#L899) | case 'virtual': |
| [900](#L900) | if($EVENT->is\_virtual() && !$EVENT->is\_cancelled()): |
| [901](#L901) | ob\_start(); |
| [902](#L902) |  |
| [903](#L903) | $vir = new EVO\_Event\_Virtual($EVENT); |
| [904](#L904) | $vir->print\_eventcard\_cell\_html(); |
| [905](#L905) |  |
| [906](#L906) | $OT.= ob\_get\_clean(); |
| [907](#L907) | endif; |
| [908](#L908) | break; |
| [909](#L909) |  |
| [910](#L910) | // health guidance |
| [911](#L911) | case 'health': |
| [912](#L912) |  |
| [913](#L913) | if( !$EVENT->check\_yn('\_health')) break; |
| [914](#L914) |  |
| [915](#L915) | ob\_start(); |
| [916](#L916) | include('views/html-eventcard-health.php'); |
| [917](#L917) | return ob\_get\_clean(); |
| [918](#L918) |  |
| [919](#L919) |  |
| [920](#L920) | break; |
| [921](#L921) |  |
| [922](#L922) | // paypal link |
| [923](#L923) | case 'paypal': |
| [924](#L924) | $ev\_txt = $EVENT->get\_prop('evcal\_paypal\_text'); |
| [925](#L925) | $text = ($ev\_txt)? $ev\_txt: evo\_lang\_get('evcal\_evcard\_tix1','Buy ticket via Paypal'); |
| [926](#L926) |  |
| [927](#L927) | $currency = !empty($evOPT['evcal\_pp\_cur'])? $evOPT['evcal\_pp\_cur']: false; |
| [928](#L928) | $email = ($EVENT->get\_prop('evcal\_paypal\_email')? $EVENT->get\_prop('evcal\_paypal\_email'): $evOPT['evcal\_pp\_email']); |
| [929](#L929) |  |
| [930](#L930) | if($currency && $email): |
| [931](#L931) | $\_event\_time = $EVENT->get\_formatted\_smart\_time(); |
| [932](#L932) |  |
| [933](#L933) | ob\_start(); |
| [934](#L934) | ?> |
| [935](#L935) |  |
| [936](#L936) |  |
| [937](#L937) | <div class='evo\_metarow\_paypal evorow evcal\_evdata\_row evo\_paypal'> |
| [938](#L938) | <span class='evcal\_evdata\_icons'><i class='fa <?php echo esc\_html( get\_eventON\_icon('evcal\_\_fai\_007', 'fa-ticket',$evOPT ) );?>'></i></span> |
| [939](#L939) | <div class='evcal\_evdata\_cell'> |
| [940](#L940) | <p style='padding-bottom:5px;'><?php echo esc\_html( $text );?></p> |
| [941](#L941) | <form target="\_blank" name="\_xclick" action="https://www.paypal.com/us/cgi-bin/webscr" method="post"> |
| [942](#L942) | <input type="hidden" name="cmd" value="\_xclick"> |
| [943](#L943) | <input type="hidden" name="business" value="<?php echo esc\_html( $email );?>"> |
| [944](#L944) | <input type="hidden" name="currency\_code" value="<?php echo esc\_html( $currency );?>"> |
| [945](#L945) | <input type="hidden" name="item\_name" value="<?php echo esc\_html( $EVENT->post\_title.' '.$\_event\_time );?>"> |
| [946](#L946) | <input type="hidden" name="amount" value="<?php echo esc\_html( $EVENT->get\_prop('evcal\_paypal\_item\_price') );?>"> |
| [947](#L947) | <input type='submit' class='evcal\_btn' value='<?php echo esc\_html( evo\_lang\_get('evcal\_evcard\_btn1','Buy Now') );?>'/> |
| [948](#L948) | </form> |
| [949](#L949) | </div></div> |
| [950](#L950) | <?php $OT.= ob\_get\_clean(); |
| [951](#L951) | endif; |
| [952](#L952) |  |
| [953](#L953) | break; |
| [954](#L954) |  |
| [955](#L955) | // social share u2.2.13 |
| [956](#L956) | case 'evosocial': |
| [957](#L957) | ob\_start(); |
| [958](#L958) | include('views/html-eventcard-social.php'); |
| [959](#L959) | return ob\_get\_clean(); |
| [960](#L960) |  |
| [961](#L961) | break; |
| [962](#L962) |  |
| [963](#L963) | }// end switch |
| [964](#L964) |  |
| [965](#L965) | // for custom meta data fields |
| [966](#L966) | if(!empty($object->x) && $box\_name == 'customfield'.$object->x){ |
| [967](#L967) | $i18n\_name = eventon\_get\_custom\_language($evoOPT2,'evcal\_cmd\_'.$object->x , $evOPT['evcal\_ec\_f'.$object->x.'a1']); |
| [968](#L968) |  |
| [969](#L969) | // user role restriction access validation |
| [970](#L970) | if( |
| [971](#L971) | ($object->visibility\_type=='admin' && !current\_user\_can( 'manage\_options' ) ) || |
| [972](#L972) | ($object->visibility\_type=='loggedin' && !is\_user\_logged\_in() && empty($object->login\_needed\_message)) |
| [973](#L973) | ){}else{ |
| [974](#L974) |  |
| [975](#L975) | $OT .="<div class='evo\_metarow\_cusF". esc\_attr( $object->x )." evorow evcal\_evdata\_row evcal\_evrow\_sm '> |
| [976](#L976) | <span class='evcal\_evdata\_icons'><i class='fa ". esc\_attr( $object->imgurl ) ."'></i></span> |
| [977](#L977) | <div class='evcal\_evdata\_cell'> |
| [978](#L978) | <h3 class='evo\_h3'>". esc\_html( $i18n\_name ) ."</h3>"; |
| [979](#L979) |  |
| [980](#L980) | // if visible only to loggedin users and user is not logged in |
| [981](#L981) | if( !empty($object->login\_needed\_message)){ |
| [982](#L982) | $OT .="<div class='evo\_custom\_content evo\_data\_val'>". $object->login\_needed\_message . "</div>"; |
| [983](#L983) | }else{ |
| [984](#L984) | if($object->type=='button'){ |
| [985](#L985) | $\_target = (!empty($object->\_target) && $object->\_target=='yes')? 'target="\_blank"':null; |
| [986](#L986) | $OT .="<a href='". esc\_url( $object->valueL ) ."' {$\_target} class='evcal\_btn evo\_cusmeta\_btn'>". esc\_html( $object->value ) ."</a>"; |
| [987](#L987) | }else{ |
| [988](#L988) | $OT .="<div class='evo\_custom\_content evo\_data\_val'>". |
| [989](#L989) | (  EVO()->frontend->filter\_evo\_content($object->value) )."</div>"; |
| [990](#L990) | } |
| [991](#L991) | } |
| [992](#L992) |  |
| [993](#L993) | $OT .="</div></div>"; |
| [994](#L994) | } |
| [995](#L995) | } |
| [996](#L996) |  |
| [997](#L997) | return $OT; |
| [998](#L998) | } |
| [999](#L999) |  |
| [1000](#L1000) | // view in my time |
| [1001](#L1001) | public function get\_view\_my\_time\_content($timezone\_data, $start, $end){ |
| [1002](#L1002) | extract( $timezone\_data ); |
| [1003](#L1003) |  |
| [1004](#L1004) | $data = array( |
| [1005](#L1005) | '\_\_df'=> $\_\_df, |
| [1006](#L1006) | '\_\_tf'=> $\_\_tf, |
| [1007](#L1007) | '\_\_f'=> $\_\_f, |
| [1008](#L1008) | 'times'=> $start . '-' . $end, |
| [1009](#L1009) | 'tzo' => $this->help->get\_timezone\_offset( $this->ev\_tz,  $start) |
| [1010](#L1010) | ); |
| [1011](#L1011) |  |
| [1012](#L1012) | return "<em class='evcal\_tz\_time evo\_mytime tzo\_trig' title='". evo\_lang('My Time') ."'  ". $this->help->array\_to\_html\_data($data)."><i class='fa fa-globe-americas'></i> <b>{$\_\_t}</b></em>"; |
| [1013](#L1013) |  |
| [1014](#L1014) | } |
| [1015](#L1015) |  |
| [1016](#L1016) | // SEO Schema data |
| [1017](#L1017) | function get\_schema($EventData, $\_eventcard){ |
| [1018](#L1018) | extract($EventData); |
| [1019](#L1019) | $EVENT = $this->EVENT; |
| [1020](#L1020) |  |
| [1021](#L1021) | //print\_r($EventData); |
| [1022](#L1022) |  |
| [1023](#L1023) | $\_\_scheme\_data = '<div class="evo\_event\_schema" style="display:none" >'; |
| [1024](#L1024) |  |
| [1025](#L1025) | $tz = strpos($this->timezone, '-') === false? '+'. $this->timezone : $this->timezone; |
| [1026](#L1026) |  |
| [1027](#L1027) |  |
| [1028](#L1028) | // Start time |
| [1029](#L1029) | $\_schema\_starttime = $\_schema\_endtime = ''; |
| [1030](#L1030) | if(is\_array($start\_date\_data)) |
| [1031](#L1031) | $\_schema\_starttime = $start\_date\_data['Y'].'-'.$start\_date\_data['n'].'-'.$start\_date\_data['j'].( !$EVENT->is\_all\_day()? 'T'.$start\_date\_data['H'].':'.$start\_date\_data['i']. $tz. ':00' :''); |
| [1032](#L1032) | if(is\_array($end\_date\_data)) |
| [1033](#L1033) | $\_schema\_endtime = $end\_date\_data['Y'].'-'.$end\_date\_data['n'].'-'.$end\_date\_data['j']. ( !$EVENT->is\_all\_day()? 'T'.$end\_date\_data['H'].':'.$end\_date\_data['i'].$tz. ':00':''); |
| [1034](#L1034) |  |
| [1035](#L1035) | // Event Status |
| [1036](#L1036) | $ES = array( |
| [1037](#L1037) | 'cancelled'=>'https://schema.org/EventCancelled', |
| [1038](#L1038) | 'movedonline'=>'https://schema.org/EventMovedOnline', |
| [1039](#L1039) | 'postponed'=>'https://schema.org/EventPostponed', |
| [1040](#L1040) | 'rescheduled'=>'https://schema.org/EventRescheduled', |
| [1041](#L1041) | ); |
| [1042](#L1042) |  |
| [1043](#L1043) | $\_ES = isset($ES[$\_status])? $ES[$\_status]: 'https://schema.org/EventScheduled'; |
| [1044](#L1044) |  |
| [1045](#L1045) |  |
| [1046](#L1046) | // Event details |
| [1047](#L1047) | $\_\_schema\_desc = !empty($event\_excerpt\_txt)? $event\_excerpt\_txt : (isset($EVENT->post\_title)? '"'.$EVENT->post\_title.'"':''); |
| [1048](#L1048) | if(!empty($event\_details)) $\_\_schema\_desc = $event\_details; |
| [1049](#L1049) | $\_\_schema\_desc = str\_replace("'","'", $\_\_schema\_desc); |
| [1050](#L1050) | $\_\_schema\_desc = str\_replace('"',"", $\_\_schema\_desc); |
| [1051](#L1051) | $\_\_schema\_desc = preg\_replace( "/\r|\n/", " ", $\_\_schema\_desc ); |
| [1052](#L1052) |  |
| [1053](#L1053) | // attendence mode |
| [1054](#L1054) | $AM = ucfirst( $EVENT->get\_attendance\_mode() ); |
| [1055](#L1055) | $\_AM = 'https://schema.org/'. $AM .'EventAttendanceMode'; |
| [1056](#L1056) |  |
| [1057](#L1057) | if(!empty($schema) && $schema){ |
| [1058](#L1058) | // for each schema custom values |
| [1059](#L1059) | foreach(apply\_filters('evo\_event\_schema',array( |
| [1060](#L1060) | 'url'=>array( |
| [1061](#L1061) | 'type'=>'a', |
| [1062](#L1062) | 'attr'=>'href', |
| [1063](#L1063) | 'attrcontent'=> $EVENT->get\_permalink() |
| [1064](#L1064) | ), |
| [1065](#L1065) | 'image'=>array( |
| [1066](#L1066) | 'type'=>'meta', |
| [1067](#L1067) | 'content'=> (!empty($img\_src) &&!empty($img\_src)? $img\_src:'') |
| [1068](#L1068) | ), |
| [1069](#L1069) | 'startDate'=>array( |
| [1070](#L1070) | 'type'=>'meta', |
| [1071](#L1071) | 'content'=> $\_schema\_starttime |
| [1072](#L1072) | ), |
| [1073](#L1073) | 'endDate'=>array( |
| [1074](#L1074) | 'type'=>'meta', |
| [1075](#L1075) | 'content'=> $\_schema\_endtime |
| [1076](#L1076) | ), |
| [1077](#L1077) | 'eventStatus'=>array( |
| [1078](#L1078) | 'type'=>'meta', |
| [1079](#L1079) | 'content'=>  $\_ES |
| [1080](#L1080) | ), |
| [1081](#L1081) | ),$EVENT, $EVENT->ID) as $key=>$value){ |
| [1082](#L1082) | $\_\_scheme\_data .= "<".(!empty($value['type'])? $value['type']:'meta') ." itemprop='". esc\_attr( $key ) ."' ".(!empty($value['content'])? 'content="'. esc\_html( $value['content'] ).'"':'') ." ". ( !empty($value['attr'])? $value['attr']."='". esc\_html( $value['attrcontent'] )."'":''); |
| [1083](#L1083) |  |
| [1084](#L1084) | if(!empty($value['itemtype'])) $\_\_scheme\_data .= ' itemscope itemtype="'. esc\_html( $value['itemtype'] ) .'"'; |
| [1085](#L1085) |  |
| [1086](#L1086) | $\_\_scheme\_data .= ($value['type'] =='meta')? "/>": ">"; |
| [1087](#L1087) | $\_\_scheme\_data .= (!empty($value['html'])? $value['html'] :''); |
| [1088](#L1088) | $\_\_scheme\_data .= (isset($value['type']) && $value['type'] == 'meta')? '': |
| [1089](#L1089) | ( isset($value['type'])? "</". esc\_attr( $value['type'] ) .">" :'' ); |
| [1090](#L1090) | } |
| [1091](#L1091) |  |
| [1092](#L1092) | // location data |
| [1093](#L1093) | if( !empty($location\_type) && $location\_type =='virtual'){ |
| [1094](#L1094) | $\_\_scheme\_data .= '<item style="display:none" itemprop="location" itemscope itemtype="http://schema.org/VirtualLocation">'; |
| [1095](#L1095) | if(!empty($location\_link)) $\_\_scheme\_data .= '<span itemprop="url">'. esc\_url( $location\_link ) .'</span>'; |
| [1096](#L1096) | $\_\_scheme\_data .= "</item>"; |
| [1097](#L1097) |  |
| [1098](#L1098) | //$\_AM = 'https://schema.org/OnlineEventAttendanceMode'; |
| [1099](#L1099) |  |
| [1100](#L1100) | } |
| [1101](#L1101) |  |
| [1102](#L1102) | if(!empty($location\_address)){ |
| [1103](#L1103) |  |
| [1104](#L1104) | $\_\_scheme\_data .= '<item style="display:none" itemprop="location" itemscope itemtype="http://schema.org/Place">'. ( !empty($location\_name)? '<span itemprop="name">'.$location\_name.'</span>':'').'<span itemprop="address" itemscope itemtype="http://schema.org/PostalAddress"><item itemprop="streetAddress">'. stripslashes($location\_address) .'</item></span></item>'; |
| [1105](#L1105) | } |
| [1106](#L1106) |  |
| [1107](#L1107) | $\_\_scheme\_data .= '<item style="display:none" itemprop="eventAttendanceMode" itemscope itemtype="'.$\_AM.'"></item>'; |
| [1108](#L1108) |  |
| [1109](#L1109) | // offer data |
| [1110](#L1110) | if( $EVENT->get\_prop('\_seo\_offer\_price') && $EVENT->get\_prop('\_seo\_offer\_currency')){ |
| [1111](#L1111) | $\_\_scheme\_data .= '<div itemprop="offers" itemscope itemtype="http://schema.org/Offer"> |
| [1112](#L1112) | <div class="event-price" itemprop="price" content="'.$EVENT->get\_prop('\_seo\_offer\_price').'">'.$EVENT->get\_prop('\_seo\_offer\_price').'</div> |
| [1113](#L1113) | <meta itemprop="priceCurrency" content="'.$EVENT->get\_prop('\_seo\_offer\_currency').'"> |
| [1114](#L1114) | <meta itemprop="url" content="'.$EVENT->get\_permalink().'"> |
| [1115](#L1115) | <meta itemprop="availability" content="http://schema.org/InStock"> |
| [1116](#L1116) | <meta itemprop="validFrom" content="'.$\_schema\_starttime.'"> |
| [1117](#L1117) | </div>'; |
| [1118](#L1118) | } |
| [1119](#L1119) |  |
| [1120](#L1120) | // organizer data |
| [1121](#L1121) | if(!empty($organizer) && isset($organizer->name)){ |
| [1122](#L1122) | $\_\_scheme\_data .= '<div itemprop="organizer" itemscope="" itemtype="http://schema.org/Organization"> |
| [1123](#L1123) | <meta itemprop="name" content="'.$organizer->name.'"> |
| [1124](#L1124) | '. (!empty($organizer\_link)? '<meta itemprop="url" content="'.$organizer\_link.'">':''). |
| [1125](#L1125) | '</div>'; |
| [1126](#L1126) | } |
| [1127](#L1127) |  |
| [1128](#L1128) | // performer data using organizer data |
| [1129](#L1129) | if( $EVENT->get\_prop('evo\_event\_org\_as\_perf') && !empty($organizer) && isset($organizer->name)){ |
| [1130](#L1130) | $\_\_scheme\_data .= '<div itemprop="performer" itemscope="" itemtype="http://schema.org/Person"> |
| [1131](#L1131) | <meta itemprop="name" content="'.$organizer->name.'"> |
| [1132](#L1132) | </div>'; |
| [1133](#L1133) | } |
| [1134](#L1134) | }else{ |
| [1135](#L1135) | $\_\_scheme\_data .= '<a href="'.$event\_permalink.'"></a>'; |
| [1136](#L1136) | } |
| [1137](#L1137) |  |
| [1138](#L1138) | // JSON LD |
| [1139](#L1139) | if(!empty($schema\_jsonld) && $schema\_jsonld){ |
| [1140](#L1140) | $\_\_scheme\_data .= '<script type="application/ld+json">'; |
| [1141](#L1141) |  |
| [1142](#L1142) | // event status |
| [1143](#L1143) | $\_schema\_eventstatus = ',"eventStatus":"'. $\_ES .'"'; |
| [1144](#L1144) |  |
| [1145](#L1145) | // location |
| [1146](#L1146) | $\_schema\_location = ''; |
| [1147](#L1147) |  |
| [1148](#L1148) | if(!empty($location\_type) && $location\_type == 'virtual' || !empty($location\_address)){ |
| [1149](#L1149) | $\_schema\_location .= ',"location":'; |
| [1150](#L1150) | } |
| [1151](#L1151) |  |
| [1152](#L1152) | if(!empty($location\_type) && $location\_type == 'virtual' || !empty($location\_address)) |
| [1153](#L1153) | $\_schema\_location .= '['; |
| [1154](#L1154) |  |
| [1155](#L1155) | if(!empty($location\_type) && $location\_type == 'virtual'){ |
| [1156](#L1156) | $\_schema\_location .= '{"@type":"VirtualLocation"'; |
| [1157](#L1157) | if(!empty($location\_link)) $\_schema\_location .= ',"url":"'.$location\_link.'"'; |
| [1158](#L1158) | $\_schema\_location .= '}'; |
| [1159](#L1159) | } |
| [1160](#L1160) | if(!empty($location\_address)){ |
| [1161](#L1161) |  |
| [1162](#L1162) | if(!empty($location\_type) && $location\_type == 'virtual') |
| [1163](#L1163) | $\_schema\_location .= ','; |
| [1164](#L1164) |  |
| [1165](#L1165) | if( !empty($location\_name) ) |
| [1166](#L1166) | $location\_name = str\_replace('"', "", $location\_name); |
| [1167](#L1167) | $\_name = !empty($location\_name)? '"name":"'.$location\_name.'",':''; |
| [1168](#L1168) |  |
| [1169](#L1169) | $\_schema\_location .= '{"@type":"Place",'.$\_name.'"address":{"@type": "PostalAddress","streetAddress":"'. str\_replace("\,",",", stripslashes($location\_address) ).'"}}'; |
| [1170](#L1170) | } |
| [1171](#L1171) | if(!empty($location\_type) && $location\_type == 'virtual' || !empty($location\_address)){ |
| [1172](#L1172) | $\_schema\_location .= ']'; |
| [1173](#L1173) | } |
| [1174](#L1174) |  |
| [1175](#L1175) | // organizer |
| [1176](#L1176) | $\_schema\_performer = $\_schema\_organizer = ''; |
| [1177](#L1177) | if(!empty($organizer) && isset($organizer->name)){ |
| [1178](#L1178) | $\_schema\_organizer = ',"organizer":{"@type":"Organization","name":"'.$organizer->name.'"'. |
| [1179](#L1179) | ( !empty($organizer\_link)? ',"url":"'.$organizer\_link.'"':''). |
| [1180](#L1180) | '}'; |
| [1181](#L1181) | } |
| [1182](#L1182) |  |
| [1183](#L1183) | // perfomer data using organizer |
| [1184](#L1184) | if( $EVENT->get\_prop('evo\_event\_org\_as\_perf') && !empty($organizer) && isset($organizer->name) ){ |
| [1185](#L1185) | $\_schema\_performer = ',"performer":{"@type":"Person","name":"'.$organizer->name.'"}'; |
| [1186](#L1186) | } |
| [1187](#L1187) |  |
| [1188](#L1188) | // offers field |
| [1189](#L1189) | $\_schema\_offers = ''; |
| [1190](#L1190) | if( $EVENT->get\_prop('\_seo\_offer\_price') && $EVENT->get\_prop('\_seo\_offer\_currency')){ |
| [1191](#L1191) | $\_schema\_offers = ',"offers":{"@type":"Offer","price":"'. esc\_html( $EVENT->get\_prop('\_seo\_offer\_price') ) .'","priceCurrency":"'. esc\_html( $EVENT->get\_prop('\_seo\_offer\_currency') ).'","availability":"http://schema.org/InStock","validFrom":"'. esc\_html( $\_schema\_starttime ) .'","url":"'. esc\_url( $EVENT->get\_permalink() ).'"}'; |
| [1192](#L1192) | } |
| [1193](#L1193) |  |
| [1194](#L1194) | // build the schema content |
| [1195](#L1195) | $\_\_scheme\_data .= |
| [1196](#L1196) | '{"@context": "http://schema.org","@type": "Event", |
| [1197](#L1197) | "@id": "event\_'. esc\_html( $EVENT->get\_event\_uniqid() ).'", |
| [1198](#L1198) | "eventAttendanceMode":"'. $\_AM .'", |
| [1199](#L1199) | "name": '.(isset($EVENT->post\_title)? '"'.htmlspecialchars( $EVENT->post\_title, ENT\_QUOTES ) .'"' :'').', |
| [1200](#L1200) | "url": "'. $EVENT->get\_permalink() .'", |
| [1201](#L1201) | "startDate": "'.$\_schema\_starttime.'", |
| [1202](#L1202) | "endDate": "'.$\_schema\_endtime.'", |
| [1203](#L1203) | "image":'.(!empty($img\_src) &&!empty($img\_src)? '"'. esc\_url( $img\_src ).'"':'""').', |
| [1204](#L1204) | "description":"'.$\_\_schema\_desc.'"'. |
| [1205](#L1205) | $\_schema\_location. |
| [1206](#L1206) | $\_schema\_organizer. |
| [1207](#L1207) | $\_schema\_performer. |
| [1208](#L1208) | $\_schema\_offers. |
| [1209](#L1209) | $\_schema\_eventstatus. |
| [1210](#L1210) | apply\_filters('eventon\_event\_json\_schema\_adds', '', $EVENT, $EVENT->ID). |
| [1211](#L1211) | '}'; |
| [1212](#L1212) | $\_\_scheme\_data .= "</script>"; |
| [1213](#L1213) | } |
| [1214](#L1214) | $\_\_scheme\_data .= "</div>"; |
| [1215](#L1215) |  |
| [1216](#L1216) | return $\_\_scheme\_data; |
| [1217](#L1217) | } |
| [1218](#L1218) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php?format=txt)
* [Original Format](/export/3220385/eventon-lite/trunk/includes/calendar/class-calendar-event-structure.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_f4a1d806_20250110_183205.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# EventON <= 2.2.15 - Missing Authorization to Unauthenticated Stored Cross-Site Scripting and Plugin Settings Updates

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   EventON <= 2.2.15 - Missing Authorization to Unauthenticated Stored Cross-Site Scripting and Plugin Settings Updates

7.2

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-6180](https://www.cve.org/CVERecord?id=CVE-2024-6180) |
| --- | --- |
| CVSS | 7.2 (High) |
| Publicly Published | July 8, 2024 |
| Last Updated | July 30, 2024 |
| Researcher | [Lucio Sá](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lucio-sa) |

### Description

The EventON plugin for WordPress is vulnerable to unauthorized modification of data due to a missing capability check on the 'eventon\_import\_settings' ajax action in all versions up to, and including, 2.2.15. This makes it possible for unauthenticated attackers to update plugin settings, including adding stored cross-site scripting to settings options displayed on event calendar pages.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3121634/eventon-lite/trunk/includes/admin/class-admin-ajax.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Feventon-lite%2Feventon-2215-missing-authorization-to-unauthenticated-stored-cross-site-scripting-and-plugin-settings-updates&t=EventON%20%3C%3D%202.2.15%20-%20Missing%20Authorization%20to%20Unauthenticated%20Stored%20Cross-Site%20Scripting%20and%20Plugin%20Settings%20Updates "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Feventon-lite%2Feventon-2215-missing-authorization-to-unauthenticated-stored-cross-site-scripting-and-plugin-settings-updates&text=EventON%20%3C%3D%202.2.15%20-%20Missing%20Authorization%20to%20Unauthenticated%20Stored%20Cross-Site%20Scripting%20and%20Plugin%20Settings%20Updates "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Feventon-lite%2Feventon-2215-missing-authorization-to-unauthenticated-stored-cross-site-scripting-and-plugin-settings-updates "LinkedIn")
Email

## Vulnerability Details for EventON

#### [EventON](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/eventon-lite)

| Software Type | Plugin |
| --- | --- |
| Software Slug | eventon-lite [(view on wordpress.org)](https://wordpress.org/plugins/eventon-lite) |
| Patched? | Yes |
| Remediation | Update to version 2.2.16, or a newer patched version |
| Affected Version | * <= 2.2.15 |
| Patched Version | * 2.2.16 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


