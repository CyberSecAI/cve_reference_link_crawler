

| [cgit logo](/) | [index](/) : [wireless/iwd.git](/pub/scm/network/wireless/iwd.git/) | master |
| --- | --- | --- |
| Wireless daemon for Linux | Marcel Holtmann |

| [about](/pub/scm/network/wireless/iwd.git/about/)[summary](/pub/scm/network/wireless/iwd.git/)[refs](/pub/scm/network/wireless/iwd.git/refs/?id=6415420f1c92012f64063c131480ffcef58e60ca)[log](/pub/scm/network/wireless/iwd.git/log/)[tree](/pub/scm/network/wireless/iwd.git/tree/?id=6415420f1c92012f64063c131480ffcef58e60ca)[commit](/pub/scm/network/wireless/iwd.git/commit/?id=6415420f1c92012f64063c131480ffcef58e60ca)[diff](/pub/scm/network/wireless/iwd.git/diff/?id=6415420f1c92012f64063c131480ffcef58e60ca)[stats](/pub/scm/network/wireless/iwd.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mathy Vanhoef <vanhoefm@gmail.com> | 2024-01-29 17:11:49 +0100 |
| --- | --- | --- |
| committer | Denis Kenzior <denkenz@gmail.com> | 2024-01-29 21:00:00 -0600 |
| commit | [6415420f1c92012f64063c131480ffcef58e60ca](/pub/scm/network/wireless/iwd.git/commit/?id=6415420f1c92012f64063c131480ffcef58e60ca) ([patch](/pub/scm/network/wireless/iwd.git/patch/?id=6415420f1c92012f64063c131480ffcef58e60ca)) | |
| tree | [002c738107c15564f6d241c1cb0f346909a07327](/pub/scm/network/wireless/iwd.git/tree/?id=6415420f1c92012f64063c131480ffcef58e60ca) | |
| parent | [1a79092383f4bbe05eaab80b5f0f148e38ace2cf](/pub/scm/network/wireless/iwd.git/commit/?id=1a79092383f4bbe05eaab80b5f0f148e38ace2cf) ([diff](/pub/scm/network/wireless/iwd.git/diff/?id=6415420f1c92012f64063c131480ffcef58e60ca&id2=1a79092383f4bbe05eaab80b5f0f148e38ace2cf)) | |

ap: only accept ptk 4/4 after receiving ptk 2/4When operating as an AP, drop message 4 of the 4-way handshake if the AP
has not yet received message 2. Otherwise an attacker can skip message 2
and immediately send message 4 to bypass authentication (the AP would be
using an all-zero ptk to verify the authenticity of message 4).
[Diffstat](/pub/scm/network/wireless/iwd.git/diff/?id=6415420f1c92012f64063c131480ffcef58e60ca)

| -rw-r--r-- | [src/eapol.c](/pub/scm/network/wireless/iwd.git/diff/src/eapol.c?id=6415420f1c92012f64063c131480ffcef58e60ca) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/src/eapol.c b/src/eapol.cindex bad4bbb7e..3ce14d5c0 100644--- a/[src/eapol.c](/pub/scm/network/wireless/iwd.git/tree/src/eapol.c?id=1a79092383f4bbe05eaab80b5f0f148e38ace2cf)+++ b/[src/eapol.c](/pub/scm/network/wireless/iwd.git/tree/src/eapol.c?id=6415420f1c92012f64063c131480ffcef58e60ca)@@ -2092,6 +2092,10 @@ static void eapol\_handle\_ptk\_4\_of\_4(struct eapol\_sm \*sm, if (L\_BE64\_TO\_CPU(ek->key\_replay\_counter) != sm->replay\_counter) return; + /\* Ensure we received Message 2 and thus have a PTK to verify MIC \*/+ if (!sm->handshake->have\_snonce)+ return;+ kck = handshake\_state\_get\_kck(sm->handshake);  if (!eapol\_verify\_mic(sm->handshake->akm\_suite, kck, ek, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:22:19 +0000

