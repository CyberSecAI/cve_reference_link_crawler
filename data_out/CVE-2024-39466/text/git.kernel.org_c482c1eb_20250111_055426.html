

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d9d3490c48df572edefc0b64655259eefdcbb9be)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d9d3490c48df572edefc0b64655259eefdcbb9be)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d9d3490c48df572edefc0b64655259eefdcbb9be)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d9d3490c48df572edefc0b64655259eefdcbb9be)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Konrad Dybcio <konrad.dybcio@linaro.org> | 2024-03-09 14:15:03 +0100 |
| --- | --- | --- |
| committer | Daniel Lezcano <daniel.lezcano@linaro.org> | 2024-04-23 12:40:29 +0200 |
| commit | [d9d3490c48df572edefc0b64655259eefdcbb9be](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d9d3490c48df572edefc0b64655259eefdcbb9be) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d9d3490c48df572edefc0b64655259eefdcbb9be)) | |
| tree | [60e3594f697541b7bbc85e3450c41c9a8a1e95aa](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d9d3490c48df572edefc0b64655259eefdcbb9be) | |
| parent | [c0f14ec95262cdcf557016f84b87e45f54e0b881](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c0f14ec95262cdcf557016f84b87e45f54e0b881) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d9d3490c48df572edefc0b64655259eefdcbb9be&id2=c0f14ec95262cdcf557016f84b87e45f54e0b881)) | |
| download | [linux-d9d3490c48df572edefc0b64655259eefdcbb9be.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d9d3490c48df572edefc0b64655259eefdcbb9be.tar.gz) | |

thermal/drivers/qcom/lmh: Check for SCM availability at probeUp until now, the necessary scm availability check has not been
performed, leading to possible null pointer dereferences (which did
happen for me on RB1).
Fix that.
Fixes: 53bca371cdf7 ("thermal/drivers/qcom: Add support for LMh driver")
Cc: <stable@vger.kernel.org>
Reviewed-by: Dmitry Baryshkov <dmitry.baryshkov@linaro.org>
Reviewed-by: Bjorn Andersson <andersson@kernel.org>
Signed-off-by: Konrad Dybcio <konrad.dybcio@linaro.org>
Signed-off-by: Daniel Lezcano <daniel.lezcano@linaro.org>
Link: [https://lore.kernel.org/r/20240308-topic-rb1\_lmh-v2-2-bac3914b0fe3@linaro.org](https://lore.kernel.org/r/20240308-topic-rb1_lmh-v2-2-bac3914b0fe3%40linaro.org)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d9d3490c48df572edefc0b64655259eefdcbb9be)

| -rw-r--r-- | [drivers/thermal/qcom/lmh.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/thermal/qcom/lmh.c?id=d9d3490c48df572edefc0b64655259eefdcbb9be) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/drivers/thermal/qcom/lmh.c b/drivers/thermal/qcom/lmh.cindex f6edb12ec00419..5225b3621a56c4 100644--- a/[drivers/thermal/qcom/lmh.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thermal/qcom/lmh.c?id=c0f14ec95262cdcf557016f84b87e45f54e0b881)+++ b/[drivers/thermal/qcom/lmh.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thermal/qcom/lmh.c?id=d9d3490c48df572edefc0b64655259eefdcbb9be)@@ -95,6 +95,9 @@ static int lmh\_probe(struct platform\_device \*pdev) unsigned int enable\_alg; u32 node\_id; + if (!qcom\_scm\_is\_available())+ return -EPROBE\_DEFER;+ lmh\_data = devm\_kzalloc(dev, sizeof(\*lmh\_data), GFP\_KERNEL); if (!lmh\_data) return -ENOMEM; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 05:53:04 +0000

