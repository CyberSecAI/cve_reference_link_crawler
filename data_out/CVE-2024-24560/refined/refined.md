- **Root cause of vulnerability:** When making calls to external contracts, the input buffer is written starting at byte 28, while the return buffer starts at byte 0. The size of the return data is checked against the minimum size for the return type, but not against the actual length word of the dynamic type, leading to a potential read past the intended return data into the input buffer.
- **Weaknesses/vulnerabilities present:** The vulnerability lies in the insufficient size check of return data, specifically for dynamic types. The check only ensures that the `RETURNDATASIZE` is greater than the minimum size of the return type, but does not ensure it is as large as the length word within the dynamic type. This allows for reading past the end of the returned data.
- **Impact of exploitation:** An attacker can craft a malicious contract that returns malformed data. This will cause the calling contract to read return data that is not intended, leading to it using data from the input buffer instead, which is attacker controlled.
- **Attack vectors:** A malicious contract could return a malformed byte string (or another dynamic type), where the length field indicates a size that exceeds the actual returndata size.
- **Required attacker capabilities/position:** The attacker needs to be able to deploy a smart contract that is called by a vulnerable Vyper contract. The attacker can then craft a response with incorrect length fields for dynamic types which the vulnerable contract will interpret incorrectly.