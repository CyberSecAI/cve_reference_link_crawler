=== Content from www.wordfence.com_fd1ea8fd_20250111_070001.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# ImagePress - Image Gallery <= 1.2.2 - Authenticated (Administrator+) Stored Cross-Site Scripting via Plugin Settings

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   ImagePress - Image Gallery <= 1.2.2 - Authenticated (Administrator+) Stored Cross-Site Scripting via Plugin Settings

4.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:H/PR:H/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:H/PR:H/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-9776](https://www.cve.org/CVERecord?id=CVE-2024-9776) |
| --- | --- |
| CVSS | 4.4 (Medium) |
| Publicly Published | October 11, 2024 |
| Last Updated | October 12, 2024 |
| Researcher | [家桥 王](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/jia-qiao-wang) |

### Description

The ImagePress – Image Gallery plugin for WordPress is vulnerable to Stored Cross-Site Scripting via admin settings in all versions up to, and including, 1.2.2 due to insufficient input sanitization and output escaping. This makes it possible for authenticated attackers, with administrator-level permissions and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page. This only affects multi-site installations and installations where unfiltered\_html has been disabled.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/image-gallery/trunk/includes/page-settings.php)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3167164/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fimage-gallery%2Fimagepress-image-gallery-122-authenticated-administrator-stored-cross-site-scripting-via-plugin-settings&t=ImagePress%20-%20Image%20Gallery%20%3C%3D%201.2.2%20-%20Authenticated%20%28Administrator%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Plugin%20Settings "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fimage-gallery%2Fimagepress-image-gallery-122-authenticated-administrator-stored-cross-site-scripting-via-plugin-settings&text=ImagePress%20-%20Image%20Gallery%20%3C%3D%201.2.2%20-%20Authenticated%20%28Administrator%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Plugin%20Settings "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fimage-gallery%2Fimagepress-image-gallery-122-authenticated-administrator-stored-cross-site-scripting-via-plugin-settings "LinkedIn")
Email

## Vulnerability Details for ImagePress – Image Gallery

#### [ImagePress – Image Gallery](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/image-gallery)

| Software Type | Plugin |
| --- | --- |
| Software Slug | image-gallery [(view on wordpress.org)](https://wordpress.org/plugins/image-gallery) |
| Patched? | Yes |
| Remediation | Update to version 1.3.0, or a newer patched version |
| Affected Version | * <= 1.2.2 |
| Patched Version | * 1.3.0 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_cc63e987_20250111_070000.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3167164)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3167163 "Changeset 3167163")
* [Next Changeset](/changeset/3167165 "Changeset 3167165") →

---

# Changeset 3167164

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/11/2024 12:39:31 PM
([3 months](/timeline?from=2024-10-11T12%3A39%3A31Z&precision=second "See timeline at 10/11/2024 12:39:31 PM") ago)

Author:
butterflymedia
Message:

Fix 3 vulnerabillities reported via Wordfence

Location:
[image-gallery/trunk](/browser/image-gallery/trunk?rev=3167164)
Files:

8 edited

* [image-gallery.php](/browser/image-gallery/trunk/image-gallery.php?rev=3167164 "Show entry in browser")
  (modified)
  ([13 diffs](#file0 "Show differences"))
* [includes/alpha-functions.php](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3167164 "Show entry in browser")
  (modified)
  ([7 diffs](#file1 "Show differences"))
* [includes/functions.php](/browser/image-gallery/trunk/includes/functions.php?rev=3167164 "Show entry in browser")
  (modified)
  ([15 diffs](#file2 "Show differences"))
* [includes/imagepress-install.php](/browser/image-gallery/trunk/includes/imagepress-install.php?rev=3167164 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [includes/page-settings.php](/browser/image-gallery/trunk/includes/page-settings.php?rev=3167164 "Show entry in browser")
  (modified)
  ([7 diffs](#file4 "Show differences"))
* [index.php](/browser/image-gallery/trunk/index.php?rev=3167164 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [phpcs.xml](/browser/image-gallery/trunk/phpcs.xml?rev=3167164 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [readme.txt](/browser/image-gallery/trunk/readme.txt?rev=3167164 "Show entry in browser")
  (modified)
  ([2 diffs](#file7 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [image-gallery/trunk/image-gallery.php](/changeset/3167164/image-gallery/trunk/image-gallery.php "Show the changeset 3167164 restricted to image-gallery/trunk/image-gallery.php")

  | [r3166568](/browser/image-gallery/trunk/image-gallery.php?rev=3166568#L3 "Show revision 3166568 of this file in browser") | [r3167164](/browser/image-gallery/trunk/image-gallery.php?rev=3167164#L3 "Show revision 3167164 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | Plugin Name: ImagePress - Image Gallery |
  | 4 | 4 | Plugin URI: https://getbutterfly.com/ |
  | 5 |  | Description: A simple, multi-user WordPress image gallery plugin with front-end upload. |
  | 6 |  | Version: 1.~~2.2~~ |
  |  | 5 | Description: A simple, multi-user WordPress plugin with a list of advanced options for creating beautiful, responsive image gallery plugin with front-end upload. |
  |  | 6 | Version: 1.3.0 |
  | 7 | 7 | Author: Ciprian Popescu |
  | 8 | 8 | Author URI: https://getbutterfly.com |
  | […](/browser/image-gallery/trunk/image-gallery.php?rev=3166568#L34) | […](/browser/image-gallery/trunk/image-gallery.php?rev=3167164#L34) |  |
  | 34 | 34 | } |
  | 35 | 35 |  |
  | 36 |  | define( 'IP\_PLUGIN\_VERSION', '1.~~2.2~~' ); |
  |  | 36 | define( 'IP\_PLUGIN\_VERSION', '1.3.0' ); |
  | 37 | 37 | define( 'IP\_PLUGIN\_URL', WP\_PLUGIN\_URL . '/' . dirname( plugin\_basename( \_\_FILE\_\_ ) ) ); |
  | 38 | 38 | define( 'IP\_PLUGIN\_PATH', WP\_PLUGIN\_DIR . '/' . dirname( plugin\_basename( \_\_FILE\_\_ ) ) ); |
  | […](/browser/image-gallery/trunk/image-gallery.php?rev=3166568#L48) | […](/browser/image-gallery/trunk/image-gallery.php?rev=3167164#L48) |  |
  | 48 | 48 | ]; |
  | 49 | 49 |  |
  | 50 |  | ~~updateImagePressO~~ption( $option\_array ); |
  | 51 |  | } |
  | 52 |  | } |
  | 53 |  |  |
  | 54 |  | ~~includ~~e IP\_PLUGIN\_PATH . '/includes/imagepress-install.php'; |
  | 55 |  | ~~includ~~e IP\_PLUGIN\_PATH . '/includes/functions.php'; |
  | 56 |  | ~~includ~~e IP\_PLUGIN\_PATH . '/includes/alpha-functions.php'; |
  | 57 |  | ~~includ~~e IP\_PLUGIN\_PATH . '/includes/cinnamon-users.php'; |
  | 58 |  | ~~includ~~e IP\_PLUGIN\_PATH . '/includes/page-settings.php'; |
  |  | 50 | ip\_update\_option( $option\_array ); |
  |  | 51 | } |
  |  | 52 | } |
  |  | 53 |  |
  |  | 54 | require IP\_PLUGIN\_PATH . '/includes/imagepress-install.php'; |
  |  | 55 | require IP\_PLUGIN\_PATH . '/includes/functions.php'; |
  |  | 56 | require IP\_PLUGIN\_PATH . '/includes/alpha-functions.php'; |
  |  | 57 | require IP\_PLUGIN\_PATH . '/includes/cinnamon-users.php'; |
  |  | 58 | require IP\_PLUGIN\_PATH . '/includes/page-settings.php'; |
  | 59 | 59 |  |
  | 60 | 60 | add\_action( 'plugins\_loaded', 'imagepress\_init' ); |
  | […](/browser/image-gallery/trunk/image-gallery.php?rev=3166568#L197) | […](/browser/image-gallery/trunk/image-gallery.php?rev=3167164#L197) |  |
  | 197 | 197 | $ip\_moderate = (int) get\_imagepress\_option( 'ip\_moderate' ); |
  | 198 | 198 |  |
  | 199 |  | if ( isset( $\_POST['imagepress\_upload\_image\_form\_submitted'] ) && wp\_verify\_nonce( ~~$\_POST['imagepress\_upload\_image\_form\_submitted']~~, 'imagepress\_upload\_image\_form' ) ) { |
  |  | 199 | if ( isset( $\_POST['imagepress\_upload\_image\_form\_submitted'] ) && wp\_verify\_nonce( sanitize\_text\_field( wp\_unslash( $\_POST['imagepress\_upload\_image\_form\_submitted'] ) ), 'imagepress\_upload\_image\_form' ) ) { |
  | 200 | 200 | $ip\_status = ( $ip\_moderate === 0 ) ? 'pending' : 'publish'; |
  | 201 | 201 |  |
  | […](/browser/image-gallery/trunk/image-gallery.php?rev=3166568#L204) | […](/browser/image-gallery/trunk/image-gallery.php?rev=3167164#L204) |  |
  | 204 | 204 |  |
  | 205 | 205 | if ( ! empty( $\_POST['imagepress\_image\_caption'] ) ) { |
  | 206 |  | $ip\_image\_caption = sanitize\_text\_field( ~~$\_POST['imagepress\_image\_caption']~~ ); |
  |  | 206 | $ip\_image\_caption = sanitize\_text\_field( wp\_unslash( $\_POST['imagepress\_image\_caption'] ) ); |
  | 207 | 207 | } |
  | 208 | 208 |  |
  | 209 | 209 | $user\_image\_data = [ |
  | 210 | 210 | 'post\_title'   => $ip\_image\_caption, |
  | 211 |  | 'post\_content' => sanitize\_text\_field( ~~$\_POST['imagepress\_image\_description']~~ ), |
  |  | 211 | 'post\_content' => sanitize\_text\_field( wp\_unslash( $\_POST['imagepress\_image\_description'] ) ), |
  | 212 | 212 | 'post\_status'  => $ip\_status, |
  | 213 | 213 | 'post\_author'  => $ip\_image\_author, |
  | […](/browser/image-gallery/trunk/image-gallery.php?rev=3166568#L243) | […](/browser/image-gallery/trunk/image-gallery.php?rev=3167164#L243) |  |
  | 243 | 243 |  |
  | 244 | 244 | $headers[] = "MIME-Version: 1.0\r\n"; |
  | 245 |  | $headers[] = ~~"Content-Type: text/html; charset=\""~~ . get\_option( 'blog\_charset' ) . "\"\r\n"; |
  |  | 245 | $headers[] = 'Content-Type: text/html; charset="' . get\_option( 'blog\_charset' ) . "\"\r\n"; |
  | 246 | 246 | wp\_mail( $notification\_email, $notification\_subject, $notification\_message, $headers ); |
  | 247 | 247 |  |
  | […](/browser/image-gallery/trunk/image-gallery.php?rev=3166568#L260) | […](/browser/image-gallery/trunk/image-gallery.php?rev=3167164#L260) |  |
  | 260 | 260 | $out .= '<p>' . \_\_( 'You need to be logged in to upload an image.', 'image-gallery' ) . '</p>'; |
  | 261 | 261 | } |
  | 262 |  | if ( ( (int) get\_imagepress\_option( 'ip\_registration' ) === 0 && is\_user\_logged\_in() ) || (int) get\_imagepress\_option( 'ip\_registration' ) === 1 ) { |
  |  | 262 |  |
  |  | 263 | if ( |
  |  | 264 | ( (int) get\_imagepress\_option( 'ip\_registration' ) === 0 && is\_user\_logged\_in() ) || |
  |  | 265 | (int) get\_imagepress\_option( 'ip\_registration' ) === 1 |
  |  | 266 | ) { |
  | 263 | 267 | if ( isset( $\_POST['imagepress\_image\_caption'] ) && isset( $\_POST['imagepress\_image\_category'] ) ) { |
  | 264 |  | $out .= imagepress\_get\_upload\_image\_form( $imagepress\_image\_caption = $\_POST['imagepress\_image\_caption'], $imagepress\_image\_category = $\_POST['imagepress\_image\_category'], $imagepress\_image\_description = $\_POST['imagepress\_image\_description'], $category ); |
  |  | 268 | $out                             .= imagepress\_get\_upload\_image\_form( |
  |  | 269 | $imagepress\_image\_caption     = sanitize\_text\_field( wp\_unslash( $\_POST['imagepress\_image\_caption'] ) ), |
  |  | 270 | $imagepress\_image\_category    = sanitize\_text\_field( wp\_unslash( $\_POST['imagepress\_image\_category'] ) ), |
  |  | 271 | $imagepress\_image\_description = sanitize\_text\_field( wp\_unslash( $\_POST['imagepress\_image\_description'] ) ), |
  |  | 272 | $category |
  |  | 273 | ); |
  | 265 | 274 | } else { |
  | 266 | 275 | $out .= imagepress\_get\_upload\_image\_form( '', '', '', $category ); |
  | […](/browser/image-gallery/trunk/image-gallery.php?rev=3166568#L334) | […](/browser/image-gallery/trunk/image-gallery.php?rev=3167164#L343) |  |
  | 334 | 343 | $out .= wp\_nonce\_field( 'imagepress\_upload\_image\_form', 'imagepress\_upload\_image\_form\_submitted', true, false ); |
  | 335 | 344 |  |
  | 336 |  | ~~if (!empty($ip\_caption\_label))~~ |
  | 337 |  | $out .= '<p> |
  |  | 345 | if ( ! empty( $ip\_caption\_label ) ) { |
  |  | 346 | $out .= '<p> |
  | 338 | 347 | <label>' . $ip\_caption\_label . '</label> |
  | 339 | 348 | <input type="text" id="imagepress\_image\_caption" name="imagepress\_image\_caption" placeholder="' . $ip\_caption\_label . '" required> |
  | 340 | 349 | </p>'; |
  | 341 |  |  |
  | 342 |  | if (!empty($ip\_description\_label)) { |
  | 343 |  | $out .= '<p> |
  | 344 |  | <label>' . get\_imagepress\_option('ip\_description\_label') . '</label> |
  | 345 |  | <textarea id="imagepress\_image\_description" name="imagepress\_image\_description" placeholder="' . get\_imagepress\_option('ip\_description\_label') . '" rows="6"></textarea> |
  |  | 350 | } |
  |  | 351 |  |
  |  | 352 | if ( ! empty( $ip\_description\_label ) ) { |
  |  | 353 | $out .= '<p> |
  |  | 354 | <label>' . get\_imagepress\_option( 'ip\_description\_label' ) . '</label> |
  |  | 355 | <textarea id="imagepress\_image\_description" name="imagepress\_image\_description" placeholder="' . get\_imagepress\_option( 'ip\_description\_label' ) . '" rows="6"></textarea> |
  | 346 | 356 | </p>'; |
  | 347 |  | } |
  |  | 357 | } |
  | 348 | 358 |  |
  | 349 | 359 | $out .= '<p>'; |
  | 350 |  | ~~if ('' != $imagepress\_hardcoded\_category~~) { |
  | 351 |  | ~~$iphcc = get\_term\_by('slug', $imagepress\_hardcoded\_category, 'imagepress\_image\_category'~~); // ImagePress hard-coded category |
  | 352 |  | ~~$out~~ .= '<input type="hidden" id="imagepress\_image\_category" name="imagepress\_image\_category" value="' . $iphcc->term\_id . '">'; |
  | 353 |  | } else { |
  | 354 |  | ~~$out .= imagepress\_get\_image\_categories\_dropdown('imagepress\_image\_category', ''~~); |
  | 355 |  | } |
  |  | 360 | if ( '' != $imagepress\_hardcoded\_category ) { |
  |  | 361 | $iphcc = get\_term\_by( 'slug', $imagepress\_hardcoded\_category, 'imagepress\_image\_category' ); // ImagePress hard-coded category |
  |  | 362 | $out  .= '<input type="hidden" id="imagepress\_image\_category" name="imagepress\_image\_category" value="' . $iphcc->term\_id . '">'; |
  |  | 363 | } else { |
  |  | 364 | $out .= imagepress\_get\_image\_categories\_dropdown( 'imagepress\_image\_category', '' ); |
  |  | 365 | } |
  | 356 | 366 | $out .= '</p>'; |
  | 357 | 367 |  |
  | 358 |  | $uploadsize ~~= number\_format((($ip\_upload\_size \* 1024)/1024000), 0, '.', ''~~); |
  |  | 368 | $uploadsize     = number\_format( ( ( $ip\_upload\_size \* 1024 ) / 1024000 ), 0, '.', '' ); |
  | 359 | 369 | $datauploadsize = $uploadsize \* 1024000; |
  | 360 | 370 |  |
  | […](/browser/image-gallery/trunk/image-gallery.php?rev=3166568#L362) | […](/browser/image-gallery/trunk/image-gallery.php?rev=3167164#L372) |  |
  | 362 | 372 |  |
  | 363 | 373 | <label for="imagepress\_image\_file" id="dropContainer" class="dropSelector"> |
  | 364 |  | <b>' . \_\_(~~'Drop files here<br><small>or</small>', 'image-gallery'~~) . '</b><br> |
  |  | 374 | <b>' . \_\_( 'Drop files here<br><small>or</small>', 'image-gallery' ) . '</b><br> |
  | 365 | 375 | <input type="file" accept="image/\*" data-max-size="' . $datauploadsize . '" name="imagepress\_image\_file" id="imagepress\_image\_file" required> |
  | 366 |  | <br><small>' . $uploadsize . 'MB ' . \_\_(~~'maximum', 'image-gallery'~~) . '</small> |
  |  | 376 | <br><small>' . $uploadsize . 'MB ' . \_\_( 'maximum', 'image-gallery' ) . '</small> |
  | 367 | 377 | </label> |
  | 368 | 378 |  |
  | 369 | 379 | <hr>'; |
  | 370 | 380 |  |
  | 371 |  | ~~if ((int) $ip\_upload\_tos === 1 && !empty($ip\_upload\_tos\_content)~~) { |
  | 372 |  | ~~$oninvalid = get\_imagepress\_option('ip\_upload\_tos\_error'~~); |
  | 373 |  |  |
  | 374 |  | $out .= '<p><input type="checkbox" id="imagepress\_agree" name="imagepress\_agree" value="1" onchange="this.setCustomValidity(validity.valueMissing ? \'' . $oninvalid . '\' : \'\');" required> '; |
  | 375 |  |  |
  | 376 |  | ~~if (!empty($ip\_upload\_tos\_url)~~) { |
  | 377 |  | $out .= '<a href="' . $ip\_upload\_tos\_url . '" target="\_blank">' . $ip\_upload\_tos\_content . '</a>'; |
  | 378 |  | } else { |
  | 379 |  | $out .= $ip\_upload\_tos\_content; |
  | 380 |  | } |
  | 381 |  |  |
  | 382 |  | $out .= '</p> |
  |  | 381 | if ( (int) $ip\_upload\_tos === 1 && ! empty( $ip\_upload\_tos\_content ) ) { |
  |  | 382 | $oninvalid = get\_imagepress\_option( 'ip\_upload\_tos\_error' ); |
  |  | 383 |  |
  |  | 384 | $out .= '<p><input type="checkbox" id="imagepress\_agree" name="imagepress\_agree" value="1" onchange="this.setCustomValidity(validity.valueMissing ? \'' . $oninvalid . '\' : \'\');" required> '; |
  |  | 385 |  |
  |  | 386 | if ( ! empty( $ip\_upload\_tos\_url ) ) { |
  |  | 387 | $out .= '<a href="' . $ip\_upload\_tos\_url . '" target="\_blank">' . $ip\_upload\_tos\_content . '</a>'; |
  |  | 388 | } else { |
  |  | 389 | $out .= $ip\_upload\_tos\_content; |
  |  | 390 | } |
  |  | 391 |  |
  |  | 392 | $out .= '</p> |
  | 383 | 393 | <script>document.getElementById("imagepress\_agree").setCustomValidity("' . $oninvalid . '");</script>'; |
  | 384 |  | } |
  |  | 394 | } |
  | 385 | 395 |  |
  | 386 | 396 | $out .= '<p> |
  | […](/browser/image-gallery/trunk/image-gallery.php?rev=3166568#L393) | […](/browser/image-gallery/trunk/image-gallery.php?rev=3167164#L403) |  |
  | 393 | 403 | } |
  | 394 | 404 |  |
  | 395 |  | function imagepress\_get\_image\_categories\_dropdown($taxonomy, $selected ) { |
  |  | 405 | function imagepress\_get\_image\_categories\_dropdown( $taxonomy, $selected ) { |
  | 396 | 406 | return wp\_dropdown\_categories( |
  | 397 | 407 | [ |
  | 398 |  | 'taxonomy'        => $taxonomy, |
  | 399 |  | 'name'            => 'imagepress\_image\_category', |
  | 400 |  | 'selected'        => $selected, |
  | 401 |  | ~~'exclude'         => get\_imagepress\_option('ip\_cat\_exclude'~~), |
  | 402 |  | 'hide\_empty'      => 0, |
  | 403 |  | 'echo'            => 0, |
  | 404 |  | 'orderby'         => 'name', |
  | 405 |  | ~~'show\_option\_all' => get\_imagepress\_option('ip\_category\_label'~~), |
  | 406 |  | 'required'        => true, |
  |  | 408 | 'taxonomy'        => $taxonomy, |
  |  | 409 | 'name'            => 'imagepress\_image\_category', |
  |  | 410 | 'selected'        => $selected, |
  |  | 411 | 'exclude'         => get\_imagepress\_option( 'ip\_cat\_exclude' ), |
  |  | 412 | 'hide\_empty'      => 0, |
  |  | 413 | 'echo'            => 0, |
  |  | 414 | 'orderby'         => 'name', |
  |  | 415 | 'show\_option\_all' => get\_imagepress\_option( 'ip\_category\_label' ), |
  |  | 416 | 'required'        => true, |
  | 407 | 417 | ] |
  | 408 | 418 | ); |
  | […](/browser/image-gallery/trunk/image-gallery.php?rev=3166568#L417) | […](/browser/image-gallery/trunk/image-gallery.php?rev=3167164#L427) |  |
  | 417 | 427 | } |
  | 418 | 428 |  |
  | 419 |  | register\_activation\_hook(~~\_\_FILE\_\_, 'imagepress\_activate'~~); |
  | 420 |  | register\_deactivation\_hook(~~\_\_FILE\_\_, 'imagepress\_deactivate'~~); |
  |  | 429 | register\_activation\_hook( \_\_FILE\_\_, 'imagepress\_activate' ); |
  |  | 430 | register\_deactivation\_hook( \_\_FILE\_\_, 'imagepress\_deactivate' ); |
  | 421 | 431 | //register\_uninstall\_hook( \_\_FILE\_\_, 'imagepress\_uninstall'); |
  | 422 | 432 |  |
  | […](/browser/image-gallery/trunk/image-gallery.php?rev=3166568#L424) | […](/browser/image-gallery/trunk/image-gallery.php?rev=3167164#L434) |  |
  | 424 | 434 |  |
  | 425 | 435 | // enqueue admin scripts and styles |
  | 426 |  | add\_action(~~'admin\_enqueue\_scripts', 'ip\_enqueue\_color\_picker'~~); |
  |  | 436 | add\_action( 'admin\_enqueue\_scripts', 'ip\_enqueue\_color\_picker' ); |
  | 427 | 437 | function ip\_enqueue\_color\_picker() { |
  | 428 | 438 | wp\_enqueue\_style( 'imagepress', plugins\_url( 'css/ip-admin.css', \_\_FILE\_\_ ), [], IP\_PLUGIN\_VERSION ); |
  | […](/browser/image-gallery/trunk/image-gallery.php?rev=3166568#L472) | […](/browser/image-gallery/trunk/image-gallery.php?rev=3167164#L482) |  |
  | 472 | 482 |  |
  | 473 | 483 |  |
  | 474 |  | function imagepress\_notify\_status(~~$new\_status, $old\_status, $post~~) { |
  |  | 484 | function imagepress\_notify\_status( $new\_status, $old\_status, $post ) { |
  | 475 | 485 | global $current\_user; |
  | 476 |  | $contributor = get\_userdata(~~$post->post\_author~~); |
  |  | 486 | $contributor = get\_userdata( $post->post\_author ); |
  | 477 | 487 |  |
  | 478 | 488 | $headers[] = "MIME-Version: 1.0\r\n"; |
  | 479 |  | $headers[] = ~~"Content-Type: text/html; charset=\"" . get\_option('blog\_charset'~~) . "\"\r\n"; |
  | 480 |  |  |
  | 481 |  | if (~~(string) $old\_status !== 'pending' && (string) $new\_status === 'pending' && (string) get\_imagepress\_option('ip\_notification\_email') !== ''~~) { |
  | 482 |  | $subject ~~= '[' . get\_option('blogname'~~) . '] "' . $post->post\_title . '" pending review'; |
  | 483 |  | $message = "<p>A new post by {$contributor->display\_name} is pending review.</p>"; |
  |  | 489 | $headers[] = 'Content-Type: text/html; charset="' . get\_option( 'blog\_charset' ) . "\"\r\n"; |
  |  | 490 |  |
  |  | 491 | if ( (string) $old\_status !== 'pending' && (string) $new\_status === 'pending' && (string) get\_imagepress\_option( 'ip\_notification\_email' ) !== '' ) { |
  |  | 492 | $subject  = '[' . get\_option( 'blogname' ) . '] "' . $post->post\_title . '" pending review'; |
  |  | 493 | $message  = "<p>A new post by {$contributor->display\_name} is pending review.</p>"; |
  | 484 | 494 | $message .= "<p>Author: {$contributor->user\_login} <{$contributor->user\_email}></p>"; |
  | 485 | 495 | $message .= "<p>Title: {$post->post\_title}</p>"; |
  | 486 |  | $category = get\_the\_category(~~$post->ID~~); |
  | 487 |  | if (~~isset($category[0])~~) { |
  |  | 496 | $category = get\_the\_category( $post->ID ); |
  |  | 497 | if ( isset( $category[0] ) ) { |
  | 488 | 498 | $message .= "<p>Category: {$category[0]->name}</p>"; |
  | 489 | 499 | } |
  | 490 | 500 |  |
  | 491 |  | wp\_mail(~~get\_imagepress\_option('ip\_notification\_email'), $subject, $message, $headers~~); |
  | 492 |  | } else~~if ((string) $old\_status === 'pending' && (string) $new\_status === 'publish' && (string) get\_imagepress\_option('approvednotification') === 'yes'~~) { |
  | 493 |  | $subject = '[' . get\_option(~~'blogname'~~) . '] "' . $post->post\_title . '" approved'; |
  | 494 |  | $message = "<p>{$contributor->display\_name}, your post has been approved and published at " . get\_permalink(~~$post->ID) . ".</p>"~~; |
  | 495 |  |  |
  | 496 |  | wp\_mail(~~$contributor->user\_email, $subject, $message, $headers~~); |
  | 497 |  | } else~~if ((string) $old\_status === 'pending' && (string) $new\_status === 'draft' && (int) $current\_user->ID != (int) $contributor->ID && (string) get\_imagepress\_option('declinednotification') === 'yes'~~) { |
  | 498 |  | $subject = '[' . get\_option(~~'blogname'~~) . '] "' . $post->post\_title . '" declined'; |
  |  | 501 | wp\_mail( get\_imagepress\_option( 'ip\_notification\_email' ), $subject, $message, $headers ); |
  |  | 502 | } elseif ( (string) $old\_status === 'pending' && (string) $new\_status === 'publish' && (string) get\_imagepress\_option( 'approvednotification' ) === 'yes' ) { |
  |  | 503 | $subject = '[' . get\_option( 'blogname' ) . '] "' . $post->post\_title . '" approved'; |
  |  | 504 | $message = "<p>{$contributor->display\_name}, your post has been approved and published at " . get\_permalink( $post->ID ) . '.</p>'; |
  |  | 505 |  |
  |  | 506 | wp\_mail( $contributor->user\_email, $subject, $message, $headers ); |
  |  | 507 | } elseif ( (string) $old\_status === 'pending' && (string) $new\_status === 'draft' && (int) $current\_user->ID !== (int) $contributor->ID && (string) get\_imagepress\_option( 'declinednotification' ) === 'yes' ) { |
  |  | 508 | $subject = '[' . get\_option( 'blogname' ) . '] "' . $post->post\_title . '" declined'; |
  | 499 | 509 | $message = "<p>{$contributor->display\_name}, your post has not been approved.</p>"; |
  | 500 | 510 |  |
  | 501 |  | wp\_mail(~~$contributor->user\_email, $subject, $message, $headers~~); |
  | 502 |  | } |
  | 503 |  | } |
  |  | 511 | wp\_mail( $contributor->user\_email, $subject, $message, $headers ); |
  |  | 512 | } |
  |  | 513 | } |
* ## [image-gallery/trunk/includes/alpha-functions.php](/changeset/3167164/image-gallery/trunk/includes/alpha-functions.php "Show the changeset 3167164 restricted to image-gallery/trunk/includes/alpha-functions.php")

  | [r3166568](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3166568#L10 "Show revision 3166568 of this file in browser") | [r3167164](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3167164#L10 "Show revision 3167164 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | \*/ |
  | 11 | 11 |  |
  | 12 |  | add\_shortcode(~~'imagepress-loop', 'imagepress\_loop'~~); |
  |  | 12 | add\_shortcode( 'imagepress-loop', 'imagepress\_loop' ); |
  | 13 | 13 |  |
  | 14 | 14 | function imagepress\_url\_builder( $sort, $range, $taxonomy, $query = '' ) { |
  | 15 | 15 | if ( empty( $sort ) && ! empty( $\_GET['sort'] ) ) { |
  | 16 |  | $sort = sanitize\_text\_field( ~~$\_GET['sort']~~ ); |
  |  | 16 | $sort = sanitize\_text\_field( wp\_unslash( $\_GET['sort'] ) ); |
  | 17 | 17 | } |
  | 18 | 18 |  |
  | 19 | 19 | if ( empty( $range ) && ! empty( $\_GET['range'] ) ) { |
  | 20 |  | $range = sanitize\_text\_field( ~~$\_GET['range']~~ ); |
  |  | 20 | $range = sanitize\_text\_field( wp\_unslash( $\_GET['range'] ) ); |
  | 21 | 21 | } |
  | 22 | 22 |  |
  | […](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3166568#L24) | […](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3167164#L24) |  |
  | 24 | 24 | $taxonomy = ''; |
  | 25 | 25 | } elseif ( empty( $taxonomy ) && ! empty( $\_GET['t'] ) ) { |
  | 26 |  | $taxonomy = sanitize\_text\_field( ~~$\_GET['t']~~ ); |
  |  | 26 | $taxonomy = sanitize\_text\_field( wp\_unslash( $\_GET['t'] ) ); |
  | 27 | 27 | } |
  | 28 | 28 |  |
  | […](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3166568#L33) | […](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3167164#L33) |  |
  | 33 | 33 | ]; |
  | 34 | 34 |  |
  | 35 |  | // Get position where '/page' text starts |
  | 36 |  | $pos = strpos( $\_SERVER['REQUEST\_URI'], '/page' ); |
  | 37 |  | // Remove string from specific position |
  | 38 |  | $final\_url = substr( $\_SERVER['REQUEST\_URI'], 0, $pos ); |
  | 39 |  |  |
  | 40 |  | return strtok( $final\_url, '?' ) . '?' . http\_build\_query( $url\_parameters ); |
  |  | 35 | if ( isset( $\_SERVER['REQUEST\_URI'] ) ) { |
  |  | 36 | $request\_uri = sanitize\_text\_field( wp\_unslash( $\_SERVER['REQUEST\_URI'] ) ); |
  |  | 37 |  |
  |  | 38 | // Get position where '/page' text starts |
  |  | 39 | $pos = strpos( $request\_uri, '/page' ); |
  |  | 40 | // Remove string from specific position |
  |  | 41 | $final\_url = substr( $request\_uri, 0, $pos ); |
  |  | 42 |  |
  |  | 43 | return strtok( $final\_url, '?' ) . '?' . http\_build\_query( $url\_parameters ); |
  |  | 44 | } |
  | 41 | 45 | } |
  | 42 | 46 |  |
  | […](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3166568#L48) | […](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3167164#L52) |  |
  | 48 | 52 | } |
  | 49 | 53 |  |
  | 50 |  | $sort  = ( isset( $\_GET['sort'] ) ) ? sanitize\_text\_field( ~~$\_GET['sort']~~ ) : ''; |
  | 51 |  | $range = ( isset( $\_GET['range'] ) ) ? sanitize\_text\_field( ~~$\_GET['range']~~ ) : ''; |
  | 52 |  | $tax   = ( isset( $\_GET['t'] ) ) ? sanitize\_text\_field( ~~$\_GET['t']~~ ) : ''; |
  |  | 54 | $sort  = ( isset( $\_GET['sort'] ) ) ? sanitize\_text\_field( wp\_unslash( $\_GET['sort'] ) ) : ''; |
  |  | 55 | $range = ( isset( $\_GET['range'] ) ) ? sanitize\_text\_field( wp\_unslash( $\_GET['range'] ) ) : ''; |
  |  | 56 | $tax   = ( isset( $\_GET['t'] ) ) ? sanitize\_text\_field( wp\_unslash( $\_GET['t'] ) ) : ''; |
  | 53 | 57 |  |
  | 54 | 58 | $out = '<p class="ip-sorter-primary" id="ip-sorter-primary"> |
  | […](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3166568#L76) | […](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3167164#L80) |  |
  | 76 | 80 | $terms = get\_terms( 'imagepress\_image\_category' ); |
  | 77 | 81 |  |
  | 78 |  | if ( ! empty( $terms ) && ! is\_wp\_error( $terms ) ) { |
  | 79 |  | foreach ( $terms as $term ) { |
  | 80 |  | $out .= '<option value="' . imagepress\_url\_builder( '', '', $term->slug, $query\_value ) . '" ' . selected( $term->slug, $tax, false ) . '>' . $term->name . '</option>'; |
  | 81 |  | } |
  | 82 |  | } |
  |  | 82 | if ( ! empty( $terms ) && ! is\_wp\_error( $terms ) ) { |
  |  | 83 | foreach ( $terms as $term ) { |
  |  | 84 | $out .= '<option value="' . imagepress\_url\_builder( '', '', $term->slug, $query\_value ) . '" ' . selected( $term->slug, $tax, false ) . '>' . $term->name . '</option>'; |
  |  | 85 | } |
  |  | 86 | } |
  | 83 | 87 |  |
  | 84 | 88 | $out .= '</select> |
  | […](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3166568#L90) | […](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3167164#L94) |  |
  | 90 | 94 | } |
  | 91 | 95 |  |
  | 92 |  | function imagepress\_loop($atts) { |
  | 93 |  | extract(shortcode\_atts(array( |
  | 94 |  | 'category'      => '', |
  | 95 |  | 'count'         => 0, |
  | 96 |  | 'limit'         => 999999, |
  | 97 |  | 'user'          => 0, |
  | 98 |  | 'columns'       => '', |
  | 99 |  | 'pending'       => 'no', |
  | 100 |  | 'sort'          => 'no', |
  | 101 |  | 'filters'       => 'no', |
  | 102 |  | 'type'          => '', // 'random' |
  | 103 |  | 'collection'    => '', // new parameter (will extract all images from a certain collection) |
  | 104 |  | 'collection\_id' => '', // new parameter (will extract all images from a certain collection) |
  | 105 |  | 'order'         => '', // only used by profile viewer |
  | 106 |  |  |
  | 107 |  | 'fieldname'     => '', |
  | 108 |  | 'fieldvalue'    => '', |
  | 109 |  | 'mode' => '', |
  | 110 |  | ), $atts)); |
  | 111 |  |  |
  | 112 |  | $out = ''; |
  | 113 |  | $ipSlug = (string) get\_imagepress\_option('ip\_slug'); |
  | 114 |  |  |
  | 115 |  | if ((string) trim($filters) === 'yes') { |
  |  | 96 | function imagepress\_loop( $atts ) { |
  |  | 97 | extract( |
  |  | 98 | shortcode\_atts( |
  |  | 99 | [ |
  |  | 100 | 'category'      => '', |
  |  | 101 | 'count'         => 0, |
  |  | 102 | 'limit'         => 999999, |
  |  | 103 | 'user'          => 0, |
  |  | 104 | 'columns'       => '', |
  |  | 105 | 'pending'       => 'no', |
  |  | 106 | 'sort'          => 'no', |
  |  | 107 | 'filters'       => 'no', |
  |  | 108 | 'type'          => '', // 'random' |
  |  | 109 | 'collection'    => '', // new parameter (will extract all images from a certain collection) |
  |  | 110 | 'collection\_id' => '', // new parameter (will extract all images from a certain collection) |
  |  | 111 | 'order'         => '', // only used by profile viewer |
  |  | 112 |  |
  |  | 113 | 'fieldname'     => '', |
  |  | 114 | 'fieldvalue'    => '', |
  |  | 115 | 'mode'          => '', |
  |  | 116 | ], |
  |  | 117 | $atts |
  |  | 118 | ) |
  |  | 119 | ); |
  |  | 120 |  |
  |  | 121 | $out     = ''; |
  |  | 122 | $ip\_slug = (string) get\_imagepress\_option( 'ip\_slug' ); |
  |  | 123 |  |
  |  | 124 | if ( (string) trim( $filters ) === 'yes' ) { |
  | 116 | 125 | $out .= imagepress\_get\_discover\_filters(); |
  | 117 | 126 | } |
  | 118 | 127 |  |
  | 119 |  | $paged = (~~get\_query\_var('paged')) ? get\_query\_var('paged'~~) : 1; |
  | 120 |  |  |
  | 121 |  | if (~~(int) $count > 0~~) { |
  |  | 128 | $paged = ( get\_query\_var( 'paged' ) ) ? get\_query\_var( 'paged' ) : 1; |
  |  | 129 |  |
  |  | 130 | if ( (int) $count > 0 ) { |
  | 122 | 131 | $ipp = (int) $count; |
  | 123 | 132 | } else { |
  | 124 |  | $ipp = (int) get\_imagepress\_option(~~'ip\_ipp'~~); |
  | 125 |  | } |
  | 126 |  | $args1 = ~~array(~~ |
  | 127 |  | 'post\_type' ~~=> $ipS~~lug, |
  | 128 |  | 'paged' => $paged, |
  |  | 133 | $ipp = (int) get\_imagepress\_option( 'ip\_ipp' ); |
  |  | 134 | } |
  |  | 135 | $args1 = [ |
  |  | 136 | 'post\_type'      => $ip\_slug, |
  |  | 137 | 'paged'          => $paged, |
  | 129 | 138 | 'posts\_per\_page' => $ipp, |
  | 130 |  | 'post\_status' => 'publish', |
  | 131 |  | ~~)~~; |
  |  | 139 | 'post\_status'    => 'publish', |
  |  | 140 | ]; |
  | 132 | 141 |  |
  | 133 | 142 | // Search query arguments |
  | 134 |  | if (~~isset($\_GET['q']) && !empty($\_GET['q'])~~) { |
  | 135 |  | $query = sanitize\_text\_field(~~$\_GET['q']~~); |
  |  | 143 | if ( isset( $\_GET['q'] ) && ! empty( $\_GET['q'] ) ) { |
  |  | 144 | $query = sanitize\_text\_field( $\_GET['q'] ); |
  | 136 | 145 |  |
  | 137 | 146 | $args1['s'] = (string) $query; |
  | 138 | 147 | } |
  | 139 | 148 |  |
  | 140 |  | if (~~isset($\_GET['t']) && !empty($\_GET['t'])~~) { |
  | 141 |  | $taxonomy ~~= (string) sanitize\_text\_field($\_GET['t']~~); |
  | 142 |  | $tax\_query ~~= array(~~ |
  | 143 |  | ~~array(~~ |
  | 144 |  | 'taxonomy' => 'imagepress\_image\_category', |
  | 145 |  | 'field' => 'slug', |
  | 146 |  | 'terms' => $taxonomy, |
  |  | 149 | if ( isset( $\_GET['t'] ) && ! empty( $\_GET['t'] ) ) { |
  |  | 150 | $taxonomy           = (string) sanitize\_text\_field( $\_GET['t'] ); |
  |  | 151 | $tax\_query          = [ |
  |  | 152 | [ |
  |  | 153 | 'taxonomy'         => 'imagepress\_image\_category', |
  |  | 154 | 'field'            => 'slug', |
  |  | 155 | 'terms'            => $taxonomy, |
  | 147 | 156 | 'include\_children' => true, |
  | 148 |  | 'operator' => 'IN', |
  | 149 |  | ~~)~~ |
  | 150 |  | ~~)~~; |
  |  | 157 | 'operator'         => 'IN', |
  |  | 158 | ], |
  |  | 159 | ]; |
  | 151 | 160 | $args1['tax\_query'] = $tax\_query; |
  | 152 | 161 | } |
  | 153 | 162 |  |
  | 154 | 163 | // Check "category" parameter |
  | 155 |  | if (~~!empty($category)~~) { |
  | 156 |  | $tax\_query ~~= array(~~ |
  | 157 |  | ~~array(~~ |
  | 158 |  | 'taxonomy' => 'imagepress\_image\_category', |
  | 159 |  | 'field' => 'slug', |
  | 160 |  | 'terms' => $category, |
  |  | 164 | if ( ! empty( $category ) ) { |
  |  | 165 | $tax\_query          = [ |
  |  | 166 | [ |
  |  | 167 | 'taxonomy'         => 'imagepress\_image\_category', |
  |  | 168 | 'field'            => 'slug', |
  |  | 169 | 'terms'            => $category, |
  | 161 | 170 | 'include\_children' => true, |
  | 162 |  | 'operator' => 'IN', |
  | 163 |  | ~~)~~, |
  | 164 |  | ~~)~~; |
  |  | 171 | 'operator'         => 'IN', |
  |  | 172 | ], |
  |  | 173 | ]; |
  | 165 | 174 | $args1['tax\_query'] = $tax\_query; |
  | 166 | 175 | } |
  | 167 | 176 |  |
  | 168 | 177 | // Check "user/author" parameter |
  | 169 |  | if (~~!empty($user)~~) { |
  |  | 178 | if ( ! empty( $user ) ) { |
  | 170 | 179 | $args1['author'] = (int) $user; |
  | 171 | 180 | } |
  | 172 | 181 |  |
  | 173 |  | if (~~(string) $order === 'custom'~~) { |
  |  | 182 | if ( (string) $order === 'custom' ) { |
  | 174 | 183 | $args1['orderby'] = 'menu\_order'; |
  | 175 |  | $args1['order'] = 'ASC'; |
  | 176 |  | } |
  | 177 |  |  |
  | 178 |  | if (~~!empty($fieldname) && !empty($fieldvalue)~~) { |
  | 179 |  | $field\_query ~~= array(~~ |
  | 180 |  | ~~array(~~ |
  | 181 |  | 'key' => $fieldname, |
  |  | 184 | $args1['order']   = 'ASC'; |
  |  | 185 | } |
  |  | 186 |  |
  |  | 187 | if ( ! empty( $fieldname ) && ! empty( $fieldvalue ) ) { |
  |  | 188 | $field\_query         = [ |
  |  | 189 | [ |
  |  | 190 | 'key'   => $fieldname, |
  | 182 | 191 | 'value' => $fieldvalue, |
  | 183 |  | ~~)~~, |
  | 184 |  | ~~)~~; |
  |  | 192 | ], |
  |  | 193 | ]; |
  | 185 | 194 | $args1['meta\_query'] = $field\_query; |
  | 186 | 195 | } |
  | 187 | 196 |  |
  | 188 | 197 | // Most liked images |
  | 189 |  | if (~~(string) $sort !== 'no'~~) { |
  | 190 |  | $args1['meta\_query'] = ~~array(~~ |
  | 191 |  | 'key' => '\_like\_count' |
  | 192 |  | ~~)~~; |
  | 193 |  | $args1['meta\_key'] = '\_like\_count'; |
  | 194 |  | $args1['orderby'] = 'meta\_value\_num'; |
  | 195 |  | $args1['order'] = 'DESC'; |
  | 196 |  | } |
  | 197 |  |  |
  | 198 |  | if (~~isset($\_GET['sort']) || isset($\_GET['range'])~~) { |
  | 199 |  | $sort ~~= (string) trim($\_GET['sort']~~); |
  | 200 |  | $range = (string) trim(~~$\_GET['range']~~); |
  | 201 |  |  |
  | 202 |  | if (~~$sort == 'likes'~~) { |
  | 203 |  | $args1['meta\_query'] = ~~array(~~ |
  | 204 |  | 'key' => '\_like\_count' |
  | 205 |  | ~~)~~; |
  | 206 |  | $args1['meta\_key'] = '\_like\_count'; |
  | 207 |  | $args1['orderby'] = 'meta\_value\_num'; |
  | 208 |  | $args1['order'] = 'DESC'; |
  | 209 |  | } else~~if ($sort == 'views'~~) { |
  | 210 |  | $args1['meta\_query'] = ~~array(~~ |
  | 211 |  | 'key' => 'post\_views\_count' |
  | 212 |  | ~~)~~; |
  | 213 |  | $args1['meta\_key'] = 'post\_views\_count'; |
  | 214 |  | $args1['orderby'] = 'meta\_value\_num'; |
  | 215 |  | $args1['order'] = 'DESC'; |
  | 216 |  | } else~~if ($sort == 'comments'~~) { |
  |  | 198 | if ( (string) $sort !== 'no' ) { |
  |  | 199 | $args1['meta\_query'] = [ |
  |  | 200 | 'key' => '\_like\_count', |
  |  | 201 | ]; |
  |  | 202 | $args1['meta\_key']   = '\_like\_count'; |
  |  | 203 | $args1['orderby']    = 'meta\_value\_num'; |
  |  | 204 | $args1['order']      = 'DESC'; |
  |  | 205 | } |
  |  | 206 |  |
  |  | 207 | if ( isset( $\_GET['sort'] ) || isset( $\_GET['range'] ) ) { |
  |  | 208 | $sort  = (string) trim( $\_GET['sort'] ); |
  |  | 209 | $range = (string) trim( $\_GET['range'] ); |
  |  | 210 |  |
  |  | 211 | if ( $sort == 'likes' ) { |
  |  | 212 | $args1['meta\_query'] = [ |
  |  | 213 | 'key' => '\_like\_count', |
  |  | 214 | ]; |
  |  | 215 | $args1['meta\_key']   = '\_like\_count'; |
  |  | 216 | $args1['orderby']    = 'meta\_value\_num'; |
  |  | 217 | $args1['order']      = 'DESC'; |
  |  | 218 | } elseif ( $sort == 'views' ) { |
  |  | 219 | $args1['meta\_query'] = [ |
  |  | 220 | 'key' => 'post\_views\_count', |
  |  | 221 | ]; |
  |  | 222 | $args1['meta\_key']   = 'post\_views\_count'; |
  |  | 223 | $args1['orderby']    = 'meta\_value\_num'; |
  |  | 224 | $args1['order']      = 'DESC'; |
  |  | 225 | } elseif ( $sort == 'comments' ) { |
  | 217 | 226 | $args1['orderby'] = 'comment\_count'; |
  | 218 | 227 | $args1['orderby'] = 'DESC'; |
  | 219 |  | } else~~if ($sort == 'newest'~~) { |
  |  | 228 | } elseif ( $sort == 'newest' ) { |
  | 220 | 229 | $args1['orderby'] = 'date'; |
  | 221 |  | $args1['order'] = 'DESC'; |
  | 222 |  | } else~~if ($sort == 'oldest'~~) { |
  |  | 230 | $args1['order']   = 'DESC'; |
  |  | 231 | } elseif ( $sort == 'oldest' ) { |
  | 223 | 232 | $args1['orderby'] = 'date'; |
  | 224 |  | $args1['order'] = 'ASC'; |
  |  | 233 | $args1['order']   = 'ASC'; |
  | 225 | 234 | } else { |
  | 226 | 235 | $args1['orderby'] = 'date'; |
  | 227 |  | $args1['order'] = 'DESC'; |
  |  | 236 | $args1['order']   = 'DESC'; |
  | 228 | 237 | } |
  | 229 | 238 |  |
  | 230 | 239 | // Range filtering |
  | 231 |  | if (~~$range == 'lastmonth'~~) { |
  | 232 |  | $date\_query ~~= array(~~ |
  | 233 |  | 'date\_query' => ~~array(~~ |
  |  | 240 | if ( $range == 'lastmonth' ) { |
  |  | 241 | $date\_query          = [ |
  |  | 242 | 'date\_query' => [ |
  | 234 | 243 | 'column' => 'post\_date', |
  | 235 |  | 'after' ~~=> date('Y-m-d', strtotime('-30 days'))~~ |
  | 236 |  | ~~)~~ |
  | 237 |  | ~~)~~; |
  |  | 244 | 'after'  => gmdate( 'Y-m-d', strtotime( '-30 days' ) ), |
  |  | 245 | ], |
  |  | 246 | ]; |
  | 238 | 247 | $args1['date\_query'] = $date\_query; |
  | 239 |  | } else~~if ($range == 'lastweek'~~) { |
  | 240 |  | $date\_query ~~= array(~~ |
  | 241 |  | 'date\_query' => ~~array(~~ |
  |  | 248 | } elseif ( $range == 'lastweek' ) { |
  |  | 249 | $date\_query          = [ |
  |  | 250 | 'date\_query' => [ |
  | 242 | 251 | 'column' => 'post\_date', |
  | 243 |  | 'after' ~~=> date('Y-m-d', strtotime('-7 days'))~~ |
  | 244 |  | ~~)~~ |
  | 245 |  | ~~)~~; |
  |  | 252 | 'after'  => gmdate( 'Y-m-d', strtotime( '-7 days' ) ), |
  |  | 253 | ], |
  |  | 254 | ]; |
  | 246 | 255 | $args1['date\_query'] = $date\_query; |
  | 247 |  | } else~~if ($range == 'lastday'~~) { |
  | 248 |  | $date\_query ~~= array(~~ |
  | 249 |  | 'date\_query' => ~~array(~~ |
  |  | 256 | } elseif ( $range == 'lastday' ) { |
  |  | 257 | $date\_query          = [ |
  |  | 258 | 'date\_query' => [ |
  | 250 | 259 | 'column' => 'post\_date', |
  | 251 |  | 'after' ~~=> date('Y-m-d', strtotime('-1 days'))~~ |
  | 252 |  | ~~)~~ |
  | 253 |  | ~~)~~; |
  |  | 260 | 'after'  => gmdate( 'Y-m-d', strtotime( '-1 days' ) ), |
  |  | 261 | ], |
  |  | 262 | ]; |
  | 254 | 263 | $args1['date\_query'] = $date\_query; |
  | 255 | 264 | } |
  | 256 | 265 | } |
  | 257 | 266 |  |
  | 258 |  | $ip\_query = new WP\_Query(~~$args1~~); |
  |  | 267 | $ip\_query = new WP\_Query( $args1 ); |
  | 259 | 268 |  |
  | 260 | 269 | // Image box appearance |
  | 261 |  | $ip\_box\_ui = (string) get\_imagepress\_option(~~'ip\_box\_ui'~~); |
  |  | 270 | $ip\_box\_ui = (string) get\_imagepress\_option( 'ip\_box\_ui' ); |
  | 262 | 271 |  |
  | 263 | 272 | $out .= '<div id="ip-boxes" class="ip-box-container ip-box-container-' . $ip\_box\_ui . '">'; |
  | 264 |  | ~~if ($ip\_query->have\_posts()~~) { |
  | 265 |  | ~~while ($ip\_query->have\_posts()~~) { |
  | 266 |  | $ip\_query->the\_post(); |
  | 267 |  |  |
  | 268 |  | ~~$out .= ipRenderGridElement(get\_the\_ID()~~); |
  | 269 |  | } |
  | 270 |  |  |
  | 271 |  | // Pagination |
  | 272 |  | ~~if (function\_exists('pagination') && (int) $count == 0~~) { |
  | 273 |  | ~~$out .= pagination($ip\_query->max\_num\_pages~~); |
  | 274 |  | } |
  | 275 |  | } |
  |  | 273 | if ( $ip\_query->have\_posts() ) { |
  |  | 274 | while ( $ip\_query->have\_posts() ) { |
  |  | 275 | $ip\_query->the\_post(); |
  |  | 276 |  |
  |  | 277 | $out .= ip\_render\_grid\_element( get\_the\_ID() ); |
  |  | 278 | } |
  |  | 279 |  |
  |  | 280 | // Pagination |
  |  | 281 | if ( function\_exists( 'pagination' ) && (int) $count == 0 ) { |
  |  | 282 | $out .= pagination( $ip\_query->max\_num\_pages ); |
  |  | 283 | } |
  |  | 284 | } |
  | 276 | 285 | $out .= '</div><div class="ip-clear"></div>'; |
  | 277 | 286 |  |
  | […](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3166568#L297) | […](/browser/image-gallery/trunk/includes/alpha-functions.php?rev=3167164#L306) |  |
  | 297 | 306 | \* ImagePress numbered pagination |
  | 298 | 307 | \*/ |
  | 299 |  | function pagination(~~$pages = '', $range = 2~~) { |
  |  | 308 | function pagination( $pages = '', $range = 2 ) { |
  | 300 | 309 | global $paged; |
  | 301 | 310 |  |
  | 302 |  | $showitems = (~~$range \* 2~~) + 1; |
  | 303 |  | $display = ''; |
  | 304 |  |  |
  | 305 |  | if (~~empty($paged)~~) { |
  |  | 311 | $showitems = ( $range \* 2 ) + 1; |
  |  | 312 | $display   = ''; |
  |  | 313 |  |
  |  | 314 | if ( empty( $paged ) ) { |
  | 306 | 315 | $paged = 1; |
  | 307 | 316 | } |
  | 308 | 317 |  |
  | 309 |  | if (~~1 != $pages~~) { |
  |  | 318 | if ( 1 != $pages ) { |
  | 310 | 319 | $display .= '<div class="native-pagination"> |
  | 311 | 320 | <span>' . $paged . '/' . $pages . '</span>'; |
  | 312 |  | if ($paged > 2 && $paged > $range + 1 && $showitems < $pages) { |
  | 313 |  | $display .= '<a href="' . get\_pagenum\_link(1) . '">&laquo;</a>'; |
  |  | 321 | if ( $paged > 2 && $paged > $range + 1 && $showitems < $pages ) { |
  |  | 322 | $display .= '<a href="' . get\_pagenum\_link( 1 ) . '">&laquo;</a>'; |
  |  | 323 | } |
  |  | 324 | if ( $paged > 1 && $showitems < $pages ) { |
  |  | 325 | $display .= '<a href="' . get\_pagenum\_link( $paged - 1 ) . '">&lsaquo;</a>'; |
  |  | 326 | } |
  |  | 327 |  |
  |  | 328 | for ( $i = 1; $i <= $pages; $i++ ) { |
  |  | 329 | if ( 1 != $pages && ( ! ( $i >= $paged + $range + 1 || $i <= $paged - $range - 1 ) || $pages <= $showitems ) ) { |
  |  | 330 | $display .= ( $paged == $i ) ? '<span class="current">' . $i . '</span>' : '<a href="' . get\_pagenum\_link( $i ) . '" class="inactive">' . $i . '</a>'; |
  | 314 | 331 | } |
  | 315 |  | if ($paged > 1 && $showitems < $pages) { |
  | 316 |  | $display .= '<a href="' . get\_pagenum\_link($paged - 1) . '">&lsaquo;</a>'; |
  | 317 |  | } |
  | 318 |  |  |
  | 319 |  | for ($i=1; $i <= $pages; $i++) { |
  | 320 |  | if (1 != $pages && (!($i >= $paged + $range + 1 || $i <= $paged - $range - 1) || $pages <= $showitems)) { |
  | 321 |  | $display .= ($paged == $i) ? '<span class="current">' . $i . '</span>' : '<a href="' . get\_pagenum\_link($i) . '" class="inactive">' . $i . '</a>'; |
  | 322 |  | } |
  | 323 |  | } |
  | 324 |  |  |
  | 325 |  | if ($paged < $pages && $showitems < $pages) { |
  | 326 |  | $display .= '<a href="' . get\_pagenum\_link($paged + 1) . '">&rsaquo;</a>'; |
  | 327 |  | } |
  | 328 |  | if ($paged < $pages-1 && $paged + $range - 1 < $pages && $showitems < $pages) { |
  | 329 |  | $display .= '<a href="' . get\_pagenum\_link($pages) . '">&raquo;</a>'; |
  | 330 |  | } |
  |  | 332 | } |
  |  | 333 |  |
  |  | 334 | if ( $paged < $pages && $showitems < $pages ) { |
  |  | 335 | $display .= '<a href="' . get\_pagenum\_link( $paged + 1 ) . '">&rsaquo;</a>'; |
  |  | 336 | } |
  |  | 337 | if ( $paged < $pages - 1 && $paged + $range - 1 < $pages && $showitems < $pages ) { |
  |  | 338 | $display .= '<a href="' . get\_pagenum\_link( $pages ) . '">&raquo;</a>'; |
  |  | 339 | } |
  | 331 | 340 | $display .= '</div>'; |
  | 332 | 341 | } |
* ## [image-gallery/trunk/includes/functions.php](/changeset/3167164/image-gallery/trunk/includes/functions.php "Show the changeset 3167164 restricted to image-gallery/trunk/includes/functions.php")

  | [r3166568](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L1 "Show revision 3166568 of this file in browser") | [r3167164](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L1 "Show revision 3167164 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | function imagepress\_registration() { |
  | 3 |  | $ip\_slug = sanitize\_text\_field(~~get\_imagepress\_option('ip\_slug')~~); |
  | 4 |  |  |
  | 5 |  | if (~~empty($ip\_slug)~~) { |
  |  | 3 | $ip\_slug = sanitize\_text\_field( get\_imagepress\_option( 'ip\_slug' ) ); |
  |  | 4 |  |
  |  | 5 | if ( empty( $ip\_slug ) ) { |
  | 6 | 6 | $ip\_slug = 'image'; |
  | 7 | 7 | } |
  | 8 | 8 |  |
  | 9 |  | $image\_type\_labels = ~~array(~~ |
  | 10 |  | 'name'                  => \_x(~~'Images', 'Post type general name', 'image-gallery'~~), |
  | 11 |  | 'singular\_name'         => \_x(~~'Image', 'Post type singular name', 'image-gallery'~~), |
  | 12 |  | 'menu\_name'             => \_\_(~~'ImagePress', 'image-gallery'~~), |
  | 13 |  | 'name\_admin\_bar'        => \_\_(~~'Image', 'image-gallery'~~), |
  | 14 |  | 'archives'              => \_\_(~~'Image archives', 'image-gallery'~~), |
  | 15 |  | 'parent\_item\_colon'     => \_\_(~~'Parent image:', 'image-gallery'~~), |
  | 16 |  | 'all\_items'             => \_\_(~~'All images', 'image-gallery'~~), |
  | 17 |  | 'add\_new\_item'          => \_\_(~~'Add new image', 'image-gallery'~~), |
  | 18 |  | 'add\_new'               => \_\_(~~'Add new', 'image-gallery'~~), |
  | 19 |  | 'new\_item'              => \_\_(~~'New image', 'image-gallery'~~), |
  | 20 |  | 'edit\_item'             => \_\_(~~'Edit image', 'image-gallery'~~), |
  | 21 |  | 'update\_item'           => \_\_(~~'Update image', 'image-gallery'~~), |
  | 22 |  | 'view\_item'             => \_\_(~~'View image', 'image-gallery'~~), |
  | 23 |  | 'search\_items'          => \_\_(~~'Search image', 'image-gallery'~~), |
  | 24 |  | 'not\_found'             => \_\_(~~'Not found', 'image-gallery'~~), |
  | 25 |  | 'not\_found\_in\_trash'    => \_\_(~~'Not found in trash', 'image-gallery'~~), |
  | 26 |  | 'featured\_image'        => \_\_(~~'Featured image', 'image-gallery'~~), |
  | 27 |  | 'set\_featured\_image'    => \_\_(~~'Set featured image', 'image-gallery'~~), |
  | 28 |  | 'remove\_featured\_image' => \_\_(~~'Remove featured image', 'image-gallery'~~), |
  | 29 |  | 'use\_featured\_image'    => \_\_(~~'Use as featured image', 'image-gallery'~~), |
  | 30 |  | 'insert\_into\_item'      => \_\_(~~'Insert into image', 'image-gallery'~~), |
  | 31 |  | 'uploaded\_to\_this\_item' => \_\_(~~'Uploaded to this image', 'image-gallery'~~), |
  | 32 |  | 'items\_list'            => \_\_(~~'Images list', 'image-gallery'~~), |
  | 33 |  | 'items\_list\_navigation' => \_\_(~~'Images list navigation', 'image-gallery'~~), |
  | 34 |  | 'filter\_items\_list'     => \_\_(~~'Filter images list', 'image-gallery'~~), |
  | 35 |  | ~~)~~; |
  | 36 |  |  |
  | 37 |  | $image\_type\_args = ~~array(~~ |
  | 38 |  | 'label'                 => \_\_(~~'Image', 'image-gallery'~~), |
  | 39 |  | 'description'           => \_\_(~~'Image post type', 'image-gallery'~~), |
  |  | 9 | $image\_type\_labels = [ |
  |  | 10 | 'name'                  => \_x( 'Images', 'Post type general name', 'image-gallery' ), |
  |  | 11 | 'singular\_name'         => \_x( 'Image', 'Post type singular name', 'image-gallery' ), |
  |  | 12 | 'menu\_name'             => \_\_( 'ImagePress', 'image-gallery' ), |
  |  | 13 | 'name\_admin\_bar'        => \_\_( 'Image', 'image-gallery' ), |
  |  | 14 | 'archives'              => \_\_( 'Image archives', 'image-gallery' ), |
  |  | 15 | 'parent\_item\_colon'     => \_\_( 'Parent image:', 'image-gallery' ), |
  |  | 16 | 'all\_items'             => \_\_( 'All images', 'image-gallery' ), |
  |  | 17 | 'add\_new\_item'          => \_\_( 'Add new image', 'image-gallery' ), |
  |  | 18 | 'add\_new'               => \_\_( 'Add new', 'image-gallery' ), |
  |  | 19 | 'new\_item'              => \_\_( 'New image', 'image-gallery' ), |
  |  | 20 | 'edit\_item'             => \_\_( 'Edit image', 'image-gallery' ), |
  |  | 21 | 'update\_item'           => \_\_( 'Update image', 'image-gallery' ), |
  |  | 22 | 'view\_item'             => \_\_( 'View image', 'image-gallery' ), |
  |  | 23 | 'search\_items'          => \_\_( 'Search image', 'image-gallery' ), |
  |  | 24 | 'not\_found'             => \_\_( 'Not found', 'image-gallery' ), |
  |  | 25 | 'not\_found\_in\_trash'    => \_\_( 'Not found in trash', 'image-gallery' ), |
  |  | 26 | 'featured\_image'        => \_\_( 'Featured image', 'image-gallery' ), |
  |  | 27 | 'set\_featured\_image'    => \_\_( 'Set featured image', 'image-gallery' ), |
  |  | 28 | 'remove\_featured\_image' => \_\_( 'Remove featured image', 'image-gallery' ), |
  |  | 29 | 'use\_featured\_image'    => \_\_( 'Use as featured image', 'image-gallery' ), |
  |  | 30 | 'insert\_into\_item'      => \_\_( 'Insert into image', 'image-gallery' ), |
  |  | 31 | 'uploaded\_to\_this\_item' => \_\_( 'Uploaded to this image', 'image-gallery' ), |
  |  | 32 | 'items\_list'            => \_\_( 'Images list', 'image-gallery' ), |
  |  | 33 | 'items\_list\_navigation' => \_\_( 'Images list navigation', 'image-gallery' ), |
  |  | 34 | 'filter\_items\_list'     => \_\_( 'Filter images list', 'image-gallery' ), |
  |  | 35 | ]; |
  |  | 36 |  |
  |  | 37 | $image\_type\_args = [ |
  |  | 38 | 'label'                 => \_\_( 'Image', 'image-gallery' ), |
  |  | 39 | 'description'           => \_\_( 'Image post type', 'image-gallery' ), |
  | 40 | 40 | 'labels'                => $image\_type\_labels, |
  | 41 |  | 'supports'              => ~~array('title', 'editor', 'author', 'thumbnail', 'comments', 'custom-fields', 'publicize', 'wpcom-markdown')~~, |
  |  | 41 | 'supports'              => [ 'title', 'editor', 'author', 'thumbnail', 'comments', 'custom-fields', 'publicize', 'wpcom-markdown' ], |
  | 42 | 42 | 'hierarchical'          => false, |
  | 43 | 43 | 'public'                => true, |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L56) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L56) |  |
  | 56 | 56 | 'rest\_base'             => $ip\_slug, |
  | 57 | 57 | 'rest\_controller\_class' => 'WP\_REST\_Posts\_Controller', |
  | 58 |  | ~~)~~; |
  | 59 |  |  |
  | 60 |  | register\_post\_type(~~$ip\_slug, $image\_type\_args~~); |
  | 61 |  |  |
  | 62 |  | $image~~Taxonomy = array(~~ |
  | 63 |  | 'name'                       => \_x(~~'Image categories', 'Taxonomy general name', 'image-gallery'~~), |
  | 64 |  | 'singular\_name'              => \_x(~~'Image category', 'Taxonomy singular name', 'image-gallery'~~), |
  | 65 |  | 'menu\_name'                  => \_\_(~~'Image Categories', 'image-gallery'~~), |
  | 66 |  | 'all\_items'                  => \_\_(~~'All image categories', 'image-gallery'~~), |
  | 67 |  | 'parent\_item'                => \_\_(~~'Parent image category', 'image-gallery'~~), |
  | 68 |  | 'parent\_item\_colon'          => \_\_(~~'Parent image category:', 'image-gallery'~~), |
  | 69 |  | 'new\_item\_name'              => \_\_(~~'New image category', 'image-gallery'~~), |
  | 70 |  | 'add\_new\_item'               => \_\_(~~'Add new image category', 'image-gallery'~~), |
  | 71 |  | 'edit\_item'                  => \_\_(~~'Edit image category', 'image-gallery'~~), |
  | 72 |  | 'update\_item'                => \_\_(~~'Update image category', 'image-gallery'~~), |
  | 73 |  | 'view\_item'                  => \_\_(~~'View image category', 'image-gallery'~~), |
  | 74 |  | 'separate\_items\_with\_commas' => \_\_(~~'Separate image categories with commas', 'image-gallery'~~), |
  | 75 |  | 'add\_or\_remove\_items'        => \_\_(~~'Add or remove image categories', 'image-gallery'~~), |
  | 76 |  | 'choose\_from\_most\_used'      => \_\_(~~'Choose from the most used', 'image-gallery'~~), |
  | 77 |  | 'popular\_items'              => \_\_(~~'Popular image categories', 'image-gallery'~~), |
  | 78 |  | 'search\_items'               => \_\_(~~'Search image categories', 'image-gallery'~~), |
  | 79 |  | 'not\_found'                  => \_\_(~~'Not found', 'image-gallery'~~), |
  | 80 |  | 'no\_terms'                   => \_\_(~~'No image categories', 'image-gallery'~~), |
  | 81 |  | 'items\_list'                 => \_\_(~~'Image categories list', 'image-gallery'~~), |
  | 82 |  | 'items\_list\_navigation'      => \_\_(~~'Image categories list navigation', 'image-gallery'~~), |
  | 83 |  | ~~)~~; |
  | 84 |  |  |
  | 85 |  | $image\_category\_args = ~~array(~~ |
  | 86 |  | 'labels'                => $image~~T~~axonomy, |
  |  | 58 | ]; |
  |  | 59 |  |
  |  | 60 | register\_post\_type( $ip\_slug, $image\_type\_args ); |
  |  | 61 |  |
  |  | 62 | $image\_taxonomy = [ |
  |  | 63 | 'name'                       => \_x( 'Image categories', 'Taxonomy general name', 'image-gallery' ), |
  |  | 64 | 'singular\_name'              => \_x( 'Image category', 'Taxonomy singular name', 'image-gallery' ), |
  |  | 65 | 'menu\_name'                  => \_\_( 'Image Categories', 'image-gallery' ), |
  |  | 66 | 'all\_items'                  => \_\_( 'All image categories', 'image-gallery' ), |
  |  | 67 | 'parent\_item'                => \_\_( 'Parent image category', 'image-gallery' ), |
  |  | 68 | 'parent\_item\_colon'          => \_\_( 'Parent image category:', 'image-gallery' ), |
  |  | 69 | 'new\_item\_name'              => \_\_( 'New image category', 'image-gallery' ), |
  |  | 70 | 'add\_new\_item'               => \_\_( 'Add new image category', 'image-gallery' ), |
  |  | 71 | 'edit\_item'                  => \_\_( 'Edit image category', 'image-gallery' ), |
  |  | 72 | 'update\_item'                => \_\_( 'Update image category', 'image-gallery' ), |
  |  | 73 | 'view\_item'                  => \_\_( 'View image category', 'image-gallery' ), |
  |  | 74 | 'separate\_items\_with\_commas' => \_\_( 'Separate image categories with commas', 'image-gallery' ), |
  |  | 75 | 'add\_or\_remove\_items'        => \_\_( 'Add or remove image categories', 'image-gallery' ), |
  |  | 76 | 'choose\_from\_most\_used'      => \_\_( 'Choose from the most used', 'image-gallery' ), |
  |  | 77 | 'popular\_items'              => \_\_( 'Popular image categories', 'image-gallery' ), |
  |  | 78 | 'search\_items'               => \_\_( 'Search image categories', 'image-gallery' ), |
  |  | 79 | 'not\_found'                  => \_\_( 'Not found', 'image-gallery' ), |
  |  | 80 | 'no\_terms'                   => \_\_( 'No image categories', 'image-gallery' ), |
  |  | 81 | 'items\_list'                 => \_\_( 'Image categories list', 'image-gallery' ), |
  |  | 82 | 'items\_list\_navigation'      => \_\_( 'Image categories list navigation', 'image-gallery' ), |
  |  | 83 | ]; |
  |  | 84 |  |
  |  | 85 | $image\_category\_args = [ |
  |  | 86 | 'labels'                => $image\_taxonomy, |
  | 87 | 87 | 'hierarchical'          => true, |
  | 88 | 88 | 'public'                => true, |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L94) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L94) |  |
  | 94 | 94 | 'rest\_base'             => 'image-category', |
  | 95 | 95 | 'rest\_controller\_class' => 'WP\_REST\_Terms\_Controller', |
  | 96 |  | ~~)~~; |
  | 97 |  |  |
  | 98 |  | register\_taxonomy(~~'imagepress\_image\_category', array($ip\_slug), $image\_category\_args~~); |
  | 99 |  | } |
  | 100 |  |  |
  | 101 |  | function ip\_get~~PostViews($postID~~) { |
  | 102 |  | $count = get\_post\_meta(~~$postID, 'post\_views\_count', true~~); |
  | 103 |  | $count = empty(~~$count~~) ? 0 : $count; |
  | 104 |  |  |
  | 105 |  | update\_post\_meta(~~$postID, 'post\_views\_count', $count~~); |
  |  | 96 | ]; |
  |  | 97 |  |
  |  | 98 | register\_taxonomy( 'imagepress\_image\_category', [ $ip\_slug ], $image\_category\_args ); |
  |  | 99 | } |
  |  | 100 |  |
  |  | 101 | function ip\_get\_post\_views( $post\_id ) { |
  |  | 102 | $count = get\_post\_meta( $post\_id, 'post\_views\_count', true ); |
  |  | 103 | $count = empty( $count ) ? 0 : $count; |
  |  | 104 |  |
  |  | 105 | update\_post\_meta( $post\_id, 'post\_views\_count', $count ); |
  | 106 | 106 |  |
  | 107 | 107 | return $count; |
  | 108 | 108 | } |
  | 109 |  | function ip\_set~~PostViews($postID~~) { |
  | 110 |  | $count = get\_post\_meta(~~$postID, 'post\_views\_count', true~~); |
  | 111 |  | $count = empty(~~$count~~) ? 1 : $count + 1; |
  | 112 |  |  |
  | 113 |  | update\_post\_meta(~~$postID, 'post\_views\_count', $count~~); |
  |  | 109 | function ip\_set\_post\_views( $post\_id ) { |
  |  | 110 | $count = get\_post\_meta( $post\_id, 'post\_views\_count', true ); |
  |  | 111 | $count = empty( $count ) ? 1 : $count + 1; |
  |  | 112 |  |
  |  | 113 | update\_post\_meta( $post\_id, 'post\_views\_count', $count ); |
  | 114 | 114 | } |
  | 115 | 115 |  |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L125) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L125) |  |
  | 125 | 125 |  |
  | 126 | 126 | // check if user is author // show author tools |
  | 127 |  | if (~~$post->post\_author == $current\_user->ID~~) { |
  | 128 |  | $out .= ' | <a href="#" class="ip-editor-display" id="ip-editor-open">' . \_\_(~~'Author tools', 'image-gallery'~~) . '</a>'; |
  |  | 127 | if ( intval( $post->post\_author ) === intval( $current\_user->ID ) ) { |
  |  | 128 | $out .= ' | <a href="#" class="ip-editor-display" id="ip-editor-open">' . \_\_( 'Author tools', 'image-gallery' ) . '</a>'; |
  | 129 | 129 |  |
  | 130 | 130 | $edit\_id = get\_the\_ID(); |
  | 131 | 131 |  |
  | 132 |  | if (!empty($\_POST['post\_id']) && !empty($\_POST['post\_title']) && isset($\_POST['update\_post\_nonce']) && isset($\_POST['postcontent'])) { |
  | 133 |  | $post\_id = $\_POST['post\_id']; |
  | 134 |  | $post\_type = get\_post\_type($post\_id); |
  | 135 |  | $capability = ('page' == $post\_type) ? 'edit\_page' : 'edit\_post'; |
  | 136 |  | if (current\_user\_can($capability, $post\_id) && wp\_verify\_nonce($\_POST['update\_post\_nonce'], 'update\_post\_'. $post\_id)) { |
  | 137 |  | $post = array( |
  | 138 |  | 'ID' => esc\_sql($post\_id), |
  | 139 |  | 'post\_content' => (stripslashes($\_POST['postcontent'])), |
  | 140 |  | 'post\_title' => esc\_sql($\_POST['post\_title']), |
  | 141 |  | 'post\_name' => sanitize\_text\_field($\_POST['post\_title']) |
  |  | 132 | if ( ! empty( $\_POST['post\_id'] ) && ! empty( $\_POST['post\_title'] ) && isset( $\_POST['update\_post\_nonce'] ) && isset( $\_POST['postcontent'] ) ) { |
  |  | 133 | $post\_id    = $\_POST['post\_id']; |
  |  | 134 | $post\_type  = get\_post\_type( $post\_id ); |
  |  | 135 | $capability = ( 'page' === (string) $post\_type ) ? 'edit\_page' : 'edit\_post'; |
  |  | 136 | if ( current\_user\_can( $capability, $post\_id ) && wp\_verify\_nonce( $\_POST['update\_post\_nonce'], 'update\_post\_' . $post\_id ) ) { |
  |  | 137 | $post = [ |
  |  | 138 | 'ID'           => esc\_sql( $post\_id ), |
  |  | 139 | 'post\_content' => ( stripslashes( $\_POST['postcontent'] ) ), |
  |  | 140 | 'post\_title'   => esc\_sql( $\_POST['post\_title'] ), |
  |  | 141 | 'post\_name'    => sanitize\_text\_field( $\_POST['post\_title'] ), |
  |  | 142 | ]; |
  |  | 143 | wp\_update\_post( $post ); |
  |  | 144 |  |
  |  | 145 | imagepress\_process\_image( 'imagepress\_image\_file', $post\_id, 1 ); |
  |  | 146 |  |
  |  | 147 | $images = get\_children( |
  |  | 148 | [ |
  |  | 149 | 'post\_parent'    => $post\_id, |
  |  | 150 | 'post\_status'    => 'inherit', |
  |  | 151 | 'post\_type'      => 'attachment', |
  |  | 152 | 'post\_mime\_type' => 'image', |
  |  | 153 | 'order'          => 'ASC', |
  |  | 154 | 'orderby'        => 'menu\_order ID', |
  |  | 155 | ] |
  | 142 | 156 | ); |
  | 143 |  | wp\_update\_post($post); |
  | 144 |  |  |
  | 145 |  | imagepress\_process\_image('imagepress\_image\_file', $post\_id, 1); |
  | 146 |  |  |
  | 147 |  | $images = get\_children(array('post\_parent' => $post\_id, 'post\_status' => 'inherit', 'post\_type' => 'attachment', 'post\_mime\_type' => 'image', 'order' => 'ASC', 'orderby' => 'menu\_order ID')); |
  | 148 |  | $count = $images ? count($images) : 0; |
  | 149 |  | if ($count == 1 || !has\_post\_thumbnail($post\_id)) { |
  | 150 |  | foreach ($images as $attachment\_id => $image) { |
  | 151 |  | set\_post\_thumbnail($post\_id, $image->ID); |
  |  | 157 | $count  = $images ? count( $images ) : 0; |
  |  | 158 | if ( (int) $count === 1 || ! has\_post\_thumbnail( $post\_id ) ) { |
  |  | 159 | foreach ( $images as $attachment\_id => $image ) { |
  |  | 160 | set\_post\_thumbnail( $post\_id, $image->ID ); |
  | 152 | 161 | } |
  | 153 | 162 | } |
  | 154 | 163 |  |
  | 155 |  | wp\_set\_object\_terms(~~$post\_id, (int) $\_POST['imagepress\_image\_category'], 'imagepress\_image\_category'~~); |
  |  | 164 | wp\_set\_object\_terms( $post\_id, (int) $\_POST['imagepress\_image\_category'], 'imagepress\_image\_category' ); |
  | 156 | 165 | } |
  | 157 | 166 | } |
  | 158 | 167 |  |
  | 159 |  | $out .= '<div id="info" class="ip-editor"> |
  |  | 168 | $out         .= '<div id="info" class="ip-editor"> |
  | 160 | 169 | <form id="post" class="post-edit front-end-form imagepress-form thin-ui-form" method="post" enctype="multipart/form-data"> |
  | 161 | 170 | <input type="hidden" name="post\_id" value="' . $edit\_id . '">'; |
  | 162 |  | $out .= wp\_nonce\_field(~~'update\_post\_' . $edit\_id, 'update\_post\_nonce', true, false~~); |
  |  | 171 | $out .= wp\_nonce\_field( 'update\_post\_' . $edit\_id, 'update\_post\_nonce', true, false ); |
  | 163 | 172 |  |
  | 164 | 173 | $out .= '<p> |
  | 165 |  | <label for="post\_title">' . \_\_(~~'Title', 'image-gallery'~~) . '</label><br> |
  | 166 |  | <input type="text" id="post\_title" name="post\_title" value="' . get\_the\_title(~~$edit\_id~~) . '"> |
  |  | 174 | <label for="post\_title">' . \_\_( 'Title', 'image-gallery' ) . '</label><br> |
  |  | 175 | <input type="text" id="post\_title" name="post\_title" value="' . get\_the\_title( $edit\_id ) . '"> |
  | 167 | 176 | </p> |
  | 168 | 177 | <p> |
  | 169 |  | <label for="postcontent">' . \_\_(~~'Description', 'image-gallery'~~) . '</label><br> |
  | 170 |  | <textarea id="postcontent" name="postcontent" rows="3">' . ~~strip\_tags(get\_post\_field('post\_content', $edit\_id)~~) . '</textarea></p> |
  |  | 178 | <label for="postcontent">' . \_\_( 'Description', 'image-gallery' ) . '</label><br> |
  |  | 179 | <textarea id="postcontent" name="postcontent" rows="3">' . wp\_strip\_all\_tags( get\_post\_field( 'post\_content', $edit\_id ) ) . '</textarea></p> |
  | 171 | 180 | <hr>'; |
  | 172 | 181 |  |
  | 173 |  | $ip\_category = wp\_get\_object\_terms(~~$edit\_id, 'imagepress\_image\_category'~~); |
  | 174 |  |  |
  | 175 |  | $out .= imagepress\_get\_image\_categories\_dropdown(~~'imagepress\_image\_category', $ip\_category[0]->term\_id~~); |
  | 176 |  |  |
  | 177 |  | $ip\_upload\_size = get\_imagepress\_option(~~'ip\_upload\_size'~~); |
  | 178 |  | $uploadsize ~~= number\_format((($ip\_upload\_size \* 1024)/1024000), 0, '.', ''~~); |
  |  | 182 | $ip\_category = wp\_get\_object\_terms( $edit\_id, 'imagepress\_image\_category' ); |
  |  | 183 |  |
  |  | 184 | $out .= imagepress\_get\_image\_categories\_dropdown( 'imagepress\_image\_category', $ip\_category[0]->term\_id ); |
  |  | 185 |  |
  |  | 186 | $ip\_upload\_size = get\_imagepress\_option( 'ip\_upload\_size' ); |
  |  | 187 | $uploadsize     = number\_format( ( ( $ip\_upload\_size \* 1024 ) / 1024000 ), 0, '.', '' ); |
  | 179 | 188 | $datauploadsize = $uploadsize \* 1024000; |
  | 180 | 189 |  |
  | 181 |  | $out .= '<p><label for="imagepress\_image\_file">Replace main image (' . $uploadsize . 'MB ' . \_\_(~~'maximum', 'image-gallery'~~) . ')...</label><br><input type="file" accept="image/\*" data-max-size="' . $datauploadsize . '" name="imagepress\_image\_file" id="imagepress\_image\_file"></p> |
  |  | 190 | $out .= '<p><label for="imagepress\_image\_file">Replace main image (' . $uploadsize . 'MB ' . \_\_( 'maximum', 'image-gallery' ) . ')...</label><br><input type="file" accept="image/\*" data-max-size="' . $datauploadsize . '" name="imagepress\_image\_file" id="imagepress\_image\_file"></p> |
  | 182 | 191 | <hr>'; |
  | 183 | 192 |  |
  | 184 |  | $ip~~DeleteRedirection = get\_imagepress\_option('ip\_delete\_redirection'~~); |
  | 185 |  | ~~if (empty($ipDeleteRedirection)~~) { |
  | 186 |  | ~~$ipDeleteR~~edirection = home\_url(); |
  | 187 |  | } |
  |  | 193 | $ip\_delete\_redirection = get\_imagepress\_option( 'ip\_delete\_redirection' ); |
  |  | 194 | if ( empty( $ip\_delete\_redirection ) ) { |
  |  | 195 | $ip\_delete\_redirection = home\_url(); |
  |  | 196 | } |
  | 188 | 197 |  |
  | 189 | 198 | $out .= '<p> |
  | 190 |  | <input type="submit" id="submit" value="' . \_\_(~~'Update', 'image-gallery'~~) . '"> |
  | 191 |  | <a href="#" data-redirect="' . $ip~~DeleteRedirection . '" data-image-id="' . get\_the\_ID() . '" class="button" id="ip-editor-delete-image">' . \_\_('Delete', 'image-gallery'~~) . '</a> |
  |  | 199 | <input type="submit" id="submit" value="' . \_\_( 'Update', 'image-gallery' ) . '"> |
  |  | 200 | <a href="#" data-redirect="' . $ip\_delete\_redirection . '" data-image-id="' . get\_the\_ID() . '" class="button" id="ip-editor-delete-image">' . \_\_( 'Delete', 'image-gallery' ) . '</a> |
  | 192 | 201 | </p> |
  | 193 | 202 | </form> |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L201) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L210) |  |
  | 201 | 210 |  |
  | 202 | 211 | // ip\_editor() related actions |
  | 203 |  | ~~add\_action('wp\_ajax\_ip\_delete\_post', 'ip\_delete\_post');~~ |
  | 204 | 212 | function ip\_delete\_post() { |
  | 205 |  | $imageId = (int) $\_POST['id']; |
  | 206 |  |  |
  | 207 |  | if (wp\_delete\_post($imageId)) { |
  |  | 213 | check\_ajax\_referer( 'ajax\_nonce', 'nonce' ); |
  |  | 214 |  |
  |  | 215 | if ( ! current\_user\_can( 'delete\_posts' ) ) { |
  |  | 216 | wp\_send\_json\_error( 'Unauthorized', 403 ); |
  |  | 217 | } |
  |  | 218 |  |
  |  | 219 | $image\_id = (int) $\_POST['id']; |
  |  | 220 |  |
  |  | 221 | if ( wp\_delete\_post( $image\_id ) ) { |
  | 208 | 222 | echo 'success'; |
  | 209 | 223 | } |
  | 210 | 224 |  |
  | 211 |  | die(); |
  | 212 |  | } |
  | 213 |  | add\_action('wp\_ajax\_ip\_update\_post\_title', 'ip\_update\_post\_title'); |
  |  | 225 | wp\_die(); |
  |  | 226 | } |
  |  | 227 |  |
  |  | 228 | add\_action( 'wp\_ajax\_ip\_delete\_post', 'ip\_delete\_post' ); |
  |  | 229 |  |
  | 214 | 230 | function ip\_update\_post\_title() { |
  | 215 |  | $updated\_post = array( |
  | 216 |  | 'ID' => (int) $\_REQUEST['id'], |
  |  | 231 | check\_ajax\_referer( 'ajax\_nonce', 'nonce' ); |
  |  | 232 |  |
  |  | 233 | if ( ! current\_user\_can( 'delete\_posts' ) ) { |
  |  | 234 | wp\_send\_json\_error( 'Unauthorized', 403 ); |
  |  | 235 | } |
  |  | 236 |  |
  |  | 237 | $updated\_post = [ |
  |  | 238 | 'ID'         => (int) $\_REQUEST['id'], |
  | 217 | 239 | 'post\_title' => (string) $\_REQUEST['title'], |
  | 218 |  | ~~)~~; |
  | 219 |  |  |
  | 220 |  | wp\_update\_post(~~$updated\_post~~); |
  |  | 240 | ]; |
  |  | 241 |  |
  |  | 242 | wp\_update\_post( $updated\_post ); |
  | 221 | 243 |  |
  | 222 | 244 | echo 'success'; |
  | 223 |  | die(); |
  | 224 |  | } |
  | 225 |  | add\_action('wp\_ajax\_ip\_featured\_post', 'ip\_featured\_post'); |
  | 226 |  | function ip\_featured\_post() { |
  | 227 |  | $permission = check\_ajax\_referer('ip\_featured\_post\_nonce', 'nonce', false); |
  | 228 |  | if ($permission == false) { |
  | 229 |  | echo 'error'; |
  | 230 |  | } else { |
  | 231 |  | update\_post\_meta($\_REQUEST['pid'], '\_thumbnail\_id', $\_REQUEST['id']); |
  | 232 |  | echo 'success'; |
  | 233 |  | } |
  | 234 |  | die(); |
  | 235 |  | } |
  |  | 245 |  |
  |  | 246 | wp\_die(); |
  |  | 247 | } |
  |  | 248 |  |
  |  | 249 | add\_action( 'wp\_ajax\_ip\_update\_post\_title', 'ip\_update\_post\_title' ); |
  | 236 | 250 |  |
  | 237 | 251 |  |
  | 238 | 252 |  |
  | 239 | 253 | // main ImagePress image function |
  | 240 |  | function ip\_main(~~$imageId~~) { |
  |  | 254 | function ip\_main( $image\_id ) { |
  | 241 | 255 | global $wpdb, $post; |
  | 242 | 256 |  |
  | 243 |  | $post\_thumbnail\_id ~~= get\_post\_thumbnail\_id($imageId~~); |
  | 244 |  | $image\_attributes ~~= wp\_get\_attachment\_image\_src($post\_thumbnail\_id, 'full'~~); |
  |  | 257 | $post\_thumbnail\_id  = get\_post\_thumbnail\_id( $image\_id ); |
  |  | 258 | $image\_attributes   = wp\_get\_attachment\_image\_src( $post\_thumbnail\_id, 'full' ); |
  | 245 | 259 | $post\_thumbnail\_url = $image\_attributes[0]; |
  | 246 | 260 |  |
  | 247 |  | if(get\_imagepress\_option('ip\_comments') == 1) |
  | 248 |  | $ip\_comments = '<em> | </em><a href="' . get\_permalink($imageId) . '"><i class="ai-chat-dots"></i> ' . get\_comments\_number($imageId) . '</a> '; |
  | 249 |  | if(get\_imagepress\_option('ip\_comments') == 0) |
  |  | 261 | if ( intval( get\_imagepress\_option( 'ip\_comments' ) ) === 1 ) { |
  |  | 262 | $ip\_comments = '<em> | </em><a href="' . get\_permalink( $image\_id ) . '"><i class="ai-chat-dots"></i> ' . get\_comments\_number( $image\_id ) . '</a> '; |
  |  | 263 | } |
  |  | 264 | if ( intval( get\_imagepress\_option( 'ip\_comments' ) ) === 0 ) { |
  | 250 | 265 | $ip\_comments = ''; |
  |  | 266 | } |
  | 251 | 267 | ?> |
  | 252 | 268 |  |
  | 253 | 269 | <div class="imagepress-container"> |
  | 254 |  | <a href="<?php echo ~~$post\_thumbnail\_url~~; ?>"> |
  | 255 |  | <?php the\_post\_thumbnail(~~'full'~~); ?> |
  |  | 270 | <a href="<?php echo esc\_url( $post\_thumbnail\_url ); ?>"> |
  |  | 271 | <?php the\_post\_thumbnail( 'full' ); ?> |
  | 256 | 272 | </a> |
  | 257 |  | <?php ip\_set~~PostViews($imageId~~); ?> |
  |  | 273 | <?php ip\_set\_post\_views( $image\_id ); ?> |
  | 258 | 274 | </div> |
  | 259 | 275 |  |
  | 260 | 276 | <div class="ip-bar"> |
  | 261 |  | <?php echo ~~ipGetPostLikeLink($imageId); ?><em> | </em><i class="ai-eye-open"></i> <?php echo ip\_getPostViews($imageId); ?><?php echo $ip\_comments~~; ?> |
  |  | 277 | <?php echo wp\_kses\_post( ipGetPostLikeLink( $image\_id ) ); ?><em> | </em><i class="ai-eye-open"></i> <?php echo intval( ip\_get\_post\_views( $image\_id ) ); ?><?php echo wp\_kses\_post( $ip\_comments ); ?> |
  | 262 | 278 | <?php |
  | 263 | 279 | /\* |
  | 264 | 280 | \* Image editor |
  | 265 | 281 | \*/ |
  | 266 |  | echo ~~ip\_editor(~~); |
  |  | 282 | echo wp\_kses\_post( ip\_editor() ); |
  | 267 | 283 | ?> |
  | 268 | 284 | </div> |
  | 269 | 285 |  |
  | 270 | 286 | <h1 class="ip-title"> |
  | 271 |  | <?php echo ~~get\_the\_title($imageId~~); ?> |
  |  | 287 | <?php echo esc\_html( get\_the\_title( $image\_id ) ); ?> |
  | 272 | 288 | </h1> |
  | 273 | 289 |  |
  | 274 | 290 | <p> |
  | 275 | 291 | <div style="float: left; margin: 0 8px 0 0;"> |
  | 276 |  | <?php echo get\_avatar(~~$post->post\_author, 40~~); ?> |
  |  | 292 | <?php echo get\_avatar( $post->post\_author, 40 ); ?> |
  | 277 | 293 | </div> |
  | 278 |  | <?php esc\_html\_e(~~'by', 'image-gallery'); ?> <b><?php echo getImagePressProfileUri($post->post\_author~~); ?></b> |
  | 279 |  | <br><small><?php esc\_html\_e(~~'Uploaded', 'image-gallery'); ?> <time title="<?php the\_time(get\_option('date\_format')); ?>"><?php echo human\_time\_diff(get\_the\_time('U'), current\_time('timestamp')) . ' ago'; ?></time> <?php esc\_html\_e('in', 'image-gallery'); ?> <?php echo get\_the\_term\_list(get\_the\_ID(), 'imagepress\_image\_category', '', ', ', ''~~); ?></small> |
  |  | 294 | <?php esc\_html\_e( 'by', 'image-gallery' ); ?> <b><?php echo wp\_kses\_post( ip\_get\_profile\_url( $post->post\_author ) ); ?></b> |
  |  | 295 | <br><small><?php esc\_html\_e( 'Uploaded', 'image-gallery' ); ?> <time title="<?php the\_time( get\_option( 'date\_format' ) ); ?>"><?php echo esc\_attr( human\_time\_diff( get\_the\_time( 'U' ), current\_time( 'timestamp' ) ) . ' ago' ); ?></time> <?php esc\_html\_e( 'in', 'image-gallery' ); ?> <?php echo get\_the\_term\_list( get\_the\_ID(), 'imagepress\_image\_category', '', ', ', '' ); ?></small> |
  | 280 | 296 | </p> |
  | 281 | 297 |  |
  | 282 | 298 | <div class="ip-clear"></div> |
  | 283 | 299 |  |
  | 284 |  | <?php imagepress\_get\_images(~~$imageId~~); ?> |
  |  | 300 | <?php imagepress\_get\_images( $image\_id ); ?> |
  | 285 | 301 |  |
  | 286 | 302 | <section> |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L289) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L305) |  |
  | 289 | 305 |  |
  | 290 | 306 | <section role="navigation"> |
  | 291 |  | <?php previous\_post\_link(~~'%link', esc\_html\_\_('Previous', 'image-gallery')~~); ?> |
  | 292 |  | <?php next\_post\_link(~~'%link', esc\_html\_\_('Next', 'image-gallery')~~); ?> |
  |  | 307 | <?php previous\_post\_link( '%link', esc\_html\_\_( 'Previous', 'image-gallery' ) ); ?> |
  |  | 308 | <?php next\_post\_link( '%link', esc\_html\_\_( 'Next', 'image-gallery' ) ); ?> |
  | 293 | 309 | </section> |
  | 294 | 310 | <?php |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L298) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L314) |  |
  | 298 | 314 |  |
  | 299 | 315 | // main ImagePress image function |
  | 300 |  | function ip\_main\_return( $image~~I~~d ) { |
  |  | 316 | function ip\_main\_return( $image\_id ) { |
  | 301 | 317 | global $wpdb, $post; |
  | 302 | 318 |  |
  | 303 | 319 | $out = ''; |
  | 304 |  | ip\_set~~PostViews($imageId~~); |
  | 305 |  |  |
  | 306 |  | $post\_thumbnail\_id ~~= get\_post\_thumbnail\_id($imageId~~); |
  | 307 |  | $image\_attributes ~~= wp\_get\_attachment\_image\_src($post\_thumbnail\_id, 'full'~~); |
  |  | 320 | ip\_set\_post\_views( $image\_id ); |
  |  | 321 |  |
  |  | 322 | $post\_thumbnail\_id  = get\_post\_thumbnail\_id( $image\_id ); |
  |  | 323 | $image\_attributes   = wp\_get\_attachment\_image\_src( $post\_thumbnail\_id, 'full' ); |
  | 308 | 324 | $post\_thumbnail\_url = $image\_attributes[0]; |
  | 309 | 325 |  |
  | 310 | 326 | $ip\_comments = ''; |
  | 311 | 327 |  |
  | 312 |  | if (~~(int) get\_imagepress\_option('ip\_comments') === 1~~) { |
  | 313 |  | $ip\_comments = '<em> | </em><a href="' . get\_permalink(~~$imageId) . '"><i class="ai-chat-dots"></i> ' . get\_comments\_number($imageId~~) . '</a> '; |
  |  | 328 | if ( (int) get\_imagepress\_option( 'ip\_comments' ) === 1 ) { |
  |  | 329 | $ip\_comments = '<em> | </em><a href="' . get\_permalink( $image\_id ) . '"><i class="ai-chat-dots"></i> ' . get\_comments\_number( $image\_id ) . '</a> '; |
  | 314 | 330 | } |
  | 315 | 331 |  |
  | 316 | 332 | $out .= '<div class="imagepress-container"> |
  | 317 |  | <a href="' . $post\_thumbnail\_url . '"><img src="' . $image\_attributes[0] . '" width="' . $image\_attributes[1] . '" height="' . $image\_attributes[2] . '" alt="' . get\_permalink( $image~~I~~d ) . '"></a> |
  |  | 333 | <a href="' . $post\_thumbnail\_url . '"><img src="' . $image\_attributes[0] . '" width="' . $image\_attributes[1] . '" height="' . $image\_attributes[2] . '" alt="' . get\_permalink( $image\_id ) . '"></a> |
  | 318 | 334 | </div> |
  | 319 | 335 |  |
  | 320 | 336 | <div class="ip-bar"> |
  | 321 |  | <i class="ai-eye-open"></i> ' . i~~p\_getPostViews($imageId~~) . $ip\_comments; |
  |  | 337 | <i class="ai-eye-open"></i> ' . intval( ip\_get\_post\_views( $image\_id ) ) . $ip\_comments; |
  | 322 | 338 |  |
  | 323 | 339 | $out .= ip\_editor(); |
  | 324 |  | $out .= '</div> |
  |  | 340 | $out     .= '</div> |
  | 325 | 341 |  |
  | 326 | 342 | <h1 class="ip-title"></h1> |
  | 327 | 343 |  |
  | 328 | 344 | <p> |
  | 329 |  | <div style="float: left; margin: 0 8px 0 0;">' . get\_avatar(~~$post->post\_author, 40~~) . '</div>' . |
  | 330 |  | \_\_(~~'by', 'image-gallery') . ' <b>' . getImagePressProfileUri($post->post\_author~~) . '</b> |
  | 331 |  | <br><small>' . \_\_(~~'Uploaded', 'image-gallery') . ' <time>' . human\_time\_diff(get\_the\_time('U'), current\_time('timestamp')) . ' ago' . '</time> ' . \_\_('in', 'image-gallery') . ' ' . get\_the\_term\_list(get\_the\_ID(), 'imagepress\_image\_category', '', ', ', ''~~) . '</small> |
  |  | 345 | <div style="float: left; margin: 0 8px 0 0;">' . get\_avatar( $post->post\_author, 40 ) . '</div>' . |
  |  | 346 | \_\_( 'by', 'image-gallery' ) . ' <b>' . ip\_get\_profile\_url( $post->post\_author ) . '</b> |
  |  | 347 | <br><small>' . \_\_( 'Uploaded', 'image-gallery' ) . ' <time>' . human\_time\_diff( get\_the\_time( 'U' ), current\_time( 'timestamp' ) ) . ' ago' . '</time> ' . \_\_( 'in', 'image-gallery' ) . ' ' . get\_the\_term\_list( get\_the\_ID(), 'imagepress\_image\_category', '', ', ', '' ) . '</small> |
  | 332 | 348 | </p> |
  | 333 | 349 |  |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L338) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L354) |  |
  | 338 | 354 |  |
  | 339 | 355 | $out .= '<hr><section role="navigation"><p>' . |
  | 340 |  | get\_previous\_post\_link(~~'%link', esc\_html\_\_('Previous', 'image-gallery')~~) . ' | ' . |
  | 341 |  | get\_next\_post\_link(~~'%link', esc\_html\_\_('Next', 'image-gallery')~~) . |
  |  | 356 | get\_previous\_post\_link( '%link', esc\_html\_\_( 'Previous', 'image-gallery' ) ) . ' | ' . |
  |  | 357 | get\_next\_post\_link( '%link', esc\_html\_\_( 'Next', 'image-gallery' ) ) . |
  | 342 | 358 | '</p></section>'; |
  | 343 | 359 |  |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L347) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L363) |  |
  | 347 | 363 |  |
  | 348 | 364 |  |
  | 349 |  | function imagepress\_get\_images($post\_id) { |
  | 350 |  | $thumbnail\_ID = get\_post\_thumbnail\_id(); |
  | 351 |  | $images = get\_children(array('post\_parent' => $post\_id, 'post\_status' => 'inherit', 'post\_type' => 'attachment', 'post\_mime\_type' => 'image', 'order' => 'ASC', 'orderby' => 'menu\_order ID')); |
  | 352 |  |  |
  | 353 |  | if ($images && count($images) > 1) { |
  |  | 365 | function imagepress\_get\_images( $post\_id ) { |
  |  | 366 | $thumbnail\_id = get\_post\_thumbnail\_id(); |
  |  | 367 | $images       = get\_children( |
  |  | 368 | [ |
  |  | 369 | 'post\_parent'    => $post\_id, |
  |  | 370 | 'post\_status'    => 'inherit', |
  |  | 371 | 'post\_type'      => 'attachment', |
  |  | 372 | 'post\_mime\_type' => 'image', |
  |  | 373 | 'order'          => 'ASC', |
  |  | 374 | 'orderby'        => 'menu\_order ID', |
  |  | 375 | ] |
  |  | 376 | ); |
  |  | 377 |  |
  |  | 378 | if ( $images && count( $images ) > 1 ) { |
  | 354 | 379 | echo '<div class="ip-more">'; |
  | 355 |  | foreach ($images as $attachment\_id => $image) { |
  | 356 |  | if ($image->ID != $thumbnail\_ID) { |
  | 357 |  | $big\_array = image\_downsize($image->ID, 'full'); |
  | 358 |  |  |
  | 359 |  | echo '<img src="' . $big\_array[0] . '" alt="">'; |
  | 360 |  | } |
  |  | 380 | foreach ( $images as $attachment\_id => $image ) { |
  |  | 381 | if ( $image->ID != $thumbnail\_id ) { |
  |  | 382 | $big\_array = image\_downsize( $image->ID, 'full' ); |
  |  | 383 |  |
  |  | 384 | echo '<img src="' . esc\_url( $big\_array[0] ) . '" alt="">'; |
  | 361 | 385 | } |
  |  | 386 | } |
  | 362 | 387 | echo '</div>'; |
  | 363 | 388 | } |
  | 364 | 389 |  |
  | 365 |  | $videos = get\_children(array('post\_parent' => $post\_id, 'post\_status' => 'inherit', 'post\_type' => 'attachment', 'order' => 'ASC', 'orderby' => 'menu\_order ID')); |
  | 366 |  |  |
  | 367 |  | if ($videos && count($videos) > 1) { |
  |  | 390 | $videos = get\_children( |
  |  | 391 | [ |
  |  | 392 | 'post\_parent' => $post\_id, |
  |  | 393 | 'post\_status' => 'inherit', |
  |  | 394 | 'post\_type'   => 'attachment', |
  |  | 395 | 'order'       => 'ASC', |
  |  | 396 | 'orderby'     => 'menu\_order ID', |
  |  | 397 | ] |
  |  | 398 | ); |
  |  | 399 |  |
  |  | 400 | if ( $videos && count( $videos ) > 1 ) { |
  | 368 | 401 | echo '<div class="ip-more">'; |
  | 369 |  | ~~foreach ($videos as $attachment\_id => $video~~) { |
  | 370 |  | ~~if (strpos(get\_post\_mime\_type($video->ID), 'video') !== false~~) { |
  | 371 |  | echo '<video width="100%" class="ip-video-secondary" controls> |
  | 372 |  | <source src="' . ~~wp\_get\_attachment\_url($video->ID) . '" type="' . get\_post\_mime\_type($video->ID~~) . '"> |
  |  | 402 | foreach ( $videos as $attachment\_id => $video ) { |
  |  | 403 | if ( strpos( get\_post\_mime\_type( $video->ID ), 'video' ) !== false ) { |
  |  | 404 | echo '<video width="100%" class="ip-video-secondary" controls> |
  |  | 405 | <source src="' . esc\_url( wp\_get\_attachment\_url( $video->ID ) ) . '" type="' . esc\_attr( get\_post\_mime\_type( $video->ID ) ) . '"> |
  | 373 | 406 | Your browser does not support HTML5 video. |
  | 374 | 407 | </video>'; |
  | 375 |  | ~~}~~ |
  | 376 | 408 | } |
  |  | 409 | } |
  | 377 | 410 | echo '</div>'; |
  | 378 | 411 | } |
  | 379 | 412 | } |
  | 380 | 413 |  |
  | 381 |  | function kformat(~~$number~~) { |
  |  | 414 | function kformat( $number ) { |
  | 382 | 415 | $number = (int) $number; |
  | 383 | 416 |  |
  | 384 |  | return number\_format(~~$number, 0, '.', ','~~); |
  |  | 417 | return number\_format( $number, 0, '.', ',' ); |
  | 385 | 418 | } |
  | 386 | 419 |  |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L388) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L421) |  |
  | 388 | 421 | global $post; |
  | 389 | 422 |  |
  | 390 |  | $out = '<h3>' . \_\_(~~'More by the same author', 'image-gallery'~~) . '</h3>' . |
  | 391 |  | cinnamon\_get\_related\_author\_posts(~~$post->post\_author~~); |
  |  | 423 | $out = '<h3>' . \_\_( 'More by the same author', 'image-gallery' ) . '</h3>' . |
  |  | 424 | cinnamon\_get\_related\_author\_posts( $post->post\_author ); |
  | 392 | 425 |  |
  | 393 | 426 | return $out; |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L395) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L428) |  |
  | 395 | 428 |  |
  | 396 | 429 | function ip\_author() { |
  | 397 |  | echo do\_shortcode(~~'[cinnamon-profile]'~~); |
  |  | 430 | echo do\_shortcode( '[cinnamon-profile]' ); |
  | 398 | 431 | } |
  | 399 | 432 |  |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L403) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L436) |  |
  | 403 | 436 | global $\_wp\_additional\_image\_sizes; |
  | 404 | 437 |  |
  | 405 |  | $image\_sizes = array(); |
  | 406 |  | foreach(get\_intermediate\_image\_sizes() as $size) { |
  | 407 |  | $image\_sizes[$size] = array(0, 0); |
  | 408 |  | if(in\_array($size, array('thumbnail', 'medium', 'large'))) { |
  | 409 |  | $image\_sizes[$size][0] = get\_option($size . '\_size\_w'); |
  | 410 |  | $image\_sizes[$size][1] = get\_option($size . '\_size\_h'); |
  |  | 438 | $image\_sizes = []; |
  |  | 439 | foreach ( get\_intermediate\_image\_sizes() as $size ) { |
  |  | 440 | $image\_sizes[ $size ] = [ 0, 0 ]; |
  |  | 441 | if ( in\_array( $size, [ 'thumbnail', 'medium', 'large' ] ) ) { |
  |  | 442 | $image\_sizes[ $size ][0] = get\_option( $size . '\_size\_w' ); |
  |  | 443 | $image\_sizes[ $size ][1] = get\_option( $size . '\_size\_h' ); |
  |  | 444 | } elseif ( isset( $\_wp\_additional\_image\_sizes ) && isset( $\_wp\_additional\_image\_sizes[ $size ] ) ) { |
  |  | 445 | $image\_sizes[ $size ] = [ $\_wp\_additional\_image\_sizes[ $size ]['width'], $\_wp\_additional\_image\_sizes[ $size ]['height'] ]; |
  | 411 | 446 | } |
  | 412 |  | ~~else~~ |
  | 413 |  | ~~if(isset($\_wp\_additional\_image\_sizes) && isset($\_wp\_additional\_image\_sizes[$size]))~~ |
  | 414 |  | ~~$image\_sizes[$size] = array($\_wp\_additional\_image\_sizes[$size]['width'], $\_wp\_additional\_image\_sizes[$size]['height']);~~ |
  | 415 | 447 | } |
  | 416 | 448 | return $image\_sizes; |
  | 417 | 449 | } |
  | 418 | 450 |  |
  | 419 |  | add\_filter(~~'wp\_dropdown\_cats', 'ip\_wp\_dropdown\_categories\_required', 10, 2~~); |
  | 420 |  | function ip\_wp\_dropdown\_categories\_required(~~$output, $args~~) { |
  | 421 |  | if~~(isset($args['required']) && $args['required']~~) { |
  |  | 451 | add\_filter( 'wp\_dropdown\_cats', 'ip\_wp\_dropdown\_categories\_required', 10, 2 ); |
  |  | 452 | function ip\_wp\_dropdown\_categories\_required( $output, $args ) { |
  |  | 453 | if ( isset( $args['required'] ) && $args['required'] ) { |
  | 422 | 454 | $output = preg\_replace( |
  | 423 | 455 | '^' . preg\_quote( '<select ' ) . '^', |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L434) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L466) |  |
  | 434 | 466 |  |
  | 435 | 467 | $user\_roles = $current\_user->roles; |
  | 436 |  | $user\_role ~~= array\_shift($user\_roles~~); |
  |  | 468 | $user\_role  = array\_shift( $user\_roles ); |
  | 437 | 469 |  |
  | 438 | 470 | return $user\_role; |
  | 439 | 471 | } |
  | 440 | 472 |  |
  | 441 |  | function ip\_get\_field($atts) { |
  | 442 |  | extract(shortcode\_atts(array( |
  | 443 |  | 'field' => '', |
  | 444 |  | ), $atts)); |
  | 445 |  |  |
  | 446 |  | $field = get\_post\_meta(get\_the\_ID(), $field, true); |
  |  | 473 | function ip\_get\_field( $atts ) { |
  |  | 474 | $attributes = shortcode\_atts( |
  |  | 475 | [ |
  |  | 476 | 'field' => '', |
  |  | 477 | ], |
  |  | 478 | $atts |
  |  | 479 | ); |
  |  | 480 |  |
  |  | 481 | $field = get\_post\_meta( get\_the\_ID(), $attributes['field'], true ); |
  | 447 | 482 |  |
  | 448 | 483 | return $field; |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L455) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L490) |  |
  | 455 | 490 | 'menu\_order' => intval( $position ), |
  | 456 | 491 | ]; |
  | 457 |  |  |
  |  | 492 |  |
  | 458 | 493 | wp\_update\_post( $post\_data ); |
  | 459 | 494 | } |
  | […](/browser/image-gallery/trunk/includes/functions.php?rev=3166568#L468) | […](/browser/image-gallery/trunk/includes/functions.php?rev=3167164#L503) |  |
  | 468 | 503 | \* Use a get\_option() wrapper. |
  | 469 | 504 | \*/ |
  | 470 |  | function get\_imagepress\_option(~~$option~~) { |
  | 471 |  | $ip~~Options = get\_option('imagepress'~~); |
  | 472 |  |  |
  | 473 |  | return $ip~~Options[$option~~]; |
  | 474 |  | } |
  | 475 |  |  |
  | 476 |  | function ~~updateImagePressOption($optionArray~~) { |
  | 477 |  | $image~~PressOption = get\_option('imagepress'~~); |
  | 478 |  | $updated~~Array = array\_merge($imagePressOption, $optionArray~~); |
  | 479 |  |  |
  | 480 |  | update\_option(~~'imagepress', $updatedArray~~); |
  | 481 |  | } |
  | 482 |  |  |
  | 483 |  | function ~~getImagePressProfileUri($authorId, $structure = true~~) { |
  | 484 |  | $ip~~ProfileLink = '<span class="name"><a href="' . get\_author\_posts\_url($authorId) . '">' . get\_the\_author\_meta('user\_nicename', $authorId~~) . '</a></span>'; |
  | 485 |  |  |
  | 486 |  | if (~~$structure === false~~) { |
  | 487 |  | $ip~~ProfileLink = get\_author\_posts\_url($authorId~~); |
  | 488 |  | } |
  | 489 |  |  |
  | 490 |  | return $ip~~ProfileL~~ink; |
  | 491 |  | } |
  | 492 |  |  |
  | 493 |  | function ip~~RenderGridElement($elementId~~) { |
  |  | 505 | function get\_imagepress\_option( $option ) { |
  |  | 506 | $ip\_options = get\_option( 'imagepress' ); |
  |  | 507 |  |
  |  | 508 | return $ip\_options[ $option ]; |
  |  | 509 | } |
  |  | 510 |  |
  |  | 511 | function ip\_update\_option( $option\_array ) { |
  |  | 512 | $imagepress\_option = get\_option( 'imagepress' ); |
  |  | 513 | $updated\_array     = array\_merge( $imagepress\_option, $option\_array ); |
  |  | 514 |  |
  |  | 515 | update\_option( 'imagepress', $updated\_array ); |
  |  | 516 | } |
  |  | 517 |  |
  |  | 518 | function ip\_get\_profile\_url( $author\_id, $structure = true ) { |
  |  | 519 | $ip\_profile\_link = '<span class="name"><a href="' . get\_author\_posts\_url( $author\_id ) . '">' . get\_the\_author\_meta( 'user\_nicename', $author\_id ) . '</a></span>'; |
  |  | 520 |  |
  |  | 521 | if ( $structure === false ) { |
  |  | 522 | $ip\_profile\_link = get\_author\_posts\_url( $author\_id ); |
  |  | 523 | } |
  |  | 524 |  |
  |  | 525 | return $ip\_profile\_link; |
  |  | 526 | } |
  |  | 527 |  |
  |  | 528 | function ip\_render\_grid\_element( $element\_id ) { |
  | 494 | 529 | $out = ''; |
  | 495 | 530 |  |
  | 496 | 531 | // Set default values |
  | 497 |  | $post\_thumbnail\_id = get\_post\_thumbnail\_id(~~$elementId~~); |
  |  | 532 | $post\_thumbnail\_id = get\_post\_thumbnail\_id( $element\_id ); |
  | 498 | 533 |  |
  | 499 | 534 | // Get ImagePress grid options |
  | 500 |  | $ip\_click\_behaviour ~~= get\_imagepress\_option('ip\_click\_behaviour'~~); |
  | 501 |  | $get~~ImagePressTitle = get\_imagepress\_option('ip\_title\_optional'~~); |
  | 502 |  | $get~~ImagePressAuthor = get\_imagepress\_option('ip\_author\_optional'~~); |
  | 503 |  | $get~~ImagePressMeta = get\_imagepress\_option('ip\_meta\_optional'~~); |
  | 504 |  | $get~~ImagePressViews = get\_imagepress\_option('ip\_views\_optional'~~); |
  | 505 |  | $get\_ip\_comments ~~= get\_imagepress\_option('ip\_comments'~~); |
  | 506 |  | $ip\_ipw ~~= get\_imagepress\_option('ip\_ipw'~~); |
  | 507 |  | $size ~~= get\_imagepress\_option('ip\_image\_size'~~); |
  | 508 |  |  |
  | 509 |  | if (~~$ip\_click\_behaviour === 'media'~~) { |
  |  | 535 | $ip\_click\_behaviour    = get\_imagepress\_option( 'ip\_click\_behaviour' ); |
  |  | 536 | $get\_imagepress\_title  = get\_imagepress\_option( 'ip\_title\_optional' ); |
  |  | 537 | $get\_imagepress\_author = get\_imagepress\_option( 'ip\_author\_optional' ); |
  |  | 538 | $get\_imagepress\_meta   = get\_imagepress\_option( 'ip\_meta\_optional' ); |
  |  | 539 | $get\_imagepress\_views  = get\_imagepress\_option( 'ip\_views\_optional' ); |
  |  | 540 | $get\_ip\_comments       = get\_imagepress\_option( 'ip\_comments' ); |
  |  | 541 | $ip\_ipw                = get\_imagepress\_option( 'ip\_ipw' ); |
  |  | 542 | $size                  = get\_imagepress\_option( 'ip\_image\_size' ); |
  |  | 543 |  |
  |  | 544 | if ( $ip\_click\_behaviour === 'media' ) { |
  | 510 | 545 | // Get attachment source |
  | 511 |  | $image\_attributes = wp\_get\_attachment\_image\_src(~~$post\_thumbnail\_id, 'full'~~); |
  |  | 546 | $image\_attributes = wp\_get\_attachment\_image\_src( $post\_thumbnail\_id, 'full' ); |
  | 512 | 547 |  |
  | 513 | 548 | $ip\_image\_link = $image\_attributes[0]; |
  | 514 |  | } else~~if ($ip\_click\_behaviour === 'custom'~~) { |
  | 515 |  | $ip\_image\_link = get\_permalink(~~$elementId~~); |
  |  | 549 | } elseif ( $ip\_click\_behaviour === 'custom' ) { |
  |  | 550 | $ip\_image\_link = get\_permalink( $element\_id ); |
  | 516 | 551 | } |
  | 517 | 552 |  |
  | 518 | 553 | // Make all "brick" elements optional and active by default |
  | 519 | 554 | $ip\_title\_optional = ''; |
  | 520 |  | if (~~(int) $getImagePressTitle === 1~~) { |
  | 521 |  | $ip\_title\_optional = '<span class="imagetitle">' . get\_the\_title(~~$elementId~~) . '</span>'; |
  |  | 555 | if ( (int) $get\_imagepress\_title === 1 ) { |
  |  | 556 | $ip\_title\_optional = '<span class="imagetitle">' . get\_the\_title( $element\_id ) . '</span>'; |
  | 522 | 557 | } |
  | 523 | 558 |  |
  | 524 | 559 | $ip\_author\_optional = ''; |
  | 525 |  | if (~~(int) $getImagePressAuthor === 1~~) { |
  |  | 560 | if ( (int) $get\_imagepress\_author === 1 ) { |
  | 526 | 561 | // Get post author ID |
  | 527 |  | $post\_author\_id = get\_post\_field(~~'post\_author', $elementId~~); |
  | 528 |  |  |
  | 529 |  | $ip\_author\_optional = ~~getImagePressProfileUri($post\_author\_id~~); |
  |  | 562 | $post\_author\_id = get\_post\_field( 'post\_author', $element\_id ); |
  |  | 563 |  |
  |  | 564 | $ip\_author\_optional = ip\_get\_profile\_url( $post\_author\_id ); |
  | 530 | 565 | } |
  | 531 | 566 |  |
  | 532 | 567 | $ip\_meta\_optional = ''; |
  | 533 |  | if ((int) $getImagePressMeta === 1) |
  | 534 |  | $ip\_meta\_optional = '<span class="imagecategory" data-tag="' . strip\_tags(get\_the\_term\_list($elementId, 'imagepress\_image\_category', '', ', ', '')) . '">' . strip\_tags(get\_the\_term\_list($elementId, 'imagepress\_image\_category', '', ', ', '')) . '</span>'; |
  |  | 568 | if ( (int) $get\_imagepress\_meta === 1 ) { |
  |  | 569 | $ip\_meta\_optional = '<span class="imagecategory" data-tag="' . wp\_strip\_all\_tags( get\_the\_term\_list( $element\_id, 'imagepress\_image\_category', '', ', ', '' ) ) . '">' . wp\_strip\_all\_tags( get\_the\_term\_list( $element\_id, 'imagepress\_image\_category', '', ', ', '' ) ) . '</span>'; |
  |  | 570 | } |
  | 535 | 571 |  |
  | 536 | 572 | $ip\_views\_optional = ''; |
  | 537 |  | if ((int) $getImagePressViews === 1) |
  | 538 |  | $ip\_views\_optional = '<span class="imageviews"><i class="ai-eye-open"></i> ' . ip\_getPostViews($elementId) . '</span> '; |
  |  | 573 | if ( (int) $get\_imagepress\_views === 1 ) { |
  |  | 574 | $ip\_views\_optional = '<span class="imageviews"><i class="ai-eye-open"></i> ' . intval( ip\_get\_post\_views( $element\_id ) ) . '</span> '; |
  |  | 575 | } |
  | 539 | 576 |  |
  | 540 | 577 | /\*\*/ |
  | 541 | 578 | $ip\_comments = ''; |
  | 542 |  | if ($get\_ip\_comments == 1) |
  | 543 |  | $ip\_comments = '<span class="imagecomments"><i class="ai-chat-dots"></i> ' . get\_comments\_number($elementId) . '</span> '; |
  | 544 |  |  |
  | 545 |  | $image\_attributes = wp\_get\_attachment\_image\_src($post\_thumbnail\_id, $size); |
  | 546 |  |  |
  | 547 |  | $out .= '<div class="ip\_box ip\_box\_' . $elementId . '" style="width: ' . (100/$ip\_ipw) . '%;"> |
  | 548 |  | <a href="' . $ip\_image\_link . '" data-taxonomy="' . strip\_tags(get\_the\_term\_list($elementId, 'imagepress\_image\_category', '', ', ', '')) . '" data-src="' . $image\_attributes[0] . '" title="' . get\_the\_title($elementId) . '"><img src="' . $image\_attributes[0] . '" alt="' . get\_the\_title($elementId) . '"></a> |
  |  | 579 | if ( $get\_ip\_comments == 1 ) { |
  |  | 580 | $ip\_comments = '<span class="imagecomments"><i class="ai-chat-dots"></i> ' . get\_comments\_number( $element\_id ) . '</span> '; |
  |  | 581 | } |
  |  | 582 |  |
  |  | 583 | $image\_attributes = wp\_get\_attachment\_image\_src( $post\_thumbnail\_id, $size ); |
  |  | 584 |  |
  |  | 585 | $out .= '<div class="ip\_box ip\_box\_' . $element\_id . '" style="width: ' . ( 100 / $ip\_ipw ) . '%;"> |
  |  | 586 | <a href="' . $ip\_image\_link . '" data-taxonomy="' . wp\_strip\_all\_tags( get\_the\_term\_list( $element\_id, 'imagepress\_image\_category', '', ', ', '' ) ) . '" data-src="' . $image\_attributes[0] . '" title="' . get\_the\_title( $element\_id ) . '"><img src="' . $image\_attributes[0] . '" alt="' . get\_the\_title( $element\_id ) . '"></a> |
  | 549 | 587 | <div class="ip\_box\_top">' . $ip\_title\_optional . $ip\_author\_optional . $ip\_meta\_optional . '</div> |
  | 550 | 588 | <div class="ip\_box\_bottom">' . $ip\_views\_optional . $ip\_comments . '</div> |
* ## [image-gallery/trunk/includes/imagepress-install.php](/changeset/3167164/image-gallery/trunk/includes/imagepress-install.php "Show the changeset 3167164 restricted to image-gallery/trunk/includes/imagepress-install.php")

  | [r1893517](/browser/image-gallery/trunk/includes/imagepress-install.php?rev=1893517#L1 "Show revision 1893517 of this file in browser") | [r3167164](/browser/image-gallery/trunk/includes/imagepress-install.php?rev=3167164#L1 "Show revision 3167164 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 |  | $option~~Array = array(~~ |
  |  | 2 | $option\_array = [ |
  | 3 | 3 | // Configurator tab |
  | 4 |  | 'ip\_box\_ui' => 'default', |
  | 5 |  | 'ip\_grid\_ui' => 'default', |
  | 6 |  | 'ip\_ipw' => 5, |
  | 7 |  | 'ip\_ipp' => 20, |
  | 8 |  | 'ip\_order' => 'DESC', |
  | 9 |  | 'ip\_orderby' => 'date', |
  | 10 |  | 'ip\_slug' => 'image', |
  | 11 |  | 'ip\_image\_size' => 'imagepress\_sq\_std', |
  | 12 |  | 'ip\_title\_optional' => 1, |
  | 13 |  | 'ip\_meta\_optional' => 1, |
  | 14 |  | 'ip\_views\_optional' => 1, |
  | 15 |  | 'ip\_comments' => 1, |
  | 16 |  | 'ip\_author\_optional' => 0, |
  |  | 4 | 'ip\_box\_ui'                      => 'default', |
  |  | 5 | 'ip\_grid\_ui'                     => 'default', |
  |  | 6 | 'ip\_ipw'                         => 5, |
  |  | 7 | 'ip\_ipp'                         => 20, |
  |  | 8 | 'ip\_order'                       => 'DESC', |
  |  | 9 | 'ip\_orderby'                     => 'date', |
  |  | 10 | 'ip\_slug'                        => 'image', |
  |  | 11 | 'ip\_image\_size'                  => 'imagepress\_sq\_std', |
  |  | 12 | 'ip\_title\_optional'              => 1, |
  |  | 13 | 'ip\_meta\_optional'               => 1, |
  |  | 14 | 'ip\_views\_optional'              => 1, |
  |  | 15 | 'ip\_comments'                    => 1, |
  |  | 16 | 'ip\_author\_optional'             => 0, |
  | 17 | 17 |  |
  | 18 | 18 | // Collections tab |
  | 19 |  | 'ip\_collections\_page' => '', |
  |  | 19 | 'ip\_collections\_page'            => '', |
  | 20 | 20 |  |
  | 21 | 21 | // Login tab |
  | 22 |  | 'ip\_login\_image' => '', |
  | 23 |  | 'ip\_login\_bg' => '#fefefe', |
  | 24 |  | 'ip\_login\_box\_bg' => '#ffffff', |
  | 25 |  | 'ip\_login\_box\_text' => '#000000', |
  | 26 |  | 'ip\_login\_page\_text' => '#000000', |
  | 27 |  | 'ip\_login\_button\_bg' => '#00a0d2', |
  | 28 |  | 'ip\_login\_button\_text' => '#ffffff', |
  | 29 |  | 'ip\_login\_copyright' => '', |
  |  | 22 | 'ip\_login\_image'                 => '', |
  |  | 23 | 'ip\_login\_bg'                    => '#fefefe', |
  |  | 24 | 'ip\_login\_box\_bg'                => '#ffffff', |
  |  | 25 | 'ip\_login\_box\_text'              => '#000000', |
  |  | 26 | 'ip\_login\_page\_text'             => '#000000', |
  |  | 27 | 'ip\_login\_button\_bg'             => '#00a0d2', |
  |  | 28 | 'ip\_login\_button\_text'           => '#ffffff', |
  |  | 29 | 'ip\_login\_copyright'             => '', |
  | 30 | 30 |  |
  | 31 | 31 | // Labels tab |
  | 32 |  | 'ip\_caption\_label' => 'Image Caption', |
  | 33 |  | 'ip\_category\_label' => 'Image Category', |
  | 34 |  | 'ip\_description\_label' => 'Image Description', |
  | 35 |  | 'ip\_upload\_label' => 'Upload', |
  | 36 |  | 'ip\_image\_label' => 'Select Image', |
  | 37 |  | 'ip\_upload\_success\_title' => 'Image uploaded!', |
  | 38 |  | 'ip\_upload\_success' => 'Click here to view your image.', |
  |  | 32 | 'ip\_caption\_label'               => 'Image Caption', |
  |  | 33 | 'ip\_category\_label'              => 'Image Category', |
  |  | 34 | 'ip\_description\_label'           => 'Image Description', |
  |  | 35 | 'ip\_upload\_label'                => 'Upload', |
  |  | 36 | 'ip\_image\_label'                 => 'Select Image', |
  |  | 37 | 'ip\_upload\_success\_title'        => 'Image uploaded!', |
  |  | 38 | 'ip\_upload\_success'              => 'Click here to view your image.', |
  | 39 | 39 |  |
  | 40 | 40 | // Settings tab |
  | 41 |  | 'ip\_moderate' => 1, |
  | 42 |  | 'ip\_registration' => 1, |
  | 43 |  | 'ip\_click\_behaviour' => 'custom', |
  | 44 |  | 'ip\_cat\_moderation\_include' => '', |
  | 45 |  | 'ip\_upload\_redirection' => '', |
  | 46 |  | 'ip\_delete\_redirection' => '', |
  | 47 |  | 'ip\_notification\_email' => '', |
  |  | 41 | 'ip\_moderate'                    => 1, |
  |  | 42 | 'ip\_registration'                => 1, |
  |  | 43 | 'ip\_click\_behaviour'             => 'custom', |
  |  | 44 | 'ip\_cat\_moderation\_include'      => '', |
  |  | 45 | 'ip\_upload\_redirection'          => '', |
  |  | 46 | 'ip\_delete\_redirection'          => '', |
  |  | 47 | 'ip\_notification\_email'          => '', |
  | 48 | 48 |  |
  | 49 | 49 | // Authors tab |
  | 50 |  | 'approvednotification' => 1, |
  | 51 |  | 'declinednotification' => 1, |
  |  | 50 | 'approvednotification'           => 1, |
  |  | 51 | 'declinednotification'           => 1, |
  | 52 | 52 |  |
  | 53 | 53 | // Upload tab |
  | 54 |  | 'ip\_upload\_tos' => 0, |
  | 55 |  | 'ip\_upload\_tos\_url' => '', |
  | 56 |  | 'ip\_upload\_tos\_error' => 'You have to agree! You definitely have to!', |
  | 57 |  | 'ip\_upload\_tos\_content' => 'I have read and agree to the terms & conditions of use.', |
  | 58 |  | 'ip\_upload\_size' => 4096, |
  | 59 |  | 'ip\_global\_upload\_limit' => 1000, |
  |  | 54 | 'ip\_upload\_tos'                  => 0, |
  |  | 55 | 'ip\_upload\_tos\_url'              => '', |
  |  | 56 | 'ip\_upload\_tos\_error'            => 'You have to agree! You definitely have to!', |
  |  | 57 | 'ip\_upload\_tos\_content'          => 'I have read and agree to the terms & conditions of use.', |
  |  | 58 | 'ip\_upload\_size'                 => 4096, |
  |  | 59 | 'ip\_global\_upload\_limit'         => 1000, |
  | 60 | 60 | 'ip\_global\_upload\_limit\_message' => 'You have reached the maximum number of images allowed.', |
  | 61 |  | 'ip\_cat\_exclude' => '', |
  | 62 |  | 'ip\_max\_quality' ~~=> 100~~ |
  | 63 |  | ~~)~~; |
  |  | 61 | 'ip\_cat\_exclude'                 => '', |
  |  | 62 | 'ip\_max\_quality'                 => 100, |
  |  | 63 | ]; |
  | 64 | 64 |  |
  | 65 |  | add\_option(~~'imagepress', $optionArray~~); |
  |  | 65 | add\_option( 'imagepress', $option\_array ); |
* ## [image-gallery/trunk/includes/page-settings.php](/changeset/3167164/image-gallery/trunk/includes/page-settings.php "Show the changeset 3167164 restricted to image-gallery/trunk/includes/page-settings.php")

  | [r3166568](/browser/image-gallery/trunk/includes/page-settings.php?rev=3166568#L12 "Show revision 3166568 of this file in browser") | [r3167164](/browser/image-gallery/trunk/includes/page-settings.php?rev=3167164#L12 "Show revision 3167164 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | ?> |
  | 13 | 13 | <h2 class="nav-tab-wrapper ip-nav-tab-wrapper"> |
  | 14 |  | <a href="<?php echo $section; ?>dashboard\_tab" class="nav-tab <?php echo $tab === 'dashboard\_tab' ? 'nav-tab-active' : ''; ?>"><?php \_e( 'Dashboard', 'image-gallery' ); ?></a> |
  | 15 |  | <a href="<?php echo $section; ?>settings\_tab" class="nav-tab <?php echo $tab === 'settings\_tab' ? 'nav-tab-active' : ''; ?>"><?php \_e( 'Settings', 'image-gallery' ); ?></a> |
  | 16 |  | <a href="<?php echo $section; ?>configurator\_tab" class="nav-tab <?php echo $tab === 'configurator\_tab' ? 'nav-tab-active' : ''; ?>"><?php \_e( 'Configurator', 'image-gallery' ); ?></a> |
  | 17 |  |  |
  | 18 |  | <a href="<?php echo $section; ?>label\_tab" class="nav-tab <?php echo $tab === 'label\_tab' ? 'nav-tab-active' : ''; ?>"><?php \_e( 'Labels', 'image-gallery' ); ?></a> |
  | 19 |  | <a href="<?php echo $section; ?>upload\_tab" class="nav-tab <?php echo $tab === 'upload\_tab' ? 'nav-tab-active' : ''; ?>"><?php \_e( 'Upload', 'image-gallery' ); ?></a> |
  | 20 |  |  |
  | 21 |  | <a href="<?php echo $section; ?>extensions" class="nav-tab <?php echo $tab === 'extensions' ? 'nav-tab-active' : ''; ?> highlighted"><b><?php \_e( 'UPGRADE', 'image-gallery' ); ?></b></a> |
  |  | 14 | <a href="<?php echo esc\_attr( $section ); ?>dashboard\_tab" class="nav-tab <?php echo $tab === 'dashboard\_tab' ? 'nav-tab-active' : ''; ?>"><?php esc\_html\_e( 'Dashboard', 'image-gallery' ); ?></a> |
  |  | 15 | <a href="<?php echo esc\_attr( $section ); ?>settings\_tab" class="nav-tab <?php echo $tab === 'settings\_tab' ? 'nav-tab-active' : ''; ?>"><?php esc\_html\_e( 'Settings', 'image-gallery' ); ?></a> |
  |  | 16 | <a href="<?php echo esc\_attr( $section ); ?>configurator\_tab" class="nav-tab <?php echo $tab === 'configurator\_tab' ? 'nav-tab-active' : ''; ?>"><?php esc\_html\_e( 'Configurator', 'image-gallery' ); ?></a> |
  |  | 17 |  |
  |  | 18 | <a href="<?php echo esc\_attr( $section ); ?>label\_tab" class="nav-tab <?php echo $tab === 'label\_tab' ? 'nav-tab-active' : ''; ?>"><?php esc\_html\_e( 'Labels', 'image-gallery' ); ?></a> |
  |  | 19 | <a href="<?php echo esc\_attr( $section ); ?>upload\_tab" class="nav-tab <?php echo $tab === 'upload\_tab' ? 'nav-tab-active' : ''; ?>"><?php esc\_html\_e( 'Upload', 'image-gallery' ); ?></a> |
  | 22 | 20 | </h2> |
  | 23 | 21 |  |
  | […](/browser/image-gallery/trunk/includes/page-settings.php?rev=3166568#L36) | […](/browser/image-gallery/trunk/includes/page-settings.php?rev=3167164#L34) |  |
  | 36 | 34 | </div> |
  | 37 | 35 | <div class="gb-footer"> |
  | 38 |  | <p>For support, feature requests and bug reporting, please visit the <a href="https://getbutterfly.com/" rel="external">official website</a>.<br>&copy;' . ~~date\_i18n( 'Y'~~ ) . ' <a href="https://getbutterfly.com/" rel="external"><strong>getButterfly</strong>.com</a> &middot; <a href="https://getbutterfly.com/support/documentation/imagepress/">Documentation</a> &middot; <small>Code wrangling since 2005</small></p> |
  |  | 36 | <p>For support, feature requests and bug reporting, please visit the <a href="https://getbutterfly.com/" rel="external">official website</a>.<br>&copy;' . esc\_attr( date\_i18n( 'Y' ) ) . ' <a href="https://getbutterfly.com/" rel="external"><strong>getButterfly</strong>.com</a> &middot; <a href="https://getbutterfly.com/support/documentation/imagepress/">Documentation</a> &middot; <small>Code wrangling since 2005</small></p> |
  | 39 | 37 | </div> |
  | 40 | 38 | </div> |
  | […](/browser/image-gallery/trunk/includes/page-settings.php?rev=3166568#L42) | […](/browser/image-gallery/trunk/includes/page-settings.php?rev=3167164#L40) |  |
  | 42 | 40 |  |
  | 43 | 41 | <p> |
  | 44 |  | <small>You are using <b>ImagePress - Image Gallery</b> plugin version <strong>' . ~~$ipdata['Version']~~ . '</strong>.</small><br> |
  | 45 |  | <small>You are using PHP version ' . PHP\_VERSION . ' and MySQL server version ' . ~~$wpdb->db\_version(~~) . '.</small> |
  |  | 42 | <small>You are using <b>ImagePress - Image Gallery</b> plugin version <strong>' . esc\_attr( $ipdata['Version'] ) . '</strong>.</small><br> |
  |  | 43 | <small>You are using PHP version ' . PHP\_VERSION . ' and MySQL server version ' . esc\_attr( $wpdb->db\_version() ) . '.</small> |
  | 46 | 44 | </p> |
  | 47 | 45 |  |
  | […](/browser/image-gallery/trunk/includes/page-settings.php?rev=3166568#L56) | […](/browser/image-gallery/trunk/includes/page-settings.php?rev=3167164#L54) |  |
  | 56 | 54 | echo '<p><div class="dashicons dashicons-no"></div> <b>Error:</b> Your image slug is not set. Go to <b>Configurator</b> section and set it.</p>'; |
  | 57 | 55 | } else { |
  | 58 |  | echo '<p><div class="dashicons dashicons-yes"></div> <b>Note:</b> Your image slug is <code>' . ~~$ip\_slug~~ . '</code>. If you changed it recently, visit your <b>Permalinks</b> section and resave the changes.</p>'; |
  |  | 56 | echo '<p><div class="dashicons dashicons-yes"></div> <b>Note:</b> Your image slug is <code>' . esc\_attr( $ip\_slug ) . '</code>. If you changed it recently, visit your <b>Permalinks</b> section and resave the changes.</p>'; |
  | 59 | 57 | } |
  | 60 | 58 | if ( '' !== locate\_template( $single\_template ) ) { |
  | […](/browser/image-gallery/trunk/includes/page-settings.php?rev=3166568#L85) | […](/browser/image-gallery/trunk/includes/page-settings.php?rev=3167164#L83) |  |
  | 85 | 83 | <code>[imagepress-loop category="landscapes"]</code> - display all images in a specific category. Use the category <b>slug</b>.<br> |
  | 86 | 84 | </p>'; |
  | 87 |  | ~~} elseif ( $tab === 'configurator\_tab' ) {~~ |
  | 88 |  | ~~if ( isset( $\_POST['isGSSubmit'] ) ) {~~ |
  | 89 |  | ~~$ipUpdatedOptions = array(~~ |
  | 90 |  | ~~'ip\_box\_ui' => $\_POST['ip\_box\_ui'],~~ |
  | 91 |  | ~~'ip\_grid\_ui' => $\_POST['ip\_grid\_ui'],~~ |
  | 92 |  | ~~'ip\_ipw' => $\_POST['ip\_ipw'],~~ |
  | 93 |  | ~~'ip\_ipp' => $\_POST['ip\_ipp'],~~ |
  | 94 |  | ~~'ip\_order' => $\_POST['ip\_order'],~~ |
  | 95 |  | ~~'ip\_orderby' => $\_POST['ip\_orderby'],~~ |
  | 96 |  | ~~'ip\_slug' => $\_POST['ip\_slug'],~~ |
  | 97 |  | ~~'ip\_image\_size' => $\_POST['ip\_image\_size'],~~ |
  | 98 |  | ~~'ip\_title\_optional' => $\_POST['ip\_title\_optional'],~~ |
  | 99 |  | ~~'ip\_meta\_optional' => $\_POST['ip\_meta\_optional'],~~ |
  | 100 |  | ~~'ip\_views\_optional' => $\_POST['ip\_views\_optional'],~~ |
  | 101 |  | ~~'ip\_comments' => $\_POST['ip\_comments'],~~ |
  | 102 |  | ~~'ip\_author\_optional' => $\_POST['ip\_author\_optional'],~~ |
  | 103 |  | ~~);~~ |
  | 104 |  | ~~$ipOptions = get\_option('imagepress');~~ |
  | 105 |  | ~~$ipUpdate = array\_merge($ipOptions, $ipUpdatedOptions);~~ |
  | 106 |  | ~~update\_option('imagepress', $ipUpdate);~~ |
  | 107 |  |  |
  | 108 |  | ~~echo '<div class="updated notice is-dismissible"><p>Settings updated successfully!</p></div>';~~ |
  | 109 |  | ~~}~~ |
  | 110 | 85 | ?> |
  | 111 |  | <form method="post" action=""> |
  | 112 |  | <h2><?php esc\_html\_e('Grid Configurator', 'image-gallery'); ?></h2> |
  | 113 |  | <p>The <b>Grid configurator</b> allows you to select which information will be visible inside the image box.</p> |
  | 114 |  | <table class="form-table"> |
  | 115 |  | <tbody> |
  | 116 |  | <tr> |
  | 117 |  | <th scope="row"><label>Image box appearance</label></th> |
  | 118 |  | <td> |
  | 119 |  | <select name="ip\_box\_ui" id="ip\_box\_ui"> |
  | 120 |  | <option value="default"<?php if ((string) get\_imagepress\_option('ip\_box\_ui') === 'default') echo ' selected'; ?>>Default</option> |
  | 121 |  | <option value="overlay"<?php if ((string) get\_imagepress\_option('ip\_box\_ui') === 'overlay') echo ' selected'; ?>>Overlay</option> |
  | 122 |  | </select> |
  | 123 |  | </td> |
  | 124 |  | </tr> |
  | 125 |  | <tr> |
  | 126 |  | <th scope="row"><label>Image grid display</label></th> |
  | 127 |  | <td> |
  | 128 |  | <select name="ip\_grid\_ui" id="ip\_grid\_ui"> |
  | 129 |  | <option value="basic"<?php if ((string) get\_imagepress\_option('ip\_grid\_ui') === 'basic') echo ' selected'; ?>>Basic (no styling)</option> |
  | 130 |  | <option value="default"<?php if ((string) get\_imagepress\_option('ip\_grid\_ui') === 'default') echo ' selected'; ?>>Default (equal height containers)</option> |
  | 131 |  | <option value="masonry"<?php if ((string) get\_imagepress\_option('ip\_grid\_ui') === 'masonry') echo ' selected'; ?>>Masonry</option> |
  | 132 |  | </select> |
  | 133 |  | </td> |
  | 134 |  | </tr> |
  | 135 |  | <tr> |
  | 136 |  | <th scope="row"><label>Image box details</label></th> |
  | 137 |  | <td> |
  | 138 |  | <p> |
  | 139 |  | <input name="ip\_slug" id="slug" type="text" class="regular-text" placeholder="Image slug" value="<?php echo get\_imagepress\_option('ip\_slug'); ?>" required> <label for="ip\_slug"><b>Image</b> slug</label> |
  | 140 |  | <br><small>Use an appropriate slug for your image (e.g. <b>image</b> in <code>domain.com/<b>image</b>/myimage</code>).</small> |
  | 141 |  | <br><small>Tip: use a singular term, one word only, lowercase, letters only (examples: image, poster, illustration).</small> |
  | 142 |  | </p> |
  | 143 |  | <p> |
  | 144 |  | <select name="ip\_image\_size" id="ip\_image\_size"> |
  | 145 |  | <optgroup label="WordPress (default)"> |
  | 146 |  | <option value="thumbnail"<?php if (get\_imagepress\_option('ip\_image\_size') == 'thumbnail') echo ' selected'; ?>>Thumbnail</option> |
  | 147 |  | <option value="medium"<?php if (get\_imagepress\_option('ip\_image\_size') == 'medium') echo ' selected'; ?>>Medium</option> |
  | 148 |  | </optgroup> |
  | 149 |  | <optgroup label="ImagePress (default)"> |
  | 150 |  | <option value="imagepress\_sq\_std"<?php if (get\_imagepress\_option('ip\_image\_size') == 'imagepress\_sq\_std') echo ' selected'; ?>>Standard (Square)</option> |
  | 151 |  | <option value="imagepress\_pt\_std"<?php if (get\_imagepress\_option('ip\_image\_size') == 'imagepress\_pt\_std') echo ' selected'; ?>>Standard (Portrait)</option> |
  | 152 |  | <option value="imagepress\_ls\_std"<?php if (get\_imagepress\_option('ip\_image\_size') == 'imagepress\_ls\_std') echo ' selected'; ?>>Standard (Landscape)</option> |
  | 153 |  | </optgroup> |
  | 154 |  | <optgroup label="Other registered sizes (use with care)"> |
  | 155 |  | <?php |
  | 156 |  | $ip\_image\_size = get\_imagepress\_option('ip\_image\_size'); |
  | 157 |  | $thumbsize = isset($ip\_image\_size) ? esc\_attr($ip\_image\_size) : ''; |
  | 158 |  | $image\_sizes = ip\_return\_image\_sizes(); |
  | 159 |  | foreach ($image\_sizes as $size => $atts) { |
  | 160 |  | if ((int) $atts[0] !== 0 && (int) $atts[1] !== 0) { |
  | 161 |  | ?> |
  | 162 |  | <option value="<?php echo $size ;?>" <?php selected($thumbsize, $size); ?>><?php echo $size . ' - ' . implode('x', $atts); ?></option> |
  | 163 |  | <?php |
  | 164 |  | } |
  | 165 |  | } |
  | 166 |  | ?> |
  | 167 |  | </optgroup> |
  | 168 |  | </select> <label for="ip\_image\_size"><b>Image box</b> thumbnail size</label> |
  | 169 |  | <br><small>Use <b>thumbnail</b>, adjust the column size to match your thumbnail size and hide the description in order to have uniform sizes</small> |
  | 170 |  | </p> |
  | 171 |  | <p> |
  | 172 |  | <select name="ip\_title\_optional" id="ip\_title\_optional"> |
  | 173 |  | <option value="0"<?php if(get\_imagepress\_option('ip\_title\_optional') == 0) echo ' selected'; ?>>Hide image title</option> |
  | 174 |  | <option value="1"<?php if(get\_imagepress\_option('ip\_title\_optional') == 1) echo ' selected'; ?>>Show image title</option> |
  | 175 |  | </select> |
  | 176 |  | <label for="ip\_title\_optional">Show/hide image title</label> |
  | 177 |  | </p> |
  | 178 |  | <p> |
  | 179 |  | <select name="ip\_meta\_optional" id="ip\_meta\_optional"> |
  | 180 |  | <option value="0"<?php if(get\_imagepress\_option('ip\_meta\_optional') == 0) echo ' selected'; ?>>Hide image meta</option> |
  | 181 |  | <option value="1"<?php if(get\_imagepress\_option('ip\_meta\_optional') == 1) echo ' selected'; ?>>Show image meta</option> |
  | 182 |  | </select> |
  | 183 |  | <label for="ip\_meta\_optional">Show/hide the image meta (category/taxonomy)</label> |
  | 184 |  | </p> |
  | 185 |  | <p> |
  | 186 |  | <select name="ip\_views\_optional" id="ip\_views\_optional"> |
  | 187 |  | <option value="0"<?php if(get\_imagepress\_option('ip\_views\_optional') == 0) echo ' selected'; ?>>Hide image views</option> |
  | 188 |  | <option value="1"<?php if(get\_imagepress\_option('ip\_views\_optional') == 1) echo ' selected'; ?>>Show image views</option> |
  | 189 |  | </select> |
  | 190 |  | <label for="ip\_views\_optional">Show/hide the number of image views</label> |
  | 191 |  | </p> |
  | 192 |  | <p> |
  | 193 |  | <select name="ip\_comments" id="ip\_comments"> |
  | 194 |  | <option value="0"<?php if(get\_imagepress\_option('ip\_comments') == '0') echo ' selected'; ?>>Hide image comments</option> |
  | 195 |  | <option value="1"<?php if(get\_imagepress\_option('ip\_comments') == '1') echo ' selected'; ?>>Show image comments</option> |
  | 196 |  | </select> |
  | 197 |  | <label for="ip\_comments">Show/hide the number of image comments</label> |
  | 198 |  | </p> |
  | 199 |  | <p> |
  | 200 |  | <select name="ip\_author\_optional" id="ip\_author\_optional"> |
  | 201 |  | <option value="0"<?php if(get\_imagepress\_option('ip\_author\_optional') == 0) echo ' selected'; ?>>Hide image author</option> |
  | 202 |  | <option value="1"<?php if(get\_imagepress\_option('ip\_author\_optional') == 1) echo ' selected'; ?>>Show image author</option> |
  | 203 |  | </select> |
  | 204 |  | <label for="ip\_author\_optional">Show/hide the author name and link</label> |
  | 205 |  | </p> |
  | 206 |  | </td> |
  | 207 |  | </tr> |
  | 208 |  | </tbody> |
  | 209 |  | </table> |
  | 210 |  |  |
  | 211 |  | <hr> |
  | 212 |  | <h2>Grid Settings</h2> |
  | 213 |  | <p>These settings apply globally for the image and author grid.</p> |
  | 214 |  | <table class="form-table"> |
  | 215 |  | <tbody> |
  | 216 |  | <tr> |
  | 217 |  | <th scope="row"><label>Image grid details</label></th> |
  | 218 |  | <td> |
  | 219 |  | <input name="ip\_ipw" id="ip\_ipw" type="number" value="<?php echo get\_imagepress\_option('ip\_ipw'); ?>" min="1" max="1024"> |
  | 220 |  | <label for="ip\_ipw">Images per row (0-32)</label> |
  | 221 |  | <br><small>Number of images per grid row.</small> |
  | 222 |  | <br> |
  | 223 |  |  |
  | 224 |  | <input name="ip\_ipp" id="ip\_ipp" type="number" value="<?php echo get\_imagepress\_option('ip\_ipp'); ?>" min="1" max="65536"> |
  | 225 |  | <label for="ip\_ipp">Images per page (0-256)</label> |
  | 226 |  | <br><small>How many images per page you want to display using the <code>[imagepress-loop]</code> shortcode.</small> |
  | 227 |  |  |
  | 228 |  | <p> |
  | 229 |  | <label for="ip\_order">Sort images</label> |
  | 230 |  | <select name="ip\_order" id="ip\_order"> |
  | 231 |  | <option value="ASC"<?php if(get\_imagepress\_option('ip\_order') == 'ASC') echo ' selected'; ?>>ASC</option> |
  | 232 |  | <option value="DESC"<?php if(get\_imagepress\_option('ip\_order') == 'DESC') echo ' selected'; ?>>DESC</option> |
  | 233 |  | </select> <label for="ip\_orderby">by</label> <select name="ip\_orderby" id="ip\_orderby"> |
  | 234 |  | <option value="none"<?php if(get\_imagepress\_option('ip\_orderby') == 'none') echo ' selected'; ?>>none</option> |
  | 235 |  | <option value="ID"<?php if(get\_imagepress\_option('ip\_orderby') == 'ID') echo ' selected'; ?>>ID</option> |
  | 236 |  | <option value="author"<?php if(get\_imagepress\_option('ip\_orderby') == 'author') echo ' selected'; ?>>author</option> |
  | 237 |  | <option value="title"<?php if(get\_imagepress\_option('ip\_orderby') == 'title') echo ' selected'; ?>>title</option> |
  | 238 |  | <option value="name"<?php if(get\_imagepress\_option('ip\_orderby') == 'name') echo ' selected'; ?>>name</option> |
  | 239 |  | <option value="date"<?php if(get\_imagepress\_option('ip\_orderby') == 'date') echo ' selected'; ?>>date</option> |
  | 240 |  | <option value="rand"<?php if(get\_imagepress\_option('ip\_orderby') == 'rand') echo ' selected'; ?>>rand</option> |
  | 241 |  | <option value="comment\_count"<?php if(get\_imagepress\_option('ip\_orderby') == 'comment\_count') echo ' selected'; ?>>comment\_count</option> |
  | 242 |  | </select> |
  | 243 |  | </p> |
  | 244 |  | </td> |
  | 245 |  | </tr> |
  | 246 |  | </tbody> |
  | 247 |  | </table> |
  | 248 |  |  |
  | 249 |  | <hr> |
  | 250 |  | <p><input type="submit" name="isGSSubmit" value="Save Changes" class="button-primary"></p> |
  | 251 |  | </form> |
  | 252 |  | <?php } else if ($tab == 'settings\_tab') { |
  | 253 |  | if (isset($\_POST['isGSSubmit'])) { |
  | 254 |  | $ipUpdatedOptions = array( |
  | 255 |  | 'ip\_moderate' => $\_POST['ip\_moderate'], |
  | 256 |  | 'ip\_registration' => $\_POST['ip\_registration'], |
  | 257 |  | 'ip\_click\_behaviour' => $\_POST['ip\_click\_behaviour'], |
  | 258 |  | 'ip\_cat\_moderation\_include' => $\_POST['ip\_cat\_moderation\_include'], |
  | 259 |  | 'ip\_upload\_redirection' => $\_POST['ip\_upload\_redirection'], |
  | 260 |  | 'ip\_delete\_redirection' => $\_POST['ip\_delete\_redirection'], |
  | 261 |  | 'ip\_notification\_email' => $\_POST['ip\_notification\_email'], |
  | 262 |  | 'approvednotification' => $\_POST['approvednotification'], |
  | 263 |  | 'declinednotification' => $\_POST['declinednotification'] |
  | 264 |  | ); |
  | 265 |  | $ipOptions = get\_option('imagepress'); |
  | 266 |  | $ipUpdate = array\_merge($ipOptions, $ipUpdatedOptions); |
  | 267 |  | update\_option('imagepress', $ipUpdate); |
  | 268 |  |  |
  | 269 |  | echo '<div class="updated notice is-dismissible"><p>Settings updated successfully!</p></div>'; |
  | 270 |  | } |
  | 271 |  | ?> |
  | 272 |  | <form method="post" action=""> |
  | 273 |  | <h2>General Settings</h2> |
  | 274 |  | <p>These settings apply globally for all ImagePress users.</p> |
  | 275 |  | <table class="form-table"> |
  | 276 |  | <tbody> |
  | 277 |  | <tr> |
  | 278 |  | <th scope="row"><label for="ip\_registration">User registration</label></th> |
  | 279 |  | <td> |
  | 280 |  | <select name="ip\_registration" id="ip\_registration"> |
  | 281 |  | <option value="0"<?php if(get\_imagepress\_option('ip\_registration') == '0') echo ' selected'; ?>>Require user registration (recommended)</option> |
  | 282 |  | <option value="1"<?php if(get\_imagepress\_option('ip\_registration') == '1') echo ' selected'; ?>>Do not require user registration</option> |
  | 283 |  | </select> |
  | 284 |  | <br><small>Require users to be registered and logged in to upload images (recommended).</small> |
  | 285 |  | </td> |
  | 286 |  | </tr> |
  | 287 |  | <tr> |
  | 288 |  | <th scope="row"><label for="ip\_click\_behaviour">Image behaviour</label></th> |
  | 289 |  | <td> |
  | 290 |  | <select name="ip\_click\_behaviour" id="ip\_click\_behaviour"> |
  | 291 |  | <option value="media"<?php if(get\_imagepress\_option('ip\_click\_behaviour') == 'media') echo ' selected'; ?>>Open media (image)</option> |
  | 292 |  | <option value="custom"<?php if(get\_imagepress\_option('ip\_click\_behaviour') == 'custom') echo ' selected'; ?>>Open image page (recommended)</option> |
  | 293 |  | </select> |
  | 294 |  | <br><small>What to open when clicking on an image (single image or custom post template).</small> |
  | 295 |  | </td> |
  | 296 |  | </tr> |
  | 297 |  | <tr> |
  | 298 |  | <th scope="row"><label for="ip\_moderate">Image moderation</label></th> |
  | 299 |  | <td> |
  | 300 |  | <select name="ip\_moderate" id="ip\_moderate"> |
  | 301 |  | <option value="0"<?php if(get\_imagepress\_option('ip\_moderate') == '0') echo ' selected'; ?>>Moderate all images (recommended)</option> |
  | 302 |  | <option value="1"<?php if(get\_imagepress\_option('ip\_moderate') == '1') echo ' selected'; ?>>Do not moderate images</option> |
  | 303 |  | </select> |
  | 304 |  | <br><small>Moderate all submitted images (recommended).</small> |
  | 305 |  | </td> |
  | 306 |  | </tr> |
  | 307 |  | <tr> |
  | 308 |  | <th scope="row"><label for="ip\_cat\_moderation\_include">Moderate entries in this category</label></th> |
  | 309 |  | <td> |
  | 310 |  | <input type="number" name="ip\_cat\_moderation\_include" id="ip\_cat\_moderation\_include" value="<?php echo get\_imagepress\_option('ip\_cat\_moderation\_include'); ?>"> |
  | 311 |  | <br><small>Always moderate entries in this category (use category ID).</small> |
  | 312 |  | </td> |
  | 313 |  | </tr> |
  | 314 |  | </tbody> |
  | 315 |  | </table> |
  | 316 |  |  |
  | 317 |  | <hr> |
  | 318 |  | <h2>Redirection</h2> |
  | 319 |  | <p>Optionally redirect users to various pages after image submission/removal. Examples are: a thank you page, a confirmation page, a payment page, a newsletter page or another call to action.</p> |
  | 320 |  | <table class="form-table"> |
  | 321 |  | <tbody> |
  | 322 |  | <tr> |
  | 323 |  | <th scope="row"><label for="ip\_upload\_redirection">Upload redirect</label></th> |
  | 324 |  | <td> |
  | 325 |  | <input type="url" name="ip\_upload\_redirection" id="ip\_upload\_redirection" placeholder="https://" class="regular-text" value="<?php echo get\_imagepress\_option('ip\_upload\_redirection'); ?>"> |
  | 326 |  | <br><small>Redirect users to this page after image upload (optional, leave blank to disable).</small> |
  | 327 |  | </td> |
  | 328 |  | </tr> |
  | 329 |  | <tr> |
  | 330 |  | <th scope="row"><label for="ip\_delete\_redirection">Delete redirect</label></th> |
  | 331 |  | <td> |
  | 332 |  | <input type="url" name="ip\_delete\_redirection" id="ip\_delete\_redirection" placeholder="https://" class="regular-text" value="<?php echo get\_imagepress\_option('ip\_delete\_redirection'); ?>"> |
  | 333 |  | <br><small>Redirect users to this page after image deletion (optional, leave blank to disable).</small> |
  | 334 |  | </td> |
  | 335 |  | </tr> |
  | 336 |  | </tbody> |
  | 337 |  | </table> |
  | 338 |  |  |
  | 339 |  | <hr> |
  | 340 |  | <h2>Email Settings</h2> |
  | 341 |  | <table class="form-table"> |
  | 342 |  | <tbody> |
  | 343 |  | <tr> |
  | 344 |  | <th scope="row"><label for="ip\_notification\_email">Administrator email<br><small>(used for new image notification)</small></label></th> |
  | 345 |  | <td> |
  | 346 |  | <input type="text" name="ip\_notification\_email" id="ip\_notification\_email" value="<?php echo get\_imagepress\_option('ip\_notification\_email'); ?>" class="regular-text"> |
  | 347 |  | <br><small>The administrator will receive an email notification each time a new image is uploaded.</small> |
  | 348 |  | <br><small>Separate multiple addresses with comma.</small> |
  | 349 |  | </td> |
  | 350 |  | </tr> |
  | 351 |  | <tr> |
  | 352 |  | <th scope="row"><label>Email Settings</label></th> |
  | 353 |  | <td> |
  | 354 |  | <p> |
  | 355 |  | <input type="checkbox" id="approvednotification" name="approvednotification" value="yes" <?php if(get\_imagepress\_option('approvednotification') == 'yes') echo 'checked'; ?>> <label for="approvednotification">Notify author when image is approved</label> |
  | 356 |  | <br> |
  | 357 |  | <input type="checkbox" id="declinednotification" name="declinednotification" value="yes" <?php if(get\_imagepress\_option('declinednotification') == 'yes') echo 'checked'; ?>> <label for="declinednotification">Notify author when image is rejected</label> |
  | 358 |  | </p> |
  | 359 |  | </td> |
  | 360 |  | </tr> |
  | 361 |  | </tbody> |
  | 362 |  | </table> |
  | 363 |  |  |
  | 364 |  | <hr> |
  | 365 |  | <p><input type="submit" name="isGSSubmit" value="Save Changes" class="button-primary"></p> |
  | 366 |  | </form> |
  | 367 |  | <?php } else if ($tab == 'label\_tab') { |
  | 368 |  | if (isset($\_POST['isGSSubmit'])) { |
  | 369 |  | $ipUpdatedOptions = array( |
  | 370 |  | 'ip\_caption\_label' => $\_POST['ip\_caption\_label'], |
  | 371 |  | 'ip\_category\_label' => $\_POST['ip\_category\_label'], |
  | 372 |  | 'ip\_description\_label' => $\_POST['ip\_description\_label'], |
  | 373 |  | 'ip\_upload\_label' => $\_POST['ip\_upload\_label'], |
  | 374 |  | 'ip\_image\_label' => $\_POST['ip\_image\_label'], |
  | 375 |  | 'ip\_upload\_success\_title' => $\_POST['ip\_upload\_success\_title'], |
  | 376 |  | 'ip\_upload\_success' => $\_POST['ip\_upload\_success'] |
  | 377 |  | ); |
  | 378 |  | $ipOptions = get\_option('imagepress'); |
  | 379 |  | $ipUpdate = array\_merge($ipOptions, $ipUpdatedOptions); |
  | 380 |  | update\_option('imagepress', $ipUpdate); |
  | 381 |  |  |
  | 382 |  | echo '<div class="updated notice is-dismissible"><p>Settings updated successfully!</p></div>'; |
  | 383 |  | } |
  | 384 |  | ?> |
  | 385 |  | <form method="post" action=""> |
  | 386 |  | <h2><?php \_e('Label Settings', 'image-gallery'); ?></h2> |
  | 387 |  | <p><?php \_e('Configure, set or translate any of ImagePress labels. Leave a label blank to disable/hide it.', 'image-gallery'); ?></p> |
  | 388 |  | <table class="form-table"> |
  | 389 |  | <tbody> |
  | 390 |  | <tr> |
  | 391 |  | <th scope="row"><label for="ip\_caption\_label">Image caption label<br><small>Leave blank to disable</small></label></th> |
  | 392 |  | <td> |
  | 393 |  | <input type="text" name="ip\_caption\_label" id="ip\_caption\_label" value="<?php echo get\_imagepress\_option('ip\_caption\_label'); ?>" class="regular-text"> |
  | 394 |  | </td> |
  | 395 |  | </tr> |
  | 396 |  | <tr> |
  | 397 |  | <th scope="row"><label for="ip\_category\_label">Image category label<br><small>(dropdown)</small></label></th> |
  | 398 |  | <td> |
  | 399 |  | <input type="text" name="ip\_category\_label" id="ip\_category\_label" value="<?php echo get\_imagepress\_option('ip\_category\_label'); ?>" class="regular-text"> |
  | 400 |  | </td> |
  | 401 |  | </tr> |
  | 402 |  | <tr> |
  | 403 |  | <th scope="row"><label for="ip\_description\_label">Image description label<br><small>(textarea)<br>Leave blank to disable</small></label></th> |
  | 404 |  | <td> |
  | 405 |  | <input type="text" name="ip\_description\_label" id="ip\_description\_label" value="<?php echo get\_imagepress\_option('ip\_description\_label'); ?>" class="regular-text"> |
  | 406 |  | </td> |
  | 407 |  | </tr> |
  | 408 |  | <tr> |
  | 409 |  | <th scope="row"><label for="ip\_upload\_label">Image upload button label<br><small>(button)</small></label></th> |
  | 410 |  | <td> |
  | 411 |  | <input type="text" name="ip\_upload\_label" id="ip\_upload\_label" value="<?php echo get\_imagepress\_option('ip\_upload\_label'); ?>" class="regular-text"> |
  | 412 |  | </td> |
  | 413 |  | </tr> |
  | 414 |  | <tr> |
  | 415 |  | <th scope="row"><label for="ip\_image\_label">Image upload selection label<br><small>(link)</small></label></th> |
  | 416 |  | <td> |
  | 417 |  | <input type="text" name="ip\_image\_label" id="ip\_image\_label" value="<?php echo get\_imagepress\_option('ip\_image\_label'); ?>" class="regular-text"> |
  | 418 |  | </td> |
  | 419 |  | </tr> |
  | 420 |  | </tbody> |
  | 421 |  | </table> |
  | 422 |  |  |
  | 423 |  | <hr> |
  | 424 |  | <h2><?php \_e('Image Upload', 'image-gallery'); ?></h2> |
  | 425 |  | <p>This text will appear when the image upload is successful. Leave blank to disable.</p> |
  | 426 |  | <table class="form-table"> |
  | 427 |  | <tbody> |
  | 428 |  | <tr> |
  | 429 |  | <th scope="row"><label for="ip\_upload\_success\_title">Upload success title</label></th> |
  | 430 |  | <td> |
  | 431 |  | <input type="text" name="ip\_upload\_success\_title" id="ip\_upload\_success\_title" value="<?php echo get\_imagepress\_option('ip\_upload\_success\_title'); ?>" class="regular-text"> |
  | 432 |  | </td> |
  | 433 |  | </tr> |
  | 434 |  | <tr> |
  | 435 |  | <th scope="row"><label for="ip\_upload\_success">Upload success</label></th> |
  | 436 |  | <td> |
  | 437 |  | <input type="text" name="ip\_upload\_success" id="ip\_upload\_success" value="<?php echo get\_imagepress\_option('ip\_upload\_success'); ?>" class="regular-text"> |
  | 438 |  | </td> |
  | 439 |  | </tr> |
  | 440 |  | </tbody> |
  | 441 |  | </table> |
  | 442 |  |  |
  | 443 |  | <hr> |
  | 444 |  | <p><input type="submit" name="isGSSubmit" value="Save Changes" class="button-primary"></p> |
  | 445 |  | </form> |
  | 446 |  | <?php } else if ($tab == 'upload\_tab') { |
  | 447 |  | if (isset($\_POST['isGSSubmit'])) { |
  | 448 |  | $ipUpdatedOptions = array( |
  | 449 |  | 'ip\_upload\_tos' => $\_POST['ip\_upload\_tos'], |
  | 450 |  | 'ip\_upload\_tos\_url' => $\_POST['ip\_upload\_tos\_url'], |
  | 451 |  | 'ip\_upload\_tos\_error' => $\_POST['ip\_upload\_tos\_error'], |
  | 452 |  | 'ip\_upload\_tos\_content' => $\_POST['ip\_upload\_tos\_content'], |
  | 453 |  | 'ip\_upload\_size' => $\_POST['ip\_upload\_size'], |
  | 454 |  | 'ip\_global\_upload\_limit' => $\_POST['ip\_global\_upload\_limit'], |
  | 455 |  | 'ip\_global\_upload\_limit\_message' => $\_POST['ip\_global\_upload\_limit\_message'], |
  | 456 |  | 'ip\_cat\_exclude' => $\_POST['ip\_cat\_exclude'], |
  | 457 |  | 'ip\_max\_quality' => $\_POST['ip\_max\_quality'] |
  | 458 |  | ); |
  | 459 |  | $ipOptions = get\_option('imagepress'); |
  | 460 |  | $ipUpdate = array\_merge($ipOptions, $ipUpdatedOptions); |
  | 461 |  | update\_option('imagepress', $ipUpdate); |
  | 462 |  |  |
  | 463 |  | if ((int) trim($\_POST['ip\_quota\_increase']) > 0) { |
  | 464 |  | $ipUsers = get\_users(); |
  | 465 |  | $ip\_quota\_increase = (int) trim($\_POST['ip\_quota\_increase']); |
  | 466 |  |  |
  | 467 |  | foreach ($ipUsers as $user) { |
  | 468 |  | $quota = (int) get\_the\_author\_meta('ip\_upload\_limit', $user->ID); |
  | 469 |  |  |
  | 470 |  | if ((string) $\_POST['ip\_quota\_action'] === 'increase') { |
  | 471 |  | update\_user\_meta($user->ID, 'ip\_upload\_limit', $quota + $ip\_quota\_increase); |
  | 472 |  | } else if ((string) $\_POST['ip\_quota\_action'] === 'decrease') { |
  | 473 |  | update\_user\_meta($user->ID, 'ip\_upload\_limit', $quota - $ip\_quota\_increase); |
  | 474 |  | } else if ((string) $\_POST['ip\_quota\_action'] === 'set') { |
  | 475 |  | update\_user\_meta($user->ID, 'ip\_upload\_limit', $ip\_quota\_increase); |
  | 476 |  | } |
  | 477 |  | } |
  | 478 |  | } |
  | 479 |  |  |
  | 480 |  | echo '<div class="updated notice is-dismissible"><p>Users quota increased successfully!</p></div>'; |
  | 481 |  | echo '<div class="updated notice is-dismissible"><p>Settings updated successfully!</p></div>'; |
  | 482 |  | } |
  | 483 |  | ?> |
  | 484 |  | <form method="post" action=""> |
  | 485 |  | <h2><?php \_e('Upload Settings', 'image-gallery'); ?></h2> |
  | 486 |  | <table class="form-table"> |
  | 487 |  | <tbody> |
  | 488 |  | <tr> |
  | 489 |  | <th scope="row"><label for="ip\_max\_quality">Image quality</label></th> |
  | 490 |  | <td> |
  | 491 |  | <input name="ip\_max\_quality" id="ip\_max\_quality" type="number" value="<?php echo get\_imagepress\_option('ip\_max\_quality')?>" min="0" max="100"> |
  | 492 |  | <br><small>Set image quality when uploading image.</small> |
  | 493 |  | </td> |
  | 494 |  | </tr> |
  | 495 |  | <tr> |
  | 496 |  | <th scope="row"><label for="ip\_upload\_size">Maximum image upload size<br><small>(in kilobytes)</small></label></th> |
  | 497 |  | <td> |
  | 498 |  | <input type="number" name="ip\_upload\_size" id="ip\_upload\_size" min="0" max="65536" step="1024" value="<?php echo get\_imagepress\_option('ip\_upload\_size'); ?>"> |
  | 499 |  | <br><small>Try 4096 for most configurations.</small> |
  | 500 |  | </td> |
  | 501 |  | </tr> |
  | 502 |  | <tr> |
  | 503 |  | <th scope="row"><label for="ip\_cat\_exclude">Exclude categories</label></th> |
  | 504 |  | <td> |
  | 505 |  | <input type="text" name="ip\_cat\_exclude" id="ip\_cat\_exclude" value="<?php echo get\_imagepress\_option('ip\_cat\_exclude'); ?>"> |
  | 506 |  | <br><small>Exclude these categories from the upload form (separate IDs with comma).</small> |
  | 507 |  | </td> |
  | 508 |  | </tr> |
  | 509 |  | <tr> |
  | 510 |  | <th scope="row"><label>Terms and conditions of use</label></th> |
  | 511 |  | <td> |
  | 512 |  | <select name="ip\_upload\_tos" id="ip\_upload\_tos"> |
  | 513 |  | <option value="1"<?php if(get\_imagepress\_option('ip\_upload\_tos') == 1) echo ' selected'; ?>>Enable terms and conditions</option> |
  | 514 |  | <option value="0"<?php if(get\_imagepress\_option('ip\_upload\_tos') == 0) echo ' selected'; ?>>Disable terms and conditions</option> |
  | 515 |  | </select> <label for="ip\_upload\_tos">Enable/disable terms and conditions of use</label> |
  | 516 |  | <br> |
  | 517 |  | <input type="text" name="ip\_upload\_tos\_content" id="ip\_upload\_tos\_content" class="regular-text" value="<?php echo get\_imagepress\_option('ip\_upload\_tos\_content'); ?>" placeholder="I agree with the terms and conditions"> <label for="ip\_upload\_tos\_content">Terms and conditions of use body</label> |
  | 518 |  | <br> |
  | 519 |  | <input type="text" name="ip\_upload\_tos\_error" id="ip\_upload\_tos\_error" class="regular-text" value="<?php echo get\_imagepress\_option('ip\_upload\_tos\_error'); ?>" placeholder="Please indicate that you accept the terms and conditions of use"> <label for="ip\_upload\_tos\_error">Terms and conditions of use error</label> |
  | 520 |  | <br> |
  | 521 |  | <input type="url" name="ip\_upload\_tos\_url" id="ip\_upload\_tos\_url" class="regular-text" value="<?php echo get\_imagepress\_option('ip\_upload\_tos\_url'); ?>" placeholder="https://"> <label for="ip\_upload\_tos\_url">Terms and conditions of use URL</label> |
  | 522 |  | <br><small>Opens in new tab/window</small> |
  | 523 |  | </td> |
  | 524 |  | </tr> |
  | 525 |  | </tbody> |
  | 526 |  | </table> |
  | 527 |  |  |
  | 528 |  | <hr> |
  | 529 |  | <h2>Limits and Quotas</h2> |
  | 530 |  | <p> |
  | 531 |  | Set global and per-user upload limits.<br> |
  | 532 |  | Set individual limits for each user in their <a href="<?php echo admin\_url('users.php'); ?>">profile editor</a>. Individual limits have higher priority than global limits. |
  | 533 |  | </p> |
  | 534 |  | <table class="form-table"> |
  | 535 |  | <tbody> |
  | 536 |  | <tr> |
  | 537 |  | <th scope="row"><label for="ip\_global\_upload\_limit">Maximum image upload limit</label></th> |
  | 538 |  | <td> |
  | 539 |  | <input type="number" name="ip\_global\_upload\_limit" id="ip\_global\_upload\_limit" min="0" max="999999" step="1" value="<?php echo get\_imagepress\_option('ip\_global\_upload\_limit'); ?>"> <label for="ip\_global\_upload\_limit">Image upload limit (global, if no other limits are specified)</label> |
  | 540 |  | <hr> |
  | 541 |  |  |
  | 542 |  | <p> |
  | 543 |  | <select name="ip\_quota\_action"> |
  | 544 |  | <option value="increase">Increase all users quota by</option> |
  | 545 |  | <option value="decrease">Decrease all users quota by</option> |
  | 546 |  | <option value="set">Set all users quota to</option> |
  | 547 |  | </select> <input name="ip\_quota\_increase" type="number" min="0" placeholder="0"> images |
  | 548 |  | <br><small>Note that setting a limit higher than the global limit will override it.</small> |
  | 549 |  | </p> |
  | 550 |  |  |
  | 551 |  | <hr> |
  | 552 |  | <textarea class="large-text" rows="4" id="ip\_global\_upload\_limit\_message" name="ip\_global\_upload\_limit\_message" placeholder="You have reached the maximum number of images allowed."><?php echo get\_imagepress\_option('ip\_global\_upload\_limit\_message'); ?></textarea> |
  | 553 |  | <br><small>Set a message when maximum number of images is reached.</small> |
  | 554 |  | </td> |
  | 555 |  | </tr> |
  | 556 |  | </tbody> |
  | 557 |  | </table> |
  | 558 |  |  |
  | 559 |  | <hr> |
  | 560 |  |  |
  | 561 |  | <p><input type="submit" name="isGSSubmit" value="Save Changes" class="button-primary"></p> |
  | 562 |  | </form> |
  | 563 |  | <?php |
  | 564 |  | } elseif ( $tab === 'extensions' ) { |
  | 565 |  | ?> |
  | 566 |  | <h2><?php \_e( 'ImagePress PRO', 'image-gallery' ); ?></h2> |
  |  | 86 | <h2><?php esc\_html\_e( 'ImagePress PRO', 'image-gallery' ); ?></h2> |
  | 567 | 87 |  |
  | 568 | 88 | <div style="display: grid; grid-template-columns: repeat(2, 1fr); grid-gap: 2em;"> |
  | […](/browser/image-gallery/trunk/includes/page-settings.php?rev=3166568#L592) | […](/browser/image-gallery/trunk/includes/page-settings.php?rev=3167164#L112) |  |
  | 592 | 112 |  |
  | 593 | 113 | <ul class="feature-list--pro--optional"> |
  | 594 |  | ~~<li><span class="dashicons dashicons-yes-alt"></span> <a href="https://propertypin.co/" rel="external noopener">PropertyPin</a> integration</li>~~ |
  | 595 | 114 | <li><span class="dashicons dashicons-yes-alt"></span> Bulk (media library) upload</li> |
  | 596 | 115 | <li><span class="dashicons dashicons-yes-alt"></span> Image pins (similar to Pinterest)</li> |
  | […](/browser/image-gallery/trunk/includes/page-settings.php?rev=3166568#L601) | […](/browser/image-gallery/trunk/includes/page-settings.php?rev=3167164#L120) |  |
  | 601 | 120 | </div> |
  | 602 | 121 | <?php |
  |  | 122 | } elseif ( $tab === 'configurator\_tab' ) { |
  |  | 123 | if ( isset( $\_POST['isGSSubmit'] ) ) { |
  |  | 124 | if ( ! isset( $\_POST['imagepress\_settings\_nonce'] ) || ! check\_admin\_referer( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ) ) { |
  |  | 125 | wp\_die( esc\_html\_\_( 'Nonce verification failed. Please try again.', 'image-gallery' ) ); |
  |  | 126 | } |
  |  | 127 |  |
  |  | 128 | $ip\_updated\_options = [ |
  |  | 129 | 'ip\_box\_ui'          => isset( $\_POST['ip\_box\_ui'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_box\_ui'] ) ) : '', |
  |  | 130 | 'ip\_grid\_ui'         => isset( $\_POST['ip\_grid\_ui'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_grid\_ui'] ) ) : '', |
  |  | 131 | 'ip\_ipw'             => isset( $\_POST['ip\_ipw'] ) ? intval( $\_POST['ip\_ipw'] ) : 0, |
  |  | 132 | 'ip\_ipp'             => isset( $\_POST['ip\_ipp'] ) ? intval( $\_POST['ip\_ipp'] ) : 0, |
  |  | 133 | 'ip\_order'           => isset( $\_POST['ip\_order'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_order'] ) ) : '', |
  |  | 134 | 'ip\_orderby'         => isset( $\_POST['ip\_orderby'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_orderby'] ) ) : '', |
  |  | 135 | 'ip\_slug'            => isset( $\_POST['ip\_slug'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_slug'] ) ) : '', |
  |  | 136 | 'ip\_image\_size'      => isset( $\_POST['ip\_image\_size'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_image\_size'] ) ) : '', |
  |  | 137 | 'ip\_title\_optional'  => isset( $\_POST['ip\_title\_optional'] ) ? intval( $\_POST['ip\_title\_optional'] ) : 0, |
  |  | 138 | 'ip\_meta\_optional'   => isset( $\_POST['ip\_meta\_optional'] ) ? intval( $\_POST['ip\_meta\_optional'] ) : 0, |
  |  | 139 | 'ip\_views\_optional'  => isset( $\_POST['ip\_views\_optional'] ) ? intval( $\_POST['ip\_views\_optional'] ) : 0, |
  |  | 140 | 'ip\_comments'        => isset( $\_POST['ip\_comments'] ) ? intval( $\_POST['ip\_comments'] ) : 0, |
  |  | 141 | 'ip\_author\_optional' => isset( $\_POST['ip\_author\_optional'] ) ? intval( $\_POST['ip\_author\_optional'] ) : 0, |
  |  | 142 | ]; |
  |  | 143 | $ip\_options         = get\_option( 'imagepress' ); |
  |  | 144 | $ip\_update          = array\_merge( $ip\_options, $ip\_updated\_options ); |
  |  | 145 | update\_option( 'imagepress', $ip\_update ); |
  |  | 146 |  |
  |  | 147 | echo '<div class="updated notice is-dismissible"><p>Settings updated successfully!</p></div>'; |
  |  | 148 | } |
  |  | 149 | ?> |
  |  | 150 | <form method="post" action=""> |
  |  | 151 | <?php wp\_nonce\_field( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ); ?> |
  |  | 152 |  |
  |  | 153 | <h2><?php esc\_html\_e( 'Grid Configurator', 'image-gallery' ); ?></h2> |
  |  | 154 | <p>The <b>Grid configurator</b> allows you to select which information will be visible inside the image box.</p> |
  |  | 155 | <table class="form-table"> |
  |  | 156 | <tbody> |
  |  | 157 | <tr> |
  |  | 158 | <th scope="row"><label>Image box appearance</label></th> |
  |  | 159 | <td> |
  |  | 160 | <select name="ip\_box\_ui" id="ip\_box\_ui"> |
  |  | 161 | <option value="default" |
  |  | 162 | <?php |
  |  | 163 | if ( (string) get\_imagepress\_option( 'ip\_box\_ui' ) === 'default' ) { |
  |  | 164 | echo ' selected';} |
  |  | 165 | ?> |
  |  | 166 | >Default</option> |
  |  | 167 | <option value="overlay" |
  |  | 168 | <?php |
  |  | 169 | if ( (string) get\_imagepress\_option( 'ip\_box\_ui' ) === 'overlay' ) { |
  |  | 170 | echo ' selected';} |
  |  | 171 | ?> |
  |  | 172 | >Overlay</option> |
  |  | 173 | </select> |
  |  | 174 | </td> |
  |  | 175 | </tr> |
  |  | 176 | <tr> |
  |  | 177 | <th scope="row"><label>Image grid display</label></th> |
  |  | 178 | <td> |
  |  | 179 | <select name="ip\_grid\_ui" id="ip\_grid\_ui"> |
  |  | 180 | <option value="basic" |
  |  | 181 | <?php |
  |  | 182 | if ( (string) get\_imagepress\_option( 'ip\_grid\_ui' ) === 'basic' ) { |
  |  | 183 | echo ' selected';} |
  |  | 184 | ?> |
  |  | 185 | >Basic (no styling)</option> |
  |  | 186 | <option value="default" |
  |  | 187 | <?php |
  |  | 188 | if ( (string) get\_imagepress\_option( 'ip\_grid\_ui' ) === 'default' ) { |
  |  | 189 | echo ' selected';} |
  |  | 190 | ?> |
  |  | 191 | >Default (equal height containers)</option> |
  |  | 192 | <option value="masonry" |
  |  | 193 | <?php |
  |  | 194 | if ( (string) get\_imagepress\_option( 'ip\_grid\_ui' ) === 'masonry' ) { |
  |  | 195 | echo ' selected';} |
  |  | 196 | ?> |
  |  | 197 | >Masonry</option> |
  |  | 198 | </select> |
  |  | 199 | </td> |
  |  | 200 | </tr> |
  |  | 201 | <tr> |
  |  | 202 | <th scope="row"><label>Image box details</label></th> |
  |  | 203 | <td> |
  |  | 204 | <p> |
  |  | 205 | <input name="ip\_slug" id="slug" type="text" class="regular-text" placeholder="Image slug" value="<?php echo esc\_attr( get\_imagepress\_option( 'ip\_slug' ) ); ?>" required> <label for="ip\_slug"><b>Image</b> slug</label> |
  |  | 206 | <br><small>Use an appropriate slug for your image (e.g. <b>image</b> in <code>domain.com/<b>image</b>/my-image-name/</code>).</small> |
  |  | 207 | <br><small>Tip: use a singular term, one word only, lowercase, letters only (examples: image, poster, illustration).</small> |
  |  | 208 | </p> |
  |  | 209 | <p> |
  |  | 210 | <select name="ip\_image\_size" id="ip\_image\_size"> |
  |  | 211 | <optgroup label="WordPress (default)"> |
  |  | 212 | <option value="thumbnail" |
  |  | 213 | <?php |
  |  | 214 | if ( (string) get\_imagepress\_option( 'ip\_image\_size' ) === 'thumbnail' ) { |
  |  | 215 | echo ' selected';} |
  |  | 216 | ?> |
  |  | 217 | >Thumbnail</option> |
  |  | 218 | <option value="medium" |
  |  | 219 | <?php |
  |  | 220 | if ( (string) get\_imagepress\_option( 'ip\_image\_size' ) === 'medium' ) { |
  |  | 221 | echo ' selected';} |
  |  | 222 | ?> |
  |  | 223 | >Medium</option> |
  |  | 224 | </optgroup> |
  |  | 225 | <optgroup label="ImagePress (default)"> |
  |  | 226 | <option value="imagepress\_sq\_std" |
  |  | 227 | <?php |
  |  | 228 | if ( (string) get\_imagepress\_option( 'ip\_image\_size' ) === 'imagepress\_sq\_std' ) { |
  |  | 229 | echo ' selected';} |
  |  | 230 | ?> |
  |  | 231 | >Standard (Square)</option> |
  |  | 232 | <option value="imagepress\_pt\_std" |
  |  | 233 | <?php |
  |  | 234 | if ( (string) get\_imagepress\_option( 'ip\_image\_size' ) === 'imagepress\_pt\_std' ) { |
  |  | 235 | echo ' selected';} |
  |  | 236 | ?> |
  |  | 237 | >Standard (Portrait)</option> |
  |  | 238 | <option value="imagepress\_ls\_std" |
  |  | 239 | <?php |
  |  | 240 | if ( (string) get\_imagepress\_option( 'ip\_image\_size' ) === 'imagepress\_ls\_std' ) { |
  |  | 241 | echo ' selected';} |
  |  | 242 | ?> |
  |  | 243 | >Standard (Landscape)</option> |
  |  | 244 | </optgroup> |
  |  | 245 | <optgroup label="Other registered sizes (use with care)"> |
  |  | 246 | <?php |
  |  | 247 | $ip\_image\_size = get\_imagepress\_option( 'ip\_image\_size' ); |
  |  | 248 | $thumbsize     = isset( $ip\_image\_size ) ? esc\_attr( $ip\_image\_size ) : ''; |
  |  | 249 | $image\_sizes   = ip\_return\_image\_sizes(); |
  |  | 250 | foreach ( $image\_sizes as $size => $atts ) { |
  |  | 251 | if ( (int) $atts[0] !== 0 && (int) $atts[1] !== 0 ) { |
  |  | 252 | ?> |
  |  | 253 | <option value="<?php echo esc\_attr( $size ); ?>" <?php selected( $thumbsize, $size ); ?>><?php echo esc\_attr( $size ) . ' - ' . implode( 'x', array\_map( 'esc\_attr', $atts ) ); ?></option> |
  |  | 254 | <?php |
  |  | 255 | } |
  |  | 256 | } |
  |  | 257 | ?> |
  |  | 258 | </optgroup> |
  |  | 259 | </select> <label for="ip\_image\_size"><b>Image box</b> thumbnail size</label> |
  |  | 260 | <br><small>Use <b>thumbnail</b>, adjust the column size to match your thumbnail size and hide the description in order to have uniform sizes</small> |
  |  | 261 | </p> |
  |  | 262 | <p> |
  |  | 263 | <select name="ip\_title\_optional" id="ip\_title\_optional"> |
  |  | 264 | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_title\_optional' ) ) ); ?>>Hide image title</option> |
  |  | 265 | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_title\_optional' ) ) ); ?>>Show image title</option> |
  |  | 266 | </select> |
  |  | 267 | <label for="ip\_title\_optional">Show/hide image title</label> |
  |  | 268 | </p> |
  |  | 269 | <p> |
  |  | 270 | <select name="ip\_meta\_optional" id="ip\_meta\_optional"> |
  |  | 271 | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_meta\_optional' ) ) ); ?>>Hide image meta</option> |
  |  | 272 | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_meta\_optional' ) ) ); ?>>Show image meta</option> |
  |  | 273 | </select> |
  |  | 274 | <label for="ip\_meta\_optional">Show/hide the image meta (category/taxonomy)</label> |
  |  | 275 | </p> |
  |  | 276 | <p> |
  |  | 277 | <select name="ip\_views\_optional" id="ip\_views\_optional"> |
  |  | 278 | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_views\_optional' ) ) ); ?>>Hide image views</option> |
  |  | 279 | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_views\_optional' ) ) ); ?>>Show image views</option> |
  |  | 280 | </select> |
  |  | 281 | <label for="ip\_views\_optional">Show/hide the number of image views</label> |
  |  | 282 | </p> |
  |  | 283 | <p> |
  |  | 284 | <select name="ip\_comments" id="ip\_comments"> |
  |  | 285 | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_comments' ) ) ); ?>>Hide image comments</option> |
  |  | 286 | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_comments' ) ) ); ?>>Show image comments</option> |
  |  | 287 | </select> |
  |  | 288 | <label for="ip\_comments">Show/hide the number of image comments</label> |
  |  | 289 | </p> |
  |  | 290 | <p> |
  |  | 291 | <select name="ip\_author\_optional" id="ip\_author\_optional"> |
  |  | 292 | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_author\_optional' ) ) ); ?>>Hide image author</option> |
  |  | 293 | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_author\_optional' ) ) ); ?>>Show image author</option> |
  |  | 294 | </select> |
  |  | 295 | <label for="ip\_author\_optional">Show/hide the author name and link</label> |
  |  | 296 | </p> |
  |  | 297 | </td> |
  |  | 298 | </tr> |
  |  | 299 | </tbody> |
  |  | 300 | </table> |
  |  | 301 |  |
  |  | 302 | <hr> |
  |  | 303 | <h2>Grid Settings</h2> |
  |  | 304 | <p>These settings apply globally for the image and author grid.</p> |
  |  | 305 | <table class="form-table"> |
  |  | 306 | <tbody> |
  |  | 307 | <tr> |
  |  | 308 | <th scope="row"><label>Image grid details</label></th> |
  |  | 309 | <td> |
  |  | 310 | <input name="ip\_ipw" id="ip\_ipw" type="number" value="<?php echo intval( get\_imagepress\_option( 'ip\_ipw' ) ); ?>" min="1" max="1024"> |
  |  | 311 | <label for="ip\_ipw">Images per row (0-32)</label> |
  |  | 312 | <br><small>Number of images per grid row.</small> |
  |  | 313 | <br> |
  |  | 314 |  |
  |  | 315 | <input name="ip\_ipp" id="ip\_ipp" type="number" value="<?php echo intval( get\_imagepress\_option( 'ip\_ipp' ) ); ?>" min="1" max="65536"> |
  |  | 316 | <label for="ip\_ipp">Images per page (0-256)</label> |
  |  | 317 | <br><small>How many images per page you want to display using the <code>[imagepress-loop]</code> shortcode.</small> |
  |  | 318 |  |
  |  | 319 | <p> |
  |  | 320 | <label for="ip\_order">Sort images</label> |
  |  | 321 | <select name="ip\_order" id="ip\_order"> |
  |  | 322 | <option value="ASC" <?php selected( 'ASC', get\_imagepress\_option( 'ip\_order' ) ); ?>>ASC</option> |
  |  | 323 | <option value="DESC" <?php selected( 'DESC', get\_imagepress\_option( 'ip\_order' ) ); ?>>DESC</option> |
  |  | 324 | </select> <label for="ip\_orderby">by</label> <select name="ip\_orderby" id="ip\_orderby"> |
  |  | 325 | <option value="none" <?php selected( 'none', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>none</option> |
  |  | 326 | <option value="ID" <?php selected( 'ID', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>ID</option> |
  |  | 327 | <option value="author" <?php selected( 'author', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>author</option> |
  |  | 328 | <option value="title" <?php selected( 'title', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>title</option> |
  |  | 329 | <option value="name" <?php selected( 'name', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>name</option> |
  |  | 330 | <option value="date" <?php selected( 'date', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>date</option> |
  |  | 331 | <option value="rand" <?php selected( 'rand', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>rand</option> |
  |  | 332 | <option value="comment\_count" <?php selected( 'comment\_count', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>comment\_count</option> |
  |  | 333 | </select> |
  |  | 334 | </p> |
  |  | 335 | </td> |
  |  | 336 | </tr> |
  |  | 337 | </tbody> |
  |  | 338 | </table> |
  |  | 339 |  |
  |  | 340 | <hr> |
  |  | 341 | <p><input type="submit" name="isGSSubmit" value="Save Changes" class="button-primary"></p> |
  |  | 342 | </form> |
  |  | 343 | <?php |
  |  | 344 | } elseif ( $tab === 'settings\_tab' ) { |
  |  | 345 | if ( isset( $\_POST['isGSSubmit'] ) ) { |
  |  | 346 | if ( ! isset( $\_POST['imagepress\_settings\_nonce'] ) || ! check\_admin\_referer( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ) ) { |
  |  | 347 | wp\_die( esc\_html\_\_( 'Nonce verification failed. Please try again.', 'image-gallery' ) ); |
  |  | 348 | } |
  |  | 349 |  |
  |  | 350 | $ip\_updated\_options = [ |
  |  | 351 | 'ip\_moderate'               => isset( $\_POST['ip\_moderate'] ) ? intval( $\_POST['ip\_moderate'] ) : 0, |
  |  | 352 | 'ip\_registration'           => isset( $\_POST['ip\_registration'] ) ? intval( $\_POST['ip\_registration'] ) : 0, |
  |  | 353 | 'ip\_click\_behaviour'        => isset( $\_POST['ip\_click\_behaviour'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_click\_behaviour'] ) ) : '', |
  |  | 354 | 'ip\_cat\_moderation\_include' => isset( $\_POST['ip\_cat\_moderation\_include'] ) ? intval( $\_POST['ip\_cat\_moderation\_include'] ) : 0, |
  |  | 355 | 'ip\_upload\_redirection'     => isset( $\_POST['ip\_upload\_redirection'] ) ? sanitize\_url( wp\_unslash( $\_POST['ip\_upload\_redirection'] ) ) : '', |
  |  | 356 | 'ip\_delete\_redirection'     => isset( $\_POST['ip\_delete\_redirection'] ) ? sanitize\_url( wp\_unslash( $\_POST['ip\_delete\_redirection'] ) ) : '', |
  |  | 357 | 'ip\_notification\_email'     => isset( $\_POST['ip\_notification\_email'] ) ? sanitize\_email( wp\_unslash( $\_POST['ip\_notification\_email'] ) ) : '', |
  |  | 358 | 'approvednotification'      => isset( $\_POST['approvednotification'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['approvednotification'] ) ) : '', |
  |  | 359 | 'declinednotification'      => isset( $\_POST['declinednotification'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['declinednotification'] ) ) : '', |
  |  | 360 | ]; |
  |  | 361 | $ip\_options         = get\_option( 'imagepress' ); |
  |  | 362 | $ip\_update          = array\_merge( $ip\_options, $ip\_updated\_options ); |
  |  | 363 | update\_option( 'imagepress', $ip\_update ); |
  |  | 364 |  |
  |  | 365 | echo '<div class="updated notice is-dismissible"><p>Settings updated successfully!</p></div>'; |
  |  | 366 | } |
  |  | 367 | ?> |
  |  | 368 | <form method="post" action=""> |
  |  | 369 | <?php wp\_nonce\_field( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ); ?> |
  |  | 370 |  |
  |  | 371 | <h2>General Settings</h2> |
  |  | 372 | <p>These settings apply globally for all ImagePress users.</p> |
  |  | 373 | <table class="form-table"> |
  |  | 374 | <tbody> |
  |  | 375 | <tr> |
  |  | 376 | <th scope="row"><label for="ip\_registration">User registration</label></th> |
  |  | 377 | <td> |
  |  | 378 | <select name="ip\_registration" id="ip\_registration"> |
  |  | 379 | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_registration' ) ) ); ?>>Require user registration (recommended)</option> |
  |  | 380 | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_registration' ) ) ); ?>>Do not require user registration</option> |
  |  | 381 | </select> |
  |  | 382 | <br><small>Require users to be registered and logged in to upload images (recommended).</small> |
  |  | 383 | </td> |
  |  | 384 | </tr> |
  |  | 385 | <tr> |
  |  | 386 | <th scope="row"><label for="ip\_click\_behaviour">Image behaviour</label></th> |
  |  | 387 | <td> |
  |  | 388 | <select name="ip\_click\_behaviour" id="ip\_click\_behaviour"> |
  |  | 389 | <option value="media" <?php selected( 'media', get\_imagepress\_option( 'ip\_click\_behaviour' ) ); ?>>Open media (image)</option> |
  |  | 390 | <option value="custom" <?php selected( 'custom', get\_imagepress\_option( 'ip\_click\_behaviour' ) ); ?>>Open image page</option> |
  |  | 391 | </select> |
  |  | 392 | <br><small>What to open when clicking on an image (single image or custom post template).</small> |
  |  | 393 | </td> |
  |  | 394 | </tr> |
  |  | 395 | <tr> |
  |  | 396 | <th scope="row"><label for="ip\_moderate">Image moderation</label></th> |
  |  | 397 | <td> |
  |  | 398 | <select name="ip\_moderate" id="ip\_moderate"> |
  |  | 399 | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_moderate' ) ) ); ?>>Moderate all images (recommended)</option> |
  |  | 400 | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_moderate' ) ) ); ?>>Do not moderate images</option> |
  |  | 401 | </select> |
  |  | 402 | <br><small>Moderate all submitted images (recommended).</small> |
  |  | 403 | </td> |
  |  | 404 | </tr> |
  |  | 405 | <tr> |
  |  | 406 | <th scope="row"><label for="ip\_cat\_moderation\_include">Moderate entries in this category</label></th> |
  |  | 407 | <td> |
  |  | 408 | <input type="number" name="ip\_cat\_moderation\_include" id="ip\_cat\_moderation\_include" value="<?php echo intval( get\_imagepress\_option( 'ip\_cat\_moderation\_include' ) ); ?>"> |
  |  | 409 | <br><small>Always moderate entries in this category (use category ID).</small> |
  |  | 410 | </td> |
  |  | 411 | </tr> |
  |  | 412 | </tbody> |
  |  | 413 | </table> |
  |  | 414 |  |
  |  | 415 | <hr> |
  |  | 416 | <h2>Redirection</h2> |
  |  | 417 | <p>Optionally redirect users to various pages after image submission/removal. Examples are: a thank you page, a confirmation page, a payment page, a newsletter page or another call to action.</p> |
  |  | 418 | <table class="form-table"> |
  |  | 419 | <tbody> |
  |  | 420 | <tr> |
  |  | 421 | <th scope="row"><label for="ip\_upload\_redirection">Upload redirect</label></th> |
  |  | 422 | <td> |
  |  | 423 | <input type="url" name="ip\_upload\_redirection" id="ip\_upload\_redirection" placeholder="https://" class="regular-text" value="<?php echo esc\_url( get\_imagepress\_option( 'ip\_upload\_redirection' ) ); ?>"> |
  |  | 424 | <br><small>Redirect users to this page after image upload (optional, leave blank to disable).</small> |
  |  | 425 | </td> |
  |  | 426 | </tr> |
  |  | 427 | <tr> |
  |  | 428 | <th scope="row"><label for="ip\_delete\_redirection">Delete redirect</label></th> |
  |  | 429 | <td> |
  |  | 430 | <input type="url" name="ip\_delete\_redirection" id="ip\_delete\_redirection" placeholder="https://" class="regular-text" value="<?php echo esc\_url( get\_imagepress\_option( 'ip\_delete\_redirection' ) ); ?>"> |
  |  | 431 | <br><small>Redirect users to this page after image deletion (optional, leave blank to disable).</small> |
  |  | 432 | </td> |
  |  | 433 | </tr> |
  |  | 434 | </tbody> |
  |  | 435 | </table> |
  |  | 436 |  |
  |  | 437 | <hr> |
  |  | 438 | <h2>Email Settings</h2> |
  |  | 439 | <table class="form-table"> |
  |  | 440 | <tbody> |
  |  | 441 | <tr> |
  |  | 442 | <th scope="row"><label for="ip\_notification\_email">Administrator email<br><small>(used for new image notification)</small></label></th> |
  |  | 443 | <td> |
  |  | 444 | <input type="text" name="ip\_notification\_email" id="ip\_notification\_email" value="<?php echo esc\_attr( get\_imagepress\_option( 'ip\_notification\_email' ) ); ?>" class="regular-text"> |
  |  | 445 | <br><small>The administrator will receive an email notification each time a new image is uploaded.</small> |
  |  | 446 | <br><small>Separate multiple addresses with comma.</small> |
  |  | 447 | </td> |
  |  | 448 | </tr> |
  |  | 449 | <tr> |
  |  | 450 | <th scope="row"><label>Email Settings</label></th> |
  |  | 451 | <td> |
  |  | 452 | <p> |
  |  | 453 | <input type="checkbox" id="approvednotification" name="approvednotification" value="yes" <?php checked( 'yes', get\_imagepress\_option( 'approvednotification' ) ); ?>> <label for="approvednotification">Notify author when image is approved</label> |
  |  | 454 | <br> |
  |  | 455 | <input type="checkbox" id="declinednotification" name="declinednotification" value="yes" <?php checked( 'yes', get\_imagepress\_option( 'declinednotification' ) ); ?>> <label for="declinednotification">Notify author when image is rejected</label> |
  |  | 456 | </p> |
  |  | 457 | </td> |
  |  | 458 | </tr> |
  |  | 459 | </tbody> |
  |  | 460 | </table> |
  |  | 461 |  |
  |  | 462 | <hr> |
  |  | 463 | <p><input type="submit" name="isGSSubmit" value="Save Changes" class="button-primary"></p> |
  |  | 464 | </form> |
  |  | 465 | <?php |
  |  | 466 | } elseif ( $tab === 'label\_tab' ) { |
  |  | 467 | if ( isset( $\_POST['isGSSubmit'] ) ) { |
  |  | 468 | if ( ! isset( $\_POST['imagepress\_settings\_nonce'] ) || ! check\_admin\_referer( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ) ) { |
  |  | 469 | wp\_die( esc\_html\_\_( 'Nonce verification failed. Please try again.', 'image-gallery' ) ); |
  |  | 470 | } |
  |  | 471 |  |
  |  | 472 | $ip\_updated\_options = [ |
  |  | 473 | 'ip\_caption\_label'        => isset( $\_POST['ip\_caption\_label'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_caption\_label'] ) ) : '', |
  |  | 474 | 'ip\_category\_label'       => isset( $\_POST['ip\_category\_label'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_category\_label'] ) ) : '', |
  |  | 475 | 'ip\_description\_label'    => isset( $\_POST['ip\_description\_label'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_description\_label'] ) ) : '', |
  |  | 476 | 'ip\_upload\_label'         => isset( $\_POST['ip\_upload\_label'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_upload\_label'] ) ) : '', |
  |  | 477 | 'ip\_image\_label'          => isset( $\_POST['ip\_image\_label'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_image\_label'] ) ) : '', |
  |  | 478 | 'ip\_upload\_success\_title' => isset( $\_POST['ip\_upload\_success\_title'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_upload\_success\_title'] ) ) : '', |
  |  | 479 | 'ip\_upload\_success'       => isset( $\_POST['ip\_upload\_success'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_upload\_success'] ) ) : '', |
  |  | 480 | ]; |
  |  | 481 | $ip\_options         = get\_option( 'imagepress' ); |
  |  | 482 | $ip\_update          = array\_merge( $ip\_options, $ip\_updated\_options ); |
  |  | 483 | update\_option( 'imagepress', $ip\_update ); |
  |  | 484 |  |
  |  | 485 | echo '<div class="updated notice is-dismissible"><p>Settings updated successfully!</p></div>'; |
  |  | 486 | } |
  |  | 487 | ?> |
  |  | 488 | <form method="post" action=""> |
  |  | 489 | <?php wp\_nonce\_field( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ); ?> |
  |  | 490 |  |
  |  | 491 | <h2><?php esc\_html\_e( 'Label Settings', 'image-gallery' ); ?></h2> |
  |  | 492 | <p><?php esc\_html\_e( 'Configure, set or translate any of ImagePress labels. Leave a label blank to disable/hide it.', 'image-gallery' ); ?></p> |
  |  | 493 | <table class="form-table"> |
  |  | 494 | <tbody> |
  |  | 495 | <tr> |
  |  | 496 | <th scope="row"><label for="ip\_caption\_label">Image caption label<br><small>Leave blank to disable</small></label></th> |
  |  | 497 | <td> |
  |  | 498 | <input type="text" name="ip\_caption\_label" id="ip\_caption\_label" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_caption\_label' ) ); ?>" class="regular-text"> |
  |  | 499 | </td> |
  |  | 500 | </tr> |
  |  | 501 | <tr> |
  |  | 502 | <th scope="row"><label for="ip\_category\_label">Image category label<br><small>(dropdown)</small></label></th> |
  |  | 503 | <td> |
  |  | 504 | <input type="text" name="ip\_category\_label" id="ip\_category\_label" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_category\_label' ) ); ?>" class="regular-text"> |
  |  | 505 | </td> |
  |  | 506 | </tr> |
  |  | 507 | <tr> |
  |  | 508 | <th scope="row"><label for="ip\_description\_label">Image description label<br><small>(textarea)<br>Leave blank to disable</small></label></th> |
  |  | 509 | <td> |
  |  | 510 | <input type="text" name="ip\_description\_label" id="ip\_description\_label" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_description\_label' ) ); ?>" class="regular-text"> |
  |  | 511 | </td> |
  |  | 512 | </tr> |
  |  | 513 | <tr> |
  |  | 514 | <th scope="row"><label for="ip\_upload\_label">Image upload button label<br><small>(button)</small></label></th> |
  |  | 515 | <td> |
  |  | 516 | <input type="text" name="ip\_upload\_label" id="ip\_upload\_label" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_upload\_label' ) ); ?>" class="regular-text"> |
  |  | 517 | </td> |
  |  | 518 | </tr> |
  |  | 519 | <tr> |
  |  | 520 | <th scope="row"><label for="ip\_image\_label">Image upload selection label<br><small>(link)</small></label></th> |
  |  | 521 | <td> |
  |  | 522 | <input type="text" name="ip\_image\_label" id="ip\_image\_label" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_image\_label' ) ); ?>" class="regular-text"> |
  |  | 523 | </td> |
  |  | 524 | </tr> |
  |  | 525 | </tbody> |
  |  | 526 | </table> |
  |  | 527 |  |
  |  | 528 | <hr> |
  |  | 529 | <h2><?php esc\_html\_e( 'Image Upload', 'image-gallery' ); ?></h2> |
  |  | 530 | <p>This text will appear when the image upload is successful. Leave blank to disable.</p> |
  |  | 531 | <table class="form-table"> |
  |  | 532 | <tbody> |
  |  | 533 | <tr> |
  |  | 534 | <th scope="row"><label for="ip\_upload\_success\_title">Upload success title</label></th> |
  |  | 535 | <td> |
  |  | 536 | <input type="text" name="ip\_upload\_success\_title" id="ip\_upload\_success\_title" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_upload\_success\_title' ) ); ?>" class="regular-text"> |
  |  | 537 | </td> |
  |  | 538 | </tr> |
  |  | 539 | <tr> |
  |  | 540 | <th scope="row"><label for="ip\_upload\_success">Upload success</label></th> |
  |  | 541 | <td> |
  |  | 542 | <input type="text" name="ip\_upload\_success" id="ip\_upload\_success" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_upload\_success' ) ); ?>" class="regular-text"> |
  |  | 543 | </td> |
  |  | 544 | </tr> |
  |  | 545 | </tbody> |
  |  | 546 | </table> |
  |  | 547 |  |
  |  | 548 | <hr> |
  |  | 549 | <p><input type="submit" name="isGSSubmit" value="Save Changes" class="button-primary"></p> |
  |  | 550 | </form> |
  |  | 551 | <?php |
  |  | 552 | } elseif ( $tab === 'upload\_tab' ) { |
  |  | 553 | if ( isset( $\_POST['isGSSubmit'] ) ) { |
  |  | 554 | if ( ! isset( $\_POST['imagepress\_settings\_nonce'] ) || ! check\_admin\_referer( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ) ) { |
  |  | 555 | wp\_die( esc\_html\_\_( 'Nonce verification failed. Please try again.', 'image-gallery' ) ); |
  |  | 556 | } |
  |  | 557 |  |
  |  | 558 | $ip\_updated\_options = [ |
  |  | 559 | 'ip\_upload\_tos'                  => isset( $\_POST['ip\_upload\_tos'] ) ? intval( $\_POST['ip\_upload\_tos'] ) : 0, |
  |  | 560 | 'ip\_upload\_tos\_url'              => isset( $\_POST['ip\_upload\_tos\_url'] ) ? sanitize\_url( wp\_unslash( $\_POST['ip\_upload\_tos\_url'] ) ) : '', |
  |  | 561 | 'ip\_upload\_tos\_error'            => isset( $\_POST['ip\_upload\_tos\_error'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_upload\_tos\_error'] ) ) : '', |
  |  | 562 | 'ip\_upload\_tos\_content'          => isset( $\_POST['ip\_upload\_tos\_content'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_upload\_tos\_content'] ) ) : '', |
  |  | 563 | 'ip\_upload\_size'                 => isset( $\_POST['ip\_upload\_size'] ) ? intval( $\_POST['ip\_upload\_size'] ) : 0, |
  |  | 564 | 'ip\_global\_upload\_limit'         => isset( $\_POST['ip\_global\_upload\_limit'] ) ? intval( $\_POST['ip\_global\_upload\_limit'] ) : 0, |
  |  | 565 | 'ip\_global\_upload\_limit\_message' => isset( $\_POST['ip\_global\_upload\_limit\_message'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_global\_upload\_limit\_message'] ) ) : '', |
  |  | 566 | 'ip\_cat\_exclude'                 => isset( $\_POST['ip\_cat\_exclude'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_cat\_exclude'] ) ) : '', |
  |  | 567 | 'ip\_max\_quality'                 => isset( $\_POST['ip\_max\_quality'] ) ? intval( $\_POST['ip\_max\_quality'] ) : 0, |
  |  | 568 | ]; |
  |  | 569 | $ip\_options         = get\_option( 'imagepress' ); |
  |  | 570 | $ip\_update          = array\_merge( $ip\_options, $ip\_updated\_options ); |
  |  | 571 | update\_option( 'imagepress', $ip\_update ); |
  |  | 572 |  |
  |  | 573 | if ( isset( $\_POST['ip\_quota\_increase'] ) && intval( $\_POST['ip\_quota\_increase'] ) > 0 ) { |
  |  | 574 | $ip\_users          = get\_users(); |
  |  | 575 | $ip\_quota\_increase = intval( $\_POST['ip\_quota\_increase'] ); |
  |  | 576 |  |
  |  | 577 | foreach ( $ip\_users as $user ) { |
  |  | 578 | $quota = (int) get\_the\_author\_meta( 'ip\_upload\_limit', $user->ID ); |
  |  | 579 |  |
  |  | 580 | if ( isset( $\_POST['ip\_quota\_action'] ) && sanitize\_text\_field( wp\_unslash( $\_POST['ip\_quota\_action'] ) ) === 'increase' ) { |
  |  | 581 | update\_user\_meta( $user->ID, 'ip\_upload\_limit', $quota + $ip\_quota\_increase ); |
  |  | 582 | } elseif ( isset( $\_POST['ip\_quota\_action'] ) && sanitize\_text\_field( wp\_unslash( $\_POST['ip\_quota\_action'] ) ) === 'decrease' ) { |
  |  | 583 | update\_user\_meta( $user->ID, 'ip\_upload\_limit', $quota - $ip\_quota\_increase ); |
  |  | 584 | } elseif ( isset( $\_POST['ip\_quota\_action'] ) && sanitize\_text\_field( wp\_unslash( $\_POST['ip\_quota\_action'] ) ) === 'set' ) { |
  |  | 585 | update\_user\_meta( $user->ID, 'ip\_upload\_limit', $ip\_quota\_increase ); |
  |  | 586 | } |
  |  | 587 | } |
  |  | 588 | } |
  |  | 589 |  |
  |  | 590 | echo '<div class="updated notice is-dismissible"><p>Users quota increased successfully!</p></div>'; |
  |  | 591 | echo '<div class="updated notice is-dismissible"><p>Settings updated successfully!</p></div>'; |
  |  | 592 | } |
  |  | 593 | ?> |
  |  | 594 | <form method="post" action=""> |
  |  | 595 | <?php wp\_nonce\_field( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ); ?> |
  |  | 596 |  |
  |  | 597 | <h2><?php esc\_html\_e( 'Upload Settings', 'image-gallery' ); ?></h2> |
  |  | 598 | <table class="form-table"> |
  |  | 599 | <tbody> |
  |  | 600 | <tr> |
  |  | 601 | <th scope="row"><label for="ip\_max\_quality">Image quality</label></th> |
  |  | 602 | <td> |
  |  | 603 | <input name="ip\_max\_quality" id="ip\_max\_quality" type="number" value="<?php echo intval( get\_imagepress\_option( 'ip\_max\_quality' ) ); ?>" min="0" max="100"> |
  |  | 604 | <br><small>Set image quality when uploading image.</small> |
  |  | 605 | </td> |
  |  | 606 | </tr> |
  |  | 607 | <tr> |
  |  | 608 | <th scope="row"><label for="ip\_upload\_size">Maximum image upload size<br><small>(in kilobytes)</small></label></th> |
  |  | 609 | <td> |
  |  | 610 | <input type="number" name="ip\_upload\_size" id="ip\_upload\_size" min="0" max="65536" step="1024" value="<?php echo intval( get\_imagepress\_option( 'ip\_upload\_size' ) ); ?>"> |
  |  | 611 | <br><small>Try 4096 for most configurations.</small> |
  |  | 612 | </td> |
  |  | 613 | </tr> |
  |  | 614 | <tr> |
  |  | 615 | <th scope="row"><label for="ip\_cat\_exclude">Exclude categories</label></th> |
  |  | 616 | <td> |
  |  | 617 | <input type="text" name="ip\_cat\_exclude" id="ip\_cat\_exclude" value="<?php echo esc\_attr( get\_imagepress\_option( 'ip\_cat\_exclude' ) ); ?>"> |
  |  | 618 | <br><small>Exclude these categories from the upload form (separate IDs with comma).</small> |
  |  | 619 | </td> |
  |  | 620 | </tr> |
  |  | 621 | <tr> |
  |  | 622 | <th scope="row"><label>Terms and conditions of use</label></th> |
  |  | 623 | <td> |
  |  | 624 | <select name="ip\_upload\_tos" id="ip\_upload\_tos"> |
  |  | 625 | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_upload\_tos' ) ) ); ?>>Enable terms and conditions</option> |
  |  | 626 | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_upload\_tos' ) ) ); ?>>Disable terms and conditions</option> |
  |  | 627 | </select> <label for="ip\_upload\_tos">Enable/disable terms and conditions of use</label> |
  |  | 628 | <br> |
  |  | 629 | <input type="text" name="ip\_upload\_tos\_content" id="ip\_upload\_tos\_content" class="regular-text" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_upload\_tos\_content' ) ); ?>" placeholder="I agree with the terms and conditions"> <label for="ip\_upload\_tos\_content">Terms and conditions of use body</label> |
  |  | 630 | <br> |
  |  | 631 | <input type="text" name="ip\_upload\_tos\_error" id="ip\_upload\_tos\_error" class="regular-text" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_upload\_tos\_error' ) ); ?>" placeholder="Please indicate that you accept the terms and conditions of use"> <label for="ip\_upload\_tos\_error">Terms and conditions of use error</label> |
  |  | 632 | <br> |
  |  | 633 | <input type="url" name="ip\_upload\_tos\_url" id="ip\_upload\_tos\_url" class="regular-text" value="<?php echo esc\_url( get\_imagepress\_option( 'ip\_upload\_tos\_url' ) ); ?>" placeholder="https://"> <label for="ip\_upload\_tos\_url">Terms and conditions of use URL</label> |
  |  | 634 | <br><small>Opens in new tab/window</small> |
  |  | 635 | </td> |
  |  | 636 | </tr> |
  |  | 637 | </tbody> |
  |  | 638 | </table> |
  |  | 639 |  |
  |  | 640 | <hr> |
  |  | 641 | <h2>Limits and Quotas</h2> |
  |  | 642 | <p> |
  |  | 643 | Set global and per-user upload limits.<br> |
  |  | 644 | Set individual limits for each user in their <a href="<?php echo esc\_url( admin\_url( 'users.php' ) ); ?>">profile editor</a>. Individual limits have higher priority than global limits. |
  |  | 645 | </p> |
  |  | 646 | <table class="form-table"> |
  |  | 647 | <tbody> |
  |  | 648 | <tr> |
  |  | 649 | <th scope="row"><label for="ip\_global\_upload\_limit">Maximum image upload limit</label></th> |
  |  | 650 | <td> |
  |  | 651 | <input type="number" name="ip\_global\_upload\_limit" id="ip\_global\_upload\_limit" min="0" max="999999" step="1" value="<?php echo intval( get\_imagepress\_option( 'ip\_global\_upload\_limit' ) ); ?>"> <label for="ip\_global\_upload\_limit">Image upload limit (global, if no other limits are specified)</label> |
  |  | 652 | <hr> |
  |  | 653 |  |
  |  | 654 | <p> |
  |  | 655 | <select name="ip\_quota\_action"> |
  |  | 656 | <option value="increase">Increase all users quota by</option> |
  |  | 657 | <option value="decrease">Decrease all users quota by</option> |
  |  | 658 | <option value="set">Set all users quota to</option> |
  |  | 659 | </select> <input name="ip\_quota\_increase" type="number" min="0" placeholder="0"> images |
  |  | 660 | <br><small>Note that setting a limit higher than the global limit will override it.</small> |
  |  | 661 | </p> |
  |  | 662 |  |
  |  | 663 | <hr> |
  |  | 664 | <textarea class="large-text" rows="4" id="ip\_global\_upload\_limit\_message" name="ip\_global\_upload\_limit\_message" placeholder="You have reached the maximum number of images allowed."><?php echo wp\_kses\_post( get\_imagepress\_option( 'ip\_global\_upload\_limit\_message' ) ); ?></textarea> |
  |  | 665 | <br><small>Set a message when maximum number of images is reached.</small> |
  |  | 666 | </td> |
  |  | 667 | </tr> |
  |  | 668 | </tbody> |
  |  | 669 | </table> |
  |  | 670 |  |
  |  | 671 | <hr> |
  |  | 672 |  |
  |  | 673 | <p><input type="submit" name="isGSSubmit" value="Save Changes" class="button-primary"></p> |
  |  | 674 | </form> |
  |  | 675 | <?php |
  | 603 | 676 | } |
  | 604 | 677 | ?> |
* ## [image-gallery/trunk/index.php](/changeset/3167164/image-gallery/trunk/index.php "Show the changeset 3167164 restricted to image-gallery/trunk/index.php")

  | [r1602018](/browser/image-gallery/trunk/index.php?rev=1602018#L1 "Show revision 1602018 of this file in browser") | [r3167164](/browser/image-gallery/trunk/index.php?rev=3167164#L1 "Show revision 3167164 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 |  | ~~#~~ Silence is golden. |
  |  | 2 | // Silence is golden. |
* ## [image-gallery/trunk/phpcs.xml](/changeset/3167164/image-gallery/trunk/phpcs.xml "Show the changeset 3167164 restricted to image-gallery/trunk/phpcs.xml")

  | [r3079508](/browser/image-gallery/trunk/phpcs.xml?rev=3079508#L34 "Show revision 3079508 of this file in browser") | [r3167164](/browser/image-gallery/trunk/phpcs.xml?rev=3167164#L34 "Show revision 3167164 of this file in browser") |  |
  | --- | --- | --- |
  | 34 | 34 | </rule> |
  | 35 | 35 | <rule ref="Generic.WhiteSpace.DisallowTabIndent" /> |
  |  | 36 |  |
  |  | 37 | <!-- Allow short syntax arrays. --> |
  |  | 38 | <rule ref="Generic.Arrays.DisallowLongArraySyntax"/> |
  |  | 39 |  |
  |  | 40 | <!-- Disallow long array syntax --> |
  |  | 41 | <rule ref="Generic.Arrays.DisallowShortArraySyntax.Found"> |
  |  | 42 | <exclude-pattern>\*</exclude-pattern> |
  |  | 43 | </rule> |
  |  | 44 | <rule ref="Universal.Arrays.DisallowShortArraySyntax.Found"> |
  |  | 45 | <exclude-pattern>\*</exclude-pattern> |
  |  | 46 | </rule> |
  | 36 | 47 | </ruleset> |
* ## [image-gallery/trunk/readme.txt](/changeset/3167164/image-gallery/trunk/readme.txt "Show the changeset 3167164 restricted to image-gallery/trunk/readme.txt")

  | [r3166568](/browser/image-gallery/trunk/readme.txt?rev=3166568#L5 "Show revision 3166568 of this file in browser") | [r3167164](/browser/image-gallery/trunk/readme.txt?rev=3167164#L5 "Show revision 3167164 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires at least: 4.9 |
  | 6 | 6 | Tested up to: 6.6.2 |
  | 7 |  | Stable tag: 1.~~2.2~~ |
  |  | 7 | Stable tag: 1.3.0 |
  | 8 | 8 | Requires PHP: 7.0 |
  | 9 | 9 | License: GPLv3 or later |
  | 10 | 10 | License URI: https://www.gnu.org/licenses/gpl-3.0.html |
  | 11 | 11 |  |
  | 12 |  | A simple, multi-user WordPress image gallery plugin with front-end upload. |
  |  | 12 | A simple, multi-user WordPress plugin with a list of advanced options for creating beautiful, responsive image gallery plugin with front-end upload. |
  | 13 | 13 |  |
  | 14 | 14 | == Description == |
  | […](/browser/image-gallery/trunk/readme.txt?rev=3166568#L52) | […](/browser/image-gallery/trunk/readme.txt?rev=3167164#L52) |  |
  | 52 | 52 |  |
  | 53 | 53 | == Changelog == |
  |  | 54 |  |
  |  | 55 | = 1.3.0 = |
  |  | 56 | \* FIX: Fix Authenticated (Administrator+) Stored Cross-Site Scripting via Plugin Settings CVE ID: CVE-2024-9776 (props 家桥 王) |
  |  | 57 | \* FIX: Fix Cross-Site Request Forgery to Plugin Settings Update CVE ID: CVE-2024-9778 (props Michelle Porter) |
  |  | 58 | \* FIX: Fix Missing Authorization to Authenticated (Subscriber+) Arbitrary Post Deletion and Post Title Update CVE ID: CVE-2024-9824 (props Michelle Porter) |
  | 54 | 59 |  |
  | 55 | 60 | = 1.2.2 = |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3167164)
* [Zip Archive](?format=zip&new=3167164)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_0407d1df_20250111_065953.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fimage-gallery%2Ftrunk%2Fincludes%2Fpage-settings.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/image-gallery/trunk/includes/page-settings.php?rev=3166568 "Revision 3166568")
* Next Revision →
* [Blame](/browser/image-gallery/trunk/includes/page-settings.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/image-gallery/trunk/includes/page-settings.php)

---

# [source:](/browser?order=name "Go to repository root") [image-gallery](/browser/image-gallery?order=name "View image-gallery")/[trunk](/browser/image-gallery/trunk?order=name "View trunk")/[includes](/browser/image-gallery/trunk/includes?order=name "View includes")/[page-settings.php](/browser/image-gallery/trunk/includes/page-settings.php?order=name "View page-settings.php")

View diff against:

View revision:

| [Last change](/changeset/3167164/image-gallery/trunk/includes/page-settings.php "View differences") on this file was [3167164](/changeset/3167164/ "View changeset 3167164"), checked in by butterflymedia, [3 months ago](/timeline?from=2024-10-11T12%3A39%3A31Z&precision=second "See timeline at 10/11/2024 12:39:31 PM") |
| --- |
| Fix 3 vulnerabillities reported via Wordfence |
| **File size:** 48.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | function imagepress\_admin\_page() { |
| [3](#L3) | ?> |
| [4](#L4) | <div class="wrap"> |
| [5](#L5) | <h1><b>ImagePress - Image Gallery</b> Settings</h1> |
| [6](#L6) |  |
| [7](#L7) | <?php |
| [8](#L8) | $ip\_slug = get\_imagepress\_option( 'ip\_slug' ); |
| [9](#L9) |  |
| [10](#L10) | $tab     = ( filter\_has\_var( INPUT\_GET, 'tab' ) ) ? filter\_input( INPUT\_GET, 'tab' ) : 'dashboard\_tab'; |
| [11](#L11) | $section = 'edit.php?post\_type=' . $ip\_slug . '&page=imagepress\_admin\_page&amp;tab='; |
| [12](#L12) | ?> |
| [13](#L13) | <h2 class="nav-tab-wrapper ip-nav-tab-wrapper"> |
| [14](#L14) | <a href="<?php echo esc\_attr( $section ); ?>dashboard\_tab" class="nav-tab <?php echo $tab === 'dashboard\_tab' ? 'nav-tab-active' : ''; ?>"><?php esc\_html\_e( 'Dashboard', 'image-gallery' ); ?></a> |
| [15](#L15) | <a href="<?php echo esc\_attr( $section ); ?>settings\_tab" class="nav-tab <?php echo $tab === 'settings\_tab' ? 'nav-tab-active' : ''; ?>"><?php esc\_html\_e( 'Settings', 'image-gallery' ); ?></a> |
| [16](#L16) | <a href="<?php echo esc\_attr( $section ); ?>configurator\_tab" class="nav-tab <?php echo $tab === 'configurator\_tab' ? 'nav-tab-active' : ''; ?>"><?php esc\_html\_e( 'Configurator', 'image-gallery' ); ?></a> |
| [17](#L17) |  |
| [18](#L18) | <a href="<?php echo esc\_attr( $section ); ?>label\_tab" class="nav-tab <?php echo $tab === 'label\_tab' ? 'nav-tab-active' : ''; ?>"><?php esc\_html\_e( 'Labels', 'image-gallery' ); ?></a> |
| [19](#L19) | <a href="<?php echo esc\_attr( $section ); ?>upload\_tab" class="nav-tab <?php echo $tab === 'upload\_tab' ? 'nav-tab-active' : ''; ?>"><?php esc\_html\_e( 'Upload', 'image-gallery' ); ?></a> |
| [20](#L20) | </h2> |
| [21](#L21) |  |
| [22](#L22) | <?php |
| [23](#L23) | if ( $tab === 'dashboard\_tab' ) { |
| [24](#L24) | global $wpdb; |
| [25](#L25) |  |
| [26](#L26) | // Get the WP built-in version |
| [27](#L27) | $ipdata = get\_plugin\_data( IP\_PLUGIN\_FILE\_PATH ); |
| [28](#L28) |  |
| [29](#L29) | echo '<div id="gb-ad"> |
| [30](#L30) | <h3 class="gb-handle">Thank you for using ImagePress - Image Gallery!</h3> |
| [31](#L31) | <div id="gb-ad-content"> |
| [32](#L32) | <div class="inside"> |
| [33](#L33) | <p>If you enjoy this plugin, get the <a href="https://getbutterfly.com/wordpress-plugins/imagepress/" rel="external">PRO version</a>! We work hard to update it, fix bugs, add new features and make it compatible with the latest web technologies.</p> |
| [34](#L34) | </div> |
| [35](#L35) | <div class="gb-footer"> |
| [36](#L36) | <p>For support, feature requests and bug reporting, please visit the <a href="https://getbutterfly.com/" rel="external">official website</a>.<br>&copy;' . esc\_attr( date\_i18n( 'Y' ) ) . ' <a href="https://getbutterfly.com/" rel="external"><strong>getButterfly</strong>.com</a> &middot; <a href="https://getbutterfly.com/support/documentation/imagepress/">Documentation</a> &middot; <small>Code wrangling since 2005</small></p> |
| [37](#L37) | </div> |
| [38](#L38) | </div> |
| [39](#L39) | </div> |
| [40](#L40) |  |
| [41](#L41) | <p> |
| [42](#L42) | <small>You are using <b>ImagePress - Image Gallery</b> plugin version <strong>' . esc\_attr( $ipdata['Version'] ) . '</strong>.</small><br> |
| [43](#L43) | <small>You are using PHP version ' . PHP\_VERSION . ' and MySQL server version ' . esc\_attr( $wpdb->db\_version() ) . '.</small> |
| [44](#L44) | </p> |
| [45](#L45) |  |
| [46](#L46) | <h2>Installation</h2> |
| [47](#L47) | <p>Check the installation steps below and make the required changes.</p>'; |
| [48](#L48) |  |
| [49](#L49) | $single\_template = 'single-' . $ip\_slug . '.php'; |
| [50](#L50) |  |
| [51](#L51) | echo '<div class="gb-assistant">'; |
| [52](#L52) |  |
| [53](#L53) | if ( (string) $ip\_slug === '' ) { |
| [54](#L54) | echo '<p><div class="dashicons dashicons-no"></div> <b>Error:</b> Your image slug is not set. Go to <b>Configurator</b> section and set it.</p>'; |
| [55](#L55) | } else { |
| [56](#L56) | echo '<p><div class="dashicons dashicons-yes"></div> <b>Note:</b> Your image slug is <code>' . esc\_attr( $ip\_slug ) . '</code>. If you changed it recently, visit your <b>Permalinks</b> section and resave the changes.</p>'; |
| [57](#L57) | } |
| [58](#L58) | if ( '' !== locate\_template( $single\_template ) ) { |
| [59](#L59) | echo '<p><div class="dashicons dashicons-yes"></div> <b>Note:</b> You have a custom image template available.</p>'; |
| [60](#L60) | } |
| [61](#L61) |  |
| [62](#L62) | echo '</div> |
| [63](#L63) |  |
| [64](#L64) | <div class="gb-assistant">'; |
| [65](#L65) |  |
| [66](#L66) | if ( get\_option( 'default\_role' ) === 'author' ) { |
| [67](#L67) | echo '<p><div class="dashicons dashicons-yes"></div> <b>Note:</b> New user default role is <code>author</code>. Subscribers and contributors are not able to edit their uploaded images.</p>'; |
| [68](#L68) | } else { |
| [69](#L69) | echo '<p><div class="dashicons dashicons-no"></div> <b>Error:</b> New user default role should be <code>author</code> in order to allow for front-end image editing. Subscribers and contributors are not able to edit their uploaded images. <a href="' . esc\_url( admin\_url( 'options-general.php' ) ) . '">Change it</a>.</p>'; |
| [70](#L70) | } |
| [71](#L71) |  |
| [72](#L72) | echo '</div>'; |
| [73](#L73) |  |
| [74](#L74) | echo '<h3>Shortcodes</h3> |
| [75](#L75) | <p> |
| [76](#L76) | <code>[imagepress-add]</code> - show the submission form.<br> |
| [77](#L77) | <code>[imagepress-add category="landscapes"]</code> - show the submission form with a fixed (hidden) category. Use the category <b>slug</b>.<br> |
| [78](#L78) | <code>[imagepress-loop]</code> - display all images.<br> |
| [79](#L79) | <code>[imagepress-loop user="7"]</code> - filter images by user ID.<br> |
| [80](#L80) | <code>[imagepress-loop count="4"]</code> - display a specific number of images.<br> |
| [81](#L81) | <code>[imagepress-loop filters="yes"]</code> - display all images with filters/sorters.<br> |
| [82](#L82) | <code>[imagepress-loop sort="views" count="10"]</code> - display images sorted by likes.<br> |
| [83](#L83) | <code>[imagepress-loop category="landscapes"]</code> - display all images in a specific category. Use the category <b>slug</b>.<br> |
| [84](#L84) | </p>'; |
| [85](#L85) | ?> |
| [86](#L86) | <h2><?php esc\_html\_e( 'ImagePress PRO', 'image-gallery' ); ?></h2> |
| [87](#L87) |  |
| [88](#L88) | <div style="display: grid; grid-template-columns: repeat(2, 1fr); grid-gap: 2em;"> |
| [89](#L89) | <div class="ip-card"> |
| [90](#L90) | <h3>What's included?</h3> |
| [91](#L91) |  |
| [92](#L92) | <ul class="feature-list--pro"> |
| [93](#L93) | <li><span class="dashicons dashicons-yes-alt"></span> Secondary uploads (additional images, variants, progress shots, making of, etc.)</li> |
| [94](#L94) | <li><span class="dashicons dashicons-yes-alt"></span> Additional styles and themes</li> |
| [95](#L95) | <li><span class="dashicons dashicons-yes-alt"></span> Collections</li> |
| [96](#L96) | <li><span class="dashicons dashicons-yes-alt"></span> Custom (user created) categories</li> |
| [97](#L97) | <li><span class="dashicons dashicons-yes-alt"></span> Keywords/tags</li> |
| [98](#L98) | <li><span class="dashicons dashicons-yes-alt"></span> Colour search</li> |
| [99](#L99) | <li><span class="dashicons dashicons-yes-alt"></span> Likes</li> |
| [100](#L100) | <li><span class="dashicons dashicons-yes-alt"></span> Followers</li> |
| [101](#L101) | <li><span class="dashicons dashicons-yes-alt"></span> User profiles</li> |
| [102](#L102) | <li><span class="dashicons dashicons-yes-alt"></span> And lots more!</li> |
| [103](#L103) | </ul> |
| [104](#L104) |  |
| [105](#L105) | <p> |
| [106](#L106) | <a href="https://getbutterfly.com/wordpress-plugins/imagepress/" rel="external noopener" class="button button-primary button-hero">Get ImagePress PRO!</a> |
| [107](#L107) | <a href="https://getbutterfly.com/wordpress-plugins/imagepress/" rel="external noopener" class="button button-secondary button-hero">ImagePress PRO Demo</a> |
| [108](#L108) | </p> |
| [109](#L109) | </div> |
| [110](#L110) | <div class="ip-card"> |
| [111](#L111) | <h3>What's optional?</h3> |
| [112](#L112) |  |
| [113](#L113) | <ul class="feature-list--pro--optional"> |
| [114](#L114) | <li><span class="dashicons dashicons-yes-alt"></span> Bulk (media library) upload</li> |
| [115](#L115) | <li><span class="dashicons dashicons-yes-alt"></span> Image pins (similar to Pinterest)</li> |
| [116](#L116) | <li><span class="dashicons dashicons-yes-alt"></span> Custom development and support</li> |
| [117](#L117) | <li><span class="dashicons dashicons-yes-alt"></span> And lots more!</li> |
| [118](#L118) | </ul> |
| [119](#L119) | </div> |
| [120](#L120) | </div> |
| [121](#L121) | <?php |
| [122](#L122) | } elseif ( $tab === 'configurator\_tab' ) { |
| [123](#L123) | if ( isset( $\_POST['isGSSubmit'] ) ) { |
| [124](#L124) | if ( ! isset( $\_POST['imagepress\_settings\_nonce'] ) || ! check\_admin\_referer( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ) ) { |
| [125](#L125) | wp\_die( esc\_html\_\_( 'Nonce verification failed. Please try again.', 'image-gallery' ) ); |
| [126](#L126) | } |
| [127](#L127) |  |
| [128](#L128) | $ip\_updated\_options = [ |
| [129](#L129) | 'ip\_box\_ui'          => isset( $\_POST['ip\_box\_ui'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_box\_ui'] ) ) : '', |
| [130](#L130) | 'ip\_grid\_ui'         => isset( $\_POST['ip\_grid\_ui'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_grid\_ui'] ) ) : '', |
| [131](#L131) | 'ip\_ipw'             => isset( $\_POST['ip\_ipw'] ) ? intval( $\_POST['ip\_ipw'] ) : 0, |
| [132](#L132) | 'ip\_ipp'             => isset( $\_POST['ip\_ipp'] ) ? intval( $\_POST['ip\_ipp'] ) : 0, |
| [133](#L133) | 'ip\_order'           => isset( $\_POST['ip\_order'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_order'] ) ) : '', |
| [134](#L134) | 'ip\_orderby'         => isset( $\_POST['ip\_orderby'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_orderby'] ) ) : '', |
| [135](#L135) | 'ip\_slug'            => isset( $\_POST['ip\_slug'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_slug'] ) ) : '', |
| [136](#L136) | 'ip\_image\_size'      => isset( $\_POST['ip\_image\_size'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_image\_size'] ) ) : '', |
| [137](#L137) | 'ip\_title\_optional'  => isset( $\_POST['ip\_title\_optional'] ) ? intval( $\_POST['ip\_title\_optional'] ) : 0, |
| [138](#L138) | 'ip\_meta\_optional'   => isset( $\_POST['ip\_meta\_optional'] ) ? intval( $\_POST['ip\_meta\_optional'] ) : 0, |
| [139](#L139) | 'ip\_views\_optional'  => isset( $\_POST['ip\_views\_optional'] ) ? intval( $\_POST['ip\_views\_optional'] ) : 0, |
| [140](#L140) | 'ip\_comments'        => isset( $\_POST['ip\_comments'] ) ? intval( $\_POST['ip\_comments'] ) : 0, |
| [141](#L141) | 'ip\_author\_optional' => isset( $\_POST['ip\_author\_optional'] ) ? intval( $\_POST['ip\_author\_optional'] ) : 0, |
| [142](#L142) | ]; |
| [143](#L143) | $ip\_options         = get\_option( 'imagepress' ); |
| [144](#L144) | $ip\_update          = array\_merge( $ip\_options, $ip\_updated\_options ); |
| [145](#L145) | update\_option( 'imagepress', $ip\_update ); |
| [146](#L146) |  |
| [147](#L147) | echo '<div class="updated notice is-dismissible"><p>Settings updated successfully!</p></div>'; |
| [148](#L148) | } |
| [149](#L149) | ?> |
| [150](#L150) | <form method="post" action=""> |
| [151](#L151) | <?php wp\_nonce\_field( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ); ?> |
| [152](#L152) |  |
| [153](#L153) | <h2><?php esc\_html\_e( 'Grid Configurator', 'image-gallery' ); ?></h2> |
| [154](#L154) | <p>The <b>Grid configurator</b> allows you to select which information will be visible inside the image box.</p> |
| [155](#L155) | <table class="form-table"> |
| [156](#L156) | <tbody> |
| [157](#L157) | <tr> |
| [158](#L158) | <th scope="row"><label>Image box appearance</label></th> |
| [159](#L159) | <td> |
| [160](#L160) | <select name="ip\_box\_ui" id="ip\_box\_ui"> |
| [161](#L161) | <option value="default" |
| [162](#L162) | <?php |
| [163](#L163) | if ( (string) get\_imagepress\_option( 'ip\_box\_ui' ) === 'default' ) { |
| [164](#L164) | echo ' selected';} |
| [165](#L165) | ?> |
| [166](#L166) | >Default</option> |
| [167](#L167) | <option value="overlay" |
| [168](#L168) | <?php |
| [169](#L169) | if ( (string) get\_imagepress\_option( 'ip\_box\_ui' ) === 'overlay' ) { |
| [170](#L170) | echo ' selected';} |
| [171](#L171) | ?> |
| [172](#L172) | >Overlay</option> |
| [173](#L173) | </select> |
| [174](#L174) | </td> |
| [175](#L175) | </tr> |
| [176](#L176) | <tr> |
| [177](#L177) | <th scope="row"><label>Image grid display</label></th> |
| [178](#L178) | <td> |
| [179](#L179) | <select name="ip\_grid\_ui" id="ip\_grid\_ui"> |
| [180](#L180) | <option value="basic" |
| [181](#L181) | <?php |
| [182](#L182) | if ( (string) get\_imagepress\_option( 'ip\_grid\_ui' ) === 'basic' ) { |
| [183](#L183) | echo ' selected';} |
| [184](#L184) | ?> |
| [185](#L185) | >Basic (no styling)</option> |
| [186](#L186) | <option value="default" |
| [187](#L187) | <?php |
| [188](#L188) | if ( (string) get\_imagepress\_option( 'ip\_grid\_ui' ) === 'default' ) { |
| [189](#L189) | echo ' selected';} |
| [190](#L190) | ?> |
| [191](#L191) | >Default (equal height containers)</option> |
| [192](#L192) | <option value="masonry" |
| [193](#L193) | <?php |
| [194](#L194) | if ( (string) get\_imagepress\_option( 'ip\_grid\_ui' ) === 'masonry' ) { |
| [195](#L195) | echo ' selected';} |
| [196](#L196) | ?> |
| [197](#L197) | >Masonry</option> |
| [198](#L198) | </select> |
| [199](#L199) | </td> |
| [200](#L200) | </tr> |
| [201](#L201) | <tr> |
| [202](#L202) | <th scope="row"><label>Image box details</label></th> |
| [203](#L203) | <td> |
| [204](#L204) | <p> |
| [205](#L205) | <input name="ip\_slug" id="slug" type="text" class="regular-text" placeholder="Image slug" value="<?php echo esc\_attr( get\_imagepress\_option( 'ip\_slug' ) ); ?>" required> <label for="ip\_slug"><b>Image</b> slug</label> |
| [206](#L206) | <br><small>Use an appropriate slug for your image (e.g. <b>image</b> in <code>domain.com/<b>image</b>/my-image-name/</code>).</small> |
| [207](#L207) | <br><small>Tip: use a singular term, one word only, lowercase, letters only (examples: image, poster, illustration).</small> |
| [208](#L208) | </p> |
| [209](#L209) | <p> |
| [210](#L210) | <select name="ip\_image\_size" id="ip\_image\_size"> |
| [211](#L211) | <optgroup label="WordPress (default)"> |
| [212](#L212) | <option value="thumbnail" |
| [213](#L213) | <?php |
| [214](#L214) | if ( (string) get\_imagepress\_option( 'ip\_image\_size' ) === 'thumbnail' ) { |
| [215](#L215) | echo ' selected';} |
| [216](#L216) | ?> |
| [217](#L217) | >Thumbnail</option> |
| [218](#L218) | <option value="medium" |
| [219](#L219) | <?php |
| [220](#L220) | if ( (string) get\_imagepress\_option( 'ip\_image\_size' ) === 'medium' ) { |
| [221](#L221) | echo ' selected';} |
| [222](#L222) | ?> |
| [223](#L223) | >Medium</option> |
| [224](#L224) | </optgroup> |
| [225](#L225) | <optgroup label="ImagePress (default)"> |
| [226](#L226) | <option value="imagepress\_sq\_std" |
| [227](#L227) | <?php |
| [228](#L228) | if ( (string) get\_imagepress\_option( 'ip\_image\_size' ) === 'imagepress\_sq\_std' ) { |
| [229](#L229) | echo ' selected';} |
| [230](#L230) | ?> |
| [231](#L231) | >Standard (Square)</option> |
| [232](#L232) | <option value="imagepress\_pt\_std" |
| [233](#L233) | <?php |
| [234](#L234) | if ( (string) get\_imagepress\_option( 'ip\_image\_size' ) === 'imagepress\_pt\_std' ) { |
| [235](#L235) | echo ' selected';} |
| [236](#L236) | ?> |
| [237](#L237) | >Standard (Portrait)</option> |
| [238](#L238) | <option value="imagepress\_ls\_std" |
| [239](#L239) | <?php |
| [240](#L240) | if ( (string) get\_imagepress\_option( 'ip\_image\_size' ) === 'imagepress\_ls\_std' ) { |
| [241](#L241) | echo ' selected';} |
| [242](#L242) | ?> |
| [243](#L243) | >Standard (Landscape)</option> |
| [244](#L244) | </optgroup> |
| [245](#L245) | <optgroup label="Other registered sizes (use with care)"> |
| [246](#L246) | <?php |
| [247](#L247) | $ip\_image\_size = get\_imagepress\_option( 'ip\_image\_size' ); |
| [248](#L248) | $thumbsize     = isset( $ip\_image\_size ) ? esc\_attr( $ip\_image\_size ) : ''; |
| [249](#L249) | $image\_sizes   = ip\_return\_image\_sizes(); |
| [250](#L250) | foreach ( $image\_sizes as $size => $atts ) { |
| [251](#L251) | if ( (int) $atts[0] !== 0 && (int) $atts[1] !== 0 ) { |
| [252](#L252) | ?> |
| [253](#L253) | <option value="<?php echo esc\_attr( $size ); ?>" <?php selected( $thumbsize, $size ); ?>><?php echo esc\_attr( $size ) . ' - ' . implode( 'x', array\_map( 'esc\_attr', $atts ) ); ?></option> |
| [254](#L254) | <?php |
| [255](#L255) | } |
| [256](#L256) | } |
| [257](#L257) | ?> |
| [258](#L258) | </optgroup> |
| [259](#L259) | </select> <label for="ip\_image\_size"><b>Image box</b> thumbnail size</label> |
| [260](#L260) | <br><small>Use <b>thumbnail</b>, adjust the column size to match your thumbnail size and hide the description in order to have uniform sizes</small> |
| [261](#L261) | </p> |
| [262](#L262) | <p> |
| [263](#L263) | <select name="ip\_title\_optional" id="ip\_title\_optional"> |
| [264](#L264) | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_title\_optional' ) ) ); ?>>Hide image title</option> |
| [265](#L265) | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_title\_optional' ) ) ); ?>>Show image title</option> |
| [266](#L266) | </select> |
| [267](#L267) | <label for="ip\_title\_optional">Show/hide image title</label> |
| [268](#L268) | </p> |
| [269](#L269) | <p> |
| [270](#L270) | <select name="ip\_meta\_optional" id="ip\_meta\_optional"> |
| [271](#L271) | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_meta\_optional' ) ) ); ?>>Hide image meta</option> |
| [272](#L272) | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_meta\_optional' ) ) ); ?>>Show image meta</option> |
| [273](#L273) | </select> |
| [274](#L274) | <label for="ip\_meta\_optional">Show/hide the image meta (category/taxonomy)</label> |
| [275](#L275) | </p> |
| [276](#L276) | <p> |
| [277](#L277) | <select name="ip\_views\_optional" id="ip\_views\_optional"> |
| [278](#L278) | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_views\_optional' ) ) ); ?>>Hide image views</option> |
| [279](#L279) | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_views\_optional' ) ) ); ?>>Show image views</option> |
| [280](#L280) | </select> |
| [281](#L281) | <label for="ip\_views\_optional">Show/hide the number of image views</label> |
| [282](#L282) | </p> |
| [283](#L283) | <p> |
| [284](#L284) | <select name="ip\_comments" id="ip\_comments"> |
| [285](#L285) | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_comments' ) ) ); ?>>Hide image comments</option> |
| [286](#L286) | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_comments' ) ) ); ?>>Show image comments</option> |
| [287](#L287) | </select> |
| [288](#L288) | <label for="ip\_comments">Show/hide the number of image comments</label> |
| [289](#L289) | </p> |
| [290](#L290) | <p> |
| [291](#L291) | <select name="ip\_author\_optional" id="ip\_author\_optional"> |
| [292](#L292) | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_author\_optional' ) ) ); ?>>Hide image author</option> |
| [293](#L293) | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_author\_optional' ) ) ); ?>>Show image author</option> |
| [294](#L294) | </select> |
| [295](#L295) | <label for="ip\_author\_optional">Show/hide the author name and link</label> |
| [296](#L296) | </p> |
| [297](#L297) | </td> |
| [298](#L298) | </tr> |
| [299](#L299) | </tbody> |
| [300](#L300) | </table> |
| [301](#L301) |  |
| [302](#L302) | <hr> |
| [303](#L303) | <h2>Grid Settings</h2> |
| [304](#L304) | <p>These settings apply globally for the image and author grid.</p> |
| [305](#L305) | <table class="form-table"> |
| [306](#L306) | <tbody> |
| [307](#L307) | <tr> |
| [308](#L308) | <th scope="row"><label>Image grid details</label></th> |
| [309](#L309) | <td> |
| [310](#L310) | <input name="ip\_ipw" id="ip\_ipw" type="number" value="<?php echo intval( get\_imagepress\_option( 'ip\_ipw' ) ); ?>" min="1" max="1024"> |
| [311](#L311) | <label for="ip\_ipw">Images per row (0-32)</label> |
| [312](#L312) | <br><small>Number of images per grid row.</small> |
| [313](#L313) | <br> |
| [314](#L314) |  |
| [315](#L315) | <input name="ip\_ipp" id="ip\_ipp" type="number" value="<?php echo intval( get\_imagepress\_option( 'ip\_ipp' ) ); ?>" min="1" max="65536"> |
| [316](#L316) | <label for="ip\_ipp">Images per page (0-256)</label> |
| [317](#L317) | <br><small>How many images per page you want to display using the <code>[imagepress-loop]</code> shortcode.</small> |
| [318](#L318) |  |
| [319](#L319) | <p> |
| [320](#L320) | <label for="ip\_order">Sort images</label> |
| [321](#L321) | <select name="ip\_order" id="ip\_order"> |
| [322](#L322) | <option value="ASC" <?php selected( 'ASC', get\_imagepress\_option( 'ip\_order' ) ); ?>>ASC</option> |
| [323](#L323) | <option value="DESC" <?php selected( 'DESC', get\_imagepress\_option( 'ip\_order' ) ); ?>>DESC</option> |
| [324](#L324) | </select> <label for="ip\_orderby">by</label> <select name="ip\_orderby" id="ip\_orderby"> |
| [325](#L325) | <option value="none" <?php selected( 'none', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>none</option> |
| [326](#L326) | <option value="ID" <?php selected( 'ID', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>ID</option> |
| [327](#L327) | <option value="author" <?php selected( 'author', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>author</option> |
| [328](#L328) | <option value="title" <?php selected( 'title', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>title</option> |
| [329](#L329) | <option value="name" <?php selected( 'name', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>name</option> |
| [330](#L330) | <option value="date" <?php selected( 'date', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>date</option> |
| [331](#L331) | <option value="rand" <?php selected( 'rand', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>rand</option> |
| [332](#L332) | <option value="comment\_count" <?php selected( 'comment\_count', get\_imagepress\_option( 'ip\_orderby' ) ); ?>>comment\_count</option> |
| [333](#L333) | </select> |
| [334](#L334) | </p> |
| [335](#L335) | </td> |
| [336](#L336) | </tr> |
| [337](#L337) | </tbody> |
| [338](#L338) | </table> |
| [339](#L339) |  |
| [340](#L340) | <hr> |
| [341](#L341) | <p><input type="submit" name="isGSSubmit" value="Save Changes" class="button-primary"></p> |
| [342](#L342) | </form> |
| [343](#L343) | <?php |
| [344](#L344) | } elseif ( $tab === 'settings\_tab' ) { |
| [345](#L345) | if ( isset( $\_POST['isGSSubmit'] ) ) { |
| [346](#L346) | if ( ! isset( $\_POST['imagepress\_settings\_nonce'] ) || ! check\_admin\_referer( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ) ) { |
| [347](#L347) | wp\_die( esc\_html\_\_( 'Nonce verification failed. Please try again.', 'image-gallery' ) ); |
| [348](#L348) | } |
| [349](#L349) |  |
| [350](#L350) | $ip\_updated\_options = [ |
| [351](#L351) | 'ip\_moderate'               => isset( $\_POST['ip\_moderate'] ) ? intval( $\_POST['ip\_moderate'] ) : 0, |
| [352](#L352) | 'ip\_registration'           => isset( $\_POST['ip\_registration'] ) ? intval( $\_POST['ip\_registration'] ) : 0, |
| [353](#L353) | 'ip\_click\_behaviour'        => isset( $\_POST['ip\_click\_behaviour'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_click\_behaviour'] ) ) : '', |
| [354](#L354) | 'ip\_cat\_moderation\_include' => isset( $\_POST['ip\_cat\_moderation\_include'] ) ? intval( $\_POST['ip\_cat\_moderation\_include'] ) : 0, |
| [355](#L355) | 'ip\_upload\_redirection'     => isset( $\_POST['ip\_upload\_redirection'] ) ? sanitize\_url( wp\_unslash( $\_POST['ip\_upload\_redirection'] ) ) : '', |
| [356](#L356) | 'ip\_delete\_redirection'     => isset( $\_POST['ip\_delete\_redirection'] ) ? sanitize\_url( wp\_unslash( $\_POST['ip\_delete\_redirection'] ) ) : '', |
| [357](#L357) | 'ip\_notification\_email'     => isset( $\_POST['ip\_notification\_email'] ) ? sanitize\_email( wp\_unslash( $\_POST['ip\_notification\_email'] ) ) : '', |
| [358](#L358) | 'approvednotification'      => isset( $\_POST['approvednotification'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['approvednotification'] ) ) : '', |
| [359](#L359) | 'declinednotification'      => isset( $\_POST['declinednotification'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['declinednotification'] ) ) : '', |
| [360](#L360) | ]; |
| [361](#L361) | $ip\_options         = get\_option( 'imagepress' ); |
| [362](#L362) | $ip\_update          = array\_merge( $ip\_options, $ip\_updated\_options ); |
| [363](#L363) | update\_option( 'imagepress', $ip\_update ); |
| [364](#L364) |  |
| [365](#L365) | echo '<div class="updated notice is-dismissible"><p>Settings updated successfully!</p></div>'; |
| [366](#L366) | } |
| [367](#L367) | ?> |
| [368](#L368) | <form method="post" action=""> |
| [369](#L369) | <?php wp\_nonce\_field( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ); ?> |
| [370](#L370) |  |
| [371](#L371) | <h2>General Settings</h2> |
| [372](#L372) | <p>These settings apply globally for all ImagePress users.</p> |
| [373](#L373) | <table class="form-table"> |
| [374](#L374) | <tbody> |
| [375](#L375) | <tr> |
| [376](#L376) | <th scope="row"><label for="ip\_registration">User registration</label></th> |
| [377](#L377) | <td> |
| [378](#L378) | <select name="ip\_registration" id="ip\_registration"> |
| [379](#L379) | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_registration' ) ) ); ?>>Require user registration (recommended)</option> |
| [380](#L380) | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_registration' ) ) ); ?>>Do not require user registration</option> |
| [381](#L381) | </select> |
| [382](#L382) | <br><small>Require users to be registered and logged in to upload images (recommended).</small> |
| [383](#L383) | </td> |
| [384](#L384) | </tr> |
| [385](#L385) | <tr> |
| [386](#L386) | <th scope="row"><label for="ip\_click\_behaviour">Image behaviour</label></th> |
| [387](#L387) | <td> |
| [388](#L388) | <select name="ip\_click\_behaviour" id="ip\_click\_behaviour"> |
| [389](#L389) | <option value="media" <?php selected( 'media', get\_imagepress\_option( 'ip\_click\_behaviour' ) ); ?>>Open media (image)</option> |
| [390](#L390) | <option value="custom" <?php selected( 'custom', get\_imagepress\_option( 'ip\_click\_behaviour' ) ); ?>>Open image page</option> |
| [391](#L391) | </select> |
| [392](#L392) | <br><small>What to open when clicking on an image (single image or custom post template).</small> |
| [393](#L393) | </td> |
| [394](#L394) | </tr> |
| [395](#L395) | <tr> |
| [396](#L396) | <th scope="row"><label for="ip\_moderate">Image moderation</label></th> |
| [397](#L397) | <td> |
| [398](#L398) | <select name="ip\_moderate" id="ip\_moderate"> |
| [399](#L399) | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_moderate' ) ) ); ?>>Moderate all images (recommended)</option> |
| [400](#L400) | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_moderate' ) ) ); ?>>Do not moderate images</option> |
| [401](#L401) | </select> |
| [402](#L402) | <br><small>Moderate all submitted images (recommended).</small> |
| [403](#L403) | </td> |
| [404](#L404) | </tr> |
| [405](#L405) | <tr> |
| [406](#L406) | <th scope="row"><label for="ip\_cat\_moderation\_include">Moderate entries in this category</label></th> |
| [407](#L407) | <td> |
| [408](#L408) | <input type="number" name="ip\_cat\_moderation\_include" id="ip\_cat\_moderation\_include" value="<?php echo intval( get\_imagepress\_option( 'ip\_cat\_moderation\_include' ) ); ?>"> |
| [409](#L409) | <br><small>Always moderate entries in this category (use category ID).</small> |
| [410](#L410) | </td> |
| [411](#L411) | </tr> |
| [412](#L412) | </tbody> |
| [413](#L413) | </table> |
| [414](#L414) |  |
| [415](#L415) | <hr> |
| [416](#L416) | <h2>Redirection</h2> |
| [417](#L417) | <p>Optionally redirect users to various pages after image submission/removal. Examples are: a thank you page, a confirmation page, a payment page, a newsletter page or another call to action.</p> |
| [418](#L418) | <table class="form-table"> |
| [419](#L419) | <tbody> |
| [420](#L420) | <tr> |
| [421](#L421) | <th scope="row"><label for="ip\_upload\_redirection">Upload redirect</label></th> |
| [422](#L422) | <td> |
| [423](#L423) | <input type="url" name="ip\_upload\_redirection" id="ip\_upload\_redirection" placeholder="https://" class="regular-text" value="<?php echo esc\_url( get\_imagepress\_option( 'ip\_upload\_redirection' ) ); ?>"> |
| [424](#L424) | <br><small>Redirect users to this page after image upload (optional, leave blank to disable).</small> |
| [425](#L425) | </td> |
| [426](#L426) | </tr> |
| [427](#L427) | <tr> |
| [428](#L428) | <th scope="row"><label for="ip\_delete\_redirection">Delete redirect</label></th> |
| [429](#L429) | <td> |
| [430](#L430) | <input type="url" name="ip\_delete\_redirection" id="ip\_delete\_redirection" placeholder="https://" class="regular-text" value="<?php echo esc\_url( get\_imagepress\_option( 'ip\_delete\_redirection' ) ); ?>"> |
| [431](#L431) | <br><small>Redirect users to this page after image deletion (optional, leave blank to disable).</small> |
| [432](#L432) | </td> |
| [433](#L433) | </tr> |
| [434](#L434) | </tbody> |
| [435](#L435) | </table> |
| [436](#L436) |  |
| [437](#L437) | <hr> |
| [438](#L438) | <h2>Email Settings</h2> |
| [439](#L439) | <table class="form-table"> |
| [440](#L440) | <tbody> |
| [441](#L441) | <tr> |
| [442](#L442) | <th scope="row"><label for="ip\_notification\_email">Administrator email<br><small>(used for new image notification)</small></label></th> |
| [443](#L443) | <td> |
| [444](#L444) | <input type="text" name="ip\_notification\_email" id="ip\_notification\_email" value="<?php echo esc\_attr( get\_imagepress\_option( 'ip\_notification\_email' ) ); ?>" class="regular-text"> |
| [445](#L445) | <br><small>The administrator will receive an email notification each time a new image is uploaded.</small> |
| [446](#L446) | <br><small>Separate multiple addresses with comma.</small> |
| [447](#L447) | </td> |
| [448](#L448) | </tr> |
| [449](#L449) | <tr> |
| [450](#L450) | <th scope="row"><label>Email Settings</label></th> |
| [451](#L451) | <td> |
| [452](#L452) | <p> |
| [453](#L453) | <input type="checkbox" id="approvednotification" name="approvednotification" value="yes" <?php checked( 'yes', get\_imagepress\_option( 'approvednotification' ) ); ?>> <label for="approvednotification">Notify author when image is approved</label> |
| [454](#L454) | <br> |
| [455](#L455) | <input type="checkbox" id="declinednotification" name="declinednotification" value="yes" <?php checked( 'yes', get\_imagepress\_option( 'declinednotification' ) ); ?>> <label for="declinednotification">Notify author when image is rejected</label> |
| [456](#L456) | </p> |
| [457](#L457) | </td> |
| [458](#L458) | </tr> |
| [459](#L459) | </tbody> |
| [460](#L460) | </table> |
| [461](#L461) |  |
| [462](#L462) | <hr> |
| [463](#L463) | <p><input type="submit" name="isGSSubmit" value="Save Changes" class="button-primary"></p> |
| [464](#L464) | </form> |
| [465](#L465) | <?php |
| [466](#L466) | } elseif ( $tab === 'label\_tab' ) { |
| [467](#L467) | if ( isset( $\_POST['isGSSubmit'] ) ) { |
| [468](#L468) | if ( ! isset( $\_POST['imagepress\_settings\_nonce'] ) || ! check\_admin\_referer( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ) ) { |
| [469](#L469) | wp\_die( esc\_html\_\_( 'Nonce verification failed. Please try again.', 'image-gallery' ) ); |
| [470](#L470) | } |
| [471](#L471) |  |
| [472](#L472) | $ip\_updated\_options = [ |
| [473](#L473) | 'ip\_caption\_label'        => isset( $\_POST['ip\_caption\_label'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_caption\_label'] ) ) : '', |
| [474](#L474) | 'ip\_category\_label'       => isset( $\_POST['ip\_category\_label'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_category\_label'] ) ) : '', |
| [475](#L475) | 'ip\_description\_label'    => isset( $\_POST['ip\_description\_label'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_description\_label'] ) ) : '', |
| [476](#L476) | 'ip\_upload\_label'         => isset( $\_POST['ip\_upload\_label'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_upload\_label'] ) ) : '', |
| [477](#L477) | 'ip\_image\_label'          => isset( $\_POST['ip\_image\_label'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_image\_label'] ) ) : '', |
| [478](#L478) | 'ip\_upload\_success\_title' => isset( $\_POST['ip\_upload\_success\_title'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_upload\_success\_title'] ) ) : '', |
| [479](#L479) | 'ip\_upload\_success'       => isset( $\_POST['ip\_upload\_success'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_upload\_success'] ) ) : '', |
| [480](#L480) | ]; |
| [481](#L481) | $ip\_options         = get\_option( 'imagepress' ); |
| [482](#L482) | $ip\_update          = array\_merge( $ip\_options, $ip\_updated\_options ); |
| [483](#L483) | update\_option( 'imagepress', $ip\_update ); |
| [484](#L484) |  |
| [485](#L485) | echo '<div class="updated notice is-dismissible"><p>Settings updated successfully!</p></div>'; |
| [486](#L486) | } |
| [487](#L487) | ?> |
| [488](#L488) | <form method="post" action=""> |
| [489](#L489) | <?php wp\_nonce\_field( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ); ?> |
| [490](#L490) |  |
| [491](#L491) | <h2><?php esc\_html\_e( 'Label Settings', 'image-gallery' ); ?></h2> |
| [492](#L492) | <p><?php esc\_html\_e( 'Configure, set or translate any of ImagePress labels. Leave a label blank to disable/hide it.', 'image-gallery' ); ?></p> |
| [493](#L493) | <table class="form-table"> |
| [494](#L494) | <tbody> |
| [495](#L495) | <tr> |
| [496](#L496) | <th scope="row"><label for="ip\_caption\_label">Image caption label<br><small>Leave blank to disable</small></label></th> |
| [497](#L497) | <td> |
| [498](#L498) | <input type="text" name="ip\_caption\_label" id="ip\_caption\_label" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_caption\_label' ) ); ?>" class="regular-text"> |
| [499](#L499) | </td> |
| [500](#L500) | </tr> |
| [501](#L501) | <tr> |
| [502](#L502) | <th scope="row"><label for="ip\_category\_label">Image category label<br><small>(dropdown)</small></label></th> |
| [503](#L503) | <td> |
| [504](#L504) | <input type="text" name="ip\_category\_label" id="ip\_category\_label" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_category\_label' ) ); ?>" class="regular-text"> |
| [505](#L505) | </td> |
| [506](#L506) | </tr> |
| [507](#L507) | <tr> |
| [508](#L508) | <th scope="row"><label for="ip\_description\_label">Image description label<br><small>(textarea)<br>Leave blank to disable</small></label></th> |
| [509](#L509) | <td> |
| [510](#L510) | <input type="text" name="ip\_description\_label" id="ip\_description\_label" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_description\_label' ) ); ?>" class="regular-text"> |
| [511](#L511) | </td> |
| [512](#L512) | </tr> |
| [513](#L513) | <tr> |
| [514](#L514) | <th scope="row"><label for="ip\_upload\_label">Image upload button label<br><small>(button)</small></label></th> |
| [515](#L515) | <td> |
| [516](#L516) | <input type="text" name="ip\_upload\_label" id="ip\_upload\_label" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_upload\_label' ) ); ?>" class="regular-text"> |
| [517](#L517) | </td> |
| [518](#L518) | </tr> |
| [519](#L519) | <tr> |
| [520](#L520) | <th scope="row"><label for="ip\_image\_label">Image upload selection label<br><small>(link)</small></label></th> |
| [521](#L521) | <td> |
| [522](#L522) | <input type="text" name="ip\_image\_label" id="ip\_image\_label" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_image\_label' ) ); ?>" class="regular-text"> |
| [523](#L523) | </td> |
| [524](#L524) | </tr> |
| [525](#L525) | </tbody> |
| [526](#L526) | </table> |
| [527](#L527) |  |
| [528](#L528) | <hr> |
| [529](#L529) | <h2><?php esc\_html\_e( 'Image Upload', 'image-gallery' ); ?></h2> |
| [530](#L530) | <p>This text will appear when the image upload is successful. Leave blank to disable.</p> |
| [531](#L531) | <table class="form-table"> |
| [532](#L532) | <tbody> |
| [533](#L533) | <tr> |
| [534](#L534) | <th scope="row"><label for="ip\_upload\_success\_title">Upload success title</label></th> |
| [535](#L535) | <td> |
| [536](#L536) | <input type="text" name="ip\_upload\_success\_title" id="ip\_upload\_success\_title" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_upload\_success\_title' ) ); ?>" class="regular-text"> |
| [537](#L537) | </td> |
| [538](#L538) | </tr> |
| [539](#L539) | <tr> |
| [540](#L540) | <th scope="row"><label for="ip\_upload\_success">Upload success</label></th> |
| [541](#L541) | <td> |
| [542](#L542) | <input type="text" name="ip\_upload\_success" id="ip\_upload\_success" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_upload\_success' ) ); ?>" class="regular-text"> |
| [543](#L543) | </td> |
| [544](#L544) | </tr> |
| [545](#L545) | </tbody> |
| [546](#L546) | </table> |
| [547](#L547) |  |
| [548](#L548) | <hr> |
| [549](#L549) | <p><input type="submit" name="isGSSubmit" value="Save Changes" class="button-primary"></p> |
| [550](#L550) | </form> |
| [551](#L551) | <?php |
| [552](#L552) | } elseif ( $tab === 'upload\_tab' ) { |
| [553](#L553) | if ( isset( $\_POST['isGSSubmit'] ) ) { |
| [554](#L554) | if ( ! isset( $\_POST['imagepress\_settings\_nonce'] ) || ! check\_admin\_referer( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ) ) { |
| [555](#L555) | wp\_die( esc\_html\_\_( 'Nonce verification failed. Please try again.', 'image-gallery' ) ); |
| [556](#L556) | } |
| [557](#L557) |  |
| [558](#L558) | $ip\_updated\_options = [ |
| [559](#L559) | 'ip\_upload\_tos'                  => isset( $\_POST['ip\_upload\_tos'] ) ? intval( $\_POST['ip\_upload\_tos'] ) : 0, |
| [560](#L560) | 'ip\_upload\_tos\_url'              => isset( $\_POST['ip\_upload\_tos\_url'] ) ? sanitize\_url( wp\_unslash( $\_POST['ip\_upload\_tos\_url'] ) ) : '', |
| [561](#L561) | 'ip\_upload\_tos\_error'            => isset( $\_POST['ip\_upload\_tos\_error'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_upload\_tos\_error'] ) ) : '', |
| [562](#L562) | 'ip\_upload\_tos\_content'          => isset( $\_POST['ip\_upload\_tos\_content'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_upload\_tos\_content'] ) ) : '', |
| [563](#L563) | 'ip\_upload\_size'                 => isset( $\_POST['ip\_upload\_size'] ) ? intval( $\_POST['ip\_upload\_size'] ) : 0, |
| [564](#L564) | 'ip\_global\_upload\_limit'         => isset( $\_POST['ip\_global\_upload\_limit'] ) ? intval( $\_POST['ip\_global\_upload\_limit'] ) : 0, |
| [565](#L565) | 'ip\_global\_upload\_limit\_message' => isset( $\_POST['ip\_global\_upload\_limit\_message'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_global\_upload\_limit\_message'] ) ) : '', |
| [566](#L566) | 'ip\_cat\_exclude'                 => isset( $\_POST['ip\_cat\_exclude'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['ip\_cat\_exclude'] ) ) : '', |
| [567](#L567) | 'ip\_max\_quality'                 => isset( $\_POST['ip\_max\_quality'] ) ? intval( $\_POST['ip\_max\_quality'] ) : 0, |
| [568](#L568) | ]; |
| [569](#L569) | $ip\_options         = get\_option( 'imagepress' ); |
| [570](#L570) | $ip\_update          = array\_merge( $ip\_options, $ip\_updated\_options ); |
| [571](#L571) | update\_option( 'imagepress', $ip\_update ); |
| [572](#L572) |  |
| [573](#L573) | if ( isset( $\_POST['ip\_quota\_increase'] ) && intval( $\_POST['ip\_quota\_increase'] ) > 0 ) { |
| [574](#L574) | $ip\_users          = get\_users(); |
| [575](#L575) | $ip\_quota\_increase = intval( $\_POST['ip\_quota\_increase'] ); |
| [576](#L576) |  |
| [577](#L577) | foreach ( $ip\_users as $user ) { |
| [578](#L578) | $quota = (int) get\_the\_author\_meta( 'ip\_upload\_limit', $user->ID ); |
| [579](#L579) |  |
| [580](#L580) | if ( isset( $\_POST['ip\_quota\_action'] ) && sanitize\_text\_field( wp\_unslash( $\_POST['ip\_quota\_action'] ) ) === 'increase' ) { |
| [581](#L581) | update\_user\_meta( $user->ID, 'ip\_upload\_limit', $quota + $ip\_quota\_increase ); |
| [582](#L582) | } elseif ( isset( $\_POST['ip\_quota\_action'] ) && sanitize\_text\_field( wp\_unslash( $\_POST['ip\_quota\_action'] ) ) === 'decrease' ) { |
| [583](#L583) | update\_user\_meta( $user->ID, 'ip\_upload\_limit', $quota - $ip\_quota\_increase ); |
| [584](#L584) | } elseif ( isset( $\_POST['ip\_quota\_action'] ) && sanitize\_text\_field( wp\_unslash( $\_POST['ip\_quota\_action'] ) ) === 'set' ) { |
| [585](#L585) | update\_user\_meta( $user->ID, 'ip\_upload\_limit', $ip\_quota\_increase ); |
| [586](#L586) | } |
| [587](#L587) | } |
| [588](#L588) | } |
| [589](#L589) |  |
| [590](#L590) | echo '<div class="updated notice is-dismissible"><p>Users quota increased successfully!</p></div>'; |
| [591](#L591) | echo '<div class="updated notice is-dismissible"><p>Settings updated successfully!</p></div>'; |
| [592](#L592) | } |
| [593](#L593) | ?> |
| [594](#L594) | <form method="post" action=""> |
| [595](#L595) | <?php wp\_nonce\_field( 'save\_imagepress\_settings\_action', 'imagepress\_settings\_nonce' ); ?> |
| [596](#L596) |  |
| [597](#L597) | <h2><?php esc\_html\_e( 'Upload Settings', 'image-gallery' ); ?></h2> |
| [598](#L598) | <table class="form-table"> |
| [599](#L599) | <tbody> |
| [600](#L600) | <tr> |
| [601](#L601) | <th scope="row"><label for="ip\_max\_quality">Image quality</label></th> |
| [602](#L602) | <td> |
| [603](#L603) | <input name="ip\_max\_quality" id="ip\_max\_quality" type="number" value="<?php echo intval( get\_imagepress\_option( 'ip\_max\_quality' ) ); ?>" min="0" max="100"> |
| [604](#L604) | <br><small>Set image quality when uploading image.</small> |
| [605](#L605) | </td> |
| [606](#L606) | </tr> |
| [607](#L607) | <tr> |
| [608](#L608) | <th scope="row"><label for="ip\_upload\_size">Maximum image upload size<br><small>(in kilobytes)</small></label></th> |
| [609](#L609) | <td> |
| [610](#L610) | <input type="number" name="ip\_upload\_size" id="ip\_upload\_size" min="0" max="65536" step="1024" value="<?php echo intval( get\_imagepress\_option( 'ip\_upload\_size' ) ); ?>"> |
| [611](#L611) | <br><small>Try 4096 for most configurations.</small> |
| [612](#L612) | </td> |
| [613](#L613) | </tr> |
| [614](#L614) | <tr> |
| [615](#L615) | <th scope="row"><label for="ip\_cat\_exclude">Exclude categories</label></th> |
| [616](#L616) | <td> |
| [617](#L617) | <input type="text" name="ip\_cat\_exclude" id="ip\_cat\_exclude" value="<?php echo esc\_attr( get\_imagepress\_option( 'ip\_cat\_exclude' ) ); ?>"> |
| [618](#L618) | <br><small>Exclude these categories from the upload form (separate IDs with comma).</small> |
| [619](#L619) | </td> |
| [620](#L620) | </tr> |
| [621](#L621) | <tr> |
| [622](#L622) | <th scope="row"><label>Terms and conditions of use</label></th> |
| [623](#L623) | <td> |
| [624](#L624) | <select name="ip\_upload\_tos" id="ip\_upload\_tos"> |
| [625](#L625) | <option value="1" <?php selected( 1, intval( get\_imagepress\_option( 'ip\_upload\_tos' ) ) ); ?>>Enable terms and conditions</option> |
| [626](#L626) | <option value="0" <?php selected( 0, intval( get\_imagepress\_option( 'ip\_upload\_tos' ) ) ); ?>>Disable terms and conditions</option> |
| [627](#L627) | </select> <label for="ip\_upload\_tos">Enable/disable terms and conditions of use</label> |
| [628](#L628) | <br> |
| [629](#L629) | <input type="text" name="ip\_upload\_tos\_content" id="ip\_upload\_tos\_content" class="regular-text" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_upload\_tos\_content' ) ); ?>" placeholder="I agree with the terms and conditions"> <label for="ip\_upload\_tos\_content">Terms and conditions of use body</label> |
| [630](#L630) | <br> |
| [631](#L631) | <input type="text" name="ip\_upload\_tos\_error" id="ip\_upload\_tos\_error" class="regular-text" value="<?php echo esc\_html( get\_imagepress\_option( 'ip\_upload\_tos\_error' ) ); ?>" placeholder="Please indicate that you accept the terms and conditions of use"> <label for="ip\_upload\_tos\_error">Terms and conditions of use error</label> |
| [632](#L632) | <br> |
| [633](#L633) | <input type="url" name="ip\_upload\_tos\_url" id="ip\_upload\_tos\_url" class="regular-text" value="<?php echo esc\_url( get\_imagepress\_option( 'ip\_upload\_tos\_url' ) ); ?>" placeholder="https://"> <label for="ip\_upload\_tos\_url">Terms and conditions of use URL</label> |
| [634](#L634) | <br><small>Opens in new tab/window</small> |
| [635](#L635) | </td> |
| [636](#L636) | </tr> |
| [637](#L637) | </tbody> |
| [638](#L638) | </table> |
| [639](#L639) |  |
| [640](#L640) | <hr> |
| [641](#L641) | <h2>Limits and Quotas</h2> |
| [642](#L642) | <p> |
| [643](#L643) | Set global and per-user upload limits.<br> |
| [644](#L644) | Set individual limits for each user in their <a href="<?php echo esc\_url( admin\_url( 'users.php' ) ); ?>">profile editor</a>. Individual limits have higher priority than global limits. |
| [645](#L645) | </p> |
| [646](#L646) | <table class="form-table"> |
| [647](#L647) | <tbody> |
| [648](#L648) | <tr> |
| [649](#L649) | <th scope="row"><label for="ip\_global\_upload\_limit">Maximum image upload limit</label></th> |
| [650](#L650) | <td> |
| [651](#L651) | <input type="number" name="ip\_global\_upload\_limit" id="ip\_global\_upload\_limit" min="0" max="999999" step="1" value="<?php echo intval( get\_imagepress\_option( 'ip\_global\_upload\_limit' ) ); ?>"> <label for="ip\_global\_upload\_limit">Image upload limit (global, if no other limits are specified)</label> |
| [652](#L652) | <hr> |
| [653](#L653) |  |
| [654](#L654) | <p> |
| [655](#L655) | <select name="ip\_quota\_action"> |
| [656](#L656) | <option value="increase">Increase all users quota by</option> |
| [657](#L657) | <option value="decrease">Decrease all users quota by</option> |
| [658](#L658) | <option value="set">Set all users quota to</option> |
| [659](#L659) | </select> <input name="ip\_quota\_increase" type="number" min="0" placeholder="0"> images |
| [660](#L660) | <br><small>Note that setting a limit higher than the global limit will override it.</small> |
| [661](#L661) | </p> |
| [662](#L662) |  |
| [663](#L663) | <hr> |
| [664](#L664) | <textarea class="large-text" rows="4" id="ip\_global\_upload\_limit\_message" name="ip\_global\_upload\_limit\_message" placeholder="You have reached the maximum number of images allowed."><?php echo wp\_kses\_post( get\_imagepress\_option( 'ip\_global\_upload\_limit\_message' ) ); ?></textarea> |
| [665](#L665) | <br><small>Set a message when maximum number of images is reached.</small> |
| [666](#L666) | </td> |
| [667](#L667) | </tr> |
| [668](#L668) | </tbody> |
| [669](#L669) | </table> |
| [670](#L670) |  |
| [671](#L671) | <hr> |
| [672](#L672) |  |
| [673](#L673) | <p><input type="submit" name="isGSSubmit" value="Save Changes" class="button-primary"></p> |
| [674](#L674) | </form> |
| [675](#L675) | <?php |
| [676](#L676) | } |
| [677](#L677) | ?> |
| [678](#L678) | </div> |
| [679](#L679) | <?php |
| [680](#L680) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/image-gallery/trunk/includes/page-settings.php?format=txt)
* [Original Format](/export/3220596/image-gallery/trunk/includes/page-settings.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


