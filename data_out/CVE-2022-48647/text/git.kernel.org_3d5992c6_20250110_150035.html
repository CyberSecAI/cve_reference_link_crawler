

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5f623a77cfc2d501d72bcb4f9ee71721e6c766ff)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5f623a77cfc2d501d72bcb4f9ee71721e6c766ff)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5f623a77cfc2d501d72bcb4f9ee71721e6c766ff)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f623a77cfc2d501d72bcb4f9ee71721e6c766ff)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Íñigo Huguet <ihuguet@redhat.com> | 2022-09-14 12:36:48 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-09-28 11:32:15 +0200 |
| commit | [5f623a77cfc2d501d72bcb4f9ee71721e6c766ff](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5f623a77cfc2d501d72bcb4f9ee71721e6c766ff) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5f623a77cfc2d501d72bcb4f9ee71721e6c766ff)) | |
| tree | [6623098ecffcfedcbf0953066ab0d82c86e11c8d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5f623a77cfc2d501d72bcb4f9ee71721e6c766ff) | |
| parent | [b6bea8101f9777d8e9c2d26b4fd5d737c044af9c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b6bea8101f9777d8e9c2d26b4fd5d737c044af9c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f623a77cfc2d501d72bcb4f9ee71721e6c766ff&id2=b6bea8101f9777d8e9c2d26b4fd5d737c044af9c)) | |
| download | [linux-5f623a77cfc2d501d72bcb4f9ee71721e6c766ff.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5f623a77cfc2d501d72bcb4f9ee71721e6c766ff.tar.gz) | |

sfc: fix TX channel offset when using legacy interrupts[ Upstream commit f232af4295653afa4ade3230462b3be15ad16419 ]
In legacy interrupt mode the tx\_channel\_offset was hardcoded to 1, but
that's not correct if efx\_sepparate\_tx\_channels is false. In that case,
the offset is 0 because the tx queues are in the single existing channel
at index 0, together with the rx queue.
Without this fix, as soon as you try to send any traffic, it tries to
get the tx queues from an uninitialized channel getting these errors:
WARNING: CPU: 1 PID: 0 at drivers/net/ethernet/sfc/tx.c:540 efx\_hard\_start\_xmit+0x12e/0x170 [sfc]
[...]
RIP: 0010:efx\_hard\_start\_xmit+0x12e/0x170 [sfc]
[...]
Call Trace:
<IRQ>
dev\_hard\_start\_xmit+0xd7/0x230
sch\_direct\_xmit+0x9f/0x360
\_\_dev\_queue\_xmit+0x890/0xa40
[...]
BUG: unable to handle kernel NULL pointer dereference at 0000000000000020
[...]
RIP: 0010:efx\_hard\_start\_xmit+0x153/0x170 [sfc]
[...]
Call Trace:
<IRQ>
dev\_hard\_start\_xmit+0xd7/0x230
sch\_direct\_xmit+0x9f/0x360
\_\_dev\_queue\_xmit+0x890/0xa40
[...]
Fixes: c308dfd1b43e ("sfc: fix wrong tx channel offset with efx\_separate\_tx\_channels")
Reported-by: Tianhao Zhao <tizhao@redhat.com>
Signed-off-by: Íñigo Huguet <ihuguet@redhat.com>
Acked-by: Edward Cree <ecree.xilinx@gmail.com>
Link: [https://lore.kernel.org/r/20220914103648.16902-1-ihuguet@redhat.com](https://lore.kernel.org/r/20220914103648.16902-1-ihuguet%40redhat.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f623a77cfc2d501d72bcb4f9ee71721e6c766ff)

| -rw-r--r-- | [drivers/net/ethernet/sfc/efx\_channels.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/sfc/efx_channels.c?id=5f623a77cfc2d501d72bcb4f9ee71721e6c766ff) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/sfc/efx\_channels.c b/drivers/net/ethernet/sfc/efx\_channels.cindex 032b8c0bd78890..5b4d661ab98679 100644--- a/[drivers/net/ethernet/sfc/efx\_channels.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/sfc/efx_channels.c?id=b6bea8101f9777d8e9c2d26b4fd5d737c044af9c)+++ b/[drivers/net/ethernet/sfc/efx\_channels.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/sfc/efx_channels.c?id=5f623a77cfc2d501d72bcb4f9ee71721e6c766ff)@@ -319,7 +319,7 @@ int efx\_probe\_interrupts(struct efx\_nic \*efx) efx->n\_channels = 1 + (efx\_separate\_tx\_channels ? 1 : 0); efx->n\_rx\_channels = 1; efx->n\_tx\_channels = 1;- efx->tx\_channel\_offset = 1;+ efx->tx\_channel\_offset = efx\_separate\_tx\_channels ? 1 : 0; efx->n\_xdp\_channels = 0; efx->xdp\_channel\_offset = efx->n\_channels; efx->legacy\_irq = efx->pci\_dev->irq; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:59:12 +0000

