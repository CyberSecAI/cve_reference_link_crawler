

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0b4a5d1e15ce72f69be48f38dc0401dab890ae0f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0b4a5d1e15ce72f69be48f38dc0401dab890ae0f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0b4a5d1e15ce72f69be48f38dc0401dab890ae0f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0b4a5d1e15ce72f69be48f38dc0401dab890ae0f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | John Keeping <john@metanate.com> | 2021-12-14 19:10:09 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-22 09:32:44 +0100 |
| commit | [0b4a5d1e15ce72f69be48f38dc0401dab890ae0f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0b4a5d1e15ce72f69be48f38dc0401dab890ae0f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0b4a5d1e15ce72f69be48f38dc0401dab890ae0f)) | |
| tree | [030a58fa575bfb395636af9a52a99f6161cd5091](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0b4a5d1e15ce72f69be48f38dc0401dab890ae0f) | |
| parent | [feb116a0ecc5625d6532c616d9a10ef4ef81514b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=feb116a0ecc5625d6532c616d9a10ef4ef81514b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0b4a5d1e15ce72f69be48f38dc0401dab890ae0f&id2=feb116a0ecc5625d6532c616d9a10ef4ef81514b)) | |
| download | [linux-0b4a5d1e15ce72f69be48f38dc0401dab890ae0f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0b4a5d1e15ce72f69be48f38dc0401dab890ae0f.tar.gz) | |

net: stmmac: dwmac-rk: fix oob read in rk\_gmac\_setup[ Upstream commit 0546b224cc7717cc8a2db076b0bb069a9c430794 ]
KASAN reports an out-of-bounds read in rk\_gmac\_setup on the line:
while (ops->regs[i]) {
This happens for most platforms since the regs flexible array member is
empty, so the memory after the ops structure is being read here. It
seems that mostly this happens to contain zero anyway, so we get lucky
and everything still works.
To avoid adding redundant data to nearly all the ops structures, add a
new flag to indicate whether the regs field is valid and avoid this loop
when it is not.
Fixes: 3bb3d6b1c195 ("net: stmmac: Add RK3566/RK3568 SoC support")
Signed-off-by: John Keeping <john@metanate.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0b4a5d1e15ce72f69be48f38dc0401dab890ae0f)

| -rw-r--r-- | [drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c?id=0b4a5d1e15ce72f69be48f38dc0401dab890ae0f) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c b/drivers/net/ethernet/stmicro/stmmac/dwmac-rk.cindex 6924a6aacbd53c..c469abc91fa1b0 100644--- a/[drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c?id=feb116a0ecc5625d6532c616d9a10ef4ef81514b)+++ b/[drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/stmicro/stmmac/dwmac-rk.c?id=0b4a5d1e15ce72f69be48f38dc0401dab890ae0f)@@ -33,6 +33,7 @@ struct rk\_gmac\_ops { void (\*set\_rgmii\_speed)(struct rk\_priv\_data \*bsp\_priv, int speed); void (\*set\_rmii\_speed)(struct rk\_priv\_data \*bsp\_priv, int speed); void (\*integrated\_phy\_powerup)(struct rk\_priv\_data \*bsp\_priv);+ bool regs\_valid; u32 regs[]; }; @@ -1092,6 +1093,7 @@ static const struct rk\_gmac\_ops rk3568\_ops = { .set\_to\_rmii = rk3568\_set\_to\_rmii, .set\_rgmii\_speed = rk3568\_set\_gmac\_speed, .set\_rmii\_speed = rk3568\_set\_gmac\_speed,+ .regs\_valid = true, .regs = { 0xfe2a0000, /\* gmac0 \*/ 0xfe010000, /\* gmac1 \*/@@ -1383,7 +1385,7 @@ static struct rk\_priv\_data \*rk\_gmac\_setup(struct platform\_device \*pdev, \* to be distinguished. \*/ res = platform\_get\_resource(pdev, IORESOURCE\_MEM, 0);- if (res) {+ if (res && ops->regs\_valid) { int i = 0;  while (ops->regs[i]) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:59:45 +0000

