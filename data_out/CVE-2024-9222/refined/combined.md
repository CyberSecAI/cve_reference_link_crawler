=== Content from www.wordfence.com_66a73a81_20250111_123631.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Paid Membership Subscriptions – Effortless Memberships, Recurring Payments & Content Restriction <= 2.12.8 - Reflected Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Paid Membership Subscriptions – Effortless Memberships, Recurring Payments & Content Restriction <= 2.12.8 - Reflected Cross-Site Scripting

6.1

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-9222](https://www.cve.org/CVERecord?id=CVE-2024-9222) |
| --- | --- |
| CVSS | 6.1 (Medium) |
| Publicly Published | October 1, 2024 |
| Last Updated | October 2, 2024 |
| Researcher | [Colin Xu](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/colin-xu) |

### Description

The Paid Membership Subscriptions – Effortless Memberships, Recurring Payments & Content Restriction plugin for WordPress is vulnerable to Reflected Cross-Site Scripting due to the use of add\_query\_arg without appropriate escaping on the URL in all versions up to, and including, 2.12.8. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that execute if they can successfully trick a user into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/paid-member-subscriptions/tags/2.12.8/includes/admin/class-admin-payments-list-table.php#L155)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3160323/#file10)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpaid-member-subscriptions%2Fpaid-membership-subscriptions-effortless-memberships-recurring-payments-content-restriction-2128-reflected-cross-site-scripting&t=Paid%20Membership%20Subscriptions%20%E2%80%93%20Effortless%20Memberships%2C%20Recurring%20Payments%20%26%20Content%20Restriction%20%3C%3D%202.12.8%20-%20Reflected%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpaid-member-subscriptions%2Fpaid-membership-subscriptions-effortless-memberships-recurring-payments-content-restriction-2128-reflected-cross-site-scripting&text=Paid%20Membership%20Subscriptions%20%E2%80%93%20Effortless%20Memberships%2C%20Recurring%20Payments%20%26%20Content%20Restriction%20%3C%3D%202.12.8%20-%20Reflected%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpaid-member-subscriptions%2Fpaid-membership-subscriptions-effortless-memberships-recurring-payments-content-restriction-2128-reflected-cross-site-scripting "LinkedIn")
Email

## Vulnerability Details for Paid Membership Subscriptions – Effortless Memberships, Recurring Payments & Content Restriction

#### [Paid Membership Subscriptions – Effortless Memberships, Recurring Payments & Content Restriction](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/paid-member-subscriptions)

| Software Type | Plugin |
| --- | --- |
| Software Slug | paid-member-subscriptions [(view on wordpress.org)](https://wordpress.org/plugins/paid-member-subscriptions) |
| Patched? | Yes |
| Remediation | Update to version 2.12.9, or a newer patched version |
| Affected Version | * <= 2.12.8 |
| Patched Version | * 2.12.9 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_516b1b5f_20250111_123630.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3160323)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3160322 "Changeset 3160322")
* [Next Changeset](/changeset/3160324 "Changeset 3160324") →

---

# Changeset 3160323

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/01/2024 07:54:43 AM
([3 months](/timeline?from=2024-10-01T07%3A54%3A43Z&precision=second "See timeline at 10/01/2024 07:54:43 AM") ago)

Author:
raster02
Message:

tagging version 2.12.9

Location:
[paid-member-subscriptions](/browser/paid-member-subscriptions?rev=3160323)
Files:

60 edited
1 copied

* [tags/2.12.9](/browser/paid-member-subscriptions/tags/2.12.9?rev=3160323 "Show entry in browser")
  (copied)
  *(copied from [paid-member-subscriptions/trunk](/browser/paid-member-subscriptions/trunk?rev=3149295 "Show original file (revision 3160321)"))*
* [tags/2.12.9/assets/js/admin/meta-box-subscription-details.js](/browser/paid-member-subscriptions/tags/2.12.9/assets/js/admin/meta-box-subscription-details.js?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [tags/2.12.9/extend/tutor-lms/class-pms-tutor-lms.php](/browser/paid-member-subscriptions/tags/2.12.9/extend/tutor-lms/class-pms-tutor-lms.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [tags/2.12.9/includes/admin/class-admin-dashboard.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-dashboard.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [tags/2.12.9/includes/admin/class-admin-export.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-export.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [tags/2.12.9/includes/admin/class-admin-member-payments-list-table.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-member-payments-list-table.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [tags/2.12.9/includes/admin/class-admin-member-subscription-list-table.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-member-subscription-list-table.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [tags/2.12.9/includes/admin/class-admin-members-add-new-bulk-list-table.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-add-new-bulk-list-table.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))
* [tags/2.12.9/includes/admin/class-admin-members-list-table.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-list-table.php?rev=3160323 "Show entry in browser")
  (modified)
  ([5 diffs](#file8 "Show differences"))
* [tags/2.12.9/includes/admin/class-admin-members.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members.php?rev=3160323 "Show entry in browser")
  (modified)
  ([3 diffs](#file9 "Show differences"))
* [tags/2.12.9/includes/admin/class-admin-payments-list-table.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments-list-table.php?rev=3160323 "Show entry in browser")
  (modified)
  ([4 diffs](#file10 "Show differences"))
* [tags/2.12.9/includes/admin/class-admin-payments.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments.php?rev=3160323 "Show entry in browser")
  (modified)
  ([2 diffs](#file11 "Show differences"))
* [tags/2.12.9/includes/admin/class-admin-setup-wizard.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-setup-wizard.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file12 "Show differences"))
* [tags/2.12.9/includes/admin/class-admin-subscription-plans.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-subscription-plans.php?rev=3160323 "Show entry in browser")
  (modified)
  ([6 diffs](#file13 "Show differences"))
* [tags/2.12.9/includes/admin/class-edd-sl-plugin-updater.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-edd-sl-plugin-updater.php?rev=3160323 "Show entry in browser")
  (modified)
  ([3 diffs](#file14 "Show differences"))
* [tags/2.12.9/includes/admin/functions-admin.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/functions-admin.php?rev=3160323 "Show entry in browser")
  (modified)
  ([2 diffs](#file15 "Show differences"))
* [tags/2.12.9/includes/admin/views/view-page-addons.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-addons.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file16 "Show differences"))
* [tags/2.12.9/includes/admin/views/view-page-basic-info.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-basic-info.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file17 "Show differences"))
* [tags/2.12.9/includes/admin/views/view-page-settings-content\_restriction.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-settings-content_restriction.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file18 "Show differences"))
* [tags/2.12.9/includes/functions-content-restriction.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-content-restriction.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file19 "Show differences"))
* [tags/2.12.9/includes/functions-member-subscriptions.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-member-subscriptions.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file20 "Show differences"))
* [tags/2.12.9/includes/functions-member.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-member.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file21 "Show differences"))
* [tags/2.12.9/includes/functions-payment.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-payment.php?rev=3160323 "Show entry in browser")
  (modified)
  ([2 diffs](#file22 "Show differences"))
* [tags/2.12.9/includes/functions-plugin-notifications.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-plugin-notifications.php?rev=3160323 "Show entry in browser")
  (modified)
  ([5 diffs](#file23 "Show differences"))
* [tags/2.12.9/includes/functions-user-roles.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-user-roles.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file24 "Show differences"))
* [tags/2.12.9/includes/gateways/paypal\_standard/functions-paypal-standard.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/gateways/paypal_standard/functions-paypal-standard.php?rev=3160323 "Show entry in browser")
  (modified)
  ([2 diffs](#file25 "Show differences"))
* [tags/2.12.9/includes/gateways/stripe/admin/functions-admin-connect.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/admin/functions-admin-connect.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file26 "Show differences"))
* [tags/2.12.9/includes/gateways/stripe/assets/front-end-connect.js](/browser/paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/assets/front-end-connect.js?rev=3160323 "Show entry in browser")
  (modified)
  ([4 diffs](#file27 "Show differences"))
* [tags/2.12.9/includes/gateways/stripe/class-payment-gateway-stripe-connect.php](/browser/paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/class-payment-gateway-stripe-connect.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file28 "Show differences"))
* [tags/2.12.9/index.php](/browser/paid-member-subscriptions/tags/2.12.9/index.php?rev=3160323 "Show entry in browser")
  (modified)
  ([4 diffs](#file29 "Show differences"))
* [tags/2.12.9/readme.txt](/browser/paid-member-subscriptions/tags/2.12.9/readme.txt?rev=3160323 "Show entry in browser")
  (modified)
  ([3 diffs](#file30 "Show differences"))
* [trunk/assets/js/admin/meta-box-subscription-details.js](/browser/paid-member-subscriptions/trunk/assets/js/admin/meta-box-subscription-details.js?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file31 "Show differences"))
* [trunk/extend/tutor-lms/class-pms-tutor-lms.php](/browser/paid-member-subscriptions/trunk/extend/tutor-lms/class-pms-tutor-lms.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file32 "Show differences"))
* [trunk/includes/admin/class-admin-dashboard.php](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-dashboard.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file33 "Show differences"))
* [trunk/includes/admin/class-admin-export.php](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-export.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file34 "Show differences"))
* [trunk/includes/admin/class-admin-member-payments-list-table.php](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-member-payments-list-table.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file35 "Show differences"))
* [trunk/includes/admin/class-admin-member-subscription-list-table.php](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-member-subscription-list-table.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file36 "Show differences"))
* [trunk/includes/admin/class-admin-members-add-new-bulk-list-table.php](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-add-new-bulk-list-table.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file37 "Show differences"))
* [trunk/includes/admin/class-admin-members-list-table.php](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=3160323 "Show entry in browser")
  (modified)
  ([5 diffs](#file38 "Show differences"))
* [trunk/includes/admin/class-admin-members.php](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members.php?rev=3160323 "Show entry in browser")
  (modified)
  ([3 diffs](#file39 "Show differences"))
* [trunk/includes/admin/class-admin-payments-list-table.php](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3160323 "Show entry in browser")
  (modified)
  ([4 diffs](#file40 "Show differences"))
* [trunk/includes/admin/class-admin-payments.php](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments.php?rev=3160323 "Show entry in browser")
  (modified)
  ([2 diffs](#file41 "Show differences"))
* [trunk/includes/admin/class-admin-setup-wizard.php](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-setup-wizard.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file42 "Show differences"))
* [trunk/includes/admin/class-admin-subscription-plans.php](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3160323 "Show entry in browser")
  (modified)
  ([6 diffs](#file43 "Show differences"))
* [trunk/includes/admin/class-edd-sl-plugin-updater.php](/browser/paid-member-subscriptions/trunk/includes/admin/class-edd-sl-plugin-updater.php?rev=3160323 "Show entry in browser")
  (modified)
  ([3 diffs](#file44 "Show differences"))
* [trunk/includes/admin/functions-admin.php](/browser/paid-member-subscriptions/trunk/includes/admin/functions-admin.php?rev=3160323 "Show entry in browser")
  (modified)
  ([2 diffs](#file45 "Show differences"))
* [trunk/includes/admin/views/view-page-addons.php](/browser/paid-member-subscriptions/trunk/includes/admin/views/view-page-addons.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file46 "Show differences"))
* [trunk/includes/admin/views/view-page-basic-info.php](/browser/paid-member-subscriptions/trunk/includes/admin/views/view-page-basic-info.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file47 "Show differences"))
* [trunk/includes/admin/views/view-page-settings-content\_restriction.php](/browser/paid-member-subscriptions/trunk/includes/admin/views/view-page-settings-content_restriction.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file48 "Show differences"))
* [trunk/includes/functions-content-restriction.php](/browser/paid-member-subscriptions/trunk/includes/functions-content-restriction.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file49 "Show differences"))
* [trunk/includes/functions-member-subscriptions.php](/browser/paid-member-subscriptions/trunk/includes/functions-member-subscriptions.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file50 "Show differences"))
* [trunk/includes/functions-member.php](/browser/paid-member-subscriptions/trunk/includes/functions-member.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file51 "Show differences"))
* [trunk/includes/functions-payment.php](/browser/paid-member-subscriptions/trunk/includes/functions-payment.php?rev=3160323 "Show entry in browser")
  (modified)
  ([2 diffs](#file52 "Show differences"))
* [trunk/includes/functions-plugin-notifications.php](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3160323 "Show entry in browser")
  (modified)
  ([5 diffs](#file53 "Show differences"))
* [trunk/includes/functions-user-roles.php](/browser/paid-member-subscriptions/trunk/includes/functions-user-roles.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file54 "Show differences"))
* [trunk/includes/gateways/paypal\_standard/functions-paypal-standard.php](/browser/paid-member-subscriptions/trunk/includes/gateways/paypal_standard/functions-paypal-standard.php?rev=3160323 "Show entry in browser")
  (modified)
  ([2 diffs](#file55 "Show differences"))
* [trunk/includes/gateways/stripe/admin/functions-admin-connect.php](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/admin/functions-admin-connect.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file56 "Show differences"))
* [trunk/includes/gateways/stripe/assets/front-end-connect.js](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js?rev=3160323 "Show entry in browser")
  (modified)
  ([4 diffs](#file57 "Show differences"))
* [trunk/includes/gateways/stripe/class-payment-gateway-stripe-connect.php](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/class-payment-gateway-stripe-connect.php?rev=3160323 "Show entry in browser")
  (modified)
  ([1 diff](#file58 "Show differences"))
* [trunk/index.php](/browser/paid-member-subscriptions/trunk/index.php?rev=3160323 "Show entry in browser")
  (modified)
  ([4 diffs](#file59 "Show differences"))
* [trunk/readme.txt](/browser/paid-member-subscriptions/trunk/readme.txt?rev=3160323 "Show entry in browser")
  (modified)
  ([3 diffs](#file60 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [paid-member-subscriptions/tags/2.12.9/assets/js/admin/meta-box-subscription-details.js](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/assets/js/admin/meta-box-subscription-details.js "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/assets/js/admin/meta-box-subscription-details.js")

  | [r3127842](/browser/paid-member-subscriptions/trunk/assets/js/admin/meta-box-subscription-details.js?rev=3127842#L26 "Show revision 3127842 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/assets/js/admin/meta-box-subscription-details.js?rev=3160323#L26 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 26 | 26 |  |
  | 27 | 27 | alert( 'Subscription Plan duration must be a whole number.' ); |
  |  | 28 |  |
  |  | 29 | return false; |
  |  | 30 | } |
  |  | 31 |  |
  |  | 32 | var subscription\_plan\_price = $('#pms-subscription-plan-price').val().trim(); |
  |  | 33 |  |
  |  | 34 | if( parseFloat( subscription\_plan\_price ) < 1 ) { |
  |  | 35 |  |
  |  | 36 | alert( 'Subscription Plan price must be at least 1.' ); |
  | 28 | 37 |  |
  | 29 | 38 | return false; |
* ## [paid-member-subscriptions/tags/2.12.9/extend/tutor-lms/class-pms-tutor-lms.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/extend/tutor-lms/class-pms-tutor-lms.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/extend/tutor-lms/class-pms-tutor-lms.php")

  | [r3093002](/browser/paid-member-subscriptions/trunk/extend/tutor-lms/class-pms-tutor-lms.php?rev=3093002#L1089 "Show revision 3093002 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/extend/tutor-lms/class-pms-tutor-lms.php?rev=3160323#L1089 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 1089 | 1089 | $message .= '<p style="margin-top: 16px;">' . wp\_kses\_post( '<strong>Tutor LMS Integration</strong> for <strong>Paid Member Subscriptions</strong> is now available!<br><br>Sell access to courses, create beautiful front-end register, login and reset password forms and restrict access to your Courses.<br>Enable by selecting <strong>Paid Member Subscriptions</strong> as the eCommerce Engine in <a href="'. esc\_url( admin\_url( 'admin.php?page=tutor\_settings&tab\_page=monetization' ) ) .'">Tutor LMS --> Settings --> Monetization</a>.' ) . '</p>'; |
  | 1090 | 1090 | $message .= '<p><a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/integration-with-other-plugins/tutor-lms/?utm\_source=wpbackend&utm\_medium=pms-documentation&utm\_campaign=PMSDocs" class="button-primary" target="\_blank">' . esc\_html\_\_( 'Learn More', 'paid-member-subscriptions' ) . '</a></p>'; |
  | 1091 |  | $message .= '<a href="' . esc\_url( ~~add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id )~~ ) ) . '" type="button" class="notice-dismiss" style="text-decoration: none;"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  |  | 1091 | $message .= '<a href="' . esc\_url( wp\_nonce\_url( add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id ) ), 'pms\_plugin\_notice\_dismiss' ) ) . '" type="button" class="notice-dismiss" style="text-decoration: none;"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  | 1092 | 1092 |  |
  | 1093 | 1093 | pms\_add\_plugin\_notification( $notification\_id, $message, 'pms-notice pms-narrow notice notice-success', true, array( 'pms-addons-page' ) ); |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-dashboard.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-dashboard.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-dashboard.php")

  | [r2995200](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-dashboard.php?rev=2995200#L99 "Show revision 2995200 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-dashboard.php?rev=3160323#L99 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 99 | 99 | public function get\_dashboard\_stats(){ |
  | 100 | 100 | check\_admin\_referer( 'pms\_dashboard\_get\_stats' ); |
  |  | 101 |  |
  |  | 102 | if( !current\_user\_can( 'manage\_options' ) ) |
  |  | 103 | die(); |
  | 101 | 104 |  |
  | 102 | 105 | if( empty( $\_POST['interval'] ) ) |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-export.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-export.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-export.php")

  | [r2569272](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-export.php?rev=2569272#L99 "Show revision 2569272 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-export.php?rev=3160323#L99 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 99 | 99 | ) ); |
  | 100 | 100 |  |
  | 101 |  | $download\_url = ~~add\_query\_arg( $args, admin\_url(~~) ); |
  |  | 101 | $download\_url = esc\_url( add\_query\_arg( $args, admin\_url() ) ); |
  | 102 | 102 |  |
  | 103 | 103 | echo json\_encode( array( 'step' => 'done', 'url' => $download\_url ) ); exit; |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-member-payments-list-table.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-member-payments-list-table.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-member-payments-list-table.php")

  | [r2939341](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-member-payments-list-table.php?rev=2939341#L174 "Show revision 2939341 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-member-payments-list-table.php?rev=3160323#L174 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 174 | 174 | public function column\_actions( $item ) { |
  | 175 | 175 |  |
  | 176 |  | $actions = '<a class="button-secondary" href="' . ~~add\_query\_arg( array( 'page' => 'pms-payments-page', 'pms-action' => 'edit\_payment', 'payment\_id' => $item['actions'] ), admin\_url( 'admin.php'~~ ) ) . '">' . \_\_( 'View Details', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 176 | $actions = '<a class="button-secondary" href="' . esc\_url( add\_query\_arg( array( 'page' => 'pms-payments-page', 'pms-action' => 'edit\_payment', 'payment\_id' => $item['actions'] ), admin\_url( 'admin.php' ) ) ) . '">' . \_\_( 'View Details', 'paid-member-subscriptions' ) . '</a>'; |
  | 177 | 177 |  |
  | 178 | 178 | return apply\_filters( 'pms\_member\_payments\_list\_table\_actions', $actions, $item ); |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-member-subscription-list-table.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-member-subscription-list-table.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-member-subscription-list-table.php")

  | [r2835897](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-member-subscription-list-table.php?rev=2835897#L334 "Show revision 2835897 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-member-subscription-list-table.php?rev=3160323#L334 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 334 | 334 | $output = '<div class="row-actions">'; |
  | 335 | 335 |  |
  | 336 |  | $output .= '<a href="' . ~~add\_query\_arg( array( 'page' => 'pms-members-page', 'subpage' => 'edit\_subscription', 'subscription\_id' => $item['subscription\_id'] ), 'admin.php'~~ ) . '" class="button button-secondary">' . \_\_( 'Edit', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 336 | $output .= '<a href="' . esc\_url( add\_query\_arg( array( 'page' => 'pms-members-page', 'subpage' => 'edit\_subscription', 'subscription\_id' => $item['subscription\_id'] ), 'admin.php' ) ) . '" class="button button-secondary">' . \_\_( 'Edit', 'paid-member-subscriptions' ) . '</a>'; |
  | 337 | 337 |  |
  | 338 | 338 | $output = apply\_filters( 'pms\_member\_subscription\_list\_table\_column\_actions', $output, $item ); |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-add-new-bulk-list-table.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-add-new-bulk-list-table.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-add-new-bulk-list-table.php")

  | [r2962413](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-add-new-bulk-list-table.php?rev=2962413#L368 "Show revision 2962413 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-add-new-bulk-list-table.php?rev=3160323#L368 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 368 | 368 |  |
  | 369 | 369 | // Add an edit user action for each member |
  | 370 |  | $actions['view\_user'] = '<a href="' . ~~add\_query\_arg( array( 'user\_id' => $item['user\_id']), admin\_url('user-edit.php'~~) ) . '">' . esc\_html\_\_( 'Edit User', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 370 | $actions['view\_user'] = '<a href="' . esc\_url( add\_query\_arg( array( 'user\_id' => $item['user\_id']), admin\_url('user-edit.php') ) ) . '">' . esc\_html\_\_( 'Edit User', 'paid-member-subscriptions' ) . '</a>'; |
  | 371 | 371 |  |
  | 372 | 372 | // Return value saved for username and also the row actions |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-list-table.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-list-table.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-list-table.php")

  | [r2799943](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=2799943#L191 "Show revision 2799943 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-list-table.php?rev=3160323#L191 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 191 | 191 |  |
  | 192 | 192 | return apply\_filters( 'pms\_members\_list\_table\_get\_views', array( |
  | 193 |  | 'all'       => '<a href="' . ~~remove\_query\_arg( array( 'pms-view', 'paged'~~ ) ) . '" ' . ( !isset( $\_GET['pms-view'] ) ? 'class="current"' : '' ) . '>All <span class="count">(' . ( isset( $this->views\_count['all'] ) ? $this->views\_count['all'] : '' ) . ')</span></a>', |
  | 194 |  | 'active'    => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'active', 'paged' => 1~~ ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'active' ? 'class="current"' : '' ) . '>Active <span class="count">(' . ( isset( $this->views\_count['active'] ) ? $this->views\_count['active'] : '' ) . ')</span></a>', |
  | 195 |  | 'canceled'  => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'canceled', 'paged' => 1~~ ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'canceled' ? 'class="current"' : '' ) . '>Canceled <span class="count">(' . ( isset( $this->views\_count['canceled'] ) ? $this->views\_count['canceled'] : '' ) . ')</span></a>', |
  | 196 |  | 'expired'   => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'expired', 'paged' => 1~~ ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'expired' ? 'class="current"' : '' ) . '>Expired <span class="count">(' . ( isset( $this->views\_count['expired'] ) ? $this->views\_count['expired'] : '' ) . ')</span></a>', |
  | 197 |  | 'pending'   => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'pending', 'paged' => 1~~ ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'pending' ? 'class="current"' : '' ) . '>Pending <span class="count">(' . ( isset( $this->views\_count['pending'] ) ? $this->views\_count['pending'] : '' ) . ')</span></a>', |
  | 198 |  | 'abandoned' => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'abandoned', 'paged' => 1~~ ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'abandoned' ? 'class="current"' : '' ) . '>Abandoned <span class="count">(' . ( isset( $this->views\_count['abandoned'] ) ? $this->views\_count['abandoned'] : '' ) . ')</span></a>', |
  |  | 193 | 'all'       => '<a href="' . esc\_url( remove\_query\_arg( array( 'pms-view', 'paged' ) ) ) . '" ' . ( !isset( $\_GET['pms-view'] ) ? 'class="current"' : '' ) . '>All <span class="count">(' . ( isset( $this->views\_count['all'] ) ? $this->views\_count['all'] : '' ) . ')</span></a>', |
  |  | 194 | 'active'    => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'active', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'active' ? 'class="current"' : '' ) . '>Active <span class="count">(' . ( isset( $this->views\_count['active'] ) ? $this->views\_count['active'] : '' ) . ')</span></a>', |
  |  | 195 | 'canceled'  => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'canceled', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'canceled' ? 'class="current"' : '' ) . '>Canceled <span class="count">(' . ( isset( $this->views\_count['canceled'] ) ? $this->views\_count['canceled'] : '' ) . ')</span></a>', |
  |  | 196 | 'expired'   => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'expired', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'expired' ? 'class="current"' : '' ) . '>Expired <span class="count">(' . ( isset( $this->views\_count['expired'] ) ? $this->views\_count['expired'] : '' ) . ')</span></a>', |
  |  | 197 | 'pending'   => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'pending', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'pending' ? 'class="current"' : '' ) . '>Pending <span class="count">(' . ( isset( $this->views\_count['pending'] ) ? $this->views\_count['pending'] : '' ) . ')</span></a>', |
  |  | 198 | 'abandoned' => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'abandoned', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'abandoned' ? 'class="current"' : '' ) . '>Abandoned <span class="count">(' . ( isset( $this->views\_count['abandoned'] ) ? $this->views\_count['abandoned'] : '' ) . ')</span></a>', |
  | 199 | 199 | )); |
  | 200 | 200 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=2799943#L385) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-list-table.php?rev=3160323#L385) |  |
  | 385 | 385 | $data[] = apply\_filters( 'pms\_members\_list\_table\_entry\_data', array( |
  | 386 | 386 | 'user\_id'           => $member->user\_id, |
  | 387 |  | 'username'          => '<strong><a href="' . ~~add\_query\_arg( array( 'subpage' => 'edit\_member', 'member\_id' => $member->user\_id ), admin\_url( 'admin.php?page=pms-members-page'~~ ) ) . '">' . esc\_attr( $member->username ) . '</a></strong>', |
  |  | 387 | 'username'          => '<strong><a href="' . esc\_url( add\_query\_arg( array( 'subpage' => 'edit\_member', 'member\_id' => $member->user\_id ), admin\_url( 'admin.php?page=pms-members-page' ) ) ) . '">' . esc\_attr( $member->username ) . '</a></strong>', |
  | 388 | 388 | 'name'              => $member\_name, |
  | 389 | 389 | 'email'             => $member->email, |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=2799943#L463) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-list-table.php?rev=3160323#L463) |  |
  | 463 | 463 |  |
  | 464 | 464 | // Add an edit user action for each member |
  | 465 |  | $actions['edit'] = '<a href="' . ~~add\_query\_arg( array( 'subpage' => 'edit\_member', 'member\_id' => $item['user\_id'] ), admin\_url( 'admin.php?page=pms-members-page'~~ ) ) . '">' . esc\_html\_\_( 'Edit Member', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 465 | $actions['edit'] = '<a href="' . esc\_url( add\_query\_arg( array( 'subpage' => 'edit\_member', 'member\_id' => $item['user\_id'] ), admin\_url( 'admin.php?page=pms-members-page' ) ) ) . '">' . esc\_html\_\_( 'Edit Member', 'paid-member-subscriptions' ) . '</a>'; |
  | 466 | 466 |  |
  | 467 | 467 | // Return value saved for username and also the row actions |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=2799943#L502) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-list-table.php?rev=3160323#L502) |  |
  | 502 | 502 | $output .= '<span class="pms-member-list-subscription pms-has-bubble">'; |
  | 503 | 503 |  |
  | 504 |  | $output .= '<a href="' . ~~add\_query\_arg( array( 'subpage' => 'edit\_subscription', 'subscription\_id' => $member\_subscription->id~~ ) ) . '">'; |
  |  | 504 | $output .= '<a href="' . esc\_url( add\_query\_arg( array( 'subpage' => 'edit\_subscription', 'subscription\_id' => $member\_subscription->id ) ) ) . '">'; |
  | 505 | 505 | $output .= apply\_filters( 'pms\_list\_table\_' . $this->\_args['plural'] . '\_show\_status\_dot', '<span class="pms-status-dot ' . esc\_attr( $member\_subscription->status ) . '"></span>' ); |
  | 506 | 506 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=2799943#L539) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members-list-table.php?rev=3160323#L539) |  |
  | 539 | 539 | $sign = '+'; |
  | 540 | 540 |  |
  | 541 |  | $output .= '<a href="' . ~~add\_query\_arg( array( 'subpage' => 'edit\_member', 'member\_id' => $user\_id~~ ) ) . '" title="'.esc\_html\_\_( 'View Abandoned Subscriptions', 'paid-member-subscriptions' ).'" class="pms-abandon-count">'; |
  |  | 541 | $output .= '<a href="' . esc\_url( add\_query\_arg( array( 'subpage' => 'edit\_member', 'member\_id' => $user\_id ) ) ) . '" title="'.esc\_html\_\_( 'View Abandoned Subscriptions', 'paid-member-subscriptions' ).'" class="pms-abandon-count">'; |
  | 542 | 542 | $output .= sprintf( \_n( '%1$s %2$s abandoned subscription', '%1$s %2$s abandoned subscriptions', $abandon\_count, 'paid-member-subscriptions' ), $sign, $abandon\_count ); |
  | 543 | 543 | $output .= '</a>'; |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members.php")

  | [r3127842](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members.php?rev=3127842#L138 "Show revision 3127842 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members.php?rev=3160323#L138 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 138 | 138 | if( $subscription\_id ) { |
  | 139 | 139 |  |
  | 140 |  | wp\_redirect( ~~add\_query\_arg( array( 'page' => $this->menu\_slug, 'subpage' => 'edit\_subscription', 'subscription\_id' => (int)$subscription\_id, 'message' => '2', 'updated' => '1' ), admin\_url( 'admin.php'~~ ) ) ); |
  |  | 140 | wp\_redirect( esc\_url( add\_query\_arg( array( 'page' => $this->menu\_slug, 'subpage' => 'edit\_subscription', 'subscription\_id' => (int)$subscription\_id, 'message' => '2', 'updated' => '1' ), admin\_url( 'admin.php' ) ) ) ); |
  | 141 | 141 | exit; |
  | 142 | 142 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members.php?rev=3127842#L205) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members.php?rev=3160323#L205) |  |
  | 205 | 205 | if( $updated ) { |
  | 206 | 206 |  |
  | 207 |  | wp\_redirect( ~~add\_query\_arg( array( 'message' => '3', 'updated' => '1' ), pms\_get\_current\_page\_url(~~) ) ); |
  |  | 207 | wp\_redirect( esc\_url( add\_query\_arg( array( 'message' => '3', 'updated' => '1' ), pms\_get\_current\_page\_url() ) ) ); |
  | 208 | 208 | exit; |
  | 209 | 209 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members.php?rev=3127842#L235) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-members.php?rev=3160323#L235) |  |
  | 235 | 235 |  |
  | 236 | 236 | if( ! empty( $member\_subscriptions ) ) |
  | 237 |  | wp\_redirect( ~~add\_query\_arg( array( 'page' => $this->menu\_slug, 'subpage' => 'edit\_member', 'member\_id' => $member\_id, 'message' => '4', 'updated' => '1' ), admin\_url( 'admin.php'~~ ) ) ); |
  |  | 237 | wp\_redirect( esc\_url( add\_query\_arg( array( 'page' => $this->menu\_slug, 'subpage' => 'edit\_member', 'member\_id' => $member\_id, 'message' => '4', 'updated' => '1' ), admin\_url( 'admin.php' ) ) ) ); |
  | 238 | 238 | else |
  | 239 |  | wp\_redirect( ~~add\_query\_arg( array( 'page' => $this->menu\_slug, 'message' => '4', 'updated' => '1' ), admin\_url( 'admin.php'~~ ) ) ); |
  |  | 239 | wp\_redirect( esc\_url( add\_query\_arg( array( 'page' => $this->menu\_slug, 'message' => '4', 'updated' => '1' ), admin\_url( 'admin.php' ) ) ) ); |
  | 240 | 240 |  |
  | 241 | 241 | exit; |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments-list-table.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments-list-table.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments-list-table.php")

  | [r3086317](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3086317#L156 "Show revision 3086317 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments-list-table.php?rev=3160323#L156 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 156 | 156 |  |
  | 157 | 157 | return apply\_filters( 'pms\_payments\_list\_table\_get\_views', array( |
  | 158 |  | 'all'       => '<a href="' . ~~remove\_query\_arg( array( 'pms-view', 'paged'~~ ) ) . '" ' . ( !isset( $\_GET['pms-view'] ) ? 'class="current"' : '' ) . '>All <span class="count">(' . ( isset( $this->views\_count['all'] ) ? $this->views\_count['all'] : '' ) . ')</span></a>', |
  | 159 |  | 'completed' => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'completed', 'paged' => 1 ) ) . '" ' . ( isset( $\_GET['pms-view'] ) &&~~$\_GET['pms-view'] == 'completed' ? 'class="current"' : '' ) . '>Completed <span class="count">(' . ( isset( $this->views\_count['completed'] ) ? $this->views\_count['completed'] : '' ) . ')</span></a>', |
  | 160 |  | 'pending'   => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'pending', 'paged' => 1 ) ) . '" ' . ( isset( $\_GET['pms-view'] ) &&~~$\_GET['pms-view'] == 'pending' ? 'class="current"' : '' ) . '>Pending <span class="count">(' . ( isset( $this->views\_count['pending'] ) ? $this->views\_count['pending'] : '' ) . ')</span></a>', |
  | 161 |  | 'failed'    => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'failed', 'paged' => 1 ) ) . '" ' . ( isset( $\_GET['pms-view'] ) &&~~$\_GET['pms-view'] == 'failed' ? 'class="current"' : '' ) . '>Failed <span class="count">(' . ( isset( $this->views\_count['failed'] ) ? $this->views\_count['failed'] : '' ) . ')</span></a>', |
  | 162 |  | 'refunded'  => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'refunded', 'paged' => 1 ) ) . '" ' . ( isset( $\_GET['pms-view'] ) &&~~$\_GET['pms-view'] == 'refunded' ? 'class="current"' : '' ) . '>Refunded <span class="count">(' . ( isset( $this->views\_count['refunded'] ) ? $this->views\_count['refunded'] : '' ) . ')</span></a>' |
  |  | 158 | 'all'       => '<a href="' . esc\_url( remove\_query\_arg( array( 'pms-view', 'paged' ) ) ) . '" ' . ( !isset( $\_GET['pms-view'] ) ? 'class="current"' : '' ) . '>All <span class="count">(' . ( isset( $this->views\_count['all'] ) ? $this->views\_count['all'] : '' ) . ')</span></a>', |
  |  | 159 | 'completed' => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'completed', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'completed' ? 'class="current"' : '' ) . '>Completed <span class="count">(' . ( isset( $this->views\_count['completed'] ) ? $this->views\_count['completed'] : '' ) . ')</span></a>', |
  |  | 160 | 'pending'   => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'pending', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'pending' ? 'class="current"' : '' ) . '>Pending <span class="count">(' . ( isset( $this->views\_count['pending'] ) ? $this->views\_count['pending'] : '' ) . ')</span></a>', |
  |  | 161 | 'failed'    => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'failed', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'failed' ? 'class="current"' : '' ) . '>Failed <span class="count">(' . ( isset( $this->views\_count['failed'] ) ? $this->views\_count['failed'] : '' ) . ')</span></a>', |
  |  | 162 | 'refunded'  => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'refunded', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'refunded' ? 'class="current"' : '' ) . '>Refunded <span class="count">(' . ( isset( $this->views\_count['refunded'] ) ? $this->views\_count['refunded'] : '' ) . ')</span></a>' |
  | 163 | 163 | )); |
  | 164 | 164 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3086317#L393) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments-list-table.php?rev=3160323#L393) |  |
  | 393 | 393 |  |
  | 394 | 394 | // Edit payment row action |
  | 395 |  | $actions['edit'] = '<a href="' . ~~add\_query\_arg( array( 'pms-action' => 'edit\_payment', 'payment\_id' => $item['id'] ), admin\_url( 'admin.php?page=pms-payments-page'~~ ) ) . '">' . esc\_html\_\_( 'Edit Payment', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 395 | $actions['edit'] = '<a href="' . esc\_url( add\_query\_arg( array( 'pms-action' => 'edit\_payment', 'payment\_id' => $item['id'] ), admin\_url( 'admin.php?page=pms-payments-page' ) ) ) . '">' . esc\_html\_\_( 'Edit Payment', 'paid-member-subscriptions' ) . '</a>'; |
  | 396 | 396 |  |
  | 397 | 397 | // Delete row action |
  | 398 |  | $actions['delete'] = '<a onclick="return confirm( \'' . esc\_html\_\_( "Are you sure you want to delete this Payment?", "paid-member-subscriptions" ) . ' \' )" href="' . ~~wp\_nonce\_url( add\_query\_arg( array( 'pms-action' => 'delete\_payment', 'payment\_id' => $item['id'] ) ), 'pms\_payment\_nonce'~~ ) . '">' . esc\_html\_\_( 'Delete', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 398 | $actions['delete'] = '<a onclick="return confirm( \'' . esc\_html\_\_( "Are you sure you want to delete this Payment?", "paid-member-subscriptions" ) . ' \' )" href="' . esc\_url( wp\_nonce\_url( add\_query\_arg( array( 'pms-action' => 'delete\_payment', 'payment\_id' => $item['id'] ) ), 'pms\_payment\_nonce' ) ) . '">' . esc\_html\_\_( 'Delete', 'paid-member-subscriptions' ) . '</a>'; |
  | 399 | 399 |  |
  | 400 | 400 | /\*\* |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3086317#L409) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments-list-table.php?rev=3160323#L409) |  |
  | 409 | 409 | $payment = pms\_get\_payment( $item['id'] ); |
  | 410 | 410 |  |
  | 411 |  | $output  = '<a href="' . ~~add\_query\_arg( array( 'page' => 'pms-members-page', 'pms-action' => 'edit\_member', 'member\_id' => $payment->user\_id, 'subpage' => 'edit\_member' ), admin\_url( 'admin.php'~~ ) ) . '" title="' . \_\_( 'Edit Member', 'paid-member-subscriptions' ) . '">' . $item['username']; |
  |  | 411 | $output  = '<a href="' . esc\_url( add\_query\_arg( array( 'page' => 'pms-members-page', 'pms-action' => 'edit\_member', 'member\_id' => $payment->user\_id, 'subpage' => 'edit\_member' ), admin\_url( 'admin.php' ) ) ) . '" title="' . \_\_( 'Edit Member', 'paid-member-subscriptions' ) . '">' . $item['username']; |
  | 412 | 412 | $output .= $this->row\_actions( $actions ); |
  | 413 | 413 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3086317#L452) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments-list-table.php?rev=3160323#L452) |  |
  | 452 | 452 |  |
  | 453 | 453 | if( $item['status'] == 'failed' ){ |
  | 454 |  | $output .= ' | <a href="' . ~~add\_query\_arg( array( 'pms-action' => 'edit\_payment', 'payment\_id' => $item['id']~~ ) ) . '">' . esc\_html\_\_( 'View Logs', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 454 | $output .= ' | <a href="' . esc\_url( add\_query\_arg( array( 'pms-action' => 'edit\_payment', 'payment\_id' => $item['id'] ) ) ) . '">' . esc\_html\_\_( 'View Logs', 'paid-member-subscriptions' ) . '</a>'; |
  | 455 | 455 | } |
  | 456 | 456 |  |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments.php")

  | [r3127842](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments.php?rev=3127842#L97 "Show revision 3127842 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments.php?rev=3160323#L97 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 97 | 97 | return; |
  | 98 | 98 |  |
  |  | 99 | // Verify user capability |
  |  | 100 | if( ! ( current\_user\_can( 'manage\_options' ) || current\_user\_can( 'pms\_edit\_capability' ) ) ) |
  |  | 101 | return; |
  |  | 102 |  |
  | 99 | 103 | // Get current actions |
  | 100 | 104 | $action = !empty( $\_REQUEST['pms-action'] ) ? sanitize\_text\_field( $\_REQUEST['pms-action'] ) : ( isset( $\_REQUEST['action'] ) && $\_REQUEST['action'] != '-1' ? sanitize\_text\_field( $\_REQUEST['action'] ) : ( isset( $\_REQUEST['action2'] ) ? sanitize\_text\_field( $\_REQUEST['action2'] ) : '' ) ); |
  | 101 | 105 |  |
  | 102 |  | if( empty(~~$action~~) ) |
  |  | 106 | if( empty( $action ) ) |
  | 103 | 107 | return; |
  | 104 | 108 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments.php?rev=3127842#L357) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-payments.php?rev=3160323#L361) |  |
  | 357 | 361 | do\_action( 'pms\_manually\_added\_payment\_success', $payment ); |
  | 358 | 362 |  |
  | 359 |  | wp\_redirect(~~add\_query\_arg(array('page' => $this->menu\_slug, 'message' => '1', 'updated' => '1'), admin\_url('admin.php'))~~); |
  |  | 363 | wp\_redirect( esc\_url( add\_query\_arg( array('page' => $this->menu\_slug, 'message' => '1', 'updated' => '1'), admin\_url( 'admin.php' ) ) ) ); |
  | 360 | 364 | exit; |
  | 361 | 365 | } |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-setup-wizard.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-setup-wizard.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-setup-wizard.php")

  | [r3145313](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-setup-wizard.php?rev=3145313#L257 "Show revision 3145313 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-setup-wizard.php?rev=3160323#L257 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 257 | 257 | return ''; |
  | 258 | 258 |  |
  | 259 |  | return ~~add\_query\_arg( 'step', $keys[$step\_index + 1]~~ ); |
  |  | 259 | return esc\_url( add\_query\_arg( 'step', $keys[$step\_index + 1] ) ); |
  | 260 | 260 | } |
  | 261 | 261 |  |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-subscription-plans.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-subscription-plans.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-subscription-plans.php")

  | [r3045553](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3045553#L156 "Show revision 3045553 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-subscription-plans.php?rev=3160323#L156 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 156 | 156 | } |
  | 157 | 157 |  |
  | 158 |  | wp\_redirect( ~~add\_query\_arg( array( 'post\_type' => $this->post\_type ), pms\_get\_current\_page\_url(true~~) ) ); |
  |  | 158 | wp\_redirect( esc\_url( add\_query\_arg( array( 'post\_type' => $this->post\_type ), pms\_get\_current\_page\_url(true) ) ) ); |
  | 159 | 159 | die(); |
  | 160 | 160 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3045553#L191) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-subscription-plans.php?rev=3160323#L191) |  |
  | 191 | 191 | } |
  | 192 | 192 |  |
  | 193 |  | wp\_redirect( ~~add\_query\_arg( array( 'post\_type' => $this->post\_type ), pms\_get\_current\_page\_url(true~~) ) ); |
  |  | 193 | wp\_redirect( esc\_url( add\_query\_arg( array( 'post\_type' => $this->post\_type ), pms\_get\_current\_page\_url(true) ) ) ); |
  | 194 | 194 | die(); |
  | 195 | 195 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3045553#L547) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-subscription-plans.php?rev=3160323#L547) |  |
  | 547 | 547 | } |
  | 548 | 548 |  |
  | 549 |  | $url = 'href="' .  ~~add\_query\_arg( 'subscription\_plan', $plan->id, get\_permalink( pms\_get\_page('register'~~) ) ) .'&single\_plan=yes"'; |
  |  | 549 | $url = 'href="' .  esc\_url( add\_query\_arg( 'subscription\_plan', $plan->id, get\_permalink( pms\_get\_page('register') ) ) ) .'&single\_plan=yes"'; |
  | 550 | 550 | $pattern = str\_replace( 'href="1"', $url, $pattern ); |
  | 551 | 551 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3045553#L577) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-subscription-plans.php?rev=3160323#L577) |  |
  | 577 | 577 | } |
  | 578 | 578 |  |
  | 579 |  | $url = 'href="' .  ~~add\_query\_arg( 'subscription\_plan', $plan->id, get\_permalink( pms\_get\_page('register'~~) ) ) .'&single\_plan=yes"'; |
  |  | 579 | $url = 'href="' .  esc\_url( add\_query\_arg( 'subscription\_plan', $plan->id, get\_permalink( pms\_get\_page('register') ) ) ) .'&single\_plan=yes"'; |
  | 580 | 580 | $pattern = str\_replace( 'href="2"', $url, $pattern ); |
  | 581 | 581 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3045553#L607) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-subscription-plans.php?rev=3160323#L607) |  |
  | 607 | 607 | } |
  | 608 | 608 |  |
  | 609 |  | $url = 'href="' .  ~~add\_query\_arg( 'subscription\_plan', $plan->id, get\_permalink( pms\_get\_page('register'~~) ) ) .'&single\_plan=yes"'; |
  |  | 609 | $url = 'href="' .  esc\_url( add\_query\_arg( 'subscription\_plan', $plan->id, get\_permalink( pms\_get\_page('register') ) ) ) .'&single\_plan=yes"'; |
  | 610 | 610 | $pattern = str\_replace( 'href="3"', $url, $pattern ); |
  | 611 | 611 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3045553#L786) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-admin-subscription-plans.php?rev=3160323#L786) |  |
  | 786 | 786 | $redirect = add\_query\_arg( $redirect\_args, pms\_get\_current\_page\_url( true ) ); |
  | 787 | 787 |  |
  | 788 |  | wp\_redirect( ~~$redirect~~ ); |
  |  | 788 | wp\_redirect( esc\_url( $redirect ) ); |
  | 789 | 789 | exit; |
  | 790 | 790 |  |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/class-edd-sl-plugin-updater.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/class-edd-sl-plugin-updater.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/class-edd-sl-plugin-updater.php")

  | [r3024979](/browser/paid-member-subscriptions/trunk/includes/admin/class-edd-sl-plugin-updater.php?rev=3024979#L748 "Show revision 3024979 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-edd-sl-plugin-updater.php?rev=3160323#L748 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 748 | 748 | if ( ! empty( $message ) ) { |
  | 749 | 749 | $message = implode( "<br/>", array\_unique($message) );//if we got the same message for multiple addons show just one, and add a br in case we show multiple messages |
  | 750 |  | $redirect = ~~add\_query\_arg( array( 'pms\_sl\_activation' => 'false', 'message' => urlencode( $message ) ), $this->license\_page\_url(~~) ); |
  |  | 750 | $redirect = esc\_url( add\_query\_arg( array( 'pms\_sl\_activation' => 'false', 'message' => urlencode( $message ) ), $this->license\_page\_url() ) ); |
  | 751 | 751 |  |
  | 752 | 752 | $this->update\_option( 'pms\_license\_status', isset( $license\_data->error ) ? $license\_data->error : $license\_data->license ); |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-edd-sl-plugin-updater.php?rev=3024979#L759) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-edd-sl-plugin-updater.php?rev=3160323#L759) |  |
  | 759 | 759 | $this->update\_option( 'pms\_license\_status', isset( $license\_data->error ) ? $license\_data->error : $license\_data->license ); |
  | 760 | 760 |  |
  | 761 |  | wp\_redirect( ~~add\_query\_arg( array( 'pms\_sl\_activation' => 'true', 'message' => urlencode( \_\_( 'You have successfully activated your license.', 'paid-member-subscriptions' ) ) ), $this->license\_page\_url(~~) ) ); |
  |  | 761 | wp\_redirect( esc\_url( add\_query\_arg( array( 'pms\_sl\_activation' => 'true', 'message' => urlencode( \_\_( 'You have successfully activated your license.', 'paid-member-subscriptions' ) ) ), $this->license\_page\_url() ) ) ); |
  | 762 | 762 | exit(); |
  | 763 | 763 | } |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-edd-sl-plugin-updater.php?rev=3024979#L841) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/class-edd-sl-plugin-updater.php?rev=3160323#L841) |  |
  | 841 | 841 | $message = \_\_( 'An error occurred, please try again.', 'paid-member-subscriptions' ); |
  | 842 | 842 |  |
  | 843 |  | wp\_redirect( ~~add\_query\_arg( array( 'pms\_sl\_activation' => 'false', 'message' => urlencode( $message ) ), $this->license\_page\_url(~~) ) ); |
  |  | 843 | wp\_redirect( esc\_url( add\_query\_arg( array( 'pms\_sl\_activation' => 'false', 'message' => urlencode( $message ) ), $this->license\_page\_url() ) ) ); |
  | 844 | 844 | exit(); |
  | 845 | 845 | } |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/functions-admin.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/functions-admin.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/functions-admin.php")

  | [r3093002](/browser/paid-member-subscriptions/trunk/includes/admin/functions-admin.php?rev=3093002#L42 "Show revision 3093002 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/functions-admin.php?rev=3160323#L42 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 42 | 42 | return; |
  | 43 | 43 |  |
  |  | 44 | if( ! ( current\_user\_can( 'manage\_options' ) || current\_user\_can( 'pms\_edit\_capability' ) ) ) |
  |  | 45 | return; |
  |  | 46 |  |
  | 44 | 47 | // Remove all cron jobs |
  | 45 | 48 | wp\_clear\_scheduled\_hook( 'pms\_cron\_process\_member\_subscriptions\_payments' ); |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/functions-admin.php?rev=3093002#L69) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/functions-admin.php?rev=3160323#L72) |  |
  | 69 | 72 | )); |
  | 70 | 73 |  |
  | 71 |  | wp\_safe\_redirect( ~~add\_query\_arg( 'sucess\_notice', '1', $url~~ ) ); |
  |  | 74 | wp\_safe\_redirect( esc\_url( add\_query\_arg( 'sucess\_notice', '1', $url ) ) ); |
  | 72 | 75 | exit; |
  | 73 | 76 |  |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-addons.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-addons.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-addons.php")

  | [r3118211](/browser/paid-member-subscriptions/trunk/includes/admin/views/view-page-addons.php?rev=3118211#L138 "Show revision 3118211 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-addons.php?rev=3160323#L138 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 138 | 138 | array(  'slug' => 'pms-add-on-stripe/index.php', |
  | 139 | 139 | 'type'        => 'add-on', |
  | 140 |  | 'name'        => \_\_( 'Stripe', 'paid-member-subscriptions' ), |
  | 141 |  | 'description' => \_\_( '~~Accept credit card payments, both one-time and recurring, directly on your website via Stripe~~.', 'paid-member-subscriptions' ), |
  |  | 140 | 'name'        => \_\_( 'Stripe (deprecated)', 'paid-member-subscriptions' ), |
  |  | 141 | 'description' => \_\_( 'Old Stripe implementation not available for new users.', 'paid-member-subscriptions' ), |
  | 142 | 142 | 'icon'        => 'pms-add-on-stripe-logo.png', |
  | 143 | 143 | 'doc\_url'     => 'https://www.cozmoslabs.com/docs/paid-member-subscriptions/add-ons/stripe-payment-gateway/?utm\_source=wpbackend&utm\_medium=clientsite&utm\_content=add-on-page&utm\_campaign=PMS', |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-basic-info.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-basic-info.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-basic-info.php")

  | [r3100435](/browser/paid-member-subscriptions/trunk/includes/admin/views/view-page-basic-info.php?rev=3100435#L324 "Show revision 3100435 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-basic-info.php?rev=3160323#L324 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 324 | 324 | <div> |
  | 325 | 325 | <a href="https://www.cozmoslabs.com/add-ons/stripe/?utm\_source=wpbackend&utm\_medium=clientsite&utm\_campaign=PMSFree&utm\_content=basic-info" target="\_blank"> |
  | 326 |  | <h4 class="pms-add-on-name"><?php esc\_html\_e( 'Stripe', 'paid-member-subscriptions' ); ?></h4> |
  |  | 326 | <h4 class="pms-add-on-name"><?php esc\_html\_e( 'Stripe (deprecated)', 'paid-member-subscriptions' ); ?></h4> |
  | 327 | 327 | </a> |
  | 328 | 328 |  |
  | 329 | 329 | <a href="https://www.cozmoslabs.com/add-ons/stripe/?utm\_source=wpbackend&utm\_medium=clientsite&utm\_campaign=PMSFree&utm\_content=basic-info" target="\_blank" class="pms-addon-image-container"> |
  | 330 |  | <img src="<?php echo esc\_url( PMS\_PLUGIN\_DIR\_URL ); ?>assets/images/add-on-stripe.png" alt="~~Navigation Menu Filtering~~" class="pms-addon-image" /> |
  |  | 330 | <img src="<?php echo esc\_url( PMS\_PLUGIN\_DIR\_URL ); ?>assets/images/add-on-stripe.png" alt="Stripe" class="pms-addon-image" /> |
  | 331 | 331 | </a> |
  | 332 | 332 |  |
* ## [paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-settings-content\_restriction.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-settings-content_restriction.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-settings-content_restriction.php")

  | [r3118211](/browser/paid-member-subscriptions/trunk/includes/admin/views/view-page-settings-content_restriction.php?rev=3118211#L177 "Show revision 3118211 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/admin/views/view-page-settings-content_restriction.php?rev=3160323#L177 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 177 | 177 | <p class="cozmoslabs-description cozmoslabs-description-space-left"><?php esc\_html\_e( 'Show a portion of the restricted post to logged-out users or users that are not subscribed to a plan.', 'paid-member-subscriptions' ); ?></p> |
  | 178 | 178 | </div> |
  |  | 179 |  |
  |  | 180 | <!-- Exclude Restricted Posts from Queries --> |
  |  | 181 | <div class="cozmoslabs-form-field-wrapper cozmoslabs-toggle-switch"> |
  |  | 182 | <label class="cozmoslabs-form-field-label" for="pms\_excludeRestrictedPosts"><?php esc\_html\_e( 'Exclude Restricted Posts from Queries', 'paid-member-subscriptions' ); ?></label> |
  |  | 183 |  |
  |  | 184 | <div class="cozmoslabs-toggle-container"> |
  |  | 185 | <input type="checkbox" name="pms\_content\_restriction\_settings[pms\_excludePosts]" id="pms\_excludeRestrictedPosts" value="yes" <?php echo ( isset( $this->options['pms\_excludePosts'] ) && $this->options['pms\_excludePosts'] == 'yes' ) ? 'checked' : ''; ?> > |
  |  | 186 | <label class="cozmoslabs-toggle-track" for="pms\_excludeRestrictedPosts"></label> |
  |  | 187 | </div> |
  |  | 188 |  |
  |  | 189 | <div class="cozmoslabs-toggle-description"> |
  |  | 190 | <label for="pms\_excludeRestrictedPosts" class="cozmoslabs-description"><?php esc\_html\_e( 'Activate this option to exclude the restricted posts from default WordPress and WooCommerce queries.', 'paid-member-subscriptions' ); ?></label> |
  |  | 191 | </div> |
  |  | 192 | </div> |
  | 179 | 193 | </div> |
* ## [paid-member-subscriptions/tags/2.12.9/includes/functions-content-restriction.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/functions-content-restriction.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/functions-content-restriction.php")

  | [r2962413](/browser/paid-member-subscriptions/trunk/includes/functions-content-restriction.php?rev=2962413#L398 "Show revision 2962413 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-content-restriction.php?rev=3160323#L398 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 398 | 398 |  |
  | 399 | 399 | } |
  |  | 400 |  |
  |  | 401 |  |
  |  | 402 | /\*\* |
  |  | 403 | \* Exclude Restricted Posts From Query |
  |  | 404 | \*/ |
  |  | 405 |  |
  |  | 406 | $settings = get\_option( 'pms\_content\_restriction\_settings' ); |
  |  | 407 |  |
  |  | 408 | if( isset( $settings['pms\_excludePosts'] ) && $settings['pms\_excludePosts'] == 'yes' ){ |
  |  | 409 |  |
  |  | 410 | /\* Exclude restricted posts and pages from the main queries like blog, archive and taxonomy pages. \*/ |
  |  | 411 | add\_action( 'pre\_get\_posts', 'pmsc\_exclude\_post\_from\_query', 40 ); |
  |  | 412 | function pmsc\_exclude\_post\_from\_query( $query ) { |
  |  | 413 |  |
  |  | 414 | if( !function\_exists( 'pms\_is\_post\_restricted' ) || is\_admin() || is\_single() ) |
  |  | 415 | return; |
  |  | 416 |  |
  |  | 417 | if( $query->is\_main\_query() || ( $query->is\_search() && isset( $\_GET['s'] ) ) ) { |
  |  | 418 |  |
  |  | 419 | remove\_action('pre\_get\_posts', 'pmsc\_exclude\_post\_from\_query', 40 ); |
  |  | 420 |  |
  |  | 421 | $args = $query->query\_vars; |
  |  | 422 | $args['suppress\_filters'] = true; |
  |  | 423 | $args['posts\_per\_page'] = get\_option( 'posts\_per\_page' ); |
  |  | 424 |  |
  |  | 425 | if( is\_search() ) |
  |  | 426 | $args['post\_type'] = 'any'; |
  |  | 427 |  |
  |  | 428 | $posts = get\_posts($args); |
  |  | 429 |  |
  |  | 430 | $previous\_restricted\_ids = $query->get( 'post\_\_not\_in' ); |
  |  | 431 | if ( ! is\_array( $previous\_restricted\_ids ) ) { |
  |  | 432 | $previous\_restricted\_ids = array(); |
  |  | 433 | } |
  |  | 434 |  |
  |  | 435 | $ids = wp\_list\_pluck( $posts, 'ID' ); |
  |  | 436 | $restricted\_ids = array\_filter( $ids,'pms\_is\_post\_restricted' ); |
  |  | 437 |  |
  |  | 438 | $updated\_restricted\_ids = array\_merge( $previous\_restricted\_ids, $restricted\_ids ); |
  |  | 439 | $query->set( 'post\_\_not\_in', $updated\_restricted\_ids ); |
  |  | 440 | } |
  |  | 441 | } |
  |  | 442 |  |
  |  | 443 | //Remove restricted forums from the main bbPress query |
  |  | 444 | add\_filter( 'bbp\_after\_has\_forums\_parse\_args', 'pmsc\_exclude\_restricted\_forums\_from\_main\_query' ); |
  |  | 445 | function pmsc\_exclude\_restricted\_forums\_from\_main\_query( $vars ) { |
  |  | 446 | if( !function\_exists( 'pms\_is\_post\_restricted' ) ) return; |
  |  | 447 |  |
  |  | 448 | $query = new WP\_Query( $vars ); |
  |  | 449 |  |
  |  | 450 | $forum\_ids = array(); |
  |  | 451 |  |
  |  | 452 | foreach ( $query->posts as $forum ) { |
  |  | 453 | $forum\_ids[] = $forum->ID; |
  |  | 454 | } |
  |  | 455 |  |
  |  | 456 | $previous\_restricted\_forums = $query->get( 'post\_\_not\_in' ); |
  |  | 457 | if ( ! is\_array( $previous\_restricted\_forums ) ) { |
  |  | 458 | $previous\_restricted\_forums = array(); |
  |  | 459 | } |
  |  | 460 |  |
  |  | 461 | $restricted\_forums = array\_filter( $forum\_ids, 'pms\_is\_post\_restricted' ); |
  |  | 462 | $updated\_restricted\_forums = array\_merge( $previous\_restricted\_forums, $restricted\_forums ); |
  |  | 463 |  |
  |  | 464 | $vars['post\_\_not\_in'] = $updated\_restricted\_forums; |
  |  | 465 |  |
  |  | 466 | return $vars; |
  |  | 467 | } |
  |  | 468 |  |
  |  | 469 | //Alters the output of the query that displays the Category Archive (including Shop) pages, filtering the restricted products from the output |
  |  | 470 | add\_action( 'pre\_get\_posts', 'pms\_exclude\_restricted\_products\_from\_woocoommerce\_category\_queries', 11 ); |
  |  | 471 | function pms\_exclude\_restricted\_products\_from\_woocoommerce\_category\_queries( $query ) { |
  |  | 472 | if( is\_admin() || !function\_exists('pms\_is\_post\_restricted') ) |
  |  | 473 | return; |
  |  | 474 |  |
  |  | 475 | if( isset( $query->query\_vars['wc\_query'] ) && $query->query\_vars['wc\_query'] == 'product\_query' ){ |
  |  | 476 |  |
  |  | 477 | remove\_action( 'pre\_get\_posts', 'pms\_exclude\_restricted\_products\_from\_woocoommerce\_category\_queries', 11 ); |
  |  | 478 |  |
  |  | 479 | $args = $query->query\_vars; |
  |  | 480 | $args['suppress\_filters'] = true; |
  |  | 481 | $args['posts\_per\_page'] = -1; |
  |  | 482 |  |
  |  | 483 | $previous\_restricted\_ids = $query->get( 'post\_\_not\_in' ); |
  |  | 484 | if ( ! is\_array( $previous\_restricted\_ids ) ) { |
  |  | 485 | $previous\_restricted\_ids = array(); |
  |  | 486 | } |
  |  | 487 |  |
  |  | 488 | $products = wc\_get\_products( $args ); |
  |  | 489 |  |
  |  | 490 | $product\_ids = array(); |
  |  | 491 |  |
  |  | 492 | foreach ($products as $product) { |
  |  | 493 | $product\_ids[] = $product->get\_id(); |
  |  | 494 | } |
  |  | 495 |  |
  |  | 496 | $restricted\_ids = array\_filter( $product\_ids, 'pms\_is\_post\_restricted' ); |
  |  | 497 |  |
  |  | 498 | $updated\_restricted\_ids = array\_merge( $previous\_restricted\_ids, $restricted\_ids ); |
  |  | 499 | $query->set( 'post\_\_not\_in', $updated\_restricted\_ids ); |
  |  | 500 |  |
  |  | 501 | } |
  |  | 502 | } |
  |  | 503 |  |
  |  | 504 | //Alters the output of the [products] shortcode from WooCommerce, filtering restricted products from the output |
  |  | 505 | add\_action( 'woocommerce\_shortcode\_products\_query', 'pmsc\_exclude\_restricted\_products\_from\_woocoommerce\_products\_shortcode\_queries' ); |
  |  | 506 | function pmsc\_exclude\_restricted\_products\_from\_woocoommerce\_products\_shortcode\_queries( $query\_args ) { |
  |  | 507 | if( !is\_admin() && function\_exists('pms\_is\_post\_restricted') ) { |
  |  | 508 | $posts\_per\_page = $query\_args['posts\_per\_page']; |
  |  | 509 |  |
  |  | 510 | $query\_args['suppress\_filters'] = true; |
  |  | 511 | $query\_args['posts\_per\_page'] = '-1'; |
  |  | 512 |  |
  |  | 513 | $products = wc\_get\_products( $query\_args ); |
  |  | 514 |  |
  |  | 515 | $query\_args['posts\_per\_page'] = $posts\_per\_page; |
  |  | 516 |  |
  |  | 517 | $product\_ids = array(); |
  |  | 518 |  |
  |  | 519 | foreach ($products as $product) { |
  |  | 520 | $product\_ids[] = $product->get\_id(); |
  |  | 521 | } |
  |  | 522 |  |
  |  | 523 | $previous\_restricted\_ids = isset( $query\_args['post\_\_not\_in'] ) ? $query\_args['post\_\_not\_in'] : array(); |
  |  | 524 |  |
  |  | 525 | if ( ! is\_array( $previous\_restricted\_ids ) ) { |
  |  | 526 | $previous\_restricted\_ids = array(); |
  |  | 527 | } |
  |  | 528 |  |
  |  | 529 | $restricted\_ids = array\_filter( $product\_ids, 'pms\_is\_post\_restricted' ); |
  |  | 530 | $updated\_restricted\_ids = array\_merge( $previous\_restricted\_ids, $restricted\_ids ); |
  |  | 531 |  |
  |  | 532 | $query\_args['post\_\_not\_in'] = $updated\_restricted\_ids; |
  |  | 533 | } |
  |  | 534 |  |
  |  | 535 | return $query\_args; |
  |  | 536 | } |
  |  | 537 | } |
  |  | 538 |  |
* ## [paid-member-subscriptions/tags/2.12.9/includes/functions-member-subscriptions.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/functions-member-subscriptions.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/functions-member-subscriptions.php")

  | [r2854210](/browser/paid-member-subscriptions/trunk/includes/functions-member-subscriptions.php?rev=2854210#L158 "Show revision 2854210 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-member-subscriptions.php?rev=3160323#L158 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 158 | 158 |  |
  | 159 | 159 | // Query order |
  | 160 |  | $query\_order = $args['order'] . ' '; |
  |  | 160 | $query\_order = strtoupper( $args['order'] ) === 'DESC' ? 'DESC' : 'ASC'; |
  |  | 161 | $query\_order .= ' '; |
  | 161 | 162 |  |
  | 162 | 163 | // Query limit |
* ## [paid-member-subscriptions/tags/2.12.9/includes/functions-member.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/functions-member.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/functions-member.php")

  | [r2884005](/browser/paid-member-subscriptions/trunk/includes/functions-member.php?rev=2884005#L188 "Show revision 2884005 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-member.php?rev=3160323#L188 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 188 | 188 |  |
  | 189 | 189 | $query\_oder\_by = "ORDER BY users." . sanitize\_text\_field( $args['orderby'] ) . ' '; |
  | 190 |  | $query\_order   = strtoupper( sanitize\_text\_field( $args['order'] ) ) . ' '; |
  |  | 190 |  |
  |  | 191 | $query\_order = strtoupper( $args['order'] ) === 'DESC' ? 'DESC' : 'ASC'; |
  |  | 192 | $query\_order .= ' '; |
  | 191 | 193 |  |
  | 192 | 194 | $query\_limit = ''; |
* ## [paid-member-subscriptions/tags/2.12.9/includes/functions-payment.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/functions-payment.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/functions-payment.php")

  | [r3107154](/browser/paid-member-subscriptions/trunk/includes/functions-payment.php?rev=3107154#L144 "Show revision 3107154 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-payment.php?rev=3160323#L144 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 144 | 144 |  |
  | 145 | 145 | $query\_order\_by = ''; |
  |  | 146 | // removed table name so it can be sanitized using the core function |
  | 146 | 147 | if ( !empty($args['orderby']) ) |
  | 147 |  | $query\_order\_by = " ORDER BY pms\_payments." . sanitize\_text\_field( $args['orderby'] ) . ' '; |
  | 148 |  |  |
  | 149 |  | $query\_order = strtoupper( sanitize\_text\_field( $args['order'] ) ) . ' '; |
  |  | 148 | $query\_order\_by = sanitize\_text\_field( $args['orderby'] ) . ' '; |
  |  | 149 |  |
  |  | 150 | $query\_order = strtoupper( $args['order'] ) === 'DESC' ? 'DESC' : 'ASC'; |
  |  | 151 | $query\_order .= ' '; |
  |  | 152 |  |
  |  | 153 | $query\_order\_string = " ORDER BY " . sanitize\_sql\_orderby( $query\_order\_by . $query\_order ); |
  | 150 | 154 |  |
  | 151 | 155 | $query\_limit        = ''; |
  | […](/browser/paid-member-subscriptions/trunk/includes/functions-payment.php?rev=3107154#L158) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-payment.php?rev=3160323#L162) |  |
  | 158 | 162 |  |
  | 159 | 163 | // Concatenate query string |
  | 160 |  | $query\_string .= $query\_from . $query\_inner\_join . $query\_where . $query\_order\_~~by . $query\_order~~ . $query\_limit . $query\_offset; |
  |  | 164 | $query\_string .= $query\_from . $query\_inner\_join . $query\_where . $query\_order\_string . $query\_limit . $query\_offset; |
  | 161 | 165 |  |
  | 162 | 166 |  |
* ## [paid-member-subscriptions/tags/2.12.9/includes/functions-plugin-notifications.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/functions-plugin-notifications.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/functions-plugin-notifications.php")

  | [r3145313](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3145313#L12 "Show revision 3145313 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-plugin-notifications.php?rev=3160323#L12 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 |  |
  | 13 | 13 | if( ! empty( $\_GET['pms\_dismiss\_admin\_notification'] ) ) { |
  |  | 14 |  |
  |  | 15 | if( empty( $\_GET['\_wpnonce'] ) || !wp\_verify\_nonce( sanitize\_text\_field( $\_GET['\_wpnonce'] ), 'pms\_plugin\_notice\_dismiss' ) ) |
  |  | 16 | return; |
  | 14 | 17 |  |
  | 15 | 18 | $notifications = PMS\_Plugin\_Notifications::get\_instance(); |
  | […](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3145313#L94) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-plugin-notifications.php?rev=3160323#L97) |  |
  | 94 | 97 | $message .= '<p style="margin-top: 16px;">' . wp\_kses\_post( \_\_( '<strong>New payment gateway!</strong><br><br><strong>Stripe</strong> payment gateway is now available in the free version. <br>Your users can pay using credit and debit cards without leaving your website and you can also offer them additional payment methods like Bancontact, iDeal, Giropay and more. <br><br>Get started now by going to <strong>Paid Member Subscriptions -> Settings -> Payments</strong>!', 'paid-member-subscriptions' ) ) . '</p>'; |
  | 95 | 98 | $message .= '<p><a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/payment-gateways/stripe-connect/?utm\_source=wp-backend&utm\_medium=addon-notification&utm\_campaign=PMSFree" class="button-primary" target="\_blank">' . esc\_html\_\_( 'Learn More', 'paid-member-subscriptions' ) . '</a></p>'; |
  | 96 |  | $message .= '<a href="' . esc\_url( ~~add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id )~~ ) ) . '#pms-addons-title" type="button" class="notice-dismiss"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  |  | 99 | $message .= '<a href="' . esc\_url( wp\_nonce\_url( add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id ) ), 'pms\_plugin\_notice\_dismiss' ) ) . '#pms-addons-title" type="button" class="notice-dismiss"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  | 97 | 100 |  |
  | 98 | 101 | pms\_add\_plugin\_notification( $notification\_id, $message, 'pms-notice pms-narrow notice notice-info', true, array( 'pms-settings-page' ) ); |
  | […](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3145313#L103) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-plugin-notifications.php?rev=3160323#L106) |  |
  | 103 | 106 | $message .= '<p style="margin-top: 16px;">' . wp\_kses\_post( '<strong>Files Restriction add-on!</strong><br><br>Lock down direct access to files and allow only paying members to access them using the new Files Restriction add-on. <br>The add-on is available with an <strong>Agency</strong> or <strong>Pro</strong> license.<br> Don\'t have a license? <a href="https://www.cozmoslabs.com/wordpress-paid-member-subscriptions/?utm\_source=wpbackend&utm\_medium=plugin-notification-files&utm\_campaign=PMSFree#pricing" target="\_blank">Buy now!</a>' ) . '</p>'; |
  | 104 | 107 | $message .= '<p><a href="'. admin\_url( 'admin.php?page=pms-addons-page' ) .'" class="button-primary" target="\_blank">' . esc\_html\_\_( 'Add-ons Page', 'paid-member-subscriptions' ) . '</a><a href="https://www.cozmoslabs.com/add-ons/paid-member-subscriptions-files-restriction/?utm\_source=wpbackend&utm\_medium=clientsite&utm\_content=plugin-notification-files&utm\_campaign=PMSFree" class="button-secondary" target="\_blank">' . esc\_html\_\_( 'Learn More', 'paid-member-subscriptions' ) . '</a></p>'; |
  | 105 |  | $message .= '<a href="' . esc\_url( ~~add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id )~~ ) ) . '#pms-addons-title" type="button" class="notice-dismiss"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  |  | 108 | $message .= '<a href="' . esc\_url( wp\_nonce\_url( add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id ) ), 'pms\_plugin\_notice\_dismiss' ) ) . '#pms-addons-title" type="button" class="notice-dismiss"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  | 106 | 109 |  |
  | 107 | 110 | pms\_add\_plugin\_notification( $notification\_id, $message, 'pms-notice pms-narrow notice notice-info', true, array( 'pms-settings-page' ) ); |
  | […](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3145313#L118) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-plugin-notifications.php?rev=3160323#L121) |  |
  | 118 | 121 | $message .= '<p style="margin-top: 16px;">' . wp\_kses\_post( '<strong>LearnDash Integration</strong> for <strong>Paid Member Subscriptions</strong> is now available!<br><br>Sell access to courses, create beautiful front-end register, login and reset password forms and restrict access to your Courses, Lessons and Quizzes.<br>Activate from the <a href="'.admin\_url( 'admin.php?page=pms-addons-page' ).'">add-ons</a> page.' ) . '</p>'; |
  | 119 | 122 | $message .= '<p><a href="https://www.cozmoslabs.com/add-ons/learndash/?utm\_source=wpbackend&utm\_medium=addon-notification&utm\_campaign=PMSPaid" class="button-primary" target="\_blank">' . esc\_html\_\_( 'Learn More', 'paid-member-subscriptions' ) . '</a></p>'; |
  | 120 |  | $message .= '<a href="' . esc\_url( ~~add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id )~~ ) ) . '" type="button" class="notice-dismiss"><span class="screen-reader-text" target="\_blank">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  |  | 123 | $message .= '<a href="' . esc\_url( wp\_nonce\_url( add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id ) ), 'pms\_plugin\_notice\_dismiss' ) ) . '" type="button" class="notice-dismiss"><span class="screen-reader-text" target="\_blank">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  | 121 | 124 |  |
  | 122 | 125 | pms\_add\_plugin\_notification( $notification\_id, $message, 'pms-notice pms-narrow notice notice-success', true, array( 'pms-addons-page' ) ); |
  | […](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3145313#L130) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-plugin-notifications.php?rev=3160323#L133) |  |
  | 130 | 133 | $message .= '<p><a style="min-width: auto !important;height:30px; margin-right: 12px;" href="https://www.cozmoslabs.com/wordpress-paid-member-subscriptions/?utm\_source=wpbackend&utm\_medium=addon-notification&utm\_campaign=PMSFree#pricing" class="button-primary" target="\_blank">' . esc\_html\_\_( 'Buy now', 'paid-member-subscriptions' ) . '</a>'; |
  | 131 | 134 | $message .= '<a href="https://www.cozmoslabs.com/add-ons/learndash/?utm\_source=wpbackend&utm\_medium=addon-notification&utm\_campaign=PMSFree" class="button button-secondary"  target="\_blank">' . esc\_html\_\_( 'Learn More', 'paid-member-subscriptions' ) . '</a></p>'; |
  | 132 |  | $message .= '<a href="' . esc\_url( ~~add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id )~~ ) ) . '" type="button" class="notice-dismiss"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  |  | 135 | $message .= '<a href="' . esc\_url( wp\_nonce\_url( add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id ) ), 'pms\_plugin\_notice\_dismiss' ) ) . '" type="button" class="notice-dismiss"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  | 133 | 136 |  |
  | 134 | 137 | pms\_add\_plugin\_notification( $notification\_id, $message, 'pms-notice pms-narrow notice notice-success', true, array( 'pms-addons-page' ) ); |
* ## [paid-member-subscriptions/tags/2.12.9/includes/functions-user-roles.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/functions-user-roles.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/functions-user-roles.php")

  | [r3031453](/browser/paid-member-subscriptions/trunk/includes/functions-user-roles.php?rev=3031453#L308 "Show revision 3031453 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/functions-user-roles.php?rev=3160323#L308 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 308 | 308 | } |
  | 309 | 309 | add\_action( 'pms\_abandon\_member\_subscription\_successful', 'pms\_member\_remove\_user\_role\_subscription\_abandoned', 10, 2 ); |
  |  | 310 |  |
  |  | 311 |  |
  |  | 312 | /\*\* |
  |  | 313 | \* Multiple Roles Selection |
  |  | 314 | \* |
  |  | 315 | \*/ |
  |  | 316 | class PMS\_Multiple\_Roles\_Selection { |
  |  | 317 |  |
  |  | 318 | function \_\_construct() { |
  |  | 319 |  |
  |  | 320 | // Add multiple roles checkbox to back-end Add / Edit User (as admin) |
  |  | 321 | add\_action( 'load-user-new.php', array( $this, 'actions\_on\_user\_new' ) ); |
  |  | 322 | add\_action( 'load-user-edit.php', array( $this, 'actions\_on\_user\_edit' ) ); |
  |  | 323 |  |
  |  | 324 | add\_action( 'load-profile.php', array( $this, 'actions\_on\_user\_new' ) ); |
  |  | 325 | add\_action( 'load-profile.php', array( $this, 'actions\_on\_user\_edit' ) ); |
  |  | 326 |  |
  |  | 327 | } |
  |  | 328 |  |
  |  | 329 | public function sanitize\_role( $role ) { |
  |  | 330 |  |
  |  | 331 | $role = strtolower( $role ); |
  |  | 332 | $role = wp\_strip\_all\_tags( $role ); |
  |  | 333 | $role = preg\_replace( '/[^a-z0-9\_\-\s]/', '', $role ); |
  |  | 334 | $role = str\_replace( ' ', '\_', $role ); |
  |  | 335 | $role = sanitize\_text\_field( $role ); |
  |  | 336 |  |
  |  | 337 | return $role; |
  |  | 338 |  |
  |  | 339 | } |
  |  | 340 |  |
  |  | 341 | // Add actions on Add User back-end page |
  |  | 342 | public function actions\_on\_user\_new() { |
  |  | 343 |  |
  |  | 344 | $this->scripts\_and\_styles\_actions( 'user\_new' ); |
  |  | 345 |  |
  |  | 346 | add\_action( 'user\_new\_form', array( $this, 'roles\_field\_user\_new' ) ); |
  |  | 347 |  |
  |  | 348 | add\_action( 'user\_register', array( $this, 'roles\_update\_user\_new' ) ); |
  |  | 349 |  |
  |  | 350 | } |
  |  | 351 |  |
  |  | 352 | // Add actions on Edit User back-end page |
  |  | 353 | public function actions\_on\_user\_edit() { |
  |  | 354 |  |
  |  | 355 | $this->scripts\_and\_styles\_actions( 'user\_edit' ); |
  |  | 356 |  |
  |  | 357 | add\_action( 'personal\_options', array( $this, 'roles\_field\_user\_edit' ) ); |
  |  | 358 |  |
  |  | 359 | add\_action( 'profile\_update', array( $this, 'roles\_update\_user\_edit' ), 10, 2 ); |
  |  | 360 |  |
  |  | 361 | } |
  |  | 362 |  |
  |  | 363 | // Roles Edit checkboxes for Add User back-end page |
  |  | 364 | public function roles\_field\_user\_new() { |
  |  | 365 |  |
  |  | 366 | if( ! current\_user\_can( 'promote\_users' ) ) { |
  |  | 367 | return; |
  |  | 368 | } |
  |  | 369 |  |
  |  | 370 | $user\_roles = apply\_filters( 'pms\_default\_user\_roles', array( get\_option( 'default\_role' ) ) ); |
  |  | 371 |  |
  |  | 372 | if( isset( $\_POST['createuser'] ) && ! empty( $\_POST['pms\_re\_user\_roles'] ) ) { |
  |  | 373 | $user\_roles = array\_map( array( $this, 'sanitize\_role' ), $\_POST['pms\_re\_user\_roles'] );// phpcs:ignore  WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  |  | 374 | } |
  |  | 375 |  |
  |  | 376 | wp\_nonce\_field( 'new\_user\_roles', 'pms\_re\_new\_user\_roles\_nonce' ); |
  |  | 377 |  |
  |  | 378 | if( apply\_filters( 'pms\_backend\_allow\_multiple\_user\_roles\_selection', true ) ) { |
  |  | 379 | $this->roles\_field\_display( $user\_roles ); |
  |  | 380 | } |
  |  | 381 |  |
  |  | 382 | } |
  |  | 383 |  |
  |  | 384 | // Roles Edit checkboxes for Edit User back-end page |
  |  | 385 | public function roles\_field\_user\_edit( $user ) { |
  |  | 386 |  |
  |  | 387 | if( ! current\_user\_can( 'promote\_users' ) || ! current\_user\_can( 'edit\_user', $user->ID ) ) { |
  |  | 388 | return; |
  |  | 389 | } |
  |  | 390 |  |
  |  | 391 | $user\_roles = (array) $user->roles; |
  |  | 392 |  |
  |  | 393 | wp\_nonce\_field( 'new\_user\_roles', 'pms\_re\_new\_user\_roles\_nonce' ); |
  |  | 394 |  |
  |  | 395 | if( apply\_filters( 'pms\_backend\_allow\_multiple\_user\_roles\_selection', true ) ) { |
  |  | 396 | $this->roles\_field\_display( $user\_roles ); |
  |  | 397 | } |
  |  | 398 | } |
  |  | 399 |  |
  |  | 400 | // Output roles edit checkboxes |
  |  | 401 | public function roles\_field\_display( $user\_roles ) { |
  |  | 402 |  |
  |  | 403 | $pms\_roles = get\_editable\_roles(); |
  |  | 404 |  |
  |  | 405 | ?> |
  |  | 406 | <table class="form-table"> |
  |  | 407 | <tr class="pms-re-edit-user"> |
  |  | 408 | <th><?php esc\_html\_e( 'Edit User Roles', 'paid-member-subscriptions' ); ?></th> |
  |  | 409 |  |
  |  | 410 | <td> |
  |  | 411 | <div> |
  |  | 412 | <ul style="margin: 5px 0;"> |
  |  | 413 | <?php foreach( $pms\_roles as $role\_slug => $role\_details ) { ?> |
  |  | 414 | <li> |
  |  | 415 | <label> |
  |  | 416 | <input type="checkbox" name="pms\_re\_user\_roles[]" value="<?php echo esc\_attr( $role\_slug ); ?>" <?php checked( in\_array( $role\_slug, $user\_roles ) ); ?> /> |
  |  | 417 | <?php echo esc\_html( translate\_user\_role( $role\_details['name'] ) ); ?> |
  |  | 418 | </label> |
  |  | 419 | </li> |
  |  | 420 | <?php } ?> |
  |  | 421 | </ul> |
  |  | 422 | </div> |
  |  | 423 | </td> |
  |  | 424 | </tr> |
  |  | 425 | </table> |
  |  | 426 |  |
  |  | 427 | <?php |
  |  | 428 | } |
  |  | 429 |  |
  |  | 430 | public function roles\_update\_user\_edit( $user\_id, $old\_user\_data ) { |
  |  | 431 |  |
  |  | 432 | if( ! current\_user\_can( 'promote\_users' ) || ! current\_user\_can( 'edit\_user', $user\_id ) ) { |
  |  | 433 | return; |
  |  | 434 | } |
  |  | 435 |  |
  |  | 436 | if( ! isset( $\_POST['pms\_re\_new\_user\_roles\_nonce'] ) || ! wp\_verify\_nonce( sanitize\_text\_field( $\_POST['pms\_re\_new\_user\_roles\_nonce'] ), 'new\_user\_roles' ) ) { |
  |  | 437 | return; |
  |  | 438 | } |
  |  | 439 |  |
  |  | 440 | $this->roles\_update\_user\_new\_and\_edit( $old\_user\_data ); |
  |  | 441 |  |
  |  | 442 | } |
  |  | 443 |  |
  |  | 444 | public function roles\_update\_user\_new( $user\_id ) { |
  |  | 445 |  |
  |  | 446 | if( ! current\_user\_can( 'promote\_users' ) ) { |
  |  | 447 | return; |
  |  | 448 | } |
  |  | 449 |  |
  |  | 450 | if( ! isset( $\_POST['pms\_re\_new\_user\_roles\_nonce'] ) || ! wp\_verify\_nonce( sanitize\_text\_field( $\_POST['pms\_re\_new\_user\_roles\_nonce'] ), 'new\_user\_roles' ) ) { |
  |  | 451 | return; |
  |  | 452 | } |
  |  | 453 |  |
  |  | 454 | $user = new \WP\_User( $user\_id ); |
  |  | 455 |  |
  |  | 456 | $this->roles\_update\_user\_new\_and\_edit( $user ); |
  |  | 457 |  |
  |  | 458 | } |
  |  | 459 |  |
  |  | 460 | public function roles\_update\_user\_new\_and\_edit( $user ) { |
  |  | 461 |  |
  |  | 462 | if( ! empty( $\_POST['pms\_re\_user\_roles'] ) || !empty( $\_POST['role'] ) ) { |
  |  | 463 |  |
  |  | 464 | $old\_roles = (array) $user->roles; |
  |  | 465 |  |
  |  | 466 | if( isset( $\_POST['pms\_re\_user\_roles'] ) ) |
  |  | 467 | $new\_roles = array\_map( array( $this, 'sanitize\_role' ), $\_POST['pms\_re\_user\_roles'] );//phpcs:ignore  WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  |  | 468 | else |
  |  | 469 | $new\_roles = array( $this->sanitize\_role( $\_POST['role'] ) ); //phpcs:ignore  WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  |  | 470 |  |
  |  | 471 | foreach( $new\_roles as $new\_role ) { |
  |  | 472 | if( ! in\_array( $new\_role, (array) $user->roles ) ) { |
  |  | 473 | $user->add\_role( $new\_role ); |
  |  | 474 | } |
  |  | 475 | } |
  |  | 476 |  |
  |  | 477 | foreach( $old\_roles as $old\_role ) { |
  |  | 478 | if( ! in\_array( $old\_role, $new\_roles ) ) { |
  |  | 479 | $user->remove\_role( $old\_role ); |
  |  | 480 | } |
  |  | 481 | } |
  |  | 482 | } else { |
  |  | 483 | foreach( (array) $user->roles as $old\_role ) { |
  |  | 484 | $user->remove\_role( $old\_role ); |
  |  | 485 | } |
  |  | 486 | } |
  |  | 487 |  |
  |  | 488 | } |
  |  | 489 |  |
  |  | 490 | public function scripts\_and\_styles\_actions( $location ) { |
  |  | 491 |  |
  |  | 492 | // Enqueue jQuery on both Add User and Edit User back-end pages |
  |  | 493 | add\_action( 'admin\_enqueue\_scripts', array( $this, 'enqueue\_jquery' ) ); |
  |  | 494 |  |
  |  | 495 | // Actions for Add User back-end page |
  |  | 496 | if( $location == 'user\_new' && apply\_filters( 'pms\_backend\_allow\_multiple\_user\_roles\_selection', true ) ) { |
  |  | 497 | add\_action( 'admin\_footer', array( $this, 'print\_scripts\_user\_new' ), 25 ); |
  |  | 498 | } |
  |  | 499 |  |
  |  | 500 | // Actions for Edit User back-end page |
  |  | 501 | if( $location == 'user\_edit' && apply\_filters( 'pms\_backend\_allow\_multiple\_user\_roles\_selection', true ) ) { |
  |  | 502 | add\_action( 'admin\_head', array( $this, 'print\_styles\_user\_edit' ) ); |
  |  | 503 | add\_action( 'admin\_footer', array( $this, 'print\_scripts\_user\_edit' ), 25 ); |
  |  | 504 | } |
  |  | 505 |  |
  |  | 506 | } |
  |  | 507 |  |
  |  | 508 | // Enqueue jQuery where needed (use action) |
  |  | 509 | public function enqueue\_jquery() { |
  |  | 510 |  |
  |  | 511 | wp\_enqueue\_script( 'jquery' ); |
  |  | 512 |  |
  |  | 513 | } |
  |  | 514 |  |
  |  | 515 | // Print scripts on Add User back-end page |
  |  | 516 | public function print\_scripts\_user\_new() { |
  |  | 517 |  |
  |  | 518 | ?> |
  |  | 519 | <script> |
  |  | 520 | jQuery( document ).ready( function() { |
  |  | 521 | // Remove WordPress default Role Select |
  |  | 522 | var roles\_dropdown = jQuery( 'select#role' ); |
  |  | 523 | roles\_dropdown.closest( 'tr' ).remove(); |
  |  | 524 | } ); |
  |  | 525 | </script> |
  |  | 526 |  |
  |  | 527 | <?php |
  |  | 528 | } |
  |  | 529 |  |
  |  | 530 | // Print scripts on Edit User back-end page |
  |  | 531 | public function print\_scripts\_user\_edit() { |
  |  | 532 |  |
  |  | 533 | ?> |
  |  | 534 | <script> |
  |  | 535 | jQuery( document ).ready( |
  |  | 536 | // Remove WordPress default Role Select |
  |  | 537 | function() { |
  |  | 538 | jQuery( '.user-role-wrap' ).remove(); |
  |  | 539 | } |
  |  | 540 | ); |
  |  | 541 | </script> |
  |  | 542 |  |
  |  | 543 | <?php |
  |  | 544 | } |
  |  | 545 |  |
  |  | 546 | // Print scripts on Edit User back-end page |
  |  | 547 | public function print\_styles\_user\_edit() { |
  |  | 548 |  |
  |  | 549 | ?> |
  |  | 550 | <style type="text/css"> |
  |  | 551 | /\* Hide WordPress default Role Select \*/ |
  |  | 552 | .user-role-wrap { |
  |  | 553 | display: none !important; |
  |  | 554 | } |
  |  | 555 | </style> |
  |  | 556 |  |
  |  | 557 | <?php |
  |  | 558 | } |
  |  | 559 |  |
  |  | 560 | } |
  |  | 561 |  |
  |  | 562 | if ( ! function\_exists( 'is\_plugin\_active' ) ) { |
  |  | 563 | require\_once( ABSPATH . 'wp-admin/includes/plugin.php' ); |
  |  | 564 | } |
  |  | 565 |  |
  |  | 566 | $wppb\_generalSettings = get\_option( 'wppb\_general\_settings', 'not\_found' ); |
  |  | 567 |  |
  |  | 568 | if(  ! is\_plugin\_active( 'profile-builder/index.php' ) || $wppb\_generalSettings == 'not\_found' || empty( $wppb\_generalSettings['rolesEditor'] ) || $wppb\_generalSettings['rolesEditor'] !== 'yes'  ) { |
  |  | 569 | $pms\_role\_editor\_instance = new PMS\_Multiple\_Roles\_Selection(); |
  |  | 570 | } |
* ## [paid-member-subscriptions/tags/2.12.9/includes/gateways/paypal\_standard/functions-paypal-standard.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/gateways/paypal_standard/functions-paypal-standard.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/gateways/paypal_standard/functions-paypal-standard.php")

  | [r2949078](/browser/paid-member-subscriptions/trunk/includes/gateways/paypal_standard/functions-paypal-standard.php?rev=2949078#L50 "Show revision 2949078 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/gateways/paypal_standard/functions-paypal-standard.php?rev=3160323#L50 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 50 | 50 |  |
  | 51 | 51 | <?php if( in\_array( 'paypal\_standard', $options['active\_pay\_gates'] ) ) : ?> |
  | 52 |  | <?php $paypal\_ipn\_url = esc\_url( add\_query\_arg( 'pay\_gate\_listener', 'paypal\_ipn', trailingslashit( home\_url() ) ) ); ?> |
  |  | 52 | <?php |
  |  | 53 | $paypal\_ipn\_url = esc\_url( add\_query\_arg( 'pay\_gate\_listener', 'paypal\_ipn', trailingslashit( home\_url() ) ) ); |
  |  | 54 | $paypal\_link\_doc = '<a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/payment-gateways/paypal-standard/#Setting\_up\_Instant\_Payment\_Notifications\_IPN" target="\_blank" data-code="f223" class="pms-docs-link dashicons dashicons-editor-help"></a>'; |
  |  | 55 | ?> |
  | 53 | 56 | <?php elseif( in\_array( 'paypal\_express', $options['active\_pay\_gates'] ) ) : ?> |
  | 54 |  | <?php $paypal\_ipn\_url = esc\_url( add\_query\_arg( 'pay\_gate\_listener', 'paypal\_epipn', trailingslashit( home\_url() ) ) ); ?> |
  |  | 57 | <?php |
  |  | 58 | $paypal\_ipn\_url = esc\_url( add\_query\_arg( 'pay\_gate\_listener', 'paypal\_epipn', trailingslashit( home\_url() ) ) ); |
  |  | 59 | $paypal\_link\_doc = '<a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/add-ons/paypal-pro-and-express-checkout/#Setting\_up\_Instant\_Payment\_Notifications\_IPN" target="\_blank" data-code="f223" class="pms-docs-link dashicons dashicons-editor-help"></a>'; |
  |  | 60 | ?> |
  | 55 | 61 | <?php else: ?> |
  | 56 | 62 | <?php $paypal\_ipn\_url = ""; ?> |
  | […](/browser/paid-member-subscriptions/trunk/includes/gateways/paypal_standard/functions-paypal-standard.php?rev=2949078#L64) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/gateways/paypal_standard/functions-paypal-standard.php?rev=3160323#L70) |  |
  | 64 | 70 |  |
  | 65 | 71 | <p class="pms-ipn-notice cozmoslabs-description cozmoslabs-description-space-left"> |
  | 66 |  | <?php printf( wp\_kses\_post( \_\_( 'In order for <strong>PayPal payments to work correctly</strong>, you need to setup the IPN Url in your PayPal account. %s', 'paid-member-subscriptions' ) ), ~~'<a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/add-ons/recurring-payments-for-paypal-standard/?utm\_source=wpbackend&utm\_medium=pms-documentation&utm\_campaign=PMSDocs#Setting\_up\_Instant\_Payment\_Notifications\_IPN" target="\_blank" data-code="f223" class="pms-docs-link dashicons dashicons-editor-help"></a>'~~ ); ?> |
  |  | 72 | <?php printf( wp\_kses\_post( \_\_( 'In order for <strong>PayPal payments to work correctly</strong>, you need to setup the IPN Url in your PayPal account. %s', 'paid-member-subscriptions' ) ), wp\_kses\_post( $paypal\_link\_doc ) ); ?> |
  | 67 | 73 | </p> |
  | 68 | 74 | </div> |
* ## [paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/admin/functions-admin-connect.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/admin/functions-admin-connect.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/admin/functions-admin-connect.php")

  | [r3118211](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/admin/functions-admin-connect.php?rev=3118211#L574 "Show revision 3118211 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/admin/functions-admin-connect.php?rev=3160323#L574 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 574 | 574 | echo '<input id="stripe-connect-webhook-url" type="text" name="stripe\_connect\_webhook\_url" value="' . esc\_url( add\_query\_arg( 'pay\_gate\_listener', 'stripe', trailingslashit( home\_url() ) ) ) . '" class="widefat" disabled /><a class="stripe-connect\_\_copy button-secondary" data-id="stripe-connect-webhook-url" href="" style="margin-left: 4px;">Copy</a>'; |
  | 575 | 575 |  |
  | 576 |  | echo '<p class="cozmoslabs-description cozmoslabs-description-space-left">' . wp\_kses\_post( sprintf( \_\_( 'Copy this URL and configure it in your Stripe Account~~under Developers -> Webhooks -> Add Endpoint. %sClick here%s to see the list of necessary events and learn more. ', 'paid-member-subscriptions' ), '<br><a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/payment-gateways/stripe-connect/~~">', '</a>' ) ) . '</p>'; |
  |  | 576 | echo '<p class="cozmoslabs-description cozmoslabs-description-space-left">' . wp\_kses\_post( sprintf( \_\_( 'Copy this URL and configure it in your Stripe Account. %sClick here%s to learn more about the Webhooks setup process. ', 'paid-member-subscriptions' ), '<br><a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/payment-gateways/stripe-connect/#Webhooks\_setup">', '</a>' ) ) . '</p>'; |
  | 577 | 577 |  |
  | 578 | 578 | echo '</div>'; |
* ## [paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/assets/front-end-connect.js](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/assets/front-end-connect.js "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/assets/front-end-connect.js")

  | [r3145313](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js?rev=3145313#L124 "Show revision 3145313 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/assets/front-end-connect.js?rev=3160323#L124 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 124 | 124 | // Payment Intents |
  | 125 | 125 | $(document).on( 'wppb\_invisible\_recaptcha\_success', stripeConnectPaymentGatewayHandler ) |
  |  | 126 | $(document).on( 'wppb\_v3\_recaptcha\_success', stripeConnectPaymentGatewayHandler ) |
  | 126 | 127 |  |
  | 127 | 128 | $(document).on('submit', '.pms-form', function (e) { |
  | 128 | 129 |  |
  | 129 |  | if( e.target && ( jQuery( e.target ).attr('id') == 'pms\_recover\_password\_form' || jQuery( e.target ).attr('id') == 'pms\_new\_password\_form' ) ) |
  |  | 130 | if( e.target && ( jQuery( e.target ).attr('id') == 'pms\_recover\_password\_form' || jQuery( e.target ).attr('id') == 'pms\_new\_password\_form' || jQuery( e.target ).attr('id') == 'pms\_login' ) ) |
  | 130 | 131 | return |
  | 131 | 132 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js?rev=3145313#L153) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/assets/front-end-connect.js?rev=3160323#L154) |  |
  | 153 | 154 | $(document).on('submit', '.wppb-register-user', function (e) { |
  | 154 | 155 |  |
  | 155 |  | if ( !~~$('.wppb-recaptcha .wppb-recaptcha-element', $(e.currentTarget)).hasClass('wppb-invisible-recaptcha'~~) ) { |
  |  | 156 | if ( ! ( $( '.wppb-recaptcha .wppb-recaptcha-element', $(e.currentTarget) ).hasClass( 'wppb-invisible-recaptcha' ) || $( '.wppb-recaptcha .wppb-recaptcha-element', $(e.currentTarget) ).hasClass( 'wppb-v3-recaptcha' ) ) ) { |
  | 156 | 157 |  |
  | 157 | 158 | var target\_button = $('input[type="submit"], button[type="submit"]', $(this)).not('#pms-apply-discount').not('input[name="pms\_redirect\_back"]') |
  | […](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js?rev=3145313#L178) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/assets/front-end-connect.js?rev=3160323#L179) |  |
  | 178 | 179 |  |
  | 179 | 180 | // Current submit button can't be determined from `this` context in case of the Invisible reCaptcha handler |
  | 180 |  | if( e.type == 'wppb\_invisible\_recaptcha\_success' ){ |
  |  | 181 | if( e.type == 'wppb\_invisible\_recaptcha\_success' || e.type == 'wppb\_v3\_recaptcha\_success' ){ |
  | 181 | 182 |  |
  | 182 | 183 | // target\_button is supplied to the handler starting with version 3.5.0 of Profile Builder, we use this for backwards compatibility |
  | […](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js?rev=3145313#L418) | […](/browser/paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/assets/front-end-connect.js?rev=3160323#L419) |  |
  | 418 | 419 | return |
  | 419 | 420 |  |
  | 420 |  | var submitButton = $('.pms-form .pms-form-submit, .pms-form input[type="submit"], .pms-form button[type="submit"], .wppb-register-user input[type="submit"], .wppb-register-user button[type="submit"]').not('#pms-apply-discount') |
  |  | 421 | var submitButton = $('.pms-form .pms-form-submit, .pms-form input[type="submit"], .pms-form button[type="submit"], .wppb-register-user input[type="submit"], .wppb-register-user button[type="submit"]').not('#pms-apply-discount, .login-submit #wp-submit') |
  | 421 | 422 |  |
  | 422 | 423 | var data = stripeConnectGetFormData( submitButton ) |
* ## [paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/class-payment-gateway-stripe-connect.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/class-payment-gateway-stripe-connect.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/class-payment-gateway-stripe-connect.php")

  | [r3145313](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/class-payment-gateway-stripe-connect.php?rev=3145313#L2500 "Show revision 3145313 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/includes/gateways/stripe/class-payment-gateway-stripe-connect.php?rev=3160323#L2500 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 2500 | 2500 | if( !empty( $plans ) ){ |
  | 2501 | 2501 | foreach( $plans as $plan ){ |
  | 2502 |  | if( !empty( $plan->price ) ){ |
  |  | 2502 | if( !empty( $plan->price ) && $plan->price > 1 ){ |
  | 2503 | 2503 | $amount = $plan->price; |
  | 2504 | 2504 | break; |
* ## [paid-member-subscriptions/tags/2.12.9/index.php](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/index.php "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/index.php")

  | [r3149295](/browser/paid-member-subscriptions/trunk/index.php?rev=3149295#L4 "Show revision 3149295 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/index.php?rev=3160323#L4 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: http://www.cozmoslabs.com/ |
  | 5 | 5 | \* Description: Accept payments, create subscription plans and restrict content on your membership website. |
  | 6 |  | \* Version: 2.12.~~8~~ |
  |  | 6 | \* Version: 2.12.9 |
  | 7 | 7 | \* Author: Cozmoslabs |
  | 8 | 8 | \* Author URI: http://www.cozmoslabs.com/ |
  | […](/browser/paid-member-subscriptions/trunk/index.php?rev=3149295#L11) | […](/browser/paid-member-subscriptions/tags/2.12.9/index.php?rev=3160323#L11) |  |
  | 11 | 11 | \* License: GPL2 |
  | 12 | 12 | \* WC requires at least: 3.0.0 |
  | 13 |  | \* WC tested up to: 9.~~2~~ |
  | 14 |  | \* Elementor tested up to: 3.24.~~0~~ |
  | 15 |  | \* Elementor Pro tested up to: 3.24.~~0~~ |
  |  | 13 | \* WC tested up to: 9.3 |
  |  | 14 | \* Elementor tested up to: 3.24.4 |
  |  | 15 | \* Elementor Pro tested up to: 3.24.4 |
  | 16 | 16 | \* |
  | 17 | 17 | \* == Copyright == |
  | […](/browser/paid-member-subscriptions/trunk/index.php?rev=3149295#L40) | […](/browser/paid-member-subscriptions/tags/2.12.9/index.php?rev=3160323#L40) |  |
  | 40 | 40 | public function \_\_construct() { |
  | 41 | 41 |  |
  | 42 |  | define( 'PMS\_VERSION', '2.12.~~8~~' ); |
  |  | 42 | define( 'PMS\_VERSION', '2.12.9' ); |
  | 43 | 43 | define( 'PMS\_PLUGIN\_DIR\_PATH', plugin\_dir\_path( \_\_FILE\_\_ ) ); |
  | 44 | 44 | define( 'PMS\_PLUGIN\_DIR\_URL', plugin\_dir\_url( \_\_FILE\_\_ ) ); |
  | […](/browser/paid-member-subscriptions/trunk/index.php?rev=3149295#L886) | […](/browser/paid-member-subscriptions/tags/2.12.9/index.php?rev=3160323#L886) |  |
  | 886 | 886 | if( file\_exists( PMS\_PLUGIN\_DIR\_PATH . 'includes/admin/pricing-table-designs/pricing-table-designs.php' ) ) |
  | 887 | 887 | include\_once PMS\_PLUGIN\_DIR\_PATH . 'includes/admin/pricing-table-designs/pricing-table-designs.php'; |
  | 888 |  |  |
  | 889 | 888 |  |
  | 890 | 889 | /\* |
* ## [paid-member-subscriptions/tags/2.12.9/readme.txt](/changeset/3160323/paid-member-subscriptions/tags/2.12.9/readme.txt "Show the changeset 3160323 restricted to paid-member-subscriptions/tags/2.12.9/readme.txt")

  | [r3149295](/browser/paid-member-subscriptions/trunk/readme.txt?rev=3149295#L5 "Show revision 3149295 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/tags/2.12.9/readme.txt?rev=3160323#L5 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires at least: 3.1 |
  | 6 | 6 | Tested up to: 6.6 |
  | 7 |  | Stable tag: 2.12.~~8~~ |
  |  | 7 | Stable tag: 2.12.9 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: https://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/paid-member-subscriptions/trunk/readme.txt?rev=3149295#L60) | […](/browser/paid-member-subscriptions/tags/2.12.9/readme.txt?rev=3160323#L60) |  |
  | 60 | 60 | \* \*\*[pms-payment-history]\*\* - adds a front-end table with the member's payment history |
  | 61 | 61 | \* \*\*[pms-recover-password]\*\* - adds a recover password password form, that enables users to reset their password if needed |
  | 62 |  |  |
  | 63 |  | ~~https://www.youtube.com/watch?v=6AEIvvCOZHM&start=0&autoplay=1~~ |
  | 64 | 62 |  |
  | 65 | 63 | = Membership Modules: = |
  | […](/browser/paid-member-subscriptions/trunk/readme.txt?rev=3149295#L253) | […](/browser/paid-member-subscriptions/tags/2.12.9/readme.txt?rev=3160323#L251) |  |
  | 253 | 251 |  |
  | 254 | 252 | == Changelog == |
  |  | 253 | = 2.12.9 = |
  |  | 254 | \* Feature: Added option to exclude restricted posts from default queries. Go to Settings -> Content Restriction to enable this functionality |
  |  | 255 | \* Feature: Implemented a Multiple User Role selection functionality for the Users -> Edit User page |
  |  | 256 | \* Fix: Did a security review fixing random issues |
  |  | 257 | \* Fix: Security issue regarding unproperly sanitized URLs around some back-end pages. Thanks to Colin Xu from Wordfence |
  |  | 258 | \* Fix: Issue with Stripe when both Login and Register forms were present on the same page |
  |  | 259 | \* Misc: Corrected some documentation links |
  |  | 260 | \* Misc: Let the Stripe Payment Element grow naturally with the form width |
  |  | 261 |  |
  | 255 | 262 | = 2.12.8 = |
  | 256 | 263 | \* Fix: Incorrect spelling on cancel button title |
* ## [paid-member-subscriptions/trunk/assets/js/admin/meta-box-subscription-details.js](/changeset/3160323/paid-member-subscriptions/trunk/assets/js/admin/meta-box-subscription-details.js "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/assets/js/admin/meta-box-subscription-details.js")

  | [r3127842](/browser/paid-member-subscriptions/trunk/assets/js/admin/meta-box-subscription-details.js?rev=3127842#L26 "Show revision 3127842 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/assets/js/admin/meta-box-subscription-details.js?rev=3160323#L26 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 26 | 26 |  |
  | 27 | 27 | alert( 'Subscription Plan duration must be a whole number.' ); |
  |  | 28 |  |
  |  | 29 | return false; |
  |  | 30 | } |
  |  | 31 |  |
  |  | 32 | var subscription\_plan\_price = $('#pms-subscription-plan-price').val().trim(); |
  |  | 33 |  |
  |  | 34 | if( parseFloat( subscription\_plan\_price ) < 1 ) { |
  |  | 35 |  |
  |  | 36 | alert( 'Subscription Plan price must be at least 1.' ); |
  | 28 | 37 |  |
  | 29 | 38 | return false; |
* ## [paid-member-subscriptions/trunk/extend/tutor-lms/class-pms-tutor-lms.php](/changeset/3160323/paid-member-subscriptions/trunk/extend/tutor-lms/class-pms-tutor-lms.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/extend/tutor-lms/class-pms-tutor-lms.php")

  | [r3093002](/browser/paid-member-subscriptions/trunk/extend/tutor-lms/class-pms-tutor-lms.php?rev=3093002#L1089 "Show revision 3093002 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/extend/tutor-lms/class-pms-tutor-lms.php?rev=3160323#L1089 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 1089 | 1089 | $message .= '<p style="margin-top: 16px;">' . wp\_kses\_post( '<strong>Tutor LMS Integration</strong> for <strong>Paid Member Subscriptions</strong> is now available!<br><br>Sell access to courses, create beautiful front-end register, login and reset password forms and restrict access to your Courses.<br>Enable by selecting <strong>Paid Member Subscriptions</strong> as the eCommerce Engine in <a href="'. esc\_url( admin\_url( 'admin.php?page=tutor\_settings&tab\_page=monetization' ) ) .'">Tutor LMS --> Settings --> Monetization</a>.' ) . '</p>'; |
  | 1090 | 1090 | $message .= '<p><a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/integration-with-other-plugins/tutor-lms/?utm\_source=wpbackend&utm\_medium=pms-documentation&utm\_campaign=PMSDocs" class="button-primary" target="\_blank">' . esc\_html\_\_( 'Learn More', 'paid-member-subscriptions' ) . '</a></p>'; |
  | 1091 |  | $message .= '<a href="' . esc\_url( ~~add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id )~~ ) ) . '" type="button" class="notice-dismiss" style="text-decoration: none;"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  |  | 1091 | $message .= '<a href="' . esc\_url( wp\_nonce\_url( add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id ) ), 'pms\_plugin\_notice\_dismiss' ) ) . '" type="button" class="notice-dismiss" style="text-decoration: none;"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  | 1092 | 1092 |  |
  | 1093 | 1093 | pms\_add\_plugin\_notification( $notification\_id, $message, 'pms-notice pms-narrow notice notice-success', true, array( 'pms-addons-page' ) ); |
* ## [paid-member-subscriptions/trunk/includes/admin/class-admin-dashboard.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/class-admin-dashboard.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/class-admin-dashboard.php")

  | [r2995200](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-dashboard.php?rev=2995200#L99 "Show revision 2995200 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-dashboard.php?rev=3160323#L99 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 99 | 99 | public function get\_dashboard\_stats(){ |
  | 100 | 100 | check\_admin\_referer( 'pms\_dashboard\_get\_stats' ); |
  |  | 101 |  |
  |  | 102 | if( !current\_user\_can( 'manage\_options' ) ) |
  |  | 103 | die(); |
  | 101 | 104 |  |
  | 102 | 105 | if( empty( $\_POST['interval'] ) ) |
* ## [paid-member-subscriptions/trunk/includes/admin/class-admin-export.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/class-admin-export.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/class-admin-export.php")

  | [r2569272](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-export.php?rev=2569272#L99 "Show revision 2569272 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-export.php?rev=3160323#L99 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 99 | 99 | ) ); |
  | 100 | 100 |  |
  | 101 |  | $download\_url = ~~add\_query\_arg( $args, admin\_url(~~) ); |
  |  | 101 | $download\_url = esc\_url( add\_query\_arg( $args, admin\_url() ) ); |
  | 102 | 102 |  |
  | 103 | 103 | echo json\_encode( array( 'step' => 'done', 'url' => $download\_url ) ); exit; |
* ## [paid-member-subscriptions/trunk/includes/admin/class-admin-member-payments-list-table.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/class-admin-member-payments-list-table.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/class-admin-member-payments-list-table.php")

  | [r2939341](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-member-payments-list-table.php?rev=2939341#L174 "Show revision 2939341 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-member-payments-list-table.php?rev=3160323#L174 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 174 | 174 | public function column\_actions( $item ) { |
  | 175 | 175 |  |
  | 176 |  | $actions = '<a class="button-secondary" href="' . ~~add\_query\_arg( array( 'page' => 'pms-payments-page', 'pms-action' => 'edit\_payment', 'payment\_id' => $item['actions'] ), admin\_url( 'admin.php'~~ ) ) . '">' . \_\_( 'View Details', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 176 | $actions = '<a class="button-secondary" href="' . esc\_url( add\_query\_arg( array( 'page' => 'pms-payments-page', 'pms-action' => 'edit\_payment', 'payment\_id' => $item['actions'] ), admin\_url( 'admin.php' ) ) ) . '">' . \_\_( 'View Details', 'paid-member-subscriptions' ) . '</a>'; |
  | 177 | 177 |  |
  | 178 | 178 | return apply\_filters( 'pms\_member\_payments\_list\_table\_actions', $actions, $item ); |
* ## [paid-member-subscriptions/trunk/includes/admin/class-admin-member-subscription-list-table.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/class-admin-member-subscription-list-table.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/class-admin-member-subscription-list-table.php")

  | [r2835897](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-member-subscription-list-table.php?rev=2835897#L334 "Show revision 2835897 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-member-subscription-list-table.php?rev=3160323#L334 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 334 | 334 | $output = '<div class="row-actions">'; |
  | 335 | 335 |  |
  | 336 |  | $output .= '<a href="' . ~~add\_query\_arg( array( 'page' => 'pms-members-page', 'subpage' => 'edit\_subscription', 'subscription\_id' => $item['subscription\_id'] ), 'admin.php'~~ ) . '" class="button button-secondary">' . \_\_( 'Edit', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 336 | $output .= '<a href="' . esc\_url( add\_query\_arg( array( 'page' => 'pms-members-page', 'subpage' => 'edit\_subscription', 'subscription\_id' => $item['subscription\_id'] ), 'admin.php' ) ) . '" class="button button-secondary">' . \_\_( 'Edit', 'paid-member-subscriptions' ) . '</a>'; |
  | 337 | 337 |  |
  | 338 | 338 | $output = apply\_filters( 'pms\_member\_subscription\_list\_table\_column\_actions', $output, $item ); |
* ## [paid-member-subscriptions/trunk/includes/admin/class-admin-members-add-new-bulk-list-table.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/class-admin-members-add-new-bulk-list-table.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/class-admin-members-add-new-bulk-list-table.php")

  | [r2962413](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-add-new-bulk-list-table.php?rev=2962413#L368 "Show revision 2962413 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-add-new-bulk-list-table.php?rev=3160323#L368 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 368 | 368 |  |
  | 369 | 369 | // Add an edit user action for each member |
  | 370 |  | $actions['view\_user'] = '<a href="' . ~~add\_query\_arg( array( 'user\_id' => $item['user\_id']), admin\_url('user-edit.php'~~) ) . '">' . esc\_html\_\_( 'Edit User', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 370 | $actions['view\_user'] = '<a href="' . esc\_url( add\_query\_arg( array( 'user\_id' => $item['user\_id']), admin\_url('user-edit.php') ) ) . '">' . esc\_html\_\_( 'Edit User', 'paid-member-subscriptions' ) . '</a>'; |
  | 371 | 371 |  |
  | 372 | 372 | // Return value saved for username and also the row actions |
* ## [paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php")

  | [r2799943](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=2799943#L191 "Show revision 2799943 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=3160323#L191 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 191 | 191 |  |
  | 192 | 192 | return apply\_filters( 'pms\_members\_list\_table\_get\_views', array( |
  | 193 |  | 'all'       => '<a href="' . ~~remove\_query\_arg( array( 'pms-view', 'paged'~~ ) ) . '" ' . ( !isset( $\_GET['pms-view'] ) ? 'class="current"' : '' ) . '>All <span class="count">(' . ( isset( $this->views\_count['all'] ) ? $this->views\_count['all'] : '' ) . ')</span></a>', |
  | 194 |  | 'active'    => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'active', 'paged' => 1~~ ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'active' ? 'class="current"' : '' ) . '>Active <span class="count">(' . ( isset( $this->views\_count['active'] ) ? $this->views\_count['active'] : '' ) . ')</span></a>', |
  | 195 |  | 'canceled'  => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'canceled', 'paged' => 1~~ ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'canceled' ? 'class="current"' : '' ) . '>Canceled <span class="count">(' . ( isset( $this->views\_count['canceled'] ) ? $this->views\_count['canceled'] : '' ) . ')</span></a>', |
  | 196 |  | 'expired'   => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'expired', 'paged' => 1~~ ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'expired' ? 'class="current"' : '' ) . '>Expired <span class="count">(' . ( isset( $this->views\_count['expired'] ) ? $this->views\_count['expired'] : '' ) . ')</span></a>', |
  | 197 |  | 'pending'   => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'pending', 'paged' => 1~~ ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'pending' ? 'class="current"' : '' ) . '>Pending <span class="count">(' . ( isset( $this->views\_count['pending'] ) ? $this->views\_count['pending'] : '' ) . ')</span></a>', |
  | 198 |  | 'abandoned' => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'abandoned', 'paged' => 1~~ ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'abandoned' ? 'class="current"' : '' ) . '>Abandoned <span class="count">(' . ( isset( $this->views\_count['abandoned'] ) ? $this->views\_count['abandoned'] : '' ) . ')</span></a>', |
  |  | 193 | 'all'       => '<a href="' . esc\_url( remove\_query\_arg( array( 'pms-view', 'paged' ) ) ) . '" ' . ( !isset( $\_GET['pms-view'] ) ? 'class="current"' : '' ) . '>All <span class="count">(' . ( isset( $this->views\_count['all'] ) ? $this->views\_count['all'] : '' ) . ')</span></a>', |
  |  | 194 | 'active'    => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'active', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'active' ? 'class="current"' : '' ) . '>Active <span class="count">(' . ( isset( $this->views\_count['active'] ) ? $this->views\_count['active'] : '' ) . ')</span></a>', |
  |  | 195 | 'canceled'  => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'canceled', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'canceled' ? 'class="current"' : '' ) . '>Canceled <span class="count">(' . ( isset( $this->views\_count['canceled'] ) ? $this->views\_count['canceled'] : '' ) . ')</span></a>', |
  |  | 196 | 'expired'   => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'expired', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'expired' ? 'class="current"' : '' ) . '>Expired <span class="count">(' . ( isset( $this->views\_count['expired'] ) ? $this->views\_count['expired'] : '' ) . ')</span></a>', |
  |  | 197 | 'pending'   => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'pending', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'pending' ? 'class="current"' : '' ) . '>Pending <span class="count">(' . ( isset( $this->views\_count['pending'] ) ? $this->views\_count['pending'] : '' ) . ')</span></a>', |
  |  | 198 | 'abandoned' => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'abandoned', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'abandoned' ? 'class="current"' : '' ) . '>Abandoned <span class="count">(' . ( isset( $this->views\_count['abandoned'] ) ? $this->views\_count['abandoned'] : '' ) . ')</span></a>', |
  | 199 | 199 | )); |
  | 200 | 200 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=2799943#L385) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=3160323#L385) |  |
  | 385 | 385 | $data[] = apply\_filters( 'pms\_members\_list\_table\_entry\_data', array( |
  | 386 | 386 | 'user\_id'           => $member->user\_id, |
  | 387 |  | 'username'          => '<strong><a href="' . ~~add\_query\_arg( array( 'subpage' => 'edit\_member', 'member\_id' => $member->user\_id ), admin\_url( 'admin.php?page=pms-members-page'~~ ) ) . '">' . esc\_attr( $member->username ) . '</a></strong>', |
  |  | 387 | 'username'          => '<strong><a href="' . esc\_url( add\_query\_arg( array( 'subpage' => 'edit\_member', 'member\_id' => $member->user\_id ), admin\_url( 'admin.php?page=pms-members-page' ) ) ) . '">' . esc\_attr( $member->username ) . '</a></strong>', |
  | 388 | 388 | 'name'              => $member\_name, |
  | 389 | 389 | 'email'             => $member->email, |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=2799943#L463) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=3160323#L463) |  |
  | 463 | 463 |  |
  | 464 | 464 | // Add an edit user action for each member |
  | 465 |  | $actions['edit'] = '<a href="' . ~~add\_query\_arg( array( 'subpage' => 'edit\_member', 'member\_id' => $item['user\_id'] ), admin\_url( 'admin.php?page=pms-members-page'~~ ) ) . '">' . esc\_html\_\_( 'Edit Member', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 465 | $actions['edit'] = '<a href="' . esc\_url( add\_query\_arg( array( 'subpage' => 'edit\_member', 'member\_id' => $item['user\_id'] ), admin\_url( 'admin.php?page=pms-members-page' ) ) ) . '">' . esc\_html\_\_( 'Edit Member', 'paid-member-subscriptions' ) . '</a>'; |
  | 466 | 466 |  |
  | 467 | 467 | // Return value saved for username and also the row actions |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=2799943#L502) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=3160323#L502) |  |
  | 502 | 502 | $output .= '<span class="pms-member-list-subscription pms-has-bubble">'; |
  | 503 | 503 |  |
  | 504 |  | $output .= '<a href="' . ~~add\_query\_arg( array( 'subpage' => 'edit\_subscription', 'subscription\_id' => $member\_subscription->id~~ ) ) . '">'; |
  |  | 504 | $output .= '<a href="' . esc\_url( add\_query\_arg( array( 'subpage' => 'edit\_subscription', 'subscription\_id' => $member\_subscription->id ) ) ) . '">'; |
  | 505 | 505 | $output .= apply\_filters( 'pms\_list\_table\_' . $this->\_args['plural'] . '\_show\_status\_dot', '<span class="pms-status-dot ' . esc\_attr( $member\_subscription->status ) . '"></span>' ); |
  | 506 | 506 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=2799943#L539) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members-list-table.php?rev=3160323#L539) |  |
  | 539 | 539 | $sign = '+'; |
  | 540 | 540 |  |
  | 541 |  | $output .= '<a href="' . ~~add\_query\_arg( array( 'subpage' => 'edit\_member', 'member\_id' => $user\_id~~ ) ) . '" title="'.esc\_html\_\_( 'View Abandoned Subscriptions', 'paid-member-subscriptions' ).'" class="pms-abandon-count">'; |
  |  | 541 | $output .= '<a href="' . esc\_url( add\_query\_arg( array( 'subpage' => 'edit\_member', 'member\_id' => $user\_id ) ) ) . '" title="'.esc\_html\_\_( 'View Abandoned Subscriptions', 'paid-member-subscriptions' ).'" class="pms-abandon-count">'; |
  | 542 | 542 | $output .= sprintf( \_n( '%1$s %2$s abandoned subscription', '%1$s %2$s abandoned subscriptions', $abandon\_count, 'paid-member-subscriptions' ), $sign, $abandon\_count ); |
  | 543 | 543 | $output .= '</a>'; |
* ## [paid-member-subscriptions/trunk/includes/admin/class-admin-members.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/class-admin-members.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/class-admin-members.php")

  | [r3127842](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members.php?rev=3127842#L138 "Show revision 3127842 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members.php?rev=3160323#L138 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 138 | 138 | if( $subscription\_id ) { |
  | 139 | 139 |  |
  | 140 |  | wp\_redirect( ~~add\_query\_arg( array( 'page' => $this->menu\_slug, 'subpage' => 'edit\_subscription', 'subscription\_id' => (int)$subscription\_id, 'message' => '2', 'updated' => '1' ), admin\_url( 'admin.php'~~ ) ) ); |
  |  | 140 | wp\_redirect( esc\_url( add\_query\_arg( array( 'page' => $this->menu\_slug, 'subpage' => 'edit\_subscription', 'subscription\_id' => (int)$subscription\_id, 'message' => '2', 'updated' => '1' ), admin\_url( 'admin.php' ) ) ) ); |
  | 141 | 141 | exit; |
  | 142 | 142 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members.php?rev=3127842#L205) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members.php?rev=3160323#L205) |  |
  | 205 | 205 | if( $updated ) { |
  | 206 | 206 |  |
  | 207 |  | wp\_redirect( ~~add\_query\_arg( array( 'message' => '3', 'updated' => '1' ), pms\_get\_current\_page\_url(~~) ) ); |
  |  | 207 | wp\_redirect( esc\_url( add\_query\_arg( array( 'message' => '3', 'updated' => '1' ), pms\_get\_current\_page\_url() ) ) ); |
  | 208 | 208 | exit; |
  | 209 | 209 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members.php?rev=3127842#L235) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-members.php?rev=3160323#L235) |  |
  | 235 | 235 |  |
  | 236 | 236 | if( ! empty( $member\_subscriptions ) ) |
  | 237 |  | wp\_redirect( ~~add\_query\_arg( array( 'page' => $this->menu\_slug, 'subpage' => 'edit\_member', 'member\_id' => $member\_id, 'message' => '4', 'updated' => '1' ), admin\_url( 'admin.php'~~ ) ) ); |
  |  | 237 | wp\_redirect( esc\_url( add\_query\_arg( array( 'page' => $this->menu\_slug, 'subpage' => 'edit\_member', 'member\_id' => $member\_id, 'message' => '4', 'updated' => '1' ), admin\_url( 'admin.php' ) ) ) ); |
  | 238 | 238 | else |
  | 239 |  | wp\_redirect( ~~add\_query\_arg( array( 'page' => $this->menu\_slug, 'message' => '4', 'updated' => '1' ), admin\_url( 'admin.php'~~ ) ) ); |
  |  | 239 | wp\_redirect( esc\_url( add\_query\_arg( array( 'page' => $this->menu\_slug, 'message' => '4', 'updated' => '1' ), admin\_url( 'admin.php' ) ) ) ); |
  | 240 | 240 |  |
  | 241 | 241 | exit; |
* ## [paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php")

  | [r3086317](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3086317#L156 "Show revision 3086317 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3160323#L156 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 156 | 156 |  |
  | 157 | 157 | return apply\_filters( 'pms\_payments\_list\_table\_get\_views', array( |
  | 158 |  | 'all'       => '<a href="' . ~~remove\_query\_arg( array( 'pms-view', 'paged'~~ ) ) . '" ' . ( !isset( $\_GET['pms-view'] ) ? 'class="current"' : '' ) . '>All <span class="count">(' . ( isset( $this->views\_count['all'] ) ? $this->views\_count['all'] : '' ) . ')</span></a>', |
  | 159 |  | 'completed' => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'completed', 'paged' => 1 ) ) . '" ' . ( isset( $\_GET['pms-view'] ) &&~~$\_GET['pms-view'] == 'completed' ? 'class="current"' : '' ) . '>Completed <span class="count">(' . ( isset( $this->views\_count['completed'] ) ? $this->views\_count['completed'] : '' ) . ')</span></a>', |
  | 160 |  | 'pending'   => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'pending', 'paged' => 1 ) ) . '" ' . ( isset( $\_GET['pms-view'] ) &&~~$\_GET['pms-view'] == 'pending' ? 'class="current"' : '' ) . '>Pending <span class="count">(' . ( isset( $this->views\_count['pending'] ) ? $this->views\_count['pending'] : '' ) . ')</span></a>', |
  | 161 |  | 'failed'    => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'failed', 'paged' => 1 ) ) . '" ' . ( isset( $\_GET['pms-view'] ) &&~~$\_GET['pms-view'] == 'failed' ? 'class="current"' : '' ) . '>Failed <span class="count">(' . ( isset( $this->views\_count['failed'] ) ? $this->views\_count['failed'] : '' ) . ')</span></a>', |
  | 162 |  | 'refunded'  => '<a href="' . ~~add\_query\_arg( array( 'pms-view' => 'refunded', 'paged' => 1 ) ) . '" ' . ( isset( $\_GET['pms-view'] ) &&~~$\_GET['pms-view'] == 'refunded' ? 'class="current"' : '' ) . '>Refunded <span class="count">(' . ( isset( $this->views\_count['refunded'] ) ? $this->views\_count['refunded'] : '' ) . ')</span></a>' |
  |  | 158 | 'all'       => '<a href="' . esc\_url( remove\_query\_arg( array( 'pms-view', 'paged' ) ) ) . '" ' . ( !isset( $\_GET['pms-view'] ) ? 'class="current"' : '' ) . '>All <span class="count">(' . ( isset( $this->views\_count['all'] ) ? $this->views\_count['all'] : '' ) . ')</span></a>', |
  |  | 159 | 'completed' => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'completed', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'completed' ? 'class="current"' : '' ) . '>Completed <span class="count">(' . ( isset( $this->views\_count['completed'] ) ? $this->views\_count['completed'] : '' ) . ')</span></a>', |
  |  | 160 | 'pending'   => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'pending', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'pending' ? 'class="current"' : '' ) . '>Pending <span class="count">(' . ( isset( $this->views\_count['pending'] ) ? $this->views\_count['pending'] : '' ) . ')</span></a>', |
  |  | 161 | 'failed'    => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'failed', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'failed' ? 'class="current"' : '' ) . '>Failed <span class="count">(' . ( isset( $this->views\_count['failed'] ) ? $this->views\_count['failed'] : '' ) . ')</span></a>', |
  |  | 162 | 'refunded'  => '<a href="' . esc\_url( add\_query\_arg( array( 'pms-view' => 'refunded', 'paged' => 1 ) ) ) . '" ' . ( isset( $\_GET['pms-view'] ) && $\_GET['pms-view'] == 'refunded' ? 'class="current"' : '' ) . '>Refunded <span class="count">(' . ( isset( $this->views\_count['refunded'] ) ? $this->views\_count['refunded'] : '' ) . ')</span></a>' |
  | 163 | 163 | )); |
  | 164 | 164 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3086317#L393) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3160323#L393) |  |
  | 393 | 393 |  |
  | 394 | 394 | // Edit payment row action |
  | 395 |  | $actions['edit'] = '<a href="' . ~~add\_query\_arg( array( 'pms-action' => 'edit\_payment', 'payment\_id' => $item['id'] ), admin\_url( 'admin.php?page=pms-payments-page'~~ ) ) . '">' . esc\_html\_\_( 'Edit Payment', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 395 | $actions['edit'] = '<a href="' . esc\_url( add\_query\_arg( array( 'pms-action' => 'edit\_payment', 'payment\_id' => $item['id'] ), admin\_url( 'admin.php?page=pms-payments-page' ) ) ) . '">' . esc\_html\_\_( 'Edit Payment', 'paid-member-subscriptions' ) . '</a>'; |
  | 396 | 396 |  |
  | 397 | 397 | // Delete row action |
  | 398 |  | $actions['delete'] = '<a onclick="return confirm( \'' . esc\_html\_\_( "Are you sure you want to delete this Payment?", "paid-member-subscriptions" ) . ' \' )" href="' . ~~wp\_nonce\_url( add\_query\_arg( array( 'pms-action' => 'delete\_payment', 'payment\_id' => $item['id'] ) ), 'pms\_payment\_nonce'~~ ) . '">' . esc\_html\_\_( 'Delete', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 398 | $actions['delete'] = '<a onclick="return confirm( \'' . esc\_html\_\_( "Are you sure you want to delete this Payment?", "paid-member-subscriptions" ) . ' \' )" href="' . esc\_url( wp\_nonce\_url( add\_query\_arg( array( 'pms-action' => 'delete\_payment', 'payment\_id' => $item['id'] ) ), 'pms\_payment\_nonce' ) ) . '">' . esc\_html\_\_( 'Delete', 'paid-member-subscriptions' ) . '</a>'; |
  | 399 | 399 |  |
  | 400 | 400 | /\*\* |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3086317#L409) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3160323#L409) |  |
  | 409 | 409 | $payment = pms\_get\_payment( $item['id'] ); |
  | 410 | 410 |  |
  | 411 |  | $output  = '<a href="' . ~~add\_query\_arg( array( 'page' => 'pms-members-page', 'pms-action' => 'edit\_member', 'member\_id' => $payment->user\_id, 'subpage' => 'edit\_member' ), admin\_url( 'admin.php'~~ ) ) . '" title="' . \_\_( 'Edit Member', 'paid-member-subscriptions' ) . '">' . $item['username']; |
  |  | 411 | $output  = '<a href="' . esc\_url( add\_query\_arg( array( 'page' => 'pms-members-page', 'pms-action' => 'edit\_member', 'member\_id' => $payment->user\_id, 'subpage' => 'edit\_member' ), admin\_url( 'admin.php' ) ) ) . '" title="' . \_\_( 'Edit Member', 'paid-member-subscriptions' ) . '">' . $item['username']; |
  | 412 | 412 | $output .= $this->row\_actions( $actions ); |
  | 413 | 413 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3086317#L452) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3160323#L452) |  |
  | 452 | 452 |  |
  | 453 | 453 | if( $item['status'] == 'failed' ){ |
  | 454 |  | $output .= ' | <a href="' . ~~add\_query\_arg( array( 'pms-action' => 'edit\_payment', 'payment\_id' => $item['id']~~ ) ) . '">' . esc\_html\_\_( 'View Logs', 'paid-member-subscriptions' ) . '</a>'; |
  |  | 454 | $output .= ' | <a href="' . esc\_url( add\_query\_arg( array( 'pms-action' => 'edit\_payment', 'payment\_id' => $item['id'] ) ) ) . '">' . esc\_html\_\_( 'View Logs', 'paid-member-subscriptions' ) . '</a>'; |
  | 455 | 455 | } |
  | 456 | 456 |  |
* ## [paid-member-subscriptions/trunk/includes/admin/class-admin-payments.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/class-admin-payments.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/class-admin-payments.php")

  | [r3127842](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments.php?rev=3127842#L97 "Show revision 3127842 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments.php?rev=3160323#L97 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 97 | 97 | return; |
  | 98 | 98 |  |
  |  | 99 | // Verify user capability |
  |  | 100 | if( ! ( current\_user\_can( 'manage\_options' ) || current\_user\_can( 'pms\_edit\_capability' ) ) ) |
  |  | 101 | return; |
  |  | 102 |  |
  | 99 | 103 | // Get current actions |
  | 100 | 104 | $action = !empty( $\_REQUEST['pms-action'] ) ? sanitize\_text\_field( $\_REQUEST['pms-action'] ) : ( isset( $\_REQUEST['action'] ) && $\_REQUEST['action'] != '-1' ? sanitize\_text\_field( $\_REQUEST['action'] ) : ( isset( $\_REQUEST['action2'] ) ? sanitize\_text\_field( $\_REQUEST['action2'] ) : '' ) ); |
  | 101 | 105 |  |
  | 102 |  | if( empty(~~$action~~) ) |
  |  | 106 | if( empty( $action ) ) |
  | 103 | 107 | return; |
  | 104 | 108 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments.php?rev=3127842#L357) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments.php?rev=3160323#L361) |  |
  | 357 | 361 | do\_action( 'pms\_manually\_added\_payment\_success', $payment ); |
  | 358 | 362 |  |
  | 359 |  | wp\_redirect(~~add\_query\_arg(array('page' => $this->menu\_slug, 'message' => '1', 'updated' => '1'), admin\_url('admin.php'))~~); |
  |  | 363 | wp\_redirect( esc\_url( add\_query\_arg( array('page' => $this->menu\_slug, 'message' => '1', 'updated' => '1'), admin\_url( 'admin.php' ) ) ) ); |
  | 360 | 364 | exit; |
  | 361 | 365 | } |
* ## [paid-member-subscriptions/trunk/includes/admin/class-admin-setup-wizard.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/class-admin-setup-wizard.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/class-admin-setup-wizard.php")

  | [r3145313](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-setup-wizard.php?rev=3145313#L257 "Show revision 3145313 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-setup-wizard.php?rev=3160323#L257 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 257 | 257 | return ''; |
  | 258 | 258 |  |
  | 259 |  | return ~~add\_query\_arg( 'step', $keys[$step\_index + 1]~~ ); |
  |  | 259 | return esc\_url( add\_query\_arg( 'step', $keys[$step\_index + 1] ) ); |
  | 260 | 260 | } |
  | 261 | 261 |  |
* ## [paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php")

  | [r3045553](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3045553#L156 "Show revision 3045553 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3160323#L156 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 156 | 156 | } |
  | 157 | 157 |  |
  | 158 |  | wp\_redirect( ~~add\_query\_arg( array( 'post\_type' => $this->post\_type ), pms\_get\_current\_page\_url(true~~) ) ); |
  |  | 158 | wp\_redirect( esc\_url( add\_query\_arg( array( 'post\_type' => $this->post\_type ), pms\_get\_current\_page\_url(true) ) ) ); |
  | 159 | 159 | die(); |
  | 160 | 160 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3045553#L191) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3160323#L191) |  |
  | 191 | 191 | } |
  | 192 | 192 |  |
  | 193 |  | wp\_redirect( ~~add\_query\_arg( array( 'post\_type' => $this->post\_type ), pms\_get\_current\_page\_url(true~~) ) ); |
  |  | 193 | wp\_redirect( esc\_url( add\_query\_arg( array( 'post\_type' => $this->post\_type ), pms\_get\_current\_page\_url(true) ) ) ); |
  | 194 | 194 | die(); |
  | 195 | 195 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3045553#L547) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3160323#L547) |  |
  | 547 | 547 | } |
  | 548 | 548 |  |
  | 549 |  | $url = 'href="' .  ~~add\_query\_arg( 'subscription\_plan', $plan->id, get\_permalink( pms\_get\_page('register'~~) ) ) .'&single\_plan=yes"'; |
  |  | 549 | $url = 'href="' .  esc\_url( add\_query\_arg( 'subscription\_plan', $plan->id, get\_permalink( pms\_get\_page('register') ) ) ) .'&single\_plan=yes"'; |
  | 550 | 550 | $pattern = str\_replace( 'href="1"', $url, $pattern ); |
  | 551 | 551 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3045553#L577) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3160323#L577) |  |
  | 577 | 577 | } |
  | 578 | 578 |  |
  | 579 |  | $url = 'href="' .  ~~add\_query\_arg( 'subscription\_plan', $plan->id, get\_permalink( pms\_get\_page('register'~~) ) ) .'&single\_plan=yes"'; |
  |  | 579 | $url = 'href="' .  esc\_url( add\_query\_arg( 'subscription\_plan', $plan->id, get\_permalink( pms\_get\_page('register') ) ) ) .'&single\_plan=yes"'; |
  | 580 | 580 | $pattern = str\_replace( 'href="2"', $url, $pattern ); |
  | 581 | 581 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3045553#L607) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3160323#L607) |  |
  | 607 | 607 | } |
  | 608 | 608 |  |
  | 609 |  | $url = 'href="' .  ~~add\_query\_arg( 'subscription\_plan', $plan->id, get\_permalink( pms\_get\_page('register'~~) ) ) .'&single\_plan=yes"'; |
  |  | 609 | $url = 'href="' .  esc\_url( add\_query\_arg( 'subscription\_plan', $plan->id, get\_permalink( pms\_get\_page('register') ) ) ) .'&single\_plan=yes"'; |
  | 610 | 610 | $pattern = str\_replace( 'href="3"', $url, $pattern ); |
  | 611 | 611 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3045553#L786) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-subscription-plans.php?rev=3160323#L786) |  |
  | 786 | 786 | $redirect = add\_query\_arg( $redirect\_args, pms\_get\_current\_page\_url( true ) ); |
  | 787 | 787 |  |
  | 788 |  | wp\_redirect( ~~$redirect~~ ); |
  |  | 788 | wp\_redirect( esc\_url( $redirect ) ); |
  | 789 | 789 | exit; |
  | 790 | 790 |  |
* ## [paid-member-subscriptions/trunk/includes/admin/class-edd-sl-plugin-updater.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/class-edd-sl-plugin-updater.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/class-edd-sl-plugin-updater.php")

  | [r3024979](/browser/paid-member-subscriptions/trunk/includes/admin/class-edd-sl-plugin-updater.php?rev=3024979#L748 "Show revision 3024979 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/class-edd-sl-plugin-updater.php?rev=3160323#L748 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 748 | 748 | if ( ! empty( $message ) ) { |
  | 749 | 749 | $message = implode( "<br/>", array\_unique($message) );//if we got the same message for multiple addons show just one, and add a br in case we show multiple messages |
  | 750 |  | $redirect = ~~add\_query\_arg( array( 'pms\_sl\_activation' => 'false', 'message' => urlencode( $message ) ), $this->license\_page\_url(~~) ); |
  |  | 750 | $redirect = esc\_url( add\_query\_arg( array( 'pms\_sl\_activation' => 'false', 'message' => urlencode( $message ) ), $this->license\_page\_url() ) ); |
  | 751 | 751 |  |
  | 752 | 752 | $this->update\_option( 'pms\_license\_status', isset( $license\_data->error ) ? $license\_data->error : $license\_data->license ); |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-edd-sl-plugin-updater.php?rev=3024979#L759) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-edd-sl-plugin-updater.php?rev=3160323#L759) |  |
  | 759 | 759 | $this->update\_option( 'pms\_license\_status', isset( $license\_data->error ) ? $license\_data->error : $license\_data->license ); |
  | 760 | 760 |  |
  | 761 |  | wp\_redirect( ~~add\_query\_arg( array( 'pms\_sl\_activation' => 'true', 'message' => urlencode( \_\_( 'You have successfully activated your license.', 'paid-member-subscriptions' ) ) ), $this->license\_page\_url(~~) ) ); |
  |  | 761 | wp\_redirect( esc\_url( add\_query\_arg( array( 'pms\_sl\_activation' => 'true', 'message' => urlencode( \_\_( 'You have successfully activated your license.', 'paid-member-subscriptions' ) ) ), $this->license\_page\_url() ) ) ); |
  | 762 | 762 | exit(); |
  | 763 | 763 | } |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-edd-sl-plugin-updater.php?rev=3024979#L841) | […](/browser/paid-member-subscriptions/trunk/includes/admin/class-edd-sl-plugin-updater.php?rev=3160323#L841) |  |
  | 841 | 841 | $message = \_\_( 'An error occurred, please try again.', 'paid-member-subscriptions' ); |
  | 842 | 842 |  |
  | 843 |  | wp\_redirect( ~~add\_query\_arg( array( 'pms\_sl\_activation' => 'false', 'message' => urlencode( $message ) ), $this->license\_page\_url(~~) ) ); |
  |  | 843 | wp\_redirect( esc\_url( add\_query\_arg( array( 'pms\_sl\_activation' => 'false', 'message' => urlencode( $message ) ), $this->license\_page\_url() ) ) ); |
  | 844 | 844 | exit(); |
  | 845 | 845 | } |
* ## [paid-member-subscriptions/trunk/includes/admin/functions-admin.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/functions-admin.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/functions-admin.php")

  | [r3093002](/browser/paid-member-subscriptions/trunk/includes/admin/functions-admin.php?rev=3093002#L42 "Show revision 3093002 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/functions-admin.php?rev=3160323#L42 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 42 | 42 | return; |
  | 43 | 43 |  |
  |  | 44 | if( ! ( current\_user\_can( 'manage\_options' ) || current\_user\_can( 'pms\_edit\_capability' ) ) ) |
  |  | 45 | return; |
  |  | 46 |  |
  | 44 | 47 | // Remove all cron jobs |
  | 45 | 48 | wp\_clear\_scheduled\_hook( 'pms\_cron\_process\_member\_subscriptions\_payments' ); |
  | […](/browser/paid-member-subscriptions/trunk/includes/admin/functions-admin.php?rev=3093002#L69) | […](/browser/paid-member-subscriptions/trunk/includes/admin/functions-admin.php?rev=3160323#L72) |  |
  | 69 | 72 | )); |
  | 70 | 73 |  |
  | 71 |  | wp\_safe\_redirect( ~~add\_query\_arg( 'sucess\_notice', '1', $url~~ ) ); |
  |  | 74 | wp\_safe\_redirect( esc\_url( add\_query\_arg( 'sucess\_notice', '1', $url ) ) ); |
  | 72 | 75 | exit; |
  | 73 | 76 |  |
* ## [paid-member-subscriptions/trunk/includes/admin/views/view-page-addons.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/views/view-page-addons.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/views/view-page-addons.php")

  | [r3118211](/browser/paid-member-subscriptions/trunk/includes/admin/views/view-page-addons.php?rev=3118211#L138 "Show revision 3118211 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/views/view-page-addons.php?rev=3160323#L138 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 138 | 138 | array(  'slug' => 'pms-add-on-stripe/index.php', |
  | 139 | 139 | 'type'        => 'add-on', |
  | 140 |  | 'name'        => \_\_( 'Stripe', 'paid-member-subscriptions' ), |
  | 141 |  | 'description' => \_\_( '~~Accept credit card payments, both one-time and recurring, directly on your website via Stripe~~.', 'paid-member-subscriptions' ), |
  |  | 140 | 'name'        => \_\_( 'Stripe (deprecated)', 'paid-member-subscriptions' ), |
  |  | 141 | 'description' => \_\_( 'Old Stripe implementation not available for new users.', 'paid-member-subscriptions' ), |
  | 142 | 142 | 'icon'        => 'pms-add-on-stripe-logo.png', |
  | 143 | 143 | 'doc\_url'     => 'https://www.cozmoslabs.com/docs/paid-member-subscriptions/add-ons/stripe-payment-gateway/?utm\_source=wpbackend&utm\_medium=clientsite&utm\_content=add-on-page&utm\_campaign=PMS', |
* ## [paid-member-subscriptions/trunk/includes/admin/views/view-page-basic-info.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/views/view-page-basic-info.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/views/view-page-basic-info.php")

  | [r3100435](/browser/paid-member-subscriptions/trunk/includes/admin/views/view-page-basic-info.php?rev=3100435#L324 "Show revision 3100435 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/views/view-page-basic-info.php?rev=3160323#L324 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 324 | 324 | <div> |
  | 325 | 325 | <a href="https://www.cozmoslabs.com/add-ons/stripe/?utm\_source=wpbackend&utm\_medium=clientsite&utm\_campaign=PMSFree&utm\_content=basic-info" target="\_blank"> |
  | 326 |  | <h4 class="pms-add-on-name"><?php esc\_html\_e( 'Stripe', 'paid-member-subscriptions' ); ?></h4> |
  |  | 326 | <h4 class="pms-add-on-name"><?php esc\_html\_e( 'Stripe (deprecated)', 'paid-member-subscriptions' ); ?></h4> |
  | 327 | 327 | </a> |
  | 328 | 328 |  |
  | 329 | 329 | <a href="https://www.cozmoslabs.com/add-ons/stripe/?utm\_source=wpbackend&utm\_medium=clientsite&utm\_campaign=PMSFree&utm\_content=basic-info" target="\_blank" class="pms-addon-image-container"> |
  | 330 |  | <img src="<?php echo esc\_url( PMS\_PLUGIN\_DIR\_URL ); ?>assets/images/add-on-stripe.png" alt="~~Navigation Menu Filtering~~" class="pms-addon-image" /> |
  |  | 330 | <img src="<?php echo esc\_url( PMS\_PLUGIN\_DIR\_URL ); ?>assets/images/add-on-stripe.png" alt="Stripe" class="pms-addon-image" /> |
  | 331 | 331 | </a> |
  | 332 | 332 |  |
* ## [paid-member-subscriptions/trunk/includes/admin/views/view-page-settings-content\_restriction.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/admin/views/view-page-settings-content_restriction.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/admin/views/view-page-settings-content_restriction.php")

  | [r3118211](/browser/paid-member-subscriptions/trunk/includes/admin/views/view-page-settings-content_restriction.php?rev=3118211#L177 "Show revision 3118211 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/admin/views/view-page-settings-content_restriction.php?rev=3160323#L177 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 177 | 177 | <p class="cozmoslabs-description cozmoslabs-description-space-left"><?php esc\_html\_e( 'Show a portion of the restricted post to logged-out users or users that are not subscribed to a plan.', 'paid-member-subscriptions' ); ?></p> |
  | 178 | 178 | </div> |
  |  | 179 |  |
  |  | 180 | <!-- Exclude Restricted Posts from Queries --> |
  |  | 181 | <div class="cozmoslabs-form-field-wrapper cozmoslabs-toggle-switch"> |
  |  | 182 | <label class="cozmoslabs-form-field-label" for="pms\_excludeRestrictedPosts"><?php esc\_html\_e( 'Exclude Restricted Posts from Queries', 'paid-member-subscriptions' ); ?></label> |
  |  | 183 |  |
  |  | 184 | <div class="cozmoslabs-toggle-container"> |
  |  | 185 | <input type="checkbox" name="pms\_content\_restriction\_settings[pms\_excludePosts]" id="pms\_excludeRestrictedPosts" value="yes" <?php echo ( isset( $this->options['pms\_excludePosts'] ) && $this->options['pms\_excludePosts'] == 'yes' ) ? 'checked' : ''; ?> > |
  |  | 186 | <label class="cozmoslabs-toggle-track" for="pms\_excludeRestrictedPosts"></label> |
  |  | 187 | </div> |
  |  | 188 |  |
  |  | 189 | <div class="cozmoslabs-toggle-description"> |
  |  | 190 | <label for="pms\_excludeRestrictedPosts" class="cozmoslabs-description"><?php esc\_html\_e( 'Activate this option to exclude the restricted posts from default WordPress and WooCommerce queries.', 'paid-member-subscriptions' ); ?></label> |
  |  | 191 | </div> |
  |  | 192 | </div> |
  | 179 | 193 | </div> |
* ## [paid-member-subscriptions/trunk/includes/functions-content-restriction.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/functions-content-restriction.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/functions-content-restriction.php")

  | [r2962413](/browser/paid-member-subscriptions/trunk/includes/functions-content-restriction.php?rev=2962413#L398 "Show revision 2962413 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/functions-content-restriction.php?rev=3160323#L398 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 398 | 398 |  |
  | 399 | 399 | } |
  |  | 400 |  |
  |  | 401 |  |
  |  | 402 | /\*\* |
  |  | 403 | \* Exclude Restricted Posts From Query |
  |  | 404 | \*/ |
  |  | 405 |  |
  |  | 406 | $settings = get\_option( 'pms\_content\_restriction\_settings' ); |
  |  | 407 |  |
  |  | 408 | if( isset( $settings['pms\_excludePosts'] ) && $settings['pms\_excludePosts'] == 'yes' ){ |
  |  | 409 |  |
  |  | 410 | /\* Exclude restricted posts and pages from the main queries like blog, archive and taxonomy pages. \*/ |
  |  | 411 | add\_action( 'pre\_get\_posts', 'pmsc\_exclude\_post\_from\_query', 40 ); |
  |  | 412 | function pmsc\_exclude\_post\_from\_query( $query ) { |
  |  | 413 |  |
  |  | 414 | if( !function\_exists( 'pms\_is\_post\_restricted' ) || is\_admin() || is\_single() ) |
  |  | 415 | return; |
  |  | 416 |  |
  |  | 417 | if( $query->is\_main\_query() || ( $query->is\_search() && isset( $\_GET['s'] ) ) ) { |
  |  | 418 |  |
  |  | 419 | remove\_action('pre\_get\_posts', 'pmsc\_exclude\_post\_from\_query', 40 ); |
  |  | 420 |  |
  |  | 421 | $args = $query->query\_vars; |
  |  | 422 | $args['suppress\_filters'] = true; |
  |  | 423 | $args['posts\_per\_page'] = get\_option( 'posts\_per\_page' ); |
  |  | 424 |  |
  |  | 425 | if( is\_search() ) |
  |  | 426 | $args['post\_type'] = 'any'; |
  |  | 427 |  |
  |  | 428 | $posts = get\_posts($args); |
  |  | 429 |  |
  |  | 430 | $previous\_restricted\_ids = $query->get( 'post\_\_not\_in' ); |
  |  | 431 | if ( ! is\_array( $previous\_restricted\_ids ) ) { |
  |  | 432 | $previous\_restricted\_ids = array(); |
  |  | 433 | } |
  |  | 434 |  |
  |  | 435 | $ids = wp\_list\_pluck( $posts, 'ID' ); |
  |  | 436 | $restricted\_ids = array\_filter( $ids,'pms\_is\_post\_restricted' ); |
  |  | 437 |  |
  |  | 438 | $updated\_restricted\_ids = array\_merge( $previous\_restricted\_ids, $restricted\_ids ); |
  |  | 439 | $query->set( 'post\_\_not\_in', $updated\_restricted\_ids ); |
  |  | 440 | } |
  |  | 441 | } |
  |  | 442 |  |
  |  | 443 | //Remove restricted forums from the main bbPress query |
  |  | 444 | add\_filter( 'bbp\_after\_has\_forums\_parse\_args', 'pmsc\_exclude\_restricted\_forums\_from\_main\_query' ); |
  |  | 445 | function pmsc\_exclude\_restricted\_forums\_from\_main\_query( $vars ) { |
  |  | 446 | if( !function\_exists( 'pms\_is\_post\_restricted' ) ) return; |
  |  | 447 |  |
  |  | 448 | $query = new WP\_Query( $vars ); |
  |  | 449 |  |
  |  | 450 | $forum\_ids = array(); |
  |  | 451 |  |
  |  | 452 | foreach ( $query->posts as $forum ) { |
  |  | 453 | $forum\_ids[] = $forum->ID; |
  |  | 454 | } |
  |  | 455 |  |
  |  | 456 | $previous\_restricted\_forums = $query->get( 'post\_\_not\_in' ); |
  |  | 457 | if ( ! is\_array( $previous\_restricted\_forums ) ) { |
  |  | 458 | $previous\_restricted\_forums = array(); |
  |  | 459 | } |
  |  | 460 |  |
  |  | 461 | $restricted\_forums = array\_filter( $forum\_ids, 'pms\_is\_post\_restricted' ); |
  |  | 462 | $updated\_restricted\_forums = array\_merge( $previous\_restricted\_forums, $restricted\_forums ); |
  |  | 463 |  |
  |  | 464 | $vars['post\_\_not\_in'] = $updated\_restricted\_forums; |
  |  | 465 |  |
  |  | 466 | return $vars; |
  |  | 467 | } |
  |  | 468 |  |
  |  | 469 | //Alters the output of the query that displays the Category Archive (including Shop) pages, filtering the restricted products from the output |
  |  | 470 | add\_action( 'pre\_get\_posts', 'pms\_exclude\_restricted\_products\_from\_woocoommerce\_category\_queries', 11 ); |
  |  | 471 | function pms\_exclude\_restricted\_products\_from\_woocoommerce\_category\_queries( $query ) { |
  |  | 472 | if( is\_admin() || !function\_exists('pms\_is\_post\_restricted') ) |
  |  | 473 | return; |
  |  | 474 |  |
  |  | 475 | if( isset( $query->query\_vars['wc\_query'] ) && $query->query\_vars['wc\_query'] == 'product\_query' ){ |
  |  | 476 |  |
  |  | 477 | remove\_action( 'pre\_get\_posts', 'pms\_exclude\_restricted\_products\_from\_woocoommerce\_category\_queries', 11 ); |
  |  | 478 |  |
  |  | 479 | $args = $query->query\_vars; |
  |  | 480 | $args['suppress\_filters'] = true; |
  |  | 481 | $args['posts\_per\_page'] = -1; |
  |  | 482 |  |
  |  | 483 | $previous\_restricted\_ids = $query->get( 'post\_\_not\_in' ); |
  |  | 484 | if ( ! is\_array( $previous\_restricted\_ids ) ) { |
  |  | 485 | $previous\_restricted\_ids = array(); |
  |  | 486 | } |
  |  | 487 |  |
  |  | 488 | $products = wc\_get\_products( $args ); |
  |  | 489 |  |
  |  | 490 | $product\_ids = array(); |
  |  | 491 |  |
  |  | 492 | foreach ($products as $product) { |
  |  | 493 | $product\_ids[] = $product->get\_id(); |
  |  | 494 | } |
  |  | 495 |  |
  |  | 496 | $restricted\_ids = array\_filter( $product\_ids, 'pms\_is\_post\_restricted' ); |
  |  | 497 |  |
  |  | 498 | $updated\_restricted\_ids = array\_merge( $previous\_restricted\_ids, $restricted\_ids ); |
  |  | 499 | $query->set( 'post\_\_not\_in', $updated\_restricted\_ids ); |
  |  | 500 |  |
  |  | 501 | } |
  |  | 502 | } |
  |  | 503 |  |
  |  | 504 | //Alters the output of the [products] shortcode from WooCommerce, filtering restricted products from the output |
  |  | 505 | add\_action( 'woocommerce\_shortcode\_products\_query', 'pmsc\_exclude\_restricted\_products\_from\_woocoommerce\_products\_shortcode\_queries' ); |
  |  | 506 | function pmsc\_exclude\_restricted\_products\_from\_woocoommerce\_products\_shortcode\_queries( $query\_args ) { |
  |  | 507 | if( !is\_admin() && function\_exists('pms\_is\_post\_restricted') ) { |
  |  | 508 | $posts\_per\_page = $query\_args['posts\_per\_page']; |
  |  | 509 |  |
  |  | 510 | $query\_args['suppress\_filters'] = true; |
  |  | 511 | $query\_args['posts\_per\_page'] = '-1'; |
  |  | 512 |  |
  |  | 513 | $products = wc\_get\_products( $query\_args ); |
  |  | 514 |  |
  |  | 515 | $query\_args['posts\_per\_page'] = $posts\_per\_page; |
  |  | 516 |  |
  |  | 517 | $product\_ids = array(); |
  |  | 518 |  |
  |  | 519 | foreach ($products as $product) { |
  |  | 520 | $product\_ids[] = $product->get\_id(); |
  |  | 521 | } |
  |  | 522 |  |
  |  | 523 | $previous\_restricted\_ids = isset( $query\_args['post\_\_not\_in'] ) ? $query\_args['post\_\_not\_in'] : array(); |
  |  | 524 |  |
  |  | 525 | if ( ! is\_array( $previous\_restricted\_ids ) ) { |
  |  | 526 | $previous\_restricted\_ids = array(); |
  |  | 527 | } |
  |  | 528 |  |
  |  | 529 | $restricted\_ids = array\_filter( $product\_ids, 'pms\_is\_post\_restricted' ); |
  |  | 530 | $updated\_restricted\_ids = array\_merge( $previous\_restricted\_ids, $restricted\_ids ); |
  |  | 531 |  |
  |  | 532 | $query\_args['post\_\_not\_in'] = $updated\_restricted\_ids; |
  |  | 533 | } |
  |  | 534 |  |
  |  | 535 | return $query\_args; |
  |  | 536 | } |
  |  | 537 | } |
  |  | 538 |  |
* ## [paid-member-subscriptions/trunk/includes/functions-member-subscriptions.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/functions-member-subscriptions.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/functions-member-subscriptions.php")

  | [r2854210](/browser/paid-member-subscriptions/trunk/includes/functions-member-subscriptions.php?rev=2854210#L158 "Show revision 2854210 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/functions-member-subscriptions.php?rev=3160323#L158 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 158 | 158 |  |
  | 159 | 159 | // Query order |
  | 160 |  | $query\_order = $args['order'] . ' '; |
  |  | 160 | $query\_order = strtoupper( $args['order'] ) === 'DESC' ? 'DESC' : 'ASC'; |
  |  | 161 | $query\_order .= ' '; |
  | 161 | 162 |  |
  | 162 | 163 | // Query limit |
* ## [paid-member-subscriptions/trunk/includes/functions-member.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/functions-member.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/functions-member.php")

  | [r2884005](/browser/paid-member-subscriptions/trunk/includes/functions-member.php?rev=2884005#L188 "Show revision 2884005 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/functions-member.php?rev=3160323#L188 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 188 | 188 |  |
  | 189 | 189 | $query\_oder\_by = "ORDER BY users." . sanitize\_text\_field( $args['orderby'] ) . ' '; |
  | 190 |  | $query\_order   = strtoupper( sanitize\_text\_field( $args['order'] ) ) . ' '; |
  |  | 190 |  |
  |  | 191 | $query\_order = strtoupper( $args['order'] ) === 'DESC' ? 'DESC' : 'ASC'; |
  |  | 192 | $query\_order .= ' '; |
  | 191 | 193 |  |
  | 192 | 194 | $query\_limit = ''; |
* ## [paid-member-subscriptions/trunk/includes/functions-payment.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/functions-payment.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/functions-payment.php")

  | [r3107154](/browser/paid-member-subscriptions/trunk/includes/functions-payment.php?rev=3107154#L144 "Show revision 3107154 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/functions-payment.php?rev=3160323#L144 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 144 | 144 |  |
  | 145 | 145 | $query\_order\_by = ''; |
  |  | 146 | // removed table name so it can be sanitized using the core function |
  | 146 | 147 | if ( !empty($args['orderby']) ) |
  | 147 |  | $query\_order\_by = " ORDER BY pms\_payments." . sanitize\_text\_field( $args['orderby'] ) . ' '; |
  | 148 |  |  |
  | 149 |  | $query\_order = strtoupper( sanitize\_text\_field( $args['order'] ) ) . ' '; |
  |  | 148 | $query\_order\_by = sanitize\_text\_field( $args['orderby'] ) . ' '; |
  |  | 149 |  |
  |  | 150 | $query\_order = strtoupper( $args['order'] ) === 'DESC' ? 'DESC' : 'ASC'; |
  |  | 151 | $query\_order .= ' '; |
  |  | 152 |  |
  |  | 153 | $query\_order\_string = " ORDER BY " . sanitize\_sql\_orderby( $query\_order\_by . $query\_order ); |
  | 150 | 154 |  |
  | 151 | 155 | $query\_limit        = ''; |
  | […](/browser/paid-member-subscriptions/trunk/includes/functions-payment.php?rev=3107154#L158) | […](/browser/paid-member-subscriptions/trunk/includes/functions-payment.php?rev=3160323#L162) |  |
  | 158 | 162 |  |
  | 159 | 163 | // Concatenate query string |
  | 160 |  | $query\_string .= $query\_from . $query\_inner\_join . $query\_where . $query\_order\_~~by . $query\_order~~ . $query\_limit . $query\_offset; |
  |  | 164 | $query\_string .= $query\_from . $query\_inner\_join . $query\_where . $query\_order\_string . $query\_limit . $query\_offset; |
  | 161 | 165 |  |
  | 162 | 166 |  |
* ## [paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php")

  | [r3145313](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3145313#L12 "Show revision 3145313 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3160323#L12 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 |  |
  | 13 | 13 | if( ! empty( $\_GET['pms\_dismiss\_admin\_notification'] ) ) { |
  |  | 14 |  |
  |  | 15 | if( empty( $\_GET['\_wpnonce'] ) || !wp\_verify\_nonce( sanitize\_text\_field( $\_GET['\_wpnonce'] ), 'pms\_plugin\_notice\_dismiss' ) ) |
  |  | 16 | return; |
  | 14 | 17 |  |
  | 15 | 18 | $notifications = PMS\_Plugin\_Notifications::get\_instance(); |
  | […](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3145313#L94) | […](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3160323#L97) |  |
  | 94 | 97 | $message .= '<p style="margin-top: 16px;">' . wp\_kses\_post( \_\_( '<strong>New payment gateway!</strong><br><br><strong>Stripe</strong> payment gateway is now available in the free version. <br>Your users can pay using credit and debit cards without leaving your website and you can also offer them additional payment methods like Bancontact, iDeal, Giropay and more. <br><br>Get started now by going to <strong>Paid Member Subscriptions -> Settings -> Payments</strong>!', 'paid-member-subscriptions' ) ) . '</p>'; |
  | 95 | 98 | $message .= '<p><a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/payment-gateways/stripe-connect/?utm\_source=wp-backend&utm\_medium=addon-notification&utm\_campaign=PMSFree" class="button-primary" target="\_blank">' . esc\_html\_\_( 'Learn More', 'paid-member-subscriptions' ) . '</a></p>'; |
  | 96 |  | $message .= '<a href="' . esc\_url( ~~add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id )~~ ) ) . '#pms-addons-title" type="button" class="notice-dismiss"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  |  | 99 | $message .= '<a href="' . esc\_url( wp\_nonce\_url( add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id ) ), 'pms\_plugin\_notice\_dismiss' ) ) . '#pms-addons-title" type="button" class="notice-dismiss"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  | 97 | 100 |  |
  | 98 | 101 | pms\_add\_plugin\_notification( $notification\_id, $message, 'pms-notice pms-narrow notice notice-info', true, array( 'pms-settings-page' ) ); |
  | […](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3145313#L103) | […](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3160323#L106) |  |
  | 103 | 106 | $message .= '<p style="margin-top: 16px;">' . wp\_kses\_post( '<strong>Files Restriction add-on!</strong><br><br>Lock down direct access to files and allow only paying members to access them using the new Files Restriction add-on. <br>The add-on is available with an <strong>Agency</strong> or <strong>Pro</strong> license.<br> Don\'t have a license? <a href="https://www.cozmoslabs.com/wordpress-paid-member-subscriptions/?utm\_source=wpbackend&utm\_medium=plugin-notification-files&utm\_campaign=PMSFree#pricing" target="\_blank">Buy now!</a>' ) . '</p>'; |
  | 104 | 107 | $message .= '<p><a href="'. admin\_url( 'admin.php?page=pms-addons-page' ) .'" class="button-primary" target="\_blank">' . esc\_html\_\_( 'Add-ons Page', 'paid-member-subscriptions' ) . '</a><a href="https://www.cozmoslabs.com/add-ons/paid-member-subscriptions-files-restriction/?utm\_source=wpbackend&utm\_medium=clientsite&utm\_content=plugin-notification-files&utm\_campaign=PMSFree" class="button-secondary" target="\_blank">' . esc\_html\_\_( 'Learn More', 'paid-member-subscriptions' ) . '</a></p>'; |
  | 105 |  | $message .= '<a href="' . esc\_url( ~~add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id )~~ ) ) . '#pms-addons-title" type="button" class="notice-dismiss"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  |  | 108 | $message .= '<a href="' . esc\_url( wp\_nonce\_url( add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id ) ), 'pms\_plugin\_notice\_dismiss' ) ) . '#pms-addons-title" type="button" class="notice-dismiss"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  | 106 | 109 |  |
  | 107 | 110 | pms\_add\_plugin\_notification( $notification\_id, $message, 'pms-notice pms-narrow notice notice-info', true, array( 'pms-settings-page' ) ); |
  | […](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3145313#L118) | […](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3160323#L121) |  |
  | 118 | 121 | $message .= '<p style="margin-top: 16px;">' . wp\_kses\_post( '<strong>LearnDash Integration</strong> for <strong>Paid Member Subscriptions</strong> is now available!<br><br>Sell access to courses, create beautiful front-end register, login and reset password forms and restrict access to your Courses, Lessons and Quizzes.<br>Activate from the <a href="'.admin\_url( 'admin.php?page=pms-addons-page' ).'">add-ons</a> page.' ) . '</p>'; |
  | 119 | 122 | $message .= '<p><a href="https://www.cozmoslabs.com/add-ons/learndash/?utm\_source=wpbackend&utm\_medium=addon-notification&utm\_campaign=PMSPaid" class="button-primary" target="\_blank">' . esc\_html\_\_( 'Learn More', 'paid-member-subscriptions' ) . '</a></p>'; |
  | 120 |  | $message .= '<a href="' . esc\_url( ~~add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id )~~ ) ) . '" type="button" class="notice-dismiss"><span class="screen-reader-text" target="\_blank">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  |  | 123 | $message .= '<a href="' . esc\_url( wp\_nonce\_url( add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id ) ), 'pms\_plugin\_notice\_dismiss' ) ) . '" type="button" class="notice-dismiss"><span class="screen-reader-text" target="\_blank">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  | 121 | 124 |  |
  | 122 | 125 | pms\_add\_plugin\_notification( $notification\_id, $message, 'pms-notice pms-narrow notice notice-success', true, array( 'pms-addons-page' ) ); |
  | […](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3145313#L130) | […](/browser/paid-member-subscriptions/trunk/includes/functions-plugin-notifications.php?rev=3160323#L133) |  |
  | 130 | 133 | $message .= '<p><a style="min-width: auto !important;height:30px; margin-right: 12px;" href="https://www.cozmoslabs.com/wordpress-paid-member-subscriptions/?utm\_source=wpbackend&utm\_medium=addon-notification&utm\_campaign=PMSFree#pricing" class="button-primary" target="\_blank">' . esc\_html\_\_( 'Buy now', 'paid-member-subscriptions' ) . '</a>'; |
  | 131 | 134 | $message .= '<a href="https://www.cozmoslabs.com/add-ons/learndash/?utm\_source=wpbackend&utm\_medium=addon-notification&utm\_campaign=PMSFree" class="button button-secondary"  target="\_blank">' . esc\_html\_\_( 'Learn More', 'paid-member-subscriptions' ) . '</a></p>'; |
  | 132 |  | $message .= '<a href="' . esc\_url( ~~add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id )~~ ) ) . '" type="button" class="notice-dismiss"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  |  | 135 | $message .= '<a href="' . esc\_url( wp\_nonce\_url( add\_query\_arg( array( 'pms\_dismiss\_admin\_notification' => $notification\_id ) ), 'pms\_plugin\_notice\_dismiss' ) ) . '" type="button" class="notice-dismiss"><span class="screen-reader-text">' . esc\_html\_\_( 'Dismiss this notice.', 'paid-member-subscriptions' ) . '</span></a>'; |
  | 133 | 136 |  |
  | 134 | 137 | pms\_add\_plugin\_notification( $notification\_id, $message, 'pms-notice pms-narrow notice notice-success', true, array( 'pms-addons-page' ) ); |
* ## [paid-member-subscriptions/trunk/includes/functions-user-roles.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/functions-user-roles.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/functions-user-roles.php")

  | [r3031453](/browser/paid-member-subscriptions/trunk/includes/functions-user-roles.php?rev=3031453#L308 "Show revision 3031453 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/functions-user-roles.php?rev=3160323#L308 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 308 | 308 | } |
  | 309 | 309 | add\_action( 'pms\_abandon\_member\_subscription\_successful', 'pms\_member\_remove\_user\_role\_subscription\_abandoned', 10, 2 ); |
  |  | 310 |  |
  |  | 311 |  |
  |  | 312 | /\*\* |
  |  | 313 | \* Multiple Roles Selection |
  |  | 314 | \* |
  |  | 315 | \*/ |
  |  | 316 | class PMS\_Multiple\_Roles\_Selection { |
  |  | 317 |  |
  |  | 318 | function \_\_construct() { |
  |  | 319 |  |
  |  | 320 | // Add multiple roles checkbox to back-end Add / Edit User (as admin) |
  |  | 321 | add\_action( 'load-user-new.php', array( $this, 'actions\_on\_user\_new' ) ); |
  |  | 322 | add\_action( 'load-user-edit.php', array( $this, 'actions\_on\_user\_edit' ) ); |
  |  | 323 |  |
  |  | 324 | add\_action( 'load-profile.php', array( $this, 'actions\_on\_user\_new' ) ); |
  |  | 325 | add\_action( 'load-profile.php', array( $this, 'actions\_on\_user\_edit' ) ); |
  |  | 326 |  |
  |  | 327 | } |
  |  | 328 |  |
  |  | 329 | public function sanitize\_role( $role ) { |
  |  | 330 |  |
  |  | 331 | $role = strtolower( $role ); |
  |  | 332 | $role = wp\_strip\_all\_tags( $role ); |
  |  | 333 | $role = preg\_replace( '/[^a-z0-9\_\-\s]/', '', $role ); |
  |  | 334 | $role = str\_replace( ' ', '\_', $role ); |
  |  | 335 | $role = sanitize\_text\_field( $role ); |
  |  | 336 |  |
  |  | 337 | return $role; |
  |  | 338 |  |
  |  | 339 | } |
  |  | 340 |  |
  |  | 341 | // Add actions on Add User back-end page |
  |  | 342 | public function actions\_on\_user\_new() { |
  |  | 343 |  |
  |  | 344 | $this->scripts\_and\_styles\_actions( 'user\_new' ); |
  |  | 345 |  |
  |  | 346 | add\_action( 'user\_new\_form', array( $this, 'roles\_field\_user\_new' ) ); |
  |  | 347 |  |
  |  | 348 | add\_action( 'user\_register', array( $this, 'roles\_update\_user\_new' ) ); |
  |  | 349 |  |
  |  | 350 | } |
  |  | 351 |  |
  |  | 352 | // Add actions on Edit User back-end page |
  |  | 353 | public function actions\_on\_user\_edit() { |
  |  | 354 |  |
  |  | 355 | $this->scripts\_and\_styles\_actions( 'user\_edit' ); |
  |  | 356 |  |
  |  | 357 | add\_action( 'personal\_options', array( $this, 'roles\_field\_user\_edit' ) ); |
  |  | 358 |  |
  |  | 359 | add\_action( 'profile\_update', array( $this, 'roles\_update\_user\_edit' ), 10, 2 ); |
  |  | 360 |  |
  |  | 361 | } |
  |  | 362 |  |
  |  | 363 | // Roles Edit checkboxes for Add User back-end page |
  |  | 364 | public function roles\_field\_user\_new() { |
  |  | 365 |  |
  |  | 366 | if( ! current\_user\_can( 'promote\_users' ) ) { |
  |  | 367 | return; |
  |  | 368 | } |
  |  | 369 |  |
  |  | 370 | $user\_roles = apply\_filters( 'pms\_default\_user\_roles', array( get\_option( 'default\_role' ) ) ); |
  |  | 371 |  |
  |  | 372 | if( isset( $\_POST['createuser'] ) && ! empty( $\_POST['pms\_re\_user\_roles'] ) ) { |
  |  | 373 | $user\_roles = array\_map( array( $this, 'sanitize\_role' ), $\_POST['pms\_re\_user\_roles'] );// phpcs:ignore  WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  |  | 374 | } |
  |  | 375 |  |
  |  | 376 | wp\_nonce\_field( 'new\_user\_roles', 'pms\_re\_new\_user\_roles\_nonce' ); |
  |  | 377 |  |
  |  | 378 | if( apply\_filters( 'pms\_backend\_allow\_multiple\_user\_roles\_selection', true ) ) { |
  |  | 379 | $this->roles\_field\_display( $user\_roles ); |
  |  | 380 | } |
  |  | 381 |  |
  |  | 382 | } |
  |  | 383 |  |
  |  | 384 | // Roles Edit checkboxes for Edit User back-end page |
  |  | 385 | public function roles\_field\_user\_edit( $user ) { |
  |  | 386 |  |
  |  | 387 | if( ! current\_user\_can( 'promote\_users' ) || ! current\_user\_can( 'edit\_user', $user->ID ) ) { |
  |  | 388 | return; |
  |  | 389 | } |
  |  | 390 |  |
  |  | 391 | $user\_roles = (array) $user->roles; |
  |  | 392 |  |
  |  | 393 | wp\_nonce\_field( 'new\_user\_roles', 'pms\_re\_new\_user\_roles\_nonce' ); |
  |  | 394 |  |
  |  | 395 | if( apply\_filters( 'pms\_backend\_allow\_multiple\_user\_roles\_selection', true ) ) { |
  |  | 396 | $this->roles\_field\_display( $user\_roles ); |
  |  | 397 | } |
  |  | 398 | } |
  |  | 399 |  |
  |  | 400 | // Output roles edit checkboxes |
  |  | 401 | public function roles\_field\_display( $user\_roles ) { |
  |  | 402 |  |
  |  | 403 | $pms\_roles = get\_editable\_roles(); |
  |  | 404 |  |
  |  | 405 | ?> |
  |  | 406 | <table class="form-table"> |
  |  | 407 | <tr class="pms-re-edit-user"> |
  |  | 408 | <th><?php esc\_html\_e( 'Edit User Roles', 'paid-member-subscriptions' ); ?></th> |
  |  | 409 |  |
  |  | 410 | <td> |
  |  | 411 | <div> |
  |  | 412 | <ul style="margin: 5px 0;"> |
  |  | 413 | <?php foreach( $pms\_roles as $role\_slug => $role\_details ) { ?> |
  |  | 414 | <li> |
  |  | 415 | <label> |
  |  | 416 | <input type="checkbox" name="pms\_re\_user\_roles[]" value="<?php echo esc\_attr( $role\_slug ); ?>" <?php checked( in\_array( $role\_slug, $user\_roles ) ); ?> /> |
  |  | 417 | <?php echo esc\_html( translate\_user\_role( $role\_details['name'] ) ); ?> |
  |  | 418 | </label> |
  |  | 419 | </li> |
  |  | 420 | <?php } ?> |
  |  | 421 | </ul> |
  |  | 422 | </div> |
  |  | 423 | </td> |
  |  | 424 | </tr> |
  |  | 425 | </table> |
  |  | 426 |  |
  |  | 427 | <?php |
  |  | 428 | } |
  |  | 429 |  |
  |  | 430 | public function roles\_update\_user\_edit( $user\_id, $old\_user\_data ) { |
  |  | 431 |  |
  |  | 432 | if( ! current\_user\_can( 'promote\_users' ) || ! current\_user\_can( 'edit\_user', $user\_id ) ) { |
  |  | 433 | return; |
  |  | 434 | } |
  |  | 435 |  |
  |  | 436 | if( ! isset( $\_POST['pms\_re\_new\_user\_roles\_nonce'] ) || ! wp\_verify\_nonce( sanitize\_text\_field( $\_POST['pms\_re\_new\_user\_roles\_nonce'] ), 'new\_user\_roles' ) ) { |
  |  | 437 | return; |
  |  | 438 | } |
  |  | 439 |  |
  |  | 440 | $this->roles\_update\_user\_new\_and\_edit( $old\_user\_data ); |
  |  | 441 |  |
  |  | 442 | } |
  |  | 443 |  |
  |  | 444 | public function roles\_update\_user\_new( $user\_id ) { |
  |  | 445 |  |
  |  | 446 | if( ! current\_user\_can( 'promote\_users' ) ) { |
  |  | 447 | return; |
  |  | 448 | } |
  |  | 449 |  |
  |  | 450 | if( ! isset( $\_POST['pms\_re\_new\_user\_roles\_nonce'] ) || ! wp\_verify\_nonce( sanitize\_text\_field( $\_POST['pms\_re\_new\_user\_roles\_nonce'] ), 'new\_user\_roles' ) ) { |
  |  | 451 | return; |
  |  | 452 | } |
  |  | 453 |  |
  |  | 454 | $user = new \WP\_User( $user\_id ); |
  |  | 455 |  |
  |  | 456 | $this->roles\_update\_user\_new\_and\_edit( $user ); |
  |  | 457 |  |
  |  | 458 | } |
  |  | 459 |  |
  |  | 460 | public function roles\_update\_user\_new\_and\_edit( $user ) { |
  |  | 461 |  |
  |  | 462 | if( ! empty( $\_POST['pms\_re\_user\_roles'] ) || !empty( $\_POST['role'] ) ) { |
  |  | 463 |  |
  |  | 464 | $old\_roles = (array) $user->roles; |
  |  | 465 |  |
  |  | 466 | if( isset( $\_POST['pms\_re\_user\_roles'] ) ) |
  |  | 467 | $new\_roles = array\_map( array( $this, 'sanitize\_role' ), $\_POST['pms\_re\_user\_roles'] );//phpcs:ignore  WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  |  | 468 | else |
  |  | 469 | $new\_roles = array( $this->sanitize\_role( $\_POST['role'] ) ); //phpcs:ignore  WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  |  | 470 |  |
  |  | 471 | foreach( $new\_roles as $new\_role ) { |
  |  | 472 | if( ! in\_array( $new\_role, (array) $user->roles ) ) { |
  |  | 473 | $user->add\_role( $new\_role ); |
  |  | 474 | } |
  |  | 475 | } |
  |  | 476 |  |
  |  | 477 | foreach( $old\_roles as $old\_role ) { |
  |  | 478 | if( ! in\_array( $old\_role, $new\_roles ) ) { |
  |  | 479 | $user->remove\_role( $old\_role ); |
  |  | 480 | } |
  |  | 481 | } |
  |  | 482 | } else { |
  |  | 483 | foreach( (array) $user->roles as $old\_role ) { |
  |  | 484 | $user->remove\_role( $old\_role ); |
  |  | 485 | } |
  |  | 486 | } |
  |  | 487 |  |
  |  | 488 | } |
  |  | 489 |  |
  |  | 490 | public function scripts\_and\_styles\_actions( $location ) { |
  |  | 491 |  |
  |  | 492 | // Enqueue jQuery on both Add User and Edit User back-end pages |
  |  | 493 | add\_action( 'admin\_enqueue\_scripts', array( $this, 'enqueue\_jquery' ) ); |
  |  | 494 |  |
  |  | 495 | // Actions for Add User back-end page |
  |  | 496 | if( $location == 'user\_new' && apply\_filters( 'pms\_backend\_allow\_multiple\_user\_roles\_selection', true ) ) { |
  |  | 497 | add\_action( 'admin\_footer', array( $this, 'print\_scripts\_user\_new' ), 25 ); |
  |  | 498 | } |
  |  | 499 |  |
  |  | 500 | // Actions for Edit User back-end page |
  |  | 501 | if( $location == 'user\_edit' && apply\_filters( 'pms\_backend\_allow\_multiple\_user\_roles\_selection', true ) ) { |
  |  | 502 | add\_action( 'admin\_head', array( $this, 'print\_styles\_user\_edit' ) ); |
  |  | 503 | add\_action( 'admin\_footer', array( $this, 'print\_scripts\_user\_edit' ), 25 ); |
  |  | 504 | } |
  |  | 505 |  |
  |  | 506 | } |
  |  | 507 |  |
  |  | 508 | // Enqueue jQuery where needed (use action) |
  |  | 509 | public function enqueue\_jquery() { |
  |  | 510 |  |
  |  | 511 | wp\_enqueue\_script( 'jquery' ); |
  |  | 512 |  |
  |  | 513 | } |
  |  | 514 |  |
  |  | 515 | // Print scripts on Add User back-end page |
  |  | 516 | public function print\_scripts\_user\_new() { |
  |  | 517 |  |
  |  | 518 | ?> |
  |  | 519 | <script> |
  |  | 520 | jQuery( document ).ready( function() { |
  |  | 521 | // Remove WordPress default Role Select |
  |  | 522 | var roles\_dropdown = jQuery( 'select#role' ); |
  |  | 523 | roles\_dropdown.closest( 'tr' ).remove(); |
  |  | 524 | } ); |
  |  | 525 | </script> |
  |  | 526 |  |
  |  | 527 | <?php |
  |  | 528 | } |
  |  | 529 |  |
  |  | 530 | // Print scripts on Edit User back-end page |
  |  | 531 | public function print\_scripts\_user\_edit() { |
  |  | 532 |  |
  |  | 533 | ?> |
  |  | 534 | <script> |
  |  | 535 | jQuery( document ).ready( |
  |  | 536 | // Remove WordPress default Role Select |
  |  | 537 | function() { |
  |  | 538 | jQuery( '.user-role-wrap' ).remove(); |
  |  | 539 | } |
  |  | 540 | ); |
  |  | 541 | </script> |
  |  | 542 |  |
  |  | 543 | <?php |
  |  | 544 | } |
  |  | 545 |  |
  |  | 546 | // Print scripts on Edit User back-end page |
  |  | 547 | public function print\_styles\_user\_edit() { |
  |  | 548 |  |
  |  | 549 | ?> |
  |  | 550 | <style type="text/css"> |
  |  | 551 | /\* Hide WordPress default Role Select \*/ |
  |  | 552 | .user-role-wrap { |
  |  | 553 | display: none !important; |
  |  | 554 | } |
  |  | 555 | </style> |
  |  | 556 |  |
  |  | 557 | <?php |
  |  | 558 | } |
  |  | 559 |  |
  |  | 560 | } |
  |  | 561 |  |
  |  | 562 | if ( ! function\_exists( 'is\_plugin\_active' ) ) { |
  |  | 563 | require\_once( ABSPATH . 'wp-admin/includes/plugin.php' ); |
  |  | 564 | } |
  |  | 565 |  |
  |  | 566 | $wppb\_generalSettings = get\_option( 'wppb\_general\_settings', 'not\_found' ); |
  |  | 567 |  |
  |  | 568 | if(  ! is\_plugin\_active( 'profile-builder/index.php' ) || $wppb\_generalSettings == 'not\_found' || empty( $wppb\_generalSettings['rolesEditor'] ) || $wppb\_generalSettings['rolesEditor'] !== 'yes'  ) { |
  |  | 569 | $pms\_role\_editor\_instance = new PMS\_Multiple\_Roles\_Selection(); |
  |  | 570 | } |
* ## [paid-member-subscriptions/trunk/includes/gateways/paypal\_standard/functions-paypal-standard.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/gateways/paypal_standard/functions-paypal-standard.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/gateways/paypal_standard/functions-paypal-standard.php")

  | [r2949078](/browser/paid-member-subscriptions/trunk/includes/gateways/paypal_standard/functions-paypal-standard.php?rev=2949078#L50 "Show revision 2949078 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/gateways/paypal_standard/functions-paypal-standard.php?rev=3160323#L50 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 50 | 50 |  |
  | 51 | 51 | <?php if( in\_array( 'paypal\_standard', $options['active\_pay\_gates'] ) ) : ?> |
  | 52 |  | <?php $paypal\_ipn\_url = esc\_url( add\_query\_arg( 'pay\_gate\_listener', 'paypal\_ipn', trailingslashit( home\_url() ) ) ); ?> |
  |  | 52 | <?php |
  |  | 53 | $paypal\_ipn\_url = esc\_url( add\_query\_arg( 'pay\_gate\_listener', 'paypal\_ipn', trailingslashit( home\_url() ) ) ); |
  |  | 54 | $paypal\_link\_doc = '<a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/payment-gateways/paypal-standard/#Setting\_up\_Instant\_Payment\_Notifications\_IPN" target="\_blank" data-code="f223" class="pms-docs-link dashicons dashicons-editor-help"></a>'; |
  |  | 55 | ?> |
  | 53 | 56 | <?php elseif( in\_array( 'paypal\_express', $options['active\_pay\_gates'] ) ) : ?> |
  | 54 |  | <?php $paypal\_ipn\_url = esc\_url( add\_query\_arg( 'pay\_gate\_listener', 'paypal\_epipn', trailingslashit( home\_url() ) ) ); ?> |
  |  | 57 | <?php |
  |  | 58 | $paypal\_ipn\_url = esc\_url( add\_query\_arg( 'pay\_gate\_listener', 'paypal\_epipn', trailingslashit( home\_url() ) ) ); |
  |  | 59 | $paypal\_link\_doc = '<a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/add-ons/paypal-pro-and-express-checkout/#Setting\_up\_Instant\_Payment\_Notifications\_IPN" target="\_blank" data-code="f223" class="pms-docs-link dashicons dashicons-editor-help"></a>'; |
  |  | 60 | ?> |
  | 55 | 61 | <?php else: ?> |
  | 56 | 62 | <?php $paypal\_ipn\_url = ""; ?> |
  | […](/browser/paid-member-subscriptions/trunk/includes/gateways/paypal_standard/functions-paypal-standard.php?rev=2949078#L64) | […](/browser/paid-member-subscriptions/trunk/includes/gateways/paypal_standard/functions-paypal-standard.php?rev=3160323#L70) |  |
  | 64 | 70 |  |
  | 65 | 71 | <p class="pms-ipn-notice cozmoslabs-description cozmoslabs-description-space-left"> |
  | 66 |  | <?php printf( wp\_kses\_post( \_\_( 'In order for <strong>PayPal payments to work correctly</strong>, you need to setup the IPN Url in your PayPal account. %s', 'paid-member-subscriptions' ) ), ~~'<a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/add-ons/recurring-payments-for-paypal-standard/?utm\_source=wpbackend&utm\_medium=pms-documentation&utm\_campaign=PMSDocs#Setting\_up\_Instant\_Payment\_Notifications\_IPN" target="\_blank" data-code="f223" class="pms-docs-link dashicons dashicons-editor-help"></a>'~~ ); ?> |
  |  | 72 | <?php printf( wp\_kses\_post( \_\_( 'In order for <strong>PayPal payments to work correctly</strong>, you need to setup the IPN Url in your PayPal account. %s', 'paid-member-subscriptions' ) ), wp\_kses\_post( $paypal\_link\_doc ) ); ?> |
  | 67 | 73 | </p> |
  | 68 | 74 | </div> |
* ## [paid-member-subscriptions/trunk/includes/gateways/stripe/admin/functions-admin-connect.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/gateways/stripe/admin/functions-admin-connect.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/gateways/stripe/admin/functions-admin-connect.php")

  | [r3118211](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/admin/functions-admin-connect.php?rev=3118211#L574 "Show revision 3118211 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/admin/functions-admin-connect.php?rev=3160323#L574 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 574 | 574 | echo '<input id="stripe-connect-webhook-url" type="text" name="stripe\_connect\_webhook\_url" value="' . esc\_url( add\_query\_arg( 'pay\_gate\_listener', 'stripe', trailingslashit( home\_url() ) ) ) . '" class="widefat" disabled /><a class="stripe-connect\_\_copy button-secondary" data-id="stripe-connect-webhook-url" href="" style="margin-left: 4px;">Copy</a>'; |
  | 575 | 575 |  |
  | 576 |  | echo '<p class="cozmoslabs-description cozmoslabs-description-space-left">' . wp\_kses\_post( sprintf( \_\_( 'Copy this URL and configure it in your Stripe Account~~under Developers -> Webhooks -> Add Endpoint. %sClick here%s to see the list of necessary events and learn more. ', 'paid-member-subscriptions' ), '<br><a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/payment-gateways/stripe-connect/~~">', '</a>' ) ) . '</p>'; |
  |  | 576 | echo '<p class="cozmoslabs-description cozmoslabs-description-space-left">' . wp\_kses\_post( sprintf( \_\_( 'Copy this URL and configure it in your Stripe Account. %sClick here%s to learn more about the Webhooks setup process. ', 'paid-member-subscriptions' ), '<br><a href="https://www.cozmoslabs.com/docs/paid-member-subscriptions/payment-gateways/stripe-connect/#Webhooks\_setup">', '</a>' ) ) . '</p>'; |
  | 577 | 577 |  |
  | 578 | 578 | echo '</div>'; |
* ## [paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js](/changeset/3160323/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js")

  | [r3145313](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js?rev=3145313#L124 "Show revision 3145313 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js?rev=3160323#L124 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 124 | 124 | // Payment Intents |
  | 125 | 125 | $(document).on( 'wppb\_invisible\_recaptcha\_success', stripeConnectPaymentGatewayHandler ) |
  |  | 126 | $(document).on( 'wppb\_v3\_recaptcha\_success', stripeConnectPaymentGatewayHandler ) |
  | 126 | 127 |  |
  | 127 | 128 | $(document).on('submit', '.pms-form', function (e) { |
  | 128 | 129 |  |
  | 129 |  | if( e.target && ( jQuery( e.target ).attr('id') == 'pms\_recover\_password\_form' || jQuery( e.target ).attr('id') == 'pms\_new\_password\_form' ) ) |
  |  | 130 | if( e.target && ( jQuery( e.target ).attr('id') == 'pms\_recover\_password\_form' || jQuery( e.target ).attr('id') == 'pms\_new\_password\_form' || jQuery( e.target ).attr('id') == 'pms\_login' ) ) |
  | 130 | 131 | return |
  | 131 | 132 |  |
  | […](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js?rev=3145313#L153) | […](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js?rev=3160323#L154) |  |
  | 153 | 154 | $(document).on('submit', '.wppb-register-user', function (e) { |
  | 154 | 155 |  |
  | 155 |  | if ( !~~$('.wppb-recaptcha .wppb-recaptcha-element', $(e.currentTarget)).hasClass('wppb-invisible-recaptcha'~~) ) { |
  |  | 156 | if ( ! ( $( '.wppb-recaptcha .wppb-recaptcha-element', $(e.currentTarget) ).hasClass( 'wppb-invisible-recaptcha' ) || $( '.wppb-recaptcha .wppb-recaptcha-element', $(e.currentTarget) ).hasClass( 'wppb-v3-recaptcha' ) ) ) { |
  | 156 | 157 |  |
  | 157 | 158 | var target\_button = $('input[type="submit"], button[type="submit"]', $(this)).not('#pms-apply-discount').not('input[name="pms\_redirect\_back"]') |
  | […](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js?rev=3145313#L178) | […](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js?rev=3160323#L179) |  |
  | 178 | 179 |  |
  | 179 | 180 | // Current submit button can't be determined from `this` context in case of the Invisible reCaptcha handler |
  | 180 |  | if( e.type == 'wppb\_invisible\_recaptcha\_success' ){ |
  |  | 181 | if( e.type == 'wppb\_invisible\_recaptcha\_success' || e.type == 'wppb\_v3\_recaptcha\_success' ){ |
  | 181 | 182 |  |
  | 182 | 183 | // target\_button is supplied to the handler starting with version 3.5.0 of Profile Builder, we use this for backwards compatibility |
  | […](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js?rev=3145313#L418) | […](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/assets/front-end-connect.js?rev=3160323#L419) |  |
  | 418 | 419 | return |
  | 419 | 420 |  |
  | 420 |  | var submitButton = $('.pms-form .pms-form-submit, .pms-form input[type="submit"], .pms-form button[type="submit"], .wppb-register-user input[type="submit"], .wppb-register-user button[type="submit"]').not('#pms-apply-discount') |
  |  | 421 | var submitButton = $('.pms-form .pms-form-submit, .pms-form input[type="submit"], .pms-form button[type="submit"], .wppb-register-user input[type="submit"], .wppb-register-user button[type="submit"]').not('#pms-apply-discount, .login-submit #wp-submit') |
  | 421 | 422 |  |
  | 422 | 423 | var data = stripeConnectGetFormData( submitButton ) |
* ## [paid-member-subscriptions/trunk/includes/gateways/stripe/class-payment-gateway-stripe-connect.php](/changeset/3160323/paid-member-subscriptions/trunk/includes/gateways/stripe/class-payment-gateway-stripe-connect.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/includes/gateways/stripe/class-payment-gateway-stripe-connect.php")

  | [r3145313](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/class-payment-gateway-stripe-connect.php?rev=3145313#L2500 "Show revision 3145313 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/includes/gateways/stripe/class-payment-gateway-stripe-connect.php?rev=3160323#L2500 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 2500 | 2500 | if( !empty( $plans ) ){ |
  | 2501 | 2501 | foreach( $plans as $plan ){ |
  | 2502 |  | if( !empty( $plan->price ) ){ |
  |  | 2502 | if( !empty( $plan->price ) && $plan->price > 1 ){ |
  | 2503 | 2503 | $amount = $plan->price; |
  | 2504 | 2504 | break; |
* ## [paid-member-subscriptions/trunk/index.php](/changeset/3160323/paid-member-subscriptions/trunk/index.php "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/index.php")

  | [r3149295](/browser/paid-member-subscriptions/trunk/index.php?rev=3149295#L4 "Show revision 3149295 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/index.php?rev=3160323#L4 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: http://www.cozmoslabs.com/ |
  | 5 | 5 | \* Description: Accept payments, create subscription plans and restrict content on your membership website. |
  | 6 |  | \* Version: 2.12.~~8~~ |
  |  | 6 | \* Version: 2.12.9 |
  | 7 | 7 | \* Author: Cozmoslabs |
  | 8 | 8 | \* Author URI: http://www.cozmoslabs.com/ |
  | […](/browser/paid-member-subscriptions/trunk/index.php?rev=3149295#L11) | […](/browser/paid-member-subscriptions/trunk/index.php?rev=3160323#L11) |  |
  | 11 | 11 | \* License: GPL2 |
  | 12 | 12 | \* WC requires at least: 3.0.0 |
  | 13 |  | \* WC tested up to: 9.~~2~~ |
  | 14 |  | \* Elementor tested up to: 3.24.~~0~~ |
  | 15 |  | \* Elementor Pro tested up to: 3.24.~~0~~ |
  |  | 13 | \* WC tested up to: 9.3 |
  |  | 14 | \* Elementor tested up to: 3.24.4 |
  |  | 15 | \* Elementor Pro tested up to: 3.24.4 |
  | 16 | 16 | \* |
  | 17 | 17 | \* == Copyright == |
  | […](/browser/paid-member-subscriptions/trunk/index.php?rev=3149295#L40) | […](/browser/paid-member-subscriptions/trunk/index.php?rev=3160323#L40) |  |
  | 40 | 40 | public function \_\_construct() { |
  | 41 | 41 |  |
  | 42 |  | define( 'PMS\_VERSION', '2.12.~~8~~' ); |
  |  | 42 | define( 'PMS\_VERSION', '2.12.9' ); |
  | 43 | 43 | define( 'PMS\_PLUGIN\_DIR\_PATH', plugin\_dir\_path( \_\_FILE\_\_ ) ); |
  | 44 | 44 | define( 'PMS\_PLUGIN\_DIR\_URL', plugin\_dir\_url( \_\_FILE\_\_ ) ); |
  | […](/browser/paid-member-subscriptions/trunk/index.php?rev=3149295#L886) | […](/browser/paid-member-subscriptions/trunk/index.php?rev=3160323#L886) |  |
  | 886 | 886 | if( file\_exists( PMS\_PLUGIN\_DIR\_PATH . 'includes/admin/pricing-table-designs/pricing-table-designs.php' ) ) |
  | 887 | 887 | include\_once PMS\_PLUGIN\_DIR\_PATH . 'includes/admin/pricing-table-designs/pricing-table-designs.php'; |
  | 888 |  |  |
  | 889 | 888 |  |
  | 890 | 889 | /\* |
* ## [paid-member-subscriptions/trunk/readme.txt](/changeset/3160323/paid-member-subscriptions/trunk/readme.txt "Show the changeset 3160323 restricted to paid-member-subscriptions/trunk/readme.txt")

  | [r3149295](/browser/paid-member-subscriptions/trunk/readme.txt?rev=3149295#L5 "Show revision 3149295 of this file in browser") | [r3160323](/browser/paid-member-subscriptions/trunk/readme.txt?rev=3160323#L5 "Show revision 3160323 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires at least: 3.1 |
  | 6 | 6 | Tested up to: 6.6 |
  | 7 |  | Stable tag: 2.12.~~8~~ |
  |  | 7 | Stable tag: 2.12.9 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: https://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/paid-member-subscriptions/trunk/readme.txt?rev=3149295#L60) | […](/browser/paid-member-subscriptions/trunk/readme.txt?rev=3160323#L60) |  |
  | 60 | 60 | \* \*\*[pms-payment-history]\*\* - adds a front-end table with the member's payment history |
  | 61 | 61 | \* \*\*[pms-recover-password]\*\* - adds a recover password password form, that enables users to reset their password if needed |
  | 62 |  |  |
  | 63 |  | ~~https://www.youtube.com/watch?v=6AEIvvCOZHM&start=0&autoplay=1~~ |
  | 64 | 62 |  |
  | 65 | 63 | = Membership Modules: = |
  | […](/browser/paid-member-subscriptions/trunk/readme.txt?rev=3149295#L253) | […](/browser/paid-member-subscriptions/trunk/readme.txt?rev=3160323#L251) |  |
  | 253 | 251 |  |
  | 254 | 252 | == Changelog == |
  |  | 253 | = 2.12.9 = |
  |  | 254 | \* Feature: Added option to exclude restricted posts from default queries. Go to Settings -> Content Restriction to enable this functionality |
  |  | 255 | \* Feature: Implemented a Multiple User Role selection functionality for the Users -> Edit User page |
  |  | 256 | \* Fix: Did a security review fixing random issues |
  |  | 257 | \* Fix: Security issue regarding unproperly sanitized URLs around some back-end pages. Thanks to Colin Xu from Wordfence |
  |  | 258 | \* Fix: Issue with Stripe when both Login and Register forms were present on the same page |
  |  | 259 | \* Misc: Corrected some documentation links |
  |  | 260 | \* Misc: Let the Stripe Payment Element grow naturally with the form width |
  |  | 261 |  |
  | 255 | 262 | = 2.12.8 = |
  | 256 | 263 | \* Fix: Incorrect spelling on cancel button title |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3160323)
* [Zip Archive](?format=zip&new=3160323)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_5316e224_20250111_123624.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fpaid-member-subscriptions%2Ftags%2F2.12.8%2Fincludes%2Fadmin%2Fclass-admin-payments-list-table.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=2818040 "Revision 2818040")
* [Next Revision](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?rev=3160323 "Revision 3160323") →
* [Blame](/browser/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/paid-member-subscriptions/tags/2.12.8/includes/admin/class-admin-payments-list-table.php)

---

# [source:](/browser?order=name "Go to repository root") [paid-member-subscriptions](/browser/paid-member-subscriptions?order=name "View paid-member-subscriptions")/[tags](/browser/paid-member-subscriptions/tags?order=name "View tags")/[2.12.8](/browser/paid-member-subscriptions/tags/2.12.8?order=name "View 2.12.8")/[includes](/browser/paid-member-subscriptions/tags/2.12.8/includes?order=name "View includes")/[admin](/browser/paid-member-subscriptions/tags/2.12.8/includes/admin?order=name "View admin")/[class-admin-payments-list-table.php](/browser/paid-member-subscriptions/tags/2.12.8/includes/admin/class-admin-payments-list-table.php?order=name "View class-admin-payments-list-table.php")

View diff against:

View revision:

| [Last change](/changeset/3086317/paid-member-subscriptions/trunk/includes/admin/class-admin-payments-list-table.php "View differences") on this file was [3086317](/changeset/3086317/ "View changeset 3086317"), checked in by raster02, [8 months ago](/timeline?from=2024-05-14T08%3A14%3A49Z&precision=second "See timeline at 05/14/2024 08:14:49 AM") |
| --- |
| tagging version 2.12.0 |
| **File size:** 17.4 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | // Exit if accessed directly |
| [4](#L4) | if ( ! defined( 'ABSPATH' ) ) exit; |
| [5](#L5) |  |
| [6](#L6) | // WP\_List\_Table is not loaded automatically in the plugins section |
| [7](#L7) | if( ! class\_exists( 'WP\_List\_Table' ) ) { |
| [8](#L8) | require\_once( ABSPATH . 'wp-admin/includes/class-wp-list-table.php' ); |
| [9](#L9) | } |
| [10](#L10) |  |
| [11](#L11) |  |
| [12](#L12) | /\* |
| [13](#L13) | \* Extent WP default list table for our custom payments section |
| [14](#L14) | \* |
| [15](#L15) | \*/ |
| [16](#L16) | Class PMS\_Payments\_List\_Table extends WP\_List\_Table { |
| [17](#L17) |  |
| [18](#L18) | /\*\* |
| [19](#L19) | \* Payments per page |
| [20](#L20) | \* |
| [21](#L21) | \* @access public |
| [22](#L22) | \* @var int |
| [23](#L23) | \*/ |
| [24](#L24) | public $items\_per\_page; |
| [25](#L25) |  |
| [26](#L26) | /\*\* |
| [27](#L27) | \* Payments table data |
| [28](#L28) | \* |
| [29](#L29) | \* @access public |
| [30](#L30) | \* @var array |
| [31](#L31) | \*/ |
| [32](#L32) | public $data; |
| [33](#L33) |  |
| [34](#L34) | /\*\* |
| [35](#L35) | \* Payments table views count |
| [36](#L36) | \* |
| [37](#L37) | \* @access public |
| [38](#L38) | \* @var array |
| [39](#L39) | \*/ |
| [40](#L40) | public $views\_count = array(); |
| [41](#L41) |  |
| [42](#L42) | /\*\* |
| [43](#L43) | \* The total number of items |
| [44](#L44) | \* |
| [45](#L45) | \* @access private |
| [46](#L46) | \* @var int |
| [47](#L47) | \* |
| [48](#L48) | \*/ |
| [49](#L49) | private $total\_items; |
| [50](#L50) |  |
| [51](#L51) | /\*\* |
| [52](#L52) | \* Constructor function |
| [53](#L53) | \* |
| [54](#L54) | \*/ |
| [55](#L55) | public function \_\_construct() { |
| [56](#L56) |  |
| [57](#L57) | $screen = get\_current\_screen(); |
| [58](#L58) |  |
| [59](#L59) | parent::\_\_construct( array( |
| [60](#L60) | 'singular'  => 'payment', |
| [61](#L61) | 'plural'    => 'payments', |
| [62](#L62) | 'ajax'      => false, |
| [63](#L63) | 'screen'    => $screen->id, |
| [64](#L64) | )); |
| [65](#L65) |  |
| [66](#L66) | add\_filter( 'manage\_' . $screen->id . ' \_columns' , array( $this , 'manage\_columns' ) ); |
| [67](#L67) |  |
| [68](#L68) | // Register custom bulk actions |
| [69](#L69) | add\_filter( 'bulk\_actions-' . $screen->id, array( $this, 'register\_bulk\_actions' ) ); |
| [70](#L70) |  |
| [71](#L71) | //Set items per page |
| [72](#L72) | $items\_per\_page = get\_user\_meta( get\_current\_user\_id(), 'pms\_payments\_per\_page', true ); |
| [73](#L73) |  |
| [74](#L74) | if( empty( $items\_per\_page ) ) |
| [75](#L75) | $items\_per\_page = 10; |
| [76](#L76) |  |
| [77](#L77) | $this->items\_per\_page = $items\_per\_page; |
| [78](#L78) |  |
| [79](#L79) | //Set table data |
| [80](#L80) | $this->set\_table\_data(); |
| [81](#L81) |  |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | public function manage\_columns() { |
| [85](#L85) |  |
| [86](#L86) | $this->get\_column\_info(); |
| [87](#L87) |  |
| [88](#L88) | return $this->\_column\_headers[0]; |
| [89](#L89) |  |
| [90](#L90) | } |
| [91](#L91) |  |
| [92](#L92) | /\* |
| [93](#L93) | \* Register custom bulk actions |
| [94](#L94) | \* |
| [95](#L95) | \* @param array $actions actions. |
| [96](#L96) | \* |
| [97](#L97) | \* @return array |
| [98](#L98) | \* |
| [99](#L99) | \*/ |
| [100](#L100) | function register\_bulk\_actions( $actions ) { |
| [101](#L101) |  |
| [102](#L102) | if( !empty( $\_GET['page'] == 'pms-payments-page' ) && empty( $\_GET['subpage'] ) ) |
| [103](#L103) | $actions['pms\_bulk\_delete\_payments'] = esc\_html\_\_( 'Delete Payments', 'paid-member-subscriptions' ); |
| [104](#L104) |  |
| [105](#L105) | return $actions; |
| [106](#L106) | } |
| [107](#L107) |  |
| [108](#L108) | /\*\* |
| [109](#L109) | \* Overwrites the parent class. |
| [110](#L110) | \* Define the columns for the payments |
| [111](#L111) | \* |
| [112](#L112) | \* @return array |
| [113](#L113) | \* |
| [114](#L114) | \*/ |
| [115](#L115) | public function get\_columns() { |
| [116](#L116) |  |
| [117](#L117) | $columns = array( |
| [118](#L118) | 'cb'             => '<input type="checkbox" />', |
| [119](#L119) | 'id'             => esc\_html\_\_( 'ID', 'paid-member-subscriptions' ), |
| [120](#L120) | 'username'       => esc\_html\_\_( 'User', 'paid-member-subscriptions' ), |
| [121](#L121) | 'subscriptions'  => esc\_html\_\_( 'Subscription', 'paid-member-subscriptions' ), |
| [122](#L122) | 'amount'         => esc\_html\_\_( 'Amount', 'paid-member-subscriptions' ), |
| [123](#L123) | 'date'           => esc\_html\_\_( 'Date / Time', 'paid-member-subscriptions' ), |
| [124](#L124) | 'type'           => esc\_html\_\_( 'Type', 'paid-member-subscriptions' ), |
| [125](#L125) | 'transaction\_id' => esc\_html\_\_( 'Transaction ID', 'paid-member-subscriptions' ), |
| [126](#L126) | 'status'         => esc\_html\_\_( 'Status', 'paid-member-subscriptions' ), |
| [127](#L127) | ); |
| [128](#L128) |  |
| [129](#L129) | return apply\_filters( 'pms\_payments\_list\_table\_columns', $columns ); |
| [130](#L130) |  |
| [131](#L131) | } |
| [132](#L132) |  |
| [133](#L133) |  |
| [134](#L134) | /\*\* |
| [135](#L135) | \* Overwrites the parent class. |
| [136](#L136) | \* Define which columns are sortable |
| [137](#L137) | \* |
| [138](#L138) | \* @return array |
| [139](#L139) | \* |
| [140](#L140) | \*/ |
| [141](#L141) | public function get\_sortable\_columns() { |
| [142](#L142) |  |
| [143](#L143) | return array( |
| [144](#L144) | 'id'     => array( 'id', false ), |
| [145](#L145) | 'status' => array( 'status', false ) |
| [146](#L146) | ); |
| [147](#L147) |  |
| [148](#L148) | } |
| [149](#L149) |  |
| [150](#L150) |  |
| [151](#L151) | /\*\* |
| [152](#L152) | \* Returns the possible views for the members list table |
| [153](#L153) | \* |
| [154](#L154) | \*/ |
| [155](#L155) | protected function get\_views() { |
| [156](#L156) |  |
| [157](#L157) | return apply\_filters( 'pms\_payments\_list\_table\_get\_views', array( |
| [158](#L158) | 'all'       => '<a href="' . remove\_query\_arg( array( 'pms-view', 'paged' ) ) . '" ' . ( !isset( $\_GET['pms-view'] ) ? 'class="current"' : '' ) . '>All <span class="count">(' . ( isset( $this->views\_count['all'] ) ? $this->views\_count['all'] : '' ) . ')</span></a>', |
| [159](#L159) | 'completed' => '<a href="' . add\_query\_arg( array( 'pms-view' => 'completed', 'paged' => 1 ) ) . '" ' . ( isset( $\_GET['pms-view'] ) &&$\_GET['pms-view'] == 'completed' ? 'class="current"' : '' ) . '>Completed <span class="count">(' . ( isset( $this->views\_count['completed'] ) ? $this->views\_count['completed'] : '' ) . ')</span></a>', |
| [160](#L160) | 'pending'   => '<a href="' . add\_query\_arg( array( 'pms-view' => 'pending', 'paged' => 1 ) ) . '" ' . ( isset( $\_GET['pms-view'] ) &&$\_GET['pms-view'] == 'pending' ? 'class="current"' : '' ) . '>Pending <span class="count">(' . ( isset( $this->views\_count['pending'] ) ? $this->views\_count['pending'] : '' ) . ')</span></a>', |
| [161](#L161) | 'failed'    => '<a href="' . add\_query\_arg( array( 'pms-view' => 'failed', 'paged' => 1 ) ) . '" ' . ( isset( $\_GET['pms-view'] ) &&$\_GET['pms-view'] == 'failed' ? 'class="current"' : '' ) . '>Failed <span class="count">(' . ( isset( $this->views\_count['failed'] ) ? $this->views\_count['failed'] : '' ) . ')</span></a>', |
| [162](#L162) | 'refunded'  => '<a href="' . add\_query\_arg( array( 'pms-view' => 'refunded', 'paged' => 1 ) ) . '" ' . ( isset( $\_GET['pms-view'] ) &&$\_GET['pms-view'] == 'refunded' ? 'class="current"' : '' ) . '>Refunded <span class="count">(' . ( isset( $this->views\_count['refunded'] ) ? $this->views\_count['refunded'] : '' ) . ')</span></a>' |
| [163](#L163) | )); |
| [164](#L164) |  |
| [165](#L165) | } |
| [166](#L166) |  |
| [167](#L167) | /\* |
| [168](#L168) | \* Overwrite parent display tablenav to avoid WP's default nonce for bulk actions |
| [169](#L169) | \* |
| [170](#L170) | \* @param string @which     - which side of the table ( top or bottom ) |
| [171](#L171) | \* |
| [172](#L172) | \*/ |
| [173](#L173) | protected function display\_tablenav( $which ) { |
| [174](#L174) |  |
| [175](#L175) | echo '<div class="tablenav ' . esc\_attr( $which ) . '">'; |
| [176](#L176) |  |
| [177](#L177) | if ( !empty( $\_GET['pms-view'] ) ) |
| [178](#L178) | echo '<input type="hidden" id="pms-view" name="pms-view" value="'. esc\_attr( sanitize\_text\_field( $\_GET['pms-view'] )) .'">'; |
| [179](#L179) |  |
| [180](#L180) | $this->bulk\_actions( $which ); |
| [181](#L181) | wp\_nonce\_field( 'pms\_payment\_nonce' ); |
| [182](#L182) |  |
| [183](#L183) | $this->extra\_tablenav( $which ); |
| [184](#L184) | if ( $which == 'bottom' ) |
| [185](#L185) | $this->pagination( $which ); |
| [186](#L186) |  |
| [187](#L187) | echo '<br class="clear" />'; |
| [188](#L188) | echo '</div>'; |
| [189](#L189) |  |
| [190](#L190) | } |
| [191](#L191) |  |
| [192](#L192) | /\*\* |
| [193](#L193) | \* Sets the table data |
| [194](#L194) | \* |
| [195](#L195) | \* @return array |
| [196](#L196) | \* |
| [197](#L197) | \*/ |
| [198](#L198) | public function set\_table\_data() { |
| [199](#L199) |  |
| [200](#L200) | $data = array(); |
| [201](#L201) | $args = array(); |
| [202](#L202) |  |
| [203](#L203) | $selected\_view = ( isset( $\_GET['pms-view'] ) ? sanitize\_text\_field( $\_GET['pms-view'] ) : '' ); |
| [204](#L204) | $paged         = ( isset( $\_GET['paged'] )    ? (int)$\_GET['paged'] : 1 ); |
| [205](#L205) |  |
| [206](#L206) | /\*\* |
| [207](#L207) | \* Set payments arguments |
| [208](#L208) | \* |
| [209](#L209) | \*/ |
| [210](#L210) | $args['number'] = $this->items\_per\_page; |
| [211](#L211) | $args['offset'] = ( $paged - 1 ) \* $this->items\_per\_page; |
| [212](#L212) | $args['status'] = $selected\_view; |
| [213](#L213) |  |
| [214](#L214) | // Search query |
| [215](#L215) | if ( !empty($\_REQUEST['s']) ) { |
| [216](#L216) | $args['search'] = sanitize\_text\_field( $\_REQUEST['s'] ); |
| [217](#L217) | } |
| [218](#L218) |  |
| [219](#L219) | // Order by query |
| [220](#L220) | if( ! empty( $\_REQUEST['orderby'] ) && ! empty( $\_REQUEST['order'] ) ) { |
| [221](#L221) |  |
| [222](#L222) | $orderby               = sanitize\_text\_field( $\_REQUEST['orderby'] ); |
| [223](#L223) | $orderby\_possibilities = array( 'id', 'status' ); |
| [224](#L224) |  |
| [225](#L225) | if( in\_array( $orderby, $orderby\_possibilities ) ) |
| [226](#L226) | $args['orderby'] = $orderby; |
| [227](#L227) |  |
| [228](#L228) | $order = strtolower( sanitize\_text\_field( $\_REQUEST['order'] ) ); |
| [229](#L229) |  |
| [230](#L230) | if( $order == 'asc' ) |
| [231](#L231) | $args['order'] = 'ASC'; |
| [232](#L232) | elseif( $order == 'desc' ) |
| [233](#L233) | $args['order'] = 'DESC'; |
| [234](#L234) |  |
| [235](#L235) | } |
| [236](#L236) |  |
| [237](#L237) | /\*\* |
| [238](#L238) | \* Get payments |
| [239](#L239) | \* |
| [240](#L240) | \*/ |
| [241](#L241) | $payments = pms\_get\_payments( $args ); |
| [242](#L242) |  |
| [243](#L243) | /\*\* |
| [244](#L244) | \* Get payment gateways data |
| [245](#L245) | \* |
| [246](#L246) | \*/ |
| [247](#L247) | $payment\_gateways = pms\_get\_payment\_gateways(); |
| [248](#L248) |  |
| [249](#L249) |  |
| [250](#L250) | /\*\* |
| [251](#L251) | \* Set views count for each view ( a.k.a payment status ) |
| [252](#L252) | \* |
| [253](#L253) | \*/ |
| [254](#L254) | $views = $this->get\_views(); |
| [255](#L255) |  |
| [256](#L256) | $args = array(); |
| [257](#L257) |  |
| [258](#L258) | if ( !empty($\_REQUEST['s']) ) |
| [259](#L259) | $args['search'] = sanitize\_text\_field( $\_REQUEST['s'] ); |
| [260](#L260) |  |
| [261](#L261) | foreach( $views as $view\_slug => $view\_link) { |
| [262](#L262) |  |
| [263](#L263) | $args['status'] = ( $view\_slug != 'all' ? $view\_slug : '' ); |
| [264](#L264) |  |
| [265](#L265) | $this->views\_count[$view\_slug] = pms\_get\_payments\_count( $args ); |
| [266](#L266) |  |
| [267](#L267) | } |
| [268](#L268) |  |
| [269](#L269) |  |
| [270](#L270) | /\*\* |
| [271](#L271) | \* Set data array |
| [272](#L272) | \* |
| [273](#L273) | \*/ |
| [274](#L274) | foreach( $payments as $payment ) { |
| [275](#L275) |  |
| [276](#L276) | if( !empty($selected\_view) && $payment->status != $selected\_view ) |
| [277](#L277) | continue; |
| [278](#L278) |  |
| [279](#L279) | // Get user data |
| [280](#L280) | $user = get\_user\_by( 'id', $payment->user\_id ); |
| [281](#L281) |  |
| [282](#L282) | if( $user ) |
| [283](#L283) | $username = $user->data->user\_login; |
| [284](#L284) | else |
| [285](#L285) | $username = esc\_html\_\_( 'User no longer exists', 'paid-member-subscriptions' ); |
| [286](#L286) |  |
| [287](#L287) | // Get payment gateway data |
| [288](#L288) | if( ! empty( $payment\_gateways[$payment->payment\_gateway]['display\_name\_admin'] ) ) |
| [289](#L289) | $payment\_gateway\_name = $payment\_gateways[$payment->payment\_gateway]['display\_name\_admin']; |
| [290](#L290) | else |
| [291](#L291) | $payment\_gateway\_name = ''; |
| [292](#L292) |  |
| [293](#L293) |  |
| [294](#L294) | $data[] = apply\_filters( 'pms\_payments\_list\_table\_entry\_data', array( |
| [295](#L295) | 'id'              => $payment->id, |
| [296](#L296) | 'username'        => $username, |
| [297](#L297) | 'subscription'    => $payment->subscription\_id, |
| [298](#L298) | 'amount'          => $payment->amount, |
| [299](#L299) | 'date'            => apply\_filters('pms\_match\_date\_format\_to\_wp\_settings', ucfirst( date\_i18n( 'F d, Y H:i:s', strtotime( $payment->date ) + ( get\_option( 'gmt\_offset' ) \* HOUR\_IN\_SECONDS ) ) ), true), |
| [300](#L300) | 'type'            => pms\_get\_payment\_type\_name( $payment->type ), |
| [301](#L301) | 'payment\_gateway' => $payment\_gateway\_name, |
| [302](#L302) | 'transaction\_id'  => $payment->transaction\_id, |
| [303](#L303) | 'status'          => $payment->status, |
| [304](#L304) | 'discount\_code'   => $payment->discount\_code |
| [305](#L305) | ), $payment ); |
| [306](#L306) | } |
| [307](#L307) |  |
| [308](#L308) |  |
| [309](#L309) | /\*\* |
| [310](#L310) | \* Set all items |
| [311](#L311) | \* |
| [312](#L312) | \*/ |
| [313](#L313) | $this->total\_items = $this->views\_count[ ( !empty( $selected\_view ) ? $selected\_view : 'all' ) ]; |
| [314](#L314) |  |
| [315](#L315) |  |
| [316](#L316) | /\*\* |
| [317](#L317) | \* Set table data |
| [318](#L318) | \* |
| [319](#L319) | \*/ |
| [320](#L320) | $this->data = $data; |
| [321](#L321) |  |
| [322](#L322) | } |
| [323](#L323) |  |
| [324](#L324) |  |
| [325](#L325) | /\*\* |
| [326](#L326) | \* Populates the items for the table |
| [327](#L327) | \* |
| [328](#L328) | \* @param array $item           - data for the current row |
| [329](#L329) | \* |
| [330](#L330) | \* @return string |
| [331](#L331) | \* |
| [332](#L332) | \*/ |
| [333](#L333) | public function prepare\_items() { |
| [334](#L334) |  |
| [335](#L335) | $this->\_column\_headers = $this->get\_column\_info(); |
| [336](#L336) |  |
| [337](#L337) | $this->set\_pagination\_args( array( |
| [338](#L338) | 'total\_items' => $this->total\_items, |
| [339](#L339) | 'per\_page'    => $this->items\_per\_page |
| [340](#L340) | )); |
| [341](#L341) |  |
| [342](#L342) | $this->items = $this->data; |
| [343](#L343) |  |
| [344](#L344) | } |
| [345](#L345) |  |
| [346](#L346) |  |
| [347](#L347) | /\*\* |
| [348](#L348) | \* Return data that will be displayed in each column |
| [349](#L349) | \* |
| [350](#L350) | \* @param array $item           - data for the current row |
| [351](#L351) | \* @param string $column\_name   - name of the current column |
| [352](#L352) | \* |
| [353](#L353) | \* @return string |
| [354](#L354) | \* |
| [355](#L355) | \*/ |
| [356](#L356) | public function column\_default( $item, $column\_name ) { |
| [357](#L357) |  |
| [358](#L358) | return !empty( $item[ $column\_name ] ) ? $item[ $column\_name ] : '-'; |
| [359](#L359) |  |
| [360](#L360) | } |
| [361](#L361) |  |
| [362](#L362) |  |
| [363](#L363) | /\*\* |
| [364](#L364) | \* Handles the checkbox column output. |
| [365](#L365) | \* |
| [366](#L366) | \* @since 4.3.0 |
| [367](#L367) | \* |
| [368](#L368) | \* @param $item The current item. |
| [369](#L369) | \*/ |
| [370](#L370) | function column\_cb( $item ) { |
| [371](#L371) | if( isset( $item[ 'id' ] ) && !empty( $item[ 'id' ] ) ){ |
| [372](#L372) | $payment\_id = $item[ 'id' ]; |
| [373](#L373) | ?> |
| [374](#L374) | <label class="screen-reader-text" for="cb-select-<?php echo esc\_attr( $payment\_id ); ?>"></label> |
| [375](#L375) | <input type="checkbox" name="payments[]" id="cb-select-<?php echo esc\_attr( $payment\_id ); ?>" value="<?php echo esc\_attr( $payment\_id ); ?>" /> |
| [376](#L376) | <?php |
| [377](#L377) | } |
| [378](#L378) | } |
| [379](#L379) |  |
| [380](#L380) |  |
| [381](#L381) | /\*\* |
| [382](#L382) | \* Return data that will be displayed in the username column |
| [383](#L383) | \* |
| [384](#L384) | \* @param array $item   - data of the current row |
| [385](#L385) | \* |
| [386](#L386) | \* @return string |
| [387](#L387) | \* |
| [388](#L388) | \*/ |
| [389](#L389) | public function column\_username( $item ) { |
| [390](#L390) |  |
| [391](#L391) | // Add row actions |
| [392](#L392) | $actions = array(); |
| [393](#L393) |  |
| [394](#L394) | // Edit payment row action |
| [395](#L395) | $actions['edit'] = '<a href="' . add\_query\_arg( array( 'pms-action' => 'edit\_payment', 'payment\_id' => $item['id'] ), admin\_url( 'admin.php?page=pms-payments-page' ) ) . '">' . esc\_html\_\_( 'Edit Payment', 'paid-member-subscriptions' ) . '</a>'; |
| [396](#L396) |  |
| [397](#L397) | // Delete row action |
| [398](#L398) | $actions['delete'] = '<a onclick="return confirm( \'' . esc\_html\_\_( "Are you sure you want to delete this Payment?", "paid-member-subscriptions" ) . ' \' )" href="' . wp\_nonce\_url( add\_query\_arg( array( 'pms-action' => 'delete\_payment', 'payment\_id' => $item['id'] ) ), 'pms\_payment\_nonce' ) . '">' . esc\_html\_\_( 'Delete', 'paid-member-subscriptions' ) . '</a>'; |
| [399](#L399) |  |
| [400](#L400) | /\*\* |
| [401](#L401) | \* Filter the actions for a payment |
| [402](#L402) | \* |
| [403](#L403) | \* @param array $actions |
| [404](#L404) | \* @param array $item |
| [405](#L405) | \* |
| [406](#L406) | \*/ |
| [407](#L407) | $actions = apply\_filters( 'pms\_payments\_list\_table\_entry\_actions', $actions, $item ); |
| [408](#L408) |  |
| [409](#L409) | $payment = pms\_get\_payment( $item['id'] ); |
| [410](#L410) |  |
| [411](#L411) | $output  = '<a href="' . add\_query\_arg( array( 'page' => 'pms-members-page', 'pms-action' => 'edit\_member', 'member\_id' => $payment->user\_id, 'subpage' => 'edit\_member' ), admin\_url( 'admin.php' ) ) . '" title="' . \_\_( 'Edit Member', 'paid-member-subscriptions' ) . '">' . $item['username']; |
| [412](#L412) | $output .= $this->row\_actions( $actions ); |
| [413](#L413) |  |
| [414](#L414) | return $output; |
| [415](#L415) |  |
| [416](#L416) | } |
| [417](#L417) |  |
| [418](#L418) |  |
| [419](#L419) | /\*\* |
| [420](#L420) | \* Return data that will be displayed in the subscriptions column |
| [421](#L421) | \* |
| [422](#L422) | \* @param array $item   - data of the current row |
| [423](#L423) | \* |
| [424](#L424) | \* @return string |
| [425](#L425) | \* |
| [426](#L426) | \*/ |
| [427](#L427) | public function column\_subscriptions( $item ) { |
| [428](#L428) |  |
| [429](#L429) | $subscription\_plan = pms\_get\_subscription\_plan( $item['subscription'] ); |
| [430](#L430) | $output = '<span class="pms-payment-list-subscription">' . esc\_html( $subscription\_plan->name ) . '</span>'; |
| [431](#L431) |  |
| [432](#L432) | return $output; |
| [433](#L433) |  |
| [434](#L434) | } |
| [435](#L435) |  |
| [436](#L436) |  |
| [437](#L437) | /\*\* |
| [438](#L438) | \* Return data that will be displayed in the status column |
| [439](#L439) | \* |
| [440](#L440) | \* @param array $item   - data of the current row |
| [441](#L441) | \* |
| [442](#L442) | \* @return string |
| [443](#L443) | \* |
| [444](#L444) | \*/ |
| [445](#L445) | public function column\_status( $item ) { |
| [446](#L446) |  |
| [447](#L447) | $payment\_statuses = pms\_get\_payment\_statuses(); |
| [448](#L448) |  |
| [449](#L449) | $output = apply\_filters( 'pms\_list\_table\_' . $this->\_args['plural'] . '\_show\_status\_dot', '<span class="pms-status-dot ' . esc\_attr( $item['status'] ) . '"></span>' ); |
| [450](#L450) |  |
| [451](#L451) | $output .= ( isset( $payment\_statuses[ $item['status'] ] ) ? esc\_html( $payment\_statuses[ $item['status'] ] ) : $item['status'] ); |
| [452](#L452) |  |
| [453](#L453) | if( $item['status'] == 'failed' ){ |
| [454](#L454) | $output .= ' | <a href="' . add\_query\_arg( array( 'pms-action' => 'edit\_payment', 'payment\_id' => $item['id'] ) ) . '">' . esc\_html\_\_( 'View Logs', 'paid-member-subscriptions' ) . '</a>'; |
| [455](#L455) | } |
| [456](#L456) |  |
| [457](#L457) | return $output; |
| [458](#L458) |  |
| [459](#L459) | } |
| [460](#L460) |  |
| [461](#L461) |  |
| [462](#L462) | /\*\* |
| [463](#L463) | \* Return data that will be displayed in the amount column |
| [464](#L464) | \* |
| [465](#L465) | \* @param array $item   - data of the current row |
| [466](#L466) | \* |
| [467](#L467) | \* @return string |
| [468](#L468) | \* |
| [469](#L469) | \*/ |
| [470](#L470) | public function column\_amount( $item ) { |
| [471](#L471) |  |
| [472](#L472) | // Check if discount code was used for this payment |
| [473](#L473) | if ( !empty($item['discount\_code']) ) { |
| [474](#L474) | $output = '<span class="pms-has-bubble">'; |
| [475](#L475) |  |
| [476](#L476) | $output .= pms\_format\_price( $item['amount'], pms\_get\_active\_currency() ) . '<span class="pms-discount-dot"> % </span>'; |
| [477](#L477) |  |
| [478](#L478) | $output .= '<div class="pms-bubble">'; |
| [479](#L479) | $output .= '<div><span class="alignleft">' . esc\_html\_\_('Discount code', 'paid-member-subscriptions') . '</span><span class="alignright">' . esc\_html( $item['discount\_code'] ) . '</span></div>'; |
| [480](#L480) | $output .= '</div>'; |
| [481](#L481) |  |
| [482](#L482) | $output .= '</span>'; |
| [483](#L483) | } else |
| [484](#L484) | $output = pms\_format\_price( $item['amount'], pms\_get\_active\_currency() ); |
| [485](#L485) |  |
| [486](#L486) | return apply\_filters( 'pms\_payments\_list\_table\_column\_amount', $output, $item ); |
| [487](#L487) |  |
| [488](#L488) | } |
| [489](#L489) |  |
| [490](#L490) |  |
| [491](#L491) | /\*\* |
| [492](#L492) | \* Return data that will be displayed in the type column |
| [493](#L493) | \* |
| [494](#L494) | \* @param array $item   - data of the current row |
| [495](#L495) | \* |
| [496](#L496) | \* @return string |
| [497](#L497) | \* |
| [498](#L498) | \*/ |
| [499](#L499) | public function column\_type( $item ) { |
| [500](#L500) |  |
| [501](#L501) | $output = $item['type']; |
| [502](#L502) |  |
| [503](#L503) | if( ! empty( $item['payment\_gateway'] ) ) |
| [504](#L504) | $output .= ' (' . esc\_html( $item['payment\_gateway'] ) . ')'; |
| [505](#L505) |  |
| [506](#L506) | return $output; |
| [507](#L507) |  |
| [508](#L508) | } |
| [509](#L509) |  |
| [510](#L510) | /\*\* |
| [511](#L511) | \* Return data that will be displayed in the transaction\_id column |
| [512](#L512) | \* |
| [513](#L513) | \* @param array $item   - data of the current row |
| [514](#L514) | \* |
| [515](#L515) | \* @return string |
| [516](#L516) | \* |
| [517](#L517) | \*/ |
| [518](#L518) | public function column\_transaction\_id( $item ) { |
| [519](#L519) |  |
| [520](#L520) | if( empty( $item['transaction\_id'] ) ) |
| [521](#L521) | return '-'; |
| [522](#L522) |  |
| [523](#L523) | if( !empty( $item['payment\_gateway'] ) ){ |
| [524](#L524) |  |
| [525](#L525) | $test\_mode = pms\_is\_payment\_test\_mode(); |
| [526](#L526) |  |
| [527](#L527) | if( in\_array( $item['payment\_gateway'], array( 'PayPal', 'PayPal Standard', 'PayPal Express' ) ) ){ |
| [528](#L528) |  |
| [529](#L529) | if( $test\_mode ){ |
| [530](#L530) | $url = 'https://www.sandbox.paypal.com/activity/payment/' . $item['transaction\_id']; |
| [531](#L531) | } else { |
| [532](#L532) | $url = 'https://www.paypal.com/activity/payment/' . $item['transaction\_id']; |
| [533](#L533) | } |
| [534](#L534) |  |
| [535](#L535) | } else if( in\_array( $item['payment\_gateway'], array( 'stripe', 'Stripe' ) ) ){ |
| [536](#L536) |  |
| [537](#L537) | if( $test\_mode ){ |
| [538](#L538) | $url = 'https://dashboard.stripe.com/test/payments/' . $item['transaction\_id']; |
| [539](#L539) | } else { |
| [540](#L540) | $url = 'https://dashboard.stripe.com/payments/' . $item['transaction\_id']; |
| [541](#L541) | } |
| [542](#L542) |  |
| [543](#L543) | } |
| [544](#L544) |  |
| [545](#L545) | } |
| [546](#L546) |  |
| [547](#L547) | if( !empty( $url ) ){ |
| [548](#L548) | return '<a href="'. $url .'" target="\_blank">'. $item['transaction\_id'] . '</a>'; |
| [549](#L549) | } else { |
| [550](#L550) | return $item['transaction\_id']; |
| [551](#L551) | } |
| [552](#L552) |  |
| [553](#L553) | } |
| [554](#L554) |  |
| [555](#L555) |  |
| [556](#L556) | /\*\* |
| [557](#L557) | \* Display if no items are found |
| [558](#L558) | \* |
| [559](#L559) | \*/ |
| [560](#L560) | public function no\_items() { |
| [561](#L561) |  |
| [562](#L562) | echo esc\_html\_\_( 'No payments found', 'paid-member-subscriptions' ); |
| [563](#L563) |  |
| [564](#L564) | } |
| [565](#L565) |  |
| [566](#L566) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/paid-member-subscriptions/tags/2.12.8/includes/admin/class-admin-payments-list-table.php?format=txt)
* [Original Format](/export/3220689/paid-member-subscriptions/tags/2.12.8/includes/admin/class-admin-payments-list-table.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


