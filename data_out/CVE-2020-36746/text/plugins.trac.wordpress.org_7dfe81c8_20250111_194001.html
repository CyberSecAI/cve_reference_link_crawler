

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D2368729%2540menu-swapper%26old%3D2368729%2540menu-swapper)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2196674/menu-swapper "Changeset 2196674 for menu-swapper")
* [Next Change](/changeset/2368730/menu-swapper "Changeset 2368730 for menu-swapper") →

---

# Changeset [2368729](/changeset/2368729 "Show full changeset") for [menu-swapper](/browser/menu-swapper?rev=2368729 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
08/25/2020 02:26:46 PM
([4 years](/timeline?from=2020-08-25T14%3A26%3A46Z&precision=second "See timeline at 08/25/2020 02:26:46 PM") ago)

Author:
sevenspark
Message:

Update with security fix, bump v to 1.1.1

Location:
[menu-swapper/trunk](/browser/menu-swapper/trunk?rev=2368729)
Files:

3 edited

* [includes/meta-box.php](/browser/menu-swapper/trunk/includes/meta-box.php?rev=2368729 "Show entry in browser")
  (modified)
  ([5 diffs](#file0 "Show differences"))
* [menu-swapper.php](/browser/menu-swapper/trunk/menu-swapper.php?rev=2368729 "Show entry in browser")
  (modified)
  ([5 diffs](#file1 "Show differences"))
* [readme.txt](/browser/menu-swapper/trunk/readme.txt?rev=2368729 "Show entry in browser")
  (modified)
  ([3 diffs](#file2 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [menu-swapper/trunk/includes/meta-box.php](/changeset/2368729/menu-swapper/trunk/includes/meta-box.php "Show the changeset 2368729 restricted to menu-swapper/trunk/includes/meta-box.php")

  | [r1241808](/browser/menu-swapper/trunk/includes/meta-box.php?rev=1241808#L1 "Show revision 1241808 of this file in browser") | [r2368729](/browser/menu-swapper/trunk/includes/meta-box.php?rev=2368729#L1 "Show revision 2368729 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | function mswp\_add\_swap\_meta\_box() { |
  |  | 3 | function mswp\_add\_swap\_meta\_box() { |
  | 4 | 4 | $post\_types = array( |
  | 5 | 5 | 'post', |
  | […](/browser/menu-swapper/trunk/includes/meta-box.php?rev=1241808#L11) | […](/browser/menu-swapper/trunk/includes/meta-box.php?rev=2368729#L11) |  |
  | 11 | 11 | foreach( $post\_types as $post\_type ){ |
  | 12 | 12 |  |
  | 13 |  | add\_meta\_box( |
  | 14 |  | 'mswp\_meta\_box', // $id |
  | 15 |  | 'Menu Swapper', // $title |
  | 16 |  | 'mswp\_show\_swap\_meta\_box', // $callback |
  | 17 |  | $post\_type, // $page |
  | 18 |  | 'side', // $context |
  | 19 |  | 'default' // $priority |
  | 20 |  | ); |
  |  | 13 | add\_meta\_box( |
  |  | 14 | 'mswp\_meta\_box', // $id |
  |  | 15 | 'Menu Swapper', // $title |
  |  | 16 | 'mswp\_show\_swap\_meta\_box', // $callback |
  |  | 17 | $post\_type, // $page |
  |  | 18 | 'side', // $context |
  |  | 19 | 'default' // $priority |
  |  | 20 | ); |
  | 21 | 21 | } |
  | 22 |  | } |
  | 23 |  | add\_action( 'add\_meta\_boxes', 'mswp\_add\_swap\_meta\_box' ); |
  |  | 22 | } |
  |  | 23 | add\_action( 'add\_meta\_boxes', 'mswp\_add\_swap\_meta\_box' ); |
  | 24 | 24 |  |
  | 25 | 25 |  |
  | 26 |  | function mswp\_show\_swap\_meta\_box() { |
  | 27 |  | global $post; |
  |  | 26 | function mswp\_show\_swap\_meta\_box() { |
  |  | 27 | global $post; |
  | 28 | 28 | $target\_loc = get\_post\_meta( $post->ID, MSWP\_TARGET\_POST\_META, true ); |
  | 29 | 29 | $current\_loc = get\_post\_meta( $post->ID, MSWP\_LOC\_POST\_META, true ); |
  | […](/browser/menu-swapper/trunk/includes/meta-box.php?rev=1241808#L34) | […](/browser/menu-swapper/trunk/includes/meta-box.php?rev=2368729#L34) |  |
  | 34 | 34 | ?> |
  | 35 | 35 | <input type="hidden" name="swap\_meta\_box\_nonce" value="<?php echo wp\_create\_nonce(basename(\_\_FILE\_\_)); ?>" /> |
  | 36 |  |  |
  |  | 36 |  |
  | 37 | 37 | <h4>Replace this Theme Location</h4> |
  | 38 | 38 | <select name="mswp-target-theme-loc"> |
  | 39 |  | <option value="none">None (Swapper ~~will not affect menu~~)</option> |
  |  | 39 | <option value="none">None (Swapper disabled)</option> |
  | 40 | 40 | <option value="all" <?php if( $target\_loc == 'all' ): ?>selected="selected"<?php endif;?> >Any/All (will affect all menus)</option> |
  | 41 | 41 | <?php foreach( $theme\_locations as $slug => $name ): ?> |
  | 42 | 42 | <option value="<?php echo $slug;?>" <?php if( $target\_loc == $slug ): ?>selected="selected"<?php endif; ?> ><?php echo $name; ?></option> |
  | 43 |  | <?php endforeach; ?> |
  |  | 43 | <?php endforeach; ?> |
  | 44 | 44 | </select> |
  | 45 | 45 | <p><small><em>(The one set in wp\_nav\_menu in your template)</em></small></p> |
  | […](/browser/menu-swapper/trunk/includes/meta-box.php?rev=1241808#L49) | […](/browser/menu-swapper/trunk/includes/meta-box.php?rev=2368729#L49) |  |
  | 49 | 49 | <?php foreach( $theme\_locations as $slug => $name ): ?> |
  | 50 | 50 | <option value="<?php echo $slug;?>" <?php if( $current\_loc == $slug ): ?>selected="selected"<?php endif; ?> ><?php echo $name; ?></option> |
  | 51 |  | <?php endforeach; ?> |
  |  | 51 | <?php endforeach; ?> |
  | 52 | 52 | </select> |
  | 53 | 53 | <p><small><em>(The one that you want to display on the page)</em></small></p> |
  | […](/browser/menu-swapper/trunk/includes/meta-box.php?rev=1241808#L57) | […](/browser/menu-swapper/trunk/includes/meta-box.php?rev=2368729#L57) |  |
  | 57 | 57 |  |
  | 58 | 58 |  |
  | 59 |  | function mswp\_save\_meta( $post\_id ) { |
  |  | 59 | function mswp\_save\_meta( $post\_id ) { |
  | 60 | 60 |  |
  | 61 |  | if( !isset( $\_POST[ 'mswp-swap-theme-loc' ] ) ) |
  |  | 61 | if( !isset( $\_POST[ 'mswp-swap-theme-loc' ] ) ) |
  | 62 | 62 | return $post\_id; |
  | 63 | 63 |  |
  | 64 |  | // verify nonce |
  | 65 |  | if( ~~isset( $\_POST['swap\_meta\_box\_nonce'] ) &&~~ !wp\_verify\_nonce( $\_POST['swap\_meta\_box\_nonce'], basename(\_\_FILE\_\_) ) ) |
  | 66 |  | return $post\_id; |
  | 67 |  | ~~// check autosave~~ |
  |  | 64 | // verify nonce |
  |  | 65 | if( !isset( $\_POST['swap\_meta\_box\_nonce'] ) || !wp\_verify\_nonce( $\_POST['swap\_meta\_box\_nonce'], basename(\_\_FILE\_\_) ) ) |
  |  | 66 | return $post\_id; |
  |  | 67 | // check autosave |
  | 68 | 68 | if( defined( 'DOING\_AUTOSAVE' ) && DOING\_AUTOSAVE ) |
  | 69 |  | return $post\_id; |
  | 70 |  | // check permissions |
  | 71 |  | if( isset( $\_POST['post\_type'] ) && 'page' == $\_POST['post\_type']) { |
  | 72 |  | if( !current\_user\_can( 'edit\_page', $post\_id ) ) |
  | 73 |  | return $post\_id; |
  | 74 |  | } |
  | 75 |  | elseif( !current\_user\_can('edit\_post', $post\_id ) ) { |
  | 76 |  | return $post\_id; |
  |  | 69 | return $post\_id; |
  |  | 70 | // check permissions |
  |  | 71 | if( isset( $\_POST['post\_type'] ) && 'page' == $\_POST['post\_type']) { |
  |  | 72 | if( !current\_user\_can( 'edit\_page', $post\_id ) ) |
  |  | 73 | return $post\_id; |
  | 77 | 74 | } |
  | 78 |  |  |
  |  | 75 | elseif( !current\_user\_can('edit\_post', $post\_id ) ) { |
  |  | 76 | return $post\_id; |
  |  | 77 | } |
  |  | 78 |  |
  | 79 | 79 |  |
  | 80 | 80 | //SWAP |
  | 81 |  | $old = get\_post\_meta( $post\_id, MSWP\_LOC\_POST\_META, true ); |
  | 82 |  | $new = $\_POST[ 'mswp-swap-theme-loc' ]; |
  | 83 |  | if( $new && $new != $old) { |
  | 84 |  | update\_post\_meta( $post\_id, MSWP\_LOC\_POST\_META, $new ); |
  | 85 |  | } |
  | 86 |  | elseif( '' == $new && $old ) { |
  | 87 |  | delete\_post\_meta( $post\_id, MSWP\_LOC\_POST\_META, $old ); |
  | 88 |  | } |
  |  | 81 | $old = get\_post\_meta( $post\_id, MSWP\_LOC\_POST\_META, true ); |
  |  | 82 | $new = $\_POST[ 'mswp-swap-theme-loc' ]; |
  |  | 83 | if( $new && $new != $old) { |
  |  | 84 | update\_post\_meta( $post\_id, MSWP\_LOC\_POST\_META, $new ); |
  |  | 85 | } |
  |  | 86 | elseif( '' == $new && $old ) { |
  |  | 87 | delete\_post\_meta( $post\_id, MSWP\_LOC\_POST\_META, $old ); |
  |  | 88 | } |
  | 89 | 89 |  |
  | 90 | 90 | //TARGET |
  | 91 |  | $old = get\_post\_meta( $post\_id, MSWP\_TARGET\_POST\_META, true ); |
  | 92 |  | $new = $\_POST[ 'mswp-target-theme-loc' ]; |
  | 93 |  | if( $new && $new != $old) { |
  | 94 |  | update\_post\_meta( $post\_id, MSWP\_TARGET\_POST\_META, $new ); |
  | 95 |  | } |
  | 96 |  | elseif( '' == $new && $old ) { |
  | 97 |  | delete\_post\_meta( $post\_id, MSWP\_TARGET\_POST\_META, $old ); |
  |  | 91 | $old = get\_post\_meta( $post\_id, MSWP\_TARGET\_POST\_META, true ); |
  |  | 92 | $new = $\_POST[ 'mswp-target-theme-loc' ]; |
  |  | 93 | if( $new && $new != $old) { |
  |  | 94 | update\_post\_meta( $post\_id, MSWP\_TARGET\_POST\_META, $new ); |
  | 98 | 95 | } |
  | 99 |  | } |
  | 100 |  | add\_action( 'save\_post', 'mswp\_save\_meta' ); |
  |  | 96 | elseif( '' == $new && $old ) { |
  |  | 97 | delete\_post\_meta( $post\_id, MSWP\_TARGET\_POST\_META, $old ); |
  |  | 98 | } |
  |  | 99 | } |
  |  | 100 | add\_action( 'save\_post', 'mswp\_save\_meta' ); |
* ## [menu-swapper/trunk/menu-swapper.php](/changeset/2368729/menu-swapper/trunk/menu-swapper.php "Show the changeset 2368729 restricted to menu-swapper/trunk/menu-swapper.php")

  | [r1241808](/browser/menu-swapper/trunk/menu-swapper.php?rev=1241808#L2 "Show revision 1241808 of this file in browser") | [r2368729](/browser/menu-swapper/trunk/menu-swapper.php?rev=2368729#L2 "Show revision 2368729 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 | /\* |
  | 3 | 3 | Plugin Name: Menu Swapper |
  | 4 |  | Plugin URI: http://sevenspark.com |
  |  | 4 | Plugin URI: https://sevenspark.com |
  | 5 | 5 | Description: Register custom theme locations and swap menus on each Post or Page |
  | 6 | 6 | Author: Chris Mavricos, SevenSpark |
  | 7 |  | Author URI: http://sevenspark.com |
  | 8 |  | Version: 1.1.~~0.2~~ |
  |  | 7 | Author URI: https://sevenspark.com |
  |  | 8 | Version: 1.1.1 |
  | 9 | 9 | Text Domain: menuswap |
  | 10 | 10 | \*/ |
  | […](/browser/menu-swapper/trunk/menu-swapper.php?rev=1241808#L39) | […](/browser/menu-swapper/trunk/menu-swapper.php?rev=2368729#L39) |  |
  | 39 | 39 |  |
  | 40 | 40 | if( ! defined( 'MSWP\_VERSION' ) ) |
  | 41 |  | define( 'MSWP\_VERSION', '1.1.~~0.2~~' ); |
  |  | 41 | define( 'MSWP\_VERSION', '1.1.1' ); |
  | 42 | 42 |  |
  | 43 | 43 | // Plugin Folder URL |
  | […](/browser/menu-swapper/trunk/menu-swapper.php?rev=1241808#L53) | […](/browser/menu-swapper/trunk/menu-swapper.php?rev=2368729#L53) |  |
  | 53 | 53 | define( 'MSWP\_PLUGIN\_FILE', \_\_FILE\_\_ ); |
  | 54 | 54 |  |
  | 55 |  | define( 'MSWP\_LOC\_POST\_META' , 'mswp-swap-loc' ); |
  | 56 |  | define( 'MSWP\_TARGET\_POST\_META' , 'mswp-target-loc' ); |
  |  | 55 | define( 'MSWP\_LOC\_POST\_META' , 'mswp-swap-loc' ); |
  |  | 56 | define( 'MSWP\_TARGET\_POST\_META' , 'mswp-target-loc' ); |
  | 57 | 57 | define( 'MSWP\_THEME\_LOC\_OPTION' , 'mswp\_theme\_locations' ); |
  | 58 | 58 | } |
  | […](/browser/menu-swapper/trunk/menu-swapper.php?rev=1241808#L74) | […](/browser/menu-swapper/trunk/menu-swapper.php?rev=2368729#L74) |  |
  | 74 | 74 | require\_once MSWP\_PLUGIN\_DIR . 'includes/admin-page.php'; |
  | 75 | 75 | require\_once MSWP\_PLUGIN\_DIR . 'includes/meta-box.php'; |
  | 76 |  |  |
  |  | 76 |  |
  | 77 | 77 | } else { |
  | 78 | 78 | //require\_once KB\_PLUGIN\_DIR . 'includes/process-download.php'; |
  | […](/browser/menu-swapper/trunk/menu-swapper.php?rev=1241808#L100) | […](/browser/menu-swapper/trunk/menu-swapper.php?rev=2368729#L100) |  |
  | 100 | 100 |  |
  | 101 | 101 | MSWP(); |
  | 102 |  |  |
* ## [menu-swapper/trunk/readme.txt](/changeset/2368729/menu-swapper/trunk/readme.txt "Show the changeset 2368729 restricted to menu-swapper/trunk/readme.txt")

  | [r1241808](/browser/menu-swapper/trunk/readme.txt?rev=1241808#L4 "Show revision 1241808 of this file in browser") | [r2368729](/browser/menu-swapper/trunk/readme.txt?rev=2368729#L4 "Show revision 2368729 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Tags: menu, switch, swap, change |
  | 5 | 5 | Requires at least: 4.0 |
  | 6 |  | Tested up to: ~~4.3~~ |
  | 7 |  | Stable tag: 1.1.~~0.2~~ |
  |  | 6 | Tested up to: 5.5 |
  |  | 7 | Stable tag: 1.1.1 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/menu-swapper/trunk/readme.txt?rev=1241808#L43) | […](/browser/menu-swapper/trunk/readme.txt?rev=2368729#L43) |  |
  | 43 | 43 | == Changelog == |
  | 44 | 44 |  |
  |  | 45 | = 1.1.1 = |
  |  | 46 |  |
  |  | 47 | \* Security fix: make sure nonce is always checked |
  |  | 48 |  |
  | 45 | 49 | = 1.1.0.2 = |
  | 46 | 50 |  |
  | […](/browser/menu-swapper/trunk/readme.txt?rev=1241808#L64) | […](/browser/menu-swapper/trunk/readme.txt?rev=2368729#L68) |  |
  | 64 | 68 | = 1.0 = |
  | 65 | 69 | \* Initial submission |
  | 66 |  |  |
  | 67 |  |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2368729)
* [Zip Archive](?format=zip&new=2368729)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

