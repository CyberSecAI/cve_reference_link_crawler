=== Content from git.kernel.org_5d8fc265_20250111_071855.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3a741b80b3457f079cf637e47800fb7bf8038ad6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3a741b80b3457f079cf637e47800fb7bf8038ad6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3a741b80b3457f079cf637e47800fb7bf8038ad6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3a741b80b3457f079cf637e47800fb7bf8038ad6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Van Hensbergen <ericvh@kernel.org> | 2024-11-19 11:43:17 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:38:37 +0100 |
| commit | [3a741b80b3457f079cf637e47800fb7bf8038ad6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3a741b80b3457f079cf637e47800fb7bf8038ad6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3a741b80b3457f079cf637e47800fb7bf8038ad6)) | |
| tree | [f2aa882f3831eb9d1b4767f209e01add75b0fd6c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3a741b80b3457f079cf637e47800fb7bf8038ad6) | |
| parent | [f111de0f010308949254ee1cc45df8e6b8e1d7d4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f111de0f010308949254ee1cc45df8e6b8e1d7d4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3a741b80b3457f079cf637e47800fb7bf8038ad6&id2=f111de0f010308949254ee1cc45df8e6b8e1d7d4)) | |
| download | [linux-3a741b80b3457f079cf637e47800fb7bf8038ad6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3a741b80b3457f079cf637e47800fb7bf8038ad6.tar.gz) | |

fs/9p: fix uninitialized values during inode evict[ Upstream commit 6630036b7c228f57c7893ee0403e92c2db2cd21d ]
If an iget fails due to not being able to retrieve information
from the server then the inode structure is only partially
initialized. When the inode gets evicted, references to
uninitialized structures (like fscache cookies) were being
made.
This patch checks for a bad\_inode before doing anything other
than clearing the inode from the cache. Since the inode is
bad, it shouldn't have any state associated with it that needs
to be written back (and there really isn't a way to complete
those anyways).
Reported-by: syzbot+eb83fe1cce5833cd66a0@syzkaller.appspotmail.com
Signed-off-by: Eric Van Hensbergen <ericvh@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Xiangyu: CVE-2024-36923 Minor conflict resolution ]
Signed-off-by: Xiangyu Chen <xiangyu.chen@windriver.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3a741b80b3457f079cf637e47800fb7bf8038ad6)

| -rw-r--r-- | [fs/9p/vfs\_inode.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/9p/vfs_inode.c?id=3a741b80b3457f079cf637e47800fb7bf8038ad6) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 7 deletions

| diff --git a/fs/9p/vfs\_inode.c b/fs/9p/vfs\_inode.cindex 853c63b8368157..aba0625de48ae9 100644--- a/[fs/9p/vfs\_inode.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_inode.c?id=f111de0f010308949254ee1cc45df8e6b8e1d7d4)+++ b/[fs/9p/vfs\_inode.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_inode.c?id=3a741b80b3457f079cf637e47800fb7bf8038ad6)@@ -374,20 +374,23 @@ void v9fs\_evict\_inode(struct inode \*inode) struct v9fs\_inode \_\_maybe\_unused \*v9inode = V9FS\_I(inode); \_\_le32 \_\_maybe\_unused version; - truncate\_inode\_pages\_final(&inode->i\_data);+ if (!is\_bad\_inode(inode)) {+ truncate\_inode\_pages\_final(&inode->i\_data);  #ifdef CONFIG\_9P\_FSCACHE- version = cpu\_to\_le32(v9inode->qid.version);- fscache\_clear\_inode\_writeback(v9fs\_inode\_cookie(v9inode), inode,+ version = cpu\_to\_le32(v9inode->qid.version);+ fscache\_clear\_inode\_writeback(v9fs\_inode\_cookie(v9inode), inode, &version); #endif-- clear\_inode(inode);- filemap\_fdatawrite(&inode->i\_data);+ clear\_inode(inode);+ filemap\_fdatawrite(&inode->i\_data);  #ifdef CONFIG\_9P\_FSCACHE- fscache\_relinquish\_cookie(v9fs\_inode\_cookie(v9inode), false);+ if (v9fs\_inode\_cookie(v9inode))+ fscache\_relinquish\_cookie(v9fs\_inode\_cookie(v9inode), false); #endif+ } else+ clear\_inode(inode); }  static int v9fs\_test\_inode(struct inode \*inode, void \*data) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:17:32 +0000



=== Content from git.kernel.org_3fdf872c_20250111_071854.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=18cf7026355187b8d2b4cdfed61dbf873e9d29ff)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=18cf7026355187b8d2b4cdfed61dbf873e9d29ff)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=18cf7026355187b8d2b4cdfed61dbf873e9d29ff)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=18cf7026355187b8d2b4cdfed61dbf873e9d29ff)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Van Hensbergen <ericvh@kernel.org> | 2024-11-19 11:43:16 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:37:34 +0100 |
| commit | [18cf7026355187b8d2b4cdfed61dbf873e9d29ff](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=18cf7026355187b8d2b4cdfed61dbf873e9d29ff) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=18cf7026355187b8d2b4cdfed61dbf873e9d29ff)) | |
| tree | [d5e9fab4d1f0d28a63700bbf41da8cab465e2b1d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=18cf7026355187b8d2b4cdfed61dbf873e9d29ff) | |
| parent | [298609e7069ce74542a2253a39ccc9717f1d877a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=298609e7069ce74542a2253a39ccc9717f1d877a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=18cf7026355187b8d2b4cdfed61dbf873e9d29ff&id2=298609e7069ce74542a2253a39ccc9717f1d877a)) | |
| download | [linux-18cf7026355187b8d2b4cdfed61dbf873e9d29ff.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-18cf7026355187b8d2b4cdfed61dbf873e9d29ff.tar.gz) | |

fs/9p: fix uninitialized values during inode evict[ Upstream commit 6630036b7c228f57c7893ee0403e92c2db2cd21d ]
If an iget fails due to not being able to retrieve information
from the server then the inode structure is only partially
initialized. When the inode gets evicted, references to
uninitialized structures (like fscache cookies) were being
made.
This patch checks for a bad\_inode before doing anything other
than clearing the inode from the cache. Since the inode is
bad, it shouldn't have any state associated with it that needs
to be written back (and there really isn't a way to complete
those anyways).
Reported-by: syzbot+eb83fe1cce5833cd66a0@syzkaller.appspotmail.com
Signed-off-by: Eric Van Hensbergen <ericvh@kernel.org>
(cherry picked from commit 1b4cb6e91f19b81217ad98142ee53a1ab25893fd)
[Xiangyu: CVE-2024-36923 Minor conflict resolution due to missing 4eb31178 ]
Signed-off-by: Xiangyu Chen <xiangyu.chen@windriver.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=18cf7026355187b8d2b4cdfed61dbf873e9d29ff)

| -rw-r--r-- | [fs/9p/vfs\_inode.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/9p/vfs_inode.c?id=18cf7026355187b8d2b4cdfed61dbf873e9d29ff) | 23 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 13 insertions, 10 deletions

| diff --git a/fs/9p/vfs\_inode.c b/fs/9p/vfs\_inode.cindex 8f287009545c97..495631eba3a697 100644--- a/[fs/9p/vfs\_inode.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_inode.c?id=298609e7069ce74542a2253a39ccc9717f1d877a)+++ b/[fs/9p/vfs\_inode.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_inode.c?id=18cf7026355187b8d2b4cdfed61dbf873e9d29ff)@@ -392,17 +392,20 @@ void v9fs\_evict\_inode(struct inode \*inode) struct v9fs\_inode \*v9inode = V9FS\_I(inode); \_\_le32 version; - truncate\_inode\_pages\_final(&inode->i\_data);- version = cpu\_to\_le32(v9inode->qid.version);- fscache\_clear\_inode\_writeback(v9fs\_inode\_cookie(v9inode), inode,+ if (!is\_bad\_inode(inode)) {+ truncate\_inode\_pages\_final(&inode->i\_data);+ version = cpu\_to\_le32(v9inode->qid.version);+ fscache\_clear\_inode\_writeback(v9fs\_inode\_cookie(v9inode), inode, &version);- clear\_inode(inode);- filemap\_fdatawrite(&inode->i\_data);-- fscache\_relinquish\_cookie(v9fs\_inode\_cookie(v9inode), false);- /\* clunk the fid stashed in writeback\_fid \*/- p9\_fid\_put(v9inode->writeback\_fid);- v9inode->writeback\_fid = NULL;+ clear\_inode(inode);+ filemap\_fdatawrite(&inode->i\_data);+ if (v9fs\_inode\_cookie(v9inode))+ fscache\_relinquish\_cookie(v9fs\_inode\_cookie(v9inode), false);+ /\* clunk the fid stashed in writeback\_fid \*/+ p9\_fid\_put(v9inode->writeback\_fid);+ v9inode->writeback\_fid = NULL;+ } else+ clear\_inode(inode); }  static int v9fs\_test\_inode(struct inode \*inode, void \*data) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:17:31 +0000



=== Content from git.kernel.org_45182575_20250111_071856.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6630036b7c228f57c7893ee0403e92c2db2cd21d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6630036b7c228f57c7893ee0403e92c2db2cd21d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6630036b7c228f57c7893ee0403e92c2db2cd21d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6630036b7c228f57c7893ee0403e92c2db2cd21d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Van Hensbergen <ericvh@kernel.org> | 2024-03-19 13:50:32 +0000 |
| --- | --- | --- |
| committer | Eric Van Hensbergen <ericvh@kernel.org> | 2024-03-25 14:16:06 +0000 |
| commit | [6630036b7c228f57c7893ee0403e92c2db2cd21d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6630036b7c228f57c7893ee0403e92c2db2cd21d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6630036b7c228f57c7893ee0403e92c2db2cd21d)) | |
| tree | [253cc86a28179485f9c37b53723fc7f2b464abc6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6630036b7c228f57c7893ee0403e92c2db2cd21d) | |
| parent | [10211b4a23cf4a3df5c11a10e5b3d371f16a906f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=10211b4a23cf4a3df5c11a10e5b3d371f16a906f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6630036b7c228f57c7893ee0403e92c2db2cd21d&id2=10211b4a23cf4a3df5c11a10e5b3d371f16a906f)) | |
| download | [linux-6630036b7c228f57c7893ee0403e92c2db2cd21d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6630036b7c228f57c7893ee0403e92c2db2cd21d.tar.gz) | |

fs/9p: fix uninitialized values during inode evictIf an iget fails due to not being able to retrieve information
from the server then the inode structure is only partially
initialized. When the inode gets evicted, references to
uninitialized structures (like fscache cookies) were being
made.
This patch checks for a bad\_inode before doing anything other
than clearing the inode from the cache. Since the inode is
bad, it shouldn't have any state associated with it that needs
to be written back (and there really isn't a way to complete
those anyways).
Reported-by: syzbot+eb83fe1cce5833cd66a0@syzkaller.appspotmail.com
Signed-off-by: Eric Van Hensbergen <ericvh@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6630036b7c228f57c7893ee0403e92c2db2cd21d)

| -rw-r--r-- | [fs/9p/vfs\_inode.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/9p/vfs_inode.c?id=6630036b7c228f57c7893ee0403e92c2db2cd21d) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 6 deletions

| diff --git a/fs/9p/vfs\_inode.c b/fs/9p/vfs\_inode.cindex 360a5304ec03ce..b01b1bbf249371 100644--- a/[fs/9p/vfs\_inode.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_inode.c?id=10211b4a23cf4a3df5c11a10e5b3d371f16a906f)+++ b/[fs/9p/vfs\_inode.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_inode.c?id=6630036b7c228f57c7893ee0403e92c2db2cd21d)@@ -344,17 +344,21 @@ void v9fs\_evict\_inode(struct inode \*inode) struct v9fs\_inode \_\_maybe\_unused \*v9inode = V9FS\_I(inode); \_\_le32 \_\_maybe\_unused version; - truncate\_inode\_pages\_final(&inode->i\_data);+ if (!is\_bad\_inode(inode)) {+ truncate\_inode\_pages\_final(&inode->i\_data); - version = cpu\_to\_le32(v9inode->qid.version);- netfs\_clear\_inode\_writeback(inode, &version);+ version = cpu\_to\_le32(v9inode->qid.version);+ netfs\_clear\_inode\_writeback(inode, &version); - clear\_inode(inode);- filemap\_fdatawrite(&inode->i\_data);+ clear\_inode(inode);+ filemap\_fdatawrite(&inode->i\_data);  #ifdef CONFIG\_9P\_FSCACHE- fscache\_relinquish\_cookie(v9fs\_inode\_cookie(v9inode), false);+ if (v9fs\_inode\_cookie(v9inode))+ fscache\_relinquish\_cookie(v9fs\_inode\_cookie(v9inode), false); #endif+ } else+ clear\_inode(inode); }  struct inode \*v9fs\_fid\_iget(struct super\_block \*sb, struct p9\_fid \*fid) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:17:33 +0000



=== Content from git.kernel.org_28d88ee5_20250111_071854.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1b4cb6e91f19b81217ad98142ee53a1ab25893fd)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1b4cb6e91f19b81217ad98142ee53a1ab25893fd)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1b4cb6e91f19b81217ad98142ee53a1ab25893fd)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1b4cb6e91f19b81217ad98142ee53a1ab25893fd)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Van Hensbergen <ericvh@kernel.org> | 2024-03-19 13:50:32 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-17 12:14:37 +0200 |
| commit | [1b4cb6e91f19b81217ad98142ee53a1ab25893fd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1b4cb6e91f19b81217ad98142ee53a1ab25893fd) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1b4cb6e91f19b81217ad98142ee53a1ab25893fd)) | |
| tree | [daea3f1b74cfb6c81faabec20dbecce2e1eceaea](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1b4cb6e91f19b81217ad98142ee53a1ab25893fd) | |
| parent | [658d316e339efaa79a75bee5e5547af086b3e9b3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=658d316e339efaa79a75bee5e5547af086b3e9b3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1b4cb6e91f19b81217ad98142ee53a1ab25893fd&id2=658d316e339efaa79a75bee5e5547af086b3e9b3)) | |
| download | [linux-1b4cb6e91f19b81217ad98142ee53a1ab25893fd.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1b4cb6e91f19b81217ad98142ee53a1ab25893fd.tar.gz) | |

fs/9p: fix uninitialized values during inode evict[ Upstream commit 6630036b7c228f57c7893ee0403e92c2db2cd21d ]
If an iget fails due to not being able to retrieve information
from the server then the inode structure is only partially
initialized. When the inode gets evicted, references to
uninitialized structures (like fscache cookies) were being
made.
This patch checks for a bad\_inode before doing anything other
than clearing the inode from the cache. Since the inode is
bad, it shouldn't have any state associated with it that needs
to be written back (and there really isn't a way to complete
those anyways).
Reported-by: syzbot+eb83fe1cce5833cd66a0@syzkaller.appspotmail.com
Signed-off-by: Eric Van Hensbergen <ericvh@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1b4cb6e91f19b81217ad98142ee53a1ab25893fd)

| -rw-r--r-- | [fs/9p/vfs\_inode.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/9p/vfs_inode.c?id=1b4cb6e91f19b81217ad98142ee53a1ab25893fd) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 6 deletions

| diff --git a/fs/9p/vfs\_inode.c b/fs/9p/vfs\_inode.cindex 32572982f72e68..7d42f0c6c644ff 100644--- a/[fs/9p/vfs\_inode.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_inode.c?id=658d316e339efaa79a75bee5e5547af086b3e9b3)+++ b/[fs/9p/vfs\_inode.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_inode.c?id=1b4cb6e91f19b81217ad98142ee53a1ab25893fd)@@ -371,17 +371,21 @@ void v9fs\_evict\_inode(struct inode \*inode) struct v9fs\_inode \_\_maybe\_unused \*v9inode = V9FS\_I(inode); \_\_le32 \_\_maybe\_unused version; - truncate\_inode\_pages\_final(&inode->i\_data);+ if (!is\_bad\_inode(inode)) {+ truncate\_inode\_pages\_final(&inode->i\_data); - version = cpu\_to\_le32(v9inode->qid.version);- netfs\_clear\_inode\_writeback(inode, &version);+ version = cpu\_to\_le32(v9inode->qid.version);+ netfs\_clear\_inode\_writeback(inode, &version); - clear\_inode(inode);- filemap\_fdatawrite(&inode->i\_data);+ clear\_inode(inode);+ filemap\_fdatawrite(&inode->i\_data);  #ifdef CONFIG\_9P\_FSCACHE- fscache\_relinquish\_cookie(v9fs\_inode\_cookie(v9inode), false);+ if (v9fs\_inode\_cookie(v9inode))+ fscache\_relinquish\_cookie(v9fs\_inode\_cookie(v9inode), false); #endif+ } else+ clear\_inode(inode); }  static int v9fs\_test\_inode(struct inode \*inode, void \*data) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:17:32 +0000


