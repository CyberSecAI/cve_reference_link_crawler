

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=50e60de381c342008c0956fd762e1c26408f372c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=50e60de381c342008c0956fd762e1c26408f372c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=50e60de381c342008c0956fd762e1c26408f372c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=50e60de381c342008c0956fd762e1c26408f372c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Subbaraya Sundeep <sbhatta@marvell.com> | 2024-03-18 14:59:58 +0530 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2024-03-20 10:49:07 +0000 |
| commit | [50e60de381c342008c0956fd762e1c26408f372c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=50e60de381c342008c0956fd762e1c26408f372c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=50e60de381c342008c0956fd762e1c26408f372c)) | |
| tree | [fa3d6e25c07170e71a1a1b6748dd671a79a233e4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=50e60de381c342008c0956fd762e1c26408f372c) | |
| parent | [dfcf6355f53b1796cf7fd50a4f27b18ee6a3497a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dfcf6355f53b1796cf7fd50a4f27b18ee6a3497a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=50e60de381c342008c0956fd762e1c26408f372c&id2=dfcf6355f53b1796cf7fd50a4f27b18ee6a3497a)) | |
| download | [linux-50e60de381c342008c0956fd762e1c26408f372c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-50e60de381c342008c0956fd762e1c26408f372c.tar.gz) | |

octeontx2-af: Use separate handlers for interruptsFor PF to AF interrupt vector and VF to AF vector same
interrupt handler is registered which is causing race condition.
When two interrupts are raised to two CPUs at same time
then two cores serve same event corrupting the data.
Fixes: 7304ac4567bc ("octeontx2-af: Add mailbox IRQ and msg handlers")
Signed-off-by: Subbaraya Sundeep <sbhatta@marvell.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=50e60de381c342008c0956fd762e1c26408f372c)

| -rw-r--r-- | [drivers/net/ethernet/marvell/octeontx2/af/rvu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/marvell/octeontx2/af/rvu.c?id=50e60de381c342008c0956fd762e1c26408f372c) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 3 deletions

| diff --git a/drivers/net/ethernet/marvell/octeontx2/af/rvu.c b/drivers/net/ethernet/marvell/octeontx2/af/rvu.cindex 0b65a18c3a882c..ff78251f92d448 100644--- a/[drivers/net/ethernet/marvell/octeontx2/af/rvu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/marvell/octeontx2/af/rvu.c?id=dfcf6355f53b1796cf7fd50a4f27b18ee6a3497a)+++ b/[drivers/net/ethernet/marvell/octeontx2/af/rvu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/marvell/octeontx2/af/rvu.c?id=50e60de381c342008c0956fd762e1c26408f372c)@@ -2533,10 +2533,9 @@ static void rvu\_queue\_work(struct mbox\_wq\_info \*mw, int first, } } -static irqreturn\_t rvu\_mbox\_intr\_handler(int irq, void \*rvu\_irq)+static irqreturn\_t rvu\_mbox\_pf\_intr\_handler(int irq, void \*rvu\_irq) { struct rvu \*rvu = (struct rvu \*)rvu\_irq;- int vfs = rvu->vfs; u64 intr;  intr = rvu\_read64(rvu, BLKADDR\_RVUM, RVU\_AF\_PFAF\_MBOX\_INT);@@ -2550,6 +2549,18 @@ static irqreturn\_t rvu\_mbox\_intr\_handler(int irq, void \*rvu\_irq)  rvu\_queue\_work(&rvu->afpf\_wq\_info, 0, rvu->hw->total\_pfs, intr); + return IRQ\_HANDLED;+}++static irqreturn\_t rvu\_mbox\_intr\_handler(int irq, void \*rvu\_irq)+{+ struct rvu \*rvu = (struct rvu \*)rvu\_irq;+ int vfs = rvu->vfs;+ u64 intr;++ /\* Sync with mbox memory region \*/+ rmb();+ /\* Handle VF interrupts \*/ if (vfs > 64) { intr = rvupf\_read64(rvu, RVU\_PF\_VFPF\_MBOX\_INTX(1));@@ -2894,7 +2905,7 @@ static int rvu\_register\_interrupts(struct rvu \*rvu) /\* Register mailbox interrupt handler \*/ sprintf(&rvu->irq\_name[RVU\_AF\_INT\_VEC\_MBOX \* NAME\_SIZE], "RVUAF Mbox"); ret = request\_irq(pci\_irq\_vector(rvu->pdev, RVU\_AF\_INT\_VEC\_MBOX),- rvu\_mbox\_intr\_handler, 0,+ rvu\_mbox\_pf\_intr\_handler, 0, &rvu->irq\_name[RVU\_AF\_INT\_VEC\_MBOX \* NAME\_SIZE], rvu); if (ret) { dev\_err(rvu->dev, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:26:31 +0000

