

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3070439%2Fuser-registration%2Ftrunk%2Fincludes%2Fclass-ur-ajax.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3034436/user-registration/trunk/includes/class-ur-ajax.php "Changeset 3034436 for user-registration/trunk/includes/class-ur-ajax.php")
* [Next Change](/changeset/3095484/user-registration/trunk/includes/class-ur-ajax.php "Changeset 3095484 for user-registration/trunk/includes/class-ur-ajax.php") →

---

# Changeset [3070439](/changeset/3070439 "Show full changeset") for [user-registration/trunk/includes/class-ur-ajax.php](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
04/15/2024 05:24:45 AM
([9 months](/timeline?from=2024-04-15T05%3A24%3A45Z&precision=second "See timeline at 04/15/2024 05:24:45 AM") ago)

Author:
wpeverestdev
Message:

Update to version 3.2.0 from GitHub

File:

1 edited

* [user-registration/trunk/includes/class-ur-ajax.php](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439 "Show entry in browser")
  (modified)
  ([7 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [user-registration/trunk/includes/class-ur-ajax.php](/changeset/3070439/user-registration/trunk/includes/class-ur-ajax.php "Show the changeset 3070439 restricted to user-registration/trunk/includes/class-ur-ajax.php")

  | [r3034436](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3034436#L55 "Show revision 3034436 of this file in browser") | [r3070439](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439#L55 "Show revision 3070439 of this file in browser") |  |
  | --- | --- | --- |
  | 55 | 55 | 'update\_profile\_details'    => true, |
  | 56 | 56 | 'profile\_pic\_upload'        => true, |
  | 57 |  | 'profile\_pic\_remove'        => ~~tru~~e, |
  |  | 57 | 'profile\_pic\_remove'        => false, |
  | 58 | 58 | 'ajax\_login\_submit'         => true, |
  | 59 | 59 | 'send\_test\_email'           => true, |
  | […](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3034436#L806) | […](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439#L806) |  |
  | 806 | 806 | check\_ajax\_referer( 'ur\_form\_save\_nonce', 'security' ); |
  | 807 | 807 |  |
  |  | 808 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 809 | throw new Exception( \_\_( "You don't have enough permission to perform this task. Please contact the Administrator.", 'user-registration' ) ); |
  |  | 810 | } |
  |  | 811 |  |
  | 808 | 812 | if ( ! isset( $\_POST['data'] ) || ( isset( $\_POST['data'] ) && gettype( wp\_unslash( $\_POST['data'] ) ) != 'array' ) ) { //phpcs:ignore |
  | 809 | 813 | throw new Exception( \_\_( 'post data not set', 'user-registration' ) ); |
  | […](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3034436#L856) | […](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439#L860) |  |
  | 856 | 860 | \* Perform validation before form save from form builder. |
  | 857 | 861 | \*/ |
  | 858 |  | do\_action(~~"user\_registration\_admin\_backend\_validation\_before\_form\_save"~~); |
  | 859 |  |  |
  |  | 862 | do\_action( 'user\_registration\_admin\_backend\_validation\_before\_form\_save' ); |
  |  | 863 |  |
  | 860 | 864 | $form\_name    = sanitize\_text\_field( $\_POST['data']['form\_name'] ); //phpcs:ignore |
  | 861 | 865 | $form\_row\_ids = sanitize\_text\_field( $\_POST['data']['form\_row\_ids'] ); //phpcs:ignore |
  | […](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3034436#L1125) | […](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439#L1129) |  |
  | 1125 | 1129 | $attachment\_id = isset( $\_POST['attachment\_id'] ) ? intval( wp\_unslash( $\_POST['attachment\_id'] ) ) : ''; |
  | 1126 | 1130 |  |
  | 1127 |  | if ( file\_exists( get\_attached\_file( $attachment\_id ) ) && ! unlink( get\_attached\_file( $attachment\_id ) ) ) { |
  |  | 1131 | if ( is\_user\_logged\_in() ) { |
  |  | 1132 | $user\_id             = get\_current\_user\_id(); |
  |  | 1133 | $user\_profile\_pic\_id = get\_user\_meta( $user\_id, 'user\_registration\_profile\_pic\_url' ); |
  |  | 1134 |  |
  |  | 1135 | if ( $user\_profile\_pic\_id == $attachment\_id ) { |
  |  | 1136 |  |
  |  | 1137 | if ( file\_exists( get\_attached\_file( $attachment\_id ) ) && ! unlink( get\_attached\_file( $attachment\_id ) ) ) { |
  |  | 1138 | wp\_send\_json\_error( |
  |  | 1139 | array( |
  |  | 1140 | 'message' => esc\_html\_\_( 'File cannot be removed', 'user-registration' ), |
  |  | 1141 | ) |
  |  | 1142 | ); |
  |  | 1143 | } |
  |  | 1144 | update\_user\_meta( $user\_id, 'user\_registration\_profile\_pic\_url', '' ); |
  |  | 1145 | } else { |
  |  | 1146 | wp\_send\_json\_error( |
  |  | 1147 | array( |
  |  | 1148 | 'message' => esc\_html\_\_( 'File cannot be removed', 'user-registration' ), |
  |  | 1149 | ) |
  |  | 1150 | ); |
  |  | 1151 | } |
  |  | 1152 | } else { |
  | 1128 | 1153 | wp\_send\_json\_error( |
  | 1129 | 1154 | array( |
  | […](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3034436#L1131) | […](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439#L1156) |  |
  | 1131 | 1156 | ) |
  | 1132 | 1157 | ); |
  | 1133 |  | } |
  | 1134 |  |  |
  | 1135 |  | $user\_id = get\_current\_user\_id(); |
  | 1136 |  |  |
  | 1137 |  | if ( $user\_id > 0 ) { |
  | 1138 |  | update\_user\_meta( $user\_id, 'user\_registration\_profile\_pic\_url', '' ); |
  |  | 1158 |  |
  | 1139 | 1159 | } |
  | 1140 | 1160 |  |
  | […](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3034436#L1475) | […](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439#L1495) |  |
  | 1475 | 1495 | $slug         = isset( $\_POST['slug'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['slug'] ) ) : null; |
  | 1476 | 1496 | $name         = isset( $\_POST['name'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['name'] ) ) : null; |
  |  | 1497 | $video\_id     = isset( $\_POST['video\_id'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['video\_id'] ) ) : null; |
  | 1477 | 1498 | $license\_data = ur\_get\_license\_plan(); |
  | 1478 | 1499 | $button       = ''; |
  | […](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3034436#L1484) | […](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439#L1505) |  |
  | 1484 | 1505 | wp\_send\_json\_success( array( 'action\_button' => $button ) ); |
  | 1485 | 1506 | } else { |
  | 1486 |  | $button = '<div class="action-buttons"><a class="button upgrade-now" href="https://wpuserregistration.com/pricing/?utm\_source=~~addons-page&utm\_medium=upgrade-button&utm\_campaign=ur-upgrade-to-pro~~" target="\_blank">' . esc\_html\_\_( 'Upgrade Plan', 'user-registration' ) . '</a></div>'; |
  |  | 1507 | $button = '<div class="action-buttons"><a class="button upgrade-now" href="https://wpuserregistration.com/pricing/?utm\_source=builder-fields&utm\_medium=premium-field-popup&utm\_campaign=' . UR()->utm\_campaign . '" target="\_blank">' . esc\_html\_\_( 'Upgrade Plan', 'user-registration' ) . '</a></div>'; |
  | 1487 | 1508 | wp\_send\_json\_success( array( 'action\_button' => $button ) ); |
  | 1488 | 1509 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3070439)
* [Zip Archive](?format=zip&new=3070439)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

