

|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Search](query.cgi)
* |
* | [Reports](report.cgi)
* | [New Account](createaccount.cgi)
* |
  [Help](docs/en/html/bug_page.html)
* | [Log In](http://bugzilla.maptools.org/show_bug.cgi?id=2769&GoAheadAndLogIn=1)

*First*
*Last*
*Prev*
*Next*

*No search results available*

[**Bug 2769**](show_bug.cgi?id=2769) -
There is a heap-use-after-free in t2p\_writeproc function in tiff2pdf.c line 405 (CVE-2017-17973)

| Summary: | There is a heap-use-after-free in t2p\_writeproc function in tiff2pdf.c li... |
| --- | --- |

| | **[Status](page.cgi?id=fields.html#status)**: | RESOLVED WORKSFORME | | --- | --- | |  | | | **Product**: | libtiff | | **[Component](describecomponents.cgi?product=libtiff):** | default | | **Version**: | unspecified | | **Platform**: | PC Linux | |  | | | **[Importance](page.cgi?id=fields.html#importance)**: | P2 enhancement | | **Target Milestone**: | --- | | **[Assigned To](page.cgi?id=fields.html#assigned_to)**: | Frank Warmerdam | |  | | | **URL**: |  | | **Whiteboard**: |  | | | **[Keywords](describekeywords.cgi)**: |  | | |  | | | Depends on: |  | | Blocks: |  ||  | Show dependency [tree](showdependencytree.cgi?id=2769&hide_resolved=1) / [graph](showdependencygraph.cgi?id=2769) | | |  | | **Reported**: | 2017-12-29 04:20 by xiaosatianyu@126.com | | --- | --- | | **Modified**: | 2019-08-16 12:46 ([History](show_activity.cgi?id=2769)) | |  | | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| Attachments | |
| --- | --- |
| [**pod**](attachment.cgi?id=837 "View the content of the attachment") (3.93 KB, application/octet-stream)  [2017-12-29 04:20](#attach_837 "Go to the comment associated with the attachment"), xiaosatianyu@126.com | [Details](attachment.cgi?id=837&action=edit) |
| [Add an attachment](attachment.cgi?bugid=2769&action=enter) (proposed patch, testcase, etc.) | |

| Note You need to [log in](show_bug.cgi?id=2769&GoAheadAndLogIn=1) before you can comment on or make changes to this bug.   ---   *[Description](show_bug.cgi?id=2769#c0) From xiaosatianyu@126.com  2017-12-29 04:20:20* ``` [Created an attachment (id=837)](attachment.cgi?id=837 "pod") [[details]](attachment.cgi?id=837&action=edit "pod") pod  There is a  heap-use-after-free  in  t2p_writeproc function  in tiff2pdf.c line 405. ================================================================= ==12652==ERROR: AddressSanitizer: heap-use-after-free on address 0x603000001510 at pc 0x000000470005 bp 0x7fffb2fb31d0 sp 0x7fffb2fb2980 READ of size 32 at 0x603000001510 thread T0     #0 0x470004 in __interceptor_fwrite /home/xiaosatianyu/workspace/git/LLVM/llvm/projects/compiler-rt/lib/asan/../sanitizer_common/sanitizer_common_interceptors.inc:1051     #1 0x52d18a in t2p_writeproc /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/tools/tiff2pdf.c:405:21     #2 0x55a242 in t2pWriteFile /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/tools/tiff2pdf.c:379:10     #3 0x567bd8 in t2p_write_pdf_stream /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/tools/tiff2pdf.c:3989:13     #4 0x580218 in t2p_write_pdf_transfer_stream /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/tools/tiff2pdf.c:5017:13     #5 0x52fd08 in t2p_write_pdf /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/tools/tiff2pdf.c:5497:16     #6 0x52bd9b in main /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/tools/tiff2pdf.c:808:2     #7 0x7f285f27bf44 in __libc_start_main /build/eglibc-SvCtMH/eglibc-2.19/csu/libc-start.c:287     #8 0x41c8eb in _start (/home/binzhang/Desktop/tiff2pdf/tiff2pdf+0x41c8eb)  0x603000001510 is located 0 bytes inside of 32-byte region [0x603000001510,0x603000001530) freed by thread T0 here:     #0 0x4f5290 in __interceptor_free /home/xiaosatianyu/workspace/git/LLVM/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:68     #1 0x7bde10 in _TIFFfree /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_unix.c:330:2     #2 0x592a30 in TIFFFreeDirectory /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_dir.c:1266:2     #3 0x5cb5a2 in TIFFReadDirectory /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_dirread.c:3563:2     #4 0x5bea4a in TIFFSetDirectory /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_dir.c:1622:10     #5 0x5338e1 in t2p_read_tiff_init /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/tools/tiff2pdf.c:1131:3     #6 0x52e0cc in t2p_write_pdf /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/tools/tiff2pdf.c:5431:2     #7 0x52bd9b in main /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/tools/tiff2pdf.c:808:2     #8 0x7f285f27bf44 in __libc_start_main /build/eglibc-SvCtMH/eglibc-2.19/csu/libc-start.c:287  previously allocated by thread T0 here:     #0 0x4f55f6 in __interceptor_malloc /home/xiaosatianyu/workspace/git/LLVM/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88     #1 0x7bdc60 in _TIFFmalloc /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_unix.c:316:10     #2 0x590197 in setByteArray /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_dir.c:54:19     #3 0x590413 in _TIFFsetShortArray /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_dir.c:66:7     #4 0x5a2127 in _TIFFVSetField /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_dir.c:457:4     #5 0x7b71a0 in ZIPVSetField /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_zip.c:375:10     #6 0x777cc9 in PredictorVSetField /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_predict.c:774:10     #7 0x590984 in TIFFVSetField /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_dir.c:854:6     #8 0x590811 in TIFFSetField /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_dir.c:798:11     #9 0x5d0cec in TIFFReadDirectory /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_dirread.c:3931:7     #10 0x5bea4a in TIFFSetDirectory /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/libtiff/tif_dir.c:1622:10     #11 0x5338e1 in t2p_read_tiff_init /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/tools/tiff2pdf.c:1131:3     #12 0x52e0cc in t2p_write_pdf /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/tools/tiff2pdf.c:5431:2     #13 0x52bd9b in main /home/xiaosatianyu/workspace/git/fuzz/for-new-CVE/benlibtiff/libtiff/tools/tiff2pdf.c:808:2     #14 0x7f285f27bf44 in __libc_start_main /build/eglibc-SvCtMH/eglibc-2.19/csu/libc-start.c:287  SUMMARY: AddressSanitizer: heap-use-after-free /home/xiaosatianyu/workspace/git/LLVM/llvm/projects/compiler-rt/lib/asan/../sanitizer_common/sanitizer_common_interceptors.inc:1051 in __interceptor_fwrite Shadow bytes around the buggy address:   0x0c067fff8250: fd fd fa fa fd fd fd fd fa fa fd fd fd fd fa fa   0x0c067fff8260: fd fd fd fd fa fa fd fd fd fd fa fa fd fd fd fd   0x0c067fff8270: fa fa fd fd fd fd fa fa fd fd fd fd fa fa fd fd   0x0c067fff8280: fd fd fa fa fd fd fd fd fa fa fd fd fd fd fa fa   0x0c067fff8290: fd fd fd fd fa fa fd fd fd fa fa fa fd fd fd fd =>0x0c067fff82a0: fa fa[fd]fd fd fd fa fa fd fd fd fd fa fa fd fd   0x0c067fff82b0: fd fd fa fa fd fd fd fd fa fa fd fd fd fd fa fa   0x0c067fff82c0: fd fd fd fd fa fa fd fd fd fd fa fa fd fd fd fd   0x0c067fff82d0: fa fa fd fd fd fd fa fa fd fd fd fd fa fa fd fd   0x0c067fff82e0: fd fd fa fa fd fd fd fd fa fa fd fd fd fd fa fa   0x0c067fff82f0: fd fd fd fd fa fa fd fd fd fd fa fa fd fd fd fd Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==12652==ABORTING ```  ------- *Comment [#1](show_bug.cgi?id=2769#c1) From Salvatore Bonaccorso  2017-12-31 10:38:04* ------- ``` This issue has been assigned CVE-2017-17973 ```  ------- *Comment [#2](show_bug.cgi?id=2769#c2) From Huzaifa Sidhpurwala  2018-01-15 00:09:50* ------- ``` I am not able to reproduce this on libtiff master, can you please specify what version of libtiff was used for reproducing this? ```  ------- *Comment [#3](show_bug.cgi?id=2769#c3) From Salvatore Bonaccorso  2018-01-27 03:44:27* ------- ``` xiaosatianyu, can you give details on how one can reproduce the issue? I was neither on master (as Huzaifa noted), nor on Release-v4-0-9 and Release-v4-0-8. ```  ------- *Comment [#4](show_bug.cgi?id=2769#c4) From Salvatore Bonaccorso  2018-05-10 14:06:01* ------- ``` xiaosatianyu, ping? ```  ------- *Comment [#5](show_bug.cgi?id=2769#c5) From Even Rouault  2019-08-16 12:46:34* ------- ``` Cannot reproduce either. Closing ``` |
| --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=2769)
* - [XML](show_bug.cgi?ctype=xml&id=2769)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=2769)
* - Top of page

*First*
*Last*
*Prev*
*Next*

*No search results available*

* Actions:
  + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Search](query.cgi)
  + |
  + | [Reports](report.cgi)
  + | [New Account](createaccount.cgi)
  + |
    [Help](docs/en/html/bug_page.html)
  + | [Log In](http://bugzilla.maptools.org/show_bug.cgi?id=2769&GoAheadAndLogIn=1)

