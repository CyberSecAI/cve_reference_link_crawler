

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6ce9efd12ae81cf46bf44eb0348594558dfbb9d2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6ce9efd12ae81cf46bf44eb0348594558dfbb9d2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6ce9efd12ae81cf46bf44eb0348594558dfbb9d2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6ce9efd12ae81cf46bf44eb0348594558dfbb9d2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tvrtko Ursulin <tvrtko.ursulin@igalia.com> | 2024-07-11 14:53:30 +0100 |
| --- | --- | --- |
| committer | Thomas Zimmermann <tzimmermann@suse.de> | 2024-07-18 15:48:37 +0200 |
| commit | [6ce9efd12ae81cf46bf44eb0348594558dfbb9d2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6ce9efd12ae81cf46bf44eb0348594558dfbb9d2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6ce9efd12ae81cf46bf44eb0348594558dfbb9d2)) | |
| tree | [b4163c7f4be2d59311b21481f201bc241277f062](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6ce9efd12ae81cf46bf44eb0348594558dfbb9d2) | |
| parent | [eeb1f825b5dc68047a0556e5ae86d1467920db41](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eeb1f825b5dc68047a0556e5ae86d1467920db41) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6ce9efd12ae81cf46bf44eb0348594558dfbb9d2&id2=eeb1f825b5dc68047a0556e5ae86d1467920db41)) | |
| download | [linux-6ce9efd12ae81cf46bf44eb0348594558dfbb9d2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6ce9efd12ae81cf46bf44eb0348594558dfbb9d2.tar.gz) | |

drm/v3d: Prevent out of bounds access in performance query extensionsCheck that the number of perfmons userspace is passing in the copy and
reset extensions is not greater than the internal kernel storage where
the ids will be copied into.
Signed-off-by: Tvrtko Ursulin <tvrtko.ursulin@igalia.com>
Fixes: bae7cb5d6800 ("drm/v3d: Create a CPU job extension for the reset performance query job")
Cc: Maíra Canal <mcanal@igalia.com>
Cc: Iago Toral Quiroga <itoral@igalia.com>
Cc: stable@vger.kernel.org # v6.8+
Reviewed-by: Iago Toral Quiroga <itoral@igalia.com>
Reviewed-by: Maíra Canal <mcanal@igalia.com>
Signed-off-by: Maíra Canal <mcanal@igalia.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240711135340.84617-2-tursulin@igalia.com](https://patchwork.freedesktop.org/patch/msgid/20240711135340.84617-2-tursulin%40igalia.com)
(cherry picked from commit f32b5128d2c440368b5bf3a7a356823e235caabb)
Signed-off-by: Thomas Zimmermann <tzimmermann@suse.de>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6ce9efd12ae81cf46bf44eb0348594558dfbb9d2)

| -rw-r--r-- | [drivers/gpu/drm/v3d/v3d\_submit.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/v3d/v3d_submit.c?id=6ce9efd12ae81cf46bf44eb0348594558dfbb9d2) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/v3d/v3d\_submit.c b/drivers/gpu/drm/v3d/v3d\_submit.cindex 88f63d526b2236..263fefc1d04ff7 100644--- a/[drivers/gpu/drm/v3d/v3d\_submit.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/v3d/v3d_submit.c?id=eeb1f825b5dc68047a0556e5ae86d1467920db41)+++ b/[drivers/gpu/drm/v3d/v3d\_submit.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/v3d/v3d_submit.c?id=6ce9efd12ae81cf46bf44eb0348594558dfbb9d2)@@ -637,6 +637,9 @@ v3d\_get\_cpu\_reset\_performance\_params(struct drm\_file \*file\_priv, if (copy\_from\_user(&reset, ext, sizeof(reset))) return -EFAULT; + if (reset.nperfmons > V3D\_MAX\_PERFMONS)+ return -EINVAL;+ job->job\_type = V3D\_CPU\_JOB\_TYPE\_RESET\_PERFORMANCE\_QUERY;  job->performance\_query.queries = kvmalloc\_array(reset.count,@@ -708,6 +711,9 @@ v3d\_get\_cpu\_copy\_performance\_query\_params(struct drm\_file \*file\_priv, if (copy.pad) return -EINVAL; + if (copy.nperfmons > V3D\_MAX\_PERFMONS)+ return -EINVAL;+ job->job\_type = V3D\_CPU\_JOB\_TYPE\_COPY\_PERFORMANCE\_QUERY;  job->performance\_query.queries = kvmalloc\_array(copy.count, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:13:51 +0000

