

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1f8d0691c50581ba6043f009ec9e8b9f78f09d5a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1f8d0691c50581ba6043f009ec9e8b9f78f09d5a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1f8d0691c50581ba6043f009ec9e8b9f78f09d5a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1f8d0691c50581ba6043f009ec9e8b9f78f09d5a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jean Delvare <jdelvare@suse.de> | 2024-02-14 15:59:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-23 08:55:04 +0100 |
| commit | [1f8d0691c50581ba6043f009ec9e8b9f78f09d5a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1f8d0691c50581ba6043f009ec9e8b9f78f09d5a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1f8d0691c50581ba6043f009ec9e8b9f78f09d5a)) | |
| tree | [18f5eca521052342b5180276aa265974806d7f15](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1f8d0691c50581ba6043f009ec9e8b9f78f09d5a) | |
| parent | [23a8b74fe9c4aec26bc8eecf33826963598b33ab](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=23a8b74fe9c4aec26bc8eecf33826963598b33ab) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1f8d0691c50581ba6043f009ec9e8b9f78f09d5a&id2=23a8b74fe9c4aec26bc8eecf33826963598b33ab)) | |
| download | [linux-1f8d0691c50581ba6043f009ec9e8b9f78f09d5a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1f8d0691c50581ba6043f009ec9e8b9f78f09d5a.tar.gz) | |

i2c: i801: Fix block process call transactions[ Upstream commit c1c9d0f6f7f1dbf29db996bd8e166242843a5f21 ]
According to the Intel datasheets, software must reset the block
buffer index twice for block process call transactions: once before
writing the outgoing data to the buffer, and once again before
reading the incoming data from the buffer.
The driver is currently missing the second reset, causing the wrong
portion of the block buffer to be read.
Signed-off-by: Jean Delvare <jdelvare@suse.de>
Reported-by: Piotr Zakowski <piotr.zakowski@intel.com>
Closes: https://lore.kernel.org/linux-i2c/20240213120553.7b0ab120@endymion.delvare/
Fixes: 315cd67c9453 ("i2c: i801: Add Block Write-Block Read Process Call support")
Reviewed-by: Alexander Sverdlin <alexander.sverdlin@gmail.com>
Signed-off-by: Andi Shyti <andi.shyti@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1f8d0691c50581ba6043f009ec9e8b9f78f09d5a)

| -rw-r--r-- | [drivers/i2c/busses/i2c-i801.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/i2c/busses/i2c-i801.c?id=1f8d0691c50581ba6043f009ec9e8b9f78f09d5a) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/i2c/busses/i2c-i801.c b/drivers/i2c/busses/i2c-i801.cindex 8ecba1ca923655..87c2c7c8473679 100644--- a/[drivers/i2c/busses/i2c-i801.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/busses/i2c-i801.c?id=23a8b74fe9c4aec26bc8eecf33826963598b33ab)+++ b/[drivers/i2c/busses/i2c-i801.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/busses/i2c-i801.c?id=1f8d0691c50581ba6043f009ec9e8b9f78f09d5a)@@ -522,11 +522,10 @@ static int i801\_block\_transaction\_by\_block(struct i801\_priv \*priv, /\* Set block buffer mode \*/ outb\_p(inb\_p(SMBAUXCTL(priv)) | SMBAUXCTL\_E32B, SMBAUXCTL(priv)); - inb\_p(SMBHSTCNT(priv)); /\* reset the data buffer index \*/- if (read\_write == I2C\_SMBUS\_WRITE) { len = data->block[0]; outb\_p(len, SMBHSTDAT0(priv));+ inb\_p(SMBHSTCNT(priv)); /\* reset the data buffer index \*/ for (i = 0; i < len; i++) outb\_p(data->block[i+1], SMBBLKDAT(priv)); }@@ -542,6 +541,7 @@ static int i801\_block\_transaction\_by\_block(struct i801\_priv \*priv, return -EPROTO;  data->block[0] = len;+ inb\_p(SMBHSTCNT(priv)); /\* reset the data buffer index \*/ for (i = 0; i < len; i++) data->block[i + 1] = inb\_p(SMBBLKDAT(priv)); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:13:44 +0000

