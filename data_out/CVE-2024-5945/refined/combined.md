=== Content from plugins.trac.wordpress.org_2cabc855_20250110_175709.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3105276)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3105275 "Changeset 3105275")
* [Next Changeset](/changeset/3105277 "Changeset 3105277") →

---

# Changeset 3105276

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
06/20/2024 05:25:17 PM
([7 months](/timeline?from=2024-06-20T17%3A25%3A17Z&precision=second "See timeline at 06/20/2024 05:25:17 PM") ago)

Author:
petredobrescu
Message:

Version 4.3

* Fix: Patched a Stored Cross-Site Scripting vulnerability found by Colin Xu and responsibly disclosed by the WordFence team;
* Compat: Added compatibity with WP All Import plugin;
* Compat: Tested with the latest versions of [WordPress](/wiki/WordPress) (6.6) and PHP (8.3).

Location:
[wp-svg-images](/browser/wp-svg-images?rev=3105276)
Files:

4 edited
1 copied

* [tags/4.3](/browser/wp-svg-images/tags/4.3?rev=3105276 "Show entry in browser")
  (copied)
  *(copied from [wp-svg-images/trunk](/browser/wp-svg-images/trunk?rev=3058565 "Show original file (revision 3105275)"))*
* [tags/4.3/readme.txt](/browser/wp-svg-images/tags/4.3/readme.txt?rev=3105276 "Show entry in browser")
  (modified)
  ([3 diffs](#file1 "Show differences"))
* [tags/4.3/wp-svg-images.php](/browser/wp-svg-images/tags/4.3/wp-svg-images.php?rev=3105276 "Show entry in browser")
  (modified)
  ([4 diffs](#file2 "Show differences"))
* [trunk/readme.txt](/browser/wp-svg-images/trunk/readme.txt?rev=3105276 "Show entry in browser")
  (modified)
  ([3 diffs](#file3 "Show differences"))
* [trunk/wp-svg-images.php](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=3105276 "Show entry in browser")
  (modified)
  ([4 diffs](#file4 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wp-svg-images/tags/4.3/readme.txt](/changeset/3105276/wp-svg-images/tags/4.3/readme.txt "Show the changeset 3105276 restricted to wp-svg-images/tags/4.3/readme.txt")

  | [r3058565](/browser/wp-svg-images/trunk/readme.txt?rev=3058565#L5 "Show revision 3058565 of this file in browser") | [r3105276](/browser/wp-svg-images/tags/4.3/readme.txt?rev=3105276#L5 "Show revision 3105276 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires at least: 3.0.1 |
  | 6 | 6 | Requires PHP: 5.6.40 |
  | 7 |  | Tested up to: 6.~~5~~ |
  | 8 |  | Stable tag: 4.~~2~~ |
  |  | 7 | Tested up to: 6.6 |
  |  | 8 | Stable tag: 4.3 |
  | 9 | 9 | License: GPLv2 or later |
  | 10 | 10 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/wp-svg-images/trunk/readme.txt?rev=3058565#L33) | […](/browser/wp-svg-images/tags/4.3/readme.txt?rev=3105276#L33) |  |
  | 33 | 33 | This plugin is supported & maintained by [ShortPixel](https://shortpixel.com/). |
  | 34 | 34 | Other popular plugins by ShortPixel: |
  |  | 35 | [FastPixel Caching](https://wordpress.org/plugins/fastpixel-website-accelerator/) - WP Optimization made easy |
  | 35 | 36 | [ShortPixel Image Optimizer](https://wordpress.org/plugins/shortpixel-image-optimiser/) - Image optimization & compression for all the images on your website, including WebP delivery – ShortPixel Image Optimizer. |
  | 36 | 37 | [ShortPixel Adaptive Images](https://wordpress.org/plugins/shortpixel-adaptive-images/) - On-the-fly image optimization & CDN delivery. |
  | […](/browser/wp-svg-images/trunk/readme.txt?rev=3058565#L68) | […](/browser/wp-svg-images/tags/4.3/readme.txt?rev=3105276#L69) |  |
  | 68 | 69 |  |
  | 69 | 70 | == Changelog == |
  |  | 71 | = 4.3 = |
  |  | 72 | Release date: June 20th, 2024 |
  |  | 73 | \* Fix: Patched a Stored Cross-Site Scripting vulnerability found by Colin Xu and responsibly disclosed by the WordFence team; |
  |  | 74 | \* Compat: Added compatibity with WP All Import plugin; |
  |  | 75 | \* Compat: Tested with the latest versions of WordPress (6.6) and PHP (8.3). |
  | 70 | 76 |  |
  | 71 | 77 | = 4.2 = |
  | 72 | 78 | Release date: April 6th, 2023 |
  | 73 |  | \* Tested on WordPress 6.2; |
  | 74 |  | \* Updated SVG sanitizer scripts; |
  | 75 |  | \* Skip percentage width and height when reading SVG dimensions. |
  |  | 79 | \* Compat: Tested on WordPress 6.2; |
  |  | 80 | \* Compat: Updated SVG sanitizer scripts; |
  |  | 81 | \* Tweak: Skip percentage width and height when reading SVG dimensions. |
  | 76 | 82 |  |
  | 77 | 83 | = 4.1 = |
* ## [wp-svg-images/tags/4.3/wp-svg-images.php](/changeset/3105276/wp-svg-images/tags/4.3/wp-svg-images.php "Show the changeset 3105276 restricted to wp-svg-images/tags/4.3/wp-svg-images.php")

  | [r2894818](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=2894818#L1 "Show revision 2894818 of this file in browser") | [r3105276](/browser/wp-svg-images/tags/4.3/wp-svg-images.php?rev=3105276#L1 "Show revision 3105276 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | /\* |
  | 3 |  | Plugin Name:    WP SVG Images |
  |  | 3 | Plugin Name:        WP SVG Images |
  | 4 | 4 | Plugin URI:     https://shortpixel.com/ |
  | 5 |  | Description:    Full SVG Media support in WordPress |
  | 6 |  | Version:    ~~4.2~~ |
  | 7 |  | Author:         ShortPixel |
  |  | 5 | Description:        Full SVG Media support in WordPress |
  |  | 6 | Version:        4.3 |
  |  | 7 | Author:         ShortPixel |
  | 8 | 8 | Author URI:     https://shortpixel.com/ |
  | 9 |  | GitHub Plugin URI: https://github.com/short-pixel-optimizer/wp-svg-images |
  | 10 |  | Text Domain:    wpsvg |
  | 11 |  | Domain Path:    /languages |
  |  | 9 | GitHub Plugin URI:  https://github.com/short-pixel-optimizer/wp-svg-images |
  |  | 10 | Primary Branch:     main |
  |  | 11 | Text Domain:        wpsvg |
  |  | 12 | Domain Path:        /languages |
  | 12 | 13 | \*/ |
  | 13 | 14 |  |
  | […](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=2894818#L71) | […](/browser/wp-svg-images/tags/4.3/wp-svg-images.php?rev=3105276#L72) |  |
  | 71 | 72 |  |
  | 72 | 73 | add\_action( 'admin\_init', array( $this, 'upsell' ) ); |
  |  | 74 | add\_filter( 'wp\_all\_import\_image\_mime\_type', array( $this, 'wp\_all\_import\_svgs' ), 10, 2 ); |
  |  | 75 | } |
  |  | 76 |  |
  |  | 77 | function wp\_all\_import\_svgs( $mime\_type, $image\_filepath ){ |
  |  | 78 | if( empty( $mime\_type ) && ( substr( $image\_filepath, -4 ) == '.svg' || substr( $image\_filepath, -5 ) == '.svgz' ) ){ |
  |  | 79 | return 'image/svg+xml'; |
  |  | 80 | } |
  |  | 81 | return $mime\_type; |
  | 73 | 82 | } |
  | 74 | 83 |  |
  | […](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=2894818#L110) | […](/browser/wp-svg-images/tags/4.3/wp-svg-images.php?rev=3105276#L119) |  |
  | 110 | 119 |  |
  | 111 | 120 | function wp\_handle\_upload\_prefilter( $file ){ |
  | 112 |  | if( $file['type'] === 'image/svg+xml' ){ |
  |  | 121 |  |
  |  | 122 | // Security:  form data can be faked, including the filetype. Check tmpfile. |
  |  | 123 | $file\_type = mime\_content\_type($file['tmp\_name']); |
  |  | 124 |  |
  |  | 125 | if( $file\_type == 'image/svg+xml' ) |
  |  | 126 | { |
  | 113 | 127 | $user = wp\_get\_current\_user(); |
  | 114 | 128 | $roles = (array)$user->roles; |
  | […](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=2894818#L211) | […](/browser/wp-svg-images/tags/4.3/wp-svg-images.php?rev=3105276#L225) |  |
  | 211 | 225 | <div class="wrap"> |
  | 212 | 226 | <h2><?php \_e( 'SVG images', 'wpsvg' ) ?></h2> |
  | 213 |  |  |
  |  | 227 |  |
  | 214 | 228 | <?php if( $show\_update\_notice ) echo '<div class="below-h2 updated"><p>' . \_\_( 'Settings saved.', 'wpsvg' ) . '</p></div>'; ?> |
  | 215 |  |  |
  |  | 229 |  |
  | 216 | 230 | <div class="postbox" style="margin-top:10px"> |
  | 217 | 231 | <div class="inside" style="padding-bottom:2px"> |
* ## [wp-svg-images/trunk/readme.txt](/changeset/3105276/wp-svg-images/trunk/readme.txt "Show the changeset 3105276 restricted to wp-svg-images/trunk/readme.txt")

  | [r3058565](/browser/wp-svg-images/trunk/readme.txt?rev=3058565#L5 "Show revision 3058565 of this file in browser") | [r3105276](/browser/wp-svg-images/trunk/readme.txt?rev=3105276#L5 "Show revision 3105276 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires at least: 3.0.1 |
  | 6 | 6 | Requires PHP: 5.6.40 |
  | 7 |  | Tested up to: 6.~~5~~ |
  | 8 |  | Stable tag: 4.~~2~~ |
  |  | 7 | Tested up to: 6.6 |
  |  | 8 | Stable tag: 4.3 |
  | 9 | 9 | License: GPLv2 or later |
  | 10 | 10 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/wp-svg-images/trunk/readme.txt?rev=3058565#L33) | […](/browser/wp-svg-images/trunk/readme.txt?rev=3105276#L33) |  |
  | 33 | 33 | This plugin is supported & maintained by [ShortPixel](https://shortpixel.com/). |
  | 34 | 34 | Other popular plugins by ShortPixel: |
  |  | 35 | [FastPixel Caching](https://wordpress.org/plugins/fastpixel-website-accelerator/) - WP Optimization made easy |
  | 35 | 36 | [ShortPixel Image Optimizer](https://wordpress.org/plugins/shortpixel-image-optimiser/) - Image optimization & compression for all the images on your website, including WebP delivery – ShortPixel Image Optimizer. |
  | 36 | 37 | [ShortPixel Adaptive Images](https://wordpress.org/plugins/shortpixel-adaptive-images/) - On-the-fly image optimization & CDN delivery. |
  | […](/browser/wp-svg-images/trunk/readme.txt?rev=3058565#L68) | […](/browser/wp-svg-images/trunk/readme.txt?rev=3105276#L69) |  |
  | 68 | 69 |  |
  | 69 | 70 | == Changelog == |
  |  | 71 | = 4.3 = |
  |  | 72 | Release date: June 20th, 2024 |
  |  | 73 | \* Fix: Patched a Stored Cross-Site Scripting vulnerability found by Colin Xu and responsibly disclosed by the WordFence team; |
  |  | 74 | \* Compat: Added compatibity with WP All Import plugin; |
  |  | 75 | \* Compat: Tested with the latest versions of WordPress (6.6) and PHP (8.3). |
  | 70 | 76 |  |
  | 71 | 77 | = 4.2 = |
  | 72 | 78 | Release date: April 6th, 2023 |
  | 73 |  | \* Tested on WordPress 6.2; |
  | 74 |  | \* Updated SVG sanitizer scripts; |
  | 75 |  | \* Skip percentage width and height when reading SVG dimensions. |
  |  | 79 | \* Compat: Tested on WordPress 6.2; |
  |  | 80 | \* Compat: Updated SVG sanitizer scripts; |
  |  | 81 | \* Tweak: Skip percentage width and height when reading SVG dimensions. |
  | 76 | 82 |  |
  | 77 | 83 | = 4.1 = |
* ## [wp-svg-images/trunk/wp-svg-images.php](/changeset/3105276/wp-svg-images/trunk/wp-svg-images.php "Show the changeset 3105276 restricted to wp-svg-images/trunk/wp-svg-images.php")

  | [r2894818](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=2894818#L1 "Show revision 2894818 of this file in browser") | [r3105276](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=3105276#L1 "Show revision 3105276 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | /\* |
  | 3 |  | Plugin Name:    WP SVG Images |
  |  | 3 | Plugin Name:        WP SVG Images |
  | 4 | 4 | Plugin URI:     https://shortpixel.com/ |
  | 5 |  | Description:    Full SVG Media support in WordPress |
  | 6 |  | Version:    ~~4.2~~ |
  | 7 |  | Author:         ShortPixel |
  |  | 5 | Description:        Full SVG Media support in WordPress |
  |  | 6 | Version:        4.3 |
  |  | 7 | Author:         ShortPixel |
  | 8 | 8 | Author URI:     https://shortpixel.com/ |
  | 9 |  | GitHub Plugin URI: https://github.com/short-pixel-optimizer/wp-svg-images |
  | 10 |  | Text Domain:    wpsvg |
  | 11 |  | Domain Path:    /languages |
  |  | 9 | GitHub Plugin URI:  https://github.com/short-pixel-optimizer/wp-svg-images |
  |  | 10 | Primary Branch:     main |
  |  | 11 | Text Domain:        wpsvg |
  |  | 12 | Domain Path:        /languages |
  | 12 | 13 | \*/ |
  | 13 | 14 |  |
  | […](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=2894818#L71) | […](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=3105276#L72) |  |
  | 71 | 72 |  |
  | 72 | 73 | add\_action( 'admin\_init', array( $this, 'upsell' ) ); |
  |  | 74 | add\_filter( 'wp\_all\_import\_image\_mime\_type', array( $this, 'wp\_all\_import\_svgs' ), 10, 2 ); |
  |  | 75 | } |
  |  | 76 |  |
  |  | 77 | function wp\_all\_import\_svgs( $mime\_type, $image\_filepath ){ |
  |  | 78 | if( empty( $mime\_type ) && ( substr( $image\_filepath, -4 ) == '.svg' || substr( $image\_filepath, -5 ) == '.svgz' ) ){ |
  |  | 79 | return 'image/svg+xml'; |
  |  | 80 | } |
  |  | 81 | return $mime\_type; |
  | 73 | 82 | } |
  | 74 | 83 |  |
  | […](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=2894818#L110) | […](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=3105276#L119) |  |
  | 110 | 119 |  |
  | 111 | 120 | function wp\_handle\_upload\_prefilter( $file ){ |
  | 112 |  | if( $file['type'] === 'image/svg+xml' ){ |
  |  | 121 |  |
  |  | 122 | // Security:  form data can be faked, including the filetype. Check tmpfile. |
  |  | 123 | $file\_type = mime\_content\_type($file['tmp\_name']); |
  |  | 124 |  |
  |  | 125 | if( $file\_type == 'image/svg+xml' ) |
  |  | 126 | { |
  | 113 | 127 | $user = wp\_get\_current\_user(); |
  | 114 | 128 | $roles = (array)$user->roles; |
  | […](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=2894818#L211) | […](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=3105276#L225) |  |
  | 211 | 225 | <div class="wrap"> |
  | 212 | 226 | <h2><?php \_e( 'SVG images', 'wpsvg' ) ?></h2> |
  | 213 |  |  |
  |  | 227 |  |
  | 214 | 228 | <?php if( $show\_update\_notice ) echo '<div class="below-h2 updated"><p>' . \_\_( 'Settings saved.', 'wpsvg' ) . '</p></div>'; ?> |
  | 215 |  |  |
  |  | 229 |  |
  | 216 | 230 | <div class="postbox" style="margin-top:10px"> |
  | 217 | 231 | <div class="inside" style="padding-bottom:2px"> |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3105276)
* [Zip Archive](?format=zip&new=3105276)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_8668e925_20250110_175707.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwp-svg-images%2Ftrunk%2Fwp-svg-images.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=2894818 "Revision 2894818")
* Next Revision →
* [Blame](/browser/wp-svg-images/trunk/wp-svg-images.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wp-svg-images/trunk/wp-svg-images.php)

---

# [source:](/browser?order=name "Go to repository root") [wp-svg-images](/browser/wp-svg-images?order=name "View wp-svg-images")/[trunk](/browser/wp-svg-images/trunk?order=name "View trunk")/[wp-svg-images.php](/browser/wp-svg-images/trunk/wp-svg-images.php?order=name "View wp-svg-images.php")

View diff against:

View revision:

| [Last change](/changeset/3105276/wp-svg-images/trunk/wp-svg-images.php "View differences") on this file was [3105276](/changeset/3105276/ "View changeset 3105276"), checked in by petredobrescu, [7 months ago](/timeline?from=2024-06-20T17%3A25%3A17Z&precision=second "See timeline at 06/20/2024 05:25:17 PM") |
| --- |
| Version 4.3   * Fix: Patched a Stored Cross-Site Scripting vulnerability found by Colin Xu and responsibly disclosed by the WordFence team; * Compat: Added compatibity with WP All Import plugin; * Compat: Tested with the latest versions of [WordPress](/wiki/WordPress) (6.6) and PHP (8.3). |
| **File size:** 17.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | Plugin Name:            WP SVG Images |
| [4](#L4) | Plugin URI:             https://shortpixel.com/ |
| [5](#L5) | Description:            Full SVG Media support in WordPress |
| [6](#L6) | Version:                4.3 |
| [7](#L7) | Author:                 ShortPixel |
| [8](#L8) | Author URI:             https://shortpixel.com/ |
| [9](#L9) | GitHub Plugin URI:      https://github.com/short-pixel-optimizer/wp-svg-images |
| [10](#L10) | Primary Branch:         main |
| [11](#L11) | Text Domain:            wpsvg |
| [12](#L12) | Domain Path:            /languages |
| [13](#L13) | \*/ |
| [14](#L14) |  |
| [15](#L15) | defined( 'ABSPATH' ) || exit; |
| [16](#L16) |  |
| [17](#L17) | if( ! class\_exists('enshrined\svgSanitize\Sanitizer') ){ |
| [18](#L18) | require\_once( 'svg-sanitizer/data/AttributeInterface.php' ); |
| [19](#L19) | require\_once( 'svg-sanitizer/data/TagInterface.php' ); |
| [20](#L20) | require\_once( 'svg-sanitizer/data/AllowedAttributes.php' ); |
| [21](#L21) | require\_once( 'svg-sanitizer/data/AllowedTags.php' ); |
| [22](#L22) | require\_once( 'svg-sanitizer/data/XPath.php' ); |
| [23](#L23) | require\_once( 'svg-sanitizer/ElementReference/Resolver.php' ); |
| [24](#L24) | require\_once( 'svg-sanitizer/ElementReference/Subject.php' ); |
| [25](#L25) | require\_once( 'svg-sanitizer/ElementReference/Usage.php' ); |
| [26](#L26) | require\_once( 'svg-sanitizer/Exceptions/NestingException.php' ); |
| [27](#L27) | require\_once( 'svg-sanitizer/Helper.php' ); |
| [28](#L28) | require\_once( 'svg-sanitizer/Sanitizer.php' ); |
| [29](#L29) | } |
| [30](#L30) |  |
| [31](#L31) | class WPSVG\_allowedTags extends \enshrined\svgSanitize\data\AllowedTags{ |
| [32](#L32) | public static function getTags(){ |
| [33](#L33) | return apply\_filters( 'WPSVG\_setAllowedTags', parent::getTags() ); |
| [34](#L34) | } |
| [35](#L35) | } |
| [36](#L36) |  |
| [37](#L37) | class WPSVG\_allowedAttrs extends \enshrined\svgSanitize\data\AllowedAttributes{ |
| [38](#L38) | public static function getAttributes(){ |
| [39](#L39) | return apply\_filters( 'WPSVG\_setAllowedAttrs', parent::getAttributes() ); |
| [40](#L40) | } |
| [41](#L41) | } |
| [42](#L42) |  |
| [43](#L43) | if( ! class\_exists('WPSVG') ){ |
| [44](#L44) | class WPSVG{ |
| [45](#L45) | var $plugin\_admin\_page; |
| [46](#L46) | var $settings; |
| [47](#L47) | var $sanitizer; |
| [48](#L48) | var $spio\_installed = false; |
| [49](#L49) | var $spio\_active = false; |
| [50](#L50) |  |
| [51](#L51) | function \_\_construct(){ |
| [52](#L52) | $this->sanitizer = new enshrined\svgSanitize\Sanitizer(); |
| [53](#L53) | $this->sanitizer->removeXMLTag( true ); |
| [54](#L54) | $this->sanitizer->minify( true ); |
| [55](#L55) |  |
| [56](#L56) | add\_filter( 'wp\_handle\_upload\_prefilter', array( $this, 'wp\_handle\_upload\_prefilter' ) ); |
| [57](#L57) |  |
| [58](#L58) | add\_action( 'plugins\_loaded', array( $this, 'plugins\_loaded' ) ); |
| [59](#L59) | add\_action( 'admin\_menu', array( $this, 'plugin\_menu\_link' ) ); |
| [60](#L60) | add\_action( 'init', array( $this, 'plugin\_init' ) ); |
| [61](#L61) |  |
| [62](#L62) | add\_action( 'admin\_init', array( $this, 'add\_svg\_support' ) ); |
| [63](#L63) | add\_action( 'admin\_footer', array( $this, 'fix\_svg\_thumbnail\_size' ) ); |
| [64](#L64) | add\_filter( 'upload\_mimes', array( $this, 'add\_svg\_mime' ) ); |
| [65](#L65) | add\_filter( 'wp\_check\_filetype\_and\_ext', array( $this, 'wp\_check\_filetype\_and\_ext' ), 100, 4 ); |
| [66](#L66) | add\_filter( 'wp\_generate\_attachment\_metadata', array( $this, 'wp\_generate\_attachment\_metadata' ), 10, 2 ); |
| [67](#L67) | add\_filter( 'fl\_module\_upload\_regex', array( $this, 'fl\_module\_upload\_regex' ), 10, 4 ); |
| [68](#L68) | add\_filter( 'render\_block', array( $this, 'fix\_missing\_width\_height\_on\_image\_block' ), 10, 2 ); |
| [69](#L69) |  |
| [70](#L70) | add\_action( 'admin\_notices', array( $this, 'admin\_notices' ) ); |
| [71](#L71) | add\_action( 'wp\_ajax\_wpsvg\_notice\_dismissed', array( $this, 'wpsvg\_notice\_dismissed' ) ); |
| [72](#L72) |  |
| [73](#L73) | add\_action( 'admin\_init', array( $this, 'upsell' ) ); |
| [74](#L74) | add\_filter( 'wp\_all\_import\_image\_mime\_type', array( $this, 'wp\_all\_import\_svgs' ), 10, 2 ); |
| [75](#L75) | } |
| [76](#L76) |  |
| [77](#L77) | function wp\_all\_import\_svgs( $mime\_type, $image\_filepath ){ |
| [78](#L78) | if( empty( $mime\_type ) && ( substr( $image\_filepath, -4 ) == '.svg' || substr( $image\_filepath, -5 ) == '.svgz' ) ){ |
| [79](#L79) | return 'image/svg+xml'; |
| [80](#L80) | } |
| [81](#L81) | return $mime\_type; |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | function upsell(){ |
| [85](#L85) | $plugins = get\_plugins(); |
| [86](#L86) | $this->spio\_installed = isset( $plugins['shortpixel-image-optimiser/wp-shortpixel.php'] ); |
| [87](#L87) | $this->spio\_active = is\_plugin\_active('shortpixel-image-optimiser/wp-shortpixel.php'); |
| [88](#L88) |  |
| [89](#L89) | if( ! $this->spio\_installed || ! $this->spio\_active ){ |
| [90](#L90) | wp\_enqueue\_style( 'spio-upsell', plugins\_url( '/assets/css/spio-upsell.css', \_\_FILE\_\_ ) ); |
| [91](#L91) | wp\_enqueue\_script( 'spio-upsell', plugins\_url( '/assets/js/spio-upsell.js', \_\_FILE\_\_ ), array('jquery') ); |
| [92](#L92) | } |
| [93](#L93) | } |
| [94](#L94) |  |
| [95](#L95) | function wpsvg\_notice\_dismissed(){ |
| [96](#L96) | if( defined('DOING\_AJAX') && DOING\_AJAX && check\_ajax\_referer('wpsvg\_notice\_dismissed') ){ |
| [97](#L97) | add\_user\_meta( get\_current\_user\_id(), 'wpsvg\_notice\_dismissed', 1, true ); |
| [98](#L98) | } |
| [99](#L99) | } |
| [100](#L100) |  |
| [101](#L101) | function admin\_notices(){ |
| [102](#L102) | if( ! get\_user\_meta( get\_current\_user\_id(), 'wpsvg\_notice\_dismissed' ) ){ |
| [103](#L103) | if( function\_exists('get\_current\_screen') && isset( get\_current\_screen()->id ) && in\_array( get\_current\_screen()->id, array( 'plugins', 'plugin-install', 'upload', 'attachment' ) ) ){ ?> |
| [104](#L104) | <div class="wpsvg-notice notice notice-success is-dismissible"> |
| [105](#L105) | <p><?php printf( esc\_html\_\_( 'Hey, WP SVG images has some new settings! Activate SVG sanitization and manage permissions by going to the new %s', 'wpsvg' ), '<a href="' . admin\_url('options-general.php?page=wp-svg-images.php') . '">' . esc\_html\_\_( 'Settings page', 'wpsvg' ) . '</a>' ) ?></p> |
| [106](#L106) | <p><small style="opacity:.9"><?php printf( esc\_html\_\_( 'WP SVG images in now a part of the %s family.', 'wpsvg' ), '<a href="https://shortpixel.com/api-tools" target="\_blank">ShortPixel</a>' ) ?></small></p> |
| [107](#L107) | <p><a href="<?php echo admin\_url('options-general.php?page=wp-svg-images.php') ?>" class="button button-primary"><?php esc\_html\_e( 'Go to Settings', 'wpsvg' ) ?></a></p> |
| [108](#L108) | </div> |
| [109](#L109) | <script> |
| [110](#L110) | jQuery(document).ready(function($){ |
| [111](#L111) | $(document).on('click', '.wpsvg-notice .notice-dismiss', function(){ |
| [112](#L112) | $.post( ajaxurl, { action: 'wpsvg\_notice\_dismissed', \_wpnonce: '<?php echo wp\_create\_nonce('wpsvg\_notice\_dismissed') ?>' }); |
| [113](#L113) | }); |
| [114](#L114) | }); |
| [115](#L115) | </script><?php |
| [116](#L116) | } |
| [117](#L117) | } |
| [118](#L118) | } |
| [119](#L119) |  |
| [120](#L120) | function wp\_handle\_upload\_prefilter( $file ){ |
| [121](#L121) |  |
| [122](#L122) | // Security:  form data can be faked, including the filetype. Check tmpfile. |
| [123](#L123) | $file\_type = mime\_content\_type($file['tmp\_name']); |
| [124](#L124) |  |
| [125](#L125) | if( $file\_type == 'image/svg+xml' ) |
| [126](#L126) | { |
| [127](#L127) | $user = wp\_get\_current\_user(); |
| [128](#L128) | $roles = (array)$user->roles; |
| [129](#L129) | $unrestricted = false; |
| [130](#L130) | foreach( $roles as $role ){ |
| [131](#L131) | if( isset( $this->settings[ 'role\_' . esc\_attr( $role ) ] ) && intval( $this->settings[ 'role\_' . esc\_attr( $role ) ] ) === 2 ){ |
| [132](#L132) | $unrestricted = true; |
| [133](#L133) | break; |
| [134](#L134) | } |
| [135](#L135) | } |
| [136](#L136) |  |
| [137](#L137) | if( ! $unrestricted && ! $this->sanitize( $file['tmp\_name'] ) ){ |
| [138](#L138) | $file['error'] = \_\_( 'This SVG can not be sanitized!', 'wpsvg' ); |
| [139](#L139) | } |
| [140](#L140) | } |
| [141](#L141) | return $file; |
| [142](#L142) | } |
| [143](#L143) |  |
| [144](#L144) | function sanitize( $file ){ |
| [145](#L145) | $svg\_code = file\_get\_contents( $file ); |
| [146](#L146) | if( $is\_zipped = $this->is\_gzipped( $svg\_code ) ){ |
| [147](#L147) | $svg\_code = gzdecode( $svg\_code ); |
| [148](#L148) |  |
| [149](#L149) | if( $svg\_code === false ){ |
| [150](#L150) | return false; |
| [151](#L151) | } |
| [152](#L152) | } |
| [153](#L153) |  |
| [154](#L154) | $this->sanitizer->setAllowedTags( new WPSVG\_allowedTags() ); |
| [155](#L155) | $this->sanitizer->setAllowedAttrs( new WPSVG\_allowedAttrs() ); |
| [156](#L156) |  |
| [157](#L157) | $clean\_svg\_code = $this->sanitizer->sanitize( $svg\_code ); |
| [158](#L158) |  |
| [159](#L159) | if( $clean\_svg\_code === false ){ |
| [160](#L160) | return false; |
| [161](#L161) | } |
| [162](#L162) |  |
| [163](#L163) | if( $is\_zipped ){ |
| [164](#L164) | $clean\_svg\_code = gzencode( $clean\_svg\_code ); |
| [165](#L165) | } |
| [166](#L166) |  |
| [167](#L167) | file\_put\_contents( $file, $clean\_svg\_code ); |
| [168](#L168) |  |
| [169](#L169) | return true; |
| [170](#L170) | } |
| [171](#L171) |  |
| [172](#L172) | function is\_gzipped( $svg\_code ){ |
| [173](#L173) | if( function\_exists('mb\_strpos') ){ |
| [174](#L174) | return 0 === mb\_strpos( $svg\_code, "\x1f" . "\x8b" . "\x08" ); |
| [175](#L175) | }else{ |
| [176](#L176) | return 0 === strpos( $svg\_code, "\x1f" . "\x8b" . "\x08" ); |
| [177](#L177) | } |
| [178](#L178) | } |
| [179](#L179) |  |
| [180](#L180) | function plugins\_loaded(){ |
| [181](#L181) | load\_plugin\_textdomain( 'wpsvg', FALSE, basename( \_\_DIR\_\_ ) . '/languages/' ); |
| [182](#L182) | } |
| [183](#L183) |  |
| [184](#L184) | function plugin\_menu\_link(){ |
| [185](#L185) | $this->plugin\_admin\_page = add\_submenu\_page( |
| [186](#L186) | 'options-general.php', |
| [187](#L187) | \_\_( 'SVG images', 'wpsvg' ), |
| [188](#L188) | \_\_( 'SVG images', 'wpsvg' ), |
| [189](#L189) | 'manage\_options', |
| [190](#L190) | basename( \_\_FILE\_\_ ), |
| [191](#L191) | array( $this, 'admin\_options\_page' ) |
| [192](#L192) | ); |
| [193](#L193) | add\_filter( 'plugin\_action\_links\_' . plugin\_basename( \_\_FILE\_\_ ), array( $this, 'filter\_plugin\_actions' ), 10, 2 ); |
| [194](#L194) | } |
| [195](#L195) |  |
| [196](#L196) | function filter\_plugin\_actions( $links, $file ){ |
| [197](#L197) | array\_unshift( $links, '<a href="options-general.php?page=' . basename( \_\_FILE\_\_ ) . '">' . \_\_( 'Settings', 'wpsvg' ) . '</a>' ); |
| [198](#L198) | return $links; |
| [199](#L199) | } |
| [200](#L200) |  |
| [201](#L201) | function plugin\_init(){ |
| [202](#L202) | $this->settings = get\_option('wpsvg\_settings'); |
| [203](#L203) | } |
| [204](#L204) |  |
| [205](#L205) | function admin\_options\_page(){ |
| [206](#L206) | global $wp\_roles; |
| [207](#L207) |  |
| [208](#L208) | if( get\_current\_screen()->id != $this->plugin\_admin\_page ) return; |
| [209](#L209) |  |
| [210](#L210) | add\_user\_meta( get\_current\_user\_id(), 'wpsvg\_notice\_dismissed', 1, true ); |
| [211](#L211) |  |
| [212](#L212) | $show\_update\_notice = false; |
| [213](#L213) | if( isset( $\_POST['plugin\_sent'] ) ){ |
| [214](#L214) | if( check\_admin\_referer( 'save\_these\_settings', 'settings\_nonce' ) ){ |
| [215](#L215) | $this->settings = array(); |
| [216](#L216) | foreach( $\_POST as $key => $value ){ |
| [217](#L217) | if( substr( $key, 0, 5 ) == 'role\_' ){ |
| [218](#L218) | $this->settings[ sanitize\_text\_field( $key ) ] = intval( $value ); |
| [219](#L219) | } |
| [220](#L220) | } |
| [221](#L221) | update\_option( 'wpsvg\_settings', $this->settings ); |
| [222](#L222) | $show\_update\_notice = true; |
| [223](#L223) | } |
| [224](#L224) | } ?> |
| [225](#L225) | <div class="wrap"> |
| [226](#L226) | <h2><?php \_e( 'SVG images', 'wpsvg' ) ?></h2> |
| [227](#L227) |  |
| [228](#L228) | <?php if( $show\_update\_notice ) echo '<div class="below-h2 updated"><p>' . \_\_( 'Settings saved.', 'wpsvg' ) . '</p></div>'; ?> |
| [229](#L229) |  |
| [230](#L230) | <div class="postbox" style="margin-top:10px"> |
| [231](#L231) | <div class="inside" style="padding-bottom:2px"> |
| [232](#L232) | <h3><?php esc\_html\_e( 'Security notice', 'wpsvg' ) ?></h3> |
| [233](#L233) | <p><?php printf( esc\_html\_\_( 'Every SVG image is an XML file, which can contain %1$smalicious code%2$s, that can lead to %1$sXSS or Injection attacks%2$s.%3$sBelow you can decide which user roles (with upload capability) will be able to upload SVG images and also if their uploads will be sanitized.', 'wpsvg' ), '<strong>', '</strong>', '<br>' ) ?></p> |
| [234](#L234) | <p><?php printf( esc\_html\_\_( 'Sometimes you may need to upload some special SVG that includes your JavaScript code or other elements that are normally removed during sanitization - in that case, you can temporarily %1$senable unrestricted SVG upload%2$s if you are sure about your SVG code. Otherwise, it is recommended to use only the %1$senable sanitized SVG upload%2$s option.','wpsvg' ), '<code>', '</code>' ) ?> <a href="https://shortpixel.com/knowledge-base/article/524-about-sanitizing-svgs" target="\_blank"><span class="dashicons dashicons-editor-help" style="text-decoration:none"></span><?php esc\_html\_e( 'Read more', 'wpsvg' ) ?></a></p> |
| [235](#L235) | <p class="notice notice-large notice-warning"><?php printf( esc\_html\_\_( 'You should %1$senable unrestricted SVG upload%2$s permanently only if you are absolutely sure that all users within this user role are responsible and experienced enough to detect malicious SVG code by themselves.', 'wpsvg' ), '<code>', '</code>' ) ?></p> |
| [236](#L236) | </div> |
| [237](#L237) | </div> |
| [238](#L238) |  |
| [239](#L239) | <div class="wpsvg-wrapper"> |
| [240](#L240) | <section style="flex-grow:1;padding:18px;border:1px solid #ccc"> |
| [241](#L241) | <form method="post" action="<?php echo admin\_url( 'options-general.php?page=' . basename( \_\_FILE\_\_ ) ) ?>"> |
| [242](#L242) | <input type="hidden" name="plugin\_sent" value="1"> |
| [243](#L243) | <?php wp\_nonce\_field( 'save\_these\_settings', 'settings\_nonce' ) ?> |
| [244](#L244) |  |
| [245](#L245) | <table class="form-table"><?php |
| [246](#L246) | $options = array( |
| [247](#L247) | 1 => esc\_html\_\_( 'enable sanitized SVG upload', 'wpsvg' ), |
| [248](#L248) | 2 => esc\_html\_\_( 'enable unrestricted SVG upload', 'wpsvg' ), |
| [249](#L249) | 0 => esc\_html\_\_( 'disable SVG upload', 'wpsvg' ), |
| [250](#L250) | ); |
| [251](#L251) | foreach( $wp\_roles->roles as $role\_slug => $role ){ |
| [252](#L252) | $role\_slug = esc\_attr( $role\_slug ); |
| [253](#L253) | if( isset( $role['capabilities'], $role['capabilities']['upload\_files'] ) && $role['capabilities']['upload\_files'] ){ ?> |
| [254](#L254) | <tr> |
| [255](#L255) | <th> |
| [256](#L256) | <label for="role\_<?php echo $role\_slug ?>"> |
| [257](#L257) | <?php echo $role['name'] ?> |
| [258](#L258) | </label> |
| [259](#L259) | </th> |
| [260](#L260) | <td> |
| [261](#L261) | <select name="role\_<?php echo $role\_slug ?>" id="role\_<?php echo $role\_slug ?>"><?php |
| [262](#L262) | foreach( $options as $value => $text ){ |
| [263](#L263) | $maybe\_selected = ''; |
| [264](#L264) | if( isset( $this->settings[ 'role\_' . $role\_slug ] ) ){ |
| [265](#L265) | if( intval( $this->settings[ 'role\_' . $role\_slug ] ) === $value ){ |
| [266](#L266) | $maybe\_selected = 'selected'; |
| [267](#L267) | } |
| [268](#L268) | }else{ |
| [269](#L269) | if( $value === 1 ){ |
| [270](#L270) | $maybe\_selected = 'selected'; |
| [271](#L271) | } |
| [272](#L272) | } ?> |
| [273](#L273) | <option value="<?php echo $value ?>" <?php echo $maybe\_selected ?>> |
| [274](#L274) | <?php echo $text ?> |
| [275](#L275) | </option><?php |
| [276](#L276) | } ?> |
| [277](#L277) | </select> |
| [278](#L278) | <a href="https://shortpixel.com/knowledge-base/article/524-about-sanitizing-svgs" target="\_blank" aria-label="<?php esc\_attr\_e( 'Read more', 'wpsvg' ) ?>"><span class="dashicons dashicons-editor-help" style="text-decoration:none"></span></a> |
| [279](#L279) | </td> |
| [280](#L280) | </tr><?php |
| [281](#L281) | } |
| [282](#L282) | } ?> |
| [283](#L283) | </table> |
| [284](#L284) |  |
| [285](#L285) | <p class="submit"><input type="submit" class="button button-primary button-large" value="<?php \_e( 'Save', 'wpsvg' ) ?>"></p> |
| [286](#L286) | </form> |
| [287](#L287) | </section> |
| [288](#L288) | <?php if( ! $this->spio\_installed || ! $this->spio\_active ) include\_once('upsell.php') ?> |
| [289](#L289) | </div> |
| [290](#L290) | </div><?php |
| [291](#L291) | } |
| [292](#L292) |  |
| [293](#L293) | function fix\_missing\_width\_height\_on\_image\_block( $block\_content, $block ){ |
| [294](#L294) | if( $block['blockName'] === 'core/image' ){ |
| [295](#L295) | if( strpos( $block\_content, 'width=' ) === false && strpos( $block\_content, 'height=' ) === false ){ |
| [296](#L296) | if( isset( $block['attrs'], $block['attrs']['id'] ) && get\_post\_mime\_type( $block['attrs']['id'] ) == 'image/svg+xml' ){ |
| [297](#L297) | $svg\_path = get\_attached\_file( $block['attrs']['id'] ); |
| [298](#L298) | $dimensions = $this->svg\_dimensions( $svg\_path ); |
| [299](#L299) | $block\_content = str\_replace( '<img ', '<img width="' . $dimensions->width . '" height="' . $dimensions->height . '" ', $block\_content ); |
| [300](#L300) | } |
| [301](#L301) | } |
| [302](#L302) | } |
| [303](#L303) | return $block\_content; |
| [304](#L304) | } |
| [305](#L305) |  |
| [306](#L306) | function fl\_module\_upload\_regex( $regex, $type, $ext, $file ){ |
| [307](#L307) | if( $ext == 'svg' || $ext == 'svgz' ){ |
| [308](#L308) | $regex['photo'] = str\_replace( '|png|', '|png|svgz?|', $regex['photo'] ); |
| [309](#L309) | } |
| [310](#L310) | return $regex; |
| [311](#L311) | } |
| [312](#L312) |  |
| [313](#L313) | function fix\_svg\_thumbnail\_size(){ |
| [314](#L314) | echo '<style>.attachment-info .thumbnail img[src$=".svg"],#postimagediv .inside img[src$=".svg"]{width:100%}</style>'; |
| [315](#L315) | } |
| [316](#L316) |  |
| [317](#L317) | function wp\_generate\_attachment\_metadata( $metadata, $attachment\_id ){ |
| [318](#L318) | if( get\_post\_mime\_type( $attachment\_id ) == 'image/svg+xml' ){ |
| [319](#L319) | $svg\_path = get\_attached\_file( $attachment\_id ); |
| [320](#L320) | $dimensions = $this->svg\_dimensions( $svg\_path ); |
| [321](#L321) | $metadata['width'] = $dimensions->width; |
| [322](#L322) | $metadata['height'] = $dimensions->height; |
| [323](#L323) | } |
| [324](#L324) | return $metadata; |
| [325](#L325) | } |
| [326](#L326) |  |
| [327](#L327) | function wp\_check\_filetype\_and\_ext( $filetype\_ext\_data, $file, $filename, $mimes ){ |
| [328](#L328) | $user = wp\_get\_current\_user(); |
| [329](#L329) | $roles = (array)$user->roles; |
| [330](#L330) | foreach( $roles as $role ){ |
| [331](#L331) | if( isset( $this->settings[ 'role\_' . esc\_attr( $role ) ] ) && intval( $this->settings[ 'role\_' . esc\_attr( $role ) ] ) ){ |
| [332](#L332) | if( substr( $filename, -4 ) == '.svg' ){ |
| [333](#L333) | $filetype\_ext\_data['ext'] = 'svg'; |
| [334](#L334) | $filetype\_ext\_data['type'] = 'image/svg+xml'; |
| [335](#L335) | }elseif( substr( $filename, -5 ) == '.svgz' ){ |
| [336](#L336) | $filetype\_ext\_data['ext'] = 'svgz'; |
| [337](#L337) | $filetype\_ext\_data['type'] = 'image/svg+xml'; |
| [338](#L338) | } |
| [339](#L339) | break; |
| [340](#L340) | } |
| [341](#L341) | } |
| [342](#L342) | return $filetype\_ext\_data; |
| [343](#L343) | } |
| [344](#L344) |  |
| [345](#L345) | public function add\_svg\_support(){ |
| [346](#L346) | if( is\_admin() && get\_option('WPSVGActivated') ){ |
| [347](#L347) | delete\_option( 'WPSVGActivated' ); |
| [348](#L348) | wp\_redirect( admin\_url( 'options-general.php?page=' . basename( \_\_FILE\_\_ ) ) ); |
| [349](#L349) | } |
| [350](#L350) |  |
| [351](#L351) | function svg\_thumbs( $content ){ |
| [352](#L352) | return apply\_filters( 'final\_output', $content ); |
| [353](#L353) | } |
| [354](#L354) |  |
| [355](#L355) | ob\_start( 'svg\_thumbs' ); |
| [356](#L356) |  |
| [357](#L357) | add\_filter( 'final\_output', array( $this, 'final\_output' ) ); |
| [358](#L358) | add\_filter( 'wp\_prepare\_attachment\_for\_js', array( $this, 'wp\_prepare\_attachment\_for\_js' ), 10, 3 ); |
| [359](#L359) | } |
| [360](#L360) |  |
| [361](#L361) | function final\_output( $content ){ |
| [362](#L362) | $content = str\_replace( |
| [363](#L363) | '<# } else if ( \'image\' === data.type && data.sizes && data.sizes.full ) { #>', |
| [364](#L364) | '<# } else if ( \'svg+xml\' === data.subtype ) { #> |
| [365](#L365) | <img class="details-image" src="{{ data.url }}" draggable="false" /> |
| [366](#L366) | <# } else if ( \'image\' === data.type && data.sizes && data.sizes.full ) { #>', |
| [367](#L367) | $content |
| [368](#L368) | ); |
| [369](#L369) |  |
| [370](#L370) | $content = str\_replace( |
| [371](#L371) | '<# } else if ( \'image\' === data.type && data.sizes ) { #>', |
| [372](#L372) | '<# } else if ( \'svg+xml\' === data.subtype ) { #> |
| [373](#L373) | <div class="centered"> |
| [374](#L374) | <img src="{{ data.url }}" class="thumbnail" draggable="false" /> |
| [375](#L375) | </div> |
| [376](#L376) | <# } else if ( \'image\' === data.type && data.sizes ) { #>', |
| [377](#L377) | $content |
| [378](#L378) | ); |
| [379](#L379) |  |
| [380](#L380) | return $content; |
| [381](#L381) | } |
| [382](#L382) |  |
| [383](#L383) | public function add\_svg\_mime( $mimes = array() ){ |
| [384](#L384) | $user = wp\_get\_current\_user(); |
| [385](#L385) | $roles = (array)$user->roles; |
| [386](#L386) | foreach( $roles as $role ){ |
| [387](#L387) | if( isset( $this->settings[ 'role\_' . esc\_attr( $role ) ] ) && intval( $this->settings[ 'role\_' . esc\_attr( $role ) ] ) ){ |
| [388](#L388) | $mimes['svg'] = 'image/svg+xml'; |
| [389](#L389) | $mimes['svgz'] = 'image/svg+xml'; |
| [390](#L390) | break; |
| [391](#L391) | } |
| [392](#L392) | } |
| [393](#L393) | return $mimes; |
| [394](#L394) | } |
| [395](#L395) |  |
| [396](#L396) | function wp\_prepare\_attachment\_for\_js( $response, $attachment, $meta ){ |
| [397](#L397) | if( $response['mime'] == 'image/svg+xml' && empty( $response['sizes'] ) ){ |
| [398](#L398) | $svg\_path = get\_attached\_file( $attachment->ID ); |
| [399](#L399) | if( ! file\_exists( $svg\_path ) ){ |
| [400](#L400) | $svg\_path = $response['url']; |
| [401](#L401) | } |
| [402](#L402) | $dimensions = $this->svg\_dimensions( $svg\_path ); |
| [403](#L403) | $response['sizes'] = array( |
| [404](#L404) | 'full' => array( |
| [405](#L405) | 'url' => $response['url'], |
| [406](#L406) | 'width' => $dimensions->width, |
| [407](#L407) | 'height' => $dimensions->height, |
| [408](#L408) | 'orientation' => $dimensions->width > $dimensions->height ? 'landscape' : 'portrait' |
| [409](#L409) | ) |
| [410](#L410) | ); |
| [411](#L411) | } |
| [412](#L412) | return $response; |
| [413](#L413) | } |
| [414](#L414) |  |
| [415](#L415) | function svg\_dimensions( $svg ){ |
| [416](#L416) | $svg = simplexml\_load\_file( $svg ); |
| [417](#L417) | $width = 0; |
| [418](#L418) | $height = 0; |
| [419](#L419) | if( $svg ){ |
| [420](#L420) | $attributes = $svg->attributes(); |
| [421](#L421) | if( isset( $attributes->width, $attributes->height ) ){ |
| [422](#L422) | if( substr( trim( $attributes->width ), -1 ) != '%' ){ |
| [423](#L423) | $width = floatval( $attributes->width ); |
| [424](#L424) | } |
| [425](#L425) | if( substr( trim( $attributes->height ), -1 ) != '%' ){ |
| [426](#L426) | $height = floatval( $attributes->height ); |
| [427](#L427) | } |
| [428](#L428) | } |
| [429](#L429) | if( ( ! $width || ! $height ) && isset( $attributes->viewBox ) ){ |
| [430](#L430) | $sizes = explode( ' ', $attributes->viewBox ); |
| [431](#L431) | if( isset( $sizes[2], $sizes[3] ) ){ |
| [432](#L432) | $width = floatval( $sizes[2] ); |
| [433](#L433) | $height = floatval( $sizes[3] ); |
| [434](#L434) | } |
| [435](#L435) | } |
| [436](#L436) | } |
| [437](#L437) | return (object)array( 'width' => $width, 'height' => $height ); |
| [438](#L438) | } |
| [439](#L439) | } |
| [440](#L440) |  |
| [441](#L441) | register\_activation\_hook( \_\_FILE\_\_, function(){ |
| [442](#L442) | add\_option( 'WPSVGActivated', 1 ); |
| [443](#L443) | }); |
| [444](#L444) |  |
| [445](#L445) | new WPSVG(); |
| [446](#L446) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wp-svg-images/trunk/wp-svg-images.php?format=txt)
* [Original Format](/export/3220367/wp-svg-images/trunk/wp-svg-images.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_1bc60b15_20250110_175708.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwp-svg-images%2Ftrunk%2Fwp-svg-images.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wp-svg-images/trunk/wp-svg-images.php?rev=2894818 "Revision 2894818")
* Next Revision →
* [Blame](/browser/wp-svg-images/trunk/wp-svg-images.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wp-svg-images/trunk/wp-svg-images.php)

---

# [source:](/browser?order=name "Go to repository root") [wp-svg-images](/browser/wp-svg-images?order=name "View wp-svg-images")/[trunk](/browser/wp-svg-images/trunk?order=name "View trunk")/[wp-svg-images.php](/browser/wp-svg-images/trunk/wp-svg-images.php?order=name "View wp-svg-images.php")

View diff against:

View revision:

| [Last change](/changeset/3105276/wp-svg-images/trunk/wp-svg-images.php "View differences") on this file was [3105276](/changeset/3105276/ "View changeset 3105276"), checked in by petredobrescu, [7 months ago](/timeline?from=2024-06-20T17%3A25%3A17Z&precision=second "See timeline at 06/20/2024 05:25:17 PM") |
| --- |
| Version 4.3   * Fix: Patched a Stored Cross-Site Scripting vulnerability found by Colin Xu and responsibly disclosed by the WordFence team; * Compat: Added compatibity with WP All Import plugin; * Compat: Tested with the latest versions of [WordPress](/wiki/WordPress) (6.6) and PHP (8.3). |
| **File size:** 17.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | Plugin Name:            WP SVG Images |
| [4](#L4) | Plugin URI:             https://shortpixel.com/ |
| [5](#L5) | Description:            Full SVG Media support in WordPress |
| [6](#L6) | Version:                4.3 |
| [7](#L7) | Author:                 ShortPixel |
| [8](#L8) | Author URI:             https://shortpixel.com/ |
| [9](#L9) | GitHub Plugin URI:      https://github.com/short-pixel-optimizer/wp-svg-images |
| [10](#L10) | Primary Branch:         main |
| [11](#L11) | Text Domain:            wpsvg |
| [12](#L12) | Domain Path:            /languages |
| [13](#L13) | \*/ |
| [14](#L14) |  |
| [15](#L15) | defined( 'ABSPATH' ) || exit; |
| [16](#L16) |  |
| [17](#L17) | if( ! class\_exists('enshrined\svgSanitize\Sanitizer') ){ |
| [18](#L18) | require\_once( 'svg-sanitizer/data/AttributeInterface.php' ); |
| [19](#L19) | require\_once( 'svg-sanitizer/data/TagInterface.php' ); |
| [20](#L20) | require\_once( 'svg-sanitizer/data/AllowedAttributes.php' ); |
| [21](#L21) | require\_once( 'svg-sanitizer/data/AllowedTags.php' ); |
| [22](#L22) | require\_once( 'svg-sanitizer/data/XPath.php' ); |
| [23](#L23) | require\_once( 'svg-sanitizer/ElementReference/Resolver.php' ); |
| [24](#L24) | require\_once( 'svg-sanitizer/ElementReference/Subject.php' ); |
| [25](#L25) | require\_once( 'svg-sanitizer/ElementReference/Usage.php' ); |
| [26](#L26) | require\_once( 'svg-sanitizer/Exceptions/NestingException.php' ); |
| [27](#L27) | require\_once( 'svg-sanitizer/Helper.php' ); |
| [28](#L28) | require\_once( 'svg-sanitizer/Sanitizer.php' ); |
| [29](#L29) | } |
| [30](#L30) |  |
| [31](#L31) | class WPSVG\_allowedTags extends \enshrined\svgSanitize\data\AllowedTags{ |
| [32](#L32) | public static function getTags(){ |
| [33](#L33) | return apply\_filters( 'WPSVG\_setAllowedTags', parent::getTags() ); |
| [34](#L34) | } |
| [35](#L35) | } |
| [36](#L36) |  |
| [37](#L37) | class WPSVG\_allowedAttrs extends \enshrined\svgSanitize\data\AllowedAttributes{ |
| [38](#L38) | public static function getAttributes(){ |
| [39](#L39) | return apply\_filters( 'WPSVG\_setAllowedAttrs', parent::getAttributes() ); |
| [40](#L40) | } |
| [41](#L41) | } |
| [42](#L42) |  |
| [43](#L43) | if( ! class\_exists('WPSVG') ){ |
| [44](#L44) | class WPSVG{ |
| [45](#L45) | var $plugin\_admin\_page; |
| [46](#L46) | var $settings; |
| [47](#L47) | var $sanitizer; |
| [48](#L48) | var $spio\_installed = false; |
| [49](#L49) | var $spio\_active = false; |
| [50](#L50) |  |
| [51](#L51) | function \_\_construct(){ |
| [52](#L52) | $this->sanitizer = new enshrined\svgSanitize\Sanitizer(); |
| [53](#L53) | $this->sanitizer->removeXMLTag( true ); |
| [54](#L54) | $this->sanitizer->minify( true ); |
| [55](#L55) |  |
| [56](#L56) | add\_filter( 'wp\_handle\_upload\_prefilter', array( $this, 'wp\_handle\_upload\_prefilter' ) ); |
| [57](#L57) |  |
| [58](#L58) | add\_action( 'plugins\_loaded', array( $this, 'plugins\_loaded' ) ); |
| [59](#L59) | add\_action( 'admin\_menu', array( $this, 'plugin\_menu\_link' ) ); |
| [60](#L60) | add\_action( 'init', array( $this, 'plugin\_init' ) ); |
| [61](#L61) |  |
| [62](#L62) | add\_action( 'admin\_init', array( $this, 'add\_svg\_support' ) ); |
| [63](#L63) | add\_action( 'admin\_footer', array( $this, 'fix\_svg\_thumbnail\_size' ) ); |
| [64](#L64) | add\_filter( 'upload\_mimes', array( $this, 'add\_svg\_mime' ) ); |
| [65](#L65) | add\_filter( 'wp\_check\_filetype\_and\_ext', array( $this, 'wp\_check\_filetype\_and\_ext' ), 100, 4 ); |
| [66](#L66) | add\_filter( 'wp\_generate\_attachment\_metadata', array( $this, 'wp\_generate\_attachment\_metadata' ), 10, 2 ); |
| [67](#L67) | add\_filter( 'fl\_module\_upload\_regex', array( $this, 'fl\_module\_upload\_regex' ), 10, 4 ); |
| [68](#L68) | add\_filter( 'render\_block', array( $this, 'fix\_missing\_width\_height\_on\_image\_block' ), 10, 2 ); |
| [69](#L69) |  |
| [70](#L70) | add\_action( 'admin\_notices', array( $this, 'admin\_notices' ) ); |
| [71](#L71) | add\_action( 'wp\_ajax\_wpsvg\_notice\_dismissed', array( $this, 'wpsvg\_notice\_dismissed' ) ); |
| [72](#L72) |  |
| [73](#L73) | add\_action( 'admin\_init', array( $this, 'upsell' ) ); |
| [74](#L74) | add\_filter( 'wp\_all\_import\_image\_mime\_type', array( $this, 'wp\_all\_import\_svgs' ), 10, 2 ); |
| [75](#L75) | } |
| [76](#L76) |  |
| [77](#L77) | function wp\_all\_import\_svgs( $mime\_type, $image\_filepath ){ |
| [78](#L78) | if( empty( $mime\_type ) && ( substr( $image\_filepath, -4 ) == '.svg' || substr( $image\_filepath, -5 ) == '.svgz' ) ){ |
| [79](#L79) | return 'image/svg+xml'; |
| [80](#L80) | } |
| [81](#L81) | return $mime\_type; |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | function upsell(){ |
| [85](#L85) | $plugins = get\_plugins(); |
| [86](#L86) | $this->spio\_installed = isset( $plugins['shortpixel-image-optimiser/wp-shortpixel.php'] ); |
| [87](#L87) | $this->spio\_active = is\_plugin\_active('shortpixel-image-optimiser/wp-shortpixel.php'); |
| [88](#L88) |  |
| [89](#L89) | if( ! $this->spio\_installed || ! $this->spio\_active ){ |
| [90](#L90) | wp\_enqueue\_style( 'spio-upsell', plugins\_url( '/assets/css/spio-upsell.css', \_\_FILE\_\_ ) ); |
| [91](#L91) | wp\_enqueue\_script( 'spio-upsell', plugins\_url( '/assets/js/spio-upsell.js', \_\_FILE\_\_ ), array('jquery') ); |
| [92](#L92) | } |
| [93](#L93) | } |
| [94](#L94) |  |
| [95](#L95) | function wpsvg\_notice\_dismissed(){ |
| [96](#L96) | if( defined('DOING\_AJAX') && DOING\_AJAX && check\_ajax\_referer('wpsvg\_notice\_dismissed') ){ |
| [97](#L97) | add\_user\_meta( get\_current\_user\_id(), 'wpsvg\_notice\_dismissed', 1, true ); |
| [98](#L98) | } |
| [99](#L99) | } |
| [100](#L100) |  |
| [101](#L101) | function admin\_notices(){ |
| [102](#L102) | if( ! get\_user\_meta( get\_current\_user\_id(), 'wpsvg\_notice\_dismissed' ) ){ |
| [103](#L103) | if( function\_exists('get\_current\_screen') && isset( get\_current\_screen()->id ) && in\_array( get\_current\_screen()->id, array( 'plugins', 'plugin-install', 'upload', 'attachment' ) ) ){ ?> |
| [104](#L104) | <div class="wpsvg-notice notice notice-success is-dismissible"> |
| [105](#L105) | <p><?php printf( esc\_html\_\_( 'Hey, WP SVG images has some new settings! Activate SVG sanitization and manage permissions by going to the new %s', 'wpsvg' ), '<a href="' . admin\_url('options-general.php?page=wp-svg-images.php') . '">' . esc\_html\_\_( 'Settings page', 'wpsvg' ) . '</a>' ) ?></p> |
| [106](#L106) | <p><small style="opacity:.9"><?php printf( esc\_html\_\_( 'WP SVG images in now a part of the %s family.', 'wpsvg' ), '<a href="https://shortpixel.com/api-tools" target="\_blank">ShortPixel</a>' ) ?></small></p> |
| [107](#L107) | <p><a href="<?php echo admin\_url('options-general.php?page=wp-svg-images.php') ?>" class="button button-primary"><?php esc\_html\_e( 'Go to Settings', 'wpsvg' ) ?></a></p> |
| [108](#L108) | </div> |
| [109](#L109) | <script> |
| [110](#L110) | jQuery(document).ready(function($){ |
| [111](#L111) | $(document).on('click', '.wpsvg-notice .notice-dismiss', function(){ |
| [112](#L112) | $.post( ajaxurl, { action: 'wpsvg\_notice\_dismissed', \_wpnonce: '<?php echo wp\_create\_nonce('wpsvg\_notice\_dismissed') ?>' }); |
| [113](#L113) | }); |
| [114](#L114) | }); |
| [115](#L115) | </script><?php |
| [116](#L116) | } |
| [117](#L117) | } |
| [118](#L118) | } |
| [119](#L119) |  |
| [120](#L120) | function wp\_handle\_upload\_prefilter( $file ){ |
| [121](#L121) |  |
| [122](#L122) | // Security:  form data can be faked, including the filetype. Check tmpfile. |
| [123](#L123) | $file\_type = mime\_content\_type($file['tmp\_name']); |
| [124](#L124) |  |
| [125](#L125) | if( $file\_type == 'image/svg+xml' ) |
| [126](#L126) | { |
| [127](#L127) | $user = wp\_get\_current\_user(); |
| [128](#L128) | $roles = (array)$user->roles; |
| [129](#L129) | $unrestricted = false; |
| [130](#L130) | foreach( $roles as $role ){ |
| [131](#L131) | if( isset( $this->settings[ 'role\_' . esc\_attr( $role ) ] ) && intval( $this->settings[ 'role\_' . esc\_attr( $role ) ] ) === 2 ){ |
| [132](#L132) | $unrestricted = true; |
| [133](#L133) | break; |
| [134](#L134) | } |
| [135](#L135) | } |
| [136](#L136) |  |
| [137](#L137) | if( ! $unrestricted && ! $this->sanitize( $file['tmp\_name'] ) ){ |
| [138](#L138) | $file['error'] = \_\_( 'This SVG can not be sanitized!', 'wpsvg' ); |
| [139](#L139) | } |
| [140](#L140) | } |
| [141](#L141) | return $file; |
| [142](#L142) | } |
| [143](#L143) |  |
| [144](#L144) | function sanitize( $file ){ |
| [145](#L145) | $svg\_code = file\_get\_contents( $file ); |
| [146](#L146) | if( $is\_zipped = $this->is\_gzipped( $svg\_code ) ){ |
| [147](#L147) | $svg\_code = gzdecode( $svg\_code ); |
| [148](#L148) |  |
| [149](#L149) | if( $svg\_code === false ){ |
| [150](#L150) | return false; |
| [151](#L151) | } |
| [152](#L152) | } |
| [153](#L153) |  |
| [154](#L154) | $this->sanitizer->setAllowedTags( new WPSVG\_allowedTags() ); |
| [155](#L155) | $this->sanitizer->setAllowedAttrs( new WPSVG\_allowedAttrs() ); |
| [156](#L156) |  |
| [157](#L157) | $clean\_svg\_code = $this->sanitizer->sanitize( $svg\_code ); |
| [158](#L158) |  |
| [159](#L159) | if( $clean\_svg\_code === false ){ |
| [160](#L160) | return false; |
| [161](#L161) | } |
| [162](#L162) |  |
| [163](#L163) | if( $is\_zipped ){ |
| [164](#L164) | $clean\_svg\_code = gzencode( $clean\_svg\_code ); |
| [165](#L165) | } |
| [166](#L166) |  |
| [167](#L167) | file\_put\_contents( $file, $clean\_svg\_code ); |
| [168](#L168) |  |
| [169](#L169) | return true; |
| [170](#L170) | } |
| [171](#L171) |  |
| [172](#L172) | function is\_gzipped( $svg\_code ){ |
| [173](#L173) | if( function\_exists('mb\_strpos') ){ |
| [174](#L174) | return 0 === mb\_strpos( $svg\_code, "\x1f" . "\x8b" . "\x08" ); |
| [175](#L175) | }else{ |
| [176](#L176) | return 0 === strpos( $svg\_code, "\x1f" . "\x8b" . "\x08" ); |
| [177](#L177) | } |
| [178](#L178) | } |
| [179](#L179) |  |
| [180](#L180) | function plugins\_loaded(){ |
| [181](#L181) | load\_plugin\_textdomain( 'wpsvg', FALSE, basename( \_\_DIR\_\_ ) . '/languages/' ); |
| [182](#L182) | } |
| [183](#L183) |  |
| [184](#L184) | function plugin\_menu\_link(){ |
| [185](#L185) | $this->plugin\_admin\_page = add\_submenu\_page( |
| [186](#L186) | 'options-general.php', |
| [187](#L187) | \_\_( 'SVG images', 'wpsvg' ), |
| [188](#L188) | \_\_( 'SVG images', 'wpsvg' ), |
| [189](#L189) | 'manage\_options', |
| [190](#L190) | basename( \_\_FILE\_\_ ), |
| [191](#L191) | array( $this, 'admin\_options\_page' ) |
| [192](#L192) | ); |
| [193](#L193) | add\_filter( 'plugin\_action\_links\_' . plugin\_basename( \_\_FILE\_\_ ), array( $this, 'filter\_plugin\_actions' ), 10, 2 ); |
| [194](#L194) | } |
| [195](#L195) |  |
| [196](#L196) | function filter\_plugin\_actions( $links, $file ){ |
| [197](#L197) | array\_unshift( $links, '<a href="options-general.php?page=' . basename( \_\_FILE\_\_ ) . '">' . \_\_( 'Settings', 'wpsvg' ) . '</a>' ); |
| [198](#L198) | return $links; |
| [199](#L199) | } |
| [200](#L200) |  |
| [201](#L201) | function plugin\_init(){ |
| [202](#L202) | $this->settings = get\_option('wpsvg\_settings'); |
| [203](#L203) | } |
| [204](#L204) |  |
| [205](#L205) | function admin\_options\_page(){ |
| [206](#L206) | global $wp\_roles; |
| [207](#L207) |  |
| [208](#L208) | if( get\_current\_screen()->id != $this->plugin\_admin\_page ) return; |
| [209](#L209) |  |
| [210](#L210) | add\_user\_meta( get\_current\_user\_id(), 'wpsvg\_notice\_dismissed', 1, true ); |
| [211](#L211) |  |
| [212](#L212) | $show\_update\_notice = false; |
| [213](#L213) | if( isset( $\_POST['plugin\_sent'] ) ){ |
| [214](#L214) | if( check\_admin\_referer( 'save\_these\_settings', 'settings\_nonce' ) ){ |
| [215](#L215) | $this->settings = array(); |
| [216](#L216) | foreach( $\_POST as $key => $value ){ |
| [217](#L217) | if( substr( $key, 0, 5 ) == 'role\_' ){ |
| [218](#L218) | $this->settings[ sanitize\_text\_field( $key ) ] = intval( $value ); |
| [219](#L219) | } |
| [220](#L220) | } |
| [221](#L221) | update\_option( 'wpsvg\_settings', $this->settings ); |
| [222](#L222) | $show\_update\_notice = true; |
| [223](#L223) | } |
| [224](#L224) | } ?> |
| [225](#L225) | <div class="wrap"> |
| [226](#L226) | <h2><?php \_e( 'SVG images', 'wpsvg' ) ?></h2> |
| [227](#L227) |  |
| [228](#L228) | <?php if( $show\_update\_notice ) echo '<div class="below-h2 updated"><p>' . \_\_( 'Settings saved.', 'wpsvg' ) . '</p></div>'; ?> |
| [229](#L229) |  |
| [230](#L230) | <div class="postbox" style="margin-top:10px"> |
| [231](#L231) | <div class="inside" style="padding-bottom:2px"> |
| [232](#L232) | <h3><?php esc\_html\_e( 'Security notice', 'wpsvg' ) ?></h3> |
| [233](#L233) | <p><?php printf( esc\_html\_\_( 'Every SVG image is an XML file, which can contain %1$smalicious code%2$s, that can lead to %1$sXSS or Injection attacks%2$s.%3$sBelow you can decide which user roles (with upload capability) will be able to upload SVG images and also if their uploads will be sanitized.', 'wpsvg' ), '<strong>', '</strong>', '<br>' ) ?></p> |
| [234](#L234) | <p><?php printf( esc\_html\_\_( 'Sometimes you may need to upload some special SVG that includes your JavaScript code or other elements that are normally removed during sanitization - in that case, you can temporarily %1$senable unrestricted SVG upload%2$s if you are sure about your SVG code. Otherwise, it is recommended to use only the %1$senable sanitized SVG upload%2$s option.','wpsvg' ), '<code>', '</code>' ) ?> <a href="https://shortpixel.com/knowledge-base/article/524-about-sanitizing-svgs" target="\_blank"><span class="dashicons dashicons-editor-help" style="text-decoration:none"></span><?php esc\_html\_e( 'Read more', 'wpsvg' ) ?></a></p> |
| [235](#L235) | <p class="notice notice-large notice-warning"><?php printf( esc\_html\_\_( 'You should %1$senable unrestricted SVG upload%2$s permanently only if you are absolutely sure that all users within this user role are responsible and experienced enough to detect malicious SVG code by themselves.', 'wpsvg' ), '<code>', '</code>' ) ?></p> |
| [236](#L236) | </div> |
| [237](#L237) | </div> |
| [238](#L238) |  |
| [239](#L239) | <div class="wpsvg-wrapper"> |
| [240](#L240) | <section style="flex-grow:1;padding:18px;border:1px solid #ccc"> |
| [241](#L241) | <form method="post" action="<?php echo admin\_url( 'options-general.php?page=' . basename( \_\_FILE\_\_ ) ) ?>"> |
| [242](#L242) | <input type="hidden" name="plugin\_sent" value="1"> |
| [243](#L243) | <?php wp\_nonce\_field( 'save\_these\_settings', 'settings\_nonce' ) ?> |
| [244](#L244) |  |
| [245](#L245) | <table class="form-table"><?php |
| [246](#L246) | $options = array( |
| [247](#L247) | 1 => esc\_html\_\_( 'enable sanitized SVG upload', 'wpsvg' ), |
| [248](#L248) | 2 => esc\_html\_\_( 'enable unrestricted SVG upload', 'wpsvg' ), |
| [249](#L249) | 0 => esc\_html\_\_( 'disable SVG upload', 'wpsvg' ), |
| [250](#L250) | ); |
| [251](#L251) | foreach( $wp\_roles->roles as $role\_slug => $role ){ |
| [252](#L252) | $role\_slug = esc\_attr( $role\_slug ); |
| [253](#L253) | if( isset( $role['capabilities'], $role['capabilities']['upload\_files'] ) && $role['capabilities']['upload\_files'] ){ ?> |
| [254](#L254) | <tr> |
| [255](#L255) | <th> |
| [256](#L256) | <label for="role\_<?php echo $role\_slug ?>"> |
| [257](#L257) | <?php echo $role['name'] ?> |
| [258](#L258) | </label> |
| [259](#L259) | </th> |
| [260](#L260) | <td> |
| [261](#L261) | <select name="role\_<?php echo $role\_slug ?>" id="role\_<?php echo $role\_slug ?>"><?php |
| [262](#L262) | foreach( $options as $value => $text ){ |
| [263](#L263) | $maybe\_selected = ''; |
| [264](#L264) | if( isset( $this->settings[ 'role\_' . $role\_slug ] ) ){ |
| [265](#L265) | if( intval( $this->settings[ 'role\_' . $role\_slug ] ) === $value ){ |
| [266](#L266) | $maybe\_selected = 'selected'; |
| [267](#L267) | } |
| [268](#L268) | }else{ |
| [269](#L269) | if( $value === 1 ){ |
| [270](#L270) | $maybe\_selected = 'selected'; |
| [271](#L271) | } |
| [272](#L272) | } ?> |
| [273](#L273) | <option value="<?php echo $value ?>" <?php echo $maybe\_selected ?>> |
| [274](#L274) | <?php echo $text ?> |
| [275](#L275) | </option><?php |
| [276](#L276) | } ?> |
| [277](#L277) | </select> |
| [278](#L278) | <a href="https://shortpixel.com/knowledge-base/article/524-about-sanitizing-svgs" target="\_blank" aria-label="<?php esc\_attr\_e( 'Read more', 'wpsvg' ) ?>"><span class="dashicons dashicons-editor-help" style="text-decoration:none"></span></a> |
| [279](#L279) | </td> |
| [280](#L280) | </tr><?php |
| [281](#L281) | } |
| [282](#L282) | } ?> |
| [283](#L283) | </table> |
| [284](#L284) |  |
| [285](#L285) | <p class="submit"><input type="submit" class="button button-primary button-large" value="<?php \_e( 'Save', 'wpsvg' ) ?>"></p> |
| [286](#L286) | </form> |
| [287](#L287) | </section> |
| [288](#L288) | <?php if( ! $this->spio\_installed || ! $this->spio\_active ) include\_once('upsell.php') ?> |
| [289](#L289) | </div> |
| [290](#L290) | </div><?php |
| [291](#L291) | } |
| [292](#L292) |  |
| [293](#L293) | function fix\_missing\_width\_height\_on\_image\_block( $block\_content, $block ){ |
| [294](#L294) | if( $block['blockName'] === 'core/image' ){ |
| [295](#L295) | if( strpos( $block\_content, 'width=' ) === false && strpos( $block\_content, 'height=' ) === false ){ |
| [296](#L296) | if( isset( $block['attrs'], $block['attrs']['id'] ) && get\_post\_mime\_type( $block['attrs']['id'] ) == 'image/svg+xml' ){ |
| [297](#L297) | $svg\_path = get\_attached\_file( $block['attrs']['id'] ); |
| [298](#L298) | $dimensions = $this->svg\_dimensions( $svg\_path ); |
| [299](#L299) | $block\_content = str\_replace( '<img ', '<img width="' . $dimensions->width . '" height="' . $dimensions->height . '" ', $block\_content ); |
| [300](#L300) | } |
| [301](#L301) | } |
| [302](#L302) | } |
| [303](#L303) | return $block\_content; |
| [304](#L304) | } |
| [305](#L305) |  |
| [306](#L306) | function fl\_module\_upload\_regex( $regex, $type, $ext, $file ){ |
| [307](#L307) | if( $ext == 'svg' || $ext == 'svgz' ){ |
| [308](#L308) | $regex['photo'] = str\_replace( '|png|', '|png|svgz?|', $regex['photo'] ); |
| [309](#L309) | } |
| [310](#L310) | return $regex; |
| [311](#L311) | } |
| [312](#L312) |  |
| [313](#L313) | function fix\_svg\_thumbnail\_size(){ |
| [314](#L314) | echo '<style>.attachment-info .thumbnail img[src$=".svg"],#postimagediv .inside img[src$=".svg"]{width:100%}</style>'; |
| [315](#L315) | } |
| [316](#L316) |  |
| [317](#L317) | function wp\_generate\_attachment\_metadata( $metadata, $attachment\_id ){ |
| [318](#L318) | if( get\_post\_mime\_type( $attachment\_id ) == 'image/svg+xml' ){ |
| [319](#L319) | $svg\_path = get\_attached\_file( $attachment\_id ); |
| [320](#L320) | $dimensions = $this->svg\_dimensions( $svg\_path ); |
| [321](#L321) | $metadata['width'] = $dimensions->width; |
| [322](#L322) | $metadata['height'] = $dimensions->height; |
| [323](#L323) | } |
| [324](#L324) | return $metadata; |
| [325](#L325) | } |
| [326](#L326) |  |
| [327](#L327) | function wp\_check\_filetype\_and\_ext( $filetype\_ext\_data, $file, $filename, $mimes ){ |
| [328](#L328) | $user = wp\_get\_current\_user(); |
| [329](#L329) | $roles = (array)$user->roles; |
| [330](#L330) | foreach( $roles as $role ){ |
| [331](#L331) | if( isset( $this->settings[ 'role\_' . esc\_attr( $role ) ] ) && intval( $this->settings[ 'role\_' . esc\_attr( $role ) ] ) ){ |
| [332](#L332) | if( substr( $filename, -4 ) == '.svg' ){ |
| [333](#L333) | $filetype\_ext\_data['ext'] = 'svg'; |
| [334](#L334) | $filetype\_ext\_data['type'] = 'image/svg+xml'; |
| [335](#L335) | }elseif( substr( $filename, -5 ) == '.svgz' ){ |
| [336](#L336) | $filetype\_ext\_data['ext'] = 'svgz'; |
| [337](#L337) | $filetype\_ext\_data['type'] = 'image/svg+xml'; |
| [338](#L338) | } |
| [339](#L339) | break; |
| [340](#L340) | } |
| [341](#L341) | } |
| [342](#L342) | return $filetype\_ext\_data; |
| [343](#L343) | } |
| [344](#L344) |  |
| [345](#L345) | public function add\_svg\_support(){ |
| [346](#L346) | if( is\_admin() && get\_option('WPSVGActivated') ){ |
| [347](#L347) | delete\_option( 'WPSVGActivated' ); |
| [348](#L348) | wp\_redirect( admin\_url( 'options-general.php?page=' . basename( \_\_FILE\_\_ ) ) ); |
| [349](#L349) | } |
| [350](#L350) |  |
| [351](#L351) | function svg\_thumbs( $content ){ |
| [352](#L352) | return apply\_filters( 'final\_output', $content ); |
| [353](#L353) | } |
| [354](#L354) |  |
| [355](#L355) | ob\_start( 'svg\_thumbs' ); |
| [356](#L356) |  |
| [357](#L357) | add\_filter( 'final\_output', array( $this, 'final\_output' ) ); |
| [358](#L358) | add\_filter( 'wp\_prepare\_attachment\_for\_js', array( $this, 'wp\_prepare\_attachment\_for\_js' ), 10, 3 ); |
| [359](#L359) | } |
| [360](#L360) |  |
| [361](#L361) | function final\_output( $content ){ |
| [362](#L362) | $content = str\_replace( |
| [363](#L363) | '<# } else if ( \'image\' === data.type && data.sizes && data.sizes.full ) { #>', |
| [364](#L364) | '<# } else if ( \'svg+xml\' === data.subtype ) { #> |
| [365](#L365) | <img class="details-image" src="{{ data.url }}" draggable="false" /> |
| [366](#L366) | <# } else if ( \'image\' === data.type && data.sizes && data.sizes.full ) { #>', |
| [367](#L367) | $content |
| [368](#L368) | ); |
| [369](#L369) |  |
| [370](#L370) | $content = str\_replace( |
| [371](#L371) | '<# } else if ( \'image\' === data.type && data.sizes ) { #>', |
| [372](#L372) | '<# } else if ( \'svg+xml\' === data.subtype ) { #> |
| [373](#L373) | <div class="centered"> |
| [374](#L374) | <img src="{{ data.url }}" class="thumbnail" draggable="false" /> |
| [375](#L375) | </div> |
| [376](#L376) | <# } else if ( \'image\' === data.type && data.sizes ) { #>', |
| [377](#L377) | $content |
| [378](#L378) | ); |
| [379](#L379) |  |
| [380](#L380) | return $content; |
| [381](#L381) | } |
| [382](#L382) |  |
| [383](#L383) | public function add\_svg\_mime( $mimes = array() ){ |
| [384](#L384) | $user = wp\_get\_current\_user(); |
| [385](#L385) | $roles = (array)$user->roles; |
| [386](#L386) | foreach( $roles as $role ){ |
| [387](#L387) | if( isset( $this->settings[ 'role\_' . esc\_attr( $role ) ] ) && intval( $this->settings[ 'role\_' . esc\_attr( $role ) ] ) ){ |
| [388](#L388) | $mimes['svg'] = 'image/svg+xml'; |
| [389](#L389) | $mimes['svgz'] = 'image/svg+xml'; |
| [390](#L390) | break; |
| [391](#L391) | } |
| [392](#L392) | } |
| [393](#L393) | return $mimes; |
| [394](#L394) | } |
| [395](#L395) |  |
| [396](#L396) | function wp\_prepare\_attachment\_for\_js( $response, $attachment, $meta ){ |
| [397](#L397) | if( $response['mime'] == 'image/svg+xml' && empty( $response['sizes'] ) ){ |
| [398](#L398) | $svg\_path = get\_attached\_file( $attachment->ID ); |
| [399](#L399) | if( ! file\_exists( $svg\_path ) ){ |
| [400](#L400) | $svg\_path = $response['url']; |
| [401](#L401) | } |
| [402](#L402) | $dimensions = $this->svg\_dimensions( $svg\_path ); |
| [403](#L403) | $response['sizes'] = array( |
| [404](#L404) | 'full' => array( |
| [405](#L405) | 'url' => $response['url'], |
| [406](#L406) | 'width' => $dimensions->width, |
| [407](#L407) | 'height' => $dimensions->height, |
| [408](#L408) | 'orientation' => $dimensions->width > $dimensions->height ? 'landscape' : 'portrait' |
| [409](#L409) | ) |
| [410](#L410) | ); |
| [411](#L411) | } |
| [412](#L412) | return $response; |
| [413](#L413) | } |
| [414](#L414) |  |
| [415](#L415) | function svg\_dimensions( $svg ){ |
| [416](#L416) | $svg = simplexml\_load\_file( $svg ); |
| [417](#L417) | $width = 0; |
| [418](#L418) | $height = 0; |
| [419](#L419) | if( $svg ){ |
| [420](#L420) | $attributes = $svg->attributes(); |
| [421](#L421) | if( isset( $attributes->width, $attributes->height ) ){ |
| [422](#L422) | if( substr( trim( $attributes->width ), -1 ) != '%' ){ |
| [423](#L423) | $width = floatval( $attributes->width ); |
| [424](#L424) | } |
| [425](#L425) | if( substr( trim( $attributes->height ), -1 ) != '%' ){ |
| [426](#L426) | $height = floatval( $attributes->height ); |
| [427](#L427) | } |
| [428](#L428) | } |
| [429](#L429) | if( ( ! $width || ! $height ) && isset( $attributes->viewBox ) ){ |
| [430](#L430) | $sizes = explode( ' ', $attributes->viewBox ); |
| [431](#L431) | if( isset( $sizes[2], $sizes[3] ) ){ |
| [432](#L432) | $width = floatval( $sizes[2] ); |
| [433](#L433) | $height = floatval( $sizes[3] ); |
| [434](#L434) | } |
| [435](#L435) | } |
| [436](#L436) | } |
| [437](#L437) | return (object)array( 'width' => $width, 'height' => $height ); |
| [438](#L438) | } |
| [439](#L439) | } |
| [440](#L440) |  |
| [441](#L441) | register\_activation\_hook( \_\_FILE\_\_, function(){ |
| [442](#L442) | add\_option( 'WPSVGActivated', 1 ); |
| [443](#L443) | }); |
| [444](#L444) |  |
| [445](#L445) | new WPSVG(); |
| [446](#L446) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wp-svg-images/trunk/wp-svg-images.php?format=txt)
* [Original Format](/export/3220367/wp-svg-images/trunk/wp-svg-images.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_6c15bce5_20250110_175710.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# WP SVG Images <= 4.2 - Authenticated (Author+) Stored Cross-Site Scripting via SVG

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   WP SVG Images <= 4.2 - Authenticated (Author+) Stored Cross-Site Scripting via SVG

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-5945](https://www.cve.org/CVERecord?id=CVE-2024-5945) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | June 20, 2024 |
| Last Updated | June 21, 2024 |
| Researcher | [Colin Xu](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/colin-xu) |

### Description

The WP SVG Images plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the ‘type’ parameter in all versions up to, and including, 4.2 due to insufficient input sanitization. This makes it possible for authenticated attackers, with Author-level access and above, who have permissions to upload sanitized files, to bypass SVG sanitization and inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wp-svg-images/trunk/wp-svg-images.php#L111)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wp-svg-images/trunk/wp-svg-images.php#L313)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3105276/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-svg-images%2Fwp-svg-images-42-authenticated-author-stored-cross-site-scripting-via-svg&t=WP%20SVG%20Images%20%3C%3D%204.2%20-%20Authenticated%20%28Author%2B%29%20Stored%20Cross-Site%20Scripting%20via%20SVG "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-svg-images%2Fwp-svg-images-42-authenticated-author-stored-cross-site-scripting-via-svg&text=WP%20SVG%20Images%20%3C%3D%204.2%20-%20Authenticated%20%28Author%2B%29%20Stored%20Cross-Site%20Scripting%20via%20SVG "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-svg-images%2Fwp-svg-images-42-authenticated-author-stored-cross-site-scripting-via-svg "LinkedIn")
Email

## Vulnerability Details for WP SVG Images

#### [WP SVG Images](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wp-svg-images)

| Software Type | Plugin |
| --- | --- |
| Software Slug | wp-svg-images [(view on wordpress.org)](https://wordpress.org/plugins/wp-svg-images) |
| Patched? | Yes |
| Remediation | Update to version 4.3, or a newer patched version |
| Affected Version | * <= 4.2 |
| Patched Version | * 4.3 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


