=== Content from news.ycombinator.com_fdc1e906_20250111_014645.html ===


| |  | **[Hacker News](news)** [new](newest) | [past](front) | [comments](newcomments) | <ask> | <show> | <jobs> | <submit> | [login](login?goto=item%3Fid%3D41586031) | | --- | --- | --- | |
| --- | --- | --- | --- |
|
| |  |  | [Ruby-SAML pwned by XML signature wrapping attacks](https://ssoready.com/blog/engineering/ruby-saml-pwned-by-xml-signature-wrapping-attacks/) ([ssoready.com](from?site=ssoready.com)) | | --- | --- | --- | |  | | 166 points by [ucarion](user?id=ucarion) [3 months ago](item?id=41586031)  | [hide](hide?id=41586031&goto=item%3Fid%3D41586031) | [past](https://hn.algolia.com/?query=Ruby-SAML%20pwned%20by%20XML%20signature%20wrapping%20attacks&type=story&dateRange=all&sort=byDate&storyText=false&prefix&page=0) | [favorite](fave?id=41586031&auth=98d14f94fbf250ca398f757970e658fbfe1cf7a6) | [91 comments](item?id=41586031) |  | |  |  | [stouset](user?id=stouset) [3 months ago](item?id=41586913)   | [next](#41587332) [–]  SAML is absolutely insane. It’s *three* separate specs: one that defines what every XML element means semantically, one that defines multiple document models that you might want to combine those to use, and one that talks about network protocols you might want to use those documents in. It’s insane and inscrutable. I previously worked at the company that first created this gem. It was not written based off actually reading the spec. It was based off a loose examination of what other legitimate docs in the wild looked like, and built to parse those. Which of course meant that early on it was vulnerable to *everything* since it was built to fit positive results and not negative ones. This isn’t even the first XML signature issue: early released versions didn’t even bother to check that the part being used was the part that was signed. If *any* part of the doc was signed and valid it was good to go. Fun times. | | --- | --- | --- | | | --- | --- | --- | --- | | |  |  | [userbinator](user?id=userbinator) [3 months ago](item?id=41587792)   | [parent](#41586913) | [next](#41587795) [–]  In my experience, anything XML-related seems to be the product of simplicity-hating architecture astronauts with zero consideration for efficiency, possibly as a way of justifying their existence and continued employment. Standards based on ASN.1 get a lot of hate (X.509 etc.) but I'd rather work with that than XML. | | --- | --- | --- | | | |  |  | [darby\_nine](user?id=darby_nine) [3 months ago](item?id=41592439)   | [root](#41586913) | [parent](#41587792) | [next](#41587969) [–]  > In my experience, anything XML-related seems to be the product of simplicity-hating architecture astronauts with zero consideration for efficiency, possibly as a way of justifying their existence and continued employment. I am very confused by people who have emotional reactions to technologies. XML has a number of capabilities that are very difficult to represent in other documents without creating an unreadable mess. XML is more than just the worst SOAP api you've used. | | --- | --- | --- | | | |  |  | [lcnPylGDnU4H9OF](user?id=lcnPylGDnU4H9OF) [3 months ago](item?id=41595467)   | [root](#41586913) | [parent](#41592439) | [next](#41593925) [–]  > I am very confused by people who have emotional reactions to technologies. Given the phrasing ("simplicity-hating architecture astronauts"), I suspect they're having an emotional reaction to a colleague who, at some point, advocated for their team's use of XML. Which I honestly think is slightly justified if their colleague's advocacy was thoughtless or otherwise unreasonable. Maybe JSON would actually work better for what they were doing. Of course, that said, I also say it's "slightly" justified because good ol' XML did nothing wrong. | | --- | --- | --- | | | |  |  | [AtlasBarfed](user?id=AtlasBarfed) [3 months ago](item?id=41593925)   | [root](#41586913) | [parent](#41592439) | [prev](#41595467) | [next](#41587969) [–]  ......such as? Xml is a hierarchical days structure that has less data hinting to parsers /serializes than json. Please don't say namespaces. Broke xpath and other parsing techs. Attrs vs tags? Cdata? Any one remember ibm web services being all cdata tags? | | --- | --- | --- | | | |  |  | [consteval](user?id=consteval) [3 months ago](item?id=41651483)   | [root](#41586913) | [parent](#41593925) | [next](#41587969) [–]  The existence of closing tags makes tree structures much more convenient and ergonomical to represent. Also the supporting XML tech is quite nice. Schema validation and translation is simple. It's also much simpler to parse. | | --- | --- | --- | | | |  |  | [amluto](user?id=amluto) [3 months ago](item?id=41587969)   | [root](#41586913) | [parent](#41587792) | [prev](#41592439) | [next](#41591885) [–]  I find XML to be perfectly fine as a markup language. I once set up a system to generate logs as XML elements and display them prettily with XSLT. It was delightful! Using XML as an interchange format for things intended to be read by a machine is not so great. Don’t use it where you actually want something more like protobuf. | | --- | --- | --- | | | |  |  | [bawolff](user?id=bawolff) [3 months ago](item?id=41588507)   | [root](#41586913) | [parent](#41587969) | [next](#41588527) [–]  XML isnt great for that, but the xml part is the least of the concerns. XSignature and SAML are insane specs, and would still be insane if the underlying presentation language wasnt xml (i mean, then you wouldnt be using xsignature, but if you made sone xsignature like thing for a different presentation language, it would still be crazy) | | --- | --- | --- | | | |  |  | [amluto](user?id=amluto) [3 months ago](item?id=41595598)   | [root](#41586913) | [parent](#41588507) | [next](#41588527) [–]  Signatures in XML are nuts. So is all the mess built around RPC in XML, although IMO that’s not as bad as signatures. But the problem with signatures has nothing to do with XML per se in my opinion. I could just as easily come up with a similarly poor signature scheme in HTML (snicker), nasty C structs with endian issues, MIME, or even plain English. Hah, someone should make a signature scheme meant to be verified by an LLM that parses it and calls out to a helper to do the actual math :) Seriously, though, signing XML well is easy. Take some XML, *serialize it to bytes*, sign with libsodium, and transport the bytes of XML and the bytes of signature. But do not get cute and transport the signed XML as a subtree in another XML document: the bytes must *bytes* until the signature is verified. You could *maybe* get away with sticking it in another document as CDATA [0], but base64 would be better, since you basically can’t screw it up. And it’s entirely possible to screw even this up JOSE-style if you lose track of what a “key” is. DO NOT have the signed (document, signature) tuple specify the signature algorithm or parameters. All of that is part of the public key, which the verifier (obviously) needs to acquire out of band. [0] Someone may pwn, or at least massively confuse, you if you do this. Imagine what happens if the inner and outer documents have different character encodings. | | --- | --- | --- | | | |  |  | [jahewson](user?id=jahewson) [3 months ago](item?id=41588527)   | [root](#41586913) | [parent](#41587969) | [prev](#41588507) | [next](#41591885) [–]  I like your take and I think it is demonstrated by the fact that JSX is nice and YAML is awful. | | --- | --- | --- | | | |  |  | [zerkten](user?id=zerkten) [3 months ago](item?id=41591885)   | [root](#41586913) | [parent](#41587792) | [prev](#41587969) | [next](#41589821) [–]  This is very true. You only have to look at the list authors/editors of the specs from Oasis to see that they square up with the individuals identified by Joel in [https://www.joelonsoftware.com/2001/04/21/dont-let-architect...](https://www.joelonsoftware.com/2001/04/21/dont-let-architecture-astronauts-scare-you/). If XML was removed, these specs wouldn't have been much better. The motivation of the companies sponsoring specs was to build something that sold more enterprise middleware and identity servers. This was never going to be attractive to the individuals working with IETF, or the people working on web standards who'd create WHATWG (I know SAML isn't their domain.) Many readers here also won't be aware of how web services, SOAP, and XML were the AI hype of the time. These were getting pushed into every kind of solution. At the same time, the alternative options for document and serialization formats weren't ubiquitous, so having XML everywhere was somewhat pragmatic for the average developer. I can't imagine ASP (or early-.NET) developers trying to deal with ASN.1. | | --- | --- | --- | | | |  |  | [zaik](user?id=zaik) [3 months ago](item?id=41589821)   | [root](#41586913) | [parent](#41587792) | [prev](#41591885) | [next](#41590247) [–]  XMPP is still a simple and efficient chat protocol. But it makes sure to only allow a sane subset of XML. | | --- | --- | --- | | | |  |  | [mdaniel](user?id=mdaniel) [3 months ago](item?id=41593440)   | [root](#41586913) | [parent](#41589821) | [next](#41597581) [–]  > and efficient *citation needed* <https://xmpp.org/rfcs/rfc6121.html#session> | | --- | --- | --- | | | |  |  | [zaik](user?id=zaik) [3 months ago](item?id=41594561)   | [root](#41586913) | [parent](#41593440) | [next](#41597581) [–]  Almost all steps in this example session are optional. But even clients that do everything are still more efficient than most other chat apps people use: [https://blog.lewman.com/internet-messaging-versus-congested-...](https://blog.lewman.com/internet-messaging-versus-congested-network.html) | | --- | --- | --- | | | |  |  | [userbinator](user?id=userbinator) [3 months ago](item?id=41597581)   | [root](#41586913) | [parent](#41589821) | [prev](#41593440) | [next](#41590247) [–]  IRC and (early versions of) MSNP are far simpler and more efficient. | | --- | --- | --- | | | |  |  | [gwervc](user?id=gwervc) [3 months ago](item?id=41590247)   | [root](#41586913) | [parent](#41587792) | [prev](#41589821) | [next](#41589290) [–]  You are throwing the baby with the bath water. XML is fine, even if it has some gotcha. Astronauts will go wild with any tech at their disposal (I'm seeing it every day at work with .net and JSON). | | --- | --- | --- | | | |  |  | [tannhaeuser](user?id=tannhaeuser) [3 months ago](item?id=41589290)   | [root](#41586913) | [parent](#41587792) | [prev](#41590247) | [next](#41587795) [–]  You're not wrong. The amount of fields of use where XML is used bogusly which have nothing to do with markup is truly staggering. XML signing and relying on canonical XML serialization for it is just peak and something else. The sad thing is that XML was meant as a simplification over full SGML for delivery of markup on the web. Specifically, XML is always fully tagged (doesn't make use of tag inference), and does neither have empty ("void") elements nor short forms for attributes such as in <option selected>. Thus XML never *needs* markup declarations for special per-element or per-attribute parsing rules. This was done to facilitate newer vocabularies next to HTML like SVG and MathML. But soon enough, folks took the XML specification as an invitation for complexity and a self-serving spec circus: namespaces, XInclude (as a bogus replacement for entity expansion), XQuery, XSLT, XML Schema as a super-verbose replacement for DTDs using XML itself, etc. XHTML 2 was the largest failure and turning point, introducing not just a new vocabulary, but trying to reinvent how browsers work in a design-by-comittee fashion. It could be said that XHTML took W3C down along with it. For message payloads in large and long-term multi-party projects (governments, finance/payments, healthcare, etc.), I'm however not sure the alternatives (JSON-over-HTTP and the idiotic quasi-religious apeal to misunderstood "REST" semantics) is really helping. XML Schema, while in part overkill and unused (substitution groups), certainly has facilitated separating service interface from service implementation, multiple generations and multiple implementations, test cases bases, and other long-term maintenance goals. | | --- | --- | --- | | | |  |  | [eftpotrm](user?id=eftpotrm) [3 months ago](item?id=41589988)   | [root](#41586913) | [parent](#41589290) | [next](#41592452) [–]  I'm not going to argue that XML hasn't been used badly and excessively in a lot of places, it really has, and using every part of it religiously will tie you in knots, fast. But I can't help noticing that Json is gaining more and more XML-like functionality through things like schemas and JsonPath, as people slowly realise *why* XML had those functions they're now having to replace. I'm a long way from convinced that all the engineering effort to switch was actually beneficial. | | --- | --- | --- | | | |  |  | [dwaite](user?id=dwaite) [3 months ago](item?id=41593758)   | [root](#41586913) | [parent](#41589988) | [next](#41592472) [–]  And schema and paths have much the same issues - they are being used as tools in things like network-exchanged messages when the underlying specs and the implementations out there were not designed with that idea in mind. You are going to have a bad time if your schema validation tries to resolve schema URL by default. You are going to have a bad time if your JSONpath implementation supports the older "eval" mechanisms, or has unbounded memory/processing time growth from top-down traversal of the JSON. The issue in the article was purposely avoided in JSON by virtue of JWS not having canonicalization, transforms, or partial signatures. You sign a chunk of binary data, and that binary data might be parsable as JSON. | | --- | --- | --- | | | |  |  | [darby\_nine](user?id=darby_nine) [3 months ago](item?id=41592472)   | [root](#41586913) | [parent](#41589988) | [prev](#41593758) | [next](#41590567) [–]  > But I can't help noticing that Json is gaining more and more XML-like functionality through things like schemas and JsonPath, as people slowly realise why XML had those functions they're now having to replace. I think there's an analogy here to static typing and gradual typing. XML is a massive pain in the ass to implement and JSON is often good enough. Only having to implement the features you plan on using is quite nice. | | --- | --- | --- | | | |  |  | [eftpotrm](user?id=eftpotrm) [3 months ago](item?id=41593367)   | [root](#41586913) | [parent](#41592472) | [next](#41590567) [–]  For who though? If you're a user of whatever-data-format designing your new application, you could always use the subset you actually cared about. No-one forced you to use all the complex bits in XML. If you're a library author - well, yes, you could implement a Json parser at first that was eval(input), then something more complex because that's a security hole, then something else again because that's not too quick, then a new library like JsonPath to get queryability, and... all your work is still less functional than the system you were trying to replace. So yes, you can possibly implement Json libraries in less code than implementing XML libraries. But unless you had a reason to implement a new XML library from scratch anyway, that isn't actually a win. | | --- | --- | --- | | | |  |  | [darby\_nine](user?id=darby_nine) [3 months ago](item?id=41594338)   | [root](#41586913) | [parent](#41593367) | [next](#41590567) [–]  > No-one forced you to use all the complex bits in XML. Just parsing XML alone is hugely painful, let alone implementing the rest of the stuff like XSLT, namespaces, validation, xpath, etc etc. Plus, once you've done this, you still need a natural way to map this into domain types, or you need to force people into a visitor pattern or some other awkward deserialization technique. JSON just requires a single JSONValue sum type. XML has its place, but it'd have to be a pretty extreme case of needing rigor or a tree where I need to be able to peg arbitrary attributes onto the nodes in order to see it as attractive. Most APIs won't benefit from all of XML's features. For instance I maintain a podcasting/rss feed library and XML (And more importantly, the way people publish invalid xml) makes me really wish they had gone with a different format in the day that was harder to fuck up. | | --- | --- | --- | | | |  |  | [aversis\_](user?id=aversis_) [3 months ago](item?id=41590567)   | [root](#41586913) | [parent](#41589988) | [prev](#41592472) | [next](#41592452) [–]  Devs just love reinventing the wheel every few years. Maybe we should switch to CSV next just for fun. | | --- | --- | --- | | | |  |  | [darby\_nine](user?id=darby_nine) [3 months ago](item?id=41592452)   | [root](#41586913) | [parent](#41589290) | [prev](#41589988) | [next](#41587795) [–]  > have nothing to do with markup Yes, it's a badly named language. It has nothing to do with markup. As always, intentions don't matter at all, and it's the best tool we have for certain types of structures. | | --- | --- | --- | | | |  |  | [dwaite](user?id=dwaite) [3 months ago](item?id=41593820)   | [root](#41586913) | [parent](#41592452) | [next](#41587795) [–]  It is a properly named language. Just a staggering majority of XML use is for a purpose it was not originally designed for. It is meant to be a good tool for progressive enhancement text markup, such as stylizing hypertext or math equations. | | --- | --- | --- | | | |  |  | [darby\_nine](user?id=darby_nine) [3 months ago](item?id=41595392)   | [root](#41586913) | [parent](#41593820) | [next](#41587795) [–]  > It is meant to be a good tool for progressive enhancement text markup, such as stylizing hypertext or math equations. Well, at least hypertext. I've seen the disaster that is MathML. | | --- | --- | --- | | | |  |  | [bradly](user?id=bradly) [3 months ago](item?id=41587795)   | [parent](#41586913) | [prev](#41587792) | [next](#41586981) [–]  I was jamming this gem rails back in 2009-2010 and will tell you we had no idea what we were doing on our side either. We were a couple a Rails devs at a tiny start up implement Qualcomm's SSO and tbh I'm surprised it actually worked. There wasn't a two-legged oauth gem at the time so I remember writing one and being blowing away at how much I actually understood the OAuth 1.0 2-legged spec. | | --- | --- | --- | | | |  |  | [runiq](user?id=runiq) [3 months ago](item?id=41590841)   | [root](#41586913) | [parent](#41587795) | [next](#41586981) [–]  In case there are other people like me who don't know what 'two-legged authentication' is: <https://stackoverflow.com/a/2880692> | | --- | --- | --- | | | |  |  | [ucarion](user?id=ucarion) [3 months ago](item?id=41586981)   | [parent](#41586913) | [prev](#41587795) | [next](#41587439) [–]  You'll be pleased to know that we're not making a ton of progress on the "split things over N docs" front. In recent years IETF has given us SCIM (which is sort of like "offline SAML") which is 3 RFCs (goals, schemas, http stuff), and of course JWT is actually part of a series of like 9 RFCs (including JWT, of course, but also JWK, JWS, JWE, JWA, ...). I think there's this phenomenon where people who are like "dude, nobody cares, just do the dumbest possible thing we can get away with" aren't the people who decide to get involved in writing security specs. | | --- | --- | --- | | | |  |  | [victor106](user?id=victor106) [3 months ago](item?id=41587421)   | [root](#41586913) | [parent](#41586981) | [next](#41587439) [–]  > SCIM (which is sort of like "offline SAML") If you are talking about SCIM (System for Cross Domain Identity Management) then it’s very different from what SAML is. SCIM Is used for user provisioning where as SAML is used for SSO. | | --- | --- | --- | | | |  |  | [paradox460](user?id=paradox460) [3 months ago](item?id=41587439)   | [parent](#41586913) | [prev](#41586981) | [next](#41587332) [–]  Hey a fellow ol alum. Boy I have dark memories of what that gem cost | | --- | --- | --- | | | |  |  | [jrozner](user?id=jrozner) [3 months ago](item?id=41587580)   | [root](#41586913) | [parent](#41587439) | [next](#41587332) [–]  Also an alum from WAY back (pre-A). One of the first things I did when I started was look at a different wrapping vuln. | | --- | --- | --- | | | |  |  | [bfrog](user?id=bfrog) [3 months ago](item?id=41587332)   | [prev](#41586913) | [next](#41588521) [–]  Signed xml alone is a wildly confusing idea, as the signatures get embedded as elements in the document being signed. There’s a wild set of rules on how to make xml canonical, sign, add the signature, etc. It’s nontrivial. | | --- | --- | --- | | | |  |  | [vbezhenar](user?id=vbezhenar) [3 months ago](item?id=41587573)   | [parent](#41587332) | [next](#41588521) [–]  What's confusing about it? Everything seems pretty obvious to me. | | --- | --- | --- | | | |  |  | [bfrog](user?id=bfrog) [3 months ago](item?id=41591056)   | [root](#41587332) | [parent](#41587573) | [next](#41587633) [–]  To clarify, in signing you have to convert xml to bytes you can get back in the other side, while modifying the same bytes injecting signatures. The whole custom canonical xml serializer is actually complex with escape rules and a bunch of other insanity. On the other side you have to do the opposite by dropping the signature element and serializing the same way. Worse this is done at an element level not a document level as noted in the linked article. Really, it’s not that simple. It typically requires a while xml library for dealing with it that is error prone. Check the number of errors and cves for libxmlsec for example. Or even the versions in C# or Java. | | --- | --- | --- | | | |  |  | [captn3m0](user?id=captn3m0) [3 months ago](item?id=41587633)   | [root](#41587332) | [parent](#41587573) | [prev](#41591056) | [next](#41591046) [–]  Adding Signatures to an existing document, no matter the format is just a whole bunch of trouble. | | --- | --- | --- | | | |  |  | [maxbond](user?id=maxbond) [3 months ago](item?id=41587935)   | [root](#41587332) | [parent](#41587633) | [next](#41591046) [–]  To expand, generally you wouldn't want to *change the identity of the document* by signing it (eg change it's hash). That's bananas. If the signature was external to the document, you wouldn't need any complex and error prone rules to canonicalize. You'd just generate an HMAC tag and send it alongside (or, better yet, use an authenticated encryption like AES-GCM). | | --- | --- | --- | | | |  |  | [jahewson](user?id=jahewson) [3 months ago](item?id=41588574)   | [root](#41587332) | [parent](#41587935) | [next](#41591046) [–]  The sane thing is to sign bytes, as you suggest. But OP is right that it needs to preclude adding signatures to a document. | | --- | --- | --- | | | |  |  | [nimish](user?id=nimish) [3 months ago](item?id=41591046)   | [root](#41587332) | [parent](#41587573) | [prev](#41587633) | [next](#41588521) [–]  Xml canonicalization is insane but necessary. Far more complex than the signature process itself Then the incredibly stupid need to modify the signed document to insert the signature online so verifying it requires a full blown parser among other things | | --- | --- | --- | | | |  |  | [bfrog](user?id=bfrog) [3 months ago](item?id=41601878)   | [root](#41587332) | [parent](#41591046) | [next](#41588521) [–]  Exactly, I had worked on creating a implementation of saml in go, initially I wanted to use the builtin xml library but quickly found it to be overwhelmingly difficult and ended up creating a binding to xmlsec. | | --- | --- | --- | | | |  |  | [nimish](user?id=nimish) [3 months ago](item?id=41612493)   | [root](#41587332) | [parent](#41601878) | [next](#41588521) [–]  Go's XML namespace handling is broken and has been for years. It's a shame. | | --- | --- | --- | | | |  |  | [quickgist](user?id=quickgist) [3 months ago](item?id=41588521)   | [prev](#41587332) | [next](#41587486) [–]  I love this quote from the blog: > Why are we making chandeliers out of swords of Damocles? Amazing description of proliferating footguns. | | --- | --- | --- | | | |  |  | [dudeinjapan](user?id=dudeinjapan) [3 months ago](item?id=41587486)   | [prev](#41588521) | [next](#41586381) [–]  Recent RubySaml contributor here. The problem in this issue is not only RubySaml, but actually much older code in a module called XmlSecurity. Some major problems with SAML are 1) the user’s browser acts as a MITM between the SP and IdP on all requests (vector for this attack), and 2) it requires the IdP and SP to maintain their own certs, which is fine in theory, but humans at big corps are lazy, and the complexity causes people to be lax on security. | | --- | --- | --- | | | |  |  | [SigmundA](user?id=SigmundA) [3 months ago](item?id=41587995)   | [parent](#41587486) | [next](#41586381) [–]  >1) the user’s browser acts as a MITM between the SP and IdP on all requests (vector for this attack) This is exactly how OIDC implicit flow works. The basic difference is using JWT instead of signed XML otherwise it's nearly identical, I mean public/private key signing is the basis for JWT and XML sig. SAML also supports artifact binding which would use a back channel similar to other ODIC flows, but I haven't seen it used much because its make things more complicated and requires the SP to be able to communicate with the IdP. | | --- | --- | --- | | | |  |  | [caust1c](user?id=caust1c) [3 months ago](item?id=41586381)   | [prev](#41587486) | [next](#41586887) [–]  I know very little about XML and SAML, but from what little I do know it shocks me that it's still the de-facto standard for SSO. Great analysis and thanks for sharing! | | --- | --- | --- | | | |  |  | [tptacek](user?id=tptacek) [3 months ago](item?id=41586434)   | [parent](#41586381) | [next](#41586887) [–]  It should not be, and people should use OIDC in preference to it wherever they can. | | --- | --- | --- | | | |  |  | [Roguelazer](user?id=Roguelazer) [3 months ago](item?id=41586778)   | [root](#41586381) | [parent](#41586434) | [next](#41586887) [–]  I'm optimistic SAML will be dead soon. ActiveDirectory/EntraID/whatever Microsoft wants to call it now supports OpenID Connect. Okta, OneLogin, Google, and all the other post-turn-of-the-millenium IdPs support OIDC. Shibboleth is the last major IdP I know if that is SAML-only, and I haven't seen anyone using it in like 10 years. When I built enterprise SSO for my current company, we went OIDC-only and we haven't had a single customer who needed SAML. | | --- | --- | --- | | | |  |  | [jrochkind1](user?id=jrochkind1) [3 months ago](item?id=41587760)   | [root](#41586381) | [parent](#41586778) | [next](#41587287) [–]  > Shibboleth is the last major IdP I know if that is SAML-only, and I haven't seen anyone using it in like 10 years Most universities are still using Shibboleth. And probably will be forever. I think Shibboleth influenced SAML, probably to it's detriment. | | --- | --- | --- | | | |  |  | [Griever](user?id=Griever) [3 months ago](item?id=41588469)   | [root](#41586381) | [parent](#41587760) | [next](#41587287) [–]  Yup, thankfully most federate through InCommon so it’s less painful than it used to be, but that’s not saying much. | | --- | --- | --- | | | |  |  | [zdragnar](user?id=zdragnar) [3 months ago](item?id=41587287)   | [root](#41586381) | [parent](#41586778) | [prev](#41587760) | [next](#41589161) [–]  Working in the health market, pretty much the only thing our customers support is SAML, and that's only among customers who have anything at all that can integrate with us. | | --- | --- | --- | | | |  |  | [koito17](user?id=koito17) [3 months ago](item?id=41587338)   | [root](#41586381) | [parent](#41587287) | [next](#41589161) [–]  Anecdotally, many American universities and academic journal sites still use Shibboleth. Thus, in the United States, SAML is far from dead, whether we like it or not. | | --- | --- | --- | | | |  |  | [GoblinSlayer](user?id=GoblinSlayer) [3 months ago](item?id=41588835)   | [root](#41586381) | [parent](#41587338) | [next](#41589161) [–]  Shibboleth supports CAS. | | --- | --- | --- | | | |  |  | [Johnnynator](user?id=Johnnynator) [3 months ago](item?id=41589161)   | [root](#41586381) | [parent](#41586778) | [prev](#41587287) | [next](#41587678) [–]  > Shibboleth is the last major IdP I know if that is SAML-only Shibboleth has officially supported Plugins for OIDC for some time now. As others said, Shiboleth is still rather pupular at Universities and higher Education, OIDC will have a hard time to set foot there without the OpenID Connect Federation Draft beeing finished and then Implemented by the different Metadata Federation that exist (most National Research Networks manage one) | | --- | --- | --- | | | |  |  | [hirsin](user?id=hirsin) [3 months ago](item?id=41587678)   | [root](#41586381) | [parent](#41586778) | [prev](#41589161) | [next](#41587356) [–]  Okta barely supports OIDC I'm afraid. We have to use SAML with them because they don't support a reusable app model for OIDC (a "marketplace app" that multiple customers can use). I'd love to add FastFed support for OIDC and be done with it but SAML still rules the world. | | --- | --- | --- | | | |  |  | [pquerna](user?id=pquerna) [3 months ago](item?id=41587899)   | [root](#41586381) | [parent](#41587678) | [next](#41587356) [–]  Our app <<https://www.okta.com/integrations/conductorone/>> is in the Okta OIN ("marketplace") using OIDC? So not sure what you mean by that? | | --- | --- | --- | | | |  |  | [hirsin](user?id=hirsin) [3 months ago](item?id=41594493)   | [root](#41586381) | [parent](#41587899) | [next](#41587356) [–]  Ooh that's excellent news, thank you! When I'd last checked it was not an option and our account rep had no predictions to offer. | | --- | --- | --- | | | |  |  | [sk5t](user?id=sk5t) [3 months ago](item?id=41587356)   | [root](#41586381) | [parent](#41586778) | [prev](#41587678) | [next](#41588630) [–]  > I'm optimistic SAML will be dead soon Get used to disappointment. | | --- | --- | --- | | | |  |  | [riffraff](user?id=riffraff) [3 months ago](item?id=41588630)   | [root](#41586381) | [parent](#41586778) | [prev](#41587356) | [next](#41586887) [–]  Isn't the shared identity login thingy (eIDAS) in the EU SAML based? | | --- | --- | --- | | | |  |  | [SigmundA](user?id=SigmundA) [3 months ago](item?id=41586887)   | [prev](#41586381) | [next](#41590283) [–]  Microsoft's SignedXml implementation in the .Net framework fixed this 8 years ago so long as you are correctly using the GetIdElement which makes sure there are no duplicates. [https://coding.abel.nu/2016/03/vulnerability-in-net-signedxm...](https://coding.abel.nu/2016/03/vulnerability-in-net-signedxml/) | | --- | --- | --- | | | |  |  | [silon42](user?id=silon42) [3 months ago](item?id=41589654)   | [parent](#41586887) | [next](#41587328) [–]  And they "forgot" to tell people that if doing this properly, they need to use a schema/DTD where Id is defined as ID and then guaranteed unique by XML parser. I've seen invalid schemas/signatures where Id was just defined as string in the schema (fails when verifying using libxml/xmlsec for example) | | --- | --- | --- | | | |  |  | [SigmundA](user?id=SigmundA) [3 months ago](item?id=41601962)   | [root](#41586887) | [parent](#41589654) | [next](#41587328) [–]  GetElementId makes sure its a NCName and makes sure its unique regardless, you can view the source here: [https://github.com/dotnet/runtime/blob/c4d7f7c6f2e2f34f07e64...](https://github.com/dotnet/runtime/blob/c4d7f7c6f2e2f34f07e64c6caa3bf9b2ce915cc1/src/libraries/System.Security.Cryptography.Xml/src/System/Security/Cryptography/Xml/SignedXml.cs#L557) | | --- | --- | --- | | | |  |  | [jrpelkonen](user?id=jrpelkonen) [3 months ago](item?id=41587328)   | [parent](#41586887) | [prev](#41589654) | [next](#41590283) [–]  I know next to nothing about .net, but this seems like the classic “you’re holding it wrong” excuse to me. If there’s a way to call an api the wrong way and the right way, and both appear to work, large number of developers will implement the insecure api. Why can’t the incorrect api be removed? I understand there’s pressure to support old client code but vulnerabilities should trump backwards compatibility. | | --- | --- | --- | | | |  |  | [SigmundA](user?id=SigmundA) [3 months ago](item?id=41587513)   | [root](#41586887) | [parent](#41587328) | [next](#41590283) [–]  The incorrect api would be using GetXml and looking at the raw XmlElement and using select nodes or something vs using the GetIdElement on the SignedXML object itself, its not going to prevent you from looking at the xml document directly and do something incorrect but it gives you a correct helper method right next to CheckSignature to do the right thing. I mean at some point you do have to understand the difference between xml and a specific schema of it and how its used in SAML, its not like xml elements are required to have a unique id attribute. This isn't something you would call directly anyway unless you were writing your own SAML client, which isn't that hard but there are existing ones, here is a simple one that works well: <https://github.com/jitbit/AspNetSaml> | | --- | --- | --- | | | |  |  | [benmmurphy](user?id=benmmurphy) [3 months ago](item?id=41590283)   | [prev](#41586887) | [next](#41589463) [–]  i think the problem is signature verification APIs should return the signed data or an error and then the consumer should use the signed data from the API and not any other data. then there is no confusion over what was signed or not. in the case of XML signature verification they probably should return a list of (XMLElement, Path) tuples. so the actual XMLElement that was signed and verified by the API and a path to the element in the document. having APIs that return IDs and then make assumptions that the signature verification code and the consumer code is going to perform resolution the same way is dangerous. even returning the path is a potential footgun but I assume consumers of an XMLSignature need to be able to check that elements appear in certain places in the document. i guess also DOM model APIs are probably implicitly returning a path if they support navigating by `getParentElement()`. | | --- | --- | --- | | | |  |  | [lifeisstillgood](user?id=lifeisstillgood) [3 months ago](item?id=41589463)   | [prev](#41590283) | [next](#41591702) [–]  This article actually reads like a dev who understands the problem and has an opinion. Where else can one find such writing about security issues ? | | --- | --- | --- | | | |  |  | [agentultra](user?id=agentultra) [3 months ago](item?id=41591702)   | [prev](#41589463) | [next](#41587357) [–]  Businesses that want to integrate with larger SaaS providers and enterprises are often compelled to implement SAML. I used to fight tooth and nail to avoid it over issues with the SAML spec but... business is business. Good suggestions from the article: work around it. The non-technical folks may force you to implement it in your system. Doesn't mean you have to leave your systems vulnerable. | | --- | --- | --- | | | |  |  | [zb3](user?id=zb3) [3 months ago](item?id=41587357)   | [prev](#41591702) | [next](#41586756) [–]  Unfortunately XML signatures are also widely used in Polish government APIs which citizens/companies are required to use :( | | --- | --- | --- | | | |  |  | [vbezhenar](user?id=vbezhenar) [3 months ago](item?id=41587591)   | [parent](#41587357) | [next](#41587563) [–]  Same here in Kazakhstan. And we also use our home-made crypto algorithms (derived from USSR GOST), which are not present in popular open source libraries. | | --- | --- | --- | | | |  |  | [notpushkin](user?id=notpushkin) [3 months ago](item?id=41590239)   | [root](#41587357) | [parent](#41587591) | [next](#41587563) [–]  Are those different from Russian GOST algorithms? I think there’s a bunch of libraries (mostly forks of other popular open source libraries) for that. | | --- | --- | --- | | | |  |  | [vbezhenar](user?id=vbezhenar) [3 months ago](item?id=41623479)   | [root](#41587357) | [parent](#41590239) | [next](#41587563) [–]  I don't really know, sorry. We have our own identifiers for algorithms like СТ РК ГОСТ Р 34.10-2015, СТ РК ГОСТ Р 34.11-2015 and our local company (nitec.kz) creates SDK which includes implementations of those algorithms for Java and OpenSSL. Whether they copied those algorithms from Russian ones, I don't know, never researched that. | | --- | --- | --- | | | |  |  | [magicalhippo](user?id=magicalhippo) [3 months ago](item?id=41587563)   | [parent](#41587357) | [prev](#41587591) | [next](#41588823) [–]  Same in Sweden and Denmark, several gov't systems requiring signed XMLs. And before you think legacy systems, no, these are the new systems, with rollout starting a few years ago and still ongoing. | | --- | --- | --- | | | |  |  | [jpnc](user?id=jpnc) [3 months ago](item?id=41588823)   | [parent](#41587357) | [prev](#41587563) | [next](#41586756) [–]  That's essentially true for all of EU. If you've ever done integration with EU central services you know what I'm talking about. | | --- | --- | --- | | | |  |  | [intelVISA](user?id=intelVISA) [3 months ago](item?id=41594584)   | [root](#41587357) | [parent](#41588823) | [next](#41586756) [–]  Makes sense, the EU favors architecture astronauts over profitable technology. | | --- | --- | --- | | | |  |  | [bawolff](user?id=bawolff) [3 months ago](item?id=41586756)   | [prev](#41587357) | [next](#41591935) [–]  SAML has to be one of the worst security specs ever | | --- | --- | --- | | | |  |  | [hsbauauvhabzb](user?id=hsbauauvhabzb) [3 months ago](item?id=41586890)   | [parent](#41586756) | [next](#41591935) [–]  Why do you say that? I think it’s ugly, but it’s substantially simpler to understand than oidc. What parts of the spec (read: not just shitty implementations by developers) are bad? I’m genuinely curious here, I’m not attempting to bait an argument. | | --- | --- | --- | | | |  |  | [bawolff](user?id=bawolff) [3 months ago](item?id=41587946)   | [root](#41586756) | [parent](#41586890) | [next](#41587154) [–]  Two things Saml itself is sort of a kitchen sink. It includes everything you could possibly ever want, but nobody implements all of it so you need to figure out common subset, which defeats the point of a standard. Second, XMLSignature sucks... like badly. Only part of the response is signed, but which part there is no standard on. It is way too complicated. Why have multiple overlapping signatures is crazy. Comments arent signed but change meaning of document. A billion signature types. Etc. | | --- | --- | --- | | | |  |  | [Freak\_NL](user?id=Freak_NL) [3 months ago](item?id=41589258)   | [root](#41586756) | [parent](#41587946) | [next](#41590228) [–]  XML signatures in SAML suck so much they deserve to be your point one. For functionality at least it's possible to just poke around and see what works with whatever party your connecting, but debugging broken signing? With XML signatures it is possible to have it all working with one provider (perhaps a Windows machine running ADFS) and then be unable to verify the signatures from another, *and you'll never know where the fault lies*. At least with modern stuff like JWT's the ways to encrypt and sign are well-understood. | | --- | --- | --- | | | |  |  | [cmgbhm](user?id=cmgbhm) [3 months ago](item?id=41590228)   | [root](#41586756) | [parent](#41587946) | [prev](#41589258) | [next](#41593325) [–]  It also supports putting keyinfo into the document as well and validates it by default unless you really know to go out of your way to disable it. Oh look, another signature issue… <https://github.com/advisories/GHSA-2xp3-57p7-qf4v> When googling for a SAML dependency, if a library doesn’t already have CVEs for this stuff, it’s likely never been tested. | | --- | --- | --- | | | |  |  | [mdaniel](user?id=mdaniel) [3 months ago](item?id=41593325)   | [root](#41586756) | [parent](#41587946) | [prev](#41590228) | [next](#41589662) [–]  > Comments arent signed but change meaning of document Do you have an example of that assertion handy? The only comment-influences-execution behavior I'm aware of is in SQL[1], and I haven't ever seen any XML system (in any business domain) which does what you said 1: I mean, setting aside linter suppression, which pedantically does impact execution but I meant of the final software | | --- | --- | --- | | | |  |  | [bawolff](user?id=bawolff) [3 months ago](item?id=41594678)   | [root](#41586756) | [parent](#41593325) | [next](#41589662) [–]  [https://duo.com/blog/duo-finds-saml-vulnerabilities-affectin...](https://duo.com/blog/duo-finds-saml-vulnerabilities-affecting-multiple-implementations) has the full details. But basically in some xml apis, a comment can split a single text node into two adjacent text nodes. Some implementations would only look at the first text node. The original xsignature spec (although i think this has been changed) said to remove all comments from doc before signing it, so the attacker can add arbitrary comments without messing up the signature. | | --- | --- | --- | | | |  |  | [mdaniel](user?id=mdaniel) [3 months ago](item?id=41597822)   | [root](#41586756) | [parent](#41594678) | [next](#41589662) [–]  > so the attacker can add arbitrary comments without messing up the signature. Right, I believe you, but the original assertion was "change meaning of document" -- I can likely add arbitrary whitespace, too, under that same "tomato, tomahto" canonicalization path, but how do either of those two insertions benefit the attacker by *changing the meaning of the document*? | | --- | --- | --- | | | |  |  | [bawolff](user?id=bawolff) [3 months ago](item?id=41603447)   | [root](#41586756) | [parent](#41597822) | [next](#41589662) [–]  Comments affect the dom structure of parsed xml subtley. There were cases where this was enough to log in as a different user. See the link i provided. | | --- | --- | --- | | | |  |  | [silon42](user?id=silon42) [3 months ago](item?id=41589662)   | [root](#41586756) | [parent](#41587946) | [prev](#41593325) | [next](#41587154) [–]  Personally I've found one of the few sane uses of XMLSignature is just to use only enveloped-signature, where the signature is then removed from message before processing... also it can be composed by nesting them (carefully). | | --- | --- | --- | | | |  |  | [tptacek](user?id=tptacek) [3 months ago](item?id=41587154)   | [root](#41586756) | [parent](#41586890) | [prev](#41587946) | [next](#41587944) [–]  It is drastically harder to understand than OIDC, in large part due to XML signatures, which are a demented format, mostly for the reasons stated in this blog post (but also for some reasons it shares with JWT, and also for some sui generis reasons having to do with how complicated xmldsig is and how few implementations there are of it). You really couldn't find a worse format to do cryptography with than XML. | | --- | --- | --- | | | |  |  | [unscaled](user?id=unscaled) [3 months ago](item?id=41587944)   | [root](#41586756) | [parent](#41586890) | [prev](#41587154) | [next](#41587720) [–]  It's not just shitty implementations here. The designers of SAML and XMLDSig cannot just blame the developers for implementing their "perfect" spec incorrectly. The blog post above details exactly why XMLDSig can only be implemented securely, if you explicitly make an effort to *ignore* the spec. When following the specification leads to insecure implementations it's the spec that's shitty, and the spec authors should carry the blame. The Open ID spec isn't great either and has its own share of issues, but in most scenarios, it doesn't rely on signature validation. If you only use the authorization code flow, breaking the ID token signature becomes ineffective, since the attacker still needs a valid authorization code from the IdP for this attack. If you restrict your implementation to what is allowed in OAuth 2.1 [1] or follow OAuth Best Practices [2], you can implement Open ID Connect pretty safely, as they eliminate the implicit grant and introduce PKCE. I sure wish the OpenID foundation would cut all the unnecessary bloat in their spec(namely the ID Token, Implicit and Hybrid Flow and unnecessarily client-side token validation rules) and leave it as just a simple extension to OAuth 2.1 that specifies a few extra parameters and a User Info Endpoint. But if we have to leave with this over-engineered spec, I can still trust that implementations of OIDC would fail less horribly than SAML. [1] <https://oauth.net/2.1/> [2] <https://oauth.net/2/oauth-best-practice/> | | --- | --- | --- | | | |  |  | [bawolff](user?id=bawolff) [3 months ago](item?id=41588481)   | [root](#41586756) | [parent](#41587944) | [next](#41587720) [–]  > It's not just shitty implementations here I agree 100% the spec is shitty, but on top of it,some of the implementations are really weird beyond the spec. there was a prominent c library for it that (last i checked) in the default config added a custom hmac signature version where the hmac key is embedded in the attacker control document, and also hooked into the the system web pki, so if the provided key doesnt match, it will test if the doc was signed by a tls key from any website in the world. | | --- | --- | --- | | | |  |  | [tux3](user?id=tux3) [3 months ago](item?id=41589387)   | [root](#41586756) | [parent](#41588481) | [next](#41587720) [–]  Outstanding. That's just lovely. | | --- | --- | --- | | | |  |  | [jiggawatts](user?id=jiggawatts) [3 months ago](item?id=41587720)   | [root](#41586756) | [parent](#41586890) | [prev](#41587944) | [next](#41591935) [–]  It’s also a nested meta protocol with an extensible markup language (XML) used to express extensible fields but using SAML encoding for them instead of just XML. It’s the inner-platform effect, which is common in over engineered monstrosities like SAML. | | --- | --- | --- | | | |  |  | [brohee](user?id=brohee) [3 months ago](item?id=41591935)   | [prev](#41586756) | [next](#41592379) [–]  "Nobody cares about XML Signatures anymore, except in the context of SAML" I wish, but I'm pretty sure that it's still used in EBICS (latest version of the standard here [https://www.ebics.org/securedl/sdl-eyJ0eXAiOiJKV1QiLCJhbGciO...](https://www.ebics.org/securedl/sdl-eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3MjY3MzgxOTAsImV4cCI6MTcyNjgyODE4OSwidXNlciI6MiwiZ3JvdXBzIjpbMCwtMiwyXSwiZmlsZSI6ImZpbGVhZG1pblwvdW5zZWN1cmVkXC9zcGVjaWZpY2F0aW9uXC9zcGVjX2N1cnJlbnRfRU5cLzIwMjItMDYtMjctRUJJQ1NfVl8zLjAuMl9GaW5hbFZlcnNpb24ucGRmIiwicGFnZSI6OTF9.l9UwUBOYzu0uVRORKuoApbUBHHIrAAw-ZO7UXSXFbqw/2022-06-27-EBICS_V_3.0.2_FinalVersion.pdf)), which is even scarier than SAML. | | --- | --- | --- | | | |  |  | [layer8](user?id=layer8) [3 months ago](item?id=41592379)   | [prev](#41591935) | [next](#41591676) [–]  > All an XML signature does is let you cryptographically sign an XML document. Same thing as what JWTs do with alg: "RS256" (no ES256, because remember: the year is 2000). This stopped being true in 2005, see RFC 4050. | | --- | --- | --- | | | |  |  | [agentultra](user?id=agentultra) [3 months ago](item?id=41591676)   | [prev](#41592379) [–]  > Ignore Postel Pretty good advice. I believe it should be the default. The situations that require permissiveness should be exceptions and treated with a high degree of scrutiny. | | --- | --- | --- | | |
| |  | | --- |   [Guidelines](newsguidelines.html) | [FAQ](newsfaq.html) | [Lists](lists) | [API](https://github.com/HackerNews/API) | [Security](security.html) | [Legal](https://www.ycombinator.com/legal/) | [Apply to YC](https://www.ycombinator.com/apply/) | Contact Search: |



=== Content from lists.debian.org_fb159986_20250111_014644.html ===


---

[[Date Prev](msg00005.html)][[Date Next](msg00007.html)]
[[Thread Prev](msg00005.html)][[Thread Next](msg00007.html)]
[[Date Index](maillist.html#00006)]
[[Thread Index](threads.html#00006)]

# [SECURITY] [DLA 3949-1] ruby-saml security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3949-1] ruby-saml security update
* *From*: Abhijith PA <abhijith@debian.org>
* *Date*: Mon, 11 Nov 2024 20:33:35 +0530
* *Message-id*: <[[🔎]](/msgid-search/ZzIcx_320BOI5uJL%40debian.org) [ZzIcx\_320BOI5uJL@debian.org](msg00006.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3949-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                          Abhijith PA
November 11, 2024                             <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : ruby-saml
Version        : 1.11.0-1+deb11u1
CVE ID         : CVE-2024-45409

It was discovered that ruby-saml, a library for implementing the
client side of a SAML authorization does not properly verify the
signature of the SAML Response. An unauthenticated attacker with
access to any signed saml document (by the IdP) can thus forge a SAML
Response/Assertion with arbitrary contents. This would allow the
attacker to log in as arbitrary user within the vulnerable system.

For Debian 11 bullseye, this problem has been fixed in version
1.11.0-1+deb11u1.

We recommend that you upgrade your ruby-saml packages.

For the detailed security status of ruby-saml please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/ruby-saml>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEE7xPqJqaY/zX9fJAuhj1N8u2cKO8FAmcyHMYACgkQhj1N8u2c
KO9urg/8DxdwkPS8JI2SxtMZIDqwoCzOMirDMoSFmog6YefBO2GseYYMF3XNjZeF
cKBKn8+O0t90G8MdeXbiriv/gv+aMH8qXwdGuiKJzmSxS6l0qfaRYrpNfNfPTbtL
InUJd1JGFyK+z2AFqZfYbbx5FjBBDva0EnA0EmrBkBuyX5Rk6lW4N/GQrUp77UIa
FvDAD0JFlUQCqCRDY7HL1sfjmwKgBsO9BmLBe+vaDc8yunqF5RFqh1JqQHE0+HIY
XkDJ2IQsAWIozOejuBjRx5ecjYdHrxbnDH0wNbEeaPOyZRPiqvJYOynZdHzcaLt8
vugP62CQt/Q4gl/5/1Apv/QgsyqUl7htfrp8Sy1Kc50JKOjyUgYw2KqdJ6ZyO3PC
2Xuh+rG54eE7HbGKLUuBrW0yczcOYnGaSnVd8vqWpTtq8KITuHhcJzEoPSVChxZa
+/6u4LaOI5ynR8lG7tG7bow5/sFMOLRaBHEiUWy0j6JaWh/ajXEQ46p+8BoMXT6S
5vkn9+11pd1RhYkCjbvdG8kZlh3hfCRKztfttaRD4V3dXwDJyhMk49a7OQhROMat
l7vp6BTdMDe7MCoeK/aENFYvkNi4h/uMt5FIVxMepfewnyyiVBQsLQyKIaX0AbJ/
FArSvBopGFWVjDnzzD8zytqOJo0HndcAxdyUqMZWb92J2nKIHE0=
=0RKy
-----END PGP SIGNATURE-----

```

---



=== Content from ssoready.com_312dc425_20250111_014647.html ===

[SSOReady
![](https://ssoready.com/blog//logo.png)](https://ssoready.com)

Open main menu

[Documentation](https://ssoready.com/docs)
[Pricing](https://ssoready.com/pricing)
[Company](https://ssoready.com/company)
[Blog](https://ssoready.com/blog)

[Get started now →](https://app.ssoready.com)

[SSOReady
![](https://ssoready.com/blog//logo.png)](https://ssoready.com)
Close menu

[Documentation](https://ssoready.com/docs)
[Pricing](https://ssoready.com/pricing)
[Company](https://ssoready.com/company)
[Blog](https://ssoready.com/blog)

[Get started now](https://app.ssoready.com)

[Back to Blog](https://ssoready.com/blog/)
# Ruby-SAML pwned by XML signature wrapping attacks

GitLab and others are affected. The blame lies in the SAML specification, and in credulous engineers that implement it.

![profile picture](https://ssoready.com/blog///authors/ulysse-carion.jpg)

[CVE-2024-45409](https://nvd.nist.gov/vuln/detail/CVE-2024-45409) was published
on September 10, 2024. It’s yet another XML signature wrapping attack, this time
affecting the main Ruby implementation of SAML. The vuln allows an attacker log
in as any arbitrary user of the affected system.

This attack keeps coming up
[again](https://lists.w3.org/Archives/Public/public-xmlsec/2009Nov/att-0019/Camera-Ready.pdf)
and [again](https://www.cve.org/CVERecord?id=CVE-2020-5390), and it keeps
affecting huge swaths of the internet — this time,
[GitLab](https://about.gitlab.com/releases/2024/09/17/patch-release-gitlab-17-3-3-released/#saml-authentication-bypass)
and much of the Ruby ecosystem — at a time.

Here’s what this issue is, why it keeps happening, and what we can do about it.

# XML Signature Wrapping

XML signatures are the year 2000’s answer to
[JWTs](https://en.wikipedia.org/wiki/JSON_Web_Token). In 2024, JWTs are a very
common answer to “I need to sign some data and send it over the internet”. It’s
not a perfect spec, but it’s workable.

XML signatures do the same thing, but every conceivable step is much more
complicated.

All an XML signature does is let you cryptographically sign an XML document.
Same thing as what JWTs do with `alg: "RS256"` (no `ES256`, because remember:
the year is 2000).

There is exactly one sane way to cryptographically sign data:

1. You take your message, and convert it to bytes
2. You sign the bytes, which produces some more bytes
3. You transmit two things: the message-bytes from (1), and the signature-bytes from (2)
4. [Don’t get cute](https://en.wikipedia.org/wiki/KISS_principle).

Steps 1-3 is what JWT does. It does step (3) by separating the message and the
signature with a period (`.`), which works because it also base64s the message
and the signature, and `.` can’t appear in base64. People hate on JWT because it
forgot about (4); it’s part of an overarching attempt to standardize all of
crypto under something called
[JOSE](https://datatracker.ietf.org/group/jose/documents/) (and
[COSE](https://datatracker.ietf.org/doc/html/rfc8152)), a bad idea. But overall
they’re pretty good. They work. You can mostly ignore the overreach on the part
of the spec authors.

XML Signatures takes a different approach. Instead, it:

1. Lets you sign *subsets* of a message,
2. Or none of the message at all,
3. Because instead of sending a signature accompanying your message, you *edit the very message you’re signing* to sprinkle in some `<ds:Signature>` elements,
4. Each of which sign a different
   subset of the message. A `ds:Signature` uses a URI to point to other parts of
   the message, and say “here’s a signature for that part of the message”

If you ignore the XML-ness of it all, it’s the equivalent of signing `{"email": "bob@company.com"}` by modifying it to be:

```
{
   "email": "bob@company.com",
   "__sig": {
      "uri": "/email",
      "sig": "... signature for the string bob@company.com ..."
   }
}

```

This is a bad idea. It introduces the need for some “signature discovery” step,
where you search through the document for signatures (`__sig` in my JSON
example; `<ds:Signature>` elements in XML signatures). It basically begs
engineers to do this:

```
def validate_xml(xml_document):
    for signature in find_xml_signature_elements(xml_document):
        element = resolve_uri(signature["SignedInfo"]["Reference"]["URI"], xml_document)
        verify_signature(element, signature["SignatureValue"]

```

Note that this doesn’t actually *do* anything if the document doesn’t have any
signature at all.

People write a ton of bugs related to this “signature discovery” step. Every
such bug is what they call a “XML Signature Wrapping” attack; someone wrote some
tricky XML that makes your code lose track of what’s actually being signed.

To anticipate the obvious suggestion: no, sadly you can’t just check whether the
top-level XML document is signed, because that’s not how SAML does it (more
later), and SAML is the only reason people do XML Signatures (again, more
later).

So you instead in practice have people adapting their previous code to make sure
that the part of the message they care about is, in fact, signed:

```
def validate_xml(xml_document, uri_checklist):
    checked_uris = []
    for signature in find_xml_signature_elements(xml_document):
        element = resolve_uri(signature["SignedInfo"]["Reference"]["URI"], xml_document)
        verify_signature(element, signature["SignatureValue"]
        checked_uris.append(signature["SignedInfo"]["Reference"]["URI"])

    for uri in uri_checklist:
        if uri not in checked_uris:
            throw MissingSignatureError()

```

There are a million ways this goes wrong, but here’s the one `ruby-saml` ran
into: there’s nothing that guarantees the `URI` the signature points to is
unique.

So what you could do is take a legitimate message, and just stick some other
stuff into the message, reusing the same `URI`. And then hope your victim’s code
will get confused as to what it just signed.

Something like this:

```
<Document>
    <!-- a faked message; this is never actually signed -->
    <ImportantStuff>
        <Message id="dead[...]beef">
            <Email>eve@evil.com</Email>
        </Message>
    </ImportantStuff>

    <!-- attacker-supplied message, copied out of the ImportantStuff from a legit message -->
    <Message id="dead[...]beef">
        <Email>alice@customer.com</Email>
    </Message>

    <!-- a signature for alice@customer.com -->
    <Signature>
        <SignedInfo>
            <Reference URI="dead[...]beef" />
        </SignedInfo>
        <SignatureValue>... the correct signature, but for alice@customer.com ...</SignatureValue>
    </Signature>
</Document>

```

The victim code finds the signature, resolves the uri to the top-level
`Message`, but then later on would process `ImportantStuff` instead of
`Message`, if that’s where the `Message` is normally placed.

It’s a mess. Ruby-SAML patched this by [throwing if `resolve_uri` finds more
than one
match](https://github.com/SAML-Toolkits/ruby-saml/commit/4865d030cae9705ee5cdb12415c654c634093ae7).
But Ruby-SAML has no reliable way of validating which parts of an XML document
were signed, and so I wouldn’t be surprised if there were more issues in that
codebase lurking.

# SAML is why this matters

Nobody cares about XML Signatures anymore, except in the context of SAML. SAML
is what people mean by “enterprise single-sign-on”, and it works by having an
Identity Provider (Okta, Microsoft Entra, Google Workspace, etc.) send a signed
XML message to a Service Provider (a B2B SaaS product). That message typically
just contains the logging in user’s email address. It’s an elaborate email
address transmission protocol.

Concretely, SAML requests are a POST from your user’s browser containing:

```
<?xml version="1.0" encoding="UTF-8"?>
<saml2p:Response>
    <saml2:Assertion ID="id2829877824622019702853127">
        <saml2:Issuer>
            http://www.okta.com/exkig8gdo63cjI4OD5d7
        </saml2:Issuer>
        <ds:Signature>
            <ds:SignedInfo>
                <ds:Reference URI="#id2829877824622019702853127">
                </ds:Reference>
            </ds:SignedInfo>
            <ds:SignatureValue>
                n744L/[...]mDruC1H9E0Lz7sbZg==
            </ds:SignatureValue>
        </ds:Signature>
        <saml2:Subject>
            <saml2:NameID>
                ulysse.carion@ssoready.com
            </saml2:NameID>
        </saml2:Subject>
    </saml2:Assertion>
</saml2p:Response>

```

And “implementing SAML” mostly consists of:

1. “Validating” the message, with all the fraught gotchas that entails
2. Logging in the user as `ulysse.carion@ssoready.com`.

Notice how this is roughly the same shape of message that I laid out in the
previous example. I won’t disclose it here because that’d be irresponsible, but
you can do the same attack. You could get me to validate the message in step
(1), but then have some other thing in the message, also with
`ID="id2829877824622019702853127"`, that I use in step (2).

To repeat it again, the core dumb idea here is that you’re signing a message,
instead of signing bytes. XML Signatures interweaves cryptography and the XML
tree model into a messy knot. It’s really hard to make sure the message you’re
processing is the same as the bytes you verified.

# How to fix this: disregard the spec

SAML library authors need to stop being so credulous about the spec.

When a specification is a collection of security flaws, responsible engineers
disregard the specification. Responsible engineers should disregard what the
SAML and XML Signatures spec authors wrote down, and instead implement the
secure thing at its core.

Put another way, the reason XML wrapping attacks keep coming up is that people
architect their code like this:

1. `saml-ruby` calls into some
2. `xml-signatures-ruby` dependency or submodule

This seems like good, sane composition. But XML Signatures is insane. It cannot
be composed. XML Signatures can’t say “yes this message is valid”. What it can
say is “these N potentially-overlapping subsets of this XML document are
correctly signed” (It’s actually [considerably worse than
that](/blog/engineering/xml-dsig-is-unfortunate/), but whatever). There’s no
building on top of XML Signatures.

So here’s the sane thing to do instead:

1. Notice that every Identity Provider in the world has practically agreed to
   shape their SAML payloads in the same shape.
2. Assume all messages shaped otherwise are invalid.
3. Disregard the `URI` in XML signatures.
4. Presume in advance that they’re signing exactly the subset of the SAML
   payload they should be signing, which is also the subset of the payload
   you’ll be processing later.
5. Verify *that* signature, and only that signature.

In other words: forget XML signatures. Treat it as some weird relic. Just look
at the SAML payload, and implement the de-facto protocol that has emerged.

Ignore [Postel](https://en.wikipedia.org/wiki/Robustness_principle). When it
comes to processing cryptographic signatures, loosey-goosey isn’t “liberal”,
it’s libertine.

## Footer

![Company name](https://ssoready.com/blog//logo.png)

Open-source dev tools for enterprise SSO. Ship SAML support this afternoon.

[X](https://x.com/ssoready)
[GitHub](https://github.com/ssoready)

### Product

* [Log in](https://app.ssoready.com)
* [Pricing](https://ssoready.com/pricing)

### Company

* [About](https://ssoready.com/company)

### Legal

* [Privacy Policy](https://ssoready.com/terms)
* [Terms of Use](https://ssoready.com/terms)

© Copyright 2024, All rights reserved by Codomain Data Corporation (d.b.a. SSOReady)



=== Content from security.netapp.com_c4622f57_20250111_014646.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [CVE-2024-45409 Ruby SAML Vulnerability in NetApp Products](https://security.netapp.com/advisory/ntap-20240926-0008)

## CVE-2024-45409 Ruby SAML Vulnerability in NetApp Products

circle-info

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20240926-0008 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20240926-0008 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20240926-0008 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20240926-0008 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20240926-0008
**Version:**
3.0

**Last updated:**
11/22/2024

**Status:**
Interim.

**CVEs:** CVE-2024-45409

Overview
#### Summary

Multiple NetApp products incorporate Ruby-SAML. Certain versions of Ruby-SAML are susceptible to a vulnerability which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of this vulnerability could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

StorageGRID (formerly StorageGRID Webscale):

No attack is possible via S3 or SSH. A successful attacker must already be a valid user, know the details of a higher-privilege user and have access to a valid signed SAML result to become a different user.

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2024-45409](https://nvd.nist.gov/vuln/detail/CVE-2024-45409) | 9.8 (CRITICAL) | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

#### References

* <https://github.com/SAML-Toolkits/ruby-saml/security/advisories/GHSA-jw9c-mfg7-9rx2>

Affected Products
#### Affected Products

* StorageGRID (formerly StorageGRID Webscale)

#### Products Not Affected

* AFF BIOS - A1K/A70/A90
* AFF BIOS - A700s
* AFF Baseboard Management Controller (BMC) - A1K/A70/A90
* AFF Baseboard Management Controller (BMC) - A700s
* AFF LOADER- A1K/A70/A90
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Control Center
* Astra Control Center - NetApp Kubernetes Monitoring Operator
* Astra Control Provisioner
* Astra Trident
* Astra Trident Autosupport
* BlueXP Classification
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Volumes ONTAP Mediator
* Data Infrastructure Insights Acquisition Unit (formerly Cloud Insights Acquisition Unit)
* Data Infrastructure Insights Storage Workload Security Agent (formerly Cloud Insights Storage Workload Security Agent)
* Data Infrastructure Insights Telegraf Agent (formerly Cloud Insights Telegraf Agent)
* E-Series BIOS
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Powershell Tools
* Element Python SDK
* FAS/AFF BIOS - 2820
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF BIOS - A250/500f/C250
* FAS/AFF BIOS - A300/8200/C190/A220/2720/2750/A150
* FAS/AFF BIOS - A320
* FAS/AFF BIOS - A700/9000
* FAS/AFF BIOS - A800/C800
* FAS/AFF BIOS - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - A320
* FAS/AFF Baseboard Management Controller (BMC) - A800/C800
* FAS/AFF Baseboard Management Controller (BMC) - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - C190/A150/A220/FAS2720/FAS2750
* FAS/AFF Baseboard Management Controller (BMC) - FAS2820
* FAS/AFF Service Processor - A300/8200
* FAS/AFF Service Processor - A700/9000
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM12 SAS Disk Shelf Firmware
* IOM12B SAS Disk Shelf Firmware
* IOM12E SAS Disk Shelf Firmware
* IOM12F SAS Disk Shelf Firmware
* IOM12G SAS Disk Shelf Firmware
* IOM6 SAS Disk Shelf Firmware
* IOM6E SAS Disk Shelf Firmware
* Management Services for Element Software and NetApp HCI
* MetroCluster DataCollector
* MetroCluster Tiebreaker
* Multipath I/O (SANtricity DSM for Windows MPIO)
* NetApp BlueXP
* NetApp Converged Systems Advisor Agent
* NetApp DataOps Toolkit
* NetApp E-Series Host Collection
* NetApp E-Series SANtricity Collection
* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node (Bootstrap OS)
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Kubernetes Monitoring Operator
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP 9
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP Select Deploy administration utility
* ONTAP tools for VMware vSphere 10
* ONTAP tools for VMware vSphere 9
* OnCommand Insight
* OnCommand Workflow Automation
* RcfFileGenerator for MetroCluster IP
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine
* SnapGathers
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* StorageGRID BIOS SG1000/SG100/SG1100/SG110
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG5812/SG5860
* StorageGRID BIOS SG6060/SGF6024/SGF6112/SG6160
* StorageGRID Baseboard Management Controller (BMC) - SG6060/SG6160/SGF6024/SGF6112/SG100/SG110/SG1000/SG1100
* StorageGRID Baseboard Management Controller (BMC) SG5812/SG5860
* System Manager 9.x
* Terraform Provider for ONTAP
* Workload Factory for VMware

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **StorageGRID (formerly StorageGRID Webscale)** | <https://mysupport.netapp.com/site/products/all/details/storagegrid/downloads-tab/download/61023/11.8.0.7> |

#### Workarounds

StorageGRID (formerly StorageGRID Webscale):

Disable SAML login until a fix is available.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Interim.**

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20240926-0008>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20240926 | Initial Public Release |
| 2.0 | 20240930 | StorageGRID (formerly StorageGRID Webscale) added to Software Versions and Fixes |
| 3.0 | 20241122 | ONTAP tools for VMware vSphere 10 moved to Products Not Affected |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from github.com_1df35baa_20250111_014643.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSAML-Toolkits%2Fruby-saml%2Fcommit%2F1ec5392bc506fe43a02dbb66b68741051c5ffeae)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSAML-Toolkits%2Fruby-saml%2Fcommit%2F1ec5392bc506fe43a02dbb66b68741051c5ffeae)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=SAML-Toolkits%2Fruby-saml)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SAML-Toolkits](/SAML-Toolkits)
/
**[ruby-saml](/SAML-Toolkits/ruby-saml)**
Public

* [Notifications](/login?return_to=%2FSAML-Toolkits%2Fruby-saml) You must be signed in to change notification settings
* [Fork
  569](/login?return_to=%2FSAML-Toolkits%2Fruby-saml)
* [Star
   924](/login?return_to=%2FSAML-Toolkits%2Fruby-saml)

* [Code](/SAML-Toolkits/ruby-saml)
* [Issues
  17](/SAML-Toolkits/ruby-saml/issues)
* [Pull requests
  7](/SAML-Toolkits/ruby-saml/pulls)
* [Actions](/SAML-Toolkits/ruby-saml/actions)
* [Projects
  0](/SAML-Toolkits/ruby-saml/projects)
* [Security](/SAML-Toolkits/ruby-saml/security)
* [Insights](/SAML-Toolkits/ruby-saml/pulse)

Additional navigation options

* [Code](/SAML-Toolkits/ruby-saml)
* [Issues](/SAML-Toolkits/ruby-saml/issues)
* [Pull requests](/SAML-Toolkits/ruby-saml/pulls)
* [Actions](/SAML-Toolkits/ruby-saml/actions)
* [Projects](/SAML-Toolkits/ruby-saml/projects)
* [Security](/SAML-Toolkits/ruby-saml/security)
* [Insights](/SAML-Toolkits/ruby-saml/pulse)

## Commit

[Permalink](/SAML-Toolkits/ruby-saml/commit/1ec5392bc506fe43a02dbb66b68741051c5ffeae)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Release 1.12.3 to include critical vulnerability [CVE-2024-45409](https://github.com/advisories/GHSA-jw9c-mfg7-9rx2 "CVE-2024-45409") fix

[Browse files](/SAML-Toolkits/ruby-saml/tree/1ec5392bc506fe43a02dbb66b68741051c5ffeae)
Browse the repository at this point in the history

* Loading branch information

[![@pitbulk](https://avatars.githubusercontent.com/u/600897?s=40&v=4)](/pitbulk)

[pitbulk](/SAML-Toolkits/ruby-saml/commits?author=pitbulk "View all commits by pitbulk")
committed
Sep 10, 2024

1 parent
[bbb4fb6](/SAML-Toolkits/ruby-saml/commit/bbb4fb6c483ade203b0cfde32a0843416b771491)

commit 1ec5392

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**24 additions**
and
**8 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* changelog.md
  [changelog.md](#diff-3bd14d078188074c410028847113ceae68865d0ad5b844a27183ef87fbe2fcc3)
* lib

  + onelogin/ruby-saml

    - lib/onelogin/ruby-saml/version.rb
      [version.rb](#diff-3c52fa63d935cd1227c846d73141e2a98f2769690903ceeddde9cc6ea112ab79)
  + lib/xml\_security.rb
    [xml\_security.rb](#diff-091398471b63b720a2fd9771bace3c21c3a590210259af1bf38446c1e0cf7598)

## There are no files selected for viewing

3 changes: 3 additions & 0 deletions

3
[changelog.md](#diff-3bd14d078188074c410028847113ceae68865d0ad5b844a27183ef87fbe2fcc3 "changelog.md")

Show comments

[View file](/SAML-Toolkits/ruby-saml/blob/1ec5392bc506fe43a02dbb66b68741051c5ffeae/changelog.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,5 +1,8 @@ |
|  |  | # RubySaml Changelog |
|  |  |  |
|  |  | ### 1.12.3 (Sep 10, 2024) |
|  |  | \* Fix for critical vulnerability CVE-2024-45409: SAML authentication bypass via Incorrect XPath selector |
|  |  |  |
|  |  | ### 1.12.2 (Apr 08, 2022) |
|  |  | \* [575](https://github.com/onelogin/ruby-saml/pull/575) Fix SloLogoutresponse bug on LogoutRequest |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[lib/onelogin/ruby-saml/version.rb](#diff-3c52fa63d935cd1227c846d73141e2a98f2769690903ceeddde9cc6ea112ab79 "lib/onelogin/ruby-saml/version.rb")

Show comments

[View file](/SAML-Toolkits/ruby-saml/blob/1ec5392bc506fe43a02dbb66b68741051c5ffeae/lib/onelogin/ruby-saml/version.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,5 @@ |
|  |  | module OneLogin |
|  |  | module RubySaml |
|  |  | VERSION = '1.12.2' |
|  |  | VERSION = '1.12.3' |
|  |  | end |
|  |  | end |

27 changes: 20 additions & 7 deletions

27
[lib/xml\_security.rb](#diff-091398471b63b720a2fd9771bace3c21c3a590210259af1bf38446c1e0cf7598 "lib/xml_security.rb")

Show comments

[View file](/SAML-Toolkits/ruby-saml/blob/1ec5392bc506fe43a02dbb66b68741051c5ffeae/lib/xml_security.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -312,17 +312,30 @@ def validate\_signature(base64\_cert, soft = true) |
|  |  | canon\_string = noko\_signed\_info\_element.canonicalize(canon\_algorithm) |
|  |  | noko\_sig\_element.remove |
|  |  |  |
|  |  | # get signed info |
|  |  | signed\_info\_element = REXML::XPath.first( |
|  |  | sig\_element, |
|  |  | "./ds:SignedInfo", |
|  |  | { "ds" => DSIG } |
|  |  | ) |
|  |  |  |
|  |  | # get inclusive namespaces |
|  |  | inclusive\_namespaces = extract\_inclusive\_namespaces |
|  |  |  |
|  |  | # check digests |
|  |  | ref = REXML::XPath.first(sig\_element, "//ds:Reference", {"ds"=>DSIG}) |
|  |  | ref = REXML::XPath.first(signed\_info\_element, "./ds:Reference", {"ds"=>DSIG}) |
|  |  |  |
|  |  | hashed\_element = document.at\_xpath("//\*[@ID=$id]", nil, { 'id' => extract\_signed\_element\_id }) |
|  |  | reference\_nodes = document.xpath("//\*[@ID=$id]", nil, { 'id' => extract\_signed\_element\_id }) |
|  |  |  |
|  |  | if reference\_nodes.length > 1 # ensures no elements with same ID to prevent signature wrapping attack. |
|  |  | return append\_error("Duplicated IDs found", soft) |
|  |  | end |
|  |  |  |
|  |  | hashed\_element = reference\_nodes[0] |
|  |  |  |
|  |  | canon\_algorithm = canon\_algorithm REXML::XPath.first( |
|  |  | ref, |
|  |  | '//ds:CanonicalizationMethod', |
|  |  | signed\_info\_element, |
|  |  | './ds:CanonicalizationMethod', |
|  |  | { "ds" => DSIG } |
|  |  | ) |
|  |  |  |
| Expand All | | @@ -332,13 +345,13 @@ def validate\_signature(base64\_cert, soft = true) |
|  |  |  |
|  |  | digest\_algorithm = algorithm(REXML::XPath.first( |
|  |  | ref, |
|  |  | "//ds:DigestMethod", |
|  |  | "./ds:DigestMethod", |
|  |  | { "ds" => DSIG } |
|  |  | )) |
|  |  | hash = digest\_algorithm.digest(canon\_hashed\_element) |
|  |  | encoded\_digest\_value = REXML::XPath.first( |
|  |  | ref, |
|  |  | "//ds:DigestValue", |
|  |  | "./ds:DigestValue", |
|  |  | { "ds" => DSIG } |
|  |  | ) |
|  |  | digest\_value = Base64.decode64(OneLogin::RubySaml::Utils.element\_text(encoded\_digest\_value)) |
| Expand All | | @@ -364,7 +377,7 @@ def validate\_signature(base64\_cert, soft = true) |
|  |  | def process\_transforms(ref, canon\_algorithm) |
|  |  | transforms = REXML::XPath.match( |
|  |  | ref, |
|  |  | "//ds:Transforms/ds:Transform", |
|  |  | "./ds:Transforms/ds:Transform", |
|  |  | { "ds" => DSIG } |
|  |  | ) |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `1ec5392`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSAML-Toolkits%2Fruby-saml%2Fcommit%2F1ec5392bc506fe43a02dbb66b68741051c5ffeae) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_36efa41c_20250111_014644.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSAML-Toolkits%2Fruby-saml%2Fsecurity%2Fadvisories%2FGHSA-jw9c-mfg7-9rx2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSAML-Toolkits%2Fruby-saml%2Fsecurity%2Fadvisories%2FGHSA-jw9c-mfg7-9rx2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=SAML-Toolkits%2Fruby-saml)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SAML-Toolkits](/SAML-Toolkits)
/
**[ruby-saml](/SAML-Toolkits/ruby-saml)**
Public

* [Notifications](/login?return_to=%2FSAML-Toolkits%2Fruby-saml) You must be signed in to change notification settings
* [Fork
  569](/login?return_to=%2FSAML-Toolkits%2Fruby-saml)
* [Star
   924](/login?return_to=%2FSAML-Toolkits%2Fruby-saml)

* [Code](/SAML-Toolkits/ruby-saml)
* [Issues
  17](/SAML-Toolkits/ruby-saml/issues)
* [Pull requests
  7](/SAML-Toolkits/ruby-saml/pulls)
* [Actions](/SAML-Toolkits/ruby-saml/actions)
* [Projects
  0](/SAML-Toolkits/ruby-saml/projects)
* [Security](/SAML-Toolkits/ruby-saml/security)
* [Insights](/SAML-Toolkits/ruby-saml/pulse)

Additional navigation options

* [Code](/SAML-Toolkits/ruby-saml)
* [Issues](/SAML-Toolkits/ruby-saml/issues)
* [Pull requests](/SAML-Toolkits/ruby-saml/pulls)
* [Actions](/SAML-Toolkits/ruby-saml/actions)
* [Projects](/SAML-Toolkits/ruby-saml/projects)
* [Security](/SAML-Toolkits/ruby-saml/security)
* [Insights](/SAML-Toolkits/ruby-saml/pulse)

# SAML authentication bypass via Incorrect XPath selector

Critical

[pitbulk](/pitbulk)
published
GHSA-jw9c-mfg7-9rx2
Sep 10, 2024

## Package

bundler

omniauth-saml
([RubyGems](/advisories?query=ecosystem%3Arubygems))

## Affected versions

<=2.1.0
<= 1.10.3

## Patched versions

2.2.0
1.10.5

bundler

ruby-saml
([RubyGems](/advisories?query=ecosystem%3Arubygems))

<=1.12.2 || >=1.13.0 <= 1.16.0

1.17.0, 1.12.3

## Description

Ruby-SAML in <= 12.2 and 1.13.0 <= 1.16.0 does not properly verify the signature of the SAML Response. An unauthenticated attacker with access to any signed saml document (by the IdP) can thus forge a SAML Response/Assertion with arbitrary contents. This would allow the attacker to log in as arbitrary user within the vulnerable system.

This vulnerability was reported by ahacker1 of SecureSAML (ahacker1@securesaml.com)

### Severity

Critical

10.0

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
High

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:N

### CVE ID

CVE-2024-45409

### Weaknesses

[CWE-347](/advisories?query=cwe%3A347)

### Credits

* [![@ahacker1-securesaml](https://avatars.githubusercontent.com/u/180476984?s=40&v=4)](/ahacker1-securesaml)
  [ahacker1-securesaml](/ahacker1-securesaml)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_72ce51fd_20250111_014643.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSAML-Toolkits%2Fruby-saml%2Fcommit%2F4865d030cae9705ee5cdb12415c654c634093ae7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSAML-Toolkits%2Fruby-saml%2Fcommit%2F4865d030cae9705ee5cdb12415c654c634093ae7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=SAML-Toolkits%2Fruby-saml)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SAML-Toolkits](/SAML-Toolkits)
/
**[ruby-saml](/SAML-Toolkits/ruby-saml)**
Public

* [Notifications](/login?return_to=%2FSAML-Toolkits%2Fruby-saml) You must be signed in to change notification settings
* [Fork
  569](/login?return_to=%2FSAML-Toolkits%2Fruby-saml)
* [Star
   924](/login?return_to=%2FSAML-Toolkits%2Fruby-saml)

* [Code](/SAML-Toolkits/ruby-saml)
* [Issues
  17](/SAML-Toolkits/ruby-saml/issues)
* [Pull requests
  7](/SAML-Toolkits/ruby-saml/pulls)
* [Actions](/SAML-Toolkits/ruby-saml/actions)
* [Projects
  0](/SAML-Toolkits/ruby-saml/projects)
* [Security](/SAML-Toolkits/ruby-saml/security)
* [Insights](/SAML-Toolkits/ruby-saml/pulse)

Additional navigation options

* [Code](/SAML-Toolkits/ruby-saml)
* [Issues](/SAML-Toolkits/ruby-saml/issues)
* [Pull requests](/SAML-Toolkits/ruby-saml/pulls)
* [Actions](/SAML-Toolkits/ruby-saml/actions)
* [Projects](/SAML-Toolkits/ruby-saml/projects)
* [Security](/SAML-Toolkits/ruby-saml/security)
* [Insights](/SAML-Toolkits/ruby-saml/pulse)

## Commit

[Permalink](/SAML-Toolkits/ruby-saml/commit/4865d030cae9705ee5cdb12415c654c634093ae7)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/SAML-Toolkits/ruby-saml/tree/4865d030cae9705ee5cdb12415c654c634093ae7)
Browse the repository at this point in the history

```
* Use correct XPaths and resolve to correct elements

* Update xml_security.rb

* Block references that resolve to multiple nodes to prevent signature wrapping attacks
```

* Loading branch information

[![@ahacker1-securesaml](https://avatars.githubusercontent.com/u/180476984?s=40&v=4)](/ahacker1-securesaml)

[ahacker1-securesaml](/SAML-Toolkits/ruby-saml/commits?author=ahacker1-securesaml "View all commits by ahacker1-securesaml")
authored
Sep 10, 2024

1 parent
[6e33ed3](/SAML-Toolkits/ruby-saml/commit/6e33ed341081c4692990e9540342d1460b6d7d32)

commit 4865d03

Showing
**1 changed file**
with
**19 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

26 changes: 19 additions & 7 deletions

26
[lib/xml\_security.rb](#diff-091398471b63b720a2fd9771bace3c21c3a590210259af1bf38446c1e0cf7598 "lib/xml_security.rb")

Show comments

[View file](/SAML-Toolkits/ruby-saml/blob/4865d030cae9705ee5cdb12415c654c634093ae7/lib/xml_security.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -310,17 +310,29 @@ def validate\_signature(base64\_cert, soft = true) |
|  |  | canon\_string = noko\_signed\_info\_element.canonicalize(canon\_algorithm) |
|  |  | noko\_sig\_element.remove |
|  |  |  |
|  |  | # get signed info |
|  |  | signed\_info\_element = REXML::XPath.first( |
|  |  | sig\_element, |
|  |  | "./ds:SignedInfo", |
|  |  | { "ds" => DSIG } |
|  |  | ) |
|  |  | # get inclusive namespaces |
|  |  | inclusive\_namespaces = extract\_inclusive\_namespaces |
|  |  |  |
|  |  | # check digests |
|  |  | ref = REXML::XPath.first(sig\_element, "//ds:Reference", {"ds"=>DSIG}) |
|  |  | ref = REXML::XPath.first(signed\_info\_element, "./ds:Reference", {"ds"=>DSIG}) |
|  |  |  |
|  |  | hashed\_element = document.at\_xpath("//\*[@ID=$id]", nil, { 'id' => extract\_signed\_element\_id }) |
|  |  | reference\_nodes = document.xpath("//\*[@ID=$id]", nil, { 'id' => extract\_signed\_element\_id }) |
|  |  |  |
|  |  | if reference\_nodes.length > 1 # ensures no elements with same ID to prevent signature wrapping attack. |
|  |  | return append\_error("Digest Mismatch", soft) |
|  |  | end |
|  |  |  |
|  |  | hashed\_element = reference\_nodes[0] |
|  |  |  |
|  |  | canon\_algorithm = canon\_algorithm REXML::XPath.first( |
|  |  | ref, |
|  |  | '//ds:CanonicalizationMethod', |
|  |  | signed\_info\_element, |
|  |  | './ds:CanonicalizationMethod', |
|  |  | { "ds" => DSIG } |
|  |  | ) |
|  |  |  |
| Expand All | | @@ -330,13 +342,13 @@ def validate\_signature(base64\_cert, soft = true) |
|  |  |  |
|  |  | digest\_algorithm = algorithm(REXML::XPath.first( |
|  |  | ref, |
|  |  | "//ds:DigestMethod", |
|  |  | "./ds:DigestMethod", |
|  |  | { "ds" => DSIG } |
|  |  | )) |
|  |  | hash = digest\_algorithm.digest(canon\_hashed\_element) |
|  |  | encoded\_digest\_value = REXML::XPath.first( |
|  |  | ref, |
|  |  | "//ds:DigestValue", |
|  |  | "./ds:DigestValue", |
|  |  | { "ds" => DSIG } |
|  |  | ) |
|  |  | digest\_value = Base64.decode64(OneLogin::RubySaml::Utils.element\_text(encoded\_digest\_value)) |
| Expand All | | @@ -362,7 +374,7 @@ def validate\_signature(base64\_cert, soft = true) |
|  |  | def process\_transforms(ref, canon\_algorithm) |
|  |  | transforms = REXML::XPath.match( |
|  |  | ref, |
|  |  | "//ds:Transforms/ds:Transform", |
|  |  | "./ds:Transforms/ds:Transform", |
|  |  | { "ds" => DSIG } |
|  |  | ) |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4865d03`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSAML-Toolkits%2Fruby-saml%2Fcommit%2F4865d030cae9705ee5cdb12415c654c634093ae7) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a9dc1ba1_20250111_014644.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fomniauth%2Fomniauth-saml%2Fsecurity%2Fadvisories%2FGHSA-cvp8-5r8g-fhvq)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fomniauth%2Fomniauth-saml%2Fsecurity%2Fadvisories%2FGHSA-cvp8-5r8g-fhvq)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=omniauth%2Fomniauth-saml)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[omniauth](/omniauth)
/
**[omniauth-saml](/omniauth/omniauth-saml)**
Public

* [Notifications](/login?return_to=%2Fomniauth%2Fomniauth-saml) You must be signed in to change notification settings
* [Fork
  206](/login?return_to=%2Fomniauth%2Fomniauth-saml)
* [Star
   338](/login?return_to=%2Fomniauth%2Fomniauth-saml)

* [Code](/omniauth/omniauth-saml)
* [Issues
  24](/omniauth/omniauth-saml/issues)
* [Pull requests
  4](/omniauth/omniauth-saml/pulls)
* [Actions](/omniauth/omniauth-saml/actions)
* [Projects
  0](/omniauth/omniauth-saml/projects)
* [Security](/omniauth/omniauth-saml/security)
* [Insights](/omniauth/omniauth-saml/pulse)

Additional navigation options

* [Code](/omniauth/omniauth-saml)
* [Issues](/omniauth/omniauth-saml/issues)
* [Pull requests](/omniauth/omniauth-saml/pulls)
* [Actions](/omniauth/omniauth-saml/actions)
* [Projects](/omniauth/omniauth-saml/projects)
* [Security](/omniauth/omniauth-saml/security)
* [Insights](/omniauth/omniauth-saml/pulse)

# Improper Verification of Cryptographic Signature in omniauth-saml

Critical

[bufferoverflow](/bufferoverflow)
published
GHSA-cvp8-5r8g-fhvq
Sep 11, 2024

## Package

bundler

omniauth-saml
([RubyGems](/advisories?query=ecosystem%3Arubygems))

## Affected versions

<= 2.1.0
<= 2.1.0
<= 1.10.3

## Patched versions

2.2.1
2.1.2
1.10.5

## Description

ruby-saml, the dependent SAML gem of omniauth-saml has a signature wrapping vulnerability in <= v1.12.0 and v1.13.0 to v1.16.0 , see [GHSA-jw9c-mfg7-9rx2](https://github.com/SAML-Toolkits/ruby-saml/security/advisories/GHSA-jw9c-mfg7-9rx2 "GHSA-jw9c-mfg7-9rx2")

As a result, omniauth-saml created a [new release](https://github.com/omniauth/omniauth-saml/releases) by upgrading ruby-saml to the patched versions v1.17.

### Severity

Critical

### CVE ID

CVE-2024-45409

### Weaknesses

[CWE-347](/advisories?query=cwe%3A347)

### Credits

* [![@ahacker1-securesaml](https://avatars.githubusercontent.com/u/180476984?s=40&v=4)](/ahacker1-securesaml)
  [ahacker1-securesaml](/ahacker1-securesaml)
  Reporter
* [![@suprnova32](https://avatars.githubusercontent.com/u/723365?s=40&v=4)](/suprnova32)
  [suprnova32](/suprnova32)
  Remediation reviewer
* [![@rajiv](https://avatars.githubusercontent.com/u/42373?s=40&v=4)](/rajiv)
  [rajiv](/rajiv)
  Remediation reviewer
* [![@bufferoverflow](https://avatars.githubusercontent.com/u/378909?s=40&v=4)](/bufferoverflow)
  [bufferoverflow](/bufferoverflow)
  Remediation developer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


