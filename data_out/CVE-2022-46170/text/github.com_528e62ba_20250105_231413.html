
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcodeigniter4%2FCodeIgniter4%2Fcommit%2Ff9fb6574fbeb5a4aa63f7ea87296523e10db9328)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcodeigniter4%2FCodeIgniter4%2Fcommit%2Ff9fb6574fbeb5a4aa63f7ea87296523e10db9328)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=codeigniter4%2FCodeIgniter4)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[codeigniter4](/codeigniter4)
/
**[CodeIgniter4](/codeigniter4/CodeIgniter4)**
Public

* [Notifications](/login?return_to=%2Fcodeigniter4%2FCodeIgniter4) You must be signed in to change notification settings
* [Fork
  1.9k](/login?return_to=%2Fcodeigniter4%2FCodeIgniter4)
* [Star
   5.5k](/login?return_to=%2Fcodeigniter4%2FCodeIgniter4)

* [Code](/codeigniter4/CodeIgniter4)
* [Issues
  71](/codeigniter4/CodeIgniter4/issues)
* [Pull requests
  22](/codeigniter4/CodeIgniter4/pulls)
* [Actions](/codeigniter4/CodeIgniter4/actions)
* [Projects
  0](/codeigniter4/CodeIgniter4/projects)
* [Security](/codeigniter4/CodeIgniter4/security)
* [Insights](/codeigniter4/CodeIgniter4/pulse)

Additional navigation options

* [Code](/codeigniter4/CodeIgniter4)
* [Issues](/codeigniter4/CodeIgniter4/issues)
* [Pull requests](/codeigniter4/CodeIgniter4/pulls)
* [Actions](/codeigniter4/CodeIgniter4/actions)
* [Projects](/codeigniter4/CodeIgniter4/projects)
* [Security](/codeigniter4/CodeIgniter4/security)
* [Insights](/codeigniter4/CodeIgniter4/pulse)

## Commit

[Permalink](/codeigniter4/CodeIgniter4/commit/f9fb6574fbeb5a4aa63f7ea87296523e10db9328)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-6cq5-8cj7-g558](https://github.com/advisories/GHSA-6cq5-8cj7-g558 "GHSA-6cq5-8cj7-g558")

[Browse files](/codeigniter4/CodeIgniter4/tree/f9fb6574fbeb5a4aa63f7ea87296523e10db9328)
Browse the repository at this point in the history

```
Fix session handlers bug
```

* Loading branch information

[![@MGatner](https://avatars.githubusercontent.com/u/17572847?s=40&v=4)](/MGatner)

[MGatner](/codeigniter4/CodeIgniter4/commits?author=MGatner "View all commits by MGatner")
authored
Dec 22, 2022

2 parents
[bd3343a](/codeigniter4/CodeIgniter4/commit/bd3343a0eee8d999369d6dee7c21df0a3d50ee20)
+
[3128af9](/codeigniter4/CodeIgniter4/commit/3128af94ff7e025edabfaf731367d8427fdd23a8)

commit f9fb657

 Show file tree

 Hide file tree

Showing
**11 changed files**
with
**131 additions**
and
**39 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* system/Session/Handlers

  + system/Session/Handlers/DatabaseHandler.php
    [DatabaseHandler.php](#diff-160a6654640fd6e392269f217c188d1836c51a3f5b50bc351fd5f0f1f7719801)
  + system/Session/Handlers/MemcachedHandler.php
    [MemcachedHandler.php](#diff-e1f3d6ae3cae5194b5dc94b2af341f571d38010e4880c60b57eb5f4d0c838626)
  + system/Session/Handlers/RedisHandler.php
    [RedisHandler.php](#diff-1a7b1fe40ddc58f0b240a268889a1952778b0631ce9db5f54cddaa359429dd60)
* user\_guide\_src/source

  + changelogs

    - user\_guide\_src/source/changelogs/v4.2.11.rst
      [v4.2.11.rst](#diff-0ecfd2be110cfd65234fdc061478dbad5e6a107bf2e7d0061c9149e3ebaa87fc)
  + installation

    - user\_guide\_src/source/installation/upgrade\_4211.rst
      [upgrade\_4211.rst](#diff-09b7418d05b0cfb40a7a068cca5db5ac4c50717bf343a8e9692574316f5f4f88)
  + libraries

    - user\_guide\_src/source/libraries/sessions.rst
      [sessions.rst](#diff-918d712ea81f7d420f08b6fafced8c5f4abe459d2c4552e76bf619dec950428e)
    - sessions

      * user\_guide\_src/source/libraries/sessions/039.php
        [039.php](#diff-e6ec9ec901500bcf6841c7b85cd7698fbf5c93a91316becb7f4e146a2b23532e)
      * user\_guide\_src/source/libraries/sessions/040.php
        [040.php](#diff-c4fd0878d380ad4e22867115739d0df6a0d6db33fa7fdb76343cab53ae6cf4e7)
      * user\_guide\_src/source/libraries/sessions/041.php
        [041.php](#diff-5ea47070f6ae0aac92272f7152508126ee956d8ef61a93d2be3d7e14bb908749)
      * user\_guide\_src/source/libraries/sessions/042.php
        [042.php](#diff-954c3bbd0ca6d5f87f949966801f9adea37d9c11a6775d12a2b3961114871b02)
      * user\_guide\_src/source/libraries/sessions/043.php
        [043.php](#diff-f708247bf714f6a6d228344e327f8a96e69de07a342a39afdd57bf9497b1aec5)

## There are no files selected for viewing

23 changes: 18 additions & 5 deletions

23
[system/Session/Handlers/DatabaseHandler.php](#diff-160a6654640fd6e392269f217c188d1836c51a3f5b50bc351fd5f0f1f7719801 "system/Session/Handlers/DatabaseHandler.php")

Show comments

[View file](/codeigniter4/CodeIgniter4/blob/f9fb6574fbeb5a4aa63f7ea87296523e10db9328/system/Session/Handlers/DatabaseHandler.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -60,12 +60,18 @@ class DatabaseHandler extends BaseHandler |
|  |  | \*/ |
|  |  | protected $rowExists = false; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* ID prefix for multiple session cookies |
|  |  | \*/ |
|  |  | protected string $idPrefix; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @throws SessionException |
|  |  | \*/ |
|  |  | public function \_\_construct(AppConfig $config, string $ipAddress) |
|  |  | { |
|  |  | parent::\_\_construct($config, $ipAddress); |
|  |  |  |
|  |  | $this->table = $config->sessionSavePath; |
|  |  |  |
|  |  | if (empty($this->table)) { |
| Expand All | | @@ -77,6 +83,9 @@ public function \_\_construct(AppConfig $config, string $ipAddress) |
|  |  | $this->db = Database::connect($this->DBGroup); |
|  |  |  |
|  |  | $this->platform = $this->db->getPlatform(); |
|  |  |  |
|  |  | // Add sessionCookieName for multiple session cookies. |
|  |  | $this->idPrefix = $config->sessionCookieName . ':'; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -115,7 +124,7 @@ public function read($id) |
|  |  | $this->sessionID = $id; |
|  |  | } |
|  |  |  |
|  |  | $builder = $this->db->table($this->table)->where('id', $id); |
|  |  | $builder = $this->db->table($this->table)->where('id', $this->idPrefix . $id); |
|  |  |  |
|  |  | if ($this->matchIP) { |
|  |  | $builder = $builder->where('ip\_address', $this->ipAddress); |
| Expand Down  Expand Up | | @@ -182,7 +191,7 @@ public function write($id, $data): bool |
|  |  |  |
|  |  | if ($this->rowExists === false) { |
|  |  | $insertData = [ |
|  |  | 'id' => $id, |
|  |  | 'id' => $this->idPrefix . $id, |
|  |  | 'ip\_address' => $this->ipAddress, |
|  |  | 'data' => $this->prepareData($data), |
|  |  | ]; |
| Expand All | | @@ -197,7 +206,7 @@ public function write($id, $data): bool |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | $builder = $this->db->table($this->table)->where('id', $id); |
|  |  | $builder = $this->db->table($this->table)->where('id', $this->idPrefix . $id); |
|  |  |  |
|  |  | if ($this->matchIP) { |
|  |  | $builder = $builder->where('ip\_address', $this->ipAddress); |
| Expand Down  Expand Up | | @@ -242,7 +251,7 @@ public function close(): bool |
|  |  | public function destroy($id): bool |
|  |  | { |
|  |  | if ($this->lock) { |
|  |  | $builder = $this->db->table($this->table)->where('id', $id); |
|  |  | $builder = $this->db->table($this->table)->where('id', $this->idPrefix . $id); |
|  |  |  |
|  |  | if ($this->matchIP) { |
|  |  | $builder = $builder->where('ip\_address', $this->ipAddress); |
| Expand Down  Expand Up | | @@ -276,7 +285,11 @@ public function gc($max\_lifetime) |
|  |  | $separator = ' '; |
|  |  | $interval = implode($separator, ['', "{$max\_lifetime} second", '']); |
|  |  |  |
|  |  | return $this->db->table($this->table)->where('timestamp <', "now() - INTERVAL {$interval}", false)->delete() ? 1 : $this->fail(); |
|  |  | return $this->db->table($this->table)->where( |
|  |  | 'timestamp <', |
|  |  | "now() - INTERVAL {$interval}", |
|  |  | false |
|  |  | )->delete() ? 1 : $this->fail(); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down | |  |

32 changes: 26 additions & 6 deletions

32
[system/Session/Handlers/MemcachedHandler.php](#diff-e1f3d6ae3cae5194b5dc94b2af341f571d38010e4880c60b57eb5f4d0c838626 "system/Session/Handlers/MemcachedHandler.php")

Show comments

[View file](/codeigniter4/CodeIgniter4/blob/f9fb6574fbeb5a4aa63f7ea87296523e10db9328/system/Session/Handlers/MemcachedHandler.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -61,6 +61,9 @@ public function \_\_construct(AppConfig $config, string $ipAddress) |
|  |  | throw SessionException::forEmptySavepath(); |
|  |  | } |
|  |  |  |
|  |  | // Add sessionCookieName for multiple session cookies. |
|  |  | $this->keyPrefix .= $config->sessionCookieName . ':'; |
|  |  |  |
|  |  | if ($this->matchIP === true) { |
|  |  | $this->keyPrefix .= $this->ipAddress . ':'; |
|  |  | } |
| Expand Down  Expand Up | | @@ -89,7 +92,14 @@ public function open($path, $name): bool |
|  |  | $serverList[] = $server['host'] . ':' . $server['port']; |
|  |  | } |
|  |  |  |
|  |  | if (! preg\_match\_all('#,?([^,:]+)\:(\d{1,5})(?:\:(\d+))?#', $this->savePath, $matches, PREG\_SET\_ORDER)) { |
|  |  | if ( |
|  |  | ! preg\_match\_all( |
|  |  | '#,?([^,:]+)\:(\d{1,5})(?:\:(\d+))?#', |
|  |  | $this->savePath, |
|  |  | $matches, |
|  |  | PREG\_SET\_ORDER |
|  |  | ) |
|  |  | ) { |
|  |  | $this->memcached = null; |
|  |  | $this->logger->error('Session: Invalid Memcached save path format: ' . $this->savePath); |
|  |  |  |
| Expand All | | @@ -99,13 +109,17 @@ public function open($path, $name): bool |
|  |  | foreach ($matches as $match) { |
|  |  | // If Memcached already has this server (or if the port is invalid), skip it |
|  |  | if (in\_array($match[1] . ':' . $match[2], $serverList, true)) { |
|  |  | $this->logger->debug('Session: Memcached server pool already has ' . $match[1] . ':' . $match[2]); |
|  |  | $this->logger->debug( |
|  |  | 'Session: Memcached server pool already has ' . $match[1] . ':' . $match[2] |
|  |  | ); |
|  |  |  |
|  |  | continue; |
|  |  | } |
|  |  |  |
|  |  | if (! $this->memcached->addServer($match[1], (int) $match[2], $match[3] ?? 0)) { |
|  |  | $this->logger->error('Could not add ' . $match[1] . ':' . $match[2] . ' to Memcached server pool.'); |
|  |  | $this->logger->error( |
|  |  | 'Could not add ' . $match[1] . ':' . $match[2] . ' to Memcached server pool.' |
|  |  | ); |
|  |  | } else { |
|  |  | $serverList[] = $match[1] . ':' . $match[2]; |
|  |  | } |
| Expand Down  Expand Up | | @@ -260,7 +274,9 @@ protected function lockSession(string $sessionID): bool |
|  |  | } |
|  |  |  |
|  |  | if (! $this->memcached->set($lockKey, Time::now()->getTimestamp(), 300)) { |
|  |  | $this->logger->error('Session: Error while trying to obtain lock for ' . $this->keyPrefix . $sessionID); |
|  |  | $this->logger->error( |
|  |  | 'Session: Error while trying to obtain lock for ' . $this->keyPrefix . $sessionID |
|  |  | ); |
|  |  |  |
|  |  | return false; |
|  |  | } |
| Expand All | | @@ -270,7 +286,9 @@ protected function lockSession(string $sessionID): bool |
|  |  | } while (++$attempt < 30); |
|  |  |  |
|  |  | if ($attempt === 30) { |
|  |  | $this->logger->error('Session: Unable to obtain lock for ' . $this->keyPrefix . $sessionID . ' after 30 attempts, aborting.'); |
|  |  | $this->logger->error( |
|  |  | 'Session: Unable to obtain lock for ' . $this->keyPrefix . $sessionID . ' after 30 attempts, aborting.' |
|  |  | ); |
|  |  |  |
|  |  | return false; |
|  |  | } |
| Expand All | | @@ -290,7 +308,9 @@ protected function releaseLock(): bool |
|  |  | ! $this->memcached->delete($this->lockKey) |
|  |  | && $this->memcached->getResultCode() !== Memcached::RES\_NOTFOUND |
|  |  | ) { |
|  |  | $this->logger->error('Session: Error while trying to free lock for ' . $this->lockKey); |
|  |  | $this->logger->error( |
|  |  | 'Session: Error while trying to free lock for ' . $this->lockKey |
|  |  | ); |
|  |  |  |
|  |  | return false; |
|  |  | } |
| Expand Down | |  |

3 changes: 3 additions & 0 deletions

3
[system/Session/Handlers/RedisHandler.php](#diff-1a7b1fe40ddc58f0b240a268889a1952778b0631ce9db5f54cddaa359429dd60 "system/Session/Handlers/RedisHandler.php")

Show comments

[View file](/codeigniter4/CodeIgniter4/blob/f9fb6574fbeb5a4aa63f7ea87296523e10db9328/system/Session/Handlers/RedisHandler.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -71,6 +71,9 @@ public function \_\_construct(AppConfig $config, string $ipAddress) |
|  |  |  |
|  |  | $this->setSavePath(); |
|  |  |  |
|  |  | // Add sessionCookieName for multiple session cookies. |
|  |  | $this->keyPrefix .= $config->sessionCookieName . ':'; |
|  |  |  |
|  |  | if ($this->matchIP === true) { |
|  |  | $this->keyPrefix .= $this->ipAddress . ':'; |
|  |  | } |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[user\_guide\_src/source/changelogs/v4.2.11.rst](#diff-0ecfd2be110cfd65234fdc061478dbad5e6a107bf2e7d0061c9149e3ebaa87fc "user_guide_src/source/changelogs/v4.2.11.rst")

Show comments

[View file](/codeigniter4/CodeIgniter4/blob/f9fb6574fbeb5a4aa63f7ea87296523e10db9328/user_guide_src/source/changelogs/v4.2.11.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -13,11 +13,15 @@ SECURITY |
|  |  | \*\*\*\*\*\*\*\* |
|  |  |  |
|  |  | - \*Attackers may spoof IP address when using proxy\* was fixed. See the `Security advisory GHSA-ghw3-5qvm-3mqc <https://github.com/codeigniter4/CodeIgniter4/security/advisories/GHSA-ghw3-5qvm-3mqc>`\_ for more information. |
|  |  | - \*Potential Session Handlers Vulnerability\* was fixed. See the `Security advisory GHSA-6cq5-8cj7-g558 <https://github.com/codeigniter4/CodeIgniter4/security/advisories/GHSA-6cq5-8cj7-g558>`\_ for more information. |
|  |  |  |
|  |  | BREAKING |
|  |  | \*\*\*\*\*\*\*\* |
|  |  |  |
|  |  | - The ``Config\App::$proxyIPs`` value format has been changed. See :ref:`Upgrading Guide <upgrade-4211-proxyips>`. |
|  |  | - The key of the session data record for :ref:`sessions-databasehandler-driver`, |
|  |  | :ref:`sessions-memcachedhandler-driver` and :ref:`sessions-redishandler-driver` |
|  |  | has changed. See :ref:`Upgrading Guide <upgrade-4211-session-key>`. |
|  |  |  |
|  |  | Bugs Fixed |
|  |  | \*\*\*\*\*\*\*\*\*\* |
| Expand Down | |  |

24 changes: 24 additions & 0 deletions

24
[user\_guide\_src/source/installation/upgrade\_4211.rst](#diff-09b7418d05b0cfb40a7a068cca5db5ac4c50717bf343a8e9692574316f5f4f88 "user_guide_src/source/installation/upgrade_4211.rst")

Show comments

[View file](/codeigniter4/CodeIgniter4/blob/f9fb6574fbeb5a4aa63f7ea87296523e10db9328/user_guide_src/source/installation/upgrade_4211.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -29,6 +29,29 @@ The config value format has been changed. Now you must set your proxy IP address |
|  |  |  |
|  |  | ``ConfigException`` will be thrown for old format config value. |
|  |  |  |
|  |  | .. \_upgrade-4211-session-key: |
|  |  |  |
|  |  | Session Handler Key Changes |
|  |  | =========================== |
|  |  |  |
|  |  | The key of the session data record for :ref:`sessions-databasehandler-driver`, |
|  |  | :ref:`sessions-memcachedhandler-driver` and :ref:`sessions-redishandler-driver` |
|  |  | has changed. Therefore, any existing session data will be invalidated after |
|  |  | the upgrade if you are using these session handlers. |
|  |  |  |
|  |  | - When using ``DatabaseHandler``, the ``id`` column value in the session table |
|  |  | now contains the session cookie name (``Config\App::$sessionCookieName``). |
|  |  | - When using ``MemcachedHandler`` or ``RedisHandler``, the key value contains |
|  |  | the session cookie name (``Config\App::$sessionCookieName``). |
|  |  |  |
|  |  | There is maximum length for the ``id`` column and Memcached key (250 bytes). |
|  |  | If the following values exceed those maximum length, the session will not work properly. |
|  |  |  |
|  |  | - the session cookie name, delimiter, and session id (32 characters by default) |
|  |  | when using ``DatabaseHandler`` |
|  |  | - the prefix (``ci\_session``), session cookie name, delimiters, and session id |
|  |  | when using ``MemcachedHandler`` |
|  |  |  |
|  |  | Project Files |
|  |  | \*\*\*\*\*\*\*\*\*\*\*\*\* |
|  |  |  |
| Expand All | | @@ -46,3 +69,4 @@ many will be simple comments or formatting that have no effect on the runtime: |
|  |  | \* app/Config/Toolbar.php |
|  |  | \* app/Views/welcome\_message.php |
|  |  | \* composer.json |
|  |  | \* phpunit.xml.dist |

69 changes: 44 additions & 25 deletions

69
[user\_guide\_src/source/libraries/sessions.rst](#diff-918d712ea81f7d420f08b6fafced8c5f4abe459d2c4552e76bf619dec950428e "user_guide_src/source/libraries/sessions.rst")

Show comments

[View file](/codeigniter4/CodeIgniter4/blob/f9fb6574fbeb5a4aa63f7ea87296523e10db9328/user_guide_src/source/libraries/sessions.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -358,8 +358,8 @@ same way: |
|  |  | unusable during the same request after you destroy the session. |
|  |  |  |
|  |  | You may also use the ``stop()`` method to completely kill the session |
|  |  | by removing the old session\_id, destroying all data, and destroying |
|  |  | the cookie that contained the session id: |
|  |  | by removing the old session ID, destroying all data, and destroying |
|  |  | the cookie that contained the session ID: |
|  |  |  |
|  |  | .. literalinclude:: sessions/038.php |
|  |  |  |
| Expand Down  Expand Up | | @@ -390,26 +390,35 @@ all of the options and their effects. |
|  |  | You'll find the following Session related preferences in your |
|  |  | \*\*app/Config/App.php\*\* file: |
|  |  |  |
|  |  | ============================== ============================================ ================================================= ============================================================================================ |
|  |  | Preference Default Options Description |
|  |  | ============================== ============================================ ================================================= ============================================================================================ |
|  |  | \*\*sessionDriver\*\* CodeIgniter\\Session\\Handlers\\FileHandler CodeIgniter\\Session\\Handlers\\FileHandler The session storage driver to use. |
|  |  | CodeIgniter\\Session\\Handlers\\DatabaseHandler |
|  |  | CodeIgniter\\Session\\Handlers\\MemcachedHandler |
|  |  | CodeIgniter\\Session\\Handlers\\RedisHandler |
|  |  | CodeIgniter\\Session\\Handlers\\ArrayHandler |
|  |  | \*\*sessionCookieName\*\* ci\_session [A-Za-z\\_-] characters only The name used for the session cookie. |
|  |  | \*\*sessionExpiration\*\* 7200 (2 hours) Time in seconds (integer) The number of seconds you would like the session to last. |
|  |  | If you would like a non-expiring session (until browser is closed) set the value to zero: 0 |
|  |  | \*\*sessionSavePath\*\* null None Specifies the storage location, depends on the driver being used. |
|  |  | \*\*sessionMatchIP\*\* false true/false (boolean) Whether to validate the user's IP address when reading the session cookie. |
|  |  | Note that some ISPs dynamically changes the IP, so if you want a non-expiring session you |
|  |  | will likely set this to false. |
|  |  | \*\*sessionTimeToUpdate\*\* 300 Time in seconds (integer) This option controls how often the session class will regenerate itself and create a new |
|  |  | session ID. Setting it to 0 will disable session ID regeneration. |
|  |  | \*\*sessionRegenerateDestroy\*\* false true/false (boolean) Whether to destroy session data associated with the old session ID when auto-regenerating |
|  |  | the session ID. When set to false, the data will be later deleted by the garbage collector. |
|  |  | ============================== ============================================ ================================================= ============================================================================================ |
|  |  | ============================== ================== =========================== ============================================================ |
|  |  | Preference Default Options Description |
|  |  | ============================== ================== =========================== ============================================================ |
|  |  | \*\*sessionDriver\*\* FileHandler::class FileHandler::class The session storage driver to use. |
|  |  | DatabaseHandler::class All the session drivers are located in the |
|  |  | MemcachedHandler::class ``CodeIgniter\Session\Handlers\`` namespace. |
|  |  | RedisHandler::class |
|  |  | ArrayHandler::class |
|  |  | \*\*sessionCookieName\*\* ci\_session [A-Za-z\\_-] characters only The name used for the session cookie. |
|  |  | The value will be included in the key of the |
|  |  | Database/Memcached/Redis session records. So, set the value |
|  |  | so that it does not exceed the maximum length of the key. |
|  |  | \*\*sessionExpiration\*\* 7200 (2 hours) Time in seconds (integer) The number of seconds you would like the session to last. |
|  |  | If you would like a non-expiring session (until browser is |
|  |  | closed) set the value to zero: 0 |
|  |  | \*\*sessionSavePath\*\* null None Specifies the storage location, depends on the driver being |
|  |  | used. |
|  |  | \*\*sessionMatchIP\*\* false true/false (boolean) Whether to validate the user's IP address when reading the |
|  |  | session cookie. Note that some ISPs dynamically changes the IP, |
|  |  | so if you want a non-expiring session you will likely set this |
|  |  | to false. |
|  |  | \*\*sessionTimeToUpdate\*\* 300 Time in seconds (integer) This option controls how often the session class will |
|  |  | regenerate itself and create a new session ID. Setting it to 0 |
|  |  | will disable session ID regeneration. |
|  |  | \*\*sessionRegenerateDestroy\*\* false true/false (boolean) Whether to destroy session data associated with the old |
|  |  | session ID when auto-regenerating |
|  |  | the session ID. When set to false, the data will be later |
|  |  | deleted by the garbage collector. |
|  |  | ============================== ================== =========================== ============================================================ |
|  |  |  |
|  |  | .. note:: As a last resort, the Session library will try to fetch PHP's |
|  |  | session related INI settings, as well as legacy CI settings such as |
| Expand Down  Expand Up | | @@ -498,9 +507,9 @@ permissions will probably break your application. |
|  |  | Instead, you should do something like this, depending on your environment |
|  |  | :: |
|  |  |  |
|  |  | mkdir /<path to your application directory>/Writable/sessions/ |
|  |  | chmod 0700 /<path to your application directory>/Writable/sessions/ |
|  |  | chown www-data /<path to your application directory>/Writable/sessions/ |
|  |  | > mkdir /<path to your application directory>/writable/sessions/ |
|  |  | > chmod 0700 /<path to your application directory>/writable/sessions/ |
|  |  | > chown www-data /<path to your application directory>/writable/sessions/ |
|  |  |  |
|  |  | Bonus Tip |
|  |  | --------- |
| Expand All | | @@ -518,6 +527,8 @@ In addition, if performance is your only concern, you may want to look |
|  |  | into using `tmpfs <https://eddmann.com/posts/storing-php-sessions-file-caches-in-memory-using-tmpfs/>`\_, |
|  |  | (warning: external resource), which can make your sessions blazing fast. |
|  |  |  |
|  |  | .. \_sessions-databasehandler-driver: |
|  |  |  |
|  |  | DatabaseHandler Driver |
|  |  | ====================== |
|  |  |  |
| Expand Down  Expand Up | | @@ -561,6 +572,10 @@ For PostgreSQL:: |
|  |  |  |
|  |  | CREATE INDEX "ci\_sessions\_timestamp" ON "ci\_sessions" ("timestamp"); |
|  |  |  |
|  |  | .. note:: The ``id`` value contains the session cookie name (``Config\App::$sessionCookieName``) |
|  |  | and the session ID and a delimiter. It should be increased as needed, for example, |
|  |  | when using long session IDs. |
|  |  |  |
|  |  | You will also need to add a PRIMARY KEY \*\*depending on your 'sessionMatchIP' |
|  |  | setting\*\*. The examples below work both on MySQL and PostgreSQL:: |
|  |  |  |
| Expand Down  Expand Up | | @@ -595,6 +610,8 @@ when it generates the code. |
|  |  | done processing session data if you're having performance |
|  |  | issues. |
|  |  |  |
|  |  | .. \_sessions-redishandler-driver: |
|  |  |  |
|  |  | RedisHandler Driver |
|  |  | =================== |
|  |  |  |
| Expand Down  Expand Up | | @@ -631,6 +648,8 @@ sufficient: |
|  |  |  |
|  |  | .. literalinclude:: sessions/041.php |
|  |  |  |
|  |  | .. \_sessions-memcachedhandler-driver: |
|  |  |  |
|  |  | MemcachedHandler Driver |
|  |  | ======================= |
|  |  |  |
| Expand Down | |  |

4 changes: 3 additions & 1 deletion

4
[user\_guide\_src/source/libraries/sessions/039.php](#diff-e6ec9ec901500bcf6841c7b85cd7698fbf5c93a91316becb7f4e146a2b23532e "user_guide_src/source/libraries/sessions/039.php")

Show comments

[View file](/codeigniter4/CodeIgniter4/blob/f9fb6574fbeb5a4aa63f7ea87296523e10db9328/user_guide_src/source/libraries/sessions/039.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,7 +6,9 @@ |
|  |  |  |
|  |  | class App extends BaseConfig |
|  |  | { |
|  |  | public $sessionDriver = 'CodeIgniter\Session\Handlers\DatabaseHandler'; |
|  |  | // ... |
|  |  | public $sessionDriver = 'CodeIgniter\Session\Handlers\DatabaseHandler'; |
|  |  | // ... |
|  |  | public $sessionSavePath = 'ci\_sessions'; |
|  |  | // ... |
|  |  | } |

1 change: 1 addition & 0 deletions

1
[user\_guide\_src/source/libraries/sessions/040.php](#diff-c4fd0878d380ad4e22867115739d0df6a0d6db33fa7fdb76343cab53ae6cf4e7 "user_guide_src/source/libraries/sessions/040.php")

Show comments

[View file](/codeigniter4/CodeIgniter4/blob/f9fb6574fbeb5a4aa63f7ea87296523e10db9328/user_guide_src/source/libraries/sessions/040.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,6 +6,7 @@ |
|  |  |  |
|  |  | class App extends BaseConfig |
|  |  | { |
|  |  | // ... |
|  |  | public $sessionDBGroup = 'groupName'; |
|  |  | // ... |
|  |  | } |

4 changes: 3 additions & 1 deletion

4
[user\_guide\_src/source/libraries/sessions/041.php](#diff-5ea47070f6ae0aac92272f7152508126ee956d8ef61a93d2be3d7e14bb908749 "user_guide_src/source/libraries/sessions/041.php")

Show comments

[View file](/codeigniter4/CodeIgniter4/blob/f9fb6574fbeb5a4aa63f7ea87296523e10db9328/user_guide_src/source/libraries/sessions/041.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,7 +6,9 @@ |
|  |  |  |
|  |  | class App extends BaseConfig |
|  |  | { |
|  |  | public $sessionDiver = 'CodeIgniter\Session\Handlers\RedisHandler'; |
|  |  | // ... |
|  |  | public $sessionDiver = 'CodeIgniter\Session\Handlers\RedisHandler'; |
|  |  | // ... |
|  |  | public $sessionSavePath = 'tcp://localhost:6379'; |
|  |  | // ... |
|  |  | } |

4 changes: 3 additions & 1 deletion

4
[user\_guide\_src/source/libraries/sessions/042.php](#diff-954c3bbd0ca6d5f87f949966801f9adea37d9c11a6775d12a2b3961114871b02 "user_guide_src/source/libraries/sessions/042.php")

Show comments

[View file](/codeigniter4/CodeIgniter4/blob/f9fb6574fbeb5a4aa63f7ea87296523e10db9328/user_guide_src/source/libraries/sessions/042.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,7 +6,9 @@ |
|  |  |  |
|  |  | class App extends BaseConfig |
|  |  | { |
|  |  | public $sessionDriver = 'CodeIgniter\Session\Handlers\MemcachedHandler'; |
|  |  | // ... |
|  |  | public $sessionDriver = 'CodeIgniter\Session\Handlers\MemcachedHandler'; |
|  |  | // ... |
|  |  | public $sessionSavePath = 'localhost:11211'; |
|  |  | // ... |
|  |  | } |

2 changes: 2 additions & 0 deletions

2
[user\_guide\_src/source/libraries/sessions/043.php](#diff-f708247bf714f6a6d228344e327f8a96e69de07a342a39afdd57bf9497b1aec5 "user_guide_src/source/libraries/sessions/043.php")

Show comments

[View file](/codeigniter4/CodeIgniter4/blob/f9fb6574fbeb5a4aa63f7ea87296523e10db9328/user_guide_src/source/libraries/sessions/043.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,6 +6,8 @@ |
|  |  |  |
|  |  | class App extends BaseConfig |
|  |  | { |
|  |  | // ... |
|  |  |  |
|  |  | // localhost will be given higher priority (5) here, |
|  |  | // compared to 192.0.2.1 with a weight of 1. |
|  |  | public $sessionSavePath = 'localhost:11211:5,192.0.2.1:11211:1'; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f9fb657`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcodeigniter4%2FCodeIgniter4%2Fcommit%2Ff9fb6574fbeb5a4aa63f7ea87296523e10db9328) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

