<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>oss-security - CPython CVE-2024-6923: Email header injection due to unquoted
 newlines</title>

<link href="/style.css" type="text/css" rel="stylesheet">
<style type="text/css">
.calendar { text-align: center; }
.ccell { background: #ccc; width: 5ex; padding: 2px; }

.cal_brief { text-align: center; }
.cal_brief td:first-child { background: inherit; }
.cal_brief td { background: #ccc; width: 5ex; padding: 2px; }
.cal_big { text-align: center; padding: 0; margin: 0; }
.cal_big td { padding: 0 2px; }
.cal_mon { text-align: center; }
.cal_mon th { font-size: small; padding: 0; margin: 0; }
.cal_mon td { background: #ccc; width: 5ex; height: 1.5em;
	padding: 2px; text-align: right; }
.cal_mon td[colspan] { background: inherit; }
.cal_mon sup { color: #F0F0F0; text-align: left; float: left;
	margin-top: -2pt; font-weight: bold; }
.cal_mon a { text-align: right; margin-left: -4em; float: right; }
</style>
</head>

<BODY bgcolor="#E0E0E0" text="black" link="blue" alink="red" vlink="navy">


<table bgcolor="#ffffff" width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>

<td>
<a href="/"><img class="logo" src="/logo.png" border="0" width="182" height="80" alt="Openwall"></a>
<td width="100%">
<div class="nav">
<ul>
<li><a href="/">Products</a>
<ul>
<li><a href="/Owl/">Openwall GNU/*/Linux &nbsp; <i>server OS</i></a>
<li><a href="/lkrg/">Linux Kernel Runtime Guard</a>
<li><a href="/john/">John the Ripper &nbsp; <i>password cracker</i></a>
<ul>
<li><a href="/john/">Free &amp; Open Source for any platform</a>
<li><a href="/john/cloud/">in the cloud</a>
<li><a href="/john/pro/linux/">Pro for Linux</a>
<li><a href="/john/pro/macosx/">Pro for macOS</a>
</ul>
<li><a href="/wordlists/">Wordlists &nbsp; <i>for password cracking</i></a>
<li><a href="/passwdqc/">passwdqc &nbsp; <i>policy enforcement</i></a>
<ul>
<li><a href="/passwdqc/">Free &amp; Open Source for Unix</a>
<li><a href="/passwdqc/windows/">Pro for Windows (Active Directory)</a>
</ul>
<li><a href="/yescrypt/">yescrypt &nbsp; <i>KDF &amp; password hashing</i></a>
<li><a href="/yespower/">yespower &nbsp; <i>Proof-of-Work (PoW)</i></a>
<li><a href="/crypt/">crypt_blowfish &nbsp; <i>password hashing</i></a>
<li><a href="/phpass/">phpass &nbsp; <i>ditto in PHP</i></a>
<li><a href="/tcb/">tcb &nbsp; <i>better password shadowing</i></a>
<li><a href="/pam/">Pluggable Authentication Modules</a>
<li><a href="/scanlogd/">scanlogd &nbsp; <i>port scan detector</i></a>
<li><a href="/popa3d/">popa3d &nbsp; <i>tiny POP3 daemon</i></a>
<li><a href="/blists/">blists &nbsp; <i>web interface to mailing lists</i></a>
<li><a href="/msulogin/">msulogin &nbsp; <i>single user mode login</i></a>
<li><a href="/php_mt_seed/">php_mt_seed &nbsp; <i>mt_rand() cracker</i></a>
</ul>
<li><a href="/services/">Services</a>
<li id="narrow-li-1"><a>Publications</a>
<ul>
<li><a href="/articles/">Articles</a>
<li><a href="/presentations/">Presentations</a>
</ul>
<li><a>Resources</a>
<ul>
<li><a href="/lists/">Mailing lists</a>
<li><a href="https://openwall.info/wiki/">Community wiki</a>
<li><a href="https://github.com/openwall">Source code repositories (GitHub)</a>
<li><a href="https://cvsweb.openwall.com">Source code repositories (CVSweb)</a>
<li><a href="/mirrors/">File archive &amp; mirrors</a>
<li><a href="/signatures/">How to verify digital signatures</a>
<li><a href="/ove/">OVE IDs</a>
</ul>
<li id="last-li"><a href="/news">What's new</a>
</ul>
</div>


</table>


<TABLE bgcolor="#B4D0DC" width="100%" border="0" cellspacing="0" cellpadding="1">
<TR><TD>
<TABLE width="100%" border="0" cellspacing="0" cellpadding="2">
<TR><TD bgcolor="#ECF8FF">
<a href="https://hashsuite.openwall.net">
Hash Suite - Windows password security audit tool. GUI, reports in PDF.</a>

</TABLE>
</TABLE>

<a href="2">[&lt;prev]</a> <a href="../../../2024/08/02/1">[next&gt;]</a> <a href="../../../2024/08/02/2">[thread-next&gt;]</a> <a href=".">[day]</a> <a href="..">[month]</a> <a href="../..">[year]</a> <a href="../../..">[list]</a>
<pre style="white-space: pre-wrap">
Message-ID: &lt;f787c960-d069-43c5-b106-fb72bda132cd&#64;oracle.com&gt;
Date: Thu, 1 Aug 2024 14:28:38 -0700
From: Alan Coopersmith &lt;alan.coopersmith&#64;...cle.com&gt;
To: oss-security&#64;...ts.openwall.com
Subject: CPython CVE-2024-6923: Email header injection due to unquoted
 newlines

----- Begin Forwarded Message -----
Subject: 	[Security-announce][CVE-2024-6923] Email header injection due to unquoted newlines
Date: 	Thu, 1 Aug 2024 08:38:53 -0500
From: 	Seth Larson &lt;seth&#64;...hon.org&gt;
Reply-To: 	security-sig&#64;...hon.org
To: 	security-announce&#64;...hon.org

There is a MEDIUM severity vulnerability affecting CPython.

The email module didnâ€™t properly quote newlines for email headers when serializing an email message allowing for header injection when an email is serialized.

Please see the linked CVE for the latest information on affected versions:

* <a href="https://www.cve.org/CVERecord?id=CVE-2024-6923" rel="nofollow">https://www.cve.org/CVERecord?id=CVE-2024-6923</a>
* <a href="https://github.com/python/cpython/pull/122233" rel="nofollow">https://github.com/python/cpython/pull/122233</a>
* <a href="https://github.com/python/cpython/issues/121650" rel="nofollow">https://github.com/python/cpython/issues/121650</a>

------ End Forwarded Message ------

The original bug report stated:

&gt; If a parsed email header contains a correctly quoted newline, setting an
&gt; email header to that value will include a newline.
&gt; 
&gt; from email import message_from_string
&gt; from email.policy import default
&gt; 
&gt; email_in = """\
&gt; To: incoming+tag&#64;...example.com
&gt; From: External Sender &lt;sender&#64;...m.example.com&gt;
&gt; Subject: Here's an =?UTF-8?Q?embedded_newline=0A?=
&gt; Content-Type: text/html; charset=UTF-8
&gt; Content-Transfer-Encoding: quoted-printable
&gt; MIME-Version: 1.0
&gt; 
&gt; &lt;html&gt;
&gt; &lt;head&gt;&lt;title&gt;An embeded newline&lt;/title&gt;&lt;/head&gt;
&gt; &lt;body&gt;
&gt;   &lt;p&gt;I sent you an embedded newline in the subject. How do you like that?!&lt;/p&gt;
&gt; &lt;/body&gt;
&gt; &lt;/html&gt;
&gt; """
&gt; 
&gt; msg = message_from_string(email_in, policy=default)
&gt; msg = message_from_string(email_in, policy=default)
&gt; for header, value in msg.items():
&gt;     del msg[header]
&gt;     msg[header] = value
&gt; email_out = str(msg)
&gt; print(email_out)
&gt; 
&gt; Output is:
&gt; 
&gt; To: incoming+tag&#64;...example.com
&gt; From: External Sender &lt;sender&#64;...m.example.com&gt;
&gt; Subject: Here's an embedded newline
&gt; 
&gt; Content-Type: text/html; charset="UTF-8"
&gt; Content-Transfer-Encoding: quoted-printable
&gt; MIME-Version: 1.0
&gt; 
&gt; &lt;html&gt;
&gt; &lt;head&gt;&lt;title&gt;An embeded newline&lt;/title&gt;&lt;/head&gt;
&gt; &lt;body&gt;
&gt;   &lt;p&gt;I sent you an embedded newline in the subject. How do you like that?!&lt;/p&gt;
&gt; &lt;/body&gt;
&gt; &lt;/html&gt;
&gt; 
&gt; An email parser will interpret the newline as the start of the message.
&gt; In this case, the Content-Type and other MIME headers will not be
&gt; processed, and the email treated as plain text. In other cases,
&gt; required headers like To may not be processed and the email will not
&gt; be delivered.

A later update noted:

&gt; On further investigation, a plain string with a trailing newline has this issue:
&gt; 
&gt; email["Subject"] = "string with newlines\n"
&gt; 
&gt; So the "re-use parsed header" is not part of the issue. 


</pre>
<p><a href="https://www.openwall.com/blists/">Powered by blists</a> - <a href="https://lists.openwall.net">more mailing lists</a>


<p>
Please check out the
<a href="https://oss-security.openwall.org/wiki/">
Open Source Software Security Wiki</a>, which is counterpart to this
<a href="https://oss-security.openwall.org/wiki/mailing-lists/oss-security">mailing list</a>.
<p>
Confused about <a href="/lists/">mailing lists</a> and their use?
<a href="https://en.wikipedia.org/wiki/Electronic_mailing_list">Read about mailing lists on Wikipedia</a>
and check out these
<a href="https://www.complang.tuwien.ac.at/anton/mail-news-errors.html">guidelines on proper formatting of your messages</a>.
<p>

</body>
</html>
