
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgrafana%2Fgrafana%2Fpull%2F60256)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgrafana%2Fgrafana%2Fpull%2F60256)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=grafana%2Fgrafana)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[grafana](/grafana)
/
**[grafana](/grafana/grafana)**
Public

* [Notifications](/login?return_to=%2Fgrafana%2Fgrafana) You must be signed in to change notification settings
* [Fork
  12.3k](/login?return_to=%2Fgrafana%2Fgrafana)
* [Star
   65.8k](/login?return_to=%2Fgrafana%2Fgrafana)

* [Code](/grafana/grafana)
* [Issues
  3.9k](/grafana/grafana/issues)
* [Pull requests
  281](/grafana/grafana/pulls)
* [Discussions](/grafana/grafana/discussions)
* [Actions](/grafana/grafana/actions)
* [Projects
  6](/grafana/grafana/projects)
* [Security](/grafana/grafana/security)
* [Insights](/grafana/grafana/pulse)

Additional navigation options

* [Code](/grafana/grafana)
* [Issues](/grafana/grafana/issues)
* [Pull requests](/grafana/grafana/pulls)
* [Discussions](/grafana/grafana/discussions)
* [Actions](/grafana/grafana/actions)
* [Projects](/grafana/grafana/projects)
* [Security](/grafana/grafana/security)
* [Insights](/grafana/grafana/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgrafana%2Fgrafana%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgrafana%2Fgrafana%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [v9.2.x] Snapshots: Build snapshot originalUrl on the backend (#60232) #60256

 Merged

[axelavargas](/axelavargas)
merged 1 commit into
[v9.2.x](/grafana/grafana/tree/v9.2.x "grafana/grafana:v9.2.x")
from
[backport-60232-to-v9.2.x-2](/grafana/grafana/tree/backport-60232-to-v9.2.x-2 "grafana/grafana:backport-60232-to-v9.2.x-2")

Dec 13, 2022

 Merged

# [[v9.2.x] Snapshots: Build snapshot originalUrl on the backend (#60232)](#top) #60256

[axelavargas](/axelavargas)
merged 1 commit into
[v9.2.x](/grafana/grafana/tree/v9.2.x "grafana/grafana:v9.2.x")
from
[backport-60232-to-v9.2.x-2](/grafana/grafana/tree/backport-60232-to-v9.2.x-2 "grafana/grafana:backport-60232-to-v9.2.x-2")

Dec 13, 2022

[Conversation
0](/grafana/grafana/pull/60256)
[Commits
1](/grafana/grafana/pull/60256/commits)
[Checks
0](/grafana/grafana/pull/60256/checks)
[Files changed](/grafana/grafana/pull/60256/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![axelavargas](https://avatars.githubusercontent.com/u/239999?s=60&v=4)](/axelavargas)

Copy link

Member

### @axelavargas **[axelavargas](/axelavargas)** commented [Dec 13, 2022](#issue-1494544934)

manual backport [#60232](https://github.com/grafana/grafana/pull/60232)

Sorry, something went wrong.

All reactions

[![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas)
[axelavargas](/axelavargas)
added
[backport](/grafana/grafana/labels/backport)
A backport PR
[no-changelog](/grafana/grafana/labels/no-changelog)
Skip including change in changelog/release notes
labels
[Dec 13, 2022](#event-8027179153)

[![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas)
[axelavargas](/axelavargas)
added this to the [9.2.8](/grafana/grafana/milestone/366) milestone
[Dec 13, 2022](#event-8027179174)

[![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas)
[axelavargas](/axelavargas)
self-assigned this
[Dec 13, 2022](#event-8027179241)

 [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas)
[axelavargas](/axelavargas)
requested review from
a team
as [code owners](/grafana/grafana/blob/3c68684dd2594e747af59423ea5c7855ff72877c/.github/CODEOWNERS#L114)
[December 13, 2022 15:50](#event-8027179254)

 [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas)
[axelavargas](/axelavargas)
requested a review
from a team
[December 13, 2022 15:50](#event-8027179284)

 [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas)
[axelavargas](/axelavargas)
requested a review
from a team
as a [code owner](/grafana/grafana/blob/3c68684dd2594e747af59423ea5c7855ff72877c/.github/CODEOWNERS#L37)
[December 13, 2022 15:50](#event-8027179294)

 [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas)
[axelavargas](/axelavargas)
requested review from
[ashharrison90](/ashharrison90),
[JoaoSilvaGrafana](/JoaoSilvaGrafana),
[jackw](/jackw),
[codeincarnate](/codeincarnate),
[oscarkilhed](/oscarkilhed),
[mildwonkey](/mildwonkey),
[idafurjes](/idafurjes) and
[yangkb09](/yangkb09)
and removed request for
a team
[December 13, 2022 15:50](#event-8027179330)

[![@grafanabot](https://avatars.githubusercontent.com/u/43478413?s=40&u=a7be21af02d82dcfe4d68822d6add1dc78b445b1&v=4)](/grafanabot)
[grafanabot](/grafanabot)
added
[area/frontend](/grafana/grafana/labels/area/frontend)
[area/backend](/grafana/grafana/labels/area/backend)
labels
[Dec 13, 2022](#event-8027185892)

[![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas)
[axelavargas](/axelavargas)
mentioned this pull request
[Dec 13, 2022](#ref-pullrequest-1494337772)

[[v9.2.x] Snapshots: Build snapshot originalUrl on the backend (#60232)
#60247](/grafana/grafana/pull/60247)
 Closed

[![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&v=4)](/axelavargas)

`[Snapshots: Build snapshot originalUrl on the backend (](/grafana/grafana/pull/60256/commits/1da14a67d265b89f0a41688c7ca9ac05c733ca5e "Snapshots: Build snapshot originalUrl on the backend (#60232)
* Snapshots: Fix originalUrl spoof security issue

* Store relative URL only & validate UID

* use existing modal management tools

* Dummy commit to nudge CI

* Remove unused hooks file

* Fix import after backport

* Backport fixes

Co-authored-by: kay delaney <kay@grafana.com>
(cherry picked from commit 239888f)

backport fix

add missing prop to ConfirmModal after mergin conflicts")[#60232](https://github.com/grafana/grafana/pull/60232)[)](/grafana/grafana/pull/60256/commits/1da14a67d265b89f0a41688c7ca9ac05c733ca5e "Snapshots: Build snapshot originalUrl on the backend (#60232)
* Snapshots: Fix originalUrl spoof security issue

* Store relative URL only & validate UID

* use existing modal management tools

* Dummy commit to nudge CI

* Remove unused hooks file

* Fix import after backport

* Backport fixes

Co-authored-by: kay delaney <kay@grafana.com>
(cherry picked from commit 239888f)

backport fix

add missing prop to ConfirmModal after mergin conflicts")`
 …

`[1da14a6](/grafana/grafana/pull/60256/commits/1da14a67d265b89f0a41688c7ca9ac05c733ca5e)`

```
* Snapshots: Fix originalUrl spoof security issue

* Store relative URL only & validate UID

* use existing modal management tools

* Dummy commit to nudge CI

* Remove unused hooks file

* Fix import after backport

* Backport fixes

Co-authored-by: kay delaney <kay@grafana.com>
(cherry picked from commit [239888f](https://github.com/grafana/grafana/commit/239888f22983010576bb3a9135a7294e88c0c74a))

backport fix

add missing prop to ConfirmModal after mergin conflicts
```

 [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas)
[axelavargas](/axelavargas)
[force-pushed](/grafana/grafana/compare/18e7e745672adcec6c28e7eae56e577e447684d3..1da14a67d265b89f0a41688c7ca9ac05c733ca5e)
the
backport-60232-to-v9.2.x-2

branch
from
[`18e7e74`](/grafana/grafana/commit/18e7e745672adcec6c28e7eae56e577e447684d3) to
[`1da14a6`](/grafana/grafana/commit/1da14a67d265b89f0a41688c7ca9ac05c733ca5e)  [Compare](/grafana/grafana/compare/18e7e745672adcec6c28e7eae56e577e447684d3..1da14a67d265b89f0a41688c7ca9ac05c733ca5e)
[December 13, 2022 15:57](#event-8027255637)

 [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas)
[axelavargas](/axelavargas)
removed request for
[ashharrison90](/ashharrison90),
[JoaoSilvaGrafana](/JoaoSilvaGrafana),
[jackw](/jackw),
[codeincarnate](/codeincarnate) and
[oscarkilhed](/oscarkilhed)
[December 13, 2022 16:02](#event-8027312804)

 [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas)
[axelavargas](/axelavargas)
requested review from
[ivanortegaalba](/ivanortegaalba),
[dprokop](/dprokop) and
[malcolmholmes](/malcolmholmes)
and removed request for
[mildwonkey](/mildwonkey),
[idafurjes](/idafurjes) and
[yangkb09](/yangkb09)
[December 13, 2022 16:02](#event-8027312841)

[![ivanortegaalba](https://avatars.githubusercontent.com/u/5699976?s=60&v=4)](/ivanortegaalba)

**[ivanortegaalba](/ivanortegaalba)**
approved these changes
[Dec 13, 2022](#pullrequestreview-1215831993)

 [View reviewed changes](/grafana/grafana/pull/60256/files/1da14a67d265b89f0a41688c7ca9ac05c733ca5e)

[![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas)
[axelavargas](/axelavargas)
merged commit [`d7dcea7`](/grafana/grafana/commit/d7dcea71ea763780dc286792a0afd560bff2985c)
into
v9.2.x

[Dec 13, 2022](https://github.com/grafana/grafana/pull/60256#event-8027866250)

 [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas)
[axelavargas](/axelavargas)
deleted the
backport-60232-to-v9.2.x-2

branch
[December 13, 2022 16:43](#event-8027866406)

[![@zerok](https://avatars.githubusercontent.com/u/3782?s=40&v=4)](/zerok)
[zerok](/zerok)
modified the milestones:
[9.2.8](/grafana/grafana/milestone/366),
[9.2.10](/grafana/grafana/milestone/374)
[Jan 25, 2023](#event-8352584674)

[matejkubinec](/matejkubinec)
added a commit
to percona/grafana
that referenced
this pull request
[Mar 16, 2023](#ref-commit-d527b3a)
[![@matejkubinec](https://avatars.githubusercontent.com/u/32638572?s=40&u=f15b1e5f63d6faa5145a40e4164e0fa9ea72fff7&v=4)](/matejkubinec) [![@grafanabot](https://avatars.githubusercontent.com/u/43478413?s=40&u=a7be21af02d82dcfe4d68822d6add1dc78b445b1&v=4)](/grafanabot)
[![@nmarrs](https://avatars.githubusercontent.com/u/22381771?s=40&u=ccb32ecdc60cfb1698f45febb3b0bbce6038dc13&v=4)](/nmarrs) [![@ArturWierzbicki](https://avatars.githubusercontent.com/u/23451458?s=40&u=1f9adee1a1f94b4c245b838df05d6662400cea34&v=4)](/ArturWierzbicki) [![@mdvictor](https://avatars.githubusercontent.com/u/36818606?s=40&u=ce9025a7a04ae6e1a483480620fbc96442c74e43&v=4)](/mdvictor) [![@sh0rez](https://avatars.githubusercontent.com/u/26971117?s=40&u=b4bdcc92bc449d589bdc51b4df471dcc976d79c8&v=4)](/sh0rez) [![@gillesdemey](https://avatars.githubusercontent.com/u/868844?s=40&u=d34da4534900c5e729ae25d01ef03d75361486f8&v=4)](/gillesdemey) [![@IevaVasiljeva](https://avatars.githubusercontent.com/u/9482349?s=40&u=6bf34051e6e76a6e014cb56085fd8671f8a32f16&v=4)](/IevaVasiljeva) [![@gtk-grafana](https://avatars.githubusercontent.com/u/109082771?s=40&u=bbd7b28097ca89a03816a1dabae2fcb1189b174e&v=4)](/gtk-grafana) [![@kylebrandt](https://avatars.githubusercontent.com/u/1692624?s=40&u=f03edc41ac5f244ccf8afbaf591a2c2d5bf9422b&v=4)](/kylebrandt) [![@gamab](https://avatars.githubusercontent.com/u/5232696?s=40&u=6c5fef30916541609539c960841a8f9230a2fd6f&v=4)](/gamab) [![@Jguer](https://avatars.githubusercontent.com/u/8071073?s=40&u=31dcf861785552275aea3a89860b081ed114ee1f&v=4)](/Jguer) [![@itsmylife](https://avatars.githubusercontent.com/u/820946?s=40&u=5a928c48831b349c7da1b0022636df01ce0f1ced&v=4)](/itsmylife) [![@yinjialu](https://avatars.githubusercontent.com/u/37073056?s=40&v=4)](/yinjialu) [![@leeoniya](https://avatars.githubusercontent.com/u/43234?s=40&u=49f10c1db35f1a4f328346b597cc763f695bb29d&v=4)](/leeoniya) [![@kminehart](https://avatars.githubusercontent.com/u/5140827?s=40&u=6a9f121b3b6daf545a3b29dda06a0f7f62e2db7d&v=4)](/kminehart) [![@dsotirakis](https://avatars.githubusercontent.com/u/15115078?s=40&u=2637caf13fe96ac43d1680b369e8cfdb8732ddf1&v=4)](/dsotirakis) [![@mckn](https://avatars.githubusercontent.com/u/172951?s=40&v=4)](/mckn) [![@armandgrillet](https://avatars.githubusercontent.com/u/2117580?s=40&u=e7e72ff4eb22b8e90a0c6cf6d9a1300dd9ac0e3f&v=4)](/armandgrillet) [![@chri2547](https://avatars.githubusercontent.com/u/35463610?s=40&u=97f7cf99392dddf4ffdc83bbbce761efd6f40332&v=4)](/chri2547) [![@kaydelaney](https://avatars.githubusercontent.com/u/45561153?s=40&u=136490e13ee468c88746b8dc89a1772cbbf4ae73&v=4)](/kaydelaney) [![@joeblubaugh](https://avatars.githubusercontent.com/u/1951900?s=40&u=1f1faee9254bfaa1e686540a726bbd9ff1cf6e71&v=4)](/joeblubaugh) [![@jfagoagas](https://avatars.githubusercontent.com/u/16007882?s=40&u=95544302b7438701266a93bae2de3cc96e7be42e&v=4)](/jfagoagas) [![@kalleep](https://avatars.githubusercontent.com/u/23356117?s=40&v=4)](/kalleep) [![@sunker](https://avatars.githubusercontent.com/u/2388950?s=40&u=a614311e8b2ef2d114e50d00ca9262b9f73e9b29&v=4)](/sunker) [![@joshhunt](https://avatars.githubusercontent.com/u/46142?s=40&u=5bf6f4243ee4ab8d8a99c3c210af343fdc625798&v=4)](/joshhunt) [![@andresmgot](https://avatars.githubusercontent.com/u/4025665?s=40&u=6d474b97f4f73c53f4609e6921afdabc407c6dbb&v=4)](/andresmgot) [![@grobinson-grafana](https://avatars.githubusercontent.com/u/85952834?s=40&v=4)](/grobinson-grafana) [![@alexweav](https://avatars.githubusercontent.com/u/8410871?s=40&u=b0142389bdf25772feb7ba112977b2ba34dbfe6c&v=4)](/alexweav) [![@lionralfs](https://avatars.githubusercontent.com/u/16670790?s=40&u=8c241532d32e0de477818202f0883af39215299c&v=4)](/lionralfs) [![@santihernandezc](https://avatars.githubusercontent.com/u/41638679?s=40&u=e5de0a9e10494cc06d4781de14abbb1473526b8e&v=4)](/santihernandezc) [![@julienduchesne](https://avatars.githubusercontent.com/u/29210090?s=40&u=d64510d5f3d87110355ed5c2e12d07d216b13c3b&v=4)](/julienduchesne) [![@Elfo404](https://avatars.githubusercontent.com/u/1170767?s=40&u=00040d625496f2c19fd3c9e7b8a43bf8752ba1ab&v=4)](/Elfo404) [![@torkelo](https://avatars.githubusercontent.com/u/10999?s=40&u=00ee9b9643b8eafd5df664bad66f196ff32bd9ed&v=4)](/torkelo) [![@DanCech](https://avatars.githubusercontent.com/u/1443603?s=40&u=563883eed1a53cbd19c35742c3a3ee1b2ddfb0ac&v=4)](/DanCech) [![@eleijonmarck](https://avatars.githubusercontent.com/u/7727602?s=40&u=4f4984c270ed39839e9b8dff600287396939ac2b&v=4)](/eleijonmarck) [![@ashharrison90](https://avatars.githubusercontent.com/u/20999846?s=40&u=e6c1c42a3025abfa1c1d579691b5541df490cf73&v=4)](/ashharrison90) [![@adrapereira](https://avatars.githubusercontent.com/u/4313971?s=40&u=78f1a19e9e0539dc5da5c46eebed12987e83f4fd&v=4)](/adrapereira) [![@ifrost](https://avatars.githubusercontent.com/u/745532?s=40&u=0e3338cd009dbb61fc67c4dfcf2a4469fad47c97&v=4)](/ifrost) [![@mvsousa](https://avatars.githubusercontent.com/u/3681977?s=40&u=a80007616212a617090a537c3fa0855fd754853d&v=4)](/mvsousa) [![@svennergr](https://avatars.githubusercontent.com/u/8092184?s=40&u=733ce9f1c399468005886bdfa2ce242d758348f0&v=4)](/svennergr) [![@ryantxu](https://avatars.githubusercontent.com/u/705951?s=40&u=45875989d2adfe87f95caa12e32e5a82b08898f8&v=4)](/ryantxu) [![@oscarkilhed](https://avatars.githubusercontent.com/u/468940?s=40&u=cdfbb52c148b5da116460f3ea9126cb5b5569e54&v=4)](/oscarkilhed) [![@dessen-xu](https://avatars.githubusercontent.com/u/41524013?s=40&u=01884d79b94696e284a35c8b681bf29434ef1a36&v=4)](/dessen-xu) [![@sakjur](https://avatars.githubusercontent.com/u/298945?s=40&u=f59488eb9b9031b02ae9f24116f8d5ac7d0071f8&v=4)](/sakjur) [![@siiimooon](https://avatars.githubusercontent.com/u/85333972?s=40&u=bc3afa1dea6abfb33d7f3e626099df5bc77955ad&v=4)](/siiimooon) [![@zoltanbedi](https://avatars.githubusercontent.com/u/13729989?s=40&u=6b2d0104259543f280a6b8ea1cccaba2c59e87d5&v=4)](/zoltanbedi) [![@neel1996](https://avatars.githubusercontent.com/u/47709856?s=40&u=d02474c07146b62f73c082ba2d9e312909bbf5cc&v=4)](/neel1996) [![@marefr](https://avatars.githubusercontent.com/u/1668778?s=40&v=4)](/marefr) [![@wjordan](https://avatars.githubusercontent.com/u/56541?s=40&v=4)](/wjordan) [![@sd2k](https://avatars.githubusercontent.com/u/5464991?s=40&u=debba4e86c2176c3afc994fa3eb8ba9ddb7e6d53&v=4)](/sd2k) [![@asimpson](https://avatars.githubusercontent.com/u/1048831?s=40&u=d49ee317b1a2d379515b5e59c03fce5b70009faa&v=4)](/asimpson) [![@xiyu95](https://avatars.githubusercontent.com/u/112968312?s=40&u=ea78ebf8294c6ddaab752aaa136a3f1ac943bfd3&v=4)](/xiyu95) [![@wbrowne](https://avatars.githubusercontent.com/u/1173299?s=40&u=07b5baceef0bdc39ee7f967f39c9c82afb4a81d2&v=4)](/wbrowne) [![@gwdawson](https://avatars.githubusercontent.com/u/34524710?s=40&u=7ea8832f2f2e29b4805d75b3bba2411344593189&v=4)](/gwdawson) [![@xnyo](https://avatars.githubusercontent.com/u/16373015?s=40&u=1dc1b8caf479abe3feaa070c01b1400c3a62b448&v=4)](/xnyo) [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas) [![@joey-grafana](https://avatars.githubusercontent.com/u/90795735?s=40&u=16b1cfc381a83ca938f6d096935f0e747b3691fb&v=4)](/joey-grafana) [![@tolzhabayev](https://avatars.githubusercontent.com/u/580672?s=40&u=cf4a1f5bdba6e8ecfe23dc9fa22069e5431498f8&v=4)](/tolzhabayev) [![@jackw](https://avatars.githubusercontent.com/u/73201?s=40&u=9fb7fc975368a6fae3be8676b46cfc9ad06c7b15&v=4)](/jackw) [![@gguillotte-grafana](https://avatars.githubusercontent.com/u/100453168?s=40&u=3d0bf8114b33430d58934de11387ccd510f3a0e5&v=4)](/gguillotte-grafana) [![@phongvq](https://avatars.githubusercontent.com/u/20754136?s=40&u=30cff65424186e5ff97e24894b5935ae17fd73c2&v=4)](/phongvq) [![@daniellee](https://avatars.githubusercontent.com/u/434655?s=40&u=0625e6874dbde9488a0cd6bc2d3a94c665337551&v=4)](/daniellee) [![@mgyongyosi](https://avatars.githubusercontent.com/u/1585112?s=40&u=bedfa00ab0788c2bfe8411a8218f7bb9a446cc67&v=4)](/mgyongyosi) [![@malcolmholmes](https://avatars.githubusercontent.com/u/42545407?s=40&v=4)](/malcolmholmes) [![@jdbaldry](https://avatars.githubusercontent.com/u/4599384?s=40&v=4)](/jdbaldry) [![@zuchka](https://avatars.githubusercontent.com/u/37156449?s=40&u=7227f6489882e5cf0856219349f19ac1ddbd2a11&v=4)](/zuchka) [![@leandro-deveikis](https://avatars.githubusercontent.com/u/34773040?s=40&u=0c0813698b625812c84deccbe3e4727f5104a28a&v=4)](/leandro-deveikis) [![@bartpeeters](https://avatars.githubusercontent.com/u/29534282?s=40&v=4)](/bartpeeters) [![@yvigara](https://avatars.githubusercontent.com/u/704600?s=40&u=127c2e201ae7c012f5e801e624af426aaf059b1c&v=4)](/yvigara) [![@owensmallwood](https://avatars.githubusercontent.com/u/20195316?s=40&u=0381407162d812492507256b2e90d3ace502b045&v=4)](/owensmallwood) [![@lpskdl](https://avatars.githubusercontent.com/u/108552997?s=40&u=4b1d5afda8817ac8fa0c3f379fbc21f05339f682&v=4)](/lpskdl) [![@aangelisc](https://avatars.githubusercontent.com/u/15019026?s=40&u=3540a1f3f4e09019aaa10a927ca4ca1a8b1caa51&v=4)](/aangelisc) [![@zserge](https://avatars.githubusercontent.com/u/1911760?s=40&u=d54bceb88fc5adc736476c5625bc96eed3725de0&v=4)](/zserge) [![@bergquist](https://avatars.githubusercontent.com/u/618863?s=40&u=3e138dc82d635ddf0c5c82e6463edb81b2205a74&v=4)](/bergquist) [![@iwysiu](https://avatars.githubusercontent.com/u/5421859?s=40&v=4)](/iwysiu) [![@bohandley](https://avatars.githubusercontent.com/u/25674746?s=40&u=5db785e20acac583c2c70f95579eed8acda76034&v=4)](/bohandley) [![@Eve832](https://avatars.githubusercontent.com/u/81647476?s=40&u=171081136377053e2d0a04a2d1f5e21270066d50&v=4)](/Eve832) [![@JacobsonMT](https://avatars.githubusercontent.com/u/8484471?s=40&u=30df9eec2de8834a517222b6f477bbf30598b98c&v=4)](/JacobsonMT) [![@robbymilo](https://avatars.githubusercontent.com/u/8106669?s=40&u=b5929162f75a8e3e5dca80dcfe543e46ff5985aa&v=4)](/robbymilo) [![@academo](https://avatars.githubusercontent.com/u/227916?s=40&u=2d66242d42fb2751b3a9b966ef1d433be978e4dc&v=4)](/academo) [![@adela-almasan](https://avatars.githubusercontent.com/u/88068998?s=40&u=8c681fb7664266c333858b055907df9d31b705ac&v=4)](/adela-almasan) [![@ktw4071](https://avatars.githubusercontent.com/u/10269640?s=40&v=4)](/ktw4071) [![@linoman](https://avatars.githubusercontent.com/u/2051016?s=40&u=85065225ade2a54d017c39fa976bcee1d79de5c9&v=4)](/linoman) [![@leventebalogh](https://avatars.githubusercontent.com/u/9974811?s=40&u=7e1691a3b32d0f3adbe905e8863a6be9cde6461f&v=4)](/leventebalogh) [![@xlson](https://avatars.githubusercontent.com/u/114937?s=40&u=d3cfffe519c44bd3938c5f7297f4b880ada09bbe&v=4)](/xlson) [![@usmangt](https://avatars.githubusercontent.com/u/69509548?s=40&u=2072d0b29b8514dfa1ded27606bd014f7edc020a&v=4)](/usmangt) [![@zerok](https://avatars.githubusercontent.com/u/3782?s=40&v=4)](/zerok) [![@imatwawana](https://avatars.githubusercontent.com/u/76437239?s=40&u=6dd696d8dde9fd57f5a423f3a81cf99a82d9a5cf&v=4)](/imatwawana) [![@aocenas](https://avatars.githubusercontent.com/u/1014802?s=40&u=a934e3470e711b2ed875899d43d9f887ee88b5a7&v=4)](/aocenas) [![@codeincarnate](https://avatars.githubusercontent.com/u/199847?s=40&u=133d1e683542a7ec4b44a74c617962e777eba96e&v=4)](/codeincarnate)

`[PMM-11762](https://jira.percona.com/browse/PMM-11762) [- Grafana 9.2.13 (](/percona/grafana/commit/d527b3a07ab637c2702ff20cd855395f7b9a6e22 "PMM-11762 - Grafana 9.2.13 (#629)

* Canvas: Improve resource picker initialization (#57319) (#57566)

(cherry picked from commit 9d857f4d61803f6156de5c7d89b04cd2593d0632)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* Storage: Fix initialization on windows (#57504) (#57577)

(cherry picked from commit 749b3b62631e89b07a592ec922447b1c9158afa5)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* TablePanel: Fix updating footer values on data change (#57518) (#57581)

* TablePanel: Fix updating footer values on data change

* tests

(cherry picked from commit c30716a073d0147fe85ddb1102429d04f6a4d6df)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* live: explicitely reply with http 200 (#57428) (#57592)

`pkg/web` triggers a panic when a http handler chain does not return any
response to the client.
This has been put in place, because it usually means a middleware along
the way did not call the next one.

In this specific case however, the handlers meant to return 200, but did
not do so explicitely, instead relying on the default behavior of `net/http`

(cherry picked from commit beaaabd770e540c463800e6d320884e3c6e00ae0)

Co-authored-by: sh0rez <me@shorez.de>

* Changelog: Updated changelog for 9.2.2 (#57601) (#57604)

(cherry picked from commit f64b0e1fae248469ee0fc8fbb2fc8efb90228808)

* \"Release: Updated versions in package to 9.2.3\" (#57605)

* [v9.2.x] Alerting: Always allow configuring AM configuration (#57614)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* move data source permission model to enterprise repo (#57615) (#57659)

(cherry picked from commit 92531c559612dd077f30b186873e23002c5c5ac5)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* Prometheus: Flavor/version configuration (#57554) (#57563)

* Backport PR for: Prometheus: Flavor/version configuration (#57554), and /label match parameter support #56510

* Revert \"Revert \"Prometheus: Type and flavor configuration (#56496)\" (#57552)\"
This reverts commit 2432ce619a7e62026685df14f60116ea4fb3447d.
* Adds new fields and documentation for Prometheus datasource configuration: prometheus type, and version

(cherry picked from commit f93c3acc51180cee78222f2df95ac7b380d1a616)

* Revert \"Revert \"Prometheus: Provide label values match parameter API when supported prometheus instance is configured (#56510)\" (#57551)\" (#57553) (#57564)

This reverts commit e7671bf9092811ecb053466e5b9c9913e2922fe1.
(cherry picked from commit e59ddd6bc5630625e49cafc965764cd8faa23cd6)
Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Prometheus query builder: Replace select with AsyncSelect to support high cardinality prometheus instances (#57300) (#57630)

* Replace current select with AsyncSelect component to facilitate autocomplete via prometheus server instead of client application
Co-authored-by: Kyle Brandt <kyle@grafana.com>

(cherry picked from commit c27aac0d385bfe695dec5f1b268940b4a19d3c50)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Docs: (Whats new 9.2) Prom Stream Parser (#57603) (#57693)

* Docs: (Whats new 9.2) Prom Stream Parser

* Update docs/sources/whatsnew/whats-new-in-v9-2.md

Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>

Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>
(cherry picked from commit dfdc9bcbc1491beb746914fcb8645436819d8aee)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Fix: Unlock new button based on user permissions (#57733) (#57760)

(cherry picked from commit 4d380978d304029ff17f2c2f0195e1b5b0a0c5b5)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* fix GF_AUTH_JWT_URL_LOGIN not working (#57689) (#57761)

(cherry picked from commit cae900c6f9e41b5559d8ed25afa5cd5d2af56aa0)

* [v9.2.x] Alerting: Fall back to \"range\" query type for unified alerting when \"both\" is specified (#57765)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Alerting: Fix \"Not Implemented\" responses (#57710) (#57712)

* Prometheus: fix Raw query is not updated when label op change. (#57492) (#57493) (#57780)

(cherry picked from commit 9aac0d32f9dbb77d0701398bf3d577a55dcce224)

Co-authored-by: yinjialu <37073056+yinjialu@users.noreply.github.com>

* Candlestick: Maintain candle width at different display resolutions (#57709) (#57794)

(cherry picked from commit 7d020d3f6e5476b47ce258dd4315e24a311f0506)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* TimeseriesPanel: Fill below to override works with name override (#57728) (#57800)

(cherry picked from commit 953fdfe76f3d6e51b8b32f4285e9501dfab944c5)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Security: Upgrade x/text to version unaffected by CVE-2022-32149 (#57797)

* Only provide version ot build-frontend-packages if it's a valid semver (has 2 digits) (#57808) (#57810)

(cherry picked from commit fd16cad7da36420148ae5811cfefa9876ce8f782)

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>

* CI: Add `CreateTempDir` func and use it in publish packages logic (#57171) (#57261)

* Add CreateTempDir func and use it in publish packages logic

* Fill err return in defer func

(cherry picked from commit e829b5014911363be862306b34a41fb0eeb13362)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Chore: Fix vulnerabilities in webpack loader-utils (#57753)

* chore: remove unused webpack loaders from core and toolkit

* chore: refresh yarn.lock file

* getting there...I hope..

* making sure we are not using naughty loader-utils.

* fixed storybook.

* Remove Sensu from docs (#57812) (#57823)

We do not support Sensu in Grafana Alerting, only Sensu Go.

(cherry picked from commit ee7adc081b3b2136d3786c069762057e8f428461)

Co-authored-by: Armand Grillet <2117580+armandgrillet@users.noreply.github.com>

* Prometheus: Do not drop errors in streaming parser (#57698) (#57835)

- Fixes #57692
- and also takes care of #42776 when using the streaming parser, not an ideal fix for #42776 but makes explore work better I think. https://github.com/grafana/grafana/issues/57365 might be a better longer term solution

(cherry picked from commit 6126f56ef0a0428ab3021c5a3368c2911000654f)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Prometheus: Chore - Remove incorrect FrameType from exemplar frame (#57695) (#57828)

(cherry picked from commit 2cd9cbd35925830dee97d9d18840eadc9d0cbbf3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* resolves merge conflicts (#57840)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* Docs: Add information about DB version support to upgrade guide. (#57643) (#57868)

In v9.2 Grafana added an official DB version support policy. That change
is now noted in the upgrade guide.

(cherry picked from commit 89d917b196a12bafbec80d043fa1f36e9c825243)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Access Control: documentation for RBAC provisioning with Terraform (#57747) (#57882)

* add docs for RBAC provisioning with Terraform

* remove unnecessary bit

* shuffle the structure around, as docs can't go more than four levels deep

* Update index.md

* Update index.md

(cherry picked from commit 7e62352aea20a47589b66f20c2c8ef7ca5847b65)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* docs(config): Include admin_email documentation (#55789) (#57725)

(cherry picked from commit 1340c2c358d37c3249246277d4eeb51806faacb1)

Co-authored-by: Pepe Fagoaga <pepe@verica.io>

* RBAC: Allow to list users for dashboard / folder admins (#57080) (#57252)

* RBAC: Use query struct in tests

* RBAC: If access control enforcement is disabled don't filter out users
when fetching permissions

(cherry picked from commit 9adaf1565c2408e3e13668af7d50cdcdd5d77242)

Co-authored-by: Karl Persson <kalle.persson@grafana.com>

* CloudWatch: Fix broken test (#57879) (#57900)

* mock date.now

* fix broken test

(cherry picked from commit 92ed9a4f2f6c3d5b8a0cfeaecda0062f6b77c525)

Co-authored-by: Erik Sundell <erik.sundell87@gmail.com>

* Chore: Update footer changelog link to github (#57871) (#57895)

(cherry picked from commit fd5c14757486ef510741ac344469b1ccfe2a6242)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Google Cloud Monitoring: Ensure selectors fit in the screen (#57817) (#57899)

(cherry picked from commit ce38840f293bfe94a1d6338a9bab255b3d7cc56c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* add an endpoint for updating several managed permissions with one call (#57893) (#57898)

(cherry picked from commit 2546437e2052025daaf8ee2ab9ea4262b7364e61)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* change json command parameter names from userID to userId and teamID to teamId (#57902) (#57913)

(cherry picked from commit 5c1a1c8318bec43dec6aaf130aaafda3f19e54a6)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* Alerting: Add debug logs in validateAndGetPrefix (#57002) (#57923)

(cherry picked from commit b0a927b1385654a6776cbe8deb36f6dfadc914fd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Attempt to preserve UID from migrated channel (#57639) (#57919)

(cherry picked from commit 0dfd78c88cbb97df6594dda57d73c705bda106e0)

Co-authored-by: Alexander Weaver <weaver.alex.d@gmail.com>

* [v9.2.x] Alerting: fix filtering in notification policies (#57925)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* removes CTAs (#57931) (#57935)

(cherry picked from commit 6aa3003a541552aa9ce6e9b3e95a9dd0b8213e78)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* BarChart: Fix stacked hover (#57711) (#57937)

(cherry picked from commit fbfd0fd51b1d61b186957e0b58c2ea60472f55f3)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* TimeSeries: Render null-bounded points at data edges (#57798) (#57938)

(cherry picked from commit 45234e76eb82a417d8cee236d7a2ad91dc580bbb)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* CloudWatch: Fix `all-log-groups` endpoint when called without logGroupNamePrefix  (#57483) (#57945)

(cherry picked from commit 1f7c84f1256ed46fe5099f27aae57a2121da1080)

Co-authored-by: Lion Ralfs <lion.ralfs@gmail.com>

* Add GCP_KEY to publish-grafanacom step (#57910) (#57948)

(cherry picked from commit 1eaf7cbfc0f4aaed8b84c3e50d9c0c352668b363)

* Changelog: Updated changelog for 9.2.3 (#57955) (#57957)

(cherry picked from commit 02add89b530a569f38e38597be294c6b16ef29d8)

* \"Release: Updated versions in package to 9.2.4\" (#57958)

* metrics: expose when the binary was built as an gauge (#57951) (#57969)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 3188af9be352feabeb000b204d7375b5626231d5)

* Alerting: Fix flaky test in notifiers (#57927) (#57993)

* Alerting: Fix flaky test in notifiers

* remove TODO comment

(cherry picked from commit a3f828de8aae968f783aeeb648de98e75c421af4)

Co-authored-by: Santiago <santiagohernandez.1997@gmail.com>

* [v9.2.x] Google Cloud Monitoring: Set frame interval to draw null values (#57914)

* Linux Packages: Handle publish to beta (#57528) (#58044)

Uses the feature added here: https://github.com/grafana/deployment_tools/pull/46301
When a version is named \"beta\", it will be distributed in the beta distribution, rather than in stable

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
(cherry picked from commit c46a4a0b260d3b008bfa771cdc103065a6fe6880)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* chore: bump code coverage action version (#56710) (#58040)

(cherry picked from commit e3e32c7d04a5d20b45411c118f7e3c7e63d90709)

Co-authored-by: Giordano Ricci <me@giordanoricci.com>

* Alerting: Fix response is not returned for invalid Duration in Provisioning API (#58046) (#58049)

(cherry picked from commit 4c581b5f85db705bd4b01d5679407069dd3b2cfb)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* LibrayPanels: Fix unlinking libray panel (#57825) (#58042)

* remove unneeded package updates (#58005) (#58068)

(cherry picked from commit 6a4a10fa926e89eb0498a4d703ccc8c67b5dd46d)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Alerting: Fix feedback (#57922) (#58104)

(cherry picked from commit f2e4cb7c4ea4ee85a177e27fba3d6bf191e043a7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshot is not taken for stale series (#57982) (#58102)

(cherry picked from commit 215ffee4375adb784526827340bbc8c66fd342cc)

* fix: migration of alert_rules fix (#58123)

* increase select placeholder contrast to be WCAG AA compliant (#58034) (#58125)

(cherry picked from commit c3206167a65babd66ca4d590723c4fd754c4aad9)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Tempo: Make usage of time range for TraceID query optional (#58057) (#58128)

* Added switch to toggle the TraceID query time shift

* Fix and improve tests

(cherry picked from commit 90ac300d1023768f9778bb58e77a05948dea5b2e)

Co-authored-by: Andre Pereira <adrapereira@gmail.com>

* [v9.2.x] Explore: Track data links usage (#56868) (#58037)

* Explore: Track data links usage (#56868)

* Add tracking for data links in explore

* Add tracking for data links in explore

* Fix tests

* Retrigger build

(cherry picked from commit dd5e3a08184b3d875c0ee62aab7ca9a054a8c23e)

# Conflicts:
#	public/app/features/explore/Explore.tsx
#	public/app/features/explore/LogsContainer.tsx

* Post-merge fixes

Remove unused import

* reduce the number of requests in folder section (#55876) (#58145)

(cherry picked from commit 372ba83534e0fd91e1c25d7c3c27a3ac1f68f62c)

Co-authored-by: Marcos Vinicius <marcos.vinicius.wz@gmail.com>

* TimeSeries: more thorough detection of negative values for stacking dir (#57863) (#58147)

(cherry picked from commit 4d88e2b542c62bf287a60af01fddfa2e6de220b4)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* fixed explain handlers for label- and lineformat (#58135) (#58151)

(cherry picked from commit 4b1ddba0a8998884982d275e846ec4af6787a06f)

Co-authored-by: Sven Grossmann <sven.grossmann@grafana.com>

* fixes typo (#58159) (#58194)

(cherry picked from commit 1722000309c6e6dc36c9e4f5ef9c2e40cc6e6c65)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Alerting: Encode path separators to side-step proxies (#58222)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Build: add explicit build step for go codeql (#58195) (#58243)

* add explicit build step for go codeql

* support workflow_dispatch for codeql checks

* syntax fix

* enable on push to codeql-go branch

* test

* use go version from go.mod

* explicitly set go version

* tidy up, add workflow_dispatch support to all codeql actions

(cherry picked from commit da9c646f242fd16ba8a789fa5d1c50094d761ae7)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Search: Fixes searching by current folder when opened by clicking dashboard folder name  (#57716) (#57949)

* Search: Read from url on mount no on app boot

* Fixed tests

* Remove unused type

(cherry picked from commit 3991be4c1dd35ff05e1a7dee117710e766b1a3c9)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* \"Release: Updated versions in package to 9.2.5\" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying \"General\" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

\"Release: Updated versions in package to 9.2.6\"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

\"Release: Updated versions in package to 9.2.7\"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

\"Release: Updated versions in package to 9.2.8\"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation \"stealing\" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

\"Release: Updated versions in package to 9.2.11\"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v…")[#629](https://github.com/percona/grafana/pull/629)[)](/percona/grafana/commit/d527b3a07ab637c2702ff20cd855395f7b9a6e22 "PMM-11762 - Grafana 9.2.13 (#629)

* Canvas: Improve resource picker initialization (#57319) (#57566)

(cherry picked from commit 9d857f4d61803f6156de5c7d89b04cd2593d0632)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* Storage: Fix initialization on windows (#57504) (#57577)

(cherry picked from commit 749b3b62631e89b07a592ec922447b1c9158afa5)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* TablePanel: Fix updating footer values on data change (#57518) (#57581)

* TablePanel: Fix updating footer values on data change

* tests

(cherry picked from commit c30716a073d0147fe85ddb1102429d04f6a4d6df)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* live: explicitely reply with http 200 (#57428) (#57592)

`pkg/web` triggers a panic when a http handler chain does not return any
response to the client.
This has been put in place, because it usually means a middleware along
the way did not call the next one.

In this specific case however, the handlers meant to return 200, but did
not do so explicitely, instead relying on the default behavior of `net/http`

(cherry picked from commit beaaabd770e540c463800e6d320884e3c6e00ae0)

Co-authored-by: sh0rez <me@shorez.de>

* Changelog: Updated changelog for 9.2.2 (#57601) (#57604)

(cherry picked from commit f64b0e1fae248469ee0fc8fbb2fc8efb90228808)

* \"Release: Updated versions in package to 9.2.3\" (#57605)

* [v9.2.x] Alerting: Always allow configuring AM configuration (#57614)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* move data source permission model to enterprise repo (#57615) (#57659)

(cherry picked from commit 92531c559612dd077f30b186873e23002c5c5ac5)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* Prometheus: Flavor/version configuration (#57554) (#57563)

* Backport PR for: Prometheus: Flavor/version configuration (#57554), and /label match parameter support #56510

* Revert \"Revert \"Prometheus: Type and flavor configuration (#56496)\" (#57552)\"
This reverts commit 2432ce619a7e62026685df14f60116ea4fb3447d.
* Adds new fields and documentation for Prometheus datasource configuration: prometheus type, and version

(cherry picked from commit f93c3acc51180cee78222f2df95ac7b380d1a616)

* Revert \"Revert \"Prometheus: Provide label values match parameter API when supported prometheus instance is configured (#56510)\" (#57551)\" (#57553) (#57564)

This reverts commit e7671bf9092811ecb053466e5b9c9913e2922fe1.
(cherry picked from commit e59ddd6bc5630625e49cafc965764cd8faa23cd6)
Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Prometheus query builder: Replace select with AsyncSelect to support high cardinality prometheus instances (#57300) (#57630)

* Replace current select with AsyncSelect component to facilitate autocomplete via prometheus server instead of client application
Co-authored-by: Kyle Brandt <kyle@grafana.com>

(cherry picked from commit c27aac0d385bfe695dec5f1b268940b4a19d3c50)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Docs: (Whats new 9.2) Prom Stream Parser (#57603) (#57693)

* Docs: (Whats new 9.2) Prom Stream Parser

* Update docs/sources/whatsnew/whats-new-in-v9-2.md

Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>

Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>
(cherry picked from commit dfdc9bcbc1491beb746914fcb8645436819d8aee)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Fix: Unlock new button based on user permissions (#57733) (#57760)

(cherry picked from commit 4d380978d304029ff17f2c2f0195e1b5b0a0c5b5)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* fix GF_AUTH_JWT_URL_LOGIN not working (#57689) (#57761)

(cherry picked from commit cae900c6f9e41b5559d8ed25afa5cd5d2af56aa0)

* [v9.2.x] Alerting: Fall back to \"range\" query type for unified alerting when \"both\" is specified (#57765)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Alerting: Fix \"Not Implemented\" responses (#57710) (#57712)

* Prometheus: fix Raw query is not updated when label op change. (#57492) (#57493) (#57780)

(cherry picked from commit 9aac0d32f9dbb77d0701398bf3d577a55dcce224)

Co-authored-by: yinjialu <37073056+yinjialu@users.noreply.github.com>

* Candlestick: Maintain candle width at different display resolutions (#57709) (#57794)

(cherry picked from commit 7d020d3f6e5476b47ce258dd4315e24a311f0506)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* TimeseriesPanel: Fill below to override works with name override (#57728) (#57800)

(cherry picked from commit 953fdfe76f3d6e51b8b32f4285e9501dfab944c5)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Security: Upgrade x/text to version unaffected by CVE-2022-32149 (#57797)

* Only provide version ot build-frontend-packages if it's a valid semver (has 2 digits) (#57808) (#57810)

(cherry picked from commit fd16cad7da36420148ae5811cfefa9876ce8f782)

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>

* CI: Add `CreateTempDir` func and use it in publish packages logic (#57171) (#57261)

* Add CreateTempDir func and use it in publish packages logic

* Fill err return in defer func

(cherry picked from commit e829b5014911363be862306b34a41fb0eeb13362)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Chore: Fix vulnerabilities in webpack loader-utils (#57753)

* chore: remove unused webpack loaders from core and toolkit

* chore: refresh yarn.lock file

* getting there...I hope..

* making sure we are not using naughty loader-utils.

* fixed storybook.

* Remove Sensu from docs (#57812) (#57823)

We do not support Sensu in Grafana Alerting, only Sensu Go.

(cherry picked from commit ee7adc081b3b2136d3786c069762057e8f428461)

Co-authored-by: Armand Grillet <2117580+armandgrillet@users.noreply.github.com>

* Prometheus: Do not drop errors in streaming parser (#57698) (#57835)

- Fixes #57692
- and also takes care of #42776 when using the streaming parser, not an ideal fix for #42776 but makes explore work better I think. https://github.com/grafana/grafana/issues/57365 might be a better longer term solution

(cherry picked from commit 6126f56ef0a0428ab3021c5a3368c2911000654f)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Prometheus: Chore - Remove incorrect FrameType from exemplar frame (#57695) (#57828)

(cherry picked from commit 2cd9cbd35925830dee97d9d18840eadc9d0cbbf3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* resolves merge conflicts (#57840)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* Docs: Add information about DB version support to upgrade guide. (#57643) (#57868)

In v9.2 Grafana added an official DB version support policy. That change
is now noted in the upgrade guide.

(cherry picked from commit 89d917b196a12bafbec80d043fa1f36e9c825243)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Access Control: documentation for RBAC provisioning with Terraform (#57747) (#57882)

* add docs for RBAC provisioning with Terraform

* remove unnecessary bit

* shuffle the structure around, as docs can't go more than four levels deep

* Update index.md

* Update index.md

(cherry picked from commit 7e62352aea20a47589b66f20c2c8ef7ca5847b65)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* docs(config): Include admin_email documentation (#55789) (#57725)

(cherry picked from commit 1340c2c358d37c3249246277d4eeb51806faacb1)

Co-authored-by: Pepe Fagoaga <pepe@verica.io>

* RBAC: Allow to list users for dashboard / folder admins (#57080) (#57252)

* RBAC: Use query struct in tests

* RBAC: If access control enforcement is disabled don't filter out users
when fetching permissions

(cherry picked from commit 9adaf1565c2408e3e13668af7d50cdcdd5d77242)

Co-authored-by: Karl Persson <kalle.persson@grafana.com>

* CloudWatch: Fix broken test (#57879) (#57900)

* mock date.now

* fix broken test

(cherry picked from commit 92ed9a4f2f6c3d5b8a0cfeaecda0062f6b77c525)

Co-authored-by: Erik Sundell <erik.sundell87@gmail.com>

* Chore: Update footer changelog link to github (#57871) (#57895)

(cherry picked from commit fd5c14757486ef510741ac344469b1ccfe2a6242)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Google Cloud Monitoring: Ensure selectors fit in the screen (#57817) (#57899)

(cherry picked from commit ce38840f293bfe94a1d6338a9bab255b3d7cc56c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* add an endpoint for updating several managed permissions with one call (#57893) (#57898)

(cherry picked from commit 2546437e2052025daaf8ee2ab9ea4262b7364e61)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* change json command parameter names from userID to userId and teamID to teamId (#57902) (#57913)

(cherry picked from commit 5c1a1c8318bec43dec6aaf130aaafda3f19e54a6)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* Alerting: Add debug logs in validateAndGetPrefix (#57002) (#57923)

(cherry picked from commit b0a927b1385654a6776cbe8deb36f6dfadc914fd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Attempt to preserve UID from migrated channel (#57639) (#57919)

(cherry picked from commit 0dfd78c88cbb97df6594dda57d73c705bda106e0)

Co-authored-by: Alexander Weaver <weaver.alex.d@gmail.com>

* [v9.2.x] Alerting: fix filtering in notification policies (#57925)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* removes CTAs (#57931) (#57935)

(cherry picked from commit 6aa3003a541552aa9ce6e9b3e95a9dd0b8213e78)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* BarChart: Fix stacked hover (#57711) (#57937)

(cherry picked from commit fbfd0fd51b1d61b186957e0b58c2ea60472f55f3)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* TimeSeries: Render null-bounded points at data edges (#57798) (#57938)

(cherry picked from commit 45234e76eb82a417d8cee236d7a2ad91dc580bbb)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* CloudWatch: Fix `all-log-groups` endpoint when called without logGroupNamePrefix  (#57483) (#57945)

(cherry picked from commit 1f7c84f1256ed46fe5099f27aae57a2121da1080)

Co-authored-by: Lion Ralfs <lion.ralfs@gmail.com>

* Add GCP_KEY to publish-grafanacom step (#57910) (#57948)

(cherry picked from commit 1eaf7cbfc0f4aaed8b84c3e50d9c0c352668b363)

* Changelog: Updated changelog for 9.2.3 (#57955) (#57957)

(cherry picked from commit 02add89b530a569f38e38597be294c6b16ef29d8)

* \"Release: Updated versions in package to 9.2.4\" (#57958)

* metrics: expose when the binary was built as an gauge (#57951) (#57969)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 3188af9be352feabeb000b204d7375b5626231d5)

* Alerting: Fix flaky test in notifiers (#57927) (#57993)

* Alerting: Fix flaky test in notifiers

* remove TODO comment

(cherry picked from commit a3f828de8aae968f783aeeb648de98e75c421af4)

Co-authored-by: Santiago <santiagohernandez.1997@gmail.com>

* [v9.2.x] Google Cloud Monitoring: Set frame interval to draw null values (#57914)

* Linux Packages: Handle publish to beta (#57528) (#58044)

Uses the feature added here: https://github.com/grafana/deployment_tools/pull/46301
When a version is named \"beta\", it will be distributed in the beta distribution, rather than in stable

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
(cherry picked from commit c46a4a0b260d3b008bfa771cdc103065a6fe6880)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* chore: bump code coverage action version (#56710) (#58040)

(cherry picked from commit e3e32c7d04a5d20b45411c118f7e3c7e63d90709)

Co-authored-by: Giordano Ricci <me@giordanoricci.com>

* Alerting: Fix response is not returned for invalid Duration in Provisioning API (#58046) (#58049)

(cherry picked from commit 4c581b5f85db705bd4b01d5679407069dd3b2cfb)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* LibrayPanels: Fix unlinking libray panel (#57825) (#58042)

* remove unneeded package updates (#58005) (#58068)

(cherry picked from commit 6a4a10fa926e89eb0498a4d703ccc8c67b5dd46d)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Alerting: Fix feedback (#57922) (#58104)

(cherry picked from commit f2e4cb7c4ea4ee85a177e27fba3d6bf191e043a7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshot is not taken for stale series (#57982) (#58102)

(cherry picked from commit 215ffee4375adb784526827340bbc8c66fd342cc)

* fix: migration of alert_rules fix (#58123)

* increase select placeholder contrast to be WCAG AA compliant (#58034) (#58125)

(cherry picked from commit c3206167a65babd66ca4d590723c4fd754c4aad9)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Tempo: Make usage of time range for TraceID query optional (#58057) (#58128)

* Added switch to toggle the TraceID query time shift

* Fix and improve tests

(cherry picked from commit 90ac300d1023768f9778bb58e77a05948dea5b2e)

Co-authored-by: Andre Pereira <adrapereira@gmail.com>

* [v9.2.x] Explore: Track data links usage (#56868) (#58037)

* Explore: Track data links usage (#56868)

* Add tracking for data links in explore

* Add tracking for data links in explore

* Fix tests

* Retrigger build

(cherry picked from commit dd5e3a08184b3d875c0ee62aab7ca9a054a8c23e)

# Conflicts:
#	public/app/features/explore/Explore.tsx
#	public/app/features/explore/LogsContainer.tsx

* Post-merge fixes

Remove unused import

* reduce the number of requests in folder section (#55876) (#58145)

(cherry picked from commit 372ba83534e0fd91e1c25d7c3c27a3ac1f68f62c)

Co-authored-by: Marcos Vinicius <marcos.vinicius.wz@gmail.com>

* TimeSeries: more thorough detection of negative values for stacking dir (#57863) (#58147)

(cherry picked from commit 4d88e2b542c62bf287a60af01fddfa2e6de220b4)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* fixed explain handlers for label- and lineformat (#58135) (#58151)

(cherry picked from commit 4b1ddba0a8998884982d275e846ec4af6787a06f)

Co-authored-by: Sven Grossmann <sven.grossmann@grafana.com>

* fixes typo (#58159) (#58194)

(cherry picked from commit 1722000309c6e6dc36c9e4f5ef9c2e40cc6e6c65)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Alerting: Encode path separators to side-step proxies (#58222)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Build: add explicit build step for go codeql (#58195) (#58243)

* add explicit build step for go codeql

* support workflow_dispatch for codeql checks

* syntax fix

* enable on push to codeql-go branch

* test

* use go version from go.mod

* explicitly set go version

* tidy up, add workflow_dispatch support to all codeql actions

(cherry picked from commit da9c646f242fd16ba8a789fa5d1c50094d761ae7)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Search: Fixes searching by current folder when opened by clicking dashboard folder name  (#57716) (#57949)

* Search: Read from url on mount no on app boot

* Fixed tests

* Remove unused type

(cherry picked from commit 3991be4c1dd35ff05e1a7dee117710e766b1a3c9)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* \"Release: Updated versions in package to 9.2.5\" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying \"General\" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

\"Release: Updated versions in package to 9.2.6\"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

\"Release: Updated versions in package to 9.2.7\"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

\"Release: Updated versions in package to 9.2.8\"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation \"stealing\" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

\"Release: Updated versions in package to 9.2.11\"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v…")`
…

`[d527b3a](/percona/grafana/commit/d527b3a07ab637c2702ff20cd855395f7b9a6e22)`

```
* Canvas: Improve resource picker initialization (#57319) (#57566)

(cherry picked from commit 9d857f4d61803f6156de5c7d89b04cd2593d0632)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* Storage: Fix initialization on windows (#57504) (#57577)

(cherry picked from commit 749b3b62631e89b07a592ec922447b1c9158afa5)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* TablePanel: Fix updating footer values on data change (#57518) (#57581)

* TablePanel: Fix updating footer values on data change

* tests

(cherry picked from commit c30716a073d0147fe85ddb1102429d04f6a4d6df)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* live: explicitely reply with http 200 (#57428) (#57592)

`pkg/web` triggers a panic when a http handler chain does not return any
response to the client.
This has been put in place, because it usually means a middleware along
the way did not call the next one.

In this specific case however, the handlers meant to return 200, but did
not do so explicitely, instead relying on the default behavior of `net/http`

(cherry picked from commit beaaabd770e540c463800e6d320884e3c6e00ae0)

Co-authored-by: sh0rez <me@shorez.de>

* Changelog: Updated changelog for 9.2.2 (#57601) (#57604)

(cherry picked from commit f64b0e1fae248469ee0fc8fbb2fc8efb90228808)

* "Release: Updated versions in package to 9.2.3" (#57605)

* [v9.2.x] Alerting: Always allow configuring AM configuration (#57614)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* move data source permission model to enterprise repo (#57615) (#57659)

(cherry picked from commit 92531c559612dd077f30b186873e23002c5c5ac5)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* Prometheus: Flavor/version configuration (#57554) (#57563)

* Backport PR for: Prometheus: Flavor/version configuration (#57554), and /label match parameter support #56510

* Revert "Revert "Prometheus: Type and flavor configuration (#56496)" (#57552)"
This reverts commit 2432ce619a7e62026685df14f60116ea4fb3447d.
* Adds new fields and documentation for Prometheus datasource configuration: prometheus type, and version

(cherry picked from commit f93c3acc51180cee78222f2df95ac7b380d1a616)

* Revert "Revert "Prometheus: Provide label values match parameter API when supported prometheus instance is configured (#56510)" (#57551)" (#57553) (#57564)

This reverts commit e7671bf9092811ecb053466e5b9c9913e2922fe1.
(cherry picked from commit e59ddd6bc5630625e49cafc965764cd8faa23cd6)
Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Prometheus query builder: Replace select with AsyncSelect to support high cardinality prometheus instances (#57300) (#57630)

* Replace current select with AsyncSelect component to facilitate autocomplete via prometheus server instead of client application
Co-authored-by: Kyle Brandt <kyle@grafana.com>

(cherry picked from commit c27aac0d385bfe695dec5f1b268940b4a19d3c50)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Docs: (Whats new 9.2) Prom Stream Parser (#57603) (#57693)

* Docs: (Whats new 9.2) Prom Stream Parser

* Update docs/sources/whatsnew/whats-new-in-v9-2.md

Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>

Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>
(cherry picked from commit dfdc9bcbc1491beb746914fcb8645436819d8aee)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Fix: Unlock new button based on user permissions (#57733) (#57760)

(cherry picked from commit 4d380978d304029ff17f2c2f0195e1b5b0a0c5b5)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* fix GF_AUTH_JWT_URL_LOGIN not working (#57689) (#57761)

(cherry picked from commit cae900c6f9e41b5559d8ed25afa5cd5d2af56aa0)

* [v9.2.x] Alerting: Fall back to "range" query type for unified alerting when "both" is specified (#57765)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Alerting: Fix "Not Implemented" responses (#57710) (#57712)

* Prometheus: fix Raw query is not updated when label op change. (#57492) (#57493) (#57780)

(cherry picked from commit 9aac0d32f9dbb77d0701398bf3d577a55dcce224)

Co-authored-by: yinjialu <37073056+yinjialu@users.noreply.github.com>

* Candlestick: Maintain candle width at different display resolutions (#57709) (#57794)

(cherry picked from commit 7d020d3f6e5476b47ce258dd4315e24a311f0506)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* TimeseriesPanel: Fill below to override works with name override (#57728) (#57800)

(cherry picked from commit 953fdfe76f3d6e51b8b32f4285e9501dfab944c5)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Security: Upgrade x/text to version unaffected by CVE-2022-32149 (#57797)

* Only provide version ot build-frontend-packages if it's a valid semver (has 2 digits) (#57808) (#57810)

(cherry picked from commit fd16cad7da36420148ae5811cfefa9876ce8f782)

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>

* CI: Add `CreateTempDir` func and use it in publish packages logic (#57171) (#57261)

* Add CreateTempDir func and use it in publish packages logic

* Fill err return in defer func

(cherry picked from commit e829b5014911363be862306b34a41fb0eeb13362)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Chore: Fix vulnerabilities in webpack loader-utils (#57753)

* chore: remove unused webpack loaders from core and toolkit

* chore: refresh yarn.lock file

* getting there...I hope..

* making sure we are not using naughty loader-utils.

* fixed storybook.

* Remove Sensu from docs (#57812) (#57823)

We do not support Sensu in Grafana Alerting, only Sensu Go.

(cherry picked from commit ee7adc081b3b2136d3786c069762057e8f428461)

Co-authored-by: Armand Grillet <2117580+armandgrillet@users.noreply.github.com>

* Prometheus: Do not drop errors in streaming parser (#57698) (#57835)

- Fixes #57692
- and also takes care of #42776 when using the streaming parser, not an ideal fix for #42776 but makes explore work better I think. https://github.com/grafana/grafana/issues/57365 might be a better longer term solution

(cherry picked from commit 6126f56ef0a0428ab3021c5a3368c2911000654f)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Prometheus: Chore - Remove incorrect FrameType from exemplar frame (#57695) (#57828)

(cherry picked from commit 2cd9cbd35925830dee97d9d18840eadc9d0cbbf3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* resolves merge conflicts (#57840)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* Docs: Add information about DB version support to upgrade guide. (#57643) (#57868)

In v9.2 Grafana added an official DB version support policy. That change
is now noted in the upgrade guide.

(cherry picked from commit 89d917b196a12bafbec80d043fa1f36e9c825243)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Access Control: documentation for RBAC provisioning with Terraform (#57747) (#57882)

* add docs for RBAC provisioning with Terraform

* remove unnecessary bit

* shuffle the structure around, as docs can't go more than four levels deep

* Update index.md

* Update index.md

(cherry picked from commit 7e62352aea20a47589b66f20c2c8ef7ca5847b65)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* docs(config): Include admin_email documentation (#55789) (#57725)

(cherry picked from commit 1340c2c358d37c3249246277d4eeb51806faacb1)

Co-authored-by: Pepe Fagoaga <pepe@verica.io>

* RBAC: Allow to list users for dashboard / folder admins (#57080) (#57252)

* RBAC: Use query struct in tests

* RBAC: If access control enforcement is disabled don't filter out users
when fetching permissions

(cherry picked from commit 9adaf1565c2408e3e13668af7d50cdcdd5d77242)

Co-authored-by: Karl Persson <kalle.persson@grafana.com>

* CloudWatch: Fix broken test (#57879) (#57900)

* mock date.now

* fix broken test

(cherry picked from commit 92ed9a4f2f6c3d5b8a0cfeaecda0062f6b77c525)

Co-authored-by: Erik Sundell <erik.sundell87@gmail.com>

* Chore: Update footer changelog link to github (#57871) (#57895)

(cherry picked from commit fd5c14757486ef510741ac344469b1ccfe2a6242)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Google Cloud Monitoring: Ensure selectors fit in the screen (#57817) (#57899)

(cherry picked from commit ce38840f293bfe94a1d6338a9bab255b3d7cc56c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* add an endpoint for updating several managed permissions with one call (#57893) (#57898)

(cherry picked from commit 2546437e2052025daaf8ee2ab9ea4262b7364e61)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* change json command parameter names from userID to userId and teamID to teamId (#57902) (#57913)

(cherry picked from commit 5c1a1c8318bec43dec6aaf130aaafda3f19e54a6)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* Alerting: Add debug logs in validateAndGetPrefix (#57002) (#57923)

(cherry picked from commit b0a927b1385654a6776cbe8deb36f6dfadc914fd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Attempt to preserve UID from migrated channel (#57639) (#57919)

(cherry picked from commit 0dfd78c88cbb97df6594dda57d73c705bda106e0)

Co-authored-by: Alexander Weaver <weaver.alex.d@gmail.com>

* [v9.2.x] Alerting: fix filtering in notification policies (#57925)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* removes CTAs (#57931) (#57935)

(cherry picked from commit 6aa3003a541552aa9ce6e9b3e95a9dd0b8213e78)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* BarChart: Fix stacked hover (#57711) (#57937)

(cherry picked from commit fbfd0fd51b1d61b186957e0b58c2ea60472f55f3)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* TimeSeries: Render null-bounded points at data edges (#57798) (#57938)

(cherry picked from commit 45234e76eb82a417d8cee236d7a2ad91dc580bbb)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* CloudWatch: Fix `all-log-groups` endpoint when called without logGroupNamePrefix  (#57483) (#57945)

(cherry picked from commit 1f7c84f1256ed46fe5099f27aae57a2121da1080)

Co-authored-by: Lion Ralfs <lion.ralfs@gmail.com>

* Add GCP_KEY to publish-grafanacom step (#57910) (#57948)

(cherry picked from commit 1eaf7cbfc0f4aaed8b84c3e50d9c0c352668b363)

* Changelog: Updated changelog for 9.2.3 (#57955) (#57957)

(cherry picked from commit 02add89b530a569f38e38597be294c6b16ef29d8)

* "Release: Updated versions in package to 9.2.4" (#57958)

* metrics: expose when the binary was built as an gauge (#57951) (#57969)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 3188af9be352feabeb000b204d7375b5626231d5)

* Alerting: Fix flaky test in notifiers (#57927) (#57993)

* Alerting: Fix flaky test in notifiers

* remove TODO comment

(cherry picked from commit a3f828de8aae968f783aeeb648de98e75c421af4)

Co-authored-by: Santiago <santiagohernandez.1997@gmail.com>

* [v9.2.x] Google Cloud Monitoring: Set frame interval to draw null values (#57914)

* Linux Packages: Handle publish to beta (#57528) (#58044)

Uses the feature added here: https://github.com/grafana/deployment_tools/pull/46301
When a version is named "beta", it will be distributed in the beta distribution, rather than in stable

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
(cherry picked from commit c46a4a0b260d3b008bfa771cdc103065a6fe6880)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* chore: bump code coverage action version (#56710) (#58040)

(cherry picked from commit e3e32c7d04a5d20b45411c118f7e3c7e63d90709)

Co-authored-by: Giordano Ricci <me@giordanoricci.com>

* Alerting: Fix response is not returned for invalid Duration in Provisioning API (#58046) (#58049)

(cherry picked from commit 4c581b5f85db705bd4b01d5679407069dd3b2cfb)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* LibrayPanels: Fix unlinking libray panel (#57825) (#58042)

* remove unneeded package updates (#58005) (#58068)

(cherry picked from commit 6a4a10fa926e89eb0498a4d703ccc8c67b5dd46d)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Alerting: Fix feedback (#57922) (#58104)

(cherry picked from commit f2e4cb7c4ea4ee85a177e27fba3d6bf191e043a7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshot is not taken for stale series (#57982) (#58102)

(cherry picked from commit 215ffee4375adb784526827340bbc8c66fd342cc)

* fix: migration of alert_rules fix (#58123)

* increase select placeholder contrast to be WCAG AA compliant (#58034) (#58125)

(cherry picked from commit c3206167a65babd66ca4d590723c4fd754c4aad9)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Tempo: Make usage of time range for TraceID query optional (#58057) (#58128)

* Added switch to toggle the TraceID query time shift

* Fix and improve tests

(cherry picked from commit 90ac300d1023768f9778bb58e77a05948dea5b2e)

Co-authored-by: Andre Pereira <adrapereira@gmail.com>

* [v9.2.x] Explore: Track data links usage (#56868) (#58037)

* Explore: Track data links usage (#56868)

* Add tracking for data links in explore

* Add tracking for data links in explore

* Fix tests

* Retrigger build

(cherry picked from commit dd5e3a08184b3d875c0ee62aab7ca9a054a8c23e)

# Conflicts:
#	public/app/features/explore/Explore.tsx
#	public/app/features/explore/LogsContainer.tsx

* Post-merge fixes

Remove unused import

* reduce the number of requests in folder section (#55876) (#58145)

(cherry picked from commit 372ba83534e0fd91e1c25d7c3c27a3ac1f68f62c)

Co-authored-by: Marcos Vinicius <marcos.vinicius.wz@gmail.com>

* TimeSeries: more thorough detection of negative values for stacking dir (#57863) (#58147)

(cherry picked from commit 4d88e2b542c62bf287a60af01fddfa2e6de220b4)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* fixed explain handlers for label- and lineformat (#58135) (#58151)

(cherry picked from commit 4b1ddba0a8998884982d275e846ec4af6787a06f)

Co-authored-by: Sven Grossmann <sven.grossmann@grafana.com>

* fixes typo (#58159) (#58194)

(cherry picked from commit 1722000309c6e6dc36c9e4f5ef9c2e40cc6e6c65)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Alerting: Encode path separators to side-step proxies (#58222)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Build: add explicit build step for go codeql (#58195) (#58243)

* add explicit build step for go codeql

* support workflow_dispatch for codeql checks

* syntax fix

* enable on push to codeql-go branch

* test

* use go version from go.mod

* explicitly set go version

* tidy up, add workflow_dispatch support to all codeql actions

(cherry picked from commit da9c646f242fd16ba8a789fa5d1c50094d761ae7)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Search: Fixes searching by current folder when opened by clicking dashboard folder name  (#57716) (#57949)

* Search: Read from url on mount no on app boot

* Fixed tests

* Remove unused type

(cherry picked from commit 3991be4c1dd35ff05e1a7dee117710e766b1a3c9)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* "Release: Updated versions in package to 9.2.5" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying "General" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

"Release: Updated versions in package to 9.2.6"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

"Release: Updated versions in package to 9.2.7"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

"Release: Updated versions in package to 9.2.8"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation "stealing" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

"Release: Updated versions in package to 9.2.11"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v…
```

[matejkubinec](/matejkubinec)
added a commit
to percona/grafana
that referenced
this pull request
[Mar 16, 2023](#ref-commit-7a27215)
[![@matejkubinec](https://avatars.githubusercontent.com/u/32638572?s=40&u=f15b1e5f63d6faa5145a40e4164e0fa9ea72fff7&v=4)](/matejkubinec) [![@grafanabot](https://avatars.githubusercontent.com/u/43478413?s=40&u=a7be21af02d82dcfe4d68822d6add1dc78b445b1&v=4)](/grafanabot)
[![@nmarrs](https://avatars.githubusercontent.com/u/22381771?s=40&u=ccb32ecdc60cfb1698f45febb3b0bbce6038dc13&v=4)](/nmarrs) [![@ArturWierzbicki](https://avatars.githubusercontent.com/u/23451458?s=40&u=1f9adee1a1f94b4c245b838df05d6662400cea34&v=4)](/ArturWierzbicki) [![@mdvictor](https://avatars.githubusercontent.com/u/36818606?s=40&u=ce9025a7a04ae6e1a483480620fbc96442c74e43&v=4)](/mdvictor) [![@sh0rez](https://avatars.githubusercontent.com/u/26971117?s=40&u=b4bdcc92bc449d589bdc51b4df471dcc976d79c8&v=4)](/sh0rez) [![@gillesdemey](https://avatars.githubusercontent.com/u/868844?s=40&u=d34da4534900c5e729ae25d01ef03d75361486f8&v=4)](/gillesdemey) [![@IevaVasiljeva](https://avatars.githubusercontent.com/u/9482349?s=40&u=6bf34051e6e76a6e014cb56085fd8671f8a32f16&v=4)](/IevaVasiljeva) [![@gtk-grafana](https://avatars.githubusercontent.com/u/109082771?s=40&u=bbd7b28097ca89a03816a1dabae2fcb1189b174e&v=4)](/gtk-grafana) [![@kylebrandt](https://avatars.githubusercontent.com/u/1692624?s=40&u=f03edc41ac5f244ccf8afbaf591a2c2d5bf9422b&v=4)](/kylebrandt) [![@gamab](https://avatars.githubusercontent.com/u/5232696?s=40&u=6c5fef30916541609539c960841a8f9230a2fd6f&v=4)](/gamab) [![@Jguer](https://avatars.githubusercontent.com/u/8071073?s=40&u=31dcf861785552275aea3a89860b081ed114ee1f&v=4)](/Jguer) [![@itsmylife](https://avatars.githubusercontent.com/u/820946?s=40&u=5a928c48831b349c7da1b0022636df01ce0f1ced&v=4)](/itsmylife) [![@yinjialu](https://avatars.githubusercontent.com/u/37073056?s=40&v=4)](/yinjialu) [![@leeoniya](https://avatars.githubusercontent.com/u/43234?s=40&u=49f10c1db35f1a4f328346b597cc763f695bb29d&v=4)](/leeoniya) [![@kminehart](https://avatars.githubusercontent.com/u/5140827?s=40&u=6a9f121b3b6daf545a3b29dda06a0f7f62e2db7d&v=4)](/kminehart) [![@dsotirakis](https://avatars.githubusercontent.com/u/15115078?s=40&u=2637caf13fe96ac43d1680b369e8cfdb8732ddf1&v=4)](/dsotirakis) [![@mckn](https://avatars.githubusercontent.com/u/172951?s=40&v=4)](/mckn) [![@armandgrillet](https://avatars.githubusercontent.com/u/2117580?s=40&u=e7e72ff4eb22b8e90a0c6cf6d9a1300dd9ac0e3f&v=4)](/armandgrillet) [![@chri2547](https://avatars.githubusercontent.com/u/35463610?s=40&u=97f7cf99392dddf4ffdc83bbbce761efd6f40332&v=4)](/chri2547) [![@kaydelaney](https://avatars.githubusercontent.com/u/45561153?s=40&u=136490e13ee468c88746b8dc89a1772cbbf4ae73&v=4)](/kaydelaney) [![@joeblubaugh](https://avatars.githubusercontent.com/u/1951900?s=40&u=1f1faee9254bfaa1e686540a726bbd9ff1cf6e71&v=4)](/joeblubaugh) [![@jfagoagas](https://avatars.githubusercontent.com/u/16007882?s=40&u=95544302b7438701266a93bae2de3cc96e7be42e&v=4)](/jfagoagas) [![@kalleep](https://avatars.githubusercontent.com/u/23356117?s=40&v=4)](/kalleep) [![@sunker](https://avatars.githubusercontent.com/u/2388950?s=40&u=a614311e8b2ef2d114e50d00ca9262b9f73e9b29&v=4)](/sunker) [![@joshhunt](https://avatars.githubusercontent.com/u/46142?s=40&u=5bf6f4243ee4ab8d8a99c3c210af343fdc625798&v=4)](/joshhunt) [![@andresmgot](https://avatars.githubusercontent.com/u/4025665?s=40&u=6d474b97f4f73c53f4609e6921afdabc407c6dbb&v=4)](/andresmgot) [![@grobinson-grafana](https://avatars.githubusercontent.com/u/85952834?s=40&v=4)](/grobinson-grafana) [![@alexweav](https://avatars.githubusercontent.com/u/8410871?s=40&u=b0142389bdf25772feb7ba112977b2ba34dbfe6c&v=4)](/alexweav) [![@lionralfs](https://avatars.githubusercontent.com/u/16670790?s=40&u=8c241532d32e0de477818202f0883af39215299c&v=4)](/lionralfs) [![@santihernandezc](https://avatars.githubusercontent.com/u/41638679?s=40&u=e5de0a9e10494cc06d4781de14abbb1473526b8e&v=4)](/santihernandezc) [![@julienduchesne](https://avatars.githubusercontent.com/u/29210090?s=40&u=d64510d5f3d87110355ed5c2e12d07d216b13c3b&v=4)](/julienduchesne) [![@Elfo404](https://avatars.githubusercontent.com/u/1170767?s=40&u=00040d625496f2c19fd3c9e7b8a43bf8752ba1ab&v=4)](/Elfo404) [![@torkelo](https://avatars.githubusercontent.com/u/10999?s=40&u=00ee9b9643b8eafd5df664bad66f196ff32bd9ed&v=4)](/torkelo) [![@DanCech](https://avatars.githubusercontent.com/u/1443603?s=40&u=563883eed1a53cbd19c35742c3a3ee1b2ddfb0ac&v=4)](/DanCech) [![@eleijonmarck](https://avatars.githubusercontent.com/u/7727602?s=40&u=4f4984c270ed39839e9b8dff600287396939ac2b&v=4)](/eleijonmarck) [![@ashharrison90](https://avatars.githubusercontent.com/u/20999846?s=40&u=e6c1c42a3025abfa1c1d579691b5541df490cf73&v=4)](/ashharrison90) [![@adrapereira](https://avatars.githubusercontent.com/u/4313971?s=40&u=78f1a19e9e0539dc5da5c46eebed12987e83f4fd&v=4)](/adrapereira) [![@ifrost](https://avatars.githubusercontent.com/u/745532?s=40&u=0e3338cd009dbb61fc67c4dfcf2a4469fad47c97&v=4)](/ifrost) [![@mvsousa](https://avatars.githubusercontent.com/u/3681977?s=40&u=a80007616212a617090a537c3fa0855fd754853d&v=4)](/mvsousa) [![@svennergr](https://avatars.githubusercontent.com/u/8092184?s=40&u=733ce9f1c399468005886bdfa2ce242d758348f0&v=4)](/svennergr) [![@ryantxu](https://avatars.githubusercontent.com/u/705951?s=40&u=45875989d2adfe87f95caa12e32e5a82b08898f8&v=4)](/ryantxu) [![@oscarkilhed](https://avatars.githubusercontent.com/u/468940?s=40&u=cdfbb52c148b5da116460f3ea9126cb5b5569e54&v=4)](/oscarkilhed) [![@dessen-xu](https://avatars.githubusercontent.com/u/41524013?s=40&u=01884d79b94696e284a35c8b681bf29434ef1a36&v=4)](/dessen-xu) [![@sakjur](https://avatars.githubusercontent.com/u/298945?s=40&u=f59488eb9b9031b02ae9f24116f8d5ac7d0071f8&v=4)](/sakjur) [![@siiimooon](https://avatars.githubusercontent.com/u/85333972?s=40&u=bc3afa1dea6abfb33d7f3e626099df5bc77955ad&v=4)](/siiimooon) [![@zoltanbedi](https://avatars.githubusercontent.com/u/13729989?s=40&u=6b2d0104259543f280a6b8ea1cccaba2c59e87d5&v=4)](/zoltanbedi) [![@neel1996](https://avatars.githubusercontent.com/u/47709856?s=40&u=d02474c07146b62f73c082ba2d9e312909bbf5cc&v=4)](/neel1996) [![@marefr](https://avatars.githubusercontent.com/u/1668778?s=40&v=4)](/marefr) [![@wjordan](https://avatars.githubusercontent.com/u/56541?s=40&v=4)](/wjordan) [![@sd2k](https://avatars.githubusercontent.com/u/5464991?s=40&u=debba4e86c2176c3afc994fa3eb8ba9ddb7e6d53&v=4)](/sd2k) [![@asimpson](https://avatars.githubusercontent.com/u/1048831?s=40&u=d49ee317b1a2d379515b5e59c03fce5b70009faa&v=4)](/asimpson) [![@xiyu95](https://avatars.githubusercontent.com/u/112968312?s=40&u=ea78ebf8294c6ddaab752aaa136a3f1ac943bfd3&v=4)](/xiyu95) [![@wbrowne](https://avatars.githubusercontent.com/u/1173299?s=40&u=07b5baceef0bdc39ee7f967f39c9c82afb4a81d2&v=4)](/wbrowne) [![@gwdawson](https://avatars.githubusercontent.com/u/34524710?s=40&u=7ea8832f2f2e29b4805d75b3bba2411344593189&v=4)](/gwdawson) [![@xnyo](https://avatars.githubusercontent.com/u/16373015?s=40&u=1dc1b8caf479abe3feaa070c01b1400c3a62b448&v=4)](/xnyo) [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas) [![@joey-grafana](https://avatars.githubusercontent.com/u/90795735?s=40&u=16b1cfc381a83ca938f6d096935f0e747b3691fb&v=4)](/joey-grafana) [![@tolzhabayev](https://avatars.githubusercontent.com/u/580672?s=40&u=cf4a1f5bdba6e8ecfe23dc9fa22069e5431498f8&v=4)](/tolzhabayev) [![@jackw](https://avatars.githubusercontent.com/u/73201?s=40&u=9fb7fc975368a6fae3be8676b46cfc9ad06c7b15&v=4)](/jackw) [![@gguillotte-grafana](https://avatars.githubusercontent.com/u/100453168?s=40&u=3d0bf8114b33430d58934de11387ccd510f3a0e5&v=4)](/gguillotte-grafana) [![@phongvq](https://avatars.githubusercontent.com/u/20754136?s=40&u=30cff65424186e5ff97e24894b5935ae17fd73c2&v=4)](/phongvq) [![@daniellee](https://avatars.githubusercontent.com/u/434655?s=40&u=0625e6874dbde9488a0cd6bc2d3a94c665337551&v=4)](/daniellee) [![@mgyongyosi](https://avatars.githubusercontent.com/u/1585112?s=40&u=bedfa00ab0788c2bfe8411a8218f7bb9a446cc67&v=4)](/mgyongyosi) [![@malcolmholmes](https://avatars.githubusercontent.com/u/42545407?s=40&v=4)](/malcolmholmes) [![@jdbaldry](https://avatars.githubusercontent.com/u/4599384?s=40&v=4)](/jdbaldry) [![@zuchka](https://avatars.githubusercontent.com/u/37156449?s=40&u=7227f6489882e5cf0856219349f19ac1ddbd2a11&v=4)](/zuchka) [![@leandro-deveikis](https://avatars.githubusercontent.com/u/34773040?s=40&u=0c0813698b625812c84deccbe3e4727f5104a28a&v=4)](/leandro-deveikis) [![@bartpeeters](https://avatars.githubusercontent.com/u/29534282?s=40&v=4)](/bartpeeters) [![@yvigara](https://avatars.githubusercontent.com/u/704600?s=40&u=127c2e201ae7c012f5e801e624af426aaf059b1c&v=4)](/yvigara) [![@owensmallwood](https://avatars.githubusercontent.com/u/20195316?s=40&u=0381407162d812492507256b2e90d3ace502b045&v=4)](/owensmallwood) [![@lpskdl](https://avatars.githubusercontent.com/u/108552997?s=40&u=4b1d5afda8817ac8fa0c3f379fbc21f05339f682&v=4)](/lpskdl) [![@aangelisc](https://avatars.githubusercontent.com/u/15019026?s=40&u=3540a1f3f4e09019aaa10a927ca4ca1a8b1caa51&v=4)](/aangelisc) [![@zserge](https://avatars.githubusercontent.com/u/1911760?s=40&u=d54bceb88fc5adc736476c5625bc96eed3725de0&v=4)](/zserge) [![@bergquist](https://avatars.githubusercontent.com/u/618863?s=40&u=3e138dc82d635ddf0c5c82e6463edb81b2205a74&v=4)](/bergquist) [![@iwysiu](https://avatars.githubusercontent.com/u/5421859?s=40&v=4)](/iwysiu) [![@bohandley](https://avatars.githubusercontent.com/u/25674746?s=40&u=5db785e20acac583c2c70f95579eed8acda76034&v=4)](/bohandley) [![@Eve832](https://avatars.githubusercontent.com/u/81647476?s=40&u=171081136377053e2d0a04a2d1f5e21270066d50&v=4)](/Eve832) [![@JacobsonMT](https://avatars.githubusercontent.com/u/8484471?s=40&u=30df9eec2de8834a517222b6f477bbf30598b98c&v=4)](/JacobsonMT) [![@robbymilo](https://avatars.githubusercontent.com/u/8106669?s=40&u=b5929162f75a8e3e5dca80dcfe543e46ff5985aa&v=4)](/robbymilo) [![@academo](https://avatars.githubusercontent.com/u/227916?s=40&u=2d66242d42fb2751b3a9b966ef1d433be978e4dc&v=4)](/academo) [![@adela-almasan](https://avatars.githubusercontent.com/u/88068998?s=40&u=8c681fb7664266c333858b055907df9d31b705ac&v=4)](/adela-almasan) [![@ktw4071](https://avatars.githubusercontent.com/u/10269640?s=40&v=4)](/ktw4071) [![@linoman](https://avatars.githubusercontent.com/u/2051016?s=40&u=85065225ade2a54d017c39fa976bcee1d79de5c9&v=4)](/linoman) [![@leventebalogh](https://avatars.githubusercontent.com/u/9974811?s=40&u=7e1691a3b32d0f3adbe905e8863a6be9cde6461f&v=4)](/leventebalogh) [![@xlson](https://avatars.githubusercontent.com/u/114937?s=40&u=d3cfffe519c44bd3938c5f7297f4b880ada09bbe&v=4)](/xlson) [![@usmangt](https://avatars.githubusercontent.com/u/69509548?s=40&u=2072d0b29b8514dfa1ded27606bd014f7edc020a&v=4)](/usmangt) [![@zerok](https://avatars.githubusercontent.com/u/3782?s=40&v=4)](/zerok) [![@imatwawana](https://avatars.githubusercontent.com/u/76437239?s=40&u=6dd696d8dde9fd57f5a423f3a81cf99a82d9a5cf&v=4)](/imatwawana) [![@aocenas](https://avatars.githubusercontent.com/u/1014802?s=40&u=a934e3470e711b2ed875899d43d9f887ee88b5a7&v=4)](/aocenas) [![@codeincarnate](https://avatars.githubusercontent.com/u/199847?s=40&u=133d1e683542a7ec4b44a74c617962e777eba96e&v=4)](/codeincarnate)

`[PMM-11762](https://jira.percona.com/browse/PMM-11762) [- Grafana 9.2.13 (](/percona/grafana/commit/7a27215437f712bdb93f9e1963062dd162a33ae8 "PMM-11762 - Grafana 9.2.13 (#629)

* Canvas: Improve resource picker initialization (#57319) (#57566)

(cherry picked from commit 9d857f4d61803f6156de5c7d89b04cd2593d0632)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* Storage: Fix initialization on windows (#57504) (#57577)

(cherry picked from commit 749b3b62631e89b07a592ec922447b1c9158afa5)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* TablePanel: Fix updating footer values on data change (#57518) (#57581)

* TablePanel: Fix updating footer values on data change

* tests

(cherry picked from commit c30716a073d0147fe85ddb1102429d04f6a4d6df)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* live: explicitely reply with http 200 (#57428) (#57592)

`pkg/web` triggers a panic when a http handler chain does not return any
response to the client.
This has been put in place, because it usually means a middleware along
the way did not call the next one.

In this specific case however, the handlers meant to return 200, but did
not do so explicitely, instead relying on the default behavior of `net/http`

(cherry picked from commit beaaabd770e540c463800e6d320884e3c6e00ae0)

Co-authored-by: sh0rez <me@shorez.de>

* Changelog: Updated changelog for 9.2.2 (#57601) (#57604)

(cherry picked from commit f64b0e1fae248469ee0fc8fbb2fc8efb90228808)

* \"Release: Updated versions in package to 9.2.3\" (#57605)

* [v9.2.x] Alerting: Always allow configuring AM configuration (#57614)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* move data source permission model to enterprise repo (#57615) (#57659)

(cherry picked from commit 92531c559612dd077f30b186873e23002c5c5ac5)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* Prometheus: Flavor/version configuration (#57554) (#57563)

* Backport PR for: Prometheus: Flavor/version configuration (#57554), and /label match parameter support #56510

* Revert \"Revert \"Prometheus: Type and flavor configuration (#56496)\" (#57552)\"
This reverts commit 2432ce619a7e62026685df14f60116ea4fb3447d.
* Adds new fields and documentation for Prometheus datasource configuration: prometheus type, and version

(cherry picked from commit f93c3acc51180cee78222f2df95ac7b380d1a616)

* Revert \"Revert \"Prometheus: Provide label values match parameter API when supported prometheus instance is configured (#56510)\" (#57551)\" (#57553) (#57564)

This reverts commit e7671bf9092811ecb053466e5b9c9913e2922fe1.
(cherry picked from commit e59ddd6bc5630625e49cafc965764cd8faa23cd6)
Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Prometheus query builder: Replace select with AsyncSelect to support high cardinality prometheus instances (#57300) (#57630)

* Replace current select with AsyncSelect component to facilitate autocomplete via prometheus server instead of client application
Co-authored-by: Kyle Brandt <kyle@grafana.com>

(cherry picked from commit c27aac0d385bfe695dec5f1b268940b4a19d3c50)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Docs: (Whats new 9.2) Prom Stream Parser (#57603) (#57693)

* Docs: (Whats new 9.2) Prom Stream Parser

* Update docs/sources/whatsnew/whats-new-in-v9-2.md

Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>

Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>
(cherry picked from commit dfdc9bcbc1491beb746914fcb8645436819d8aee)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Fix: Unlock new button based on user permissions (#57733) (#57760)

(cherry picked from commit 4d380978d304029ff17f2c2f0195e1b5b0a0c5b5)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* fix GF_AUTH_JWT_URL_LOGIN not working (#57689) (#57761)

(cherry picked from commit cae900c6f9e41b5559d8ed25afa5cd5d2af56aa0)

* [v9.2.x] Alerting: Fall back to \"range\" query type for unified alerting when \"both\" is specified (#57765)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Alerting: Fix \"Not Implemented\" responses (#57710) (#57712)

* Prometheus: fix Raw query is not updated when label op change. (#57492) (#57493) (#57780)

(cherry picked from commit 9aac0d32f9dbb77d0701398bf3d577a55dcce224)

Co-authored-by: yinjialu <37073056+yinjialu@users.noreply.github.com>

* Candlestick: Maintain candle width at different display resolutions (#57709) (#57794)

(cherry picked from commit 7d020d3f6e5476b47ce258dd4315e24a311f0506)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* TimeseriesPanel: Fill below to override works with name override (#57728) (#57800)

(cherry picked from commit 953fdfe76f3d6e51b8b32f4285e9501dfab944c5)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Security: Upgrade x/text to version unaffected by CVE-2022-32149 (#57797)

* Only provide version ot build-frontend-packages if it's a valid semver (has 2 digits) (#57808) (#57810)

(cherry picked from commit fd16cad7da36420148ae5811cfefa9876ce8f782)

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>

* CI: Add `CreateTempDir` func and use it in publish packages logic (#57171) (#57261)

* Add CreateTempDir func and use it in publish packages logic

* Fill err return in defer func

(cherry picked from commit e829b5014911363be862306b34a41fb0eeb13362)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Chore: Fix vulnerabilities in webpack loader-utils (#57753)

* chore: remove unused webpack loaders from core and toolkit

* chore: refresh yarn.lock file

* getting there...I hope..

* making sure we are not using naughty loader-utils.

* fixed storybook.

* Remove Sensu from docs (#57812) (#57823)

We do not support Sensu in Grafana Alerting, only Sensu Go.

(cherry picked from commit ee7adc081b3b2136d3786c069762057e8f428461)

Co-authored-by: Armand Grillet <2117580+armandgrillet@users.noreply.github.com>

* Prometheus: Do not drop errors in streaming parser (#57698) (#57835)

- Fixes #57692
- and also takes care of #42776 when using the streaming parser, not an ideal fix for #42776 but makes explore work better I think. https://github.com/grafana/grafana/issues/57365 might be a better longer term solution

(cherry picked from commit 6126f56ef0a0428ab3021c5a3368c2911000654f)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Prometheus: Chore - Remove incorrect FrameType from exemplar frame (#57695) (#57828)

(cherry picked from commit 2cd9cbd35925830dee97d9d18840eadc9d0cbbf3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* resolves merge conflicts (#57840)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* Docs: Add information about DB version support to upgrade guide. (#57643) (#57868)

In v9.2 Grafana added an official DB version support policy. That change
is now noted in the upgrade guide.

(cherry picked from commit 89d917b196a12bafbec80d043fa1f36e9c825243)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Access Control: documentation for RBAC provisioning with Terraform (#57747) (#57882)

* add docs for RBAC provisioning with Terraform

* remove unnecessary bit

* shuffle the structure around, as docs can't go more than four levels deep

* Update index.md

* Update index.md

(cherry picked from commit 7e62352aea20a47589b66f20c2c8ef7ca5847b65)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* docs(config): Include admin_email documentation (#55789) (#57725)

(cherry picked from commit 1340c2c358d37c3249246277d4eeb51806faacb1)

Co-authored-by: Pepe Fagoaga <pepe@verica.io>

* RBAC: Allow to list users for dashboard / folder admins (#57080) (#57252)

* RBAC: Use query struct in tests

* RBAC: If access control enforcement is disabled don't filter out users
when fetching permissions

(cherry picked from commit 9adaf1565c2408e3e13668af7d50cdcdd5d77242)

Co-authored-by: Karl Persson <kalle.persson@grafana.com>

* CloudWatch: Fix broken test (#57879) (#57900)

* mock date.now

* fix broken test

(cherry picked from commit 92ed9a4f2f6c3d5b8a0cfeaecda0062f6b77c525)

Co-authored-by: Erik Sundell <erik.sundell87@gmail.com>

* Chore: Update footer changelog link to github (#57871) (#57895)

(cherry picked from commit fd5c14757486ef510741ac344469b1ccfe2a6242)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Google Cloud Monitoring: Ensure selectors fit in the screen (#57817) (#57899)

(cherry picked from commit ce38840f293bfe94a1d6338a9bab255b3d7cc56c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* add an endpoint for updating several managed permissions with one call (#57893) (#57898)

(cherry picked from commit 2546437e2052025daaf8ee2ab9ea4262b7364e61)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* change json command parameter names from userID to userId and teamID to teamId (#57902) (#57913)

(cherry picked from commit 5c1a1c8318bec43dec6aaf130aaafda3f19e54a6)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* Alerting: Add debug logs in validateAndGetPrefix (#57002) (#57923)

(cherry picked from commit b0a927b1385654a6776cbe8deb36f6dfadc914fd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Attempt to preserve UID from migrated channel (#57639) (#57919)

(cherry picked from commit 0dfd78c88cbb97df6594dda57d73c705bda106e0)

Co-authored-by: Alexander Weaver <weaver.alex.d@gmail.com>

* [v9.2.x] Alerting: fix filtering in notification policies (#57925)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* removes CTAs (#57931) (#57935)

(cherry picked from commit 6aa3003a541552aa9ce6e9b3e95a9dd0b8213e78)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* BarChart: Fix stacked hover (#57711) (#57937)

(cherry picked from commit fbfd0fd51b1d61b186957e0b58c2ea60472f55f3)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* TimeSeries: Render null-bounded points at data edges (#57798) (#57938)

(cherry picked from commit 45234e76eb82a417d8cee236d7a2ad91dc580bbb)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* CloudWatch: Fix `all-log-groups` endpoint when called without logGroupNamePrefix  (#57483) (#57945)

(cherry picked from commit 1f7c84f1256ed46fe5099f27aae57a2121da1080)

Co-authored-by: Lion Ralfs <lion.ralfs@gmail.com>

* Add GCP_KEY to publish-grafanacom step (#57910) (#57948)

(cherry picked from commit 1eaf7cbfc0f4aaed8b84c3e50d9c0c352668b363)

* Changelog: Updated changelog for 9.2.3 (#57955) (#57957)

(cherry picked from commit 02add89b530a569f38e38597be294c6b16ef29d8)

* \"Release: Updated versions in package to 9.2.4\" (#57958)

* metrics: expose when the binary was built as an gauge (#57951) (#57969)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 3188af9be352feabeb000b204d7375b5626231d5)

* Alerting: Fix flaky test in notifiers (#57927) (#57993)

* Alerting: Fix flaky test in notifiers

* remove TODO comment

(cherry picked from commit a3f828de8aae968f783aeeb648de98e75c421af4)

Co-authored-by: Santiago <santiagohernandez.1997@gmail.com>

* [v9.2.x] Google Cloud Monitoring: Set frame interval to draw null values (#57914)

* Linux Packages: Handle publish to beta (#57528) (#58044)

Uses the feature added here: https://github.com/grafana/deployment_tools/pull/46301
When a version is named \"beta\", it will be distributed in the beta distribution, rather than in stable

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
(cherry picked from commit c46a4a0b260d3b008bfa771cdc103065a6fe6880)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* chore: bump code coverage action version (#56710) (#58040)

(cherry picked from commit e3e32c7d04a5d20b45411c118f7e3c7e63d90709)

Co-authored-by: Giordano Ricci <me@giordanoricci.com>

* Alerting: Fix response is not returned for invalid Duration in Provisioning API (#58046) (#58049)

(cherry picked from commit 4c581b5f85db705bd4b01d5679407069dd3b2cfb)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* LibrayPanels: Fix unlinking libray panel (#57825) (#58042)

* remove unneeded package updates (#58005) (#58068)

(cherry picked from commit 6a4a10fa926e89eb0498a4d703ccc8c67b5dd46d)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Alerting: Fix feedback (#57922) (#58104)

(cherry picked from commit f2e4cb7c4ea4ee85a177e27fba3d6bf191e043a7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshot is not taken for stale series (#57982) (#58102)

(cherry picked from commit 215ffee4375adb784526827340bbc8c66fd342cc)

* fix: migration of alert_rules fix (#58123)

* increase select placeholder contrast to be WCAG AA compliant (#58034) (#58125)

(cherry picked from commit c3206167a65babd66ca4d590723c4fd754c4aad9)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Tempo: Make usage of time range for TraceID query optional (#58057) (#58128)

* Added switch to toggle the TraceID query time shift

* Fix and improve tests

(cherry picked from commit 90ac300d1023768f9778bb58e77a05948dea5b2e)

Co-authored-by: Andre Pereira <adrapereira@gmail.com>

* [v9.2.x] Explore: Track data links usage (#56868) (#58037)

* Explore: Track data links usage (#56868)

* Add tracking for data links in explore

* Add tracking for data links in explore

* Fix tests

* Retrigger build

(cherry picked from commit dd5e3a08184b3d875c0ee62aab7ca9a054a8c23e)

# Conflicts:
#	public/app/features/explore/Explore.tsx
#	public/app/features/explore/LogsContainer.tsx

* Post-merge fixes

Remove unused import

* reduce the number of requests in folder section (#55876) (#58145)

(cherry picked from commit 372ba83534e0fd91e1c25d7c3c27a3ac1f68f62c)

Co-authored-by: Marcos Vinicius <marcos.vinicius.wz@gmail.com>

* TimeSeries: more thorough detection of negative values for stacking dir (#57863) (#58147)

(cherry picked from commit 4d88e2b542c62bf287a60af01fddfa2e6de220b4)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* fixed explain handlers for label- and lineformat (#58135) (#58151)

(cherry picked from commit 4b1ddba0a8998884982d275e846ec4af6787a06f)

Co-authored-by: Sven Grossmann <sven.grossmann@grafana.com>

* fixes typo (#58159) (#58194)

(cherry picked from commit 1722000309c6e6dc36c9e4f5ef9c2e40cc6e6c65)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Alerting: Encode path separators to side-step proxies (#58222)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Build: add explicit build step for go codeql (#58195) (#58243)

* add explicit build step for go codeql

* support workflow_dispatch for codeql checks

* syntax fix

* enable on push to codeql-go branch

* test

* use go version from go.mod

* explicitly set go version

* tidy up, add workflow_dispatch support to all codeql actions

(cherry picked from commit da9c646f242fd16ba8a789fa5d1c50094d761ae7)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Search: Fixes searching by current folder when opened by clicking dashboard folder name  (#57716) (#57949)

* Search: Read from url on mount no on app boot

* Fixed tests

* Remove unused type

(cherry picked from commit 3991be4c1dd35ff05e1a7dee117710e766b1a3c9)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* \"Release: Updated versions in package to 9.2.5\" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying \"General\" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

\"Release: Updated versions in package to 9.2.6\"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

\"Release: Updated versions in package to 9.2.7\"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

\"Release: Updated versions in package to 9.2.8\"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation \"stealing\" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

\"Release: Updated versions in package to 9.2.11\"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v…")[#629](https://github.com/percona/grafana/pull/629)[)](/percona/grafana/commit/7a27215437f712bdb93f9e1963062dd162a33ae8 "PMM-11762 - Grafana 9.2.13 (#629)

* Canvas: Improve resource picker initialization (#57319) (#57566)

(cherry picked from commit 9d857f4d61803f6156de5c7d89b04cd2593d0632)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* Storage: Fix initialization on windows (#57504) (#57577)

(cherry picked from commit 749b3b62631e89b07a592ec922447b1c9158afa5)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* TablePanel: Fix updating footer values on data change (#57518) (#57581)

* TablePanel: Fix updating footer values on data change

* tests

(cherry picked from commit c30716a073d0147fe85ddb1102429d04f6a4d6df)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* live: explicitely reply with http 200 (#57428) (#57592)

`pkg/web` triggers a panic when a http handler chain does not return any
response to the client.
This has been put in place, because it usually means a middleware along
the way did not call the next one.

In this specific case however, the handlers meant to return 200, but did
not do so explicitely, instead relying on the default behavior of `net/http`

(cherry picked from commit beaaabd770e540c463800e6d320884e3c6e00ae0)

Co-authored-by: sh0rez <me@shorez.de>

* Changelog: Updated changelog for 9.2.2 (#57601) (#57604)

(cherry picked from commit f64b0e1fae248469ee0fc8fbb2fc8efb90228808)

* \"Release: Updated versions in package to 9.2.3\" (#57605)

* [v9.2.x] Alerting: Always allow configuring AM configuration (#57614)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* move data source permission model to enterprise repo (#57615) (#57659)

(cherry picked from commit 92531c559612dd077f30b186873e23002c5c5ac5)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* Prometheus: Flavor/version configuration (#57554) (#57563)

* Backport PR for: Prometheus: Flavor/version configuration (#57554), and /label match parameter support #56510

* Revert \"Revert \"Prometheus: Type and flavor configuration (#56496)\" (#57552)\"
This reverts commit 2432ce619a7e62026685df14f60116ea4fb3447d.
* Adds new fields and documentation for Prometheus datasource configuration: prometheus type, and version

(cherry picked from commit f93c3acc51180cee78222f2df95ac7b380d1a616)

* Revert \"Revert \"Prometheus: Provide label values match parameter API when supported prometheus instance is configured (#56510)\" (#57551)\" (#57553) (#57564)

This reverts commit e7671bf9092811ecb053466e5b9c9913e2922fe1.
(cherry picked from commit e59ddd6bc5630625e49cafc965764cd8faa23cd6)
Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Prometheus query builder: Replace select with AsyncSelect to support high cardinality prometheus instances (#57300) (#57630)

* Replace current select with AsyncSelect component to facilitate autocomplete via prometheus server instead of client application
Co-authored-by: Kyle Brandt <kyle@grafana.com>

(cherry picked from commit c27aac0d385bfe695dec5f1b268940b4a19d3c50)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Docs: (Whats new 9.2) Prom Stream Parser (#57603) (#57693)

* Docs: (Whats new 9.2) Prom Stream Parser

* Update docs/sources/whatsnew/whats-new-in-v9-2.md

Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>

Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>
(cherry picked from commit dfdc9bcbc1491beb746914fcb8645436819d8aee)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Fix: Unlock new button based on user permissions (#57733) (#57760)

(cherry picked from commit 4d380978d304029ff17f2c2f0195e1b5b0a0c5b5)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* fix GF_AUTH_JWT_URL_LOGIN not working (#57689) (#57761)

(cherry picked from commit cae900c6f9e41b5559d8ed25afa5cd5d2af56aa0)

* [v9.2.x] Alerting: Fall back to \"range\" query type for unified alerting when \"both\" is specified (#57765)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Alerting: Fix \"Not Implemented\" responses (#57710) (#57712)

* Prometheus: fix Raw query is not updated when label op change. (#57492) (#57493) (#57780)

(cherry picked from commit 9aac0d32f9dbb77d0701398bf3d577a55dcce224)

Co-authored-by: yinjialu <37073056+yinjialu@users.noreply.github.com>

* Candlestick: Maintain candle width at different display resolutions (#57709) (#57794)

(cherry picked from commit 7d020d3f6e5476b47ce258dd4315e24a311f0506)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* TimeseriesPanel: Fill below to override works with name override (#57728) (#57800)

(cherry picked from commit 953fdfe76f3d6e51b8b32f4285e9501dfab944c5)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Security: Upgrade x/text to version unaffected by CVE-2022-32149 (#57797)

* Only provide version ot build-frontend-packages if it's a valid semver (has 2 digits) (#57808) (#57810)

(cherry picked from commit fd16cad7da36420148ae5811cfefa9876ce8f782)

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>

* CI: Add `CreateTempDir` func and use it in publish packages logic (#57171) (#57261)

* Add CreateTempDir func and use it in publish packages logic

* Fill err return in defer func

(cherry picked from commit e829b5014911363be862306b34a41fb0eeb13362)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Chore: Fix vulnerabilities in webpack loader-utils (#57753)

* chore: remove unused webpack loaders from core and toolkit

* chore: refresh yarn.lock file

* getting there...I hope..

* making sure we are not using naughty loader-utils.

* fixed storybook.

* Remove Sensu from docs (#57812) (#57823)

We do not support Sensu in Grafana Alerting, only Sensu Go.

(cherry picked from commit ee7adc081b3b2136d3786c069762057e8f428461)

Co-authored-by: Armand Grillet <2117580+armandgrillet@users.noreply.github.com>

* Prometheus: Do not drop errors in streaming parser (#57698) (#57835)

- Fixes #57692
- and also takes care of #42776 when using the streaming parser, not an ideal fix for #42776 but makes explore work better I think. https://github.com/grafana/grafana/issues/57365 might be a better longer term solution

(cherry picked from commit 6126f56ef0a0428ab3021c5a3368c2911000654f)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Prometheus: Chore - Remove incorrect FrameType from exemplar frame (#57695) (#57828)

(cherry picked from commit 2cd9cbd35925830dee97d9d18840eadc9d0cbbf3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* resolves merge conflicts (#57840)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* Docs: Add information about DB version support to upgrade guide. (#57643) (#57868)

In v9.2 Grafana added an official DB version support policy. That change
is now noted in the upgrade guide.

(cherry picked from commit 89d917b196a12bafbec80d043fa1f36e9c825243)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Access Control: documentation for RBAC provisioning with Terraform (#57747) (#57882)

* add docs for RBAC provisioning with Terraform

* remove unnecessary bit

* shuffle the structure around, as docs can't go more than four levels deep

* Update index.md

* Update index.md

(cherry picked from commit 7e62352aea20a47589b66f20c2c8ef7ca5847b65)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* docs(config): Include admin_email documentation (#55789) (#57725)

(cherry picked from commit 1340c2c358d37c3249246277d4eeb51806faacb1)

Co-authored-by: Pepe Fagoaga <pepe@verica.io>

* RBAC: Allow to list users for dashboard / folder admins (#57080) (#57252)

* RBAC: Use query struct in tests

* RBAC: If access control enforcement is disabled don't filter out users
when fetching permissions

(cherry picked from commit 9adaf1565c2408e3e13668af7d50cdcdd5d77242)

Co-authored-by: Karl Persson <kalle.persson@grafana.com>

* CloudWatch: Fix broken test (#57879) (#57900)

* mock date.now

* fix broken test

(cherry picked from commit 92ed9a4f2f6c3d5b8a0cfeaecda0062f6b77c525)

Co-authored-by: Erik Sundell <erik.sundell87@gmail.com>

* Chore: Update footer changelog link to github (#57871) (#57895)

(cherry picked from commit fd5c14757486ef510741ac344469b1ccfe2a6242)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Google Cloud Monitoring: Ensure selectors fit in the screen (#57817) (#57899)

(cherry picked from commit ce38840f293bfe94a1d6338a9bab255b3d7cc56c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* add an endpoint for updating several managed permissions with one call (#57893) (#57898)

(cherry picked from commit 2546437e2052025daaf8ee2ab9ea4262b7364e61)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* change json command parameter names from userID to userId and teamID to teamId (#57902) (#57913)

(cherry picked from commit 5c1a1c8318bec43dec6aaf130aaafda3f19e54a6)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* Alerting: Add debug logs in validateAndGetPrefix (#57002) (#57923)

(cherry picked from commit b0a927b1385654a6776cbe8deb36f6dfadc914fd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Attempt to preserve UID from migrated channel (#57639) (#57919)

(cherry picked from commit 0dfd78c88cbb97df6594dda57d73c705bda106e0)

Co-authored-by: Alexander Weaver <weaver.alex.d@gmail.com>

* [v9.2.x] Alerting: fix filtering in notification policies (#57925)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* removes CTAs (#57931) (#57935)

(cherry picked from commit 6aa3003a541552aa9ce6e9b3e95a9dd0b8213e78)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* BarChart: Fix stacked hover (#57711) (#57937)

(cherry picked from commit fbfd0fd51b1d61b186957e0b58c2ea60472f55f3)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* TimeSeries: Render null-bounded points at data edges (#57798) (#57938)

(cherry picked from commit 45234e76eb82a417d8cee236d7a2ad91dc580bbb)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* CloudWatch: Fix `all-log-groups` endpoint when called without logGroupNamePrefix  (#57483) (#57945)

(cherry picked from commit 1f7c84f1256ed46fe5099f27aae57a2121da1080)

Co-authored-by: Lion Ralfs <lion.ralfs@gmail.com>

* Add GCP_KEY to publish-grafanacom step (#57910) (#57948)

(cherry picked from commit 1eaf7cbfc0f4aaed8b84c3e50d9c0c352668b363)

* Changelog: Updated changelog for 9.2.3 (#57955) (#57957)

(cherry picked from commit 02add89b530a569f38e38597be294c6b16ef29d8)

* \"Release: Updated versions in package to 9.2.4\" (#57958)

* metrics: expose when the binary was built as an gauge (#57951) (#57969)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 3188af9be352feabeb000b204d7375b5626231d5)

* Alerting: Fix flaky test in notifiers (#57927) (#57993)

* Alerting: Fix flaky test in notifiers

* remove TODO comment

(cherry picked from commit a3f828de8aae968f783aeeb648de98e75c421af4)

Co-authored-by: Santiago <santiagohernandez.1997@gmail.com>

* [v9.2.x] Google Cloud Monitoring: Set frame interval to draw null values (#57914)

* Linux Packages: Handle publish to beta (#57528) (#58044)

Uses the feature added here: https://github.com/grafana/deployment_tools/pull/46301
When a version is named \"beta\", it will be distributed in the beta distribution, rather than in stable

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
(cherry picked from commit c46a4a0b260d3b008bfa771cdc103065a6fe6880)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* chore: bump code coverage action version (#56710) (#58040)

(cherry picked from commit e3e32c7d04a5d20b45411c118f7e3c7e63d90709)

Co-authored-by: Giordano Ricci <me@giordanoricci.com>

* Alerting: Fix response is not returned for invalid Duration in Provisioning API (#58046) (#58049)

(cherry picked from commit 4c581b5f85db705bd4b01d5679407069dd3b2cfb)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* LibrayPanels: Fix unlinking libray panel (#57825) (#58042)

* remove unneeded package updates (#58005) (#58068)

(cherry picked from commit 6a4a10fa926e89eb0498a4d703ccc8c67b5dd46d)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Alerting: Fix feedback (#57922) (#58104)

(cherry picked from commit f2e4cb7c4ea4ee85a177e27fba3d6bf191e043a7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshot is not taken for stale series (#57982) (#58102)

(cherry picked from commit 215ffee4375adb784526827340bbc8c66fd342cc)

* fix: migration of alert_rules fix (#58123)

* increase select placeholder contrast to be WCAG AA compliant (#58034) (#58125)

(cherry picked from commit c3206167a65babd66ca4d590723c4fd754c4aad9)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Tempo: Make usage of time range for TraceID query optional (#58057) (#58128)

* Added switch to toggle the TraceID query time shift

* Fix and improve tests

(cherry picked from commit 90ac300d1023768f9778bb58e77a05948dea5b2e)

Co-authored-by: Andre Pereira <adrapereira@gmail.com>

* [v9.2.x] Explore: Track data links usage (#56868) (#58037)

* Explore: Track data links usage (#56868)

* Add tracking for data links in explore

* Add tracking for data links in explore

* Fix tests

* Retrigger build

(cherry picked from commit dd5e3a08184b3d875c0ee62aab7ca9a054a8c23e)

# Conflicts:
#	public/app/features/explore/Explore.tsx
#	public/app/features/explore/LogsContainer.tsx

* Post-merge fixes

Remove unused import

* reduce the number of requests in folder section (#55876) (#58145)

(cherry picked from commit 372ba83534e0fd91e1c25d7c3c27a3ac1f68f62c)

Co-authored-by: Marcos Vinicius <marcos.vinicius.wz@gmail.com>

* TimeSeries: more thorough detection of negative values for stacking dir (#57863) (#58147)

(cherry picked from commit 4d88e2b542c62bf287a60af01fddfa2e6de220b4)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* fixed explain handlers for label- and lineformat (#58135) (#58151)

(cherry picked from commit 4b1ddba0a8998884982d275e846ec4af6787a06f)

Co-authored-by: Sven Grossmann <sven.grossmann@grafana.com>

* fixes typo (#58159) (#58194)

(cherry picked from commit 1722000309c6e6dc36c9e4f5ef9c2e40cc6e6c65)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Alerting: Encode path separators to side-step proxies (#58222)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Build: add explicit build step for go codeql (#58195) (#58243)

* add explicit build step for go codeql

* support workflow_dispatch for codeql checks

* syntax fix

* enable on push to codeql-go branch

* test

* use go version from go.mod

* explicitly set go version

* tidy up, add workflow_dispatch support to all codeql actions

(cherry picked from commit da9c646f242fd16ba8a789fa5d1c50094d761ae7)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Search: Fixes searching by current folder when opened by clicking dashboard folder name  (#57716) (#57949)

* Search: Read from url on mount no on app boot

* Fixed tests

* Remove unused type

(cherry picked from commit 3991be4c1dd35ff05e1a7dee117710e766b1a3c9)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* \"Release: Updated versions in package to 9.2.5\" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying \"General\" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

\"Release: Updated versions in package to 9.2.6\"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

\"Release: Updated versions in package to 9.2.7\"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

\"Release: Updated versions in package to 9.2.8\"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation \"stealing\" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

\"Release: Updated versions in package to 9.2.11\"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v…")`
…

`[7a27215](/percona/grafana/commit/7a27215437f712bdb93f9e1963062dd162a33ae8)`

```
* Canvas: Improve resource picker initialization (#57319) (#57566)

(cherry picked from commit 9d857f4d61803f6156de5c7d89b04cd2593d0632)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* Storage: Fix initialization on windows (#57504) (#57577)

(cherry picked from commit 749b3b62631e89b07a592ec922447b1c9158afa5)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* TablePanel: Fix updating footer values on data change (#57518) (#57581)

* TablePanel: Fix updating footer values on data change

* tests

(cherry picked from commit c30716a073d0147fe85ddb1102429d04f6a4d6df)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* live: explicitely reply with http 200 (#57428) (#57592)

`pkg/web` triggers a panic when a http handler chain does not return any
response to the client.
This has been put in place, because it usually means a middleware along
the way did not call the next one.

In this specific case however, the handlers meant to return 200, but did
not do so explicitely, instead relying on the default behavior of `net/http`

(cherry picked from commit beaaabd770e540c463800e6d320884e3c6e00ae0)

Co-authored-by: sh0rez <me@shorez.de>

* Changelog: Updated changelog for 9.2.2 (#57601) (#57604)

(cherry picked from commit f64b0e1fae248469ee0fc8fbb2fc8efb90228808)

* "Release: Updated versions in package to 9.2.3" (#57605)

* [v9.2.x] Alerting: Always allow configuring AM configuration (#57614)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* move data source permission model to enterprise repo (#57615) (#57659)

(cherry picked from commit 92531c559612dd077f30b186873e23002c5c5ac5)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* Prometheus: Flavor/version configuration (#57554) (#57563)

* Backport PR for: Prometheus: Flavor/version configuration (#57554), and /label match parameter support #56510

* Revert "Revert "Prometheus: Type and flavor configuration (#56496)" (#57552)"
This reverts commit 2432ce619a7e62026685df14f60116ea4fb3447d.
* Adds new fields and documentation for Prometheus datasource configuration: prometheus type, and version

(cherry picked from commit f93c3acc51180cee78222f2df95ac7b380d1a616)

* Revert "Revert "Prometheus: Provide label values match parameter API when supported prometheus instance is configured (#56510)" (#57551)" (#57553) (#57564)

This reverts commit e7671bf9092811ecb053466e5b9c9913e2922fe1.
(cherry picked from commit e59ddd6bc5630625e49cafc965764cd8faa23cd6)
Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Prometheus query builder: Replace select with AsyncSelect to support high cardinality prometheus instances (#57300) (#57630)

* Replace current select with AsyncSelect component to facilitate autocomplete via prometheus server instead of client application
Co-authored-by: Kyle Brandt <kyle@grafana.com>

(cherry picked from commit c27aac0d385bfe695dec5f1b268940b4a19d3c50)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Docs: (Whats new 9.2) Prom Stream Parser (#57603) (#57693)

* Docs: (Whats new 9.2) Prom Stream Parser

* Update docs/sources/whatsnew/whats-new-in-v9-2.md

Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>

Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>
(cherry picked from commit dfdc9bcbc1491beb746914fcb8645436819d8aee)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Fix: Unlock new button based on user permissions (#57733) (#57760)

(cherry picked from commit 4d380978d304029ff17f2c2f0195e1b5b0a0c5b5)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* fix GF_AUTH_JWT_URL_LOGIN not working (#57689) (#57761)

(cherry picked from commit cae900c6f9e41b5559d8ed25afa5cd5d2af56aa0)

* [v9.2.x] Alerting: Fall back to "range" query type for unified alerting when "both" is specified (#57765)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Alerting: Fix "Not Implemented" responses (#57710) (#57712)

* Prometheus: fix Raw query is not updated when label op change. (#57492) (#57493) (#57780)

(cherry picked from commit 9aac0d32f9dbb77d0701398bf3d577a55dcce224)

Co-authored-by: yinjialu <37073056+yinjialu@users.noreply.github.com>

* Candlestick: Maintain candle width at different display resolutions (#57709) (#57794)

(cherry picked from commit 7d020d3f6e5476b47ce258dd4315e24a311f0506)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* TimeseriesPanel: Fill below to override works with name override (#57728) (#57800)

(cherry picked from commit 953fdfe76f3d6e51b8b32f4285e9501dfab944c5)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Security: Upgrade x/text to version unaffected by CVE-2022-32149 (#57797)

* Only provide version ot build-frontend-packages if it's a valid semver (has 2 digits) (#57808) (#57810)

(cherry picked from commit fd16cad7da36420148ae5811cfefa9876ce8f782)

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>

* CI: Add `CreateTempDir` func and use it in publish packages logic (#57171) (#57261)

* Add CreateTempDir func and use it in publish packages logic

* Fill err return in defer func

(cherry picked from commit e829b5014911363be862306b34a41fb0eeb13362)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Chore: Fix vulnerabilities in webpack loader-utils (#57753)

* chore: remove unused webpack loaders from core and toolkit

* chore: refresh yarn.lock file

* getting there...I hope..

* making sure we are not using naughty loader-utils.

* fixed storybook.

* Remove Sensu from docs (#57812) (#57823)

We do not support Sensu in Grafana Alerting, only Sensu Go.

(cherry picked from commit ee7adc081b3b2136d3786c069762057e8f428461)

Co-authored-by: Armand Grillet <2117580+armandgrillet@users.noreply.github.com>

* Prometheus: Do not drop errors in streaming parser (#57698) (#57835)

- Fixes #57692
- and also takes care of #42776 when using the streaming parser, not an ideal fix for #42776 but makes explore work better I think. https://github.com/grafana/grafana/issues/57365 might be a better longer term solution

(cherry picked from commit 6126f56ef0a0428ab3021c5a3368c2911000654f)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Prometheus: Chore - Remove incorrect FrameType from exemplar frame (#57695) (#57828)

(cherry picked from commit 2cd9cbd35925830dee97d9d18840eadc9d0cbbf3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* resolves merge conflicts (#57840)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* Docs: Add information about DB version support to upgrade guide. (#57643) (#57868)

In v9.2 Grafana added an official DB version support policy. That change
is now noted in the upgrade guide.

(cherry picked from commit 89d917b196a12bafbec80d043fa1f36e9c825243)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Access Control: documentation for RBAC provisioning with Terraform (#57747) (#57882)

* add docs for RBAC provisioning with Terraform

* remove unnecessary bit

* shuffle the structure around, as docs can't go more than four levels deep

* Update index.md

* Update index.md

(cherry picked from commit 7e62352aea20a47589b66f20c2c8ef7ca5847b65)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* docs(config): Include admin_email documentation (#55789) (#57725)

(cherry picked from commit 1340c2c358d37c3249246277d4eeb51806faacb1)

Co-authored-by: Pepe Fagoaga <pepe@verica.io>

* RBAC: Allow to list users for dashboard / folder admins (#57080) (#57252)

* RBAC: Use query struct in tests

* RBAC: If access control enforcement is disabled don't filter out users
when fetching permissions

(cherry picked from commit 9adaf1565c2408e3e13668af7d50cdcdd5d77242)

Co-authored-by: Karl Persson <kalle.persson@grafana.com>

* CloudWatch: Fix broken test (#57879) (#57900)

* mock date.now

* fix broken test

(cherry picked from commit 92ed9a4f2f6c3d5b8a0cfeaecda0062f6b77c525)

Co-authored-by: Erik Sundell <erik.sundell87@gmail.com>

* Chore: Update footer changelog link to github (#57871) (#57895)

(cherry picked from commit fd5c14757486ef510741ac344469b1ccfe2a6242)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Google Cloud Monitoring: Ensure selectors fit in the screen (#57817) (#57899)

(cherry picked from commit ce38840f293bfe94a1d6338a9bab255b3d7cc56c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* add an endpoint for updating several managed permissions with one call (#57893) (#57898)

(cherry picked from commit 2546437e2052025daaf8ee2ab9ea4262b7364e61)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* change json command parameter names from userID to userId and teamID to teamId (#57902) (#57913)

(cherry picked from commit 5c1a1c8318bec43dec6aaf130aaafda3f19e54a6)

Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>

* Alerting: Add debug logs in validateAndGetPrefix (#57002) (#57923)

(cherry picked from commit b0a927b1385654a6776cbe8deb36f6dfadc914fd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Attempt to preserve UID from migrated channel (#57639) (#57919)

(cherry picked from commit 0dfd78c88cbb97df6594dda57d73c705bda106e0)

Co-authored-by: Alexander Weaver <weaver.alex.d@gmail.com>

* [v9.2.x] Alerting: fix filtering in notification policies (#57925)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* removes CTAs (#57931) (#57935)

(cherry picked from commit 6aa3003a541552aa9ce6e9b3e95a9dd0b8213e78)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* BarChart: Fix stacked hover (#57711) (#57937)

(cherry picked from commit fbfd0fd51b1d61b186957e0b58c2ea60472f55f3)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* TimeSeries: Render null-bounded points at data edges (#57798) (#57938)

(cherry picked from commit 45234e76eb82a417d8cee236d7a2ad91dc580bbb)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* CloudWatch: Fix `all-log-groups` endpoint when called without logGroupNamePrefix  (#57483) (#57945)

(cherry picked from commit 1f7c84f1256ed46fe5099f27aae57a2121da1080)

Co-authored-by: Lion Ralfs <lion.ralfs@gmail.com>

* Add GCP_KEY to publish-grafanacom step (#57910) (#57948)

(cherry picked from commit 1eaf7cbfc0f4aaed8b84c3e50d9c0c352668b363)

* Changelog: Updated changelog for 9.2.3 (#57955) (#57957)

(cherry picked from commit 02add89b530a569f38e38597be294c6b16ef29d8)

* "Release: Updated versions in package to 9.2.4" (#57958)

* metrics: expose when the binary was built as an gauge (#57951) (#57969)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 3188af9be352feabeb000b204d7375b5626231d5)

* Alerting: Fix flaky test in notifiers (#57927) (#57993)

* Alerting: Fix flaky test in notifiers

* remove TODO comment

(cherry picked from commit a3f828de8aae968f783aeeb648de98e75c421af4)

Co-authored-by: Santiago <santiagohernandez.1997@gmail.com>

* [v9.2.x] Google Cloud Monitoring: Set frame interval to draw null values (#57914)

* Linux Packages: Handle publish to beta (#57528) (#58044)

Uses the feature added here: https://github.com/grafana/deployment_tools/pull/46301
When a version is named "beta", it will be distributed in the beta distribution, rather than in stable

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
(cherry picked from commit c46a4a0b260d3b008bfa771cdc103065a6fe6880)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* chore: bump code coverage action version (#56710) (#58040)

(cherry picked from commit e3e32c7d04a5d20b45411c118f7e3c7e63d90709)

Co-authored-by: Giordano Ricci <me@giordanoricci.com>

* Alerting: Fix response is not returned for invalid Duration in Provisioning API (#58046) (#58049)

(cherry picked from commit 4c581b5f85db705bd4b01d5679407069dd3b2cfb)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* LibrayPanels: Fix unlinking libray panel (#57825) (#58042)

* remove unneeded package updates (#58005) (#58068)

(cherry picked from commit 6a4a10fa926e89eb0498a4d703ccc8c67b5dd46d)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Alerting: Fix feedback (#57922) (#58104)

(cherry picked from commit f2e4cb7c4ea4ee85a177e27fba3d6bf191e043a7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshot is not taken for stale series (#57982) (#58102)

(cherry picked from commit 215ffee4375adb784526827340bbc8c66fd342cc)

* fix: migration of alert_rules fix (#58123)

* increase select placeholder contrast to be WCAG AA compliant (#58034) (#58125)

(cherry picked from commit c3206167a65babd66ca4d590723c4fd754c4aad9)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Tempo: Make usage of time range for TraceID query optional (#58057) (#58128)

* Added switch to toggle the TraceID query time shift

* Fix and improve tests

(cherry picked from commit 90ac300d1023768f9778bb58e77a05948dea5b2e)

Co-authored-by: Andre Pereira <adrapereira@gmail.com>

* [v9.2.x] Explore: Track data links usage (#56868) (#58037)

* Explore: Track data links usage (#56868)

* Add tracking for data links in explore

* Add tracking for data links in explore

* Fix tests

* Retrigger build

(cherry picked from commit dd5e3a08184b3d875c0ee62aab7ca9a054a8c23e)

# Conflicts:
#	public/app/features/explore/Explore.tsx
#	public/app/features/explore/LogsContainer.tsx

* Post-merge fixes

Remove unused import

* reduce the number of requests in folder section (#55876) (#58145)

(cherry picked from commit 372ba83534e0fd91e1c25d7c3c27a3ac1f68f62c)

Co-authored-by: Marcos Vinicius <marcos.vinicius.wz@gmail.com>

* TimeSeries: more thorough detection of negative values for stacking dir (#57863) (#58147)

(cherry picked from commit 4d88e2b542c62bf287a60af01fddfa2e6de220b4)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* fixed explain handlers for label- and lineformat (#58135) (#58151)

(cherry picked from commit 4b1ddba0a8998884982d275e846ec4af6787a06f)

Co-authored-by: Sven Grossmann <sven.grossmann@grafana.com>

* fixes typo (#58159) (#58194)

(cherry picked from commit 1722000309c6e6dc36c9e4f5ef9c2e40cc6e6c65)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Alerting: Encode path separators to side-step proxies (#58222)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Build: add explicit build step for go codeql (#58195) (#58243)

* add explicit build step for go codeql

* support workflow_dispatch for codeql checks

* syntax fix

* enable on push to codeql-go branch

* test

* use go version from go.mod

* explicitly set go version

* tidy up, add workflow_dispatch support to all codeql actions

(cherry picked from commit da9c646f242fd16ba8a789fa5d1c50094d761ae7)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Search: Fixes searching by current folder when opened by clicking dashboard folder name  (#57716) (#57949)

* Search: Read from url on mount no on app boot

* Fixed tests

* Remove unused type

(cherry picked from commit 3991be4c1dd35ff05e1a7dee117710e766b1a3c9)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* "Release: Updated versions in package to 9.2.5" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying "General" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

"Release: Updated versions in package to 9.2.6"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

"Release: Updated versions in package to 9.2.7"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

"Release: Updated versions in package to 9.2.8"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation "stealing" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

"Release: Updated versions in package to 9.2.11"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v…
```

[matejkubinec](/matejkubinec)
added a commit
to percona/grafana
that referenced
this pull request
[Mar 16, 2023](#ref-commit-7d18b3d)
[![@matejkubinec](https://avatars.githubusercontent.com/u/32638572?s=40&u=f15b1e5f63d6faa5145a40e4164e0fa9ea72fff7&v=4)](/matejkubinec) [![@grafanabot](https://avatars.githubusercontent.com/u/43478413?s=40&u=a7be21af02d82dcfe4d68822d6add1dc78b445b1&v=4)](/grafanabot)
[![@nmarrs](https://avatars.githubusercontent.com/u/22381771?s=40&u=ccb32ecdc60cfb1698f45febb3b0bbce6038dc13&v=4)](/nmarrs) [![@ArturWierzbicki](https://avatars.githubusercontent.com/u/23451458?s=40&u=1f9adee1a1f94b4c245b838df05d6662400cea34&v=4)](/ArturWierzbicki) [![@mdvictor](https://avatars.githubusercontent.com/u/36818606?s=40&u=ce9025a7a04ae6e1a483480620fbc96442c74e43&v=4)](/mdvictor) [![@sh0rez](https://avatars.githubusercontent.com/u/26971117?s=40&u=b4bdcc92bc449d589bdc51b4df471dcc976d79c8&v=4)](/sh0rez) [![@gillesdemey](https://avatars.githubusercontent.com/u/868844?s=40&u=d34da4534900c5e729ae25d01ef03d75361486f8&v=4)](/gillesdemey) [![@IevaVasiljeva](https://avatars.githubusercontent.com/u/9482349?s=40&u=6bf34051e6e76a6e014cb56085fd8671f8a32f16&v=4)](/IevaVasiljeva) [![@gtk-grafana](https://avatars.githubusercontent.com/u/109082771?s=40&u=bbd7b28097ca89a03816a1dabae2fcb1189b174e&v=4)](/gtk-grafana) [![@kylebrandt](https://avatars.githubusercontent.com/u/1692624?s=40&u=f03edc41ac5f244ccf8afbaf591a2c2d5bf9422b&v=4)](/kylebrandt) [![@gamab](https://avatars.githubusercontent.com/u/5232696?s=40&u=6c5fef30916541609539c960841a8f9230a2fd6f&v=4)](/gamab) [![@Jguer](https://avatars.githubusercontent.com/u/8071073?s=40&u=31dcf861785552275aea3a89860b081ed114ee1f&v=4)](/Jguer) [![@itsmylife](https://avatars.githubusercontent.com/u/820946?s=40&u=5a928c48831b349c7da1b0022636df01ce0f1ced&v=4)](/itsmylife) [![@yinjialu](https://avatars.githubusercontent.com/u/37073056?s=40&v=4)](/yinjialu) [![@leeoniya](https://avatars.githubusercontent.com/u/43234?s=40&u=49f10c1db35f1a4f328346b597cc763f695bb29d&v=4)](/leeoniya) [![@kminehart](https://avatars.githubusercontent.com/u/5140827?s=40&u=6a9f121b3b6daf545a3b29dda06a0f7f62e2db7d&v=4)](/kminehart) [![@dsotirakis](https://avatars.githubusercontent.com/u/15115078?s=40&u=2637caf13fe96ac43d1680b369e8cfdb8732ddf1&v=4)](/dsotirakis) [![@mckn](https://avatars.githubusercontent.com/u/172951?s=40&v=4)](/mckn) [![@armandgrillet](https://avatars.githubusercontent.com/u/2117580?s=40&u=e7e72ff4eb22b8e90a0c6cf6d9a1300dd9ac0e3f&v=4)](/armandgrillet) [![@chri2547](https://avatars.githubusercontent.com/u/35463610?s=40&u=97f7cf99392dddf4ffdc83bbbce761efd6f40332&v=4)](/chri2547) [![@kaydelaney](https://avatars.githubusercontent.com/u/45561153?s=40&u=136490e13ee468c88746b8dc89a1772cbbf4ae73&v=4)](/kaydelaney) [![@joeblubaugh](https://avatars.githubusercontent.com/u/1951900?s=40&u=1f1faee9254bfaa1e686540a726bbd9ff1cf6e71&v=4)](/joeblubaugh) [![@jfagoagas](https://avatars.githubusercontent.com/u/16007882?s=40&u=95544302b7438701266a93bae2de3cc96e7be42e&v=4)](/jfagoagas) [![@kalleep](https://avatars.githubusercontent.com/u/23356117?s=40&v=4)](/kalleep) [![@sunker](https://avatars.githubusercontent.com/u/2388950?s=40&u=a614311e8b2ef2d114e50d00ca9262b9f73e9b29&v=4)](/sunker) [![@joshhunt](https://avatars.githubusercontent.com/u/46142?s=40&u=5bf6f4243ee4ab8d8a99c3c210af343fdc625798&v=4)](/joshhunt) [![@andresmgot](https://avatars.githubusercontent.com/u/4025665?s=40&u=6d474b97f4f73c53f4609e6921afdabc407c6dbb&v=4)](/andresmgot) [![@grobinson-grafana](https://avatars.githubusercontent.com/u/85952834?s=40&v=4)](/grobinson-grafana) [![@alexweav](https://avatars.githubusercontent.com/u/8410871?s=40&u=b0142389bdf25772feb7ba112977b2ba34dbfe6c&v=4)](/alexweav) [![@lionralfs](https://avatars.githubusercontent.com/u/16670790?s=40&u=8c241532d32e0de477818202f0883af39215299c&v=4)](/lionralfs) [![@santihernandezc](https://avatars.githubusercontent.com/u/41638679?s=40&u=e5de0a9e10494cc06d4781de14abbb1473526b8e&v=4)](/santihernandezc) [![@julienduchesne](https://avatars.githubusercontent.com/u/29210090?s=40&u=d64510d5f3d87110355ed5c2e12d07d216b13c3b&v=4)](/julienduchesne) [![@Elfo404](https://avatars.githubusercontent.com/u/1170767?s=40&u=00040d625496f2c19fd3c9e7b8a43bf8752ba1ab&v=4)](/Elfo404) [![@torkelo](https://avatars.githubusercontent.com/u/10999?s=40&u=00ee9b9643b8eafd5df664bad66f196ff32bd9ed&v=4)](/torkelo) [![@DanCech](https://avatars.githubusercontent.com/u/1443603?s=40&u=563883eed1a53cbd19c35742c3a3ee1b2ddfb0ac&v=4)](/DanCech) [![@eleijonmarck](https://avatars.githubusercontent.com/u/7727602?s=40&u=4f4984c270ed39839e9b8dff600287396939ac2b&v=4)](/eleijonmarck) [![@ashharrison90](https://avatars.githubusercontent.com/u/20999846?s=40&u=e6c1c42a3025abfa1c1d579691b5541df490cf73&v=4)](/ashharrison90) [![@adrapereira](https://avatars.githubusercontent.com/u/4313971?s=40&u=78f1a19e9e0539dc5da5c46eebed12987e83f4fd&v=4)](/adrapereira) [![@ifrost](https://avatars.githubusercontent.com/u/745532?s=40&u=0e3338cd009dbb61fc67c4dfcf2a4469fad47c97&v=4)](/ifrost) [![@mvsousa](https://avatars.githubusercontent.com/u/3681977?s=40&u=a80007616212a617090a537c3fa0855fd754853d&v=4)](/mvsousa) [![@svennergr](https://avatars.githubusercontent.com/u/8092184?s=40&u=733ce9f1c399468005886bdfa2ce242d758348f0&v=4)](/svennergr) [![@ryantxu](https://avatars.githubusercontent.com/u/705951?s=40&u=45875989d2adfe87f95caa12e32e5a82b08898f8&v=4)](/ryantxu) [![@oscarkilhed](https://avatars.githubusercontent.com/u/468940?s=40&u=cdfbb52c148b5da116460f3ea9126cb5b5569e54&v=4)](/oscarkilhed) [![@dessen-xu](https://avatars.githubusercontent.com/u/41524013?s=40&u=01884d79b94696e284a35c8b681bf29434ef1a36&v=4)](/dessen-xu) [![@sakjur](https://avatars.githubusercontent.com/u/298945?s=40&u=f59488eb9b9031b02ae9f24116f8d5ac7d0071f8&v=4)](/sakjur) [![@siiimooon](https://avatars.githubusercontent.com/u/85333972?s=40&u=bc3afa1dea6abfb33d7f3e626099df5bc77955ad&v=4)](/siiimooon) [![@zoltanbedi](https://avatars.githubusercontent.com/u/13729989?s=40&u=6b2d0104259543f280a6b8ea1cccaba2c59e87d5&v=4)](/zoltanbedi) [![@neel1996](https://avatars.githubusercontent.com/u/47709856?s=40&u=d02474c07146b62f73c082ba2d9e312909bbf5cc&v=4)](/neel1996) [![@marefr](https://avatars.githubusercontent.com/u/1668778?s=40&v=4)](/marefr) [![@wjordan](https://avatars.githubusercontent.com/u/56541?s=40&v=4)](/wjordan) [![@sd2k](https://avatars.githubusercontent.com/u/5464991?s=40&u=debba4e86c2176c3afc994fa3eb8ba9ddb7e6d53&v=4)](/sd2k) [![@asimpson](https://avatars.githubusercontent.com/u/1048831?s=40&u=d49ee317b1a2d379515b5e59c03fce5b70009faa&v=4)](/asimpson) [![@xiyu95](https://avatars.githubusercontent.com/u/112968312?s=40&u=ea78ebf8294c6ddaab752aaa136a3f1ac943bfd3&v=4)](/xiyu95) [![@wbrowne](https://avatars.githubusercontent.com/u/1173299?s=40&u=07b5baceef0bdc39ee7f967f39c9c82afb4a81d2&v=4)](/wbrowne) [![@gwdawson](https://avatars.githubusercontent.com/u/34524710?s=40&u=7ea8832f2f2e29b4805d75b3bba2411344593189&v=4)](/gwdawson) [![@xnyo](https://avatars.githubusercontent.com/u/16373015?s=40&u=1dc1b8caf479abe3feaa070c01b1400c3a62b448&v=4)](/xnyo) [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas) [![@joey-grafana](https://avatars.githubusercontent.com/u/90795735?s=40&u=16b1cfc381a83ca938f6d096935f0e747b3691fb&v=4)](/joey-grafana) [![@tolzhabayev](https://avatars.githubusercontent.com/u/580672?s=40&u=cf4a1f5bdba6e8ecfe23dc9fa22069e5431498f8&v=4)](/tolzhabayev) [![@jackw](https://avatars.githubusercontent.com/u/73201?s=40&u=9fb7fc975368a6fae3be8676b46cfc9ad06c7b15&v=4)](/jackw) [![@gguillotte-grafana](https://avatars.githubusercontent.com/u/100453168?s=40&u=3d0bf8114b33430d58934de11387ccd510f3a0e5&v=4)](/gguillotte-grafana) [![@phongvq](https://avatars.githubusercontent.com/u/20754136?s=40&u=30cff65424186e5ff97e24894b5935ae17fd73c2&v=4)](/phongvq) [![@daniellee](https://avatars.githubusercontent.com/u/434655?s=40&u=0625e6874dbde9488a0cd6bc2d3a94c665337551&v=4)](/daniellee) [![@mgyongyosi](https://avatars.githubusercontent.com/u/1585112?s=40&u=bedfa00ab0788c2bfe8411a8218f7bb9a446cc67&v=4)](/mgyongyosi) [![@malcolmholmes](https://avatars.githubusercontent.com/u/42545407?s=40&v=4)](/malcolmholmes) [![@jdbaldry](https://avatars.githubusercontent.com/u/4599384?s=40&v=4)](/jdbaldry) [![@zuchka](https://avatars.githubusercontent.com/u/37156449?s=40&u=7227f6489882e5cf0856219349f19ac1ddbd2a11&v=4)](/zuchka) [![@leandro-deveikis](https://avatars.githubusercontent.com/u/34773040?s=40&u=0c0813698b625812c84deccbe3e4727f5104a28a&v=4)](/leandro-deveikis) [![@bartpeeters](https://avatars.githubusercontent.com/u/29534282?s=40&v=4)](/bartpeeters) [![@yvigara](https://avatars.githubusercontent.com/u/704600?s=40&u=127c2e201ae7c012f5e801e624af426aaf059b1c&v=4)](/yvigara) [![@owensmallwood](https://avatars.githubusercontent.com/u/20195316?s=40&u=0381407162d812492507256b2e90d3ace502b045&v=4)](/owensmallwood) [![@lpskdl](https://avatars.githubusercontent.com/u/108552997?s=40&u=4b1d5afda8817ac8fa0c3f379fbc21f05339f682&v=4)](/lpskdl) [![@aangelisc](https://avatars.githubusercontent.com/u/15019026?s=40&u=3540a1f3f4e09019aaa10a927ca4ca1a8b1caa51&v=4)](/aangelisc) [![@zserge](https://avatars.githubusercontent.com/u/1911760?s=40&u=d54bceb88fc5adc736476c5625bc96eed3725de0&v=4)](/zserge) [![@bergquist](https://avatars.githubusercontent.com/u/618863?s=40&u=3e138dc82d635ddf0c5c82e6463edb81b2205a74&v=4)](/bergquist) [![@iwysiu](https://avatars.githubusercontent.com/u/5421859?s=40&v=4)](/iwysiu) [![@bohandley](https://avatars.githubusercontent.com/u/25674746?s=40&u=5db785e20acac583c2c70f95579eed8acda76034&v=4)](/bohandley) [![@Eve832](https://avatars.githubusercontent.com/u/81647476?s=40&u=171081136377053e2d0a04a2d1f5e21270066d50&v=4)](/Eve832) [![@JacobsonMT](https://avatars.githubusercontent.com/u/8484471?s=40&u=30df9eec2de8834a517222b6f477bbf30598b98c&v=4)](/JacobsonMT) [![@robbymilo](https://avatars.githubusercontent.com/u/8106669?s=40&u=b5929162f75a8e3e5dca80dcfe543e46ff5985aa&v=4)](/robbymilo) [![@academo](https://avatars.githubusercontent.com/u/227916?s=40&u=2d66242d42fb2751b3a9b966ef1d433be978e4dc&v=4)](/academo) [![@adela-almasan](https://avatars.githubusercontent.com/u/88068998?s=40&u=8c681fb7664266c333858b055907df9d31b705ac&v=4)](/adela-almasan) [![@ktw4071](https://avatars.githubusercontent.com/u/10269640?s=40&v=4)](/ktw4071) [![@linoman](https://avatars.githubusercontent.com/u/2051016?s=40&u=85065225ade2a54d017c39fa976bcee1d79de5c9&v=4)](/linoman) [![@leventebalogh](https://avatars.githubusercontent.com/u/9974811?s=40&u=7e1691a3b32d0f3adbe905e8863a6be9cde6461f&v=4)](/leventebalogh) [![@xlson](https://avatars.githubusercontent.com/u/114937?s=40&u=d3cfffe519c44bd3938c5f7297f4b880ada09bbe&v=4)](/xlson) [![@usmangt](https://avatars.githubusercontent.com/u/69509548?s=40&u=2072d0b29b8514dfa1ded27606bd014f7edc020a&v=4)](/usmangt) [![@zerok](https://avatars.githubusercontent.com/u/3782?s=40&v=4)](/zerok) [![@imatwawana](https://avatars.githubusercontent.com/u/76437239?s=40&u=6dd696d8dde9fd57f5a423f3a81cf99a82d9a5cf&v=4)](/imatwawana) [![@aocenas](https://avatars.githubusercontent.com/u/1014802?s=40&u=a934e3470e711b2ed875899d43d9f887ee88b5a7&v=4)](/aocenas) [![@codeincarnate](https://avatars.githubusercontent.com/u/199847?s=40&u=133d1e683542a7ec4b44a74c617962e777eba96e&v=4)](/codeincarnate)

`[PMM-11762](https://jira.percona.com/browse/PMM-11762) [- Grafana 9.2.13 (](/percona/grafana/commit/7d18b3d6f818267819b5138e71fc42ae9a236f82 "PMM-11762 - Grafana 9.2.13 (#629) (#633)

* Canvas: Improve resource picker initialization (#57319) (#57566)

(cherry picked from commit 9d857f4d61803f6156de5c7d89b04cd2593d0632)

* Storage: Fix initialization on windows (#57504) (#57577)

(cherry picked from commit 749b3b62631e89b07a592ec922447b1c9158afa5)

* TablePanel: Fix updating footer values on data change (#57518) (#57581)

* TablePanel: Fix updating footer values on data change

* tests

(cherry picked from commit c30716a073d0147fe85ddb1102429d04f6a4d6df)

* live: explicitely reply with http 200 (#57428) (#57592)

`pkg/web` triggers a panic when a http handler chain does not return any
response to the client.
This has been put in place, because it usually means a middleware along
the way did not call the next one.

In this specific case however, the handlers meant to return 200, but did
not do so explicitely, instead relying on the default behavior of `net/http`

(cherry picked from commit beaaabd770e540c463800e6d320884e3c6e00ae0)

* Changelog: Updated changelog for 9.2.2 (#57601) (#57604)

(cherry picked from commit f64b0e1fae248469ee0fc8fbb2fc8efb90228808)

* \"Release: Updated versions in package to 9.2.3\" (#57605)

* [v9.2.x] Alerting: Always allow configuring AM configuration (#57614)

* move data source permission model to enterprise repo (#57615) (#57659)

(cherry picked from commit 92531c559612dd077f30b186873e23002c5c5ac5)

* Prometheus: Flavor/version configuration (#57554) (#57563)

* Backport PR for: Prometheus: Flavor/version configuration (#57554), and /label match parameter support #56510

* Revert \"Revert \"Prometheus: Type and flavor configuration (#56496)\" (#57552)\"
This reverts commit 2432ce619a7e62026685df14f60116ea4fb3447d.
* Adds new fields and documentation for Prometheus datasource configuration: prometheus type, and version

(cherry picked from commit f93c3acc51180cee78222f2df95ac7b380d1a616)

* Revert \"Revert \"Prometheus: Provide label values match parameter API when supported prometheus instance is configured (#56510)\" (#57551)\" (#57553) (#57564)

This reverts commit e7671bf9092811ecb053466e5b9c9913e2922fe1.
(cherry picked from commit e59ddd6bc5630625e49cafc965764cd8faa23cd6)

* Prometheus query builder: Replace select with AsyncSelect to support high cardinality prometheus instances (#57300) (#57630)

* Replace current select with AsyncSelect component to facilitate autocomplete via prometheus server instead of client application

(cherry picked from commit c27aac0d385bfe695dec5f1b268940b4a19d3c50)

* Docs: (Whats new 9.2) Prom Stream Parser (#57603) (#57693)

* Docs: (Whats new 9.2) Prom Stream Parser

* Update docs/sources/whatsnew/whats-new-in-v9-2.md

(cherry picked from commit dfdc9bcbc1491beb746914fcb8645436819d8aee)

* Fix: Unlock new button based on user permissions (#57733) (#57760)

(cherry picked from commit 4d380978d304029ff17f2c2f0195e1b5b0a0c5b5)

* fix GF_AUTH_JWT_URL_LOGIN not working (#57689) (#57761)

(cherry picked from commit cae900c6f9e41b5559d8ed25afa5cd5d2af56aa0)

* [v9.2.x] Alerting: Fall back to \"range\" query type for unified alerting when \"both\" is specified (#57765)

* Alerting: Fix \"Not Implemented\" responses (#57710) (#57712)

* Prometheus: fix Raw query is not updated when label op change. (#57492) (#57493) (#57780)

(cherry picked from commit 9aac0d32f9dbb77d0701398bf3d577a55dcce224)

* Candlestick: Maintain candle width at different display resolutions (#57709) (#57794)

(cherry picked from commit 7d020d3f6e5476b47ce258dd4315e24a311f0506)

* TimeseriesPanel: Fill below to override works with name override (#57728) (#57800)

(cherry picked from commit 953fdfe76f3d6e51b8b32f4285e9501dfab944c5)

* Security: Upgrade x/text to version unaffected by CVE-2022-32149 (#57797)

* Only provide version ot build-frontend-packages if it's a valid semver (has 2 digits) (#57808) (#57810)

(cherry picked from commit fd16cad7da36420148ae5811cfefa9876ce8f782)

* CI: Add `CreateTempDir` func and use it in publish packages logic (#57171) (#57261)

* Add CreateTempDir func and use it in publish packages logic

* Fill err return in defer func

(cherry picked from commit e829b5014911363be862306b34a41fb0eeb13362)

* [v9.2.x] Chore: Fix vulnerabilities in webpack loader-utils (#57753)

* chore: remove unused webpack loaders from core and toolkit

* chore: refresh yarn.lock file

* getting there...I hope..

* making sure we are not using naughty loader-utils.

* fixed storybook.

* Remove Sensu from docs (#57812) (#57823)

We do not support Sensu in Grafana Alerting, only Sensu Go.

(cherry picked from commit ee7adc081b3b2136d3786c069762057e8f428461)

* Prometheus: Do not drop errors in streaming parser (#57698) (#57835)

- Fixes #57692
- and also takes care of #42776 when using the streaming parser, not an ideal fix for #42776 but makes explore work better I think. https://github.com/grafana/grafana/issues/57365 might be a better longer term solution

(cherry picked from commit 6126f56ef0a0428ab3021c5a3368c2911000654f)

* Prometheus: Chore - Remove incorrect FrameType from exemplar frame (#57695) (#57828)

(cherry picked from commit 2cd9cbd35925830dee97d9d18840eadc9d0cbbf3)

* resolves merge conflicts (#57840)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

* Docs: Add information about DB version support to upgrade guide. (#57643) (#57868)

In v9.2 Grafana added an official DB version support policy. That change
is now noted in the upgrade guide.

(cherry picked from commit 89d917b196a12bafbec80d043fa1f36e9c825243)

* Access Control: documentation for RBAC provisioning with Terraform (#57747) (#57882)

* add docs for RBAC provisioning with Terraform

* remove unnecessary bit

* shuffle the structure around, as docs can't go more than four levels deep

* Update index.md

* Update index.md

(cherry picked from commit 7e62352aea20a47589b66f20c2c8ef7ca5847b65)

* docs(config): Include admin_email documentation (#55789) (#57725)

(cherry picked from commit 1340c2c358d37c3249246277d4eeb51806faacb1)

* RBAC: Allow to list users for dashboard / folder admins (#57080) (#57252)

* RBAC: Use query struct in tests

* RBAC: If access control enforcement is disabled don't filter out users
when fetching permissions

(cherry picked from commit 9adaf1565c2408e3e13668af7d50cdcdd5d77242)

* CloudWatch: Fix broken test (#57879) (#57900)

* mock date.now

* fix broken test

(cherry picked from commit 92ed9a4f2f6c3d5b8a0cfeaecda0062f6b77c525)

* Chore: Update footer changelog link to github (#57871) (#57895)

(cherry picked from commit fd5c14757486ef510741ac344469b1ccfe2a6242)

* Google Cloud Monitoring: Ensure selectors fit in the screen (#57817) (#57899)

(cherry picked from commit ce38840f293bfe94a1d6338a9bab255b3d7cc56c)

* add an endpoint for updating several managed permissions with one call (#57893) (#57898)

(cherry picked from commit 2546437e2052025daaf8ee2ab9ea4262b7364e61)

* change json command parameter names from userID to userId and teamID to teamId (#57902) (#57913)

(cherry picked from commit 5c1a1c8318bec43dec6aaf130aaafda3f19e54a6)

* Alerting: Add debug logs in validateAndGetPrefix (#57002) (#57923)

(cherry picked from commit b0a927b1385654a6776cbe8deb36f6dfadc914fd)

* Attempt to preserve UID from migrated channel (#57639) (#57919)

(cherry picked from commit 0dfd78c88cbb97df6594dda57d73c705bda106e0)

* [v9.2.x] Alerting: fix filtering in notification policies (#57925)

* removes CTAs (#57931) (#57935)

(cherry picked from commit 6aa3003a541552aa9ce6e9b3e95a9dd0b8213e78)

* BarChart: Fix stacked hover (#57711) (#57937)

(cherry picked from commit fbfd0fd51b1d61b186957e0b58c2ea60472f55f3)

* TimeSeries: Render null-bounded points at data edges (#57798) (#57938)

(cherry picked from commit 45234e76eb82a417d8cee236d7a2ad91dc580bbb)

* CloudWatch: Fix `all-log-groups` endpoint when called without logGroupNamePrefix  (#57483) (#57945)

(cherry picked from commit 1f7c84f1256ed46fe5099f27aae57a2121da1080)

* Add GCP_KEY to publish-grafanacom step (#57910) (#57948)

(cherry picked from commit 1eaf7cbfc0f4aaed8b84c3e50d9c0c352668b363)

* Changelog: Updated changelog for 9.2.3 (#57955) (#57957)

(cherry picked from commit 02add89b530a569f38e38597be294c6b16ef29d8)

* \"Release: Updated versions in package to 9.2.4\" (#57958)

* metrics: expose when the binary was built as an gauge (#57951) (#57969)

(cherry picked from commit 3188af9be352feabeb000b204d7375b5626231d5)

* Alerting: Fix flaky test in notifiers (#57927) (#57993)

* Alerting: Fix flaky test in notifiers

* remove TODO comment

(cherry picked from commit a3f828de8aae968f783aeeb648de98e75c421af4)

* [v9.2.x] Google Cloud Monitoring: Set frame interval to draw null values (#57914)

* Linux Packages: Handle publish to beta (#57528) (#58044)

Uses the feature added here: https://github.com/grafana/deployment_tools/pull/46301
When a version is named \"beta\", it will be distributed in the beta distribution, rather than in stable

(cherry picked from commit c46a4a0b260d3b008bfa771cdc103065a6fe6880)

* chore: bump code coverage action version (#56710) (#58040)

(cherry picked from commit e3e32c7d04a5d20b45411c118f7e3c7e63d90709)

* Alerting: Fix response is not returned for invalid Duration in Provisioning API (#58046) (#58049)

(cherry picked from commit 4c581b5f85db705bd4b01d5679407069dd3b2cfb)

* LibrayPanels: Fix unlinking libray panel (#57825) (#58042)

* remove unneeded package updates (#58005) (#58068)

(cherry picked from commit 6a4a10fa926e89eb0498a4d703ccc8c67b5dd46d)

* Alerting: Fix feedback (#57922) (#58104)

(cherry picked from commit f2e4cb7c4ea4ee85a177e27fba3d6bf191e043a7)

* Alerting: Fix screenshot is not taken for stale series (#57982) (#58102)

(cherry picked from commit 215ffee4375adb784526827340bbc8c66fd342cc)

* fix: migration of alert_rules fix (#58123)

* increase select placeholder contrast to be WCAG AA compliant (#58034) (#58125)

(cherry picked from commit c3206167a65babd66ca4d590723c4fd754c4aad9)

* Tempo: Make usage of time range for TraceID query optional (#58057) (#58128)

* Added switch to toggle the TraceID query time shift

* Fix and improve tests

(cherry picked from commit 90ac300d1023768f9778bb58e77a05948dea5b2e)

* [v9.2.x] Explore: Track data links usage (#56868) (#58037)

* Explore: Track data links usage (#56868)

* Add tracking for data links in explore

* Add tracking for data links in explore

* Fix tests

* Retrigger build

(cherry picked from commit dd5e3a08184b3d875c0ee62aab7ca9a054a8c23e)

# Conflicts:
#	public/app/features/explore/Explore.tsx
#	public/app/features/explore/LogsContainer.tsx

* Post-merge fixes

Remove unused import

* reduce the number of requests in folder section (#55876) (#58145)

(cherry picked from commit 372ba83534e0fd91e1c25d7c3c27a3ac1f68f62c)

* TimeSeries: more thorough detection of negative values for stacking dir (#57863) (#58147)

(cherry picked from commit 4d88e2b542c62bf287a60af01fddfa2e6de220b4)

* fixed explain handlers for label- and lineformat (#58135) (#58151)

(cherry picked from commit 4b1ddba0a8998884982d275e846ec4af6787a06f)

* fixes typo (#58159) (#58194)

(cherry picked from commit 1722000309c6e6dc36c9e4f5ef9c2e40cc6e6c65)

* [v9.2.x] Alerting: Encode path separators to side-step proxies (#58222)

* Build: add explicit build step for go codeql (#58195) (#58243)

* add explicit build step for go codeql

* support workflow_dispatch for codeql checks

* syntax fix

* enable on push to codeql-go branch

* test

* use go version from go.mod

* explicitly set go version

* tidy up, add workflow_dispatch support to all codeql actions

(cherry picked from commit da9c646f242fd16ba8a789fa5d1c50094d761ae7)

* Search: Fixes searching by current folder when opened by clicking dashboard folder name  (#57716) (#57949)

* Search: Read from url on mount no on app boot

* Fixed tests

* Remove unused type

(cherry picked from commit 3991be4c1dd35ff05e1a7dee117710e766b1a3c9)

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* \"Release: Updated versions in package to 9.2.5\" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

* adds permissions requirements to two tasks

(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

* Docs: Fix provisioning table formatting (#57042)

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying \"General\" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

* Release: Bump version to 9.2.6 (#58857)

\"Release: Updated versions in package to 9.2.6\"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

* makes prettier

(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

* Release: Bump version to 9.2.7 (#59245)

\"Release: Updated versions in package to 9.2.7\"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

* Release: Bump version to 9.2.8 (#59526)

\"Release: Updated versions in package to 9.2.8\"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

* Fix conflicting modifications :D

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

* Populate SignedInUser remote cache

* Line

* minor fixes to make this work

* Fix tests

* change flag to updated name

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

anticipate next rotation

(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

* ensure 2 ttl window to prevent caching of tokens near rotation

* fix description of toggle

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation \"stealing\" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

\"Release: Updated versions in package to 9.2.11\"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v…

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>
Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>
Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>
Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>
Co-authored-by: sh0rez <me@shorez.de>
Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>
Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>
Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>
Co-authored-by: Kyle Brandt <kyle@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
Co-authored-by: Jo <joao.guerreiro@grafana.com>
Co-authored-by: ismail simsek <ismailsimsek09@gmail.com>
Co-authored-by: yinjialu <37073056+yinjialu@users.noreply.github.com>
Co-authored-by: Leon Sorokin <leeoniya@gmail.com>
Co-authored-by: emerson_gong <yong-jie.gong@microfocus.com>
Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>
Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>
Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>
Co-authored-by: Armand Grillet <2117580+armandgrillet@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>
Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>
Co-authored-by: Pepe Fagoaga <pepe@verica.io>
Co-authored-by: Karl Persson <kalle.persson@grafana.com>
Co-authored-by: Erik Sundell <erik.sundell87@gmail.com>
Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>
Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>
Co-authored-by: George Robinson <george.robinson@grafana.com>
Co-authored-by: Alexander Weaver <weaver.alex.d@gmail.com>
Co-authored-by: Lion Ralfs <lion.ralfs@gmail.com>
Co-authored-by: Santiago <santiagohernandez.1997@gmail.com>
Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>
Co-authored-by: Giordano Ricci <me@giordanoricci.com>
Co-authored-by: Torkel Ödegaard <torkel@grafana.com>
Co-authored-by: Dan Cech <dcech@grafana.com>
Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>
Co-authored-by: Andre Pereira <adrapereira@gmail.com>
Co-authored-by: Piotr Jamróz <pm.jamroz@gmail.com>
Co-authored-by: Marcos Vinicius <marcos.vinicius.wz@gmail.com>
Co-authored-by: Sven Grossmann <sven.grossmann@grafana.com>
Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>
Co-authored-by: dessen-xu <1805680163@qq.com>
Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>
Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>
Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>
Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>
Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>
Co-authored-by: Ben Sully <ben.sully@grafana.com>
Co-authored-by: Adam Simpson <adam@adamsimpson.net>
Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>
Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>
Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>
Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>
Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>
Co-authored-by: Timur Olzhabayev <timur.olzhabayev@grafana.com>
Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>
Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>
Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>
Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>
Co-authored-by: malcolmholmes <42545407+malcolmholmes@users.noreply.github.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>
Co-authored-by: lean.dev <34773040+leandro-deveikis@users.noreply.github.com>
Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>
Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>
Co-authored-by: owensmallwood <owen.smallwood@grafana.com>
Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>
Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>
Co-authored-by: Andreas Christou <andreas.christou@grafana.com>
Co-authored-by: Serge Zaitsev <serge.zaitsev@grafana.com>
Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>
Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: kay delaney <kay@grafana.com>
Co-authored-by: Isabella Siu <Isabella.siu@grafana.com>
Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>
Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>
Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>
Co-authored-by: Robby Milo <robbymilo@fastmail.com>
Co-authored-by: Esteban Beltran <academo@users.noreply.github.com>
Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>
Co-authored-by: Taewoo K <taewoo.kim@grafana.com>
Co-authored-by: linoman <2051016+linoman@users.noreply.github.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>
Co-authored-by: Leonard Gram <leo@xlson.com>
Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>
Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
Co-authored-by: Hamas Shafiq <hamas.shafiq@grafana.com>
Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>
Co-authored-by: Andrej Ocenas <mr.ocenas@gmail.com>
Co-authored-by: Kyle Cunningham <codeincarnate@users.noreply.github.com>")[#629](https://github.com/percona/grafana/pull/629)[) (](/percona/grafana/commit/7d18b3d6f818267819b5138e71fc42ae9a236f82 "PMM-11762 - Grafana 9.2.13 (#629) (#633)

* Canvas: Improve resource picker initialization (#57319) (#57566)

(cherry picked from commit 9d857f4d61803f6156de5c7d89b04cd2593d0632)

* Storage: Fix initialization on windows (#57504) (#57577)

(cherry picked from commit 749b3b62631e89b07a592ec922447b1c9158afa5)

* TablePanel: Fix updating footer values on data change (#57518) (#57581)

* TablePanel: Fix updating footer values on data change

* tests

(cherry picked from commit c30716a073d0147fe85ddb1102429d04f6a4d6df)

* live: explicitely reply with http 200 (#57428) (#57592)

`pkg/web` triggers a panic when a http handler chain does not return any
response to the client.
This has been put in place, because it usually means a middleware along
the way did not call the next one.

In this specific case however, the handlers meant to return 200, but did
not do so explicitely, instead relying on the default behavior of `net/http`

(cherry picked from commit beaaabd770e540c463800e6d320884e3c6e00ae0)

* Changelog: Updated changelog for 9.2.2 (#57601) (#57604)

(cherry picked from commit f64b0e1fae248469ee0fc8fbb2fc8efb90228808)

* \"Release: Updated versions in package to 9.2.3\" (#57605)

* [v9.2.x] Alerting: Always allow configuring AM configuration (#57614)

* move data source permission model to enterprise repo (#57615) (#57659)

(cherry picked from commit 92531c559612dd077f30b186873e23002c5c5ac5)

* Prometheus: Flavor/version configuration (#57554) (#57563)

* Backport PR for: Prometheus: Flavor/version configuration (#57554), and /label match parameter support #56510

* Revert \"Revert \"Prometheus: Type and flavor configuration (#56496)\" (#57552)\"
This reverts commit 2432ce619a7e62026685df14f60116ea4fb3447d.
* Adds new fields and documentation for Prometheus datasource configuration: prometheus type, and version

(cherry picked from commit f93c3acc51180cee78222f2df95ac7b380d1a616)

* Revert \"Revert \"Prometheus: Provide label values match parameter API when supported prometheus instance is configured (#56510)\" (#57551)\" (#57553) (#57564)

This reverts commit e7671bf9092811ecb053466e5b9c9913e2922fe1.
(cherry picked from commit e59ddd6bc5630625e49cafc965764cd8faa23cd6)

* Prometheus query builder: Replace select with AsyncSelect to support high cardinality prometheus instances (#57300) (#57630)

* Replace current select with AsyncSelect component to facilitate autocomplete via prometheus server instead of client application

(cherry picked from commit c27aac0d385bfe695dec5f1b268940b4a19d3c50)

* Docs: (Whats new 9.2) Prom Stream Parser (#57603) (#57693)

* Docs: (Whats new 9.2) Prom Stream Parser

* Update docs/sources/whatsnew/whats-new-in-v9-2.md

(cherry picked from commit dfdc9bcbc1491beb746914fcb8645436819d8aee)

* Fix: Unlock new button based on user permissions (#57733) (#57760)

(cherry picked from commit 4d380978d304029ff17f2c2f0195e1b5b0a0c5b5)

* fix GF_AUTH_JWT_URL_LOGIN not working (#57689) (#57761)

(cherry picked from commit cae900c6f9e41b5559d8ed25afa5cd5d2af56aa0)

* [v9.2.x] Alerting: Fall back to \"range\" query type for unified alerting when \"both\" is specified (#57765)

* Alerting: Fix \"Not Implemented\" responses (#57710) (#57712)

* Prometheus: fix Raw query is not updated when label op change. (#57492) (#57493) (#57780)

(cherry picked from commit 9aac0d32f9dbb77d0701398bf3d577a55dcce224)

* Candlestick: Maintain candle width at different display resolutions (#57709) (#57794)

(cherry picked from commit 7d020d3f6e5476b47ce258dd4315e24a311f0506)

* TimeseriesPanel: Fill below to override works with name override (#57728) (#57800)

(cherry picked from commit 953fdfe76f3d6e51b8b32f4285e9501dfab944c5)

* Security: Upgrade x/text to version unaffected by CVE-2022-32149 (#57797)

* Only provide version ot build-frontend-packages if it's a valid semver (has 2 digits) (#57808) (#57810)

(cherry picked from commit fd16cad7da36420148ae5811cfefa9876ce8f782)

* CI: Add `CreateTempDir` func and use it in publish packages logic (#57171) (#57261)

* Add CreateTempDir func and use it in publish packages logic

* Fill err return in defer func

(cherry picked from commit e829b5014911363be862306b34a41fb0eeb13362)

* [v9.2.x] Chore: Fix vulnerabilities in webpack loader-utils (#57753)

* chore: remove unused webpack loaders from core and toolkit

* chore: refresh yarn.lock file

* getting there...I hope..

* making sure we are not using naughty loader-utils.

* fixed storybook.

* Remove Sensu from docs (#57812) (#57823)

We do not support Sensu in Grafana Alerting, only Sensu Go.

(cherry picked from commit ee7adc081b3b2136d3786c069762057e8f428461)

* Prometheus: Do not drop errors in streaming parser (#57698) (#57835)

- Fixes #57692
- and also takes care of #42776 when using the streaming parser, not an ideal fix for #42776 but makes explore work better I think. https://github.com/grafana/grafana/issues/57365 might be a better longer term solution

(cherry picked from commit 6126f56ef0a0428ab3021c5a3368c2911000654f)

* Prometheus: Chore - Remove incorrect FrameType from exemplar frame (#57695) (#57828)

(cherry picked from commit 2cd9cbd35925830dee97d9d18840eadc9d0cbbf3)

* resolves merge conflicts (#57840)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

* Docs: Add information about DB version support to upgrade guide. (#57643) (#57868)

In v9.2 Grafana added an official DB version support policy. That change
is now noted in the upgrade guide.

(cherry picked from commit 89d917b196a12bafbec80d043fa1f36e9c825243)

* Access Control: documentation for RBAC provisioning with Terraform (#57747) (#57882)

* add docs for RBAC provisioning with Terraform

* remove unnecessary bit

* shuffle the structure around, as docs can't go more than four levels deep

* Update index.md

* Update index.md

(cherry picked from commit 7e62352aea20a47589b66f20c2c8ef7ca5847b65)

* docs(config): Include admin_email documentation (#55789) (#57725)

(cherry picked from commit 1340c2c358d37c3249246277d4eeb51806faacb1)

* RBAC: Allow to list users for dashboard / folder admins (#57080) (#57252)

* RBAC: Use query struct in tests

* RBAC: If access control enforcement is disabled don't filter out users
when fetching permissions

(cherry picked from commit 9adaf1565c2408e3e13668af7d50cdcdd5d77242)

* CloudWatch: Fix broken test (#57879) (#57900)

* mock date.now

* fix broken test

(cherry picked from commit 92ed9a4f2f6c3d5b8a0cfeaecda0062f6b77c525)

* Chore: Update footer changelog link to github (#57871) (#57895)

(cherry picked from commit fd5c14757486ef510741ac344469b1ccfe2a6242)

* Google Cloud Monitoring: Ensure selectors fit in the screen (#57817) (#57899)

(cherry picked from commit ce38840f293bfe94a1d6338a9bab255b3d7cc56c)

* add an endpoint for updating several managed permissions with one call (#57893) (#57898)

(cherry picked from commit 2546437e2052025daaf8ee2ab9ea4262b7364e61)

* change json command parameter names from userID to userId and teamID to teamId (#57902) (#57913)

(cherry picked from commit 5c1a1c8318bec43dec6aaf130aaafda3f19e54a6)

* Alerting: Add debug logs in validateAndGetPrefix (#57002) (#57923)

(cherry picked from commit b0a927b1385654a6776cbe8deb36f6dfadc914fd)

* Attempt to preserve UID from migrated channel (#57639) (#57919)

(cherry picked from commit 0dfd78c88cbb97df6594dda57d73c705bda106e0)

* [v9.2.x] Alerting: fix filtering in notification policies (#57925)

* removes CTAs (#57931) (#57935)

(cherry picked from commit 6aa3003a541552aa9ce6e9b3e95a9dd0b8213e78)

* BarChart: Fix stacked hover (#57711) (#57937)

(cherry picked from commit fbfd0fd51b1d61b186957e0b58c2ea60472f55f3)

* TimeSeries: Render null-bounded points at data edges (#57798) (#57938)

(cherry picked from commit 45234e76eb82a417d8cee236d7a2ad91dc580bbb)

* CloudWatch: Fix `all-log-groups` endpoint when called without logGroupNamePrefix  (#57483) (#57945)

(cherry picked from commit 1f7c84f1256ed46fe5099f27aae57a2121da1080)

* Add GCP_KEY to publish-grafanacom step (#57910) (#57948)

(cherry picked from commit 1eaf7cbfc0f4aaed8b84c3e50d9c0c352668b363)

* Changelog: Updated changelog for 9.2.3 (#57955) (#57957)

(cherry picked from commit 02add89b530a569f38e38597be294c6b16ef29d8)

* \"Release: Updated versions in package to 9.2.4\" (#57958)

* metrics: expose when the binary was built as an gauge (#57951) (#57969)

(cherry picked from commit 3188af9be352feabeb000b204d7375b5626231d5)

* Alerting: Fix flaky test in notifiers (#57927) (#57993)

* Alerting: Fix flaky test in notifiers

* remove TODO comment

(cherry picked from commit a3f828de8aae968f783aeeb648de98e75c421af4)

* [v9.2.x] Google Cloud Monitoring: Set frame interval to draw null values (#57914)

* Linux Packages: Handle publish to beta (#57528) (#58044)

Uses the feature added here: https://github.com/grafana/deployment_tools/pull/46301
When a version is named \"beta\", it will be distributed in the beta distribution, rather than in stable

(cherry picked from commit c46a4a0b260d3b008bfa771cdc103065a6fe6880)

* chore: bump code coverage action version (#56710) (#58040)

(cherry picked from commit e3e32c7d04a5d20b45411c118f7e3c7e63d90709)

* Alerting: Fix response is not returned for invalid Duration in Provisioning API (#58046) (#58049)

(cherry picked from commit 4c581b5f85db705bd4b01d5679407069dd3b2cfb)

* LibrayPanels: Fix unlinking libray panel (#57825) (#58042)

* remove unneeded package updates (#58005) (#58068)

(cherry picked from commit 6a4a10fa926e89eb0498a4d703ccc8c67b5dd46d)

* Alerting: Fix feedback (#57922) (#58104)

(cherry picked from commit f2e4cb7c4ea4ee85a177e27fba3d6bf191e043a7)

* Alerting: Fix screenshot is not taken for stale series (#57982) (#58102)

(cherry picked from commit 215ffee4375adb784526827340bbc8c66fd342cc)

* fix: migration of alert_rules fix (#58123)

* increase select placeholder contrast to be WCAG AA compliant (#58034) (#58125)

(cherry picked from commit c3206167a65babd66ca4d590723c4fd754c4aad9)

* Tempo: Make usage of time range for TraceID query optional (#58057) (#58128)

* Added switch to toggle the TraceID query time shift

* Fix and improve tests

(cherry picked from commit 90ac300d1023768f9778bb58e77a05948dea5b2e)

* [v9.2.x] Explore: Track data links usage (#56868) (#58037)

* Explore: Track data links usage (#56868)

* Add tracking for data links in explore

* Add tracking for data links in explore

* Fix tests

* Retrigger build

(cherry picked from commit dd5e3a08184b3d875c0ee62aab7ca9a054a8c23e)

# Conflicts:
#	public/app/features/explore/Explore.tsx
#	public/app/features/explore/LogsContainer.tsx

* Post-merge fixes

Remove unused import

* reduce the number of requests in folder section (#55876) (#58145)

(cherry picked from commit 372ba83534e0fd91e1c25d7c3c27a3ac1f68f62c)

* TimeSeries: more thorough detection of negative values for stacking dir (#57863) (#58147)

(cherry picked from commit 4d88e2b542c62bf287a60af01fddfa2e6de220b4)

* fixed explain handlers for label- and lineformat (#58135) (#58151)

(cherry picked from commit 4b1ddba0a8998884982d275e846ec4af6787a06f)

* fixes typo (#58159) (#58194)

(cherry picked from commit 1722000309c6e6dc36c9e4f5ef9c2e40cc6e6c65)

* [v9.2.x] Alerting: Encode path separators to side-step proxies (#58222)

* Build: add explicit build step for go codeql (#58195) (#58243)

* add explicit build step for go codeql

* support workflow_dispatch for codeql checks

* syntax fix

* enable on push to codeql-go branch

* test

* use go version from go.mod

* explicitly set go version

* tidy up, add workflow_dispatch support to all codeql actions

(cherry picked from commit da9c646f242fd16ba8a789fa5d1c50094d761ae7)

* Search: Fixes searching by current folder when opened by clicking dashboard folder name  (#57716) (#57949)

* Search: Read from url on mount no on app boot

* Fixed tests

* Remove unused type

(cherry picked from commit 3991be4c1dd35ff05e1a7dee117710e766b1a3c9)

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* \"Release: Updated versions in package to 9.2.5\" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

* adds permissions requirements to two tasks

(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

* Docs: Fix provisioning table formatting (#57042)

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying \"General\" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

* Release: Bump version to 9.2.6 (#58857)

\"Release: Updated versions in package to 9.2.6\"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

* makes prettier

(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

* Release: Bump version to 9.2.7 (#59245)

\"Release: Updated versions in package to 9.2.7\"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

* Release: Bump version to 9.2.8 (#59526)

\"Release: Updated versions in package to 9.2.8\"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

* Fix conflicting modifications :D

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

* Populate SignedInUser remote cache

* Line

* minor fixes to make this work

* Fix tests

* change flag to updated name

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

anticipate next rotation

(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

* ensure 2 ttl window to prevent caching of tokens near rotation

* fix description of toggle

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation \"stealing\" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

\"Release: Updated versions in package to 9.2.11\"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v…

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>
Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>
Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>
Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>
Co-authored-by: sh0rez <me@shorez.de>
Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>
Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>
Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>
Co-authored-by: Kyle Brandt <kyle@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
Co-authored-by: Jo <joao.guerreiro@grafana.com>
Co-authored-by: ismail simsek <ismailsimsek09@gmail.com>
Co-authored-by: yinjialu <37073056+yinjialu@users.noreply.github.com>
Co-authored-by: Leon Sorokin <leeoniya@gmail.com>
Co-authored-by: emerson_gong <yong-jie.gong@microfocus.com>
Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>
Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>
Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>
Co-authored-by: Armand Grillet <2117580+armandgrillet@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>
Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>
Co-authored-by: Pepe Fagoaga <pepe@verica.io>
Co-authored-by: Karl Persson <kalle.persson@grafana.com>
Co-authored-by: Erik Sundell <erik.sundell87@gmail.com>
Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>
Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>
Co-authored-by: George Robinson <george.robinson@grafana.com>
Co-authored-by: Alexander Weaver <weaver.alex.d@gmail.com>
Co-authored-by: Lion Ralfs <lion.ralfs@gmail.com>
Co-authored-by: Santiago <santiagohernandez.1997@gmail.com>
Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>
Co-authored-by: Giordano Ricci <me@giordanoricci.com>
Co-authored-by: Torkel Ödegaard <torkel@grafana.com>
Co-authored-by: Dan Cech <dcech@grafana.com>
Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>
Co-authored-by: Andre Pereira <adrapereira@gmail.com>
Co-authored-by: Piotr Jamróz <pm.jamroz@gmail.com>
Co-authored-by: Marcos Vinicius <marcos.vinicius.wz@gmail.com>
Co-authored-by: Sven Grossmann <sven.grossmann@grafana.com>
Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>
Co-authored-by: dessen-xu <1805680163@qq.com>
Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>
Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>
Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>
Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>
Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>
Co-authored-by: Ben Sully <ben.sully@grafana.com>
Co-authored-by: Adam Simpson <adam@adamsimpson.net>
Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>
Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>
Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>
Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>
Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>
Co-authored-by: Timur Olzhabayev <timur.olzhabayev@grafana.com>
Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>
Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>
Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>
Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>
Co-authored-by: malcolmholmes <42545407+malcolmholmes@users.noreply.github.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>
Co-authored-by: lean.dev <34773040+leandro-deveikis@users.noreply.github.com>
Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>
Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>
Co-authored-by: owensmallwood <owen.smallwood@grafana.com>
Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>
Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>
Co-authored-by: Andreas Christou <andreas.christou@grafana.com>
Co-authored-by: Serge Zaitsev <serge.zaitsev@grafana.com>
Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>
Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: kay delaney <kay@grafana.com>
Co-authored-by: Isabella Siu <Isabella.siu@grafana.com>
Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>
Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>
Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>
Co-authored-by: Robby Milo <robbymilo@fastmail.com>
Co-authored-by: Esteban Beltran <academo@users.noreply.github.com>
Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>
Co-authored-by: Taewoo K <taewoo.kim@grafana.com>
Co-authored-by: linoman <2051016+linoman@users.noreply.github.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>
Co-authored-by: Leonard Gram <leo@xlson.com>
Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>
Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
Co-authored-by: Hamas Shafiq <hamas.shafiq@grafana.com>
Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>
Co-authored-by: Andrej Ocenas <mr.ocenas@gmail.com>
Co-authored-by: Kyle Cunningham <codeincarnate@users.noreply.github.com>")[#633](https://github.com/percona/grafana/pull/633)[)](/percona/grafana/commit/7d18b3d6f818267819b5138e71fc42ae9a236f82 "PMM-11762 - Grafana 9.2.13 (#629) (#633)

* Canvas: Improve resource picker initialization (#57319) (#57566)

(cherry picked from commit 9d857f4d61803f6156de5c7d89b04cd2593d0632)

* Storage: Fix initialization on windows (#57504) (#57577)

(cherry picked from commit 749b3b62631e89b07a592ec922447b1c9158afa5)

* TablePanel: Fix updating footer values on data change (#57518) (#57581)

* TablePanel: Fix updating footer values on data change

* tests

(cherry picked from commit c30716a073d0147fe85ddb1102429d04f6a4d6df)

* live: explicitely reply with http 200 (#57428) (#57592)

`pkg/web` triggers a panic when a http handler chain does not return any
response to the client.
This has been put in place, because it usually means a middleware along
the way did not call the next one.

In this specific case however, the handlers meant to return 200, but did
not do so explicitely, instead relying on the default behavior of `net/http`

(cherry picked from commit beaaabd770e540c463800e6d320884e3c6e00ae0)

* Changelog: Updated changelog for 9.2.2 (#57601) (#57604)

(cherry picked from commit f64b0e1fae248469ee0fc8fbb2fc8efb90228808)

* \"Release: Updated versions in package to 9.2.3\" (#57605)

* [v9.2.x] Alerting: Always allow configuring AM configuration (#57614)

* move data source permission model to enterprise repo (#57615) (#57659)

(cherry picked from commit 92531c559612dd077f30b186873e23002c5c5ac5)

* Prometheus: Flavor/version configuration (#57554) (#57563)

* Backport PR for: Prometheus: Flavor/version configuration (#57554), and /label match parameter support #56510

* Revert \"Revert \"Prometheus: Type and flavor configuration (#56496)\" (#57552)\"
This reverts commit 2432ce619a7e62026685df14f60116ea4fb3447d.
* Adds new fields and documentation for Prometheus datasource configuration: prometheus type, and version

(cherry picked from commit f93c3acc51180cee78222f2df95ac7b380d1a616)

* Revert \"Revert \"Prometheus: Provide label values match parameter API when supported prometheus instance is configured (#56510)\" (#57551)\" (#57553) (#57564)

This reverts commit e7671bf9092811ecb053466e5b9c9913e2922fe1.
(cherry picked from commit e59ddd6bc5630625e49cafc965764cd8faa23cd6)

* Prometheus query builder: Replace select with AsyncSelect to support high cardinality prometheus instances (#57300) (#57630)

* Replace current select with AsyncSelect component to facilitate autocomplete via prometheus server instead of client application

(cherry picked from commit c27aac0d385bfe695dec5f1b268940b4a19d3c50)

* Docs: (Whats new 9.2) Prom Stream Parser (#57603) (#57693)

* Docs: (Whats new 9.2) Prom Stream Parser

* Update docs/sources/whatsnew/whats-new-in-v9-2.md

(cherry picked from commit dfdc9bcbc1491beb746914fcb8645436819d8aee)

* Fix: Unlock new button based on user permissions (#57733) (#57760)

(cherry picked from commit 4d380978d304029ff17f2c2f0195e1b5b0a0c5b5)

* fix GF_AUTH_JWT_URL_LOGIN not working (#57689) (#57761)

(cherry picked from commit cae900c6f9e41b5559d8ed25afa5cd5d2af56aa0)

* [v9.2.x] Alerting: Fall back to \"range\" query type for unified alerting when \"both\" is specified (#57765)

* Alerting: Fix \"Not Implemented\" responses (#57710) (#57712)

* Prometheus: fix Raw query is not updated when label op change. (#57492) (#57493) (#57780)

(cherry picked from commit 9aac0d32f9dbb77d0701398bf3d577a55dcce224)

* Candlestick: Maintain candle width at different display resolutions (#57709) (#57794)

(cherry picked from commit 7d020d3f6e5476b47ce258dd4315e24a311f0506)

* TimeseriesPanel: Fill below to override works with name override (#57728) (#57800)

(cherry picked from commit 953fdfe76f3d6e51b8b32f4285e9501dfab944c5)

* Security: Upgrade x/text to version unaffected by CVE-2022-32149 (#57797)

* Only provide version ot build-frontend-packages if it's a valid semver (has 2 digits) (#57808) (#57810)

(cherry picked from commit fd16cad7da36420148ae5811cfefa9876ce8f782)

* CI: Add `CreateTempDir` func and use it in publish packages logic (#57171) (#57261)

* Add CreateTempDir func and use it in publish packages logic

* Fill err return in defer func

(cherry picked from commit e829b5014911363be862306b34a41fb0eeb13362)

* [v9.2.x] Chore: Fix vulnerabilities in webpack loader-utils (#57753)

* chore: remove unused webpack loaders from core and toolkit

* chore: refresh yarn.lock file

* getting there...I hope..

* making sure we are not using naughty loader-utils.

* fixed storybook.

* Remove Sensu from docs (#57812) (#57823)

We do not support Sensu in Grafana Alerting, only Sensu Go.

(cherry picked from commit ee7adc081b3b2136d3786c069762057e8f428461)

* Prometheus: Do not drop errors in streaming parser (#57698) (#57835)

- Fixes #57692
- and also takes care of #42776 when using the streaming parser, not an ideal fix for #42776 but makes explore work better I think. https://github.com/grafana/grafana/issues/57365 might be a better longer term solution

(cherry picked from commit 6126f56ef0a0428ab3021c5a3368c2911000654f)

* Prometheus: Chore - Remove incorrect FrameType from exemplar frame (#57695) (#57828)

(cherry picked from commit 2cd9cbd35925830dee97d9d18840eadc9d0cbbf3)

* resolves merge conflicts (#57840)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

* Docs: Add information about DB version support to upgrade guide. (#57643) (#57868)

In v9.2 Grafana added an official DB version support policy. That change
is now noted in the upgrade guide.

(cherry picked from commit 89d917b196a12bafbec80d043fa1f36e9c825243)

* Access Control: documentation for RBAC provisioning with Terraform (#57747) (#57882)

* add docs for RBAC provisioning with Terraform

* remove unnecessary bit

* shuffle the structure around, as docs can't go more than four levels deep

* Update index.md

* Update index.md

(cherry picked from commit 7e62352aea20a47589b66f20c2c8ef7ca5847b65)

* docs(config): Include admin_email documentation (#55789) (#57725)

(cherry picked from commit 1340c2c358d37c3249246277d4eeb51806faacb1)

* RBAC: Allow to list users for dashboard / folder admins (#57080) (#57252)

* RBAC: Use query struct in tests

* RBAC: If access control enforcement is disabled don't filter out users
when fetching permissions

(cherry picked from commit 9adaf1565c2408e3e13668af7d50cdcdd5d77242)

* CloudWatch: Fix broken test (#57879) (#57900)

* mock date.now

* fix broken test

(cherry picked from commit 92ed9a4f2f6c3d5b8a0cfeaecda0062f6b77c525)

* Chore: Update footer changelog link to github (#57871) (#57895)

(cherry picked from commit fd5c14757486ef510741ac344469b1ccfe2a6242)

* Google Cloud Monitoring: Ensure selectors fit in the screen (#57817) (#57899)

(cherry picked from commit ce38840f293bfe94a1d6338a9bab255b3d7cc56c)

* add an endpoint for updating several managed permissions with one call (#57893) (#57898)

(cherry picked from commit 2546437e2052025daaf8ee2ab9ea4262b7364e61)

* change json command parameter names from userID to userId and teamID to teamId (#57902) (#57913)

(cherry picked from commit 5c1a1c8318bec43dec6aaf130aaafda3f19e54a6)

* Alerting: Add debug logs in validateAndGetPrefix (#57002) (#57923)

(cherry picked from commit b0a927b1385654a6776cbe8deb36f6dfadc914fd)

* Attempt to preserve UID from migrated channel (#57639) (#57919)

(cherry picked from commit 0dfd78c88cbb97df6594dda57d73c705bda106e0)

* [v9.2.x] Alerting: fix filtering in notification policies (#57925)

* removes CTAs (#57931) (#57935)

(cherry picked from commit 6aa3003a541552aa9ce6e9b3e95a9dd0b8213e78)

* BarChart: Fix stacked hover (#57711) (#57937)

(cherry picked from commit fbfd0fd51b1d61b186957e0b58c2ea60472f55f3)

* TimeSeries: Render null-bounded points at data edges (#57798) (#57938)

(cherry picked from commit 45234e76eb82a417d8cee236d7a2ad91dc580bbb)

* CloudWatch: Fix `all-log-groups` endpoint when called without logGroupNamePrefix  (#57483) (#57945)

(cherry picked from commit 1f7c84f1256ed46fe5099f27aae57a2121da1080)

* Add GCP_KEY to publish-grafanacom step (#57910) (#57948)

(cherry picked from commit 1eaf7cbfc0f4aaed8b84c3e50d9c0c352668b363)

* Changelog: Updated changelog for 9.2.3 (#57955) (#57957)

(cherry picked from commit 02add89b530a569f38e38597be294c6b16ef29d8)

* \"Release: Updated versions in package to 9.2.4\" (#57958)

* metrics: expose when the binary was built as an gauge (#57951) (#57969)

(cherry picked from commit 3188af9be352feabeb000b204d7375b5626231d5)

* Alerting: Fix flaky test in notifiers (#57927) (#57993)

* Alerting: Fix flaky test in notifiers

* remove TODO comment

(cherry picked from commit a3f828de8aae968f783aeeb648de98e75c421af4)

* [v9.2.x] Google Cloud Monitoring: Set frame interval to draw null values (#57914)

* Linux Packages: Handle publish to beta (#57528) (#58044)

Uses the feature added here: https://github.com/grafana/deployment_tools/pull/46301
When a version is named \"beta\", it will be distributed in the beta distribution, rather than in stable

(cherry picked from commit c46a4a0b260d3b008bfa771cdc103065a6fe6880)

* chore: bump code coverage action version (#56710) (#58040)

(cherry picked from commit e3e32c7d04a5d20b45411c118f7e3c7e63d90709)

* Alerting: Fix response is not returned for invalid Duration in Provisioning API (#58046) (#58049)

(cherry picked from commit 4c581b5f85db705bd4b01d5679407069dd3b2cfb)

* LibrayPanels: Fix unlinking libray panel (#57825) (#58042)

* remove unneeded package updates (#58005) (#58068)

(cherry picked from commit 6a4a10fa926e89eb0498a4d703ccc8c67b5dd46d)

* Alerting: Fix feedback (#57922) (#58104)

(cherry picked from commit f2e4cb7c4ea4ee85a177e27fba3d6bf191e043a7)

* Alerting: Fix screenshot is not taken for stale series (#57982) (#58102)

(cherry picked from commit 215ffee4375adb784526827340bbc8c66fd342cc)

* fix: migration of alert_rules fix (#58123)

* increase select placeholder contrast to be WCAG AA compliant (#58034) (#58125)

(cherry picked from commit c3206167a65babd66ca4d590723c4fd754c4aad9)

* Tempo: Make usage of time range for TraceID query optional (#58057) (#58128)

* Added switch to toggle the TraceID query time shift

* Fix and improve tests

(cherry picked from commit 90ac300d1023768f9778bb58e77a05948dea5b2e)

* [v9.2.x] Explore: Track data links usage (#56868) (#58037)

* Explore: Track data links usage (#56868)

* Add tracking for data links in explore

* Add tracking for data links in explore

* Fix tests

* Retrigger build

(cherry picked from commit dd5e3a08184b3d875c0ee62aab7ca9a054a8c23e)

# Conflicts:
#	public/app/features/explore/Explore.tsx
#	public/app/features/explore/LogsContainer.tsx

* Post-merge fixes

Remove unused import

* reduce the number of requests in folder section (#55876) (#58145)

(cherry picked from commit 372ba83534e0fd91e1c25d7c3c27a3ac1f68f62c)

* TimeSeries: more thorough detection of negative values for stacking dir (#57863) (#58147)

(cherry picked from commit 4d88e2b542c62bf287a60af01fddfa2e6de220b4)

* fixed explain handlers for label- and lineformat (#58135) (#58151)

(cherry picked from commit 4b1ddba0a8998884982d275e846ec4af6787a06f)

* fixes typo (#58159) (#58194)

(cherry picked from commit 1722000309c6e6dc36c9e4f5ef9c2e40cc6e6c65)

* [v9.2.x] Alerting: Encode path separators to side-step proxies (#58222)

* Build: add explicit build step for go codeql (#58195) (#58243)

* add explicit build step for go codeql

* support workflow_dispatch for codeql checks

* syntax fix

* enable on push to codeql-go branch

* test

* use go version from go.mod

* explicitly set go version

* tidy up, add workflow_dispatch support to all codeql actions

(cherry picked from commit da9c646f242fd16ba8a789fa5d1c50094d761ae7)

* Search: Fixes searching by current folder when opened by clicking dashboard folder name  (#57716) (#57949)

* Search: Read from url on mount no on app boot

* Fixed tests

* Remove unused type

(cherry picked from commit 3991be4c1dd35ff05e1a7dee117710e766b1a3c9)

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* \"Release: Updated versions in package to 9.2.5\" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

* adds permissions requirements to two tasks

(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

* Docs: Fix provisioning table formatting (#57042)

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying \"General\" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

* Release: Bump version to 9.2.6 (#58857)

\"Release: Updated versions in package to 9.2.6\"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

* makes prettier

(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

* Release: Bump version to 9.2.7 (#59245)

\"Release: Updated versions in package to 9.2.7\"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

* Release: Bump version to 9.2.8 (#59526)

\"Release: Updated versions in package to 9.2.8\"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

* Fix conflicting modifications :D

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

* Populate SignedInUser remote cache

* Line

* minor fixes to make this work

* Fix tests

* change flag to updated name

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

anticipate next rotation

(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

* ensure 2 ttl window to prevent caching of tokens near rotation

* fix description of toggle

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation \"stealing\" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

\"Release: Updated versions in package to 9.2.11\"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v…

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>
Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>
Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>
Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>
Co-authored-by: sh0rez <me@shorez.de>
Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>
Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>
Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>
Co-authored-by: Kyle Brandt <kyle@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
Co-authored-by: Jo <joao.guerreiro@grafana.com>
Co-authored-by: ismail simsek <ismailsimsek09@gmail.com>
Co-authored-by: yinjialu <37073056+yinjialu@users.noreply.github.com>
Co-authored-by: Leon Sorokin <leeoniya@gmail.com>
Co-authored-by: emerson_gong <yong-jie.gong@microfocus.com>
Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>
Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>
Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>
Co-authored-by: Armand Grillet <2117580+armandgrillet@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>
Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>
Co-authored-by: Pepe Fagoaga <pepe@verica.io>
Co-authored-by: Karl Persson <kalle.persson@grafana.com>
Co-authored-by: Erik Sundell <erik.sundell87@gmail.com>
Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>
Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>
Co-authored-by: George Robinson <george.robinson@grafana.com>
Co-authored-by: Alexander Weaver <weaver.alex.d@gmail.com>
Co-authored-by: Lion Ralfs <lion.ralfs@gmail.com>
Co-authored-by: Santiago <santiagohernandez.1997@gmail.com>
Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>
Co-authored-by: Giordano Ricci <me@giordanoricci.com>
Co-authored-by: Torkel Ödegaard <torkel@grafana.com>
Co-authored-by: Dan Cech <dcech@grafana.com>
Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>
Co-authored-by: Andre Pereira <adrapereira@gmail.com>
Co-authored-by: Piotr Jamróz <pm.jamroz@gmail.com>
Co-authored-by: Marcos Vinicius <marcos.vinicius.wz@gmail.com>
Co-authored-by: Sven Grossmann <sven.grossmann@grafana.com>
Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>
Co-authored-by: dessen-xu <1805680163@qq.com>
Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>
Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>
Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>
Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>
Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>
Co-authored-by: Ben Sully <ben.sully@grafana.com>
Co-authored-by: Adam Simpson <adam@adamsimpson.net>
Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>
Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>
Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>
Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>
Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>
Co-authored-by: Timur Olzhabayev <timur.olzhabayev@grafana.com>
Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>
Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>
Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>
Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>
Co-authored-by: malcolmholmes <42545407+malcolmholmes@users.noreply.github.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>
Co-authored-by: lean.dev <34773040+leandro-deveikis@users.noreply.github.com>
Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>
Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>
Co-authored-by: owensmallwood <owen.smallwood@grafana.com>
Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>
Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>
Co-authored-by: Andreas Christou <andreas.christou@grafana.com>
Co-authored-by: Serge Zaitsev <serge.zaitsev@grafana.com>
Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>
Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: kay delaney <kay@grafana.com>
Co-authored-by: Isabella Siu <Isabella.siu@grafana.com>
Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>
Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>
Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>
Co-authored-by: Robby Milo <robbymilo@fastmail.com>
Co-authored-by: Esteban Beltran <academo@users.noreply.github.com>
Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>
Co-authored-by: Taewoo K <taewoo.kim@grafana.com>
Co-authored-by: linoman <2051016+linoman@users.noreply.github.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>
Co-authored-by: Leonard Gram <leo@xlson.com>
Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>
Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
Co-authored-by: Hamas Shafiq <hamas.shafiq@grafana.com>
Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>
Co-authored-by: Andrej Ocenas <mr.ocenas@gmail.com>
Co-authored-by: Kyle Cunningham <codeincarnate@users.noreply.github.com>")`
…

`[7d18b3d](/percona/grafana/commit/7d18b3d6f818267819b5138e71fc42ae9a236f82)`

```
* Canvas: Improve resource picker initialization (#57319) (#57566)

(cherry picked from commit 9d857f4d61803f6156de5c7d89b04cd2593d0632)

* Storage: Fix initialization on windows (#57504) (#57577)

(cherry picked from commit 749b3b62631e89b07a592ec922447b1c9158afa5)

* TablePanel: Fix updating footer values on data change (#57518) (#57581)

* TablePanel: Fix updating footer values on data change

* tests

(cherry picked from commit c30716a073d0147fe85ddb1102429d04f6a4d6df)

* live: explicitely reply with http 200 (#57428) (#57592)

`pkg/web` triggers a panic when a http handler chain does not return any
response to the client.
This has been put in place, because it usually means a middleware along
the way did not call the next one.

In this specific case however, the handlers meant to return 200, but did
not do so explicitely, instead relying on the default behavior of `net/http`

(cherry picked from commit beaaabd770e540c463800e6d320884e3c6e00ae0)

* Changelog: Updated changelog for 9.2.2 (#57601) (#57604)

(cherry picked from commit f64b0e1fae248469ee0fc8fbb2fc8efb90228808)

* "Release: Updated versions in package to 9.2.3" (#57605)

* [v9.2.x] Alerting: Always allow configuring AM configuration (#57614)

* move data source permission model to enterprise repo (#57615) (#57659)

(cherry picked from commit 92531c559612dd077f30b186873e23002c5c5ac5)

* Prometheus: Flavor/version configuration (#57554) (#57563)

* Backport PR for: Prometheus: Flavor/version configuration (#57554), and /label match parameter support #56510

* Revert "Revert "Prometheus: Type and flavor configuration (#56496)" (#57552)"
This reverts commit 2432ce619a7e62026685df14f60116ea4fb3447d.
* Adds new fields and documentation for Prometheus datasource configuration: prometheus type, and version

(cherry picked from commit f93c3acc51180cee78222f2df95ac7b380d1a616)

* Revert "Revert "Prometheus: Provide label values match parameter API when supported prometheus instance is configured (#56510)" (#57551)" (#57553) (#57564)

This reverts commit e7671bf9092811ecb053466e5b9c9913e2922fe1.
(cherry picked from commit e59ddd6bc5630625e49cafc965764cd8faa23cd6)

* Prometheus query builder: Replace select with AsyncSelect to support high cardinality prometheus instances (#57300) (#57630)

* Replace current select with AsyncSelect component to facilitate autocomplete via prometheus server instead of client application

(cherry picked from commit c27aac0d385bfe695dec5f1b268940b4a19d3c50)

* Docs: (Whats new 9.2) Prom Stream Parser (#57603) (#57693)

* Docs: (Whats new 9.2) Prom Stream Parser

* Update docs/sources/whatsnew/whats-new-in-v9-2.md

(cherry picked from commit dfdc9bcbc1491beb746914fcb8645436819d8aee)

* Fix: Unlock new button based on user permissions (#57733) (#57760)

(cherry picked from commit 4d380978d304029ff17f2c2f0195e1b5b0a0c5b5)

* fix GF_AUTH_JWT_URL_LOGIN not working (#57689) (#57761)

(cherry picked from commit cae900c6f9e41b5559d8ed25afa5cd5d2af56aa0)

* [v9.2.x] Alerting: Fall back to "range" query type for unified alerting when "both" is specified (#57765)

* Alerting: Fix "Not Implemented" responses (#57710) (#57712)

* Prometheus: fix Raw query is not updated when label op change. (#57492) (#57493) (#57780)

(cherry picked from commit 9aac0d32f9dbb77d0701398bf3d577a55dcce224)

* Candlestick: Maintain candle width at different display resolutions (#57709) (#57794)

(cherry picked from commit 7d020d3f6e5476b47ce258dd4315e24a311f0506)

* TimeseriesPanel: Fill below to override works with name override (#57728) (#57800)

(cherry picked from commit 953fdfe76f3d6e51b8b32f4285e9501dfab944c5)

* Security: Upgrade x/text to version unaffected by CVE-2022-32149 (#57797)

* Only provide version ot build-frontend-packages if it's a valid semver (has 2 digits) (#57808) (#57810)

(cherry picked from commit fd16cad7da36420148ae5811cfefa9876ce8f782)

* CI: Add `CreateTempDir` func and use it in publish packages logic (#57171) (#57261)

* Add CreateTempDir func and use it in publish packages logic

* Fill err return in defer func

(cherry picked from commit e829b5014911363be862306b34a41fb0eeb13362)

* [v9.2.x] Chore: Fix vulnerabilities in webpack loader-utils (#57753)

* chore: remove unused webpack loaders from core and toolkit

* chore: refresh yarn.lock file

* getting there...I hope..

* making sure we are not using naughty loader-utils.

* fixed storybook.

* Remove Sensu from docs (#57812) (#57823)

We do not support Sensu in Grafana Alerting, only Sensu Go.

(cherry picked from commit ee7adc081b3b2136d3786c069762057e8f428461)

* Prometheus: Do not drop errors in streaming parser (#57698) (#57835)

- Fixes #57692
- and also takes care of #42776 when using the streaming parser, not an ideal fix for #42776 but makes explore work better I think. https://github.com/grafana/grafana/issues/57365 might be a better longer term solution

(cherry picked from commit 6126f56ef0a0428ab3021c5a3368c2911000654f)

* Prometheus: Chore - Remove incorrect FrameType from exemplar frame (#57695) (#57828)

(cherry picked from commit 2cd9cbd35925830dee97d9d18840eadc9d0cbbf3)

* resolves merge conflicts (#57840)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

* Dashboards: Add workaround for react-grid-layout rearrange bug (#57832) (#57836)

(cherry picked from commit e4d1d8d70cd553c262e1095bb3d77f4271b111d6)

* Docs: Add information about DB version support to upgrade guide. (#57643) (#57868)

In v9.2 Grafana added an official DB version support policy. That change
is now noted in the upgrade guide.

(cherry picked from commit 89d917b196a12bafbec80d043fa1f36e9c825243)

* Access Control: documentation for RBAC provisioning with Terraform (#57747) (#57882)

* add docs for RBAC provisioning with Terraform

* remove unnecessary bit

* shuffle the structure around, as docs can't go more than four levels deep

* Update index.md

* Update index.md

(cherry picked from commit 7e62352aea20a47589b66f20c2c8ef7ca5847b65)

* docs(config): Include admin_email documentation (#55789) (#57725)

(cherry picked from commit 1340c2c358d37c3249246277d4eeb51806faacb1)

* RBAC: Allow to list users for dashboard / folder admins (#57080) (#57252)

* RBAC: Use query struct in tests

* RBAC: If access control enforcement is disabled don't filter out users
when fetching permissions

(cherry picked from commit 9adaf1565c2408e3e13668af7d50cdcdd5d77242)

* CloudWatch: Fix broken test (#57879) (#57900)

* mock date.now

* fix broken test

(cherry picked from commit 92ed9a4f2f6c3d5b8a0cfeaecda0062f6b77c525)

* Chore: Update footer changelog link to github (#57871) (#57895)

(cherry picked from commit fd5c14757486ef510741ac344469b1ccfe2a6242)

* Google Cloud Monitoring: Ensure selectors fit in the screen (#57817) (#57899)

(cherry picked from commit ce38840f293bfe94a1d6338a9bab255b3d7cc56c)

* add an endpoint for updating several managed permissions with one call (#57893) (#57898)

(cherry picked from commit 2546437e2052025daaf8ee2ab9ea4262b7364e61)

* change json command parameter names from userID to userId and teamID to teamId (#57902) (#57913)

(cherry picked from commit 5c1a1c8318bec43dec6aaf130aaafda3f19e54a6)

* Alerting: Add debug logs in validateAndGetPrefix (#57002) (#57923)

(cherry picked from commit b0a927b1385654a6776cbe8deb36f6dfadc914fd)

* Attempt to preserve UID from migrated channel (#57639) (#57919)

(cherry picked from commit 0dfd78c88cbb97df6594dda57d73c705bda106e0)

* [v9.2.x] Alerting: fix filtering in notification policies (#57925)

* removes CTAs (#57931) (#57935)

(cherry picked from commit 6aa3003a541552aa9ce6e9b3e95a9dd0b8213e78)

* BarChart: Fix stacked hover (#57711) (#57937)

(cherry picked from commit fbfd0fd51b1d61b186957e0b58c2ea60472f55f3)

* TimeSeries: Render null-bounded points at data edges (#57798) (#57938)

(cherry picked from commit 45234e76eb82a417d8cee236d7a2ad91dc580bbb)

* CloudWatch: Fix `all-log-groups` endpoint when called without logGroupNamePrefix  (#57483) (#57945)

(cherry picked from commit 1f7c84f1256ed46fe5099f27aae57a2121da1080)

* Add GCP_KEY to publish-grafanacom step (#57910) (#57948)

(cherry picked from commit 1eaf7cbfc0f4aaed8b84c3e50d9c0c352668b363)

* Changelog: Updated changelog for 9.2.3 (#57955) (#57957)

(cherry picked from commit 02add89b530a569f38e38597be294c6b16ef29d8)

* "Release: Updated versions in package to 9.2.4" (#57958)

* metrics: expose when the binary was built as an gauge (#57951) (#57969)

(cherry picked from commit 3188af9be352feabeb000b204d7375b5626231d5)

* Alerting: Fix flaky test in notifiers (#57927) (#57993)

* Alerting: Fix flaky test in notifiers

* remove TODO comment

(cherry picked from commit a3f828de8aae968f783aeeb648de98e75c421af4)

* [v9.2.x] Google Cloud Monitoring: Set frame interval to draw null values (#57914)

* Linux Packages: Handle publish to beta (#57528) (#58044)

Uses the feature added here: https://github.com/grafana/deployment_tools/pull/46301
When a version is named "beta", it will be distributed in the beta distribution, rather than in stable

(cherry picked from commit c46a4a0b260d3b008bfa771cdc103065a6fe6880)

* chore: bump code coverage action version (#56710) (#58040)

(cherry picked from commit e3e32c7d04a5d20b45411c118f7e3c7e63d90709)

* Alerting: Fix response is not returned for invalid Duration in Provisioning API (#58046) (#58049)

(cherry picked from commit 4c581b5f85db705bd4b01d5679407069dd3b2cfb)

* LibrayPanels: Fix unlinking libray panel (#57825) (#58042)

* remove unneeded package updates (#58005) (#58068)

(cherry picked from commit 6a4a10fa926e89eb0498a4d703ccc8c67b5dd46d)

* Alerting: Fix feedback (#57922) (#58104)

(cherry picked from commit f2e4cb7c4ea4ee85a177e27fba3d6bf191e043a7)

* Alerting: Fix screenshot is not taken for stale series (#57982) (#58102)

(cherry picked from commit 215ffee4375adb784526827340bbc8c66fd342cc)

* fix: migration of alert_rules fix (#58123)

* increase select placeholder contrast to be WCAG AA compliant (#58034) (#58125)

(cherry picked from commit c3206167a65babd66ca4d590723c4fd754c4aad9)

* Tempo: Make usage of time range for TraceID query optional (#58057) (#58128)

* Added switch to toggle the TraceID query time shift

* Fix and improve tests

(cherry picked from commit 90ac300d1023768f9778bb58e77a05948dea5b2e)

* [v9.2.x] Explore: Track data links usage (#56868) (#58037)

* Explore: Track data links usage (#56868)

* Add tracking for data links in explore

* Add tracking for data links in explore

* Fix tests

* Retrigger build

(cherry picked from commit dd5e3a08184b3d875c0ee62aab7ca9a054a8c23e)

# Conflicts:
#	public/app/features/explore/Explore.tsx
#	public/app/features/explore/LogsContainer.tsx

* Post-merge fixes

Remove unused import

* reduce the number of requests in folder section (#55876) (#58145)

(cherry picked from commit 372ba83534e0fd91e1c25d7c3c27a3ac1f68f62c)

* TimeSeries: more thorough detection of negative values for stacking dir (#57863) (#58147)

(cherry picked from commit 4d88e2b542c62bf287a60af01fddfa2e6de220b4)

* fixed explain handlers for label- and lineformat (#58135) (#58151)

(cherry picked from commit 4b1ddba0a8998884982d275e846ec4af6787a06f)

* fixes typo (#58159) (#58194)

(cherry picked from commit 1722000309c6e6dc36c9e4f5ef9c2e40cc6e6c65)

* [v9.2.x] Alerting: Encode path separators to side-step proxies (#58222)

* Build: add explicit build step for go codeql (#58195) (#58243)

* add explicit build step for go codeql

* support workflow_dispatch for codeql checks

* syntax fix

* enable on push to codeql-go branch

* test

* use go version from go.mod

* explicitly set go version

* tidy up, add workflow_dispatch support to all codeql actions

(cherry picked from commit da9c646f242fd16ba8a789fa5d1c50094d761ae7)

* Search: Fixes searching by current folder when opened by clicking dashboard folder name  (#57716) (#57949)

* Search: Read from url on mount no on app boot

* Fixed tests

* Remove unused type

(cherry picked from commit 3991be4c1dd35ff05e1a7dee117710e766b1a3c9)

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* "Release: Updated versions in package to 9.2.5" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

* adds permissions requirements to two tasks

(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

* Docs: Fix provisioning table formatting (#57042)

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying "General" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

* Release: Bump version to 9.2.6 (#58857)

"Release: Updated versions in package to 9.2.6"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

* makes prettier

(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

* Release: Bump version to 9.2.7 (#59245)

"Release: Updated versions in package to 9.2.7"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

* Release: Bump version to 9.2.8 (#59526)

"Release: Updated versions in package to 9.2.8"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

* Fix conflicting modifications :D

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

* Populate SignedInUser remote cache

* Line

* minor fixes to make this work

* Fix tests

* change flag to updated name

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

anticipate next rotation

(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

* ensure 2 ttl window to prevent caching of tokens near rotation

* fix description of toggle

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation "stealing" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

"Release: Updated versions in package to 9.2.11"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v…

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>
Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>
Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>
Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>
Co-authored-by: sh0rez <me@shorez.de>
Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>
Co-authored-by: Ieva <ieva.vasiljeva@grafana.com>
Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>
Co-authored-by: Kyle Brandt <kyle@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
Co-authored-by: Jo <joao.guerreiro@grafana.com>
Co-authored-by: ismail simsek <ismailsimsek09@gmail.com>
Co-authored-by: yinjialu <37073056+yinjialu@users.noreply.github.com>
Co-authored-by: Leon Sorokin <leeoniya@gmail.com>
Co-authored-by: emerson_gong <yong-jie.gong@microfocus.com>
Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>
Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>
Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>
Co-authored-by: Armand Grillet <2117580+armandgrillet@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>
Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>
Co-authored-by: Pepe Fagoaga <pepe@verica.io>
Co-authored-by: Karl Persson <kalle.persson@grafana.com>
Co-authored-by: Erik Sundell <erik.sundell87@gmail.com>
Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>
Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>
Co-authored-by: George Robinson <george.robinson@grafana.com>
Co-authored-by: Alexander Weaver <weaver.alex.d@gmail.com>
Co-authored-by: Lion Ralfs <lion.ralfs@gmail.com>
Co-authored-by: Santiago <santiagohernandez.1997@gmail.com>
Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>
Co-authored-by: Giordano Ricci <me@giordanoricci.com>
Co-authored-by: Torkel Ödegaard <torkel@grafana.com>
Co-authored-by: Dan Cech <dcech@grafana.com>
Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>
Co-authored-by: Andre Pereira <adrapereira@gmail.com>
Co-authored-by: Piotr Jamróz <pm.jamroz@gmail.com>
Co-authored-by: Marcos Vinicius <marcos.vinicius.wz@gmail.com>
Co-authored-by: Sven Grossmann <sven.grossmann@grafana.com>
Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>
Co-authored-by: dessen-xu <1805680163@qq.com>
Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>
Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>
Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>
Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>
Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>
Co-authored-by: Ben Sully <ben.sully@grafana.com>
Co-authored-by: Adam Simpson <adam@adamsimpson.net>
Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>
Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>
Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>
Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>
Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>
Co-authored-by: Timur Olzhabayev <timur.olzhabayev@grafana.com>
Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>
Co-authored-by: Garrett Guillotte <100453168+gguillotte-grafana@users.noreply.github.com>
Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>
Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>
Co-authored-by: malcolmholmes <42545407+malcolmholmes@users.noreply.github.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>
Co-authored-by: lean.dev <34773040+leandro-deveikis@users.noreply.github.com>
Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>
Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>
Co-authored-by: owensmallwood <owen.smallwood@grafana.com>
Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>
Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>
Co-authored-by: Andreas Christou <andreas.christou@grafana.com>
Co-authored-by: Serge Zaitsev <serge.zaitsev@grafana.com>
Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>
Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: kay delaney <kay@grafana.com>
Co-authored-by: Isabella Siu <Isabella.siu@grafana.com>
Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>
Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>
Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>
Co-authored-by: Robby Milo <robbymilo@fastmail.com>
Co-authored-by: Esteban Beltran <academo@users.noreply.github.com>
Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>
Co-authored-by: Taewoo K <taewoo.kim@grafana.com>
Co-authored-by: linoman <2051016+linoman@users.noreply.github.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>
Co-authored-by: Leonard Gram <leo@xlson.com>
Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>
Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
Co-authored-by: Hamas Shafiq <hamas.shafiq@grafana.com>
Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>
Co-authored-by: Andrej Ocenas <mr.ocenas@gmail.com>
Co-authored-by: Kyle Cunningham <codeincarnate@users.noreply.github.com>
```

[matejkubinec](/matejkubinec)
added a commit
to percona/grafana
that referenced
this pull request
[May 25, 2023](#ref-commit-f84a7c3)
[![@matejkubinec](https://avatars.githubusercontent.com/u/32638572?s=40&u=f15b1e5f63d6faa5145a40e4164e0fa9ea72fff7&v=4)](/matejkubinec) [![@grafanabot](https://avatars.githubusercontent.com/u/43478413?s=40&u=a7be21af02d82dcfe4d68822d6add1dc78b445b1&v=4)](/grafanabot)
[![@mvsousa](https://avatars.githubusercontent.com/u/3681977?s=40&u=a80007616212a617090a537c3fa0855fd754853d&v=4)](/mvsousa) [![@leeoniya](https://avatars.githubusercontent.com/u/43234?s=40&u=49f10c1db35f1a4f328346b597cc763f695bb29d&v=4)](/leeoniya) [![@svennergr](https://avatars.githubusercontent.com/u/8092184?s=40&u=733ce9f1c399468005886bdfa2ce242d758348f0&v=4)](/svennergr) [![@chri2547](https://avatars.githubusercontent.com/u/35463610?s=40&u=97f7cf99392dddf4ffdc83bbbce761efd6f40332&v=4)](/chri2547) [![@gillesdemey](https://avatars.githubusercontent.com/u/868844?s=40&u=d34da4534900c5e729ae25d01ef03d75361486f8&v=4)](/gillesdemey) [![@DanCech](https://avatars.githubusercontent.com/u/1443603?s=40&u=563883eed1a53cbd19c35742c3a3ee1b2ddfb0ac&v=4)](/DanCech) [![@torkelo](https://avatars.githubusercontent.com/u/10999?s=40&u=00ee9b9643b8eafd5df664bad66f196ff32bd9ed&v=4)](/torkelo) [![@eleijonmarck](https://avatars.githubusercontent.com/u/7727602?s=40&u=4f4984c270ed39839e9b8dff600287396939ac2b&v=4)](/eleijonmarck) [![@ryantxu](https://avatars.githubusercontent.com/u/705951?s=40&u=45875989d2adfe87f95caa12e32e5a82b08898f8&v=4)](/ryantxu) [![@mdvictor](https://avatars.githubusercontent.com/u/36818606?s=40&u=ce9025a7a04ae6e1a483480620fbc96442c74e43&v=4)](/mdvictor) [![@oscarkilhed](https://avatars.githubusercontent.com/u/468940?s=40&u=cdfbb52c148b5da116460f3ea9126cb5b5569e54&v=4)](/oscarkilhed) [![@joshhunt](https://avatars.githubusercontent.com/u/46142?s=40&u=5bf6f4243ee4ab8d8a99c3c210af343fdc625798&v=4)](/joshhunt) [![@andresmgot](https://avatars.githubusercontent.com/u/4025665?s=40&u=6d474b97f4f73c53f4609e6921afdabc407c6dbb&v=4)](/andresmgot) [![@dessen-xu](https://avatars.githubusercontent.com/u/41524013?s=40&u=01884d79b94696e284a35c8b681bf29434ef1a36&v=4)](/dessen-xu) [![@gtk-grafana](https://avatars.githubusercontent.com/u/109082771?s=40&u=bbd7b28097ca89a03816a1dabae2fcb1189b174e&v=4)](/gtk-grafana) [![@sakjur](https://avatars.githubusercontent.com/u/298945?s=40&u=f59488eb9b9031b02ae9f24116f8d5ac7d0071f8&v=4)](/sakjur) [![@siiimooon](https://avatars.githubusercontent.com/u/85333972?s=40&u=bc3afa1dea6abfb33d7f3e626099df5bc77955ad&v=4)](/siiimooon) [![@zoltanbedi](https://avatars.githubusercontent.com/u/13729989?s=40&u=6b2d0104259543f280a6b8ea1cccaba2c59e87d5&v=4)](/zoltanbedi) [![@grobinson-grafana](https://avatars.githubusercontent.com/u/85952834?s=40&v=4)](/grobinson-grafana) [![@neel1996](https://avatars.githubusercontent.com/u/47709856?s=40&u=d02474c07146b62f73c082ba2d9e312909bbf5cc&v=4)](/neel1996) [![@dsotirakis](https://avatars.githubusercontent.com/u/15115078?s=40&u=2637caf13fe96ac43d1680b369e8cfdb8732ddf1&v=4)](/dsotirakis) [![@marefr](https://avatars.githubusercontent.com/u/1668778?s=40&v=4)](/marefr) [![@wjordan](https://avatars.githubusercontent.com/u/56541?s=40&v=4)](/wjordan) [![@sd2k](https://avatars.githubusercontent.com/u/5464991?s=40&u=debba4e86c2176c3afc994fa3eb8ba9ddb7e6d53&v=4)](/sd2k) [![@julienduchesne](https://avatars.githubusercontent.com/u/29210090?s=40&u=d64510d5f3d87110355ed5c2e12d07d216b13c3b&v=4)](/julienduchesne) [![@asimpson](https://avatars.githubusercontent.com/u/1048831?s=40&u=d49ee317b1a2d379515b5e59c03fce5b70009faa&v=4)](/asimpson) [![@joeblubaugh](https://avatars.githubusercontent.com/u/1951900?s=40&u=1f1faee9254bfaa1e686540a726bbd9ff1cf6e71&v=4)](/joeblubaugh) [![@xiyu95](https://avatars.githubusercontent.com/u/112968312?s=40&u=ea78ebf8294c6ddaab752aaa136a3f1ac943bfd3&v=4)](/xiyu95) [![@wbrowne](https://avatars.githubusercontent.com/u/1173299?s=40&u=07b5baceef0bdc39ee7f967f39c9c82afb4a81d2&v=4)](/wbrowne) [![@gwdawson](https://avatars.githubusercontent.com/u/34524710?s=40&u=7ea8832f2f2e29b4805d75b3bba2411344593189&v=4)](/gwdawson) [![@ashharrison90](https://avatars.githubusercontent.com/u/20999846?s=40&u=e6c1c42a3025abfa1c1d579691b5541df490cf73&v=4)](/ashharrison90) [![@xnyo](https://avatars.githubusercontent.com/u/16373015?s=40&u=1dc1b8caf479abe3feaa070c01b1400c3a62b448&v=4)](/xnyo) [![@nmarrs](https://avatars.githubusercontent.com/u/22381771?s=40&u=ccb32ecdc60cfb1698f45febb3b0bbce6038dc13&v=4)](/nmarrs) [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas) [![@joey-grafana](https://avatars.githubusercontent.com/u/90795735?s=40&u=16b1cfc381a83ca938f6d096935f0e747b3691fb&v=4)](/joey-grafana) [![@tolzhabayev](https://avatars.githubusercontent.com/u/580672?s=40&u=cf4a1f5bdba6e8ecfe23dc9fa22069e5431498f8&v=4)](/tolzhabayev) [![@itsmylife](https://avatars.githubusercontent.com/u/820946?s=40&u=5a928c48831b349c7da1b0022636df01ce0f1ced&v=4)](/itsmylife) [![@kalleep](https://avatars.githubusercontent.com/u/23356117?s=40&v=4)](/kalleep) [![@jackw](https://avatars.githubusercontent.com/u/73201?s=40&u=9fb7fc975368a6fae3be8676b46cfc9ad06c7b15&v=4)](/jackw) [![@gguillotte-grafana](https://avatars.githubusercontent.com/u/100453168?s=40&u=3d0bf8114b33430d58934de11387ccd510f3a0e5&v=4)](/gguillotte-grafana) [![@phongvq](https://avatars.githubusercontent.com/u/20754136?s=40&u=30cff65424186e5ff97e24894b5935ae17fd73c2&v=4)](/phongvq) [![@daniellee](https://avatars.githubusercontent.com/u/434655?s=40&u=0625e6874dbde9488a0cd6bc2d3a94c665337551&v=4)](/daniellee) [![@Jguer](https://avatars.githubusercontent.com/u/8071073?s=40&u=31dcf861785552275aea3a89860b081ed114ee1f&v=4)](/Jguer) [![@mgyongyosi](https://avatars.githubusercontent.com/u/1585112?s=40&u=bedfa00ab0788c2bfe8411a8218f7bb9a446cc67&v=4)](/mgyongyosi) [![@malcolmholmes](https://avatars.githubusercontent.com/u/42545407?s=40&v=4)](/malcolmholmes) [![@kaydelaney](https://avatars.githubusercontent.com/u/45561153?s=40&u=136490e13ee468c88746b8dc89a1772cbbf4ae73&v=4)](/kaydelaney) [![@jdbaldry](https://avatars.githubusercontent.com/u/4599384?s=40&v=4)](/jdbaldry) [![@kylebrandt](https://avatars.githubusercontent.com/u/1692624?s=40&u=f03edc41ac5f244ccf8afbaf591a2c2d5bf9422b&v=4)](/kylebrandt) [![@zuchka](https://avatars.githubusercontent.com/u/37156449?s=40&u=7227f6489882e5cf0856219349f19ac1ddbd2a11&v=4)](/zuchka) [![@leandro-deveikis](https://avatars.githubusercontent.com/u/34773040?s=40&u=0c0813698b625812c84deccbe3e4727f5104a28a&v=4)](/leandro-deveikis) [![@bartpeeters](https://avatars.githubusercontent.com/u/29534282?s=40&v=4)](/bartpeeters) [![@yvigara](https://avatars.githubusercontent.com/u/704600?s=40&u=127c2e201ae7c012f5e801e624af426aaf059b1c&v=4)](/yvigara) [![@owensmallwood](https://avatars.githubusercontent.com/u/20195316?s=40&u=0381407162d812492507256b2e90d3ace502b045&v=4)](/owensmallwood) [![@IevaVasiljeva](https://avatars.githubusercontent.com/u/9482349?s=40&u=6bf34051e6e76a6e014cb56085fd8671f8a32f16&v=4)](/IevaVasiljeva) [![@lpskdl](https://avatars.githubusercontent.com/u/108552997?s=40&u=4b1d5afda8817ac8fa0c3f379fbc21f05339f682&v=4)](/lpskdl) [![@gamab](https://avatars.githubusercontent.com/u/5232696?s=40&u=6c5fef30916541609539c960841a8f9230a2fd6f&v=4)](/gamab) [![@aangelisc](https://avatars.githubusercontent.com/u/15019026?s=40&u=3540a1f3f4e09019aaa10a927ca4ca1a8b1caa51&v=4)](/aangelisc) [![@zserge](https://avatars.githubusercontent.com/u/1911760?s=40&u=d54bceb88fc5adc736476c5625bc96eed3725de0&v=4)](/zserge) [![@bergquist](https://avatars.githubusercontent.com/u/618863?s=40&u=3e138dc82d635ddf0c5c82e6463edb81b2205a74&v=4)](/bergquist) [![@iwysiu](https://avatars.githubusercontent.com/u/5421859?s=40&v=4)](/iwysiu) [![@bohandley](https://avatars.githubusercontent.com/u/25674746?s=40&u=5db785e20acac583c2c70f95579eed8acda76034&v=4)](/bohandley) [![@Eve832](https://avatars.githubusercontent.com/u/81647476?s=40&u=171081136377053e2d0a04a2d1f5e21270066d50&v=4)](/Eve832) [![@JacobsonMT](https://avatars.githubusercontent.com/u/8484471?s=40&u=30df9eec2de8834a517222b6f477bbf30598b98c&v=4)](/JacobsonMT) [![@robbymilo](https://avatars.githubusercontent.com/u/8106669?s=40&u=b5929162f75a8e3e5dca80dcfe543e46ff5985aa&v=4)](/robbymilo) [![@academo](https://avatars.githubusercontent.com/u/227916?s=40&u=2d66242d42fb2751b3a9b966ef1d433be978e4dc&v=4)](/academo) [![@adela-almasan](https://avatars.githubusercontent.com/u/88068998?s=40&u=8c681fb7664266c333858b055907df9d31b705ac&v=4)](/adela-almasan) [![@ktw4071](https://avatars.githubusercontent.com/u/10269640?s=40&v=4)](/ktw4071) [![@linoman](https://avatars.githubusercontent.com/u/2051016?s=40&u=85065225ade2a54d017c39fa976bcee1d79de5c9&v=4)](/linoman) [![@mckn](https://avatars.githubusercontent.com/u/172951?s=40&v=4)](/mckn) [![@leventebalogh](https://avatars.githubusercontent.com/u/9974811?s=40&u=7e1691a3b32d0f3adbe905e8863a6be9cde6461f&v=4)](/leventebalogh) [![@ArturWierzbicki](https://avatars.githubusercontent.com/u/23451458?s=40&u=1f9adee1a1f94b4c245b838df05d6662400cea34&v=4)](/ArturWierzbicki) [![@xlson](https://avatars.githubusercontent.com/u/114937?s=40&u=d3cfffe519c44bd3938c5f7297f4b880ada09bbe&v=4)](/xlson) [![@kminehart](https://avatars.githubusercontent.com/u/5140827?s=40&u=6a9f121b3b6daf545a3b29dda06a0f7f62e2db7d&v=4)](/kminehart) [![@usmangt](https://avatars.githubusercontent.com/u/69509548?s=40&u=2072d0b29b8514dfa1ded27606bd014f7edc020a&v=4)](/usmangt) [![@zerok](https://avatars.githubusercontent.com/u/3782?s=40&v=4)](/zerok) [![@imatwawana](https://avatars.githubusercontent.com/u/76437239?s=40&u=6dd696d8dde9fd57f5a423f3a81cf99a82d9a5cf&v=4)](/imatwawana) [![@codeincarnate](https://avatars.githubusercontent.com/u/199847?s=40&u=133d1e683542a7ec4b44a74c617962e777eba96e&v=4)](/codeincarnate) [![@aocenas](https://avatars.githubusercontent.com/u/1014802?s=40&u=a934e3470e711b2ed875899d43d9f887ee88b5a7&v=4)](/aocenas) [![@hanjm](https://avatars.githubusercontent.com/u/7621241?s=40&u=e4f8c804e65d58a3013730cce3912492500318b4&v=4)](/hanjm) [![@LudoVio](https://avatars.githubusercontent.com/u/9373203?s=40&u=783fc1a2dc9f527f5193be010d60ae8e1895396f&v=4)](/LudoVio) [![@moxious](https://avatars.githubusercontent.com/u/5471710?s=40&u=939b7c0acdedee2e16ac23d7ab12bec6bf817514&v=4)](/moxious) [![@sarah-spang](https://avatars.githubusercontent.com/u/86264026?s=40&v=4)](/sarah-spang) [![@mallettjared](https://avatars.githubusercontent.com/u/110853992?s=40&v=4)](/mallettjared) [![@JohnnyQQQQ](https://avatars.githubusercontent.com/u/3528218?s=40&u=bfac25193e2be1abeb959f5ee988ca975366fdb6&v=4)](/JohnnyQQQQ) [![@christineywang](https://avatars.githubusercontent.com/u/19804181?s=40&u=5e7deb2350518c47c0289117d0c6b2bdfb12673f&v=4)](/christineywang) [![@annelaurefroment](https://avatars.githubusercontent.com/u/49911675?s=40&v=4)](/annelaurefroment) [![@guicaulada](https://avatars.githubusercontent.com/u/7741292?s=40&u=296253fb9be05eafd88b65e2615a6c7fd8aa063e&v=4)](/guicaulada) [![@yuri-tceretian](https://avatars.githubusercontent.com/u/25988953?s=40&u=0329c4a260742982e188e4deab712da310866bbe&v=4)](/yuri-tceretian) [![@brendamuir](https://avatars.githubusercontent.com/u/100768211?s=40&v=4)](/brendamuir) [![@oneoneonepig](https://avatars.githubusercontent.com/u/13197632?s=40&u=351ccac28593c4fb7ba64afd64f660626fdf8cbe&v=4)](/oneoneonepig) [![@papagian](https://avatars.githubusercontent.com/u/1632407?s=40&u=07f720ffa380d8ec4a349e83db63cf921b1f2ad9&v=4)](/papagian)

`[PMM-12114](https://jira.percona.com/browse/PMM-12114) [Grafana 9.2.18 (](/percona/grafana/commit/f84a7c35000e11a2f4684852fd657f814381558c "PMM-12114 Grafana 9.2.18 (#668)

* reduce the number of requests in folder section (#55876) (#58145)

(cherry picked from commit 372ba83534e0fd91e1c25d7c3c27a3ac1f68f62c)

Co-authored-by: Marcos Vinicius <marcos.vinicius.wz@gmail.com>

* TimeSeries: more thorough detection of negative values for stacking dir (#57863) (#58147)

(cherry picked from commit 4d88e2b542c62bf287a60af01fddfa2e6de220b4)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* fixed explain handlers for label- and lineformat (#58135) (#58151)

(cherry picked from commit 4b1ddba0a8998884982d275e846ec4af6787a06f)

Co-authored-by: Sven Grossmann <sven.grossmann@grafana.com>

* fixes typo (#58159) (#58194)

(cherry picked from commit 1722000309c6e6dc36c9e4f5ef9c2e40cc6e6c65)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Alerting: Encode path separators to side-step proxies (#58222)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Build: add explicit build step for go codeql (#58195) (#58243)

* add explicit build step for go codeql

* support workflow_dispatch for codeql checks

* syntax fix

* enable on push to codeql-go branch

* test

* use go version from go.mod

* explicitly set go version

* tidy up, add workflow_dispatch support to all codeql actions

(cherry picked from commit da9c646f242fd16ba8a789fa5d1c50094d761ae7)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Search: Fixes searching by current folder when opened by clicking dashboard folder name  (#57716) (#57949)

* Search: Read from url on mount no on app boot

* Fixed tests

* Remove unused type

(cherry picked from commit 3991be4c1dd35ff05e1a7dee117710e766b1a3c9)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* \"Release: Updated versions in package to 9.2.5\" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying \"General\" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

\"Release: Updated versions in package to 9.2.6\"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

\"Release: Updated versions in package to 9.2.7\"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

\"Release: Updated versions in package to 9.2.8\"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation \"stealing\" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

\"Release: Updated versions in package to 9.2.11\"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v9.2.x] QueryEditorRow: Fixes issue loading query editor when data source variable selected (#62179)

QueryEditorRow: Fixes issue loading query editor when data source variable selected (#61927)

* QueryEditorRow: Fixes issue loading query editor when data source variable selected

* Fix func name

* Removed wait

* restore waiting for with better check

* restore waiting for with better check

(cherry picked from commit 9f7ddf1f0b5234a1fd82e1f92d1444f81a794e45)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* [v9.2.x] update gpg secret names (#62250)

update gpg secret names

* [v9.2.x] Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62205)

Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62193)

* fix: capture both ErrInvalidAPIKey

* rename of variable

(cherry picked from commit c5cb5be3cc078cc99b0324ae0db429646e0603ad)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Login: Fix panic when UpsertUser is called without ReqContext (#62574)

* Login: Fix panic when UpsertUser is called without ReqContext (#62539)

(cherry picked from commit b1151dd118f2a1c305a6f757661e42e59cf145c1)
(cherry picked from commit 679cc18648295053a6ab9b764b85cd68f773f81b)

* [v9.2.x] Tempo: Fix span name being dropped from the query (#62591)

Tempo: Fix span name being dropped from the query (#62257)
(cherry picked from commit c3b476e1dcb310e1d3b425f058264ed5be00d1d8)
Co-authored-by: Hamas Shafiq <hamas.shafiq@grafana.com>

* [v9.2.x] Expressions: Fixes the issue showing expressions editor (#62626)

* Expressions: Fixes the issue showing expressions editor (#62510)

* Use suggested value for uid

* update the snapshot

* use __expr__

* replace all -100 with __expr__

* update snapshot

* more changes

* revert redundant change

* Use expr.DatasourceUID where it's possible

* generate files

(cherry picked from commit 91221bc4362e50b9cca6dbff3a8342b2991900d2)

* unit text fix

* [v9.2.x] docs: deleted link to moved content (#62703)

deleted link to moved content

* [v9.2.x] docs: fix broken elasticsearch metrics play link (#62717)

docs: fix broken elasticsearch metrics play link (#62715)

fix broken elastic search play link

(cherry picked from commit 1225e8d6d8a2076f2141065c0ad20b55241d6f25)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix/60084/save and test (#62748)

Fix: Save and test error message does not persist across datasource instance settings anymore

(cherry picked from commit ce50168b70b4444abb5a1aa36d695dc1b7c339b9)

Co-authored-by: Timur Olzhabayev <timur.olzhabayev@grafana.com>

* [v9.2.x] Server: Switch from separate server & cli to a unified grafana binary (#58286) (#62754)

* Server: Switch from separate server & cli to a unified grafana binary (#58286)

* avoid the need for a second bulky binary for grafana-cli

* look for grafana-server in $PATH as well as same directory

* implement unified \"grafana\" command

* update dockerfiles, fix grafana-cli -v

* update packaging to work with single binary

- add wrapper scripts for grafana and grafana-server
- update and sync package files
- implement --sign flag of build package command
- stop packaging scripts folder, they are not useful for end users
- add support for --configOverrides in server command
- remove unused nfpm.yaml config file

* windows support

(cherry picked from commit de99ce139c96e7229bb5e194aed225e3321d8685)

* Build: don't remove grafana-server and grafana-cli binaries from deb and rpm packages (#59890)

* don't remove grafana-server and grafana-cli binaries from /usr/share/grafana/bin in deb and rpm packages

* don't add config overrides in /usr/sbin/grafana-server

(cherry picked from commit 01cba80cbd762a180a18592a82d6e5992c4fb941)

---------

Co-authored-by: Dan Cech <dcech@grafana.com>

* [v9.2.x] MSSQL: Add support for macro function calls (#62887)

MSSQL: Add support for macro function calls (#62742)

* MSSQL: Add support for macro function calls

* Add tests

(cherry picked from commit 9fc3b360a43e9f0295f7366e9ea635a43521b341)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Remove packages path from branch filter (#60946)

Remove packages path from branch filter (#60128)

That directory is no longer used in published docs and causes this
workflow to fail when changes only affect the packages directory.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 1516aa27622ee5dc8d14cc3ebcd07647bf1619bd)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Update publishing workflows to use organization secret (#63043)

Update publishing workflows to use organization secret (#63001)

The new tokens are managed centrally and have a longer expiry.
Administrators of the grafanabot account will be
notified of the pending expiry and the secret can be rotated centrally
without the need for a repository administrator to update their
secrets.

The existing repository secrets can safely be removed. The tokens for
those secrets will be removed by the end of this week.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit ba9bdf3455b24f3d86b425ccd24994b915327c3b)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Server: Fix issue backporting #58286 to v9.2.x in #62754 (#63067)

Fix issue backporting #58286 to v9.2.x in #62754

* [v9.2.x] Remove `gen-jsonnet` make target from `bra.toml` (#63102)

Remove gen-jsonnet from toml

* [v9.2.x] fix broken envelope encryption link (#63141)

fix broken envelope encryption link (#63135)

(cherry picked from commit 72ca7fe7fe30a95e75e558bf83efc4e791e5018e)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix MSSQL queries failing because of bad interpolation (#63170)

Fix MSSQL queries failing because of bad interpolation (#63167)

fix failing mssql queries

(cherry picked from commit 62b078e4e4cad882e9e9a01f36cc8df4aa084eab)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* CI: Backport CI/Release related code to v9.2.x (#63251)

* Cherry pick from 03b1cf7

* Remove publishpackages/go

* Backport enterprise checks

* CI: Allow other modules to register build sub-commands (#62741)

* Allow other modules to register build sub-commands

* CI: Fix retries on artifacts-page clone

* Fix linting errors

* Fix golint issues

* Update to grabpl 3.0.21

(cherry picked from commit 312ea59e6da16c28226042b7cdebf4e660880ed7)

* CI: Remove variants arg from `package` step (#62858)

* Remove variants arg from package step

* Fix starlark lint

* Default to releaseModeConfig.Variants

* Check for empty variants arg

(cherry picked from commit e5c48ac9454a8513d526384751b953ff98d12ecb)

* Remove verify-jsonnet-step

* Revert github.com/grafana/thema bump

* go mod tidy

* Remove publish.star

* Fix lib.star lint

* CI: Running Redis integration tests without grabpl (#63028)

This restores some changes from
https://github.com/grafana/grafana/pull/61920 that were accidentally
deleted.

(cherry picked from commit 2804acd264ff247673f71854d25d79656b7b0775)

* go mod tidy

* Fix clone enterprise for custom events

* Chore: Bump alpine version to `3.17.1` (#63252)

Bump alpine version to 3.17.1

(cherry picked from commit 24c60486f62fd723b3d61718d45e7b9382f74656)

---------

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>
Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2.x] MSSQL Datasource: Revert functions within macros change (#63596)

MSSQL Datasource: Revert functions within macros change (#63592)

* Revert functions within macros change
* Add tests for function and macro for mssql
* Remove macro support tests

---------

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>
(cherry picked from commit 356e2e1933f5e717a0e8f7688ba1b44f7bf9fa01)

Co-authored-by: Kyle Cunningham <codeincarnate@users.noreply.github.com>

* [v9.2.x] docs: fixed headings and link to explore with logs (#63673)

[9.3.x] docs: fixed headings and link to explore with logs (#63670)

fixed headings and link to explore with logs

(cherry picked from commit abfd8792e536ec8096f83f5abb4612fb7312f90b)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Update grafana/saml library (#689)

SAML: update grafana/saml

Co-authored-by: Jo <joao.guerreiro@grafana.com>

Co-authored-by: linoman <2051016+linoman@users.noreply.github.com>
Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#704)

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

(cherry picked from commit dbbe819368f507b9493b7a3cf6e080a5dd752b3e)

* remove added file

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Auth: Update saml go.mod (missing query sig verification) [9.2.x] (#713)

update saml go.mod (missing query sig verification)

(cherry picked from commit 1e1dbd1a06455a451d722856dc619b2a7c78e2c0)

* Release: Bump version to 9.2.11 (#728)

\"Release: Updated versions in package to 9.2.11\"

* [v9.2.x] Geomap: Sanitize the attribution string (#753)

Geomap: Sanitize the attribution string (#745)

* SAML: Update grafana/saml library (#691)

Co-authored-by: jguer <joao.guerreiro@grafana.com>

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

* add sanitize

* Fix frontend build

* Remove unnecessary yarn.lock changes

* Fix formatting

* Re-add yarn.lock message as I guess it is needed

---------

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
Co-authored-by: jguer <joao.guerreiro@grafana.com>
Co-authored-by: nmarrs <nathanielmarrs@gmail.com>
Co-authored-by: Drew Slobodnjak <60050885+drew08t@users.noreply.github.com>
(cherry picked from commit 37b4af7ffacfc24d5f24d190356a9ef32d99aa6f)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] TraceView: Add key and url escaping of json tag values (#760)

* [v9.2.x] Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64115)

Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64108)

* Change docker image used for cross-compilation

* Replace fmt.Println with log.Println

* Add specific tag for docker image

(cherry picked from commit b42fd92fad7c4e826cb6ae9ed360952bbc9a87a9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] build: fix corss build (#63263)

build: fix corss build (#61121)

* build: fix corss build

* fix lint

(cherry picked from commit 37baae3699fcad37dac87a759491ae5db02369df)

Co-authored-by: Jimmie Han <hanjinming@outlook.com>

* [9.2.x] CI: Move some build settings (#64491) (#64517)

Backporting https://github.com/grafana/grafana/pull/64491.

* Move some build settings to Vault

* CI: Remove reference to DOWNSTREAM_REPO as it isn't used

(cherry picked from commit 4b241804b401eed529e41fa775186d8ffe89ea1c)

* [v9.2.x] CI: Add `PrereleaseBucket` field in `versions.go` (#64522)

CI: Add `PrereleaseBucket` field in `versions.go` (#64519)

Add PrereleaseBucket in versions.go

(cherry picked from commit 29b3f3fbf4cd64a59422ac14c58d8fb81f7b17f9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [9.2.x] CI: Do not clone in artifacts-page pipeline (#64663)

This is done in a later step.

* [v9.2.x] Alerting: Fix queries not being previewed in detail view (#64977)

* Alerting: Fix queries not being previewed in detail view (#64198)

(cherry picked from commit 4e81aab60a587b102305a255891986e592a0d1a4)

* Update imports

---------

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>
Co-authored-by: ismail simsek <ismailsimsek09@gmail.com>

* [v9.2.x] Alerting: Fix expression issues in alert rule view and edit pages (#65008)

* Fix rule viewer

* Fix expressions editor and viewer in alerting

* [v9.2.x] Update CODEOWNERship for grafana-delivery team (#64973) (#65020)

Update CODEOWNERship for grafana-delivery team (#64973)

(cherry picked from commit 2897ee37bf9f575eef19bcd35182232f965c6499)

* [v9.2.x] CI: Update `grabpl` to `3.0.30` (#65028) (#65087)

CI: Update `grabpl` to `3.0.30` (#65028)

Update grabpl

(cherry picked from commit 4a80233bedf6e750f0ce43fa9fe1f6eb7ab9f6fa)

* [v9.2.x] NPM: Stop using the folder path before the name path (#65156)

NPM: Stop using the folder path before the name path (#63851)

Stop using the folder path before the name path

(cherry picked from commit 177aa254c563dfe98ffabd2de56330bee960f160)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Fix xss in Graphite functions tooltip (#810)

Fix xss in Graphite functions tooltip (#804)

(cherry picked from commit 87aad3f11836f810ee1fdfee27827e746ef36055)

Co-authored-by: Ludovic Viaud <ludovic.viaud@gmail.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.15 (#65196) (#65200)

Changelog: Updated changelog for 9.2.15 (#65196)

* Changelog: Updated changelog for 9.2.15

* Update CHANGELOG.md

---------

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit a907e042f9cdba3d4c00e89f820bfd9030025af9)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.16 (#65202)

\"Release: Updated versions in package to 9.2.16\"

* [v9.2.x] CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173) (#65193)

CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173)

* Remove fetch-images dependency

* Fix starlark link

(cherry picked from commit d0be9610f0e22a4571a13c2ebf2aaabe281ecf48)

* [v9.2.x] Expressions: More robust expression check (#65231)

* Expressions: More robust expression check (#65006)

More robust expression check

(cherry picked from commit 1328878aceb37da7051c5685375e2ca32ef0a6b4)

* Fix import

* [v9.2.x] CI:…")[#668](https://github.com/percona/grafana/pull/668)[)](/percona/grafana/commit/f84a7c35000e11a2f4684852fd657f814381558c "PMM-12114 Grafana 9.2.18 (#668)

* reduce the number of requests in folder section (#55876) (#58145)

(cherry picked from commit 372ba83534e0fd91e1c25d7c3c27a3ac1f68f62c)

Co-authored-by: Marcos Vinicius <marcos.vinicius.wz@gmail.com>

* TimeSeries: more thorough detection of negative values for stacking dir (#57863) (#58147)

(cherry picked from commit 4d88e2b542c62bf287a60af01fddfa2e6de220b4)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* fixed explain handlers for label- and lineformat (#58135) (#58151)

(cherry picked from commit 4b1ddba0a8998884982d275e846ec4af6787a06f)

Co-authored-by: Sven Grossmann <sven.grossmann@grafana.com>

* fixes typo (#58159) (#58194)

(cherry picked from commit 1722000309c6e6dc36c9e4f5ef9c2e40cc6e6c65)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Alerting: Encode path separators to side-step proxies (#58222)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Build: add explicit build step for go codeql (#58195) (#58243)

* add explicit build step for go codeql

* support workflow_dispatch for codeql checks

* syntax fix

* enable on push to codeql-go branch

* test

* use go version from go.mod

* explicitly set go version

* tidy up, add workflow_dispatch support to all codeql actions

(cherry picked from commit da9c646f242fd16ba8a789fa5d1c50094d761ae7)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Search: Fixes searching by current folder when opened by clicking dashboard folder name  (#57716) (#57949)

* Search: Read from url on mount no on app boot

* Fixed tests

* Remove unused type

(cherry picked from commit 3991be4c1dd35ff05e1a7dee117710e766b1a3c9)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* \"Release: Updated versions in package to 9.2.5\" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying \"General\" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

\"Release: Updated versions in package to 9.2.6\"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

\"Release: Updated versions in package to 9.2.7\"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

\"Release: Updated versions in package to 9.2.8\"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation \"stealing\" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

\"Release: Updated versions in package to 9.2.11\"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v9.2.x] QueryEditorRow: Fixes issue loading query editor when data source variable selected (#62179)

QueryEditorRow: Fixes issue loading query editor when data source variable selected (#61927)

* QueryEditorRow: Fixes issue loading query editor when data source variable selected

* Fix func name

* Removed wait

* restore waiting for with better check

* restore waiting for with better check

(cherry picked from commit 9f7ddf1f0b5234a1fd82e1f92d1444f81a794e45)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* [v9.2.x] update gpg secret names (#62250)

update gpg secret names

* [v9.2.x] Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62205)

Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62193)

* fix: capture both ErrInvalidAPIKey

* rename of variable

(cherry picked from commit c5cb5be3cc078cc99b0324ae0db429646e0603ad)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Login: Fix panic when UpsertUser is called without ReqContext (#62574)

* Login: Fix panic when UpsertUser is called without ReqContext (#62539)

(cherry picked from commit b1151dd118f2a1c305a6f757661e42e59cf145c1)
(cherry picked from commit 679cc18648295053a6ab9b764b85cd68f773f81b)

* [v9.2.x] Tempo: Fix span name being dropped from the query (#62591)

Tempo: Fix span name being dropped from the query (#62257)
(cherry picked from commit c3b476e1dcb310e1d3b425f058264ed5be00d1d8)
Co-authored-by: Hamas Shafiq <hamas.shafiq@grafana.com>

* [v9.2.x] Expressions: Fixes the issue showing expressions editor (#62626)

* Expressions: Fixes the issue showing expressions editor (#62510)

* Use suggested value for uid

* update the snapshot

* use __expr__

* replace all -100 with __expr__

* update snapshot

* more changes

* revert redundant change

* Use expr.DatasourceUID where it's possible

* generate files

(cherry picked from commit 91221bc4362e50b9cca6dbff3a8342b2991900d2)

* unit text fix

* [v9.2.x] docs: deleted link to moved content (#62703)

deleted link to moved content

* [v9.2.x] docs: fix broken elasticsearch metrics play link (#62717)

docs: fix broken elasticsearch metrics play link (#62715)

fix broken elastic search play link

(cherry picked from commit 1225e8d6d8a2076f2141065c0ad20b55241d6f25)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix/60084/save and test (#62748)

Fix: Save and test error message does not persist across datasource instance settings anymore

(cherry picked from commit ce50168b70b4444abb5a1aa36d695dc1b7c339b9)

Co-authored-by: Timur Olzhabayev <timur.olzhabayev@grafana.com>

* [v9.2.x] Server: Switch from separate server & cli to a unified grafana binary (#58286) (#62754)

* Server: Switch from separate server & cli to a unified grafana binary (#58286)

* avoid the need for a second bulky binary for grafana-cli

* look for grafana-server in $PATH as well as same directory

* implement unified \"grafana\" command

* update dockerfiles, fix grafana-cli -v

* update packaging to work with single binary

- add wrapper scripts for grafana and grafana-server
- update and sync package files
- implement --sign flag of build package command
- stop packaging scripts folder, they are not useful for end users
- add support for --configOverrides in server command
- remove unused nfpm.yaml config file

* windows support

(cherry picked from commit de99ce139c96e7229bb5e194aed225e3321d8685)

* Build: don't remove grafana-server and grafana-cli binaries from deb and rpm packages (#59890)

* don't remove grafana-server and grafana-cli binaries from /usr/share/grafana/bin in deb and rpm packages

* don't add config overrides in /usr/sbin/grafana-server

(cherry picked from commit 01cba80cbd762a180a18592a82d6e5992c4fb941)

---------

Co-authored-by: Dan Cech <dcech@grafana.com>

* [v9.2.x] MSSQL: Add support for macro function calls (#62887)

MSSQL: Add support for macro function calls (#62742)

* MSSQL: Add support for macro function calls

* Add tests

(cherry picked from commit 9fc3b360a43e9f0295f7366e9ea635a43521b341)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Remove packages path from branch filter (#60946)

Remove packages path from branch filter (#60128)

That directory is no longer used in published docs and causes this
workflow to fail when changes only affect the packages directory.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 1516aa27622ee5dc8d14cc3ebcd07647bf1619bd)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Update publishing workflows to use organization secret (#63043)

Update publishing workflows to use organization secret (#63001)

The new tokens are managed centrally and have a longer expiry.
Administrators of the grafanabot account will be
notified of the pending expiry and the secret can be rotated centrally
without the need for a repository administrator to update their
secrets.

The existing repository secrets can safely be removed. The tokens for
those secrets will be removed by the end of this week.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit ba9bdf3455b24f3d86b425ccd24994b915327c3b)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Server: Fix issue backporting #58286 to v9.2.x in #62754 (#63067)

Fix issue backporting #58286 to v9.2.x in #62754

* [v9.2.x] Remove `gen-jsonnet` make target from `bra.toml` (#63102)

Remove gen-jsonnet from toml

* [v9.2.x] fix broken envelope encryption link (#63141)

fix broken envelope encryption link (#63135)

(cherry picked from commit 72ca7fe7fe30a95e75e558bf83efc4e791e5018e)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix MSSQL queries failing because of bad interpolation (#63170)

Fix MSSQL queries failing because of bad interpolation (#63167)

fix failing mssql queries

(cherry picked from commit 62b078e4e4cad882e9e9a01f36cc8df4aa084eab)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* CI: Backport CI/Release related code to v9.2.x (#63251)

* Cherry pick from 03b1cf7

* Remove publishpackages/go

* Backport enterprise checks

* CI: Allow other modules to register build sub-commands (#62741)

* Allow other modules to register build sub-commands

* CI: Fix retries on artifacts-page clone

* Fix linting errors

* Fix golint issues

* Update to grabpl 3.0.21

(cherry picked from commit 312ea59e6da16c28226042b7cdebf4e660880ed7)

* CI: Remove variants arg from `package` step (#62858)

* Remove variants arg from package step

* Fix starlark lint

* Default to releaseModeConfig.Variants

* Check for empty variants arg

(cherry picked from commit e5c48ac9454a8513d526384751b953ff98d12ecb)

* Remove verify-jsonnet-step

* Revert github.com/grafana/thema bump

* go mod tidy

* Remove publish.star

* Fix lib.star lint

* CI: Running Redis integration tests without grabpl (#63028)

This restores some changes from
https://github.com/grafana/grafana/pull/61920 that were accidentally
deleted.

(cherry picked from commit 2804acd264ff247673f71854d25d79656b7b0775)

* go mod tidy

* Fix clone enterprise for custom events

* Chore: Bump alpine version to `3.17.1` (#63252)

Bump alpine version to 3.17.1

(cherry picked from commit 24c60486f62fd723b3d61718d45e7b9382f74656)

---------

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>
Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2.x] MSSQL Datasource: Revert functions within macros change (#63596)

MSSQL Datasource: Revert functions within macros change (#63592)

* Revert functions within macros change
* Add tests for function and macro for mssql
* Remove macro support tests

---------

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>
(cherry picked from commit 356e2e1933f5e717a0e8f7688ba1b44f7bf9fa01)

Co-authored-by: Kyle Cunningham <codeincarnate@users.noreply.github.com>

* [v9.2.x] docs: fixed headings and link to explore with logs (#63673)

[9.3.x] docs: fixed headings and link to explore with logs (#63670)

fixed headings and link to explore with logs

(cherry picked from commit abfd8792e536ec8096f83f5abb4612fb7312f90b)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Update grafana/saml library (#689)

SAML: update grafana/saml

Co-authored-by: Jo <joao.guerreiro@grafana.com>

Co-authored-by: linoman <2051016+linoman@users.noreply.github.com>
Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#704)

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

(cherry picked from commit dbbe819368f507b9493b7a3cf6e080a5dd752b3e)

* remove added file

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Auth: Update saml go.mod (missing query sig verification) [9.2.x] (#713)

update saml go.mod (missing query sig verification)

(cherry picked from commit 1e1dbd1a06455a451d722856dc619b2a7c78e2c0)

* Release: Bump version to 9.2.11 (#728)

\"Release: Updated versions in package to 9.2.11\"

* [v9.2.x] Geomap: Sanitize the attribution string (#753)

Geomap: Sanitize the attribution string (#745)

* SAML: Update grafana/saml library (#691)

Co-authored-by: jguer <joao.guerreiro@grafana.com>

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

* add sanitize

* Fix frontend build

* Remove unnecessary yarn.lock changes

* Fix formatting

* Re-add yarn.lock message as I guess it is needed

---------

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
Co-authored-by: jguer <joao.guerreiro@grafana.com>
Co-authored-by: nmarrs <nathanielmarrs@gmail.com>
Co-authored-by: Drew Slobodnjak <60050885+drew08t@users.noreply.github.com>
(cherry picked from commit 37b4af7ffacfc24d5f24d190356a9ef32d99aa6f)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] TraceView: Add key and url escaping of json tag values (#760)

* [v9.2.x] Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64115)

Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64108)

* Change docker image used for cross-compilation

* Replace fmt.Println with log.Println

* Add specific tag for docker image

(cherry picked from commit b42fd92fad7c4e826cb6ae9ed360952bbc9a87a9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] build: fix corss build (#63263)

build: fix corss build (#61121)

* build: fix corss build

* fix lint

(cherry picked from commit 37baae3699fcad37dac87a759491ae5db02369df)

Co-authored-by: Jimmie Han <hanjinming@outlook.com>

* [9.2.x] CI: Move some build settings (#64491) (#64517)

Backporting https://github.com/grafana/grafana/pull/64491.

* Move some build settings to Vault

* CI: Remove reference to DOWNSTREAM_REPO as it isn't used

(cherry picked from commit 4b241804b401eed529e41fa775186d8ffe89ea1c)

* [v9.2.x] CI: Add `PrereleaseBucket` field in `versions.go` (#64522)

CI: Add `PrereleaseBucket` field in `versions.go` (#64519)

Add PrereleaseBucket in versions.go

(cherry picked from commit 29b3f3fbf4cd64a59422ac14c58d8fb81f7b17f9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [9.2.x] CI: Do not clone in artifacts-page pipeline (#64663)

This is done in a later step.

* [v9.2.x] Alerting: Fix queries not being previewed in detail view (#64977)

* Alerting: Fix queries not being previewed in detail view (#64198)

(cherry picked from commit 4e81aab60a587b102305a255891986e592a0d1a4)

* Update imports

---------

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>
Co-authored-by: ismail simsek <ismailsimsek09@gmail.com>

* [v9.2.x] Alerting: Fix expression issues in alert rule view and edit pages (#65008)

* Fix rule viewer

* Fix expressions editor and viewer in alerting

* [v9.2.x] Update CODEOWNERship for grafana-delivery team (#64973) (#65020)

Update CODEOWNERship for grafana-delivery team (#64973)

(cherry picked from commit 2897ee37bf9f575eef19bcd35182232f965c6499)

* [v9.2.x] CI: Update `grabpl` to `3.0.30` (#65028) (#65087)

CI: Update `grabpl` to `3.0.30` (#65028)

Update grabpl

(cherry picked from commit 4a80233bedf6e750f0ce43fa9fe1f6eb7ab9f6fa)

* [v9.2.x] NPM: Stop using the folder path before the name path (#65156)

NPM: Stop using the folder path before the name path (#63851)

Stop using the folder path before the name path

(cherry picked from commit 177aa254c563dfe98ffabd2de56330bee960f160)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Fix xss in Graphite functions tooltip (#810)

Fix xss in Graphite functions tooltip (#804)

(cherry picked from commit 87aad3f11836f810ee1fdfee27827e746ef36055)

Co-authored-by: Ludovic Viaud <ludovic.viaud@gmail.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.15 (#65196) (#65200)

Changelog: Updated changelog for 9.2.15 (#65196)

* Changelog: Updated changelog for 9.2.15

* Update CHANGELOG.md

---------

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit a907e042f9cdba3d4c00e89f820bfd9030025af9)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.16 (#65202)

\"Release: Updated versions in package to 9.2.16\"

* [v9.2.x] CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173) (#65193)

CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173)

* Remove fetch-images dependency

* Fix starlark link

(cherry picked from commit d0be9610f0e22a4571a13c2ebf2aaabe281ecf48)

* [v9.2.x] Expressions: More robust expression check (#65231)

* Expressions: More robust expression check (#65006)

More robust expression check

(cherry picked from commit 1328878aceb37da7051c5685375e2ca32ef0a6b4)

* Fix import

* [v9.2.x] CI:…")`
…

`[f84a7c3](/percona/grafana/commit/f84a7c35000e11a2f4684852fd657f814381558c)`

```
* reduce the number of requests in folder section (#55876) (#58145)

(cherry picked from commit 372ba83534e0fd91e1c25d7c3c27a3ac1f68f62c)

Co-authored-by: Marcos Vinicius <marcos.vinicius.wz@gmail.com>

* TimeSeries: more thorough detection of negative values for stacking dir (#57863) (#58147)

(cherry picked from commit 4d88e2b542c62bf287a60af01fddfa2e6de220b4)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* fixed explain handlers for label- and lineformat (#58135) (#58151)

(cherry picked from commit 4b1ddba0a8998884982d275e846ec4af6787a06f)

Co-authored-by: Sven Grossmann <sven.grossmann@grafana.com>

* fixes typo (#58159) (#58194)

(cherry picked from commit 1722000309c6e6dc36c9e4f5ef9c2e40cc6e6c65)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Alerting: Encode path separators to side-step proxies (#58222)

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>

* Build: add explicit build step for go codeql (#58195) (#58243)

* add explicit build step for go codeql

* support workflow_dispatch for codeql checks

* syntax fix

* enable on push to codeql-go branch

* test

* use go version from go.mod

* explicitly set go version

* tidy up, add workflow_dispatch support to all codeql actions

(cherry picked from commit da9c646f242fd16ba8a789fa5d1c50094d761ae7)

Co-authored-by: Dan Cech <dcech@grafana.com>

* Search: Fixes searching by current folder when opened by clicking dashboard folder name  (#57716) (#57949)

* Search: Read from url on mount no on app boot

* Fixed tests

* Remove unused type

(cherry picked from commit 3991be4c1dd35ff05e1a7dee117710e766b1a3c9)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* "Release: Updated versions in package to 9.2.5" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying "General" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

"Release: Updated versions in package to 9.2.6"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

"Release: Updated versions in package to 9.2.7"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

"Release: Updated versions in package to 9.2.8"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation "stealing" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

"Release: Updated versions in package to 9.2.11"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v9.2.x] QueryEditorRow: Fixes issue loading query editor when data source variable selected (#62179)

QueryEditorRow: Fixes issue loading query editor when data source variable selected (#61927)

* QueryEditorRow: Fixes issue loading query editor when data source variable selected

* Fix func name

* Removed wait

* restore waiting for with better check

* restore waiting for with better check

(cherry picked from commit 9f7ddf1f0b5234a1fd82e1f92d1444f81a794e45)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* [v9.2.x] update gpg secret names (#62250)

update gpg secret names

* [v9.2.x] Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62205)

Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62193)

* fix: capture both ErrInvalidAPIKey

* rename of variable

(cherry picked from commit c5cb5be3cc078cc99b0324ae0db429646e0603ad)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Login: Fix panic when UpsertUser is called without ReqContext (#62574)

* Login: Fix panic when UpsertUser is called without ReqContext (#62539)

(cherry picked from commit b1151dd118f2a1c305a6f757661e42e59cf145c1)
(cherry picked from commit 679cc18648295053a6ab9b764b85cd68f773f81b)

* [v9.2.x] Tempo: Fix span name being dropped from the query (#62591)

Tempo: Fix span name being dropped from the query (#62257)
(cherry picked from commit c3b476e1dcb310e1d3b425f058264ed5be00d1d8)
Co-authored-by: Hamas Shafiq <hamas.shafiq@grafana.com>

* [v9.2.x] Expressions: Fixes the issue showing expressions editor (#62626)

* Expressions: Fixes the issue showing expressions editor (#62510)

* Use suggested value for uid

* update the snapshot

* use __expr__

* replace all -100 with __expr__

* update snapshot

* more changes

* revert redundant change

* Use expr.DatasourceUID where it's possible

* generate files

(cherry picked from commit 91221bc4362e50b9cca6dbff3a8342b2991900d2)

* unit text fix

* [v9.2.x] docs: deleted link to moved content (#62703)

deleted link to moved content

* [v9.2.x] docs: fix broken elasticsearch metrics play link (#62717)

docs: fix broken elasticsearch metrics play link (#62715)

fix broken elastic search play link

(cherry picked from commit 1225e8d6d8a2076f2141065c0ad20b55241d6f25)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix/60084/save and test (#62748)

Fix: Save and test error message does not persist across datasource instance settings anymore

(cherry picked from commit ce50168b70b4444abb5a1aa36d695dc1b7c339b9)

Co-authored-by: Timur Olzhabayev <timur.olzhabayev@grafana.com>

* [v9.2.x] Server: Switch from separate server & cli to a unified grafana binary (#58286) (#62754)

* Server: Switch from separate server & cli to a unified grafana binary (#58286)

* avoid the need for a second bulky binary for grafana-cli

* look for grafana-server in $PATH as well as same directory

* implement unified "grafana" command

* update dockerfiles, fix grafana-cli -v

* update packaging to work with single binary

- add wrapper scripts for grafana and grafana-server
- update and sync package files
- implement --sign flag of build package command
- stop packaging scripts folder, they are not useful for end users
- add support for --configOverrides in server command
- remove unused nfpm.yaml config file

* windows support

(cherry picked from commit de99ce139c96e7229bb5e194aed225e3321d8685)

* Build: don't remove grafana-server and grafana-cli binaries from deb and rpm packages (#59890)

* don't remove grafana-server and grafana-cli binaries from /usr/share/grafana/bin in deb and rpm packages

* don't add config overrides in /usr/sbin/grafana-server

(cherry picked from commit 01cba80cbd762a180a18592a82d6e5992c4fb941)

---------

Co-authored-by: Dan Cech <dcech@grafana.com>

* [v9.2.x] MSSQL: Add support for macro function calls (#62887)

MSSQL: Add support for macro function calls (#62742)

* MSSQL: Add support for macro function calls

* Add tests

(cherry picked from commit 9fc3b360a43e9f0295f7366e9ea635a43521b341)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Remove packages path from branch filter (#60946)

Remove packages path from branch filter (#60128)

That directory is no longer used in published docs and causes this
workflow to fail when changes only affect the packages directory.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 1516aa27622ee5dc8d14cc3ebcd07647bf1619bd)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Update publishing workflows to use organization secret (#63043)

Update publishing workflows to use organization secret (#63001)

The new tokens are managed centrally and have a longer expiry.
Administrators of the grafanabot account will be
notified of the pending expiry and the secret can be rotated centrally
without the need for a repository administrator to update their
secrets.

The existing repository secrets can safely be removed. The tokens for
those secrets will be removed by the end of this week.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit ba9bdf3455b24f3d86b425ccd24994b915327c3b)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Server: Fix issue backporting #58286 to v9.2.x in #62754 (#63067)

Fix issue backporting #58286 to v9.2.x in #62754

* [v9.2.x] Remove `gen-jsonnet` make target from `bra.toml` (#63102)

Remove gen-jsonnet from toml

* [v9.2.x] fix broken envelope encryption link (#63141)

fix broken envelope encryption link (#63135)

(cherry picked from commit 72ca7fe7fe30a95e75e558bf83efc4e791e5018e)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix MSSQL queries failing because of bad interpolation (#63170)

Fix MSSQL queries failing because of bad interpolation (#63167)

fix failing mssql queries

(cherry picked from commit 62b078e4e4cad882e9e9a01f36cc8df4aa084eab)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* CI: Backport CI/Release related code to v9.2.x (#63251)

* Cherry pick from 03b1cf7

* Remove publishpackages/go

* Backport enterprise checks

* CI: Allow other modules to register build sub-commands (#62741)

* Allow other modules to register build sub-commands

* CI: Fix retries on artifacts-page clone

* Fix linting errors

* Fix golint issues

* Update to grabpl 3.0.21

(cherry picked from commit 312ea59e6da16c28226042b7cdebf4e660880ed7)

* CI: Remove variants arg from `package` step (#62858)

* Remove variants arg from package step

* Fix starlark lint

* Default to releaseModeConfig.Variants

* Check for empty variants arg

(cherry picked from commit e5c48ac9454a8513d526384751b953ff98d12ecb)

* Remove verify-jsonnet-step

* Revert github.com/grafana/thema bump

* go mod tidy

* Remove publish.star

* Fix lib.star lint

* CI: Running Redis integration tests without grabpl (#63028)

This restores some changes from
https://github.com/grafana/grafana/pull/61920 that were accidentally
deleted.

(cherry picked from commit 2804acd264ff247673f71854d25d79656b7b0775)

* go mod tidy

* Fix clone enterprise for custom events

* Chore: Bump alpine version to `3.17.1` (#63252)

Bump alpine version to 3.17.1

(cherry picked from commit 24c60486f62fd723b3d61718d45e7b9382f74656)

---------

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>
Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2.x] MSSQL Datasource: Revert functions within macros change (#63596)

MSSQL Datasource: Revert functions within macros change (#63592)

* Revert functions within macros change
* Add tests for function and macro for mssql
* Remove macro support tests

---------

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>
(cherry picked from commit 356e2e1933f5e717a0e8f7688ba1b44f7bf9fa01)

Co-authored-by: Kyle Cunningham <codeincarnate@users.noreply.github.com>

* [v9.2.x] docs: fixed headings and link to explore with logs (#63673)

[9.3.x] docs: fixed headings and link to explore with logs (#63670)

fixed headings and link to explore with logs

(cherry picked from commit abfd8792e536ec8096f83f5abb4612fb7312f90b)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Update grafana/saml library (#689)

SAML: update grafana/saml

Co-authored-by: Jo <joao.guerreiro@grafana.com>

Co-authored-by: linoman <2051016+linoman@users.noreply.github.com>
Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#704)

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

(cherry picked from commit dbbe819368f507b9493b7a3cf6e080a5dd752b3e)

* remove added file

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Auth: Update saml go.mod (missing query sig verification) [9.2.x] (#713)

update saml go.mod (missing query sig verification)

(cherry picked from commit 1e1dbd1a06455a451d722856dc619b2a7c78e2c0)

* Release: Bump version to 9.2.11 (#728)

"Release: Updated versions in package to 9.2.11"

* [v9.2.x] Geomap: Sanitize the attribution string (#753)

Geomap: Sanitize the attribution string (#745)

* SAML: Update grafana/saml library (#691)

Co-authored-by: jguer <joao.guerreiro@grafana.com>

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

* add sanitize

* Fix frontend build

* Remove unnecessary yarn.lock changes

* Fix formatting

* Re-add yarn.lock message as I guess it is needed

---------

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
Co-authored-by: jguer <joao.guerreiro@grafana.com>
Co-authored-by: nmarrs <nathanielmarrs@gmail.com>
Co-authored-by: Drew Slobodnjak <60050885+drew08t@users.noreply.github.com>
(cherry picked from commit 37b4af7ffacfc24d5f24d190356a9ef32d99aa6f)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] TraceView: Add key and url escaping of json tag values (#760)

* [v9.2.x] Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64115)

Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64108)

* Change docker image used for cross-compilation

* Replace fmt.Println with log.Println

* Add specific tag for docker image

(cherry picked from commit b42fd92fad7c4e826cb6ae9ed360952bbc9a87a9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] build: fix corss build (#63263)

build: fix corss build (#61121)

* build: fix corss build

* fix lint

(cherry picked from commit 37baae3699fcad37dac87a759491ae5db02369df)

Co-authored-by: Jimmie Han <hanjinming@outlook.com>

* [9.2.x] CI: Move some build settings (#64491) (#64517)

Backporting https://github.com/grafana/grafana/pull/64491.

* Move some build settings to Vault

* CI: Remove reference to DOWNSTREAM_REPO as it isn't used

(cherry picked from commit 4b241804b401eed529e41fa775186d8ffe89ea1c)

* [v9.2.x] CI: Add `PrereleaseBucket` field in `versions.go` (#64522)

CI: Add `PrereleaseBucket` field in `versions.go` (#64519)

Add PrereleaseBucket in versions.go

(cherry picked from commit 29b3f3fbf4cd64a59422ac14c58d8fb81f7b17f9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [9.2.x] CI: Do not clone in artifacts-page pipeline (#64663)

This is done in a later step.

* [v9.2.x] Alerting: Fix queries not being previewed in detail view (#64977)

* Alerting: Fix queries not being previewed in detail view (#64198)

(cherry picked from commit 4e81aab60a587b102305a255891986e592a0d1a4)

* Update imports

---------

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>
Co-authored-by: ismail simsek <ismailsimsek09@gmail.com>

* [v9.2.x] Alerting: Fix expression issues in alert rule view and edit pages (#65008)

* Fix rule viewer

* Fix expressions editor and viewer in alerting

* [v9.2.x] Update CODEOWNERship for grafana-delivery team (#64973) (#65020)

Update CODEOWNERship for grafana-delivery team (#64973)

(cherry picked from commit 2897ee37bf9f575eef19bcd35182232f965c6499)

* [v9.2.x] CI: Update `grabpl` to `3.0.30` (#65028) (#65087)

CI: Update `grabpl` to `3.0.30` (#65028)

Update grabpl

(cherry picked from commit 4a80233bedf6e750f0ce43fa9fe1f6eb7ab9f6fa)

* [v9.2.x] NPM: Stop using the folder path before the name path (#65156)

NPM: Stop using the folder path before the name path (#63851)

Stop using the folder path before the name path

(cherry picked from commit 177aa254c563dfe98ffabd2de56330bee960f160)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Fix xss in Graphite functions tooltip (#810)

Fix xss in Graphite functions tooltip (#804)

(cherry picked from commit 87aad3f11836f810ee1fdfee27827e746ef36055)

Co-authored-by: Ludovic Viaud <ludovic.viaud@gmail.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.15 (#65196) (#65200)

Changelog: Updated changelog for 9.2.15 (#65196)

* Changelog: Updated changelog for 9.2.15

* Update CHANGELOG.md

---------

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit a907e042f9cdba3d4c00e89f820bfd9030025af9)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.16 (#65202)

"Release: Updated versions in package to 9.2.16"

* [v9.2.x] CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173) (#65193)

CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173)

* Remove fetch-images dependency

* Fix starlark link

(cherry picked from commit d0be9610f0e22a4571a13c2ebf2aaabe281ecf48)

* [v9.2.x] Expressions: More robust expression check (#65231)

* Expressions: More robust expression check (#65006)

More robust expression check

(cherry picked from commit 1328878aceb37da7051c5685375e2ca32ef0a6b4)

* Fix import

* [v9.2.x] CI:…
```

[BupycHuk](/BupycHuk)
pushed a commit
to percona/grafana
that referenced
this pull request
[Jun 29, 2023](#ref-commit-7ff49f3)
[![@matejkubinec](https://avatars.githubusercontent.com/u/32638572?s=40&u=f15b1e5f63d6faa5145a40e4164e0fa9ea72fff7&v=4)](/matejkubinec) [![@eleijonmarck](https://avatars.githubusercontent.com/u/7727602?s=40&u=4f4984c270ed39839e9b8dff600287396939ac2b&v=4)](/eleijonmarck)
[![@ryantxu](https://avatars.githubusercontent.com/u/705951?s=40&u=45875989d2adfe87f95caa12e32e5a82b08898f8&v=4)](/ryantxu) [![@grafanabot](https://avatars.githubusercontent.com/u/43478413?s=40&u=a7be21af02d82dcfe4d68822d6add1dc78b445b1&v=4)](/grafanabot) [![@mdvictor](https://avatars.githubusercontent.com/u/36818606?s=40&u=ce9025a7a04ae6e1a483480620fbc96442c74e43&v=4)](/mdvictor) [![@oscarkilhed](https://avatars.githubusercontent.com/u/468940?s=40&u=cdfbb52c148b5da116460f3ea9126cb5b5569e54&v=4)](/oscarkilhed) [![@joshhunt](https://avatars.githubusercontent.com/u/46142?s=40&u=5bf6f4243ee4ab8d8a99c3c210af343fdc625798&v=4)](/joshhunt) [![@andresmgot](https://avatars.githubusercontent.com/u/4025665?s=40&u=6d474b97f4f73c53f4609e6921afdabc407c6dbb&v=4)](/andresmgot) [![@dessen-xu](https://avatars.githubusercontent.com/u/41524013?s=40&u=01884d79b94696e284a35c8b681bf29434ef1a36&v=4)](/dessen-xu) [![@gtk-grafana](https://avatars.githubusercontent.com/u/109082771?s=40&u=bbd7b28097ca89a03816a1dabae2fcb1189b174e&v=4)](/gtk-grafana) [![@sakjur](https://avatars.githubusercontent.com/u/298945?s=40&u=f59488eb9b9031b02ae9f24116f8d5ac7d0071f8&v=4)](/sakjur) [![@siiimooon](https://avatars.githubusercontent.com/u/85333972?s=40&u=bc3afa1dea6abfb33d7f3e626099df5bc77955ad&v=4)](/siiimooon) [![@zoltanbedi](https://avatars.githubusercontent.com/u/13729989?s=40&u=6b2d0104259543f280a6b8ea1cccaba2c59e87d5&v=4)](/zoltanbedi) [![@grobinson-grafana](https://avatars.githubusercontent.com/u/85952834?s=40&v=4)](/grobinson-grafana) [![@neel1996](https://avatars.githubusercontent.com/u/47709856?s=40&u=d02474c07146b62f73c082ba2d9e312909bbf5cc&v=4)](/neel1996) [![@dsotirakis](https://avatars.githubusercontent.com/u/15115078?s=40&u=2637caf13fe96ac43d1680b369e8cfdb8732ddf1&v=4)](/dsotirakis) [![@marefr](https://avatars.githubusercontent.com/u/1668778?s=40&v=4)](/marefr) [![@chri2547](https://avatars.githubusercontent.com/u/35463610?s=40&u=97f7cf99392dddf4ffdc83bbbce761efd6f40332&v=4)](/chri2547) [![@wjordan](https://avatars.githubusercontent.com/u/56541?s=40&v=4)](/wjordan) [![@sd2k](https://avatars.githubusercontent.com/u/5464991?s=40&u=debba4e86c2176c3afc994fa3eb8ba9ddb7e6d53&v=4)](/sd2k) [![@julienduchesne](https://avatars.githubusercontent.com/u/29210090?s=40&u=d64510d5f3d87110355ed5c2e12d07d216b13c3b&v=4)](/julienduchesne) [![@DanCech](https://avatars.githubusercontent.com/u/1443603?s=40&u=563883eed1a53cbd19c35742c3a3ee1b2ddfb0ac&v=4)](/DanCech) [![@asimpson](https://avatars.githubusercontent.com/u/1048831?s=40&u=d49ee317b1a2d379515b5e59c03fce5b70009faa&v=4)](/asimpson) [![@joeblubaugh](https://avatars.githubusercontent.com/u/1951900?s=40&u=1f1faee9254bfaa1e686540a726bbd9ff1cf6e71&v=4)](/joeblubaugh) [![@xiyu95](https://avatars.githubusercontent.com/u/112968312?s=40&u=ea78ebf8294c6ddaab752aaa136a3f1ac943bfd3&v=4)](/xiyu95) [![@wbrowne](https://avatars.githubusercontent.com/u/1173299?s=40&u=07b5baceef0bdc39ee7f967f39c9c82afb4a81d2&v=4)](/wbrowne) [![@gwdawson](https://avatars.githubusercontent.com/u/34524710?s=40&u=7ea8832f2f2e29b4805d75b3bba2411344593189&v=4)](/gwdawson) [![@ashharrison90](https://avatars.githubusercontent.com/u/20999846?s=40&u=e6c1c42a3025abfa1c1d579691b5541df490cf73&v=4)](/ashharrison90) [![@xnyo](https://avatars.githubusercontent.com/u/16373015?s=40&u=1dc1b8caf479abe3feaa070c01b1400c3a62b448&v=4)](/xnyo) [![@nmarrs](https://avatars.githubusercontent.com/u/22381771?s=40&u=ccb32ecdc60cfb1698f45febb3b0bbce6038dc13&v=4)](/nmarrs) [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas) [![@joey-grafana](https://avatars.githubusercontent.com/u/90795735?s=40&u=16b1cfc381a83ca938f6d096935f0e747b3691fb&v=4)](/joey-grafana) [![@tolzhabayev](https://avatars.githubusercontent.com/u/580672?s=40&u=cf4a1f5bdba6e8ecfe23dc9fa22069e5431498f8&v=4)](/tolzhabayev) [![@itsmylife](https://avatars.githubusercontent.com/u/820946?s=40&u=5a928c48831b349c7da1b0022636df01ce0f1ced&v=4)](/itsmylife) [![@kalleep](https://avatars.githubusercontent.com/u/23356117?s=40&v=4)](/kalleep) [![@jackw](https://avatars.githubusercontent.com/u/73201?s=40&u=9fb7fc975368a6fae3be8676b46cfc9ad06c7b15&v=4)](/jackw) [![@gguillotte-grafana](https://avatars.githubusercontent.com/u/100453168?s=40&u=3d0bf8114b33430d58934de11387ccd510f3a0e5&v=4)](/gguillotte-grafana) [![@phongvq](https://avatars.githubusercontent.com/u/20754136?s=40&u=30cff65424186e5ff97e24894b5935ae17fd73c2&v=4)](/phongvq) [![@daniellee](https://avatars.githubusercontent.com/u/434655?s=40&u=0625e6874dbde9488a0cd6bc2d3a94c665337551&v=4)](/daniellee) [![@Jguer](https://avatars.githubusercontent.com/u/8071073?s=40&u=31dcf861785552275aea3a89860b081ed114ee1f&v=4)](/Jguer) [![@mgyongyosi](https://avatars.githubusercontent.com/u/1585112?s=40&u=bedfa00ab0788c2bfe8411a8218f7bb9a446cc67&v=4)](/mgyongyosi) [![@malcolmholmes](https://avatars.githubusercontent.com/u/42545407?s=40&v=4)](/malcolmholmes) [![@kaydelaney](https://avatars.githubusercontent.com/u/45561153?s=40&u=136490e13ee468c88746b8dc89a1772cbbf4ae73&v=4)](/kaydelaney) [![@jdbaldry](https://avatars.githubusercontent.com/u/4599384?s=40&v=4)](/jdbaldry) [![@kylebrandt](https://avatars.githubusercontent.com/u/1692624?s=40&u=f03edc41ac5f244ccf8afbaf591a2c2d5bf9422b&v=4)](/kylebrandt) [![@zuchka](https://avatars.githubusercontent.com/u/37156449?s=40&u=7227f6489882e5cf0856219349f19ac1ddbd2a11&v=4)](/zuchka) [![@leandro-deveikis](https://avatars.githubusercontent.com/u/34773040?s=40&u=0c0813698b625812c84deccbe3e4727f5104a28a&v=4)](/leandro-deveikis) [![@leeoniya](https://avatars.githubusercontent.com/u/43234?s=40&u=49f10c1db35f1a4f328346b597cc763f695bb29d&v=4)](/leeoniya) [![@bartpeeters](https://avatars.githubusercontent.com/u/29534282?s=40&v=4)](/bartpeeters) [![@svennergr](https://avatars.githubusercontent.com/u/8092184?s=40&u=733ce9f1c399468005886bdfa2ce242d758348f0&v=4)](/svennergr) [![@yvigara](https://avatars.githubusercontent.com/u/704600?s=40&u=127c2e201ae7c012f5e801e624af426aaf059b1c&v=4)](/yvigara) [![@owensmallwood](https://avatars.githubusercontent.com/u/20195316?s=40&u=0381407162d812492507256b2e90d3ace502b045&v=4)](/owensmallwood) [![@IevaVasiljeva](https://avatars.githubusercontent.com/u/9482349?s=40&u=6bf34051e6e76a6e014cb56085fd8671f8a32f16&v=4)](/IevaVasiljeva) [![@lpskdl](https://avatars.githubusercontent.com/u/108552997?s=40&u=4b1d5afda8817ac8fa0c3f379fbc21f05339f682&v=4)](/lpskdl) [![@gamab](https://avatars.githubusercontent.com/u/5232696?s=40&u=6c5fef30916541609539c960841a8f9230a2fd6f&v=4)](/gamab) [![@aangelisc](https://avatars.githubusercontent.com/u/15019026?s=40&u=3540a1f3f4e09019aaa10a927ca4ca1a8b1caa51&v=4)](/aangelisc) [![@zserge](https://avatars.githubusercontent.com/u/1911760?s=40&u=d54bceb88fc5adc736476c5625bc96eed3725de0&v=4)](/zserge) [![@bergquist](https://avatars.githubusercontent.com/u/618863?s=40&u=3e138dc82d635ddf0c5c82e6463edb81b2205a74&v=4)](/bergquist) [![@iwysiu](https://avatars.githubusercontent.com/u/5421859?s=40&v=4)](/iwysiu) [![@bohandley](https://avatars.githubusercontent.com/u/25674746?s=40&u=5db785e20acac583c2c70f95579eed8acda76034&v=4)](/bohandley) [![@Eve832](https://avatars.githubusercontent.com/u/81647476?s=40&u=171081136377053e2d0a04a2d1f5e21270066d50&v=4)](/Eve832) [![@JacobsonMT](https://avatars.githubusercontent.com/u/8484471?s=40&u=30df9eec2de8834a517222b6f477bbf30598b98c&v=4)](/JacobsonMT) [![@robbymilo](https://avatars.githubusercontent.com/u/8106669?s=40&u=b5929162f75a8e3e5dca80dcfe543e46ff5985aa&v=4)](/robbymilo) [![@academo](https://avatars.githubusercontent.com/u/227916?s=40&u=2d66242d42fb2751b3a9b966ef1d433be978e4dc&v=4)](/academo) [![@adela-almasan](https://avatars.githubusercontent.com/u/88068998?s=40&u=8c681fb7664266c333858b055907df9d31b705ac&v=4)](/adela-almasan) [![@ktw4071](https://avatars.githubusercontent.com/u/10269640?s=40&v=4)](/ktw4071) [![@linoman](https://avatars.githubusercontent.com/u/2051016?s=40&u=85065225ade2a54d017c39fa976bcee1d79de5c9&v=4)](/linoman) [![@mckn](https://avatars.githubusercontent.com/u/172951?s=40&v=4)](/mckn) [![@leventebalogh](https://avatars.githubusercontent.com/u/9974811?s=40&u=7e1691a3b32d0f3adbe905e8863a6be9cde6461f&v=4)](/leventebalogh) [![@ArturWierzbicki](https://avatars.githubusercontent.com/u/23451458?s=40&u=1f9adee1a1f94b4c245b838df05d6662400cea34&v=4)](/ArturWierzbicki) [![@xlson](https://avatars.githubusercontent.com/u/114937?s=40&u=d3cfffe519c44bd3938c5f7297f4b880ada09bbe&v=4)](/xlson) [![@kminehart](https://avatars.githubusercontent.com/u/5140827?s=40&u=6a9f121b3b6daf545a3b29dda06a0f7f62e2db7d&v=4)](/kminehart) [![@usmangt](https://avatars.githubusercontent.com/u/69509548?s=40&u=2072d0b29b8514dfa1ded27606bd014f7edc020a&v=4)](/usmangt) [![@zerok](https://avatars.githubusercontent.com/u/3782?s=40&v=4)](/zerok) [![@torkelo](https://avatars.githubusercontent.com/u/10999?s=40&u=00ee9b9643b8eafd5df664bad66f196ff32bd9ed&v=4)](/torkelo) [![@imatwawana](https://avatars.githubusercontent.com/u/76437239?s=40&u=6dd696d8dde9fd57f5a423f3a81cf99a82d9a5cf&v=4)](/imatwawana) [![@codeincarnate](https://avatars.githubusercontent.com/u/199847?s=40&u=133d1e683542a7ec4b44a74c617962e777eba96e&v=4)](/codeincarnate) [![@aocenas](https://avatars.githubusercontent.com/u/1014802?s=40&u=a934e3470e711b2ed875899d43d9f887ee88b5a7&v=4)](/aocenas) [![@hanjm](https://avatars.githubusercontent.com/u/7621241?s=40&u=e4f8c804e65d58a3013730cce3912492500318b4&v=4)](/hanjm) [![@gillesdemey](https://avatars.githubusercontent.com/u/868844?s=40&u=d34da4534900c5e729ae25d01ef03d75361486f8&v=4)](/gillesdemey) [![@LudoVio](https://avatars.githubusercontent.com/u/9373203?s=40&u=783fc1a2dc9f527f5193be010d60ae8e1895396f&v=4)](/LudoVio) [![@moxious](https://avatars.githubusercontent.com/u/5471710?s=40&u=939b7c0acdedee2e16ac23d7ab12bec6bf817514&v=4)](/moxious) [![@sarah-spang](https://avatars.githubusercontent.com/u/86264026?s=40&v=4)](/sarah-spang) [![@mallettjared](https://avatars.githubusercontent.com/u/110853992?s=40&v=4)](/mallettjared) [![@JohnnyQQQQ](https://avatars.githubusercontent.com/u/3528218?s=40&u=bfac25193e2be1abeb959f5ee988ca975366fdb6&v=4)](/JohnnyQQQQ) [![@christineywang](https://avatars.githubusercontent.com/u/19804181?s=40&u=5e7deb2350518c47c0289117d0c6b2bdfb12673f&v=4)](/christineywang) [![@annelaurefroment](https://avatars.githubusercontent.com/u/49911675?s=40&v=4)](/annelaurefroment) [![@guicaulada](https://avatars.githubusercontent.com/u/7741292?s=40&u=296253fb9be05eafd88b65e2615a6c7fd8aa063e&v=4)](/guicaulada) [![@yuri-tceretian](https://avatars.githubusercontent.com/u/25988953?s=40&u=0329c4a260742982e188e4deab712da310866bbe&v=4)](/yuri-tceretian) [![@brendamuir](https://avatars.githubusercontent.com/u/100768211?s=40&v=4)](/brendamuir) [![@oneoneonepig](https://avatars.githubusercontent.com/u/13197632?s=40&u=351ccac28593c4fb7ba64afd64f660626fdf8cbe&v=4)](/oneoneonepig) [![@papagian](https://avatars.githubusercontent.com/u/1632407?s=40&u=07f720ffa380d8ec4a349e83db63cf921b1f2ad9&v=4)](/papagian)

`[PMM-12254](https://jira.percona.com/browse/PMM-12254) [Grafana 9.2.20 (](/percona/grafana/commit/7ff49f34a3998067fa1ea480c07e0c74939ea306 "PMM-12254 Grafana 9.2.20 (#673)

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* \"Release: Updated versions in package to 9.2.5\" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying \"General\" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

\"Release: Updated versions in package to 9.2.6\"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

\"Release: Updated versions in package to 9.2.7\"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

\"Release: Updated versions in package to 9.2.8\"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation \"stealing\" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

\"Release: Updated versions in package to 9.2.11\"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v9.2.x] QueryEditorRow: Fixes issue loading query editor when data source variable selected (#62179)

QueryEditorRow: Fixes issue loading query editor when data source variable selected (#61927)

* QueryEditorRow: Fixes issue loading query editor when data source variable selected

* Fix func name

* Removed wait

* restore waiting for with better check

* restore waiting for with better check

(cherry picked from commit 9f7ddf1f0b5234a1fd82e1f92d1444f81a794e45)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* [v9.2.x] update gpg secret names (#62250)

update gpg secret names

* [v9.2.x] Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62205)

Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62193)

* fix: capture both ErrInvalidAPIKey

* rename of variable

(cherry picked from commit c5cb5be3cc078cc99b0324ae0db429646e0603ad)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Login: Fix panic when UpsertUser is called without ReqContext (#62574)

* Login: Fix panic when UpsertUser is called without ReqContext (#62539)

(cherry picked from commit b1151dd118f2a1c305a6f757661e42e59cf145c1)
(cherry picked from commit 679cc18648295053a6ab9b764b85cd68f773f81b)

* [v9.2.x] Tempo: Fix span name being dropped from the query (#62591)

Tempo: Fix span name being dropped from the query (#62257)
(cherry picked from commit c3b476e1dcb310e1d3b425f058264ed5be00d1d8)
Co-authored-by: Hamas Shafiq <hamas.shafiq@grafana.com>

* [v9.2.x] Expressions: Fixes the issue showing expressions editor (#62626)

* Expressions: Fixes the issue showing expressions editor (#62510)

* Use suggested value for uid

* update the snapshot

* use __expr__

* replace all -100 with __expr__

* update snapshot

* more changes

* revert redundant change

* Use expr.DatasourceUID where it's possible

* generate files

(cherry picked from commit 91221bc4362e50b9cca6dbff3a8342b2991900d2)

* unit text fix

* [v9.2.x] docs: deleted link to moved content (#62703)

deleted link to moved content

* [v9.2.x] docs: fix broken elasticsearch metrics play link (#62717)

docs: fix broken elasticsearch metrics play link (#62715)

fix broken elastic search play link

(cherry picked from commit 1225e8d6d8a2076f2141065c0ad20b55241d6f25)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix/60084/save and test (#62748)

Fix: Save and test error message does not persist across datasource instance settings anymore

(cherry picked from commit ce50168b70b4444abb5a1aa36d695dc1b7c339b9)

Co-authored-by: Timur Olzhabayev <timur.olzhabayev@grafana.com>

* [v9.2.x] Server: Switch from separate server & cli to a unified grafana binary (#58286) (#62754)

* Server: Switch from separate server & cli to a unified grafana binary (#58286)

* avoid the need for a second bulky binary for grafana-cli

* look for grafana-server in $PATH as well as same directory

* implement unified \"grafana\" command

* update dockerfiles, fix grafana-cli -v

* update packaging to work with single binary

- add wrapper scripts for grafana and grafana-server
- update and sync package files
- implement --sign flag of build package command
- stop packaging scripts folder, they are not useful for end users
- add support for --configOverrides in server command
- remove unused nfpm.yaml config file

* windows support

(cherry picked from commit de99ce139c96e7229bb5e194aed225e3321d8685)

* Build: don't remove grafana-server and grafana-cli binaries from deb and rpm packages (#59890)

* don't remove grafana-server and grafana-cli binaries from /usr/share/grafana/bin in deb and rpm packages

* don't add config overrides in /usr/sbin/grafana-server

(cherry picked from commit 01cba80cbd762a180a18592a82d6e5992c4fb941)

---------

Co-authored-by: Dan Cech <dcech@grafana.com>

* [v9.2.x] MSSQL: Add support for macro function calls (#62887)

MSSQL: Add support for macro function calls (#62742)

* MSSQL: Add support for macro function calls

* Add tests

(cherry picked from commit 9fc3b360a43e9f0295f7366e9ea635a43521b341)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Remove packages path from branch filter (#60946)

Remove packages path from branch filter (#60128)

That directory is no longer used in published docs and causes this
workflow to fail when changes only affect the packages directory.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 1516aa27622ee5dc8d14cc3ebcd07647bf1619bd)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Update publishing workflows to use organization secret (#63043)

Update publishing workflows to use organization secret (#63001)

The new tokens are managed centrally and have a longer expiry.
Administrators of the grafanabot account will be
notified of the pending expiry and the secret can be rotated centrally
without the need for a repository administrator to update their
secrets.

The existing repository secrets can safely be removed. The tokens for
those secrets will be removed by the end of this week.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit ba9bdf3455b24f3d86b425ccd24994b915327c3b)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Server: Fix issue backporting #58286 to v9.2.x in #62754 (#63067)

Fix issue backporting #58286 to v9.2.x in #62754

* [v9.2.x] Remove `gen-jsonnet` make target from `bra.toml` (#63102)

Remove gen-jsonnet from toml

* [v9.2.x] fix broken envelope encryption link (#63141)

fix broken envelope encryption link (#63135)

(cherry picked from commit 72ca7fe7fe30a95e75e558bf83efc4e791e5018e)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix MSSQL queries failing because of bad interpolation (#63170)

Fix MSSQL queries failing because of bad interpolation (#63167)

fix failing mssql queries

(cherry picked from commit 62b078e4e4cad882e9e9a01f36cc8df4aa084eab)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* CI: Backport CI/Release related code to v9.2.x (#63251)

* Cherry pick from 03b1cf7

* Remove publishpackages/go

* Backport enterprise checks

* CI: Allow other modules to register build sub-commands (#62741)

* Allow other modules to register build sub-commands

* CI: Fix retries on artifacts-page clone

* Fix linting errors

* Fix golint issues

* Update to grabpl 3.0.21

(cherry picked from commit 312ea59e6da16c28226042b7cdebf4e660880ed7)

* CI: Remove variants arg from `package` step (#62858)

* Remove variants arg from package step

* Fix starlark lint

* Default to releaseModeConfig.Variants

* Check for empty variants arg

(cherry picked from commit e5c48ac9454a8513d526384751b953ff98d12ecb)

* Remove verify-jsonnet-step

* Revert github.com/grafana/thema bump

* go mod tidy

* Remove publish.star

* Fix lib.star lint

* CI: Running Redis integration tests without grabpl (#63028)

This restores some changes from
https://github.com/grafana/grafana/pull/61920 that were accidentally
deleted.

(cherry picked from commit 2804acd264ff247673f71854d25d79656b7b0775)

* go mod tidy

* Fix clone enterprise for custom events

* Chore: Bump alpine version to `3.17.1` (#63252)

Bump alpine version to 3.17.1

(cherry picked from commit 24c60486f62fd723b3d61718d45e7b9382f74656)

---------

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>
Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2.x] MSSQL Datasource: Revert functions within macros change (#63596)

MSSQL Datasource: Revert functions within macros change (#63592)

* Revert functions within macros change
* Add tests for function and macro for mssql
* Remove macro support tests

---------

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>
(cherry picked from commit 356e2e1933f5e717a0e8f7688ba1b44f7bf9fa01)

Co-authored-by: Kyle Cunningham <codeincarnate@users.noreply.github.com>

* [v9.2.x] docs: fixed headings and link to explore with logs (#63673)

[9.3.x] docs: fixed headings and link to explore with logs (#63670)

fixed headings and link to explore with logs

(cherry picked from commit abfd8792e536ec8096f83f5abb4612fb7312f90b)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Update grafana/saml library (#689)

SAML: update grafana/saml

Co-authored-by: Jo <joao.guerreiro@grafana.com>

Co-authored-by: linoman <2051016+linoman@users.noreply.github.com>
Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#704)

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

(cherry picked from commit dbbe819368f507b9493b7a3cf6e080a5dd752b3e)

* remove added file

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Auth: Update saml go.mod (missing query sig verification) [9.2.x] (#713)

update saml go.mod (missing query sig verification)

(cherry picked from commit 1e1dbd1a06455a451d722856dc619b2a7c78e2c0)

* Release: Bump version to 9.2.11 (#728)

\"Release: Updated versions in package to 9.2.11\"

* [v9.2.x] Geomap: Sanitize the attribution string (#753)

Geomap: Sanitize the attribution string (#745)

* SAML: Update grafana/saml library (#691)

Co-authored-by: jguer <joao.guerreiro@grafana.com>

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

* add sanitize

* Fix frontend build

* Remove unnecessary yarn.lock changes

* Fix formatting

* Re-add yarn.lock message as I guess it is needed

---------

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
Co-authored-by: jguer <joao.guerreiro@grafana.com>
Co-authored-by: nmarrs <nathanielmarrs@gmail.com>
Co-authored-by: Drew Slobodnjak <60050885+drew08t@users.noreply.github.com>
(cherry picked from commit 37b4af7ffacfc24d5f24d190356a9ef32d99aa6f)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] TraceView: Add key and url escaping of json tag values (#760)

* [v9.2.x] Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64115)

Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64108)

* Change docker image used for cross-compilation

* Replace fmt.Println with log.Println

* Add specific tag for docker image

(cherry picked from commit b42fd92fad7c4e826cb6ae9ed360952bbc9a87a9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] build: fix corss build (#63263)

build: fix corss build (#61121)

* build: fix corss build

* fix lint

(cherry picked from commit 37baae3699fcad37dac87a759491ae5db02369df)

Co-authored-by: Jimmie Han <hanjinming@outlook.com>

* [9.2.x] CI: Move some build settings (#64491) (#64517)

Backporting https://github.com/grafana/grafana/pull/64491.

* Move some build settings to Vault

* CI: Remove reference to DOWNSTREAM_REPO as it isn't used

(cherry picked from commit 4b241804b401eed529e41fa775186d8ffe89ea1c)

* [v9.2.x] CI: Add `PrereleaseBucket` field in `versions.go` (#64522)

CI: Add `PrereleaseBucket` field in `versions.go` (#64519)

Add PrereleaseBucket in versions.go

(cherry picked from commit 29b3f3fbf4cd64a59422ac14c58d8fb81f7b17f9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [9.2.x] CI: Do not clone in artifacts-page pipeline (#64663)

This is done in a later step.

* [v9.2.x] Alerting: Fix queries not being previewed in detail view (#64977)

* Alerting: Fix queries not being previewed in detail view (#64198)

(cherry picked from commit 4e81aab60a587b102305a255891986e592a0d1a4)

* Update imports

---------

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>
Co-authored-by: ismail simsek <ismailsimsek09@gmail.com>

* [v9.2.x] Alerting: Fix expression issues in alert rule view and edit pages (#65008)

* Fix rule viewer

* Fix expressions editor and viewer in alerting

* [v9.2.x] Update CODEOWNERship for grafana-delivery team (#64973) (#65020)

Update CODEOWNERship for grafana-delivery team (#64973)

(cherry picked from commit 2897ee37bf9f575eef19bcd35182232f965c6499)

* [v9.2.x] CI: Update `grabpl` to `3.0.30` (#65028) (#65087)

CI: Update `grabpl` to `3.0.30` (#65028)

Update grabpl

(cherry picked from commit 4a80233bedf6e750f0ce43fa9fe1f6eb7ab9f6fa)

* [v9.2.x] NPM: Stop using the folder path before the name path (#65156)

NPM: Stop using the folder path before the name path (#63851)

Stop using the folder path before the name path

(cherry picked from commit 177aa254c563dfe98ffabd2de56330bee960f160)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Fix xss in Graphite functions tooltip (#810)

Fix xss in Graphite functions tooltip (#804)

(cherry picked from commit 87aad3f11836f810ee1fdfee27827e746ef36055)

Co-authored-by: Ludovic Viaud <ludovic.viaud@gmail.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.15 (#65196) (#65200)

Changelog: Updated changelog for 9.2.15 (#65196)

* Changelog: Updated changelog for 9.2.15

* Update CHANGELOG.md

---------

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit a907e042f9cdba3d4c00e89f820bfd9030025af9)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.16 (#65202)

\"Release: Updated versions in package to 9.2.16\"

* [v9.2.x] CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173) (#65193)

CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173)

* Remove fetch-images dependency

* Fix starlark link

(cherry picked from commit d0be9610f0e22a4571a13c2ebf2aaabe281ecf48)

* [v9.2.x] Expressions: More robust expression check (#65231)

* Expressions: More robust expression check (#65006)

More robust expression check

(cherry picked from commit 1328878aceb37da7051c5685375e2ca32ef0a6b4)

* Fix import

* [v9.2.x] CI: Remove `grabpl` dependency from `publish-packages` steps (#65329) (#65331)

CI: Remove `grabpl` dependency from `publish-packages` steps (#65329)

Remove grabpl dependency from publish packages

(cherry picked from commit 3b00d2c273d5b7622b225ae56381879b60a10c2a)

# Conflicts:
#	.drone.yml

* [v9.2.x] CI: Cleanup unnecessary `grabpl` dependencies (#65330) (#65345)

CI: Cleanup unnecessary `grabpl` dependencies (#65330)

* Remove unnecessary grabpl dependencies

* Revert test-frontend change

(cherry picked from commit 89d642e001513c72120aac89be997735717dd174)

# Conflicts:
#	.drone.yml

* [v9.2.x] CI: Allow overwriting of existing GitHub release assets (#65457)

CI: Allow overwriting of existing GitHub release assets (#65127)

* CI: Allow overwriting of existing GitHub release assets

This closes #63698

* Use c for *cli.Context in publishgithub.go

(cherry picked from commit 4ab3bd6f7e8bff7719c6c8756bfd8a86126a8616)

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2] docs: fix alias and broken link (#65483)

fixed alias and broken link

* [v9.2.x] configure HTTPS documentation  (#65558)

configure HTTPS documentation  (#65271)

* configure HTTPS settings for grafana

* Apply suggestions from code review

* Apply suggestions from code review

* rewrites and restructures content

* Apply suggestions from code review

* PR feedback review; https docs

* Update docs/sources/setup-grafana/set-up-https.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/set-up-https.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/set-up-ht…")[#673](https://github.com/percona/grafana/pull/673)[)](/percona/grafana/commit/7ff49f34a3998067fa1ea480c07e0c74939ea306 "PMM-12254 Grafana 9.2.20 (#673)

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* \"Release: Updated versions in package to 9.2.5\" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying \"General\" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

\"Release: Updated versions in package to 9.2.6\"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

\"Release: Updated versions in package to 9.2.7\"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

\"Release: Updated versions in package to 9.2.8\"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation \"stealing\" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

\"Release: Updated versions in package to 9.2.11\"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v9.2.x] QueryEditorRow: Fixes issue loading query editor when data source variable selected (#62179)

QueryEditorRow: Fixes issue loading query editor when data source variable selected (#61927)

* QueryEditorRow: Fixes issue loading query editor when data source variable selected

* Fix func name

* Removed wait

* restore waiting for with better check

* restore waiting for with better check

(cherry picked from commit 9f7ddf1f0b5234a1fd82e1f92d1444f81a794e45)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* [v9.2.x] update gpg secret names (#62250)

update gpg secret names

* [v9.2.x] Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62205)

Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62193)

* fix: capture both ErrInvalidAPIKey

* rename of variable

(cherry picked from commit c5cb5be3cc078cc99b0324ae0db429646e0603ad)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Login: Fix panic when UpsertUser is called without ReqContext (#62574)

* Login: Fix panic when UpsertUser is called without ReqContext (#62539)

(cherry picked from commit b1151dd118f2a1c305a6f757661e42e59cf145c1)
(cherry picked from commit 679cc18648295053a6ab9b764b85cd68f773f81b)

* [v9.2.x] Tempo: Fix span name being dropped from the query (#62591)

Tempo: Fix span name being dropped from the query (#62257)
(cherry picked from commit c3b476e1dcb310e1d3b425f058264ed5be00d1d8)
Co-authored-by: Hamas Shafiq <hamas.shafiq@grafana.com>

* [v9.2.x] Expressions: Fixes the issue showing expressions editor (#62626)

* Expressions: Fixes the issue showing expressions editor (#62510)

* Use suggested value for uid

* update the snapshot

* use __expr__

* replace all -100 with __expr__

* update snapshot

* more changes

* revert redundant change

* Use expr.DatasourceUID where it's possible

* generate files

(cherry picked from commit 91221bc4362e50b9cca6dbff3a8342b2991900d2)

* unit text fix

* [v9.2.x] docs: deleted link to moved content (#62703)

deleted link to moved content

* [v9.2.x] docs: fix broken elasticsearch metrics play link (#62717)

docs: fix broken elasticsearch metrics play link (#62715)

fix broken elastic search play link

(cherry picked from commit 1225e8d6d8a2076f2141065c0ad20b55241d6f25)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix/60084/save and test (#62748)

Fix: Save and test error message does not persist across datasource instance settings anymore

(cherry picked from commit ce50168b70b4444abb5a1aa36d695dc1b7c339b9)

Co-authored-by: Timur Olzhabayev <timur.olzhabayev@grafana.com>

* [v9.2.x] Server: Switch from separate server & cli to a unified grafana binary (#58286) (#62754)

* Server: Switch from separate server & cli to a unified grafana binary (#58286)

* avoid the need for a second bulky binary for grafana-cli

* look for grafana-server in $PATH as well as same directory

* implement unified \"grafana\" command

* update dockerfiles, fix grafana-cli -v

* update packaging to work with single binary

- add wrapper scripts for grafana and grafana-server
- update and sync package files
- implement --sign flag of build package command
- stop packaging scripts folder, they are not useful for end users
- add support for --configOverrides in server command
- remove unused nfpm.yaml config file

* windows support

(cherry picked from commit de99ce139c96e7229bb5e194aed225e3321d8685)

* Build: don't remove grafana-server and grafana-cli binaries from deb and rpm packages (#59890)

* don't remove grafana-server and grafana-cli binaries from /usr/share/grafana/bin in deb and rpm packages

* don't add config overrides in /usr/sbin/grafana-server

(cherry picked from commit 01cba80cbd762a180a18592a82d6e5992c4fb941)

---------

Co-authored-by: Dan Cech <dcech@grafana.com>

* [v9.2.x] MSSQL: Add support for macro function calls (#62887)

MSSQL: Add support for macro function calls (#62742)

* MSSQL: Add support for macro function calls

* Add tests

(cherry picked from commit 9fc3b360a43e9f0295f7366e9ea635a43521b341)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Remove packages path from branch filter (#60946)

Remove packages path from branch filter (#60128)

That directory is no longer used in published docs and causes this
workflow to fail when changes only affect the packages directory.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 1516aa27622ee5dc8d14cc3ebcd07647bf1619bd)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Update publishing workflows to use organization secret (#63043)

Update publishing workflows to use organization secret (#63001)

The new tokens are managed centrally and have a longer expiry.
Administrators of the grafanabot account will be
notified of the pending expiry and the secret can be rotated centrally
without the need for a repository administrator to update their
secrets.

The existing repository secrets can safely be removed. The tokens for
those secrets will be removed by the end of this week.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit ba9bdf3455b24f3d86b425ccd24994b915327c3b)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Server: Fix issue backporting #58286 to v9.2.x in #62754 (#63067)

Fix issue backporting #58286 to v9.2.x in #62754

* [v9.2.x] Remove `gen-jsonnet` make target from `bra.toml` (#63102)

Remove gen-jsonnet from toml

* [v9.2.x] fix broken envelope encryption link (#63141)

fix broken envelope encryption link (#63135)

(cherry picked from commit 72ca7fe7fe30a95e75e558bf83efc4e791e5018e)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix MSSQL queries failing because of bad interpolation (#63170)

Fix MSSQL queries failing because of bad interpolation (#63167)

fix failing mssql queries

(cherry picked from commit 62b078e4e4cad882e9e9a01f36cc8df4aa084eab)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* CI: Backport CI/Release related code to v9.2.x (#63251)

* Cherry pick from 03b1cf7

* Remove publishpackages/go

* Backport enterprise checks

* CI: Allow other modules to register build sub-commands (#62741)

* Allow other modules to register build sub-commands

* CI: Fix retries on artifacts-page clone

* Fix linting errors

* Fix golint issues

* Update to grabpl 3.0.21

(cherry picked from commit 312ea59e6da16c28226042b7cdebf4e660880ed7)

* CI: Remove variants arg from `package` step (#62858)

* Remove variants arg from package step

* Fix starlark lint

* Default to releaseModeConfig.Variants

* Check for empty variants arg

(cherry picked from commit e5c48ac9454a8513d526384751b953ff98d12ecb)

* Remove verify-jsonnet-step

* Revert github.com/grafana/thema bump

* go mod tidy

* Remove publish.star

* Fix lib.star lint

* CI: Running Redis integration tests without grabpl (#63028)

This restores some changes from
https://github.com/grafana/grafana/pull/61920 that were accidentally
deleted.

(cherry picked from commit 2804acd264ff247673f71854d25d79656b7b0775)

* go mod tidy

* Fix clone enterprise for custom events

* Chore: Bump alpine version to `3.17.1` (#63252)

Bump alpine version to 3.17.1

(cherry picked from commit 24c60486f62fd723b3d61718d45e7b9382f74656)

---------

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>
Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2.x] MSSQL Datasource: Revert functions within macros change (#63596)

MSSQL Datasource: Revert functions within macros change (#63592)

* Revert functions within macros change
* Add tests for function and macro for mssql
* Remove macro support tests

---------

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>
(cherry picked from commit 356e2e1933f5e717a0e8f7688ba1b44f7bf9fa01)

Co-authored-by: Kyle Cunningham <codeincarnate@users.noreply.github.com>

* [v9.2.x] docs: fixed headings and link to explore with logs (#63673)

[9.3.x] docs: fixed headings and link to explore with logs (#63670)

fixed headings and link to explore with logs

(cherry picked from commit abfd8792e536ec8096f83f5abb4612fb7312f90b)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Update grafana/saml library (#689)

SAML: update grafana/saml

Co-authored-by: Jo <joao.guerreiro@grafana.com>

Co-authored-by: linoman <2051016+linoman@users.noreply.github.com>
Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#704)

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

(cherry picked from commit dbbe819368f507b9493b7a3cf6e080a5dd752b3e)

* remove added file

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Auth: Update saml go.mod (missing query sig verification) [9.2.x] (#713)

update saml go.mod (missing query sig verification)

(cherry picked from commit 1e1dbd1a06455a451d722856dc619b2a7c78e2c0)

* Release: Bump version to 9.2.11 (#728)

\"Release: Updated versions in package to 9.2.11\"

* [v9.2.x] Geomap: Sanitize the attribution string (#753)

Geomap: Sanitize the attribution string (#745)

* SAML: Update grafana/saml library (#691)

Co-authored-by: jguer <joao.guerreiro@grafana.com>

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

* add sanitize

* Fix frontend build

* Remove unnecessary yarn.lock changes

* Fix formatting

* Re-add yarn.lock message as I guess it is needed

---------

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
Co-authored-by: jguer <joao.guerreiro@grafana.com>
Co-authored-by: nmarrs <nathanielmarrs@gmail.com>
Co-authored-by: Drew Slobodnjak <60050885+drew08t@users.noreply.github.com>
(cherry picked from commit 37b4af7ffacfc24d5f24d190356a9ef32d99aa6f)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] TraceView: Add key and url escaping of json tag values (#760)

* [v9.2.x] Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64115)

Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64108)

* Change docker image used for cross-compilation

* Replace fmt.Println with log.Println

* Add specific tag for docker image

(cherry picked from commit b42fd92fad7c4e826cb6ae9ed360952bbc9a87a9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] build: fix corss build (#63263)

build: fix corss build (#61121)

* build: fix corss build

* fix lint

(cherry picked from commit 37baae3699fcad37dac87a759491ae5db02369df)

Co-authored-by: Jimmie Han <hanjinming@outlook.com>

* [9.2.x] CI: Move some build settings (#64491) (#64517)

Backporting https://github.com/grafana/grafana/pull/64491.

* Move some build settings to Vault

* CI: Remove reference to DOWNSTREAM_REPO as it isn't used

(cherry picked from commit 4b241804b401eed529e41fa775186d8ffe89ea1c)

* [v9.2.x] CI: Add `PrereleaseBucket` field in `versions.go` (#64522)

CI: Add `PrereleaseBucket` field in `versions.go` (#64519)

Add PrereleaseBucket in versions.go

(cherry picked from commit 29b3f3fbf4cd64a59422ac14c58d8fb81f7b17f9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [9.2.x] CI: Do not clone in artifacts-page pipeline (#64663)

This is done in a later step.

* [v9.2.x] Alerting: Fix queries not being previewed in detail view (#64977)

* Alerting: Fix queries not being previewed in detail view (#64198)

(cherry picked from commit 4e81aab60a587b102305a255891986e592a0d1a4)

* Update imports

---------

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>
Co-authored-by: ismail simsek <ismailsimsek09@gmail.com>

* [v9.2.x] Alerting: Fix expression issues in alert rule view and edit pages (#65008)

* Fix rule viewer

* Fix expressions editor and viewer in alerting

* [v9.2.x] Update CODEOWNERship for grafana-delivery team (#64973) (#65020)

Update CODEOWNERship for grafana-delivery team (#64973)

(cherry picked from commit 2897ee37bf9f575eef19bcd35182232f965c6499)

* [v9.2.x] CI: Update `grabpl` to `3.0.30` (#65028) (#65087)

CI: Update `grabpl` to `3.0.30` (#65028)

Update grabpl

(cherry picked from commit 4a80233bedf6e750f0ce43fa9fe1f6eb7ab9f6fa)

* [v9.2.x] NPM: Stop using the folder path before the name path (#65156)

NPM: Stop using the folder path before the name path (#63851)

Stop using the folder path before the name path

(cherry picked from commit 177aa254c563dfe98ffabd2de56330bee960f160)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Fix xss in Graphite functions tooltip (#810)

Fix xss in Graphite functions tooltip (#804)

(cherry picked from commit 87aad3f11836f810ee1fdfee27827e746ef36055)

Co-authored-by: Ludovic Viaud <ludovic.viaud@gmail.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.15 (#65196) (#65200)

Changelog: Updated changelog for 9.2.15 (#65196)

* Changelog: Updated changelog for 9.2.15

* Update CHANGELOG.md

---------

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit a907e042f9cdba3d4c00e89f820bfd9030025af9)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.16 (#65202)

\"Release: Updated versions in package to 9.2.16\"

* [v9.2.x] CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173) (#65193)

CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173)

* Remove fetch-images dependency

* Fix starlark link

(cherry picked from commit d0be9610f0e22a4571a13c2ebf2aaabe281ecf48)

* [v9.2.x] Expressions: More robust expression check (#65231)

* Expressions: More robust expression check (#65006)

More robust expression check

(cherry picked from commit 1328878aceb37da7051c5685375e2ca32ef0a6b4)

* Fix import

* [v9.2.x] CI: Remove `grabpl` dependency from `publish-packages` steps (#65329) (#65331)

CI: Remove `grabpl` dependency from `publish-packages` steps (#65329)

Remove grabpl dependency from publish packages

(cherry picked from commit 3b00d2c273d5b7622b225ae56381879b60a10c2a)

# Conflicts:
#	.drone.yml

* [v9.2.x] CI: Cleanup unnecessary `grabpl` dependencies (#65330) (#65345)

CI: Cleanup unnecessary `grabpl` dependencies (#65330)

* Remove unnecessary grabpl dependencies

* Revert test-frontend change

(cherry picked from commit 89d642e001513c72120aac89be997735717dd174)

# Conflicts:
#	.drone.yml

* [v9.2.x] CI: Allow overwriting of existing GitHub release assets (#65457)

CI: Allow overwriting of existing GitHub release assets (#65127)

* CI: Allow overwriting of existing GitHub release assets

This closes #63698

* Use c for *cli.Context in publishgithub.go

(cherry picked from commit 4ab3bd6f7e8bff7719c6c8756bfd8a86126a8616)

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2] docs: fix alias and broken link (#65483)

fixed alias and broken link

* [v9.2.x] configure HTTPS documentation  (#65558)

configure HTTPS documentation  (#65271)

* configure HTTPS settings for grafana

* Apply suggestions from code review

* Apply suggestions from code review

* rewrites and restructures content

* Apply suggestions from code review

* PR feedback review; https docs

* Update docs/sources/setup-grafana/set-up-https.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/set-up-https.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/set-up-ht…")`
…

`[7ff49f3](/percona/grafana/commit/7ff49f34a3998067fa1ea480c07e0c74939ea306)`

```
* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* "Release: Updated versions in package to 9.2.5" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying "General" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

"Release: Updated versions in package to 9.2.6"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

"Release: Updated versions in package to 9.2.7"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

"Release: Updated versions in package to 9.2.8"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation "stealing" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

"Release: Updated versions in package to 9.2.11"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v9.2.x] QueryEditorRow: Fixes issue loading query editor when data source variable selected (#62179)

QueryEditorRow: Fixes issue loading query editor when data source variable selected (#61927)

* QueryEditorRow: Fixes issue loading query editor when data source variable selected

* Fix func name

* Removed wait

* restore waiting for with better check

* restore waiting for with better check

(cherry picked from commit 9f7ddf1f0b5234a1fd82e1f92d1444f81a794e45)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* [v9.2.x] update gpg secret names (#62250)

update gpg secret names

* [v9.2.x] Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62205)

Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62193)

* fix: capture both ErrInvalidAPIKey

* rename of variable

(cherry picked from commit c5cb5be3cc078cc99b0324ae0db429646e0603ad)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Login: Fix panic when UpsertUser is called without ReqContext (#62574)

* Login: Fix panic when UpsertUser is called without ReqContext (#62539)

(cherry picked from commit b1151dd118f2a1c305a6f757661e42e59cf145c1)
(cherry picked from commit 679cc18648295053a6ab9b764b85cd68f773f81b)

* [v9.2.x] Tempo: Fix span name being dropped from the query (#62591)

Tempo: Fix span name being dropped from the query (#62257)
(cherry picked from commit c3b476e1dcb310e1d3b425f058264ed5be00d1d8)
Co-authored-by: Hamas Shafiq <hamas.shafiq@grafana.com>

* [v9.2.x] Expressions: Fixes the issue showing expressions editor (#62626)

* Expressions: Fixes the issue showing expressions editor (#62510)

* Use suggested value for uid

* update the snapshot

* use __expr__

* replace all -100 with __expr__

* update snapshot

* more changes

* revert redundant change

* Use expr.DatasourceUID where it's possible

* generate files

(cherry picked from commit 91221bc4362e50b9cca6dbff3a8342b2991900d2)

* unit text fix

* [v9.2.x] docs: deleted link to moved content (#62703)

deleted link to moved content

* [v9.2.x] docs: fix broken elasticsearch metrics play link (#62717)

docs: fix broken elasticsearch metrics play link (#62715)

fix broken elastic search play link

(cherry picked from commit 1225e8d6d8a2076f2141065c0ad20b55241d6f25)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix/60084/save and test (#62748)

Fix: Save and test error message does not persist across datasource instance settings anymore

(cherry picked from commit ce50168b70b4444abb5a1aa36d695dc1b7c339b9)

Co-authored-by: Timur Olzhabayev <timur.olzhabayev@grafana.com>

* [v9.2.x] Server: Switch from separate server & cli to a unified grafana binary (#58286) (#62754)

* Server: Switch from separate server & cli to a unified grafana binary (#58286)

* avoid the need for a second bulky binary for grafana-cli

* look for grafana-server in $PATH as well as same directory

* implement unified "grafana" command

* update dockerfiles, fix grafana-cli -v

* update packaging to work with single binary

- add wrapper scripts for grafana and grafana-server
- update and sync package files
- implement --sign flag of build package command
- stop packaging scripts folder, they are not useful for end users
- add support for --configOverrides in server command
- remove unused nfpm.yaml config file

* windows support

(cherry picked from commit de99ce139c96e7229bb5e194aed225e3321d8685)

* Build: don't remove grafana-server and grafana-cli binaries from deb and rpm packages (#59890)

* don't remove grafana-server and grafana-cli binaries from /usr/share/grafana/bin in deb and rpm packages

* don't add config overrides in /usr/sbin/grafana-server

(cherry picked from commit 01cba80cbd762a180a18592a82d6e5992c4fb941)

---------

Co-authored-by: Dan Cech <dcech@grafana.com>

* [v9.2.x] MSSQL: Add support for macro function calls (#62887)

MSSQL: Add support for macro function calls (#62742)

* MSSQL: Add support for macro function calls

* Add tests

(cherry picked from commit 9fc3b360a43e9f0295f7366e9ea635a43521b341)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Remove packages path from branch filter (#60946)

Remove packages path from branch filter (#60128)

That directory is no longer used in published docs and causes this
workflow to fail when changes only affect the packages directory.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 1516aa27622ee5dc8d14cc3ebcd07647bf1619bd)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Update publishing workflows to use organization secret (#63043)

Update publishing workflows to use organization secret (#63001)

The new tokens are managed centrally and have a longer expiry.
Administrators of the grafanabot account will be
notified of the pending expiry and the secret can be rotated centrally
without the need for a repository administrator to update their
secrets.

The existing repository secrets can safely be removed. The tokens for
those secrets will be removed by the end of this week.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit ba9bdf3455b24f3d86b425ccd24994b915327c3b)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Server: Fix issue backporting #58286 to v9.2.x in #62754 (#63067)

Fix issue backporting #58286 to v9.2.x in #62754

* [v9.2.x] Remove `gen-jsonnet` make target from `bra.toml` (#63102)

Remove gen-jsonnet from toml

* [v9.2.x] fix broken envelope encryption link (#63141)

fix broken envelope encryption link (#63135)

(cherry picked from commit 72ca7fe7fe30a95e75e558bf83efc4e791e5018e)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix MSSQL queries failing because of bad interpolation (#63170)

Fix MSSQL queries failing because of bad interpolation (#63167)

fix failing mssql queries

(cherry picked from commit 62b078e4e4cad882e9e9a01f36cc8df4aa084eab)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* CI: Backport CI/Release related code to v9.2.x (#63251)

* Cherry pick from 03b1cf7

* Remove publishpackages/go

* Backport enterprise checks

* CI: Allow other modules to register build sub-commands (#62741)

* Allow other modules to register build sub-commands

* CI: Fix retries on artifacts-page clone

* Fix linting errors

* Fix golint issues

* Update to grabpl 3.0.21

(cherry picked from commit 312ea59e6da16c28226042b7cdebf4e660880ed7)

* CI: Remove variants arg from `package` step (#62858)

* Remove variants arg from package step

* Fix starlark lint

* Default to releaseModeConfig.Variants

* Check for empty variants arg

(cherry picked from commit e5c48ac9454a8513d526384751b953ff98d12ecb)

* Remove verify-jsonnet-step

* Revert github.com/grafana/thema bump

* go mod tidy

* Remove publish.star

* Fix lib.star lint

* CI: Running Redis integration tests without grabpl (#63028)

This restores some changes from
https://github.com/grafana/grafana/pull/61920 that were accidentally
deleted.

(cherry picked from commit 2804acd264ff247673f71854d25d79656b7b0775)

* go mod tidy

* Fix clone enterprise for custom events

* Chore: Bump alpine version to `3.17.1` (#63252)

Bump alpine version to 3.17.1

(cherry picked from commit 24c60486f62fd723b3d61718d45e7b9382f74656)

---------

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>
Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2.x] MSSQL Datasource: Revert functions within macros change (#63596)

MSSQL Datasource: Revert functions within macros change (#63592)

* Revert functions within macros change
* Add tests for function and macro for mssql
* Remove macro support tests

---------

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>
(cherry picked from commit 356e2e1933f5e717a0e8f7688ba1b44f7bf9fa01)

Co-authored-by: Kyle Cunningham <codeincarnate@users.noreply.github.com>

* [v9.2.x] docs: fixed headings and link to explore with logs (#63673)

[9.3.x] docs: fixed headings and link to explore with logs (#63670)

fixed headings and link to explore with logs

(cherry picked from commit abfd8792e536ec8096f83f5abb4612fb7312f90b)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Update grafana/saml library (#689)

SAML: update grafana/saml

Co-authored-by: Jo <joao.guerreiro@grafana.com>

Co-authored-by: linoman <2051016+linoman@users.noreply.github.com>
Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#704)

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

(cherry picked from commit dbbe819368f507b9493b7a3cf6e080a5dd752b3e)

* remove added file

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Auth: Update saml go.mod (missing query sig verification) [9.2.x] (#713)

update saml go.mod (missing query sig verification)

(cherry picked from commit 1e1dbd1a06455a451d722856dc619b2a7c78e2c0)

* Release: Bump version to 9.2.11 (#728)

"Release: Updated versions in package to 9.2.11"

* [v9.2.x] Geomap: Sanitize the attribution string (#753)

Geomap: Sanitize the attribution string (#745)

* SAML: Update grafana/saml library (#691)

Co-authored-by: jguer <joao.guerreiro@grafana.com>

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

* add sanitize

* Fix frontend build

* Remove unnecessary yarn.lock changes

* Fix formatting

* Re-add yarn.lock message as I guess it is needed

---------

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
Co-authored-by: jguer <joao.guerreiro@grafana.com>
Co-authored-by: nmarrs <nathanielmarrs@gmail.com>
Co-authored-by: Drew Slobodnjak <60050885+drew08t@users.noreply.github.com>
(cherry picked from commit 37b4af7ffacfc24d5f24d190356a9ef32d99aa6f)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] TraceView: Add key and url escaping of json tag values (#760)

* [v9.2.x] Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64115)

Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64108)

* Change docker image used for cross-compilation

* Replace fmt.Println with log.Println

* Add specific tag for docker image

(cherry picked from commit b42fd92fad7c4e826cb6ae9ed360952bbc9a87a9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] build: fix corss build (#63263)

build: fix corss build (#61121)

* build: fix corss build

* fix lint

(cherry picked from commit 37baae3699fcad37dac87a759491ae5db02369df)

Co-authored-by: Jimmie Han <hanjinming@outlook.com>

* [9.2.x] CI: Move some build settings (#64491) (#64517)

Backporting https://github.com/grafana/grafana/pull/64491.

* Move some build settings to Vault

* CI: Remove reference to DOWNSTREAM_REPO as it isn't used

(cherry picked from commit 4b241804b401eed529e41fa775186d8ffe89ea1c)

* [v9.2.x] CI: Add `PrereleaseBucket` field in `versions.go` (#64522)

CI: Add `PrereleaseBucket` field in `versions.go` (#64519)

Add PrereleaseBucket in versions.go

(cherry picked from commit 29b3f3fbf4cd64a59422ac14c58d8fb81f7b17f9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [9.2.x] CI: Do not clone in artifacts-page pipeline (#64663)

This is done in a later step.

* [v9.2.x] Alerting: Fix queries not being previewed in detail view (#64977)

* Alerting: Fix queries not being previewed in detail view (#64198)

(cherry picked from commit 4e81aab60a587b102305a255891986e592a0d1a4)

* Update imports

---------

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>
Co-authored-by: ismail simsek <ismailsimsek09@gmail.com>

* [v9.2.x] Alerting: Fix expression issues in alert rule view and edit pages (#65008)

* Fix rule viewer

* Fix expressions editor and viewer in alerting

* [v9.2.x] Update CODEOWNERship for grafana-delivery team (#64973) (#65020)

Update CODEOWNERship for grafana-delivery team (#64973)

(cherry picked from commit 2897ee37bf9f575eef19bcd35182232f965c6499)

* [v9.2.x] CI: Update `grabpl` to `3.0.30` (#65028) (#65087)

CI: Update `grabpl` to `3.0.30` (#65028)

Update grabpl

(cherry picked from commit 4a80233bedf6e750f0ce43fa9fe1f6eb7ab9f6fa)

* [v9.2.x] NPM: Stop using the folder path before the name path (#65156)

NPM: Stop using the folder path before the name path (#63851)

Stop using the folder path before the name path

(cherry picked from commit 177aa254c563dfe98ffabd2de56330bee960f160)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Fix xss in Graphite functions tooltip (#810)

Fix xss in Graphite functions tooltip (#804)

(cherry picked from commit 87aad3f11836f810ee1fdfee27827e746ef36055)

Co-authored-by: Ludovic Viaud <ludovic.viaud@gmail.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.15 (#65196) (#65200)

Changelog: Updated changelog for 9.2.15 (#65196)

* Changelog: Updated changelog for 9.2.15

* Update CHANGELOG.md

---------

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit a907e042f9cdba3d4c00e89f820bfd9030025af9)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.16 (#65202)

"Release: Updated versions in package to 9.2.16"

* [v9.2.x] CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173) (#65193)

CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173)

* Remove fetch-images dependency

* Fix starlark link

(cherry picked from commit d0be9610f0e22a4571a13c2ebf2aaabe281ecf48)

* [v9.2.x] Expressions: More robust expression check (#65231)

* Expressions: More robust expression check (#65006)

More robust expression check

(cherry picked from commit 1328878aceb37da7051c5685375e2ca32ef0a6b4)

* Fix import

* [v9.2.x] CI: Remove `grabpl` dependency from `publish-packages` steps (#65329) (#65331)

CI: Remove `grabpl` dependency from `publish-packages` steps (#65329)

Remove grabpl dependency from publish packages

(cherry picked from commit 3b00d2c273d5b7622b225ae56381879b60a10c2a)

# Conflicts:
#	.drone.yml

* [v9.2.x] CI: Cleanup unnecessary `grabpl` dependencies (#65330) (#65345)

CI: Cleanup unnecessary `grabpl` dependencies (#65330)

* Remove unnecessary grabpl dependencies

* Revert test-frontend change

(cherry picked from commit 89d642e001513c72120aac89be997735717dd174)

# Conflicts:
#	.drone.yml

* [v9.2.x] CI: Allow overwriting of existing GitHub release assets (#65457)

CI: Allow overwriting of existing GitHub release assets (#65127)

* CI: Allow overwriting of existing GitHub release assets

This closes #63698

* Use c for *cli.Context in publishgithub.go

(cherry picked from commit 4ab3bd6f7e8bff7719c6c8756bfd8a86126a8616)

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2] docs: fix alias and broken link (#65483)

fixed alias and broken link

* [v9.2.x] configure HTTPS documentation  (#65558)

configure HTTPS documentation  (#65271)

* configure HTTPS settings for grafana

* Apply suggestions from code review

* Apply suggestions from code review

* rewrites and restructures content

* Apply suggestions from code review

* PR feedback review; https docs

* Update docs/sources/setup-grafana/set-up-https.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/set-up-https.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/set-up-ht…
```

[matejkubinec](/matejkubinec)
added a commit
to percona/grafana
that referenced
this pull request
[Jun 29, 2023](#ref-commit-87ca316)
[![@matejkubinec](https://avatars.githubusercontent.com/u/32638572?s=40&u=f15b1e5f63d6faa5145a40e4164e0fa9ea72fff7&v=4)](/matejkubinec) [![@eleijonmarck](https://avatars.githubusercontent.com/u/7727602?s=40&u=4f4984c270ed39839e9b8dff600287396939ac2b&v=4)](/eleijonmarck)
[![@ryantxu](https://avatars.githubusercontent.com/u/705951?s=40&u=45875989d2adfe87f95caa12e32e5a82b08898f8&v=4)](/ryantxu) [![@grafanabot](https://avatars.githubusercontent.com/u/43478413?s=40&u=a7be21af02d82dcfe4d68822d6add1dc78b445b1&v=4)](/grafanabot) [![@mdvictor](https://avatars.githubusercontent.com/u/36818606?s=40&u=ce9025a7a04ae6e1a483480620fbc96442c74e43&v=4)](/mdvictor) [![@oscarkilhed](https://avatars.githubusercontent.com/u/468940?s=40&u=cdfbb52c148b5da116460f3ea9126cb5b5569e54&v=4)](/oscarkilhed) [![@joshhunt](https://avatars.githubusercontent.com/u/46142?s=40&u=5bf6f4243ee4ab8d8a99c3c210af343fdc625798&v=4)](/joshhunt) [![@andresmgot](https://avatars.githubusercontent.com/u/4025665?s=40&u=6d474b97f4f73c53f4609e6921afdabc407c6dbb&v=4)](/andresmgot) [![@dessen-xu](https://avatars.githubusercontent.com/u/41524013?s=40&u=01884d79b94696e284a35c8b681bf29434ef1a36&v=4)](/dessen-xu) [![@gtk-grafana](https://avatars.githubusercontent.com/u/109082771?s=40&u=bbd7b28097ca89a03816a1dabae2fcb1189b174e&v=4)](/gtk-grafana) [![@sakjur](https://avatars.githubusercontent.com/u/298945?s=40&u=f59488eb9b9031b02ae9f24116f8d5ac7d0071f8&v=4)](/sakjur) [![@siiimooon](https://avatars.githubusercontent.com/u/85333972?s=40&u=bc3afa1dea6abfb33d7f3e626099df5bc77955ad&v=4)](/siiimooon) [![@zoltanbedi](https://avatars.githubusercontent.com/u/13729989?s=40&u=6b2d0104259543f280a6b8ea1cccaba2c59e87d5&v=4)](/zoltanbedi) [![@grobinson-grafana](https://avatars.githubusercontent.com/u/85952834?s=40&v=4)](/grobinson-grafana) [![@neel1996](https://avatars.githubusercontent.com/u/47709856?s=40&u=d02474c07146b62f73c082ba2d9e312909bbf5cc&v=4)](/neel1996) [![@dsotirakis](https://avatars.githubusercontent.com/u/15115078?s=40&u=2637caf13fe96ac43d1680b369e8cfdb8732ddf1&v=4)](/dsotirakis) [![@marefr](https://avatars.githubusercontent.com/u/1668778?s=40&v=4)](/marefr) [![@chri2547](https://avatars.githubusercontent.com/u/35463610?s=40&u=97f7cf99392dddf4ffdc83bbbce761efd6f40332&v=4)](/chri2547) [![@wjordan](https://avatars.githubusercontent.com/u/56541?s=40&v=4)](/wjordan) [![@sd2k](https://avatars.githubusercontent.com/u/5464991?s=40&u=debba4e86c2176c3afc994fa3eb8ba9ddb7e6d53&v=4)](/sd2k) [![@julienduchesne](https://avatars.githubusercontent.com/u/29210090?s=40&u=d64510d5f3d87110355ed5c2e12d07d216b13c3b&v=4)](/julienduchesne) [![@DanCech](https://avatars.githubusercontent.com/u/1443603?s=40&u=563883eed1a53cbd19c35742c3a3ee1b2ddfb0ac&v=4)](/DanCech) [![@asimpson](https://avatars.githubusercontent.com/u/1048831?s=40&u=d49ee317b1a2d379515b5e59c03fce5b70009faa&v=4)](/asimpson) [![@joeblubaugh](https://avatars.githubusercontent.com/u/1951900?s=40&u=1f1faee9254bfaa1e686540a726bbd9ff1cf6e71&v=4)](/joeblubaugh) [![@xiyu95](https://avatars.githubusercontent.com/u/112968312?s=40&u=ea78ebf8294c6ddaab752aaa136a3f1ac943bfd3&v=4)](/xiyu95) [![@wbrowne](https://avatars.githubusercontent.com/u/1173299?s=40&u=07b5baceef0bdc39ee7f967f39c9c82afb4a81d2&v=4)](/wbrowne) [![@gwdawson](https://avatars.githubusercontent.com/u/34524710?s=40&u=7ea8832f2f2e29b4805d75b3bba2411344593189&v=4)](/gwdawson) [![@ashharrison90](https://avatars.githubusercontent.com/u/20999846?s=40&u=e6c1c42a3025abfa1c1d579691b5541df490cf73&v=4)](/ashharrison90) [![@xnyo](https://avatars.githubusercontent.com/u/16373015?s=40&u=1dc1b8caf479abe3feaa070c01b1400c3a62b448&v=4)](/xnyo) [![@nmarrs](https://avatars.githubusercontent.com/u/22381771?s=40&u=ccb32ecdc60cfb1698f45febb3b0bbce6038dc13&v=4)](/nmarrs) [![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&u=2ad1707722037d52822bb34d39bb72a1a7d7f91d&v=4)](/axelavargas) [![@joey-grafana](https://avatars.githubusercontent.com/u/90795735?s=40&u=16b1cfc381a83ca938f6d096935f0e747b3691fb&v=4)](/joey-grafana) [![@tolzhabayev](https://avatars.githubusercontent.com/u/580672?s=40&u=cf4a1f5bdba6e8ecfe23dc9fa22069e5431498f8&v=4)](/tolzhabayev) [![@itsmylife](https://avatars.githubusercontent.com/u/820946?s=40&u=5a928c48831b349c7da1b0022636df01ce0f1ced&v=4)](/itsmylife) [![@kalleep](https://avatars.githubusercontent.com/u/23356117?s=40&v=4)](/kalleep) [![@jackw](https://avatars.githubusercontent.com/u/73201?s=40&u=9fb7fc975368a6fae3be8676b46cfc9ad06c7b15&v=4)](/jackw) [![@gguillotte-grafana](https://avatars.githubusercontent.com/u/100453168?s=40&u=3d0bf8114b33430d58934de11387ccd510f3a0e5&v=4)](/gguillotte-grafana) [![@phongvq](https://avatars.githubusercontent.com/u/20754136?s=40&u=30cff65424186e5ff97e24894b5935ae17fd73c2&v=4)](/phongvq) [![@daniellee](https://avatars.githubusercontent.com/u/434655?s=40&u=0625e6874dbde9488a0cd6bc2d3a94c665337551&v=4)](/daniellee) [![@Jguer](https://avatars.githubusercontent.com/u/8071073?s=40&u=31dcf861785552275aea3a89860b081ed114ee1f&v=4)](/Jguer) [![@mgyongyosi](https://avatars.githubusercontent.com/u/1585112?s=40&u=bedfa00ab0788c2bfe8411a8218f7bb9a446cc67&v=4)](/mgyongyosi) [![@malcolmholmes](https://avatars.githubusercontent.com/u/42545407?s=40&v=4)](/malcolmholmes) [![@kaydelaney](https://avatars.githubusercontent.com/u/45561153?s=40&u=136490e13ee468c88746b8dc89a1772cbbf4ae73&v=4)](/kaydelaney) [![@jdbaldry](https://avatars.githubusercontent.com/u/4599384?s=40&v=4)](/jdbaldry) [![@kylebrandt](https://avatars.githubusercontent.com/u/1692624?s=40&u=f03edc41ac5f244ccf8afbaf591a2c2d5bf9422b&v=4)](/kylebrandt) [![@zuchka](https://avatars.githubusercontent.com/u/37156449?s=40&u=7227f6489882e5cf0856219349f19ac1ddbd2a11&v=4)](/zuchka) [![@leandro-deveikis](https://avatars.githubusercontent.com/u/34773040?s=40&u=0c0813698b625812c84deccbe3e4727f5104a28a&v=4)](/leandro-deveikis) [![@leeoniya](https://avatars.githubusercontent.com/u/43234?s=40&u=49f10c1db35f1a4f328346b597cc763f695bb29d&v=4)](/leeoniya) [![@bartpeeters](https://avatars.githubusercontent.com/u/29534282?s=40&v=4)](/bartpeeters) [![@svennergr](https://avatars.githubusercontent.com/u/8092184?s=40&u=733ce9f1c399468005886bdfa2ce242d758348f0&v=4)](/svennergr) [![@yvigara](https://avatars.githubusercontent.com/u/704600?s=40&u=127c2e201ae7c012f5e801e624af426aaf059b1c&v=4)](/yvigara) [![@owensmallwood](https://avatars.githubusercontent.com/u/20195316?s=40&u=0381407162d812492507256b2e90d3ace502b045&v=4)](/owensmallwood) [![@IevaVasiljeva](https://avatars.githubusercontent.com/u/9482349?s=40&u=6bf34051e6e76a6e014cb56085fd8671f8a32f16&v=4)](/IevaVasiljeva) [![@lpskdl](https://avatars.githubusercontent.com/u/108552997?s=40&u=4b1d5afda8817ac8fa0c3f379fbc21f05339f682&v=4)](/lpskdl) [![@gamab](https://avatars.githubusercontent.com/u/5232696?s=40&u=6c5fef30916541609539c960841a8f9230a2fd6f&v=4)](/gamab) [![@aangelisc](https://avatars.githubusercontent.com/u/15019026?s=40&u=3540a1f3f4e09019aaa10a927ca4ca1a8b1caa51&v=4)](/aangelisc) [![@zserge](https://avatars.githubusercontent.com/u/1911760?s=40&u=d54bceb88fc5adc736476c5625bc96eed3725de0&v=4)](/zserge) [![@bergquist](https://avatars.githubusercontent.com/u/618863?s=40&u=3e138dc82d635ddf0c5c82e6463edb81b2205a74&v=4)](/bergquist) [![@iwysiu](https://avatars.githubusercontent.com/u/5421859?s=40&v=4)](/iwysiu) [![@bohandley](https://avatars.githubusercontent.com/u/25674746?s=40&u=5db785e20acac583c2c70f95579eed8acda76034&v=4)](/bohandley) [![@Eve832](https://avatars.githubusercontent.com/u/81647476?s=40&u=171081136377053e2d0a04a2d1f5e21270066d50&v=4)](/Eve832) [![@JacobsonMT](https://avatars.githubusercontent.com/u/8484471?s=40&u=30df9eec2de8834a517222b6f477bbf30598b98c&v=4)](/JacobsonMT) [![@robbymilo](https://avatars.githubusercontent.com/u/8106669?s=40&u=b5929162f75a8e3e5dca80dcfe543e46ff5985aa&v=4)](/robbymilo) [![@academo](https://avatars.githubusercontent.com/u/227916?s=40&u=2d66242d42fb2751b3a9b966ef1d433be978e4dc&v=4)](/academo) [![@adela-almasan](https://avatars.githubusercontent.com/u/88068998?s=40&u=8c681fb7664266c333858b055907df9d31b705ac&v=4)](/adela-almasan) [![@ktw4071](https://avatars.githubusercontent.com/u/10269640?s=40&v=4)](/ktw4071) [![@linoman](https://avatars.githubusercontent.com/u/2051016?s=40&u=85065225ade2a54d017c39fa976bcee1d79de5c9&v=4)](/linoman) [![@mckn](https://avatars.githubusercontent.com/u/172951?s=40&v=4)](/mckn) [![@leventebalogh](https://avatars.githubusercontent.com/u/9974811?s=40&u=7e1691a3b32d0f3adbe905e8863a6be9cde6461f&v=4)](/leventebalogh) [![@ArturWierzbicki](https://avatars.githubusercontent.com/u/23451458?s=40&u=1f9adee1a1f94b4c245b838df05d6662400cea34&v=4)](/ArturWierzbicki) [![@xlson](https://avatars.githubusercontent.com/u/114937?s=40&u=d3cfffe519c44bd3938c5f7297f4b880ada09bbe&v=4)](/xlson) [![@kminehart](https://avatars.githubusercontent.com/u/5140827?s=40&u=6a9f121b3b6daf545a3b29dda06a0f7f62e2db7d&v=4)](/kminehart) [![@usmangt](https://avatars.githubusercontent.com/u/69509548?s=40&u=2072d0b29b8514dfa1ded27606bd014f7edc020a&v=4)](/usmangt) [![@zerok](https://avatars.githubusercontent.com/u/3782?s=40&v=4)](/zerok) [![@torkelo](https://avatars.githubusercontent.com/u/10999?s=40&u=00ee9b9643b8eafd5df664bad66f196ff32bd9ed&v=4)](/torkelo) [![@imatwawana](https://avatars.githubusercontent.com/u/76437239?s=40&u=6dd696d8dde9fd57f5a423f3a81cf99a82d9a5cf&v=4)](/imatwawana) [![@codeincarnate](https://avatars.githubusercontent.com/u/199847?s=40&u=133d1e683542a7ec4b44a74c617962e777eba96e&v=4)](/codeincarnate) [![@aocenas](https://avatars.githubusercontent.com/u/1014802?s=40&u=a934e3470e711b2ed875899d43d9f887ee88b5a7&v=4)](/aocenas) [![@hanjm](https://avatars.githubusercontent.com/u/7621241?s=40&u=e4f8c804e65d58a3013730cce3912492500318b4&v=4)](/hanjm) [![@gillesdemey](https://avatars.githubusercontent.com/u/868844?s=40&u=d34da4534900c5e729ae25d01ef03d75361486f8&v=4)](/gillesdemey) [![@LudoVio](https://avatars.githubusercontent.com/u/9373203?s=40&u=783fc1a2dc9f527f5193be010d60ae8e1895396f&v=4)](/LudoVio) [![@moxious](https://avatars.githubusercontent.com/u/5471710?s=40&u=939b7c0acdedee2e16ac23d7ab12bec6bf817514&v=4)](/moxious) [![@sarah-spang](https://avatars.githubusercontent.com/u/86264026?s=40&v=4)](/sarah-spang) [![@mallettjared](https://avatars.githubusercontent.com/u/110853992?s=40&v=4)](/mallettjared) [![@JohnnyQQQQ](https://avatars.githubusercontent.com/u/3528218?s=40&u=bfac25193e2be1abeb959f5ee988ca975366fdb6&v=4)](/JohnnyQQQQ) [![@christineywang](https://avatars.githubusercontent.com/u/19804181?s=40&u=5e7deb2350518c47c0289117d0c6b2bdfb12673f&v=4)](/christineywang) [![@annelaurefroment](https://avatars.githubusercontent.com/u/49911675?s=40&v=4)](/annelaurefroment) [![@guicaulada](https://avatars.githubusercontent.com/u/7741292?s=40&u=296253fb9be05eafd88b65e2615a6c7fd8aa063e&v=4)](/guicaulada) [![@yuri-tceretian](https://avatars.githubusercontent.com/u/25988953?s=40&u=0329c4a260742982e188e4deab712da310866bbe&v=4)](/yuri-tceretian) [![@brendamuir](https://avatars.githubusercontent.com/u/100768211?s=40&v=4)](/brendamuir) [![@oneoneonepig](https://avatars.githubusercontent.com/u/13197632?s=40&u=351ccac28593c4fb7ba64afd64f660626fdf8cbe&v=4)](/oneoneonepig) [![@papagian](https://avatars.githubusercontent.com/u/1632407?s=40&u=07f720ffa380d8ec4a349e83db63cf921b1f2ad9&v=4)](/papagian)

`[PMM-12254](https://jira.percona.com/browse/PMM-12254) [Grafana 9.2.20 (](/percona/grafana/commit/87ca3167d2d7497a10fd34554da8692765636f20 "PMM-12254 Grafana 9.2.20 (#673)

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* \"Release: Updated versions in package to 9.2.5\" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying \"General\" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

\"Release: Updated versions in package to 9.2.6\"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

\"Release: Updated versions in package to 9.2.7\"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

\"Release: Updated versions in package to 9.2.8\"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation \"stealing\" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

\"Release: Updated versions in package to 9.2.11\"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v9.2.x] QueryEditorRow: Fixes issue loading query editor when data source variable selected (#62179)

QueryEditorRow: Fixes issue loading query editor when data source variable selected (#61927)

* QueryEditorRow: Fixes issue loading query editor when data source variable selected

* Fix func name

* Removed wait

* restore waiting for with better check

* restore waiting for with better check

(cherry picked from commit 9f7ddf1f0b5234a1fd82e1f92d1444f81a794e45)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* [v9.2.x] update gpg secret names (#62250)

update gpg secret names

* [v9.2.x] Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62205)

Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62193)

* fix: capture both ErrInvalidAPIKey

* rename of variable

(cherry picked from commit c5cb5be3cc078cc99b0324ae0db429646e0603ad)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Login: Fix panic when UpsertUser is called without ReqContext (#62574)

* Login: Fix panic when UpsertUser is called without ReqContext (#62539)

(cherry picked from commit b1151dd118f2a1c305a6f757661e42e59cf145c1)
(cherry picked from commit 679cc18648295053a6ab9b764b85cd68f773f81b)

* [v9.2.x] Tempo: Fix span name being dropped from the query (#62591)

Tempo: Fix span name being dropped from the query (#62257)
(cherry picked from commit c3b476e1dcb310e1d3b425f058264ed5be00d1d8)
Co-authored-by: Hamas Shafiq <hamas.shafiq@grafana.com>

* [v9.2.x] Expressions: Fixes the issue showing expressions editor (#62626)

* Expressions: Fixes the issue showing expressions editor (#62510)

* Use suggested value for uid

* update the snapshot

* use __expr__

* replace all -100 with __expr__

* update snapshot

* more changes

* revert redundant change

* Use expr.DatasourceUID where it's possible

* generate files

(cherry picked from commit 91221bc4362e50b9cca6dbff3a8342b2991900d2)

* unit text fix

* [v9.2.x] docs: deleted link to moved content (#62703)

deleted link to moved content

* [v9.2.x] docs: fix broken elasticsearch metrics play link (#62717)

docs: fix broken elasticsearch metrics play link (#62715)

fix broken elastic search play link

(cherry picked from commit 1225e8d6d8a2076f2141065c0ad20b55241d6f25)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix/60084/save and test (#62748)

Fix: Save and test error message does not persist across datasource instance settings anymore

(cherry picked from commit ce50168b70b4444abb5a1aa36d695dc1b7c339b9)

Co-authored-by: Timur Olzhabayev <timur.olzhabayev@grafana.com>

* [v9.2.x] Server: Switch from separate server & cli to a unified grafana binary (#58286) (#62754)

* Server: Switch from separate server & cli to a unified grafana binary (#58286)

* avoid the need for a second bulky binary for grafana-cli

* look for grafana-server in $PATH as well as same directory

* implement unified \"grafana\" command

* update dockerfiles, fix grafana-cli -v

* update packaging to work with single binary

- add wrapper scripts for grafana and grafana-server
- update and sync package files
- implement --sign flag of build package command
- stop packaging scripts folder, they are not useful for end users
- add support for --configOverrides in server command
- remove unused nfpm.yaml config file

* windows support

(cherry picked from commit de99ce139c96e7229bb5e194aed225e3321d8685)

* Build: don't remove grafana-server and grafana-cli binaries from deb and rpm packages (#59890)

* don't remove grafana-server and grafana-cli binaries from /usr/share/grafana/bin in deb and rpm packages

* don't add config overrides in /usr/sbin/grafana-server

(cherry picked from commit 01cba80cbd762a180a18592a82d6e5992c4fb941)

---------

Co-authored-by: Dan Cech <dcech@grafana.com>

* [v9.2.x] MSSQL: Add support for macro function calls (#62887)

MSSQL: Add support for macro function calls (#62742)

* MSSQL: Add support for macro function calls

* Add tests

(cherry picked from commit 9fc3b360a43e9f0295f7366e9ea635a43521b341)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Remove packages path from branch filter (#60946)

Remove packages path from branch filter (#60128)

That directory is no longer used in published docs and causes this
workflow to fail when changes only affect the packages directory.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 1516aa27622ee5dc8d14cc3ebcd07647bf1619bd)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Update publishing workflows to use organization secret (#63043)

Update publishing workflows to use organization secret (#63001)

The new tokens are managed centrally and have a longer expiry.
Administrators of the grafanabot account will be
notified of the pending expiry and the secret can be rotated centrally
without the need for a repository administrator to update their
secrets.

The existing repository secrets can safely be removed. The tokens for
those secrets will be removed by the end of this week.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit ba9bdf3455b24f3d86b425ccd24994b915327c3b)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Server: Fix issue backporting #58286 to v9.2.x in #62754 (#63067)

Fix issue backporting #58286 to v9.2.x in #62754

* [v9.2.x] Remove `gen-jsonnet` make target from `bra.toml` (#63102)

Remove gen-jsonnet from toml

* [v9.2.x] fix broken envelope encryption link (#63141)

fix broken envelope encryption link (#63135)

(cherry picked from commit 72ca7fe7fe30a95e75e558bf83efc4e791e5018e)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix MSSQL queries failing because of bad interpolation (#63170)

Fix MSSQL queries failing because of bad interpolation (#63167)

fix failing mssql queries

(cherry picked from commit 62b078e4e4cad882e9e9a01f36cc8df4aa084eab)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* CI: Backport CI/Release related code to v9.2.x (#63251)

* Cherry pick from 03b1cf7

* Remove publishpackages/go

* Backport enterprise checks

* CI: Allow other modules to register build sub-commands (#62741)

* Allow other modules to register build sub-commands

* CI: Fix retries on artifacts-page clone

* Fix linting errors

* Fix golint issues

* Update to grabpl 3.0.21

(cherry picked from commit 312ea59e6da16c28226042b7cdebf4e660880ed7)

* CI: Remove variants arg from `package` step (#62858)

* Remove variants arg from package step

* Fix starlark lint

* Default to releaseModeConfig.Variants

* Check for empty variants arg

(cherry picked from commit e5c48ac9454a8513d526384751b953ff98d12ecb)

* Remove verify-jsonnet-step

* Revert github.com/grafana/thema bump

* go mod tidy

* Remove publish.star

* Fix lib.star lint

* CI: Running Redis integration tests without grabpl (#63028)

This restores some changes from
https://github.com/grafana/grafana/pull/61920 that were accidentally
deleted.

(cherry picked from commit 2804acd264ff247673f71854d25d79656b7b0775)

* go mod tidy

* Fix clone enterprise for custom events

* Chore: Bump alpine version to `3.17.1` (#63252)

Bump alpine version to 3.17.1

(cherry picked from commit 24c60486f62fd723b3d61718d45e7b9382f74656)

---------

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>
Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2.x] MSSQL Datasource: Revert functions within macros change (#63596)

MSSQL Datasource: Revert functions within macros change (#63592)

* Revert functions within macros change
* Add tests for function and macro for mssql
* Remove macro support tests

---------

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>
(cherry picked from commit 356e2e1933f5e717a0e8f7688ba1b44f7bf9fa01)

Co-authored-by: Kyle Cunningham <codeincarnate@users.noreply.github.com>

* [v9.2.x] docs: fixed headings and link to explore with logs (#63673)

[9.3.x] docs: fixed headings and link to explore with logs (#63670)

fixed headings and link to explore with logs

(cherry picked from commit abfd8792e536ec8096f83f5abb4612fb7312f90b)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Update grafana/saml library (#689)

SAML: update grafana/saml

Co-authored-by: Jo <joao.guerreiro@grafana.com>

Co-authored-by: linoman <2051016+linoman@users.noreply.github.com>
Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#704)

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

(cherry picked from commit dbbe819368f507b9493b7a3cf6e080a5dd752b3e)

* remove added file

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Auth: Update saml go.mod (missing query sig verification) [9.2.x] (#713)

update saml go.mod (missing query sig verification)

(cherry picked from commit 1e1dbd1a06455a451d722856dc619b2a7c78e2c0)

* Release: Bump version to 9.2.11 (#728)

\"Release: Updated versions in package to 9.2.11\"

* [v9.2.x] Geomap: Sanitize the attribution string (#753)

Geomap: Sanitize the attribution string (#745)

* SAML: Update grafana/saml library (#691)

Co-authored-by: jguer <joao.guerreiro@grafana.com>

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

* add sanitize

* Fix frontend build

* Remove unnecessary yarn.lock changes

* Fix formatting

* Re-add yarn.lock message as I guess it is needed

---------

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
Co-authored-by: jguer <joao.guerreiro@grafana.com>
Co-authored-by: nmarrs <nathanielmarrs@gmail.com>
Co-authored-by: Drew Slobodnjak <60050885+drew08t@users.noreply.github.com>
(cherry picked from commit 37b4af7ffacfc24d5f24d190356a9ef32d99aa6f)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] TraceView: Add key and url escaping of json tag values (#760)

* [v9.2.x] Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64115)

Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64108)

* Change docker image used for cross-compilation

* Replace fmt.Println with log.Println

* Add specific tag for docker image

(cherry picked from commit b42fd92fad7c4e826cb6ae9ed360952bbc9a87a9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] build: fix corss build (#63263)

build: fix corss build (#61121)

* build: fix corss build

* fix lint

(cherry picked from commit 37baae3699fcad37dac87a759491ae5db02369df)

Co-authored-by: Jimmie Han <hanjinming@outlook.com>

* [9.2.x] CI: Move some build settings (#64491) (#64517)

Backporting https://github.com/grafana/grafana/pull/64491.

* Move some build settings to Vault

* CI: Remove reference to DOWNSTREAM_REPO as it isn't used

(cherry picked from commit 4b241804b401eed529e41fa775186d8ffe89ea1c)

* [v9.2.x] CI: Add `PrereleaseBucket` field in `versions.go` (#64522)

CI: Add `PrereleaseBucket` field in `versions.go` (#64519)

Add PrereleaseBucket in versions.go

(cherry picked from commit 29b3f3fbf4cd64a59422ac14c58d8fb81f7b17f9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [9.2.x] CI: Do not clone in artifacts-page pipeline (#64663)

This is done in a later step.

* [v9.2.x] Alerting: Fix queries not being previewed in detail view (#64977)

* Alerting: Fix queries not being previewed in detail view (#64198)

(cherry picked from commit 4e81aab60a587b102305a255891986e592a0d1a4)

* Update imports

---------

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>
Co-authored-by: ismail simsek <ismailsimsek09@gmail.com>

* [v9.2.x] Alerting: Fix expression issues in alert rule view and edit pages (#65008)

* Fix rule viewer

* Fix expressions editor and viewer in alerting

* [v9.2.x] Update CODEOWNERship for grafana-delivery team (#64973) (#65020)

Update CODEOWNERship for grafana-delivery team (#64973)

(cherry picked from commit 2897ee37bf9f575eef19bcd35182232f965c6499)

* [v9.2.x] CI: Update `grabpl` to `3.0.30` (#65028) (#65087)

CI: Update `grabpl` to `3.0.30` (#65028)

Update grabpl

(cherry picked from commit 4a80233bedf6e750f0ce43fa9fe1f6eb7ab9f6fa)

* [v9.2.x] NPM: Stop using the folder path before the name path (#65156)

NPM: Stop using the folder path before the name path (#63851)

Stop using the folder path before the name path

(cherry picked from commit 177aa254c563dfe98ffabd2de56330bee960f160)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Fix xss in Graphite functions tooltip (#810)

Fix xss in Graphite functions tooltip (#804)

(cherry picked from commit 87aad3f11836f810ee1fdfee27827e746ef36055)

Co-authored-by: Ludovic Viaud <ludovic.viaud@gmail.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.15 (#65196) (#65200)

Changelog: Updated changelog for 9.2.15 (#65196)

* Changelog: Updated changelog for 9.2.15

* Update CHANGELOG.md

---------

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit a907e042f9cdba3d4c00e89f820bfd9030025af9)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.16 (#65202)

\"Release: Updated versions in package to 9.2.16\"

* [v9.2.x] CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173) (#65193)

CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173)

* Remove fetch-images dependency

* Fix starlark link

(cherry picked from commit d0be9610f0e22a4571a13c2ebf2aaabe281ecf48)

* [v9.2.x] Expressions: More robust expression check (#65231)

* Expressions: More robust expression check (#65006)

More robust expression check

(cherry picked from commit 1328878aceb37da7051c5685375e2ca32ef0a6b4)

* Fix import

* [v9.2.x] CI: Remove `grabpl` dependency from `publish-packages` steps (#65329) (#65331)

CI: Remove `grabpl` dependency from `publish-packages` steps (#65329)

Remove grabpl dependency from publish packages

(cherry picked from commit 3b00d2c273d5b7622b225ae56381879b60a10c2a)

# Conflicts:
#	.drone.yml

* [v9.2.x] CI: Cleanup unnecessary `grabpl` dependencies (#65330) (#65345)

CI: Cleanup unnecessary `grabpl` dependencies (#65330)

* Remove unnecessary grabpl dependencies

* Revert test-frontend change

(cherry picked from commit 89d642e001513c72120aac89be997735717dd174)

# Conflicts:
#	.drone.yml

* [v9.2.x] CI: Allow overwriting of existing GitHub release assets (#65457)

CI: Allow overwriting of existing GitHub release assets (#65127)

* CI: Allow overwriting of existing GitHub release assets

This closes #63698

* Use c for *cli.Context in publishgithub.go

(cherry picked from commit 4ab3bd6f7e8bff7719c6c8756bfd8a86126a8616)

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2] docs: fix alias and broken link (#65483)

fixed alias and broken link

* [v9.2.x] configure HTTPS documentation  (#65558)

configure HTTPS documentation  (#65271)

* configure HTTPS settings for grafana

* Apply suggestions from code review

* Apply suggestions from code review

* rewrites and restructures content

* Apply suggestions from code review

* PR feedback review; https docs

* Update docs/sources/setup-grafana/set-up-https.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/set-up-https.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/set-up-ht…")[#673](https://github.com/percona/grafana/pull/673)[)](/percona/grafana/commit/87ca3167d2d7497a10fd34554da8692765636f20 "PMM-12254 Grafana 9.2.20 (#673)

* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* \"Release: Updated versions in package to 9.2.5\" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying \"General\" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

\"Release: Updated versions in package to 9.2.6\"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

\"Release: Updated versions in package to 9.2.7\"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

\"Release: Updated versions in package to 9.2.8\"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation \"stealing\" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

\"Release: Updated versions in package to 9.2.11\"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v9.2.x] QueryEditorRow: Fixes issue loading query editor when data source variable selected (#62179)

QueryEditorRow: Fixes issue loading query editor when data source variable selected (#61927)

* QueryEditorRow: Fixes issue loading query editor when data source variable selected

* Fix func name

* Removed wait

* restore waiting for with better check

* restore waiting for with better check

(cherry picked from commit 9f7ddf1f0b5234a1fd82e1f92d1444f81a794e45)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* [v9.2.x] update gpg secret names (#62250)

update gpg secret names

* [v9.2.x] Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62205)

Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62193)

* fix: capture both ErrInvalidAPIKey

* rename of variable

(cherry picked from commit c5cb5be3cc078cc99b0324ae0db429646e0603ad)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Login: Fix panic when UpsertUser is called without ReqContext (#62574)

* Login: Fix panic when UpsertUser is called without ReqContext (#62539)

(cherry picked from commit b1151dd118f2a1c305a6f757661e42e59cf145c1)
(cherry picked from commit 679cc18648295053a6ab9b764b85cd68f773f81b)

* [v9.2.x] Tempo: Fix span name being dropped from the query (#62591)

Tempo: Fix span name being dropped from the query (#62257)
(cherry picked from commit c3b476e1dcb310e1d3b425f058264ed5be00d1d8)
Co-authored-by: Hamas Shafiq <hamas.shafiq@grafana.com>

* [v9.2.x] Expressions: Fixes the issue showing expressions editor (#62626)

* Expressions: Fixes the issue showing expressions editor (#62510)

* Use suggested value for uid

* update the snapshot

* use __expr__

* replace all -100 with __expr__

* update snapshot

* more changes

* revert redundant change

* Use expr.DatasourceUID where it's possible

* generate files

(cherry picked from commit 91221bc4362e50b9cca6dbff3a8342b2991900d2)

* unit text fix

* [v9.2.x] docs: deleted link to moved content (#62703)

deleted link to moved content

* [v9.2.x] docs: fix broken elasticsearch metrics play link (#62717)

docs: fix broken elasticsearch metrics play link (#62715)

fix broken elastic search play link

(cherry picked from commit 1225e8d6d8a2076f2141065c0ad20b55241d6f25)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix/60084/save and test (#62748)

Fix: Save and test error message does not persist across datasource instance settings anymore

(cherry picked from commit ce50168b70b4444abb5a1aa36d695dc1b7c339b9)

Co-authored-by: Timur Olzhabayev <timur.olzhabayev@grafana.com>

* [v9.2.x] Server: Switch from separate server & cli to a unified grafana binary (#58286) (#62754)

* Server: Switch from separate server & cli to a unified grafana binary (#58286)

* avoid the need for a second bulky binary for grafana-cli

* look for grafana-server in $PATH as well as same directory

* implement unified \"grafana\" command

* update dockerfiles, fix grafana-cli -v

* update packaging to work with single binary

- add wrapper scripts for grafana and grafana-server
- update and sync package files
- implement --sign flag of build package command
- stop packaging scripts folder, they are not useful for end users
- add support for --configOverrides in server command
- remove unused nfpm.yaml config file

* windows support

(cherry picked from commit de99ce139c96e7229bb5e194aed225e3321d8685)

* Build: don't remove grafana-server and grafana-cli binaries from deb and rpm packages (#59890)

* don't remove grafana-server and grafana-cli binaries from /usr/share/grafana/bin in deb and rpm packages

* don't add config overrides in /usr/sbin/grafana-server

(cherry picked from commit 01cba80cbd762a180a18592a82d6e5992c4fb941)

---------

Co-authored-by: Dan Cech <dcech@grafana.com>

* [v9.2.x] MSSQL: Add support for macro function calls (#62887)

MSSQL: Add support for macro function calls (#62742)

* MSSQL: Add support for macro function calls

* Add tests

(cherry picked from commit 9fc3b360a43e9f0295f7366e9ea635a43521b341)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Remove packages path from branch filter (#60946)

Remove packages path from branch filter (#60128)

That directory is no longer used in published docs and causes this
workflow to fail when changes only affect the packages directory.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 1516aa27622ee5dc8d14cc3ebcd07647bf1619bd)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Update publishing workflows to use organization secret (#63043)

Update publishing workflows to use organization secret (#63001)

The new tokens are managed centrally and have a longer expiry.
Administrators of the grafanabot account will be
notified of the pending expiry and the secret can be rotated centrally
without the need for a repository administrator to update their
secrets.

The existing repository secrets can safely be removed. The tokens for
those secrets will be removed by the end of this week.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit ba9bdf3455b24f3d86b425ccd24994b915327c3b)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Server: Fix issue backporting #58286 to v9.2.x in #62754 (#63067)

Fix issue backporting #58286 to v9.2.x in #62754

* [v9.2.x] Remove `gen-jsonnet` make target from `bra.toml` (#63102)

Remove gen-jsonnet from toml

* [v9.2.x] fix broken envelope encryption link (#63141)

fix broken envelope encryption link (#63135)

(cherry picked from commit 72ca7fe7fe30a95e75e558bf83efc4e791e5018e)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix MSSQL queries failing because of bad interpolation (#63170)

Fix MSSQL queries failing because of bad interpolation (#63167)

fix failing mssql queries

(cherry picked from commit 62b078e4e4cad882e9e9a01f36cc8df4aa084eab)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* CI: Backport CI/Release related code to v9.2.x (#63251)

* Cherry pick from 03b1cf7

* Remove publishpackages/go

* Backport enterprise checks

* CI: Allow other modules to register build sub-commands (#62741)

* Allow other modules to register build sub-commands

* CI: Fix retries on artifacts-page clone

* Fix linting errors

* Fix golint issues

* Update to grabpl 3.0.21

(cherry picked from commit 312ea59e6da16c28226042b7cdebf4e660880ed7)

* CI: Remove variants arg from `package` step (#62858)

* Remove variants arg from package step

* Fix starlark lint

* Default to releaseModeConfig.Variants

* Check for empty variants arg

(cherry picked from commit e5c48ac9454a8513d526384751b953ff98d12ecb)

* Remove verify-jsonnet-step

* Revert github.com/grafana/thema bump

* go mod tidy

* Remove publish.star

* Fix lib.star lint

* CI: Running Redis integration tests without grabpl (#63028)

This restores some changes from
https://github.com/grafana/grafana/pull/61920 that were accidentally
deleted.

(cherry picked from commit 2804acd264ff247673f71854d25d79656b7b0775)

* go mod tidy

* Fix clone enterprise for custom events

* Chore: Bump alpine version to `3.17.1` (#63252)

Bump alpine version to 3.17.1

(cherry picked from commit 24c60486f62fd723b3d61718d45e7b9382f74656)

---------

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>
Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2.x] MSSQL Datasource: Revert functions within macros change (#63596)

MSSQL Datasource: Revert functions within macros change (#63592)

* Revert functions within macros change
* Add tests for function and macro for mssql
* Remove macro support tests

---------

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>
(cherry picked from commit 356e2e1933f5e717a0e8f7688ba1b44f7bf9fa01)

Co-authored-by: Kyle Cunningham <codeincarnate@users.noreply.github.com>

* [v9.2.x] docs: fixed headings and link to explore with logs (#63673)

[9.3.x] docs: fixed headings and link to explore with logs (#63670)

fixed headings and link to explore with logs

(cherry picked from commit abfd8792e536ec8096f83f5abb4612fb7312f90b)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Update grafana/saml library (#689)

SAML: update grafana/saml

Co-authored-by: Jo <joao.guerreiro@grafana.com>

Co-authored-by: linoman <2051016+linoman@users.noreply.github.com>
Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#704)

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

(cherry picked from commit dbbe819368f507b9493b7a3cf6e080a5dd752b3e)

* remove added file

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Auth: Update saml go.mod (missing query sig verification) [9.2.x] (#713)

update saml go.mod (missing query sig verification)

(cherry picked from commit 1e1dbd1a06455a451d722856dc619b2a7c78e2c0)

* Release: Bump version to 9.2.11 (#728)

\"Release: Updated versions in package to 9.2.11\"

* [v9.2.x] Geomap: Sanitize the attribution string (#753)

Geomap: Sanitize the attribution string (#745)

* SAML: Update grafana/saml library (#691)

Co-authored-by: jguer <joao.guerreiro@grafana.com>

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

* add sanitize

* Fix frontend build

* Remove unnecessary yarn.lock changes

* Fix formatting

* Re-add yarn.lock message as I guess it is needed

---------

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
Co-authored-by: jguer <joao.guerreiro@grafana.com>
Co-authored-by: nmarrs <nathanielmarrs@gmail.com>
Co-authored-by: Drew Slobodnjak <60050885+drew08t@users.noreply.github.com>
(cherry picked from commit 37b4af7ffacfc24d5f24d190356a9ef32d99aa6f)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] TraceView: Add key and url escaping of json tag values (#760)

* [v9.2.x] Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64115)

Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64108)

* Change docker image used for cross-compilation

* Replace fmt.Println with log.Println

* Add specific tag for docker image

(cherry picked from commit b42fd92fad7c4e826cb6ae9ed360952bbc9a87a9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] build: fix corss build (#63263)

build: fix corss build (#61121)

* build: fix corss build

* fix lint

(cherry picked from commit 37baae3699fcad37dac87a759491ae5db02369df)

Co-authored-by: Jimmie Han <hanjinming@outlook.com>

* [9.2.x] CI: Move some build settings (#64491) (#64517)

Backporting https://github.com/grafana/grafana/pull/64491.

* Move some build settings to Vault

* CI: Remove reference to DOWNSTREAM_REPO as it isn't used

(cherry picked from commit 4b241804b401eed529e41fa775186d8ffe89ea1c)

* [v9.2.x] CI: Add `PrereleaseBucket` field in `versions.go` (#64522)

CI: Add `PrereleaseBucket` field in `versions.go` (#64519)

Add PrereleaseBucket in versions.go

(cherry picked from commit 29b3f3fbf4cd64a59422ac14c58d8fb81f7b17f9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [9.2.x] CI: Do not clone in artifacts-page pipeline (#64663)

This is done in a later step.

* [v9.2.x] Alerting: Fix queries not being previewed in detail view (#64977)

* Alerting: Fix queries not being previewed in detail view (#64198)

(cherry picked from commit 4e81aab60a587b102305a255891986e592a0d1a4)

* Update imports

---------

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>
Co-authored-by: ismail simsek <ismailsimsek09@gmail.com>

* [v9.2.x] Alerting: Fix expression issues in alert rule view and edit pages (#65008)

* Fix rule viewer

* Fix expressions editor and viewer in alerting

* [v9.2.x] Update CODEOWNERship for grafana-delivery team (#64973) (#65020)

Update CODEOWNERship for grafana-delivery team (#64973)

(cherry picked from commit 2897ee37bf9f575eef19bcd35182232f965c6499)

* [v9.2.x] CI: Update `grabpl` to `3.0.30` (#65028) (#65087)

CI: Update `grabpl` to `3.0.30` (#65028)

Update grabpl

(cherry picked from commit 4a80233bedf6e750f0ce43fa9fe1f6eb7ab9f6fa)

* [v9.2.x] NPM: Stop using the folder path before the name path (#65156)

NPM: Stop using the folder path before the name path (#63851)

Stop using the folder path before the name path

(cherry picked from commit 177aa254c563dfe98ffabd2de56330bee960f160)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Fix xss in Graphite functions tooltip (#810)

Fix xss in Graphite functions tooltip (#804)

(cherry picked from commit 87aad3f11836f810ee1fdfee27827e746ef36055)

Co-authored-by: Ludovic Viaud <ludovic.viaud@gmail.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.15 (#65196) (#65200)

Changelog: Updated changelog for 9.2.15 (#65196)

* Changelog: Updated changelog for 9.2.15

* Update CHANGELOG.md

---------

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit a907e042f9cdba3d4c00e89f820bfd9030025af9)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.16 (#65202)

\"Release: Updated versions in package to 9.2.16\"

* [v9.2.x] CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173) (#65193)

CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173)

* Remove fetch-images dependency

* Fix starlark link

(cherry picked from commit d0be9610f0e22a4571a13c2ebf2aaabe281ecf48)

* [v9.2.x] Expressions: More robust expression check (#65231)

* Expressions: More robust expression check (#65006)

More robust expression check

(cherry picked from commit 1328878aceb37da7051c5685375e2ca32ef0a6b4)

* Fix import

* [v9.2.x] CI: Remove `grabpl` dependency from `publish-packages` steps (#65329) (#65331)

CI: Remove `grabpl` dependency from `publish-packages` steps (#65329)

Remove grabpl dependency from publish packages

(cherry picked from commit 3b00d2c273d5b7622b225ae56381879b60a10c2a)

# Conflicts:
#	.drone.yml

* [v9.2.x] CI: Cleanup unnecessary `grabpl` dependencies (#65330) (#65345)

CI: Cleanup unnecessary `grabpl` dependencies (#65330)

* Remove unnecessary grabpl dependencies

* Revert test-frontend change

(cherry picked from commit 89d642e001513c72120aac89be997735717dd174)

# Conflicts:
#	.drone.yml

* [v9.2.x] CI: Allow overwriting of existing GitHub release assets (#65457)

CI: Allow overwriting of existing GitHub release assets (#65127)

* CI: Allow overwriting of existing GitHub release assets

This closes #63698

* Use c for *cli.Context in publishgithub.go

(cherry picked from commit 4ab3bd6f7e8bff7719c6c8756bfd8a86126a8616)

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2] docs: fix alias and broken link (#65483)

fixed alias and broken link

* [v9.2.x] configure HTTPS documentation  (#65558)

configure HTTPS documentation  (#65271)

* configure HTTPS settings for grafana

* Apply suggestions from code review

* Apply suggestions from code review

* rewrites and restructures content

* Apply suggestions from code review

* PR feedback review; https docs

* Update docs/sources/setup-grafana/set-up-https.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/set-up-https.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/set-up-ht…")`
…

`[87ca316](/percona/grafana/commit/87ca3167d2d7497a10fd34554da8692765636f20)`

```
* merge complete (#58272)

* followup fix for backport (#58273)

* merge complete (#58274)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Timeseries: Fix null pointer when matching fill below to field (#58030) (#58298)

* Fix timeseries fill below to error

* wip

* modifications

* add tests for fillBelowTo option

(cherry picked from commit d673c8809b64237690b192d25bb6fefd177ae33d)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* MySQL: make it possible to add CA cert without using tlsAuth (#58226) (#58308)

(cherry picked from commit b1bfae035022d6cedd89014744073e89741e4738)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* Auth: Check for OrgUsersAdd on frontend to display pending invites (#58217) (#58225)

(cherry picked from commit 9ff2765bb9e7938c88f2333647a6210589a06535)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* Chore: Disable dashboard-time-zone e2e tests (#58320) (#58323)

(cherry picked from commit d4e3d47f563de34cd09372e048943a8698861d59)

Co-authored-by: Josh Hunt <joshhunt@users.noreply.github.com>

* @grafana/e2e: Fix addPanel for small screen size (#57398) (#58314)

(cherry picked from commit d001a1b035bdbbaae384cdaf3d69f9ebfd5193a0)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* Toolkit: Fix Webpack less-loader config (#57950) (#58175)

(cherry picked from commit b799be3052247f6d3da2a10ab18474dcb0705a5d)

Co-authored-by: dessen-xu <1805680163@qq.com>

* fix thanos semver string (#58335) (#58344)

(cherry picked from commit 6bc8ec0f9bbcdc48e6865e8318eb7fb8de7068ab)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Chore: Upgrade Go to 1.19.3 (v9.2) (#58339)

* Datasource Loki: preserve header `X-ID-Token` (#57878) (#58346)

(cherry picked from commit bc280d07492f66456e47eb262f935c933312b1ed)

Co-authored-by: Si Mon <85333972+siiimooon@users.noreply.github.com>

* MSSql/Postgres: Fix visual query editor filter disappearing (#58248) (#58354)

(cherry picked from commit b47230623944f01aa6e2367913e2f7596ff284bf)

* Alerting: Fix test fails in some environments (#58251) (#58356)

(cherry picked from commit 8353f307aa2ed842c9045c1e420d51574019e905)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Append org ID to alert notification URLs (#57123) (#58349)

(cherry picked from commit db1fd10ff13d936665210e0c8a86c50ecae09998)

Co-authored-by: Neel <47709856+neel1996@users.noreply.github.com>

* [v9.2.x] CI: Use full `dockerhub` repository name (#57979) (#57983)

* CI: Use full `dockerhub` repository name (#57979)

* Add full dockerhub repo name

* Update grabpl version

(cherry picked from commit 57ee0e4a4b3b6b5536e63b117718c6384920650f)

* sign drone.yml

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>

* Docs: corrects outer join example (#58348) (#58366)

* corrects outer join example

* Update docs/sources/panels-visualizations/query-transform-data/transform-data/index.md

* adds query tables back in

(cherry picked from commit 0315f6317e2653da203c9ac0f21eceb9aa9e29de)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Remove duplicate Slack notification title (#58107) (#58256)

Move mentions to a markdown-formatted pretext field
to prevent issues mixing blocks and legacy-attachment content.

(cherry picked from commit d581b368bdeeaf8870e495a15dcfdf5aef293be9)

Co-authored-by: Will Jordan <wjordan@users.noreply.github.com>

* CallResource: don't set Content-Type header if status is 204 (#50780) (#58362)

Grafana's HTTPServer ensures that the Content-Type header is always set
in the response to a CallResource call, but when the status code is
204 No Content this shouldn't be done; the body should be empty and no
Content-Type header should be set.

We ran into this in the Grafana ML plugin where we were sending an empty
response with status 204, but the frontend client saw that the content
type was JSON and tried to parse it, resulting in an error that made it
to the JS console.

(cherry picked from commit 480277f6129b61d4f23e85a31b0e46b052cbb498)

Co-authored-by: Ben Sully <ben.sully@grafana.com>

* Prometheus: Upgrades http client to v1.13.1 (#58363) (#58395)

(cherry picked from commit faa0fda6eb846752983447c2590c68d68c6cb173)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace (#58189) (#58418)

* Grafana Enterprise Packaging: Set to conflict with `grafana`, not replace
When `grafana` and `grafana-enterprise` are in the same RPM repository, grafana-enterprise takes precedence over Grafana
This is not what we want. Users should be able to install either OSS or Enterprise

* Set it only one way. It's how it's currently tested

(cherry picked from commit 786c7faff2c70a563bd1f3f391e28564d1c59964)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Changelog: Updated changelog for 9.2.4 (#58429) (#58431)

(cherry picked from commit 94573d3e6109b5a832c21013c83d9464c43ea4b4)

* "Release: Updated versions in package to 9.2.5" (#58430)

* Prometheus: remove /series endpoint calls in query builder label names and values for supported clients (#58087) (#58438)

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* expanding current unit test coverage to cover calls to new API

* interpolate the label name string instead of the match promql expression

(cherry picked from commit 92817469143a222e6d1be8b3369151d55c7fe47d)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* properly format new .drone.yml in verify-drone (#58436) (#58452)

(cherry picked from commit d593aede3d0bc712dbae34d442918532d8c158d4)

Co-authored-by: Dan Cech <dcech@grafana.com>

* pkg/web: avoid shared middleware slice (#58458) (#58463)

(cherry picked from commit 75701695d8a938d4958c12febdf37d96afcd6092)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* Tooltips: Make tooltips in FormField and FormLabel interactive and keyboard friendly (#57706) (#58471)

* Tooltips: add tabindex and interactive

A couple tooltips used in configuration of datasources like ADX were not
clickable or didn't show on keyboard focus.

- fixes #56561
- Same solution as #47137

* test: add test around tabbing to tooltips

(cherry picked from commit 3e92a2dc7725677336534eae4008be6a679ed44b)

Co-authored-by: Adam Simpson <adam@adamsimpson.net>

* Use fnv64 for InmemCacheService (#58468) (#58487)

(cherry picked from commit 72275e97d281f6b4dfb2cd1188db1e7ec5cbb198)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Use hash of opts in singleflight (#58474) (#58488)

(cherry picked from commit ad9ac85ee090f8bb006c5b095c0fe3ac7e1b71cd)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Fix screenshots were not cached (#58493) (#58494)

(cherry picked from commit c646ff0ce3b5d68d6d96a9c98916186b91a3706c)

* Dashboards: Provide better error messages in SaveDashboardAsForm (#57866) (#58432)

The existing code uses `instanceof Error` to check for a `message` field on the thrown object. The objects that are thrown are never instances of the error interface. This change introduces a new type that extends Error so that the check works properly and displays a meaningful error message in the UI.

(cherry picked from commit f07da85d8b64c7df00121b6b9ace36f9eca1b9b2)

Co-authored-by: Joe Blubaugh <joe.blubaugh@grafana.com>

* Tempo: Fix dropdown issue on tag field focus (#57616) (#57883)

(cherry picked from commit 77be89eb1c743c681d0e070cb5f170e58ffa1bfb)

Co-authored-by: xiyu95 <112968312+xiyu95@users.noreply.github.com>
Co-authored-by: Will Browne <will.browne@grafana.com>

* Elasticsearch: fix typo (#58519) (#58523)

(cherry picked from commit fa5a304de862c438e25ab8818b7477d1c8304b13)

Co-authored-by: Gareth Dawson <gareth.dawson@grafana.com>

* Docs: adjusts topics to align with task templates (#58478) (#58531)

* updates topic to align with multiple task template

* updates goal intro

* aligns formatting with single task topic template

* Update docs/sources/administration/team-management/index.md

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>

* adds permissions requirements to two tasks

Co-authored-by: Kim Nylander <104772500+knylander-grafana@users.noreply.github.com>
(cherry picked from commit 2dfe0a4060c84aaff8edc0ce3a07573d114f3f67)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Alerting: Improve debug logs in image service (#58507) (#58533)

(cherry picked from commit b92a0223e3f5f60f2ae082e21ab43243d51469f0)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Add new PageInfo component (#58421) (#58534)

(cherry picked from commit 831ecb467cfaad7942cbe785f732bd91a43b479a)

Co-authored-by: Ashley Harrison <ashley.harrison@grafana.com>

* Alerting: Fix images cached on rule instead of dashboard panel signature (#58510) (#58536)

(cherry picked from commit 7e852720e3fd6394e62749383d1e502fd9fca83d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Alerting: Small improvements to staleResultsHandler (#58007) (#58513)

(cherry picked from commit 1290951b65b75ac6a054b401d3e91388cddfe33d)

* adjusts the stem sentence (#58538) (#58541)

(cherry picked from commit ad374efcbdddfd896cc19bdd98ff1d1cc54c94b4)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Prometheus: Query builder label filters dropdown UI overload fix (#58266) (#58546)

* WIP: try to support removing series endpoint for supported clients

* add other filter variables to match param for label values query against filter values, in order to resolve bug in which filter value options would display that aren't relevant in the current query editor context, i.e. options would display that upon select would display no data

* clean up console logs

* refactor and comment

* expanding current unit test coverage to cover calls to new API

* fix unit test

* whitespace

* prettier

* WIP: need to merge in other PR

* WIP giving up and trying again

* WIP: most functionality is working, split out shared loki/prom code

* fix bug in which search results wouldn't take other label context into the query

* Fix bug in which the previously selected value would conflict with the async search

* interpolate the label name string instead of the match promql expression

* remove type assertions

* remove type assertion

* clean up generic confusing types, and add back in a type assertion

* remove generic type

* make sure to interpolate label names

* fix bugs with variables not interpolating before query

* remove debug

* assert partial properties on QueryBuilderLabelFilter

* Force update betterer results :(

* update regex so dropdown UX more closely matches current behavior

* add eslint ignore

* add eslint ignore and update betterer

(cherry picked from commit ee7348afeea1f746a6ee4e6c7bbfc77743a43204)

Co-authored-by: Galen Kistler <109082771+gtk-grafana@users.noreply.github.com>

* Linux repositories: Document `apt|rpm.grafana.com` (#57527) (#58475)

* Linux repositories: Document `apt|rpm.grafana.com`
We'll be moving off packages.grafana.com (it will be linked to the new repositories)
The new package repositories are easier to use, so let's document them instead

Question: Are the scripts in `scripts/build/update_repo` and `scripts/verify-repo-update` still used? They seem very old, and seem like the generation of scripts before grabpl was created

* Shorter RPM docs. No need to copy the same snippet twice

* Add warning about repository migration

* oops

(cherry picked from commit f1f401147f5ea3bf71099b6358a5ee81f7c68f6a)

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* Navigation: Expose new props to extend `Page`/`PluginPage` (#58465) (#58562)

* add extensions and customisation to `Page`

* adjust alignment

(cherry picked from commit b3c761aaa79d374d7dc13c5456e322e1cc294b09)

* Alerting: Log when alert rule cannot be screenshot to help debugging (#58537) (#58563)

(cherry picked from commit 68600c224b36c4668cec75b7acc30369ac8f4eec)

* Plugins: CallResource: Use canonical MIME headers when writing response (#58506) (#58567)

* Plugins: CallResource: use canonical MIME headers when writing response

* Plugins: add tests for canonical mime headers and Set-Cookie filter

* Removed extra new line

(cherry picked from commit 33f02839f0792974a103629136df36528159059a)

Co-authored-by: Giuseppe Guerra <giuseppe.guerra@grafana.com>

* Alerting: Fix logging pointer address of DashboardUID and PanelID variables (#58539) (#58565)

(cherry picked from commit c5ae1bcfe06449fafe6cc4abb8d4a4c17a8c94e4)

* Canvas: Fix setting icon from field data #58499 (#58604)

(cherry picked from commit 47055561ec92ddb6f4d1d1fdcedb09345cb3b0cf)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Canvas: Improve disabled inline editing UX (#58614)

Canvas: Improve disabled inline editing UX (#58610)

(cherry picked from commit fd6edbf8c5a52619f00a7e4e440e8bc93df18260)

Co-authored-by: Nathan Marrs <nathanielmarrs@gmail.com>

* [v9.2.x] Docs: Add feature flag example to override configuration with environment variables (#58615)

Co-authored-by: Alexa V <239999+axelavargas@users.noreply.github.com>

* [v9.2.x] Chore: Upgrade go-sqlite3 to v1.14.16 (#58588)

(cherry picked from commit 990d8cd22e4a9ed2347663fe8c72dc37b46537d1)

Co-authored-by: Emil Tullstedt <emil.tullstedt@grafana.com>

* [v9.2.x] Tempo: Fix search removing service name from query (#58633)

Tempo: Fix search removing service name from query (#58630)

* Fix handleOnChange deps

* Remove eslint disable

(cherry picked from commit c76183a961edd87eb1c620e327bb0aa4ea930041)

Co-authored-by: Joey Tawadrous <90795735+joey-grafana@users.noreply.github.com>

* Bumping msw and xmldom to mitigate xmldom vulnerability (#58632)

* Prometheus: Handle errors and warnings in buffered client (#58657)

Prometheus: Handle errors in buffered client (#58504)

* Handle prometheus errors in buffered client

* Handle prometheus warnings

* Fix tests

* Add unit test for warnings

(cherry picked from commit 8edeb1aa2268c0c9666a739d6e0841aab98390b9)

* [v9.2.x] StateTimelinePanel: Fix duration on merged values (#58679)

StateTimelinePanel: Fix duration on merged values (#58561)

Fix stateTimeline duration

(cherry picked from commit 79142340e085aa1aa1e02ae77bd59b481c2e5f96)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Omit error from http response (#58445)

* [v9.2.x] Toolkit: Fix compilation loop when watching plugins for changes (#58695)

Toolkit: Fix compilation loop when watching plugins for changes (#58167)

* fix(toolkit): ignore node_modules and dist directories when watching for changes to plugin

* fix(toolkit): move watchOptions.ignored config to pluginDev watch call

(cherry picked from commit ce5040074058062e1777feafe2ad419af1f6a216)

Co-authored-by: Jack Westbrook <jack.westbrook@gmail.com>

* [v9.2.x] Docs: Add document for jsondata field alertmanagerUid  (#57121)

* Add document for jsondata field `alertmanagerUid` (#52895)

alertmanagerUid can be used to specify Alert Manager for a particular Prometheus/Loki data source.

Co-authored-by: Garrett Guillotte <garrett.guillotte@grafana.com>

* Docs: Fix provisioning table formatting (#57042)

Co-authored-by: Vũ Quốc Phong <phong.vq.198@gmail.com>
Co-authored-by: Daniel Lee <dan.limerick@gmail.com>

* Fix: Email and username trimming and invitation validation (#58446)

* Trim leading and trailing whitespaces from email and username on signup

* Check whether the provided email address is the same as where the invitation sent

Co-authored-by: Mihaly Gyongyosi <mgyongyosi@users.noreply.github.com>

* CI: Make build and store storybook trigger in the release process (#58686) (#58704)

Make storybook trigger conditional

(cherry picked from commit 09c3ead94573815e089a99caa8aaf536dd83193b)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58685)

SQL: Fix issue where testing the datasource would always be successful if the `datasourceQueryMultiStatus` feature was enabled (#58671)

SQL Datasources: fix issue where testing the datasource connection would show success even when there was an error.

Co-authored-by: Victor Marin <victor.marin@grafana.com>
(cherry picked from commit 75e435fb00942483c421d052066225b9f5fe9ce4)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] Docs: corrects relrefs (#58709)

Docs: corrects relrefs (#58706)

corrects relrefs

(cherry picked from commit a9458c8c00c5aba6efcbf9879662ebdd6174c248)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Snapshots: Allow user with viewer permissions to delete own snapshots (#58715)

Snapshots: Allow user with viewer permissions to delete own snapshots (#58572)

(cherry picked from commit 59d2cf2ff790ccc55b82902b66b241c8d809dcb2)

Co-authored-by: kay delaney <45561153+kaydelaney@users.noreply.github.com>

* [v9.2.x] Use relref resolved from nearest section (#58721)

Use relref resolved from nearest section (#58718)

As image-rendering is a branch bundle, it is considered a section by
Hugo and relrefs should be resolved from there even for child pages.

The behavior that worked in `next` but not `latest` could be explained
by the lenient but potentially ambiguous relref resolution algorithm
Hugo uses. However, I have not determined the exact difference between
the two sets of content that causes `next` to work but `latest` not to.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit b9d8bcb59ba1725dcc58a0c0c7e3dc812d3a75b3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Search: Fixes issue with Recent/Starred section always displaying "General" folder (#58749)

* [v9.2.x] CI: Remove base and arch args (#58209) (#58713)

Remove base and arch args (#58209)

(cherry picked from commit 9c1c10ab9a522db4a99310e1f2e01148b86e222d)

# Conflicts:
#	.drone.yml

# Conflicts:
#	.drone.yml

* [v9.2.x] SSE: Keep value name from numeric table (#58850)

SSE: Keep value name from numeric table (#58831)

fixes #48868

(cherry picked from commit 1953d473c04eb4a5b6c9f4231384ab0cb3dae8f3)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* Release: Bump version to 9.2.6 (#58857)

"Release: Updated versions in package to 9.2.6"

* [v9.2.x] Transformations: Make Card Descriptions Clickable (#58733)

Transformations: Make Card Descriptions Clickable (#58717)

replace Card Meta w Card Description

(cherry picked from commit 16aa4376acf2d5eb559feeb514f1852cd3b48ff9)

Co-authored-by: matt abrams <37156449+zuchka@users.noreply.github.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.5 (#58856) (#58862)

* Changelog: Updated changelog for 9.2.5 (#58856)
(cherry picked from commit df27164b8e0167b1b6c277d3f5a0fbd64b520eab)

* [v9.2.x] Chore: Extract server lock error so it can be used with errors.As (#58905)

Chore: Extract server lock error so it can be used with errors.As (#58899)

chore: extract server lock Error so it can be used with error.As
(cherry picked from commit 7e9d94cfda96f4229019d3a9ae1d854162595ae2)

Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] Alerting: Fix metric in Images in Notifications docs (#58978)

Alerting: Fix metric in Images in Notifications docs (#58954)

(cherry picked from commit 4da97aef7dc202f8fc671ef2f925bb14f3c90ad6)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Docs: adjusts link to kms integration (#58982)

Docs: adjusts link to kms integration (#58981)

adjusts link to kms integration

(cherry picked from commit e7b5bd34bdc126f696a9b13ecfcab19f660cfde9)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* [v9.2.x] Docs: adds permission validation setting (#58987)

Docs: adds permission validation setting (#58970)

* adds permission validation setting

* Update docs/sources/administration/roles-and-permissions/access-control/configure-rbac/index.md

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>

* makes prettier

Co-authored-by: Misi <mgyongyosi@users.noreply.github.com>
(cherry picked from commit 780efa57917c2951054a7558710e53d19f140f22)

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* resolves merge conflict (#58997)

* [v9.2.x] Alerting: Add Troubleshooting to Images in notifications docs (#59025)

Alerting: Add Troubleshooting to Images in notifications docs (#58955)

(cherry picked from commit 2f878acd9df99881f5a92456ec987c6548f07ec7)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* [v9.2.x] Prometheus: fix Heatmap y buckets when legendFormat: auto (#59064)

Prometheus: fix Heatmap y buckets when legendFormat: auto (#59053)

(cherry picked from commit 1f4834a144087fcdb408baec9db00075384e27cd)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Alerting: Support Prometheus durations in Provisioning API (#59066)

Alerting: Support Prometheus durations in Provisioning API (#58293)

Provisioning API should support Prometheus durations

(cherry picked from commit 57d6adbc7c4008143ac18fc7076607be227e12d3)

Co-authored-by: Bart Peeters <birtpeeters@hotmail.com>

* [v9.2.x] MS/My/PostgresSQL: Migrate annotation query (#58847) (#59072)

MS/My/PostgresSQL: Migrate annotation query (#58847)

(cherry picked from commit 38f25a0bf56cc1727472dd9a2755d5206890fbce)

* [v9.2.x] Azure Monitor: Fix resource picker selection for subresources (#59136)

Azure Monitor: Fix resource picker selection for subresources (#56392)

(cherry picked from commit 5b1ff83ee9c527c83439f0ac52d74d9b0df6d3c1)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] SQL: Fix code editor for SQL datasources (#59189)

SQL: Fix code editor for SQL datasources (#58116)

* SQL: Fix code editor for sql datasources

* Fix: mysql completion with defaultdb

(cherry picked from commit 75097b99fb68a5c7b1dad2c41d4927afc493d3c7)

* [9.2.x] Fix #58598 X-ID-Token header missing on Loki Datasource (#58784) (#59196)

* Fix #58598 X-ID-Token header missing on Loki Datasource (#58784)

* Fix #58598 X-ID-Token header missing on Loki Datasource

* Remove unecessary continue statements

* Add getAuthHeadersForCallResource unit tests

* Fix test and switch statement issues introduced during merge

(cherry picked from commit f1ef63791ad17d4c3b16cd296148c403515ad37d)

* update test

* missed linting

Co-authored-by: Yann Vigara <yvigara@users.noreply.github.com>

* Changelog: Updated changelog for 9.2.6 (#59232) (#59244)

(cherry picked from commit ae508c12f3dd9d9c69b0611b28df57c00dc5891f)

# Conflicts:
#	CHANGELOG.md

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.7 (#59245)

"Release: Updated versions in package to 9.2.7"

* [v9.2.x] Heatmap: Fix blurry text & rendering (#59261)

Heatmap: Fix blurry text & rendering (#59260)

(cherry picked from commit 6f00bc5674d994cb85716610807e4b4f3e232fbf)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* [v9.2.x] Azure Monitor: Fix empty/errored responses for Logs variables (#59277)

Azure Monitor: Fix empty/errored responses for Logs variables (#59240)

(cherry picked from commit 276b54fe9d41d7c435eb255f75cc1a54bf415db3)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] PostgreSQL: Fix missing CA field from configuration (#59285)

PostgreSQL: Fix missing CA field from configuration (#59280)

* PostgreSQL: Fix missing CA field from configuration

(cherry picked from commit be73418d0011c6303c2f638c49002445cd63ccf9)

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>

* [v9.2.x] TimeseriesPanel: Preserve string fields for data link interpolation (#59296)

TimeseriesPanel: Preserve string fields for data link interpolation (#58424)

* TimeseriesPanel: Preserve string fields for data link interpolation

* clean code

* Modify tests so that string fields are allowed only when a valid time/number dataframe exists

* performance mods

* fix wrong length

* remove console.log

* Check if aligned dataframe has links

(cherry picked from commit 0da77201bf0958b60fcc44b2bf62f5be2a47eeff)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* Access Control: Clear user's permission cache after resource creation (#59318)

resolve merge conflicts

* [v9.2.x] Navigation: Fix crash when Help is disabled (#59375)

Navigation: Set navtree to  an empty array instead of null (#58919)

set navtree to  an empty array instead of null

(cherry picked from commit 4aa5dea96bd2f9bb137be704e1f69c09c00cdfb3)

Co-authored-by: Leo <108552997+lpskdl@users.noreply.github.com>

* [v9.2.x] BarChart: fix hover overlay for hz stacked (#59397)

BarChart: fix hover overlay for hz stacked (#59359)

(cherry picked from commit 13d5ad2ce2a7283dc25dace1328cbf0c11fec639)

Co-authored-by: Leon Sorokin <leeoniya@gmail.com>

* Docs: Improve docs for images in notifications (#59033) (#59404)

(cherry picked from commit 0af3515e95cf185b60242022ede43562127757be)

* [v9.2.x] SSE: Make sure to forward headers, user and cookies/OAuth token (#58897) (#59430)

SSE: Make sure to forward headers, user and cookies/OAuth token (#58897)

Fixes #58793 and Fixes https://github.com/grafana/azure-data-explorer-datasource/issues/513

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
(cherry picked from commit 5623b5afafbf541eac66fab1d9398756bdf9052c)

Co-authored-by: Kyle Brandt <kyle@grafana.com>

* [v9.2.x] SQL Datasources: Fix annotation migration (#59454)

SQL Datasources: Fix annotation migration (#59438)

(cherry picked from commit 71e4a8261df505cd1f14e3aeed18c7cd182dad0f)

Co-authored-by: Zoltán Bedi <zoltan.bedi@gmail.com>

* [v9.2.x] Fix: Allow creating snapshot with no dashboard id (#59465)

Fix: Allow creating snapshot with no dashboard id (#58669)

(cherry picked from commit d279b6d7b09b979add6cc285542bf44bd1eb85fe)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Docs: Add docs for labels with dots (#59486)

Docs: Add docs for labels with dots (#59352)

(cherry picked from commit c8c1499cd0cb76da66c8949332efe5050e5d656d)

Co-authored-by: George Robinson <george.robinson@grafana.com>

* Release: Bump version to 9.2.8 (#59526)

"Release: Updated versions in package to 9.2.8"

* [v9.2.x] Changelog: Updated changelog for 9.2.7 (#59525) (#59528)

Changelog: Updated changelog for 9.2.7 (#59525)

(cherry picked from commit 312dbc979e3126bbdd491beb68c976910905f979)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Backport Fix XSS in runbook URL (#681) to v9.2.x (#683)

(cherry picked from commit db1548c1491c2f5b522e3c0ceb1832b914a4b2f0)
(cherry picked from commit 3135a81edf0ebeb575c95560dd548f9589c14d02)
(cherry picked from commit fe17b64445d9cac8c0b4756867f609320c9cb049)

* [v9.2.x] Docs: Remove publish.yml (#59536)

Remove publish.yml

* [v9.2.x] Fix: Unlocking the UI for AuthProxy users (#59529)

Fix: Unlocking the UI for AuthProxy users (#59507)

Unlocking the UI for AuthProxy users

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>
(cherry picked from commit 5bb99775bb995436e9fcf723ed1e622b685a9f1f)

Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Datasources: Use context logger in cache service (#59557)

Datasources: Use context logger in cache service (#59547)

(cherry picked from commit 0fca3cf9ddc1c0e4dd1407d36099ac630fa5a74f)

Co-authored-by: Will Browne <wbrowne@users.noreply.github.com>

* [v9.2.x] Sessions: Remove invalid session cookie if it's invalid/expired/missing (#59588)

only remove invalid session cookie if it's invalid/expired/missing

(cherry picked from commit 270a893e127c7b9a050b9db16bb54ee0f5783191)

* [v9.2.x] Automate docs publishing steps (#59565)

* Automate docs publishing steps (#59550)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 10a83714c87253c2951e97913cc2a2e61801eb41)

* Remove dependency on test job (#59575)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Fix release_branch_regexp (#59590)

Apparently the non-capturing group was incorrect.

I verified the logic in a branch in grafana-github-actions:
https://github.com/grafana/grafana-github-actions/compare/jdb/2022-11-prove-grafana-regexp-behaves-correctly?expand=1

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Fix panic from empty response in ARG (#59706)

AzureMonitor: Fix panic from empty response in ARG (#59691)

AzureMonitor: Avoid panic from empty response in ARG
(cherry picked from commit 231b5b587c2811d17f765e763b4f65bf58e1610c)

Co-authored-by: Andres Martinez Gotor <andres.martinez@grafana.com>

* [v9.2.x] DataSourcePermissions: Handle licensing properly for ds permissions (#59711)

DataSourcePermissions: Handle licensing properly for ds permissions (#59694)

* RBAC: add viewer grand if dspermissions enforcement is not enabled

* RBAC: Change permissions based on role prefix

* RBAC: Add option to for permission service to add a license middleware

* RBAC: Remove actions from query struct

(cherry picked from commit 6d1bcd9f40c5aabf6dee74fdc7a0373b7c25ee0f)

* DataLinks: Backport 58934 to v9.2.x (#59457)

* manual backport

* manual backport

* [v9.2.x] Restrict workflow to grafana/grafana repository (#59755)

Restrict workflow to grafana/grafana repository (#59740)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit e7bdcb4ba865103253c7752bd3ade5f9ebfcf949)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] AzureMonitor: Automate location retrieval (#59810)

* AzureMonitor: Automate location retrieval (#59602)

* Automate location retrieval

- Add function to retrieve provider information
- Add function to retrieve subscription locations
- Add parsers for each function
- Add types
- Update resourcePickerData with new functions
- Remove old location metadata file

* Improve types

- Add types for responses
- Use correct name parameter
- Update response parser (parseProvider unnecessary)

* Fix tests

- Add necessary mocks

* Fix logic and ensure maps are consistent

* Add tests

* Review

* Lint issue

(cherry picked from commit c52d4e2a64806e8cbf47782854fdd1f795cf549d)

* Lint issues

Co-authored-by: Andreas Christou <andreas.christou@grafana.com>

* FIX: Remove service accounts from quota count (#59878)

* [v9.2.x] Chore: Remote cache key prefix (#59838) (#59877)

Chore: Remote cache key prefix (#59838)

* attempt to implement a remote cache key prefix

* add a test for the prefix store

* oh, linter

(cherry picked from commit 3978502d837986a9ad77f4bf303b433f038637b1)

* [9.2.x] Instrumentation: Log plugin and datasource info for each plugin request. (#59882)

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* [v9.2.x] Chore: Add encryption codec to the remote cache (#59871) (#59896)

* add encryption codec to the remote cache

* change config files too

* fix test constructor

* pass codec into the test cache

(cherry picked from commit f1fb202284a961bd8e3229742e57cc834a201078)

* FeatureToggle: for storing signed in user object in a Remote Cache (#59883)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix conflicting modifications :D

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* rename the flag to userRemoteCache

* undo unintended change

* Users: Add option to use remote cache for SignedInUsers (#59892)

* Add remote cache to GetSignedInUserWithCacheCtx

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Populate SignedInUser remote cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Line

* minor fixes to make this work

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Fix tests

* change flag to updated name

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>

* Auth: Session cache [v9.2.x] (#59907)

* add cache wrapper

only cache token if not to rotate

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

anticipate next rotation

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>
(cherry picked from commit 07a4b2343d59cb593ad128355e1d9217ba493700)

* FeatureToggle: for storing sessions in a Remote Cache

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
(cherry picked from commit b8a8c15148c53a76f14f76da1b0fa4cec9be9216)

* use feature flag for session cache

* ensure ttl is minimum 1 second

Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* ensure 2 ttl window to prevent caching of tokens near rotation

Co-authored-by: Kalle Persson <kalle.persson@grafana.com>

* fix description of toggle

Co-authored-by: gamab <gabi.mabs@gmail.com>
Co-authored-by: ievaVasiljeva <ieva.vasiljeva@grafana.com>
Co-authored-by: Kalle Persson <kalle.persson@grafana.com>
Co-authored-by: Gabriel MABILLE <gamab@users.noreply.github.com>

* [v9.2.x] Plugins: Add username to datasource plugin logging (#59947)

Plugins: Add username to datasource plugin logging (#59893)

Co-authored-by: Marcus Efraimsson <marcus.efraimsson@gmail.com>
Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit a5ace56be8644c725803e63798554a35eba27e79)

Co-authored-by: Carl Bergquist <carl.bergquist@gmail.com>

* [9.2.x] Backport Contexthandler: Add uname as response header #59930 (#59950)

* Contexthandler: Add uname as response header (#59930)

Signed-off-by: bergquist <carl.bergquist@gmail.com>
(cherry picked from commit 1b676d0d49460572352af4639274a4e7fe03fc9b)

* fixes tests broken due to moved featuremgt package

Signed-off-by: bergquist <carl.bergquist@gmail.com>

Signed-off-by: bergquist <carl.bergquist@gmail.com>

* Auth: Logger for user remote cache (#59961)

add logger

* [v9.2.x] UsageInsights: Record events for Explore queries (#59992)

* UsageInsights: Record events for Explore queries (#59931)

* usageinsights: record events for Explore queries

* usageinsights: make the source field optional

It is not logical to have it for an event like the dashboard-view

* usageinsights: add comment to Explore test

Explain why we are reversing a previous decision

(cherry picked from commit 74167b4d44119862c1246caa3367e4f488efd15e)

* usageinsights: fix merge conflict

* Empty-Commit to trigger build

* usageinsights: fix broken tests after merge

* [v9.2.x] Fix index out of range in regenerateLinksSupplier (#60069)

Fix index out of range in regenerateLinksSupplier (#60011)

(cherry picked from commit 896cb9ddceae6c02811a33e8a323b877cf100151)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Fix branch filter for release workflows (#60123)

Fix branch filter for release workflows (#59963)

Ensures the workflow is run on every push to all version branches.

This was thought to be working because it was tested with a manual
dispatch, however, that trigger does not consider filters and was not
an accurate test.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 6f9ee7acf9a8fee8b4a55af94d9dfccced55032c)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Use relative aliases for all non-current Grafana aliases (#60113)

* Use relative aliases for all non-current Grafana aliases

Prevents non-latest documentation "stealing" the page away from latest
and through permanent redirects for latest pages that no longer exist.

The redirected pages are indexed by search engines but our robots.txt
forbids them crawling the non-latest page.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* Remove all current page aliases

find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/next/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -z -i 's#\n *- /docs/grafana/latest/[^\n]*\n#\n#' {} \;
find docs/sources -type f -name '*.md' -exec sed -Ez -i 's#\n((aliases:\n *-)|aliases:\n)#\n\2#' {} \;

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Snapshots: Build snapshot originalUrl on the backend  (#60232) (#60256)

Co-authored-by: kay delaney <kay@grafana.com>

* Cloudwatch: Fix deeplink with default region (#60260) (#60273)

Cloudwatch: fix deeplink with default region
(cherry picked from commit d6bb2a74931a9c2b393fa22040737fb6480819f3)

* [v9.2.x] Graphite: bug fix, strip white space from queries before comparing them (#60348)

Graphite: bug fix, strip white space from queries before comparing them (#60133)

strip white space from queries before comparing them

(cherry picked from commit d5d07894b1222eab49f58157f3367d5a5ef2726e)

Co-authored-by: Brendan O'Handley <brendan.ohandley@grafana.com>

* [v9.2.x] Alerting: Set Dashboard and Panel IDs on rule group replacement (#60443)

Alerting: Set Dashboard and Panel IDs on rule group replacement (#60374)

* Set Dashboard and Panel IDs on rule group replacement

* fix comments and abbreviate test variable name

* Update pkg/services/ngalert/provisioning/alert_rules.go

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>

Co-authored-by: Jean-Philippe Quéméner <JohnnyQQQQ@users.noreply.github.com>
(cherry picked from commit 174c61b949a905ab567e9e0d65a84483f00e4079)

Co-authored-by: Alex Moreno <alexander.moreno@grafana.com>

* [v9.2.x] Add copyright notice (#60662)

* Add copyright notice (#60658)

* Create copyright

* add copyright notice

(cherry picked from commit c7671b6d1daf7987e5b8bf72b766f9b404449daa)

* yarn run prettier:write

(cherry picked from commit 160ea3e262f7db24e925d375d16670fd0200105c)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Co-authored-by: Eve Meelan <81647476+Eve832@users.noreply.github.com>
Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] BarChart: Clear tooltip when cursor exits bar (#60748)

BarChart: Clear tooltip when cursor exits bar (#60617)

(cherry picked from commit 9bd6e471e436fed37a908e5118593d515b134781)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Prometheus: Fix Instant query time calculation  (#60821)

Prometheus: Fix Instant query time calculation (#60815)

* Use single point in time instead of doing time range calculation

* Comment update

(cherry picked from commit 15d32546ea315f8ccada85cd64c5b49d55b0d6ec)

* [v9.2.x] Alerting: Prevent uid collision in migration when db is case-insensitive (#60834)

Alerting: Prevent uid collision in migration when db is case-insensitive (#60494)

* Alerting: Prevent short uid collision in legacy migration when db is case-insensitive

Two factors come into play that cause sporadic uid conflicts during legacy alert migration:
- MySQL and MySQL-compatible backends use case-insensitive collation.
- Our short uid generator is not a uniform RNG and generates uids in such a way that generations in quick succession have a higher probability of creating similar uids.

Normally we would be guaranteed unique short uid generation, however if the source alphabet contains
duplicate characters (for example, if we use case-insensitive comparison) this guarantee is void.

Generating even ~1000 uids in quick succession is nearly guaranteed to create a case-insensitive
duplicate.

(cherry picked from commit 570b62091c681fec4af9a761db09fbec94b3f750)

Co-authored-by: Matthew Jacobson <matthew.jacobson@grafana.com>

* [v9.2.x] Chore: Upgrade Go to 1.19.4 (#60794) (#60826)

* [v9.2.x] remove _build param from whatsnew (#59236) (#60888)

remove `_build` param from whatsnew (#59236)

* remove `_build` param from whatsnew

* Update whats-new-in-v9-3.md

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* Docs: Add source code url field description in publish a plugin documentation (#61080) (#61133)

* [v9.2.x] Canvas: Inconsistent save behavior (#61012)

Canvas: Save element placement (#61007)

(cherry picked from commit 88a8cba6b08901966aebf8e19c16b1a973da61f8)

Co-authored-by: Adela Almasan <88068998+adela-almasan@users.noreply.github.com>

* [v9.2.x] remove splunk plugin from legacyRunner check (#61180)

remove splunk plugin from legacyRunner check (#60979)

(cherry picked from commit 7db284cfcb9f8f3c10df07a30ad42833e8890b77)

Co-authored-by: Taewoo K <taewoo.kim@grafana.com>

* [v9.2.x] Update publishing workflows to use PATs with fine-grained access control (#61267)

Update publishing workflows to use PATs with fine-grained access control (#61098)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 87ccf10ffe9adf8cf9aee48d27964a6c704ee8ac)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* Add reference to Google OAuth docs (#61148)

* [v9.2.x] Bugfix: Prevent previous query editor to set default values when changing data source (#61285)

Bugfix: Prevent previous query editor to set default values when changing data source (#60218)

* Fixed issue where the query editor of the previous ds sets default values on query passed to the query editor of the next ds.

* Fixed issue with changing data source for query in Alerting.

* Will apply default values from DS if available.

* Fix failing tests.

* fixed spell error.

* reverted getDefaultQuery call so it can be added in a separate PR.

(cherry picked from commit b633d5395db1d04cc074e295acdc5f448beb7b99)

Co-authored-by: Marcus Andersson <marcus.andersson@grafana.com>

* [v9.2.x] Levitate: Only run against the main branch (#61401) (#61462)

Levitate: Only run against the main branch (#61401)

chore: only run Levitate against the main branch
(cherry picked from commit b8aaf85fdca926c6aff3d20cb9955e063e997ec1)
Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
Co-authored-by: Levente Balogh <balogh.levente.hu@gmail.com>

* [v9.2.x] Pin doc-validator image version to allow repository to opt in to breaking changes (#61480)

Pin doc-validator image version to allow repository to opt in to breaking changes (#61456)

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 017d4f2cbbe5125098fbc183a694422a3117f3a3)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Live: Fix `Subscription to the channel already exists` live streaming error (#61419)

Live: Fix `Subscription to the channel already exists` live streaming error (#61406)

#60570: Fix `subscription to the channel already exists`

(cherry picked from commit 23dbc916e8a0ea72360fcda43fcccfc45f4dba80)

Co-authored-by: Artur Wierzbicki <artur.wierzbicki@grafana.com>

* [v9.2.x] update docs docker image reference (#61501)

update docs docker image reference (#61269)

* update docs docker image
* remove command

(cherry picked from commit 98cadb3aa0d315e40599715d1687603943542347)

Co-authored-by: Robby Milo <robbymilo@fastmail.com>

* [v9.2.x] Auth: Fix correct error for updateapikey in context handler (#61564)

Auth: Fix correct error for updateapikey in context handler (#61544)

* fix: correct error for updateapikey

* refactor: send the correct err forward

* update: based on review

(cherry picked from commit 07bbc0716c8a5e105bbf96cf6965c03cd6f199aa)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Docs: Renderer token (#61681)

Docs: Renderer token (#59560)

* Docs: renderer token

* Apply suggestions from code review

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/image-rendering/_index.md

* Update docs/sources/setup-grafana/configure-grafana/_index.md

* makes prettier

Co-authored-by: Joan López de la Franca Beltran <joanjan14@gmail.com>
Co-authored-by: Joan López de la Franca Beltran <5459617+joanlopez@users.noreply.github.com>
Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit d042c0b30b4962497480feee3f57f24c6050ea4e)

Co-authored-by: Leonard Gram <leo@xlson.com>

* [v9.2.x] Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61691)

Auth: Fix disable/remove duplicate user entries metrics for performance reasons (#61675)

* fix: remove metrics from duplicate user entries

* fix: disable metrics collection for authinfo

* fix: initifine goroutine loop that happened

* removed: metrics

(cherry picked from commit bedd2304d1bbc5e65512a7938ac1a231bb6b3f14)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [9.2.x] Use new GPG key when publishing (#61791)

update .drone.yml

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] SearchV2: Fix star query when no stars exist (#61818)

SearchV2: Fix star query when no stars exist (#61726)

(cherry picked from commit c315946a9196c51c5c48ee5c1ceb1c509b709e5a)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] Packaging: Use base64 key (#61822)

backport

Co-authored-by: Julien Duchesne <julien.duchesne@grafana.com>

* [v9.2.x] Update _index.md (#61828)

Update _index.md (#61662)

* Update _index.md

The troubleshooting page was missing how to send dashboard panels for debugging so added it here.

* Update docs/sources/troubleshooting/_index.md

* Update docs/sources/troubleshooting/_index.md

* removed empty lines

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>
Co-authored-by: Chris Moyer <chris.moyer@grafana.com>
(cherry picked from commit 6c6c0f54025fe4183c03b529a2ab8bd5039afbda)

Co-authored-by: Usman Ahmad <69509548+usmangt@users.noreply.github.com>

* [v9.2.x] Canvas: Rectangle render error (#61888)

* TextPanel: Refactor to functional component (#60885) (#61940)

backport

* Release: Bump version to 9.2.11 (#62038)

"Release: Updated versions in package to 9.2.11"

* Docs: Update publish a plugin FAQ to cover more common questions (#62… (#62064)

* Changelog: Updated changelog for 9.2.10 (#62066) (#62076)

* Changelog: Updated changelog for 9.2.10

* Update CHANGELOG.md

* Update CHANGELOG.md

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit 87023c85cb767e275bda9f054d1863c5bab03caa)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#62158)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>
(cherry picked from commit 8b574e22b53aa4c5a35032a58844fd4aaaa12f5f)

* [v9.2.x] QueryEditorRow: Fixes issue loading query editor when data source variable selected (#62179)

QueryEditorRow: Fixes issue loading query editor when data source variable selected (#61927)

* QueryEditorRow: Fixes issue loading query editor when data source variable selected

* Fix func name

* Removed wait

* restore waiting for with better check

* restore waiting for with better check

(cherry picked from commit 9f7ddf1f0b5234a1fd82e1f92d1444f81a794e45)

Co-authored-by: Torkel Ödegaard <torkel@grafana.com>

* [v9.2.x] update gpg secret names (#62250)

update gpg secret names

* [v9.2.x] Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62205)

Auth: Fix catch both both ErrInvalidAPIKey for context with APIKey (#62193)

* fix: capture both ErrInvalidAPIKey

* rename of variable

(cherry picked from commit c5cb5be3cc078cc99b0324ae0db429646e0603ad)

Co-authored-by: Eric Leijonmarck <eric.leijonmarck@gmail.com>

* [v9.2.x] Login: Fix panic when UpsertUser is called without ReqContext (#62574)

* Login: Fix panic when UpsertUser is called without ReqContext (#62539)

(cherry picked from commit b1151dd118f2a1c305a6f757661e42e59cf145c1)
(cherry picked from commit 679cc18648295053a6ab9b764b85cd68f773f81b)

* [v9.2.x] Tempo: Fix span name being dropped from the query (#62591)

Tempo: Fix span name being dropped from the query (#62257)
(cherry picked from commit c3b476e1dcb310e1d3b425f058264ed5be00d1d8)
Co-authored-by: Hamas Shafiq <hamas.shafiq@grafana.com>

* [v9.2.x] Expressions: Fixes the issue showing expressions editor (#62626)

* Expressions: Fixes the issue showing expressions editor (#62510)

* Use suggested value for uid

* update the snapshot

* use __expr__

* replace all -100 with __expr__

* update snapshot

* more changes

* revert redundant change

* Use expr.DatasourceUID where it's possible

* generate files

(cherry picked from commit 91221bc4362e50b9cca6dbff3a8342b2991900d2)

* unit text fix

* [v9.2.x] docs: deleted link to moved content (#62703)

deleted link to moved content

* [v9.2.x] docs: fix broken elasticsearch metrics play link (#62717)

docs: fix broken elasticsearch metrics play link (#62715)

fix broken elastic search play link

(cherry picked from commit 1225e8d6d8a2076f2141065c0ad20b55241d6f25)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix/60084/save and test (#62748)

Fix: Save and test error message does not persist across datasource instance settings anymore

(cherry picked from commit ce50168b70b4444abb5a1aa36d695dc1b7c339b9)

Co-authored-by: Timur Olzhabayev <timur.olzhabayev@grafana.com>

* [v9.2.x] Server: Switch from separate server & cli to a unified grafana binary (#58286) (#62754)

* Server: Switch from separate server & cli to a unified grafana binary (#58286)

* avoid the need for a second bulky binary for grafana-cli

* look for grafana-server in $PATH as well as same directory

* implement unified "grafana" command

* update dockerfiles, fix grafana-cli -v

* update packaging to work with single binary

- add wrapper scripts for grafana and grafana-server
- update and sync package files
- implement --sign flag of build package command
- stop packaging scripts folder, they are not useful for end users
- add support for --configOverrides in server command
- remove unused nfpm.yaml config file

* windows support

(cherry picked from commit de99ce139c96e7229bb5e194aed225e3321d8685)

* Build: don't remove grafana-server and grafana-cli binaries from deb and rpm packages (#59890)

* don't remove grafana-server and grafana-cli binaries from /usr/share/grafana/bin in deb and rpm packages

* don't add config overrides in /usr/sbin/grafana-server

(cherry picked from commit 01cba80cbd762a180a18592a82d6e5992c4fb941)

---------

Co-authored-by: Dan Cech <dcech@grafana.com>

* [v9.2.x] MSSQL: Add support for macro function calls (#62887)

MSSQL: Add support for macro function calls (#62742)

* MSSQL: Add support for macro function calls

* Add tests

(cherry picked from commit 9fc3b360a43e9f0295f7366e9ea635a43521b341)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* [v9.2.x] Remove packages path from branch filter (#60946)

Remove packages path from branch filter (#60128)

That directory is no longer used in published docs and causes this
workflow to fail when changes only affect the packages directory.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit 1516aa27622ee5dc8d14cc3ebcd07647bf1619bd)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Update publishing workflows to use organization secret (#63043)

Update publishing workflows to use organization secret (#63001)

The new tokens are managed centrally and have a longer expiry.
Administrators of the grafanabot account will be
notified of the pending expiry and the secret can be rotated centrally
without the need for a repository administrator to update their
secrets.

The existing repository secrets can safely be removed. The tokens for
those secrets will be removed by the end of this week.

Signed-off-by: Jack Baldry <jack.baldry@grafana.com>
(cherry picked from commit ba9bdf3455b24f3d86b425ccd24994b915327c3b)

Co-authored-by: Jack Baldry <jack.baldry@grafana.com>

* [v9.2.x] Server: Fix issue backporting #58286 to v9.2.x in #62754 (#63067)

Fix issue backporting #58286 to v9.2.x in #62754

* [v9.2.x] Remove `gen-jsonnet` make target from `bra.toml` (#63102)

Remove gen-jsonnet from toml

* [v9.2.x] fix broken envelope encryption link (#63141)

fix broken envelope encryption link (#63135)

(cherry picked from commit 72ca7fe7fe30a95e75e558bf83efc4e791e5018e)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Fix MSSQL queries failing because of bad interpolation (#63170)

Fix MSSQL queries failing because of bad interpolation (#63167)

fix failing mssql queries

(cherry picked from commit 62b078e4e4cad882e9e9a01f36cc8df4aa084eab)

Co-authored-by: Victor Marin <36818606+mdvictor@users.noreply.github.com>

* CI: Backport CI/Release related code to v9.2.x (#63251)

* Cherry pick from 03b1cf7

* Remove publishpackages/go

* Backport enterprise checks

* CI: Allow other modules to register build sub-commands (#62741)

* Allow other modules to register build sub-commands

* CI: Fix retries on artifacts-page clone

* Fix linting errors

* Fix golint issues

* Update to grabpl 3.0.21

(cherry picked from commit 312ea59e6da16c28226042b7cdebf4e660880ed7)

* CI: Remove variants arg from `package` step (#62858)

* Remove variants arg from package step

* Fix starlark lint

* Default to releaseModeConfig.Variants

* Check for empty variants arg

(cherry picked from commit e5c48ac9454a8513d526384751b953ff98d12ecb)

* Remove verify-jsonnet-step

* Revert github.com/grafana/thema bump

* go mod tidy

* Remove publish.star

* Fix lib.star lint

* CI: Running Redis integration tests without grabpl (#63028)

This restores some changes from
https://github.com/grafana/grafana/pull/61920 that were accidentally
deleted.

(cherry picked from commit 2804acd264ff247673f71854d25d79656b7b0775)

* go mod tidy

* Fix clone enterprise for custom events

* Chore: Bump alpine version to `3.17.1` (#63252)

Bump alpine version to 3.17.1

(cherry picked from commit 24c60486f62fd723b3d61718d45e7b9382f74656)

---------

Co-authored-by: Kevin Minehart <kmineh0151@gmail.com>
Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2.x] MSSQL Datasource: Revert functions within macros change (#63596)

MSSQL Datasource: Revert functions within macros change (#63592)

* Revert functions within macros change
* Add tests for function and macro for mssql
* Remove macro support tests

---------

Co-authored-by: Oscar Kilhed <oscar.kilhed@grafana.com>
(cherry picked from commit 356e2e1933f5e717a0e8f7688ba1b44f7bf9fa01)

Co-authored-by: Kyle Cunningham <codeincarnate@users.noreply.github.com>

* [v9.2.x] docs: fixed headings and link to explore with logs (#63673)

[9.3.x] docs: fixed headings and link to explore with logs (#63670)

fixed headings and link to explore with logs

(cherry picked from commit abfd8792e536ec8096f83f5abb4612fb7312f90b)

Co-authored-by: Isabel <76437239+imatwawana@users.noreply.github.com>

* [v9.2.x] Update grafana/saml library (#689)

SAML: update grafana/saml

Co-authored-by: Jo <joao.guerreiro@grafana.com>

Co-authored-by: linoman <2051016+linoman@users.noreply.github.com>
Co-authored-by: Jo <joao.guerreiro@grafana.com>

* [v9.2.x] SVG: Add dompurify preprocessor step (#704)

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

(cherry picked from commit dbbe819368f507b9493b7a3cf6e080a5dd752b3e)

* remove added file

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* Auth: Update saml go.mod (missing query sig verification) [9.2.x] (#713)

update saml go.mod (missing query sig verification)

(cherry picked from commit 1e1dbd1a06455a451d722856dc619b2a7c78e2c0)

* Release: Bump version to 9.2.11 (#728)

"Release: Updated versions in package to 9.2.11"

* [v9.2.x] Geomap: Sanitize the attribution string (#753)

Geomap: Sanitize the attribution string (#745)

* SAML: Update grafana/saml library (#691)

Co-authored-by: jguer <joao.guerreiro@grafana.com>

* SVG: Add dompurify preprocessor step (#698)

* add sanitized SVG component

* add sanitize

* Fix frontend build

* Remove unnecessary yarn.lock changes

* Fix formatting

* Re-add yarn.lock message as I guess it is needed

---------

Co-authored-by: dsotirakis <dimitrios.sotirakis@grafana.com>
Co-authored-by: jguer <joao.guerreiro@grafana.com>
Co-authored-by: nmarrs <nathanielmarrs@gmail.com>
Co-authored-by: Drew Slobodnjak <60050885+drew08t@users.noreply.github.com>
(cherry picked from commit 37b4af7ffacfc24d5f24d190356a9ef32d99aa6f)

Co-authored-by: Ryan McKinley <ryantxu@gmail.com>

* [v9.2.x] TraceView: Add key and url escaping of json tag values (#760)

* [v9.2.x] Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64115)

Docker Build: Use `tonistiigi/binfmt` image for cross compilation (#64108)

* Change docker image used for cross-compilation

* Replace fmt.Println with log.Println

* Add specific tag for docker image

(cherry picked from commit b42fd92fad7c4e826cb6ae9ed360952bbc9a87a9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] build: fix corss build (#63263)

build: fix corss build (#61121)

* build: fix corss build

* fix lint

(cherry picked from commit 37baae3699fcad37dac87a759491ae5db02369df)

Co-authored-by: Jimmie Han <hanjinming@outlook.com>

* [9.2.x] CI: Move some build settings (#64491) (#64517)

Backporting https://github.com/grafana/grafana/pull/64491.

* Move some build settings to Vault

* CI: Remove reference to DOWNSTREAM_REPO as it isn't used

(cherry picked from commit 4b241804b401eed529e41fa775186d8ffe89ea1c)

* [v9.2.x] CI: Add `PrereleaseBucket` field in `versions.go` (#64522)

CI: Add `PrereleaseBucket` field in `versions.go` (#64519)

Add PrereleaseBucket in versions.go

(cherry picked from commit 29b3f3fbf4cd64a59422ac14c58d8fb81f7b17f9)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [9.2.x] CI: Do not clone in artifacts-page pipeline (#64663)

This is done in a later step.

* [v9.2.x] Alerting: Fix queries not being previewed in detail view (#64977)

* Alerting: Fix queries not being previewed in detail view (#64198)

(cherry picked from commit 4e81aab60a587b102305a255891986e592a0d1a4)

* Update imports

---------

Co-authored-by: Gilles De Mey <gilles.de.mey@gmail.com>
Co-authored-by: ismail simsek <ismailsimsek09@gmail.com>

* [v9.2.x] Alerting: Fix expression issues in alert rule view and edit pages (#65008)

* Fix rule viewer

* Fix expressions editor and viewer in alerting

* [v9.2.x] Update CODEOWNERship for grafana-delivery team (#64973) (#65020)

Update CODEOWNERship for grafana-delivery team (#64973)

(cherry picked from commit 2897ee37bf9f575eef19bcd35182232f965c6499)

* [v9.2.x] CI: Update `grabpl` to `3.0.30` (#65028) (#65087)

CI: Update `grabpl` to `3.0.30` (#65028)

Update grabpl

(cherry picked from commit 4a80233bedf6e750f0ce43fa9fe1f6eb7ab9f6fa)

* [v9.2.x] NPM: Stop using the folder path before the name path (#65156)

NPM: Stop using the folder path before the name path (#63851)

Stop using the folder path before the name path

(cherry picked from commit 177aa254c563dfe98ffabd2de56330bee960f160)

Co-authored-by: Dimitris Sotirakis <dimitrios.sotirakis@grafana.com>

* [v9.2.x] Fix xss in Graphite functions tooltip (#810)

Fix xss in Graphite functions tooltip (#804)

(cherry picked from commit 87aad3f11836f810ee1fdfee27827e746ef36055)

Co-authored-by: Ludovic Viaud <ludovic.viaud@gmail.com>

* [v9.2.x] Changelog: Updated changelog for 9.2.15 (#65196) (#65200)

Changelog: Updated changelog for 9.2.15 (#65196)

* Changelog: Updated changelog for 9.2.15

* Update CHANGELOG.md

---------

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>
(cherry picked from commit a907e042f9cdba3d4c00e89f820bfd9030025af9)

Co-authored-by: Grot (@grafanabot) <43478413+grafanabot@users.noreply.github.com>

* Release: Bump version to 9.2.16 (#65202)

"Release: Updated versions in package to 9.2.16"

* [v9.2.x] CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173) (#65193)

CD: Remove `fetch-images` dependency from AWS marketplace automation (#65173)

* Remove fetch-images dependency

* Fix starlark link

(cherry picked from commit d0be9610f0e22a4571a13c2ebf2aaabe281ecf48)

* [v9.2.x] Expressions: More robust expression check (#65231)

* Expressions: More robust expression check (#65006)

More robust expression check

(cherry picked from commit 1328878aceb37da7051c5685375e2ca32ef0a6b4)

* Fix import

* [v9.2.x] CI: Remove `grabpl` dependency from `publish-packages` steps (#65329) (#65331)

CI: Remove `grabpl` dependency from `publish-packages` steps (#65329)

Remove grabpl dependency from publish packages

(cherry picked from commit 3b00d2c273d5b7622b225ae56381879b60a10c2a)

# Conflicts:
#	.drone.yml

* [v9.2.x] CI: Cleanup unnecessary `grabpl` dependencies (#65330) (#65345)

CI: Cleanup unnecessary `grabpl` dependencies (#65330)

* Remove unnecessary grabpl dependencies

* Revert test-frontend change

(cherry picked from commit 89d642e001513c72120aac89be997735717dd174)

# Conflicts:
#	.drone.yml

* [v9.2.x] CI: Allow overwriting of existing GitHub release assets (#65457)

CI: Allow overwriting of existing GitHub release assets (#65127)

* CI: Allow overwriting of existing GitHub release assets

This closes #63698

* Use c for *cli.Context in publishgithub.go

(cherry picked from commit 4ab3bd6f7e8bff7719c6c8756bfd8a86126a8616)

Co-authored-by: Horst Gutmann <horst.gutmann@grafana.com>

* [v9.2] docs: fix alias and broken link (#65483)

fixed alias and broken link

* [v9.2.x] configure HTTPS documentation  (#65558)

configure HTTPS documentation  (#65271)

* configure HTTPS settings for grafana

* Apply suggestions from code review

* Apply suggestions from code review

* rewrites and restructures content

* Apply suggestions from code review

* PR feedback review; https docs

* Update docs/sources/setup-grafana/set-up-https.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/set-up-https.md

Co-authored-by: Christopher Moyer <35463610+chri2547@users.noreply.github.com>

* Update docs/sources/setup-grafana/set-up-ht…
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fgrafana%2Fgrafana%2Fpull%2F60256)

Reviewers

[![@ivanortegaalba](https://avatars.githubusercontent.com/u/5699976?s=40&v=4)](/ivanortegaalba) [ivanortegaalba](/ivanortegaalba)

ivanortegaalba approved these changes

[![@dprokop](https://avatars.githubusercontent.com/u/2376619?s=40&v=4)](/dprokop) [dprokop](/dprokop)

 Awaiting requested review from dprokop

[![@malcolmholmes](https://avatars.githubusercontent.com/u/42545407?s=40&v=4)](/malcolmholmes) [malcolmholmes](/malcolmholmes)

 Awaiting requested review from malcolmholmes

Assignees

[![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=40&v=4)](/axelavargas) [axelavargas](/axelavargas)

Labels

[area/backend](/grafana/grafana/labels/area/backend)
[area/frontend](/grafana/grafana/labels/area/frontend)
[backport](/grafana/grafana/labels/backport)
A backport PR
[no-changelog](/grafana/grafana/labels/no-changelog)
Skip including change in changelog/release notes

Projects

None yet

Milestone

 [**9.2.8**](/grafana/grafana/milestone/366 "9.2.8")

Development

Successfully merging this pull request may close these issues.

4 participants

[![@axelavargas](https://avatars.githubusercontent.com/u/239999?s=52&v=4)](/axelavargas) [![@ivanortegaalba](https://avatars.githubusercontent.com/u/5699976?s=52&v=4)](/ivanortegaalba) [![@zerok](https://avatars.githubusercontent.com/u/3782?s=52&v=4)](/zerok) [![@grafanabot](https://avatars.githubusercontent.com/u/43478413?s=52&v=4)](/grafanabot)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

