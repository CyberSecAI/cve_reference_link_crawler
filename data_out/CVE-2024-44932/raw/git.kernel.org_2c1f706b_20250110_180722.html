<!DOCTYPE html>
<html lang='en'>
<head>
<title>idpf: fix UAFs when destroying the queues - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='290f1c033281c1a502a3cd1c53c3a549259c491f'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=290f1c033281c1a502a3cd1c53c3a549259c491f'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=290f1c033281c1a502a3cd1c53c3a549259c491f'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=290f1c033281c1a502a3cd1c53c3a549259c491f'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=290f1c033281c1a502a3cd1c53c3a549259c491f'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='290f1c033281c1a502a3cd1c53c3a549259c491f'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='290f1c033281c1a502a3cd1c53c3a549259c491f'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Alexander Lobakin &lt;aleksander.lobakin@intel.com&gt;</td><td class='right'>2024-08-06 15:09:22 -0700</td></tr>
<tr><th>committer</th><td>Jakub Kicinski &lt;kuba@kernel.org&gt;</td><td class='right'>2024-08-07 20:26:55 -0700</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=290f1c033281c1a502a3cd1c53c3a549259c491f'>290f1c033281c1a502a3cd1c53c3a549259c491f</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=290f1c033281c1a502a3cd1c53c3a549259c491f'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=290f1c033281c1a502a3cd1c53c3a549259c491f'>56c611b4a2e3c0368b34cc718f98522f8bea48cd</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3cc88e8405b8d55e0ff035e31971aadd6baee2b6'>3cc88e8405b8d55e0ff035e31971aadd6baee2b6</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=290f1c033281c1a502a3cd1c53c3a549259c491f&amp;id2=3cc88e8405b8d55e0ff035e31971aadd6baee2b6'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-290f1c033281c1a502a3cd1c53c3a549259c491f.tar.gz'>linux-290f1c033281c1a502a3cd1c53c3a549259c491f.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>idpf: fix UAFs when destroying the queues</div><div class='commit-msg'>The second tagged commit started sometimes (very rarely, but possible)
throwing WARNs from
net/core/page_pool.c:page_pool_disable_direct_recycling().
Turned out idpf frees interrupt vectors with embedded NAPIs *before*
freeing the queues making page_pools' NAPI pointers lead to freed
memory before these pools are destroyed by libeth.
It's not clear whether there are other accesses to the freed vectors
when destroying the queues, but anyway, we usually free queue/interrupt
vectors only when the queues are destroyed and the NAPIs are guaranteed
to not be referenced anywhere.

Invert the allocation and freeing logic making queue/interrupt vectors
be allocated first and freed last. Vectors don't require queues to be
present, so this is safe. Additionally, this change allows to remove
that useless queue-&gt;q_vector pointer cleanup, as vectors are still
valid when freeing the queues (+ both are freed within one function,
so it's not clear why nullify the pointers at all).

Fixes: 1c325aac10a8 ("idpf: configure resources for TX queues")
Fixes: 90912f9f4f2d ("idpf: convert header split mode to libeth + napi_build_skb()")
Reported-by: Michal Kubiak &lt;michal.kubiak@intel.com&gt;
Signed-off-by: Alexander Lobakin &lt;aleksander.lobakin@intel.com&gt;
Reviewed-by: Simon Horman &lt;horms@kernel.org&gt;
Tested-by: Krishneil Singh &lt;krishneil.k.singh@intel.com&gt;
Signed-off-by: Tony Nguyen &lt;anthony.l.nguyen@intel.com&gt;
Link: <a href="https://patch.msgid.link/20240806220923.3359860-4-anthony.l.nguyen@intel.com">https://patch.msgid.link/20240806220923.3359860-4-anthony.l.nguyen@intel.com</a>
Signed-off-by: Jakub Kicinski &lt;kuba@kernel.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=290f1c033281c1a502a3cd1c53c3a549259c491f'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/idpf/idpf_lib.c?id=290f1c033281c1a502a3cd1c53c3a549259c491f'>drivers/net/ethernet/intel/idpf/idpf_lib.c</a></td><td class='right'>24</td><td class='graph'><table summary='file diffstat' width='24%'><tr><td class='add' style='width: 50.0%;'/><td class='rem' style='width: 50.0%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/idpf/idpf_txrx.c?id=290f1c033281c1a502a3cd1c53c3a549259c491f'>drivers/net/ethernet/intel/idpf/idpf_txrx.c</a></td><td class='right'>24</td><td class='graph'><table summary='file diffstat' width='24%'><tr><td class='add' style='width: 4.2%;'/><td class='rem' style='width: 95.8%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>2 files changed, 13 insertions, 35 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/drivers/net/ethernet/intel/idpf/idpf_lib.c b/drivers/net/ethernet/intel/idpf/idpf_lib.c<br/>index 10b884dd347586..0b6c8fd5bc90f7 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/idpf/idpf_lib.c?id=3cc88e8405b8d55e0ff035e31971aadd6baee2b6'>drivers/net/ethernet/intel/idpf/idpf_lib.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/idpf/idpf_lib.c?id=290f1c033281c1a502a3cd1c53c3a549259c491f'>drivers/net/ethernet/intel/idpf/idpf_lib.c</a></div><div class='hunk'>@@ -900,8 +900,8 @@ static void idpf_vport_stop(struct idpf_vport *vport)</div><div class='ctx'> </div><div class='ctx'> 	vport-&gt;link_up = false;</div><div class='ctx'> 	idpf_vport_intr_deinit(vport);</div><div class='del'>-	idpf_vport_intr_rel(vport);</div><div class='ctx'> 	idpf_vport_queues_rel(vport);</div><div class='add'>+	idpf_vport_intr_rel(vport);</div><div class='ctx'> 	np-&gt;state = __IDPF_VPORT_DOWN;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='hunk'>@@ -1349,43 +1349,43 @@ static int idpf_vport_open(struct idpf_vport *vport)</div><div class='ctx'> 	/* we do not allow interface up just yet */</div><div class='ctx'> 	netif_carrier_off(vport-&gt;netdev);</div><div class='ctx'> </div><div class='del'>-	err = idpf_vport_queues_alloc(vport);</div><div class='del'>-	if (err)</div><div class='del'>-		return err;</div><div class='del'>-</div><div class='ctx'> 	err = idpf_vport_intr_alloc(vport);</div><div class='ctx'> 	if (err) {</div><div class='ctx'> 		dev_err(&amp;adapter-&gt;pdev-&gt;dev, "Failed to allocate interrupts for vport %u: %d\n",</div><div class='ctx'> 			vport-&gt;vport_id, err);</div><div class='del'>-		goto queues_rel;</div><div class='add'>+		return err;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='add'>+	err = idpf_vport_queues_alloc(vport);</div><div class='add'>+	if (err)</div><div class='add'>+		goto intr_rel;</div><div class='add'>+</div><div class='ctx'> 	err = idpf_vport_queue_ids_init(vport);</div><div class='ctx'> 	if (err) {</div><div class='ctx'> 		dev_err(&amp;adapter-&gt;pdev-&gt;dev, "Failed to initialize queue ids for vport %u: %d\n",</div><div class='ctx'> 			vport-&gt;vport_id, err);</div><div class='del'>-		goto intr_rel;</div><div class='add'>+		goto queues_rel;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	err = idpf_vport_intr_init(vport);</div><div class='ctx'> 	if (err) {</div><div class='ctx'> 		dev_err(&amp;adapter-&gt;pdev-&gt;dev, "Failed to initialize interrupts for vport %u: %d\n",</div><div class='ctx'> 			vport-&gt;vport_id, err);</div><div class='del'>-		goto intr_rel;</div><div class='add'>+		goto queues_rel;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	err = idpf_rx_bufs_init_all(vport);</div><div class='ctx'> 	if (err) {</div><div class='ctx'> 		dev_err(&amp;adapter-&gt;pdev-&gt;dev, "Failed to initialize RX buffers for vport %u: %d\n",</div><div class='ctx'> 			vport-&gt;vport_id, err);</div><div class='del'>-		goto intr_rel;</div><div class='add'>+		goto queues_rel;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	err = idpf_queue_reg_init(vport);</div><div class='ctx'> 	if (err) {</div><div class='ctx'> 		dev_err(&amp;adapter-&gt;pdev-&gt;dev, "Failed to initialize queue registers for vport %u: %d\n",</div><div class='ctx'> 			vport-&gt;vport_id, err);</div><div class='del'>-		goto intr_rel;</div><div class='add'>+		goto queues_rel;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	idpf_rx_init_buf_tail(vport);</div><div class='hunk'>@@ -1452,10 +1452,10 @@ unmap_queue_vectors:</div><div class='ctx'> 	idpf_send_map_unmap_queue_vector_msg(vport, false);</div><div class='ctx'> intr_deinit:</div><div class='ctx'> 	idpf_vport_intr_deinit(vport);</div><div class='del'>-intr_rel:</div><div class='del'>-	idpf_vport_intr_rel(vport);</div><div class='ctx'> queues_rel:</div><div class='ctx'> 	idpf_vport_queues_rel(vport);</div><div class='add'>+intr_rel:</div><div class='add'>+	idpf_vport_intr_rel(vport);</div><div class='ctx'> </div><div class='ctx'> 	return err;</div><div class='ctx'> }</div><div class='head'>diff --git a/drivers/net/ethernet/intel/idpf/idpf_txrx.c b/drivers/net/ethernet/intel/idpf/idpf_txrx.c<br/>index a2f9f252694aa9..585c3dadd9bfac 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/idpf/idpf_txrx.c?id=3cc88e8405b8d55e0ff035e31971aadd6baee2b6'>drivers/net/ethernet/intel/idpf/idpf_txrx.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/idpf/idpf_txrx.c?id=290f1c033281c1a502a3cd1c53c3a549259c491f'>drivers/net/ethernet/intel/idpf/idpf_txrx.c</a></div><div class='hunk'>@@ -3576,9 +3576,7 @@ static void idpf_vport_intr_napi_dis_all(struct idpf_vport *vport)</div><div class='ctx'>  */</div><div class='ctx'> void idpf_vport_intr_rel(struct idpf_vport *vport)</div><div class='ctx'> {</div><div class='del'>-	int i, j, v_idx;</div><div class='del'>-</div><div class='del'>-	for (v_idx = 0; v_idx &lt; vport-&gt;num_q_vectors; v_idx++) {</div><div class='add'>+	for (u32 v_idx = 0; v_idx &lt; vport-&gt;num_q_vectors; v_idx++) {</div><div class='ctx'> 		struct idpf_q_vector *q_vector = &amp;vport-&gt;q_vectors[v_idx];</div><div class='ctx'> </div><div class='ctx'> 		kfree(q_vector-&gt;complq);</div><div class='hunk'>@@ -3593,26 +3591,6 @@ void idpf_vport_intr_rel(struct idpf_vport *vport)</div><div class='ctx'> 		free_cpumask_var(q_vector-&gt;affinity_mask);</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='del'>-	/* Clean up the mapping of queues to vectors */</div><div class='del'>-	for (i = 0; i &lt; vport-&gt;num_rxq_grp; i++) {</div><div class='del'>-		struct idpf_rxq_group *rx_qgrp = &amp;vport-&gt;rxq_grps[i];</div><div class='del'>-</div><div class='del'>-		if (idpf_is_queue_model_split(vport-&gt;rxq_model))</div><div class='del'>-			for (j = 0; j &lt; rx_qgrp-&gt;splitq.num_rxq_sets; j++)</div><div class='del'>-				rx_qgrp-&gt;splitq.rxq_sets[j]-&gt;rxq.q_vector = NULL;</div><div class='del'>-		else</div><div class='del'>-			for (j = 0; j &lt; rx_qgrp-&gt;singleq.num_rxq; j++)</div><div class='del'>-				rx_qgrp-&gt;singleq.rxqs[j]-&gt;q_vector = NULL;</div><div class='del'>-	}</div><div class='del'>-</div><div class='del'>-	if (idpf_is_queue_model_split(vport-&gt;txq_model))</div><div class='del'>-		for (i = 0; i &lt; vport-&gt;num_txq_grp; i++)</div><div class='del'>-			vport-&gt;txq_grps[i].complq-&gt;q_vector = NULL;</div><div class='del'>-	else</div><div class='del'>-		for (i = 0; i &lt; vport-&gt;num_txq_grp; i++)</div><div class='del'>-			for (j = 0; j &lt; vport-&gt;txq_grps[i].num_txq; j++)</div><div class='del'>-				vport-&gt;txq_grps[i].txqs[j]-&gt;q_vector = NULL;</div><div class='del'>-</div><div class='ctx'> 	kfree(vport-&gt;q_vectors);</div><div class='ctx'> 	vport-&gt;q_vectors = NULL;</div><div class='ctx'> }</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-10 18:05:59 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
