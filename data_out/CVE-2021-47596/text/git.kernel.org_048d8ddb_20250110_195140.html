

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4f4a353f6fe033807cd026a5de81c67469ff19b0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4f4a353f6fe033807cd026a5de81c67469ff19b0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4f4a353f6fe033807cd026a5de81c67469ff19b0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4f4a353f6fe033807cd026a5de81c67469ff19b0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jie Wang <wangjie125@huawei.com> | 2021-12-10 21:09:33 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-22 09:32:40 +0100 |
| commit | [4f4a353f6fe033807cd026a5de81c67469ff19b0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4f4a353f6fe033807cd026a5de81c67469ff19b0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4f4a353f6fe033807cd026a5de81c67469ff19b0)) | |
| tree | [49f856eaa1869c197dca4909fb533e2df2e20028](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4f4a353f6fe033807cd026a5de81c67469ff19b0) | |
| parent | [a4377575d2e9017abf393bdfb3ef8d19071fabcc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a4377575d2e9017abf393bdfb3ef8d19071fabcc) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4f4a353f6fe033807cd026a5de81c67469ff19b0&id2=a4377575d2e9017abf393bdfb3ef8d19071fabcc)) | |
| download | [linux-4f4a353f6fe033807cd026a5de81c67469ff19b0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4f4a353f6fe033807cd026a5de81c67469ff19b0.tar.gz) | |

net: hns3: fix use-after-free bug in hclgevf\_send\_mbx\_msg[ Upstream commit 27cbf64a766e86f068ce6214f04c00ceb4db1af4 ]
Currently, the hns3\_remove function firstly uninstall client instance,
and then uninstall acceletion engine device. The netdevice is freed in
client instance uninstall process, but acceletion engine device uninstall
process still use it to trace runtime information. This causes a use after
free problem.
So fixes it by check the instance register state to avoid use after free.
Fixes: d8355240cf8f ("net: hns3: add trace event support for PF/VF mailbox")
Signed-off-by: Jie Wang <wangjie125@huawei.com>
Signed-off-by: Guangbin Huang <huangguangbin2@huawei.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4f4a353f6fe033807cd026a5de81c67469ff19b0)

| -rw-r--r-- | [drivers/net/ethernet/hisilicon/hns3/hns3vf/hclgevf\_mbx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/hisilicon/hns3/hns3vf/hclgevf_mbx.c?id=4f4a353f6fe033807cd026a5de81c67469ff19b0) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/hisilicon/hns3/hns3vf/hclgevf\_mbx.c b/drivers/net/ethernet/hisilicon/hns3/hns3vf/hclgevf\_mbx.cindex fdc66fae096011..c5ac6ecf36e107 100644--- a/[drivers/net/ethernet/hisilicon/hns3/hns3vf/hclgevf\_mbx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/hisilicon/hns3/hns3vf/hclgevf_mbx.c?id=a4377575d2e9017abf393bdfb3ef8d19071fabcc)+++ b/[drivers/net/ethernet/hisilicon/hns3/hns3vf/hclgevf\_mbx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/hisilicon/hns3/hns3vf/hclgevf_mbx.c?id=4f4a353f6fe033807cd026a5de81c67469ff19b0)@@ -114,7 +114,8 @@ int hclgevf\_send\_mbx\_msg(struct hclgevf\_dev \*hdev,  memcpy(&req->msg, send\_msg, sizeof(struct hclge\_vf\_to\_pf\_msg)); - trace\_hclge\_vf\_mbx\_send(hdev, req);+ if (test\_bit(HCLGEVF\_STATE\_NIC\_REGISTERED, &hdev->state))+ trace\_hclge\_vf\_mbx\_send(hdev, req);  /\* synchronous send \*/ if (need\_resp) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 19:50:17 +0000

