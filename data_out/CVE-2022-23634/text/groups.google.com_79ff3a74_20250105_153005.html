[![](https://fonts.gstatic.com/s/i/productlogos/groups/v9/web-48dp/logo_groups_color_1x_web_48dp.png)Groups](./my-groups "Groups")ConversationsAll groups and messagesSend feedback to GoogleHelpTraining[Sign in](https://accounts.google.com/ServiceLogin?hl=en&passive=true&continue=https://groups.google.com&ec=GAZA0AM)[Groups](./my-groups "Groups")
## ruby-security-ann

[Conversations](./g/ruby-security-ann)[About](./g/ruby-security-ann/about)[Privacy](https://policies.google.com/privacy?hl=en_US) • [Terms](https://policies.google.com/terms?hl=en_US)


# [CVE-2022-23633] Possible exposure of information vulnerability in Action Pack

 2,437 viewsSkip to first unread message![Aaron Patterson's profile photo](//lh3.googleusercontent.com/a-/ALV-UjW-cjpJlxBkCu46fImPqG7PKv1HTjuLf3Wue7LQbcjy_HpHm7WK=s40-c)
### Aaron Patterson

unread,Feb 11, 2022, 8:39:25 PM2/11/22Reply to authorSign in to reply to authorForwardSign in to forwardDeleteYou do not have permission to delete messages in this groupCopy linkReport messageShow original messageEither email addresses are anonymous for this group or you need the view member email addresses permission to view the original messageto oss-se...@lists.openwall.com, ruby-sec...@googlegroups.com, rubyonrail...@googlegroups.com## Impact

Under certain circumstances response bodies will not be closed, for example a bug in a webserver[1] or a bug in a Rack middleware. In the event a response is not notified of a close, ActionDispatch::Executor will not know to reset thread local state for the next request. This can lead to data being leaked to subsequent requests, especially when interacting with ActiveSupport::CurrentAttributes.

Upgrading to the FIXED versions of Rails will ensure mitigation if this issue even in the context of a buggy webserver or middleware implementation.

## Patches

To aid users who aren't able to upgrade immediately we have provided patches for
the two supported release series. They are in git-am format and consist of a
single changeset.

\* 5.2-information-leak.patch
\* 6.0-information-leak.patch
\* 6.1-information-leak.patch
\* 7.0-information-leak.patch

## Workarounds

Upgrading is highly recommended, but to work around this problem the following middleware can be used:

```
class GuardedExecutor < ActionDispatch::Executor
  def call(env)
    ensure\_completed!
    super
  end

  private

    def ensure\_completed!
      @executor.new.complete! if @executor.active?
    end
end

# Ensure the guard is inserted before ActionDispatch::Executor
Rails.application.configure do
  config.middleware.swap ActionDispatch::Executor, GuardedExecutor, executor
end
```

## Credits

Thanks to Jean Boussier for fixing this!

1. <https://github.com/puma/puma/pull/2812>

6.1-information-leak.patch[](https://groups.google.com/group/ruby-security-ann/attach/465903062642b/6.1-information-leak.patch?part=0.1)6.0-information-leak.patch[](https://groups.google.com/group/ruby-security-ann/attach/465903062642b/6.0-information-leak.patch?part=0.2)7.0-information-leak.patch[](https://groups.google.com/group/ruby-security-ann/attach/465903062642b/7.0-information-leak.patch?part=0.3)5.2-information-leak.patch[](https://groups.google.com/group/ruby-security-ann/attach/465903062642b/5.2-information-leak.patch?part=0.4)Reply allReply to authorForward0 new messages