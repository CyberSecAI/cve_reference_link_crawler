<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="generator" content="hypermail 3.0.0, see https://github.com/hypermail-project/hypermail/" />
<title>Ambiguity about how to deal with received fragments in URI from Willy Tarreau on 2023-07-27 (ietf-http-wg@w3.org from July to September 2023)</title>
<meta name="Author" content="Willy Tarreau (w&#x40;&#0049;&#0119;&#0116;&#0046;&#0101;&#0117;)" />
<meta name="Subject" content="Ambiguity about how to deal with received fragments in URI" />
<meta name="Date" content="2023-07-27" />
<link rel="stylesheet" title="Normal view" href="/assets/styles/public.css" />
<link rel="help" href="/Help/" />
<link rel="start" href="../" title="ietf-http-wg@w3.org archives" />
<script defer="defer" src="/assets/js/archives.js"></script>
</head>
<body class="message">
<header class="head">
<nav class="breadcrumb" id="upper">
<ul>
   <li><a href="https://www.w3.org/">W3C home</a></li>
   <li><a href="/">Mailing lists</a></li>
   <li><a href="../../">Public</a></li>
   <li><a href="../" rel="start">ietf-http-wg@w3.org</a></li>
   <li><a href="./" rel="contents">July to September 2023</a></li>
</ul>
</nav>
<h1>Ambiguity about how to deal with received fragments in URI</h1>
<!-- received="Thu Jul 27 09:05:14 2023" -->
<!-- isoreceived="20230727090514" -->
<!-- sent="Thu, 27 Jul 2023 11:05:07 +0200" -->
<!-- isosent="20230727090507" -->
<!-- name="Willy Tarreau" -->
<!-- email="w&#x40;&#0049;&#0119;&#0116;&#0046;&#0101;&#0117;" -->
<!-- subject="Ambiguity about how to deal with received fragments in URI" -->
<!-- id="ZMIzQ0piz23PymxB@1wt.eu" -->
<!-- charset="UTF-8" -->
<!-- expires="-1" -->
<nav id="navbar">
<ul class="links hmenu_container">
<li>
<span class="heading">This message</span>: <ul class="hmenu"><li><a href="#start" id="options1">Message body</a></li>
<li><a href="mailto:ietf-http-wg&#x40;&#0119;&#0051;&#0046;&#0111;&#0114;&#0103;?Subject=Re%3A%20Ambiguity%20about%20how%20to%20deal%20with%20received%20fragments%20in%20URI&amp;In-Reply-To=%3CZMIzQ0piz23PymxB%401wt.eu%3E&amp;References=%3CZMIzQ0piz23PymxB%401wt.eu%3E">Respond</a></li>
<li><a href="#options3">More options</a></li>
</ul></li>
<li>
<span class="heading">Related messages</span>: <ul class="hmenu">
<!-- unext="start" -->
<li><a href="0071.html">Next message</a></li>
<li><a href="0069.html">Previous message</a></li>
<!-- unextthread="start" -->
<li><a href="0071.html">Next in thread</a></li>
<li><a href="#replies">Replies</a></li>
<!-- ureply="end" -->
</ul></li>
</ul>
</nav>
</header>
<!-- body="start" -->
<main class="mail">
<ul class="headers" aria-label="message headers">
<li><span class="from">
<span class="heading">From</span>: Willy Tarreau &lt;<a href="mailto:w&#x40;&#0049;&#0119;&#0116;&#0046;&#0101;&#0117;?Subject=Re%3A%20Ambiguity%20about%20how%20to%20deal%20with%20received%20fragments%20in%20URI&amp;In-Reply-To=%3CZMIzQ0piz23PymxB%401wt.eu%3E&amp;References=%3CZMIzQ0piz23PymxB%401wt.eu%3E">w&#x40;&#0049;&#0119;&#0116;&#0046;&#0101;&#0117;</a>&gt;
</span></li>
<li><span class="date"><span class="heading">Date</span>: Thu, 27 Jul 2023 11:05:07 +0200</span></li>
<li><span class="to"><span class="heading">To</span>: <a href="mailto:ietf-http-wg&#x40;&#0119;&#0051;&#0046;&#0111;&#0114;&#0103;?Subject=Re%3A%20Ambiguity%20about%20how%20to%20deal%20with%20received%20fragments%20in%20URI&amp;In-Reply-To=%3CZMIzQ0piz23PymxB%401wt.eu%3E&amp;References=%3CZMIzQ0piz23PymxB%401wt.eu%3E">ietf-http-wg&#x40;&#0119;&#0051;&#0046;&#0111;&#0114;&#0103;</a>
</span></li>
<li><span class="message-id"><span class="heading">Message-ID</span>: &lt;ZMIzQ0piz23PymxB&#x40;&#0049;&#0119;&#0116;&#0046;&#0101;&#0117;&gt;
</span></li>
</ul>
<pre id="start" class="body">
Hello,

An haproxy user rightfully reported that we don't ignore the fragments in
the URIs we receive. While that's historically true and comes back from
the old days where any byte from one side would be passed to the other
side, I'm facing a dilemma about how to best deal with it.

Indeed, RFC9110 is pretty clear about the fact that URIs do not contain
the fragment component, and even refers to RFC3986 that omits it for
scheme-based absolute URIs. But as often, this only concerns senders and
does not suggest much about how to proceed on the receiver when that rule
is violated. I could be tempted to say that if a fragment is present, the
the rule is violated and I should just reject the request as bad with a
400. I tried various web servers (among which Apache and NGINX) and all
silently trim any received fragment, which leaves me with even more doubt
about the suitability of the 400 here...

We could also consider that we continue to accept it and just trim it
from the functions that extract it for internal processing, but that
would mean we'd continue to pass it to the server, which is contrary to
the rules imposed to a client (even though we're a gateway here, but
still we try hard to comply as much as possible and sometimes to repair
damaged protocol elements if needed and permitted).

We could also completely trim this one when receiving the request, and
probably match more closely what the few servers I've tested seem to do,
but given that we're not supposed to receive them, I'm wondering if we're
not hiding the dust under the carpet. It will also mean that they wouldn't
appear in logs anymore, preventing from observing them.

Thus I'd like to collect some opinions here from other implementers.
Are there any who reject requests containing fragments in the URI ? If
not, are there any good reasons for not doing so (e.g. clients caught
sending them from time to time in the past and situation nor re-evaluated
since; lack of clarity in older versions of the spec, etc) ?

Without strong support for rejecting these as invalid, I'm probably going
to silently fix these requests by trimming the fragment like others seem
to do, but I really do not like doing such things that hide interoperability
issues without a good reason first. We already have normalization rules
in place to either reject or trim, but they're currently opt-in so we
can't count on that to collect more feedback.

Thanks in advance,
Willy
</pre>
<p class="received"><span class="heading">Received on</span> Thursday, 27 July 2023 09:05:14 UTC</p>
</main>
<!-- body="end" -->
<footer class="foot">
<nav id="navbarfoot">
<ul class="links hmenu_container">
<li><span class="heading">This message</span>: <span class="message_body"><a href="#start">Message body</a></span></li>
<!-- lnext="start" -->
<li><span class="heading">Next message</span>: <a href="0071.html">Stefan Eissing: "Re: Ambiguity about how to deal with received fragments in URI"</a></li>
<li><span class="heading">Previous message</span>: <a href="0069.html">internet-drafts@ietf.org: "I-D Action: draft-ietf-httpbis-message-signatures-19.txt"</a></li>
<!-- lnextthread="start" -->
<li><span class="heading">Next in thread</span>: <a href="0071.html">Stefan Eissing: "Re: Ambiguity about how to deal with received fragments in URI"</a></li>
<li id="replies"><span class="heading">Reply</span>:  <a href="0071.html">Stefan Eissing: "Re: Ambiguity about how to deal with received fragments in URI"</a></li>
<li><span class="heading">Reply</span>:  <a href="0072.html">Mark Thomas: "Re: Ambiguity about how to deal with received fragments in URI"</a></li>
<li><span class="heading">Reply</span>:  <a href="0074.html">Ilari Liusvaara: "Re: Ambiguity about how to deal with received fragments in URI"</a></li>
<!-- lreply="end" -->
</ul>
<ul class="links hmenu_container">
<li id="options3"><span class="heading">Mail actions</span>: <ul class="hmenu"><li><a href="mailto:ietf-http-wg&#x40;&#0119;&#0051;&#0046;&#0111;&#0114;&#0103;?Subject=Re%3A%20Ambiguity%20about%20how%20to%20deal%20with%20received%20fragments%20in%20URI&amp;In-Reply-To=%3CZMIzQ0piz23PymxB%401wt.eu%3E&amp;References=%3CZMIzQ0piz23PymxB%401wt.eu%3E">respond to this message</a></li>
<li><a href="mailto:ietf-http-wg&#x40;&#0119;&#0051;&#0046;&#0111;&#0114;&#0103;">mail a new topic</a></li></ul></li>
<li><span class="heading">Contemporary messages sorted</span>: <ul class="hmenu"><li><a href="index.html#msg70">by date</a></li>
<li><a href="thread.html#msg70">by thread</a></li>
<li><a href="subject.html#msg70">by subject</a></li>
<li><a href="author.html#msg70">by author</a></li>
</ul></li>
<li><span class="heading">Help</span>: <ul class="hmenu">
    <li><a href="/Help/" rel="help">how to use the archives</a></li>
    <li><a href="https://www.w3.org/Search/Mail/Public/search?type-index=ietf-http-wg&amp;index-type=t">search the archives</a></li>
</ul>
</li>
</ul>
</nav>
<!-- trailer="footer" -->
<p class="colophon">
This archive was generated by <a href="https://github.com/hypermail-project/hypermail/">hypermail 3.0.0</a>: Thursday, 27 July 2023 09:05:15 UTC
</p>
</footer>
</body>
</html>
