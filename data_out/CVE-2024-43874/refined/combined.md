=== Content from git.kernel.org_380f3c7f_20250110_222325.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bbf2c94503f6a421ed9b79e300d8085810da765d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bbf2c94503f6a421ed9b79e300d8085810da765d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bbf2c94503f6a421ed9b79e300d8085810da765d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbf2c94503f6a421ed9b79e300d8085810da765d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kim Phillips <kim.phillips@amd.com> | 2024-06-04 12:47:39 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 09:00:55 +0200 |
| commit | [bbf2c94503f6a421ed9b79e300d8085810da765d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bbf2c94503f6a421ed9b79e300d8085810da765d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bbf2c94503f6a421ed9b79e300d8085810da765d)) | |
| tree | [f3d05af7d9c29e21bbff7199d3993845084bd070](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bbf2c94503f6a421ed9b79e300d8085810da765d) | |
| parent | [ee39384ee787e86e9db4efb843818ef0ea9cb8ae](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee39384ee787e86e9db4efb843818ef0ea9cb8ae) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbf2c94503f6a421ed9b79e300d8085810da765d&id2=ee39384ee787e86e9db4efb843818ef0ea9cb8ae)) | |
| download | [linux-bbf2c94503f6a421ed9b79e300d8085810da765d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bbf2c94503f6a421ed9b79e300d8085810da765d.tar.gz) | |

crypto: ccp - Fix null pointer dereference in \_\_sev\_snp\_shutdown\_lockedcommit 468e3295774d0edce15f4ae475913b5076dd4f40 upstream.
Fix a null pointer dereference induced by DEBUG\_TEST\_DRIVER\_REMOVE.
Return from \_\_sev\_snp\_shutdown\_locked() if the psp\_device or the
sev\_device structs are not initialized. Without the fix, the driver will
produce the following splat:
ccp 0000:55:00.5: enabling device (0000 -> 0002)
ccp 0000:55:00.5: sev enabled
ccp 0000:55:00.5: psp enabled
BUG: kernel NULL pointer dereference, address: 00000000000000f0
#PF: supervisor read access in kernel mode
#PF: error\_code(0x0000) - not-present page
PGD 0 P4D 0
Oops: 0000 [#1] PREEMPT SMP DEBUG\_PAGEALLOC NOPTI
CPU: 262 PID: 1 Comm: swapper/0 Not tainted 6.9.0-rc1+ #29
RIP: 0010:\_\_sev\_snp\_shutdown\_locked+0x2e/0x150
Code: 00 55 48 89 e5 41 57 41 56 41 54 53 48 83 ec 10 41 89 f7 49 89 fe 65 48 8b 04 25 28 00 00 00 48 89 45 d8 48 8b 05 6a 5a 7f 06 <4c> 8b a0 f0 00 00 00 41 0f b6 9c 24 a2 00 00 00 48 83 fb 02 0f 83
RSP: 0018:ffffb2ea4014b7b8 EFLAGS: 00010286
RAX: 0000000000000000 RBX: ffff9e4acd2e0a28 RCX: 0000000000000000
RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffffb2ea4014b808
RBP: ffffb2ea4014b7e8 R08: 0000000000000106 R09: 000000000003d9c0
R10: 0000000000000001 R11: ffffffffa39ff070 R12: ffff9e49d40590c8
R13: 0000000000000000 R14: ffffb2ea4014b808 R15: 0000000000000000
FS: 0000000000000000(0000) GS:ffff9e58b1e00000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00000000000000f0 CR3: 0000000418a3e001 CR4: 0000000000770ef0
PKRU: 55555554
Call Trace:
<TASK>
? \_\_die\_body+0x6f/0xb0
? \_\_die+0xcc/0xf0
? page\_fault\_oops+0x330/0x3a0
? save\_trace+0x2a5/0x360
? do\_user\_addr\_fault+0x583/0x630
? exc\_page\_fault+0x81/0x120
? asm\_exc\_page\_fault+0x2b/0x30
? \_\_sev\_snp\_shutdown\_locked+0x2e/0x150
\_\_sev\_firmware\_shutdown+0x349/0x5b0
? pm\_runtime\_barrier+0x66/0xe0
sev\_dev\_destroy+0x34/0xb0
psp\_dev\_destroy+0x27/0x60
sp\_destroy+0x39/0x90
sp\_pci\_remove+0x22/0x60
pci\_device\_remove+0x4e/0x110
really\_probe+0x271/0x4e0
\_\_driver\_probe\_device+0x8f/0x160
driver\_probe\_device+0x24/0x120
\_\_driver\_attach+0xc7/0x280
? driver\_attach+0x30/0x30
bus\_for\_each\_dev+0x10d/0x130
driver\_attach+0x22/0x30
bus\_add\_driver+0x171/0x2b0
? unaccepted\_memory\_init\_kdump+0x20/0x20
driver\_register+0x67/0x100
\_\_pci\_register\_driver+0x83/0x90
sp\_pci\_init+0x22/0x30
sp\_mod\_init+0x13/0x30
do\_one\_initcall+0xb8/0x290
? sched\_clock\_noinstr+0xd/0x10
? local\_clock\_noinstr+0x3e/0x100
? stack\_depot\_save\_flags+0x21e/0x6a0
? local\_clock+0x1c/0x60
? stack\_depot\_save\_flags+0x21e/0x6a0
? sched\_clock\_noinstr+0xd/0x10
? local\_clock\_noinstr+0x3e/0x100
? \_\_lock\_acquire+0xd90/0xe30
? sched\_clock\_noinstr+0xd/0x10
? local\_clock\_noinstr+0x3e/0x100
? \_\_create\_object+0x66/0x100
? local\_clock+0x1c/0x60
? \_\_create\_object+0x66/0x100
? parameq+0x1b/0x90
? parse\_one+0x6d/0x1d0
? parse\_args+0xd7/0x1f0
? do\_initcall\_level+0x180/0x180
do\_initcall\_level+0xb0/0x180
do\_initcalls+0x60/0xa0
? kernel\_init+0x1f/0x1d0
do\_basic\_setup+0x41/0x50
kernel\_init\_freeable+0x1ac/0x230
? rest\_init+0x1f0/0x1f0
kernel\_init+0x1f/0x1d0
? rest\_init+0x1f0/0x1f0
ret\_from\_fork+0x3d/0x50
? rest\_init+0x1f0/0x1f0
ret\_from\_fork\_asm+0x11/0x20
</TASK>
Modules linked in:
CR2: 00000000000000f0
---[ end trace 0000000000000000 ]---
RIP: 0010:\_\_sev\_snp\_shutdown\_locked+0x2e/0x150
Code: 00 55 48 89 e5 41 57 41 56 41 54 53 48 83 ec 10 41 89 f7 49 89 fe 65 48 8b 04 25 28 00 00 00 48 89 45 d8 48 8b 05 6a 5a 7f 06 <4c> 8b a0 f0 00 00 00 41 0f b6 9c 24 a2 00 00 00 48 83 fb 02 0f 83
RSP: 0018:ffffb2ea4014b7b8 EFLAGS: 00010286
RAX: 0000000000000000 RBX: ffff9e4acd2e0a28 RCX: 0000000000000000
RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffffb2ea4014b808
RBP: ffffb2ea4014b7e8 R08: 0000000000000106 R09: 000000000003d9c0
R10: 0000000000000001 R11: ffffffffa39ff070 R12: ffff9e49d40590c8
R13: 0000000000000000 R14: ffffb2ea4014b808 R15: 0000000000000000
FS: 0000000000000000(0000) GS:ffff9e58b1e00000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00000000000000f0 CR3: 0000000418a3e001 CR4: 0000000000770ef0
PKRU: 55555554
Kernel panic - not syncing: Fatal exception
Kernel Offset: 0x1fc00000 from 0xffffffff81000000 (relocation range: 0xffffffff80000000-0xffffffffbfffffff)
Fixes: 1ca5614b84ee ("crypto: ccp: Add support to initialize the AMD-SP for SEV-SNP")
Cc: stable@vger.kernel.org
Signed-off-by: Kim Phillips <kim.phillips@amd.com>
Reviewed-by: Liam Merwick <liam.merwick@oracle.com>
Reviewed-by: Mario Limonciello <mario.limonciello@amd.com>
Reviewed-by: John Allen <john.allen@amd.com>
Reviewed-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbf2c94503f6a421ed9b79e300d8085810da765d)

| -rw-r--r-- | [drivers/crypto/ccp/sev-dev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/crypto/ccp/sev-dev.c?id=bbf2c94503f6a421ed9b79e300d8085810da765d) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/crypto/ccp/sev-dev.c b/drivers/crypto/ccp/sev-dev.cindex 2102377f727b1e..1912bee22dd4a6 100644--- a/[drivers/crypto/ccp/sev-dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/crypto/ccp/sev-dev.c?id=ee39384ee787e86e9db4efb843818ef0ea9cb8ae)+++ b/[drivers/crypto/ccp/sev-dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/crypto/ccp/sev-dev.c?id=bbf2c94503f6a421ed9b79e300d8085810da765d)@@ -1642,10 +1642,16 @@ fw\_err:  static int \_\_sev\_snp\_shutdown\_locked(int \*error, bool panic) {- struct sev\_device \*sev = psp\_master->sev\_data;+ struct psp\_device \*psp = psp\_master;+ struct sev\_device \*sev; struct sev\_data\_snp\_shutdown\_ex data; int ret; + if (!psp || !psp->sev\_data)+ return 0;++ sev = psp->sev\_data;+ if (!sev->snp\_initialized) return 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:22:02 +0000



=== Content from git.kernel.org_2d1a0768_20250110_222324.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=468e3295774d0edce15f4ae475913b5076dd4f40)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=468e3295774d0edce15f4ae475913b5076dd4f40)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=468e3295774d0edce15f4ae475913b5076dd4f40)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=468e3295774d0edce15f4ae475913b5076dd4f40)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kim Phillips <kim.phillips@amd.com> | 2024-06-04 12:47:39 -0500 |
| --- | --- | --- |
| committer | Herbert Xu <herbert@gondor.apana.org.au> | 2024-06-16 13:41:53 +0800 |
| commit | [468e3295774d0edce15f4ae475913b5076dd4f40](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=468e3295774d0edce15f4ae475913b5076dd4f40) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=468e3295774d0edce15f4ae475913b5076dd4f40)) | |
| tree | [57106cf5c202cfd6dbe611e99ae273dc8f05c141](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=468e3295774d0edce15f4ae475913b5076dd4f40) | |
| parent | [6d4e1993a30539f556da2ebd36f1936c583eb812](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6d4e1993a30539f556da2ebd36f1936c583eb812) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=468e3295774d0edce15f4ae475913b5076dd4f40&id2=6d4e1993a30539f556da2ebd36f1936c583eb812)) | |
| download | [linux-468e3295774d0edce15f4ae475913b5076dd4f40.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-468e3295774d0edce15f4ae475913b5076dd4f40.tar.gz) | |

crypto: ccp - Fix null pointer dereference in \_\_sev\_snp\_shutdown\_lockedFix a null pointer dereference induced by DEBUG\_TEST\_DRIVER\_REMOVE.
Return from \_\_sev\_snp\_shutdown\_locked() if the psp\_device or the
sev\_device structs are not initialized. Without the fix, the driver will
produce the following splat:
ccp 0000:55:00.5: enabling device (0000 -> 0002)
ccp 0000:55:00.5: sev enabled
ccp 0000:55:00.5: psp enabled
BUG: kernel NULL pointer dereference, address: 00000000000000f0
#PF: supervisor read access in kernel mode
#PF: error\_code(0x0000) - not-present page
PGD 0 P4D 0
Oops: 0000 [#1] PREEMPT SMP DEBUG\_PAGEALLOC NOPTI
CPU: 262 PID: 1 Comm: swapper/0 Not tainted 6.9.0-rc1+ #29
RIP: 0010:\_\_sev\_snp\_shutdown\_locked+0x2e/0x150
Code: 00 55 48 89 e5 41 57 41 56 41 54 53 48 83 ec 10 41 89 f7 49 89 fe 65 48 8b 04 25 28 00 00 00 48 89 45 d8 48 8b 05 6a 5a 7f 06 <4c> 8b a0 f0 00 00 00 41 0f b6 9c 24 a2 00 00 00 48 83 fb 02 0f 83
RSP: 0018:ffffb2ea4014b7b8 EFLAGS: 00010286
RAX: 0000000000000000 RBX: ffff9e4acd2e0a28 RCX: 0000000000000000
RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffffb2ea4014b808
RBP: ffffb2ea4014b7e8 R08: 0000000000000106 R09: 000000000003d9c0
R10: 0000000000000001 R11: ffffffffa39ff070 R12: ffff9e49d40590c8
R13: 0000000000000000 R14: ffffb2ea4014b808 R15: 0000000000000000
FS: 0000000000000000(0000) GS:ffff9e58b1e00000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00000000000000f0 CR3: 0000000418a3e001 CR4: 0000000000770ef0
PKRU: 55555554
Call Trace:
<TASK>
? \_\_die\_body+0x6f/0xb0
? \_\_die+0xcc/0xf0
? page\_fault\_oops+0x330/0x3a0
? save\_trace+0x2a5/0x360
? do\_user\_addr\_fault+0x583/0x630
? exc\_page\_fault+0x81/0x120
? asm\_exc\_page\_fault+0x2b/0x30
? \_\_sev\_snp\_shutdown\_locked+0x2e/0x150
\_\_sev\_firmware\_shutdown+0x349/0x5b0
? pm\_runtime\_barrier+0x66/0xe0
sev\_dev\_destroy+0x34/0xb0
psp\_dev\_destroy+0x27/0x60
sp\_destroy+0x39/0x90
sp\_pci\_remove+0x22/0x60
pci\_device\_remove+0x4e/0x110
really\_probe+0x271/0x4e0
\_\_driver\_probe\_device+0x8f/0x160
driver\_probe\_device+0x24/0x120
\_\_driver\_attach+0xc7/0x280
? driver\_attach+0x30/0x30
bus\_for\_each\_dev+0x10d/0x130
driver\_attach+0x22/0x30
bus\_add\_driver+0x171/0x2b0
? unaccepted\_memory\_init\_kdump+0x20/0x20
driver\_register+0x67/0x100
\_\_pci\_register\_driver+0x83/0x90
sp\_pci\_init+0x22/0x30
sp\_mod\_init+0x13/0x30
do\_one\_initcall+0xb8/0x290
? sched\_clock\_noinstr+0xd/0x10
? local\_clock\_noinstr+0x3e/0x100
? stack\_depot\_save\_flags+0x21e/0x6a0
? local\_clock+0x1c/0x60
? stack\_depot\_save\_flags+0x21e/0x6a0
? sched\_clock\_noinstr+0xd/0x10
? local\_clock\_noinstr+0x3e/0x100
? \_\_lock\_acquire+0xd90/0xe30
? sched\_clock\_noinstr+0xd/0x10
? local\_clock\_noinstr+0x3e/0x100
? \_\_create\_object+0x66/0x100
? local\_clock+0x1c/0x60
? \_\_create\_object+0x66/0x100
? parameq+0x1b/0x90
? parse\_one+0x6d/0x1d0
? parse\_args+0xd7/0x1f0
? do\_initcall\_level+0x180/0x180
do\_initcall\_level+0xb0/0x180
do\_initcalls+0x60/0xa0
? kernel\_init+0x1f/0x1d0
do\_basic\_setup+0x41/0x50
kernel\_init\_freeable+0x1ac/0x230
? rest\_init+0x1f0/0x1f0
kernel\_init+0x1f/0x1d0
? rest\_init+0x1f0/0x1f0
ret\_from\_fork+0x3d/0x50
? rest\_init+0x1f0/0x1f0
ret\_from\_fork\_asm+0x11/0x20
</TASK>
Modules linked in:
CR2: 00000000000000f0
---[ end trace 0000000000000000 ]---
RIP: 0010:\_\_sev\_snp\_shutdown\_locked+0x2e/0x150
Code: 00 55 48 89 e5 41 57 41 56 41 54 53 48 83 ec 10 41 89 f7 49 89 fe 65 48 8b 04 25 28 00 00 00 48 89 45 d8 48 8b 05 6a 5a 7f 06 <4c> 8b a0 f0 00 00 00 41 0f b6 9c 24 a2 00 00 00 48 83 fb 02 0f 83
RSP: 0018:ffffb2ea4014b7b8 EFLAGS: 00010286
RAX: 0000000000000000 RBX: ffff9e4acd2e0a28 RCX: 0000000000000000
RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffffb2ea4014b808
RBP: ffffb2ea4014b7e8 R08: 0000000000000106 R09: 000000000003d9c0
R10: 0000000000000001 R11: ffffffffa39ff070 R12: ffff9e49d40590c8
R13: 0000000000000000 R14: ffffb2ea4014b808 R15: 0000000000000000
FS: 0000000000000000(0000) GS:ffff9e58b1e00000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00000000000000f0 CR3: 0000000418a3e001 CR4: 0000000000770ef0
PKRU: 55555554
Kernel panic - not syncing: Fatal exception
Kernel Offset: 0x1fc00000 from 0xffffffff81000000 (relocation range: 0xffffffff80000000-0xffffffffbfffffff)
Fixes: 1ca5614b84ee ("crypto: ccp: Add support to initialize the AMD-SP for SEV-SNP")
Cc: stable@vger.kernel.org
Signed-off-by: Kim Phillips <kim.phillips@amd.com>
Reviewed-by: Liam Merwick <liam.merwick@oracle.com>
Reviewed-by: Mario Limonciello <mario.limonciello@amd.com>
Reviewed-by: John Allen <john.allen@amd.com>
Reviewed-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=468e3295774d0edce15f4ae475913b5076dd4f40)

| -rw-r--r-- | [drivers/crypto/ccp/sev-dev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/crypto/ccp/sev-dev.c?id=468e3295774d0edce15f4ae475913b5076dd4f40) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/crypto/ccp/sev-dev.c b/drivers/crypto/ccp/sev-dev.cindex 2102377f727b1e..1912bee22dd4a6 100644--- a/[drivers/crypto/ccp/sev-dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/crypto/ccp/sev-dev.c?id=6d4e1993a30539f556da2ebd36f1936c583eb812)+++ b/[drivers/crypto/ccp/sev-dev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/crypto/ccp/sev-dev.c?id=468e3295774d0edce15f4ae475913b5076dd4f40)@@ -1642,10 +1642,16 @@ fw\_err:  static int \_\_sev\_snp\_shutdown\_locked(int \*error, bool panic) {- struct sev\_device \*sev = psp\_master->sev\_data;+ struct psp\_device \*psp = psp\_master;+ struct sev\_device \*sev; struct sev\_data\_snp\_shutdown\_ex data; int ret; + if (!psp || !psp->sev\_data)+ return 0;++ sev = psp->sev\_data;+ if (!sev->snp\_initialized) return 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:22:02 +0000


