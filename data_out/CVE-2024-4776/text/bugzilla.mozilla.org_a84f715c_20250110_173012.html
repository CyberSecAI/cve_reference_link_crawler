

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1887343)
* [XML](/show_bug.cgi?ctype=xml&id=1887343)

Closed
[Bug 1887343](/show_bug.cgi?id=1887343)
(CVE-2024-4776)

Opened 10 months ago
Closed 9 months ago

# Window may remain disabled after file dialog is shown in full-screen

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Window may remain disabled after file dialog is shown in full-screen

## Categories

### (Core :: Widget: Win32, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Widget%3A%20Win32#Widget%3A%20Win32)

Widget: Win32
▾

Core :: Widget: Win32
Mapping of cross platform widget interfaces to Win32 platform APIs.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Widget%3A%20Win32&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Widget%3A%20Win32&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Widget%3A%20Win32)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Firefox 125

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

126 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox126 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox126 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: Laraweron, Assigned: rkraesig)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/605ee8cd1c9a74704916c7bdc4e4865d?d=mm&size=40)  [rkraesig](/user_profile?user_id=699639)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d1c01b439cdad09c283ada379958e4ce?d=mm&size=40)  [Laraweron](/user_profile?user_id=580744)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/605ee8cd1c9a74704916c7bdc4e4865d?d=mm&size=40)  [rkraesig](/user_profile?user_id=699639)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

7 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: reporter-external, sec-low, Whiteboard: [adv-main126+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-4776

[Keywords:](/describekeywords.cgi)

[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main126+]

QA Whiteboard:

[qa-126b-p2]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [crash.html](/attachment.cgi?id=9392912)  [10 months ago](#c0)  [Raphael](/user_profile?user_id=580744)   1.22 KB, text/html |  | [Details](/attachment.cgi?id=9392912&action=edit) |
| --- | --- | --- |
| [Nightly 125.mp4](/attachment.cgi?id=9392954)  [10 months ago](#c4)  [Raphael](/user_profile?user_id=580744)   7.71 MB, video/mp4 |  | [Details](/attachment.cgi?id=9392954&action=edit) |
| [Bug 1887343 - Store only window-chrome style-flags when going fullscreen r?#win-reviewers](/attachment.cgi?id=9393901)  [10 months ago](#c11)  [Ray Kraesig [:rkraesig]](/user_profile?user_id=699639)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9393901&action=edit) | [Review](/attachment.cgi?id=9393901) |
| [advisory.txt](/attachment.cgi?id=9401136)  [8 months ago](#c15)  [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733)   180 bytes, text/plain |  | [Details](/attachment.cgi?id=9401136&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Raphael](/user_profile?user_id=580744)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1887343#c0)• 10 months ago |
|  | |

Attached file
[crash.html](attachment.cgi?id=9392912)
— [Details](attachment.cgi?id=9392912&action=edit)

User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36

Steps to reproduce:

Open the attachment

Double-click the area

Select the image

Press ESC

The Firefox browser version 126.0a1 completely freezes and does not respond to commands.

Report: <https://crash-stats.mozilla.org/report/index/4a5ad2e3-a855-42de-8227-fb7370240323#tab-details>

|  | [Raphael](/user_profile?user_id=580744)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1887343#c1)• 10 months ago |
|  | |

In Firefox ESR, no crashes have been found, as the provided exploit does not pose a threat. For the Firefox Nightly version 125.0a1, the exploit appears more convincing.

I also confirm the crash in version 124 Stable.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1887343#c2)• 10 months ago |
|  | |

Do you have the pref layers.gpu-process.crash-also-crashes-browser set to true? The stack suggests this is why it crashed, but [it appears to be false by default](https://searchfox.org/mozilla-central/rev/f61dded6dbbf0c42c68669cb2279deef6cb6a7be/modules/libpref/init/StaticPrefList.yaml#8105-8108). Crashing the GPU process is not great, but it isn't necessarily a security issue. Due to bad graphics drivers, the browser is expected to be able to deal with a crashing GPU process without the user noticing.

Flags: needinfo?(Laraweron)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1887343#c3)• 10 months ago |
|  | |

The steps to reproduce didn't quite work for me as described on MacOS. I did a double click, which caused it to go full screen, but then I had to click again to make the file selector appear. I tried a random cat image I found online, and the image appeared without any issue. When you say "the issue", do you mean a specific image causes this problems or a specific one?

The test case looks very DOM-y, but the stack makes it look like the GPU process crashed, so maybe this is more graphics.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1887343#a73680_406194)• 10 months ago |

Group: firefox-core-security → core-securityComponent: Untriaged → GraphicsProduct: Firefox → Core

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1887343#a73693_406194)• 10 months ago |

Group: core-security → gfx-core-security

|  | [Raphael](/user_profile?user_id=580744)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1887343#c4)• 10 months ago |
|  | |

Attached video
[Nightly 125.mp4](attachment.cgi?id=9392954)
— [Details](attachment.cgi?id=9392954&action=edit)

To reproduce the vulnerability, you need to press ESC, which causes a crash. I have added a video for clarification. I hid the error because the exploit itself can be reproduced in Firefox 125 to spoof the address bar.

<https://drive.google.com/file/d/1RY8e1dKW8Ye5a5ouAS6gkztSEHqyRV3v/view?usp=sharing>

Flags: needinfo?(Laraweron)

|  | [Raphael](/user_profile?user_id=580744)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1887343#c5)• 10 months ago |
|  | |

The graphics do not affect the crash; instead, something else breaks. It seems as though the file selection windows are not being unloaded and remain stuck in an invisible window. It is worth noting that the browser is unable to stop the process and unload the window on its own, and the only way to exit the browser is to forcefully terminate the process through the task manager. This behavior fits the description of a denial-of-service (DoS) attack.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1887343#a78608_406194)• 10 months ago |

Group: gfx-core-security → dom-core-securityComponent: Graphics → DOM: Core & HTML

|  | [Raphael](/user_profile?user_id=580744)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1887343#a81994_580744)• 10 months ago |

Summary: Crash @ mozilla::gfx::GPUProcessManager::OnProcessUnexpectedShutdown → File Selection window may become Invisible in fullscreen after pressing ESC

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1887343#c6)• 10 months ago |
|  | |

I still haven't been able to reproduce a crash, though I don't have that pref set so it might be crashing without me noticing.

Group: dom-core-securityKeywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1887343#c7)• 10 months ago |
|  | |

I was able to reproduce this a few times but it is not 100% reliable. I had to close the browser from task manager when I triggered the issue.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1887343#c8)• 10 months ago |
|  | |

Ray, could this be related to your Windows file picker work?

Flags: needinfo?(rkraesig)

|  | [Ray Kraesig [:rkraesig]](/user_profile?user_id=699639)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1887343#c9)• 10 months ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #8](/show_bug.cgi?id=1887343#c8 "RESOLVED FIXED - Window may remain disabled after file dialog is shown in full-screen"))

> Ray, could this be related to your Windows file picker work?

Yes, almost certainly. What appears to be happening here — although I don't yet know how or why — is that the window is still `WM_DISABLED` after the file dialog is dismissed. Other Firefox windows, if there were any open, are unaffected. That shouldn't cause a *crash*, though... and I haven't been able to induce one either.

@Raphael, just to check that this isn't a language issue — are you referring to the state Firefox is in after pressing ESC, where you can't interact with it and have to kill it, as "crashed"? Or have you been able to make Firefox disappear without using Task Manager?

Flags: needinfo?(rkraesig) → needinfo?(Laraweron)

|  | [Raphael](/user_profile?user_id=580744)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1887343#c10)• 10 months ago |
|  | |

i mistakenly believed that the browser was malfunctioning, it seemed like a failure. The crash was caused when I closed the browser through the task manager.

So far, I've only been able to reproduce the problem in Windows, it appears that other operating systems are not affected. This issue allows attackers to control the browser, possibly showing advertisements that cannot be closed (auto-playing videos, new windows, or redirects to other websites).

Flags: needinfo?(Laraweron)

|  | [Ray Kraesig [:rkraesig]](/user_profile?user_id=699639)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1887343#a421990_699639)• 10 months ago |

Assignee: nobody → rkraesigComponent: DOM: Core & HTML → Widget: Win32Summary: File Selection window may become Invisible in fullscreen after pressing ESC → Window may remain disabled after file dialog is shown in full-screen

|  | [Ray Kraesig [:rkraesig]](/user_profile?user_id=699639)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1887343#a423684_699639)• 10 months ago |

Status: UNCONFIRMED → NEWEver confirmed: true

|  | [Ray Kraesig [:rkraesig]](/user_profile?user_id=699639)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1887343#c11)• 10 months ago |
|  | |

Attached file
[Bug 1887343 - Store only window-chrome style-flags when going fullscreen r?#win-reviewers](attachment.cgi?id=9393901)
— [Details](attachment.cgi?id=9393901&action=edit)

When stripping and restoring window chrome, don't modify or retain any

flags other than window-chrome flags.

This also lets us remove a tiny bit of thirteen-year-old special-case

logic (dating back to [bug 629860](/show_bug.cgi?id=629860 "VERIFIED FIXED - Closing in Full Screen mode then Relaunching FF causes repaint issues")) which tried to fix up a different bit

of stale state.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1887343#a1142362_600971)• 9 months ago |

[Attachment #9393901](/attachment.cgi?id=9393901&action=edit "Bug 1887343 - Store only window-chrome style-flags when going fullscreen  r?#win-reviewers") -
Attachment description: Bug 1887343 - Only store window-chrome style-flags when going fullscreen r?#win-reviewers → Bug 1887343 - Store only window-chrome style-flags when going fullscreen r?#win-reviewers

|  | [Ray Kraesig [:rkraesig]](/user_profile?user_id=699639)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1887343#c12)• 9 months ago |
|  | |

It's worth documenting here that the issue was due to the fullscreen-entry logic saving, and then the fullscreen-exit logic restoring, the window-style flags on entry and exit into fullscreen mode. This unfortunately included `WS_DISABLED`, which it had no business fiddling with.

The solution is simply to cache and restore only those window-style flags which deal with window decorations that actually need to change when going fullscreen.

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1887343#c13)• 9 months ago |
|  | |

Pushed by rkraesig@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/29ce18e61ece>
Store only window-chrome style-flags when going fullscreen r=win-reviewers,handyman

|  | [Serban Stanca [:SerbanS]](/user_profile?user_id=713502) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1887343#c14)• 9 months ago |
| bugherder | |

<https://hg.mozilla.org/mozilla-central/rev/29ce18e61ece>

Status: NEW → RESOLVEDClosed: 9 months ago
[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 126 Branch

|  | [Bianca Hidecuti, Desktop Test Engineering [:bhidecuti]](/user_profile?user_id=713047) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1887343#a2120392_713047)• 9 months ago |

QA Whiteboard: [qa-126b-p2]

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1887343#a4094777_486733)• 8 months ago |

Whiteboard: [adv-main126+]

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1887343#c15)• 8 months ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9401136)
— [Details](attachment.cgi?id=9401136&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1887343#a4147707_578488)• 8 months ago |

Alias: CVE-2024-4776

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1887343#c16)• 7 months ago |
|  | |

Sorry for the burst of bugspam: filter on tinkling-glitter-filtrate

Adding `reporter-external` keyword to security bugs found by non-employees for accounting reasons

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1887343&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Raphael](/user_profile?user_id=580744)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

