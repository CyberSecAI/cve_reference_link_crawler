=== Content from dheatattack.gitlab.io_ed489dc2_20250111_023420.html ===

[D(HE)at Attack](/)

* [Summary](/summary/ "Summary page")
* [FAQ](/faq/ "FAQ page")
* [Mitigations](/mitigations/ "Mitigations page")
* [PoC Code](/dheater/ "PoC Code page")
* [Details](/details/ "Details page")
* [References](/references/ "References page")

# Technical Details

# How the attack works?

During a D(HE)at attack the malicious client initiates cryptographic handshakes pretending if it would support only the
[ephemeral variant](https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange#Ephemeral_and/or_static_keys) of
the [finite field](https://en.wikipedia.org/wiki/Finite_field) [Diffie-Hellman key agreement protocol](https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange) (DHE) triggering key pair generation and shared
secret calculation on the server-side. Both operations require the server to perform the compute-intensive
[modular exponentiation](https://en.wikipedia.org/wiki/Modular_exponentiation) calculations, while the malicious client
needing to use any significant computational resources.

![D(HE)at Attack](/images/dheat-attack-short.png)

Under normal circumstances both parties perform the same operations during the Diffie-Hellman key agreement (public key
generation, shared secret calculation) meaning that theoretically the computational cost is the same for the parties.
However, in practice, a malicious client can force a server to generate a public key by acting that it would support
only the Diffie-Hellman key agreement and would wait for the server’s public key to be sure that server has performed
the [expensive modular exponentiation](https://ieeexplore.ieee.org/document/10374117#sec2c), then it terminates the
connection. In the case of certain protocols (e.g., [TLS < 1.3](https://ieeexplore.ieee.org/document/10374117#sec4c2a))
an initial cryptographic handshake message is enough to be sent without the client’s public key.

Other protocols or protocol versions (e.g., [TLS 1.3](https://ieeexplore.ieee.org/document/10374117#sec4c2b), [SSH](https://ieeexplore.ieee.org/document/10374117#sec4c2d)) require the client to send its public key before the server
would calculate and its own. In a scenario like this a malicious client can send an [arbitrary number](https://ieeexplore.ieee.org/document/10374117#sec3c), as a public key without performing the modular exponentiation. In
the possession of that arbitrary number the performs the shared secret calculation, which means a second modular
exponentiation on the server side. However, key agreement is going to fail, the server can realize that just after it
has already performed the CPU intensive operations.

# How bad is it?

D(HE)at attack is not a cryptographic library implementation issue, which can be fixed by a software update, but a
protocol flaw, that exploits the peculiarity of the Diffie-Hellman key agreement, that a malicious client can force a
server to do CPU intensive operation(s) without any significant resource (CPU) requirement. It is possible because
servers cannot distinguish a randomly chosen (\(A \in \mathbb{Z}\_p^\*\)) number from the result modular exponentiation
(\(A \equiv g^a \bmod p\)) require CPU intensive operations, meaning that the server has no [proof-of-work](https://en.wikipedia.org/wiki/Proof_of_work) from the client. Additionally, some implementation flaws can seriously
determine the effectiveness of the D(HE)at attack.

![D(HE)at Attack in TLS protocol](/images/dheat-attack-long.svg)

## Long exponent (CVE-2022-40735)

Some cryptographic libraries may use [long exponents](https://ieeexplore.ieee.org/document/10374117sec3f) (\(a\),
\(b\)) leading to significantly [more expensive calculation](https://ieeexplore.ieee.org/document/10374117#sec4b1) of
the public keys (\(B \equiv g^b \bmod p\)) than they would use shorter exponents that provide the same security
strength ([CVE-2022-40735](https://nvd.nist.gov/vuln/detail/CVE-2022-40735)). As the resource requirement of modular
exponentiation relates non-linearly to the size of the parameters (\(a\)/\(b\), \(p\)) the larger key sizes can be
forced by a malicious client the more significant the attack can be.

## Unnecessary validation (CVE-2024-41996)

Parties should validate the order of the peer’s public key to avoid [small subgroup confinement attack](https://en.wikipedia.org/wiki/Small_subgroup_confinement_attack), according to [NIST SP 800-56A Rev 3.](https://csrc.nist.gov/pubs/sp/800/56/a/r3/final) performing a modular exponentiation (\(1 \equiv A^{(p-1)/2} \bmod p\)
). However, the special publication of NIST also states that when an approved safe-prime group is used the validation
can be skipped. Some cryptographic libraries may always perform the validation independently from group value, allowing
an attacker to trigger expensive modular-exponentiation ([CVE-2024-41996](https://nvd.nist.gov/vuln/detail/CVE-2024-41996))
which is as resource intensive as a public key generation using a large exponent.

## Large key size by default

Larger parameter sizes (e.g., [ffdhe6144](https://datatracker.ietf.org/doc/html/rfc7919#appendix-A.4) or [ffhde8192](https://datatracker.ietf.org/doc/html/rfc7919#appendix-A.5)) enabled by the default configuration of a cryptographic
library or an application server can also seriously affect the potential of a D(HE)at attack, as the calculation of a
larger public key size requires [more resources](https://ieeexplore.ieee.org/document/10374117#sec4b3). For instance,
some popular [cryptographic libraries enable](https://ieeexplore.ieee.org/document/10374117#sec4b4b) the largest
available parameter (ffdhe8192) size by default in TLS. It carries the risk of a successful DoS attack when application
server implementations or configurations do not overwrite the cryptographic library defaults such [OpenSSL](https://www.openssl.org/blog/blog/2022/10/21/tls-groups-configuration/index.html) has.

[© Szilárd Pfeiffer, 2024](https://dheatattack.gitlab.io/)



=== Content from dheatattack.gitlab.io_d12ddeb1_20250111_023420.html ===

[D(HE)at Attack](/)

* [Summary](/summary/ "Summary page")
* [FAQ](/faq/ "FAQ page")
* [Mitigations](/mitigations/ "Mitigations page")
* [PoC Code](/dheater/ "PoC Code page")
* [Details](/details/ "Details page")
* [References](/references/ "References page")

# Frequently Asked Questions

### Who is vulnerable?

In theory, all protocols that use the Diffie-Hellman algorithm for key exchange are affected. In practice, there are
differences between the particular cryptographic protocols and their implementations, making one more affected than
others.

The [proof-of-concept implementation](/dheater/) of the attack supports the following protocols,

* [Transport Layer Security](https://en.wikipedia.org/wiki/Transport_Layer_Security) (TLS)
* [OpenVPN](https://en.wikipedia.org/wiki/OpenVPN)
* [Secure Shell](https://hu.wikipedia.org/wiki/Secure_Shell) (SSH)

however, other protocols such as [IPsec](https://en.wikipedia.org/wiki/IPsec) (IKEv1, IKEv2) must also be affected.

### Is my server vulnerable?

It depends on your server configuration. If your server offers the Diffie-Hellman key exchange, then you are affected.
However, the effectiveness of a potential attack largely depends on the specifics of the cryptographic protocol, the
library implementation, and the key size used during the key exchange. You can use either some free software
(e.g., [CryptoLyzer](https://cryptolyzer.readthedocs.io/), [SSLyze](https://github.com/nabla-c0d3/sslyze),
[ssh-audit](https://github.com/jtesta/ssh-audit), [testssl.sh](https://testssl.sh/)), and some SaaS solutions (e.g.,
[Scanigma](https://scanigma.com/)) as well to check whether your server offers Diffie-Hellman key exchange and if so,
under what parameters.

### How practical is the attack?

It depends on hardware capabilities and the server configuration. If your server offers Diffie-Hellman key exchange
with larger key sizes and the cryptographic library you use affected by the “long exponent” issue only an attacker
need to send extremely low amount of request to cause 100% CPU load on the server. For the exact number of requests
needed to overload a server see the [attack scenario](https://ieeexplore.ieee.org/document/10374117#sec5) section of
the full technical paper about the attack. For testing *your* server you can use the proof-of-concept implementation
[D(HE)ater](/dheater/).

### Can I detect if someone has exploited this against me?

Yes, you can, though it may require some configuration changes. An application server can log instances where a client
connection is interrupted during cryptographic handshakes. While this can happen under normal circumstances, it is also
indicative of suspicious behavior. A high number of log messages about connections being lost during the handshake phase
likely suggests an attack. For more details see [mitigations](/mitigations/#fail2ban) page.

### Should I disable Diffie-Hellman in my server configurations?

Not necessarily. However, you need to check both server configuration and cryptographic library implementation details.
The former is the simpler as the mentioned free software can be used the check whether your server configuration
enables the Diffie-Hellman key exchange or not and if so what key sizes are offered. The latter is harder is as there is
no obvious way to check the performance of the Diffie-Hellman implementation and used exponent sizes in the case of a
cryptographic library. For the details of the most popular libraries of this point of view see the [analysis](https://ieeexplore.ieee.org/document/10374117#sec4) section of the full technical paper about the attack.

### Why is the attack called “D(HE)at”?

The attack is named for its ability to overheat the CPU by making the victim execute the CPU-intensive operation
of [modular exponentiation used in the Diffie-Hellman key exchange within various cryptographic protocols (e.g., TLS,
SSH, IPsec, OpenVPN, etc.).

### Is this vulnerability serious enough to deserve a web page?

D(HE)at is not an issue with a client, server implementations, or a cryptographic library flaw, so it cannot be fixed
by simply installing a software update. Instead, it exploits the Diffie-Hellman key agreement protocol, meaning that it
may affect many the cryptographic protocols (e.g., TLS, SSH, OpenVPN, IKEv1/IKEv2, …) use the ephemeral version of
the Diffie-Hellman for exchanging keys. Therefore, a comprehensive solution to this vulnerability would require
modifying the cryptographic protocols that use DHE key agreement, as well as the client/server or library
implementations.

### Are there implementations more vulnerable than others?

Yes, some implementation flaws can seriously affect the effectiveness of the D(HE)at attack.

#### Long exponent (CVE-2022-40735)

Implementations may use unnecessarily [long exponents](https://ieeexplore.ieee.org/document/10374117sec3f) (
[CVE-2022-40735](https://nvd.nist.gov/vuln/detail/CVE-2022-40735)) which makes the modular exponentiation – the
CPU-intensive operation of the Diffie-Hellman key exchange – significantly more expensive than it should be.

| Library | Affected Versions |
| --- | --- |
| OpenSSL (1.x) | \(\le 1.1.1\) |
| OpenSSL (3.x) | \(\le 3.0.5\) |
| Mbed TLS |  |
| OpenJDK | \(\le 17.0.5\) |
| Oracle JDK | \(\le 17.0.5\) |

#### Unnecessary validation (CVE-2024-41996)

Implementations may perform public key validation against [small subgroup confinement attack](https://en.wikipedia.org/wiki/Small_subgroup_confinement_attack) unnecessarily ([CVE-2024-41996](https://nvd.nist.gov/vuln/detail/CVE-2024-41996)), where the validation is as expensive as public key generation using
large exponents.

| Library | Affected Versions |
| --- | --- |
| OpenSSL (1.x) | n/a\(^\*\) |
| OpenSSL (3.x) | \(\ge 3.0\) |

\* no public key validation

#### Large key size by default

The flaws mentioned earlier are coupled with large key sizes enabled by default makes the application uses the library
particularly vulnerable to the D(HE)at attack in the absence of mitigation techniques.

| Library | Key Size |
| --- | --- |
| OpenSSL (1.x) | n/a\(^\*\) |
| OpenSSL (3.x) | 8192 |
| OpenJDK | 8192 |
| Oracle JDK | 8192 |

\* no finite field Diffie-Hellman parameter negotiation support

### How can I contact you?

You can reach us via Twitter, or LinkedIn:

* Szilárd Pfeiffer: [Twitter](https://x.com/pfeifferszilard) (X),
  [LinkedIn](https://www.linkedin.com/in/pfeifferszilard/)
* Norbert Tihanyi: [LinkedIn](https://www.linkedin.com/in/norberttihanyi/)

[© Szilárd Pfeiffer, 2024](https://dheatattack.gitlab.io/)



=== Content from gist.github.com_8b736dd0_20250111_023421.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fc0r0n3r%2Fabccc14d4d96c0442f3a77fa5ca255d1)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fc0r0n3r%2Fabccc14d4d96c0442f3a77fa5ca255d1&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fc0r0n3r%2Fabccc14d4d96c0442f3a77fa5ca255d1) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fc0r0n3r%2Fabccc14d4d96c0442f3a77fa5ca255d1&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@c0r0n3r](https://avatars.githubusercontent.com/u/979146?s=64&v=4)](/c0r0n3r)

# [c0r0n3r](/c0r0n3r)/**[diffie\_hellman\_public\_key\_validation\_references.md](/c0r0n3r/abccc14d4d96c0442f3a77fa5ca255d1)**

Last active
July 25, 2024 19:02

Show Gist options

* [Download ZIP](/c0r0n3r/abccc14d4d96c0442f3a77fa5ca255d1/archive/67b8505d2ae02269c7d2e26abf5a2bdd7c4ebae5.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fc0r0n3r%2Fabccc14d4d96c0442f3a77fa5ca255d1)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fc0r0n3r%2Fabccc14d4d96c0442f3a77fa5ca255d1)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/c0r0n3r/abccc14d4d96c0442f3a77fa5ca255d1.js&quot;&gt;&lt;/script&gt;
* Save c0r0n3r/abccc14d4d96c0442f3a77fa5ca255d1 to your computer and use it in GitHub Desktop.

[Code](/c0r0n3r/abccc14d4d96c0442f3a77fa5ca255d1)
[Revisions
2](/c0r0n3r/abccc14d4d96c0442f3a77fa5ca255d1/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/c0r0n3r/abccc14d4d96c0442f3a77fa5ca255d1.js&quot;&gt;&lt;/script&gt;

Save c0r0n3r/abccc14d4d96c0442f3a77fa5ca255d1 to your computer and use it in GitHub Desktop.

[Download ZIP](/c0r0n3r/abccc14d4d96c0442f3a77fa5ca255d1/archive/67b8505d2ae02269c7d2e26abf5a2bdd7c4ebae5.zip)

Diffie-Hellman public key validation references

 [Raw](/c0r0n3r/abccc14d4d96c0442f3a77fa5ca255d1/raw/67b8505d2ae02269c7d2e26abf5a2bdd7c4ebae5/diffie_hellman_public_key_validation_references.md)

[**diffie\_hellman\_public\_key\_validation\_references.md**](#file-diffie_hellman_public_key_validation_references-md)

| Date | Publication | Section |
| --- | --- | --- |
| 1998 | [The OAKLEY Key Determination Protocol](https://datatracker.ietf.org/doc/html/rfc2412) | 2.8, Appendix E |
| 2018 | [NIST Special Publication 800-56A Revision 3](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-56Ar3.pdf) | 5.6.2.3.2 |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fc0r0n3r%2Fabccc14d4d96c0442f3a77fa5ca255d1)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


