<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Technical Details | D(HE)at Attack</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="How the attack works? During a D(HE)at attack the malicious client initiates cryptographic handshakes pretending if it would support only the ephemeral variant of the finite field Diffie-Hellman key agreement protocol (DHE) triggering key pair generation and shared secret calculation on the server-side. Both operations require the server to perform the compute-intensive modular exponentiation calculations, while the malicious client needing to use any significant computational resources.
Under normal circumstances both parties perform the same operations during the Diffie-Hellman key agreement (public key generation, shared secret calculation) meaning that theoretically the computational cost is the same for the parties.">
    <meta name="generator" content="Hugo 0.132.2">
    
    
    
    
      <meta name="robots" content="index, follow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.02014cf0330f494225ff2915ba061ea4b027ddc68e50450a660fe447d8489953.css" >



    
    
    
      

    

    
    
    <meta property="og:url" content="https://dheatattack.gitlab.io/details/">
  <meta property="og:site_name" content="D(HE)at Attack">
  <meta property="og:title" content="Technical Details">
  <meta property="og:description" content="How the attack works? During a D(HE)at attack the malicious client initiates cryptographic handshakes pretending if it would support only the ephemeral variant of the finite field Diffie-Hellman key agreement protocol (DHE) triggering key pair generation and shared secret calculation on the server-side. Both operations require the server to perform the compute-intensive modular exponentiation calculations, while the malicious client needing to use any significant computational resources.
Under normal circumstances both parties perform the same operations during the Diffie-Hellman key agreement (public key generation, shared secret calculation) meaning that theoretically the computational cost is the same for the parties.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">

  <meta itemprop="name" content="Technical Details">
  <meta itemprop="description" content="How the attack works? During a D(HE)at attack the malicious client initiates cryptographic handshakes pretending if it would support only the ephemeral variant of the finite field Diffie-Hellman key agreement protocol (DHE) triggering key pair generation and shared secret calculation on the server-side. Both operations require the server to perform the compute-intensive modular exponentiation calculations, while the malicious client needing to use any significant computational resources.
Under normal circumstances both parties perform the same operations during the Diffie-Hellman key agreement (public key generation, shared secret calculation) meaning that theoretically the computational cost is the same for the parties.">
  <meta itemprop="wordCount" content="624">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Technical Details">
  <meta name="twitter:description" content="How the attack works? During a D(HE)at attack the malicious client initiates cryptographic handshakes pretending if it would support only the ephemeral variant of the finite field Diffie-Hellman key agreement protocol (DHE) triggering key pair generation and shared secret calculation on the server-side. Both operations require the server to perform the compute-intensive modular exponentiation calculations, while the malicious client needing to use any significant computational resources.
Under normal circumstances both parties perform the same operations during the Diffie-Hellman key agreement (public key generation, shared secret calculation) meaning that theoretically the computational cost is the same for the parties.">

      
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-X0M3S8V4CJ"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-X0M3S8V4CJ');
        }
      </script>
    
  


    
	
   <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
 <script>
           MathJax = {
                       tex: {
                                     displayMath: [['\\[', '\\]'], ['$$', '$$']],  
                                     inlineMath: [['\\(', '\\)']]                  
                                   }
                     };
 </script>



  </head>

  <body class="ma0 avenir bg-near-white production">

    

  <header>
    <div class="bg-near-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        D(HE)at Attack
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/summary/" title="Summary page">
              Summary
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/faq/" title="FAQ page">
              FAQ
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/mitigations/" title="Mitigations page">
              Mitigations
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/dheater/" title="PoC Code page">
              PoC Code
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/details/" title="Details page">
              Details
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/references/" title="References page">
              References
            </a>
          </li>
          
        </ul>
      
      
<div class="ananke-socials">
  
    
    <a href="https://gitlab.com/dheatattack" target="_blank" rel="noopener" class="gitlab ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitLab link" aria-label="follow on GitLab——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><path d="M29.782 199.732L256 493.714 8.074 309.699c-6.856-5.142-9.712-13.996-7.141-21.993l28.849-87.974zm75.405-174.806c-3.142-8.854-15.709-8.854-18.851 0L29.782 199.732h131.961L105.187 24.926zm56.556 174.806L256 493.714l94.257-293.982H161.743zm349.324 87.974l-28.849-87.974L256 493.714l247.926-184.015c6.855-5.142 9.711-13.996 7.141-21.993zm-85.404-262.78c-3.142-8.854-15.709-8.854-18.851 0l-56.555 174.806h131.961L425.663 24.926z"></path></svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>


    <main class="pb7" role="main">
      
  <div class="flex-l mt2 mw8 center">
    <article class="center cf pv5 ph3 ph4-ns mw7">
      <header>
        <h1 class="f1">
          Technical Details
        </h1>
      </header>
      <div class="nested-copy-line-height lh-copy f4 nested-links mid-gray">
        <h1 id="how-the-attack-works">How the attack works?</h1>
<p>During a D(HE)at attack the malicious client initiates cryptographic handshakes pretending if it would support only the
<a href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange#Ephemeral_and/or_static_keys">ephemeral variant</a> of
the <a href="https://en.wikipedia.org/wiki/Finite_field">finite field</a> <a href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange">Diffie-Hellman key agreement protocol</a> (DHE) triggering key pair generation and shared
secret calculation on the server-side. Both operations require the server to perform the compute-intensive
<a href="https://en.wikipedia.org/wiki/Modular_exponentiation">modular exponentiation</a> calculations, while the malicious client
needing to use any significant computational resources.</p>
<p><img src="/images/dheat-attack-short.png" alt="D(HE)at Attack"></p>
<p>Under normal circumstances both parties perform the same operations during the Diffie-Hellman key agreement (public key
generation, shared secret calculation) meaning that theoretically the computational cost is the same for the parties.
However, in practice, a malicious client can force a server to generate a public key by acting that it would support
only the Diffie-Hellman key agreement and would wait for the server&rsquo;s public key to be sure that server has performed
the <a href="https://ieeexplore.ieee.org/document/10374117#sec2c">expensive modular exponentiation</a>, then it terminates the
connection. In the case of certain protocols (e.g., <a href="https://ieeexplore.ieee.org/document/10374117#sec4c2a">TLS &lt; 1.3</a>)
an initial cryptographic handshake message is enough to be sent without the client&rsquo;s public key.</p>
<p>Other protocols or protocol versions (e.g., <a href="https://ieeexplore.ieee.org/document/10374117#sec4c2b">TLS 1.3</a>, <a href="https://ieeexplore.ieee.org/document/10374117#sec4c2d">SSH</a>) require the client to send its public key before the server
would calculate and its own. In a scenario like this a malicious client can send an <a href="https://ieeexplore.ieee.org/document/10374117#sec3c">arbitrary number</a>, as a public key without performing the modular exponentiation. In
the possession of that arbitrary number the  performs the shared secret calculation, which means a second modular
exponentiation on the server side. However, key agreement is going to fail, the server can realize that just after it
has already performed the CPU intensive operations.</p>
<h1 id="how-bad-is-it">How bad is it?</h1>
<p>D(HE)at attack is not a cryptographic library implementation issue, which can be fixed by a software update, but a
protocol flaw, that exploits the peculiarity of the Diffie-Hellman key agreement, that a malicious client can force a
server to do CPU intensive operation(s) without any significant resource (CPU) requirement. It is possible because
servers cannot distinguish a randomly chosen (\(A \in \mathbb{Z}_p^*\)) number from the result modular exponentiation
(\(A \equiv g^a \bmod p\)) require CPU intensive operations, meaning that the server has no <a href="https://en.wikipedia.org/wiki/Proof_of_work">proof-of-work</a> from the client. Additionally, some implementation flaws can seriously
determine the effectiveness of the D(HE)at attack.</p>
<p><img src="/images/dheat-attack-long.svg" alt="D(HE)at Attack in TLS protocol"></p>
<h2 id="long-exponent-cve-2022-40735">Long exponent (CVE-2022-40735)</h2>
<p>Some cryptographic libraries may use <a href="https://ieeexplore.ieee.org/document/10374117sec3f">long exponents</a> (\(a\),
\(b\)) leading to significantly <a href="https://ieeexplore.ieee.org/document/10374117#sec4b1">more expensive calculation</a> of
the public keys (\(B \equiv g^b \bmod p\)) than they would use shorter exponents that provide the same security
strength (<a href="https://nvd.nist.gov/vuln/detail/CVE-2022-40735">CVE-2022-40735</a>). As the resource requirement of modular
exponentiation relates non-linearly to the size of the parameters (\(a\)/\(b\), \(p\)) the larger key sizes can be
forced by a malicious client the more significant the attack can be.</p>
<h2 id="unnecessary-validation-cve-2024-41996">Unnecessary validation (CVE-2024-41996)</h2>
<p>Parties should validate the order of the peer&rsquo;s public key to avoid <a href="https://en.wikipedia.org/wiki/Small_subgroup_confinement_attack">small subgroup confinement attack</a>, according to <a href="https://csrc.nist.gov/pubs/sp/800/56/a/r3/final">NIST SP 800-56A Rev 3.</a> performing a modular exponentiation (\(1 \equiv A^{(p-1)/2} \bmod p\)
).  However, the special publication of NIST also states that when an approved safe-prime group is used the validation
can be skipped. Some cryptographic libraries may always perform the validation independently from group value, allowing
an attacker to trigger expensive modular-exponentiation (<a href="https://nvd.nist.gov/vuln/detail/CVE-2024-41996">CVE-2024-41996</a>)
which is as resource intensive as a public key generation using a large exponent.</p>
<h2 id="large-key-size-by-default">Large key size by default</h2>
<p>Larger parameter sizes (e.g., <a href="https://datatracker.ietf.org/doc/html/rfc7919#appendix-A.4">ffdhe6144</a> or <a href="https://datatracker.ietf.org/doc/html/rfc7919#appendix-A.5">ffhde8192</a>) enabled by the default configuration of a cryptographic
library or an application server can also seriously affect the potential of a D(HE)at attack, as the calculation of a
larger public key size requires <a href="https://ieeexplore.ieee.org/document/10374117#sec4b3">more resources</a>. For instance,
some popular <a href="https://ieeexplore.ieee.org/document/10374117#sec4b4b">cryptographic libraries enable</a> the largest
available parameter (ffdhe8192) size by default in TLS. It carries the risk of a successful DoS attack when  application
server implementations or configurations do not overwrite the cryptographic library defaults such  <a href="https://www.openssl.org/blog/blog/2022/10/21/tls-groups-configuration/index.html">OpenSSL</a> has.</p>

      </div>
    </article>
  </div>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://dheatattack.gitlab.io/" >
    &copy;  Szilárd Pfeiffer, 2024 
  </a>
    <div>
<div class="ananke-socials">
  
    
    <a href="https://gitlab.com/dheatattack" target="_blank" rel="noopener" class="gitlab ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitLab link" aria-label="follow on GitLab——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><path d="M29.782 199.732L256 493.714 8.074 309.699c-6.856-5.142-9.712-13.996-7.141-21.993l28.849-87.974zm75.405-174.806c-3.142-8.854-15.709-8.854-18.851 0L29.782 199.732h131.961L105.187 24.926zm56.556 174.806L256 493.714l94.257-293.982H161.743zm349.324 87.974l-28.849-87.974L256 493.714l247.926-184.015c6.855-5.142 9.711-13.996 7.141-21.993zm-85.404-262.78c-3.142-8.854-15.709-8.854-18.851 0l-56.555 174.806h131.961L425.663 24.926z"></path></svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
