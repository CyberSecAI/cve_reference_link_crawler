=== Content from github.com_c3d58fa3_20250108_155751.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frpm-software-management%2Frpm%2Fcommit%2Ff2d3be2a8741234faaa96f5fd05fdfdc75779a79)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frpm-software-management%2Frpm%2Fcommit%2Ff2d3be2a8741234faaa96f5fd05fdfdc75779a79)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=rpm-software-management%2Frpm)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rpm-software-management](/rpm-software-management)
/
**[rpm](/rpm-software-management/rpm)**
Public

* [Notifications](/login?return_to=%2Frpm-software-management%2Frpm) You must be signed in to change notification settings
* [Fork
  375](/login?return_to=%2Frpm-software-management%2Frpm)
* [Star
   517](/login?return_to=%2Frpm-software-management%2Frpm)

* [Code](/rpm-software-management/rpm)
* [Issues
  271](/rpm-software-management/rpm/issues)
* [Pull requests
  7](/rpm-software-management/rpm/pulls)
* [Discussions](/rpm-software-management/rpm/discussions)
* [Actions](/rpm-software-management/rpm/actions)
* [Projects
  8](/rpm-software-management/rpm/projects)
* [Security](/rpm-software-management/rpm/security)
* [Insights](/rpm-software-management/rpm/pulse)

Additional navigation options

* [Code](/rpm-software-management/rpm)
* [Issues](/rpm-software-management/rpm/issues)
* [Pull requests](/rpm-software-management/rpm/pulls)
* [Discussions](/rpm-software-management/rpm/discussions)
* [Actions](/rpm-software-management/rpm/actions)
* [Projects](/rpm-software-management/rpm/projects)
* [Security](/rpm-software-management/rpm/security)
* [Insights](/rpm-software-management/rpm/pulse)

## Commit

[Permalink](/rpm-software-management/rpm/commit/f2d3be2a8741234faaa96f5fd05fdfdc75779a79)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Restrict following symlinks to directories by ownership ([CVE-2017-7500](https://github.com/advisories/GHSA-2jc3-8rq8-7x2x "CVE-2017-7500"))

[Browse files](/rpm-software-management/rpm/tree/f2d3be2a8741234faaa96f5fd05fdfdc75779a79)
Browse the repository at this point in the history

```
Only follow directory symlinks owned by target directory owner or root.
This prevents privilege escalation from user-writable directories via
directory symlinks to privileged directories on package upgrade, while
still allowing admin to arrange disk usage with symlinks.

The rationale is that if you can create symlinks owned by user X you *are*
user X (or root), and if you also own directory Y you can do whatever with
it already, including change permissions. So when you create a symlink to
that directory, the link ownership acts as a simple stamp of authority that
you indeed want rpm to treat this symlink as it were the directory that
you own. Such a permission can only be given by you or root, which
is just the way we want it. Plus it's almost ridiculously simple as far
as rules go, compared to trying to calculate something from the
source vs destination directory permissions etc.

In the normal case, the user arranging diskspace with symlinks is indeed
root so nothing changes, the only real change here is to links created by
non-privileged users which should be few and far between in practise.
Unfortunately our test-suite runs as a regular user via fakechroot and
thus the testcase for this fails under the new rules. Adjust the testcase
to get the ownership straight and add a second case for the illegal
behavior, basically the same as the old one but with different expectations.
```

* Loading branch information

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

[pmatilai](/rpm-software-management/rpm/commits?author=pmatilai "View all commits by pmatilai")
committed
Sep 28, 2017

1 parent
[e9d1ec5](/rpm-software-management/rpm/commit/e9d1ec565dc54a85e4a8c3bb448afa3ae4ed8441)

commit f2d3be2

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**42 additions**
and
**4 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* lib

  + lib/fsm.c
    [fsm.c](#diff-53bfda548820c5dd70e28669eaa5f7bc36c55d3ac25dbd3f590c85ffa29bbbe0)
* tests

  + data/SPECS

    - tests/data/SPECS/replacetest.spec
      [replacetest.spec](#diff-5ddf7b69a2436527ad2e29c56663443848b20ab38c14e087fae73a68011f4fd6)
  + tests/rpmreplace.at
    [rpmreplace.at](#diff-51c522ce189aeb1c70232f05045d7c7a52f22c72b8d09241bb6c4284736bb5fe)

## There are no files selected for viewing

9 changes: 6 additions & 3 deletions

9
[lib/fsm.c](#diff-53bfda548820c5dd70e28669eaa5f7bc36c55d3ac25dbd3f590c85ffa29bbbe0 "lib/fsm.c")

Show comments

[View file](/rpm-software-management/rpm/blob/f2d3be2a8741234faaa96f5fd05fdfdc75779a79/lib/fsm.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -650,7 +650,7 @@ static int fsmUtime(const char \*path, mode\_t mode, time\_t mtime) |
|  |  | return rc; |
|  |  | } |
|  |  |  |
|  |  | static int fsmVerify(const char \*path, rpmfi fi) |
|  |  | static int fsmVerify(const char \*path, rpmfi fi, const struct stat \*fsb) |
|  |  | { |
|  |  | int rc; |
|  |  | int saveerrno = errno; |
| Expand All | | @@ -675,11 +675,14 @@ static int fsmVerify(const char \*path, rpmfi fi) |
|  |  | } else if (S\_ISDIR(mode)) { |
|  |  | if (S\_ISDIR(dsb.st\_mode)) return 0; |
|  |  | if (S\_ISLNK(dsb.st\_mode)) { |
|  |  | uid\_t luid = dsb.st\_uid; |
|  |  | rc = fsmStat(path, 0, &dsb); |
|  |  | if (rc == RPMERR\_ENOENT) rc = 0; |
|  |  | if (rc) return rc; |
|  |  | errno = saveerrno; |
|  |  | if (S\_ISDIR(dsb.st\_mode)) return 0; |
|  |  | /\* Only permit directory symlinks by target owner and root \*/ |
|  |  | if (S\_ISDIR(dsb.st\_mode) && (luid == 0 || luid == fsb->st\_uid)) |
|  |  | return 0; |
|  |  | } |
|  |  | } else if (S\_ISLNK(mode)) { |
|  |  | if (S\_ISLNK(dsb.st\_mode)) { |
| Expand Down  Expand Up | | @@ -921,7 +924,7 @@ int rpmPackageFilesInstall(rpmts ts, rpmte te, rpmfiles files, |
|  |  | } |
|  |  | /\* Assume file does't exist when tmp suffix is in use \*/ |
|  |  | if (!suffix) { |
|  |  | rc = fsmVerify(fpath, fi); |
|  |  | rc = fsmVerify(fpath, fi, &sb); |
|  |  | } else { |
|  |  | rc = (action == FA\_TOUCH) ? 0 : RPMERR\_ENOENT; |
|  |  | } |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[tests/data/SPECS/replacetest.spec](#diff-5ddf7b69a2436527ad2e29c56663443848b20ab38c14e087fae73a68011f4fd6 "tests/data/SPECS/replacetest.spec")

Show comments

[View file](/rpm-software-management/rpm/blob/f2d3be2a8741234faaa96f5fd05fdfdc75779a79/tests/data/SPECS/replacetest.spec)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,6 @@ |
|  |  | %{!?filetype: %global filetype file} |
|  |  | %{?fixit: %global havepretrans 1} |
|  |  | %{!?user: %global user root} |
|  |  |  |
|  |  | Name: replacetest%{?sub:-%{sub}} |
|  |  | Version: %{ver} |
| Expand Down  Expand Up | | @@ -43,5 +44,5 @@ rm -rf $RPM\_BUILD\_ROOT |
|  |  | %endif |
|  |  |  |
|  |  | %files |
|  |  | %defattr(-,root,root,-) |
|  |  | %defattr(-,%{user},%{user},-) |
|  |  | /opt/\* |

34 changes: 34 additions & 0 deletions

34
[tests/rpmreplace.at](#diff-51c522ce189aeb1c70232f05045d7c7a52f22c72b8d09241bb6c4284736bb5fe "tests/rpmreplace.at")

Show comments

[View file](/rpm-software-management/rpm/blob/f2d3be2a8741234faaa96f5fd05fdfdc75779a79/tests/rpmreplace.at)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -402,12 +402,14 @@ runroot rpmbuild --quiet -bb \ |
|  |  | --define "ver 1.0" \ |
|  |  | --define "filetype datadir" \ |
|  |  | --define "filedata README1" \ |
|  |  | --define "user $(id -u -n)" \ |
|  |  | /data/SPECS/replacetest.spec |
|  |  |  |
|  |  | runroot rpmbuild --quiet -bb \ |
|  |  | --define "ver 2.0" \ |
|  |  | --define "filetype datadir" \ |
|  |  | --define "filedata README2" \ |
|  |  | --define "user $(id -u -n)" \ |
|  |  | /data/SPECS/replacetest.spec |
|  |  |  |
|  |  | mkdir "${RPMTEST}"/opt/f00f |
| Expand All | | @@ -421,6 +423,38 @@ test -L "${tf}" && test -d "${tf}" |
|  |  | []) |
|  |  | AT\_CLEANUP |
|  |  |  |
|  |  | AT\_SETUP([upgrade invalid locally symlinked directory]) |
|  |  | AT\_KEYWORDS([install]) |
|  |  | AT\_CHECK([ |
|  |  | RPMDB\_CLEAR |
|  |  | RPMDB\_INIT |
|  |  | tf="${RPMTEST}"/opt/foo |
|  |  | rm -rf "${RPMTEST}"/opt/\* |
|  |  | rm -rf "${TOPDIR}" |
|  |  |  |
|  |  | runroot rpmbuild --quiet -bb \ |
|  |  | --define "ver 1.0" \ |
|  |  | --define "filetype datadir" \ |
|  |  | --define "filedata README1" \ |
|  |  | /data/SPECS/replacetest.spec |
|  |  |  |
|  |  | runroot rpmbuild --quiet -bb \ |
|  |  | --define "ver 2.0" \ |
|  |  | --define "filetype datadir" \ |
|  |  | --define "filedata README2" \ |
|  |  | /data/SPECS/replacetest.spec |
|  |  |  |
|  |  | mkdir "${RPMTEST}"/opt/f00f |
|  |  | ln -s f00f "${RPMTEST}"/opt/foo |
|  |  | runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm |
|  |  | test -L "${tf}" && test -d "${tf}" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm |
|  |  | test -d "${tf}" |
|  |  | ], |
|  |  | [0], |
|  |  | [], |
|  |  | []) |
|  |  | AT\_CLEANUP |
|  |  |  |
|  |  | AT\_SETUP([upgrade empty directory to broken link]) |
|  |  | AT\_KEYWORDS([install]) |
|  |  | AT\_CHECK([ |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f2d3be2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frpm-software-management%2Frpm%2Fcommit%2Ff2d3be2a8741234faaa96f5fd05fdfdc75779a79) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from access.redhat.com_b78eede4_20250108_155743.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=ngHf197KeMw&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNDI0JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDQyNCkifQ)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=ngHf197KeMw&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNDI0JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDQyNCkifQ)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=ngHf197KeMw&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNDI0JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDQyNCkifQ)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2022 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.suse.com_7db588ee_20250108_155743.html ===


| Bugzilla – Bug 1157882 | VUL-0: CVE-2021-35937: rpm: TOCTOU race in checks for unsafe symlinks | Last modified: 2024-11-14 10:47:57 UTC |
| --- | --- | --- |

|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1157882)
* |
  [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

[**Bug 1157882**](show_bug.cgi?id=1157882)
(CVE-2021-35937)
- VUL-0: CVE-2021-35937: rpm: TOCTOU race in checks for unsafe symlinks

[Summary:](page.cgi?id=glossary.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
VUL-0: CVE-2021-35937: rpm: TOCTOU race in checks for unsafe symlinks

| | [Status](page.cgi?id=status_resolution_matrix.html): | RESOLVED WONTFIX | | --- | --- | |  | | | [Alias:](page.cgi?id=glossary.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2021-35937 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | SUSE Security Incidents | | [Classification:](page.cgi?id=glossary.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Novell Products | | [Component:](describecomponents.cgi?product=SUSE Security Incidents "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Incidents ([show other bugs](buglist.cgi?component=Incidents&product=SUSE%20Security%20Incidents&bug_status=__open__)) | | [Version:](page.cgi?id=glossary.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=glossary.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other Other | |  | | | [Priority](page.cgi?id=glossary.html#priority): | P3 - Medium **Severity**: Minor | | [Target Milestone:](page.cgi?id=glossary.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=glossary.html#assigned_to "The person in charge of resolving the bug.") | Michael Schröder | | [QA Contact:](page.cgi?id=glossary.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Security Team bot | |  | | | [URL:](page.cgi?id=glossary.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | <https://smash.suse.de/issue/248052/> | | [Whiteboard:](page.cgi?id=glossary.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | CVSSv3.1:SUSE:CVE-2021-35937:6.3:(AV... | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=glossary.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=glossary.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2019-11-27 12:09 UTC by Malte Kraus | | --- | --- | | Modified: | 2024-11-14 10:47 UTC ([History](show_activity.cgi?id=1157882)) | | CC List: | 9 users (show)  cathy.hu gabriele.sonnu jsegitz lnussel meissner mls msiddiqu pmatilai stoyan.manolov | |  | | | [See Also:](page.cgi?id=glossary.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Found By:](page.cgi?id=glossary.html#cf_foundby "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Services Priority:](page.cgi?id=glossary.html#cf_nts_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Business Priority:](page.cgi?id=glossary.html#cf_biz_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Blocker:](page.cgi?id=glossary.html#cf_blocker "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Marketing QA Status:](page.cgi?id=glossary.html#cf_marketing_qa_status "A custom Drop Down field in this installation of Bugzilla.") | --- | | [IT Deployment:](page.cgi?id=glossary.html#cf_it_deployment "A custom Drop Down field in this installation of Bugzilla.") | --- | |  | |  * [Clone This Bug](enter_bug.cgi?cloned_bug_id=1157882)  | Flags: | gabriele.sonnu: needinfo? (mls) | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=1157882&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=1157882&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1157882#c0)  Malte Kraus   2019-11-27 12:09:43 UTC  ``` In response to CVE-2017-7500 and CVE-2017-7501, it was decided that the policy of RPM is "Only follow directory symlinks owned by target directory owner or root." [1]. This check was implemented in a way that is subject to race conditions.   If an attacker manages to change things between the call to lstat() that finds a safe symlink and the open() that creates a new file, the policy is not enforced.  Exploits are tricky because of the narrow timing window between the calls, but mazes [2] could probably be used to delay the stat() long enough for a reliable exploit.  Fixing this would require opening the directory with O_PATH|O_NOFOLLOW, followed by fstat() to check ownership and openat() to create the final file.   1: <https://github.com/rpm-software-management/rpm/commit/f2d3be2a8741234faaa96f5fd05fdfdc75779a79> 2: <https://www.usenix.org/legacy/event/sec05/tech/full_papers/borisov/borisov.pdf>  See also [bnc#1157880](http://bugzilla.suse.com/show_bug.cgi?id=1157880). ``` [Comment 3](show_bug.cgi?id=1157882#c3)  Johannes Segitz   2021-03-01 15:30:03 UTC  ``` contacted upstream about this, will make it public this or next week ``` [Comment 4](show_bug.cgi?id=1157882#c4)  Johannes Segitz   2021-03-02 13:02:01 UTC  ``` Panu is looking into this, moving CRD: 2021-03-16 preliminary to prevent the bot from freaking out starting today ``` [Comment 5](show_bug.cgi?id=1157882#c5)  Johannes Segitz   2021-04-01 08:42:05 UTC  ``` Upstream maintainer is looking into this. Because if this I restart the  CRD: 2021-06-30 to have a reasonable chance to fix this ``` [Comment 6](show_bug.cgi?id=1157882#c6)  Johannes Segitz   2021-04-28 13:19:54 UTC  ``` reminder ping :) ``` [Comment 7](show_bug.cgi?id=1157882#c7)  Johannes Segitz   2021-06-16 09:13:51 UTC  ``` Any progress on this? We're getting close to the CRD. Thanks ``` [Comment 8](show_bug.cgi?id=1157882#c8)  Johannes Segitz   2021-06-30 12:14:39 UTC  ``` CRD reached, making it public to give the community a chance to work on this ``` [Comment 12](show_bug.cgi?id=1157882#c12)  Stoyan Manolov   2022-09-16 08:20:37 UTC  ``` This fix cannot be easily backported. The upstream fixes are scheduled for the next rpm major release and they are currently in beta phase. We will come back to this upon releasing the next rpm major version. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=1157882)
* - [XML](show_bug.cgi?ctype=xml&id=1157882)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=1157882)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1157882)
  + |
    [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

+ Legal:
+ [openSUSE](http://en.opensuse.org/Terms_of_site)
+ [SUSE](https://www.suse.com/company/legal/)



=== Content from security.gentoo.org_52a1e1f2_20250108_132755.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# RPM: Multiple Vulnerabilities — GLSA **202210-22**

Multiple vulnerabilities have been found in RPM, the worst of which could lead to root privilege escalation.

### Affected packages

| Package | **app-arch/rpm** on all architectures |
| --- | --- |
| Affected versions | < **4.18.0** |
| Unaffected versions | >= **4.18.0** |

### Background

The Red Hat Package Manager (RPM) is a command line driven package management system capable of installing, uninstalling, verifying, querying, and updating computer software packages.

### Description

Multiple vulnerabilities have been discovered in RPM. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All RPM users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=app-arch/rpm-4.18.0"

```
### References

* [CVE-2021-3521](https://nvd.nist.gov/vuln/detail/CVE-2021-3521)
* [CVE-2021-35937](https://nvd.nist.gov/vuln/detail/CVE-2021-35937)
* [CVE-2021-35938](https://nvd.nist.gov/vuln/detail/CVE-2021-35938)
* [CVE-2021-35939](https://nvd.nist.gov/vuln/detail/CVE-2021-35939)

**Release date**

October 31, 2022

**Latest revision**

October 31, 2022: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [830380](https://bugs.gentoo.org/show_bug.cgi?id=830380)
* [866716](https://bugs.gentoo.org/show_bug.cgi?id=866716)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from bugzilla.redhat.com_ee16e58c_20250108_132754.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1964125)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1964125)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1964125)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1964125

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1964125**](show_bug.cgi?id=1964125)
(CVE-2021-35937)
- [CVE-2021-35937](https://access.redhat.com/security/cve/CVE-2021-35937) rpm: TOCTOU race in checks for unsafe symlinks

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2021-35937 rpm: TOCTOU race in checks for unsafe symlinks

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | NEW | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2021-35937 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Nobody | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1971282](show_bug.cgi?id=1971282) [1969801](show_bug.cgi?id=1969801) [1969802](show_bug.cgi?id=1969802) [1969803](show_bug.cgi?id=1969803) [1977846](show_bug.cgi?id=1977846 "CLOSED NEXTRELEASE - CVE-2021-35937 rpm: TOCTOU race in checks for unsafe symlinks [fedora-all]") [2003065](show_bug.cgi?id=2003065) [2070454](show_bug.cgi?id=2070454) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1964123](show_bug.cgi?id=1964123) [1977373](show_bug.cgi?id=1977373) | | TreeView+ | [depends on](buglist.cgi?bug_id=1964125&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1964125&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2021-05-24 18:55 UTC by msiddiqu | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2024-02-05 10:56 UTC ([History](show_activity.cgi?id=1964125)) | | [CC List:](page.cgi?id=fields.html#cclist) | 12 users (show)  ajak caswilli derrick.roach.ctr ffesti kaycoth mdogra packaging-team-maint pmatilai sbalasub sbueno vmugicag vmukhame | | Fixed In Version: |  | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A race condition vulnerability was found in rpm. A local unprivileged user could use this flaw to bypass the checks that were introduced in response to CVE-2017-7500 and CVE-2017-7501, potentially gaining root privileges. The highest threat from this vulnerability is to data confidentiality and integrity as well as system availability. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: |  | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHBA-2024:0667](https://access.redhat.com/errata/RHBA-2024%3A0667) | 0 | None | None | None | 2024-02-02 07:05:45 UTC | | Red Hat Product Errata | [RHBA-2024:0674](https://access.redhat.com/errata/RHBA-2024%3A0674) | 0 | None | None | None | 2024-02-05 10:56:04 UTC | | Red Hat Product Errata | [RHSA-2024:0424](https://access.redhat.com/errata/RHSA-2024%3A0424) | 0 | None | None | None | 2024-01-24 16:48:35 UTC | | Red Hat Product Errata | [RHSA-2024:0435](https://access.redhat.com/errata/RHSA-2024%3A0435) | 0 | None | None | None | 2024-01-24 15:26:14 UTC | | Red Hat Product Errata | [RHSA-2024:0453](https://access.redhat.com/errata/RHSA-2024%3A0453) | 0 | None | None | None | 2024-01-24 16:40:10 UTC | | Red Hat Product Errata | [RHSA-2024:0463](https://access.redhat.com/errata/RHSA-2024%3A0463) | 0 | None | None | None | 2024-01-24 16:30:42 UTC | | Red Hat Product Errata | [RHSA-2024:0582](https://access.redhat.com/errata/RHSA-2024%3A0582) | 0 | None | None | None | 2024-01-30 13:24:43 UTC | | Red Hat Product Errata | [RHSA-2024:0647](https://access.redhat.com/errata/RHSA-2024%3A0647) | 0 | None | None | None | 2024-02-01 12:29:35 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1964125#c0)  msiddiqu    2021-05-24 18:55:14 UTC  ``` In response to [CVE-2017-7500](https://access.redhat.com/security/cve/CVE-2017-7500) and [CVE-2017-7501](https://access.redhat.com/security/cve/CVE-2017-7501), it was decided that the policy of RPM is "Only follow directory symlinks owned by target directory owner or root." [1]. This check was implemented in a way that is subject to race conditions. If an attacker manages to change things between the call to lstat() that finds a safe symlink and the open() that creates a new file, the policy is not enforced.  Exploits are tricky because of the narrow timing window between the calls, but mazes [2] could probably be used to delay the stat() long enough for a reliable exploit. Fixing this would require opening the directory with O_PATH|O_NOFOLLOW, followed by fstat() to check ownership and openat() to create the final file.  References:  1. <https://github.com/rpm-software-management/rpm/commit/f2d3be2a8741234faaa96f5fd05fdfdc75779a79> 2. <https://www.usenix.org/legacy/event/sec05/tech/full_papers/borisov/borisov.pdf> 3. <https://bugzilla.suse.com/show_bug.cgi?id=1157882>   ```  [Comment 4](show_bug.cgi?id=1964125#c4)  Mauro Matteo Cascella    2021-06-30 15:21:41 UTC  ``` Created rpm tracking bugs for this issue:  Affects: fedora-all [[bug 1977846](show_bug.cgi?id=1977846 "CLOSED NEXTRELEASE - CVE-2021-35937 rpm: TOCTOU race in checks for unsafe symlinks [fedora-all]")]   ```  [Comment 5](show_bug.cgi?id=1964125#c5)  Mauro Matteo Cascella    2021-07-07 16:22:32 UTC  ``` This flaw, along with [CVE-2021-35938](https://access.redhat.com/security/cve/CVE-2021-35938) and [CVE-2021-35939](https://access.redhat.com/security/cve/CVE-2021-35939), belong to a set of complex issues that may allow an unprivileged user to trick RPM into modifying root-owned files during installation, due to race conditions and/or symlink attacks. These issues do not have a solution upstream. Fixing would require rather involved refactoring of RPM internals.  Note that in this context, unprivileged users are actually system accounts (like the pcpqa user mentioned in one of the SUSE bugs) that are usually more tightly controlled than ordinary users. In general, access to files and directories installed by RPMs requires high privileges. Regular users should not be allowed to manipulate RPM artifacts during installation. A local attacker would first need to compromise a system account in order to exploit these flaws, thus reducing the overall impact considerably.   ```  [Comment 9](show_bug.cgi?id=1964125#c9)  Panu Matilainen    2022-05-13 07:36:06 UTC  ``` This is considered fixed in RPM 4.18 (<https://rpm.org/wiki/Releases/4.18.0>) which is currently in alpha stage of the release process, final version is expected in Q3.   ```  [Comment 10](show_bug.cgi?id=1964125#c10)  John Helmert III    2022-08-26 16:06:55 UTC  ``` (In reply to Panu Matilainen from [comment #9](show_bug.cgi?id=1964125#c9)) > This is considered fixed in RPM 4.18 (<https://rpm.org/wiki/Releases/4.18.0>) > which is currently in alpha stage of the release process, final version is > expected in Q3.  Is there a patch for this issue anywhere?   ```  [Comment 11](show_bug.cgi?id=1964125#c11)  Panu Matilainen    2022-08-29 07:29:41 UTC  ``` (In reply to John Helmert III from [comment #10](show_bug.cgi?id=1964125#c10)) > Is there a patch for this issue anywhere?  No. As indicated in the comments, fixing the set of related issues is a complicated refactoring job, some of which can be found here: <https://github.com/rpm-software-management/rpm/pull/1919>.   ```  [Comment 15](show_bug.cgi?id=1964125#c15)  errata-xmlrpc    2024-01-24 15:26:12 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 9.0 Extended Update Support  Via RHSA-2024:0435 [https://access.redhat.com/errata/RHSA-2024:0435](https://access.redhat.com/errata/RHSA-2024%3A0435)   ```  [Comment 16](show_bug.cgi?id=1964125#c16)  errata-xmlrpc    2024-01-24 16:30:40 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 9  Via RHSA-2024:0463 [https://access.redhat.com/errata/RHSA-2024:0463](https://access.redhat.com/errata/RHSA-2024%3A0463)   ```  [Comment 17](show_bug.cgi?id=1964125#c17)  errata-xmlrpc    2024-01-24 16:40:08 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 9.2 Extended Update Support  Via RHSA-2024:0453 [https://access.redhat.com/errata/RHSA-2024:0453](https://access.redhat.com/errata/RHSA-2024%3A0453)   ```  [Comment 18](show_bug.cgi?id=1964125#c18)  errata-xmlrpc    2024-01-24 16:48:33 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 8.6 Extended Update Support  Via RHSA-2024:0424 [https://access.redhat.com/errata/RHSA-2024:0424](https://access.redhat.com/errata/RHSA-2024%3A0424)   ```  [Comment 19](show_bug.cgi?id=1964125#c19)  errata-xmlrpc    2024-01-30 13:24:41 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 8.8 Extended Update Support  Via RHSA-2024:0582 [https://access.redhat.com/errata/RHSA-2024:0582](https://access.redhat.com/errata/RHSA-2024%3A0582)   ```  [Comment 20](show_bug.cgi?id=1964125#c20)  errata-xmlrpc    2024-02-01 12:29:34 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 8  Via RHSA-2024:0647 [https://access.redhat.com/errata/RHSA-2024:0647](https://access.redhat.com/errata/RHSA-2024%3A0647)   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1964125&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from access.redhat.com_93e15d61_20250108_155749.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=O09PqPv4pfc&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNjQ3JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDY0NykifQ)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=O09PqPv4pfc&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNjQ3JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDY0NykifQ)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=O09PqPv4pfc&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNjQ3JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDY0NykifQ)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2022 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_0162c069_20250108_155746.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2024 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from rpm.org_2aa4269a_20250108_155749.html ===


* [Home](/index.html)
* [Documentation](/documentation.html)
* [Download](/download.html)
* [Community](/community.html)
* [Contribute](/contribute.html)
* [Roadmap](/roadmap.html)
* [About](/about.html)

# RPM 4.18.0 Release Notes

## Download information

* Source: [rpm-4.18.0.tar.bz2](https://ftp.osuosl.org/pub/rpm/releases/rpm-4.18.x/rpm-4.18.0.tar.bz2)
* SHA256SUM: 2a17152d7187ab30edf2c2fb586463bdf6388de7b5837480955659e5e9054554

## Summary of changes from RPM 4.17.x

### General bugfixes and enhancements

* Add a new [Sequoia-based](https://sequoia-pgp.org/) OpenPGP backend (#1978)
* Documentation updates
  + Lua extensions, examples
  + Typos, grammar, clarifications, presentation improvements
  + Bring install-order documentation to this millenium
  + Drop some misleadingly outdated docs
  + Translation updates

#### Command line

* Fix `--restore` to properly honor file states and all (#965)
* Fix `--setperms` processing recorded symlinks (RhBug:1900662)
* Fix `rpmkeys` return code on I/O errors
* Fix `--showrc` to return an error code on broken rc and macro files (#1796)
* Fix mismatch between `rpmspec -q --srpm` and `rpmbuild -bs` architecture
  (#1116)
* Fix `--short-circuit` for (dynamic) buildrequires checking
* Fix `-q/--query` option not visible in `--help` (#1473)
* Fix query arguments containing `^` not working (#2104)
* Fix various dark corners in rpm2cpio.sh (RhBug:2115206)
* Add downgrade (`--oldpackage`) support to `--freshen` (#652)
* Add `--path` query for support for stateless file information (RhBug:1940895)
* Add `rpmlua` command for running rpm’s embedded Lua interpreter standalone,
  with command history and support for iLua
* Add `--shell` option for interactive macro shell to `rpmspec`
* Add `--justdb` counterpart `--nodb` option and matching API flag
* Add `-bd`, `-td` and `-rd` switches to `rpmbuild` for checking build
  dependencies
* Add available database backends to `--showrc` output

#### Transactions

* Fix intermediate symlinks not verified (CVE-2021-35939)
* Fix unowned directories created unsafely
* Fix spurious `%transfiletriggerpostun` execution (RhBug:2023311)
* Fix `%_minimize_writes` regression (in 4.15.0)
* Fix possible priority inversion in ordering code wrt weak dependencies
  with qualifiers
* Fix ctrl-c during transaction killing scriptlets (regression in 4.17.0)
* Fix excluded and non-installed files getting considered in file conflicts
  calculation
* Fix uncontrolled sqlite WAL growth during large transactions
* Fix `%posttrans` argument on upgrade

### Package building

#### Spec

* Fix mismatch between package name and provides/obsoletes rules (#1694)
* Fix `check-buildroot` not stopping on errors with `grep` >= 3.5 (#1968)
* Fix build summary confusingly mixing warnings and errors (#793)
* Fix `%patch 1` applying patches 0 and 1
* Fix package build tree not getting removed on successful build
* Fix .gemspec from `%setup` not getting removed on `%clean`
* Fix `%setup` and `%patch` not getting expanded in rpmspec –parse (#2048)
* Fix missing quotes on %sources and %patches (#1445)
* Add new `SourceLicense` tag for specifying a source license different from
  the binary license (#2079)
* Add new `%conf` spec section for build configuration (#1086)
* Add `%bcond` macro as a nicer way of defining build conditionals (#941)
* Add an optional “override clock” from `SOURCE_DATE_EPOCH` environment
  to support deterministic timestamps inside OS images
* Add support for qualifiers (eg `pre`, `post`…) for weak dependencies
* Add support for zstd long distance matching compression (`L<n>` io flag)
* Add warning if `%source_date_epoch_from_changelog set` but changelog missing
* Add new `rpmuncompress` cli tool which handles extraction of sources and
  uncompress of patches in `%setup` and `%patch` pseudomacros.
* Add new informational `UpstreamReleases` and `TranslationURL` tags
* Add parsed and expanded spec to src.rpm header as `Spec` tag
* Make `%{buildsubdir}` settable outside `%setup`
* Deprecate implicit “%patch number zero” syntax

#### Macros

* Fix individual patch application via `%autopatch` (#1766)
* Fix consistency issues in macro expansion for builtin macros
* Fix `%{define name body}` syntax in specs
* Fix non-parametric built-in macros (regression in 4.17.0)
* Fix short-circuiting of version strings in expressions (#1883)
* Add `%{shescape:...}` macro for single quoting and escapes for the shell
* Add optional argument for the `%verbose` macro
* Add support for multiple arguments in `%{quote}`
* Add support for Lua functions in expressions (eg
  `%[lua:string.reverse("hello")]`)
* Drop arbitrary macro name minimum length limit (RhBug:1994223)
* Protect automatic macros from being redefined and undefined

#### Buildroot policies

* Fix handling of filenames with spaces in `brp-compress`
* Fix Guile object files getting stripped (#1765)
* Fix `brp-strip-comment-note` running only serially
* Fix `brp-remove-la-files` sometimes removing non-libtool files
* Fix unwanted network access in check-rpaths helper script (RhBug:2079600)

#### Generators

* Fix OCaml generators to ignore cmxs files
* Add a provides generator for rpm macros

### Signatures and keys

* Fix signature check result on valid header signature but unverifiable payload
* Fix subkey binding signatures not checked on PGP public keys (CVE-2021-3521)
* Fix Ed25519 signature verification with libgcrypt
* Fix subkeys not capable of signing accepted for verification (#1911)
* Fix signing of packages unusual filenames
* Fix subkey binding timestamp used for main gpg-pubkey (#2004)
* Add support for –import in fs keyring
* Add support for linting keys on import (Sequoia backend only)

### Plugins

* Fix IMA causing install failure on filesystems without xattr support
* Add file descriptor argument to file-prepare hook
* Revert file-pre, file-prepare and file-post hook execution to their
  pre-4.17.0 positions

### Python bindings

* Fix ancient Python ts.check() argument order regression (#1871, in 4.8.0)
* Add bindings for `rpmfilesFSignature()` and `rpmfilesVSignature()`
  (`.imasig` and `.veritysig` properties in `rpm.file` objects)
* Drop experimental and internal `_build` method from from the spec bindings

### Lua interface

* Fix relocation info not available in Lua scriptlets (#1531)
* Fix scriptlet arguments passed as numbers again (regression in 4.17.0)
* Fix off-by-one in `rpm.call()`
* Fix newline behavior in interactive mode
* Fix `rpm.next_file()` to be usable only inside scriptlets with input
* Fix rpm.vercmp() error message on second argument (#2165)
* Add `rpm.splitargs()` and `rpm.unsplitargs()` functions for macro argument
  processing
* Add auto-print of `return`ed values from macros
* Drop defunct and unused `rex` extension

### API changes

#### Added APIs

* `rpmtsAddRestoreElement()`, `rpmRestore()` for `--restore`
* `rreallocn()`, similar to glibc’s reallocarray()
* `rpmhex()` for hex-enconding binary data

#### Changed APIs

* Fix database open hijacking normal signal handling
* Fix `rpmfiSetFX()` return code to be meaningful
* Fix pgpPubkeyFingerprint() to do something meaningful again
* Add new PGP-independent set of hash algorithm symbols (#1899)
* Various generic crypto APIs moved from `rpmpgp.h` to `rpmcrypto.h` header
* Disable and obsolete `rpmfiSetDX()`, `rpmfiInitD()` and `rpmfiNextD()`

#### Removed APIs

* N/A

### Internal improvements and cleanups

* Fix IMA signature lengths assumed constant (#1833, RhBug:2018937)
* Fix various leaks and other findings from static analyzers
* Fix various correctness and safety issues in the OpenPGP parser
* Fix rpmdb cookie in FIPS mode by changing it to SHA256
* Fix pgpDigParams to be properly opaque
* Fix rpmio stats spew in stderr (#1987)
* Fix changelog parsing affecting caller timezone state (#1821)
* Add an artificial limit of 1M to header array sizes
* Add support for loongarch64 architecture
* Add `ARCHSUFFIX` extension tag
* Optimize C source file classification
* Drop support for undocumented keyid based import over the net
* Various code cleanups to macro engine and Lua extensions
* Refactor file and directory operations to use fd-based APIs throughout
  (CVE-2021-35938)
* Various fixes and cleanups to hardlink handling
* Physically separate public and private headers in the codebase

### Build process

* Require POSIX.1-2008 level operating system for the `openat()` family
  of APIs
* Fix Doxygen deprecation warnings
* Fix `UID_0_USER` and `UID_0_GROUP` values when `/etc/passwd` not present
  (#1838)
* Fix out of tree build regression wrt man page generation (#1851)
* Fix stat64 build on Apple Big Sur (#1752)
* Fix build on armhf and mipsel
* Fix db backend default as per availability
* Fix signing tests assuming gpg default to sha256 hash algo
* Fix test-suite relying on deprecated distutils
* Fix warnings from autotools >= 2.70 (#1785)
* Fix `make ci` in a VPATH build
* Add option to disable libelf dependency (`--enable/--disable-libelf`)
* Add multiple new test-cases
* Update minimum required gettext version to 0.19.8
* Update CI to Fedora 36

## Compatibility notes

rpm.org



=== Content from www.usenix.org_881a4d1f_20250108_132756.html ===
Fixing Races for Fun and Proﬁt: How to abuse atime

Nikita Borisov

Rob Johnson
Naveen Sastry
University of California, Berkeley
{nikitab, rtjohnso, nks, daw}@cs.berkeley.edu

David Wagner

Abstract

Dean and Hu proposed a probabilistic countermeasure
to the classic access(2)/open(2) TOCTTOU race condi-
tion in privileged Unix programs [4]. In this paper, we
describe an attack that succeeds with very high proba-
bility against their countermeasure. We then consider a
stronger randomized variant of their defense and show
that it, too, is broken. We conclude that access(2) must
never be used in privileged Unix programs. The tools
we develop can be used to attack other ﬁlesystem races,
underscoring the importance of avoiding such races in
secure software.

1 Introduction

At USENIX Security 2004, Dean and Hu described a
probabilistic scheme for safely using the access(2) sys-
tem call in Unix systems [4]. The access(2) system call
is known to be vulnerable to Time Of Check To Time Of
Use (TOCTTOU) race attacks, and for this reason it has
fallen into almost complete disuse. This leaves Unix pro-
grammers without a portable, secure, and efﬁcient way
of checking a ﬁle’s permissions before opening it. Thus
Dean and Hu’s scheme would be a boon to systems pro-
grammers if it were secure. In this paper, we show that it
is not.

Dean and Hu’s scheme, which we call k-Race, thwarts
attackers by forcing them to win numerous races to suc-
cessfully attack the system. The strength of their scheme
rests on the assumption that an attacker has a low prob-
ability of winning each race, and hence an exponentially
low probability of winning all the races. Dean and Hu
identify two difﬁculties with winning repeated races: en-
suring that the attacker gets scheduled in time to win
each race, and staying synchronized with the victim over
many successive races. We develop three tools which
help us overcome these difﬁculties: ﬁlesystem mazes,
which greatly slow down ﬁlesystem operations of a vic-

OS
FreeBSD 4.10-PR2
Linux 2.6.8
Solaris 9

Attacker Wins / Trials
92/100
98/100
100/100

Table 1: Success rates of our attack against Dean
and Hu’s defense using the recommended security pa-
rameter, k = 7, on several platforms.

tim, system call synchronizers, and system call distin-
guishers. Using these tools, we can win races with ex-
tremely high probability, violating Dean and Hu’s as-
sumption. We use these tools to build an attack that
reliably breaks the k-Race algorithm using the recom-
mended parameter, and works on a variety of operating
systems. As shown in Table 1, our attack defeats the k-
Race algorithm over 90% of the time on every operating
system we tested.

Our attack remains successful even when the security
parameter is much larger than recommended by Dean
and Hu. We also consider a randomized extension of
the k-Race algorithm that makes non-deterministic se-
quences of calls to access(2), open(2), and fstat(2), and
show that it can be defeated as well. The tools we de-
velop for this attack are applicable to other Unix ﬁlesys-
tem race vulnerabilities, such as the stat(2)/open(2) race
common in insecure temporary ﬁle creation. We have
ported our attack code to several Unix variants and it suc-
ceeds on all of them. Our technique exploits the perfor-
mance disparity between disks and CPUs, so as this gap
grows our attack will become more powerful. This re-
futes Dean and Hu’s claim that as CPU speeds increase in
the future, the risk to systems using their defense would
decline.

Recent research in automated code auditing has dis-
covered over 40 TOCTTOU races in the Red Hat Linux
distribution [10]. This result, combined with our tech-

USENIX Association

14th USENIX Security Symposium

303

niques for exploiting race conditions, shows that races
are a prevalent and serious threat to system security.

In short, we show that the k-Race algorithm is inse-
cure, that Unix ﬁlesystem races are easy to win, and that
they will continue to be easy to win for the foreseeable
future. The rest of this paper is organized as follows. We
begin by reviewing setuid programs in Unix and the ac-
cess(2)/open(2) race. Section 3 presents Dean and Hu’s
countermeasure for preventing access(2)/open(2) races.
We then describe a simple attack on Dean and Hu’s
scheme in Section 4, and enhance this attack in Sec-
tion 5. Sections 6 and 7 describe a randomized gener-
alization of the k-Race algorithm, and an attack on that
scheme. Section 8 considers other defenses against the
access(2)/open(2) race. We consider related work in Sec-
tion 9, and summarize our contributions in Section 10.

2 The access(2)/open(2) race

The access(2) system call was introduced to address a
problem with setuid-root programs. The original Unix
authors invented the setuid mechanism to support con-
trolled sharing in Unix environments. A setuid program
runs with the permissions of the executable’s owner in-
stead of the invoker, enabling it to use private data ﬁles
that the program’s invoker cannot access. As a special
case, a setuid-root program can access any ﬁle on the
system, including the invoker’s personal ﬁles. This leads
to a classic confused deputy problem [6].

To see how the confused deputy problem arises, con-
sider a setuid-root printing program that prepares users’
ﬁles for printing and puts them onto the printing queue.1
The queue is not accessible to ordinary users, but the
setuid-root program can write to it. The program should
only let users print ﬁles that they themselves can access.
Unfortunately, since setuid-root programs have permis-
sion to read every ﬁle on the system, this implementation
does not have any easy way to determine whether the re-
quested input ﬁle is readable by the caller.

To solve this problem, Unix introduced the access(2)
system call. A setuid program can use the access(2) sys-
tem call to determine whether the invoker has the rights
needed to open a ﬁle. This solves the confused deputy
problem, but it also introduces a new security vulnera-
bility: Time Of Check To Time Of Use races [8]. The
vulnerability occurs because the return value from ac-
cess(2) tells us about the state of the ﬁlesystem at some
recent time in the past, but tells us nothing about what
the state will be when we next operate on the ﬁlesystem.
To illustrate the vulnerability, consider a typical setuid
program, which might call access(2) to check a ﬁle’s per-

1This example is inspired by an actual vulnerability in lpr
see https://www.redhat.com/archives/

in Red Hat,
redhat-watch-list/1999-October/msg00012.html.

// Victim (installed setuid-root)
void main (int argc, char **argv)
{

int fd;
if (access(argv[1], R OK) != 0)

exit(1);

fd = open(argv[1], O RDONLY);
// Do something with fd...

}

Figure 1: A setuid-root program vulnerable to the ac-
cess(2)/open(2) TOCTTOU race attack. An attacker may
be able to change the ﬁlesystem between the calls to ac-
cess(2) and open(2).

missions and then call open(2) to actually open the ﬁle
if the check succeeds, as shown in Figure 1. Unfortu-
nately, this code idiom is insecure. A clever attacker can
attempt to modify the ﬁlesystem (e.g. by changing sym-
bolic links) between the access(2) and open(2) system
calls so that when the setuid program calls access(2), the
given ﬁlename points to a safe, accessible ﬁle, but when
the setuid program calls open(2), the ﬁlename points to
a protected ﬁle. Thus, even if a setuid program uses ac-
cess(2), an attacker can still trick it into opening ﬁles that
it should not.

Figure 1 shows a typical setuid-root program that is
vulnerable to the access(2)/open(2) race, and Figure 2
shows a simple attack program that can trick the vic-
tim into opening /etc/shadow, a ﬁle that only root
can read. The attack is very timing dependent: the at-
tack program only succeeds if it manages to interrupt the
victim program between its access(2) call and open(2)
call. When this happens, the access(2) call succeeds
because, at that time, the path activedir/lnk re-
solves to a user-accessible ﬁle, public file. Af-
ter the victim calls access(2), it gets interrupted, and
the victim changes the symbolic link activedir to
point to dir1. When the victim resumes,
it calls
open(2) on activedir/lnk, which now resolves to
/etc/shadow. Since the victim is a setuid-root pro-
gram, the open(2) succeeds, but the victim believes that
it has opened a ﬁle accessible by the invoking user.

Notice that the attacker has a much better chance of
winning the race if dir0 is not currently in the buffer
cache. If that is the case, then the victim’s call to ac-
cess(2) will have to fetch the contents of dir0 from disk.
This I/O will put the victim to sleep, giving the attacker a
chance to run and switch the symbolic link activedir.
This observation is one of the key ideas behind our attack
on the k-Race defense.

304

14th USENIX Security Symposium

USENIX Association

// Attacker
void main (int argc, char **argv)
{

// Assumes directories and links:
// dir0/lnk -> public file
// dir1/lnk -> /etc/shadow
// activedir -> dir0

// Let the victim run
if (fork() == 0) {

system("victim activedir/lnk");
exit(0);

}
usleep(1); // yield CPU

// Switch where target points
unlink("activedir");
symlink("dir1", "activedir");

}

Figure 2: A program for exploiting access(2)/open(2)
races. A non-root attacker can use this program to ex-
ploit the setuid-root program shown in Figure 1.

3 The k-Race proposal

Dean and Hu noticed that, in practice, exploiting the ac-
cess(2) race condition can be quite difﬁcult. Their exper-
iments showed that a naive attacker can only expect to
win a race with probability 10−3 on uniprocessor ma-
chines and 10−1 on multiprocessor machines. Based
on this evidence, Dean and Hu proposed a probabilistic
countermeasure to this race condition. By requiring the
attacker to win a large number of races, they intended to
make it practically impossible to successfully exploit the
access(2)/open(2) race.

An implementation of their defense is given in Fig-
ure 3. The k-Race algorithm essentially repeats the ac-
cess(2)/open(2) idiom k times. To ensure that the at-
tacker must win a race between every system call, the k-
Race algorithm uses fstat(2) to check that every open(2)
call resolves to the same ﬁle. To see how this works, con-
sider an attacker trying to defeat k-Race. After the victim
makes the ﬁrst access(2) call, the attacker must switch
symlinks so that, when the victim calls open(2), the given
ﬁlename points to a protected ﬁle. After the ﬁrst call to
open(2), the attacker has tricked the victim into opening
a secret ﬁle, but the k-Race algorithm forces the attacker
to continue racing with the victim as follows. The vic-
tim next performs another call to access(2). The attacker
must race to switch the symlink to point to a public ﬁle,
or this access(2) call will not succeed. Next, the victim
calls open(2) again and uses fstat(2) to verify that the re-

int dh_access_open(char *fname)
{

int fd, rept_fd;
int orig_ino, orig_dev;
struct stat buffer;

if (access(fname, R_OK) != 0)

return -1;

fd = open(fname, O_RDONLY);
if (fd < 0)

return -1;

// This is the strengthening.
// *First, get the original inode.
if (fstat(fd, &buffer) != 0)

goto error;

orig_inode = buffer.st_ino;
orig_device = buffer.st_dev;

// Now, repeat the race.
// File must be the same each time.
for (i=0; i < k; i++) {

if (access(fname, R_OK) != 0)

goto error;

rept_fd = open(fname, O_RDONLY);
if (rept_fd < 0)
goto error;

if (fstat(rept_fd, &buffer) != 0)

goto error;

if (close(rept_fd) != 0)

goto error;

if (orig_inode != buffer.st_ino)

goto error;

if (orig_device != buffer.st_dev)

goto error;

/* If generation numbers are

available, do a similar check
for buffer.st_gen. */

}

return fd;

error:

close(fd);
close(rept_fd);
return -1;

}

Figure 3: Dean and Hu’s k-Race algorithm [4]. An at-
tacker must win 2k + 1 races to defeat this algorithm.

USENIX Association

14th USENIX Security Symposium

305

sulting ﬁle descriptor is a handle on the same ﬁle as the
result of the ﬁrst call to open(2). In order for this test
to succeed, the attacker must race to switch the symlinks
again to point to the private ﬁle. By making four system
calls, access(2), open(2), access(2), open(2), the victim
has forced the attacker to win three races.

In general, the k-Race algorithm allows the setuid-root
program to make k strengthening rounds of additional
calls to access(2) and open(2), forcing the attacker to win
a total of 2k+1 races. Dean and Hu reason that, since the
adversary must win all 2k + 1 races, the security guaran-
tees scale exponentially with the number of rounds. If p
is the probability of winning one race, then the attacker
will defeat the k-Race defense with probability ≈ p2k+1.
Their measurements indicate that p ≤ 1.4 × 10−3 on
uniprocessor machines on a range of operating systems,
and p ≤ 0.12 on a multiprocessor Sun Solaris machine.
Dean and Hu suggest k = 7 as one reasonable parameter
setting, and they estimate that with this choice the prob-
ability of a successful attack should be below 10−15.

In their argument for the security of their scheme,
Dean and Hu consider a slightly modiﬁed attacker that
attempts to switch activedir back and forth between
dir0 and dir1 between each system call made by the
victim. They observe that this attack will fail for two
reasons. First, the attacker is extremely unlikely to win
any race if dir0 is in the ﬁlesystem cache. Moreover,
even if the attacker gets lucky and dir0 is out of cache
during the victim’s ﬁrst call to open(2), the victim’s call
to open(2) will bring dir0 into the cache. In this case,
dir0 will be in the cache for the victim’s second call
to open(2), so the attacker will lose that race. Dean
and Hu’s experiments support this claim. Second, they
note that this attack requires that the attacker remain syn-
chronized with the victim. Dean and Hu added random
delays between each access(2) and open(2) call to foil
any attempts by the attacker to synchronize with the vic-
tim.

Although ﬁlesystem caching and synchronization are
real problems for an attacker, we show in the next section
that it is possible to modify the attack to overcome these
difﬁculties.

4 Basic Attack

As Dean and Hu observed, an attacker must overcome
two obstacles to successfully attack their scheme. First,
ﬁlesystem caching prevents the attacker from winning
multiple races. Second, the attacker must synchronize
with the victim. We deal with each problem in turn.

Avoiding the cache. The attack analyzed by Dean
and Hu succumbs to caching effects because it re-uses

for i = 1 to 2k + 1

wait for victim’s next system call
link activedir to diri

Figure 4: Our algorithm for defeating the k-Race algo-
rithm. The algorithm forces the victim to perform I/O,
and hence yield the CPU to the attacker, by switching
among a series of directories, dir0, . . ., dir15, all
of which are out of the ﬁlesystem cache. The attacker
detects the start of each of the victim’s system calls by
monitoring the access time of symbolic links in each di-
rectory.

dir0 and dir1. To avoid ﬁlesystem caching, we create
16 separate directories, dir0, . . ., dir15, and use each
directory exactly once. The even-numbered directories
dir0, dir2, . . ., dir14 all contain symbolic links to
a publicly accessible ﬁle. The odd-numbered directories,
dir1, dir3, . . ., dir15, contain symbolic links to the
protected ﬁle we are attacking, such as /etc/shadow.
Initially, the symbolic link activedir points to dir0.
After each of the victim’s system calls,
the attacker
changes activedir to point to the next directory, as
shown in the pseudo-code in Figure 4.

Since the attacker uses each directory exactly once,
she has a much higher chance of winning all the races
against the victim. If the attack begins with none of the
directories in cache, then the victim will be forced to
sleep on I/O for each of its system calls, giving the at-
tacker time to update activedir to point to the next
directory.

This attack succeeds only when dir0, . . ., dir15 are
not in the operating system’s buffer cache. If the attacker
tries to run the attack immediately after creating these
directories, she will fail because they will all still be in
the cache. For the rest of this section, we assume the
attacker has some method to ﬂush all these directories
from cache after creating them. Section 5 describes a
more powerful attack that eliminates this assumption.

Staying in sync. To stay synchronized with the victim,
the attacker must be able to detect when the victim has
begun each call to access(2) or open(2). The key in-
sight is that Unix updates the access time on any sym-
bolic links it traverses during name resolution.2 The at-
tacker can use this to monitor the ﬁlesystem operations
performed by the victim. The attacker simply needs to

2Some NFS conﬁgurations do not update link access times, but ev-
ery local ﬁlesystem we tested exhibited this behavior. Some kernels
support a noatime mount option that disables access time updates.
Access time polling is not critical to our attack, though. The system
call distinguishers we develop in Section 7 can be used instead of ac-
cess time polling to synchronize with the basic k-Race algorithm.

306

14th USENIX Security Symposium

USENIX Association

dir0/iotrap/lnk symlink
−−−−−→ public file
symlink
−−−−−→ dir0/iotrap
dir0/sentry
dir1/iotrap/lnk symlink
−−−−−→ /etc/shadow
symlink
−−−−−→ dir1/iotrap
dir1/sentry
dir2/iotrap/lnk symlink
−−−−−→ public file
symlink
−−−−−→ dir2/iotrap
dir2/sentry

...

dir15/iotrap/lnk symlink
−−−−−→ /etc/shadow
symlink
−−−−−→ dir15/iotrap
dir15/sentry

Figure 5: The directory structure used in our basic attack
on the k-Race algorithm. The attacker synchronizes with
the victim by polling the access time of diri/sentry.
The attacker must ﬁrst ﬂush all the iotrap directories
from the ﬁlesystem cache so that the victim will sleep on
I/O when it traverses them. The attacker creates a sym-
bolic link activedir pointing to dir0 and runs the
victim with arguement activedir/sentry/lnk.

poll the access time of a symbolic link in the path it
passes to the victim. When the access time of that link
changes, the victim must have begun a call to access(2)
or open(2).

Unfortunately, there is a small hitch with this simple
approach. In Unix, the access time is recorded only to a
1-second granularity. Consequently, the attacker cannot
poll the access time of activedir because, every time
she updates activedir to point to a new directory, she
will change its access time to the current second, and
hence will not be able to detect further accesses for up to
a second. By then, the race will be over. Moreover, the
attacker cannot poll the access time on dir7/lnk since
this would pull dir7 into the ﬁlesystem cache. This
makes it a challenge to stay synchronized with the vic-
tim.

This hurdle can be surmounted with an appropriate
re-arrangement of the directory structure. See Figure 5
for the directory structure we use to enable polling with-
out disturbing the ﬁlesystem cache. Inside each direc-
tory, diri, we create another subdirectory iotrap and
a symbolic link sentry pointing to iotrap. We then
create the ﬁnal link, lnk, that points to the public or pro-
tected ﬁle inside diri/iotrap. The attacker gives the
victim the ﬁlename activedir/sentry/lnk, and
polls the access time of activedir/sentry.

Summary.

1. The attacker creates 16 directories as shown in Fig-
ure 5 and a symbolic link activedir to dir0.

2. She forces the cache entries for these directories out

of memory.

3. The attacker then executes the victim with argument

activedir/sentry/lnk.

(a) The victim calls access(2). The kernel be-
gins traversing this path and updates the ac-
cess time on dir0/sentry. After resolving
the symbolic link dir0/sentry, the vic-
tim is put to sleep while the operating system
loads the contents of dir0/iotrap. The
victim is now suspended in the middle of exe-
cuting the access(2) call.

(b) The attacker then gains the CPU, and polls
the access time on dir0/sentry. Upon
noticing that the access time has been updated,
the attacker knows that the victim has begun
its ﬁrst access(2) call. The attacker switches
activedir to point to dir1 and begins
polling the access time on dir1/sentry.
The victim’s suspended access(2) call will not
be affected by this change to activedir be-
cause it has already traversed that part of the
path.

(c) Eventually, the victim’s I/O completes and it

ﬁnishes the access(2) call successfully.

When the victim calls open(2),
the exact same se-
quence of events occurs: the kernel updates the access
time on dir1/sentry, the victim sleeps on I/O load-
ing dir1/iotrap, the attacker runs and notices the
updated access time on dir1/sentry, the attacker
switches activedir to point to dir2, and the victim
completes the open(2) successfully. This process repeats
for the victim’s remaining system calls, and the attacker
fools the victim into opening a protected ﬁle.

We implemented and tested this simple attack on sev-
eral different machines and found that the attack works
but is extremely sensitive to the target machine’s state.
For example, if the directories used in the attack happen
to be arranged close together on disk, then the attack will
often fail. In the next section, we develop a robust ver-
sion of this attack that succeeds with high probability on
all the machines we tested.

5 Full Attack

In this section, we increase the power and reliability of
our attack. The full attack is robust, succeeds with high
probability, can defeat the k-Race algorithm with over
100 rounds of strengthening, and doesn’t depend on the
attacker’s ability to perfectly ﬂush the kernel ﬁlesystem
cache.

USENIX Association

14th USENIX Security Symposium

307

sentry

relative link

chain6/d/d/d/···/d /lnk

absolute link

chain5/d/d/d/···/d /lnk

absolute link

chain4/d/d/d/···/d /lnk

absolute link

chain3/d/d/d/···/d /lnk

absolute link

chain2/d/d/d/···/d /lnk

absolute link

chain1/d/d/d/···/d /lnk

absolute link

chain0/d/d/d/···/d /lnk

absolute link

exit

relative link to target file

Figure 6: Malicious directory structure to force the vic-
tim to sleep on I/O with extremely high probability and
hence enable the attacker to win a single race. We call
this structure a maze. We place an arrow between a sym-
bolic link and the target it references in a dotted box.

I/O ampliﬁcation. We develop a tool called a maze to
slow down the I/O operations of the victim and hence
increase the chances that it will sleep. We start by cre-
ating a deep tree of nested directories. For example, in-
side dir0, the attacker creates the tree dir/dir/..
./dir/lnk instead of just dir/lnk. We call such
a deep nested directory structure a chain. The link
sentry should now point to dir/dir/.../dir,
and hence the attacker still runs the victim with the ar-
gument activedir/sentry/lnk. The victim will
be forced to sleep on I/O if at least one of the directories
in the chain is not currently in the buffer cache. Most
Unix systems impose a limit on the length of ﬁlename
paths, known as MAXPATHLEN, and this limits the depth
of chains created by the attacker. Common values for
MAXPATHLEN are 1024 and 4096 characters. Even with
these limits an attacker can create a directory tree over
500 directories deep, but the attacker can do even more.
MAXPATHLEN only limits the number of path ele-
ments that may be speciﬁed in a single system call, it
does not limit the number of directory elements that
may be traversed during a single name lookup. An at-
tacker can use symbolic links to connect two chains to-
gether as follows. First, the attacker creates a chain

procedure make maze(exit target, nchains, depth)

link exit to exit target
let top = current directory()
let target = top/exit
for i = 0 to nchains - 1
mkdir chaini
cd chaini
for j = 0 to depth
mkdir d
cd d

link lnk to target
let target = current directory()
cd top

link sentry to target

Figure 7: Algorithm to create the directory structure in
Figure 6.

chain0/dir/dir/.../dir/lnk, as above. Then
she creates another chain chain1/dir/dir/.../
dir/lnk, where the symbolic link at the bottom of this
chain points to chain0/dir/dir/.../dir. The
sentry link should now point to chain1/dir/dir/
.../dir. Now the attacker can invoke the victim, pass-
ing it the path activedir/sentry/lnk/lnk.
If
each chain is N directories deep, then the victim will
need to traverse 2N directories to resolve this ﬁlename.
This technique can be extended to create a maze of up
to C chains, chainC − 1, chainC − 2, ..., chain0,
where each chain has at its bottom a symbolic link point-
ing to the bottom of the next chain. Figure 6 shows one
such maze of directories in its entirety. For simplicity,
we create a ﬁnal link, exit, pointing to the target ﬁle, at
then end of the maze. We also use shorter names for the
directories in each chain, enabling us to create deeper
chains within the constraints of MAXPATHLEN. Pseu-
docode for constructing this maze is given in Figure 7.
With this structure, the attacker runs the victim with the
ﬁlename argument activedir/sentry/lnk/.../
lnk/lnk.

With C chains, each N directories deep, the victim
will have to traverse CN directories to resolve the given
ﬁlename. Unix systems usually impose a limit on the
total number of symbolic links that a single ﬁlename
lookup can traverse. Table 2 gives the MAXPATHLEN
and link limit for some common versions of Unix. For
example, Linux 2.6 limits ﬁlename lookups to 40 sym-
bolic links to prevent “arbitrarily long lookups.”3 This
limits the attacker to C < 40. Despite this limit, the
attacker can still force the victim to visit over 80, 000 di-

3Comment in fs/namei.c. Note that this is not the same limit
that is used to prevent symbolic link loops, since each symbolic link
lookup is within a different component of the path.

308

14th USENIX Security Symposium

USENIX Association

OS

Linux 2.6.8
Solaris 9
FreeBSD 4.10-PR2

Filesystem MAXPATHLEN Link limit Dir. Size Max. Maze Max. Maze
Size (MB)
327
5
8

Length
81920
10240
16384

(KB)
4
0.5
0.5

4096
1024
1024

ext3
ufs
ufs

40
20
32

Table 2: MAXPATHLEN, the symbolic link limit, and other relevant parameters for three common Unix variants. Notice
that on Linux a single ﬁlename lookup can require traversing over 300MB of on-disk data.

rectories every time it calls access(2) or open(2). The
attacker is very likely to win the race if even just one of
these directories is not in the ﬁlesystem buffer cache.

Table 2 also shows the on-disk size of the largest maze
possible on each system. This ﬁgure gives us some in-
sight into why this attack is so successful. For example,
under Linux 2.6, an attacker can construct a ﬁlename that
requires loading over 300MB of data from disk, just to
resolve it. It is not surprising that when the victim calls
access(2) or open(2) on such a ﬁlename it is extremely
likely to sleep on I/O, giving the attacker plenty of time
to execute her attack.

Probabilistic cache ﬂushing. Mazes are so powerful
that the attacker does not need to ﬂush all the attack di-
rectories from cache. Instead, she can simply do “best
effort” ﬂushing by engaging in ﬁlesystem activity of her
own. This activity will cause the buffer cache to ﬂush
old items to make space for the new ones. For example,
running the command grep -r any string /usr
> /dev/null 2>&14 populates the buffer cache with
new items and will often ﬂush some of the attack direc-
tories from the cache. With large mazes, the recursive
grep is very likely to ﬂush at least one of the directories
in each maze, enabling the attacker to successfully break
the k-Race algorithm.

Summary. To defeat k-Race using k strengthening
rounds, the attacker creates M = 2k + 2 directories,
maze0, . . ., maze2k + 1, builds a maze in each of these
directories, and sets the symlink activemaze to ini-
tially point to maze0, as shown in Figure 8. The exit
links in the even-numbered mazes point to an attacker
accessible ﬁle, and the exit links in the odd-numbered
mazes point to the protected ﬁle under attack. After cre-
ating this directory setup, the attacker uses grep or some
other common Unix tool to ﬂush some of the directories
in the mazes out of cache. She then executes the vic-
tim with the path activemaze/sentry/lnk/.../
lnk and advances activemaze to point to the next

4We have found this method more reliable if the grep command
searches the ﬁles on the same disk as the mazes. This is likely to be a
consequence of on-disk caching.

activemaze

relative link

Maze 0

relative link from exit to public file

Maze 1

relative link from exit to secret file

Maze 2

relative link from exit to public file

Maze 3

relative link from exit to secret file

Maze 4

relative link from exit to public file

Figure 8: Malicious directory structure to attack the k-
Race defense using the maze structure from Figure 6.
This construction is particularly effective when k is large.

maze directory whenever she detects that the access time
of activemaze/sentry has changed.

Experimental results. We implemented the k-Race al-
gorithm,
including randomized delays between every
system call and between each round of strengthening.
We did not implement the extended k-Race defenses,
such as setting the victim scheduling priority to FIFO
or using mlock() to pin its pages in memory. We do
not believe these enhancements would prevent our attack
from succeeding.

We implemented and tested the attack on three Unix
variants: Linux 2.6.8, Solaris 9, and FreeBSD 4.10-PR2.
The Linux machine contains a 1.3GHz AMD Athlon pro-
cessor, 1GB of RAM,and a 160GB, 7200RPM IDE disk
with an 8MB on-disk cache and 9ms average seek time.
The FreeBSD machine contains a 1.4GHz Pentium IV,
512MB of RAM, and a 40GB, 7200RPM IDE disk with
a 2MB on-disk cache and 8.5ms average seek time. The
Solaris machine is a multiprocessor with two 450MHz
UltraSPARC processors, 1GB of RAM, and a RAID-1
mirror built on two 9GB SCSI disks: one 10, 000RPM
drive with a 4MB buffer, and one 7200RPM disk with a

USENIX Association

14th USENIX Security Symposium

309

OS

k-Race Parameters

Attack Parameters Wins / Trials

Linux 2.6.8
Solaris 9
FreeBSD 4.10-PR2
Linux 2.6.8
Solaris 9
FreeBSD 4.10-PR2
Linux 2.6.8

k Randomized M
201
201
201
201
201
201
50

100 No
100 No
100 No
100 Yes
100 Yes
100 Yes
1000 No

C × N
400
400
200
400
1200
200
7000

22/100
83/100
100/100
19/100
77/100
88/100
83/100

Table 3: Attack success rates against the k-Race algorithm. k is the k-Race security parameter, M is the number of
maze directories used for the attack, C × N is the total number of directories in each maze. We used grep to ﬂush
the ﬁlesystem cache before each trial. The ﬁrst three experiments show that our maze attack works on several versions
of Unix and scales to large values of k by using more mazes. The three experiments against the randomized k-Race
algorithm show that our system call distinguishers are effective, and that our attack is insensitive to the ordering of the
victim’s calls to access(2), open(2), and fstat(2). The last experiment with k = 1000 shows that by re-using mazes we
can even attack extremely large values of k.

2MB buffer. The Linux machine used the ext3 ﬁlesys-
tem, while the Solaris and FreeBSD machine each used
ufs. Table 2 summarizes the conﬁguration and capa-
bilities of each machine and its operating system. Our
results are given in Table 3, and show that, even with
k = 100, we can defeat the k-Race algorithm easily on a
variety of systems. For example, we were able to win 83
out of 100 trials on Solaris, and 100 out of 100 trials on
FreeBSD.

We stop short of performing an exhaustive analysis of
how individual factors such as memory size, hard drive
model, and operating system affect the success of our
attack. Our goal is simply to show that the attack is suc-
cessful under a broad sampling of realistic hardware and
software characteristics, which is sufﬁcient evidence that
the k-Race defense must not be used in practice.

Extensions. Our attack avoids the ﬁlesystem cache by
using a separate maze for each of the victim’s system
calls, but we can re-use mazes for extremely large val-
ues of k. As shown in Table 2, large mazes can consume
over 300MB of disk space on some operating systems.
A machine with, say, 1GB of RAM can only cache 3
of these mazes, so after the victim performs 4 system
calls, the operating system will have ﬂushed many of the
cache entries for directories in the ﬁrst maze. The at-
tacker can therefore safely reuse the ﬁrst maze. In gen-
eral, the adversary can break the k-Race defense using
extremely large k by creating as many mazes as neces-
sary to ﬁll the ﬁlesystem cache and then cycling among
these mazes during the attack. We used this technique to
attack k-Race with k = 1000 on Linux 2.6, and found
that with 50 mazes of sizes 28MB each, we can break
the k-Race defense 83 times out of 100. (We used mazes

smaller than the maximal size because, even with this
size of maze, a single trial was taking over 5 minutes.)

If the I/O ampliﬁcation methods described above are
not sufﬁcient to enable the attacker to win races handily,
she can create thousands of dummy ﬁles in each direc-
tory of each chain. This method of slowing down name
resolution was previously suggested by Mazi`eres and
Kaashoek [5]. These dummy entries will force the ker-
nel to read even more data from disk while performing
name resolution for each of the victim’s system calls. As
mentioned above, resolving a ﬁlename through a maze
may require reading hundreds of megabytes of data from
disk. By adding dummy entries in each chain directory,
an attacker can force the kernel to read gigabytes of data
from disk. We did not implement this extension because
the basic mazes were sufﬁcient to attack every system we
tested.

In summary, we have shown a practical attack against
the k-Race defense using extremely high values for the
security parameter k and on a variety of Unix operating
systems.

6 A Randomized k-Race Algorithm

Dean and Hu’s defense performs a deterministic se-
quence of access(2) and open(2) system calls, and the
attack in Section 4 exploits that by deterministically
switching between a publicly accessible ﬁle and the tar-
get ﬁle. This suggests a potential countermeasure to our
attack: in each iteration of strengthening, the victim ran-
domly chooses to perform either an access(2) or open(2)
call. Now our attack will fail unless it can determine
the victim’s sequence of system calls. We next introduce
system call distinguishers to overcome this obstacle.

310

14th USENIX Security Symposium

USENIX Association

activemaze

relative link

Maze 0

relative link from exit

Maze 1

relative link from exit

Maze 2

relative link from exit

Maze 3

relative link from exit

Maze 4

relative link from exit

relative link

target

relative link

public

secret

relative link to public file

relative link to secret file

Figure 9: Malicious directory structure for attacking the
randomized k-Race defense. The exit links in each
maze point to the symbolic link target and the attacker
points target to the public or protected ﬁle depending
on the victim’s current system call.

7 Attack on Randomized k-Race

Recall that our attack program gains access to the CPU
while the victim is in the middle of executing one of its
system calls, so it is impossible for the adversary to pre-
dict the victim’s next system call. Instead, we describe
methods for determining the victim’s current system call
and reacting appropriately.

Distinguishing access(2) and open(2) calls is surpris-
ingly easy on most Unix operating systems. In Solaris 9,
any process can read the current system call number of
any other process from /proc/pid/psinfo. Linux
and FreeBSD do not export the system call numbers of
processes, but we can exploit a side effect of their imple-
mentations of the access(2) system call. Recall that ac-
cess(2) enables a setuid-root process to determine if the
invoking user can access a certain ﬁle. When a setuid-
root process runs, the invoking user’s ID is stored in the
processes real user ID, and its effective user ID is set to
0, giving it root privileges. FreeBSD implements the ac-
cess(2) system call by copying the process’s real user ID
to its effective user ID, resolving the given ﬁlename and
performing permission checks using the effective user
ID, and then restoring the effective user ID to its original
value. Every process’s real and effective user IDs can be
read from /proc/pid/status on FreeBSD, so an at-

for i = 1 to 2k + 1

save atime(activemaze/sentry)
while atime(activemaze/sentry) unchanged

sleep

distinguish victim’s current system call
toggle target symlink between secret and

public to match victim’s system call

link activemaze to mazei

the k-
Figure 10: Attacker’s algorithm to defeat
Race scheme after setting up the directory structure
depicted in Figure 9.
The victim opens the ﬁle
activemaze/sentry/lnk/lnk/.../lnk.

tacker can determine whether the victim is currently call-
ing access(2) or open(2) by simply checking the victim’s
user IDs: if the victim’s effective and real user IDs are
equal, then it is calling access(2), otherwise it is calling
open(2). Linux implements access(2) in a similar way,
but Linux has a notion of a process “ﬁlesystem user ID”
(fsuid) that is used in all ﬁlesystem-related permission
checks. The Linux access(2) system call copies the pro-
cess’s real user ID to its ﬁlesystem user ID instead of its
effective user ID, but the attacker can still use the same
idea. She simply checks whether the victim’s ﬁlesystem
ID is equal to its real user ID. We have tested these ac-
cess(2)/open(2) distinguishers on Solaris 9, Linux 2.6,
and FreeBSD, and they all work. Based on our reading
of OpenBSD’s source code, its access(2) implementation
behaves just like FreeBSD’s, so this attack should work
on OpenBSD, as well.

Once the adversary has determined which system call
the victim is executing, she must change the symbolic
links in the maze to ensure the victim’s system call suc-
ceeds. Toggling activemaze will not work because,
by the time the attacker gets to run, the victim has al-
ready resolved that symbolic link. The attacker needs to
switch a symbolic link that the victim has not processed
yet. To support this operation, we set up the mazes as
shown in Figure 9, and the attacker toggles the sym-
bolic link, target, between the public and protected
ﬁles based on the victim’s current system call. Figure 10
shows the attacker’s new algorithm. When the victim
makes a system call, it is forced to sleep on I/O while re-
solving the ﬁlename. The attacker then wakes up, deter-
mines the victim’s current system call, switches target
so the victim’s system call will succeed, and advances
activemaze to point to the next maze. When the vic-
tim resumes, it ﬁnishes resolving the ﬁlename using the
new value for target, so the system call succeeds.

We tested this attack on Linux, Solaris, and FreeBSD.
Table 3 shows our results. Against the randomized k-
Race algorithm using k = 100 our attack won at least

USENIX Association

14th USENIX Security Symposium

311

access(2)/open(2)
k-Race, k = 7
k-Race, k = 100
Fork-Open

1.7 GHz Athlon
3 µ sec
30 µ sec
393 µ sec
135 µ sec

Linux 2.6 FreeBSD 4.10-PR2

Solaris 9
1.3GHZ P-IV 450MHZ Ultra
253 µ sec
2210 µ sec
27600 µ sec
5750 µ sec

8 µ sec
91 µ sec
1190 µ sec
582 µ sec

Table 4: Running times for different access(2)/open(2) techniques on different operating systems. We measured the
elapsed cycle count for each call and repeated each measurement 1000 times to compute the average speed. The
measurements for the k-Race algorithm do not include randomized waits, so these results are a lower bound on the
running time of k-Race.

19% of the trials and up to 88%. From this, we conclude
that the randomized k-Race algorithm is not secure. Note
also that by using system call distinguishers our attack on
the randomized algorithm performs about as well as the
attack on the deterministic algorithm.

The three techniques we have developed in this paper
— mazes, synchronization primitives, and system call
distinguishers — are general tools that adversaries can
use to exploit a variety of Unix ﬁlesystem races. For
this reason, we believe that race condition exploits are
real threats that should be treated with the same level
of care as other software vulnerabilities, such as buffer
overﬂows and format string bugs.

8 Other Defenses

Fork. As mentioned by Dean and Hu, there is at least
one secure, cross-platform option to solve this problem.
A program can eschew the use of the access(2) system
call and rely on the operating system to enforce the per-
mission checks when it opens the ﬁle. When the program
needs to open an invoker-accessible ﬁle, it can fork a new
process that then uses the setuid(2) call to drop the setuid
privilege and run only with the rights of the invoker. The
new process can then call open(2) and the operating sys-
tem will enforce that the program’s invoker has rights
to open the ﬁle. Once the forked process successfully
obtains a ﬁle descriptor, it can use standard Unix IPC
mechanisms to pass the ﬁle descriptor back to its parent
process. The parent process can use the ﬁle descriptor as
normal.

2.6, Solaris 9.1,

We have implemented this forking technique and
tested it on Linux 2.4,
and
FreeBSD 4.10-PR2 [11]. Our fork(2)/open(2) function
has the same interface as open(2), taking a string path-
name and a ﬂags parameter. It returns a ﬁle descriptor
but ensures that the program’s invoker (determined by
getuid(2)) can access the ﬁle. We envision that the code
can be placed in a library, such as libc.

One drawback with this technique is that it is much
slower than the k-Race scheme using the recommended

parameter k = 7, as can be seen in Table 4. However,
we have shown that k-Race is insecure even up to k =
100, and our experiments show that the fork(2)/open(2)
solution is faster than k-Race with k = 100.

Kernel solutions. Forking a process to open a ﬁle is a
heavy-weight solution, and a little help from the kernel
could go a long way. For example, if temporarily drop-
ping privileges were portable across different versions of
Unix, then a setuid-root program could simply temporar-
ily drop privileges, open the ﬁle, and restore privileges.
Privilege management in Unix is a notorious mess [2],
but any progress on that problem would translate into im-
mediate improvements here. Alternatively, OS kernels
can add a new ﬂag, O RUID, to the set of ﬂags for the
open call, as suggested by Dean and Hu.

Until privilege management or the O RUID ﬂag be-
come standardized, the C library can emulate these fea-
tures to create a simple portable interface. For exam-
ple, the C library could introduce a new set of user id
management interfaces that hide all the non-portable de-
tails of each OS implementation. Similarly, the C library
could emulate O RUID by temporarily dropping privi-
leges while performing the open(2) call.

Any solution like these would enable setuid-root pro-
grams to open ﬁles with the same security guarantees as
the fork(2)/open(2) solution, but with the performance
of a simple call to open(2). This would be a signiﬁcant
performance beneﬁt, as shown in Table 4, and would be
clearly superior to Dean and Hu’s defense in both secu-
rity and speed.

9 Related Work

A number of projects use static analysis techniques to
ﬁnd race conditions in C source code. Bishop and Dilger
gave one of the earliest formal descriptions of the ac-
cess(2)/open(2) race condition and used this formalism
to characterize when the race condition occurs [1]. Us-
ing this characterization, they developed a static analysis
tool that ﬁnds TOCTTOU races by looking for sequences

312

14th USENIX Security Symposium

USENIX Association

of ﬁle system operations that use lexically identical argu-
ments. Because their tool performs no data ﬂow analy-
sis, it may fail to report some real vulnerabilities. Chen
et al. used software model checking to check temporal
safety properties in eight common Unix applications [3].
Their tool, MOPS, is able to detect stat(2)/open(2) races.
Later work with MOPS by Schwarz et al. checked all of
Red Hat 9 and found 41 ﬁlesystem TOCTTOU bugs [10].
MOPS has similar limitations to Bishop and Dilger’s tool
because it also doesn’t perform data ﬂow analysis.

Static analysis techniques may generate many false
positives, requiring the developer to sift through numer-
ous warnings to ﬁnd the actual bugs. Dynamic tech-
niques aim to reduce the number of false positives by
observing runtime program behavior and looking for
TOCTTOU race conditions. Tsyrklevich and Yee de-
tected races by looking for “pseudo-transactions”, i.e.
pairs of system calls that are prone to TOCTTOU ﬁle
race vulnerabilities [12]. Upon detecting a race in a run-
ning system, their tool asks the user for a course of ac-
tion. Ko and Redmond used a similar approach to look
for dangerous sequences of system calls [7]. They wrote
a kernel extension that looks for interfering system calls,
i.e. system calls that changes the outcome of another
group of system calls. For example, their scheme would
detect our attack because the attacker’s unlink(2) calls in-
terfere with the victim’s calls to open(2) and access(2).
Cowan et al developed RaceGuard, a kernel enhance-
ment that prevents temporary ﬁle creation race condi-
tions by detecting changes to the ﬁle system between
calls to stat(2) and open(2). Related to Tsyrklevich and
Yee’s pseudo-transaction notion, the QuickSilver operat-
ing system adds support for ﬁlesystem transactions [9].
A process could prevent TOCTTOU races by enclosing
dependent system calls in one transaction. Mazi`eres and
Kaashoek give principles for designing an operating sys-
tem to avoid TOCTTOU bugs [5]. They note that an at-
tacker can create many ﬁles in a directory so that name
resolution slows down and hence easily win TOCTTOU
ﬁle races. Their solution encompasses a richer OS in-
terface to enable ﬁner grain access controls and greater
control over name resolution.

10 Conclusion

We described a practical attack on the k-Race algorithm,
developed a randomized version of k-Race, and broke
that scheme, too. The latter attack shows that our system
call distinguishers are a powerful attack tool and that our
attack is insensitive to the exact sequence of system calls
performed by the victim. We therefore reafﬁrm the con-
ventional wisdom that access(2) should never be used in
secure programs. The tools we created as part of this
attack — mazes, system call synchronizers, and system

call distinguishers — are applicable to a wide variety of
Unix ﬁlesystem races. We discussed several alternative
solutions to access(2)/open(2) races that offer determin-
istic security guarantees.

Availability

The source code for our k-Race implementation and at-
tack software is available at http://nikita.ca/
research/races.tar.gz.

Acknowledgements

We would like to thank David Molnar and the anony-
mous reviewers for their insightful comments and our
shepherd, Eu-Jin Goh, for his help in preparing the ﬁnal
version of this paper. This work was supported in part by
the NSF under grants CCR-0093337 and CCF-0430585
and by the US Postal Service.

References

[1] Matt Bishop and Michael Dilger. Checking for race
conditions in ﬁle accesses. Computing Systems,
9(2):131–152, Spring 1996.

[2] Hao Chen, Drew Dean, and David Wagner. Setuid
demystiﬁed. In Proceedings of the 11th Usenix Se-
curity Symposium, pages 171–190, August 2002.

[3] Hao Chen, Drew Dean, and David Wagner. Model
checking one million lines of C code. In Proceed-
ings of the 11th Annual Network and Distributed
System Security Symposium (NDSS), pages 171–
185, February 2004.

[4] Drew Dean and Alan Hu. Fixing races for fun and
In Proceedings of
proﬁt: How to use access(2).
13th Usenix Security Symposium, pages 195 – 206,
August 2004.

[5] David Mazi`eres and M. Frans Kaashoek. Secure
In
applications need ﬂexible operating systems.
Proceedings of the 6th Workshop on Hot Topics in
Operating Systems (HotOS-VI), pages 56–61, 1997.

[6] Norm Hardy. The confused deputy: (or why capa-
bilities might have been invented). ACM SIGOPS
Operating Systems Review, 22(4):36–38, October
1988.

[7] Calvin Ko and Timothy Redmond. Noninterference
and intrusion detection. In Proceedings of the 2002
IEEE Symposium on Security and Privacy, pages
177–187, May 2002.

USENIX Association

14th USENIX Security Symposium

313

[8] W. S. McPhee. Operating system integrity in
IBM Systems Journal, 13(3):230–252,

OS/VS2.
1974.

[9] Frank Schmuck and Jim Wyllie. Experience with
transactions in QuickSilver. In Proceedings of the
13th ACM Symposium on Operating System Princi-
ples, pages 239–253, October 1991.

[10] Benjamin Schwarz, Hao Chen, David Wagner, Ge-
off Morrison, Jacob West, Jeremy Lin, and Wei Tu.
Model checking an entire Linux distribution for se-
curity violations. Technical Report UCB//CSD-05-
1384, UC Berkeley, April 2005.

[11] W. Richard Stevens. Unix Network Programming,
chapter 14.7: Passing Descriptors. Prentice Hall
PTR, 1997.

[12] Eugene Tsyrklevich and Bennet Yee. Dynamic de-
tection and prevention of race conditions in ﬁle ac-
cesses. In Proceedings of the 12th Usenix Security
Symposium, pages 243–255, August 2003.

314

14th USENIX Security Symposium

USENIX Association



=== Content from access.redhat.com_f663d72b_20250108_155750.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2024 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_e19360ba_20250108_155751.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2024 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from www.usenix.org_881a4d1f_20250108_155745.html ===
Fixing Races for Fun and Proﬁt: How to abuse atime

Nikita Borisov

Rob Johnson
Naveen Sastry
University of California, Berkeley
{nikitab, rtjohnso, nks, daw}@cs.berkeley.edu

David Wagner

Abstract

Dean and Hu proposed a probabilistic countermeasure
to the classic access(2)/open(2) TOCTTOU race condi-
tion in privileged Unix programs [4]. In this paper, we
describe an attack that succeeds with very high proba-
bility against their countermeasure. We then consider a
stronger randomized variant of their defense and show
that it, too, is broken. We conclude that access(2) must
never be used in privileged Unix programs. The tools
we develop can be used to attack other ﬁlesystem races,
underscoring the importance of avoiding such races in
secure software.

1 Introduction

At USENIX Security 2004, Dean and Hu described a
probabilistic scheme for safely using the access(2) sys-
tem call in Unix systems [4]. The access(2) system call
is known to be vulnerable to Time Of Check To Time Of
Use (TOCTTOU) race attacks, and for this reason it has
fallen into almost complete disuse. This leaves Unix pro-
grammers without a portable, secure, and efﬁcient way
of checking a ﬁle’s permissions before opening it. Thus
Dean and Hu’s scheme would be a boon to systems pro-
grammers if it were secure. In this paper, we show that it
is not.

Dean and Hu’s scheme, which we call k-Race, thwarts
attackers by forcing them to win numerous races to suc-
cessfully attack the system. The strength of their scheme
rests on the assumption that an attacker has a low prob-
ability of winning each race, and hence an exponentially
low probability of winning all the races. Dean and Hu
identify two difﬁculties with winning repeated races: en-
suring that the attacker gets scheduled in time to win
each race, and staying synchronized with the victim over
many successive races. We develop three tools which
help us overcome these difﬁculties: ﬁlesystem mazes,
which greatly slow down ﬁlesystem operations of a vic-

OS
FreeBSD 4.10-PR2
Linux 2.6.8
Solaris 9

Attacker Wins / Trials
92/100
98/100
100/100

Table 1: Success rates of our attack against Dean
and Hu’s defense using the recommended security pa-
rameter, k = 7, on several platforms.

tim, system call synchronizers, and system call distin-
guishers. Using these tools, we can win races with ex-
tremely high probability, violating Dean and Hu’s as-
sumption. We use these tools to build an attack that
reliably breaks the k-Race algorithm using the recom-
mended parameter, and works on a variety of operating
systems. As shown in Table 1, our attack defeats the k-
Race algorithm over 90% of the time on every operating
system we tested.

Our attack remains successful even when the security
parameter is much larger than recommended by Dean
and Hu. We also consider a randomized extension of
the k-Race algorithm that makes non-deterministic se-
quences of calls to access(2), open(2), and fstat(2), and
show that it can be defeated as well. The tools we de-
velop for this attack are applicable to other Unix ﬁlesys-
tem race vulnerabilities, such as the stat(2)/open(2) race
common in insecure temporary ﬁle creation. We have
ported our attack code to several Unix variants and it suc-
ceeds on all of them. Our technique exploits the perfor-
mance disparity between disks and CPUs, so as this gap
grows our attack will become more powerful. This re-
futes Dean and Hu’s claim that as CPU speeds increase in
the future, the risk to systems using their defense would
decline.

Recent research in automated code auditing has dis-
covered over 40 TOCTTOU races in the Red Hat Linux
distribution [10]. This result, combined with our tech-

USENIX Association

14th USENIX Security Symposium

303

niques for exploiting race conditions, shows that races
are a prevalent and serious threat to system security.

In short, we show that the k-Race algorithm is inse-
cure, that Unix ﬁlesystem races are easy to win, and that
they will continue to be easy to win for the foreseeable
future. The rest of this paper is organized as follows. We
begin by reviewing setuid programs in Unix and the ac-
cess(2)/open(2) race. Section 3 presents Dean and Hu’s
countermeasure for preventing access(2)/open(2) races.
We then describe a simple attack on Dean and Hu’s
scheme in Section 4, and enhance this attack in Sec-
tion 5. Sections 6 and 7 describe a randomized gener-
alization of the k-Race algorithm, and an attack on that
scheme. Section 8 considers other defenses against the
access(2)/open(2) race. We consider related work in Sec-
tion 9, and summarize our contributions in Section 10.

2 The access(2)/open(2) race

The access(2) system call was introduced to address a
problem with setuid-root programs. The original Unix
authors invented the setuid mechanism to support con-
trolled sharing in Unix environments. A setuid program
runs with the permissions of the executable’s owner in-
stead of the invoker, enabling it to use private data ﬁles
that the program’s invoker cannot access. As a special
case, a setuid-root program can access any ﬁle on the
system, including the invoker’s personal ﬁles. This leads
to a classic confused deputy problem [6].

To see how the confused deputy problem arises, con-
sider a setuid-root printing program that prepares users’
ﬁles for printing and puts them onto the printing queue.1
The queue is not accessible to ordinary users, but the
setuid-root program can write to it. The program should
only let users print ﬁles that they themselves can access.
Unfortunately, since setuid-root programs have permis-
sion to read every ﬁle on the system, this implementation
does not have any easy way to determine whether the re-
quested input ﬁle is readable by the caller.

To solve this problem, Unix introduced the access(2)
system call. A setuid program can use the access(2) sys-
tem call to determine whether the invoker has the rights
needed to open a ﬁle. This solves the confused deputy
problem, but it also introduces a new security vulnera-
bility: Time Of Check To Time Of Use races [8]. The
vulnerability occurs because the return value from ac-
cess(2) tells us about the state of the ﬁlesystem at some
recent time in the past, but tells us nothing about what
the state will be when we next operate on the ﬁlesystem.
To illustrate the vulnerability, consider a typical setuid
program, which might call access(2) to check a ﬁle’s per-

1This example is inspired by an actual vulnerability in lpr
see https://www.redhat.com/archives/

in Red Hat,
redhat-watch-list/1999-October/msg00012.html.

// Victim (installed setuid-root)
void main (int argc, char **argv)
{

int fd;
if (access(argv[1], R OK) != 0)

exit(1);

fd = open(argv[1], O RDONLY);
// Do something with fd...

}

Figure 1: A setuid-root program vulnerable to the ac-
cess(2)/open(2) TOCTTOU race attack. An attacker may
be able to change the ﬁlesystem between the calls to ac-
cess(2) and open(2).

missions and then call open(2) to actually open the ﬁle
if the check succeeds, as shown in Figure 1. Unfortu-
nately, this code idiom is insecure. A clever attacker can
attempt to modify the ﬁlesystem (e.g. by changing sym-
bolic links) between the access(2) and open(2) system
calls so that when the setuid program calls access(2), the
given ﬁlename points to a safe, accessible ﬁle, but when
the setuid program calls open(2), the ﬁlename points to
a protected ﬁle. Thus, even if a setuid program uses ac-
cess(2), an attacker can still trick it into opening ﬁles that
it should not.

Figure 1 shows a typical setuid-root program that is
vulnerable to the access(2)/open(2) race, and Figure 2
shows a simple attack program that can trick the vic-
tim into opening /etc/shadow, a ﬁle that only root
can read. The attack is very timing dependent: the at-
tack program only succeeds if it manages to interrupt the
victim program between its access(2) call and open(2)
call. When this happens, the access(2) call succeeds
because, at that time, the path activedir/lnk re-
solves to a user-accessible ﬁle, public file. Af-
ter the victim calls access(2), it gets interrupted, and
the victim changes the symbolic link activedir to
point to dir1. When the victim resumes,
it calls
open(2) on activedir/lnk, which now resolves to
/etc/shadow. Since the victim is a setuid-root pro-
gram, the open(2) succeeds, but the victim believes that
it has opened a ﬁle accessible by the invoking user.

Notice that the attacker has a much better chance of
winning the race if dir0 is not currently in the buffer
cache. If that is the case, then the victim’s call to ac-
cess(2) will have to fetch the contents of dir0 from disk.
This I/O will put the victim to sleep, giving the attacker a
chance to run and switch the symbolic link activedir.
This observation is one of the key ideas behind our attack
on the k-Race defense.

304

14th USENIX Security Symposium

USENIX Association

// Attacker
void main (int argc, char **argv)
{

// Assumes directories and links:
// dir0/lnk -> public file
// dir1/lnk -> /etc/shadow
// activedir -> dir0

// Let the victim run
if (fork() == 0) {

system("victim activedir/lnk");
exit(0);

}
usleep(1); // yield CPU

// Switch where target points
unlink("activedir");
symlink("dir1", "activedir");

}

Figure 2: A program for exploiting access(2)/open(2)
races. A non-root attacker can use this program to ex-
ploit the setuid-root program shown in Figure 1.

3 The k-Race proposal

Dean and Hu noticed that, in practice, exploiting the ac-
cess(2) race condition can be quite difﬁcult. Their exper-
iments showed that a naive attacker can only expect to
win a race with probability 10−3 on uniprocessor ma-
chines and 10−1 on multiprocessor machines. Based
on this evidence, Dean and Hu proposed a probabilistic
countermeasure to this race condition. By requiring the
attacker to win a large number of races, they intended to
make it practically impossible to successfully exploit the
access(2)/open(2) race.

An implementation of their defense is given in Fig-
ure 3. The k-Race algorithm essentially repeats the ac-
cess(2)/open(2) idiom k times. To ensure that the at-
tacker must win a race between every system call, the k-
Race algorithm uses fstat(2) to check that every open(2)
call resolves to the same ﬁle. To see how this works, con-
sider an attacker trying to defeat k-Race. After the victim
makes the ﬁrst access(2) call, the attacker must switch
symlinks so that, when the victim calls open(2), the given
ﬁlename points to a protected ﬁle. After the ﬁrst call to
open(2), the attacker has tricked the victim into opening
a secret ﬁle, but the k-Race algorithm forces the attacker
to continue racing with the victim as follows. The vic-
tim next performs another call to access(2). The attacker
must race to switch the symlink to point to a public ﬁle,
or this access(2) call will not succeed. Next, the victim
calls open(2) again and uses fstat(2) to verify that the re-

int dh_access_open(char *fname)
{

int fd, rept_fd;
int orig_ino, orig_dev;
struct stat buffer;

if (access(fname, R_OK) != 0)

return -1;

fd = open(fname, O_RDONLY);
if (fd < 0)

return -1;

// This is the strengthening.
// *First, get the original inode.
if (fstat(fd, &buffer) != 0)

goto error;

orig_inode = buffer.st_ino;
orig_device = buffer.st_dev;

// Now, repeat the race.
// File must be the same each time.
for (i=0; i < k; i++) {

if (access(fname, R_OK) != 0)

goto error;

rept_fd = open(fname, O_RDONLY);
if (rept_fd < 0)
goto error;

if (fstat(rept_fd, &buffer) != 0)

goto error;

if (close(rept_fd) != 0)

goto error;

if (orig_inode != buffer.st_ino)

goto error;

if (orig_device != buffer.st_dev)

goto error;

/* If generation numbers are

available, do a similar check
for buffer.st_gen. */

}

return fd;

error:

close(fd);
close(rept_fd);
return -1;

}

Figure 3: Dean and Hu’s k-Race algorithm [4]. An at-
tacker must win 2k + 1 races to defeat this algorithm.

USENIX Association

14th USENIX Security Symposium

305

sulting ﬁle descriptor is a handle on the same ﬁle as the
result of the ﬁrst call to open(2). In order for this test
to succeed, the attacker must race to switch the symlinks
again to point to the private ﬁle. By making four system
calls, access(2), open(2), access(2), open(2), the victim
has forced the attacker to win three races.

In general, the k-Race algorithm allows the setuid-root
program to make k strengthening rounds of additional
calls to access(2) and open(2), forcing the attacker to win
a total of 2k+1 races. Dean and Hu reason that, since the
adversary must win all 2k + 1 races, the security guaran-
tees scale exponentially with the number of rounds. If p
is the probability of winning one race, then the attacker
will defeat the k-Race defense with probability ≈ p2k+1.
Their measurements indicate that p ≤ 1.4 × 10−3 on
uniprocessor machines on a range of operating systems,
and p ≤ 0.12 on a multiprocessor Sun Solaris machine.
Dean and Hu suggest k = 7 as one reasonable parameter
setting, and they estimate that with this choice the prob-
ability of a successful attack should be below 10−15.

In their argument for the security of their scheme,
Dean and Hu consider a slightly modiﬁed attacker that
attempts to switch activedir back and forth between
dir0 and dir1 between each system call made by the
victim. They observe that this attack will fail for two
reasons. First, the attacker is extremely unlikely to win
any race if dir0 is in the ﬁlesystem cache. Moreover,
even if the attacker gets lucky and dir0 is out of cache
during the victim’s ﬁrst call to open(2), the victim’s call
to open(2) will bring dir0 into the cache. In this case,
dir0 will be in the cache for the victim’s second call
to open(2), so the attacker will lose that race. Dean
and Hu’s experiments support this claim. Second, they
note that this attack requires that the attacker remain syn-
chronized with the victim. Dean and Hu added random
delays between each access(2) and open(2) call to foil
any attempts by the attacker to synchronize with the vic-
tim.

Although ﬁlesystem caching and synchronization are
real problems for an attacker, we show in the next section
that it is possible to modify the attack to overcome these
difﬁculties.

4 Basic Attack

As Dean and Hu observed, an attacker must overcome
two obstacles to successfully attack their scheme. First,
ﬁlesystem caching prevents the attacker from winning
multiple races. Second, the attacker must synchronize
with the victim. We deal with each problem in turn.

Avoiding the cache. The attack analyzed by Dean
and Hu succumbs to caching effects because it re-uses

for i = 1 to 2k + 1

wait for victim’s next system call
link activedir to diri

Figure 4: Our algorithm for defeating the k-Race algo-
rithm. The algorithm forces the victim to perform I/O,
and hence yield the CPU to the attacker, by switching
among a series of directories, dir0, . . ., dir15, all
of which are out of the ﬁlesystem cache. The attacker
detects the start of each of the victim’s system calls by
monitoring the access time of symbolic links in each di-
rectory.

dir0 and dir1. To avoid ﬁlesystem caching, we create
16 separate directories, dir0, . . ., dir15, and use each
directory exactly once. The even-numbered directories
dir0, dir2, . . ., dir14 all contain symbolic links to
a publicly accessible ﬁle. The odd-numbered directories,
dir1, dir3, . . ., dir15, contain symbolic links to the
protected ﬁle we are attacking, such as /etc/shadow.
Initially, the symbolic link activedir points to dir0.
After each of the victim’s system calls,
the attacker
changes activedir to point to the next directory, as
shown in the pseudo-code in Figure 4.

Since the attacker uses each directory exactly once,
she has a much higher chance of winning all the races
against the victim. If the attack begins with none of the
directories in cache, then the victim will be forced to
sleep on I/O for each of its system calls, giving the at-
tacker time to update activedir to point to the next
directory.

This attack succeeds only when dir0, . . ., dir15 are
not in the operating system’s buffer cache. If the attacker
tries to run the attack immediately after creating these
directories, she will fail because they will all still be in
the cache. For the rest of this section, we assume the
attacker has some method to ﬂush all these directories
from cache after creating them. Section 5 describes a
more powerful attack that eliminates this assumption.

Staying in sync. To stay synchronized with the victim,
the attacker must be able to detect when the victim has
begun each call to access(2) or open(2). The key in-
sight is that Unix updates the access time on any sym-
bolic links it traverses during name resolution.2 The at-
tacker can use this to monitor the ﬁlesystem operations
performed by the victim. The attacker simply needs to

2Some NFS conﬁgurations do not update link access times, but ev-
ery local ﬁlesystem we tested exhibited this behavior. Some kernels
support a noatime mount option that disables access time updates.
Access time polling is not critical to our attack, though. The system
call distinguishers we develop in Section 7 can be used instead of ac-
cess time polling to synchronize with the basic k-Race algorithm.

306

14th USENIX Security Symposium

USENIX Association

dir0/iotrap/lnk symlink
−−−−−→ public file
symlink
−−−−−→ dir0/iotrap
dir0/sentry
dir1/iotrap/lnk symlink
−−−−−→ /etc/shadow
symlink
−−−−−→ dir1/iotrap
dir1/sentry
dir2/iotrap/lnk symlink
−−−−−→ public file
symlink
−−−−−→ dir2/iotrap
dir2/sentry

...

dir15/iotrap/lnk symlink
−−−−−→ /etc/shadow
symlink
−−−−−→ dir15/iotrap
dir15/sentry

Figure 5: The directory structure used in our basic attack
on the k-Race algorithm. The attacker synchronizes with
the victim by polling the access time of diri/sentry.
The attacker must ﬁrst ﬂush all the iotrap directories
from the ﬁlesystem cache so that the victim will sleep on
I/O when it traverses them. The attacker creates a sym-
bolic link activedir pointing to dir0 and runs the
victim with arguement activedir/sentry/lnk.

poll the access time of a symbolic link in the path it
passes to the victim. When the access time of that link
changes, the victim must have begun a call to access(2)
or open(2).

Unfortunately, there is a small hitch with this simple
approach. In Unix, the access time is recorded only to a
1-second granularity. Consequently, the attacker cannot
poll the access time of activedir because, every time
she updates activedir to point to a new directory, she
will change its access time to the current second, and
hence will not be able to detect further accesses for up to
a second. By then, the race will be over. Moreover, the
attacker cannot poll the access time on dir7/lnk since
this would pull dir7 into the ﬁlesystem cache. This
makes it a challenge to stay synchronized with the vic-
tim.

This hurdle can be surmounted with an appropriate
re-arrangement of the directory structure. See Figure 5
for the directory structure we use to enable polling with-
out disturbing the ﬁlesystem cache. Inside each direc-
tory, diri, we create another subdirectory iotrap and
a symbolic link sentry pointing to iotrap. We then
create the ﬁnal link, lnk, that points to the public or pro-
tected ﬁle inside diri/iotrap. The attacker gives the
victim the ﬁlename activedir/sentry/lnk, and
polls the access time of activedir/sentry.

Summary.

1. The attacker creates 16 directories as shown in Fig-
ure 5 and a symbolic link activedir to dir0.

2. She forces the cache entries for these directories out

of memory.

3. The attacker then executes the victim with argument

activedir/sentry/lnk.

(a) The victim calls access(2). The kernel be-
gins traversing this path and updates the ac-
cess time on dir0/sentry. After resolving
the symbolic link dir0/sentry, the vic-
tim is put to sleep while the operating system
loads the contents of dir0/iotrap. The
victim is now suspended in the middle of exe-
cuting the access(2) call.

(b) The attacker then gains the CPU, and polls
the access time on dir0/sentry. Upon
noticing that the access time has been updated,
the attacker knows that the victim has begun
its ﬁrst access(2) call. The attacker switches
activedir to point to dir1 and begins
polling the access time on dir1/sentry.
The victim’s suspended access(2) call will not
be affected by this change to activedir be-
cause it has already traversed that part of the
path.

(c) Eventually, the victim’s I/O completes and it

ﬁnishes the access(2) call successfully.

When the victim calls open(2),
the exact same se-
quence of events occurs: the kernel updates the access
time on dir1/sentry, the victim sleeps on I/O load-
ing dir1/iotrap, the attacker runs and notices the
updated access time on dir1/sentry, the attacker
switches activedir to point to dir2, and the victim
completes the open(2) successfully. This process repeats
for the victim’s remaining system calls, and the attacker
fools the victim into opening a protected ﬁle.

We implemented and tested this simple attack on sev-
eral different machines and found that the attack works
but is extremely sensitive to the target machine’s state.
For example, if the directories used in the attack happen
to be arranged close together on disk, then the attack will
often fail. In the next section, we develop a robust ver-
sion of this attack that succeeds with high probability on
all the machines we tested.

5 Full Attack

In this section, we increase the power and reliability of
our attack. The full attack is robust, succeeds with high
probability, can defeat the k-Race algorithm with over
100 rounds of strengthening, and doesn’t depend on the
attacker’s ability to perfectly ﬂush the kernel ﬁlesystem
cache.

USENIX Association

14th USENIX Security Symposium

307

sentry

relative link

chain6/d/d/d/···/d /lnk

absolute link

chain5/d/d/d/···/d /lnk

absolute link

chain4/d/d/d/···/d /lnk

absolute link

chain3/d/d/d/···/d /lnk

absolute link

chain2/d/d/d/···/d /lnk

absolute link

chain1/d/d/d/···/d /lnk

absolute link

chain0/d/d/d/···/d /lnk

absolute link

exit

relative link to target file

Figure 6: Malicious directory structure to force the vic-
tim to sleep on I/O with extremely high probability and
hence enable the attacker to win a single race. We call
this structure a maze. We place an arrow between a sym-
bolic link and the target it references in a dotted box.

I/O ampliﬁcation. We develop a tool called a maze to
slow down the I/O operations of the victim and hence
increase the chances that it will sleep. We start by cre-
ating a deep tree of nested directories. For example, in-
side dir0, the attacker creates the tree dir/dir/..
./dir/lnk instead of just dir/lnk. We call such
a deep nested directory structure a chain. The link
sentry should now point to dir/dir/.../dir,
and hence the attacker still runs the victim with the ar-
gument activedir/sentry/lnk. The victim will
be forced to sleep on I/O if at least one of the directories
in the chain is not currently in the buffer cache. Most
Unix systems impose a limit on the length of ﬁlename
paths, known as MAXPATHLEN, and this limits the depth
of chains created by the attacker. Common values for
MAXPATHLEN are 1024 and 4096 characters. Even with
these limits an attacker can create a directory tree over
500 directories deep, but the attacker can do even more.
MAXPATHLEN only limits the number of path ele-
ments that may be speciﬁed in a single system call, it
does not limit the number of directory elements that
may be traversed during a single name lookup. An at-
tacker can use symbolic links to connect two chains to-
gether as follows. First, the attacker creates a chain

procedure make maze(exit target, nchains, depth)

link exit to exit target
let top = current directory()
let target = top/exit
for i = 0 to nchains - 1
mkdir chaini
cd chaini
for j = 0 to depth
mkdir d
cd d

link lnk to target
let target = current directory()
cd top

link sentry to target

Figure 7: Algorithm to create the directory structure in
Figure 6.

chain0/dir/dir/.../dir/lnk, as above. Then
she creates another chain chain1/dir/dir/.../
dir/lnk, where the symbolic link at the bottom of this
chain points to chain0/dir/dir/.../dir. The
sentry link should now point to chain1/dir/dir/
.../dir. Now the attacker can invoke the victim, pass-
ing it the path activedir/sentry/lnk/lnk.
If
each chain is N directories deep, then the victim will
need to traverse 2N directories to resolve this ﬁlename.
This technique can be extended to create a maze of up
to C chains, chainC − 1, chainC − 2, ..., chain0,
where each chain has at its bottom a symbolic link point-
ing to the bottom of the next chain. Figure 6 shows one
such maze of directories in its entirety. For simplicity,
we create a ﬁnal link, exit, pointing to the target ﬁle, at
then end of the maze. We also use shorter names for the
directories in each chain, enabling us to create deeper
chains within the constraints of MAXPATHLEN. Pseu-
docode for constructing this maze is given in Figure 7.
With this structure, the attacker runs the victim with the
ﬁlename argument activedir/sentry/lnk/.../
lnk/lnk.

With C chains, each N directories deep, the victim
will have to traverse CN directories to resolve the given
ﬁlename. Unix systems usually impose a limit on the
total number of symbolic links that a single ﬁlename
lookup can traverse. Table 2 gives the MAXPATHLEN
and link limit for some common versions of Unix. For
example, Linux 2.6 limits ﬁlename lookups to 40 sym-
bolic links to prevent “arbitrarily long lookups.”3 This
limits the attacker to C < 40. Despite this limit, the
attacker can still force the victim to visit over 80, 000 di-

3Comment in fs/namei.c. Note that this is not the same limit
that is used to prevent symbolic link loops, since each symbolic link
lookup is within a different component of the path.

308

14th USENIX Security Symposium

USENIX Association

OS

Linux 2.6.8
Solaris 9
FreeBSD 4.10-PR2

Filesystem MAXPATHLEN Link limit Dir. Size Max. Maze Max. Maze
Size (MB)
327
5
8

Length
81920
10240
16384

(KB)
4
0.5
0.5

4096
1024
1024

ext3
ufs
ufs

40
20
32

Table 2: MAXPATHLEN, the symbolic link limit, and other relevant parameters for three common Unix variants. Notice
that on Linux a single ﬁlename lookup can require traversing over 300MB of on-disk data.

rectories every time it calls access(2) or open(2). The
attacker is very likely to win the race if even just one of
these directories is not in the ﬁlesystem buffer cache.

Table 2 also shows the on-disk size of the largest maze
possible on each system. This ﬁgure gives us some in-
sight into why this attack is so successful. For example,
under Linux 2.6, an attacker can construct a ﬁlename that
requires loading over 300MB of data from disk, just to
resolve it. It is not surprising that when the victim calls
access(2) or open(2) on such a ﬁlename it is extremely
likely to sleep on I/O, giving the attacker plenty of time
to execute her attack.

Probabilistic cache ﬂushing. Mazes are so powerful
that the attacker does not need to ﬂush all the attack di-
rectories from cache. Instead, she can simply do “best
effort” ﬂushing by engaging in ﬁlesystem activity of her
own. This activity will cause the buffer cache to ﬂush
old items to make space for the new ones. For example,
running the command grep -r any string /usr
> /dev/null 2>&14 populates the buffer cache with
new items and will often ﬂush some of the attack direc-
tories from the cache. With large mazes, the recursive
grep is very likely to ﬂush at least one of the directories
in each maze, enabling the attacker to successfully break
the k-Race algorithm.

Summary. To defeat k-Race using k strengthening
rounds, the attacker creates M = 2k + 2 directories,
maze0, . . ., maze2k + 1, builds a maze in each of these
directories, and sets the symlink activemaze to ini-
tially point to maze0, as shown in Figure 8. The exit
links in the even-numbered mazes point to an attacker
accessible ﬁle, and the exit links in the odd-numbered
mazes point to the protected ﬁle under attack. After cre-
ating this directory setup, the attacker uses grep or some
other common Unix tool to ﬂush some of the directories
in the mazes out of cache. She then executes the vic-
tim with the path activemaze/sentry/lnk/.../
lnk and advances activemaze to point to the next

4We have found this method more reliable if the grep command
searches the ﬁles on the same disk as the mazes. This is likely to be a
consequence of on-disk caching.

activemaze

relative link

Maze 0

relative link from exit to public file

Maze 1

relative link from exit to secret file

Maze 2

relative link from exit to public file

Maze 3

relative link from exit to secret file

Maze 4

relative link from exit to public file

Figure 8: Malicious directory structure to attack the k-
Race defense using the maze structure from Figure 6.
This construction is particularly effective when k is large.

maze directory whenever she detects that the access time
of activemaze/sentry has changed.

Experimental results. We implemented the k-Race al-
gorithm,
including randomized delays between every
system call and between each round of strengthening.
We did not implement the extended k-Race defenses,
such as setting the victim scheduling priority to FIFO
or using mlock() to pin its pages in memory. We do
not believe these enhancements would prevent our attack
from succeeding.

We implemented and tested the attack on three Unix
variants: Linux 2.6.8, Solaris 9, and FreeBSD 4.10-PR2.
The Linux machine contains a 1.3GHz AMD Athlon pro-
cessor, 1GB of RAM,and a 160GB, 7200RPM IDE disk
with an 8MB on-disk cache and 9ms average seek time.
The FreeBSD machine contains a 1.4GHz Pentium IV,
512MB of RAM, and a 40GB, 7200RPM IDE disk with
a 2MB on-disk cache and 8.5ms average seek time. The
Solaris machine is a multiprocessor with two 450MHz
UltraSPARC processors, 1GB of RAM, and a RAID-1
mirror built on two 9GB SCSI disks: one 10, 000RPM
drive with a 4MB buffer, and one 7200RPM disk with a

USENIX Association

14th USENIX Security Symposium

309

OS

k-Race Parameters

Attack Parameters Wins / Trials

Linux 2.6.8
Solaris 9
FreeBSD 4.10-PR2
Linux 2.6.8
Solaris 9
FreeBSD 4.10-PR2
Linux 2.6.8

k Randomized M
201
201
201
201
201
201
50

100 No
100 No
100 No
100 Yes
100 Yes
100 Yes
1000 No

C × N
400
400
200
400
1200
200
7000

22/100
83/100
100/100
19/100
77/100
88/100
83/100

Table 3: Attack success rates against the k-Race algorithm. k is the k-Race security parameter, M is the number of
maze directories used for the attack, C × N is the total number of directories in each maze. We used grep to ﬂush
the ﬁlesystem cache before each trial. The ﬁrst three experiments show that our maze attack works on several versions
of Unix and scales to large values of k by using more mazes. The three experiments against the randomized k-Race
algorithm show that our system call distinguishers are effective, and that our attack is insensitive to the ordering of the
victim’s calls to access(2), open(2), and fstat(2). The last experiment with k = 1000 shows that by re-using mazes we
can even attack extremely large values of k.

2MB buffer. The Linux machine used the ext3 ﬁlesys-
tem, while the Solaris and FreeBSD machine each used
ufs. Table 2 summarizes the conﬁguration and capa-
bilities of each machine and its operating system. Our
results are given in Table 3, and show that, even with
k = 100, we can defeat the k-Race algorithm easily on a
variety of systems. For example, we were able to win 83
out of 100 trials on Solaris, and 100 out of 100 trials on
FreeBSD.

We stop short of performing an exhaustive analysis of
how individual factors such as memory size, hard drive
model, and operating system affect the success of our
attack. Our goal is simply to show that the attack is suc-
cessful under a broad sampling of realistic hardware and
software characteristics, which is sufﬁcient evidence that
the k-Race defense must not be used in practice.

Extensions. Our attack avoids the ﬁlesystem cache by
using a separate maze for each of the victim’s system
calls, but we can re-use mazes for extremely large val-
ues of k. As shown in Table 2, large mazes can consume
over 300MB of disk space on some operating systems.
A machine with, say, 1GB of RAM can only cache 3
of these mazes, so after the victim performs 4 system
calls, the operating system will have ﬂushed many of the
cache entries for directories in the ﬁrst maze. The at-
tacker can therefore safely reuse the ﬁrst maze. In gen-
eral, the adversary can break the k-Race defense using
extremely large k by creating as many mazes as neces-
sary to ﬁll the ﬁlesystem cache and then cycling among
these mazes during the attack. We used this technique to
attack k-Race with k = 1000 on Linux 2.6, and found
that with 50 mazes of sizes 28MB each, we can break
the k-Race defense 83 times out of 100. (We used mazes

smaller than the maximal size because, even with this
size of maze, a single trial was taking over 5 minutes.)

If the I/O ampliﬁcation methods described above are
not sufﬁcient to enable the attacker to win races handily,
she can create thousands of dummy ﬁles in each direc-
tory of each chain. This method of slowing down name
resolution was previously suggested by Mazi`eres and
Kaashoek [5]. These dummy entries will force the ker-
nel to read even more data from disk while performing
name resolution for each of the victim’s system calls. As
mentioned above, resolving a ﬁlename through a maze
may require reading hundreds of megabytes of data from
disk. By adding dummy entries in each chain directory,
an attacker can force the kernel to read gigabytes of data
from disk. We did not implement this extension because
the basic mazes were sufﬁcient to attack every system we
tested.

In summary, we have shown a practical attack against
the k-Race defense using extremely high values for the
security parameter k and on a variety of Unix operating
systems.

6 A Randomized k-Race Algorithm

Dean and Hu’s defense performs a deterministic se-
quence of access(2) and open(2) system calls, and the
attack in Section 4 exploits that by deterministically
switching between a publicly accessible ﬁle and the tar-
get ﬁle. This suggests a potential countermeasure to our
attack: in each iteration of strengthening, the victim ran-
domly chooses to perform either an access(2) or open(2)
call. Now our attack will fail unless it can determine
the victim’s sequence of system calls. We next introduce
system call distinguishers to overcome this obstacle.

310

14th USENIX Security Symposium

USENIX Association

activemaze

relative link

Maze 0

relative link from exit

Maze 1

relative link from exit

Maze 2

relative link from exit

Maze 3

relative link from exit

Maze 4

relative link from exit

relative link

target

relative link

public

secret

relative link to public file

relative link to secret file

Figure 9: Malicious directory structure for attacking the
randomized k-Race defense. The exit links in each
maze point to the symbolic link target and the attacker
points target to the public or protected ﬁle depending
on the victim’s current system call.

7 Attack on Randomized k-Race

Recall that our attack program gains access to the CPU
while the victim is in the middle of executing one of its
system calls, so it is impossible for the adversary to pre-
dict the victim’s next system call. Instead, we describe
methods for determining the victim’s current system call
and reacting appropriately.

Distinguishing access(2) and open(2) calls is surpris-
ingly easy on most Unix operating systems. In Solaris 9,
any process can read the current system call number of
any other process from /proc/pid/psinfo. Linux
and FreeBSD do not export the system call numbers of
processes, but we can exploit a side effect of their imple-
mentations of the access(2) system call. Recall that ac-
cess(2) enables a setuid-root process to determine if the
invoking user can access a certain ﬁle. When a setuid-
root process runs, the invoking user’s ID is stored in the
processes real user ID, and its effective user ID is set to
0, giving it root privileges. FreeBSD implements the ac-
cess(2) system call by copying the process’s real user ID
to its effective user ID, resolving the given ﬁlename and
performing permission checks using the effective user
ID, and then restoring the effective user ID to its original
value. Every process’s real and effective user IDs can be
read from /proc/pid/status on FreeBSD, so an at-

for i = 1 to 2k + 1

save atime(activemaze/sentry)
while atime(activemaze/sentry) unchanged

sleep

distinguish victim’s current system call
toggle target symlink between secret and

public to match victim’s system call

link activemaze to mazei

the k-
Figure 10: Attacker’s algorithm to defeat
Race scheme after setting up the directory structure
depicted in Figure 9.
The victim opens the ﬁle
activemaze/sentry/lnk/lnk/.../lnk.

tacker can determine whether the victim is currently call-
ing access(2) or open(2) by simply checking the victim’s
user IDs: if the victim’s effective and real user IDs are
equal, then it is calling access(2), otherwise it is calling
open(2). Linux implements access(2) in a similar way,
but Linux has a notion of a process “ﬁlesystem user ID”
(fsuid) that is used in all ﬁlesystem-related permission
checks. The Linux access(2) system call copies the pro-
cess’s real user ID to its ﬁlesystem user ID instead of its
effective user ID, but the attacker can still use the same
idea. She simply checks whether the victim’s ﬁlesystem
ID is equal to its real user ID. We have tested these ac-
cess(2)/open(2) distinguishers on Solaris 9, Linux 2.6,
and FreeBSD, and they all work. Based on our reading
of OpenBSD’s source code, its access(2) implementation
behaves just like FreeBSD’s, so this attack should work
on OpenBSD, as well.

Once the adversary has determined which system call
the victim is executing, she must change the symbolic
links in the maze to ensure the victim’s system call suc-
ceeds. Toggling activemaze will not work because,
by the time the attacker gets to run, the victim has al-
ready resolved that symbolic link. The attacker needs to
switch a symbolic link that the victim has not processed
yet. To support this operation, we set up the mazes as
shown in Figure 9, and the attacker toggles the sym-
bolic link, target, between the public and protected
ﬁles based on the victim’s current system call. Figure 10
shows the attacker’s new algorithm. When the victim
makes a system call, it is forced to sleep on I/O while re-
solving the ﬁlename. The attacker then wakes up, deter-
mines the victim’s current system call, switches target
so the victim’s system call will succeed, and advances
activemaze to point to the next maze. When the vic-
tim resumes, it ﬁnishes resolving the ﬁlename using the
new value for target, so the system call succeeds.

We tested this attack on Linux, Solaris, and FreeBSD.
Table 3 shows our results. Against the randomized k-
Race algorithm using k = 100 our attack won at least

USENIX Association

14th USENIX Security Symposium

311

access(2)/open(2)
k-Race, k = 7
k-Race, k = 100
Fork-Open

1.7 GHz Athlon
3 µ sec
30 µ sec
393 µ sec
135 µ sec

Linux 2.6 FreeBSD 4.10-PR2

Solaris 9
1.3GHZ P-IV 450MHZ Ultra
253 µ sec
2210 µ sec
27600 µ sec
5750 µ sec

8 µ sec
91 µ sec
1190 µ sec
582 µ sec

Table 4: Running times for different access(2)/open(2) techniques on different operating systems. We measured the
elapsed cycle count for each call and repeated each measurement 1000 times to compute the average speed. The
measurements for the k-Race algorithm do not include randomized waits, so these results are a lower bound on the
running time of k-Race.

19% of the trials and up to 88%. From this, we conclude
that the randomized k-Race algorithm is not secure. Note
also that by using system call distinguishers our attack on
the randomized algorithm performs about as well as the
attack on the deterministic algorithm.

The three techniques we have developed in this paper
— mazes, synchronization primitives, and system call
distinguishers — are general tools that adversaries can
use to exploit a variety of Unix ﬁlesystem races. For
this reason, we believe that race condition exploits are
real threats that should be treated with the same level
of care as other software vulnerabilities, such as buffer
overﬂows and format string bugs.

8 Other Defenses

Fork. As mentioned by Dean and Hu, there is at least
one secure, cross-platform option to solve this problem.
A program can eschew the use of the access(2) system
call and rely on the operating system to enforce the per-
mission checks when it opens the ﬁle. When the program
needs to open an invoker-accessible ﬁle, it can fork a new
process that then uses the setuid(2) call to drop the setuid
privilege and run only with the rights of the invoker. The
new process can then call open(2) and the operating sys-
tem will enforce that the program’s invoker has rights
to open the ﬁle. Once the forked process successfully
obtains a ﬁle descriptor, it can use standard Unix IPC
mechanisms to pass the ﬁle descriptor back to its parent
process. The parent process can use the ﬁle descriptor as
normal.

2.6, Solaris 9.1,

We have implemented this forking technique and
tested it on Linux 2.4,
and
FreeBSD 4.10-PR2 [11]. Our fork(2)/open(2) function
has the same interface as open(2), taking a string path-
name and a ﬂags parameter. It returns a ﬁle descriptor
but ensures that the program’s invoker (determined by
getuid(2)) can access the ﬁle. We envision that the code
can be placed in a library, such as libc.

One drawback with this technique is that it is much
slower than the k-Race scheme using the recommended

parameter k = 7, as can be seen in Table 4. However,
we have shown that k-Race is insecure even up to k =
100, and our experiments show that the fork(2)/open(2)
solution is faster than k-Race with k = 100.

Kernel solutions. Forking a process to open a ﬁle is a
heavy-weight solution, and a little help from the kernel
could go a long way. For example, if temporarily drop-
ping privileges were portable across different versions of
Unix, then a setuid-root program could simply temporar-
ily drop privileges, open the ﬁle, and restore privileges.
Privilege management in Unix is a notorious mess [2],
but any progress on that problem would translate into im-
mediate improvements here. Alternatively, OS kernels
can add a new ﬂag, O RUID, to the set of ﬂags for the
open call, as suggested by Dean and Hu.

Until privilege management or the O RUID ﬂag be-
come standardized, the C library can emulate these fea-
tures to create a simple portable interface. For exam-
ple, the C library could introduce a new set of user id
management interfaces that hide all the non-portable de-
tails of each OS implementation. Similarly, the C library
could emulate O RUID by temporarily dropping privi-
leges while performing the open(2) call.

Any solution like these would enable setuid-root pro-
grams to open ﬁles with the same security guarantees as
the fork(2)/open(2) solution, but with the performance
of a simple call to open(2). This would be a signiﬁcant
performance beneﬁt, as shown in Table 4, and would be
clearly superior to Dean and Hu’s defense in both secu-
rity and speed.

9 Related Work

A number of projects use static analysis techniques to
ﬁnd race conditions in C source code. Bishop and Dilger
gave one of the earliest formal descriptions of the ac-
cess(2)/open(2) race condition and used this formalism
to characterize when the race condition occurs [1]. Us-
ing this characterization, they developed a static analysis
tool that ﬁnds TOCTTOU races by looking for sequences

312

14th USENIX Security Symposium

USENIX Association

of ﬁle system operations that use lexically identical argu-
ments. Because their tool performs no data ﬂow analy-
sis, it may fail to report some real vulnerabilities. Chen
et al. used software model checking to check temporal
safety properties in eight common Unix applications [3].
Their tool, MOPS, is able to detect stat(2)/open(2) races.
Later work with MOPS by Schwarz et al. checked all of
Red Hat 9 and found 41 ﬁlesystem TOCTTOU bugs [10].
MOPS has similar limitations to Bishop and Dilger’s tool
because it also doesn’t perform data ﬂow analysis.

Static analysis techniques may generate many false
positives, requiring the developer to sift through numer-
ous warnings to ﬁnd the actual bugs. Dynamic tech-
niques aim to reduce the number of false positives by
observing runtime program behavior and looking for
TOCTTOU race conditions. Tsyrklevich and Yee de-
tected races by looking for “pseudo-transactions”, i.e.
pairs of system calls that are prone to TOCTTOU ﬁle
race vulnerabilities [12]. Upon detecting a race in a run-
ning system, their tool asks the user for a course of ac-
tion. Ko and Redmond used a similar approach to look
for dangerous sequences of system calls [7]. They wrote
a kernel extension that looks for interfering system calls,
i.e. system calls that changes the outcome of another
group of system calls. For example, their scheme would
detect our attack because the attacker’s unlink(2) calls in-
terfere with the victim’s calls to open(2) and access(2).
Cowan et al developed RaceGuard, a kernel enhance-
ment that prevents temporary ﬁle creation race condi-
tions by detecting changes to the ﬁle system between
calls to stat(2) and open(2). Related to Tsyrklevich and
Yee’s pseudo-transaction notion, the QuickSilver operat-
ing system adds support for ﬁlesystem transactions [9].
A process could prevent TOCTTOU races by enclosing
dependent system calls in one transaction. Mazi`eres and
Kaashoek give principles for designing an operating sys-
tem to avoid TOCTTOU bugs [5]. They note that an at-
tacker can create many ﬁles in a directory so that name
resolution slows down and hence easily win TOCTTOU
ﬁle races. Their solution encompasses a richer OS in-
terface to enable ﬁner grain access controls and greater
control over name resolution.

10 Conclusion

We described a practical attack on the k-Race algorithm,
developed a randomized version of k-Race, and broke
that scheme, too. The latter attack shows that our system
call distinguishers are a powerful attack tool and that our
attack is insensitive to the exact sequence of system calls
performed by the victim. We therefore reafﬁrm the con-
ventional wisdom that access(2) should never be used in
secure programs. The tools we created as part of this
attack — mazes, system call synchronizers, and system

call distinguishers — are applicable to a wide variety of
Unix ﬁlesystem races. We discussed several alternative
solutions to access(2)/open(2) races that offer determin-
istic security guarantees.

Availability

The source code for our k-Race implementation and at-
tack software is available at http://nikita.ca/
research/races.tar.gz.

Acknowledgements

We would like to thank David Molnar and the anony-
mous reviewers for their insightful comments and our
shepherd, Eu-Jin Goh, for his help in preparing the ﬁnal
version of this paper. This work was supported in part by
the NSF under grants CCR-0093337 and CCF-0430585
and by the US Postal Service.

References

[1] Matt Bishop and Michael Dilger. Checking for race
conditions in ﬁle accesses. Computing Systems,
9(2):131–152, Spring 1996.

[2] Hao Chen, Drew Dean, and David Wagner. Setuid
demystiﬁed. In Proceedings of the 11th Usenix Se-
curity Symposium, pages 171–190, August 2002.

[3] Hao Chen, Drew Dean, and David Wagner. Model
checking one million lines of C code. In Proceed-
ings of the 11th Annual Network and Distributed
System Security Symposium (NDSS), pages 171–
185, February 2004.

[4] Drew Dean and Alan Hu. Fixing races for fun and
In Proceedings of
proﬁt: How to use access(2).
13th Usenix Security Symposium, pages 195 – 206,
August 2004.

[5] David Mazi`eres and M. Frans Kaashoek. Secure
In
applications need ﬂexible operating systems.
Proceedings of the 6th Workshop on Hot Topics in
Operating Systems (HotOS-VI), pages 56–61, 1997.

[6] Norm Hardy. The confused deputy: (or why capa-
bilities might have been invented). ACM SIGOPS
Operating Systems Review, 22(4):36–38, October
1988.

[7] Calvin Ko and Timothy Redmond. Noninterference
and intrusion detection. In Proceedings of the 2002
IEEE Symposium on Security and Privacy, pages
177–187, May 2002.

USENIX Association

14th USENIX Security Symposium

313

[8] W. S. McPhee. Operating system integrity in
IBM Systems Journal, 13(3):230–252,

OS/VS2.
1974.

[9] Frank Schmuck and Jim Wyllie. Experience with
transactions in QuickSilver. In Proceedings of the
13th ACM Symposium on Operating System Princi-
ples, pages 239–253, October 1991.

[10] Benjamin Schwarz, Hao Chen, David Wagner, Ge-
off Morrison, Jacob West, Jeremy Lin, and Wei Tu.
Model checking an entire Linux distribution for se-
curity violations. Technical Report UCB//CSD-05-
1384, UC Berkeley, April 2005.

[11] W. Richard Stevens. Unix Network Programming,
chapter 14.7: Passing Descriptors. Prentice Hall
PTR, 1997.

[12] Eugene Tsyrklevich and Bennet Yee. Dynamic de-
tection and prevention of race conditions in ﬁle ac-
cesses. In Proceedings of the 12th Usenix Security
Symposium, pages 243–255, August 2003.

314

14th USENIX Security Symposium

USENIX Association



=== Content from access.redhat.com_59101aa0_20250108_155750.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=nuFX91b5OIM&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNTgyJTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDU4MikifQ)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=nuFX91b5OIM&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNTgyJTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDU4MikifQ)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=nuFX91b5OIM&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNTgyJTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDU4MikifQ)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2022 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_620b0232_20250108_155744.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2024 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_a350a127_20250108_155749.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=GDP9qMFxfD4&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNDUzJTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDQ1MykifQ)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=GDP9qMFxfD4&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNDUzJTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDQ1MykifQ)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=GDP9qMFxfD4&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNDUzJTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDQ1MykifQ)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2022 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_83f12c68_20250108_155748.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=D_FFMrLNb6w&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNDM1JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDQzNSkifQ)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=D_FFMrLNb6w&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNDM1JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDQzNSkifQ)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=D_FFMrLNb6w&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNDM1JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDQzNSkifQ)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2022 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_8224081b_20250108_132753.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2024 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_9d59f748_20250108_155744.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=gZmbO7cerTo&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNDYzJTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDQ2MykifQ)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=gZmbO7cerTo&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNDYzJTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDQ2MykifQ)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=gZmbO7cerTo&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNDYzJTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDQ2MykifQ)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2022 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from rpm.org_2aa4269a_20250108_132754.html ===


* [Home](/index.html)
* [Documentation](/documentation.html)
* [Download](/download.html)
* [Community](/community.html)
* [Contribute](/contribute.html)
* [Roadmap](/roadmap.html)
* [About](/about.html)

# RPM 4.18.0 Release Notes

## Download information

* Source: [rpm-4.18.0.tar.bz2](https://ftp.osuosl.org/pub/rpm/releases/rpm-4.18.x/rpm-4.18.0.tar.bz2)
* SHA256SUM: 2a17152d7187ab30edf2c2fb586463bdf6388de7b5837480955659e5e9054554

## Summary of changes from RPM 4.17.x

### General bugfixes and enhancements

* Add a new [Sequoia-based](https://sequoia-pgp.org/) OpenPGP backend (#1978)
* Documentation updates
  + Lua extensions, examples
  + Typos, grammar, clarifications, presentation improvements
  + Bring install-order documentation to this millenium
  + Drop some misleadingly outdated docs
  + Translation updates

#### Command line

* Fix `--restore` to properly honor file states and all (#965)
* Fix `--setperms` processing recorded symlinks (RhBug:1900662)
* Fix `rpmkeys` return code on I/O errors
* Fix `--showrc` to return an error code on broken rc and macro files (#1796)
* Fix mismatch between `rpmspec -q --srpm` and `rpmbuild -bs` architecture
  (#1116)
* Fix `--short-circuit` for (dynamic) buildrequires checking
* Fix `-q/--query` option not visible in `--help` (#1473)
* Fix query arguments containing `^` not working (#2104)
* Fix various dark corners in rpm2cpio.sh (RhBug:2115206)
* Add downgrade (`--oldpackage`) support to `--freshen` (#652)
* Add `--path` query for support for stateless file information (RhBug:1940895)
* Add `rpmlua` command for running rpm’s embedded Lua interpreter standalone,
  with command history and support for iLua
* Add `--shell` option for interactive macro shell to `rpmspec`
* Add `--justdb` counterpart `--nodb` option and matching API flag
* Add `-bd`, `-td` and `-rd` switches to `rpmbuild` for checking build
  dependencies
* Add available database backends to `--showrc` output

#### Transactions

* Fix intermediate symlinks not verified (CVE-2021-35939)
* Fix unowned directories created unsafely
* Fix spurious `%transfiletriggerpostun` execution (RhBug:2023311)
* Fix `%_minimize_writes` regression (in 4.15.0)
* Fix possible priority inversion in ordering code wrt weak dependencies
  with qualifiers
* Fix ctrl-c during transaction killing scriptlets (regression in 4.17.0)
* Fix excluded and non-installed files getting considered in file conflicts
  calculation
* Fix uncontrolled sqlite WAL growth during large transactions
* Fix `%posttrans` argument on upgrade

### Package building

#### Spec

* Fix mismatch between package name and provides/obsoletes rules (#1694)
* Fix `check-buildroot` not stopping on errors with `grep` >= 3.5 (#1968)
* Fix build summary confusingly mixing warnings and errors (#793)
* Fix `%patch 1` applying patches 0 and 1
* Fix package build tree not getting removed on successful build
* Fix .gemspec from `%setup` not getting removed on `%clean`
* Fix `%setup` and `%patch` not getting expanded in rpmspec –parse (#2048)
* Fix missing quotes on %sources and %patches (#1445)
* Add new `SourceLicense` tag for specifying a source license different from
  the binary license (#2079)
* Add new `%conf` spec section for build configuration (#1086)
* Add `%bcond` macro as a nicer way of defining build conditionals (#941)
* Add an optional “override clock” from `SOURCE_DATE_EPOCH` environment
  to support deterministic timestamps inside OS images
* Add support for qualifiers (eg `pre`, `post`…) for weak dependencies
* Add support for zstd long distance matching compression (`L<n>` io flag)
* Add warning if `%source_date_epoch_from_changelog set` but changelog missing
* Add new `rpmuncompress` cli tool which handles extraction of sources and
  uncompress of patches in `%setup` and `%patch` pseudomacros.
* Add new informational `UpstreamReleases` and `TranslationURL` tags
* Add parsed and expanded spec to src.rpm header as `Spec` tag
* Make `%{buildsubdir}` settable outside `%setup`
* Deprecate implicit “%patch number zero” syntax

#### Macros

* Fix individual patch application via `%autopatch` (#1766)
* Fix consistency issues in macro expansion for builtin macros
* Fix `%{define name body}` syntax in specs
* Fix non-parametric built-in macros (regression in 4.17.0)
* Fix short-circuiting of version strings in expressions (#1883)
* Add `%{shescape:...}` macro for single quoting and escapes for the shell
* Add optional argument for the `%verbose` macro
* Add support for multiple arguments in `%{quote}`
* Add support for Lua functions in expressions (eg
  `%[lua:string.reverse("hello")]`)
* Drop arbitrary macro name minimum length limit (RhBug:1994223)
* Protect automatic macros from being redefined and undefined

#### Buildroot policies

* Fix handling of filenames with spaces in `brp-compress`
* Fix Guile object files getting stripped (#1765)
* Fix `brp-strip-comment-note` running only serially
* Fix `brp-remove-la-files` sometimes removing non-libtool files
* Fix unwanted network access in check-rpaths helper script (RhBug:2079600)

#### Generators

* Fix OCaml generators to ignore cmxs files
* Add a provides generator for rpm macros

### Signatures and keys

* Fix signature check result on valid header signature but unverifiable payload
* Fix subkey binding signatures not checked on PGP public keys (CVE-2021-3521)
* Fix Ed25519 signature verification with libgcrypt
* Fix subkeys not capable of signing accepted for verification (#1911)
* Fix signing of packages unusual filenames
* Fix subkey binding timestamp used for main gpg-pubkey (#2004)
* Add support for –import in fs keyring
* Add support for linting keys on import (Sequoia backend only)

### Plugins

* Fix IMA causing install failure on filesystems without xattr support
* Add file descriptor argument to file-prepare hook
* Revert file-pre, file-prepare and file-post hook execution to their
  pre-4.17.0 positions

### Python bindings

* Fix ancient Python ts.check() argument order regression (#1871, in 4.8.0)
* Add bindings for `rpmfilesFSignature()` and `rpmfilesVSignature()`
  (`.imasig` and `.veritysig` properties in `rpm.file` objects)
* Drop experimental and internal `_build` method from from the spec bindings

### Lua interface

* Fix relocation info not available in Lua scriptlets (#1531)
* Fix scriptlet arguments passed as numbers again (regression in 4.17.0)
* Fix off-by-one in `rpm.call()`
* Fix newline behavior in interactive mode
* Fix `rpm.next_file()` to be usable only inside scriptlets with input
* Fix rpm.vercmp() error message on second argument (#2165)
* Add `rpm.splitargs()` and `rpm.unsplitargs()` functions for macro argument
  processing
* Add auto-print of `return`ed values from macros
* Drop defunct and unused `rex` extension

### API changes

#### Added APIs

* `rpmtsAddRestoreElement()`, `rpmRestore()` for `--restore`
* `rreallocn()`, similar to glibc’s reallocarray()
* `rpmhex()` for hex-enconding binary data

#### Changed APIs

* Fix database open hijacking normal signal handling
* Fix `rpmfiSetFX()` return code to be meaningful
* Fix pgpPubkeyFingerprint() to do something meaningful again
* Add new PGP-independent set of hash algorithm symbols (#1899)
* Various generic crypto APIs moved from `rpmpgp.h` to `rpmcrypto.h` header
* Disable and obsolete `rpmfiSetDX()`, `rpmfiInitD()` and `rpmfiNextD()`

#### Removed APIs

* N/A

### Internal improvements and cleanups

* Fix IMA signature lengths assumed constant (#1833, RhBug:2018937)
* Fix various leaks and other findings from static analyzers
* Fix various correctness and safety issues in the OpenPGP parser
* Fix rpmdb cookie in FIPS mode by changing it to SHA256
* Fix pgpDigParams to be properly opaque
* Fix rpmio stats spew in stderr (#1987)
* Fix changelog parsing affecting caller timezone state (#1821)
* Add an artificial limit of 1M to header array sizes
* Add support for loongarch64 architecture
* Add `ARCHSUFFIX` extension tag
* Optimize C source file classification
* Drop support for undocumented keyid based import over the net
* Various code cleanups to macro engine and Lua extensions
* Refactor file and directory operations to use fd-based APIs throughout
  (CVE-2021-35938)
* Various fixes and cleanups to hardlink handling
* Physically separate public and private headers in the codebase

### Build process

* Require POSIX.1-2008 level operating system for the `openat()` family
  of APIs
* Fix Doxygen deprecation warnings
* Fix `UID_0_USER` and `UID_0_GROUP` values when `/etc/passwd` not present
  (#1838)
* Fix out of tree build regression wrt man page generation (#1851)
* Fix stat64 build on Apple Big Sur (#1752)
* Fix build on armhf and mipsel
* Fix db backend default as per availability
* Fix signing tests assuming gpg default to sha256 hash algo
* Fix test-suite relying on deprecated distutils
* Fix warnings from autotools >= 2.70 (#1785)
* Fix `make ci` in a VPATH build
* Add option to disable libelf dependency (`--enable/--disable-libelf`)
* Add multiple new test-cases
* Update minimum required gettext version to 0.19.8
* Update CI to Fedora 36

## Compatibility notes

rpm.org



=== Content from access.redhat.com_40e79456_20250108_155741.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2024 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from github.com_8cce58f0_20250108_155748.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frpm-software-management%2Frpm%2Fpull%2F1919)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frpm-software-management%2Frpm%2Fpull%2F1919)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=rpm-software-management%2Frpm)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rpm-software-management](/rpm-software-management)
/
**[rpm](/rpm-software-management/rpm)**
Public

* [Notifications](/login?return_to=%2Frpm-software-management%2Frpm) You must be signed in to change notification settings
* [Fork
  375](/login?return_to=%2Frpm-software-management%2Frpm)
* [Star
   517](/login?return_to=%2Frpm-software-management%2Frpm)

* [Code](/rpm-software-management/rpm)
* [Issues
  271](/rpm-software-management/rpm/issues)
* [Pull requests
  7](/rpm-software-management/rpm/pulls)
* [Discussions](/rpm-software-management/rpm/discussions)
* [Actions](/rpm-software-management/rpm/actions)
* [Projects
  8](/rpm-software-management/rpm/projects)
* [Security](/rpm-software-management/rpm/security)
* [Insights](/rpm-software-management/rpm/pulse)

Additional navigation options

* [Code](/rpm-software-management/rpm)
* [Issues](/rpm-software-management/rpm/issues)
* [Pull requests](/rpm-software-management/rpm/pulls)
* [Discussions](/rpm-software-management/rpm/discussions)
* [Actions](/rpm-software-management/rpm/actions)
* [Projects](/rpm-software-management/rpm/projects)
* [Security](/rpm-software-management/rpm/security)
* [Insights](/rpm-software-management/rpm/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Frpm-software-management%2Frpm%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Frpm-software-management%2Frpm%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# First steps towards fixing the symlink CVEs #1919

 Merged

[pmatilai](/pmatilai)
merged 32 commits into
[rpm-software-management:master](/rpm-software-management/rpm/tree/master "rpm-software-management/rpm:master")
from
[pmatilai:dirsafe-pr](/pmatilai/rpm/tree/dirsafe-pr "pmatilai/rpm:dirsafe-pr")

Feb 16, 2022

 Merged

# [First steps towards fixing the symlink CVEs](#top) #1919

[pmatilai](/pmatilai)
merged 32 commits into
[rpm-software-management:master](/rpm-software-management/rpm/tree/master "rpm-software-management/rpm:master")
from
[pmatilai:dirsafe-pr](/pmatilai/rpm/tree/dirsafe-pr "pmatilai/rpm:dirsafe-pr")

Feb 16, 2022

[Conversation
14](/rpm-software-management/rpm/pull/1919)
[Commits
32](/rpm-software-management/rpm/pull/1919/commits)
[Checks
0](/rpm-software-management/rpm/pull/1919/checks)
[Files changed](/rpm-software-management/rpm/pull/1919/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![pmatilai](https://avatars.githubusercontent.com/u/3882389?s=60&v=4)](/pmatilai)

Copy link

Member

### @pmatilai **[pmatilai](/pmatilai)** commented [Feb 10, 2022](#issue-1130053126)

Details in commits, but basically fixes [CVE-2021-35939](https://github.com/advisories/GHSA-prgv-w33h-5m73 "CVE-2021-35939") and lays down some necessary infrastructure for next steps in securing down our file operations.

Sorry, something went wrong.

 🎉
1
 dmnks reacted with hooray emoji

All reactions

* 🎉
  1 reaction

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=80&u=1dfa623e3663a322b837fe9a817b0f90a627261e&v=4)](/pmatilai)

Copy link

Member

Author

### **[pmatilai](/pmatilai)** commented [Feb 10, 2022](#issuecomment-1034914090) • edited Loading

| It should be noted (probably in the commit message too) that as these symlink CVE's overlap and interact in various ways, this does not fully fix [CVE-2021-35939](https://github.com/advisories/GHSA-prgv-w33h-5m73 "CVE-2021-35939") as the directory tracking does not cover all our installation steps yet. Plugging all the holes requires converting *all* of FSM to the \*at() family of calls plus fd-based ops where possible, so this really is just the first step of many to come. |
| --- |

All reactions

Sorry, something went wrong.

[![DemiMarie](https://avatars.githubusercontent.com/u/6395399?s=60&v=4)](/DemiMarie)

**[DemiMarie](/DemiMarie)**
reviewed
[Feb 10, 2022](#pullrequestreview-879125535)

 [View reviewed changes](/rpm-software-management/rpm/pull/1919/files)

Copy link

Contributor

### @DemiMarie **[DemiMarie](/DemiMarie)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

On Linux, using `openat2()` will be much simpler and more efficient on kernels that support it. RPM is not Linux-specific, but `openat2()` might be useful where available.

Sorry, something went wrong.

All reactions

[INSTALL](/rpm-software-management/rpm/pull/1919/files#diff-b83b327f0b62e8168163c61f15fb0ac2c14169729e4f4184678337a15cd04dec)

Show resolved

Hide resolved

[lib/fsm.c](/rpm-software-management/rpm/pull/1919/files#diff-53bfda548820c5dd70e28669eaa5f7bc36c55d3ac25dbd3f590c85ffa29bbbe0)

Show resolved

Hide resolved

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=80&u=1dfa623e3663a322b837fe9a817b0f90a627261e&v=4)](/pmatilai)

Copy link

Member

Author

### **[pmatilai](/pmatilai)** commented [Feb 11, 2022](#issuecomment-1035928465)

| I'm quite aware of Linux having all manner of fancy extensions available. Rpm is portable software and we need to fix this stuff using what's available in POSIX, utilizing non-portable extensions would only make things far more complicated rather than help. There's enough complexities to deal with as it is, thank you very much. |
| --- |

 👍
1
 DemiMarie reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

 [![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&u=1dfa623e3663a322b837fe9a817b0f90a627261e&v=4)](/pmatilai)
[pmatilai](/pmatilai)
[force-pushed](/rpm-software-management/rpm/compare/da3507bb609cd41097278ced592b449050fef00f..008cbca34e97beac95788cf688b7690f2707601b)
the
dirsafe-pr

branch
2 times, most recently
from
[`da3507b`](/rpm-software-management/rpm/commit/da3507bb609cd41097278ced592b449050fef00f) to
[`008cbca`](/rpm-software-management/rpm/commit/008cbca34e97beac95788cf688b7690f2707601b)  [Compare](/rpm-software-management/rpm/compare/da3507bb609cd41097278ced592b449050fef00f..008cbca34e97beac95788cf688b7690f2707601b)
[February 15, 2022 07:30](#event-6072609700)

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=80&u=1dfa623e3663a322b837fe9a817b0f90a627261e&v=4)](/pmatilai)

Copy link

Member

Author

### **[pmatilai](/pmatilai)** commented [Feb 15, 2022](#issuecomment-1040096878) • edited Loading

| This is now using fd or dirfd+basename for file ops within the fsm, as much as possible. Plugins pose special problems as external libraries generally dont support dirfd+basename style operation, but may still need to operate on symlinks so we're stuck with "insecure" absolute paths there, for now at least.  I'm seeing a couple of install glitches on fresh chroot install still, but it's getting close now. Of course a change this big and drastic *will* have bugs in it initially, I have no illusions about that.  (edit: hmph, the test-suite was passing just a minute ago...) |
| --- |

All reactions

Sorry, something went wrong.

 [![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&u=1dfa623e3663a322b837fe9a817b0f90a627261e&v=4)](/pmatilai)
[pmatilai](/pmatilai)
[force-pushed](/rpm-software-management/rpm/compare/4e5829992f28eaf1480ac781c4dd317ce65b546a..17864deddbcfc8400651e5e8d36d77c5baf18633)
the
dirsafe-pr

branch
from
[`4e58299`](/rpm-software-management/rpm/commit/4e5829992f28eaf1480ac781c4dd317ce65b546a) to
[`17864de`](/rpm-software-management/rpm/commit/17864deddbcfc8400651e5e8d36d77c5baf18633)  [Compare](/rpm-software-management/rpm/compare/4e5829992f28eaf1480ac781c4dd317ce65b546a..17864deddbcfc8400651e5e8d36d77c5baf18633)
[February 15, 2022 10:52](#event-6073936604)

 [pmatilai](/pmatilai)
added 23 commits
[February 15, 2022 13:39](#commits-pushed-b52e9aa)

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Add optional callback on directory changes during rpmfi iteration](/rpm-software-management/rpm/pull/1919/commits/b52e9aa1c4c8308c3d89ab9d201997ad86143400 "Add optional callback on directory changes during rpmfi iteration

Internal only for now in case we need to fiddle with the API some more,
but no reason this couldn't be made public later.")`
 …

`[b52e9aa](/rpm-software-management/rpm/pull/1919/commits/b52e9aa1c4c8308c3d89ab9d201997ad86143400)`

```
Internal only for now in case we need to fiddle with the API some more,
but no reason this couldn't be made public later.
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Validate intermediate symlinks during installation,](/rpm-software-management/rpm/pull/1919/commits/97905cc911801d0e8d00c5011074bdc548eaa4c2 "Validate intermediate symlinks during installation, CVE-2021-35939

Whenever directory changes during unpacking, walk the entire tree from
starting from / and validate any symlinks crossed, fail the install
on invalid links.

This is the first of step of many towards securing our file operations
against local tamperers and besides plugging that one CVE, paves the way
for the next step by adding the necessary directory fd tracking.
This also bumps the rpm OS requirements to a whole new level by requiring
the *at() family of calls from POSIX-1.2008.

This necessarily does a whole lot of huffing and puffing we previously
did not do. It should be possible to cache secure (ie root-owned)
directory structures to avoid validating everything a million times
but for now, just keeping things simple.") [CVE-2021-35939](https://github.com/advisories/GHSA-prgv-w33h-5m73 "CVE-2021-35939")`
 …

`[97905cc](/rpm-software-management/rpm/pull/1919/commits/97905cc911801d0e8d00c5011074bdc548eaa4c2)`

```
Whenever directory changes during unpacking, walk the entire tree from
starting from / and validate any symlinks crossed, fail the install
on invalid links.

This is the first of step of many towards securing our file operations
against local tamperers and besides plugging that one CVE, paves the way
for the next step by adding the necessary directory fd tracking.
This also bumps the rpm OS requirements to a whole new level by requiring
the *at() family of calls from POSIX-1.2008.

This necessarily does a whole lot of huffing and puffing we previously
did not do. It should be possible to cache secure (ie root-owned)
directory structures to avoid validating everything a million times
but for now, just keeping things simple.
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Drop unsafe and now redundant unowned directories creation code](/rpm-software-management/rpm/pull/1919/commits/5e9c915feb85fce02eab30140d28de389ec22351 "Drop unsafe and now redundant unowned directories creation code

Any unowned directories will be created inline during processing now
so we can just flush this big pile of code that was insecure anyhow.

As an additional bonus creating the directories inline gives us an
opportunity to track the creation so we can undo too, but that is
not done here.")`
 …

`[5e9c915](/rpm-software-management/rpm/pull/1919/commits/5e9c915feb85fce02eab30140d28de389ec22351)`

```
Any unowned directories will be created inline during processing now
so we can just flush this big pile of code that was insecure anyhow.

As an additional bonus creating the directories inline gives us an
opportunity to track the creation so we can undo too, but that is
not done here.
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Consolidate skipped hardlink with content case with the others](/rpm-software-management/rpm/pull/1919/commits/7e0134299874081172c49d0732b34ff7d722516f "Consolidate skipped hardlink with content case with the others

Handling this in a separate clause makes the logic much clearer and
(in theory at least) lets us handle hardlinks to any content, not
just regular files.")`
 …

`[7e01342](/rpm-software-management/rpm/pull/1919/commits/7e0134299874081172c49d0732b34ff7d722516f)`

```
Handling this in a separate clause makes the logic much clearer and
(in theory at least) lets us handle hardlinks to any content, not
just regular files.
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Fix + sanitize the hardlink metadata setting logic](/rpm-software-management/rpm/pull/1919/commits/558ca2f597515f989f598f24eac9d611600a699f "Fix + sanitize the hardlink metadata setting logic

Fix the initial setmeta value to something meaningful: we will never
set metadata on skipped files, and hardlinks are handled with a special
logic during install. They'd need different kind of special logic on
FA_TOUCH so just play it safe and always apply metadata on those.

Harlink metadata setting on install should happen on the *last* entry
of hardlinked set that gets installed (wrt various skip scenarios)
as otherwise creating those additional links affects the timestamp.
Note in particular the \"last file of...\" case in fsmMkfile() where we
the comment said just that, but set the metadata on the *first* file
which would then be NULL'ed away.

This all gets current masked by the fact that we do the metadata setting on
a separate round, but that is about to change plus this makes the overall
logic clearer anyhow.")`
 …

`[558ca2f](/rpm-software-management/rpm/pull/1919/commits/558ca2f597515f989f598f24eac9d611600a699f)`

```
Fix the initial setmeta value to something meaningful: we will never
set metadata on skipped files, and hardlinks are handled with a special
logic during install. They'd need different kind of special logic on
FA_TOUCH so just play it safe and always apply metadata on those.

Harlink metadata setting on install should happen on the *last* entry
of hardlinked set that gets installed (wrt various skip scenarios)
as otherwise creating those additional links affects the timestamp.
Note in particular the "last file of..." case in fsmMkfile() where we
the comment said just that, but set the metadata on the *first* file
which would then be NULL'ed away.

This all gets current masked by the fact that we do the metadata setting on
a separate round, but that is about to change plus this makes the overall
logic clearer anyhow.
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Move file metadata setting back to unpack stage](/rpm-software-management/rpm/pull/1919/commits/efe19bc1c3126311aeb6d6f0f623ea7a5f8f1e51 "Move file metadata setting back to unpack stage

Commit a82251b44ee2d2802ee8aea1b3d89f88beee4bad moved metadata setting
to a separate step because there are potential benefits to doing so, but
the current downsides are worse: as long as we operate in potentially
untrusted directories, we'd need to somehow verify the content is what we
initially laid down to avoid possible privilege escalation from non-root
owned directories.

This commit does not fix that vulnerability, only makes the window much
smaller and paves the way for the real fix(es) without introducing a
second round of directory tree validation chase to the picture.")`
 …

`[efe19bc](/rpm-software-management/rpm/pull/1919/commits/efe19bc1c3126311aeb6d6f0f623ea7a5f8f1e51)`

```
Commit [a82251b](https://github.com/pmatilai/rpm/commit/a82251b44ee2d2802ee8aea1b3d89f88beee4bad) moved metadata setting
to a separate step because there are potential benefits to doing so, but
the current downsides are worse: as long as we operate in potentially
untrusted directories, we'd need to somehow verify the content is what we
initially laid down to avoid possible privilege escalation from non-root
owned directories.

This commit does not fix that vulnerability, only makes the window much
smaller and paves the way for the real fix(es) without introducing a
second round of directory tree validation chase to the picture.
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Convert the file creation steps the *at() family of calls](/rpm-software-management/rpm/pull/1919/commits/9937aae89eec8f7492fff2558b3f28cd601e6efc "Convert the file creation steps the *at() family of calls

Supposedly no functional changes here, we just need all these things
converted before we can swap over to relative paths.")`
 …

`[9937aae](/rpm-software-management/rpm/pull/1919/commits/9937aae89eec8f7492fff2558b3f28cd601e6efc)`

```
Supposedly no functional changes here, we just need all these things
converted before we can swap over to relative paths.
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`["Factorize" chdir-aware iterator creation](/rpm-software-management/rpm/pull/1919/commits/a2e4bcfee1459a8faedf4109ffa0b769a30b1ba1 "\"Factorize\" chdir-aware iterator creation")`

`[a2e4bcf](/rpm-software-management/rpm/pull/1919/commits/a2e4bcfee1459a8faedf4109ffa0b769a30b1ba1)`

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Add new rpm error codes for invalid symlinks and not-a-directory](/rpm-software-management/rpm/pull/1919/commits/93542b39ed87530eb2cc6ba2c74433bc52340de4 "Add new rpm error codes for invalid symlinks and not-a-directory")`

`[93542b3](/rpm-software-management/rpm/pull/1919/commits/93542b39ed87530eb2cc6ba2c74433bc52340de4)`

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Refactor ensureDir() to return an error code separately from the fd](/rpm-software-management/rpm/pull/1919/commits/63ef815f3a5440ede1b838e4da48619bb24f914f "Refactor ensureDir() to return an error code separately from the fd")`

`[63ef815](/rpm-software-management/rpm/pull/1919/commits/63ef815f3a5440ede1b838e4da48619bb24f914f)`

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Move file-post plugin hook back to commit stage](/rpm-software-management/rpm/pull/1919/commits/e389e39ff26ec578e83e7ac80a405c01b0ca0d69 "Move file-post plugin hook back to commit stage

This isn't ideal from the sense that some files may get a success post
call while something later can still fail, but things get even weirder
with doing it in a separate round where things could fail because of
a vanished directory and then we'd still need to call the plugin hook
with some result. Also, this lets us skip the backwards walk on the
normal case of success, which is nice.")`
 …

`[e389e39](/rpm-software-management/rpm/pull/1919/commits/e389e39ff26ec578e83e7ac80a405c01b0ca0d69)`

```
This isn't ideal from the sense that some files may get a success post
call while something later can still fail, but things get even weirder
with doing it in a separate round where things could fail because of
a vanished directory and then we'd still need to call the plugin hook
with some result. Also, this lets us skip the backwards walk on the
normal case of success, which is nice.
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Move file-pre plugin hook (back) to unpack stage](/rpm-software-management/rpm/pull/1919/commits/7348fc8ea7982570ffd4e4fa52ce46629b9646a2 "Move file-pre plugin hook (back) to unpack stage

It doesn't make much sense to call plugins for files that wont be
unpacked at all, and in particular it wont make much sense to do the
entire directory dance just to be able to pass meaningful path values
to plugins. So from now we'll only be calling file-pre for things that
we're about to lay down, which it how it used to be before splitting
the stages anyhow.")`
 …

`[7348fc8](/rpm-software-management/rpm/pull/1919/commits/7348fc8ea7982570ffd4e4fa52ce46629b9646a2)`

```
It doesn't make much sense to call plugins for files that wont be
unpacked at all, and in particular it wont make much sense to do the
entire directory dance just to be able to pass meaningful path values
to plugins. So from now we'll only be calling file-pre for things that
we're about to lay down, which it how it used to be before splitting
the stages anyhow.
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Add a helper for finishing the dir tracking iteration](/rpm-software-management/rpm/pull/1919/commits/afb5215fdd3e1aa979fa6c973f974c1b11532f96 "Add a helper for finishing the dir tracking iteration")`

`[afb5215](/rpm-software-management/rpm/pull/1919/commits/afb5215fdd3e1aa979fa6c973f974c1b11532f96)`

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Extend directory tracking to our entire operation](/rpm-software-management/rpm/pull/1919/commits/54b569670e539c291022f58f1ae4ed6b5dc9a70b "Extend directory tracking to our entire operation")`

`[54b5696](/rpm-software-management/rpm/pull/1919/commits/54b569670e539c291022f58f1ae4ed6b5dc9a70b)`

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Convert fsmStat() to fstatat() based operation](/rpm-software-management/rpm/pull/1919/commits/a4e0f7af46712de098265050838ae19bb3cc1fa5 "Convert fsmStat() to fstatat() based operation")`

`[a4e0f7a](/rpm-software-management/rpm/pull/1919/commits/a4e0f7af46712de098265050838ae19bb3cc1fa5)`

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Convert fsmRemove() and helpers to unlinkat() based operation](/rpm-software-management/rpm/pull/1919/commits/d27a6102e13e7a41c56f1e4a192d2c9a414f10f0 "Convert fsmRemove() and helpers to unlinkat() based operation")`

`[d27a610](/rpm-software-management/rpm/pull/1919/commits/d27a6102e13e7a41c56f1e4a192d2c9a414f10f0)`

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Convert fsmRename() to renameat() based operation](/rpm-software-management/rpm/pull/1919/commits/4364a400bcaf9aee0437d06eb73cde3fd1a5a962 "Convert fsmRename() to renameat() based operation

All our renames are (for now at least) within a single directory so
the second dirfd is kinda redundant, but shrug...")`
 …

`[4364a40](/rpm-software-management/rpm/pull/1919/commits/4364a400bcaf9aee0437d06eb73cde3fd1a5a962)`

```
All our renames are (for now at least) within a single directory so
the second dirfd is kinda redundant, but shrug...
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Bury rpmio FD use to fsmUnpack()](/rpm-software-management/rpm/pull/1919/commits/6a75a4ad029c6232fcf9e7408b97af9ddb4a3095 "Bury rpmio FD use to fsmUnpack()

fsmUnpack() is the only place in FSM that needs to deal with rpmio FD
types, everywhere else they are nothing but a hindrance that need to
be converted to OS level descriptors for use. Better deal with OS
level descriptors to begin with.")`
 …

`[6a75a4a](/rpm-software-management/rpm/pull/1919/commits/6a75a4ad029c6232fcf9e7408b97af9ddb4a3095)`

```
fsmUnpack() is the only place in FSM that needs to deal with rpmio FD
types, everywhere else they are nothing but a hindrance that need to
be converted to OS level descriptors for use. Better deal with OS
level descriptors to begin with.
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Return descriptor of created file from fsmMkfile()](/rpm-software-management/rpm/pull/1919/commits/77ea371dc628861302e731e57c7048861f2efd55 "Return descriptor of created file from fsmMkfile()

This will be needed for using fd-based metadata operations.")`
 …

`[77ea371](/rpm-software-management/rpm/pull/1919/commits/77ea371dc628861302e731e57c7048861f2efd55)`

```
This will be needed for using fd-based metadata operations.
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Convert fsmSetmeta() to dirfd based operation where possible](/rpm-software-management/rpm/pull/1919/commits/3ff74b4e5518040a3caa8898855473754a8d8af8 "Convert fsmSetmeta() to dirfd based operation where possible

Notably cap_set_file() doesn't have a dirfd-based mode, to handle that
safely we'll need to use fd-based operation. Which would be nicer anyhow
but symlinks can't be opened so we'll have to carry the dirfd/path based
mode forever more anyhow (yes Linux has extensions but that's another
story).")`
 …

`[3ff74b4](/rpm-software-management/rpm/pull/1919/commits/3ff74b4e5518040a3caa8898855473754a8d8af8)`

```
Notably cap_set_file() doesn't have a dirfd-based mode, to handle that
safely we'll need to use fd-based operation. Which would be nicer anyhow
but symlinks can't be opened so we'll have to carry the dirfd/path based
mode forever more anyhow (yes Linux has extensions but that's another
story).
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Add support for fd-based file metadata setting](/rpm-software-management/rpm/pull/1919/commits/4682bcffd8af58cd47385508d9432e313c5cdfd7 "Add support for fd-based file metadata setting

We need to support both fd-based and (dirfd+) path based operations
due to all the lovely mismatches in POSIX, so lotsa half-duplicated
tedious stuff here.

As of this commit, we only use fd based ops for regular files.")`
 …

`[4682bcf](/rpm-software-management/rpm/pull/1919/commits/4682bcffd8af58cd47385508d9432e313c5cdfd7)`

```
We need to support both fd-based and (dirfd+) path based operations
due to all the lovely mismatches in POSIX, so lotsa half-duplicated
tedious stuff here.

As of this commit, we only use fd based ops for regular files.
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Set file metadata via fd-based ops for everything but symlinks](/rpm-software-management/rpm/pull/1919/commits/9fe4dec03b80c50daeecfb43f02befb9a176e902 "Set file metadata via fd-based ops for everything but symlinks

Regular file ops are fd-based already, for the rest we need to open them
manually. Files with temporary suffix must never be followed, for
directories (and pre-existing FA_TOUCHed files) use the rpm symlink
\"root or target owner allowed\" rule wrt following.

This mostly fixes CVE-2021-35938, but as we're not yet using dirfd-based
operatiosn for everything there are corner cases left undone. And then
there's the plugin API which needs updating for all this.")`
 …

`[9fe4dec](/rpm-software-management/rpm/pull/1919/commits/9fe4dec03b80c50daeecfb43f02befb9a176e902)`

```
Regular file ops are fd-based already, for the rest we need to open them
manually. Files with temporary suffix must never be followed, for
directories (and pre-existing FA_TOUCHed files) use the rpm symlink
"root or target owner allowed" rule wrt following.

This mostly fixes [CVE-2021-35938](https://github.com/advisories/GHSA-83gm-5269-qr3v "CVE-2021-35938"), but as we're not yet using dirfd-based
operatiosn for everything there are corner cases left undone. And then
there's the plugin API which needs updating for all this.
```

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Convert removeSBITS() to dirfd-based operation](/rpm-software-management/rpm/pull/1919/commits/b79c44bfdb684d4d63daf5f04b82b13c1b7898d8 "Convert removeSBITS() to dirfd-based operation")`

`[b79c44b](/rpm-software-management/rpm/pull/1919/commits/b79c44bfdb684d4d63daf5f04b82b13c1b7898d8)`

 [pmatilai](/pmatilai)
added 2 commits
[February 15, 2022 13:39](#commits-pushed-a3118df)

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Add a test-case for cross-directory hardlinks](/rpm-software-management/rpm/pull/1919/commits/a3118df1da902507a5e662ac64119cd22c0be065 "Add a test-case for cross-directory hardlinks")`

`[a3118df](/rpm-software-management/rpm/pull/1919/commits/a3118df1da902507a5e662ac64119cd22c0be065)`

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Swap over to dirfd+basename based operation within the fsm](/rpm-software-management/rpm/pull/1919/commits/228b6f17bf8a9d06ca9c72eabb7e537ad64d05f3 "Swap over to dirfd+basename based operation within the fsm

Within fsm this is just a matter of adjusting error messages to include
the directory... if it only wasn't for the plugins requiring absolute
paths for outside users. For the plugins, we need to assemble absolute
paths as needed, both in ensureDir() and plugin file slots.")`
 …

`[228b6f1](/rpm-software-management/rpm/pull/1919/commits/228b6f17bf8a9d06ca9c72eabb7e537ad64d05f3)`

```
Within fsm this is just a matter of adjusting error messages to include
the directory... if it only wasn't for the plugins requiring absolute
paths for outside users. For the plugins, we need to assemble absolute
paths as needed, both in ensureDir() and plugin file slots.
```

 [![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&u=1dfa623e3663a322b837fe9a817b0f90a627261e&v=4)](/pmatilai)
[pmatilai](/pmatilai)
[force-pushed](/rpm-software-management/rpm/compare/17864deddbcfc8400651e5e8d36d77c5baf18633..228b6f17bf8a9d06ca9c72eabb7e537ad64d05f3)
the
dirsafe-pr

branch
from
[`17864de`](/rpm-software-management/rpm/commit/17864deddbcfc8400651e5e8d36d77c5baf18633) to
[`228b6f1`](/rpm-software-management/rpm/commit/228b6f17bf8a9d06ca9c72eabb7e537ad64d05f3)  [Compare](/rpm-software-management/rpm/compare/17864deddbcfc8400651e5e8d36d77c5baf18633..228b6f17bf8a9d06ca9c72eabb7e537ad64d05f3)
[February 15, 2022 11:42](#event-6074262555)

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=80&u=1dfa623e3663a322b837fe9a817b0f90a627261e&v=4)](/pmatilai)

Copy link

Member

Author

### **[pmatilai](/pmatilai)** commented [Feb 15, 2022](#issuecomment-1040176322) • edited Loading

| Okay, test-suite + all my local tests (install to empty chroot etc) pass now 🥳 |
| --- |

All reactions

Sorry, something went wrong.

[![@DemiMarie](https://avatars.githubusercontent.com/u/6395399?s=80&u=725eb6ce9da97eea58d5aa8bf4fe72ea128f8c0d&v=4)](/DemiMarie)

Copy link

Contributor

### **[DemiMarie](/DemiMarie)** commented [Feb 15, 2022](#issuecomment-1040497270)

| This is now using fd or dirfd+basename for file ops within the fsm, as much as possible. Plugins pose special problems as external libraries generally dont support dirfd+basename style operation, but may still need to operate on symlinks so we're stuck with "insecure" absolute paths there, for now at least.  Cute (but non-portable) trick: use paths of the form `/dev/fd/$FDNUM/something`. Works at least on Linux. |
| --- |

All reactions

Sorry, something went wrong.

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=80&u=1dfa623e3663a322b837fe9a817b0f90a627261e&v=4)](/pmatilai)

Copy link

Member

Author

### **[pmatilai](/pmatilai)** commented [Feb 16, 2022](#issuecomment-1041251497)

| Yeah once we have the basics working and optimized to a reasonable degree we can start looking at utilizing various OS-specific extensions. The gotcha with those is to find ways to provide extra functionality in the specific OS'es *without* introducing multiple codepaths (which will inevitably bitrot) to accomplish the same thing. |
| --- |

All reactions

Sorry, something went wrong.

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=80&u=1dfa623e3663a322b837fe9a817b0f90a627261e&v=4)](/pmatilai)

Copy link

Member

Author

### **[pmatilai](/pmatilai)** commented [Feb 16, 2022](#issuecomment-1041257588)

| Anyway...  There will inevitably be bugs in this all, and since the test-suite covers only so much the best way to find the rest is real-world testing. And sitting in a branch does little to achieve that, so I'm merging this as is now.  Danger Will Robinson, if you're in the habbit of running rpm daily snapshots then you'll want to stay alert for a while. |
| --- |

All reactions

Sorry, something went wrong.

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=80&u=1dfa623e3663a322b837fe9a817b0f90a627261e&v=4)](/pmatilai)

Copy link

Member

Author

### **[pmatilai](/pmatilai)** commented [Feb 16, 2022](#issuecomment-1041258659)

| Oh, and to make it absolutely clear: we're nowhere *near* done with this, I just want to get this bulk of change over with so we can concentrate with the finer nuances. |
| --- |

All reactions

Sorry, something went wrong.

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&u=1dfa623e3663a322b837fe9a817b0f90a627261e&v=4)](/pmatilai)
[pmatilai](/pmatilai)
merged commit [`6dd6272`](/rpm-software-management/rpm/commit/6dd62720fe84f7e2ad902c915b952fc0b29e3dcd)
into
rpm-software-management:master

[Feb 16, 2022](https://github.com/rpm-software-management/rpm/pull/1919#event-6081047593)

 [![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&u=1dfa623e3663a322b837fe9a817b0f90a627261e&v=4)](/pmatilai)
[pmatilai](/pmatilai)
deleted the
dirsafe-pr

branch
[April 7, 2022 11:14](#event-6387449019)

[![@CamberLoid](https://avatars.githubusercontent.com/u/22998116?s=40&v=4)](/CamberLoid)
[CamberLoid](/CamberLoid)
mentioned this pull request
[Nov 3, 2022](#ref-issue-1435012232)

[rpm: Several Vulnerabilites Regarding to version 4.17.0
AOSC-Dev/aosc-os-abbs#4283](/AOSC-Dev/aosc-os-abbs/issues/4283)

Closed

[![@sandy-lcq](https://avatars.githubusercontent.com/u/39258624?s=80&u=b14c9ffe76466f1eed8956d2b3b52cebeaadd23e&v=4)](/sandy-lcq)

Copy link

### **[sandy-lcq](/sandy-lcq)** commented [Feb 8, 2023](#issuecomment-1422048306)

| [@pmatilai](https://github.com/pmatilai) Thanks for fixing these CVEs. And I want to double check with you that does these 32 commits in this pull request fully fix [CVE-2021-35937](https://github.com/advisories/GHSA-63x9-9q4w-j636 "CVE-2021-35937"), [CVE-2021-35938](https://github.com/advisories/GHSA-83gm-5269-qr3v "CVE-2021-35938"), [CVE-2021-35939](https://github.com/advisories/GHSA-prgv-w33h-5m73 "CVE-2021-35939")? Any plan to porting it to 4.17.x branch? |
| --- |

All reactions

Sorry, something went wrong.

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=80&u=1dfa623e3663a322b837fe9a817b0f90a627261e&v=4)](/pmatilai)

Copy link

Member

Author

### **[pmatilai](/pmatilai)** commented [Feb 8, 2023](#issuecomment-1422075236)

| There will be no backports. |
| --- |

All reactions

Sorry, something went wrong.

[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)
[dmnks](/dmnks)
mentioned this pull request
[Jun 18, 2024](#ref-issue-2360137007)

[Relocatable packages with plain `/` in `%files` can't be installed as regular user
#3173](/rpm-software-management/rpm/issues/3173)

Closed

[dmnks](/dmnks)
added a commit
to dmnks/rpm
that referenced
this pull request
[Jul 15, 2024](#ref-commit-63e3b59)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix (relocatable) packages owning %{prefix} in fsm](/dmnks/rpm/commit/63e3b592323d7f90b108f9d7c4eb1ff252d06e15 "Fix (relocatable) packages owning %{prefix} in fsm

Make sure fsmFsPath() always returns a relative path so that when we
pass it to an *at() call, the dirfd argument is always respected (see
e.g. fchownat(2) for details).

Previously, we returned \"/\" for file info that
CONTINUE HERE

which eventually caused an installation
to fail in fsmChown()

Always pass a relative path to the *at() calls, even if we're processing
the root directory itself, to prevent those calls from
operating on the real \"/\" if the root

At the same time, make sure to unlink the root
directory if it's not the real root but a relocated prefix.

Otherwise, if a package owns the \"/\"
path, we would end up calling fchownat() on it and only accidentally
succeed if we have write permissions for it (which regular users
typically don't).

This fixes the installation and removal of such packages for regular
users (only applies to relocatable packages

This makes relocatable packages installable by regular users again (this
regressed in the symlink fixes in #1919).  Additionally, this also fixes
the removal of")`
…

`[63e3b59](/dmnks/rpm/commit/63e3b592323d7f90b108f9d7c4eb1ff252d06e15)`

```
Make sure fsmFsPath() always returns a relative path so that when we
pass it to an *at() call, the dirfd argument is always respected (see
e.g. fchownat(2) for details).

Previously, we returned "/" for file info that
CONTINUE HERE

which eventually caused an installation
to fail in fsmChown()

Always pass a relative path to the *at() calls, even if we're processing
the root directory itself, to prevent those calls from
operating on the real "/" if the root

At the same time, make sure to unlink the root
directory if it's not the real root but a relocated prefix.

Otherwise, if a package owns the "/"
path, we would end up calling fchownat() on it and only accidentally
succeed if we have write permissions for it (which regular users
typically don't).

This fixes the installation and removal of such packages for regular
users (only applies to relocatable packages

This makes relocatable packages installable by regular users again (this
regressed in the symlink fixes in [rpm-software-management#1919](https://github.com/rpm-software-management/rpm/pull/1919)).  Additionally, this also fixes
the removal of
```

[dmnks](/dmnks)
added a commit
to dmnks/rpm
that referenced
this pull request
[Jul 16, 2024](#ref-commit-be525d1)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix (relocatable) packages that own / in fsm](/dmnks/rpm/commit/be525d14ceb8dc574757f4c7d4894a61c42f96ed "Fix (relocatable) packages that own / in fsm

During payload processing, if we encounter a file entry corresponding to
the prefix directory itself, instead of referring to it relative to its
parent directory's file descriptor, we pass the absolute / path to the
*at() calls which then makes them fall back to path-based operation.

This isn't a huge problem as long as we're installing into the real root
prefix, however if the package is built as relocatable and the prefix is
overridden, we still operate on the real \"/\" instead of the new prefix.

This is wrong and even causes an installation failure if the relocatable
package is installed as a regular user who doesn't have write access for
the real root.

Fix this by simply passing \".\" instead of \"/\" to these *at() calls, to
always ensure fd-based operation.

However, this alone isn't sufficient since we can't delete the relocated
prefix directory itself this way when removing the package.  This is due
to fact that unlinkat(2) with AT_REMOVEDIR actually performs a rmdir(2),
and that fails with EINVAL if called with the \".\" path.

Therefore, when removing a package and encountering the prefix directory
itself, stop the traversal in ensureDir() one level higher than usual so
that we refer to the prefix directory relative to its parent directory
via normal fd-based operation.

Lastly, don't even attempt to remove the prefix if it's *not* relocated.
This is safer and also gets rid of a spurious warning that's printed
when removing a non-relocatable package owning / as the root user.

Such packages (that include the sole / in their %files section) perhaps
aren't exactly common and those that exist aren't normally installed or
uninstalled on a production system (such as the \"filesystem\" package on
Fedora), however it's apparently used as a shorthand for including all
files in a relocatable package, as evidenced by TBD.

Either way, this is a regression introduced by the fsm rework addressing
the symlink CVEs (see #1919 for details).

Fixes: TBD")`
…

`[be525d1](/dmnks/rpm/commit/be525d14ceb8dc574757f4c7d4894a61c42f96ed)`

```
During payload processing, if we encounter a file entry corresponding to
the prefix directory itself, instead of referring to it relative to its
parent directory's file descriptor, we pass the absolute / path to the
*at() calls which then makes them fall back to path-based operation.

This isn't a huge problem as long as we're installing into the real root
prefix, however if the package is built as relocatable and the prefix is
overridden, we still operate on the real "/" instead of the new prefix.

This is wrong and even causes an installation failure if the relocatable
package is installed as a regular user who doesn't have write access for
the real root.

Fix this by simply passing "." instead of "/" to these *at() calls, to
always ensure fd-based operation.

However, this alone isn't sufficient since we can't delete the relocated
prefix directory itself this way when removing the package.  This is due
to fact that unlinkat(2) with AT_REMOVEDIR actually performs a rmdir(2),
and that fails with EINVAL if called with the "." path.

Therefore, when removing a package and encountering the prefix directory
itself, stop the traversal in ensureDir() one level higher than usual so
that we refer to the prefix directory relative to its parent directory
via normal fd-based operation.

Lastly, don't even attempt to remove the prefix if it's *not* relocated.
This is safer and also gets rid of a spurious warning that's printed
when removing a non-relocatable package owning / as the root user.

Such packages (that include the sole / in their %files section) perhaps
aren't exactly common and those that exist aren't normally installed or
uninstalled on a production system (such as the "filesystem" package on
Fedora), however it's apparently used as a shorthand for including all
files in a relocatable package, as evidenced by TBD.

Either way, this is a regression introduced by the fsm rework addressing
the symlink CVEs (see [rpm-software-management#1919](https://github.com/rpm-software-management/rpm/pull/1919) for details).

Fixes: TBD
```

[dmnks](/dmnks)
added a commit
to dmnks/rpm
that referenced
this pull request
[Jul 16, 2024](#ref-commit-b51166a)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix (relocatable) packages that own / in fsm](/dmnks/rpm/commit/b51166a5a06c973e21c2d16b32915687b2a66e01 "Fix (relocatable) packages that own / in fsm

During payload processing, if we encounter a file entry corresponding to
the prefix directory itself, instead of referring to it relative to its
parent directory's file descriptor, we pass the absolute / path to the
*at() calls which then makes them fall back to path-based operation.

This isn't a huge problem as long as we're installing into the real root
prefix, however if the package is built as relocatable and the prefix is
overridden, we still operate on the real \"/\" instead of the new prefix.

This is wrong and even causes an installation failure if the relocatable
package is installed as a regular user who doesn't have write access for
the real root.

Fix this by simply passing \".\" instead of \"/\" to these *at() calls, to
always ensure fd-based operation.

However, this alone isn't sufficient since we can't delete the relocated
prefix directory itself this way when removing the package.  This is due
to the fact that unlinkat(2) with AT_REMOVEDIR actually does a rmdir(2),
and that fails with EINVAL if called with the \".\" path.

Therefore, when removing a package and encountering the prefix directory
itself, stop the traversal in ensureDir() one level higher than usual so
that we refer to the prefix directory relative to its parent directory
via normal fd-based operation.

Lastly, don't even attempt to remove the prefix if it's *not* relocated.
This is safer and also gets rid of a spurious warning that's printed
when removing a non-relocatable package owning / as the root user.

Such packages (that include the sole / in their %files section) perhaps
aren't exactly common and those that exist aren't normally installed or
uninstalled on a production system (such as the \"filesystem\" package on
Fedora), however it's apparently used as a shorthand for including all
files in a relocatable package, as evidenced by TBD.

Either way, this is a regression introduced by the fsm rework addressing
the symlink CVEs (see #1919 for details).

Fixes: TBD")`
…

`[b51166a](/dmnks/rpm/commit/b51166a5a06c973e21c2d16b32915687b2a66e01)`

```
During payload processing, if we encounter a file entry corresponding to
the prefix directory itself, instead of referring to it relative to its
parent directory's file descriptor, we pass the absolute / path to the
*at() calls which then makes them fall back to path-based operation.

This isn't a huge problem as long as we're installing into the real root
prefix, however if the package is built as relocatable and the prefix is
overridden, we still operate on the real "/" instead of the new prefix.

This is wrong and even causes an installation failure if the relocatable
package is installed as a regular user who doesn't have write access for
the real root.

Fix this by simply passing "." instead of "/" to these *at() calls, to
always ensure fd-based operation.

However, this alone isn't sufficient since we can't delete the relocated
prefix directory itself this way when removing the package.  This is due
to the fact that unlinkat(2) with AT_REMOVEDIR actually does a rmdir(2),
and that fails with EINVAL if called with the "." path.

Therefore, when removing a package and encountering the prefix directory
itself, stop the traversal in ensureDir() one level higher than usual so
that we refer to the prefix directory relative to its parent directory
via normal fd-based operation.

Lastly, don't even attempt to remove the prefix if it's *not* relocated.
This is safer and also gets rid of a spurious warning that's printed
when removing a non-relocatable package owning / as the root user.

Such packages (that include the sole / in their %files section) perhaps
aren't exactly common and those that exist aren't normally installed or
uninstalled on a production system (such as the "filesystem" package on
Fedora), however it's apparently used as a shorthand for including all
files in a relocatable package, as evidenced by TBD.

Either way, this is a regression introduced by the fsm rework addressing
the symlink CVEs (see [rpm-software-management#1919](https://github.com/rpm-software-management/rpm/pull/1919) for details).

Fixes: TBD
```

[dmnks](/dmnks)
added a commit
to dmnks/rpm
that referenced
this pull request
[Jul 16, 2024](#ref-commit-a10c3e9)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix relocatable packages that own prefix in fsm](/dmnks/rpm/commit/a10c3e93643dcf14b2289a01ab77e9a9fdf51131 "Fix relocatable packages that own prefix in fsm

During payload processing, if we encounter a file entry corresponding to
the prefix directory itself, instead of referring to it relative to its
parent directory's file descriptor, we pass the absolute / path to the
*at() calls which then makes them fall back to path-based operation.

This isn't a huge problem as long as we're installing into the real root
prefix, however if the package is built as relocatable and the prefix is
overridden, we still operate on the real / instead of the new prefix.

This is wrong and even causes an installation failure if the relocatable
package is installed by a regular user who doesn't have write access for
the real root.

Fix by simply passing \".\" instead of \"/\" to these *at() calls, to always
ensure fd-based operation.

However, this alone isn't sufficient since we can't delete the relocated
prefix directory itself along with the package this way.  This is due to
the fact that unlinkat(2) with AT_REMOVEDIR actually does a rmdir(2),
and that fails with EINVAL if called with the \".\" path.

Therefore, when removing a package and encountering the prefix directory
itself, stop the traversal in ensureDir() one level higher than usual so
that we refer to the prefix directory relative to its parent directory
via normal fd-based operation.

Lastly, don't even attempt to remove the prefix if it's *not* relocated.
This is safer and also gets rid of the spurious warning that's printed
when removing a non-relocatable package owning / as the root user.

Such packages (that include the sole / in their %files section) perhaps
aren't exactly common and those that exist aren't normally installed or
uninstalled on a production system (such as the \"filesystem\" package on
Fedora), however it's apparently used as a shorthand for including all
files in a relocatable package, as evidenced by TBD.

That, and the fact that this all used to work fine before the fsm rework
(#1919) addressing the symlink CVEs means a fix (one that also doesn't
reintroduce the TOCTOU issue) is in order, whether pretty or not.

Fixes: TBD")`
…

`[a10c3e9](/dmnks/rpm/commit/a10c3e93643dcf14b2289a01ab77e9a9fdf51131)`

```
During payload processing, if we encounter a file entry corresponding to
the prefix directory itself, instead of referring to it relative to its
parent directory's file descriptor, we pass the absolute / path to the
*at() calls which then makes them fall back to path-based operation.

This isn't a huge problem as long as we're installing into the real root
prefix, however if the package is built as relocatable and the prefix is
overridden, we still operate on the real / instead of the new prefix.

This is wrong and even causes an installation failure if the relocatable
package is installed by a regular user who doesn't have write access for
the real root.

Fix by simply passing "." instead of "/" to these *at() calls, to always
ensure fd-based operation.

However, this alone isn't sufficient since we can't delete the relocated
prefix directory itself along with the package this way.  This is due to
the fact that unlinkat(2) with AT_REMOVEDIR actually does a rmdir(2),
and that fails with EINVAL if called with the "." path.

Therefore, when removing a package and encountering the prefix directory
itself, stop the traversal in ensureDir() one level higher than usual so
that we refer to the prefix directory relative to its parent directory
via normal fd-based operation.

Lastly, don't even attempt to remove the prefix if it's *not* relocated.
This is safer and also gets rid of the spurious warning that's printed
when removing a non-relocatable package owning / as the root user.

Such packages (that include the sole / in their %files section) perhaps
aren't exactly common and those that exist aren't normally installed or
uninstalled on a production system (such as the "filesystem" package on
Fedora), however it's apparently used as a shorthand for including all
files in a relocatable package, as evidenced by TBD.

That, and the fact that this all used to work fine before the fsm rework
([rpm-software-management#1919](https://github.com/rpm-software-management/rpm/pull/1919)) addressing the symlink CVEs means a fix (one that also doesn't
reintroduce the TOCTOU issue) is in order, whether pretty or not.

Fixes: TBD
```

[dmnks](/dmnks)
added a commit
to dmnks/rpm
that referenced
this pull request
[Jul 16, 2024](#ref-commit-32a8f1d)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix relocatable packages that own %{prefix} in fsm](/dmnks/rpm/commit/32a8f1d1923ec0a9d2bc6cac4f2bf5b00ebc4230 "Fix relocatable packages that own %{prefix} in fsm

During payload processing, if we encounter a file entry corresponding to
the prefix directory itself, instead of referring to it relative to its
parent directory's file descriptor, we pass the absolute / path to the
*at() calls which then makes them fall back to path-based operation.

This isn't a huge problem as long as we're installing into the real root
prefix, however if the package is built as relocatable and the prefix is
overridden, we still operate on the real / instead of the new prefix.

This is wrong and even causes an installation failure if the relocatable
package is installed by a regular user who doesn't have write access for
the real root.

Fix by simply passing \".\" instead of \"/\" to these *at() calls, to always
ensure fd-based operation.

However, this alone isn't sufficient since we can't delete the relocated
prefix directory itself along with the package this way.  This is due to
the fact that unlinkat(2) with AT_REMOVEDIR actually does a rmdir(2),
and that fails with EINVAL if called with the \".\" path.

Therefore, when removing a package and encountering the prefix directory
itself, stop the traversal in ensureDir() one level higher than usual so
that we refer to the prefix directory relative to its parent directory
via normal fd-based operation.

Lastly, don't even attempt to remove the prefix if it's *not* relocated.
This is safer and also gets rid of the spurious warning that's printed
when removing a non-relocatable package owning / as the root user.

Such packages (that include the sole / in their %files section) perhaps
aren't exactly common and those that exist aren't normally installed or
uninstalled on a production system (such as the \"filesystem\" package on
Fedora), however it's apparently used as a shorthand for including all
files in a relocatable package, as evidenced by TBD.

That, and the fact that this all used to work fine before the fsm rework
(#1919) addressing the symlink CVEs means a fix (one that also doesn't
reintroduce the TOCTOU issue) is in order, whether pretty or not.

Fixes: TBD")`
…

`[32a8f1d](/dmnks/rpm/commit/32a8f1d1923ec0a9d2bc6cac4f2bf5b00ebc4230)`

```
During payload processing, if we encounter a file entry corresponding to
the prefix directory itself, instead of referring to it relative to its
parent directory's file descriptor, we pass the absolute / path to the
*at() calls which then makes them fall back to path-based operation.

This isn't a huge problem as long as we're installing into the real root
prefix, however if the package is built as relocatable and the prefix is
overridden, we still operate on the real / instead of the new prefix.

This is wrong and even causes an installation failure if the relocatable
package is installed by a regular user who doesn't have write access for
the real root.

Fix by simply passing "." instead of "/" to these *at() calls, to always
ensure fd-based operation.

However, this alone isn't sufficient since we can't delete the relocated
prefix directory itself along with the package this way.  This is due to
the fact that unlinkat(2) with AT_REMOVEDIR actually does a rmdir(2),
and that fails with EINVAL if called with the "." path.

Therefore, when removing a package and encountering the prefix directory
itself, stop the traversal in ensureDir() one level higher than usual so
that we refer to the prefix directory relative to its parent directory
via normal fd-based operation.

Lastly, don't even attempt to remove the prefix if it's *not* relocated.
This is safer and also gets rid of the spurious warning that's printed
when removing a non-relocatable package owning / as the root user.

Such packages (that include the sole / in their %files section) perhaps
aren't exactly common and those that exist aren't normally installed or
uninstalled on a production system (such as the "filesystem" package on
Fedora), however it's apparently used as a shorthand for including all
files in a relocatable package, as evidenced by TBD.

That, and the fact that this all used to work fine before the fsm rework
([rpm-software-management#1919](https://github.com/rpm-software-management/rpm/pull/1919)) addressing the symlink CVEs means a fix (one that also doesn't
reintroduce the TOCTOU issue) is in order, whether pretty or not.

Fixes: TBD
```

[dmnks](/dmnks)
added a commit
to dmnks/rpm
that referenced
this pull request
[Jul 30, 2024](#ref-commit-e52edb6)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix root relocation regression](/dmnks/rpm/commit/e52edb62d616e82838068cb1902d5e7d0d4cf0df "Fix root relocation regression

When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls (#1919) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Fixes: #3173")`
…

`[e52edb6](/dmnks/rpm/commit/e52edb62d616e82838068cb1902d5e7d0d4cf0df)`

```
When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls ([rpm-software-management#1919](https://github.com/rpm-software-management/rpm/pull/1919)) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Fixes: [rpm-software-management#3173](https://github.com/rpm-software-management/rpm/issues/3173)
```

[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)
[dmnks](/dmnks)
mentioned this pull request
[Jul 30, 2024](#ref-pullrequest-2438141843)

[Fix root relocation regression
#3223](/rpm-software-management/rpm/pull/3223)
 Merged

[pmatilai](/pmatilai)
pushed a commit
that referenced
this pull request
[Aug 1, 2024](#ref-commit-308ac60)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks) [![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=40&v=4)](/pmatilai)

`[Fix root relocation regression](/rpm-software-management/rpm/commit/308ac60677732e9979b9ce11e5a3085906da1901 "Fix root relocation regression

When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls (#1919) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Fixes: #3173")`
…

`[308ac60](/rpm-software-management/rpm/commit/308ac60677732e9979b9ce11e5a3085906da1901)`

```
When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls ([#1919](https://github.com/rpm-software-management/rpm/pull/1919)) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Fixes: [#3173](https://github.com/rpm-software-management/rpm/issues/3173)
```

[dmnks](/dmnks)
added a commit
to dmnks/rpm
that referenced
this pull request
[Aug 29, 2024](#ref-commit-679f190)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix root relocation regression](/dmnks/rpm/commit/679f1905d737e4f7485d9259bb33760e9b79d98e "Fix root relocation regression

When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls (#1919) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Fixes: #3173
(cherry picked from commit 308ac60677732e9979b9ce11e5a3085906da1901)")`
…

`[679f190](/dmnks/rpm/commit/679f1905d737e4f7485d9259bb33760e9b79d98e)`

```
When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls ([rpm-software-management#1919](https://github.com/rpm-software-management/rpm/pull/1919)) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Fixes: [rpm-software-management#3173](https://github.com/rpm-software-management/rpm/issues/3173)
(cherry picked from commit [308ac60](https://github.com/dmnks/rpm/commit/308ac60677732e9979b9ce11e5a3085906da1901))
```

[dmnks](/dmnks)
added a commit
that referenced
this pull request
[Aug 30, 2024](#ref-commit-d4aa7ef)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix root relocation regression](/rpm-software-management/rpm/commit/d4aa7ef90bced7b709db59c2ca45d76fcc8a98a2 "Fix root relocation regression

When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls (#1919) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Fixes: #3173
(cherry picked from commit 308ac60677732e9979b9ce11e5a3085906da1901)")`
…

`[d4aa7ef](/rpm-software-management/rpm/commit/d4aa7ef90bced7b709db59c2ca45d76fcc8a98a2)`

```
When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls ([#1919](https://github.com/rpm-software-management/rpm/pull/1919)) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Fixes: [#3173](https://github.com/rpm-software-management/rpm/issues/3173)
(cherry picked from commit [308ac60](https://github.com/rpm-software-management/rpm/commit/308ac60677732e9979b9ce11e5a3085906da1901))
```

[dmnks](/dmnks)
added a commit
to dmnks/rpm
that referenced
this pull request
[Oct 21, 2024](#ref-commit-72f0b69)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix root relocation regression](/dmnks/rpm/commit/72f0b698dc9b201b2482f17138bdf491c196f17e "Fix root relocation regression

When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls (#1919) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Backported from commits:
31c14ba6610568c2d634647fed1fb57221178da9
308ac60677732e9979b9ce11e5a3085906da1901

Tests are excluded from this backport since they would need significant
rework, the use case will be covered by Beaker instead.

Fixes: RHEL-49494")`
…

`[72f0b69](/dmnks/rpm/commit/72f0b698dc9b201b2482f17138bdf491c196f17e)`

```
When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls ([rpm-software-management#1919](https://github.com/rpm-software-management/rpm/pull/1919)) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Backported from commits:
[31c14ba](https://github.com/dmnks/rpm/commit/31c14ba6610568c2d634647fed1fb57221178da9)
[308ac60](https://github.com/dmnks/rpm/commit/308ac60677732e9979b9ce11e5a3085906da1901)

Tests are excluded from this backport since they would need significant
rework, the use case will be covered by Beaker instead.

Fixes: RHEL-49494
```

[dmnks](/dmnks)
added a commit
to dmnks/rpm
that referenced
this pull request
[Oct 21, 2024](#ref-commit-33ae1d2)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix root relocation regression](/dmnks/rpm/commit/33ae1d2031e18db7d98e184ad4766e9ad5cd206a "Fix root relocation regression

When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls (#1919) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Backported from commits:
31c14ba6610568c2d634647fed1fb57221178da9
308ac60677732e9979b9ce11e5a3085906da1901

Tests are excluded from this backport since they would need significant
rework, the use case will be covered by Beaker anyway.

Fixes: RHEL-49494")`
…

`[33ae1d2](/dmnks/rpm/commit/33ae1d2031e18db7d98e184ad4766e9ad5cd206a)`

```
When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls ([rpm-software-management#1919](https://github.com/rpm-software-management/rpm/pull/1919)) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Backported from commits:
[31c14ba](https://github.com/dmnks/rpm/commit/31c14ba6610568c2d634647fed1fb57221178da9)
[308ac60](https://github.com/dmnks/rpm/commit/308ac60677732e9979b9ce11e5a3085906da1901)

Tests are excluded from this backport since they would need significant
rework, the use case will be covered by Beaker anyway.

Fixes: RHEL-49494
```

[dmnks](/dmnks)
added a commit
to dmnks/rpm
that referenced
this pull request
[Oct 21, 2024](#ref-commit-9d01648)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix root relocation regression](/dmnks/rpm/commit/9d01648f6752785be07a96498af0505d04170ec1 "Fix root relocation regression

When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls (#1919) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Backported from commits:
31c14ba6610568c2d634647fed1fb57221178da9
308ac60677732e9979b9ce11e5a3085906da1901

Tests are excluded from this backport since they would need significant
rework, the use case will be covered by Beaker.

Fixes: RHEL-49494")`
…

`[9d01648](/dmnks/rpm/commit/9d01648f6752785be07a96498af0505d04170ec1)`

```
When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls ([rpm-software-management#1919](https://github.com/rpm-software-management/rpm/pull/1919)) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Backported from commits:
[31c14ba](https://github.com/dmnks/rpm/commit/31c14ba6610568c2d634647fed1fb57221178da9)
[308ac60](https://github.com/dmnks/rpm/commit/308ac60677732e9979b9ce11e5a3085906da1901)

Tests are excluded from this backport since they would need significant
rework, the use case will be covered by Beaker.

Fixes: RHEL-49494
```

[dmnks](/dmnks)
added a commit
to dmnks/rpm
that referenced
this pull request
[Oct 21, 2024](#ref-commit-283122d)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix root relocation regression](/dmnks/rpm/commit/283122d89c68291c94d407b74470e1421751ec40 "Fix root relocation regression

When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls (#1919) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Backported from commits:
31c14ba6610568c2d634647fed1fb57221178da9
308ac60677732e9979b9ce11e5a3085906da1901

Tests are excluded from this backport since they would need significant
rework, the use case will be covered by Beaker.

Fixes: RHEL-49494")`
…

`[283122d](/dmnks/rpm/commit/283122d89c68291c94d407b74470e1421751ec40)`

```
When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls ([rpm-software-management#1919](https://github.com/rpm-software-management/rpm/pull/1919)) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Backported from commits:
[31c14ba](https://github.com/dmnks/rpm/commit/31c14ba6610568c2d634647fed1fb57221178da9)
[308ac60](https://github.com/dmnks/rpm/commit/308ac60677732e9979b9ce11e5a3085906da1901)

Tests are excluded from this backport since they would need significant
rework, the use case will be covered by Beaker.

Fixes: RHEL-49494
```

[dmnks](/dmnks)
added a commit
to dmnks/rpm
that referenced
this pull request
[Oct 21, 2024](#ref-commit-4d72e56)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix root relocation regression](/dmnks/rpm/commit/4d72e5648833cad1383d496cf0baad8a9ddced01 "Fix root relocation regression

When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls (#1919) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Backported from commits:
31c14ba6610568c2d634647fed1fb57221178da9
308ac60677732e9979b9ce11e5a3085906da1901

Tests are excluded from this backport since they would need significant
rework, the use case will be covered by Beaker.

Fixes: RHEL-49494")`
…

`[4d72e56](/dmnks/rpm/commit/4d72e5648833cad1383d496cf0baad8a9ddced01)`

```
When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls ([rpm-software-management#1919](https://github.com/rpm-software-management/rpm/pull/1919)) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Backported from commits:
[31c14ba](https://github.com/dmnks/rpm/commit/31c14ba6610568c2d634647fed1fb57221178da9)
[308ac60](https://github.com/dmnks/rpm/commit/308ac60677732e9979b9ce11e5a3085906da1901)

Tests are excluded from this backport since they would need significant
rework, the use case will be covered by Beaker.

Fixes: RHEL-49494
```

[dmnks](/dmnks)
added a commit
to dmnks/rpm
that referenced
this pull request
[Nov 8, 2024](#ref-commit-b5547f5)
[![@dmnks](https://avatars.githubusercontent.com/u/7109627?s=40&u=1431b1cf4c5ed1bd419591bbe3e4e96496679eac&v=4)](/dmnks)

`[Fix root relocation regression](/dmnks/rpm/commit/b5547f53d8ba22f4cd510063eb4c8f5d61751ce2 "Fix root relocation regression

When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls (#1919) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Backported from commits:
31c14ba6610568c2d634647fed1fb57221178da9
308ac60677732e9979b9ce11e5a3085906da1901

Tests are excluded from this backport since they would need significant
rework, the use case will be covered by Beaker.

Fixes: RHEL-49494")`
…

`[b5547f5](/dmnks/rpm/commit/b5547f53d8ba22f4cd510063eb4c8f5d61751ce2)`

```
When relocating the root directory, make sure we insert the new path's
dirname to dirNames[] even if the root itself is owned by the package.

This appears to have been the intention from the first version (largely
untouched since) of this code as we allow the root to pass through the
first checks (by setting len to 0 in that case) as well as the second
for loop where we do the relocations.

This allows fsm to properly create and remove the relocated directory
since we're now using fd-based calls ([rpm-software-management#1919](https://github.com/rpm-software-management/rpm/pull/1919)) and the parent directory
needs to be opened first.

No need to do string comparison here, the empty basename signals that
we're processing the root directory, so just use that.

Building a relocatable package that owns the root directory seems to be
a handy way to create user-installable packages (see RHEL-28967) and it
happened to work before with the path-based calls so this technically
was a regression.  Add a test that emulates this use case.

Backported from commits:
[31c14ba](https://github.com/dmnks/rpm/commit/31c14ba6610568c2d634647fed1fb57221178da9)
[308ac60](https://github.com/dmnks/rpm/commit/308ac60677732e9979b9ce11e5a3085906da1901)

Tests are excluded from this backport since they would need significant
rework, the use case will be covered by Beaker.

Fixes: RHEL-49494
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Frpm-software-management%2Frpm%2Fpull%2F1919)

Reviewers

[![@DemiMarie](https://avatars.githubusercontent.com/u/6395399?s=40&v=4)](/DemiMarie) [DemiMarie](/DemiMarie)

DemiMarie left review comments

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@pmatilai](https://avatars.githubusercontent.com/u/3882389?s=52&v=4)](/pmatilai) [![@DemiMarie](https://avatars.githubusercontent.com/u/6395399?s=52&v=4)](/DemiMarie) [![@sandy-lcq](https://avatars.githubusercontent.com/u/39258624?s=52&v=4)](/sandy-lcq)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


