<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
Design by Free CSS Templates
http://www.freecsstemplates.org
Released for free under a Creative Commons Attribution 2.5 License

Name       : Vertebrata  
Description: A two-column, fixed-width design with dark color scheme.
Version    : 1.0
Released   : 20100423

-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>rpm.org - Releases</title>
<link href="/stylesheets/style.css" rel="stylesheet" type="text/css" media="screen" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
<div id="wrapper">
	<div id="header">
        <a href="/index.html">
		<div id="logo">
		</div>
        </a>
	</div>
	<!-- end #header -->
	<div id="menu">
		<ul>
            <li><a href="/index.html">Home</a></li>
            <li><a href="/documentation.html">Documentation</a></li>
            <li><a href="/download.html">Download</a></li>
            <li><a href="/community.html">Community</a></li>
            <li><a href="/contribute.html">Contribute</a></li>
            <li><a href="/roadmap.html">Roadmap</a></li>
            <li><a href="/about.html">About</a></li>
		</ul>
	</div>
	<!-- end #menu -->
	<div id="page">
	<div id="page-bgtop">
	<div id="page-bgbtm">
		<div id="content">
        <h1 id="rpm-4180-release-notes">RPM 4.18.0 Release Notes</h1>

<h2 id="download-information">Download information</h2>
<ul>
  <li>Source: <a href="https://ftp.osuosl.org/pub/rpm/releases/rpm-4.18.x/rpm-4.18.0.tar.bz2">rpm-4.18.0.tar.bz2</a></li>
  <li>SHA256SUM: 2a17152d7187ab30edf2c2fb586463bdf6388de7b5837480955659e5e9054554</li>
</ul>

<h2 id="summary-of-changes-from-rpm-417x">Summary of changes from RPM 4.17.x</h2>

<h3 id="general-bugfixes-and-enhancements">General bugfixes and enhancements</h3>
<ul>
  <li>Add a new <a href="https://sequoia-pgp.org/">Sequoia-based</a> OpenPGP backend (#1978)</li>
  <li>Documentation updates
    <ul>
      <li>Lua extensions, examples</li>
      <li>Typos, grammar, clarifications, presentation improvements</li>
      <li>Bring install-order documentation to this millenium</li>
      <li>Drop some misleadingly outdated docs</li>
      <li>Translation updates</li>
    </ul>
  </li>
</ul>

<h4 id="command-line">Command line</h4>
<ul>
  <li>Fix <code class="language-plaintext highlighter-rouge">--restore</code> to properly honor file states and all (#965)</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">--setperms</code> processing recorded symlinks (RhBug:1900662)</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">rpmkeys</code> return code on I/O errors</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">--showrc</code> to return an error code on broken rc and macro files (#1796)</li>
  <li>Fix mismatch between <code class="language-plaintext highlighter-rouge">rpmspec -q --srpm</code> and <code class="language-plaintext highlighter-rouge">rpmbuild -bs</code> architecture
(#1116)</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">--short-circuit</code> for (dynamic) buildrequires checking</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">-q/--query</code> option not visible in <code class="language-plaintext highlighter-rouge">--help</code> (#1473)</li>
  <li>Fix query arguments containing <code class="language-plaintext highlighter-rouge">^</code> not working (#2104)</li>
  <li>Fix various dark corners in rpm2cpio.sh (RhBug:2115206)</li>
  <li>Add downgrade (<code class="language-plaintext highlighter-rouge">--oldpackage</code>) support to <code class="language-plaintext highlighter-rouge">--freshen</code> (#652)</li>
  <li>Add <code class="language-plaintext highlighter-rouge">--path</code> query for support for stateless file information (RhBug:1940895)</li>
  <li>Add <code class="language-plaintext highlighter-rouge">rpmlua</code> command for running rpm’s embedded Lua interpreter standalone,
with command history and support for iLua</li>
  <li>Add <code class="language-plaintext highlighter-rouge">--shell</code> option for interactive macro shell to <code class="language-plaintext highlighter-rouge">rpmspec</code></li>
  <li>Add <code class="language-plaintext highlighter-rouge">--justdb</code> counterpart <code class="language-plaintext highlighter-rouge">--nodb</code> option and matching API flag</li>
  <li>Add <code class="language-plaintext highlighter-rouge">-bd</code>, <code class="language-plaintext highlighter-rouge">-td</code> and <code class="language-plaintext highlighter-rouge">-rd</code> switches to <code class="language-plaintext highlighter-rouge">rpmbuild</code> for checking build
dependencies</li>
  <li>Add available database backends to <code class="language-plaintext highlighter-rouge">--showrc</code> output</li>
</ul>

<h4 id="transactions">Transactions</h4>
<ul>
  <li>Fix intermediate symlinks not verified (CVE-2021-35939)</li>
  <li>Fix unowned directories created unsafely</li>
  <li>Fix spurious <code class="language-plaintext highlighter-rouge">%transfiletriggerpostun</code> execution (RhBug:2023311)</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">%_minimize_writes</code> regression (in 4.15.0)</li>
  <li>Fix possible priority inversion in ordering code wrt weak dependencies
with qualifiers</li>
  <li>Fix ctrl-c during transaction killing scriptlets (regression in 4.17.0)</li>
  <li>Fix excluded and non-installed files getting considered in file conflicts
calculation</li>
  <li>Fix uncontrolled sqlite WAL growth during large transactions</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">%posttrans</code> argument on upgrade</li>
</ul>

<h3 id="package-building">Package building</h3>

<h4 id="spec">Spec</h4>
<ul>
  <li>Fix mismatch between package name and provides/obsoletes rules (#1694)</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">check-buildroot</code> not stopping on errors with <code class="language-plaintext highlighter-rouge">grep</code> &gt;= 3.5 (#1968)</li>
  <li>Fix build summary confusingly mixing warnings and errors (#793)</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">%patch 1</code> applying patches 0 and 1</li>
  <li>Fix package build tree not getting removed on successful build</li>
  <li>Fix .gemspec from <code class="language-plaintext highlighter-rouge">%setup</code> not getting removed on <code class="language-plaintext highlighter-rouge">%clean</code></li>
  <li>Fix <code class="language-plaintext highlighter-rouge">%setup</code> and <code class="language-plaintext highlighter-rouge">%patch</code> not getting expanded in rpmspec –parse (#2048)</li>
  <li>Fix missing quotes on %sources and %patches (#1445)</li>
  <li>Add new <code class="language-plaintext highlighter-rouge">SourceLicense</code> tag for specifying a source license different from
the binary license (#2079)</li>
  <li>Add new <code class="language-plaintext highlighter-rouge">%conf</code> spec section for build configuration (#1086)</li>
  <li>Add <code class="language-plaintext highlighter-rouge">%bcond</code> macro as a nicer way of defining build conditionals (#941)</li>
  <li>Add an optional “override clock” from <code class="language-plaintext highlighter-rouge">SOURCE_DATE_EPOCH</code> environment
to support deterministic timestamps inside OS images</li>
  <li>Add support for qualifiers (eg <code class="language-plaintext highlighter-rouge">pre</code>, <code class="language-plaintext highlighter-rouge">post</code>…) for weak dependencies</li>
  <li>Add support for zstd long distance matching compression (<code class="language-plaintext highlighter-rouge">L&lt;n&gt;</code> io flag)</li>
  <li>Add warning if <code class="language-plaintext highlighter-rouge">%source_date_epoch_from_changelog set</code> but changelog missing</li>
  <li>Add new <code class="language-plaintext highlighter-rouge">rpmuncompress</code> cli tool which handles extraction of sources and
uncompress of patches in <code class="language-plaintext highlighter-rouge">%setup</code> and <code class="language-plaintext highlighter-rouge">%patch</code> pseudomacros.</li>
  <li>Add new informational <code class="language-plaintext highlighter-rouge">UpstreamReleases</code>  and <code class="language-plaintext highlighter-rouge">TranslationURL</code> tags</li>
  <li>Add parsed and expanded spec to src.rpm header as <code class="language-plaintext highlighter-rouge">Spec</code> tag</li>
  <li>Make <code class="language-plaintext highlighter-rouge">%{buildsubdir}</code> settable outside <code class="language-plaintext highlighter-rouge">%setup</code></li>
  <li>Deprecate implicit “%patch number zero” syntax</li>
</ul>

<h4 id="macros">Macros</h4>
<ul>
  <li>Fix individual patch application via <code class="language-plaintext highlighter-rouge">%autopatch</code> (#1766)</li>
  <li>Fix consistency issues in macro expansion for builtin macros</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">%{define name body}</code> syntax in specs</li>
  <li>Fix non-parametric built-in macros (regression in 4.17.0)</li>
  <li>Fix short-circuiting of version strings in expressions (#1883)</li>
  <li>Add <code class="language-plaintext highlighter-rouge">%{shescape:...}</code> macro for single quoting and escapes for the shell</li>
  <li>Add optional argument for the <code class="language-plaintext highlighter-rouge">%verbose</code> macro</li>
  <li>Add support for multiple arguments in <code class="language-plaintext highlighter-rouge">%{quote}</code></li>
  <li>Add support for Lua functions in expressions (eg
<code class="language-plaintext highlighter-rouge">%[lua:string.reverse("hello")]</code>)</li>
  <li>Drop arbitrary macro name minimum length limit (RhBug:1994223)</li>
  <li>Protect automatic macros from being redefined and undefined</li>
</ul>

<h4 id="buildroot-policies">Buildroot policies</h4>
<ul>
  <li>Fix handling of filenames with spaces in <code class="language-plaintext highlighter-rouge">brp-compress</code></li>
  <li>Fix Guile object files getting stripped (#1765)</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">brp-strip-comment-note</code> running only serially</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">brp-remove-la-files</code> sometimes removing non-libtool files</li>
  <li>Fix unwanted network access in check-rpaths helper script (RhBug:2079600)</li>
</ul>

<h4 id="generators">Generators</h4>
<ul>
  <li>Fix OCaml generators to ignore cmxs files</li>
  <li>Add a provides generator for rpm macros</li>
</ul>

<h3 id="signatures-and-keys">Signatures and keys</h3>
<ul>
  <li>Fix signature check result on valid header signature but unverifiable payload</li>
  <li>Fix subkey binding signatures not checked on PGP public keys (CVE-2021-3521)</li>
  <li>Fix Ed25519 signature verification with libgcrypt</li>
  <li>Fix subkeys not capable of signing accepted for verification (#1911)</li>
  <li>Fix signing of packages unusual filenames</li>
  <li>Fix subkey binding timestamp used for main gpg-pubkey (#2004)</li>
  <li>Add support for –import in fs keyring</li>
  <li>Add support for linting keys on import (Sequoia backend only)</li>
</ul>

<h3 id="plugins">Plugins</h3>
<ul>
  <li>Fix IMA causing install failure on filesystems without xattr support</li>
  <li>Add file descriptor argument to file-prepare hook</li>
  <li>Revert file-pre, file-prepare and file-post hook execution to their
pre-4.17.0 positions</li>
</ul>

<h3 id="python-bindings">Python bindings</h3>
<ul>
  <li>Fix ancient Python ts.check() argument order regression (#1871, in 4.8.0)</li>
  <li>Add bindings for <code class="language-plaintext highlighter-rouge">rpmfilesFSignature()</code> and <code class="language-plaintext highlighter-rouge">rpmfilesVSignature()</code>
(<code class="language-plaintext highlighter-rouge">.imasig</code> and <code class="language-plaintext highlighter-rouge">.veritysig</code> properties in <code class="language-plaintext highlighter-rouge">rpm.file</code> objects)</li>
  <li>Drop experimental and internal <code class="language-plaintext highlighter-rouge">_build</code> method from from the spec bindings</li>
</ul>

<h3 id="lua-interface">Lua interface</h3>
<ul>
  <li>Fix relocation info not available in Lua scriptlets (#1531)</li>
  <li>Fix scriptlet arguments passed as numbers again (regression in 4.17.0)</li>
  <li>Fix off-by-one in <code class="language-plaintext highlighter-rouge">rpm.call()</code></li>
  <li>Fix newline behavior in interactive mode</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">rpm.next_file()</code> to be usable only inside scriptlets with input</li>
  <li>Fix rpm.vercmp() error message on second argument (#2165)</li>
  <li>Add <code class="language-plaintext highlighter-rouge">rpm.splitargs()</code> and <code class="language-plaintext highlighter-rouge">rpm.unsplitargs()</code> functions for macro argument
processing</li>
  <li>Add auto-print of <code class="language-plaintext highlighter-rouge">return</code>ed values from macros</li>
  <li>Drop defunct and unused <code class="language-plaintext highlighter-rouge">rex</code> extension</li>
</ul>

<h3 id="api-changes">API changes</h3>

<h4 id="added-apis">Added APIs</h4>
<ul>
  <li><code class="language-plaintext highlighter-rouge">rpmtsAddRestoreElement()</code>, <code class="language-plaintext highlighter-rouge">rpmRestore()</code> for <code class="language-plaintext highlighter-rouge">--restore</code></li>
  <li><code class="language-plaintext highlighter-rouge">rreallocn()</code>, similar to glibc’s reallocarray()</li>
  <li><code class="language-plaintext highlighter-rouge">rpmhex()</code> for hex-enconding binary data</li>
</ul>

<h4 id="changed-apis">Changed APIs</h4>
<ul>
  <li>Fix database open hijacking normal signal handling</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">rpmfiSetFX()</code> return code to be meaningful</li>
  <li>Fix pgpPubkeyFingerprint() to do something meaningful again</li>
  <li>Add new PGP-independent set of hash algorithm symbols (#1899)</li>
  <li>Various generic crypto APIs moved from <code class="language-plaintext highlighter-rouge">rpmpgp.h</code> to <code class="language-plaintext highlighter-rouge">rpmcrypto.h</code> header</li>
  <li>Disable and obsolete <code class="language-plaintext highlighter-rouge">rpmfiSetDX()</code>, <code class="language-plaintext highlighter-rouge">rpmfiInitD()</code> and <code class="language-plaintext highlighter-rouge">rpmfiNextD()</code></li>
</ul>

<h4 id="removed-apis">Removed APIs</h4>
<ul>
  <li>N/A</li>
</ul>

<h3 id="internal-improvements-and-cleanups">Internal improvements and cleanups</h3>
<ul>
  <li>Fix IMA signature lengths assumed constant (#1833, RhBug:2018937)</li>
  <li>Fix various leaks and other findings from static analyzers</li>
  <li>Fix various correctness and safety issues in the OpenPGP parser</li>
  <li>Fix rpmdb cookie in FIPS mode by changing it to SHA256</li>
  <li>Fix pgpDigParams to be properly opaque</li>
  <li>Fix rpmio stats spew in stderr (#1987)</li>
  <li>Fix changelog parsing affecting caller timezone state (#1821)</li>
  <li>Add an artificial limit of 1M to header array sizes</li>
  <li>Add support for loongarch64 architecture</li>
  <li>Add <code class="language-plaintext highlighter-rouge">ARCHSUFFIX</code> extension tag</li>
  <li>Optimize C source file classification</li>
  <li>Drop support for undocumented keyid based import over the net</li>
  <li>Various code cleanups to macro engine and Lua extensions</li>
  <li>Refactor file and directory operations to use fd-based APIs throughout
(CVE-2021-35938)</li>
  <li>Various fixes and cleanups to hardlink handling</li>
  <li>Physically separate public and private headers in the codebase</li>
</ul>

<h3 id="build-process">Build process</h3>
<ul>
  <li>Require POSIX.1-2008 level operating system for the <code class="language-plaintext highlighter-rouge">openat()</code> family
of APIs</li>
  <li>Fix Doxygen deprecation warnings</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">UID_0_USER</code> and <code class="language-plaintext highlighter-rouge">UID_0_GROUP</code> values when <code class="language-plaintext highlighter-rouge">/etc/passwd</code> not present
(#1838)</li>
  <li>Fix out of tree build regression wrt man page generation (#1851)</li>
  <li>Fix stat64 build on Apple Big Sur (#1752)</li>
  <li>Fix build on armhf and mipsel</li>
  <li>Fix db backend default as per availability</li>
  <li>Fix signing tests assuming gpg default to sha256 hash algo</li>
  <li>Fix test-suite relying on deprecated distutils</li>
  <li>Fix warnings from autotools &gt;= 2.70 (#1785)</li>
  <li>Fix <code class="language-plaintext highlighter-rouge">make ci</code> in a VPATH build</li>
  <li>Add option to disable libelf dependency (<code class="language-plaintext highlighter-rouge">--enable/--disable-libelf</code>)</li>
  <li>Add multiple new test-cases</li>
  <li>Update minimum required gettext version to 0.19.8</li>
  <li>Update CI to Fedora 36</li>
</ul>

<h2 id="compatibility-notes">Compatibility notes</h2>

		<div style="clear: both;">&nbsp;</div>
		</div>
		<div style="clear: both;">&nbsp;</div>
	</div>
	</div>
	</div>
	<!-- end #page -->
</div>
	<div id="footer">
		<p>rpm.org</p>
	</div>
	<!-- end #footer -->
</body>
</html>
