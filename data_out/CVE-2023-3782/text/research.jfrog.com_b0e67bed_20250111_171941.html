
[![JFrog Security Research](/assets/static/jfrog-logo-svg.5788598.74a3bea875bf053c65a0663c9ec9a0fd.svg)](/)JFrog Security Research

* [Discover](/vulnerabilities/)
* [Follow JFrog Security
  ![twitter](/assets/static/twitter.e0519be.9769aec62433fd58c76ad32c2d613842.svg)](https://twitter.com/JFrogSecurity)
![Menu](/assets/static/hamburger.a58a0fd.dc5087fee70346d455e75c87bc430716.svg)![Menu](data:image/svg+xml...)![Menu](/assets/static/close.5cd2673.91b568c73f917f773ea7915d69802829.svg)

* [Home](/)
* [Discover](/vulnerabilities/)
* [Follow JFrog Security](https://twitter.com/JFrogSecurity)
[< Back](/vulnerabilities/)
# XRAY-526161 - OkHttp client Brotli DoS

CVE-2023-3782
| CVSS 5.9

 JFrog Severity:medium

Discovered By**Omer Kaspi**of the JFrog Security Research Team

Published 19 Jul, 2023 | Last updated 19 Jul, 2023

## [Summary](#summary)

DoS of the OkHttp client when using a BrotliInterceptor and surfing to a malicious web server, or when an attacker can perform MitM to inject a Brotli zip-bomb into an HTTP response

## [Component](#component)

com.squareup.okhttp3:okhttp-brotli

## [Affected versions](#affected-versions)

(,)

## [Description](#description)

A DoS issue lies in the `intercept()` function, if the user added `BrotliInterceptor` as an interceptor and does not add content encoding, the okhttp client will add the http header for Brotli encoding and will automatically try to decompress responses.
The code does not guard against decompression bombs, which could crash the process due to memory exhaustion. With Brotli a file that weight several KBs can be decompressed into 10GB.

## [PoC](#poc)

The following client code will crash when surfing to an HTTP server that serves a [Brotli zip bomb](https://github.com/bones-codes/bombs/raw/master/http/10GB/10GB.html.br.bz2) -

```
import okhttp3.Call;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.Response;
import okhttp3.brotli.BrotliInterceptor;
import java.io.IOException;
public class JavassistIntTruncationExample
{
public static void main(String argv[]) throws IOException {
    OkHttpClient client = new OkHttpClient.Builder()
            .addInterceptor(BrotliInterceptor.INSTANCE)
            .build();
    Request request = new Request.Builder()
            .url("http://127.0.0.1:8080")
            .build();
    Call call = client.newCall(request);
    Response response = call.execute();
    System.out.println(response.body().bytes().length);
}
}

```
## [Vulnerability Mitigations](#vulnerability-mitigations)

Remove any usage of the `BrotliInterceptor` class. If Brotli functionality is needed, a fixed version of the class [can be found here](https://github.com/square/okhttp/blob/parent-4.11.0/okhttp-brotli/src/main/kotlin/okhttp3/brotli/BrotliInterceptor.kt)

## [References](#references)

<https://github.com/square/okhttp/issues/7738>

[< Back](/vulnerabilities/)[![JFrog Security Research](/assets/static/jfrog-logo-svg.5788598.74a3bea875bf053c65a0663c9ec9a0fd.svg)](/)

* [Terms of Use](https://jfrog.com/terms-of-use/)
* [Cookies Policy](https://jfrog.com/jfrog-cookies-policy/)
* [Privacy Policy](https://jfrog.com/privacy-policy/)
* Cookies Settings

Â©2025 All Rights Reserved. JFrog Ltd.

