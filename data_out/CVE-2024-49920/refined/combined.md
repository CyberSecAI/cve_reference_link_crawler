=== Content from git.kernel.org_8c4fde5e_20250111_120522.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alex Hung <alex.hung@amd.com> | 2024-06-25 10:37:35 -0600 |
| --- | --- | --- |
| committer | Alex Deucher <alexander.deucher@amd.com> | 2024-07-23 17:07:12 -0400 |
| commit | [fdd5ecbbff751c3b9061d8ebb08e5c96119915b4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4)) | |
| tree | [34be32742c9c22333cdfa5484ca8e6c31c4afce8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4) | |
| parent | [be1fb44389ca3038ad2430dac4234669bc177ee3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=be1fb44389ca3038ad2430dac4234669bc177ee3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4&id2=be1fb44389ca3038ad2430dac4234669bc177ee3)) | |
| download | [linux-fdd5ecbbff751c3b9061d8ebb08e5c96119915b4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fdd5ecbbff751c3b9061d8ebb08e5c96119915b4.tar.gz) | |

drm/amd/display: Check null pointers before multiple uses[WHAT & HOW]
Poniters, such as stream\_enc and dc->bw\_vbios, are null checked previously
in the same function, so Coverity warns "implies that stream\_enc and
dc->bw\_vbios might be null". They are used multiple times in the
subsequent code and need to be checked.
This fixes 10 FORWARD\_NULL issues reported by Coverity.
Reviewed-by: Rodrigo Siqueira <rodrigo.siqueira@amd.com>
Signed-off-by: Jerry Zuo <jerry.zuo@amd.com>
Signed-off-by: Alex Hung <alex.hung@amd.com>
Tested-by: Daniel Wheeler <daniel.wheeler@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4)

| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/core/dc\_hw\_sequencer.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4) | 96 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20_hwseq.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4) | 8 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/link/accessories/link\_dp\_cts.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/link/accessories/link_dp_cts.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/link/hwss/link\_hwss\_dio.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/link/hwss/link_hwss_dio.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/resource/dce112/dce112\_resource.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/resource/dce112/dce112_resource.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32_resource.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource\_helpers.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32_resource_helpers.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4) | 10 | |  |  |  | | --- | --- | --- | |

7 files changed, 76 insertions, 56 deletions

| diff --git a/drivers/gpu/drm/amd/display/dc/core/dc\_hw\_sequencer.c b/drivers/gpu/drm/amd/display/dc/core/dc\_hw\_sequencer.cindex 9e42a0128baa39..5f9b6e8ef428cd 100644--- a/[drivers/gpu/drm/amd/display/dc/core/dc\_hw\_sequencer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)+++ b/[drivers/gpu/drm/amd/display/dc/core/dc\_hw\_sequencer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4)@@ -636,57 +636,59 @@ void hwss\_build\_fast\_sequence(struct dc \*dc, while (current\_pipe) { current\_mpc\_pipe = current\_pipe; while (current\_mpc\_pipe) {- if (dc->hwss.set\_flip\_control\_gsl && current\_mpc\_pipe->plane\_state && current\_mpc\_pipe->plane\_state->update\_flags.raw) {- block\_sequence[\*num\_steps].params.set\_flip\_control\_gsl\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].params.set\_flip\_control\_gsl\_params.flip\_immediate = current\_mpc\_pipe->plane\_state->flip\_immediate;- block\_sequence[\*num\_steps].func = HUBP\_SET\_FLIP\_CONTROL\_GSL;- (\*num\_steps)++;- }- if (dc->hwss.program\_triplebuffer && dc->debug.enable\_tri\_buf && current\_mpc\_pipe->plane\_state->update\_flags.raw) {- block\_sequence[\*num\_steps].params.program\_triplebuffer\_params.dc = dc;- block\_sequence[\*num\_steps].params.program\_triplebuffer\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].params.program\_triplebuffer\_params.enableTripleBuffer = current\_mpc\_pipe->plane\_state->triplebuffer\_flips;- block\_sequence[\*num\_steps].func = HUBP\_PROGRAM\_TRIPLEBUFFER;- (\*num\_steps)++;- }- if (dc->hwss.update\_plane\_addr && current\_mpc\_pipe->plane\_state->update\_flags.bits.addr\_update) {- if (resource\_is\_pipe\_type(current\_mpc\_pipe, OTG\_MASTER) &&- stream\_status->mall\_stream\_config.type == SUBVP\_MAIN) {- block\_sequence[\*num\_steps].params.subvp\_save\_surf\_addr.dc\_dmub\_srv = dc->ctx->dmub\_srv;- block\_sequence[\*num\_steps].params.subvp\_save\_surf\_addr.addr = &current\_mpc\_pipe->plane\_state->address;- block\_sequence[\*num\_steps].params.subvp\_save\_surf\_addr.subvp\_index = current\_mpc\_pipe->subvp\_index;- block\_sequence[\*num\_steps].func = DMUB\_SUBVP\_SAVE\_SURF\_ADDR;+ if (current\_mpc\_pipe->plane\_state) {+ if (dc->hwss.set\_flip\_control\_gsl && current\_mpc\_pipe->plane\_state->update\_flags.raw) {+ block\_sequence[\*num\_steps].params.set\_flip\_control\_gsl\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].params.set\_flip\_control\_gsl\_params.flip\_immediate = current\_mpc\_pipe->plane\_state->flip\_immediate;+ block\_sequence[\*num\_steps].func = HUBP\_SET\_FLIP\_CONTROL\_GSL;+ (\*num\_steps)++;+ }+ if (dc->hwss.program\_triplebuffer && dc->debug.enable\_tri\_buf && current\_mpc\_pipe->plane\_state->update\_flags.raw) {+ block\_sequence[\*num\_steps].params.program\_triplebuffer\_params.dc = dc;+ block\_sequence[\*num\_steps].params.program\_triplebuffer\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].params.program\_triplebuffer\_params.enableTripleBuffer = current\_mpc\_pipe->plane\_state->triplebuffer\_flips;+ block\_sequence[\*num\_steps].func = HUBP\_PROGRAM\_TRIPLEBUFFER;+ (\*num\_steps)++;+ }+ if (dc->hwss.update\_plane\_addr && current\_mpc\_pipe->plane\_state->update\_flags.bits.addr\_update) {+ if (resource\_is\_pipe\_type(current\_mpc\_pipe, OTG\_MASTER) &&+ stream\_status->mall\_stream\_config.type == SUBVP\_MAIN) {+ block\_sequence[\*num\_steps].params.subvp\_save\_surf\_addr.dc\_dmub\_srv = dc->ctx->dmub\_srv;+ block\_sequence[\*num\_steps].params.subvp\_save\_surf\_addr.addr = &current\_mpc\_pipe->plane\_state->address;+ block\_sequence[\*num\_steps].params.subvp\_save\_surf\_addr.subvp\_index = current\_mpc\_pipe->subvp\_index;+ block\_sequence[\*num\_steps].func = DMUB\_SUBVP\_SAVE\_SURF\_ADDR;+ (\*num\_steps)++;+ }++ block\_sequence[\*num\_steps].params.update\_plane\_addr\_params.dc = dc;+ block\_sequence[\*num\_steps].params.update\_plane\_addr\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].func = HUBP\_UPDATE\_PLANE\_ADDR; (\*num\_steps)++; } - block\_sequence[\*num\_steps].params.update\_plane\_addr\_params.dc = dc;- block\_sequence[\*num\_steps].params.update\_plane\_addr\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].func = HUBP\_UPDATE\_PLANE\_ADDR;- (\*num\_steps)++;- }-- if (hws->funcs.set\_input\_transfer\_func && current\_mpc\_pipe->plane\_state->update\_flags.bits.gamma\_change) {- block\_sequence[\*num\_steps].params.set\_input\_transfer\_func\_params.dc = dc;- block\_sequence[\*num\_steps].params.set\_input\_transfer\_func\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].params.set\_input\_transfer\_func\_params.plane\_state = current\_mpc\_pipe->plane\_state;- block\_sequence[\*num\_steps].func = DPP\_SET\_INPUT\_TRANSFER\_FUNC;- (\*num\_steps)++;- }+ if (hws->funcs.set\_input\_transfer\_func && current\_mpc\_pipe->plane\_state->update\_flags.bits.gamma\_change) {+ block\_sequence[\*num\_steps].params.set\_input\_transfer\_func\_params.dc = dc;+ block\_sequence[\*num\_steps].params.set\_input\_transfer\_func\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].params.set\_input\_transfer\_func\_params.plane\_state = current\_mpc\_pipe->plane\_state;+ block\_sequence[\*num\_steps].func = DPP\_SET\_INPUT\_TRANSFER\_FUNC;+ (\*num\_steps)++;+ } - if (dc->hwss.program\_gamut\_remap && current\_mpc\_pipe->plane\_state->update\_flags.bits.gamut\_remap\_change) {- block\_sequence[\*num\_steps].params.program\_gamut\_remap\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].func = DPP\_PROGRAM\_GAMUT\_REMAP;- (\*num\_steps)++;- }- if (current\_mpc\_pipe->plane\_state->update\_flags.bits.input\_csc\_change) {- block\_sequence[\*num\_steps].params.setup\_dpp\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].func = DPP\_SETUP\_DPP;- (\*num\_steps)++;- }- if (current\_mpc\_pipe->plane\_state->update\_flags.bits.coeff\_reduction\_change) {- block\_sequence[\*num\_steps].params.program\_bias\_and\_scale\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].func = DPP\_PROGRAM\_BIAS\_AND\_SCALE;- (\*num\_steps)++;+ if (dc->hwss.program\_gamut\_remap && current\_mpc\_pipe->plane\_state->update\_flags.bits.gamut\_remap\_change) {+ block\_sequence[\*num\_steps].params.program\_gamut\_remap\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].func = DPP\_PROGRAM\_GAMUT\_REMAP;+ (\*num\_steps)++;+ }+ if (current\_mpc\_pipe->plane\_state->update\_flags.bits.input\_csc\_change) {+ block\_sequence[\*num\_steps].params.setup\_dpp\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].func = DPP\_SETUP\_DPP;+ (\*num\_steps)++;+ }+ if (current\_mpc\_pipe->plane\_state->update\_flags.bits.coeff\_reduction\_change) {+ block\_sequence[\*num\_steps].params.program\_bias\_and\_scale\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].func = DPP\_PROGRAM\_BIAS\_AND\_SCALE;+ (\*num\_steps)++;+ } } if (hws->funcs.set\_output\_transfer\_func && current\_mpc\_pipe->stream->update\_flags.bits.out\_tf) { block\_sequence[\*num\_steps].params.set\_output\_transfer\_func\_params.dc = dc;diff --git a/drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20\_hwseq.c b/drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20\_hwseq.cindex dd652436a53920..bd7b186fb2e469 100644--- a/[drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20_hwseq.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)+++ b/[drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20_hwseq.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4)@@ -2284,6 +2284,9 @@ void dcn20\_post\_unlock\_program\_front\_end( } } + if (!hwseq)+ return;+ /\* P-State support transitions: \* Natural -> FPO: P-State disabled in prepare, force disallow anytime is safe \* FPO -> Natural: Unforce anytime after FW disable is safe (P-State will assert naturally)@@ -2291,7 +2294,7 @@ void dcn20\_post\_unlock\_program\_front\_end( \* FPO -> Unsupported: P-State disabled in prepare, unforce disallow anytime is safe \* FPO <-> SubVP: Force disallow is maintained on the FPO / SubVP pipes \*/- if (hwseq && hwseq->funcs.update\_force\_pstate)+ if (hwseq->funcs.update\_force\_pstate) dc->hwseq->funcs.update\_force\_pstate(dc, context);  /\* Only program the MALL registers after all the main and phantom pipes@@ -2531,6 +2534,9 @@ bool dcn20\_wait\_for\_blank\_complete( { int counter; + if (!opp)+ return false;+ for (counter = 0; counter < 1000; counter++) { if (!opp->funcs->dpg\_is\_pending(opp)) break;diff --git a/drivers/gpu/drm/amd/display/dc/link/accessories/link\_dp\_cts.c b/drivers/gpu/drm/amd/display/dc/link/accessories/link\_dp\_cts.cindex 555c1c484cfddc..df3781081da7ae 100644--- a/[drivers/gpu/drm/amd/display/dc/link/accessories/link\_dp\_cts.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/accessories/link_dp_cts.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)+++ b/[drivers/gpu/drm/amd/display/dc/link/accessories/link\_dp\_cts.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/accessories/link_dp_cts.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4)@@ -804,8 +804,11 @@ bool dp\_set\_test\_pattern( break; } + if (!pipe\_ctx->stream)+ return false;+ if (pipe\_ctx->stream\_res.tg->funcs->lock\_doublebuffer\_enable) {- if (pipe\_ctx->stream && should\_use\_dmub\_lock(pipe\_ctx->stream->link)) {+ if (should\_use\_dmub\_lock(pipe\_ctx->stream->link)) { union dmub\_hw\_lock\_flags hw\_locks = { 0 }; struct dmub\_hw\_lock\_inst\_flags inst\_flags = { 0 }; diff --git a/drivers/gpu/drm/amd/display/dc/link/hwss/link\_hwss\_dio.c b/drivers/gpu/drm/amd/display/dc/link/hwss/link\_hwss\_dio.cindex b76737b7b9e41b..3e47a6735912a5 100644--- a/[drivers/gpu/drm/amd/display/dc/link/hwss/link\_hwss\_dio.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/hwss/link_hwss_dio.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)+++ b/[drivers/gpu/drm/amd/display/dc/link/hwss/link\_hwss\_dio.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/hwss/link_hwss_dio.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4)@@ -74,7 +74,10 @@ void reset\_dio\_stream\_encoder(struct pipe\_ctx \*pipe\_ctx) struct link\_encoder \*link\_enc = link\_enc\_cfg\_get\_link\_enc(pipe\_ctx->stream->link); struct stream\_encoder \*stream\_enc = pipe\_ctx->stream\_res.stream\_enc; - if (stream\_enc && stream\_enc->funcs->disable\_fifo)+ if (!stream\_enc)+ return;++ if (stream\_enc->funcs->disable\_fifo) stream\_enc->funcs->disable\_fifo(stream\_enc); if (stream\_enc->funcs->set\_input\_mode) stream\_enc->funcs->set\_input\_mode(stream\_enc, 0);diff --git a/drivers/gpu/drm/amd/display/dc/resource/dce112/dce112\_resource.c b/drivers/gpu/drm/amd/display/dc/resource/dce112/dce112\_resource.cindex 88afb2a30eef50..162856c523e40c 100644--- a/[drivers/gpu/drm/amd/display/dc/resource/dce112/dce112\_resource.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/resource/dce112/dce112_resource.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)+++ b/[drivers/gpu/drm/amd/display/dc/resource/dce112/dce112\_resource.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/resource/dce112/dce112_resource.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4)@@ -1067,7 +1067,10 @@ static void bw\_calcs\_data\_update\_from\_pplib(struct dc \*dc) struct dm\_pp\_clock\_levels clks = {0}; int memory\_type\_multiplier = MEMORY\_TYPE\_MULTIPLIER\_CZ; - if (dc->bw\_vbios && dc->bw\_vbios->memory\_type == bw\_def\_hbm)+ if (!dc->bw\_vbios)+ return;++ if (dc->bw\_vbios->memory\_type == bw\_def\_hbm) memory\_type\_multiplier = MEMORY\_TYPE\_HBM;  /\*do system clock TODO PPLIB: after PPLIB implement,diff --git a/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource.c b/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource.cindex ee009716d39b1f..6eaf3cfebcb7f7 100644--- a/[drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32_resource.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)+++ b/[drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32_resource.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4)@@ -1651,6 +1651,9 @@ static void dcn32\_enable\_phantom\_plane(struct dc \*dc, else phantom\_plane = dc\_state\_create\_phantom\_plane(dc, context, curr\_pipe->plane\_state); + if (!phantom\_plane)+ continue;+ memcpy(&phantom\_plane->address, &curr\_pipe->plane\_state->address, sizeof(phantom\_plane->address)); memcpy(&phantom\_plane->scaling\_quality, &curr\_pipe->plane\_state->scaling\_quality, sizeof(phantom\_plane->scaling\_quality));diff --git a/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource\_helpers.c b/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource\_helpers.cindex d184105ce2b3e6..47c8a9fbe75467 100644--- a/[drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource\_helpers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32_resource_helpers.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)+++ b/[drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource\_helpers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32_resource_helpers.c?id=fdd5ecbbff751c3b9061d8ebb08e5c96119915b4)@@ -218,12 +218,12 @@ bool dcn32\_is\_center\_timing(struct pipe\_ctx \*pipe) pipe->stream->timing.v\_addressable != pipe->stream->src.height) { is\_center\_timing = true; }- } - if (pipe->plane\_state) {- if (pipe->stream->timing.v\_addressable != pipe->plane\_state->dst\_rect.height &&- pipe->stream->timing.v\_addressable != pipe->plane\_state->src\_rect.height) {- is\_center\_timing = true;+ if (pipe->plane\_state) {+ if (pipe->stream->timing.v\_addressable != pipe->plane\_state->dst\_rect.height &&+ pipe->stream->timing.v\_addressable != pipe->plane\_state->src\_rect.height) {+ is\_center\_timing = true;+ } } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:03:59 +0000



=== Content from git.kernel.org_236950a8_20250111_120521.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alex Hung <alex.hung@amd.com> | 2024-06-25 10:37:35 -0600 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 12:03:24 +0200 |
| commit | [26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27)) | |
| tree | [4e1052b8bd92f96a33f9aeb8956bd041dd0c9582](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27) | |
| parent | [5b35bf1a82eb29841b67ff5643ba83762250fc24](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5b35bf1a82eb29841b67ff5643ba83762250fc24) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27&id2=5b35bf1a82eb29841b67ff5643ba83762250fc24)) | |
| download | [linux-26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27.tar.gz) | |

drm/amd/display: Check null pointers before multiple uses[ Upstream commit fdd5ecbbff751c3b9061d8ebb08e5c96119915b4 ]
[WHAT & HOW]
Poniters, such as stream\_enc and dc->bw\_vbios, are null checked previously
in the same function, so Coverity warns "implies that stream\_enc and
dc->bw\_vbios might be null". They are used multiple times in the
subsequent code and need to be checked.
This fixes 10 FORWARD\_NULL issues reported by Coverity.
Reviewed-by: Rodrigo Siqueira <rodrigo.siqueira@amd.com>
Signed-off-by: Jerry Zuo <jerry.zuo@amd.com>
Signed-off-by: Alex Hung <alex.hung@amd.com>
Tested-by: Daniel Wheeler <daniel.wheeler@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27)

| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/core/dc\_hw\_sequencer.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27) | 96 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20_hwseq.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27) | 8 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/link/accessories/link\_dp\_cts.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/link/accessories/link_dp_cts.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/link/hwss/link\_hwss\_dio.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/link/hwss/link_hwss_dio.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/resource/dce112/dce112\_resource.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/resource/dce112/dce112_resource.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32_resource.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource\_helpers.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32_resource_helpers.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27) | 10 | |  |  |  | | --- | --- | --- | |

7 files changed, 76 insertions, 56 deletions

| diff --git a/drivers/gpu/drm/amd/display/dc/core/dc\_hw\_sequencer.c b/drivers/gpu/drm/amd/display/dc/core/dc\_hw\_sequencer.cindex 87e36d51c56d80..4a88412fdfab13 100644--- a/[drivers/gpu/drm/amd/display/dc/core/dc\_hw\_sequencer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c?id=5b35bf1a82eb29841b67ff5643ba83762250fc24)+++ b/[drivers/gpu/drm/amd/display/dc/core/dc\_hw\_sequencer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27)@@ -636,57 +636,59 @@ void hwss\_build\_fast\_sequence(struct dc \*dc, while (current\_pipe) { current\_mpc\_pipe = current\_pipe; while (current\_mpc\_pipe) {- if (dc->hwss.set\_flip\_control\_gsl && current\_mpc\_pipe->plane\_state && current\_mpc\_pipe->plane\_state->update\_flags.raw) {- block\_sequence[\*num\_steps].params.set\_flip\_control\_gsl\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].params.set\_flip\_control\_gsl\_params.flip\_immediate = current\_mpc\_pipe->plane\_state->flip\_immediate;- block\_sequence[\*num\_steps].func = HUBP\_SET\_FLIP\_CONTROL\_GSL;- (\*num\_steps)++;- }- if (dc->hwss.program\_triplebuffer && dc->debug.enable\_tri\_buf && current\_mpc\_pipe->plane\_state->update\_flags.raw) {- block\_sequence[\*num\_steps].params.program\_triplebuffer\_params.dc = dc;- block\_sequence[\*num\_steps].params.program\_triplebuffer\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].params.program\_triplebuffer\_params.enableTripleBuffer = current\_mpc\_pipe->plane\_state->triplebuffer\_flips;- block\_sequence[\*num\_steps].func = HUBP\_PROGRAM\_TRIPLEBUFFER;- (\*num\_steps)++;- }- if (dc->hwss.update\_plane\_addr && current\_mpc\_pipe->plane\_state->update\_flags.bits.addr\_update) {- if (resource\_is\_pipe\_type(current\_mpc\_pipe, OTG\_MASTER) &&- stream\_status->mall\_stream\_config.type == SUBVP\_MAIN) {- block\_sequence[\*num\_steps].params.subvp\_save\_surf\_addr.dc\_dmub\_srv = dc->ctx->dmub\_srv;- block\_sequence[\*num\_steps].params.subvp\_save\_surf\_addr.addr = &current\_mpc\_pipe->plane\_state->address;- block\_sequence[\*num\_steps].params.subvp\_save\_surf\_addr.subvp\_index = current\_mpc\_pipe->subvp\_index;- block\_sequence[\*num\_steps].func = DMUB\_SUBVP\_SAVE\_SURF\_ADDR;+ if (current\_mpc\_pipe->plane\_state) {+ if (dc->hwss.set\_flip\_control\_gsl && current\_mpc\_pipe->plane\_state->update\_flags.raw) {+ block\_sequence[\*num\_steps].params.set\_flip\_control\_gsl\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].params.set\_flip\_control\_gsl\_params.flip\_immediate = current\_mpc\_pipe->plane\_state->flip\_immediate;+ block\_sequence[\*num\_steps].func = HUBP\_SET\_FLIP\_CONTROL\_GSL;+ (\*num\_steps)++;+ }+ if (dc->hwss.program\_triplebuffer && dc->debug.enable\_tri\_buf && current\_mpc\_pipe->plane\_state->update\_flags.raw) {+ block\_sequence[\*num\_steps].params.program\_triplebuffer\_params.dc = dc;+ block\_sequence[\*num\_steps].params.program\_triplebuffer\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].params.program\_triplebuffer\_params.enableTripleBuffer = current\_mpc\_pipe->plane\_state->triplebuffer\_flips;+ block\_sequence[\*num\_steps].func = HUBP\_PROGRAM\_TRIPLEBUFFER;+ (\*num\_steps)++;+ }+ if (dc->hwss.update\_plane\_addr && current\_mpc\_pipe->plane\_state->update\_flags.bits.addr\_update) {+ if (resource\_is\_pipe\_type(current\_mpc\_pipe, OTG\_MASTER) &&+ stream\_status->mall\_stream\_config.type == SUBVP\_MAIN) {+ block\_sequence[\*num\_steps].params.subvp\_save\_surf\_addr.dc\_dmub\_srv = dc->ctx->dmub\_srv;+ block\_sequence[\*num\_steps].params.subvp\_save\_surf\_addr.addr = &current\_mpc\_pipe->plane\_state->address;+ block\_sequence[\*num\_steps].params.subvp\_save\_surf\_addr.subvp\_index = current\_mpc\_pipe->subvp\_index;+ block\_sequence[\*num\_steps].func = DMUB\_SUBVP\_SAVE\_SURF\_ADDR;+ (\*num\_steps)++;+ }++ block\_sequence[\*num\_steps].params.update\_plane\_addr\_params.dc = dc;+ block\_sequence[\*num\_steps].params.update\_plane\_addr\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].func = HUBP\_UPDATE\_PLANE\_ADDR; (\*num\_steps)++; } - block\_sequence[\*num\_steps].params.update\_plane\_addr\_params.dc = dc;- block\_sequence[\*num\_steps].params.update\_plane\_addr\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].func = HUBP\_UPDATE\_PLANE\_ADDR;- (\*num\_steps)++;- }-- if (hws->funcs.set\_input\_transfer\_func && current\_mpc\_pipe->plane\_state->update\_flags.bits.gamma\_change) {- block\_sequence[\*num\_steps].params.set\_input\_transfer\_func\_params.dc = dc;- block\_sequence[\*num\_steps].params.set\_input\_transfer\_func\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].params.set\_input\_transfer\_func\_params.plane\_state = current\_mpc\_pipe->plane\_state;- block\_sequence[\*num\_steps].func = DPP\_SET\_INPUT\_TRANSFER\_FUNC;- (\*num\_steps)++;- }+ if (hws->funcs.set\_input\_transfer\_func && current\_mpc\_pipe->plane\_state->update\_flags.bits.gamma\_change) {+ block\_sequence[\*num\_steps].params.set\_input\_transfer\_func\_params.dc = dc;+ block\_sequence[\*num\_steps].params.set\_input\_transfer\_func\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].params.set\_input\_transfer\_func\_params.plane\_state = current\_mpc\_pipe->plane\_state;+ block\_sequence[\*num\_steps].func = DPP\_SET\_INPUT\_TRANSFER\_FUNC;+ (\*num\_steps)++;+ } - if (dc->hwss.program\_gamut\_remap && current\_mpc\_pipe->plane\_state->update\_flags.bits.gamut\_remap\_change) {- block\_sequence[\*num\_steps].params.program\_gamut\_remap\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].func = DPP\_PROGRAM\_GAMUT\_REMAP;- (\*num\_steps)++;- }- if (current\_mpc\_pipe->plane\_state->update\_flags.bits.input\_csc\_change) {- block\_sequence[\*num\_steps].params.setup\_dpp\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].func = DPP\_SETUP\_DPP;- (\*num\_steps)++;- }- if (current\_mpc\_pipe->plane\_state->update\_flags.bits.coeff\_reduction\_change) {- block\_sequence[\*num\_steps].params.program\_bias\_and\_scale\_params.pipe\_ctx = current\_mpc\_pipe;- block\_sequence[\*num\_steps].func = DPP\_PROGRAM\_BIAS\_AND\_SCALE;- (\*num\_steps)++;+ if (dc->hwss.program\_gamut\_remap && current\_mpc\_pipe->plane\_state->update\_flags.bits.gamut\_remap\_change) {+ block\_sequence[\*num\_steps].params.program\_gamut\_remap\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].func = DPP\_PROGRAM\_GAMUT\_REMAP;+ (\*num\_steps)++;+ }+ if (current\_mpc\_pipe->plane\_state->update\_flags.bits.input\_csc\_change) {+ block\_sequence[\*num\_steps].params.setup\_dpp\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].func = DPP\_SETUP\_DPP;+ (\*num\_steps)++;+ }+ if (current\_mpc\_pipe->plane\_state->update\_flags.bits.coeff\_reduction\_change) {+ block\_sequence[\*num\_steps].params.program\_bias\_and\_scale\_params.pipe\_ctx = current\_mpc\_pipe;+ block\_sequence[\*num\_steps].func = DPP\_PROGRAM\_BIAS\_AND\_SCALE;+ (\*num\_steps)++;+ } } if (hws->funcs.set\_output\_transfer\_func && current\_mpc\_pipe->stream->update\_flags.bits.out\_tf) { block\_sequence[\*num\_steps].params.set\_output\_transfer\_func\_params.dc = dc;diff --git a/drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20\_hwseq.c b/drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20\_hwseq.cindex 2532ad410cb566..456e19e0d415c1 100644--- a/[drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20_hwseq.c?id=5b35bf1a82eb29841b67ff5643ba83762250fc24)+++ b/[drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn20/dcn20_hwseq.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27)@@ -2283,6 +2283,9 @@ void dcn20\_post\_unlock\_program\_front\_end( } } + if (!hwseq)+ return;+ /\* P-State support transitions: \* Natural -> FPO: P-State disabled in prepare, force disallow anytime is safe \* FPO -> Natural: Unforce anytime after FW disable is safe (P-State will assert naturally)@@ -2290,7 +2293,7 @@ void dcn20\_post\_unlock\_program\_front\_end( \* FPO -> Unsupported: P-State disabled in prepare, unforce disallow anytime is safe \* FPO <-> SubVP: Force disallow is maintained on the FPO / SubVP pipes \*/- if (hwseq && hwseq->funcs.update\_force\_pstate)+ if (hwseq->funcs.update\_force\_pstate) dc->hwseq->funcs.update\_force\_pstate(dc, context);  /\* Only program the MALL registers after all the main and phantom pipes@@ -2529,6 +2532,9 @@ bool dcn20\_wait\_for\_blank\_complete( { int counter; + if (!opp)+ return false;+ for (counter = 0; counter < 1000; counter++) { if (!opp->funcs->dpg\_is\_pending(opp)) break;diff --git a/drivers/gpu/drm/amd/display/dc/link/accessories/link\_dp\_cts.c b/drivers/gpu/drm/amd/display/dc/link/accessories/link\_dp\_cts.cindex 555c1c484cfddc..df3781081da7ae 100644--- a/[drivers/gpu/drm/amd/display/dc/link/accessories/link\_dp\_cts.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/accessories/link_dp_cts.c?id=5b35bf1a82eb29841b67ff5643ba83762250fc24)+++ b/[drivers/gpu/drm/amd/display/dc/link/accessories/link\_dp\_cts.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/accessories/link_dp_cts.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27)@@ -804,8 +804,11 @@ bool dp\_set\_test\_pattern( break; } + if (!pipe\_ctx->stream)+ return false;+ if (pipe\_ctx->stream\_res.tg->funcs->lock\_doublebuffer\_enable) {- if (pipe\_ctx->stream && should\_use\_dmub\_lock(pipe\_ctx->stream->link)) {+ if (should\_use\_dmub\_lock(pipe\_ctx->stream->link)) { union dmub\_hw\_lock\_flags hw\_locks = { 0 }; struct dmub\_hw\_lock\_inst\_flags inst\_flags = { 0 }; diff --git a/drivers/gpu/drm/amd/display/dc/link/hwss/link\_hwss\_dio.c b/drivers/gpu/drm/amd/display/dc/link/hwss/link\_hwss\_dio.cindex b76737b7b9e41b..3e47a6735912a5 100644--- a/[drivers/gpu/drm/amd/display/dc/link/hwss/link\_hwss\_dio.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/hwss/link_hwss_dio.c?id=5b35bf1a82eb29841b67ff5643ba83762250fc24)+++ b/[drivers/gpu/drm/amd/display/dc/link/hwss/link\_hwss\_dio.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/hwss/link_hwss_dio.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27)@@ -74,7 +74,10 @@ void reset\_dio\_stream\_encoder(struct pipe\_ctx \*pipe\_ctx) struct link\_encoder \*link\_enc = link\_enc\_cfg\_get\_link\_enc(pipe\_ctx->stream->link); struct stream\_encoder \*stream\_enc = pipe\_ctx->stream\_res.stream\_enc; - if (stream\_enc && stream\_enc->funcs->disable\_fifo)+ if (!stream\_enc)+ return;++ if (stream\_enc->funcs->disable\_fifo) stream\_enc->funcs->disable\_fifo(stream\_enc); if (stream\_enc->funcs->set\_input\_mode) stream\_enc->funcs->set\_input\_mode(stream\_enc, 0);diff --git a/drivers/gpu/drm/amd/display/dc/resource/dce112/dce112\_resource.c b/drivers/gpu/drm/amd/display/dc/resource/dce112/dce112\_resource.cindex 88afb2a30eef50..162856c523e40c 100644--- a/[drivers/gpu/drm/amd/display/dc/resource/dce112/dce112\_resource.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/resource/dce112/dce112_resource.c?id=5b35bf1a82eb29841b67ff5643ba83762250fc24)+++ b/[drivers/gpu/drm/amd/display/dc/resource/dce112/dce112\_resource.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/resource/dce112/dce112_resource.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27)@@ -1067,7 +1067,10 @@ static void bw\_calcs\_data\_update\_from\_pplib(struct dc \*dc) struct dm\_pp\_clock\_levels clks = {0}; int memory\_type\_multiplier = MEMORY\_TYPE\_MULTIPLIER\_CZ; - if (dc->bw\_vbios && dc->bw\_vbios->memory\_type == bw\_def\_hbm)+ if (!dc->bw\_vbios)+ return;++ if (dc->bw\_vbios->memory\_type == bw\_def\_hbm) memory\_type\_multiplier = MEMORY\_TYPE\_HBM;  /\*do system clock TODO PPLIB: after PPLIB implement,diff --git a/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource.c b/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource.cindex 969658313fd65a..a43ffa53890af0 100644--- a/[drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32_resource.c?id=5b35bf1a82eb29841b67ff5643ba83762250fc24)+++ b/[drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32_resource.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27)@@ -1651,6 +1651,9 @@ static void dcn32\_enable\_phantom\_plane(struct dc \*dc, else phantom\_plane = dc\_state\_create\_phantom\_plane(dc, context, curr\_pipe->plane\_state); + if (!phantom\_plane)+ continue;+ memcpy(&phantom\_plane->address, &curr\_pipe->plane\_state->address, sizeof(phantom\_plane->address)); memcpy(&phantom\_plane->scaling\_quality, &curr\_pipe->plane\_state->scaling\_quality, sizeof(phantom\_plane->scaling\_quality));diff --git a/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource\_helpers.c b/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource\_helpers.cindex d184105ce2b3e6..47c8a9fbe75467 100644--- a/[drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource\_helpers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32_resource_helpers.c?id=5b35bf1a82eb29841b67ff5643ba83762250fc24)+++ b/[drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32\_resource\_helpers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/resource/dcn32/dcn32_resource_helpers.c?id=26787fb6c2b2ee0d1a7e1574b36f4711ae40fe27)@@ -218,12 +218,12 @@ bool dcn32\_is\_center\_timing(struct pipe\_ctx \*pipe) pipe->stream->timing.v\_addressable != pipe->stream->src.height) { is\_center\_timing = true; }- } - if (pipe->plane\_state) {- if (pipe->stream->timing.v\_addressable != pipe->plane\_state->dst\_rect.height &&- pipe->stream->timing.v\_addressable != pipe->plane\_state->src\_rect.height) {- is\_center\_timing = true;+ if (pipe->plane\_state) {+ if (pipe->stream->timing.v\_addressable != pipe->plane\_state->dst\_rect.height &&+ pipe->stream->timing.v\_addressable != pipe->plane\_state->src\_rect.height) {+ is\_center\_timing = true;+ } } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:03:58 +0000


