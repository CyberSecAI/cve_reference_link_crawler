<!DOCTYPE html>
<html lang="en-US" data-themeable="true">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="csrf-token" content="WLldjeIF-FuFYwZ7pkAPoqUO_Ej6J-9HUVAI">
    
    
    <meta name="description" content="DIR-825">
    
    <title>D-LINK DIR-815 Device Vulnerability POC - HackMD</title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
	<link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">
	<!--  meta value for server side given sign in boolean -->
    <meta name="signin" content="false">

    
<script nonce="69788942-7bdf-4500-89b7-93eecf13f72b">
  window.domain = 'hackmd.io'
  window.urlpath = ''
  window.debug = false || window.localStorage.getItem('HMD_DEBUG_FLAG') === 'true'
  window.version = '1.3.0'
  window.brand = 'HackMD'

  
  window.NOTE_ID = 'RyMJsoIfQqWfojX4R2CYhw'
  

  window.GOOGLE_DRIVE_API_KEY = 'AIzaSyAHmcP5gL_64ZafuAYOvJruFAIaYgHQaY4'
  window.GOOGLE_DRIVE_CLIENT_ID = '65857506266-76uhhee8se8dgs1i0q8fhtj1prg0ar27.apps.googleusercontent.com'
  window.DROPBOX_APP_KEY = 'rdoizrlnkuha23r'
  
  window.PLANTUML_SERVER = 'https://ptuml.hackmd.io'

  window.ASSET_URL = 'https://assets.hackmd.io'

  window.USER_CAN_CREATE_TEAM = true
  window.USER_CAN_DELETE_ACCOUNT = true
  window.USER_DELETE_ACCOUNT_VIA_EMAIL = true
  window.PAYMENT_ENABLED = true
  window.PAYMENT_PROMOTION_BANNER_ENABLED = false
  window.GITHUB_SYNC_ENABLED = true
  window.GITLAB_SYNC_ENABLED = false
  window.GITLAB_SYNC_BASE_URL = ''
  window.VCS_SYNC_MODE = 'github'
  window.VCS_PROVIDER_NAME = 'GitHub'
  window.FREE_TEAM_NUM = 20
  window.FREE_TEAM_MEMBER_NUM = 3
  window.FREE_PUBLIC_TEAM_NUM = 10
  window.NEO_OVERVIEW_UI = true
  window.FOLDER_ENABLE = true
  
  window.EE_SITE_ENABLE = false
  window.EE_SITE_NAME = 'false'
  window.EE_SITE_LINK = 'false'
  window.EESITE_INFO = false
  window.ENTERPRISE_DISCOVERY_ENABLE = false
  window.ENTERPRISE_DISCOVERY_TEAM = true
  window.ENTERPRISE_DISCOVERY_NOTE = true
  window.ENTERPRISE_DISCOVERY_VIEW_PERMISSION = 'guest'
  
  window.ALLOW_ANONYMOUS = true
  window.ALLOW_ANONYMOUS_EDIT = false
  window.ALLOW_DOWNLOAD_PDF = true
  window.PUBLIC_OVERVIEW = false
  window.INTERNAL_PUBLIC_OVERVIEW = false
  window.FULL_TEXT_SEARCH_ENABLE = false
  window.ALGOLIA_SEARCH_ENABLE = true
  window.MARKETING_EMAIL_ENABLE = true
  window.OFFLINE_ACCESS = true
  
  
  
    window.WALLET_CONNECT_PROJECT_ID = '91d6fa182b725b5895a17a170a5878c1'
  
  window.API_MANAGEMENT_UI_ENABLE = true
  window.FEEDBACK_UI_ENABLE = true
  window.PUBLISH_ENABLE = true

  

  
  window.SHOW_HOT_NOTES = false
  

  
  window.HOT_NOTES_TIME_TYPE = 'week'
  

  
  window.SHOW_OVERVIEW = false
  

  
  window.MENTIONS = {}
  

  
  window.MENTION_ANCHORS = []
  

  
  window.COMMENT_ANCHORS = []
  

  
  window.IS_OWNER = false
  

  
  window.IS_TEAM_ADMIN = false
  

  
  window.IS_INVITEE_ADMIN = false
  

  
  window.USER_PROFILE = '%7B%22name%22%3A%22Guest%20Miles%22%7D'
  

  
  window.VERSION_TIME = '1690363874702'
  

  
  window.canEdit = false
  

  
  window.canWriteComment = false
  

  
  window.canHideComment = false
  

  window.TRASH_NOTE_DELETE_AFTER_FREE = 3
  window.TRASH_NOTE_DELETE_AFTER_PAID = 30

  
    window.ENABLED_PREVIEW_FEATURE = {}
  

  
    window.IS_OWNER_UPGRADED = false
  

  
    window.IMGUR_FALLBACK_CDN = 'https://imgur-backup.hackmd.io'
  

  
    window.CLOUD_META_UI = true
  
  
    window.CLOUD_META_API = true
  
  
    window.CLOUD_META_MIGRATION = false
  
  
    window.YAML_METADATA_ENABLED = false
  

  
    window.NOTE_CAPACITY_LIMIT = 50
  

  
    window.DOCUMENT_MAX_LENGTH = 100000
  

  
    window.SOCIAL_NETWORK_FEATURES_ENABLED = true
  

  
    window.PUBLISHMENT_MODERATION_ENABLED = true
  

  
    window.COMMENT_ENABLED = false
  

  window.SUGGEST_EDIT_ENABLED = true
  
    window.SUGGEST_EDIT_ENABLED = true
  

  
    window.REALTIME_CLIENT_WITH_CREDENTIALS = false
  

  
    window.COMMENT_ENABLED = false
  

  
    window.DEBUG_DISCONNECT_SOCKET_WHEN_OFFLINE = false
  

  

  

  

  
    window.CUSTOM_STYLE_ENABLED = "true"
  

  
    window.USE_NEW_LOGO = true
  

  
    window.ITERABLE_ENABLED = true
  
  
    window.ITERABLE_API_KEY = "c2c36a44c2614fb19aa3b46d660bbce2"
  

  
    window.TEXT_SELECTION_CHANGED = false
  

  
    window.CAN_VIEW_HISTORY_AT_REVISION = false
  
</script>


    
<!-- Google Tag Manager -->
<script nonce="69788942-7bdf-4500-89b7-93eecf13f72b">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KLW9Z3');</script>
<!-- End Google Tag Manager -->


    





    <meta property="fb:app_id" content="1436904003272070">



    <meta name="twitter:image:src" content="https://hackmd.io/images/media/HackMD-neo-og.jpg">
    <meta name="twitter:image:alt" content="D-LINK DIR-815 Device Vulnerability POC - HackMD">


<meta name="twitter:site" content="@hackmdio" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="D-LINK DIR-815 Device Vulnerability POC - HackMD" />


    <meta name="twitter:description" content="DIR-825" />



    <meta property="og:image" content="https://hackmd.io/images/media/HackMD-neo-og.jpg">
    <meta property="og:image:alt" content="D-LINK DIR-815 Device Vulnerability POC - HackMD">


<meta property="og:site_name" content="HackMD" />
<meta property="og:type" content="article" />
<meta property="og:title" content="D-LINK DIR-815 Device Vulnerability POC - HackMD" />


    <meta property="og:description" content="DIR-825" />




     <link href="https://assets.hackmd.io/build/font-vendor.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/font-vendor.ea8218d7d4f468b2c430.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/common-vendor.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/common-vendor.0a08ae20e14fefe857eb.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/pretty-vendor.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/pretty-vendor.db0e7b64c54d0a77290f.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/pretty.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/pretty.206c1db4aa617ea5aa67.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
<![endif]-->

    


    <script defer data-domain="hackmd.io" src="https://plausible.io/js/script.js"></script>
<script nonce="69788942-7bdf-4500-89b7-93eecf13f72b">
  window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments); }
  const keyboardWhiteList = ['a', 'span', 'button']

  function getTaggedEventAttributes (e) {
    const eventAttrs = { name: null, props: {} }
    if (!e || !e.classList) return eventAttrs
    const psEvent = /plausible-event-(.+)(=|--)(.+)/
    for (const className of [...e.classList]) {
      const [, key, , val] = className.match(psEvent) || []
      if (!key || !val) continue
      const value = val.replace(/\+/g, ' ')
      switch (key.toLowerCase()) {
        case 'name':
          eventAttrs.name = value
          break
        default:
          eventAttrs.props[key] = value
          break
      }
    }
    return eventAttrs
  }

  function isLocal () {
    return /^localhost$|^127(\.[0-9]+){0,2}\.[0-9]+$|^\[::1?\]$/.test(location.hostname) || location.protocol === 'file:'
  }

  function isAutomation () {
    return Boolean(window._phantom || window.__nightmare || window.navigator.webdriver || window.Cypress)
  }

  function shouldIgnore () {
    return isLocal() ||
      isAutomation() ||
      window.localStorage.getItem('plausible_ignore') === 'true'
  }

  function handler (e) {
    if (!window.plausible) return
    if (!e.target || !('className' in e.target)) return
    const ele = e.target

    const eventAttrs = getTaggedEventAttributes(ele)
    if (!eventAttrs.name) return
    if (ele?.href) eventAttrs.props.url = ele.href

    if (shouldIgnore()) {
      if (window.debug) logDebugEventMsg(eventAttrs)
      return
    }
    window.plausible(eventAttrs.name, { props: eventAttrs.props })
  }

  function logDebugEventMsg (eventAttrs) {
    console.warn(
      `Ignoring Event: "${eventAttrs.name}"`,
      eventAttrs,
    )
  }

  function keydownHandler (e) {
    if (e.key !== 'Enter') return
    if (e.target.nodeName.toLowerCase() === 'input') {
      switch (e.target.type.toLowerCase()) {
        case 'submit':
        case 'button':
        case 'reset':
        case 'checkbox':
        case 'radio':
        case 'file':
        case 'image':
        case 'color':
          break
        default:
          return
      }
    } else if (!keyboardWhiteList.includes(e.target.nodeName.toLowerCase())) {
      return
    }
    handler(e)
  }

  document.addEventListener('mousedown', handler)
  document.addEventListener('keydown', keydownHandler)
</script>

    
<script nonce="69788942-7bdf-4500-89b7-93eecf13f72b">
  window.publishProps = JSON.parse(`{"isOwnerAnonymous":false,"isOwnedByTeam":false,"ownerInfo":{"name":"Jian-Xian","path":"pSgS7xsnS5a4K7Y0yiB43g","avatarUrl":"https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F56055577%3Fs%3D96","description":null},"isPublished":false,"createTime":1688124236527,"updateTime":1690363874702,"vcsSyncMode":"github","vcsProviderName":"GitHub","canEdit":false,"hardBreaks":true,"onlyOwnerCanEdit":true,"isCommentEnabled":false,"likedCount":0,"isNotificationEnabled":true,"notificationType":"never","hasEmail":false,"canWriteComment":false,"viewCount":7201,"markdown":"%0A%23%23%23%20%5BProduct%5D%EF%BC%9AD-LINK%20DIR-815%0A%23%23%23%20%5BFirmware%20Version%5D%EF%BC%9A1.01%0A%23%23%23%20%5BVulnerability%20Type%5D%EF%BC%9Abuffer%20overflow%0A%23%23%23%20%5BVulnerability%20Summary%5D%3A%0AThe%20software%20component%20%2Fhtdocs%2Fweb%2Fcaptcha.cgi%20suffers%20from%20a%20buffer%20overflow%20vulnerability%20due%20to%20an%20unsafe%20implementation%20of%20the%20strncpy()%20function.%20When%20a%20user-supplied%20input%20string%20(a2)%20that%20is%20exactly%2064%20characters%20long%20(or%20longer)%20without%20a%20NULL%20termination%20character%20is%20provided%2C%20the%20strncpy(a1%20%2B%208%2C%20a2%2C%200x40u)%3B%20operation%20fails%20to%20append%20a%20NULL%20character%20at%20the%20end%20of%20the%20copied%20string.%20This%20oversight%20leads%20to%20a%20potential%20buffer%20overflow%20condition.%0A%23%23%23%20%5BDiscoverer%5D%EF%BC%9A%0AJian-Xian%20Li%2C%20Yen-Jen%20Lin%2C%20Hung-Min%20Sun%20%2F%20Laboratory%20of%20Information%20Security%2C%20National%20Tsing%20Hua%20University%0A%23%23%23%20%5BCrash%20Result%5D%EF%BC%9A%0A!%5B%5D(https%3A%2F%2Fhackmd.io%2F_uploads%2FSJGQI6Nvn.png)%0A%0A!%5B%5D(https%3A%2F%2Fhackmd.io%2F_uploads%2Frys-pNlth.png)%0A%0A---%0A%3C!--%20Normal%20Execution%20Result%EF%BC%9A%0A!%5B%5D(https%3A%2F%2Fhackmd.io%2F_uploads%2FHyjMpVlF3.png)%0ACrash%20Execution%20Result%EF%BC%9A%0A!%5B%5D(https%3A%2F%2Fhackmd.io%2F_uploads%2FSJb4pNlY3.png)%20--%3E%0A%0A%0A%0A%0A%0A%23%23%23%20%5BVulnerbility%20Detail%5D%3A%0AFunction_name%20(Problematic%20Code)%0A-%20main%20(v8%20%3D%20(int%20(*)())%26captchacgi_main%3B)%0A%60%60%60%3Dc%0Aint%20__cdecl%20main(int%20argc%2C%20const%20char%20**argv%2C%20const%20char%20**envp)%0A%7B%0A%20%20const%20char%20*v3%3B%20%2F%2F%20%24s0%0A%20%20char%20*v6%3B%20%2F%2F%20%24v0%0A%20%20int%20(*v8)()%3B%20%2F%2F%20%24t9%0A%20%20int%20v9%3B%20%2F%2F%20%24a0%0A%0A%20%20v3%20%3D%20*argv%3B%0A%20%20v6%20%3D%20strrchr(*argv%2C%2047)%3B%0A%20%20if%20(%20v6%20)%0A%20%20%20%20v3%20%3D%20v6%20%2B%201%3B%0A%20%20if%20(%20!strcmp(v3%2C%20%22phpcgi%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20phpcgi_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(int%2C%20const%20char%20**%2C%20const%20char%20**))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22dlcfg.cgi%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20dlcfg_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(int%2C%20const%20char%20**%2C%20const%20char%20**))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22seama.cgi%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20seamacgi_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(_DWORD%2C%20_DWORD%2C%20_DWORD))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22fwup.cgi%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20fwup_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(_DWORD%2C%20_DWORD%2C%20_DWORD))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22fwupdater%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20(int%20(*)())fwupdater_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(_DWORD%2C%20_DWORD%2C%20_DWORD))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22session.cgi%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20(int%20(*)())%26sessioncgi_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(_DWORD%2C%20_DWORD%2C%20_DWORD))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22captcha.cgi%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20(int%20(*)())%26captchacgi_main%3B%20%2F%2FExecute%20captcha.cgi%2C%20enter%20the%20corresponding%20function.%0A%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(_DWORD%2C%20_DWORD%2C%20_DWORD))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22hedwig.cgi%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20hedwigcgi_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(_DWORD%2C%20_DWORD%2C%20_DWORD))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22pigwidgeon.cgi%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20(int%20(*)())%26pigwidgeoncgi_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(_DWORD%2C%20_DWORD%2C%20_DWORD))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22service.cgi%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20(int%20(*)())%26servicecgi_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(_DWORD%2C%20_DWORD%2C%20_DWORD))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22ssdpcgi%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20ssdpcgi_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(_DWORD%2C%20_DWORD%2C%20_DWORD))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22soap.cgi%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20soapcgi_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(_DWORD%2C%20_DWORD%2C%20_DWORD))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22gena.cgi%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20genacgi_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(_DWORD%2C%20_DWORD%2C%20_DWORD))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22conntrack.cgi%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20(int%20(*)())%26conntrackcgi_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(_DWORD%2C%20_DWORD%2C%20_DWORD))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20if%20(%20!strcmp(v3%2C%20%22hnap%22)%20)%0A%20%20%7B%0A%20%20%20%20v8%20%3D%20(int%20(*)())%26hnap_main%3B%0A%20%20%20%20v9%20%3D%20argc%3B%0A%20%20%20%20return%20((int%20(__fastcall%20*)(_DWORD%2C%20_DWORD%2C%20_DWORD))v8)(v9%2C%20argv%2C%20envp)%3B%0A%20%20%7D%0A%20%20printf(%22CGI.BIN%2C%20unknown%20command%20%25s%5Cn%22%2C%20v3)%3B%0A%20%20return%201%3B%0A%7D%0A%60%60%60%0A%0A-%20captchacgi_main%20%EF%BC%88captcha%20%3D%20sess_generate_captcha((int)v9)%3B%EF%BC%89%0A%60%60%60%3Dc%0Aint%20captchacgi_main()%0A%7B%0A%20%20char%20*v0%3B%20%2F%2F%20%24v0%0A%20%20const%20char%20*v1%3B%20%2F%2F%20%24s0%0A%20%20const%20char%20*v2%3B%20%2F%2F%20%24a2%0A%20%20int%20(*v3)()%3B%20%2F%2F%20%24a0%0A%20%20int%20v4%3B%20%2F%2F%20%24a2%0A%20%20int%20captcha%3B%20%2F%2F%20%24v0%0A%20%20int%20v6%3B%20%2F%2F%20%24s1%0A%20%20int%20v7%3B%20%2F%2F%20%24s0%0A%20%20char%20v9%5B216%5D%3B%20%2F%2F%20%5Bsp%2B18h%5D%20%5B-1ECh%5D%20BYREF%20%0A%20%20char%20v10%5B16%5D%3B%20%2F%2F%20%5Bsp%2BF0h%5D%20%5B-114h%5D%20BYREF%0A%20%20char%20v11%5B260%5D%3B%20%2F%2F%20%5Bsp%2B100h%5D%20%5B-104h%5D%20BYREF%0A%0A%20%20v0%20%3D%20getenv(%22REQUEST_METHOD%22)%3B%0A%20%20v1%20%3D%20v0%3B%0A%20%20if%20(%20!v0%20)%0A%20%20%7B%0A%20%20%20%20v2%20%3D%20%22no%20REQUEST%22%3B%0ALABEL_10%3A%0A%20%20%20%20cgibin_print_http_status(400%2C%20%22%22%2C%20v2)%3B%0A%20%20%20%20v7%20%3D%20-1%3B%0A%20%20%20%20goto%20LABEL_12%3B%0A%20%20%7D%0A%20%20if%20(%20!strcasecmp(v0%2C%20%22GET%22)%20)%0A%20%20%7B%0A%20%20%20%20v3%20%3D%20sub_408CC4%3B%0A%20%20%20%20v4%20%3D%2064%3B%0A%20%20%7D%0A%20%20else%0A%20%20%7B%0A%20%20%20%20if%20(%20strcasecmp(v1%2C%20%22POST%22)%20)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20v2%20%3D%20%22unsupported%20HTTP%20request%22%3B%0A%20%20%20%20%20%20goto%20LABEL_10%3B%0A%20%20%20%20%7D%0A%20%20%20%20v3%20%3D%20sub_408C10%3B%0A%20%20%20%20v4%20%3D%201024%3B%0A%20%20%7D%0A%20%20cgibin_parse_request(v3%2C%200%2C%20v4)%3B%0A%20%20captcha%20%3D%20sess_generate_captcha((int)v9)%3B%20%2F%2Fgenerate%20captcha%0A%20%20v6%20%3D%20captcha%3B%0A%20%20if%20(%20captcha%20)%0A%20%20%7B%0A%20%20%20%20sprintf(v11%2C%20%22rndimage%20-f%20%2Fhtdocs%2Fweb%2Fdocs%2Fcaptcha_%25d.jpeg%20-p%20%2Fusr%2Fsbin%2Ffonts%20-w%20180%20-t%2040%20%25s%22%2C%20captcha%2C%20v10)%3B%0A%20%20%20%20v7%20%3D%200%3B%0A%20%20%20%20system(v11)%3B%0A%20%20%20%20printf(%0A%20%20%20%20%20%20%22HTTP%2F1.1%20200%20OK%5Cr%5Cn%22%0A%20%20%20%20%20%20%22Content-Type%3A%20text%2Fxml%5Cr%5Cn%22%0A%20%20%20%20%20%20%22%5Cr%5Cn%22%0A%20%20%20%20%20%20%22%3C%3Fxml%20version%3D%5C%221.0%5C%22%20encoding%3D%5C%22utf-8%5C%22%3F%3E%3Ccaptcha%3E%3Cresult%3EOK%3C%2Fresult%3E%3Cmessage%3E%2Fdocs%2Fcaptcha_%25d.jpeg%3C%2Fmessage%3E%3C%2Fcaptcha%3E%22%2C%0A%20%20%20%20%20%20v6)%3B%0A%20%20%7D%0A%20%20else%0A%20%20%7B%0A%20%20%20%20printf(%0A%20%20%20%20%20%20%22HTTP%2F1.1%20200%20OK%5Cr%5Cn%22%0A%20%20%20%20%20%20%22Content-Type%3A%20text%2Fxml%5Cr%5Cn%22%0A%20%20%20%20%20%20%22%5Cr%5Cn%22%0A%20%20%20%20%20%20%22%3C%3Fxml%20version%3D%5C%221.0%5C%22%20encoding%3D%5C%22utf-8%5C%22%3F%3E%3Ccaptcha%3E%5Cn%22%0A%20%20%20%20%20%20%22%5Ct%3Cresult%3EFAIL%3C%2Fresult%3E%3Cmessage%3ENO%20SESSION%3C%2Fmessage%3E%5Cn%22%0A%20%20%20%20%20%20%22%3C%2Fcaptcha%3E%22)%3B%0A%20%20%20%20v7%20%3D%200%3B%0A%20%20%7D%0ALABEL_12%3A%0A%20%20sub_4089C0()%3B%0A%20%20return%20v7%3B%0A%7D%0A%60%60%60%0A%0A-%20sess_generate_captcha%20(sess_get_uid(v3)%3B%E3%80%81v2%20%3D%20sub_40795C(a1%2C%20string)%3B)%0A%60%60%60%3Dc%0Aint%20__fastcall%20sess_generate_captcha(int%20a1)%0A%7B%0A%20%20int%20v2%3B%20%2F%2F%20%24s1%0A%20%20int%20v3%3B%20%2F%2F%20%24s2%0A%20%20int%20string%3B%20%2F%2F%20%24v0%0A%20%20int%20i%3B%20%2F%2F%20%24s0%0A%20%20unsigned%20int%20v6%3B%20%2F%2F%20%24v0%0A%20%20int%20v7%3B%20%2F%2F%20%24v1%0A%20%20int%20v9%5B4%5D%3B%20%2F%2F%20%5Bsp%2B18h%5D%20%5B-70h%5D%20BYREF%0A%20%20char%20v10%5B28%5D%3B%20%2F%2F%20%5Bsp%2B28h%5D%20%5B-60h%5D%20BYREF%0A%20%20struct%20sysinfo%20seed%3B%20%2F%2F%20%5Bsp%2B44h%5D%20%5B-44h%5D%20BYREF%0A%0A%20%20strcpy(v10%2C%20%22ABCDEFGHIJKLMNOPQRSTUVWXYZ%22)%3B%0A%20%20v2%20%3D%200%3B%0A%20%20v3%20%3D%20sobj_new()%3B%0A%20%20sub_40787C()%3B%0A%20%20sub_4072D0(v9)%3B%0A%20%20if%20(%20v3%20)%0A%20%20%7B%0A%20%20%20%20sess_get_uid(v3)%3B%20%20%20%2F%2FIt%20does%20not%20limit%20the%20cookie%20value%20input%20by%20the%20user%2C%20thus%20being%20a%20point%20of%20attack.%0A%20%20%20%20string%20%3D%20sobj_get_string(v3)%3B%20%2F%2FThe%20provided%20value%20is%20converted%20to%20a%20string%2C%20but%20the%20size%20of%20the%20v3%20value%20is%20not%20limited%20either.%0A%20%20%20%20v2%20%3D%20sub_40795C(a1%2C%20string)%3B%20%2F%2FThe%20value%20of%20the%20string%20will%20be%20very%20large%20and%20long%2C%20which%20is%20then%20passed%20into%20the%20sub_40795C%20function.%0A%20%20%20%20if%20(%20v2%20)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20sysinfo(%26seed)%3B%0A%20%20%20%20%20%20srandom(seed.uptime)%3B%0A%20%20%20%20%20%20for%20(%20i%20%3D%200%3B%20i%20!%3D%206%3B%20%2B%2Bi%20)%0A%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20v6%20%3D%20random()%3B%0A%20%20%20%20%20%20%20%20v7%20%3D%20a1%20%2B%20i%3B%0A%20%20%20%20%20%20%20%20*(_BYTE%20*)(v7%20%2B%20216)%20%3D%20*((_BYTE%20*)%26v9%5B4%5D%20%2B%20v6%20%25%200x1A)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20*(_DWORD%20*)(a1%20%2B%204)%20%3D%20-1%3B%0A%20%20%20%20%20%20*(_BYTE%20*)(a1%20%2B%20222)%20%3D%200%3B%0A%20%20%20%20%20%20sysinfo(%26seed)%3B%0A%20%20%20%20%20%20*(_DWORD%20*)a1%20%3D%20seed.uptime%20%2B%20v9%5B0%5D%3B%0A%20%20%20%20%20%20sub_407660(a1%2C%20v2%2C%201)%3B%0A%20%20%20%20%7D%0A%20%20%20%20sobj_del(v3)%3B%0A%20%20%7D%0A%20%20return%20v2%3B%0A%7D%0A%60%60%60%0A%0A-%20sess_get_uid%0A%60%60%60%3Dc%0Aint%20__fastcall%20sess_get_uid(int%20a1)%0A%7B%0A%20%20int%20v2%3B%20%2F%2F%20%24s2%0A%20%20char%20*v3%3B%20%2F%2F%20%24v0%0A%20%20int%20v4%3B%20%2F%2F%20%24s3%0A%20%20char%20*v5%3B%20%2F%2F%20%24s4%0A%20%20int%20v6%3B%20%2F%2F%20%24s1%0A%20%20int%20v7%3B%20%2F%2F%20%24s0%0A%20%20char%20*string%3B%20%2F%2F%20%24v0%0A%20%20int%20result%3B%20%2F%2F%20%24v0%0A%0A%20%20v2%20%3D%20sobj_new()%3B%0A%20%20v4%20%3D%20sobj_new()%3B%0A%20%20v3%20%3D%20getenv(%22HTTP_COOKIE%22)%3B%20%20%2F%2FAfter%20getenv(%22HTTP_COOKIE%22)%3B%20reads%20the%20cookie%20value%2C%20it%20does%20not%20restrict%20the%20size%20and%20length%20of%20this%20value.%0A%20%20if%20(%20!v2%20)%0A%20%20%20%20goto%20LABEL_27%3B%0A%20%20if%20(%20!v4%20)%0A%20%20%20%20goto%20LABEL_27%3B%0A%20%20v5%20%3D%20v3%3B%0A%20%20if%20(%20!v3%20)%0A%20%20%20%20goto%20LABEL_27%3B%0A%20%20v6%20%3D%200%3B%0A%20%20while%20(%201%20)%0A%20%20%7B%0A%20%20%20%20v7%20%3D%20*v5%3B%0A%20%20%20%20if%20(%20!*v5%20)%0A%20%20%20%20%20%20break%3B%0A%20%20%20%20if%20(%20v6%20%3D%3D%201%20)%0A%20%20%20%20%20%20goto%20LABEL_11%3B%0A%20%20%20%20if%20(%20v6%20%3C%202%20)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20if%20(%20v7%20%3D%3D%2032%20)%0A%20%20%20%20%20%20%20%20goto%20LABEL_18%3B%0A%20%20%20%20%20%20sobj_free(v2)%3B%0A%20%20%20%20%20%20sobj_free(v4)%3B%0ALABEL_11%3A%0A%20%20%20%20%20%20if%20(%20v7%20%3D%3D%2059%20)%0A%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20v6%20%3D%200%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20v6%20%3D%202%3B%0A%20%20%20%20%20%20%20%20if%20(%20v7%20!%3D%2061%20)%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20sobj_add_char(v2%2C%20v7)%3B%0A%20%20%20%20%20%20%20%20%20%20v6%20%3D%201%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20goto%20LABEL_18%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20(%20v6%20%3D%3D%202%20)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20if%20(%20v7%20%3D%3D%2059%20)%0A%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20v6%20%3D%203%3B%0A%20%20%20%20%20%20%20%20goto%20LABEL_18%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20sobj_add_char(v4%2C%20*v5%2B%2B)%3B%0A%20%20%20%20%7D%0A%20%20%20%20else%0A%20%20%20%20%7B%0A%20%20%20%20%20%20v6%20%3D%200%3B%0A%20%20%20%20%20%20if%20(%20!sobj_strcmp(v2%2C%20%22uid%22)%20)%0A%20%20%20%20%20%20%20%20goto%20LABEL_21%3B%0ALABEL_18%3A%0A%20%20%20%20%20%20%2B%2Bv5%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20if%20(%20!sobj_strcmp(v2%2C%20%22uid%22)%20)%0A%20%20%7B%0ALABEL_21%3A%0A%20%20%20%20string%20%3D%20(char%20*)sobj_get_string(v4)%3B%0A%20%20%20%20goto%20LABEL_22%3B%0A%20%20%7D%0ALABEL_27%3A%0A%20%20string%20%3D%20getenv(%22REMOTE_ADDR%22)%3B%0ALABEL_22%3A%0A%20%20result%20%3D%20sobj_add_string(a1%2C%20string)%3B%0A%20%20if%20(%20v2%20)%0A%20%20%20%20result%20%3D%20sobj_del(v2)%3B%0A%20%20if%20(%20v4%20)%0A%20%20%20%20return%20sobj_del(v4)%3B%0A%20%20return%20result%3B%0A%7D%20%0A%60%60%60%0A%0A-%20sub_40795C%20%EF%BC%88strncpy(a1%20%2B%208%2C%20a2%2C%200x40u)%3B%EF%BC%89%0A%60%60%60%3Dc%0Aint%20__fastcall%20sub_40795C(char%20*a1%2C%20const%20char%20*a2)%20%20%0A%7B%0A%20%20int%20i%3B%20%2F%2F%20%24s1%0A%20%20unsigned%20int%20v5%3B%20%2F%2F%20%24s0%0A%20%20unsigned%20int%20v6%3B%20%2F%2F%20%24s0%0A%20%20int%20v8%3B%20%2F%2F%20%5Bsp%2B18h%5D%20%5B-54h%5D%20BYREF%0A%20%20int%20v9%3B%20%2F%2F%20%5Bsp%2B1Ch%5D%20%5B-50h%5D%0A%20%20struct%20sysinfo%20v10%3B%20%2F%2F%20%5Bsp%2B28h%5D%20%5B-44h%5D%20BYREF%0A%0A%20%20if%20(%20!a1%20)%0A%20%20%20%20return%200%3B%0A%20%20i%20%3D%200%3B%0A%20%20if%20(%20a2%20%26%26%20*a2%20)%0A%20%20%7B%0A%20%20%20%20sub_4072D0(%26v8)%3B%0A%20%20%20%20memset(a1%2C%200%2C%200xE8u)%3B%0A%20%20%20%20for%20(%20i%20%3D%201%3B%20v9%20%3E%3D%20i%3B%20%2B%2Bi%20)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20if%20(%20!sub_407660(a1%2C%20i%2C%200)%20)%0A%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20v5%20%3D%20*(_DWORD%20*)a1%3B%0A%20%20%20%20%20%20%20%20sysinfo(%26v10)%3B%0A%20%20%20%20%20%20%20%20if%20(%20v5%20%3E%3D%20v10.uptime%20%26%26%20!strcmp(a1%20%2B%208%2C%20a2)%20)%0A%20%20%20%20%20%20%20%20%20%20return%20i%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20i%20%3D%201%3B%0A%20%20%20%20while%20(%20v9%20%3E%3D%20i%20)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20if%20(%20sub_407660(a1%2C%20i%2C%200)%20)%0A%20%20%20%20%20%20%20%20goto%20LABEL_14%3B%0A%20%20%20%20%20%20v6%20%3D%20*(_DWORD%20*)a1%3B%0A%20%20%20%20%20%20sysinfo(%26v10)%3B%0A%20%20%20%20%20%20%2B%2Bi%3B%0A%20%20%20%20%20%20if%20(%20v6%20%3C%20v10.uptime%20)%0A%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20--i%3B%0ALABEL_14%3A%0A%20%20%20%20%20%20%20%20memset(a1%2C%200%2C%200xE8u)%3B%0A%20%20%20%20%20%20%20%20sysinfo(%26v10)%3B%0A%20%20%20%20%20%20%20%20*(_DWORD%20*)a1%20%3D%20v10.uptime%20%2B%20v8%3B%0A%20%20%20%20%20%20%20%20*((_DWORD%20*)a1%20%2B%201)%20%3D%20-1%3B%0A%20%20%20%20%20%20%20%20strncpy(a1%20%2B%208%2C%20a2%2C%200x40u)%3B%20%20%2F%2FVulnerbility%20code%0A%20%20%20%20%20%20%20%20sub_407660(a1%2C%20i%2C%201)%3B%0A%20%20%20%20%20%20%20%20return%20i%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20return%200%3B%0A%20%20%7D%0A%20%20return%20i%3B%0A%7D%0A%60%60%60%0AThe%20line%20**strncpy(a1%20%2B%208%2C%20a2%2C%200x40u)%3B**%20in%20the%20program%20creates%20a%20buffer%20overflow%20vulnerability%20due%20to%20improper%20usage%20of%20the%20strncpy()%20function.%0A%0AHowever%2C%20if%20a2%20is%2064%20characters%20or%20longer%20and%20does%20not%20contain%20a%20NULL%20termination%20character%20('%5C0')%2C%20strncpy()%20will%20not%20append%20a%20NULL%20character%20at%20the%20end%20of%20the%20target%20string%20a1.%20This%20is%20where%20the%20vulnerability%20lies.%20Since%20the%20NULL%20character%20is%20used%20to%20mark%20the%20end%20of%20a%20string%20in%20C%2C%20the%20absence%20of%20this%20character%20can%20lead%20to%20a%20buffer%20overflow%20condition.","viewMode":"publish","isOwner":false,"isSignIn":false,"isLiked":false,"isBookmarked":false,"publishType":"view","commentCount":0,"isNotesRecommendationsEnabled":true,"recommendedNotes":[],"lastChangeUserInfo":{"name":"Jian-Xian","path":"pSgS7xsnS5a4K7Y0yiB43g","avatarUrl":"https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F56055577%3Fs%3D96"}}`);
  (function () {
    const decodeStringProps = (props) => {
      for (const key in props) {
        if (typeof props[key] === 'string') {
          props[key] = decodeURIComponent(props[key])
        } else if (typeof props[key] === 'object') {
          decodeStringProps(props[key])
        }
      }
    }
    decodeStringProps(window.publishProps)
  })()
</script>

    <script src="https://tally.so/widgets/embed.js"></script>

    
</head>

<body style="display:none;">
    <div id="toasts-container" class="toasts-container z-[2000]"></div>
    <div id="publish-page">
### [Product]：D-LINK DIR-815
### [Firmware Version]：1.01
### [Vulnerability Type]：buffer overflow
### [Vulnerability Summary]:
The software component /htdocs/web/captcha.cgi suffers from a buffer overflow vulnerability due to an unsafe implementation of the strncpy() function. When a user-supplied input string (a2) that is exactly 64 characters long (or longer) without a NULL termination character is provided, the strncpy(a1 + 8, a2, 0x40u); operation fails to append a NULL character at the end of the copied string. This oversight leads to a potential buffer overflow condition.
### [Discoverer]：
Jian-Xian Li, Yen-Jen Lin, Hung-Min Sun / Laboratory of Information Security, National Tsing Hua University
### [Crash Result]：
![](https://hackmd.io/_uploads/SJGQI6Nvn.png)

![](https://hackmd.io/_uploads/rys-pNlth.png)

---
&lt;!-- Normal Execution Result：
![](https://hackmd.io/_uploads/HyjMpVlF3.png)
Crash Execution Result：
![](https://hackmd.io/_uploads/SJb4pNlY3.png) --&gt;





### [Vulnerbility Detail]:
Function_name (Problematic Code)
- main (v8 = (int (*)())&amp;captchacgi_main;)
```=c
int __cdecl main(int argc, const char **argv, const char **envp)
{
  const char *v3; // $s0
  char *v6; // $v0
  int (*v8)(); // $t9
  int v9; // $a0

  v3 = *argv;
  v6 = strrchr(*argv, 47);
  if ( v6 )
    v3 = v6 + 1;
  if ( !strcmp(v3, &#34;phpcgi&#34;) )
  {
    v8 = phpcgi_main;
    v9 = argc;
    return ((int (__fastcall *)(int, const char **, const char **))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;dlcfg.cgi&#34;) )
  {
    v8 = dlcfg_main;
    v9 = argc;
    return ((int (__fastcall *)(int, const char **, const char **))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;seama.cgi&#34;) )
  {
    v8 = seamacgi_main;
    v9 = argc;
    return ((int (__fastcall *)(_DWORD, _DWORD, _DWORD))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;fwup.cgi&#34;) )
  {
    v8 = fwup_main;
    v9 = argc;
    return ((int (__fastcall *)(_DWORD, _DWORD, _DWORD))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;fwupdater&#34;) )
  {
    v8 = (int (*)())fwupdater_main;
    v9 = argc;
    return ((int (__fastcall *)(_DWORD, _DWORD, _DWORD))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;session.cgi&#34;) )
  {
    v8 = (int (*)())&amp;sessioncgi_main;
    v9 = argc;
    return ((int (__fastcall *)(_DWORD, _DWORD, _DWORD))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;captcha.cgi&#34;) )
  {
    v8 = (int (*)())&amp;captchacgi_main; //Execute captcha.cgi, enter the corresponding function.

    v9 = argc;
    return ((int (__fastcall *)(_DWORD, _DWORD, _DWORD))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;hedwig.cgi&#34;) )
  {
    v8 = hedwigcgi_main;
    v9 = argc;
    return ((int (__fastcall *)(_DWORD, _DWORD, _DWORD))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;pigwidgeon.cgi&#34;) )
  {
    v8 = (int (*)())&amp;pigwidgeoncgi_main;
    v9 = argc;
    return ((int (__fastcall *)(_DWORD, _DWORD, _DWORD))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;service.cgi&#34;) )
  {
    v8 = (int (*)())&amp;servicecgi_main;
    v9 = argc;
    return ((int (__fastcall *)(_DWORD, _DWORD, _DWORD))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;ssdpcgi&#34;) )
  {
    v8 = ssdpcgi_main;
    v9 = argc;
    return ((int (__fastcall *)(_DWORD, _DWORD, _DWORD))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;soap.cgi&#34;) )
  {
    v8 = soapcgi_main;
    v9 = argc;
    return ((int (__fastcall *)(_DWORD, _DWORD, _DWORD))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;gena.cgi&#34;) )
  {
    v8 = genacgi_main;
    v9 = argc;
    return ((int (__fastcall *)(_DWORD, _DWORD, _DWORD))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;conntrack.cgi&#34;) )
  {
    v8 = (int (*)())&amp;conntrackcgi_main;
    v9 = argc;
    return ((int (__fastcall *)(_DWORD, _DWORD, _DWORD))v8)(v9, argv, envp);
  }
  if ( !strcmp(v3, &#34;hnap&#34;) )
  {
    v8 = (int (*)())&amp;hnap_main;
    v9 = argc;
    return ((int (__fastcall *)(_DWORD, _DWORD, _DWORD))v8)(v9, argv, envp);
  }
  printf(&#34;CGI.BIN, unknown command %s\n&#34;, v3);
  return 1;
}
```

- captchacgi_main （captcha = sess_generate_captcha((int)v9);）
```=c
int captchacgi_main()
{
  char *v0; // $v0
  const char *v1; // $s0
  const char *v2; // $a2
  int (*v3)(); // $a0
  int v4; // $a2
  int captcha; // $v0
  int v6; // $s1
  int v7; // $s0
  char v9[216]; // [sp+18h] [-1ECh] BYREF 
  char v10[16]; // [sp+F0h] [-114h] BYREF
  char v11[260]; // [sp+100h] [-104h] BYREF

  v0 = getenv(&#34;REQUEST_METHOD&#34;);
  v1 = v0;
  if ( !v0 )
  {
    v2 = &#34;no REQUEST&#34;;
LABEL_10:
    cgibin_print_http_status(400, &#34;&#34;, v2);
    v7 = -1;
    goto LABEL_12;
  }
  if ( !strcasecmp(v0, &#34;GET&#34;) )
  {
    v3 = sub_408CC4;
    v4 = 64;
  }
  else
  {
    if ( strcasecmp(v1, &#34;POST&#34;) )
    {
      v2 = &#34;unsupported HTTP request&#34;;
      goto LABEL_10;
    }
    v3 = sub_408C10;
    v4 = 1024;
  }
  cgibin_parse_request(v3, 0, v4);
  captcha = sess_generate_captcha((int)v9); //generate captcha
  v6 = captcha;
  if ( captcha )
  {
    sprintf(v11, &#34;rndimage -f /htdocs/web/docs/captcha_%d.jpeg -p /usr/sbin/fonts -w 180 -t 40 %s&#34;, captcha, v10);
    v7 = 0;
    system(v11);
    printf(
      &#34;HTTP/1.1 200 OK\r\n&#34;
      &#34;Content-Type: text/xml\r\n&#34;
      &#34;\r\n&#34;
      &#34;&lt;?xml version=\&#34;1.0\&#34; encoding=\&#34;utf-8\&#34;?&gt;&lt;captcha&gt;&lt;result&gt;OK&lt;/result&gt;&lt;message&gt;/docs/captcha_%d.jpeg&lt;/message&gt;&lt;/captcha&gt;&#34;,
      v6);
  }
  else
  {
    printf(
      &#34;HTTP/1.1 200 OK\r\n&#34;
      &#34;Content-Type: text/xml\r\n&#34;
      &#34;\r\n&#34;
      &#34;&lt;?xml version=\&#34;1.0\&#34; encoding=\&#34;utf-8\&#34;?&gt;&lt;captcha&gt;\n&#34;
      &#34;\t&lt;result&gt;FAIL&lt;/result&gt;&lt;message&gt;NO SESSION&lt;/message&gt;\n&#34;
      &#34;&lt;/captcha&gt;&#34;);
    v7 = 0;
  }
LABEL_12:
  sub_4089C0();
  return v7;
}
```

- sess_generate_captcha (sess_get_uid(v3);、v2 = sub_40795C(a1, string);)
```=c
int __fastcall sess_generate_captcha(int a1)
{
  int v2; // $s1
  int v3; // $s2
  int string; // $v0
  int i; // $s0
  unsigned int v6; // $v0
  int v7; // $v1
  int v9[4]; // [sp+18h] [-70h] BYREF
  char v10[28]; // [sp+28h] [-60h] BYREF
  struct sysinfo seed; // [sp+44h] [-44h] BYREF

  strcpy(v10, &#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;);
  v2 = 0;
  v3 = sobj_new();
  sub_40787C();
  sub_4072D0(v9);
  if ( v3 )
  {
    sess_get_uid(v3);   //It does not limit the cookie value input by the user, thus being a point of attack.
    string = sobj_get_string(v3); //The provided value is converted to a string, but the size of the v3 value is not limited either.
    v2 = sub_40795C(a1, string); //The value of the string will be very large and long, which is then passed into the sub_40795C function.
    if ( v2 )
    {
      sysinfo(&amp;seed);
      srandom(seed.uptime);
      for ( i = 0; i != 6; ++i )
      {
        v6 = random();
        v7 = a1 + i;
        *(_BYTE *)(v7 + 216) = *((_BYTE *)&amp;v9[4] + v6 % 0x1A);
      }
      *(_DWORD *)(a1 + 4) = -1;
      *(_BYTE *)(a1 + 222) = 0;
      sysinfo(&amp;seed);
      *(_DWORD *)a1 = seed.uptime + v9[0];
      sub_407660(a1, v2, 1);
    }
    sobj_del(v3);
  }
  return v2;
}
```

- sess_get_uid
```=c
int __fastcall sess_get_uid(int a1)
{
  int v2; // $s2
  char *v3; // $v0
  int v4; // $s3
  char *v5; // $s4
  int v6; // $s1
  int v7; // $s0
  char *string; // $v0
  int result; // $v0

  v2 = sobj_new();
  v4 = sobj_new();
  v3 = getenv(&#34;HTTP_COOKIE&#34;);  //After getenv(&#34;HTTP_COOKIE&#34;); reads the cookie value, it does not restrict the size and length of this value.
  if ( !v2 )
    goto LABEL_27;
  if ( !v4 )
    goto LABEL_27;
  v5 = v3;
  if ( !v3 )
    goto LABEL_27;
  v6 = 0;
  while ( 1 )
  {
    v7 = *v5;
    if ( !*v5 )
      break;
    if ( v6 == 1 )
      goto LABEL_11;
    if ( v6 &lt; 2 )
    {
      if ( v7 == 32 )
        goto LABEL_18;
      sobj_free(v2);
      sobj_free(v4);
LABEL_11:
      if ( v7 == 59 )
      {
        v6 = 0;
      }
      else
      {
        v6 = 2;
        if ( v7 != 61 )
        {
          sobj_add_char(v2, v7);
          v6 = 1;
        }
      }
      goto LABEL_18;
    }
    if ( v6 == 2 )
    {
      if ( v7 == 59 )
      {
        v6 = 3;
        goto LABEL_18;
      }
      sobj_add_char(v4, *v5++);
    }
    else
    {
      v6 = 0;
      if ( !sobj_strcmp(v2, &#34;uid&#34;) )
        goto LABEL_21;
LABEL_18:
      ++v5;
    }
  }
  if ( !sobj_strcmp(v2, &#34;uid&#34;) )
  {
LABEL_21:
    string = (char *)sobj_get_string(v4);
    goto LABEL_22;
  }
LABEL_27:
  string = getenv(&#34;REMOTE_ADDR&#34;);
LABEL_22:
  result = sobj_add_string(a1, string);
  if ( v2 )
    result = sobj_del(v2);
  if ( v4 )
    return sobj_del(v4);
  return result;
} 
```

- sub_40795C （strncpy(a1 + 8, a2, 0x40u);）
```=c
int __fastcall sub_40795C(char *a1, const char *a2)  
{
  int i; // $s1
  unsigned int v5; // $s0
  unsigned int v6; // $s0
  int v8; // [sp+18h] [-54h] BYREF
  int v9; // [sp+1Ch] [-50h]
  struct sysinfo v10; // [sp+28h] [-44h] BYREF

  if ( !a1 )
    return 0;
  i = 0;
  if ( a2 &amp;&amp; *a2 )
  {
    sub_4072D0(&amp;v8);
    memset(a1, 0, 0xE8u);
    for ( i = 1; v9 &gt;= i; ++i )
    {
      if ( !sub_407660(a1, i, 0) )
      {
        v5 = *(_DWORD *)a1;
        sysinfo(&amp;v10);
        if ( v5 &gt;= v10.uptime &amp;&amp; !strcmp(a1 + 8, a2) )
          return i;
      }
    }
    i = 1;
    while ( v9 &gt;= i )
    {
      if ( sub_407660(a1, i, 0) )
        goto LABEL_14;
      v6 = *(_DWORD *)a1;
      sysinfo(&amp;v10);
      ++i;
      if ( v6 &lt; v10.uptime )
      {
        --i;
LABEL_14:
        memset(a1, 0, 0xE8u);
        sysinfo(&amp;v10);
        *(_DWORD *)a1 = v10.uptime + v8;
        *((_DWORD *)a1 + 1) = -1;
        strncpy(a1 + 8, a2, 0x40u);  //Vulnerbility code
        sub_407660(a1, i, 1);
        return i;
      }
    }
    return 0;
  }
  return i;
}
```
The line **strncpy(a1 + 8, a2, 0x40u);** in the program creates a buffer overflow vulnerability due to improper usage of the strncpy() function.

However, if a2 is 64 characters or longer and does not contain a NULL termination character (&#39;\0&#39;), strncpy() will not append a NULL character at the end of the target string a1. This is where the vulnerability lies. Since the NULL character is used to mark the end of a string in C, the absence of this character can lead to a buffer overflow condition.</div>
    <!-- signin modal -->

<div class="modal fade signin-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="margin-top: 10px; right: 20px; position: absolute;"><span aria-hidden="true">&times;</span></button>
            






    









<h3>Sign in</h3>

<form data-toggle="validator" role="form" class="form-horizontal" method="post" enctype="application/x-www-form-urlencoded" id="signin-form">
    <div class="hmd-dn"><input type="hidden" name="_csrf" value="WLldjeIF-FuFYwZ7pkAPoqUO_Ej6J-9HUVAI"></div>
    <div class="hmd-dn"><input type="hidden" name="create_team" value="false"></div>
    <div class="hmd-dn"><input type="hidden" name="create_paid_team" value="false"></div>
    
    <div class="form-group  ">
        <label for="email" class="control-label">Email</label>
        <label for="inputEmail" class="control-label pull-right errors">
            
        </label>
        <span class="help-block control-label with-errors pull-right" style="margin-top: 14px"></span>
        <div class="input-block">
            
                <input type="email" class="form-control" name="email" placeholder="Your email" required autocomplete="email">
            
            <span class="error-sign"></span>
        </div>
    </div>
    <div class="form-group ">
        <label for="password" class="control-label">Password</label>
        <label for="inputPassword" class="control-label pull-right errors">
            
        </label>
        <span class="help-block control-label with-errors pull-right" style="margin-top: 14px"></span>
        <div class="input-block">
            <input type="password" class="form-control" name="password" placeholder="Your password" required autocomplete="current-password" maxlength="128">
            <span class="error-sign"></span>
            
                <span class="control-label pull-right !text-normal !leading-normal !font-normal !mt-1.5"><a href="https://hackmd.io/settings/forgotPassword" style="text-decoration: underline;">Forgot password</a></span>
            
        </div>
    </div>

    <div style="text-align: center; padding-top: 15px; margin-bottom: 0px;">
        <div
            hidden
            id="hmd-captcha"
            data-provider=""
            data-captcha-data=""
            class="flex justify-center"
        ></div>

        
            <input type="submit" class="neo-btn neo-btn-primary !justify-center !py-3.5 !mx-auto" formaction="https://hackmd.io/login" value="Sign in">
        

        
    </div>
</form>














    
        <p class="separator">or</p>
    

    
        <p>By clicking below, you agree to our <a href="https://hackmd.io/s/terms" target="_blank">terms of service</a>.</p>
    

    












<script id="gsi-client" src="https://accounts.google.com/gsi/client" async defer nonce="69788942-7bdf-4500-89b7-93eecf13f72b"></script>
<script nonce="69788942-7bdf-4500-89b7-93eecf13f72b">
    function handleCredentialResponse(response) {
        const form = document.getElementById('sign-in-with-google-form')
        form.children.credential.value = response.credential
        form.children.method.value = location.href.toLowerCase() === 'https://hackmd.io/settings#general' ? 'merge' : 'login'
        form.submit()
    }
    var GSI_READY = new Promise(function (resolve) {
        function initialize () {
            google.accounts.id.initialize({
                client_id: '911617723593-drikdibvvn63slfd6kbqigo8ql1no55s.apps.googleusercontent.com',
                callback: handleCredentialResponse
            })
            const loginPath = '/login'
            const joinPath = '/join'
            const renderButton = function () {
                google.accounts.id.renderButton(
                    document.getElementById('sign-in-with-google-button'),
                    { type: 'standard', width: 250 }
                )
            }
            if (location.pathname.toLowerCase() === loginPath || location.pathname.toLowerCase() === joinPath) {
                renderButton()
            } else {
                $('.signin-modal').one('shown.bs.modal', function () {
                    renderButton()
                })
            }
            resolve()
        }

        window.addEventListener('load', function () { initialize() })
    })
</script>
<form class="hidden" id="sign-in-with-google-form" action="/auth/google" method="post">
    <input type="hidden" name="credential">
    <input type="hidden" name="method">
</form>


<div class="social-buttons-container">
    
    <div id="sign-in-with-google-button"></div>
    
    
    <a href="https://hackmd.io/auth/facebook" class="btn btn-lg btn-block btn-social btn-facebook">
        <i class="fa fa-facebook"></i> Sign in via Facebook
    </a>
    
    
    <a href="https://hackmd.io/auth/twitter" class="btn btn-lg btn-block btn-social btn-twitter">
        <i class="fa fa-twitter"></i> Sign in via Twitter
    </a>
    
    
    <a href="https://hackmd.io/auth/github" class="btn btn-lg btn-block btn-social btn-github">
        <i class="fa fa-github"></i> Sign in via GitHub
    </a>
    
    
    <a href="https://hackmd.io/auth/dropbox" class="btn btn-lg btn-block btn-social btn-dropbox">
        <i class="fa fa-dropbox"></i> Sign in via Dropbox
    </a>
    
    
    
      <a href="#" class="bg-white btn btn-block btn-social btn-web3 bg-gray-800 hocus:bg-[#2b2b2b] text-white hocus:text-white">
          <img src="https://hackmd.io/images/wallet.svg" style="max-height: 20px; margin-top: 8px; margin-left: 6px; border: none;">
          <span class="sign-in-wallet-text">
              Sign in with Wallet
          </span>

          <div class="inline-flex items-center justify-between w-full hidden web3-wallet-info">
              <span>
                   Wallet
                   (
                    <span class="web3-wallet-address"></span>
                   )
              </span>

              <i class="fa fa-arrow-right" aria-hidden="true"></i>
          </div>
      </a>

      <small class="web3-wallet-info hidden text-left hocus:text-white underline hocus:underline block pt-2 ui-disconnect-connected-wallets text-gray-600 cursor-pointer">
          Connect another wallet
      </small>
    
</div>




    <div >
        <p>New to HackMD? <a href="https://hackmd.io/join" class="plausible-event-name=LoginModalSignUp">Sign up</a></p>
    </div>




        </div>
    </div>
</div>

    
    <script src="https://www.googletagmanager.com/gtag/js?id=G-NGVZMM6DR6"></script>
    <script nonce="69788942-7bdf-4500-89b7-93eecf13f72b">
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        let userid = (document.cookie.match('(^|; )userid=([^;]*)')||0)[2];
        gtag('config', 'G-NGVZMM6DR6', {'user_id': userid});
        
    </script>


    
<script src="https://browser.sentry-cdn.com/5.15.5/bundle.min.js" crossorigin="anonymous"></script>
<script nonce="69788942-7bdf-4500-89b7-93eecf13f72b">Sentry.init({ dsn: 'https://73410f1915d84abc8b2dd1f1aabd1c82@sentry.hackmd.dev/4', environment: 'production', integrations: function (intrus) { return intrus.filter(function (itr) { return itr.name !== 'TryCatch' }) } });</script>


    
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KLW9Z3"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->



    <script src="https://hackmd.io/api/i18n.js"></script>
     <script src="https://assets.hackmd.io/build/font-vendor.eaa8dd82d4e056021b8c.js" defer="defer"></script><script src="https://assets.hackmd.io/build/common-vendor.04da453a2a68f624f4d4.js" defer="defer"></script><script src="https://assets.hackmd.io/build/pretty-vendor.94ca39727118897623cd.js" defer="defer"></script><script src="https://assets.hackmd.io/build/pretty-common.e537850a918313f6b528.js" defer="defer"></script><script src="https://assets.hackmd.io/build/pretty.542e7daea665107a9e4b.js" defer="defer"></script>

    

</body>
</html>
