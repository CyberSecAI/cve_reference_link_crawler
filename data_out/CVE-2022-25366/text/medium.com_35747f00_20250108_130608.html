[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8004a1e90b26&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftehwinsam.medium.com%2Fcryptomator-1-6-5-dylib-injection-8004a1e90b26&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftehwinsam.medium.com%2Fcryptomator-1-6-5-dylib-injection-8004a1e90b26&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Cryptomator 1.6.5 Dylib Injection

[![AppleBois](https://miro.medium.com/v2/da:true/resize:fill:88:88/0*U8U1aT69j5xcrlbM)](/?source=post_page---byline--8004a1e90b26--------------------------------)

[AppleBois](/?source=post_page---byline--8004a1e90b26--------------------------------)

·

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F78c54ef5d86b&operation=register&redirect=https%3A%2F%2Ftehwinsam.medium.com%2Fcryptomator-1-6-5-dylib-injection-8004a1e90b26&user=AppleBois&userId=78c54ef5d86b&source=post_page-78c54ef5d86b--byline--8004a1e90b26---------------------post_header-----------)

2 min read·Feb 17, 2022

--

Listen

Share

This module we will learn about Dylib Injection for Cryptomator 1.6.5 in MacOS Application.

First we will just run a codesign on the Cryptomator app, we can see that it’s has the flag of 0x1000 runtime hardened flag. But, there are interesting entitlement that was set to TRUE. For Dylib Injection, we are interested in Disable Library Validation and Allow Dylib Environment Variable.

![]()

Codesign output

If you are un-familiar with Dylib Injection, I will include several references for the reading.

When we see the entitlement of “com.apple.security.cs.disable-library-validation” we will know that this allow Dylib Injection, but due to the nature of the application, it will load specific third parties dylib. Which mean we can look for Dylib Proxying or Dylib Hijacking. However, I did not managed to find path for Dylib Proxying or Hijacking.

![]()

Feedback from them

But, since we have another entitlement called “com.apple.security.cs.allow-dyld-environment-variables” we can specify the ENV variable (DYLD\_INSERT\_LIBRARIES) to the path of our malicious dylib.

Below screenshot is the Source Code of the malicious Dylib

![]()

Source code of the malicious Dylib written in Objective C

Specify the Environment Variable and trigger te Cryptomator Application.

On the terminal we will able to see [+]dylib constructor called from /Applications/Cryptmator.app/Contents/MacOS/Cryptomator.

![]()

Dylib Injection is success

The impact will be it will turn into a code injection, method swizzling, interposting.

The fix should be remove low hanging fruits. Remove the entitlement “com.apple.security.cs.allow-dyld-environment-variables”

Reference:
<https://wojciechregula.blog/post/dangerous-get-task-allow-entitlement/>
<https://theevilbit.github.io/posts/dyld_insert_libraries_dylib_injection_in_macos_osx_deep_dive/>
<https://cryptomator.org/>

--

--

[![AppleBois](https://miro.medium.com/v2/resize:fill:96:96/0*U8U1aT69j5xcrlbM)](/?source=post_page---post_author_info--8004a1e90b26--------------------------------)[![AppleBois](https://miro.medium.com/v2/resize:fill:128:128/0*U8U1aT69j5xcrlbM)](/?source=post_page---post_author_info--8004a1e90b26--------------------------------)Follow[## Written by AppleBois](/?source=post_page---post_author_info--8004a1e90b26--------------------------------)[23 Followers](/followers?source=post_page---post_author_info--8004a1e90b26--------------------------------)·[1 Following](/following?source=post_page---post_author_info--8004a1e90b26--------------------------------)

Exploit Writer

Follow
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----8004a1e90b26--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----8004a1e90b26--------------------------------)[About](https://medium.com/about?autoplay=1&source=post_page-----8004a1e90b26--------------------------------)[Careers](https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----8004a1e90b26--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----8004a1e90b26--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----8004a1e90b26--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8004a1e90b26--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8004a1e90b26--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----8004a1e90b26--------------------------------)[Teams](https://medium.com/business?source=post_page-----8004a1e90b26--------------------------------)

