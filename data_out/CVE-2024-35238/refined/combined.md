=== Content from github.com_a47aa3be_20250111_034422.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmindersec%2Fminder%2Fblob%2Fdaccbc12e364e2d407d56b87a13f7bb24cbdb074%2Finternal%2Fverifier%2Fsigstore%2Fcontainer%2Fcontainer.go)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmindersec%2Fminder%2Fblob%2Fdaccbc12e364e2d407d56b87a13f7bb24cbdb074%2Finternal%2Fverifier%2Fsigstore%2Fcontainer%2Fcontainer.go)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=mindersec%2Fminder)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mindersec](/mindersec)
/
**[minder](/mindersec/minder)**
Public

* [Notifications](/login?return_to=%2Fmindersec%2Fminder) You must be signed in to change notification settings
* [Fork
  41](/login?return_to=%2Fmindersec%2Fminder)
* [Star
   306](/login?return_to=%2Fmindersec%2Fminder)

* [Code](/mindersec/minder)
* [Issues
  127](/mindersec/minder/issues)
* [Pull requests
  11](/mindersec/minder/pulls)
* [Discussions](/mindersec/minder/discussions)
* [Actions](/mindersec/minder/actions)
* [Wiki](/mindersec/minder/wiki)
* [Security](/mindersec/minder/security)
* [Insights](/mindersec/minder/pulse)

Additional navigation options

* [Code](/mindersec/minder)
* [Issues](/mindersec/minder/issues)
* [Pull requests](/mindersec/minder/pulls)
* [Discussions](/mindersec/minder/discussions)
* [Actions](/mindersec/minder/actions)
* [Wiki](/mindersec/minder/wiki)
* [Security](/mindersec/minder/security)
* [Insights](/mindersec/minder/pulse)

## Files

 daccbc1
## Breadcrumbs

1. [minder](/mindersec/minder/tree/daccbc12e364e2d407d56b87a13f7bb24cbdb074)
2. /[internal](/mindersec/minder/tree/daccbc12e364e2d407d56b87a13f7bb24cbdb074/internal)
3. /[verifier](/mindersec/minder/tree/daccbc12e364e2d407d56b87a13f7bb24cbdb074/internal/verifier)
4. /[sigstore](/mindersec/minder/tree/daccbc12e364e2d407d56b87a13f7bb24cbdb074/internal/verifier/sigstore)
5. /[container](/mindersec/minder/tree/daccbc12e364e2d407d56b87a13f7bb24cbdb074/internal/verifier/sigstore/container)
/
# container.go

Copy path Blame  Blame
## Latest commit

## History

[History](/mindersec/minder/commits/daccbc12e364e2d407d56b87a13f7bb24cbdb074/internal/verifier/sigstore/container/container.go)625 lines (552 loc) · 21.3 KB daccbc1
## Breadcrumbs

1. [minder](/mindersec/minder/tree/daccbc12e364e2d407d56b87a13f7bb24cbdb074)
2. /[internal](/mindersec/minder/tree/daccbc12e364e2d407d56b87a13f7bb24cbdb074/internal)
3. /[verifier](/mindersec/minder/tree/daccbc12e364e2d407d56b87a13f7bb24cbdb074/internal/verifier)
4. /[sigstore](/mindersec/minder/tree/daccbc12e364e2d407d56b87a13f7bb24cbdb074/internal/verifier/sigstore)
5. /[container](/mindersec/minder/tree/daccbc12e364e2d407d56b87a13f7bb24cbdb074/internal/verifier/sigstore/container)
/
# container.go

Top
## File metadata and controls

* Code
* Blame

625 lines (552 loc) · 21.3 KB[Raw](https://github.com/mindersec/minder/raw/daccbc12e364e2d407d56b87a13f7bb24cbdb074/internal/verifier/sigstore/container/container.go)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625// Copyright 2023 Stacklok, Inc//// Licensed under the Apache License, Version 2.0 (the "License");// you may not use this file except in compliance with the License.// You may obtain a copy of the License at//// http://www.apache.org/licenses/LICENSE-2.0//// Unless required by applicable law or agreed to in writing, software// distributed under the License is distributed on an "AS IS" BASIS,// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.// See the License for the specific language governing permissions and// limitations under the License.
// Package container provides the tools to verify a container artifact using sigstorepackage container
import ( "bytes" "context" "encoding/base64" "encoding/hex" "encoding/json" "encoding/pem" "errors" "fmt" "net/http" "strings"
 "github.com/google/go-containerregistry/pkg/authn" "github.com/google/go-containerregistry/pkg/crane" "github.com/google/go-containerregistry/pkg/name" v1 "github.com/google/go-containerregistry/pkg/v1" "github.com/google/go-containerregistry/pkg/v1/remote" containerdigest "github.com/opencontainers/go-digest" "github.com/rs/zerolog" protobundle "github.com/sigstore/protobuf-specs/gen/pb-go/bundle/v1" protocommon "github.com/sigstore/protobuf-specs/gen/pb-go/common/v1" protorekor "github.com/sigstore/protobuf-specs/gen/pb-go/rekor/v1" "github.com/sigstore/sigstore-go/pkg/bundle" "github.com/sigstore/sigstore-go/pkg/verify" "google.golang.org/protobuf/encoding/protojson"
 "github.com/stacklok/minder/internal/verifier/verifyif" provifv1 "github.com/stacklok/minder/pkg/providers/v1")
var ( // ErrProvenanceNotFoundOrIncomplete is returned when there's no provenance info (missing .sig or attestation) or // has incomplete data ErrProvenanceNotFoundOrIncomplete = errors.New("provenance not found or incomplete"))
const ( sigstoreBundleMediaType01 = "application/vnd.dev.sigstore.bundle+json;version=0.1")
// AuthMethod is an option for containerAuthtype AuthMethod func(auth \*containerAuth)
// containerAuth is the authentication for the containertype containerAuth struct { // Used if GH client is available ghClient provifv1.GitHub // Used if GH client is not available (any other provider) concreteAuthn authn.Authenticator // Registry to use registry string}
func (c \*containerAuth) getAuthenticator(owner string) authn.Authenticator { if c.ghClient != nil { return c.ghClient.GetCredential().GetAsContainerAuthenticator(owner) } if c.concreteAuthn != nil { return c.concreteAuthn } return authn.Anonymous}
func newContainerAuth(authOpts ...AuthMethod) \*containerAuth { auth := containerAuth{ registry: "ghcr.io", } for \_, opt := range authOpts { opt(&auth) } return &auth}
// WithGitHubClient sets the GitHub client as an authentication option we want to use during verificationfunc WithGitHubClient(ghClient provifv1.GitHub) AuthMethod { return func(auth \*containerAuth) { auth.ghClient = ghClient }}
// WithAuthenticator sets the authenticator as an authentication option we want to use during verificationfunc WithAuthenticator(auth authn.Authenticator) AuthMethod { return func(cauth \*containerAuth) { cauth.concreteAuthn = auth }}
// WithRegistry sets the registry as an authentication option we want to use during verificationfunc WithRegistry(registry string) AuthMethod { return func(cauth \*containerAuth) { cauth.registry = registry }}
func (c \*containerAuth) getRegistry() string { return c.registry}
// Verify verifies a container artifact using sigstore// isSigned is true only if we were able to find a signature/attestation and it had everything needed to construct the// sigstore bundle.// isVerified is true only if we were able to verify the constructed bundle against the configured sigstore instance.func Verify( ctx context.Context, sev \*verify.SignedEntityVerifier, owner, artifact, checksumref string, authOpts ...AuthMethod,) ([]verifyif.Result, error) { logger := zerolog.Ctx(ctx)
 cauth := newContainerAuth(authOpts...)
 logger.Info(). Str("imageRef", BuildImageRef(cauth.getRegistry(), owner, artifact, checksumref)). Msg("verifying container artifact") // Construct the bundle(s) - OCI image or GitHub's attestation endpoint bundles, err := getSigstoreBundles(ctx, owner, artifact, checksumref, cauth) if err != nil && !errors.Is(err, ErrProvenanceNotFoundOrIncomplete) { // We got some other unexpected error prior to querying for the signature/attestation return nil, err } logger.Info().Int("count", len(bundles)).Msg("number of sigstore bundles we managed to construct") // Exit early if we don't have any bundles to verify. We've tried building a bundle from the OCI image/the GitHub // attestation endpoint and failed. This means there's most probably no available provenance information about // this artifact, or it's incomplete. if len(bundles) == 0 || errors.Is(err, ErrProvenanceNotFoundOrIncomplete) { return []verifyif.Result{{ IsSigned: false, IsVerified: false, }}, nil }
 // Construct the verification result for each bundle we managed to generate. return getVerifiedResults(ctx, sev, bundles), nil}
// getVerifiedResults verifies the artifact using the bundles against the configured sigstore instance// and returns the extracted metadata that we need for ingestionfunc getVerifiedResults( ctx context.Context, sev \*verify.SignedEntityVerifier, bundles []sigstoreBundle,) []verifyif.Result { var results []verifyif.Result logger := zerolog.Ctx(ctx).With().Logger()
 // Verify each bundle we've constructed for \_, b := range bundles { // Create a new verification result - IsVerified and IsSigned flags are set explicitly for better visibility. // At this point, we managed to extract a bundle, so we can set the IsSigned flag to true // This doesn't mean the bundle is verified though, just that it exists res := verifyif.Result{ IsSigned: true, IsVerified: false, }
 // Verify the artifact using the bundle // Note that we verify the identity in the next step (evaluation) where we check it against what was set by the // user in their Minder profile (e.g., repository, cert. issuer, etc.) verificationResult, err := sev.Verify(b.bundle, verify.NewPolicy( verify.WithArtifactDigest(b.digestAlgo, b.digestBytes), verify.WithoutIdentitiesUnsafe(), )) if err != nil { // The bundle we provided failed verification // Log the error and continue to the next bundle, this one is considered signed but not verified logger.Err(err).Msg("error verifying bundle") results = append(results, res) continue }
 // We've successfully verified and extracted the artifact provenance information res.IsVerified = true res.VerificationResult = \*verificationResult results = append(results, res) } // Return the results return results}
// getSigstoreBundles returns the sigstore bundles, either through the OCI registry or the GitHub attestation endpointfunc getSigstoreBundles( ctx context.Context, owner, artifact, checksumref string, auth \*containerAuth,) ([]sigstoreBundle, error) { imageRef := BuildImageRef(auth.getRegistry(), owner, artifact, checksumref) // Try to build a bundle from the OCI image reference bundles, err := bundleFromOCIImage(ctx, imageRef, auth.getAuthenticator(owner)) if errors.Is(err, ErrProvenanceNotFoundOrIncomplete) && auth.ghClient != nil { // If we failed to find the signature in the OCI image, try to build a bundle from the GitHub attestation endpoint return bundleFromGHAttestationEndpoint(ctx, auth.ghClient, owner, checksumref) } else if err != nil { return nil, fmt.Errorf("error getting bundle from OCI image: %w", err) } // We either got an unexpected error or successfully built a bundle from the OCI image return bundles, nil}
// Attestation is the attestation from the GitHub attestation endpointtype Attestation struct { Bundle json.RawMessage `json:"bundle"`}
// AttestationReply is the reply from the GitHub attestation endpointtype AttestationReply struct { Attestations []Attestation `json:"attestations"`}
func bundleFromGHAttestationEndpoint( ctx context.Context, ghCli provifv1.GitHub, owner, checksumref string,) ([]sigstoreBundle, error) { logger := zerolog.Ctx(ctx)
 // Get the attestation reply from the GitHub attestation endpoint attestationReply, err := getAttestationReply(ctx, ghCli, owner, checksumref) if err != nil { return nil, fmt.Errorf("error getting attestation reply: %w", err) }
 var bundles []sigstoreBundle // Loop through all available attestations and extract the bundle and the certificate identity information for \_, att := range attestationReply.Attestations { protobufBundle, err := unmarhsalAttestationReply(&att) if err != nil { logger.Err(err).Msg("error unmarshalling attestation reply") continue }
 digest, err := getDigestFromVersion(checksumref) if err != nil { logger.Err(err).Msg("error getting digest from version") continue }
 // Store the bundle and the certificate identity we extracted from the attestation bundles = append(bundles, sigstoreBundle{ bundle: protobufBundle, digestBytes: digest, digestAlgo: containerdigest.Canonical.String(), }) }
 // There's no available provenance information about this image if we failed to find valid bundles from the attestations list if len(bundles) == 0 { return nil, ErrProvenanceNotFoundOrIncomplete }
 // Return the bundles return bundles, nil
}
func getAttestationReply( ctx context.Context, ghCli provifv1.GitHub, owner, checksumref string) (\*AttestationReply, error) { if ghCli == nil { return nil, fmt.Errorf("no github client available") }
 url := fmt.Sprintf("orgs/%s/attestations/%s", owner, checksumref) req, err := ghCli.NewRequest(http.MethodGet, url, nil) if err != nil { return nil, fmt.Errorf("error creating request: %w", err) }
 resp, err := ghCli.Do(ctx, req) if err != nil { if resp != nil && resp.StatusCode == http.StatusNotFound { return nil, fmt.Errorf("%w: %s", ErrProvenanceNotFoundOrIncomplete, err.Error()) } return nil, fmt.Errorf("error doing request: %w", err) } defer resp.Body.Close()
 var attestationReply AttestationReply if err := json.NewDecoder(resp.Body).Decode(&attestationReply); err != nil { return nil, fmt.Errorf("error decoding response: %w", err) }
 return &attestationReply, nil}
func unmarhsalAttestationReply(attestation \*Attestation) (\*bundle.ProtobufBundle, error) { var pbBundle protobundle.Bundle if err := protojson.Unmarshal(attestation.Bundle, &pbBundle); err != nil { return nil, fmt.Errorf("error unmarshaling attestation: %w", err) }
 protobufBundle, err := bundle.NewProtobufBundle(&pbBundle) if err != nil { return nil, fmt.Errorf("error creating protobuf bundle: %w", err) }
 return protobufBundle, nil}
func getDigestFromVersion(version string) ([]byte, error) { algoPrefix := containerdigest.Canonical.String() + ":" if !strings.HasPrefix(version, algoPrefix) { // TODO: support other digest algorithms? return nil, fmt.Errorf("expected digest to start with %s", algoPrefix) }
 stringDigest := strings.TrimPrefix(version, algoPrefix) if err := containerdigest.Canonical.Validate(stringDigest); err != nil { return nil, fmt.Errorf("error validating digest: %w", err) }
 digest, err := hex.DecodeString(stringDigest) if err != nil { return nil, fmt.Errorf("error decoding digest: %w", err) }
 return digest, nil}
// bundleFromOCIImage returns a ProtobufBundle based on OCI image reference.func bundleFromOCIImage(ctx context.Context, imageRef string, auth authn.Authenticator) ([]sigstoreBundle, error) { logger := zerolog.Ctx(ctx)
 // Get the signature manifest from the OCI image reference signatureRef, err := getSignatureReferenceFromOCIImage(imageRef, auth) if err != nil { return nil, fmt.Errorf("error getting signature reference from OCI image: %w", err) }
 // Parse the manifest and return a list of all simple signing layers we managed to extract simpleSigningLayers, err := getSimpleSigningLayersFromSignatureManifest(signatureRef, auth) if err != nil { return nil, fmt.Errorf("%w: %s", ErrProvenanceNotFoundOrIncomplete, err.Error()) }
 // Loop through each and build the sigstore bundles var bundles []sigstoreBundle for \_, layer := range simpleSigningLayers { // Build the verification material for the bundle verificationMaterial, err := getBundleVerificationMaterial(layer) if err != nil { logger.Err(err).Msg("error getting bundle verification material") continue }
 // Build the message signature for the bundle msgSignature, err := getBundleMsgSignature(layer) if err != nil { logger.Err(err).Msg("error getting bundle message signature") continue }
 // Construct and verify the bundle pbb := protobundle.Bundle{ MediaType: sigstoreBundleMediaType01, VerificationMaterial: verificationMaterial, Content: msgSignature, } bun, err := bundle.NewProtobufBundle(&pbb) if err != nil { logger.Err(err).Msg("error creating protobuf bundle") continue }
 // Collect the digest of the simple signing layer (this is what is signed) digestBytes, err := hex.DecodeString(layer.Digest.Hex) if err != nil { logger.Err(err).Msg("error decoding the simplesigning layer digest") continue }
 // Store the bundle and the certificate identity we extracted from the simple signing layer bundles = append(bundles, sigstoreBundle{ bundle: bun, digestAlgo: layer.Digest.Algorithm, digestBytes: digestBytes, }) }
 // There's no available provenance information about this image if we failed to find valid bundles from the list // of simple signing layers if len(bundles) == 0 { return nil, ErrProvenanceNotFoundOrIncomplete }
 // Return the bundles return bundles, nil}
// getSignatureReferenceFromOCIImage returns the simple signing layer from the OCI image referencefunc getSignatureReferenceFromOCIImage(imageRef string, auth authn.Authenticator) (string, error) { // 0. Get the auth options opts := []remote.Option{remote.WithAuth(auth)}
 // 1. Get the image reference ref, err := name.ParseReference(imageRef) if err != nil { return "", fmt.Errorf("error parsing image reference: %w", err) }
 // 2. Get the image descriptor desc, err := remote.Get(ref, opts...) if err != nil { return "", fmt.Errorf("error getting image descriptor: %w", err) }
 // 3. Get the digest digest := ref.Context().Digest(desc.Digest.String()) h, err := v1.NewHash(digest.Identifier()) if err != nil { return "", fmt.Errorf("error getting hash: %w", err) }
 // 4. Construct the signature reference - sha256-<hash>.sig sigTag := digest.Context().Tag(fmt.Sprint(h.Algorithm, "-", h.Hex, ".sig"))
 // 5. Return the reference return sigTag.Name(), nil}
// getSimpleSigningLayersFromSignatureManifest returns the identity and issuer from the certificatefunc getSimpleSigningLayersFromSignatureManifest(manifestRef string, auth authn.Authenticator) ([]v1.Descriptor, error) { craneOpts := []crane.Option{crane.WithAuth(auth)}
 // Get the manifest of the signature mf, err := crane.Manifest(manifestRef, craneOpts...) if err != nil { return nil, fmt.Errorf("error getting signature manifest: %w", err) }
 // Parse the manifest manifest, err := v1.ParseManifest(bytes.NewReader(mf)) if err != nil { return nil, fmt.Errorf("error parsing signature manifest: %w", err) }
 // Loop through its layers and extract the simple signing layers var results []v1.Descriptor for \_, layer := range manifest.Layers { if layer.MediaType == "application/vnd.dev.cosign.simplesigning.v1+json" { // We found a simple signing layer, store and return it even if we may fail to parse it later results = append(results, layer) } }
 // Return the results - we may not have found any simple signing layers, but we still return the results return results, nil}
// getBundleVerificationMaterial returns the bundle verification material from the simple signing layerfunc getBundleVerificationMaterial(manifestLayer v1.Descriptor) ( \*protobundle.VerificationMaterial, error) { // 1. Get the signing certificate chain signingCert, err := getVerificationMaterialX509CertificateChain(manifestLayer) if err != nil { return nil, fmt.Errorf("error getting signing certificate: %w", err) }
 // 2. Get the transparency log entries tlogEntries, err := getVerificationMaterialTlogEntries(manifestLayer) if err != nil { return nil, fmt.Errorf("error getting tlog entries: %w", err) } // 3. Construct the verification material return &protobundle.VerificationMaterial{ Content: signingCert, TlogEntries: tlogEntries, TimestampVerificationData: nil, }, nil}
// getVerificationMaterialX509CertificateChain returns the verification material X509 certificate chain from the// simple signing layerfunc getVerificationMaterialX509CertificateChain(manifestLayer v1.Descriptor) ( \*protobundle.VerificationMaterial\_X509CertificateChain, error) { // 1. Get the PEM certificate from the simple signing layer pemCert := manifestLayer.Annotations["dev.sigstore.cosign/certificate"] // 2. Construct the DER encoded version of the PEM certificate block, \_ := pem.Decode([]byte(pemCert)) if block == nil { return nil, errors.New("failed to decode PEM block") } signingCert := protocommon.X509Certificate{ RawBytes: block.Bytes, } // 3. Construct the X509 certificate chain return &protobundle.VerificationMaterial\_X509CertificateChain{ X509CertificateChain: &protocommon.X509CertificateChain{ Certificates: []\*protocommon.X509Certificate{&signingCert}, }, }, nil}
// getVerificationMaterialTlogEntries returns the verification material transparency log entries from the simple signing layerfunc getVerificationMaterialTlogEntries(manifestLayer v1.Descriptor) ( []\*protorekor.TransparencyLogEntry, error) { // 1. Get the bundle annotation bun := manifestLayer.Annotations["dev.sigstore.cosign/bundle"] var jsonData map[string]interface{} err := json.Unmarshal([]byte(bun), &jsonData) if err != nil { return nil, fmt.Errorf("error unmarshaling json: %w", err) } // 2. Get the log index, log ID, integrated time, signed entry timestamp and body logIndex, ok := jsonData["Payload"].(map[string]interface{})["logIndex"].(float64) if !ok { return nil, fmt.Errorf("error getting logIndex") } logIndexInt64 := int64(logIndex) li, ok := jsonData["Payload"].(map[string]interface{})["logID"].(string) if !ok { return nil, fmt.Errorf("error getting logID") } logID, err := hex.DecodeString(li) if err != nil { return nil, fmt.Errorf("error decoding logID: %w", err) } integratedTime, ok := jsonData["Payload"].(map[string]interface{})["integratedTime"].(float64) if !ok { return nil, fmt.Errorf("error getting integratedTime") } set, ok := jsonData["SignedEntryTimestamp"].(string) if !ok { return nil, fmt.Errorf("error getting SignedEntryTimestamp") } signedEntryTimestamp, err := base64.StdEncoding.DecodeString(set) if err != nil { return nil, fmt.Errorf("error decoding signedEntryTimestamp: %w", err) } // 3. Unmarshal the body and extract the rekor KindVersion details body, ok := jsonData["Payload"].(map[string]interface{})["body"].(string) if !ok { return nil, fmt.Errorf("error getting body") } bodyBytes, err := base64.StdEncoding.DecodeString(body) if err != nil { return nil, fmt.Errorf("error decoding body: %w", err) } err = json.Unmarshal(bodyBytes, &jsonData) if err != nil { return nil, fmt.Errorf("error unmarshaling json: %w", err) } apiVersion := jsonData["apiVersion"].(string) kind := jsonData["kind"].(string) // 4. Construct the transparency log entry list return []\*protorekor.TransparencyLogEntry{ { LogIndex: logIndexInt64, LogId: &protocommon.LogId{ KeyId: logID, }, KindVersion: &protorekor.KindVersion{ Kind: kind, Version: apiVersion, }, IntegratedTime: int64(integratedTime), InclusionPromise: &protorekor.InclusionPromise{ SignedEntryTimestamp: signedEntryTimestamp, }, InclusionProof: nil, CanonicalizedBody: bodyBytes, }, }, nil}
// getBundleMsgSignature returns the bundle message signature from the simple signing layerfunc getBundleMsgSignature(simpleSigningLayer v1.Descriptor) (\*protobundle.Bundle\_MessageSignature, error) { // 1. Get the message digest algorithm var msgHashAlg protocommon.HashAlgorithm switch simpleSigningLayer.Digest.Algorithm { case "sha256": msgHashAlg = protocommon.HashAlgorithm\_SHA2\_256 default: return nil, fmt.Errorf("unknown digest algorithm: %s", simpleSigningLayer.Digest.Algorithm) } // 2. Get the message digest digest, err := hex.DecodeString(simpleSigningLayer.Digest.Hex) if err != nil { return nil, fmt.Errorf("error decoding digest: %w", err) } // 3. Get the signature s := simpleSigningLayer.Annotations["dev.cosignproject.cosign/signature"] sig, err := base64.StdEncoding.DecodeString(s) if err != nil { return nil, fmt.Errorf("error decoding manSig: %w", err) } // Construct the bundle message signature return &protobundle.Bundle\_MessageSignature{ MessageSignature: &protocommon.MessageSignature{ MessageDigest: &protocommon.HashOutput{ Algorithm: msgHashAlg, Digest: digest, }, Signature: sig, }, }, nil}
// BuildImageRef returns the OCI image referencefunc BuildImageRef(registry, owner, artifact, checksum string) string { return fmt.Sprintf("%s/%s/%s@%s", registry, owner, artifact, checksum)}
type sigstoreBundle struct { bundle \*bundle.ProtobufBundle digestBytes []byte digestAlgo string}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_801d6b97_20250111_034423.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmindersec%2Fminder%2Fsecurity%2Fadvisories%2FGHSA-8fmj-33gw-g7pw)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmindersec%2Fminder%2Fsecurity%2Fadvisories%2FGHSA-8fmj-33gw-g7pw)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=mindersec%2Fminder)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mindersec](/mindersec)
/
**[minder](/mindersec/minder)**
Public

* [Notifications](/login?return_to=%2Fmindersec%2Fminder) You must be signed in to change notification settings
* [Fork
  41](/login?return_to=%2Fmindersec%2Fminder)
* [Star
   306](/login?return_to=%2Fmindersec%2Fminder)

* [Code](/mindersec/minder)
* [Issues
  127](/mindersec/minder/issues)
* [Pull requests
  11](/mindersec/minder/pulls)
* [Discussions](/mindersec/minder/discussions)
* [Actions](/mindersec/minder/actions)
* [Wiki](/mindersec/minder/wiki)
* [Security](/mindersec/minder/security)
* [Insights](/mindersec/minder/pulse)

Additional navigation options

* [Code](/mindersec/minder)
* [Issues](/mindersec/minder/issues)
* [Pull requests](/mindersec/minder/pulls)
* [Discussions](/mindersec/minder/discussions)
* [Actions](/mindersec/minder/actions)
* [Wiki](/mindersec/minder/wiki)
* [Security](/mindersec/minder/security)
* [Insights](/mindersec/minder/pulse)

# Denial of service of Minder Server from maliciously crafted GitHub attestations

Moderate

[JAORMX](/JAORMX)
published
GHSA-8fmj-33gw-g7pw
May 27, 2024

## Package

No package listed

## Affected versions

< 0.20240520.2157\_ref.e554e73

## Patched versions

0.20240520.2157\_ref.e554e73

## Description

Minder is vulnerable to a denial-of-service (DoS) attack which could allow an attacker to crash the Minder server and deny other users access to it.

The root cause of the vulnerability is that Minders sigstore verifier reads an untrusted response entirely into memory without enforcing a limit on the response body. An attacker can exploit this by making Minder make a request to an attacker-controlled endpoint which returns a response with a large body which will crash the Minder server.

Specifically, the point of failure is where Minder parses the response from the GitHub attestations endpoint in `getAttestationReply`. Here, Minder makes a request to the `orgs/$owner/attestations/$checksumref` GitHub endpoint (line 285) and then parses the response into the `AttestationReply` (line 295):

<https://github.com/stacklok/minder/blob/daccbc12e364e2d407d56b87a13f7bb24cbdb074/internal/verifier/sigstore/container/container.go#L271-L300>

The way Minder parses the response on line 295 makes it prone to DoS if the response is large enough. Essentially, the response needs to be larger than the machine has available memory.

To demonstrate this in an isolated way, consider the following example:

```
package main

import (
        "encoding/json"
        "fmt"
        "io"
        "strings"
)

type Attestation struct {
        Bundle json.RawMessage `json:"bundle"`
}

type AttestationReply struct {
        Attestations []Attestation `json:"attestations"`
}

func main() {
        m1 := strings.NewReader("{\"attestations\":[")
        maliciousBody := strings.NewReader(strings.Repeat("{\"bundle\":{\"k\": \"v\"{{,", 100000000))
        m2 := strings.NewReader("{\"bundle\":{\"k\": \"v\"}}]}")
        maliciousBodyReader := io.MultiReader(m1, maliciousBody, maliciousBody, maliciousBody, m2)
        fmt.Println("Created malicious body")

        var attestationReply AttestationReply
        _ = json.NewDecoder(maliciousBodyReader).Decode(&attestationReply)
}
```

This example mimics the behavior of Minders `getAttestationReply` and how a malicious response body passed to `getAttestationReply’s` parsing of the response will cause DoS.

When running this script locally on my system, Go incrementally increases memory consumption up to above 90%, freezes the machine and then performs a sigkill.

## Attack vector

The content that is hosted at the `orgs/$owner/attestations/$checksumref` GitHub attestation endpoint is controlled by users including unauthenticated users to Minders threat model. However, a user will need to configure their own Minder settings to cause Minder to make Minder send a request to fetch the attestations. The user would need to know of a package whose attestations were configured in such a way that they would return a large response when fetching them. As such, the steps needed to carry out this attack would look as such:

1. The attacker adds a package to ghcr.io with attestations that can be fetched via the `orgs/$owner/attestations/$checksumref` GitHub endpoint.
2. The attacker registers on Minder and makes Minder fetch the attestations.
3. Minder fetches attestations and crashes thereby being denied of service.

### Severity

Moderate

5.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H

### CVE ID

CVE-2024-35238

### Weaknesses

No CWEs

### Credits

* [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&v=4)](/AdamKorcz)
  [AdamKorcz](/AdamKorcz)
  Reporter
* [![@DavidKorczynski](https://avatars.githubusercontent.com/u/657617?s=40&v=4)](/DavidKorczynski)
  [DavidKorczynski](/DavidKorczynski)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_684258d5_20250111_034423.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmindersec%2Fminder%2Fcommit%2Ffe321d345b4f738de6a06b13207addc72b59f892)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmindersec%2Fminder%2Fcommit%2Ffe321d345b4f738de6a06b13207addc72b59f892)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=mindersec%2Fminder)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mindersec](/mindersec)
/
**[minder](/mindersec/minder)**
Public

* [Notifications](/login?return_to=%2Fmindersec%2Fminder) You must be signed in to change notification settings
* [Fork
  41](/login?return_to=%2Fmindersec%2Fminder)
* [Star
   306](/login?return_to=%2Fmindersec%2Fminder)

* [Code](/mindersec/minder)
* [Issues
  127](/mindersec/minder/issues)
* [Pull requests
  11](/mindersec/minder/pulls)
* [Discussions](/mindersec/minder/discussions)
* [Actions](/mindersec/minder/actions)
* [Wiki](/mindersec/minder/wiki)
* [Security](/mindersec/minder/security)
* [Insights](/mindersec/minder/pulse)

Additional navigation options

* [Code](/mindersec/minder)
* [Issues](/mindersec/minder/issues)
* [Pull requests](/mindersec/minder/pulls)
* [Discussions](/mindersec/minder/discussions)
* [Actions](/mindersec/minder/actions)
* [Wiki](/mindersec/minder/wiki)
* [Security](/mindersec/minder/security)
* [Insights](/mindersec/minder/pulse)

## Commit

[Permalink](/mindersec/minder/commit/fe321d345b4f738de6a06b13207addc72b59f892)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-8fmj-33gw-g7pw](https://github.com/advisories/GHSA-8fmj-33gw-g7pw "GHSA-8fmj-33gw-g7pw")

[Browse files](/mindersec/minder/tree/fe321d345b4f738de6a06b13207addc72b59f892)
Browse the repository at this point in the history

```
Similarly to other readers, this also limits the size. In this case, it
was set to 10MB, since attestations can get pretty big.

Signed-off-by: Juan Antonio Osorio <ozz@stacklok.com>
```

* Loading branch information

[![@JAORMX](https://avatars.githubusercontent.com/u/145564?s=40&v=4)](/JAORMX)

[JAORMX](/mindersec/minder/commits?author=JAORMX "View all commits by JAORMX")
authored
May 20, 2024

1 parent
[2d7e6b3](/mindersec/minder/commit/2d7e6b3c7b17b7a15978c62228e0303e5f69271c)

commit fe321d3

Showing
**1 changed file**
with
**9 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

11 changes: 9 additions & 2 deletions

11
[internal/verifier/sigstore/container/container.go](#diff-1f0b608f02e8d9dc1bfdefad57e74550e59c5b9acd2e727369a8b177ceede25e "internal/verifier/sigstore/container/container.go")

Show comments

[View file](/mindersec/minder/blob/fe321d345b4f738de6a06b13207addc72b59f892/internal/verifier/sigstore/container/container.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -24,6 +24,7 @@ import ( |
|  |  | "encoding/pem" |
|  |  | "errors" |
|  |  | "fmt" |
|  |  | "io" |
|  |  | "net/http" |
|  |  | "strings" |
|  |  |  |
| Expand All | | @@ -49,6 +50,10 @@ var ( |
|  |  | // ErrProvenanceNotFoundOrIncomplete is returned when there's no provenance info (missing .sig or attestation) or |
|  |  | // has incomplete data |
|  |  | ErrProvenanceNotFoundOrIncomplete = errors.New("provenance not found or incomplete") |
|  |  |  |
|  |  | // MaxAttestationsBytesLimit is the maximum number of bytes we're willing to read from the attestation endpoint |
|  |  | // We'll limit this to 10mb for now |
|  |  | MaxAttestationsBytesLimit int64 = 10 \* 1024 \* 1024 |
|  |  | ) |
|  |  |  |
|  |  | const ( |
| Expand Down  Expand Up | | @@ -291,8 +296,9 @@ func getAttestationReply( |
|  |  | } |
|  |  | defer resp.Body.Close() |
|  |  |  |
|  |  | lr := io.LimitReader(resp.Body, MaxAttestationsBytesLimit) |
|  |  | var attestationReply AttestationReply |
|  |  | if err := json.NewDecoder(resp.Body).Decode(&attestationReply); err != nil { |
|  |  | if err := json.NewDecoder(lr).Decode(&attestationReply); err != nil { |
|  |  | return nil, fmt.Errorf("error decoding response: %w", err) |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -446,7 +452,8 @@ func getSimpleSigningLayersFromSignatureManifest(manifestRef string, auth authn. |
|  |  | } |
|  |  |  |
|  |  | // Parse the manifest |
|  |  | manifest, err := v1.ParseManifest(bytes.NewReader(mf)) |
|  |  | r := io.LimitReader(bytes.NewReader(mf), MaxAttestationsBytesLimit) |
|  |  | manifest, err := v1.ParseManifest(r) |
|  |  | if err != nil { |
|  |  | return nil, fmt.Errorf("error parsing signature manifest: %w", err) |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `fe321d3`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmindersec%2Fminder%2Fcommit%2Ffe321d345b4f738de6a06b13207addc72b59f892) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


