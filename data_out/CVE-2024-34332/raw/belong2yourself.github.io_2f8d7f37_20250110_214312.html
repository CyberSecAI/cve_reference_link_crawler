<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/vulnerabilities/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/vulnerabilities/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-178247046-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-178247046-1', { 'anonymize_ip': true }); </script> <script type="text/javascript" src="/vulnerabilities/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/vulnerabilities/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>SANDRA Elevation-of-Privileges | Advisories</title><meta name="generator" content="Jekyll v3.9.5" /><meta property="og:title" content="SANDRA Elevation-of-Privileges" /><meta property="og:locale" content="en_US" /><meta name="description" content="Collection of advisories presented with a good jeckyll theme" /><meta property="og:description" content="Collection of advisories presented with a good jeckyll theme" /><link rel="canonical" href="https://belong2yourself.github.io/vulnerabilities/docs/SANDRA/Elevation-of-Privileges/readme/" /><meta property="og:url" content="https://belong2yourself.github.io/vulnerabilities/docs/SANDRA/Elevation-of-Privileges/readme/" /><meta property="og:site_name" content="Advisories" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="SANDRA Elevation-of-Privileges" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Collection of advisories presented with a good jeckyll theme","headline":"SANDRA Elevation-of-Privileges","url":"https://belong2yourself.github.io/vulnerabilities/docs/SANDRA/Elevation-of-Privileges/readme/"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="https://belong2yourself.github.io/vulnerabilities/" class="site-title lh-tight"> Advisories </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="https://belong2yourself.github.io/vulnerabilities/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/SitemagicCMS/readme/" class="nav-list-link">Sitemagic CMS</a><ul class="nav-list "><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/SitemagicCMS/Cross-Site-Request-Forgery/readme/" class="nav-list-link">CVE-2019-18220 - Cross-Site-Request-Forgery (CSRF)</a><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/SitemagicCMS/Cross-Site-Scripting/readme/" class="nav-list-link">CVE-2019-18219 - Reflected Cross-Site-Scripting</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/NopCommerce/readme/" class="nav-list-link">NopCommerce Shopping CMS</a><ul class="nav-list "><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/NopCommerce/Cross-Site-Request-Forgery/readme/" class="nav-list-link">CVE-2019-19685 - Cross-Site-Request-Forgery (CSRF)</a><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/NopCommerce/Cross-Site-Scripting/readme/" class="nav-list-link">CVE-2019-19682 - Stored Cross-Site-Scripting</a><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/NopCommerce/Privilege%20Escalation%20via%20Path%20Traversal/readme/" class="nav-list-link">CVE-2019-19684 - Privilege Escalation via Path Traversal</a><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/NopCommerce/Privilege%20Escalation%20via%20Plugin%20Upload/readme/" class="nav-list-link">CVE-2019-19684 - Privilege Escalation via unprotected Plugin Upload</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/Subrion%20CMS/readme/" class="nav-list-link">Subrion CMS</a><ul class="nav-list "><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/Subrion%20CMS/Session%20Fixation/readme/" class="nav-list-link">CVE-2020-12467 - Session Fixation</a><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/Subrion%20CMS/CSV%20Injection/readme/" class="nav-list-link">CVE-2020-12468 - CSV Injection via Export Language</a><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/Subrion%20CMS/Insecure%20Deserialization/readme/" class="nav-list-link">Insecure Deserialization</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/Subrion%20CMS/Insecure%20Deserialization/Actions%20-%20Authenticated%20PHP%20Object%20Injection/readme/" class="nav-list-link">Actions PHP Object Injection</a><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/Subrion%20CMS/Insecure%20Deserialization/Subpages%20-%20Authenticated%20PHP%20Object%20Injection/readme/" class="nav-list-link">CVE-2020-12469 - Subpages Arbitrary File Deletion</a></ul></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/MonoX%20CMS/readme/" class="nav-list-link">MonoX CMS</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/MonoX%20CMS/Multiple%20Cross-Site-Scripting/readme/" class="nav-list-link">CVE-2020-12472 - Multiple Cross-Site-Scripting</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/MonoX%20CMS/Multiple%20Cross-Site-Scripting/Blog%20Comments%20-%20Stored%20Cross-Site%20Scripting/readme/" class="nav-list-link">Sored XSS in comments</a><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/MonoX%20CMS/Multiple%20Cross-Site-Scripting/Blog%20Description%20-%20Stored%20Cross-Site%20Scripting/readme/" class="nav-list-link">Sored XSS in Blog Description</a><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/MonoX%20CMS/Multiple%20Cross-Site-Scripting/User%20Status%20-%20Stored%20Cross-Site%20Scripting/readme/" class="nav-list-link">Sored XSS in user status</a></ul><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/MonoX%20CMS/Privilege%20Escalation%20via%20ConvertVideo/readme/" class="nav-list-link">CVE-2020-12473 - Remote Command Execution via Convert Video</a><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/MonoX%20CMS/Privilege%20Escalation%20via%20Template%20Modification/readme/" class="nav-list-link">CVE-2020-12470 - Remote Command Execution via Template Tampering</a><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/MonoX%20CMS/Remote%20Code%20Execution%20via%20Insecure%20Deserialization/readme/" class="nav-list-link">CVE-2020-12471 - RCE via Insecure Deserialization</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/MonoX%20CMS/Remote%20Code%20Execution%20via%20Insecure%20Deserialization/HTML5Upload%20-%20Remote%20Code%20Execution%20via%20Insecure%20Deserialization/readme/" class="nav-list-link">RCE via HTML5Upload and SilverLightUploadHandler</a><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/MonoX%20CMS/Remote%20Code%20Execution%20via%20Insecure%20Deserialization/Photogallery%20-%20Remote%20Code%20Execution%20via%20Insecure%20Deserialization/readme/" class="nav-list-link">RCE via Photogallery</a></ul></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/readme/" class="nav-list-link">ProVide FTP Server for Windows</a><ul class="nav-list "><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20User%20Interface%20-%20Cross-Site%20Request%20Forgery/readme/" class="nav-list-link">CVE-2020-11701 - CSRF in Web User Interface</a><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20User%20Interface%20-%20Multiple%20Cross-Site-Scripting/readme/" class="nav-list-link">CVE-2020-11702 - Multiple XSS in Web User Interface</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20User%20Interface%20-%20Multiple%20Cross-Site-Scripting/Waitedit%20-%20Reflected%20Cross-Site%20Scripting/readme/" class="nav-list-link">Reflected XSS in /ajax/waitedit</a><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20User%20Interface%20-%20Multiple%20Cross-Site-Scripting/Collaborate%20-%20Stored%20Cross-Site%20Scripting/readme/" class="nav-list-link">Stored XSS in /ajax/collaborate</a><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20User%20Interface%20-%20Multiple%20Cross-Site-Scripting/Share%20-%20Stored%20Cross-Site%20Scripting/readme/" class="nav-list-link">Stored XSS in /ajax/share</a><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20User%20Interface%20-%20Multiple%20Cross-Site-Scripting/Collaborate%20-%20Reflected%20Cross-Site%20Scripting/readme/" class="nav-list-link">Reflected XSS in /ajax/collaborate</a><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20User%20Interface%20-%20Multiple%20Cross-Site-Scripting/Deletemultiple%20-%20Reflected%20Cross-Site%20Scripting/readme/" class="nav-list-link">Reflected XSS in /ajax/deletemultiple</a><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20User%20Interface%20-%20Multiple%20Cross-Site-Scripting/Share%20-%20Reflected%20Cross-Site%20Scripting/readme/" class="nav-list-link">Reflected XSS in /ajax/shared</a></ul><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20User%20Interface%20-%20HTTP%20Response%20Splitting/readme/" class="nav-list-link">CVE-2020-11703 - HTTP Response Splitting</a><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20Admin%20Interface%20-%20Multiple%20Cross-Site-Scripting/readme/" class="nav-list-link">CVE-2020-11704 - Multiple XSS in Web Admin Interface</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20Admin%20Interface%20-%20Multiple%20Cross-Site-Scripting/SetUserInfo%20-%20Stored%20Cross-Site%20Scripting/readme/" class="nav-list-link">Stored XSS in /ajax/SetUserInfo</a><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20Admin%20Interface%20-%20Multiple%20Cross-Site-Scripting/GetUserInfo%20-%20Reflected%20Cross-Site%20Scripting/readme/" class="nav-list-link">Reflected XSS in /ajax/GetUserInfo</a><li class="nav-list-item "> <a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20Admin%20Interface%20-%20Multiple%20Cross-Site-Scripting/GetInheritedProperties%20-%20Reflected%20Cross-Site%20Scripting/readme/" class="nav-list-link">Reflected XSS in /ajax/GetInheritedProperties</a></ul><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20Admin%20Interface%20-%20Authenticated%20Arbitrary%20File%20Overwrite/readme/" class="nav-list-link">CVE-2020-11705 - Path Traversal</a><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20Admin%20Interface%20-%20Cross-Site-Request-Forgery/readme/" class="nav-list-link">CVE-2020-11706 - CSRF in Admin Interface</a><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Sandbox%20Escape%20via%20Symlink%20or%20Junction/readme/" class="nav-list-link">CVE-2020-11707 - Jail Escape (Privilege Escalation) via Symlink</a><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Web%20Admin%20Interface%20-%20Privilege%20Escalation%20via%20EXECUTE()/readme/" class="nav-list-link">CVE-2020-11708 - Privilege Escalation via EXECUTE()</a><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/ProVide/Local%20Privilege%20Escalation%20via%20Unquoted%20Service%20Path/readme/" class="nav-list-link">LPE via Unquoted-Service-Path</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/Foscam/readme/" class="nav-list-link">Foscam VMS</a><ul class="nav-list "><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/Foscam/Foscam%20UID%20Denial-of-Service/readme/" class="nav-list-link">UID Denial-of-Service</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/AIDA/readme/" class="nav-list-link">AIDA</a><ul class="nav-list "><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/AIDA/Elevation-of-Privileges/readme/" class="nav-list-link">AIDA64 Elevation-of-Privileges</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/Sricam/readme/" class="nav-list-link">Sricam DeviceViewer</a><ul class="nav-list "><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/Sricam/Arbitrary%20Password%20Change%20via%20Stack-Based%20Memory%20Corruption/readme/" class="nav-list-link">Arbitrary Password Change via Stack-Based Memory Corruption</a><li class="nav-list-item "><a href="https://belong2yourself.github.io/vulnerabilities/docs/Sricam/Privilege%20Escalation%20via%20Stack-Based%20Memory%20Corruption/readme/" class="nav-list-link">Code Execution via Stack-Based Memory Corruption</a></ul><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://belong2yourself.github.io/vulnerabilities/docs/SANDRA/readme/" class="nav-list-link">SANDRA</a><ul class="nav-list "><li class="nav-list-item active"><a href="https://belong2yourself.github.io/vulnerabilities/docs/SANDRA/Elevation-of-Privileges/readme/" class="nav-list-link active">SANDRA Elevation-of-Privileges</a></ul></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Advisories" aria-label="Search Advisories" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="//github.com/klezVirus" class="site-button" > whoami </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="https://belong2yourself.github.io/vulnerabilities/docs/SANDRA/readme/">SANDRA</a><li class="breadcrumb-nav-list-item"><span>SANDRA Elevation-of-Privileges</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="sandra-elevation-of-privileges-via-arbitrary-physical-memory-mapping"> <a href="#sandra-elevation-of-privileges-via-arbitrary-physical-memory-mapping" class="anchor-heading" aria-labelledby="sandra-elevation-of-privileges-via-arbitrary-physical-memory-mapping"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SANDRA Elevation of Privileges via Arbitrary Physical Memory Mapping</h1><h2 id="summary"> <a href="#summary" class="anchor-heading" aria-labelledby="summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Summary</h2><p>The SANDRA Kernel Driver does not validate data received from the IRP-&gt;SystemBuffer.</p><p>Some IOCTL codes implement a logic where parameters arriving from the SystemBuffer are directly passed without validation to a routine that:</p><ul><li>Execute the <code class="language-plaintext highlighter-rouge">MmMapIoSpace</code> function which takes physical address, length, and cache type (hardcoded to 0) and maps specified physical memory into system memory.<li>Execute <code class="language-plaintext highlighter-rouge">IoAllocateMdl</code> that uses the virtual address from <code class="language-plaintext highlighter-rouge">MmMapIoSpace</code> and the same Length value to associate the created MDL (Memory Descriptor List) with an IRP (I/O Request Packet).<li>Then calls <code class="language-plaintext highlighter-rouge">MmBuildMdlForNonPagedPool</code>, that takes the newly created MDL and initialize the memory for the buffer.<li>Finally, a call to <code class="language-plaintext highlighter-rouge">MmMapLockedPagesSpecifyCache</code>, which takes the allocated physical memory and maps it to a user-mode buffer.</ul><p>Any user on the system can fully control the Physical Address and the size passed to the <code class="language-plaintext highlighter-rouge">MmMapIoSpace</code>, and gets back the associated mapped user-mode address.</p><p>This technique can be successfully exploited using a physical memory “scanning” approach to find an elevated process token (<a href="https://twitter.com/FuzzySec">Ruben Boonen</a> - IBM X-Force), egregiously explained by <a href="https://twitter.com/h0mbre_">h0mbre</a></p><p>Affected by the vulnerability was the 0x22a428 IOCTL code.</p><p>The weakness was discovered during February 2024, and was assigned CVE-2024-34332.</p><h2 id="vulnerable-code"> <a href="#vulnerable-code" class="anchor-heading" aria-labelledby="vulnerable-code"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Vulnerable code</h2><h3 id="ioctl-dispatch"> <a href="#ioctl-dispatch" class="anchor-heading" aria-labelledby="ioctl-dispatch"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> IOCTL Dispatch</h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
if (uVar5 &lt; 0x22a429) {
  if (uVar5 == 0x22a428) {
    if ((_Dst != (ulonglong *)0x0) &amp;&amp; (0x37 &lt; uVar6)) {
      FUN_00011ab0(0x15110);
      puVar19 = &amp;DAT_00015110;
LAB_000121fe:
      lVar17 = VulnerablePhysicalAllocation(_Dst,(longlong)puVar19);
      cVar9 = (char)lVar17;
LAB_00012206:
      bVar23 = cVar9 == '\0';
LAB_00012209:
      uVar15 = uVar21;
      if (!bVar23) goto LAB_0001231d;
LAB_00012c5c:
      uVar20 = uVar22;
      uVar15 = 0xc0000001;
      goto LAB_0001231d;
    }
  }
...
</code></pre></div></div><h2 id="vulnerable-function"> <a href="#vulnerable-function" class="anchor-heading" aria-labelledby="vulnerable-function"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Vulnerable Function</h2><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">longlong</span> <span class="nf">VulnerablePhysicalAllocation</span><span class="p">(</span><span class="n">PVOID</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">PVOID</span> <span class="n">outBuffer</span><span class="p">)</span>

<span class="p">{</span>
  <span class="p">...</span>
  <span class="n">VirtualAddress</span> <span class="o">=</span> <span class="n">MmMapIoSpace</span><span class="p">(</span>
      <span class="o">*</span><span class="p">(</span><span class="n">UINT64</span><span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="p">,</span><span class="o">*</span><span class="p">(</span><span class="n">UINT64</span><span class="o">*</span><span class="p">)((</span><span class="n">UINT64</span><span class="p">)</span><span class="n">buffer</span> <span class="o">+</span> <span class="mh">0x8</span><span class="p">),</span> <span class="o">*</span><span class="p">(</span><span class="n">UINT64</span><span class="o">*</span><span class="p">)((</span><span class="n">UINT64</span><span class="p">)</span><span class="n">buffer</span> <span class="o">+</span> <span class="mh">0x14</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
      <span class="p">);</span>
  <span class="o">*</span><span class="p">(</span><span class="n">PVOID</span> <span class="o">*</span><span class="p">)(</span><span class="n">outBuffer</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">)</span> <span class="o">=</span> <span class="n">VirtualAddress</span><span class="p">;</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="n">VirtualAddress</span> <span class="o">!=</span> <span class="p">(</span><span class="n">PVOID</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">UINT64</span><span class="o">*</span><span class="p">)((</span><span class="n">UINT64</span><span class="p">)</span><span class="n">buffer</span> <span class="o">+</span> <span class="mh">0x16</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">MemoryDescriptorList</span> <span class="o">=</span> <span class="n">IoAllocateMdl</span><span class="p">(</span>
        <span class="n">VirtualAddress</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">DWORD</span><span class="o">*</span><span class="p">)((</span><span class="n">UINT64</span><span class="p">)</span><span class="n">buffer</span> <span class="o">+</span> <span class="mh">0x10</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span>
        <span class="p">);</span>
      
      <span class="o">*</span><span class="p">(</span><span class="n">PMDL</span> <span class="o">*</span><span class="p">)(</span><span class="n">outBuffer</span> <span class="o">+</span> <span class="mh">0x20</span><span class="p">)</span> <span class="o">=</span> <span class="n">MemoryDescriptorList</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">MemoryDescriptorList</span> <span class="o">==</span> <span class="p">(</span><span class="n">PMDL</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="n">MmBuildMdlForNonPagedPool</span><span class="p">(</span><span class="n">MemoryDescriptorList</span><span class="p">);</span>
      
      <span class="n">VirtualAddress</span> <span class="o">=</span> <span class="n">MmMapLockedPagesSpecifyCache</span><span class="p">(</span>
        <span class="o">*</span><span class="p">(</span><span class="n">PMDLX</span> <span class="o">*</span><span class="p">)(</span><span class="n">outBuffer</span> <span class="o">+</span> <span class="mh">0x20</span><span class="p">),</span><span class="sc">'\x01'</span><span class="p">,</span>
        <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">UINT64</span><span class="o">*</span><span class="p">)((</span><span class="n">UINT64</span><span class="p">)</span><span class="n">buffer</span> <span class="o">+</span> <span class="mh">0x14</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">),</span>
        <span class="o">*</span><span class="p">(</span><span class="n">UINT64</span><span class="o">*</span><span class="p">)((</span><span class="n">UINT64</span><span class="p">)</span><span class="n">buffer</span> <span class="o">+</span> <span class="mh">0x8</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="n">NormalPagePriority</span>
        <span class="p">);</span>
      <span class="o">*</span><span class="p">(</span><span class="n">PVOID</span> <span class="o">*</span><span class="p">)(</span><span class="n">outBuffer</span> <span class="o">+</span> <span class="mh">0x30</span><span class="p">)</span> <span class="o">=</span> <span class="n">VirtualAddress</span><span class="p">;</span>
    <span class="p">}</span>
   <span class="p">...</span>
   <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">longlong</span><span class="p">)</span><span class="n">VirtualAddress</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="proof-of-concept"> <a href="#proof-of-concept" class="anchor-heading" aria-labelledby="proof-of-concept"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Proof-of-Concept</h2><p>It is possible for a low-privileged user in low integrity to elevate his privileges to NT System.</p><h2 id="remediation"> <a href="#remediation" class="anchor-heading" aria-labelledby="remediation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Remediation</h2><p>No fix has been released or planned to be released for this bug.</p><h2 id="references"> <a href="#references" class="anchor-heading" aria-labelledby="references"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> References</h2><ul><li><a href="https://www.ired.team/miscellaneous-reversing-forensics/windows-kernel-internals/how-kernel-exploits-abuse-tokens-for-privilege-escalation">Token Abuse for Privilege Escalation in Kernel</a><li><a href="https://fuzzysecurity.com/tutorials/expDev/23.html">Kernel Exploitation - _EPROCESS Hunt</a><li><a href="https://h0mbre.github.io/atillk64_exploit/#">Kernel Exploitation - Kernel-2-User Mode Mapping Vulnerability</a></ul><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-000 mb-0">Copyright &copy; 2019-2020 Alessandro Magnosi. Distributed by an <a href="https://github.com/belong2yourself/vulnerabilities/tree/master/LICENSE.txt">MIT license.</a></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/belong2yourself/vulnerabilities/tree/master/docs/SANDRA/Elevation-of-Privileges/readme.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
