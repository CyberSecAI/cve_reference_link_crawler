
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flatte-soft%2Fkartlanpwn)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flatte-soft%2Fkartlanpwn)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=latte-soft%2Fkartlanpwn)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[latte-soft](/latte-soft)
/
**[kartlanpwn](/latte-soft/kartlanpwn)**
Public

* [Notifications](/login?return_to=%2Flatte-soft%2Fkartlanpwn) You must be signed in to change notification settings
* [Fork
  1](/login?return_to=%2Flatte-soft%2Fkartlanpwn)
* [Star
   56](/login?return_to=%2Flatte-soft%2Fkartlanpwn)

Information & PoC for CVE-2024-45200, Mario Kart 8 Deluxe's "KartLANPwn" buffer overflow vulnerability

[nvd.nist.gov/vuln/detail/CVE-2024-45200](https://nvd.nist.gov/vuln/detail/CVE-2024-45200 "https://nvd.nist.gov/vuln/detail/CVE-2024-45200")

### License

[CC-BY-4.0 license](/latte-soft/kartlanpwn/blob/master/LICENSE)

[56
stars](/latte-soft/kartlanpwn/stargazers) [1
fork](/latte-soft/kartlanpwn/forks) [Branches](/latte-soft/kartlanpwn/branches) [Tags](/latte-soft/kartlanpwn/tags) [Activity](/latte-soft/kartlanpwn/activity)
 [Star](/login?return_to=%2Flatte-soft%2Fkartlanpwn)

 [Notifications](/login?return_to=%2Flatte-soft%2Fkartlanpwn) You must be signed in to change notification settings

* [Code](/latte-soft/kartlanpwn)
* [Issues
  0](/latte-soft/kartlanpwn/issues)
* [Pull requests
  0](/latte-soft/kartlanpwn/pulls)
* [Actions](/latte-soft/kartlanpwn/actions)
* [Security](/latte-soft/kartlanpwn/security)
* [Insights](/latte-soft/kartlanpwn/pulse)

Additional navigation options

* [Code](/latte-soft/kartlanpwn)
* [Issues](/latte-soft/kartlanpwn/issues)
* [Pull requests](/latte-soft/kartlanpwn/pulls)
* [Actions](/latte-soft/kartlanpwn/actions)
* [Security](/latte-soft/kartlanpwn/security)
* [Insights](/latte-soft/kartlanpwn/pulse)

# latte-soft/kartlanpwn

    master[Branches](/latte-soft/kartlanpwn/branches)[Tags](/latte-soft/kartlanpwn/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[7 Commits](/latte-soft/kartlanpwn/commits/master/) | | |
| [assets](/latte-soft/kartlanpwn/tree/master/assets "assets") | | [assets](/latte-soft/kartlanpwn/tree/master/assets "assets") |  |  |
| [LICENSE](/latte-soft/kartlanpwn/blob/master/LICENSE "LICENSE") | | [LICENSE](/latte-soft/kartlanpwn/blob/master/LICENSE "LICENSE") |  |  |
| [README.md](/latte-soft/kartlanpwn/blob/master/README.md "README.md") | | [README.md](/latte-soft/kartlanpwn/blob/master/README.md "README.md") |  |  |
| [kartlanpwn-poc.py](/latte-soft/kartlanpwn/blob/master/kartlanpwn-poc.py "kartlanpwn-poc.py") | | [kartlanpwn-poc.py](/latte-soft/kartlanpwn/blob/master/kartlanpwn-poc.py "kartlanpwn-poc.py") |  |  |
| View all files | | |

## Repository files navigation

* README
* CC-BY-4.0 license
# Kart"LAN"Pwn ([CVE-2024-45200](https://nvd.nist.gov/vuln/detail/CVE-2024-45200))

[![Latte Softworks Website](https://camo.githubusercontent.com/63ba4a07be2244ba42c6b32541424b44b5c3d8e1bba713bc5a72dd91b48c4b7e/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f68747470732533412532462532466c617474652e746f2d3239383062393f7374796c653d666c6174)](https://latte.to) [![Latte Softworks Discord](https://camo.githubusercontent.com/03d8ecdee1f9391d4d64ea622e4b06ab1e09e9b5e90f28d6135e25e764049910/68747470733a2f2f696d672e736869656c64732e696f2f646973636f72642f3839323231313135353330333533383734383f6c6162656c3d4c61747465253230536f6674776f726b73253230446973636f7264266c6f676f3d646973636f7264266c6f676f436f6c6f723d46464646464626636f6c6f723d353836354632)](https://latte.to/discord)

Information & Proof-of-Concept for Mario Kart 8 Deluxe's "KartLANPwn" stack-based buffer overflow vulnerability

Written by [@regginator](https://github.com/regginator)

|  |  |
| --- | --- |
| CVE | **CVE-2024-45200** |
| CVSS 3.1 | **Undetermined** *(**[Nintendo](https://hackerone.com/reports/2611669)**.. claims it's a 4.3/10)* |
| Bounty Paid | **$512** |
| H1 Report | **[#2611669](https://hackerone.com/reports/2611669)** |
| Discovered | **July 2nd, 2024** |
| Fixed | **Sept. 11th, 2024** (**v3.0.3**) |
| Disclosed | **Sept. 29th, 2024** |

### Contents

* [Background Information](#background-information)
* [Introduction](#introduction)
  + [LAN Protocol (Browse-Reply Packet)](#lan-protocol-browse-reply-packet)
  + ["`LAN_CopyAppData`" Pseudocode](#lan_copyappdata-pseudocode)
* [Proof-of-Concept](#proof-of-concept)
  + [Demonstration of PoC](#demonstration-of-poc)
* [Closing Thoughts](#closing-thoughts)
* [Credits](#credits)
* [Report Timeline](#report-timeline)
* [License](#license)

### Background Information

KartLANPwn is a vulnerability in Mario Kart 8 Deluxe's **incorrect usage** of the [`Pia`](https://github.com/kinnay/NintendoClients/wiki/Pia-Overview) P2P networking library, in which individual implementations of "[`CopyAppData`](#lan_copyappdata-pseudocode)" are sometimes called with an `outBufSize` larger than the `out` buffer itself. This can potentially lead to user-mode remote code execution (RCE) on peers' consoles if chained with an info leak. KartLANPwn affects the usage of `Pia`'s implementations of **LAN/LDN** multiplayer and **NEX** online multiplayer.

This vulnerability affects **all** versions of Mario Kart 8 Deluxe up to and including **v3.0.1** *(v3.0.2 for China/Tencent)*, and has specifically been [demonstrated](#demonstration-of-poc) via the "LAN Play" feature on the v3.0.1 retail release of MK8DX.

As of **2024/09/11**, Nintendo has deployed a fix for KartLANPwn alongside **v3.0.3** for all regions, excluding China. As of **2024/09/27**, v3.0.3 has now also been released for China. We have safely disclosed this information after receiving permission from Nintendo.

## Introduction

The proprietary `Pia` networking library is used by first-party Nintendo Switch games with local or online-play support to provide peer-to-peer netcode implementations for LAN/LDN (local multiplayer) and the `NEX` protocol, used for online multiplayer.

For demonstration's sake, we will specifically be focused on `Pia`'s LAN protocol. The room host's console opens a UDP "discovery" socket at `:30000` on a local broadcast address (`255.255.255.255`) and other consoles on the same network are supposed to advertise "browse requests" from their own socket (also on `:30000`) to the router to forward to other devices on the same network.

The room host (our 'server') sends back an initial "browse reply" that's supposed to contain information about the room (the host's display name, Mii data, # of players, etc). Within the browse-reply packet, the length of the application data to be copied into the `out` buffer can be controlled with a value of up to 150, even though `out` is only 128 bytes wide. This allows for overflowing values on the stack frame (in this specific case, for a `pop {r4-r8, pc}`)

### LAN Protocol (Browse-Reply Packet)

*At least in the case of the `Pia` version MK8DX is using*, for what we're focusing on, browse-reply packets for LAN are constructed as follows:

(All int types are encoded as big-endian)

| Index | Pseudo-Type | Description |
| --- | --- | --- |
| 0 | `u8` | Packet type (`0x1`) |
| 1 | `u32` | Size of session info body (`1266` in our case) |
| 5 | (`42` bytes) | Misc session info fields, irrelevant to us |
| 47 | (`0x180` bytes) | **Start of space for application data** |
| 431 | `u32` | **Length of application data** |

*The rest of session info follows, though unimportant for crafting a packet for KartLANPwn*

#### "`LAN_CopyAppData`" Pseudocode

For the sake of demonstration, below is rough pseudocode from the LAN implementation of "`CopyAppData`". While nothing is inherently wrong with this function alone, incorrect usage (in MK8DX's case) can allow for the stack frame to be overwritten by our input application data in `packet`.

(function located @ `+0xA0F8C0` in `main` for MK8DX v3.0.1)

```
void LAN_CopyAppData(int* r0, int packet, int out, uint outBufSize) {
    int u1 = 68612;

    if (out != NULL) {
        // The actual length to read from the `packet` buffer at the start of our
        // application data (which our 'server' controls)
        uint appDataLength = *(uint *)(packet + 432);

        // In some cases, outBufSize is input as a larger number than the bounds of the
        // `out` buffer, which allows a stack buffer overflow (in our specific case, `*out`
        // is 128 bytes long, and outBufSize is 150!)
        if (appDataLength <= outBufSize) {
            memcpy(out, packet + 48, outBufSize); // packet[47], start of application data

            u1 = 0;
        }

        *r0 = u1;
        return;
    }

    *r0 = 68615;
    return;
}
```

## Proof-of-Concept

*See [kartlanpwn-poc.py](/latte-soft/kartlanpwn/blob/master/kartlanpwn-poc.py)*

We've provided a simple PoC script written in Python, which acts as a fake room host that replies to peers' consoles with a specially crafted "browse-reply" packet that will crash the game's process when you open the "LAN Play" menu in MK8DX from a console on the same network as the computer running the script.

#### Requirements

* A recent version of [Python 3](https://www.python.org/downloads/)

Either [download the repo's zip from GitHub directly](https://github.com/latte-soft/kartlanpwn/archive/refs/heads/master.zip), or clone using `git`:

```
git clone https://github.com/latte-soft/kartlanpwn.git && cd kartlanpwn
python3 kartlanpwn-poc.py

```

### Demonstration of PoC

See video demonstration (YouTube):

> [![YouTube - KartLANPwn Demonstration (CVE-2024-45200)](https://camo.githubusercontent.com/416153ff0c21339d4a698686f7ab6098e14a2a2fc8b01fafd76a5e77c998f8b1/68747470733a2f2f696d672e796f75747562652e636f6d2f76692f454e416b42714d714659732f302e6a7067)](https://www.youtube.com/watch?v=ENAkBqMqFYs)

And for you ARM nerds, here's a screenshot from GDB of the resulting process segfault:

[![GDB screenshot](/latte-soft/kartlanpwn/raw/master/assets/gdb.png)](/latte-soft/kartlanpwn/blob/master/assets/gdb.png)

## Closing Thoughts

It only took a couple of days to figure out the details of the bug itself, but actually making use of the overflow? That's a whole other can of worms. The Nintendo Switch kernel's usermode doesn't play around; it's extremely strict in every crevice it can be. We spent many hours exchanging and tampering with different ideas and leads, to no ultimate avail for real (arbitrary) code execution. In our specific case, even reliable ROP didn't appear very doable, being that pretty much *all* relative networking-related functions were class-based, plus we also only had direct write access to `r4-r8`. (`*_this` my beloved) Plus, w/out a previous information leak, it isn't too doable to just skip a `mov r4, r0` or what-have-you to control the `_this` pointer. Fun stuff!

Report-wise, everything was actually a relatively smooth process this time with Nintendo triage from time of report, to disclosure. While the bounty payout of **$512** was far less than I anticipated (aren't they all?), anything beats the "Nintendo Ninjas" showing up at my door..

Nintendo most definitely learned their lesson per se from the simpler days of the Wii, 3DS, and even Wii U. They did their homework; successful exploitation of any kind beyond denial-of-service crashing **from usermode** on the Switch is nearly impossible. ASLR, forced No-eXecute pages (you cannot directly write to executable memory pages, games need to use a [dedicated sysmodule](https://switchbrew.org/wiki/JIT_services) just for JIT!), inability to ROP, among other pain points. *(waiting for the modding scene to eat these words in no time..)* On the other hand, in the last couple of months, I have learned a ton about a completely new platform and architecure (to me anyway) in a very short amount of time, not to mention the awesome people I've had the pleasure of working with on KartLANPwn! (Thanks Pablo and fishguy 😄)

## Credits

* Discoverer: [reggie](https://github.com/regginator)
* Great help & a huge thanks: [PabloMK7](https://github.com/PabloMK7), [fishguy6564](https://github.com/fishguy6564)
* Emotional support 🙃: [Justus](https://github.com/0xJustus), [Sky](https://github.com/cfwsky)

## Report Timeline

| Date | Info |
| --- | --- |
| **2024/07/18** | Report submitted to Nintendo via HackerOne |
| **2024/07/31** | Report triaged internally |
| **2024/09/11** | Fix released alongside Mario Kart 8 Deluxe **v3.0.3** for all regions, excluding China |
| **2024/09/12** | Bounty paid out by Nintendo |
| **2024/09/12** | Other researchers [quite quickly found out](https://x.com/OatmealDome/status/1834350565544824979) about the fix for "`a security flaw in the game's netcode`" in the bindiff for v3.0.3 |
| **2024/09/27** | Mario Kart 8 Deluxe v3.0.3 released for the Chinese region |
| **2024/09/29** | Nintendo granted disclosure, this repository made public |
| **2024/09/30** | CVE-2024-45200 [published](https://nvd.nist.gov/vuln/detail/CVE-2024-45200) by the NVD |

## License

[![CC BY 4.0](https://camo.githubusercontent.com/38def8c3992cceac9e663ee9a61e32a843ff31f8b1572b26c62a21c4a2faa20a/68747470733a2f2f6c6963656e7365627574746f6e732e6e65742f6c2f62792f342e302f38387833312e706e67)](https://creativecommons.org/licenses/by/4.0/)

[KartLANPwn](https://github.com/latte-soft/kartlanpwn) © 2024 by reggie (reggie@latte.to), Latte Softworks (<https://latte.to>) is licensed under CC BY 4.0.

To view a copy of this license, visit <https://creativecommons.org/licenses/by/4.0/>

---

*This gif was created on July 3rd, 2024:*

[![Evil LAN-play error..](/latte-soft/kartlanpwn/raw/master/assets/lan.gif)](/latte-soft/kartlanpwn/blob/master/assets/lan.gif)

## About

Information & PoC for CVE-2024-45200, Mario Kart 8 Deluxe's "KartLANPwn" buffer overflow vulnerability

[nvd.nist.gov/vuln/detail/CVE-2024-45200](https://nvd.nist.gov/vuln/detail/CVE-2024-45200 "https://nvd.nist.gov/vuln/detail/CVE-2024-45200")

### Topics

[cve](/topics/cve "Topic: cve")
[buffer-overflow](/topics/buffer-overflow "Topic: buffer-overflow")
[nintendo-switch](/topics/nintendo-switch "Topic: nintendo-switch")
[mk8dx](/topics/mk8dx "Topic: mk8dx")
[cve-2024-45200](/topics/cve-2024-45200 "Topic: cve-2024-45200")

### Resources

[Readme](#readme-ov-file)
### License

[CC-BY-4.0 license](#CC-BY-4.0-1-ov-file)

[Activity](/latte-soft/kartlanpwn/activity)
[Custom properties](/latte-soft/kartlanpwn/custom-properties)
### Stars

[**56**
stars](/latte-soft/kartlanpwn/stargazers)
### Watchers

[**3**
watching](/latte-soft/kartlanpwn/watchers)
### Forks

[**1**
fork](/latte-soft/kartlanpwn/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Flatte-soft%2Fkartlanpwn&report=latte-soft+%28user%29)

## Languages

* [Python
  100.0%](/latte-soft/kartlanpwn/search?l=python)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

