=== Content from www.horizon3.ai_aa845e6b_20250110_112744.html ===


[Skip to main content](#brx-content)
[Skip to footer](#brx-footer)
[![Renmoe Library](https://www.horizon3.ai/wp-content/uploads/2024/11/Horizon3ai_Logo_Tagline_Horizontal_RGB-WhiteTxt_NoTag.png)](https://www.horizon3.ai)

* Solutions
  + Security Strategies
  + [→ Effective Security](/effectivesecurity)
  + [→ Splunk Logging](https://www.horizon3.ai/for-splunk/)
  + [→ Purple Team Culture](https://www.horizon3.ai/purple-team-culture/)
  + [→ Vulnerable ≠ Exploitable](https://www.horizon3.ai/vulnerable-not-exploitable/)
  + [NodeZero for Compliance](https://www.horizon3.ai/compliance/)
  + [→ PCI Complinace](https://www.horizon3.ai/compliance/pci-pentesting/)
  + [→ NIS 2 Compliance](https://www.horizon3.ai/compliance/nis-2-compliance/)
  + [The NodeZero™ Platform](https://www.horizon3.ai/nodezero/)
  + [→ Internal Pentesting](https://www.horizon3.ai/nodezero/continuous-internal-pentesting/)
  + [→ External Pentesting](https://www.horizon3.ai/nodezero/external-pentesting/)
  + [→ Kubernetes Pentesting](https://www.horizon3.ai/nodezero/kubernetes-pentesting/)
  + [→ Cloud Pentesting](https://www.horizon3.ai/nodezero/cloud-pentesting/)
  + [→ Rapid Response](https://www.horizon3.ai/nodezero/rapid-response/)
  + [→ NodeZero Insights](https://www.horizon3.ai/nodezero/insights/)
  + [→ AD Password Audit](https://www.horizon3.ai/nodezero/nodezero-ad-password-audit/)
  + [→ Phishing Impact Testing](https://www.horizon3.ai/nodezero/phishing-impact-testing/)
  + [→ NodeZero Tripwires](https://www.horizon3.ai/nodezero/nodezero-tripwires/)
  + [Documentation](https://docs.horizon3.ai/getting_started/)
  + Use Cases
  + [→ Public Sector](https://www.horizon3.ai/use-case/nodezero-in-the-public-sector/)
  + [→ Education](https://www.horizon3.ai/use-case/nodezero-in-education/)
  + [→ Healthcare](https://www.horizon3.ai/use-case/for-healthcare/)
  + [→ Manufacturing](https://www.horizon3.ai/use-case/nodezero-in-manufacturing/)
  + [→ Supply Chain](https://www.horizon3.ai/use-case/nodezero-for-supply-chain/)
  + [→ Large Organizations](/who-uses-nodezero#large-org)
  + [→ MSSP and MSP](https://www.horizon3.ai/partners/mssp-msp/)
  + [Who Uses NodeZero?](https://www.horizon3.ai/who-uses-nodezero/)
  + [→ ITOps and SecOps](/who-uses-nodezero#itops)
  + [→ Security Teams](/who-uses-nodezero#security-teams)
  + [→ Pentesters](/who-uses-nodezero#pentesters)
* Partners
  + [MSSPs and MSPs](https://www.horizon3.ai/partners/mssp-msp/)
  + [Partners](https://www.horizon3.ai/partners/)
  + [Become A Partner](https://www.horizon3.ai/partners#become-a-partner-form)
  + [Partner Portal](https://partners.horizon3.ai/)
* Resources
  + [Resource Center](https://www.horizon3.ai/resource-center/)
  + [Attack Research](https://www.horizon3.ai/category/attack-research/)
  + [Blogs](https://www.horizon3.ai/category/intelligence/blogs/)
  + [Customer Stories](https://www.horizon3.ai/category/customer-story/)
  + [Webinar Replays](https://www.horizon3.ai/category/intelligence/webinars/)
  + [Credential Attacks](https://www.horizon3.ai/credentialattacks/)
  + [Log4Shell](https://www.horizon3.ai/log4shell/)
  + [Ransomware Impact](https://www.horizon3.ai/ransomware/)
  + [Glossary](https://www.horizon3.ai/resource-center/glossary/)
  + [Simplify Compliance with NodeZero: CMMC, DFARS, and NIST 800-171](https://www.horizon3.ai/intelligence/blogs/simplify-compliance-with-nodezero-cmmc-dfars-and-nist-800-171/)

    January 6, 2025  |  [Blogs](https://www.horizon3.ai/category/intelligence/blogs/)
  + [Securing Financial Services: 5 Critical Cybersecurity Advantages of NodeZero](https://www.horizon3.ai/intelligence/infographics/securing-financial-services-5-critical-cybersecurity-advantages-of-nodezero/)

    January 3, 2025  |  [Infographics](https://www.horizon3.ai/category/intelligence/infographics/)
  + [NodeZero Insights™: Proof Over Promises in Cybersecurity](https://www.horizon3.ai/intelligence/blogs/nodezero-insights-proof-over-promises-in-cybersecurity/)

    December 17, 2024  |  [Blogs](https://www.horizon3.ai/category/intelligence/blogs/)
  + [Uncover Kubernetes Security Weaknesses with NodeZero™](https://www.horizon3.ai/intelligence/webinars/uncover-kubernetes-security-weaknesses-with-nodezero/)

    December 13, 2024  |  [Webinar Replays](https://www.horizon3.ai/category/intelligence/webinars/)
* Company
  + [Our Vision](https://www.horizon3.ai/horizon3-security-vision/)
  + [Meet The Team](https://www.horizon3.ai/about-us/)
  + [Join The Team](https://www.horizon3.ai/join-our-team/)
  + [Awards](https://www.horizon3.ai/category/news/awards/)
  + [Press Releases](https://www.horizon3.ai/category/news/press-release/)
  + [Contact Us](https://www.horizon3.ai/contact-us/)
  + [Upcoming Events](https://www.horizon3.ai/events/)
* [Log In](https://portal.horizon3ai.com/)
* Try NodeZero
  + [Get A Demo](https://www.horizon3.ai/contact-us/schedule-demo/)
  + [Free Trial](https://portal.horizon3ai.com/)

* Solutions
  + Security Strategies
  + [→ Effective Security](/effectivesecurity)
  + [→ Splunk Logging](https://www.horizon3.ai/for-splunk/)
  + [→ Purple Team Culture](https://www.horizon3.ai/purple-team-culture/)
  + [→ Vulnerable ≠ Exploitable](https://www.horizon3.ai/vulnerable-not-exploitable/)
  + [NodeZero for Compliance](https://www.horizon3.ai/compliance/)
  + [→ PCI Complinace](https://www.horizon3.ai/compliance/pci-pentesting/)
  + [→ NIS 2 Compliance](https://www.horizon3.ai/compliance/nis-2-compliance/)
  + [The NodeZero™ Platform](https://www.horizon3.ai/nodezero/)
  + [→ Internal Pentesting](https://www.horizon3.ai/nodezero/continuous-internal-pentesting/)
  + [→ External Pentesting](https://www.horizon3.ai/nodezero/external-pentesting/)
  + [→ Kubernetes Pentesting](https://www.horizon3.ai/nodezero/kubernetes-pentesting/)
  + [→ Cloud Pentesting](https://www.horizon3.ai/nodezero/cloud-pentesting/)
  + [→ Rapid Response](https://www.horizon3.ai/nodezero/rapid-response/)
  + [→ NodeZero Insights](https://www.horizon3.ai/nodezero/insights/)
  + [→ AD Password Audit](https://www.horizon3.ai/nodezero/nodezero-ad-password-audit/)
  + [→ Phishing Impact Testing](https://www.horizon3.ai/nodezero/phishing-impact-testing/)
  + [→ NodeZero Tripwires](https://www.horizon3.ai/nodezero/nodezero-tripwires/)
  + [Documentation](https://docs.horizon3.ai/getting_started/)
  + Use Cases
  + [→ Public Sector](https://www.horizon3.ai/use-case/nodezero-in-the-public-sector/)
  + [→ Education](https://www.horizon3.ai/use-case/nodezero-in-education/)
  + [→ Healthcare](https://www.horizon3.ai/use-case/for-healthcare/)
  + [→ Manufacturing](https://www.horizon3.ai/use-case/nodezero-in-manufacturing/)
  + [→ Supply Chain](https://www.horizon3.ai/use-case/nodezero-for-supply-chain/)
  + [→ Large Organizations](/who-uses-nodezero#large-org)
  + [→ MSSP and MSP](https://www.horizon3.ai/partners/mssp-msp/)
  + [Who Uses NodeZero?](https://www.horizon3.ai/who-uses-nodezero/)
  + [→ ITOps and SecOps](/who-uses-nodezero#itops)
  + [→ Security Teams](/who-uses-nodezero#security-teams)
  + [→ Pentesters](/who-uses-nodezero#pentesters)
* Partners
  + [MSSPs and MSPs](https://www.horizon3.ai/partners/mssp-msp/)
  + [Partners](https://www.horizon3.ai/partners/)
  + [Become A Partner](https://www.horizon3.ai/partners#become-a-partner-form)
  + [Partner Portal](https://partners.horizon3.ai/)
* Resources
  + [Resource Center](https://www.horizon3.ai/resource-center/)
  + [Attack Research](https://www.horizon3.ai/category/attack-research/)
  + [Blogs](https://www.horizon3.ai/category/intelligence/blogs/)
  + [Customer Stories](https://www.horizon3.ai/category/customer-story/)
  + [Webinar Replays](https://www.horizon3.ai/category/intelligence/webinars/)
  + [Credential Attacks](https://www.horizon3.ai/credentialattacks/)
  + [Log4Shell](https://www.horizon3.ai/log4shell/)
  + [Ransomware Impact](https://www.horizon3.ai/ransomware/)
  + [Glossary](https://www.horizon3.ai/resource-center/glossary/)
  + [Simplify Compliance with NodeZero: CMMC, DFARS, and NIST 800-171](https://www.horizon3.ai/intelligence/blogs/simplify-compliance-with-nodezero-cmmc-dfars-and-nist-800-171/)

    January 6, 2025  |  [Blogs](https://www.horizon3.ai/category/intelligence/blogs/)
  + [Securing Financial Services: 5 Critical Cybersecurity Advantages of NodeZero](https://www.horizon3.ai/intelligence/infographics/securing-financial-services-5-critical-cybersecurity-advantages-of-nodezero/)

    January 3, 2025  |  [Infographics](https://www.horizon3.ai/category/intelligence/infographics/)
  + [NodeZero Insights™: Proof Over Promises in Cybersecurity](https://www.horizon3.ai/intelligence/blogs/nodezero-insights-proof-over-promises-in-cybersecurity/)

    December 17, 2024  |  [Blogs](https://www.horizon3.ai/category/intelligence/blogs/)
  + [Uncover Kubernetes Security Weaknesses with NodeZero™](https://www.horizon3.ai/intelligence/webinars/uncover-kubernetes-security-weaknesses-with-nodezero/)

    December 13, 2024  |  [Webinar Replays](https://www.horizon3.ai/category/intelligence/webinars/)
* Company
  + [Our Vision](https://www.horizon3.ai/horizon3-security-vision/)
  + [Meet The Team](https://www.horizon3.ai/about-us/)
  + [Join The Team](https://www.horizon3.ai/join-our-team/)
  + [Awards](https://www.horizon3.ai/category/news/awards/)
  + [Press Releases](https://www.horizon3.ai/category/news/press-release/)
  + [Contact Us](https://www.horizon3.ai/contact-us/)
  + [Upcoming Events](https://www.horizon3.ai/events/)
* [Log In](https://portal.horizon3ai.com/)
* Try NodeZero
  + [Get A Demo](https://www.horizon3.ai/contact-us/schedule-demo/)
  + [Free Trial](https://portal.horizon3ai.com/)

![](https://www.horizon3.ai/wp-content/uploads/2024/10/Screenshot-2024-10-09-at-11.22.32 AM-768x441.png)

# Palo Alto Expedition: From N-Day to Full Compromise

Zach Hanley  |  October 9, 2024  |  [Attack Blogs](https://www.horizon3.ai/category/attack-research/attack-blogs/), [Disclosures](https://www.horizon3.ai/category/attack-research/disclosures/)

On July 10, 2024, Palo Alto released a security advisory for [CVE-2024-5910](https://security.paloaltonetworks.com/CVE-2024-5910), a vulnerability which allowed attackers to remotely reset the Expedition application admin credentials. While we had never heard of [Expedition](https://live.paloaltonetworks.com/t5/expedition/ct-p/migration_tool) application before, it’s advertised as:

> The purpose of this tool is to help reduce the time and efforts of migrating a configuration from a supported vendor to Palo Alto Networks. By using Expedition, everyone can convert a configuration from Checkpoint, Cisco, or any other vendor to a PAN-OS and give you more time to improve the results.

Further reading the documentation, it became clear that this application might have more attacker value than initially expected. The Expedition application is deployed on Ubuntu server, interacted with via a web service, and users remotely integrate vendor devices by adding each system’s credentials.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-12.39.52 PM.png)

Figure 1. Integrating a device with credentials](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-12.39.52%E2%80%AFPM.png)

This blog details finding CVE-2024-5910, but also how we ended up discovering 3 additional vulnerabilities which we reported to Palo Alto:

1. CVE-2024-9464: Authenticated Command Injection
2. CVE-2024-9465: Unauthenticated SQL Injection
3. CVE-2024-9466: Cleartext Credentials in Logs

### CVE-2024-5910: No Reversing Needed

Given the description of the vulnerability, it sounded like there existed some built in function that allowed reseting the admin credential.

> Missing authentication for a critical function in Palo Alto Networks Expedition can lead to an Expedition admin account takeover for attackers with network access to Expedition.

Googling “palo alto expedition reset admin password”, yielded this forum [post](https://live.paloaltonetworks.com/t5/expedition-discussions/incorrect-username-or-password/td-p/487494) as a top result.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-12.44.57 PM.png)

Figure 2. Forum post describing reset php file](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-12.44.57%E2%80%AFPM.png)

Immediately, I see that this PHP file the user is executing locally is hosted in the folder `/var/www/html/`, which seems interesting! After several hours and failing three times to deploy the Expedition application on an old supported Ubuntu 20.04 server, we finally get the application deployed to test. We find that a simple request to the that exact endpoint over the web service resets the admin password.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-12.51.52 PM.png)

Figure 3. Reseting the admin password](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-12.51.52%E2%80%AFPM.png)

### Give an Inch, Take a Mile

While we now have administrative access the Expedition application, this does not allow us to read all the stored credentials across the system. We turned our attention to trying to turn this admin access into remote code execution on the server.

The Expedition web server is hosted via the Apache2 web service where, as we saw earlier, the /var/www/html directory is used as the web root. A significant amount of files are served via the web root, many seemingly unnecessarily, and are exposed via the web services. The Expedition web service utilizes php as the majority of its code base. Narrowing down the attack surface to files of interest, we look for php files that include the word “exec” – which if left unchecked may be an avenue for command injection.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.01.29 PM.png)

Figure 4. Lots of opportunity](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.01.29%E2%80%AFPM.png)

We happen upon the file `/var/www/html/bin/CronJobs.php`, because it contains both a call to ‘exec’ and takes user input from the passed request parameters. Any valid session ID for any role user will allow a user to interact with this endpoint.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.03.12 PM.png)

Figure 5. CronJobs.php parsing request parameters](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.03.12%E2%80%AFPM.png)

The call to exec appears on line 332 when the user updates an existing cronjob, and constructs the command to execute from data stored within the local MySQL database for the corresponding cronjob entry. Importantly, the cronjob entry for the passed `cron_id` must exist in the `cronjobs` database table.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.04.49 PM.png)

Figure 6. Call to exec() in CronJobs.php](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.04.49%E2%80%AFPM.png)

Inspecting how these database entries are created, we find that also within `CronJobs.php` that there is a create cronjob function. When the request parameters specify the `action` is `add`, it will create an empty cronjob entry in the database.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.06.18 PM.png)

Figure 7. Adding a cronjob entry to the database](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.06.18%E2%80%AFPM.png)

We have now populated the cronjob table with a cronjob entry.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.07.28 PM.png)

Figure 8. Database entry for our request](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.07.28%E2%80%AFPM.png)

With a valid cronjob entry in the database, now we must find a way to insert a malicious command so that it can be retrieved and executed by the call to exec we found earlier. Looking back at the update or action = `set` operation where the call to exec occurs, we find that the command value is constructed in several ways depending on the passed request parameters.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.08.38 PM.png)

Figure 9. Logic for how “command” is constructed with our input](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.08.38%E2%80%AFPM.png)

Looking at line 278, when the recurrence is `Daily`, the command is constructed using 3 variables, 2 of which are user controlled. The `cron_id` looks like a good candidate to attempt to inject a command, but careful inspection of the SQL statement used to insert the malicious command into the database requires a valid `cron_id` to insert with.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.10.07 PM.png)

Figure 10. cron\_id must be valid to update](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.10.07%E2%80%AFPM.png)

Turning our attention to the other variable, `time_today`, we see it is constructed by taking the request parameter `start_time` and splitting it on the semicolon character. But never validating that the time is a valid time.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.11.39 PM.png)

Figure 11. time\_today formatted from user input](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.11.39%E2%80%AFPM.png)

We craft our request so that the start\_time[0] becomes a malicious command to be executed.

`start_time=\"; touch /tmp/hacked ; :`

And the final curl request looks like the following:

> curl -ik ‘https://10.0.40.64/bin/CronJobs.php’ -H ‘Cookie: PHPSESSID=rpagjtqkqkf5269be9ro5597r7’ -d “action=set&type=cron\_jobs&project=pandb&name=test&recurrence=Daily&start\_time=\”; touch /tmp/hacked ; :&cron\_id=1″

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.16.29 PM.png)

Figure 12. Resulting database entry after updating with malicious request](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.16.29%E2%80%AFPM.png)

This vulnerability was assigned CVE-2024-9466. Our proof of concept can be found [here](https://github.com/horizon3ai/CVE-2024-9464).

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.18.21 PM.png)

Figure 13. www-data reverse shell](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-1.18.21%E2%80%AFPM.png)

### Post-Exploitation

Once you have access to the server as the www-data user from the above vulnerability, pilfering credentials out of the database is straight forward.

To dump all API keys and cleartext credentials execute the following SQL query:

`mysql -u root -p'paloalto' pandbRBAC -e 'SELECT hostname,key_name,api_key,user_name,user_password FROM device_keys dk, devices d WHERE dk.device_id=d.id'`

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-4.13.46 PM.png)

Figure 14. Credentials for integrated devices](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-4.13.46%E2%80%AFPM.png)

While looking through the system for any other credentials, we happened upon a file called `/home/userSpace/devices/debug.txt`. This world-readable file contained the raw request logs of the Expedition server when it exchanged cleartext credentials for API keys in the device integration process. The Expedition server only stores the API keys, and is not supposed to retain the cleartext credentials, but this log file showed all the credentials used in cleartext. This issue was reported and assigned CVE-2024-9466.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-4.27.37 PM.png)

Figure 15. debug.txt logging cleartext credentials](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-4.27.37%E2%80%AFPM.png)

### Unauthenticated SQL Injection to Credential Pilfering

We still had a feeling more vulnerabilities lurked in the application, and went back to analyzing the multitude of files exposed in the web root. Narrowing down the attack surface to files of interest, we look for PHP files that include the word “GET”, but do not include the `Authentication.php` or `sessionControl.php` authentication logic – which may indicate an unauthenticated endpoint which takes request parameters as input.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.13.07 PM.png)

Figure 16. Exposed endpoints without authentication](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.13.07%E2%80%AFPM.png)

We happen upon the file `/var/www/html/bin/configurations/parsers/Checkpoint/CHECKPOINT.php`. This file is reachable unauthenticated, takes HTTP request parameters as inputs, and then constructs SQL queries with that input.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.14.29 PM.png)

Figure 17. Endpoint parses request parameters](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.14.29%E2%80%AFPM.png)

Looking for a path to SQL injection, we first find that when the `action=import`, other request parameters we control are parsed to create the variables `routeName` and `id` and used in a string format to construct a query on line 73.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.15.58 PM.png)

Figure 18. SQL injection via routeName variable](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.15.58%E2%80%AFPM.png)

Unfortunately, the table that is being selected in the query does not exist by default – so queries will fail even if we can construct a malicious query. Fortunately, the code path when `action=get` has logic that will create this table in the given database.

 [![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.17.38 PM.png)

Figure 19. Create table via GET action](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.17.38%E2%80%AFPM.png)

An unauthenticated curl request like the below will create the `policies_to_import_Checkpoint` table in the `pandbRBAC` database.

`curl -ivk 'https://10.0.40.64/bin/configurations/parsers/Checkpoint/CHECKPOINT.php' -d "action=get&type=existing_ruleBases&project=pandbRBAC"`

 [![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.19.58 PM.png)

Figure 20. Table successfully created from our request](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.19.58%E2%80%AFPM.png)

Returning to the logic when `action=import`, we now can construct a curl request which won’t immediately fail. The most simple version of SQL injection as an example with an unauthenticated curl request:

`curl -ivk 'https://10.0.40.64/bin/configurations/parsers/Checkpoint/CHECKPOINT.php' -d "action=import&type=test&project=pandb&signatureid=1 OR 1=1"`

Will cause the query to hit the database like so:

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.21.38 PM.png)

Figure 21. Succesful SQL injection](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.21.38%E2%80%AFPM.png)

Given we have unauthenticated SQL injection, tables of interest to leak data via blind SLEEP based payloads are the “users” and “devices” tables which contain password hashes and device API keys like demonstrated in the previous post-exploitation section.

Firing up the SQLMAP tool, and supplying it the endpoint and parameter to inject and table to dump, it successfully dumps the entire users table.

`python3 sqlmap.py -u "https://10.0.40.64/bin/configurations/parsers/Checkpoint/CHECKPOINT.php?action=im port&type=test&project=pandbRBAC&signatureid=1" -p signatureid -T users --dump`

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.23.12 PM.png)

Figure 22. Dumping entire table of choice via BLIND time-based SQL payloads](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-3.23.12%E2%80%AFPM.png)

This vulnerability was assigned CVE-2024-9465. Our proof of concept can be found [here](https://github.com/horizon3ai/CVE-2024-9465).

### Indicators of Compromise

The file `/var/apache/log/access.log` will log HTTP requests and should be inspected for the endpoints abused in these vulnerabilities.

* `/OS/startup/restore/restoreAdmin.php` – Reset admin credentials
* `/bin/Auth.php` – Authenticate with reset admin credentials
* `/bin/CronJobs.php` – Insert malicious SQL data for command injection
* `/bin/configurations/parsers/Checkpoint/CHECKPOINT.php` – Unauthenticated SQL injection to exfiltrate database data

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-10.32.23 AM.png)

Figure 23. Request logs](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-10.32.23%E2%80%AFAM.png)

### Exposure

At the time of writing, there are approximately 23 Expedition servers exposed to the internet, which makes sense given it doesn’t seem to be an application that would need to be exposed given its function.

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-4.38.28 PM.png)

Figure 24. Shodan exposure](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-25-at-4.38.28%E2%80%AFPM.png)

### Disclosure Timeline

**11 July 2024** – Reported authenticated command injection to Palo Alto PSIRT

**12 July 2024** – Reported unauthenticated SQL injection to Palo Alto PSIRT

**12 July 2024** – Palo Alto acknowledges receipt of both issues

**28 July 2024** – Reported cleartext credentials in logs to Palo Alto PSIRT

**1 August 2024** – Palo Alto acknowledges receipt of issue

**9 October 2024** – Palo Alto Advisory for CVE-2024-9464, CVE-2024-9465, CVE-2024-9466 [released](https://security.paloaltonetworks.com/PAN-SA-2024-0010)

**9 October 2024** – This blog post

### NodeZero

[![](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-12.15.14 PM.png)

Figure 25. Dumping credentials from debug.txt](https://www.horizon3.ai/wp-content/uploads/2024/09/Screenshot-2024-09-26-at-12.15.14%E2%80%AFPM.png)

Horizon3.ai clients and free-trial users alike can run a NodeZero operation to determine the exposure and exploitability of this issue.

##### Sign up for a free trial and quickly verify you’re not exploitable.

[Start Your Free Trial](https://portal.horizon3ai.com?id=expedition)

##### How can NodeZero help you?

Let our experts walk you through a demonstration of NodeZero, so you can see how to put it to work for your company.[Get a Demo](https://www.horizon3.ai/contact-us/schedule-demo/)Share:

[![Renmoe Library](https://www.horizon3.ai/wp-content/uploads/2021/06/h3-white-logo.png)](https://www.horizon3.ai)Contact Us

### Subscribe to Community Updates

###### NodeZero Solution

* [NodeZero Overview](https://www.horizon3.ai/nodezero/)
* [Internal Pentesting](https://www.horizon3.ai/nodezero/continuous-internal-pentesting/)
* [Kubernetes Pentesting](https://www.horizon3.ai/nodezero/kubernetes-pentesting/)
* [External Pentesting](https://www.horizon3.ai/nodezero/external-pentesting/)
* [Cloud Pentesting](https://www.horizon3.ai/nodezero/cloud-pentesting/)
* [NodeZero Insights](https://www.horizon3.ai/nodezero/insights/)
* [Rapid Response](https://www.horizon3.ai/nodezero/rapid-response/)
* [AD Password Audit](https://www.horizon3.ai/nodezero/nodezero-ad-password-audit/)
* [Phishing Impact Testing](https://www.horizon3.ai/nodezero/phishing-impact-testing/)
* [NodeZero Tripwires](https://www.horizon3.ai/nodezero/nodezero-tripwires/)
* [NodeZero Documentation](https://docs.horizon3.ai/getting_started/)
* [Pentesting for Compliance](https://www.horizon3.ai/compliance/)
* [Pentesting for PCI Compliance](https://www.horizon3.ai/compliance/pci-pentesting/)
* [Pentesting for NIS 2 Compliance](https://www.horizon3.ai/compliance/nis-2-compliance/)
###### Resources

* [Blog](https://www.horizon3.ai/category/intelligence/blogs/)
* [Attack Research](https://www.horizon3.ai/category/attack-research/)
* [White Papers](https://www.horizon3.ai/category/downloads/whitepapers/)
* [Fact Sheets](https://www.horizon3.ai/category/downloads/factsheets/)
* [Case Studies](https://www.horizon3.ai/category/customer-story/)
* [Glossary](https://www.horizon3.ai/resource-center/glossary/)
###### Use Cases

* [Education](https://www.horizon3.ai/use-case/nodezero-in-education/)
* [Healthcare](https://www.horizon3.ai/use-case/for-healthcare/)
* [Manufacturing](https://www.horizon3.ai/use-case/nodezero-in-manufacturing/)
* [Public Sector](https://www.horizon3.ai/use-case/nodezero-in-the-public-sector/)
* [Supply Chain](https://www.horizon3.ai/use-case/nodezero-for-supply-chain/)
* [Large Organization](/who-uses-nodezero/#large-org/)
* [MSSPs and MSPs](https://www.horizon3.ai/partners/mssp-msp/)
* [DIB Suppliers](https://www.horizon3.ai/nsa-capt-program-for-dib-suppliers/)
* [On AWS Marketplace](https://www.horizon3.ai/horizon3-ai-and-aws/)
###### Roles

* [ITOps and SecOps](/who-uses-nodezero/#itops)
* [Security Teams](/who-uses-nodezero/#security-teams)
* [Consulting Pentester](/who-uses-nodezero/#pentesters)
###### Partners

* MSSPs and MSPs
* [Become a Partner](https://www.horizon3.ai/partners/)
* [Partner Portal](https://partners.horizon3.ai/)
###### Company

* [About Us](https://www.horizon3.ai/about-us/)
* [Careers](https://www.horizon3.ai/join-our-team/)
* [Press](https://www.horizon3.ai/category/news/press-release/)
* [Awards](https://www.horizon3.ai/category/news/awards/)
* [Contact](https://www.horizon3.ai/contact-us/)
* [Upcoming Events](https://www.horizon3.ai/events/)
© 2024 All Rights Reserved.
[Privacy Policy](https://www.horizon3.ai/privacy-policy/)[Support Policy](https://www.horizon3.ai/support-policy/)[Terms of Service](https://www.horizon3.ai/terms-of-service/)[Trust Center](https://trust.horizon3.ai/)



=== Content from security.paloaltonetworks.com_a3da4861_20250110_112743.html ===


* [Get support](https://support.paloaltonetworks.com/support)
* [Security advisories](/)
* [Report vulnerabilities](/report)
* [Bug Bounty](/scope)
* [Subscribe](https://support.paloaltonetworks.com/SupportAccount/Preferences)
* [RSS feed](/rss.xml)
[Palo Alto Networks Security Advisories](/) /
PAN-SA-2024-0010
## PAN-SA-2024-0010 Expedition: Multiple Vulnerabilities in Expedition Lead to Exposure of Firewall Credentials

Urgency
MODERATE
047910
[Severity
9.9 ·
CRITICAL](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:N/SA:N/AU:N/R:U/V:C/RE:H/U:Amber "CVSS-BT: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:N/SA:N/AU:N/R:U/V:C/RE:H/U:Amber")Exploit Maturity
**N/A**Response Effort
**HIGH**Recovery
**USER**Value Density
**CONCENTRATED**Attack Vector
**NETWORK**Attack Complexity
**LOW**Attack Requirements
**NONE**Automatable
**NO**User Interaction
**NONE**Product Confidentiality
**HIGH**Product Integrity
**HIGH**Product Availability
**HIGH**Privileges Required
**NONE**Subsequent Confidentiality
**HIGH**Subsequent Integrity
**NONE**Subsequent Availability
**NONE**[JSON](/json/PAN-SA-2024-0010 "Download the information in this advisory in CVE-JSON format")
[CSAF](/csaf/PAN-SA-2024-0010 "Download the information in this advisory in CSAF format")

 Published
**2024-10-09** Updated
**2024-11-14**Discovered
**externally**
### Description

Multiple vulnerabilities in Palo Alto Networks Expedition allow an attacker to read Expedition database contents and arbitrary files, as well as write arbitrary files to temporary storage locations on the Expedition system. Combined, these include information such as usernames, cleartext passwords, device configurations, and device API keys of PAN-OS firewalls.

These issues do not affect the firewalls, Panorama, Prisma Access, or Cloud NGFW.

| CVE | CVSS | Summary |
| --- | --- | --- |
| CVE-2024-9463 | 9.9 ([CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:N/SA:N](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:N/SA:N)) | An OS command injection vulnerability in Palo Alto Networks Expedition allows an unauthenticated attacker to run arbitrary OS commands as root in Expedition, resulting in disclosure of usernames, cleartext passwords, device configurations, and device API keys of PAN-OS firewalls. |
| CVE-2024-9464 | 9.3 ([CVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:N/VC:H/VI:H/VA:H/SC:H/SI:N/SA:N](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:N/VC:H/VI:H/VA:H/SC:H/SI:N/SA:N)) | An OS command injection vulnerability in Palo Alto Networks Expedition allows an authenticated attacker to run arbitrary OS commands as root in Expedition, resulting in disclosure of usernames, cleartext passwords, device configurations, and device API keys of PAN-OS firewalls. |
| CVE-2024-9465 | 9.2 ([CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:L/VA:N/SC:H/SI:N/SA:N](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:L/VA:N/SC:H/SI:N/SA:N)) | An SQL injection vulnerability in Palo Alto Networks Expedition allows an unauthenticated attacker to reveal Expedition database contents, such as password hashes, usernames, device configurations, and device API keys. With this, attackers can also create and read arbitrary files on the Expedition system. |
| CVE-2024-9466 | 8.2 ([CVSS:4.0/AV:L/AC:L/AT:N/PR:L/UI:N/VC:H/VI:N/VA:N/SC:H/SI:N/SA:N](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:L/AC:L/AT:N/PR:L/UI:N/VC:H/VI:N/VA:N/SC:H/SI:N/SA:N)) | A cleartext storage of sensitive information vulnerability in Palo Alto Networks Expedition allows an authenticated attacker to reveal firewall usernames, passwords, and API keys generated using those credentials. |
| CVE-2024-9467 | 7.0 ([CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:A/VC:H/VI:L/VA:N/SC:N/SI:N/SA:N](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:A/VC:H/VI:L/VA:N/SC:N/SI:N/SA:N)) | A reflected XSS vulnerability in Palo Alto Networks Expedition enables execution of malicious JavaScript in the context of an authenticated Expedition user’s browser if that user clicks on a malicious link, allowing phishing attacks that could lead to Expedition browser session theft. |

### Product Status

| Versions | Affected | Unaffected |
| Cloud NGFW | None | All |
| Expedition 1 | < 1.2.96 | >= 1.2.96 |
| Panorama | None | All |
| PAN-OS | None | All |
| Prisma Access | None | All |

### Severity: CRITICAL, Suggested Urgency: MODERATE

CVSS-BT:
9.9 /
CVSS-B:
9.9 ([CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:N/SA:N/AU:N/R:U/V:C/RE:H/U:Amber](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:N/SA:N/AU:N/R:U/V:C/RE:H/U:Amber))

### Exploitation Status

Palo Alto Networks is aware of reports from CISA that there is evidence of active exploitation for CVE-2024-9463 and CVE-2024-9465. More information can be found at <https://www.cisa.gov/news-events/alerts/2024/11/14/cisa-adds-two-known-exploited-vulnerabilities-catalog>.

### Weakness Type

[CWE-78 Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')](https://cwe.mitre.org/data/definitions/78 "More at https://cwe.mitre.org/data/definitions/78")

[CWE-79 Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')](https://cwe.mitre.org/data/definitions/79 "More at https://cwe.mitre.org/data/definitions/79")

[CWE-89 Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')](https://cwe.mitre.org/data/definitions/89 "More at https://cwe.mitre.org/data/definitions/89")

[CWE-532 Insertion of Sensitive Information into Log File](https://cwe.mitre.org/data/definitions/532 "More at https://cwe.mitre.org/data/definitions/532")

### Solution

The fixes for all listed issues are available in Expedition 1.2.96, and all later Expedition versions.

The cleartext file affected by CVE-2024-9466 will be removed automatically during the upgrade.

All Expedition usernames, passwords, and API keys should be rotated after upgrading to the fixed version of Expedition.

All firewall usernames, passwords, and API keys processed by Expedition should be rotated after updating.

### Workarounds and Mitigations

Ensure networks access to Expedition is restricted to authorized users, hosts, or networks.

If Expedition is not in active use, ensure that Expedition software is shut down.

For CVE-2024-9465, you can check for an indicator of compromise with the following command on an Expedition system (replace "root" with your username if you are using a different username):

 `mysql -uroot -p -D pandb -e "SELECT * FROM cronjobs;"`
[Terms of use](https://www.paloaltonetworks.com/legal-notices/terms-of-use)[Privacy](https://www.paloaltonetworks.com/legal-notices/privacy)[Product Security Assurance and Vulnerability Disclosure Policy](https://paloaltonetworks.com/product-security-assurance)[Report vulnerabilities](/report)[Manage subscriptions](https://support.paloaltonetworks.com/SupportAccount/Preferences)© 2025 Palo Alto Networks, Inc. All rights reserved.
