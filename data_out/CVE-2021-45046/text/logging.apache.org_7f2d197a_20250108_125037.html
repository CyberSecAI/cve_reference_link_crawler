
[Apache Logging Services™](/)

* About
  + [Guidelines](/guidelines.html)
  + [Charter](/charter.html)
  + [Team](/team-list.html)
  + [Retirement Processes](/processes.html)+ [Wiki](https://cwiki.apache.org/confluence/display/LOGGING/Home)+ [What is logging?](/what-is-logging.html)
      + [Activity monitor](/activity-monitor)

* [Download](/download.html)

* [Support](/support.html)

* [Security](/security.html)

* [XML Schemas](/xml/ns)

* The ASF
  + [License](https://www.apache.org/licenses/)
  + [Donate](https://www.apache.org/foundation/sponsorship.html)
  + [Sponsorship](https://www.apache.org/foundation/sponsorship)

* [Blog](/blog)

The Logging Services Security Team takes security seriously.
This allows our users to place their trust in Log4j for protecting their mission-critical data.
In this page we will help you find guidance on security-related issues and access to known vulnerabilities.

| Warning | [Log4j 1](/log4j/1.x) has [reached End of Life](https://blogs.apache.org/foundation/entry/apache_logging_services_project_announces) in 2015, and is no longer supported. Vulnerabilities reported after August 2015 against Log4j 1 are not checked and will not be fixed. Users should [upgrade to Log4j 2](/log4j/2.x/manual/migration.html) to obtain security fixes. |
| --- | --- |

## Getting support

If you need help on building or configuring Logging Services projects or other help on following the instructions to mitigate the known vulnerabilities listed here, please use our [user support channels](support.html#discussions).

| Tip | If you need to apply a source code patch, use the building instructions for the project version that you are using. These instructions can be found in `BUILDING.adoc`, `BUILDING.md`, etc. files distributed with the sources. |
| --- | --- |

## Reporting vulnerabilities

If you have encountered an unlisted security vulnerability or other unexpected behaviour that has a security impact, or if the descriptions here are incomplete, please report them **privately** to the Logging Services Security Team.

| Important | We urge you to **carefully read the threat model** detailed in following sections before submitting a report. It guides users on certain safety instructions while using Logging Services software and elaborates on what counts as an unexpected behaviour that has a security impact. |
| --- | --- |

### Common threat model

Below we share the threat model shared by all Logging Services projects.

#### Code signing

All Logging Services software release distributions are signed using GPG using a key from the Logging Services PMC [KEYS file](https://downloads.apache.org/logging/KEYS).
Information on how to verify releases signatures are explained further in [the Download page](download.html).
Thus, GPG signatures should be validated in your build process.

#### Configuration sources

All configuration sources to an application must be trusted by the programmer.
When loading a configuration file from disk (especially when a monitor interval is configured to reload the file periodically), the location of the configuration file must be kept safe from unauthorized modifications.
Similarly, when loading a configuration file over the network such as through HTTP, this should be configured to use TLS or a secure connection in general with strong authentication guarantees.
This remote location must be kept safe from unauthorized modifications.

For Java-based projects supporting JNDI or JMX,
when configurations are modified through JMX, the JMX server should be safely configured to require authentication and a secure connection if being accessed over the network.
When configurations are provided through JNDI, these should only use the `java` scheme for sharing configurations in a Java EE or Jakarta EE application service.
JNDI-sourced configurations should not use other JNDI providers such as LDAP, DNS, or RMI, as all these providers are difficult to properly secure.

#### Java Object Serialization Stream Protocol

[Java Object Serialization Stream Protocol](https://docs.oracle.com/javase/8/docs/platform/serialization/spec/protocol.html) should not be used to deserialize data from untrusted sources.
See [the related OWASP guide](https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data) for details.

### Log4j threat model

Below we share the threat model specific to [Log4j](/log4j).

#### Parameterized logging

When using a log message containing template parameters like `{}`, only the format string is evaluated for parameters to be substituted.
The message parameters themselves are not evaluated for parameters; they are only included in the format string corresponding to their template position.
The conversion of message parameters into a string is done on-demand depending on the layout being used.
When structure-preserving transformations of log message data are required, the `Message` API should be used for logging structured data combined with a structured layout (e.g., `JsonTemplateLayout`).
Format strings should be compile-time constants, and under no circumstances should format strings be built using user-controlled input data.

#### Unstructured logging

When using an unstructured layout such as `PatternLayout`, no guarantees can be made about the output format.
This layout is mainly useful for development purposes and should not be relied on in production applications.
For example, if a log message contains new lines, these are not escaped or encoded specially unless the configured pattern uses the `%encode{pattern}{CRLF}` wrapper pattern converter (which will encode a carriage return as the string `\r` and a line feed as the string `\n`) or some other `%encode` option.
Note that `%xEx` is appended to the pattern unless already present.
Similarly, other encoding options are available for other formats, but pattern layouts cannot make assumptions about the entire output.
As such, when using unstructured layouts, no user-controlled input should be included in logs.
It is strongly recommended that a structured layout (e.g., `JsonTemplateLayout`) is used instead for these situations.
Note that `StrLookup` plugins (those referenced by `${…​}` templates in configuration files) that contain user-provided input should not be referenced by layouts.

#### Structured logging

When using a structured layout (most layouts besides pattern layout), log messages are encoded according to various output formats.
These safely encode the various fields included in a log message.
For example, the `JsonTemplateLayout` can be configured to output log messages in various JSON structures where all log data is properly encoded into safely parseable JSON.
This is the recommended mode of operation for use with log parsing and log collection tools that rely on log files or arbitrary output streams.

#### Java Security Manager

Log4j 3 no longer supports running in or using a custom `SecurityManager`.
This Java feature has been deprecated for removal in Java 21.
Log4j 2 includes partial support for running with a Security Manager.

#### Log masking

Log4j, like any other generic logging library, cannot generically support log masking of sensitive data.
While custom plugins may be developed to attempt to mask various regular expressions (such as a string that looks like a credit card number), the general problem of log masking is equivalent to the halting problem in computer science where sensitive data can always be obfuscated in such a way as to avoid detection by log masking.
As such, it is the responsibility of the developer to properly demarcate sensitive data such that it can be consistently masked by log masking plugins.
This sort of use case should make use of the `Message` API for better control over the output of such data.

#### Availability

Log4j goes to great lengths to minimize performance overhead along with options for minimizing latency or maximizing throughput.
However, we cannot guarantee availability of the application if the appenders cannot keep up with the logs being written.
Synchronous logging can cause applications to block and wait for a log message to be written.
Asynchronous logging can also cause applications to block and wait depending on the wait strategy and queue full policy configured.
Configuring too large or too many buffers in an application can also result in out of memory errors.

#### Compressing logs

If log compression is used along with custom encryption where logs contain user-controlled input, then this can lead to a [CRIME attack](https://en.wikipedia.org/wiki/CRIME) style vulnerability where a chosen-plaintext attack is combined with information leakage caused by how the compression algorithm handles different inputs.
The simplest way to avoid this problem is to never combine compression with encryption when encoding user-controlled input.

### Log4Net threat model

Below we share the threat model specific to [log4net](/log4net).

#### Parameterized logging

When using a log message containing template parameters like `{0}`, only the format string is evaluated for parameters to be substituted.
The message parameters themselves are not evaluated for parameters; they are only included in the format string corresponding to their template position.
The conversion of message parameters into a string is done on-demand depending on the layout being used.
When structure-preserving transformations of log data are required, a structured layout (e.g., `XmlLayout`) should be used.
Format strings should be compile-time constants, and under no circumstances should format strings be built using user-controlled input data.

#### Unstructured logging

When using an unstructured layout such as `PatternLayout`, no guarantees can be made about the output format.
This layout is mainly useful for development purposes and should not be relied on in production applications.
For example, if a log message contains new lines, these are not escaped or encoded.
As such, when using unstructured layouts, no user-controlled input should be included in logs.
It is strongly recommended that a structured layout (e.g., `XmlLayout`) is used instead for these situations.

#### Structured logging

When using a structured layout (most layouts besides pattern layout), log messages are encoded according to various output formats.
These safely encode the various fields included in a log message.
For example, the `XmlLayout` can be used to output log messages in an XML structure where all log data is properly encoded into safely parseable XML.
This is the recommended mode of operation for use with log parsing and log collection tools that rely on log files or arbitrary output streams.

#### Log masking

Log4Net, like any other generic logging library, cannot generically support log masking of sensitive data.
While custom plugins may be developed to attempt to mask various regular expressions (such as a string that looks like a credit card number), the general problem of log masking is equivalent to the halting problem in computer science where sensitive data can always be obfuscated in such a way as to avoid detection by log masking.
As such, it is the responsibility of the developer to properly demarcate sensitive data such that it can be consistently masked by log masking plugins.

#### Availability

Log4Net goes to great lengths to minimize performance overhead along with options for minimizing latency or maximizing throughput.
However, we cannot guarantee availability of the application if the appenders cannot keep up with the logs being written.
Logging can cause applications to block and wait for a log message to be written.

## Vulnerability handling policy

The Logging Services Security Team follows the [ASF Project Security](https://www.apache.org/security/committers.html) guide for handling security vulnerabilities.

Reported security vulnerabilities are subject to voting (by means of [*lazy approval*](https://logging.apache.org/guidelines.html), preferably) in the private security mailing list before creating a CVE and populating its associated content.
This procedure involves only the creation of CVEs and blocks neither (vulnerability) fixes, nor releases.

## Vulnerability Disclosure Report (VDR)

Many Logging Services projects distribute [CycloneDX Software Bill of Materials (SBOM)](https://cyclonedx.org/capabilities/vdr) along with each deployed artifact.
This is streamlined by [Logging Parent](/logging-parent) for Maven-based projects.

Produced SBOMs contain BOM-links referring to a [CycloneDX Vulnerability Disclosure Report (VDR)](https://cyclonedx.org/capabilities/vdr) that Apache Logging Services uses for all projects it maintains.
This VDR is accessible through the following URL: <https://logging.apache.org/cyclonedx/vdr.xml>

## Known vulnerabilities

The Logging Services Security Team believes that accuracy, completeness and availability of security information is essential for our users.
We choose to pool all information on this one page, allowing easy searching for security vulnerabilities over a range of criteria.

| Note | We adhere to [the Maven version range syntax](https://maven.apache.org/enforcer/enforcer-rules/versionRanges.html) while sharing versions of affected components. We only extend this mathematical notation with set union operator (i.e., `âª`) to denote union of multiple ranges. |
| --- | --- |

### [CVE-2021-44832](https://nvd.nist.gov/vuln/detail/CVE-2021-44832)

| Summary | JDBC appender is vulnerable to remote code execution in certain configurations |
| --- | --- |
| CVSS 3.x Score & Vector | 6.6 MEDIUM (CVSS:3.1/AV:N/AC:H/PR:H/UI:N/S:U/C:H/I:H/A:H) |
| Components affected | `log4j-core` |
| Versions affected | `[2.0-beta7, 2.3.2) âª [2.4, 2.12.4) âª [2.13.0, 2.17.1)` |
| Versions fixed | `2.3.2` (for Java 6), `2.12.4` (for Java 7), or `2.17.1` (for Java 8 and later) |

#### Description

An attacker with write access to the logging configuration can construct a malicious configuration using a JDBC Appender with a data source referencing a JNDI URI which can execute remote code.
This issue is fixed by limiting JNDI data source names to the `java` protocol.

#### Mitigation

Upgrade to `2.3.2` (for Java 6), `2.12.4` (for Java 7), or `2.17.1` (for Java 8 and later).

In prior releases confirm that if the JDBC Appender is being used it is not configured to use any protocol other than `java`.

#### References

* [CVE-2021-44832](https://nvd.nist.gov/vuln/detail/CVE-2021-44832)

### [CVE-2021-45105](https://nvd.nist.gov/vuln/detail/CVE-2021-45105)

| Summary | Infinite recursion in lookup evaluation |
| --- | --- |
| CVSS 3.x Score & Vector | 5.9 MEDIUM (CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H) |
| Components affected | `log4j-core` |
| Versions affected | `[2.0-alpha1, 2.3.1) âª [2.4, 2.12.3) âª [2.13.0, 2.17.0)` |
| Versions fixed | `2.3.1` (for Java 6), `2.12.3` (for Java 7), and `2.17.0` (for Java 8 and later) |

#### Description

Log4j versions `2.0-alpha1` through `2.16.0` (excluding `2.3.1` and `2.12.3`), did not protect from uncontrolled recursion that can be implemented using self-referential lookups.
When the logging configuration uses a non-default Pattern Layout with a Context Lookup (for example, `$${ctx:loginId}`), attackers with control over Thread Context Map (MDC) input data can craft malicious input data that contains a recursive lookup, resulting in a `StackOverflowError` that will terminate the process.
This is also known as a *DoS (Denial-of-Service)* attack.

#### Mitigation

Upgrade to `2.3.1` (for Java 6), `2.12.3` (for Java 7), or `2.17.0` (for Java 8 and later).

Alternatively, this infinite recursion issue can be mitigated in configuration:

* In PatternLayout in the logging configuration, replace Context Lookups like `${ctx:loginId}` or `$${ctx:loginId}` with Thread Context Map patterns (`%X`, `%mdc`, or `%MDC`).
* Otherwise, in the configuration, remove references to Context Lookups like `${ctx:loginId}` or `$${ctx:loginId}` where they originate
  from sources external to the application such as HTTP headers or user input.
  Note that this mitigation is insufficient in releases older than `2.12.2` (for Java 7), and `2.16.0` (for Java 8 and later) as the issues fixed in those releases will still be present.

Note that only the `log4j-core` JAR file is impacted by this vulnerability.
Applications using only the `log4j-api` JAR file without the `log4j-core` JAR file are not impacted by this vulnerability.

#### Credits

Independently discovered by Hideki Okamoto of Akamai Technologies, Guy Lederfein of Trend Micro Research working with Trend Micro’s Zero Day Initiative, and another anonymous vulnerability researcher.

#### References

* [CVE-2021-45105](https://nvd.nist.gov/vuln/detail/CVE-2021-45105)
* [LOG4J2-3230](https://issues.apache.org/jira/browse/LOG4J2-3230)

### [CVE-2021-45046](https://nvd.nist.gov/vuln/detail/CVE-2021-45046)

| Summary | Thread Context Lookup is vulnerable to remote code execution in certain configurations |
| --- | --- |
| CVSS 3.x Score & Vector | 9.0 CRITICAL (CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H) |
| Components affected | `log4j-core` |
| Versions affected | `[2.0-beta9, 2.3.1) âª [2.4, 2.12.3) âª [2.13.0, 2.17.0)` |
| Versions fixed | `2.3.1` (for Java 6), `2.12.3` (for Java 7), and `2.17.0` (for Java 8 and later) |

#### Description

It was found that the fix to address [CVE-2021-44228](#CVE-2021-44228) in Log4j `2.15.0` was incomplete in certain non-default configurations.
When the logging configuration uses a non-default Pattern Layout with a Thread Context Lookup (for example, `$${ctx:loginId}`), attackers with control over Thread Context Map (MDC) can craft malicious input data using a JNDI Lookup pattern, resulting in an information leak and remote code execution in some environments and local code execution in all environments.
Remote code execution has been demonstrated on macOS, Fedora, Arch Linux, and Alpine Linux.

Note that this vulnerability is not limited to just the JNDI lookup.
Any other Lookup could also be included in a Thread Context Map variable and possibly have private details exposed to anyone with access to the logs.

Note that only the `log4j-core` JAR file is impacted by this vulnerability.
Applications using only the `log4j-api` JAR file without the `log4j-core` JAR file are not impacted by this vulnerability.

#### Mitigation

Upgrade to Log4j `2.3.1` (for Java 6), `2.12.3` (for Java 7), or `2.17.0` (for Java 8 and later).

#### Credits

This issue was discovered by Kai Mindermann of iC Consult and separately by 4ra1n.

Additional vulnerability details discovered independently by Ash Fox of Google, Alvaro MuÃ±oz and Tony Torralba from GitHub, Anthony Weems of Praetorian, and RyotaK (@ryotkak).

#### References

* [CVE-2021-45046](https://nvd.nist.gov/vuln/detail/CVE-2021-45046)
* [LOG4J2-3221](https://issues.apache.org/jira/browse/LOG4J2-3221)

### [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)

| Summary | JNDI lookup can be exploited to execute arbitrary code loaded from an LDAP server |
| --- | --- |
| CVSS 3.x Score & Vector | 10.0 CRITICAL (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H) |
| Components affected | `log4j-core` |
| Versions affected | `[2.0-beta9, 2.3.1) âª [2.4, 2.12.3) âª [2.13.0, 2.17.0)` |
| Versions fixed | `2.3.1` (for Java 6), `2.12.3` (for Java 7), and `2.17.0` (for Java 8 and later) |

#### Description

In Log4j, the JNDI features used in configurations, log messages, and parameters do not protect against attacker-controlled LDAP and other JNDI related endpoints.
An attacker who can control log messages or log message parameters can execute arbitrary code loaded from LDAP servers.

Note that only the `log4j-core` JAR file is impacted by this vulnerability.
Applications using only the `log4j-api` JAR file without the `log4j-core` JAR file are not impacted by this vulnerability.

#### Mitigation

##### Log4j 1 mitigation

| Warning | [Log4j 1](/log4j/1.x) has [reached End of Life](https://blogs.apache.org/foundation/entry/apache_logging_services_project_announces) in 2015, and is no longer supported. Vulnerabilities reported after August 2015 against Log4j 1 are not checked and will not be fixed. Users should [upgrade to Log4j 2](/log4j/2.x/manual/migration.html) to obtain security fixes. |
| --- | --- |

Log4j 1 does not have Lookups, so the risk is lower.
Applications using Log4j 1 are only vulnerable to this attack when they use JNDI in their configuration.
A separate CVE ([CVE-2021-4104](https://nvd.nist.gov/vuln/detail/CVE-2021-4104)) has been filed for this vulnerability.
To mitigate, audit your logging configuration to ensure it has no `JMSAppender` configured.
Log4j 1 configurations without `JMSAppender` are not impacted by this vulnerability.

##### Log4j 2 mitigation

Upgrade to Log4j `2.3.1` (for Java 6), `2.12.3` (for Java 7), or `2.17.0` (for Java 8 and later).

#### Credits

This issue was discovered by Chen Zhaojun of Alibaba Cloud Security Team.

#### References

* [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)
* [LOG4J2-3198](https://issues.apache.org/jira/browse/LOG4J2-3198)
* [LOG4J2-3201](https://issues.apache.org/jira/browse/LOG4J2-3201)

### [CVE-2020-9488](https://nvd.nist.gov/vuln/detail/CVE-2020-9488)

| Summary | Improper validation of certificate with host mismatch in SMTP appender |
| --- | --- |
| CVSS 3.x Score & Vector | 3.7 LOW (CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:N/A:N) |
| Components affected | `log4j-core` |
| Versions affected | `[2.0-beta1, 2.12.3) âª [2.13.1, 2.13.2)` |
| Versions fixed | `2.12.3` (Java 7) and `2.13.2` (Java 8 and later) |

#### Description

Improper validation of certificate with host mismatch in SMTP appender.
This could allow an SMTPS connection to be intercepted by a man-in-the-middle attack which could leak any log
messages sent through that appender.

The reported issue was caused by an error in `SslConfiguration`.
Any element using `SslConfiguration` in the Log4j `Configuration` is also affected by this issue.
This includes `HttpAppender`, `SocketAppender`, and `SyslogAppender`.
Usages of `SslConfiguration` that are configured via system properties are not affected.

#### Mitigation

Upgrade to `2.12.3` (Java 7) or `2.13.2` (Java 8 and later).

Alternatively, users can set the `mail.smtp.ssl.checkserveridentity` system property to `true` to enable SMTPS hostname verification for all SMTPS mail sessions.

#### Credits

This issue was discovered by Peter StÃ¶ckli.

#### References

* [CVE-2020-9488](https://nvd.nist.gov/vuln/detail/CVE-2020-9488)
* [LOG4J2-2819](https://issues.apache.org/jira/browse/LOG4J2-2819)

### [CVE-2017-5645](https://nvd.nist.gov/vuln/detail/CVE-2017-5645)

| Summary | TCP/UDP socket servers can be exploited to execute arbitrary code |
| --- | --- |
| CVSS 2.0 Score & Vector | 7.5 HIGH (AV:N/AC:L/Au:N/C:P/I:P/A:P) |
| Components affected | `log4j-core` |
| Versions affected | `[2.0-alpha1, 2.8.2)` |
| Versions fixed | `2.8.2` (Java 7) |

#### Description

When using the TCP socket server or UDP socket server to receive serialized log events from another application, a specially crafted binary payload can be sent that, when deserialized, can execute arbitrary code.

#### Mitigation

Java 7 and above users should migrate to version `2.8.2` or avoid using the socket server classes.
Java 6 users should avoid using the TCP or UDP socket server classes, or they can manually backport [the security fix commit](https://github.com/apache/logging-log4j2/commit/5dcc192) from `2.8.2`.

#### Credits

This issue was discovered by Marcio Almeida de Macedo of Red Team at Telstra.

#### References

* [CVE-2017-5645](https://nvd.nist.gov/vuln/detail/CVE-2017-5645)
* [LOG4J2-1863](https://issues.apache.org/jira/browse/LOG4J2-1863)
* [Security fix commit](https://github.com/apache/logging-log4j2/commit/5dcc192)

Copyright Â© 2017-2024 [The Apache Software Foundation](https://www.apache.org).
Licensed under the [Apache Software License, Version 2.0](https://www.apache.org/licenses/LICENSE-2.0) Please read our [privacy policy](https://privacy.apache.org/policies/privacy-policy-public.html).

Apache, Chainsaw, log4cxx, Log4j, Log4net, log4php and the Apache
feather logo are trademarks or registered trademarks of The Apache
Software Foundation.
Oracle and Java are registered trademarks
of Oracle and/or its affiliates. Other names may be trademarks of their respective owners.

![](https://analytics.apache.org/matomo.php?idsite=42&rec=1)

