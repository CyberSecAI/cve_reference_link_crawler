

# [Rhino Security Labs](https://rhinosecuritylabs.com)

(888) 944-8679

* [Contact Us](https://rhinosecuritylabs.com/contact/)
* [Get a quote](https://rhinosecuritylabs.com/landing/request-a-quote/)

* [Assessments](/assessment-services/)
  + [Application and Network](https://rhinosecuritylabs.com/assessment-services/web-penetration-testing/)
    - [Web Application Penetration Testing](https://rhinosecuritylabs.com/assessment-services/web-penetration-testing/)
    - [Network Penetration Testing](https://rhinosecuritylabs.com/assessment-services/network-penetration-testing/)
    - [Mobile App Penetration Testing](https://rhinosecuritylabs.com/assessment-services/mobile-app-assessment/)
  + [Cloud Penetration Testing](https://rhinosecuritylabs.com/assessment-services/aws-cloud-penetration-testing/)
    - [AWS Penetration Testing](/assessment-services/aws-cloud-penetration-testing/)
    - [GCP Penetration Testing](https://rhinosecuritylabs.com/assessment-services/gcp-penetration-testing/)
    - [Azure Penetration Testing](https://rhinosecuritylabs.com/assessment-services/azure-penetration-testing/)
  + [Adversary Simulation](https://rhinosecuritylabs.com/assessment-services/red-team-engagement/)
    - [Red Team Assessments](https://rhinosecuritylabs.com/assessment-services/red-team-engagement/)
    - [Email Spear Phishing](https://rhinosecuritylabs.com/assessment-services/social-engineering/email-phishing-assessment/)
    - [Vishing (Voice Call) Testing](https://rhinosecuritylabs.com/assessment-services/social-engineering/vishing-assessments/)
* [Industries](https://rhinosecuritylabs.com/industry/)
  + [Technology](https://rhinosecuritylabs.com/industry/technology/)
  + [Healthcare](https://rhinosecuritylabs.com/industry/healthcare/)
  + [Financial](https://rhinosecuritylabs.com/industry/financial/)
  + [Retail](https://rhinosecuritylabs.com/industry/retail/)
* [Resources](https://rhinosecuritylabs.com/resources/)
  + [Security Blog](https://rhinosecuritylabs.com/blog/)
    - [Penetration Testing AWS Environments](https://rhinosecuritylabs.com/penetration-testing/aws-security-vulnerabilities-and-the-attackers-perspective/)
    - [EasyMP Zeroday Disclosure](https://rhinosecuritylabs.com/research/epson-easymp-remote-projection-vulnerabilities/)
  + [Downloads](https://rhinosecuritylabs.com/resources/)
    - [Ebook: Questions For Every Pentest Vendor](https://rhinosecuritylabs.com/landing/6-questions-ask-pentest-vendors/)
    - [Example Pentest Report](https://rhinosecuritylabs.com/landing/penetration-test-report/)
    - [Penetration Testing FAQ](https://rhinosecuritylabs.com/assessment-services/penetration-testing-faq/)
  + [Security Research](/research-and-vulnerability-disclosure)
    - [Research and Tool Development](https://rhinosecuritylabs.com/research-and-vulnerability-disclosure/#section-1)
    - [Vulnerability Disclosure](/research-and-vulnerability-disclosure/#section-2)
* [Security Blog](https://rhinosecuritylabs.com/blog/)
* [Company](https://rhinosecuritylabs.com/company/)
  + [About Us](https://rhinosecuritylabs.com/company/)
  + [Leadership](https://rhinosecuritylabs.com/company/leadership/)
  + [Careers](https://rhinosecuritylabs.com/careers/)
  + [Company Principles](https://rhinosecuritylabs.com/careers/rhino-company-principles/)

* [Assessments](/assessment-services/)

  [Application and Network](https://rhinosecuritylabs.com/assessment-services/web-penetration-testing/)
  + [Web Application Penetration Testing](https://rhinosecuritylabs.com/assessment-services/web-penetration-testing/)
  + [Network Penetration Testing](https://rhinosecuritylabs.com/assessment-services/network-penetration-testing/)
  + [Mobile App Penetration Testing](https://rhinosecuritylabs.com/assessment-services/mobile-app-assessment/)

  [Cloud Penetration Testing](https://rhinosecuritylabs.com/assessment-services/aws-cloud-penetration-testing/)
  + [AWS Penetration Testing](/assessment-services/aws-cloud-penetration-testing/)
  + [GCP Penetration Testing](https://rhinosecuritylabs.com/assessment-services/gcp-penetration-testing/)
  + [Azure Penetration Testing](https://rhinosecuritylabs.com/assessment-services/azure-penetration-testing/)

  [Adversary Simulation](https://rhinosecuritylabs.com/assessment-services/red-team-engagement/)
  + [Red Team Assessments](https://rhinosecuritylabs.com/assessment-services/red-team-engagement/)
  + [Email Spear Phishing](https://rhinosecuritylabs.com/assessment-services/social-engineering/email-phishing-assessment/)
  + [Vishing (Voice Call) Testing](https://rhinosecuritylabs.com/assessment-services/social-engineering/vishing-assessments/)
* [Industries](https://rhinosecuritylabs.com/industry/)

  + [Technology](https://rhinosecuritylabs.com/industry/technology/)
  + [Healthcare](https://rhinosecuritylabs.com/industry/healthcare/)
  + [Financial](https://rhinosecuritylabs.com/industry/financial/)
  + [Retail](https://rhinosecuritylabs.com/industry/retail/)
* [Resources](https://rhinosecuritylabs.com/resources/)

  [Security Blog](https://rhinosecuritylabs.com/blog/)
  + [Penetration Testing AWS Environments](https://rhinosecuritylabs.com/penetration-testing/aws-security-vulnerabilities-and-the-attackers-perspective/)
  + [EasyMP Zeroday Disclosure](https://rhinosecuritylabs.com/research/epson-easymp-remote-projection-vulnerabilities/)

  [Downloads](https://rhinosecuritylabs.com/resources/)
  + [Ebook: Questions For Every Pentest Vendor](https://rhinosecuritylabs.com/landing/6-questions-ask-pentest-vendors/)
  + [Example Pentest Report](https://rhinosecuritylabs.com/landing/penetration-test-report/)
  + [Penetration Testing FAQ](https://rhinosecuritylabs.com/assessment-services/penetration-testing-faq/)

  [Security Research](/research-and-vulnerability-disclosure)
  + [Research and Tool Development](https://rhinosecuritylabs.com/research-and-vulnerability-disclosure/#section-1)
  + [Vulnerability Disclosure](/research-and-vulnerability-disclosure/#section-2)
* [Security Blog](https://rhinosecuritylabs.com/blog/)
* [Company](https://rhinosecuritylabs.com/company/)

  + [About Us](https://rhinosecuritylabs.com/company/)
  + [Leadership](https://rhinosecuritylabs.com/company/leadership/)
  + [Careers](https://rhinosecuritylabs.com/careers/)
  + [Company Principles](https://rhinosecuritylabs.com/careers/rhino-company-principles/)

[Strategic and Technical Blog](https://rhinosecuritylabs.com/blog)

[Penetration Testing](https://rhinosecuritylabs.com/penetration-testing/)

![](https://rhinosecuritylabs.com/wp-content/uploads/2022/04/feed-config-1140x400.png "feed config")
# CVE-2022-25372:Local Privilege Escalation in Pritunl VPN Client

David Yesland

## Pritunl Vulnerability Overview

## Affected Product Summary

The Pritunl VPN Client service is vulnerable to an arbitrary file write as SYSTEM on Windows. This is due to insecure directory permissions on the Pritunl ProgramData folder. The arbitrary file write is then able to be leveraged for full privilege escalation due to the privileged Pritunl VPN service executing commands as SYSTEM without specifying the full path of the executable.

The impact is elevation of privileges to SYSTEM on Windows.

**Vendor:** Pritunl

## What is Pritunl VPN?

Pritunl is a [distributed VPN server](https://pritunl.com/)that allows enterprises to to connect their datacenters and multiple cloud environments with site-to-site links and remote user access.  Being [open-source](https://github.com/pritunl/pritunl), its a common option for companies looking for OpenVPN compatibility but with greater scale and cloud compatibility.

Connecting to a Pritunl VPN provides some options.  While the server page notes “all OpenVPN clients are supported”, additional integration is offered in using the [Pritunl OpenVPN *client*](https://client.pritunl.com/) as well.

Security is at the forefront of the application as well.  [On its Security page](https://pritunl.com/security), Pritunl describes itself as “the most secure VPN server available”, and promotes its open-source codebase as the only means to “guarantee the security of your network.”

As pentesters, we’ve come across Pritunl several times, most often in connecting AWS/GCP/Azure cloud environments together.

## Arbitrary File Write As SYSTEM Technical Details

After a user imports a VPN configuration file into the Pritunl VPN Client, a file is written to “%APPDATA%\pritunl\profiles\[profile\_ID].ovpn”. When a user attempts to connect to the profile, the VPN configuration file is [sanitized](https://github.com/pritunl/pritunl-client-electron/blob/867d266eb46809c6c6c1bd62919659b289977d03/service/profile/profile.go#L250-L277) of [dangerous OpenVPN directives](https://openvpn.net/community-resources/reference-manual-for-openvpn-2-4/#scripting-and-environmental-variables) and then written to “%PROGRAMDATA%\Pritunl\[profile\_ID].ovpn” by the Pritunl VPN service. Once the file is written, the Pritunl VPN service acts as a wrapper to the openvpn.exe executable and executes OpenVPN as SYSTEM, supplying the sanitized configuration file in the “–config” argument.

Since it is possible for any user to create new files in %PROGRAMDATA%\Pritunl\\* by default, it is possible to continuously write a configuration file containing dangerous OpenVPN directives to this directory with a matching profile ID and upon attempting to connect to the profile the Pritunl VPN service will eventually execute openvpn.exe with the modified profile.

![]( "procmon1")

Even though openvpn.exe is executed with the “–security-script 1” flag, preventing external commands from being executed, this still allows the “log” OpenVPN directive to be used which writes the log output to any specified file as SYSTEM and it is possible to control partial contents of the log output.

After importing a profile named “privesc”, this can be done with the following PowerShell command and repeatedly clicking “connect” on the privesc profile while the loop runs.

```
$profile_id = ((Select-String '{"name":"privesc"' $env:APPDATA\pritunl\profiles\*).filename).split('.')[0];  while (1){"client`ntls-client`ndev TUN`nlog `"C:\\Program Files (x86)\\Pritunl\\ipconfig.bat`"`nauth-user-pass`nca `"INJECTED CONTENT`"" | Add-Content "C:\ProgramData\Pritunl\$profile_id"}
```
## Leveraging the File Write For Full Privilege Escalation

The arbitrary file write as SYSTEM can be leveraged to gain command execution as SYSTEM in the following way.

Each time a connection attempt is made using Pritunl VPN Client the “ipconfig” command is called by the Pritunl VPN service running as SYSTEM. The command line to execute “ipconfig” is done without specifying the full path of the executable. Because this command is executed from the working directory of “C:\Program Files {x86)\Pritunl\” it is possible to use the arbitrary file write vulnerability above to write commands into “C:\Program Files {x86)\Pritunl\ipconfig.bat”. This Batch file will then be executed as SYSTEM by attempting to connect again using the Pritunl VPN client.

![]( "procmon")

![]( "privesc")

## Conclusion

## Disclosure Timeline

While this is one of many findings we have in VPN clients (more to be released soon), this is the only one that’s open source.

This is also a good reminder that while open source software certainly offers transparency benefits, its not a panacea for security.

Acknowledgements to Zachary Huff and the Pritunl team for the quick patch upon disclosure.

| 2/17/2022 | Reported to Pritunl |
| --- | --- |
| 2/17/2022 | Vendor fix committed to the GitHub repository |
| 3/29/2022 | Pritunl Client v1.2.3019.52a released and [announced by vendor.](https://twitter.com/pritunl/status/1508843179218403329) |
| 4/5/2022 | Full Disclosure (blog post) released |

## Related Resources

![]( "Pasted_image_at_2018-10-28__5_37_PM")
### Java Deserialization Exploitation With Customized Ysoserial Payloads

![]( "pic3")
### Fuzzing Left4Dead 2 with CERT’s Basic Fuzzing Framework

![]( "ecs3theif")
### Weaponizing AWS ECS Task Definitionsto Steal Credentials From Running Containers

## Interested in more information?

20603
[Contact Us Today](https://rhinosecuritylabs.com/contact/)

![]()

##### [Assessment Services](https://rhinosecuritylabs.com/assessment-services/)

* [Network Penetration Test](https://rhinosecuritylabs.com/assessment-services/network-penetration-testing/)
* [Webapp Penetration Test](https://rhinosecuritylabs.com/assessment-services/web-penetration-testing/)
* [AWS Cloud Penetration Testing](https://rhinosecuritylabs.com/assessment-services/aws-cloud-penetration-testing/)
* [GCP Cloud Penetration Testing](https://rhinosecuritylabs.com/assessment-services/gcp-penetration-testing/)
* [Azure Penetration Testing](https://rhinosecuritylabs.com/assessment-services/azure-penetration-testing/)
* [Mobile App Assessment](https://rhinosecuritylabs.com/assessment-services/mobile-app-assessment/)
* [Secure Code Review](https://rhinosecuritylabs.com/assessment-services/secure-code-review/)
* [Social Engineering / Phishing Testing](https://rhinosecuritylabs.com/assessment-services/social-engineering/)
* [Vishing (Voice Call) Testing](https://rhinosecuritylabs.com/assessment-services/social-engineering/vishing-assessments/)
* [Red Team Engagements](https://rhinosecuritylabs.com/assessment-services/red-team-engagement/)

##### [Industries](https://rhinosecuritylabs.com/industry/)

* [Healthcare](https://rhinosecuritylabs.com/industry/healthcare/)
* [Finance](https://rhinosecuritylabs.com/industry/financial/)
* [Technology](https://rhinosecuritylabs.com/industry/technology/)
* [Retail](https://rhinosecuritylabs.com/industry/retail/)

##### [Resources](https://rhinosecuritylabs.com/resources/)

* [Technical Blog](https://rhinosecuritylabs.com/blog-technical/)
* [Strategic Blog](https://rhinosecuritylabs.com/blog-strategic/)
* [Example Pentest Report](https://rhinosecuritylabs.com/landing/penetration-test-report/)
* [Technical Research](https://rhinosecuritylabs.com/research-and-vulnerability-disclosure/)
* [Vulnerability Disclosures](https://rhinosecuritylabs.com/research-and-vulnerability-disclosure/)
* [Disclosure Policy](https://rhinosecuritylabs.com/company/vulnerability-disclosure-policy/)
* [Penetration Testing FAQ](https://rhinosecuritylabs.com/assessment-services/penetration-testing-faq/)
* [Support: AWS Pentest Form](https://rhinosecuritylabs.com/assessment-services/support-aws-penetration-testing-form/)

##### [Company](https://rhinosecuritylabs.com/company/)

* [Leadership](https://rhinosecuritylabs.com/company/leadership/)
* [Blog](https://rhinosecuritylabs.com/blog/)
* [Careers](https://rhinosecuritylabs.com/careers/)
* [Company Principles](https://rhinosecuritylabs.com/careers/rhino-company-principles/)
* [Contact Us](https://rhinosecuritylabs.com/contact/)
* [Get a Quote](https://rhinosecuritylabs.com/request-a-quote/)
* [RSS Feed](https://rhinosecuritylabs.com/blog/feed/)

##### About Us

Rhino Security Labs is a top penetration testing and security assessment firm, with a focus on cloud pentesting (AWS, GCP, Azure), network pentesting, web application pentesting, and phishing.

Endorsed by industry leaders, Rhino Security Labs is a trusted security advisor to the Fortune 500.

info@rhinosecuritylabs.com

(888) 944-8679

Rhino Security Labs, Inc

