=== Content from github.com_7a5af5cf_20250111_061856.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmojolicious%2Fmojo%2Fissues%2F1736)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmojolicious%2Fmojo%2Fissues%2F1736)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=mojolicious%2Fmojo)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mojolicious](/mojolicious)
/
**[mojo](/mojolicious/mojo)**
Public

* [Notifications](/login?return_to=%2Fmojolicious%2Fmojo) You must be signed in to change notification settings
* [Fork
  581](/login?return_to=%2Fmojolicious%2Fmojo)
* [Star
   2.7k](/login?return_to=%2Fmojolicious%2Fmojo)

* [Code](/mojolicious/mojo)
* [Issues
  68](/mojolicious/mojo/issues)
* [Pull requests
  22](/mojolicious/mojo/pulls)
* [Discussions](/mojolicious/mojo/discussions)
* [Actions](/mojolicious/mojo/actions)
* [Projects
  0](/mojolicious/mojo/projects)
* [Wiki](/mojolicious/mojo/wiki)
* [Security](/mojolicious/mojo/security)
* [Insights](/mojolicious/mojo/pulse)

Additional navigation options

* [Code](/mojolicious/mojo)
* [Issues](/mojolicious/mojo/issues)
* [Pull requests](/mojolicious/mojo/pulls)
* [Discussions](/mojolicious/mojo/discussions)
* [Actions](/mojolicious/mojo/actions)
* [Projects](/mojolicious/mojo/projects)
* [Wiki](/mojolicious/mojo/wiki)
* [Security](/mojolicious/mojo/security)
* [Insights](/mojolicious/mojo/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fmojolicious%2Fmojo%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fmojolicious%2Fmojo%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Template in render can't work. #1736

Closed

[darrenli912](/darrenli912) opened this issue
Mar 16, 2021
· 18 comments

Closed

# [Template in render can't work.](#top) #1736

[darrenli912](/darrenli912) opened this issue
Mar 16, 2021
· 18 comments

Labels
[bug](/mojolicious/mojo/labels/bug)
[help wanted](/mojolicious/mojo/labels/help%20wanted)
[security](/mojolicious/mojo/labels/security)

## Comments

[![@darrenli912](https://avatars.githubusercontent.com/u/5398035?s=80&v=4)](/darrenli912)

Copy link

### **[darrenli912](/darrenli912)** commented [Mar 16, 2021](#issue-832533204)

| * Mojolicious version: 9.07 * Perl version: 5.30.0 * Operating system: ubuntu  Steps to reproduce the behavior  1. Generate a mojolicious app.    Change the route:    $r->get('/index')->to('example#welcome');    Set the template in code:    $self->render(template => 'example/welcome',msg => 'Welcome to the Mojolicious real-time web framework!'); 2. Run: morbo ./script/my\_app    GET <http://127.0.0.1:3000/index.html#1212> Works well. 3. Get the error:    GET <http://127.0.0.1:3000/index.html%231212>    [2021-03-16 15:58:17.43341] [199062] [debug] [7CDPRtIY] Routing to controller "MyApp::Controller::Example" and action "welcome"    [2021-03-16 15:58:17.43450] [199062] [debug] [7CDPRtIY] Template "example/welcome.html#1212.ep" not found    [2021-03-16 15:58:17.43743] [199062] [error] [7CDPRtIY] Could not render a response at /usr/local/share/perl/5.30.0/Mojolicious.pm line 190.  From the error log, the template is changed to example/welcome.html#1212.ep and return 505 error.  Expected behavior Render the template correctly or return 404 error instead of 505 error. Actual behavior System error. |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=80&v=4)](/kraih)

Copy link

Member

### **[kraih](/kraih)** commented [Mar 16, 2021](#issuecomment-800276503)

| I'm seeing a 404 response, as expected. You must be doing something else wrong. |
| --- |

All reactions

Sorry, something went wrong.

[![@darrenli912](https://avatars.githubusercontent.com/u/5398035?s=80&v=4)](/darrenli912)

Copy link

Author

### **[darrenli912](/darrenli912)** commented [Mar 16, 2021](#issuecomment-800301973)

| Hi, Kraih  No, the problem exists.  You must visit the url that end with .html to get the problem. For example /index.html%231212  The following are my test codes. Please check.  package MyApp; use Mojo::Base 'Mojolicious', -signatures;  sub startup ($self) {  my $config = $self->plugin('NotYAMLConfig');  $self->secrets($config->{secrets});  my $r = $self->routes;  $r->get('/index')->to('example#welcome'); }  1;  package MyApp::Controller::Example; use Mojo::Base 'Mojolicious::Controller', -signatures;  sub welcome ($self) {  $self->render(templaet => 'example/welcome',msg => 'Welcome to the Mojolicious real-time web framework!'); } |
| --- |

All reactions

Sorry, something went wrong.

[![@apodran](https://avatars.githubusercontent.com/u/4117625?s=80&v=4)](/apodran)

Copy link

### **[apodran](/apodran)** commented [Mar 16, 2021](#issuecomment-800318447)

| It looks related to my problem. I am getting 500 Internal Server Error after upgrade instead of 404 Not Found. For example, it tries to find a wrong template for the route with messages like: `"Template "policiespolicy_idnumpool_assignmentsidnum.json.ep" not found`  For the route `/policies/<policy_id:num>/pool_assignments/<id:num>` and `format => 'json'`. |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=80&v=4)](/kraih)

Copy link

Member

### **[kraih](/kraih)** commented [Mar 16, 2021](#issuecomment-800362582)

| If you don't want format detection you should just disable it. |
| --- |

All reactions

Sorry, something went wrong.

[![@apodran](https://avatars.githubusercontent.com/u/4117625?s=80&v=4)](/apodran)

Copy link

### **[apodran](/apodran)** commented [Mar 16, 2021](#issuecomment-800372935)

| I am sorry for misunderstanding, I will try to explain the problem better.  Before upgrade (Mojolicious 8.58) my code rendered well for both status 200 and NotFound 404. But after upgrade to Mojolicious 9.10 something new happened. If the content is rendered (status 200) all still works well, but lines like `$c->render(status => 404)` now try to find some specific weird template names like `policiespolicy_idnumpool_assignmentsidnum.json.ep` instead of the not\_found one (`not_found.json.ep`). |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=80&v=4)](/kraih)

Copy link

Member

### **[kraih](/kraih)** commented [Mar 16, 2021](#issuecomment-800397942)

| Ah, i see. We changed most rendering and routing errors to result in 500 instead of 404 responses. That is intended behaviour. |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=80&v=4)](/kraih)

Copy link

Member

### **[kraih](/kraih)** commented [Mar 16, 2021](#issuecomment-800398650)

| The specific changes were discussed in [#1663](https://github.com/mojolicious/mojo/discussions/1663). |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=80&v=4)](/kraih)

Copy link

Member

### **[kraih](/kraih)** commented [Mar 16, 2021](#issuecomment-800467085) • edited Loading

| Ok, i'm calling this a bug. The problem is not that a missing template results in a 500 error, that's fine. But that by default anyone can trigger a 500 error with a bad format value. Possibly spamming the logs with useless error level messages.  I do not have a solution however, other than disabling [format detection](https://docs.mojolicious.org/Mojolicious/Guides/Routing#Formats), limiting the formats your routes accept, or hardcoding the format to the render call.  ``` my $inactive = $r->under([format => 0]); $inactive->get('/foo')->to('foo#bar'); ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=40&v=4)](/kraih)
[kraih](/kraih)
added
the
[bug](/mojolicious/mojo/labels/bug)
label
[Mar 16, 2021](#event-4465994815)

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=80&v=4)](/kraih)

Copy link

Member

### **[kraih](/kraih)** commented [Mar 16, 2021](#issuecomment-800473850)

| The case can also be observed on <https://mojolicious.org/.yaml>. |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=40&v=4)](/kraih)
[kraih](/kraih)
added
the
[security](/mojolicious/mojo/labels/security)
label
[Mar 16, 2021](#event-4466340490)

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=80&v=4)](/kraih)

Copy link

Member

### **[kraih](/kraih)** commented [Mar 16, 2021](#issuecomment-800518863)

| Depending on how your monitoring is set up this has the potential to be exploited for a DoS attack. So we will consider this a security issue, but a fairly harmless. |
| --- |

All reactions

Sorry, something went wrong.

[![@apodran](https://avatars.githubusercontent.com/u/4117625?s=80&v=4)](/apodran)

Copy link

### **[apodran](/apodran)** commented [Mar 16, 2021](#issuecomment-800545752) • edited Loading

| Thank you. All became clearer. Looks like I found a solution according to these changes, so my 'not\_found' template is working now:  ```   $c->reply->not_found;  ```  instead of  ```   $c->render(status => 404);  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=80&v=4)](/kraih)

Copy link

Member

### **[kraih](/kraih)** commented [Mar 16, 2021](#issuecomment-800584695)

| `$c->render(status => 404);` has always been completely wrong, if it worked that was purely by accident. Just so nobody else gets confused, that has nothing to do with the actual bug here. |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=80&v=4)](/kraih)

Copy link

Member

### **[kraih](/kraih)** commented [Mar 16, 2021](#issuecomment-800587761)

| And regarding actual solutions, ideally we would have just gotten rid of the code that propagates format values from the router to the `stash` with the 9.0 release. Having visitors to your site affect the renderer outside of real content negotiation with `respond_to` is just completely unnecessary. Maybe we still have to do that if nobody finds a better solution. It would be a little disruptive. |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=40&v=4)](/kraih)
[kraih](/kraih)
added
the
[help wanted](/mojolicious/mojo/labels/help%20wanted)
label
[Mar 17, 2021](#event-4471506796)

[![@shadowcat-mst](https://avatars.githubusercontent.com/u/252821?s=80&v=4)](/shadowcat-mst)

Copy link

Contributor

### **[shadowcat-mst](/shadowcat-mst)** commented [Mar 19, 2021](#issuecomment-803156903)

| We're clearly having a lot of "fun" trying to work out what's best.  What about just flipping the default for automagic format detection to 0 and letting people who still want it do  ``` ->under({ format => 1 })  ```  for the moment and that'll eliminate the footgunnery but let current users opt in and then we can figure out something more solid in our own time? |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=40&v=4)](/kraih)
[kraih](/kraih)
closed this as [completed](/mojolicious/mojo/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[a0c4576](/mojolicious/mojo/commit/a0c4576ffb11c235088550de9ba7ac4196e1953c)`
[Mar 20, 2021](#event-4484964928)

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=80&v=4)](/kraih)

Copy link

Member

### **[kraih](/kraih)** commented [Mar 20, 2021](#issuecomment-803431105)

| Thank you, this issue has been resolved in the 9.11 release. |
| --- |

All reactions

Sorry, something went wrong.

[![@hansquintes](https://avatars.githubusercontent.com/u/49492490?s=80&v=4)](/hansquintes)

Copy link

### **[hansquintes](/hansquintes)** commented [Oct 4, 2021](#issuecomment-933621420)

| Could this fix also affect the following construct?  ``` post '/api/v1/user/:vuserid/:tset/name/*vname' => [vuserid => qr/\d+/, tset => ['set']] => {tset => undef} => sub ($c) {}  /api/v1/user/123456/name/Emilia       -> does not work unless "format => 1" is there /api/v1/user/123456/set/name/Emilia   -> works  ``` |
| --- |

All reactions

Sorry, something went wrong.

[karenetheridge](/karenetheridge)
pushed a commit
to karenetheridge/Mojolicious
that referenced
this issue
[Sep 20, 2023](#ref-commit-2b29361)
[![@kraih](https://avatars.githubusercontent.com/u/30094?s=40&v=4)](/kraih) [![@karenetheridge](https://avatars.githubusercontent.com/u/303051?s=40&v=4)](/karenetheridge)

`[Flip format detection to fix a security issue (](/karenetheridge/Mojolicious/commit/2b293616f226c53968dfd8f6d29d3dc8c5425736 "Flip format detection to fix a security issue (closes #1736)")[closes](/karenetheridge/Mojolicious/commit/2b293616f226c53968dfd8f6d29d3dc8c5425736 "Flip format detection to fix a security issue (closes #1736)") [mojolicious#1736](https://github.com/mojolicious/mojo/issues/1736)[)](/karenetheridge/Mojolicious/commit/2b293616f226c53968dfd8f6d29d3dc8c5425736 "Flip format detection to fix a security issue (closes #1736)")`

`[2b29361](/karenetheridge/Mojolicious/commit/2b293616f226c53968dfd8f6d29d3dc8c5425736)`

[![@ltl1A](https://avatars.githubusercontent.com/u/34237635?s=80&v=4)](/ltl1A)

Copy link

### **[ltl1A](/ltl1A)** commented [Jul 3, 2024](#issuecomment-2205013380)

| Does this issue exist on lower versions, such as version 8.06 |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=80&v=4)](/kraih)

Copy link

Member

### **[kraih](/kraih)** commented [Jul 3, 2024](#issuecomment-2205287938)

| Does this issue exist on lower versions, such as version 8.06  Yes. |
| --- |

All reactions

Sorry, something went wrong.

[ltl1A](/ltl1A)
pushed a commit
to ltl1A/mojo
that referenced
this issue
[Jul 3, 2024](#ref-commit-75de3a1)

`[Flip format detection to fix a security issue (](/ltl1A/mojo/commit/75de3a137d82cdabebf538279131081e144983b8 "Flip format detection to fix a security issue (closes #1736)")[closes](/ltl1A/mojo/commit/75de3a137d82cdabebf538279131081e144983b8 "Flip format detection to fix a security issue (closes #1736)") [mojolicious#1736](https://github.com/mojolicious/mojo/issues/1736)[)](/ltl1A/mojo/commit/75de3a137d82cdabebf538279131081e144983b8 "Flip format detection to fix a security issue (closes #1736)")`

`[75de3a1](/ltl1A/mojo/commit/75de3a137d82cdabebf538279131081e144983b8)`

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fmojolicious%2Fmojo%2Fissues%2F1736)

Assignees

No one assigned

Labels

[bug](/mojolicious/mojo/labels/bug)
[help wanted](/mojolicious/mojo/labels/help%20wanted)
[security](/mojolicious/mojo/labels/security)

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

6 participants

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=52&v=4)](/kraih) [![@shadowcat-mst](https://avatars.githubusercontent.com/u/252821?s=52&v=4)](/shadowcat-mst) [![@apodran](https://avatars.githubusercontent.com/u/4117625?s=52&v=4)](/apodran) [![@darrenli912](https://avatars.githubusercontent.com/u/5398035?s=52&v=4)](/darrenli912) [![@ltl1A](https://avatars.githubusercontent.com/u/34237635?s=52&v=4)](/ltl1A) [![@hansquintes](https://avatars.githubusercontent.com/u/49492490?s=52&v=4)](/hansquintes)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_fdd929ef_20250111_061854.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmojolicious%2Fmojo%2Fcommit%2Fa0c4576ffb11c235088550de9ba7ac4196e1953c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmojolicious%2Fmojo%2Fcommit%2Fa0c4576ffb11c235088550de9ba7ac4196e1953c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=mojolicious%2Fmojo)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mojolicious](/mojolicious)
/
**[mojo](/mojolicious/mojo)**
Public

* [Notifications](/login?return_to=%2Fmojolicious%2Fmojo) You must be signed in to change notification settings
* [Fork
  581](/login?return_to=%2Fmojolicious%2Fmojo)
* [Star
   2.7k](/login?return_to=%2Fmojolicious%2Fmojo)

* [Code](/mojolicious/mojo)
* [Issues
  68](/mojolicious/mojo/issues)
* [Pull requests
  22](/mojolicious/mojo/pulls)
* [Discussions](/mojolicious/mojo/discussions)
* [Actions](/mojolicious/mojo/actions)
* [Projects
  0](/mojolicious/mojo/projects)
* [Wiki](/mojolicious/mojo/wiki)
* [Security](/mojolicious/mojo/security)
* [Insights](/mojolicious/mojo/pulse)

Additional navigation options

* [Code](/mojolicious/mojo)
* [Issues](/mojolicious/mojo/issues)
* [Pull requests](/mojolicious/mojo/pulls)
* [Discussions](/mojolicious/mojo/discussions)
* [Actions](/mojolicious/mojo/actions)
* [Projects](/mojolicious/mojo/projects)
* [Wiki](/mojolicious/mojo/wiki)
* [Security](/mojolicious/mojo/security)
* [Insights](/mojolicious/mojo/pulse)

## Commit

[Permalink](/mojolicious/mojo/commit/a0c4576ffb11c235088550de9ba7ac4196e1953c)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Flip format detection to fix a security issue (closes [#1736](https://github.com/mojolicious/mojo/issues/1736))

[Browse files](/mojolicious/mojo/tree/a0c4576ffb11c235088550de9ba7ac4196e1953c)
Browse the repository at this point in the history

* Loading branch information

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=40&v=4)](/kraih)

[kraih](/mojolicious/mojo/commits?author=kraih "View all commits by kraih")
committed
Mar 20, 2021

1 parent
[f0e64c1](/mojolicious/mojo/commit/f0e64c16cc99e6a20731bbede4909d83dbeccc4e)

commit a0c4576

 Show file tree

 Hide file tree

Showing
**17 changed files**
with
**111 additions**
and
**117 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Changes
  [Changes](#diff-bbd4b6a86bc65b6ac8e79e97afc61499158edb40f7bb404c70637b46d80a7ad2)
* lib/Mojolicious

  + Guides

    - lib/Mojolicious/Guides/Routing.pod
      [Routing.pod](#diff-9e628a8849904059aa44069af7a792b28cdea020f34547c4f43ceb50694146c5)
    - lib/Mojolicious/Guides/Tutorial.pod
      [Tutorial.pod](#diff-f6f6e2fc0c0a7c5b8995dd83a244d632d3bba94aa8ea205a82a234c5614b6aac)
  + lib/Mojolicious/Lite.pm
    [Lite.pm](#diff-a333c69a0e44b03dd9ff331d9b70aa4f8da7329b01df8fdcd9e78370b5f1cc49)
  + Routes

    - lib/Mojolicious/Routes/Match.pm
      [Match.pm](#diff-56cba07806f29101cb715e9a2bf897ff1418195f58b29ccc69d825f60bd13417)
    - lib/Mojolicious/Routes/Pattern.pm
      [Pattern.pm](#diff-f6f3e56ffaa3cc6953512939d9c344227ed704b19c8996a99f68a235257d6e31)
    - lib/Mojolicious/Routes/Route.pm
      [Route.pm](#diff-7be7af96e5651a8d90f2f63cd66dc40eb7053d94d08ddca8a97d433c9b5a960e)
* t/mojolicious

  + t/mojolicious/charset\_lite\_app.t
    [charset\_lite\_app.t](#diff-62c9ca699680fc1795b42448ac6e49d2bad10ea4a1d52640bea970f2d98281eb)
  + t/mojolicious/exception\_lite\_app.t
    [exception\_lite\_app.t](#diff-ee8b1a8f1b9802a629232bd7dee93775d0a0cff2a6c73d91ab25f41199c14722)
  + t/mojolicious/group\_lite\_app.t
    [group\_lite\_app.t](#diff-91fa245a2cdcec5296594a3995f7cedc9e3d70fdb02ecb242819b1b11da5ec85)
  + t/mojolicious/layouted\_lite\_app.t
    [layouted\_lite\_app.t](#diff-52f95f8b6843a4bbd0147f9908f4bda22f022136baf6bab1af8a8dd76c4a028e)
  + lib

    - t/mojolicious/lib/MojoliciousTest.pm
      [MojoliciousTest.pm](#diff-77ec1a260e43ac491458b995c23ac8ddf9ed2883456ec17048a8440a36bb6740)
  + t/mojolicious/lite\_app.t
    [lite\_app.t](#diff-8ef986ec608779c4c039069a83dc635e4c8a2759033f2beae0084281b2bed9b5)
  + t/mojolicious/pattern.t
    [pattern.t](#diff-06693bd51ba075449c9d45e122ae74e56771ca0c95f9e35da1fd0f5aaf8dce31)
  + t/mojolicious/restful\_lite\_app.t
    [restful\_lite\_app.t](#diff-5550b20c73c88cbf5cda0d3571a11611e1d931a11828709a5f9c16962384df66)
  + t/mojolicious/routes.t
    [routes.t](#diff-6a73bde29e3388f8375643cc5a24da8efa6d053a51624adaa28b3b2d1ca70c10)
  + t/mojolicious/twinkle\_lite\_app.t
    [twinkle\_lite\_app.t](#diff-2351470558317b60548c961ba0d4124b47ba7e54660b013d00256b43aad93162)

## There are no files selected for viewing

16 changes: 15 additions & 1 deletion

16
[Changes](#diff-bbd4b6a86bc65b6ac8e79e97afc61499158edb40f7bb404c70637b46d80a7ad2 "Changes")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/Changes)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,19 @@ |
|  |  |  |
|  |  | 9.11 2021-03-18 |
|  |  | 9.11 2021-03-20 |
|  |  | - This release contains fixes for security issues, everybody should upgrade! |
|  |  | - Disabled format detection by default to fix a vulnerability in many Mojolicious applications. From now on you have |
|  |  | to explicitly select the formats your routes are allowed to handle. |
|  |  | # /foo |
|  |  | # /foo.html |
|  |  | # /foo.json |
|  |  | $r->get('/foo')->to('bar#yada'); |
|  |  | becomes |
|  |  | $r->get('/foo' => [format => ['html', 'json']])->to('bar#yada', format => undef); |
|  |  | And if you're certain your application is not vulnerable, you can also re-enable format detection, which will be |
| This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fmojolicious%2Fmojo%2Fcommit%2Fa0c4576ffb11c235088550de9ba7ac4196e1953c)       Sorry, something went wrong.           Copy link    Quote reply     @ltl1A **[ltl1A](/ltl1A)** [Jul 3, 2024](#r143786680)  Is this commit can apply to lower version, such as 8.06.      All reactions          This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fmojolicious%2Fmojo%2Fcommit%2Fa0c4576ffb11c235088550de9ba7ac4196e1953c)       Sorry, something went wrong.           Copy link    Quote reply     @s1037989 **[s1037989](/s1037989)** [Jul 3, 2024](#r143824294) Contributor   That's not how Mojolicious releases software. Bug / Security fixes are applied to the main branch and a new release is made. If you need to stick with 8.06, I suggest you fork Mojolicious, switch to the 8.06 (or highest you can tolerate) and apply the patch your yourself. You'll then be running on your forked Mojolicious until you're able to update your apps to work with a 9+ Mojolicious.      All reactions | | |
|  |  | inherited by nested routes. |
|  |  | my $active = $r->any('/' => [format => 1]); |
|  |  | $active->get('/foo')->to('Test#first'); |
|  |  | $active->put('/bar')->to('Test#second'); |
|  |  | - Improved Mojo::UserAgent to include "Content-Length: 0" with non-GET requests for better compatibility with broken |
|  |  | web servers. |
|  |  |  |
| Expand Down | |  |

37 changes: 10 additions & 27 deletions

37
[lib/Mojolicious/Guides/Routing.pod](#diff-9e628a8849904059aa44069af7a792b28cdea020f34547c4f43ceb50694146c5 "lib/Mojolicious/Guides/Routing.pod")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/lib/Mojolicious/Guides/Routing.pod)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -552,22 +552,22 @@ L<Mojolicious::Controller/"match">. |
|  |  |  |
|  |  | =head2 Formats |
|  |  |  |
|  |  | File extensions like C<.html> and C<.txt> at the end of a route are automatically detected and stored in the stash |
|  |  | value C<format>. |
|  |  |  |
|  |  | # /foo -> {controller => 'foo', action => 'bar'} |
|  |  | # /foo.html -> {controller => 'foo', action => 'bar', format => 'html'} |
|  |  | # /foo.txt -> {controller => 'foo', action => 'bar', format => 'txt'} |
|  |  | $r->get('/foo')->to('foo#bar'); |
|  |  |  |
|  |  | This for example, allows multiple templates in different formats to share the same action code. Restrictive |
|  |  | placeholders can also be used to limit the allowed formats. |
|  |  | File extensions like C<.html> and C<.txt> at the end of a route can be detected and stored in the stash value C<format>. |
|  |  | Use a restrictive placeholder to declare the possible values. |
|  |  |  |
|  |  | # /foo.txt -> undef |
|  |  | # /foo.rss -> {controller => 'foo', action => 'bar', format => 'rss'} |
|  |  | # /foo.xml -> {controller => 'foo', action => 'bar', format => 'xml'} |
|  |  | $r->get('/foo' => [format => ['rss', 'xml']])->to('foo#bar'); |
|  |  |  |
|  |  | This for example, allows multiple templates in different formats to share the same action code. And just like with |
|  |  | placeholders you can use a default value to make the format optional. |
|  |  |  |
|  |  | # /foo -> {controller => 'foo', action => 'bar'} |
|  |  | # /foo.html -> {controller => 'foo', action => 'bar', format => 'html'} |
|  |  | # /foo.txt -> {controller => 'foo', action => 'bar', format => 'txt'} |
|  |  | $r->get('/foo' => [format => ['html', 'txt']])->to('foo#bar', format => undef); |
|  |  |  |
|  |  | A C<format> value can also be passed to L<Mojolicious::Controller/"url\_for">. |
|  |  |  |
|  |  | # /foo/23.txt -> {controller => 'foo', action => 'bar', id => 23, format => 'txt'} |
| Expand All | | @@ -576,23 +576,6 @@ A C<format> value can also be passed to L<Mojolicious::Controller/"url\_for">. |
|  |  | # Generate URL "/foo/24.txt" for route "baz" |
|  |  | my $url = $c->url\_for('baz', id => 24, format => 'txt'); |
|  |  |  |
|  |  | Or you can just disable format detection with a special type of restrictive placeholder, which gets inherited by nested |
|  |  | routes, and then re-enable it on demand. |
|  |  |  |
|  |  | # /foo -> {controller => 'foo', action => 'bar'} |
|  |  | # /foo.html -> undef |
|  |  | $r->get('/foo' => [format => 0])->to('foo#bar'); |
|  |  |  |
|  |  | # /foo -> {controller => 'foo', action => 'bar'} |
|  |  | # /foo.html -> undef |
|  |  | # /baz -> undef |
|  |  | # /baz.txt -> {controller => 'baz', action => 'yada', format => 'txt'} |
|  |  | # /baz.html -> {controller => 'baz', action => 'yada', format => 'html'} |
|  |  | # /baz.xml -> undef |
|  |  | my $inactive = $r->under([format => 0]); |
|  |  | $inactive->get('/foo')->to('foo#bar'); |
|  |  | $inactive->get('/baz' => [format => ['txt', 'html']])->to('baz#yada'); |
|  |  |  |
|  |  | =head2 WebSockets |
|  |  |  |
|  |  | With the method L<Mojolicious::Routes::Route/"websocket"> you can restrict access to WebSocket handshakes, which are |
| Expand Down | |  |

33 changes: 8 additions & 25 deletions

33
[lib/Mojolicious/Guides/Tutorial.pod](#diff-f6f6e2fc0c0a7c5b8995dd83a244d632d3bba94aa8ea205a82a234c5614b6aac "lib/Mojolicious/Guides/Tutorial.pod")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/lib/Mojolicious/Guides/Tutorial.pod)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -564,14 +564,13 @@ L<Mojolicious::Lite/"under">. |
|  |  | =head2 Formats |
|  |  |  |
|  |  | Formats can be automatically detected from file extensions like C<.html>, they are used to find the right template and |
|  |  | generate the correct C<Content-Type> header. |
|  |  | generate the correct C<Content-Type> header. Use a restrictive placeholder to declare the possible values. |
|  |  |  |
|  |  | use Mojolicious::Lite -signatures; |
|  |  |  |
|  |  | # /detection |
|  |  | # /detection.html |
|  |  | # /detection.txt |
|  |  | get '/detection' => sub ($c) { |
|  |  | get '/detection' => [format => ['html', 'txt']] => sub ($c) { |
|  |  | $c->render(template => 'detected'); |
|  |  | }; |
|  |  |  |
| Expand All | | @@ -588,37 +587,21 @@ generate the correct C<Content-Type> header. |
|  |  | @@ detected.txt.ep |
|  |  | TXT was detected. |
|  |  |  |
|  |  | The default format is C<html>, and restrictive placeholders can be used to limit possible values. |
|  |  | And just like with placeholders you can use a default value to make the format optional. |
|  |  |  |
|  |  | use Mojolicious::Lite -signatures; |
|  |  |  |
|  |  | # /hello |
|  |  | # /hello.json |
|  |  | # /hello.txt |
|  |  | get '/hello' => [format => ['json', 'txt']] => sub ($c) { |
|  |  | return $c->render(json => {hello => 'world'}) |
|  |  | if $c->stash('format') eq 'json'; |
|  |  | get '/hello' => [format => ['json', 'txt']] => {format => 'txt'} => sub ($c) { |
|  |  | return $c->render(json => {hello => 'world'}) if $c->stash('format') eq 'json'; |
|  |  | $c->render(text => 'hello world'); |
|  |  | }; |
|  |  |  |
|  |  | app->start; |
|  |  |  |
|  |  | Or you can just disable format detection with a special type of restrictive placeholder. |
|  |  |  |
|  |  | use Mojolicious::Lite; |
|  |  |  |
|  |  | # /hello |
|  |  | get '/hello' => [format => 0] => {text => 'No format detection.'}; |
|  |  |  |
|  |  | # Disable detection and allow the following routes to re-enable it on demand |
|  |  | under [format => 0]; |
|  |  |  |
|  |  | # /foo |
|  |  | get '/foo' => {text => 'No format detection again.'}; |
|  |  |  |
|  |  | # /bar.txt |
|  |  | get '/bar' => [format => 'txt'] => {text => ' Just one format.'}; |
|  |  |  |
|  |  | app->start; |
|  |  | The default format is C<html> and the renderer will fall back to when necessary. |
|  |  |  |
|  |  | =head2 Content negotiation |
|  |  |  |
| Expand All | | @@ -633,7 +616,7 @@ L<Mojolicious::Plugin::DefaultHelpers/"respond\_to">. |
|  |  | # /hello.xml |
|  |  | # /hello?format=json |
|  |  | # /hello?format=xml |
|  |  | get '/hello' => sub ($c) { |
|  |  | get '/hello' => [format => ['json', 'xml']] => {format => undef} => sub ($c) { |
|  |  | $c->respond\_to( |
|  |  | json => {json => {hello => 'world'}}, |
|  |  | xml => {text => '<hello>world</hello>'}, |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[lib/Mojolicious/Lite.pm](#diff-a333c69a0e44b03dd9ff331d9b70aa4f8da7329b01df8fdcd9e78370b5f1cc49 "lib/Mojolicious/Lite.pm")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/lib/Mojolicious/Lite.pm)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -300,7 +300,7 @@ L<Mojolicious::Guides::Tutorial> and L<Mojolicious::Guides::Routing> for more in |
|  |  | my $route = under '/:foo' => {foo => 'bar'}; |
|  |  | my $route = under '/:foo' => [foo => qr/\w+/]; |
|  |  | my $route = under '/:foo' => (agent => qr/Firefox/); |
|  |  | my $route = under [format => 0]; |
|  |  | my $route = under [format => ['json', 'yaml']]; |
|  |  |  |
|  |  | Generate nested route with L<Mojolicious::Routes::Route/"under">, to which all following routes are automatically |
|  |  | appended. See L<Mojolicious::Guides::Tutorial> and L<Mojolicious::Guides::Routing> for more information. |
| Expand Down | |  |

22 changes: 13 additions & 9 deletions

22
[lib/Mojolicious/Routes/Match.pm](#diff-56cba07806f29101cb715e9a2bf897ff1418195f58b29ccc69d825f60bd13417 "lib/Mojolicious/Routes/Match.pm")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/lib/Mojolicious/Routes/Match.pm)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -13,20 +13,24 @@ sub path\_for { |
|  |  | my ($self, $name, %values) = (shift, Mojo::Util::\_options(@\_)); |
|  |  |  |
|  |  | # Current route |
|  |  | my $route; |
|  |  | if (!$name || $name eq 'current') { return {} unless $route = $self->endpoint } |
|  |  | my ($route, $current); |
|  |  | if (!$name || $name eq 'current') { |
|  |  | return {} unless $route = $self->endpoint; |
|  |  | $current = 1; |
|  |  | } |
|  |  |  |
|  |  | # Find endpoint |
|  |  | else { return {path => $name} unless $route = $self->root->lookup($name) } |
|  |  |  |
|  |  | # Merge values (clear format) |
|  |  | my $captures = $self->stack->[-1] // {}; |
|  |  | %values = (%$captures, format => undef, %values); |
|  |  | my $pattern = $route->pattern; |
|  |  | $values{format} //= defined $captures->{format} ? $captures->{format} : $pattern->defaults->{format} |
|  |  | if $pattern->constraints->{format}; |
|  |  |  |
|  |  | my $path = $route->render(\%values); |
|  |  | my $captures = $self->stack->[-1] // {}; |
|  |  | my %merged = (%$captures, format => undef, %values); |
|  |  | my $pattern = $route->pattern; |
|  |  | my $constraints = $pattern->constraints; |
|  |  | $merged{format} = ($current ? $captures->{format} : undef) // $pattern->defaults->{format} |
|  |  | if !exists $values{format} && $constraints->{format} && $constraints->{format} ne '1'; |
|  |  |  |
|  |  | my $path = $route->render(\%merged); |
|  |  | return {path => $path, websocket => $route->has\_websocket}; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

16 changes: 8 additions & 8 deletions

16
[lib/Mojolicious/Routes/Pattern.pm](#diff-f6f3e56ffaa3cc6953512939d9c344227ed704b19c8996a99f68a235257d6e31 "lib/Mojolicious/Routes/Pattern.pm")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/lib/Mojolicious/Routes/Pattern.pm)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -125,23 +125,23 @@ sub \_compile { |
|  |  | $regex = $block . $regex if $block; |
|  |  |  |
|  |  | # Format |
|  |  | $regex .= \_compile\_format($constraints->{format}, $defaults->{format}) if $detect; |
|  |  | $regex .= \_compile\_format($constraints->{format}, exists $defaults->{format}) if $detect; |
|  |  |  |
|  |  | $self->regex(qr/^$regex/ps); |
|  |  | } |
|  |  |  |
|  |  | sub \_compile\_format { |
|  |  | my ($format, $default) = @\_; |
|  |  |  |
|  |  | # Default regex |
|  |  | return '/?(?:\.([^/]+))?$' unless defined $format; |
|  |  | my ($format, $has\_default) = @\_; |
|  |  |  |
|  |  | # No regex |
|  |  | return '' unless $format; |
|  |  |  |
|  |  | # Default regex |
|  |  | return '/?(?:\.([^/]+))?$' if $format eq '1'; |
|  |  |  |
|  |  | # Compile custom regex |
|  |  | my $regex = '\.' . \_compile\_req($format); |
|  |  | return $default ? "/?(?:$regex)?\$" : "/?$regex\$"; |
|  |  | return $has\_default ? "/?(?:$regex)?\$" : "/?$regex\$"; |
|  |  | } |
|  |  |  |
|  |  | sub \_compile\_req { |
| Expand Down  Expand Up | | @@ -344,15 +344,15 @@ Match pattern against path and remove matching parts, format detection is disabl |
|  |  | my $pattern = Mojolicious::Routes::Pattern->new; |
|  |  | my $pattern = Mojolicious::Routes::Pattern->new('/users/:id'); |
|  |  | my $pattern = Mojolicious::Routes::Pattern->new('/user/:id', id => qr/\d+/); |
|  |  | my $pattern = Mojolicious::Routes::Pattern->new(format => 0); |
|  |  | my $pattern = Mojolicious::Routes::Pattern->new(format => ['json', 'yaml']); |
|  |  |  |
|  |  | Construct a new L<Mojolicious::Routes::Pattern> object and L</"parse"> pattern if necessary. |
|  |  |  |
|  |  | =head2 parse |
|  |  |  |
|  |  | $pattern = $pattern->parse('/user/:id'); |
|  |  | $pattern = $pattern->parse('/user/:id', id=> qr/\d+/); |
|  |  | $pattern = $pattern->parse(format => 0); |
|  |  | $pattern = $pattern->parse(format => ['json', 'yaml']); |
|  |  |  |
|  |  | Parse pattern. |
|  |  |  |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[lib/Mojolicious/Routes/Route.pm](#diff-7be7af96e5651a8d90f2f63cd66dc40eb7053d94d08ddca8a97d433c9b5a960e "lib/Mojolicious/Routes/Route.pm")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/lib/Mojolicious/Routes/Route.pm)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -221,7 +221,7 @@ sub \_route { |
|  |  | croak qq{Route pattern "@{[$route->pattern->unparsed]}" contains a reserved stash value} |
|  |  | if grep { $self->is\_reserved($\_) } @{$route->pattern->placeholders}; |
|  |  | my $format = $self->pattern->constraints->{format}; |
|  |  | $route->pattern->constraints->{format} //= 0 if defined $format && !$format; |
|  |  | $route->pattern->constraints->{format} //= 1 if defined $format && $format eq '1'; |
|  |  |  |
|  |  | return $route; |
|  |  | } |
| Expand Down  Expand Up | | @@ -461,7 +461,7 @@ L<Mojolicious::Guides::Routing> for more information. |
|  |  |  |
|  |  | $r = $r->parse('/user/:id'); |
|  |  | $r = $r->parse('/user/:id', id => qr/\d+/); |
|  |  | $r = $r->parse(format => 0); |
|  |  | $r = $r->parse(format => ['json', 'yaml']); |
|  |  |  |
|  |  | Parse pattern. |
|  |  |  |
| Expand Down  Expand Up | | @@ -589,7 +589,7 @@ Stringify the whole route. |
|  |  | my $route = $r->under('/:foo' => {foo => 'bar'}); |
|  |  | my $route = $r->under('/:foo' => [foo => qr/\w+/]); |
|  |  | my $route = $r->under('/:foo' => (agent => qr/Firefox/)); |
|  |  | my $route = $r->under([format => 0]); |
|  |  | my $route = $r->under([format => ['json', 'yaml']]); |
|  |  |  |
|  |  | Generate L<Mojolicious::Routes::Route> object for a nested route with its own intermediate destination, takes the same |
|  |  | arguments as L</"any"> (except for the HTTP methods to match, which are not available). See |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[t/mojolicious/charset\_lite\_app.t](#diff-62c9ca699680fc1795b42448ac6e49d2bad10ea4a1d52640bea970f2d98281eb "t/mojolicious/charset_lite_app.t")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/t/mojolicious/charset_lite_app.t)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -27,7 +27,7 @@ app->renderer->add\_handler( |
|  |  | } |
|  |  | ); |
|  |  |  |
|  |  | get '/' => 'index'; |
|  |  | get '/' => [format => [$yatta]] => {format => undef} => 'index'; |
|  |  |  |
|  |  | post '/' => sub { |
|  |  | my $c = shift; |
| Expand Down | |  |

10 changes: 5 additions & 5 deletions

10
[t/mojolicious/exception\_lite\_app.t](#diff-ee8b1a8f1b9802a629232bd7dee93775d0a0cff2a6c73d91ab25f41199c14722 "t/mojolicious/exception_lite_app.t")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/t/mojolicious/exception_lite_app.t)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,19 +51,19 @@ get '/custom\_exception' => sub { die Mojo::Base->new }; |
|  |  |  |
|  |  | get '/dead\_template'; |
|  |  |  |
|  |  | get '/dead\_template\_too'; |
|  |  | get '/dead\_template\_too' => [format => ['xml']]; |
|  |  |  |
|  |  | get '/dead\_handler' => {handler => 'dead'}; |
|  |  | get '/dead\_handler' => [format => ['xml']] => {handler => 'dead'}; |
|  |  |  |
|  |  | get '/dead\_action\_epl' => {handler => 'epl'} => sub { |
|  |  | get '/dead\_action\_epl' => [format => ['xml']] => {handler => 'epl'} => sub { |
|  |  | die "dead action epl!\n"; |
|  |  | }; |
|  |  |  |
|  |  | get '/dead\_included\_template'; |
|  |  |  |
|  |  | get '/dead\_template\_with\_layout'; |
|  |  |  |
|  |  | get '/dead\_action' => sub { die "dead action!\n" }; |
|  |  | get '/dead\_action' => [format => ['xml', 'json']] => {format => undef} => sub { die "dead action!\n" }; |
|  |  |  |
|  |  | get '/double\_dead\_action\_☃' => sub { |
|  |  | eval { die 'double dead action!' }; |
| Expand All | | @@ -76,7 +76,7 @@ get '/trapped' => sub { |
|  |  | $c->render(text => $@->{foo} || 'failed'); |
|  |  | }; |
|  |  |  |
|  |  | get '/missing\_template' => {exception => 'whatever'}; |
|  |  | get '/missing\_template' => [format => ['xml', 'json', 'txt']] => {exception => 'whatever', format => undef}; |
|  |  |  |
|  |  | get '/missing\_template/too' => sub { |
|  |  | my $c = shift; |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[t/mojolicious/group\_lite\_app.t](#diff-91fa245a2cdcec5296594a3995f7cedc9e3d70fdb02ecb242819b1b11da5ec85 "t/mojolicious/group_lite_app.t")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/t/mojolicious/group_lite_app.t)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -162,7 +162,7 @@ group { |
|  |  | return !!0; |
|  |  | }; |
|  |  |  |
|  |  | get '/authgroup' => {text => "You're ok."}; |
|  |  | get '/authgroup' => [format => ['txt']] => {text => "You're ok.", format => undef}; |
|  |  | }; |
|  |  |  |
|  |  | get '/noauthgroup' => {inline => 'Whatever <%= $foo %>.'}; |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[t/mojolicious/layouted\_lite\_app.t](#diff-52f95f8b6843a4bbd0147f9908f4bda22f022136baf6bab1af8a8dd76c4a028e "t/mojolicious/layouted_lite_app.t")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/t/mojolicious/layouted_lite_app.t)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -101,7 +101,7 @@ get '/inline/again' => {inline => 0}; |
|  |  |  |
|  |  | get '/data' => {data => 0}; |
|  |  |  |
|  |  | get '/variants' => {layout => 'variants'} => sub { |
|  |  | get '/variants' => [format => ['txt']] => {layout => 'variants', format => undef} => sub { |
|  |  | my $c = shift; |
|  |  | $c->stash->{variant} = $c->param('device'); |
|  |  | $c->render('variants'); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[t/mojolicious/lib/MojoliciousTest.pm](#diff-77ec1a260e43ac491458b995c23ac8ddf9ed2883456ec17048a8440a36bb6740 "t/mojolicious/lib/MojoliciousTest.pm")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/t/mojolicious/lib/MojoliciousTest.pm)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -116,7 +116,7 @@ sub startup { |
|  |  | $r->any('/test10')->to('baz#index'); |
|  |  |  |
|  |  | # /withblock (template with blocks) |
|  |  | $r->any('/withblock')->to('foo#withBlock'); |
|  |  | $r->any('/withblock', [format => ['txt']])->to('foo#withBlock'); |
|  |  |  |
|  |  | # /staged (authentication with intermediate destination) |
|  |  | my $b = $r->any('/staged')->inline(1)->to('foo#stage1', return => 1); |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[t/mojolicious/lite\_app.t](#diff-8ef986ec608779c4c039069a83dc635e4c8a2759033f2beae0084281b2bed9b5 "t/mojolicious/lite_app.t")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/t/mojolicious/lite_app.t)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -76,7 +76,7 @@ get '/unicode/:0' => sub { |
|  |  | $c->render(text => $c->param('0') . $c->url\_for); |
|  |  | }; |
|  |  |  |
|  |  | get '/' => 'root'; |
|  |  | get '/' => [format => ['html']] => {format => undef} => 'root'; |
|  |  |  |
|  |  | get '/alternatives/:char' => [char => [qw(☃ ♥)]] => sub { |
|  |  | my $c = shift; |
| Expand Down  Expand Up | | @@ -132,7 +132,7 @@ get '/template/exception' => 'dies\_too'; |
|  |  |  |
|  |  | get '/with-format' => {format => 'html'} => 'with-format'; |
|  |  |  |
|  |  | get '/without-format' => 'without-format'; |
|  |  | get '/without-format' => [format => ['html']] => {format => undef} => 'without-format'; |
|  |  |  |
|  |  | any '/json\_too' => {json => {hello => 'world'}}; |
|  |  |  |
| Expand Down  Expand Up | | @@ -198,9 +198,9 @@ get '/привет/мир' => sub { shift->render(text => 'привет мир') |
|  |  |  |
|  |  | get '/root.html' => 'root\_path'; |
|  |  |  |
|  |  | get '/root' => sub { shift->render(text => 'root fallback!') }; |
|  |  | get '/root' => [format => ['txt']] => {format => undef} => sub { shift->render(text => 'root fallback!') }; |
|  |  |  |
|  |  | get '/template.txt' => {template => 'template', format => 'txt'}; |
|  |  | get '/template.txt' => [format => ['epl']] => {template => 'template', format => 'txt'}; |
|  |  |  |
|  |  | get ':number' => [number => qr/0/] => sub { |
|  |  | my $c = shift; |
| Expand Down | |  |

6 changes: 6 additions & 0 deletions

6
[t/mojolicious/pattern.t](#diff-06693bd51ba075449c9d45e122ae74e56771ca0c95f9e35da1fd0f5aaf8dce31 "t/mojolicious/pattern.t")

Show comments

[View file](/mojolicious/mojo/blob/a0c4576ffb11c235088550de9ba7ac4196e1953c/t/mojolicious/pattern.t)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -126,6 +126,7 @@ is $pattern->render({test => $value}), "/$value", 'right result'; |
|  |  | # Format detection |
|  |  | $pattern = Mojolicious::Routes::Pattern->new('/test'); |
|  |  | $pattern->defaults({action => 'index'}); |
|  |  | $pattern->constraints({format => 1}); |
|  |  | ok !$pattern->regex, 'no regex'; |
|  |  | is\_deeply $pattern->match('/test.xml', 1), {action => 'index', format => 'xml'}, 'right structure'; |
|  |  | ok $pattern->regex, 'regex has been compiled on demand'; |
| Expand Down  Expand Up | | @@ -169,6 +170,11 @@ is\_deeply $result, {test => 'foo', action => 'index', format => 'html'}, 'right |
|  |  | is $pattern->render($result), '/foo/v1.0', 'right result'; |
|  |  | is $pattern->render($result, 1), '/foo/v1.0.html', 'right result'; |
|  |  | is $pattern->render({%$result, format => undef}, 1), '/foo/v1.0', 'right result'; |
|  |  |  |
|  |  | # Versioned pattern with format |
|  |  | $pattern = Mojolicious::Routes::Pattern->new('/:test/v1.0'); |
|  |  | $pattern->defaults({action => 'index', format => 'html'}); |
|  |  | $pattern->constraints({format => ['txt']}); |
|  |  | $result = $pattern->match('/foo/v1.0.txt', 1); |
|  |  | is\_deeply $result, {test => 'foo', action => 'index', format => 'txt'}, 'right structure'; |
|  |  | is $pattern->render($result), '/foo/v1.0', 'right result'; |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a0c4576`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmojolicious%2Fmojo%2Fcommit%2Fa0c4576ffb11c235088550de9ba7ac4196e1953c) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


