=== Content from github.com_062c3ace_20250111_181045.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFzBacon%2FCVE-2023-27216_D-Link_DSL-3782_Router_command_injection%2Fblob%2Fmaster%2FCVE-2023-27216_D-Link_DSL-3782_Router_command_injection.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFzBacon%2FCVE-2023-27216_D-Link_DSL-3782_Router_command_injection%2Fblob%2Fmaster%2FCVE-2023-27216_D-Link_DSL-3782_Router_command_injection.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=FzBacon%2FCVE-2023-27216_D-Link_DSL-3782_Router_command_injection)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[FzBacon](/FzBacon)
/
**[CVE-2023-27216\_D-Link\_DSL-3782\_Router\_command\_injection](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection)**
Public

* [Notifications](/login?return_to=%2FFzBacon%2FCVE-2023-27216_D-Link_DSL-3782_Router_command_injection) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2FFzBacon%2FCVE-2023-27216_D-Link_DSL-3782_Router_command_injection)
* [Star
   2](/login?return_to=%2FFzBacon%2FCVE-2023-27216_D-Link_DSL-3782_Router_command_injection)

* [Code](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection)
* [Issues
  0](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/issues)
* [Pull requests
  0](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/pulls)
* [Actions](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/actions)
* [Projects
  0](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/projects)
* [Security](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/security)
* [Insights](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/pulse)

Additional navigation options

* [Code](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection)
* [Issues](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/issues)
* [Pull requests](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/pulls)
* [Actions](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/actions)
* [Projects](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/projects)
* [Security](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/security)
* [Insights](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/pulse)

## Files

 master
## Breadcrumbs

1. [CVE-2023-27216\_D-Link\_DSL-3782\_Router\_command\_injection](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/tree/master)
/
# CVE-2023-27216\_D-Link\_DSL-3782\_Router\_command\_injection.md

Copy path Blame  Blame
## Latest commit

## History

[History](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/commits/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.md)87 lines (66 loc) · 5.19 KB master
## Breadcrumbs

1. [CVE-2023-27216\_D-Link\_DSL-3782\_Router\_command\_injection](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/tree/master)
/
# CVE-2023-27216\_D-Link\_DSL-3782\_Router\_command\_injection.md

Top
## File metadata and controls

* Preview
* Code
* Blame

87 lines (66 loc) · 5.19 KB[Raw](https://github.com/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/refs/heads/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.md)
# CVE-2023-27216\_D-Link\_DSL-3782\_Router\_command\_injection

## 漏洞描述

### 编号

CVE-2023-27216

### 设备信息

**D-Link DSL-3782 ：**

DSL-3782\_REVA\_FIRMWARE\_PATCH\_v1.03 and below

### 漏洞类型

RCE

### 危害

可访问路由器的攻击者需凭借凭证方可执行远程代码

## 复现流程

### 复现设备

**D-Link DSL-3782 ：**

DSL-3782\_REVA\_FIRMWARE\_PATCH\_v1.01

### 固件仿真

同CVE-2022-34527\_D-Link\_DSL-3782\_Router\_command\_injection
<https://media.dlink.eu/support/products/dsl/dsl-3782/driver_software/dsl-3782_a1_eu_1.01_07282016.zip>

### 漏洞分析

已公开信息：

> An issue found in D-Link DSL-3782 v.1.03 allows remote authenticated users to execute arbitrary code as root via OS command injection in multiple setting pages. Settings known to be affected by this issues are:

* Subnet mask fields in network configuration
* Remote log server IP field in logging configuration
* Every field in port forwarding configuration
* Every field in static routes configuration

> The input provided by the user is insufficiently sanitized by the server, so bypassing the client-checks it is possible to inject arbitrary strings directly into .sh scripts. Depending on the affected field, the maximum payload length allowed will be different. Generally speaking, it is possible to inject between 15 and 50 characters. To exploit CVE-2023-27216 an attacker with remote access to the web interface of the D-Link DSL-3782 needs to inject a malicious payload into one of the affected fields. An example of working payload is: `; ping example.org #`.

大致分为四个 source 点，以下以第一点 Subnet mask fields in network configuration 为例。

找到 web 实现功能的页面

[![settings_network](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-25-11.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-25-11.png)

保存后请求的 path boaroot/cgi-bin/New\_GUI/Set/Network.asp

[![post](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-26-15.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-26-15.png)

找到文件，根据 Subnet mask fields 的参数名`lan_netmask1`定位到参数名 `netmask`

[![Network.asp](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-30-46.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-30-46.png)

逆向 cfg\_manager 跟进到一个没函数名的代码段, 将参数拼接进了一个 .sh 脚本

[![netmask](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-21-02.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-21-02.png)

[![xref](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-21-18.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-21-18.png)

[![lanconfig.sh](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-22-47.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-22-47.png)

创建一个函数反编译，虽然原作者声明只有 `netmask` 参数受影响，从这里可以看出 `ip` 参数也被拼接进了脚本，其实也是受影响的。

[![sub_420460](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-27-25.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-27-25.png)

[![word_4A26A4](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-34-40.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-34-40.png)

[![IP](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-35-03.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-35-03.png)

sink 点

[![sub_42D50C](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-31-32.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-31-32.png)

至于此 source 点 向上跟 `mxmlFindElement()` 遇到和 CVE-2022-34527 一样的问题，没得到想要的结果。
以在跟另一个 source 点的时候举例
[![strings](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-33-20.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-33-20.png)

[![xref](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-34-12.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-34-12.png)

[![sub_4765F0](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-35-03.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-35-03.png)

使用 `springf()` 将 `v9` 拼接进 `v10` ，接着 `system()` 执行。

而 `v9` 由 `tcapi_get()` 读入，跟踪如下

`tcapi_get()` 是 extern 来的，具体实现在 lib/libtcapi.so

[![extern](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-38-47.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-38-47.png)

[![tcapi_get](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-40-04.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-40-04.png)

跟进 lib/libtcapi.so ， `tcapi_get(const char *a1, const char *a2, char *a3)` 的 `a3` 由 `v7`决定

[![tcapi_get](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-41-09.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-41-09.png)

继续跟进 `send2CfgManager()` ，用 socket 可以分别向 /tmp/tcapi\_sock 写入、读取数据。 由 `tcapi_get()` 的调用会读取到 `buf` 也就是 `a1` 中。
[![send2CfgManager](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-51-41.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-51-41.png)

[![recv](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-54-27.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-16-54-27.png)

总的来说，

用户输入 由 `boa::TCWebApi_set()` 调用 `libtcapi::tcapi_set()` 调用 `libtcapi::send2CfgManager()` 将数据写入到 /tmp/tcapi\_sock 中。

`cfg_manager::tcapi_get()` extern 的 `libtcapi::tcapi_set()` 调用 `libtcapi::send2CfgManager()` 将数据从 /tmp/tcapi\_sock 读取出来。

因此将用户输入的ip拼接进 `system()` 执行

### 漏洞利用

[![rce](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-15-18-43-33.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-15-18-43-33.png)

实际上ip参数也受影响

[![rce_ip](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/raw/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-42-35.png)](/FzBacon/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection/blob/master/CVE-2023-27216_D-Link_DSL-3782_Router_command_injection.assets/2023-04-18-18-42-35.png)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


