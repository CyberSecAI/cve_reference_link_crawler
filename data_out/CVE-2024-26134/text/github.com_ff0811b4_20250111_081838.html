
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fagronholm%2Fcbor2%2Fpull%2F204)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fagronholm%2Fcbor2%2Fpull%2F204)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=agronholm%2Fcbor2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[agronholm](/agronholm)
/
**[cbor2](/agronholm/cbor2)**
Public

* [Notifications](/login?return_to=%2Fagronholm%2Fcbor2) You must be signed in to change notification settings
* [Fork
  59](/login?return_to=%2Fagronholm%2Fcbor2)
* [Star
   232](/login?return_to=%2Fagronholm%2Fcbor2)

* [Code](/agronholm/cbor2)
* [Issues
  25](/agronholm/cbor2/issues)
* [Pull requests
  7](/agronholm/cbor2/pulls)
* [Actions](/agronholm/cbor2/actions)
* [Projects
  0](/agronholm/cbor2/projects)
* [Security](/agronholm/cbor2/security)
* [Insights](/agronholm/cbor2/pulse)

Additional navigation options

* [Code](/agronholm/cbor2)
* [Issues](/agronholm/cbor2/issues)
* [Pull requests](/agronholm/cbor2/pulls)
* [Actions](/agronholm/cbor2/actions)
* [Projects](/agronholm/cbor2/projects)
* [Security](/agronholm/cbor2/security)
* [Insights](/agronholm/cbor2/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fagronholm%2Fcbor2%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fagronholm%2Fcbor2%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fixed MemoryError when decoding large definite strings #204

 Merged

[agronholm](/agronholm)
merged 7 commits into
[master](/agronholm/cbor2/tree/master "agronholm/cbor2:master")
from
[fix-memoryerror](/agronholm/cbor2/tree/fix-memoryerror "agronholm/cbor2:fix-memoryerror")

Jan 14, 2024

 Merged

# [Fixed MemoryError when decoding large definite strings](#top) #204

[agronholm](/agronholm)
merged 7 commits into
[master](/agronholm/cbor2/tree/master "agronholm/cbor2:master")
from
[fix-memoryerror](/agronholm/cbor2/tree/fix-memoryerror "agronholm/cbor2:fix-memoryerror")

Jan 14, 2024

+263

−47

[Conversation
21](/agronholm/cbor2/pull/204)
[Commits
7](/agronholm/cbor2/pull/204/commits)
[Checks
11](/agronholm/cbor2/pull/204/checks)
[Files changed
6](/agronholm/cbor2/pull/204/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![agronholm](https://avatars.githubusercontent.com/u/130003?s=60&v=4)](/agronholm)

Copy link

Owner

### @agronholm **[agronholm](/agronholm)** commented [Dec 30, 2023](#issue-2060475600)

Relates to [#198](https://github.com/agronholm/cbor2/issues/198).

Sorry, something went wrong.

All reactions

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=40&v=4)](/agronholm)

`[Fixed MemoryError when decoding large definite byte-strings or text s…](/agronholm/cbor2/pull/204/commits/42f75c9518107a0eb7faffa664f2bf5492fa9599 "Fixed MemoryError when decoding large definite byte-strings or text strings")`
 …

`[42f75c9](/agronholm/cbor2/pull/204/commits/42f75c9518107a0eb7faffa664f2bf5492fa9599)`

```
…trings
```

[![@coveralls](https://avatars.githubusercontent.com/u/2354108?s=80&v=4)](/coveralls)

Copy link

### **[coveralls](/coveralls)** commented [Dec 30, 2023](#issuecomment-1872404909) • edited Loading

| [Coverage Status](https://coveralls.io/builds/65060360)  coverage: 93.169% (-0.07%) from 93.237% when pulling **[cbc78c5](https://github.com/agronholm/cbor2/commit/cbc78c5e704c39e0151a0e26853879000f20bbaf) on fix-memoryerror** into **[0d54000](https://github.com/agronholm/cbor2/commit/0d54000bc17f677ac99cb82cc417589610d789d7) on master**. |
| --- |

All reactions

Sorry, something went wrong.

[![@mschwager](https://avatars.githubusercontent.com/u/1724818?s=80&u=c4cdef63eabf48b9795667ffdcd6035d51576a8d&v=4)](/mschwager)

Copy link

Contributor

### **[mschwager](/mschwager)** commented [Jan 2, 2024](#issuecomment-1874381335)

| I fuzzed this branch a bit, and it produced the following crash:  Output ``` ==1==ERROR: AddressSanitizer: heap-use-after-free on address 0x51600068f190 at pc 0xffff9530ccb8 bp 0xffffc175bb00 sp 0xffffc175baf8 READ of size 8 at 0x51600068f190 thread T0     #0 0xffff9530ccb4 in Py_SIZE /usr/include/python3.11/object.h:142:20     #1 0xffff9530ccb4 in PyBytes_GET_SIZE /usr/include/python3.11/cpython/bytesobject.h:45:12     #2 0xffff9530ccb4 in fp_read_object /app/cbor2/source/decoder.c:367:47     #3 0xffff95308d8c in decode_definite_bytestring /app/cbor2/source/decoder.c:554:21     #4 0xffff95308d8c in decode_bytestring /app/cbor2/source/decoder.c:625:15     #5 0xffff95306834 in decode /app/cbor2/source/decoder.c:1736:27     #6 0xffff9530b1d4 in decode_map /app/cbor2/source/decoder.c:914:33     #7 0xffff953068b4 in decode /app/cbor2/source/decoder.c:1739:27     #8 0xffff9530bea0 in decode_semantic /app/cbor2/source/decoder.c:988:29     #9 0xffff953068d4 in decode /app/cbor2/source/decoder.c:1740:27     #10 0xffff9530b460 in decode_map /app/cbor2/source/decoder.c:894:27     #11 0xffff953068b4 in decode /app/cbor2/source/decoder.c:1739:27     #12 0xffff9530a634 in decode_definite_array /app/cbor2/source/decoder.c:818:28     #13 0xffff9530a634 in decode_array /app/cbor2/source/decoder.c:875:16     #14 0xffff95306814 in decode /app/cbor2/source/decoder.c:1738:27     #15 0xffff95312550 in CBORDecoder_decode_stringref_ns /app/cbor2/source/decoder.c:1458:15     #16 0xffff9530be40 in decode_semantic /app/cbor2/source/decoder.c:977:31     #17 0xffff953068d4 in decode /app/cbor2/source/decoder.c:1740:27     #18 0xffff9530b47c in decode_map /app/cbor2/source/decoder.c:899:33     #19 0xffff953068b4 in decode /app/cbor2/source/decoder.c:1739:27     #20 0xffff9530b47c in decode_map /app/cbor2/source/decoder.c:899:33     #21 0xffff953068b4 in decode /app/cbor2/source/decoder.c:1739:27     #22 0xffff953107b8 in CBORDecoder_decode_bigfloat /app/cbor2/source/decoder.c:1246:13     #23 0xffff9530bff8 in decode_semantic /app/cbor2/source/decoder.c:969:31     #24 0xffff953068d4 in decode /app/cbor2/source/decoder.c:1740:27     #25 0xffff953358f0 in CBOR2_load /app/cbor2/source/module.c:318:19     #26 0xffff953358f0 in CBOR2_loads /app/cbor2/source/module.c:367:19     #27 0x4c9d58  (/usr/bin/python3.11+0x4c9d58) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #28 0x494544 in _PyObject_MakeTpCall (/usr/bin/python3.11+0x494544) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #29 0x4aa238 in _PyEval_EvalFrameDefault (/usr/bin/python3.11+0x4aa238) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #30 0x4e2ce8 in _PyFunction_Vectorcall (/usr/bin/python3.11+0x4e2ce8) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #31 0xffff955db6bc in pybind11::detail::simple_collector<(pybind11::return_value_policy)1>::call(_object*) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1502:47     #32 0xffff955db6bc in pybind11::object pybind11::detail::object_api<pybind11::handle>::operator()<(pybind11::return_value_policy)1, pybind11::bytes>(pybind11::bytes&&) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1672:95     #33 0xffff955db6bc in pybind11::detail::type_caster<std::function<void (pybind11::bytes)>, void>::load(pybind11::handle, bool)::func_wrapper::operator()(pybind11::bytes) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/functional.h:109:82     #34 0xffff955db6bc in void std::__invoke_impl<void, pybind11::detail::type_caster<std::function<void (pybind11::bytes)>, void>::load(pybind11::handle, bool)::func_wrapper&, pybind11::bytes>(std::__invoke_other, pybind11::detail::type_caster<std::function<void (pybind11::bytes)>, void>::load(pybind11::handle, bool)::func_wrapper&, pybind11::bytes&&) /usr/include/c++/12/bits/invoke.h:61:36     #35 0xffff955db6bc in _ZSt10__invoke_rIvRZN8pybind116detail11type_casterISt8functionIFvNS0_5bytesEEEvE4loadENS0_6handleEbE12func_wrapperJS4_EENSt9enable_ifIXsrSt6__and_IJSt7is_voidIT_ESt14__is_invocableIT0_JDpT1_EEEE5valueESE_E4typeEOSH_DpOSI_ /usr/include/c++/12/bits/invoke.h:154:33     #36 0xffff955db6bc in std::_Function_handler<void (pybind11::bytes), pybind11::detail::type_caster<std::function<void (pybind11::bytes)>, void>::load(pybind11::handle, bool)::func_wrapper>::_M_invoke(std::_Any_data const&, pybind11::bytes&&) /usr/include/c++/12/bits/std_function.h:290:30     #37 0xffff955c270c in std::function<void (pybind11::bytes)>::operator()(pybind11::bytes) const /usr/include/c++/12/bits/std_function.h:591:9     #38 0xffff955c270c in void pybind11::detail::argument_loader<pybind11::bytes>::call_impl<void, std::function<void (pybind11::bytes)>&, 0ul, pybind11::detail::void_type>(std::function<void (pybind11::bytes)>&, std::integer_sequence<unsigned long, 0ul>, pybind11::detail::void_type&&) && /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1480:37     #39 0xffff955c270c in _ZNO8pybind116detail15argument_loaderIJNS_5bytesEEE4callIvNS0_9void_typeERSt8functionIFvS2_EEEENSt9enable_ifIXsrSt7is_voidIT_E5valueES5_E4typeEOT1_ /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1454:65     #40 0xffff955c270c in void pybind11::cpp_function::initialize<std::function<void (pybind11::bytes)>&, void, pybind11::bytes, pybind11::return_value_policy>(std::function<void (pybind11::bytes)>&, void (*)(pybind11::bytes), pybind11::return_value_policy const&)::'lambda1'(pybind11::detail::function_call&)::operator()(pybind11::detail::function_call&) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/pybind11.h:254:75     #41 0xffff955c270c in void pybind11::cpp_function::initialize<std::function<void (pybind11::bytes)>&, void, pybind11::bytes, pybind11::return_value_policy>(std::function<void (pybind11::bytes)>&, void (*)(pybind11::bytes), pybind11::return_value_policy const&)::'lambda1'(pybind11::detail::function_call&)::_FUN(pybind11::detail::function_call&) /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/pybind11.h:224:21     #42 0xffff955d1ee4 in pybind11::cpp_function::dispatcher(_object*, _object*, _object*) /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/pybind11.h:946:35     #43 0x4c9d58  (/usr/bin/python3.11+0x4c9d58) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #44 0x5987d4 in PyObject_CallObject (/usr/bin/python3.11+0x5987d4) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #45 0xffff9509c0dc in pybind11::detail::simple_collector<(pybind11::return_value_policy)1>::call(_object*) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1502:47     #46 0xffff9509c0dc in pybind11::object pybind11::detail::object_api<pybind11::handle>::operator()<(pybind11::return_value_policy)1, pybind11::bytes>(pybind11::bytes&&) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1672:95     #47 0xffff9509c0dc in pybind11::detail::type_caster<std::function<void (pybind11::bytes)>, void>::load(pybind11::handle, bool)::func_wrapper::operator()(pybind11::bytes) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/functional.h:109:82     #48 0xffff9509c0dc in void std::__invoke_impl<void, pybind11::detail::type_caster<std::function<void (pybind11::bytes)>, void>::load(pybind11::handle, bool)::func_wrapper&, pybind11::bytes>(std::__invoke_other, pybind11::detail::type_caster<std::function<void (pybind11::bytes)>, void>::load(pybind11::handle, bool)::func_wrapper&, pybind11::bytes&&) /usr/include/c++/12/bits/invoke.h:61:36     #49 0xffff9509c0dc in _ZSt10__invoke_rIvRZN8pybind116detail11type_casterISt8functionIFvNS0_5bytesEEEvE4loadENS0_6handleEbE12func_wrapperJS4_EENSt9enable_ifIXsrSt6__and_IJSt7is_voidIT_ESt14__is_invocableIT0_JDpT1_EEEE5valueESE_E4typeEOSH_DpOSI_ /usr/include/c++/12/bits/invoke.h:154:33     #50 0xffff9509c0dc in std::_Function_handler<void (pybind11::bytes), pybind11::detail::type_caster<std::function<void (pybind11::bytes)>, void>::load(pybind11::handle, bool)::func_wrapper>::_M_invoke(std::_Any_data const&, pybind11::bytes&&) /usr/include/c++/12/bits/std_function.h:290:30     #51 0xffff95089d38 in std::function<void (pybind11::bytes)>::operator()(pybind11::bytes) const /usr/include/c++/12/bits/std_function.h:591:9     #52 0xffff95089d38 in atheris::TestOneInput(unsigned char const*, unsigned long) /tmp/pip-install-ssq6l7v4/atheris_afc2a48c09d548c399b1f66614c10d64/src/native/core.cc:146:26     #53 0xffff98985308 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /home/tcwg-buildslave/workspace/tcwg-llvm-release/tcwg-jade-03/final/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13     #54 0xffff98984bec in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool, bool*) /home/tcwg-buildslave/workspace/tcwg-llvm-release/tcwg-jade-03/final/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:516:7     #55 0xffff989862d0 in fuzzer::Fuzzer::MutateAndTestOne() /home/tcwg-buildslave/workspace/tcwg-llvm-release/tcwg-jade-03/final/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:760:19     #56 0xffff9898712c in fuzzer::Fuzzer::Loop(std::__Fuzzer::vector<fuzzer::SizedFile, std::__Fuzzer::allocator<fuzzer::SizedFile>>&) /home/tcwg-buildslave/workspace/tcwg-llvm-release/tcwg-jade-03/final/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:905:5     #57 0xffff98976d00 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /home/tcwg-buildslave/workspace/tcwg-llvm-release/tcwg-jade-03/final/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:911:6     #58 0xffff9508ac28 in atheris::start_fuzzing(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>> const&, std::function<void (pybind11::bytes)> const&) /tmp/pip-install-ssq6l7v4/atheris_afc2a48c09d548c399b1f66614c10d64/src/native/core.cc:226:15     #59 0xffff9509b9f8 in void pybind11::detail::argument_loader<std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>> const&, std::function<void (pybind11::bytes)> const&>::call_impl<void, void (*&)(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>> const&, std::function<void (pybind11::bytes)> const&), 0ul, 1ul, pybind11::detail::void_type>(void (*&)(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>> const&, std::function<void (pybind11::bytes)> const&), std::integer_sequence<unsigned long, 0ul, 1ul>, pybind11::detail::void_type&&) && /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1480:37     #60 0xffff9509b9f8 in _ZNO8pybind116detail15argument_loaderIJRKSt6vectorINSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEESaIS8_EERKSt8functionIFvNS_5bytesEEEEE4callIvNS0_9void_typeERPFvSC_SI_EEENSt9enable_ifIXsrSt7is_voidIT_E5valueESL_E4typeEOT1_ /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1454:65     #61 0xffff9509b9f8 in void pybind11::cpp_function::initialize<void (*&)(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>> const&, std::function<void (pybind11::bytes)> const&), void, std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>> const&, std::function<void (pybind11::bytes)> const&, pybind11::name, pybind11::scope, pybind11::sibling>(void (*&)(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>> const&, std::function<void (pybind11::bytes)> const&), void (*)(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>> const&, std::function<void (pybind11::bytes)> const&), pybind11::name const&, pybind11::scope const&, pybind11::sibling const&)::'lambda1'(pybind11::detail::function_call&)::operator()(pybind11::detail::function_call&) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/pybind11.h:254:75     #62 0xffff9509b9f8 in void pybind11::cpp_function::initialize<void (*&)(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>> const&, std::function<void (pybind11::bytes)> const&), void, std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>> const&, std::function<void (pybind11::bytes)> const&, pybind11::name, pybind11::scope, pybind11::sibling>(void (*&)(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>> const&, std::function<void (pybind11::bytes)> const&), void (*)(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>> const&, std::function<void (pybind11::bytes)> const&), pybind11::name const&, pybind11::scope const&, pybind11::sibling const&)::'lambda1'(pybind11::detail::function_call&)::_FUN(pybind11::detail::function_call&) /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/pybind11.h:224:21     #63 0xffff950988b8 in pybind11::cpp_function::dispatcher(_object*, _object*, _object*) /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/pybind11.h:946:35     #64 0x4c9d58  (/usr/bin/python3.11+0x4c9d58) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #65 0x5987d4 in PyObject_CallObject (/usr/bin/python3.11+0x5987d4) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #66 0xffff955bbdac in pybind11::detail::simple_collector<(pybind11::return_value_policy)1>::call(_object*) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1502:47     #67 0xffff955bbdac in pybind11::object pybind11::detail::object_api<pybind11::detail::accessor<pybind11::detail::accessor_policies::str_attr>>::operator()<(pybind11::return_value_policy)1, std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>>&, std::function<void (pybind11::bytes)>&>(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>>>&, std::function<void (pybind11::bytes)>&) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1672:95     #68 0xffff955bbdac in atheris::Fuzz() /tmp/pip-install-ssq6l7v4/atheris_afc2a48c09d548c399b1f66614c10d64/src/native/atheris.cc:249:29     #69 0xffff955c1540 in void pybind11::detail::argument_loader<>::call_impl<void, void (*&)(), pybind11::detail::void_type>(void (*&)(), std::integer_sequence<unsigned long>, pybind11::detail::void_type&&) && /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1480:37     #70 0xffff955c1540 in _ZNO8pybind116detail15argument_loaderIJEE4callIvNS0_9void_typeERPFvvEEENSt9enable_ifIXsrSt7is_voidIT_E5valueES4_E4typeEOT1_ /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1454:65     #71 0xffff955c1540 in void pybind11::cpp_function::initialize<void (*&)(), void, pybind11::name, pybind11::scope, pybind11::sibling>(void (*&)(), void (*)(), pybind11::name const&, pybind11::scope const&, pybind11::sibling const&)::'lambda1'(pybind11::detail::function_call&)::operator()(pybind11::detail::function_call&) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/pybind11.h:254:75     #72 0xffff955c1540 in void pybind11::cpp_function::initialize<void (*&)(), void, pybind11::name, pybind11::scope, pybind11::sibling>(void (*&)(), void (*)(), pybind11::name const&, pybind11::scope const&, pybind11::sibling const&)::'lambda1'(pybind11::detail::function_call&)::_FUN(pybind11::detail::function_call&) /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/pybind11.h:224:21     #73 0xffff955d1ee4 in pybind11::cpp_function::dispatcher(_object*, _object*, _object*) /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/pybind11.h:946:35     #74 0x4c9d58  (/usr/bin/python3.11+0x4c9d58) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #75 0x494544 in _PyObject_MakeTpCall (/usr/bin/python3.11+0x494544) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #76 0x4aa238 in _PyEval_EvalFrameDefault (/usr/bin/python3.11+0x4aa238) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #77 0x4a0b5c in PyEval_EvalCode (/usr/bin/python3.11+0x4a0b5c) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #78 0x5fafa4  (/usr/bin/python3.11+0x5fafa4) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #79 0x5f7bcc  (/usr/bin/python3.11+0x5f7bcc) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #80 0x60875c  (/usr/bin/python3.11+0x60875c) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #81 0x608304 in _PyRun_SimpleFileObject (/usr/bin/python3.11+0x608304) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #82 0x60806c in _PyRun_AnyFileObject (/usr/bin/python3.11+0x60806c) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #83 0x606318 in Py_RunMain (/usr/bin/python3.11+0x606318) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #84 0x5d0150 in Py_BytesMain (/usr/bin/python3.11+0x5d0150) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #85 0xffff9866777c  (/lib/aarch64-linux-gnu/libc.so.6+0x2777c) (BuildId: 122e8b69a986ce5b1fde3a0fa5d5c4fd522c701f)     #86 0xffff98667854 in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x27854) (BuildId: 122e8b69a986ce5b1fde3a0fa5d5c4fd522c701f)     #87 0x5cffec in _start (/usr/bin/python3.11+0x5cffec) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)  0x51600068f190 is located 16 bytes inside of 518-byte region [0x51600068f180,0x51600068f386) freed by thread T0 here:     #0 0xffff98a99a9c in free /home/tcwg-buildslave/workspace/tcwg-llvm-release/tcwg-jade-03/final/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:52:3     #1 0x4c00f4  (/usr/bin/python3.11+0x4c00f4) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #2 0xffff9530cac4 in Py_DECREF /usr/include/python3.11/object.h:538:9     #3 0xffff9530cac4 in fp_read_object /app/cbor2/source/decoder.c:363:17     #4 0xffff95308d8c in decode_definite_bytestring /app/cbor2/source/decoder.c:554:21     #5 0xffff95308d8c in decode_bytestring /app/cbor2/source/decoder.c:625:15     #6 0xffff95306834 in decode /app/cbor2/source/decoder.c:1736:27     #7 0xffff9530b1d4 in decode_map /app/cbor2/source/decoder.c:914:33     #8 0xffff953068b4 in decode /app/cbor2/source/decoder.c:1739:27     #9 0xffff9530bea0 in decode_semantic /app/cbor2/source/decoder.c:988:29     #10 0xffff953068d4 in decode /app/cbor2/source/decoder.c:1740:27     #11 0xffff9530b460 in decode_map /app/cbor2/source/decoder.c:894:27     #12 0xffff953068b4 in decode /app/cbor2/source/decoder.c:1739:27     #13 0xffff9530a634 in decode_definite_array /app/cbor2/source/decoder.c:818:28     #14 0xffff9530a634 in decode_array /app/cbor2/source/decoder.c:875:16     #15 0xffff95306814 in decode /app/cbor2/source/decoder.c:1738:27     #16 0xffff95312550 in CBORDecoder_decode_stringref_ns /app/cbor2/source/decoder.c:1458:15     #17 0xffff9530be40 in decode_semantic /app/cbor2/source/decoder.c:977:31     #18 0xffff953068d4 in decode /app/cbor2/source/decoder.c:1740:27     #19 0xffff9530b47c in decode_map /app/cbor2/source/decoder.c:899:33     #20 0xffff953068b4 in decode /app/cbor2/source/decoder.c:1739:27     #21 0xffff9530b47c in decode_map /app/cbor2/source/decoder.c:899:33     #22 0xffff953068b4 in decode /app/cbor2/source/decoder.c:1739:27     #23 0xffff953107b8 in CBORDecoder_decode_bigfloat /app/cbor2/source/decoder.c:1246:13     #24 0xffff9530bff8 in decode_semantic /app/cbor2/source/decoder.c:969:31     #25 0xffff953068d4 in decode /app/cbor2/source/decoder.c:1740:27     #26 0xffff953358f0 in CBOR2_load /app/cbor2/source/module.c:318:19     #27 0xffff953358f0 in CBOR2_loads /app/cbor2/source/module.c:367:19     #28 0x4c9d58  (/usr/bin/python3.11+0x4c9d58) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #29 0x494544 in _PyObject_MakeTpCall (/usr/bin/python3.11+0x494544) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #30 0x4aa238 in _PyEval_EvalFrameDefault (/usr/bin/python3.11+0x4aa238) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #31 0x4e2ce8 in _PyFunction_Vectorcall (/usr/bin/python3.11+0x4e2ce8) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #32 0xffff955db6bc in pybind11::detail::simple_collector<(pybind11::return_value_policy)1>::call(_object*) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1502:47     #33 0xffff955db6bc in pybind11::object pybind11::detail::object_api<pybind11::handle>::operator()<(pybind11::return_value_policy)1, pybind11::bytes>(pybind11::bytes&&) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1672:95     #34 0xffff955db6bc in pybind11::detail::type_caster<std::function<void (pybind11::bytes)>, void>::load(pybind11::handle, bool)::func_wrapper::operator()(pybind11::bytes) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/functional.h:109:82     #35 0xffff955db6bc in void std::__invoke_impl<void, pybind11::detail::type_caster<std::function<void (pybind11::bytes)>, void>::load(pybind11::handle, bool)::func_wrapper&, pybind11::bytes>(std::__invoke_other, pybind11::detail::type_caster<std::function<void (pybind11::bytes)>, void>::load(pybind11::handle, bool)::func_wrapper&, pybind11::bytes&&) /usr/include/c++/12/bits/invoke.h:61:36     #36 0xffff955db6bc in _ZSt10__invoke_rIvRZN8pybind116detail11type_casterISt8functionIFvNS0_5bytesEEEvE4loadENS0_6handleEbE12func_wrapperJS4_EENSt9enable_ifIXsrSt6__and_IJSt7is_voidIT_ESt14__is_invocableIT0_JDpT1_EEEE5valueESE_E4typeEOSH_DpOSI_ /usr/include/c++/12/bits/invoke.h:154:33     #37 0xffff955db6bc in std::_Function_handler<void (pybind11::bytes), pybind11::detail::type_caster<std::function<void (pybind11::bytes)>, void>::load(pybind11::handle, bool)::func_wrapper>::_M_invoke(std::_Any_data const&, pybind11::bytes&&) /usr/include/c++/12/bits/std_function.h:290:30     #38 0xffff955c270c in std::function<void (pybind11::bytes)>::operator()(pybind11::bytes) const /usr/include/c++/12/bits/std_function.h:591:9     #39 0xffff955c270c in void pybind11::detail::argument_loader<pybind11::bytes>::call_impl<void, std::function<void (pybind11::bytes)>&, 0ul, pybind11::detail::void_type>(std::function<void (pybind11::bytes)>&, std::integer_sequence<unsigned long, 0ul>, pybind11::detail::void_type&&) && /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1480:37     #40 0xffff955c270c in _ZNO8pybind116detail15argument_loaderIJNS_5bytesEEE4callIvNS0_9void_typeERSt8functionIFvS2_EEEENSt9enable_ifIXsrSt7is_voidIT_E5valueES5_E4typeEOT1_ /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/detail/../cast.h:1454:65     #41 0xffff955c270c in void pybind11::cpp_function::initialize<std::function<void (pybind11::bytes)>&, void, pybind11::bytes, pybind11::return_value_policy>(std::function<void (pybind11::bytes)>&, void (*)(pybind11::bytes), pybind11::return_value_policy const&)::'lambda1'(pybind11::detail::function_call&)::operator()(pybind11::detail::function_call&) const /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/pybind11.h:254:75     #42 0xffff955c270c in void pybind11::cpp_function::initialize<std::function<void (pybind11::bytes)>&, void, pybind11::bytes, pybind11::return_value_policy>(std::function<void (pybind11::bytes)>&, void (*)(pybind11::bytes), pybind11::return_value_policy const&)::'lambda1'(pybind11::detail::function_call&)::_FUN(pybind11::detail::function_call&) /tmp/pip-build-env-dfdgednk/normal/lib/python3.11/site-packages/pybind11/include/pybind11/pybind11.h:224:21  previously allocated by thread T0 here:     #0 0xffff98a99d30 in malloc /home/tcwg-buildslave/workspace/tcwg-llvm-release/tcwg-jade-03/final/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:69:3     #1 0x5a25d4  (/usr/bin/python3.11+0x5a25d4) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #2 0x4d10ec  (/usr/bin/python3.11+0x4d10ec) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #3 0x4c800c  (/usr/bin/python3.11+0x4c800c) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #4 0x4c7988 in PyObject_CallFunctionObjArgs (/usr/bin/python3.11+0x4c7988) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #5 0xffff9530c920 in fp_read_object /app/cbor2/source/decoder.c:356:15     #6 0xffff95308d8c in decode_definite_bytestring /app/cbor2/source/decoder.c:554:21     #7 0xffff95308d8c in decode_bytestring /app/cbor2/source/decoder.c:625:15     #8 0xffff95306834 in decode /app/cbor2/source/decoder.c:1736:27     #9 0xffff9530b1d4 in decode_map /app/cbor2/source/decoder.c:914:33     #10 0xffff953068b4 in decode /app/cbor2/source/decoder.c:1739:27     #11 0xffff9530bea0 in decode_semantic /app/cbor2/source/decoder.c:988:29     #12 0xffff953068d4 in decode /app/cbor2/source/decoder.c:1740:27     #13 0xffff9530b460 in decode_map /app/cbor2/source/decoder.c:894:27     #14 0xffff953068b4 in decode /app/cbor2/source/decoder.c:1739:27     #15 0xffff9530a634 in decode_definite_array /app/cbor2/source/decoder.c:818:28     #16 0xffff9530a634 in decode_array /app/cbor2/source/decoder.c:875:16     #17 0xffff95306814 in decode /app/cbor2/source/decoder.c:1738:27     #18 0xffff95312550 in CBORDecoder_decode_stringref_ns /app/cbor2/source/decoder.c:1458:15     #19 0xffff9530be40 in decode_semantic /app/cbor2/source/decoder.c:977:31     #20 0xffff953068d4 in decode /app/cbor2/source/decoder.c:1740:27     #21 0xffff9530b47c in decode_map /app/cbor2/source/decoder.c:899:33     #22 0xffff953068b4 in decode /app/cbor2/source/decoder.c:1739:27     #23 0xffff9530b47c in decode_map /app/cbor2/source/decoder.c:899:33     #24 0xffff953068b4 in decode /app/cbor2/source/decoder.c:1739:27     #25 0xffff953107b8 in CBORDecoder_decode_bigfloat /app/cbor2/source/decoder.c:1246:13     #26 0xffff9530bff8 in decode_semantic /app/cbor2/source/decoder.c:969:31     #27 0xffff953068d4 in decode /app/cbor2/source/decoder.c:1740:27     #28 0xffff953358f0 in CBOR2_load /app/cbor2/source/module.c:318:19     #29 0xffff953358f0 in CBOR2_loads /app/cbor2/source/module.c:367:19     #30 0x4c9d58  (/usr/bin/python3.11+0x4c9d58) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #31 0x494544 in _PyObject_MakeTpCall (/usr/bin/python3.11+0x494544) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)     #32 0x4aa238 in _PyEval_EvalFrameDefault (/usr/bin/python3.11+0x4aa238) (BuildId: 15a1b7b17a3e246ca60bac3646ced99af27ca711)  SUMMARY: AddressSanitizer: heap-use-after-free /usr/include/python3.11/object.h:142:20 in Py_SIZE Shadow bytes around the buggy address:   0x51600068ef00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x51600068ef80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x51600068f000: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x51600068f080: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x51600068f100: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x51600068f180: fd fd[fd]fd fd fd fd fd fd fd fd fd fd fd fd fd   0x51600068f200: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd   0x51600068f280: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd   0x51600068f300: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd   0x51600068f380: fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x51600068f400: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==1==ABORTING MS: 4 InsertRepeatedBytes-InsertRepeatedBytes-InsertByte-CMP- DE: "~\377\377\377\377\377\377\336"-; base unit: b4d12705e8bb56c5481ecec9ebfda713fc9676b1 artifact_prefix='/tmp/output/'; Test unit written to /tmp/output/crash-54a4c03551e10f514542bdf35c00142e617b1ff1  ```   I've attached the crash here: [crash-54a4c03551e10f514542bdf35c00142e617b1ff1.txt](https://github.com/agronholm/cbor2/files/13812882/crash-54a4c03551e10f514542bdf35c00142e617b1ff1.txt) |
| --- |

All reactions

Sorry, something went wrong.

[![@mschwager](https://avatars.githubusercontent.com/u/1724818?s=80&u=c4cdef63eabf48b9795667ffdcd6035d51576a8d&v=4)](/mschwager)

Copy link

Contributor

### **[mschwager](/mschwager)** commented [Jan 2, 2024](#issuecomment-1874467670)

| Would you be interested in having your project be a part of [OSS-Fuzz](https://github.com/google/oss-fuzz)? That could help with automatically finding crashes and bugs for you. I could take care of [adding it as a new project](https://google.github.io/oss-fuzz/getting-started/accepting-new-projects/) - all I'd need is a primary contact email address. |
| --- |

All reactions

Sorry, something went wrong.

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 2, 2024](#issuecomment-1874608842)

| Sounds okay. Is it comparable with Hypothesis? |
| --- |

All reactions

Sorry, something went wrong.

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 2, 2024](#issuecomment-1874609225)

| And my primary contact address is alex.gronholm@nextday.fi. |
| --- |

All reactions

Sorry, something went wrong.

[![@mschwager](https://avatars.githubusercontent.com/u/1724818?s=80&u=c4cdef63eabf48b9795667ffdcd6035d51576a8d&v=4)](/mschwager)

Copy link

Contributor

### **[mschwager](/mschwager)** commented [Jan 2, 2024](#issuecomment-1874615742)

| And my primary contact address is alex.gronholm@nextday.fi.  Hmm, the [adding new projects](https://google.github.io/oss-fuzz/getting-started/accepting-new-projects/) docs say that a Google account is required. Is that email address connected to a Google account by chance?  Fuzzing testing is similar in some ways to Hypothesis. OSS-Fuzz is a project by Google to provide free compute cycles to fuzz OSS software. For more information on fuzzing, I'd recommend starting [here](https://github.com/google/oss-fuzz?tab=readme-ov-file#oss-fuzz-continuous-fuzzing-for-open-source-software). |
| --- |

All reactions

Sorry, something went wrong.

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 2, 2024](#issuecomment-1874616185)

| Yes, that's associated with a Google account. |
| --- |

 👍
1
 mschwager reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 3, 2024](#issuecomment-1875079824)

| I've attached the crash here: [crash-54a4c03551e10f514542bdf35c00142e617b1ff1.txt](https://github.com/agronholm/cbor2/files/13812882/crash-54a4c03551e10f514542bdf35c00142e617b1ff1.txt)  What do I do with this if I want to reproduce the crash? |
| --- |

All reactions

Sorry, something went wrong.

[![@mschwager](https://avatars.githubusercontent.com/u/1724818?s=80&u=c4cdef63eabf48b9795667ffdcd6035d51576a8d&v=4)](/mschwager)

Copy link

Contributor

### **[mschwager](/mschwager)** commented [Jan 3, 2024](#issuecomment-1875408467)

| I've attached the crash here: [crash-54a4c03551e10f514542bdf35c00142e617b1ff1.txt](https://github.com/agronholm/cbor2/files/13812882/crash-54a4c03551e10f514542bdf35c00142e617b1ff1.txt)  What do I do with this if I want to reproduce the crash?  I tested it out like this:  ``` $ python -m cbor2.tool -p crash-54a4c03551e10f514542bdf35c00142e617b1ff1.txt  Traceback (most recent call last):   File "<frozen runpy>", line 198, in _run_module_as_main   File "<frozen runpy>", line 88, in _run_code   File "lib/python3.11/site-packages/cbor2/tool.py", line 225, in <module>     main()   File "lib/python3.11/site-packages/cbor2/tool.py", line 208, in main     objs = (load(infile, tag_hook=my_hook),)             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ MemoryError  ``` |
| --- |

 👍
1
 agronholm reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@mschwager](https://avatars.githubusercontent.com/u/1724818?s=40&u=c4cdef63eabf48b9795667ffdcd6035d51576a8d&v=4)](/mschwager)
[mschwager](/mschwager)
mentioned this pull request
[Jan 3, 2024](#ref-pullrequest-2064583587)

[Proposing new project: Python cbor2
google/oss-fuzz#11444](/google/oss-fuzz/pull/11444)
 Merged

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 4, 2024](#issuecomment-1876724562)

| Alright, I was able to reproduce the crash here. I think I need to start fuzzing the code before I push anything to master. |
| --- |

All reactions

Sorry, something went wrong.

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=40&v=4)](/agronholm)

`[Merge branch 'master' into fix-memoryerror](/agronholm/cbor2/pull/204/commits/fee08d9adcd2d83a22148bdb5b716262459fd984 "Merge branch 'master' into fix-memoryerror")`

`[fee08d9](/agronholm/cbor2/pull/204/commits/fee08d9adcd2d83a22148bdb5b716262459fd984)`

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 4, 2024](#issuecomment-1877828075)

| Looks like this is just another case of allocating a huge amount of memory (4629771061636907009) bytes, but this triggers a `MemoryError` with the Python implementation too. |
| --- |

All reactions

Sorry, something went wrong.

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 6, 2024](#issuecomment-1879669146)

| Turns out that the problem wasn't triggered with a `BytesIO` instance, but it is triggered with a real open file. |
| --- |

All reactions

Sorry, something went wrong.

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 6, 2024](#issuecomment-1879669710)

| All other Python CBOR implementations I tested with also raised a `MemoryError` when trying to decode input like that. |
| --- |

All reactions

Sorry, something went wrong.

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 8, 2024](#issuecomment-1880624133)

| I have a fix that avoids `MemoryError` in both implementations, but it introduced a new bug on the C side that I'm still tracking down. |
| --- |

 👍
1
 robertstypa reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

 [agronholm](/agronholm)
added 4 commits
[January 9, 2024 12:10](#commits-pushed-68f74e1)

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=40&v=4)](/agronholm)

`[Read long definite byte/text strings in 65536 byte chunks at most](/agronholm/cbor2/pull/204/commits/68f74e173840c1346ad5b36f982ee693fab6e808 "Read long definite byte/text strings in 65536 byte chunks at most")`

`[68f74e1](/agronholm/cbor2/pull/204/commits/68f74e173840c1346ad5b36f982ee693fab6e808)`

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=40&v=4)](/agronholm)

`[Merge branch 'master' into fix-memoryerror](/agronholm/cbor2/pull/204/commits/76706571ac1b89049e3632b37d3e99f11cdb8f7d "Merge branch 'master' into fix-memoryerror")`

`[7670657](/agronholm/cbor2/pull/204/commits/76706571ac1b89049e3632b37d3e99f11cdb8f7d)`

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=40&v=4)](/agronholm)

`[Merge branch 'master' into fix-memoryerror](/agronholm/cbor2/pull/204/commits/a00f34566c8b0aa3f1d39b3478ff371fe6fd130a "Merge branch 'master' into fix-memoryerror")`

`[a00f345](/agronholm/cbor2/pull/204/commits/a00f34566c8b0aa3f1d39b3478ff371fe6fd130a)`

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=40&v=4)](/agronholm)

`[Fixed test error on Windows](/agronholm/cbor2/pull/204/commits/8384772b5225e29ba58021ef475a4ca7141460f1 "Fixed test error on Windows")`

`[8384772](/agronholm/cbor2/pull/204/commits/8384772b5225e29ba58021ef475a4ca7141460f1)`

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 9, 2024](#issuecomment-1882805538)

| Alright, what's left now is to fuzz this branch before I merge. |
| --- |

All reactions

Sorry, something went wrong.

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 9, 2024](#issuecomment-1882821719)

| I'm not getting any `MemoryError` anymore with fuzzing. Would you like to verify? |
| --- |

All reactions

Sorry, something went wrong.

[![@mschwager](https://avatars.githubusercontent.com/u/1724818?s=80&u=c4cdef63eabf48b9795667ffdcd6035d51576a8d&v=4)](/mschwager)

Copy link

Contributor

### **[mschwager](/mschwager)** commented [Jan 10, 2024](#issuecomment-1885246965)

| I'm not getting any `MemoryError` anymore with fuzzing. Would you like to verify?  I found another crash with the following file: [crash-c528afcec87be909de91322a14693702fd1d44a0.txt](https://github.com/agronholm/cbor2/files/13890731/crash-c528afcec87be909de91322a14693702fd1d44a0.txt)  I think I'm correctly fuzzing this branch, but I'm not sure. Are you able to reproduce the crash? |
| --- |

All reactions

Sorry, something went wrong.

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=40&v=4)](/agronholm)

`[Fixed return value check in CBORTag_hash()](/agronholm/cbor2/pull/204/commits/cbc78c5e704c39e0151a0e26853879000f20bbaf "Fixed return value check in CBORTag_hash()")`

`[cbc78c5](/agronholm/cbor2/pull/204/commits/cbc78c5e704c39e0151a0e26853879000f20bbaf)`

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 14, 2024](#issuecomment-1890931721)

| Yeah, I can reproduce it. Looking into it now. |
| --- |

All reactions

Sorry, something went wrong.

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 14, 2024](#issuecomment-1890932712)

| No, wait, I forgot to recompile after switching branches. I'm getting this instead now: `_cbor2.CBORDecodeEOF: premature end of stream (expected to read 65536 bytes, got 509 instead)`. This is the exception we should be getting, yes? |
| --- |

All reactions

Sorry, something went wrong.

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Owner

Author

### **[agronholm](/agronholm)** commented [Jan 14, 2024](#issuecomment-1890935092)

| I'm not seeing anything bad in this branch after the commit I just pushed a little while ago, so I'm merging it. |
| --- |

All reactions

Sorry, something went wrong.

 Hide details
View details

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=40&v=4)](/agronholm)
[agronholm](/agronholm)
merged commit [`387755e`](/agronholm/cbor2/commit/387755eacf0be35591a478d3c67fe10618a6d542)
into
master

[Jan 14, 2024](https://github.com/agronholm/cbor2/pull/204#event-11481048238)
13 checks passed

 [![@agronholm](https://avatars.githubusercontent.com/u/130003?s=40&v=4)](/agronholm)
[agronholm](/agronholm)
deleted the
fix-memoryerror

branch
[January 14, 2024 12:12](#event-11481048259)

[jonathanmetzman](/jonathanmetzman)
pushed a commit
to google/oss-fuzz
that referenced
this pull request
[Jan 30, 2024](#ref-commit-3e24194)
[![@mschwager](https://avatars.githubusercontent.com/u/1724818?s=40&u=c4cdef63eabf48b9795667ffdcd6035d51576a8d&v=4)](/mschwager)

`[Proposing new project: Python cbor2 (](/google/oss-fuzz/commit/3e24194ac9f2ab13b289a2f85f07f67598396b17 "Proposing new project: Python cbor2 (#11444)

`cbor2` is a Python CBOR (de)serializer with extensive tag support.

It has nearly [2,000
dependents](https://github.com/agronholm/cbor2/network/dependents) on
GitHub. It's used by many large blockchain projects, such as:

- https://github.com/bitcoin-core/HWI
- https://github.com/Blockstream/Jade
- https://github.com/vyperlang/vyper
- https://github.com/lidofinance/lido-dao
- https://github.com/fetchai/cosmpy
- https://github.com/OpShin/opshin

And other non-blockchain projects, such as:

- https://github.com/project-chip/connectedhomeip
- https://github.com/pritunl/pritunl
- https://github.com/amazon-ion/ion-python

I received approval from this project here:
https://github.com/agronholm/cbor2/pull/204#issuecomment-1874467670")[#11444](https://github.com/google/oss-fuzz/pull/11444)[)](/google/oss-fuzz/commit/3e24194ac9f2ab13b289a2f85f07f67598396b17 "Proposing new project: Python cbor2 (#11444)

`cbor2` is a Python CBOR (de)serializer with extensive tag support.

It has nearly [2,000
dependents](https://github.com/agronholm/cbor2/network/dependents) on
GitHub. It's used by many large blockchain projects, such as:

- https://github.com/bitcoin-core/HWI
- https://github.com/Blockstream/Jade
- https://github.com/vyperlang/vyper
- https://github.com/lidofinance/lido-dao
- https://github.com/fetchai/cosmpy
- https://github.com/OpShin/opshin

And other non-blockchain projects, such as:

- https://github.com/project-chip/connectedhomeip
- https://github.com/pritunl/pritunl
- https://github.com/amazon-ion/ion-python

I received approval from this project here:
https://github.com/agronholm/cbor2/pull/204#issuecomment-1874467670")`
…

`[3e24194](/google/oss-fuzz/commit/3e24194ac9f2ab13b289a2f85f07f67598396b17)`

```
`cbor2` is a Python CBOR (de)serializer with extensive tag support.

It has nearly [2,000
dependents](<https://github.com/agronholm/cbor2/network/dependents>) on
GitHub. It's used by many large blockchain projects, such as:

- <https://github.com/bitcoin-core/HWI>
- <https://github.com/Blockstream/Jade>
- <https://github.com/vyperlang/vyper>
- <https://github.com/lidofinance/lido-dao>
- <https://github.com/fetchai/cosmpy>
- <https://github.com/OpShin/opshin>

And other non-blockchain projects, such as:

- <https://github.com/project-chip/connectedhomeip>
- <https://github.com/pritunl/pritunl>
- <https://github.com/amazon-ion/ion-python>

I received approval from this project here:
[agronholm/cbor2#204 (comment)](https://github.com/agronholm/cbor2/pull/204#issuecomment-1874467670)
```

[![@mschwager](https://avatars.githubusercontent.com/u/1724818?s=80&u=c4cdef63eabf48b9795667ffdcd6035d51576a8d&v=4)](/mschwager)

Copy link

Contributor

### **[mschwager](/mschwager)** commented [Jan 30, 2024](#issuecomment-1917475191)

| Looks like the OSS-Fuzz PR went through: [google/oss-fuzz#11444](https://github.com/google/oss-fuzz/pull/11444) 🎉 |
| --- |

All reactions

Sorry, something went wrong.

[![@kpwelsh](https://avatars.githubusercontent.com/u/9857576?s=40&v=4)](/kpwelsh)
[kpwelsh](/kpwelsh)
mentioned this pull request
[Jun 14, 2024](#ref-issue-2353313025)

[N^2 Performance on decoding large definite bytestrings
#240](/agronholm/cbor2/issues/240)

Open

2 tasks

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fagronholm%2Fcbor2%2Fpull%2F204)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=52&v=4)](/agronholm) [![@coveralls](https://avatars.githubusercontent.com/u/2354108?s=52&v=4)](/coveralls) [![@mschwager](https://avatars.githubusercontent.com/u/1724818?s=52&v=4)](/mschwager)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

