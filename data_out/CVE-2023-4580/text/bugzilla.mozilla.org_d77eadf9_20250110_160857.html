

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1843046)
* [XML](/show_bug.cgi?ctype=xml&id=1843046)

Closed
[Bug 1843046](/show_bug.cgi?id=1843046)
(CVE-2023-4580)

Opened 2 years ago
Closed 1 year ago

# push notifications saved to disk in Private Browsing mode (Toggle off push notifications in Private Browsing mode)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

push notifications saved to disk in Private Browsing mode (Toggle off push notifications in Private Browsing mode)

## Categories

### (Core :: DOM: Push Subscriptions, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Push%20Subscriptions#DOM%3A%20Push%20Subscriptions)

DOM: Push Subscriptions
▾

Core :: DOM: Push Subscriptions
Subscribing push using PushManager and waking up the corresponding service worker when a remote server sends a push message.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Push%20Subscriptions&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Push%20Subscriptions&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Push%20Subscriptions)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

118 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr102 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix) |
| firefox-esr115 | [117+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=117%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified) |
| firefox116 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=wontfix) |
| firefox117 | [+](/buglist.cgi?f1=cf_tracking_firefox117&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=verified) |
| firefox118 | [+](/buglist.cgi?f1=cf_tracking_firefox118&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr102 |  | wontfix |
| firefox-esr115 | 117+ | verified |
| firefox-esr128 | --- | --- |
| firefox116 |  | wontfix |
| firefox117 | + | verified |
| firefox118 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: hsingh, Assigned: hsingh)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/53a89b8d24636f7d6172eefd328684dc?d=mm&size=40)  [hsingh](/user_profile?user_id=704280)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/53a89b8d24636f7d6172eefd328684dc?d=mm&size=40)  [hsingh](/user_profile?user_id=704280)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/2b84b1a415615d22d7afc6554020d164?d=mm&size=40)  [jjalkanen](/user_profile?user_id=689836)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

### (Regressed 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1852438](/show_bug.cgi?id=1852438 "NEW - Notifications silently stopped working in permanent private browsing mode even when explicitly allowed")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1882176](/show_bug.cgi?id=1882176 "RESOLVED FIXED - Supporting notifications in PBM")

## Details

### (Keywords: csectype-disclosure, privacy, sec-moderate, Whiteboard: [adv-main117+] [adv-esr115.2+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2023-4580

[Keywords:](/describekeywords.cgi)

[csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main117+] [adv-esr115.2+]

QA Whiteboard:

[post-critsmash-triage] [qa-triaged]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [Bug 1843046: Do not allow notifications in private window.r=#dom-storage-reviewers](/attachment.cgi?id=9344756)  [1 years ago](#c2)  [Harveer Singh](/user_profile?user_id=704280)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-beta+](#c18 "1 year ago")  RyanVM : [approval-mozilla-esr115+](#c18 "1 year ago") | [Details](/attachment.cgi?id=9344756&action=edit) | [Review](/attachment.cgi?id=9344756) |
| --- | --- | --- |
| [Bug 1843046: Ignored a android kt private notification test.r=#geckoview-reviewers](/attachment.cgi?id=9348190)  [1 year ago](#c5)  [Harveer Singh](/user_profile?user_id=704280)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-beta+](#a3123996_75935 "1 year ago")  RyanVM : [approval-mozilla-esr115+](#a3123996_75935 "1 year ago") | [Details](/attachment.cgi?id=9348190&action=edit) | [Review](/attachment.cgi?id=9348190) |
| [advisory.txt](/attachment.cgi?id=9350228)  [1 year ago](#c25)  [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341)   200 bytes, text/plain |  | [Details](/attachment.cgi?id=9350228&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Harveer Singh](/user_profile?user_id=704280)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1843046#c0)• 2 years ago |
|  | |

As it has surfaced here (<https://bugzilla.mozilla.org/show_bug.cgi?id=1823752>), notifications store is not encrypted on disk in private browsing mode and it could leak sensitive information. There would be a follow up bug to properly encrypt and lifetime notifications store but for now, we want to disable notifications in PBM.

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a161_646284)• 2 years ago |

Group: core-security

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a25200_406194)• 1 years ago |

Group: core-security → dom-core-security

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1843046#c1)• 1 years ago |
|  | |

The original bug was describing two security problems that could be solved independently, so I'm turning this task bug into one of those security problems. (expiring old notifications might solve the unbounded growth in the other bug, but wouldn't solve this privacy issue)

Type: task → defectKeywords: [csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)Summary: Toggle off push notifications in Private Browsing mode → push notifications saved to disk in Private Browsing mode (Toggle off push notifications in Private Browsing mode)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a115483_151407)• 1 years ago |

Severity: -- → S3Priority: -- → P2

|  | [Harveer Singh](/user_profile?user_id=704280)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1843046#c2)• 1 years ago |
|  | |

Attached file
[Bug 1843046: Do not allow notifications in private window.r=#dom-storage-reviewers](attachment.cgi?id=9344756)
— [Details](attachment.cgi?id=9344756&action=edit)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1843046#c3)• 1 years ago |
|  | |

Pushed by hsingh@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/b21c8906db6d>
Do not allow notifications in private window.r=saschanaz

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1843046#c4)• 1 years ago |
|  | |

Backed out for causing gv-junit failures in WebNotificationTest:

<https://hg.mozilla.org/integration/autoland/rev/b93c29f308f934add5aea90aa94080e1c76036ee>

[Push with failures](https://treeherder.mozilla.org/jobs?repo=autoland&selectedTaskRun=DY1X_jJCReCkWFekCGjWWA.0&group_state=expanded&resultStatus=testfailed%2Cbusted%2Cexception%2Crunnable&revision=b21c8906db6d0a7e0fbae7e609d90da9cf977fbb)

[Failure log](https://treeherder.mozilla.org/logviewer?job_id=424650151&repo=autoland)

> TEST-UNEXPECTED-FAIL | org.mozilla.geckoview.test.WebNotificationTest#onShowNotification | org.mozilla.geckoview.test.util.UiThreadUtils$TimeoutException: Timed out after 30000ms

Flags: needinfo?(hsingh)

|  | [Harveer Singh](/user_profile?user_id=704280)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a1902817_704280)• 1 years ago |

Flags: needinfo?(hsingh)

|  | [Harveer Singh](/user_profile?user_id=704280)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a1989476_704280)• 1 years ago |

Status: NEW → ASSIGNED

|  | [Harveer Singh](/user_profile?user_id=704280)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1843046#c5)• 1 year ago |
|  | |

Attached file
[Bug 1843046: Ignored a android kt private notification test.r=#geckoview-reviewers](attachment.cgi?id=9348190)
— [Details](attachment.cgi?id=9348190&action=edit)

Depends on D184064

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1843046#c6)• 1 year ago |
|  | |

Pushed by hsingh@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/308fde20a1b1>
Do not allow notifications in private window.r=saschanaz

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1843046#c7)• 1 year ago |
|  | |

Backed out for causing geckoview-junit failures related to notifications:

<https://hg.mozilla.org/integration/autoland/rev/ffeee9d4fb53c4a78cc804ac8282b86eee9e6c72>

[Push with failures](https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&resultStatus=pending%2Crunning%2Csuccess%2Ctestfailed%2Cbusted%2Cexception%2Crunnable&searchStr=gv-junit&revision=308fde20a1b1f20706ad2040b000d9a5de5c7463&selectedTaskRun=Y_Xq4iykTNOS-M7pi79LSg.0)

[Failure log](https://treeherder.mozilla.org/logviewer?job_id=425905573&repo=autoland)

> TEST-UNEXPECTED-FAIL | org.mozilla.geckoview.test.WebNotificationTest#onShowNotification | org.mozilla.geckoview.test.util.UiThreadUtils$TimeoutException: Timed out after 30000ms
>
> TEST-UNEXPECTED-FAIL | org.mozilla.geckoview.test.WebNotificationTest#clickPrivateNotificationParceled | org.mozilla.geckoview.test.util.UiThreadUtils$TimeoutException: Timed out after 30000ms

Flags: needinfo?(hsingh)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1843046#c8)• 1 year ago |
|  | |

Pushed by hsingh@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/5e8b64d6b91a>
Do not allow notifications in private window.r=saschanaz
<https://hg.mozilla.org/integration/autoland/rev/31e28d290422>
Ignored a android kt private notification test.r=geckoview-reviewers,owlish

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1843046#c9)• 1 year ago |
|  | |

Backed out for linting failure:

<https://hg.mozilla.org/integration/autoland/rev/e9f4fc15eeeaa49d6f27e920e22a961b173dfa3b>

[Failure log](https://treeherder.mozilla.org/logviewer?job_id=425909534&repo=autoland)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1843046#c10)• 1 year ago |
|  | |

Also still had a [junit failure](https://treeherder.mozilla.org/logviewer?job_id=425912827&repo=autoland&lineNumber=21999)

> TEST-UNEXPECTED-FAIL | org.mozilla.geckoview.test.WebNotificationTest#onShowNotification | org.mozilla.geckoview.test.util.UiThreadUtils$TimeoutException: Timed out after 30000ms

|  | [Harveer Singh](/user_profile?user_id=704280)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1843046#c11)• 1 year ago |
|  | |

seems like the failing test is an intermittent wich is tracked here? <https://bugzilla.mozilla.org/show_bug.cgi?id=1766739>

Flags: needinfo?(hsingh) → needinfo?(aryx.bugmail)

|  | [Harveer Singh](/user_profile?user_id=704280)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1843046#c12)• 1 year ago |
|  | |

oh I see that the failure reason is different than the one shown in the intermittent. I will investigate this.

Flags: needinfo?(aryx.bugmail)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1843046#c13)• 1 year ago |
|  | |

Pushed by hsingh@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/ffeb6d319aa9>
Do not allow notifications in private window.r=saschanaz
<https://hg.mozilla.org/integration/autoland/rev/5038cbc4c1b3>
Ignored a android kt private notification test.r=geckoview-reviewers,owlish

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1843046#c14)• 1 year ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/ffeb6d319aa9>

<https://hg.mozilla.org/mozilla-central/rev/5038cbc4c1b3>

Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 1 year ago
[status-firefox118](/buglist.cgi?f1=cf_status_firefox118&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 118 Branch

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a3025463_695136)• 1 year ago |

[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=wontfix)
[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=affected)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)
[tracking-firefox117](/buglist.cgi?f1=cf_tracking_firefox117&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox117&o1=equals&v1=%2B)
[tracking-firefox118](/buglist.cgi?f1=cf_tracking_firefox118&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox118&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [117+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=117%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1843046#c15)• 1 year ago |
|  | |

Please nominate this for Beta and ESR115 approval.

Flags: needinfo?(hsingh)

|  | [Harveer Singh](/user_profile?user_id=704280)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1843046#c16)• 1 year ago |
|  | |

Comment on [attachment 9344756](/attachment.cgi?id=9344756 "Bug 1843046: Do not allow notifications in private window.r=#dom-storage-reviewers") [[details]](/attachment.cgi?id=9344756&action=edit "Bug 1843046: Do not allow notifications in private window.r=#dom-storage-reviewers")

[Bug 1843046](/show_bug.cgi?id=1843046 "VERIFIED FIXED - push notifications saved to disk in Private Browsing mode (Toggle off push notifications in Private Browsing mode)"): Do not allow notifications in private window.r=#dom-storage-reviewers

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: Currently, notifications are stored as a raw data on disk even for private browsing mode which is against firefox's security and privacy promise so we are disabling notifications in private browsing mode entirely such that we could get more time to properly implement private notifications.
* **User impact if declined**: Firefox would continue to store notifications in raw format on user machines in private session.
* **Fix Landed on Version**: 117+
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Code changes are not too complicated to apply and changes are only contained within notifications area only.

### Beta/Release Uplift Approval Request

* **User impact if declined**: Currently, notifications are stored as a raw data on disk even for private browsing mode which is against firefox's security and privacy promise so we are disabling notifications in private browsing mode entirely such that we could get more time to properly implement private notifications.
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: 1. Load a website which would generate notifications.

2. Allow permissions to get notifications (permission dialog wouldn't be generated in private session).
3. notifications are not delivered in private browsing session while they continue to deliver in non-private browsing session.

* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Code changes are not too complicated to apply and changes are only contained within notifications area only.
* **String changes made/needed**:
* **Is Android affected?**: Unknown
Flags: needinfo?(hsingh)
[Attachment #9344756](/attachment.cgi?id=9344756&action=edit "Bug 1843046: Do not allow notifications in private window.r=#dom-storage-reviewers") -
Flags: approval-mozilla-esr115?
[Attachment #9344756](/attachment.cgi?id=9344756&action=edit "Bug 1843046: Do not allow notifications in private window.r=#dom-storage-reviewers") -
Flags: approval-mozilla-beta?

|  | [Harveer Singh](/user_profile?user_id=704280)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a3123899_704280)• 1 year ago |

[Attachment #9348190](/attachment.cgi?id=9348190&action=edit "Bug 1843046: Ignored a android kt private notification test.r=#geckoview-reviewers") -
Flags: approval-mozilla-esr115?

|  | [Harveer Singh](/user_profile?user_id=704280)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1843046#c17)• 1 year ago |
|  | |

Comment on [attachment 9348190](/attachment.cgi?id=9348190 "Bug 1843046: Ignored a android kt private notification test.r=#geckoview-reviewers") [[details]](/attachment.cgi?id=9348190&action=edit "Bug 1843046: Ignored a android kt private notification test.r=#geckoview-reviewers")

[Bug 1843046](/show_bug.cgi?id=1843046 "VERIFIED FIXED - push notifications saved to disk in Private Browsing mode (Toggle off push notifications in Private Browsing mode)"): Ignored a android kt private notification test.r=#geckoview-reviewers

### Beta/Release Uplift Approval Request

* **User impact if declined**:
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**:
* **String changes made/needed**:
* **Is Android affected?**: Yes
[Attachment #9348190](/attachment.cgi?id=9348190&action=edit "Bug 1843046: Ignored a android kt private notification test.r=#geckoview-reviewers") -
Flags: approval-mozilla-beta?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1843046#c18)• 1 year ago |
|  | |

Comment on [attachment 9344756](/attachment.cgi?id=9344756 "Bug 1843046: Do not allow notifications in private window.r=#dom-storage-reviewers") [[details]](/attachment.cgi?id=9344756&action=edit "Bug 1843046: Do not allow notifications in private window.r=#dom-storage-reviewers")

[Bug 1843046](/show_bug.cgi?id=1843046 "VERIFIED FIXED - push notifications saved to disk in Private Browsing mode (Toggle off push notifications in Private Browsing mode)"): Do not allow notifications in private window.r=#dom-storage-reviewers

Approved for 117.0b9 and 115.2esr.

[Attachment #9344756](/attachment.cgi?id=9344756&action=edit "Bug 1843046: Do not allow notifications in private window.r=#dom-storage-reviewers") -
Flags: approval-mozilla-esr115?
[Attachment #9344756](/attachment.cgi?id=9344756&action=edit "Bug 1843046: Do not allow notifications in private window.r=#dom-storage-reviewers") -
Flags: approval-mozilla-esr115+
[Attachment #9344756](/attachment.cgi?id=9344756&action=edit "Bug 1843046: Do not allow notifications in private window.r=#dom-storage-reviewers") -
Flags: approval-mozilla-beta?
[Attachment #9344756](/attachment.cgi?id=9344756&action=edit "Bug 1843046: Do not allow notifications in private window.r=#dom-storage-reviewers") -
Flags: approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a3123996_75935)• 1 year ago |

[Attachment #9348190](/attachment.cgi?id=9348190&action=edit "Bug 1843046: Ignored a android kt private notification test.r=#geckoview-reviewers") -
Flags: approval-mozilla-esr115?
[Attachment #9348190](/attachment.cgi?id=9348190&action=edit "Bug 1843046: Ignored a android kt private notification test.r=#geckoview-reviewers") -
Flags: approval-mozilla-esr115+
[Attachment #9348190](/attachment.cgi?id=9348190&action=edit "Bug 1843046: Ignored a android kt private notification test.r=#geckoview-reviewers") -
Flags: approval-mozilla-beta?
[Attachment #9348190](/attachment.cgi?id=9348190&action=edit "Bug 1843046: Ignored a android kt private notification test.r=#geckoview-reviewers") -
Flags: approval-mozilla-beta+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1843046#c19)• 1 year ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/80796db900e6>
<https://hg.mozilla.org/releases/mozilla-beta/rev/bf609d109343>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a3125252_75935)• 1 year ago |

[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=fixed)

|  | [Camelia Badau [:cbadau], Desktop Test Engineering](/user_profile?user_id=500622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a3170524_500622)• 1 year ago |

Flags: qe-verify+

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a3173041_488993)• 1 year ago |

QA Whiteboard: [post-critsmash-triage]

|  | [Camelia Badau [:cbadau], Desktop Test Engineering](/user_profile?user_id=500622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a3179560_500622)• 1 year ago |

QA Whiteboard: [post-critsmash-triage] → [post-critsmash-triage] [qa-triaged]

|  | [Bogdan Maris, Desktop Test Engineering [PTO until 13 Jan]](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1843046#c20)• 1 year ago |
|  | |

Do you have an example of a website with a notification on which I can test that this is fixed? Or is the one I used bellow good enough?

I tried a few push notification sample websites like <https://cleverpush.com/en/test-notifications/> or <https://pushalert.co/demo> but using an old Nightly build before the fix (2023-07-12) no notification is shown in Private Window. Same with Firefox 117.0b9 which has the fix.

I also ran into this demo website <https://www.bennish.net/web-notifications.html> where I saw the following:

* If I open the demo in a private window in the old Nightly build and click on Authorize and then Show, I will get a notification. I will also have data in about:cache?storage=disk from the website.

The output of the console from the demo website:

`Permission to display: granted`

`Notification #1 queued for display`

`Notification #1 showed`

* If I open the demo in a private window in Firefox 117.0b9 build and click on Authorize and then Show, I will **NOT get the notification**. I will have **NO data** in about:cache?storage=disk from the website.

The output of the console from the demo website:

`Permission to display: denied`

`Notification #1 queued for display`

`Notification #1 errored`

Flags: needinfo?(hsingh)

|  | [Harveer Singh](/user_profile?user_id=704280)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1843046#c21)• 1 year ago |
|  | |

Yes, <https://www.bennish.net/web-notifications.html> is the correct one to use for testing.

<https://cleverpush.com/en/test-notifications/> website explicitly disables notifications in private session.

Flags: needinfo?(hsingh)

|  | [Bogdan Maris, Desktop Test Engineering [PTO until 13 Jan]](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1843046#c22)• 1 year ago |
|  | |

(In reply to Harveer Singh from [comment #21](/show_bug.cgi?id=1843046#c21 "VERIFIED FIXED - push notifications saved to disk in Private Browsing mode (Toggle off push notifications in Private Browsing mode)"))

> Yes, <https://www.bennish.net/web-notifications.html> is the correct one to use for testing.
>
> <https://cleverpush.com/en/test-notifications/> website explicitly disables notifications in private session.

Thanks, I verified the behavior described in [comment 20](/show_bug.cgi?id=1843046#c20 "VERIFIED FIXED - push notifications saved to disk in Private Browsing mode (Toggle off push notifications in Private Browsing mode)") using Latest Nightly 118.0a1 and Firefox 117.0b9 across platforms (Windows 10, macOS 13 and Ubuntu 22.04) on bennish.net website as a demo page, that the notification is disabled in private browsing and no data is stored on disk.

[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=verified)
[status-firefox118](/buglist.cgi?f1=cf_status_firefox118&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=verified)Flags: qe-verify+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1843046#c23)• 1 year ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/27e84a0d49de>
<https://hg.mozilla.org/releases/mozilla-esr115/rev/2d8400b399ed>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a3382988_75935)• 1 year ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Bogdan Maris, Desktop Test Engineering [PTO until 13 Jan]](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1843046#c24)• 1 year ago |
|  | |

Also verified as fixed using Firefox 115 esr across platforms (Windows 10, macOS 13 and Ubuntu 22.04).

Status: RESOLVED → VERIFIED
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified)

|  | [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1843046#c25)• 1 year ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9350228)
— [Details](attachment.cgi?id=9350228&action=edit)

|  | [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a3778221_626341)• 1 year ago |

Whiteboard: [adv-main117+]

|  | [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a3780025_626341)• 1 year ago |

Whiteboard: [adv-main117+] → [adv-main117+] [adv-esr115.2+]

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a5364559_695136)• 1 year ago |

Regressions: [1852438](/show_bug.cgi?id=1852438 "NEW - Notifications silently stopped working in permanent private browsing mode even when explicitly allowed")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a15187240_1689)• 1 year ago |

Group: core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a15193005_1689)• 1 year ago |

Alias: CVE-2023-4580

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1843046#a27643874_646284)• 8 months ago |

See Also: → [1882176](/show_bug.cgi?id=1882176 "RESOLVED FIXED - Supporting notifications in PBM")
You need to [log in](/show_bug.cgi?id=1843046&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Harveer Singh](/user_profile?user_id=704280)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

