
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgeotools%2Fgeotools%2Fcommit%2F4f70fa3234391dd0cda883a20ab0ec75688cba49)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgeotools%2Fgeotools%2Fcommit%2F4f70fa3234391dd0cda883a20ab0ec75688cba49)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=geotools%2Fgeotools)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[geotools](/geotools)
/
**[geotools](/geotools/geotools)**
Public

* [Notifications](/login?return_to=%2Fgeotools%2Fgeotools) You must be signed in to change notification settings
* [Fork
  1.2k](/login?return_to=%2Fgeotools%2Fgeotools)
* [Star
   1.7k](/login?return_to=%2Fgeotools%2Fgeotools)

* [Code](/geotools/geotools)
* [Pull requests
  1](/geotools/geotools/pulls)
* [Actions](/geotools/geotools/actions)
* [Projects
  0](/geotools/geotools/projects)
* [Wiki](/geotools/geotools/wiki)
* [Security](/geotools/geotools/security)
* [Insights](/geotools/geotools/pulse)

Additional navigation options

* [Code](/geotools/geotools)
* [Pull requests](/geotools/geotools/pulls)
* [Actions](/geotools/geotools/actions)
* [Projects](/geotools/geotools/projects)
* [Wiki](/geotools/geotools/wiki)
* [Security](/geotools/geotools/security)
* [Insights](/geotools/geotools/pulse)

## Commit

[Permalink](/geotools/geotools/commit/4f70fa3234391dd0cda883a20ab0ec75688cba49)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[GEOT-7115] Streamline JNDI lookups

[Browse files](/geotools/geotools/tree/4f70fa3234391dd0cda883a20ab0ec75688cba49)
Browse the repository at this point in the history

* Loading branch information

[![@aaime](https://avatars.githubusercontent.com/u/325433?s=40&v=4)](/aaime)

[aaime](/geotools/geotools/commits?author=aaime "View all commits by aaime")
committed
Apr 11, 2022

1 parent
[8483f1f](/geotools/geotools/commit/8483f1f4cdee174232f0c85393482112ea9f558d)

commit 4f70fa3

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**185 additions**
and
**107 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* docs/user

  + library/metadata

    - docs/user/library/metadata/geotools.rst
      [geotools.rst](#diff-ca927e7d428e6f4b49f45a44caf44ab33ed882e330fef1807e5ce9d402dc3587)
  + welcome

    - docs/user/welcome/upgrade.rst
      [upgrade.rst](#diff-d236dbfd288619d6a5022df5242ffd46075ae4c2d378bb34020203d5a1d90d1e)
* modules

  + library

    - jdbc/src/main/java/org/geotools

      * data/jdbc/datasource

        + modules/library/jdbc/src/main/java/org/geotools/data/jdbc/datasource/JNDIDataSourceFactory.java
          [JNDIDataSourceFactory.java](#diff-c610a71cf2b4d2cc951c6a401b39a14cff1d026452091e44c4919e2376f8bc63)
      * jdbc

        + modules/library/jdbc/src/main/java/org/geotools/jdbc/JDBCJNDIDataStoreFactory.java
          [JDBCJNDIDataStoreFactory.java](#diff-33d0bfa6c0b9fdbd68df8e8baa718e0f625472ad80e08143dbc5c19b214b5b4f)
    - metadata

      * modules/library/metadata/pom.xml
        [pom.xml](#diff-fa738d7b9a9df5c2d5ad7b9a2aef218ca47794fce406feef5c9b3e317c17d302)
      * src

        + main/java/org/geotools/util/factory

          - modules/library/metadata/src/main/java/org/geotools/util/factory/GeoTools.java
            [GeoTools.java](#diff-7f613b2fba8f6943a1388e3022543e6c3b382a31e8e660605c0e0485ca61f2a2)
        + test/java/org/geotools/util/factory

          - modules/library/metadata/src/test/java/org/geotools/util/factory/FactoryRegistryTest.java
            [FactoryRegistryTest.java](#diff-5f8e2e052772cd734428f81b7c966342de5ebcbb401da9580fae84e8ee821f2c)
          - modules/library/metadata/src/test/java/org/geotools/util/factory/GeoToolsTest.java
            [GeoToolsTest.java](#diff-cd2e88c836f6ef51eddc39d3735f200bfcdaf35d3d9f2f43c0670d569d122cf4)
    - referencing/src/main/java/org/geotools/referencing/factory

      * modules/library/referencing/src/main/java/org/geotools/referencing/factory/AbstractEpsgMediator.java
        [AbstractEpsgMediator.java](#diff-6e62746e06f9fc9f9a669c8fa8e4a19b5b347232e73fba0e982307cffa638138)
      * epsg

        + modules/library/referencing/src/main/java/org/geotools/referencing/factory/epsg/AbstractEpsgFactory.java
          [AbstractEpsgFactory.java](#diff-6f71d1fd102f48a837cc0d5a1762cfffa85d8ad3824cb815cd91e7bec1741dc5)
        + modules/library/referencing/src/main/java/org/geotools/referencing/factory/epsg/ThreadedEpsgFactory.java
          [ThreadedEpsgFactory.java](#diff-cb0d3587e80ac247395b4cd758f6a5e5cff851aee45374b5fef53fa9e8c9d277)
  + unsupported/postgis-raster/src/main/java/org/geotools/gce/pgraster

    - modules/unsupported/postgis-raster/src/main/java/org/geotools/gce/pgraster/PGRasterConfig.java
      [PGRasterConfig.java](#diff-0466f19b51755d5352a0ed1ca7e4cb29722ff8c7ec13f1a35188ad3c2c780d8d)

## There are no files selected for viewing

14 changes: 10 additions & 4 deletions

14
[docs/user/library/metadata/geotools.rst](#diff-ca927e7d428e6f4b49f45a44caf44ab33ed882e330fef1807e5ce9d402dc3587 "docs/user/library/metadata/geotools.rst")

Show comments

[View file](/geotools/geotools/blob/4f70fa3234391dd0cda883a20ab0ec75688cba49/docs/user/library/metadata/geotools.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -55,13 +55,19 @@ In rare cases, such as OSGi plug-in system, adding additional jars to the ``CLAS |
|  |  | JNDI |
|  |  | ^^^^ |
|  |  |  |
|  |  | If you are working in a Java Enterprise Edition environment, and would like to configure GeoTools to look up services in a specific context use the following:: |
|  |  | To configure GeoTools to look up services in a specific context use the following: |
|  |  |  |
|  |  | .. code-block:: java |
|  |  |  |
|  |  | GeoTools.init( applicationContext ); // JNDI configuration |
|  |  | GeoTools.init( context ); // JNDI configuration |
|  |  |  |
|  |  | GeoTools uses names of the format ``jdbc:EPSG`` internally these are adapted for use with your ``applicationContext`` using the ``GeoTools.fixName`` method:: |
|  |  | For JNDI lookup GeooTools uses: |
|  |  |  |
|  |  | String name = GeoTools.fixName("jdbc.EPSG"); |
|  |  | .. code-block:: java |
|  |  |  |
|  |  | DataSource dataSource = (DataSource) GeoTools.jndiLookup(name); |
|  |  |  |
|  |  | The ``jndiLookup(String)`` is to safe lookups by default. The default use of ``GeoTools.DEFAULT\_JNDI\_VALIDATOR`` ensures only no-schema and java schema lookups are allowed. To relax this policy you may supply your own approach using ``GeoTools.setJNDINameValidator(Predicate<String>)``. |
|  |  |  |
|  |  | XML |
|  |  | ^^^ |
| Expand Down | |  |

22 changes: 22 additions & 0 deletions

22
[docs/user/welcome/upgrade.rst](#diff-d236dbfd288619d6a5022df5242ffd46075ae4c2d378bb34020203d5a1d90d1e "docs/user/welcome/upgrade.rst")

Show comments

[View file](/geotools/geotools/blob/4f70fa3234391dd0cda883a20ab0ec75688cba49/docs/user/welcome/upgrade.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -70,6 +70,28 @@ Fixing this required changes to multiple classes: |
|  |  | GeoTools 25.x |
|  |  | ------------- |
|  |  |  |
|  |  | GeoTools |
|  |  | ^^^^^^^^ |
|  |  |  |
|  |  | In GeoTools 25.7 ``GeoTools.getInitialContext().look(name)`` and related methods have been deprecated, with ``GeoTools.jndiLookup(name)``. We have also taken an opportunity to remove ``GeoTools.fixName( context, name )`` |
|  |  |  |
|  |  | The use of ``GeoTools.jndiLookup(name)`` is subject to validation with the default ``GeoTools.DEFAULT\_JNDI\_VALIDATOR`` validator used limit name lookup. |
|  |  |  |
|  |  | BEFORE |
|  |  |  |
|  |  | .. code-block:: java |
|  |  |  |
|  |  | context = GeoTools.getInitialContext(); |
|  |  | String fixedName = GeoTools.fixName( context, name ); |
|  |  | return (DataSource) context.lookup(fixedName); |
|  |  |  |
|  |  | AFTER |
|  |  |  |
|  |  | .. code-block:: java |
|  |  |  |
|  |  | return (DataSource) GeoTools.jndiLookup(name); |
|  |  |  |
|  |  |  |
|  |  | More variable arguments support in core classes |
|  |  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ |
|  |  |  |
| Expand Down | |  |

9 changes: 2 additions & 7 deletions

9
[...s/library/jdbc/src/main/java/org/geotools/data/jdbc/datasource/JNDIDataSourceFactory.java](#diff-c610a71cf2b4d2cc951c6a401b39a14cff1d026452091e44c4919e2376f8bc63 "modules/library/jdbc/src/main/java/org/geotools/data/jdbc/datasource/JNDIDataSourceFactory.java")

Show comments

[View file](/geotools/geotools/blob/4f70fa3234391dd0cda883a20ab0ec75688cba49/modules/library/jdbc/src/main/java/org/geotools/data/jdbc/datasource/JNDIDataSourceFactory.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -64,7 +64,7 @@ public boolean canProcess(Map<String, ?> params) { |
|  |  | public DataSource createNewDataSource(Map<String, ?> params) throws IOException { |
|  |  | String refName = (String) JNDI\_REFNAME.lookUp(params); |
|  |  | try { |
|  |  | return (DataSource) GeoTools.getInitialContext().lookup(refName); |
|  |  | return (DataSource) GeoTools.jndiLookup(refName); |
|  |  | } catch (Exception e) { |
|  |  | throw new DataSourceException("Could not find the specified data source in JNDI", e); |
|  |  | } |
| Expand All | | @@ -83,11 +83,6 @@ public Param[] getParametersInfo() { |
|  |  | /\*\* Make sure a JNDI context is available \*/ |
|  |  | @Override |
|  |  | public boolean isAvailable() { |
|  |  | try { |
|  |  | GeoTools.getInitialContext(); |
|  |  | return true; |
|  |  | } catch (Exception e) { |
|  |  | return false; |
|  |  | } |
|  |  | return GeoTools.isJNDIAvailable(); |
|  |  | } |
|  |  | } |

19 changes: 3 additions & 16 deletions

19
[modules/library/jdbc/src/main/java/org/geotools/jdbc/JDBCJNDIDataStoreFactory.java](#diff-33d0bfa6c0b9fdbd68df8e8baa718e0f625472ad80e08143dbc5c19b214b5b4f "modules/library/jdbc/src/main/java/org/geotools/jdbc/JDBCJNDIDataStoreFactory.java")

Show comments

[View file](/geotools/geotools/blob/4f70fa3234391dd0cda883a20ab0ec75688cba49/modules/library/jdbc/src/main/java/org/geotools/jdbc/JDBCJNDIDataStoreFactory.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,7 +21,6 @@ |
|  |  | import java.util.Map; |
|  |  | import java.util.logging.Level; |
|  |  | import java.util.logging.Logger; |
|  |  | import javax.naming.Context; |
|  |  | import javax.naming.NamingException; |
|  |  | import javax.sql.DataSource; |
|  |  | import org.geotools.data.DataStore; |
| Expand Down  Expand Up | | @@ -90,23 +89,16 @@ protected DataSource createDataSource(Map<String, ?> params, SQLDialect dialect) |
|  |  | String jndiName = (String) JNDI\_REFNAME.lookUp(params); |
|  |  | if (jndiName == null) throw new IOException("Missing " + JNDI\_REFNAME.description); |
|  |  |  |
|  |  | Context ctx = null; |
|  |  | DataSource ds = null; |
|  |  |  |
|  |  | try { |
|  |  | ctx = GeoTools.getInitialContext(); |
|  |  | } catch (NamingException e) { |
|  |  | throw new RuntimeException(e); |
|  |  | } |
|  |  |  |
|  |  | try { |
|  |  | ds = (DataSource) ctx.lookup(jndiName); |
|  |  | ds = (DataSource) GeoTools.jndiLookup(jndiName); |
|  |  | } catch (NamingException e1) { |
|  |  | // check if the user did not specify "java:comp/env" |
|  |  | // and this code is running in a J2EE environment |
|  |  | try { |
|  |  | if (jndiName.startsWith(J2EERootContext) == false) { |
|  |  | ds = (DataSource) ctx.lookup(J2EERootContext + jndiName); |
|  |  | ds = (DataSource) GeoTools.jndiLookup(J2EERootContext + jndiName); |
|  |  | // success --> issue a waring |
|  |  | Logger.getLogger(this.getClass().getName()) |
|  |  | .log( |
| Expand Down  Expand Up | | @@ -135,12 +127,7 @@ protected DataSource createDataSource(Map<String, ?> params, SQLDialect dialect) |
|  |  | \*/ |
|  |  | @Override |
|  |  | public boolean isAvailable() { |
|  |  | try { |
|  |  | GeoTools.getInitialContext(); |
|  |  | return true; |
|  |  | } catch (NamingException e) { |
|  |  | return false; |
|  |  | } |
|  |  | return GeoTools.isJNDIAvailable(); |
|  |  | } |
|  |  |  |
|  |  | /\*\* Override to omit all those parameters which define the creation of the connection. \*/ |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[modules/library/metadata/pom.xml](#diff-fa738d7b9a9df5c2d5ad7b9a2aef218ca47794fce406feef5c9b3e317c17d302 "modules/library/metadata/pom.xml")

Show comments

[View file](/geotools/geotools/blob/4f70fa3234391dd0cda883a20ab0ec75688cba49/modules/library/metadata/pom.xml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -134,6 +134,11 @@ |
|  |  | <version>${project.version}</version> |
|  |  | <scope>compile</scope> |
|  |  | </dependency> |
|  |  | <dependency> |
|  |  | <groupId>org.mockito</groupId> |
|  |  | <artifactId>mockito-core</artifactId> |
|  |  | <scope>test</scope> |
|  |  | </dependency> |
|  |  | </dependencies> |
|  |  |  |
|  |  | <build> |
| Expand Down | |  |

111 changes: 92 additions & 19 deletions

111
[modules/library/metadata/src/main/java/org/geotools/util/factory/GeoTools.java](#diff-7f613b2fba8f6943a1388e3022543e6c3b382a31e8e660605c0e0485ca61f2a2 "modules/library/metadata/src/main/java/org/geotools/util/factory/GeoTools.java")

Show comments

[View file](/geotools/geotools/blob/4f70fa3234391dd0cda883a20ab0ec75688cba49/modules/library/metadata/src/main/java/org/geotools/util/factory/GeoTools.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,6 +25,8 @@ |
|  |  | import java.lang.reflect.InvocationTargetException; |
|  |  | import java.lang.reflect.Modifier; |
|  |  | import java.net.MalformedURLException; |
|  |  | import java.net.URI; |
|  |  | import java.net.URISyntaxException; |
|  |  | import java.net.URL; |
|  |  | import java.security.AccessController; |
|  |  | import java.security.PrivilegedAction; |
| Expand All | | @@ -38,6 +40,7 @@ |
|  |  | import java.util.Properties; |
|  |  | import java.util.Set; |
|  |  | import java.util.StringTokenizer; |
|  |  | import java.util.function.Predicate; |
|  |  | import java.util.jar.Manifest; |
|  |  | import java.util.logging.Level; |
|  |  | import java.util.logging.Logger; |
| Expand Down  Expand Up | | @@ -87,6 +90,7 @@ |
|  |  | \* @author Martin Desruisseaux |
|  |  | \*/ |
|  |  | public final class GeoTools { |
|  |  |  |
|  |  | /\*\* Properties about this geotools build \*/ |
|  |  | private static final Properties PROPS; |
|  |  |  |
| Expand Down  Expand Up | | @@ -301,6 +305,29 @@ private static Properties loadProperites(String resource) { |
|  |  | BINDINGS = Collections.unmodifiableMap(bindings); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Default JNDI name validator, allows lookups only on names without a scheme, or using the |
|  |  | \* <code>java</code> scheme. |
|  |  | \*/ |
|  |  | public static final Predicate<String> DEFAULT\_JNDI\_VALIDATOR = |
|  |  | name -> { |
|  |  | Logger LOGGER = Logging.getLogger(GeoTools.class); |
|  |  | try { |
|  |  | URI uri = new URI(name); |
|  |  | boolean result = uri.getScheme() == null || uri.getScheme().equals("java"); |
|  |  | if (!result) |
|  |  | LOGGER.warning( |
|  |  | "JNDI lookup allowed only on java scheme, or no scheme. Found instead: " |
|  |  | + name); |
|  |  | return result; |
|  |  | } catch (URISyntaxException e) { |
|  |  | LOGGER.log(Level.WARNING, "Invalid JNDI name provided", e); |
|  |  | return false; |
|  |  | } |
|  |  | }; |
|  |  |  |
|  |  | private static Predicate<String> jndiValidator = DEFAULT\_JNDI\_VALIDATOR; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Binds the specified {@linkplain System#getProperty(String) system property} to the specified |
|  |  | \* key. Only one key can be bound to a given system property. However the same key can be binded |
| Expand Down  Expand Up | | @@ -735,13 +762,13 @@ public static void init() { |
|  |  | /\*\* |
|  |  | \* Provides GeoTools with the JNDI context for resource lookup. |
|  |  | \* |
|  |  | \* @param applicationContext The initial context to use. |
|  |  | \* @see #getInitialContext |
|  |  | \* @param initialContext The initial context to use for JNDI lookup |
|  |  | \* @see #jndiLookup(String) |
|  |  | \* @since 2.4 |
|  |  | \*/ |
|  |  | public static void init(final InitialContext applicationContext) { |
|  |  | public static void init(final InitialContext initialContext) { |
|  |  | synchronized (GeoTools.class) { |
|  |  | context = applicationContext; |
|  |  | context = initialContext; |
|  |  | } |
|  |  | fireConfigurationChanged(); |
|  |  | } |
| Expand Down  Expand Up | | @@ -934,30 +961,24 @@ static <T, D extends T> T instantiate(String className, Class<T> type, D default |
|  |  | } |
|  |  | return defaultValue; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Returns the default initial context. |
|  |  | \* |
|  |  | \* @param hints An optional set of hints, or {@code null} if none. |
|  |  | \* @return The initial context (never {@code null}). |
|  |  | \* @throws NamingException if the initial context can't be created. |
|  |  | \* @see #init(InitialContext) |
|  |  | \* @since 2.4 |
|  |  | \* @deprecated hints isn't really used. Use the function without hints |
|  |  | \* @deprecated Please use {@link #jndiLookup(String)} instead, or provide an {@link |
|  |  | \* InitialContext} to the {@link #init(InitialContext)} method and use it directly. |
|  |  | \*/ |
|  |  | @Deprecated |
|  |  | public static synchronized InitialContext getInitialContext(final Hints hints) |
|  |  | throws NamingException { |
|  |  |  |
|  |  | return getInitialContext(); |
|  |  | public static synchronized InitialContext getInitialContext() throws NamingException { |
|  |  | Logging.getLogger(GeoTools.class) |
|  |  | .severe( |
|  |  | "Please don't use GeoTools.getInitialContext(), perform lookups using GeoTools.jndiLookup(s) instead."); |
|  |  | return getJNDIContext(); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Returns the default initial context. |
|  |  | \* |
|  |  | \* @return The initial context (never {@code null}). |
|  |  | \* @throws NamingException if the initial context can't be created. |
|  |  | \*/ |
|  |  | public static synchronized InitialContext getInitialContext() throws NamingException { |
|  |  | private static synchronized InitialContext getJNDIContext() throws NamingException { |
|  |  | if (context == null) { |
|  |  | try { |
|  |  | context = new InitialContext(); |
| Expand All | | @@ -968,6 +989,45 @@ public static synchronized InitialContext getInitialContext() throws NamingExcep |
|  |  | return context; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Checks if JNDI is available, either because it was initialized, or because it was possible to |
|  |  | \* create one. |
|  |  | \*/ |
|  |  | public static boolean isJNDIAvailable() { |
|  |  | try { |
|  |  | // see if we have a context, or can create one |
|  |  | return getJNDIContext() != null; |
|  |  | } catch (NamingException e) { |
|  |  | return false; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Sets up a function that will be called to validate the JNDI lookups. If not set, the |
|  |  | \* DEFAULT\_JNDI\_VALIDATOR is used. The function may want to log the reason why a given name was |
|  |  | \* denied lookup. |
|  |  | \* |
|  |  | \* @param validator A function returning true if the lookups are meant to be performed, false |
|  |  | \* otherwise. |
|  |  | \*/ |
|  |  | public static void setJNDINameValidator(Predicate<String> validator) { |
|  |  | jndiValidator = validator; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Looks up an object from the JNDI {@link InitialContext}. By default, it only allows lookups |
|  |  | \* with no scheme, or inside the <code>java</code> scheme. One can set up a custom name |
|  |  | \* validation routine using |
|  |  | \* |
|  |  | \* @param name |
|  |  | \* @return |
|  |  | \* @throws NamingException |
|  |  | \*/ |
|  |  | public static Object jndiLookup(String name) throws NamingException { |
|  |  | if (!jndiValidator.test(name)) return null; |
|  |  | return getJNDIContext().lookup(name); |
|  |  | } |
|  |  |  |
|  |  | private static NamingException handleException(Exception e) { |
|  |  | final Logger LOGGER = Logging.getLogger(GeoTools.class); |
|  |  | final String propFileName = "jndi.properties"; |
| Expand Down  Expand Up | | @@ -1064,7 +1124,11 @@ public static synchronized void clearInitialContext() throws NamingException { |
|  |  | \* @return Name fixed up with {@link Context#composeName(String,String)}, or {@code null} if the |
|  |  | \* given name was null. |
|  |  | \* @since 2.4 |
|  |  | \* @deprecated With no replacement, GeoTools now uses JNDI lookups as instructed in {@link |
|  |  | \* #jndiLookup(String)}, but does not put any object in the contex, the downstream |
|  |  | \* application should do it if necessary instead. |
|  |  | \*/ |
|  |  | @Deprecated |
|  |  | public static String fixName(final String name) { |
|  |  | return fixName(null, name, null); |
|  |  | } |
| Expand All | | @@ -1079,7 +1143,11 @@ public static String fixName(final String name) { |
|  |  | \* @return Name fixed up with {@link Context#composeName(String,String)}, or {@code null} if the |
|  |  | \* given name was null. |
|  |  | \* @since 2.4 |
|  |  | \* @deprecated With no replacement, GeoTools now uses JNDI lookups as instructed in {@link \* |
|  |  | \* #jndiLookup(String)}, but does not put any object in the contex, the downstream \* |
|  |  | \* application should do it if necessary instead. |
|  |  | \*/ |
|  |  | @Deprecated |
|  |  | public static String fixName(final Context context, final String name) { |
|  |  | return (context != null) ? fixName(context, name, null) : name; |
|  |  | } |
| Expand All | | @@ -1088,7 +1156,12 @@ public static String fixName(final Context context, final String name) { |
|  |  | \* Implementation of {@code fixName} method. If the context is {@code null}, then the |
|  |  | \* {@linkplain #getInitialContext GeoTools initial context} will be fetch only when first |
|  |  | \* needed. |
|  |  | \* |
|  |  | \* @deprecated With no replacement, GeoTools now uses JNDI lookups as instructed in {@link \* |
|  |  | \* #jndiLookup(String)}, but does not put any object in the contex, the downstream \* |
|  |  | \* application should do it if necessary instead. |
|  |  | \*/ |
|  |  | @Deprecated |
|  |  | private static String fixName(Context context, final String name, final Hints hints) { |
|  |  | String fixed = null; |
|  |  | if (name != null) { |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[modules/library/metadata/src/test/java/org/geotools/util/factory/FactoryRegistryTest.java](#diff-5f8e2e052772cd734428f81b7c966342de5ebcbb401da9580fae84e8ee821f2c "modules/library/metadata/src/test/java/org/geotools/util/factory/FactoryRegistryTest.java")

Show comments

[View file](/geotools/geotools/blob/4f70fa3234391dd0cda883a20ab0ec75688cba49/modules/library/metadata/src/test/java/org/geotools/util/factory/FactoryRegistryTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -68,6 +68,7 @@ public void ensureHintsLoaded() { |
|  |  | \* @param creator {@code true} if the registry should be an instance of {@link |
|  |  | \* org.geotools.util.factory.FactoryCreator}. |
|  |  | \*/ |
|  |  | @SuppressWarnings("PMD.UnusedPrivateMethod") // PMD getting confused here? |
|  |  | private FactoryRegistry getRegistry( |
|  |  | final boolean creator, |
|  |  | final Factory factory1, |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4f70fa3`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgeotools%2Fgeotools%2Fcommit%2F4f70fa3234391dd0cda883a20ab0ec75688cba49) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

