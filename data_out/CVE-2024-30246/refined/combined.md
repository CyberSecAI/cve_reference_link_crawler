=== Content from github.com_155586ce_20250110_215517.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FEnalean%2Ftuleap%2Fsecurity%2Fadvisories%2FGHSA-jc7g-4pcv-8jcj)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FEnalean%2Ftuleap%2Fsecurity%2Fadvisories%2FGHSA-jc7g-4pcv-8jcj)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=Enalean%2Ftuleap)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Enalean](/Enalean)
/
**[tuleap](/Enalean/tuleap)**
Public

* [Notifications](/login?return_to=%2FEnalean%2Ftuleap) You must be signed in to change notification settings
* [Fork
  285](/login?return_to=%2FEnalean%2Ftuleap)
* [Star
   1k](/login?return_to=%2FEnalean%2Ftuleap)

* [Code](/Enalean/tuleap)
* [Pull requests
  3](/Enalean/tuleap/pulls)
* [Security](/Enalean/tuleap/security)
* [Insights](/Enalean/tuleap/pulse)

Additional navigation options

* [Code](/Enalean/tuleap)
* [Pull requests](/Enalean/tuleap/pulls)
* [Security](/Enalean/tuleap/security)
* [Insights](/Enalean/tuleap/pulse)

# Deleting or moving an artifact can delete values from unrelated artifacts

High

[LeSuisse](/LeSuisse)
published
GHSA-jc7g-4pcv-8jcj
Mar 29, 2024

## Package

Tuleap Community Edition
(tuleap)

## Affected versions

>= 14.11.99.34 && < 15.7.99.6

## Patched versions

15.7.99.6

Tuleap Enterprise Edition
(tuleap)

>= 15.7-1 && < 15.7-2
>= 15.6-1 && < 15.6-5
>= 15.5-1 && < 15.5-6
>= 15.4-1 && < 15.4-8
>= 15.3-1 && < 15.3-6
>= 15.2-1 && < 15.2-5
>= 15.1-1 && < 15.1-9
>= 15.0-1 && < 15.0-9
>= 14.12-1 && < 14.12-6

15.7-2
15.6-5
15.5-6
15.4-8
15.3-6
15.2-5
15.1-9
15.0-9
14.12-6

## Description

### Impact

A malicious user could exploit this issue on purpose to delete information on the instance. It is however not possible to control exactly which information is deleted.

Information from the following fields can be impacted:

* Date
* File
* Float
* Int
* List
* OpenList
* Text
* String
* Permissions on artifact

### Patches

The following versions contain the fix:

* Tuleap Community Edition 15.7.99.6
* Tuleap Enterprise Edition 15.7-2
* Tuleap Enterprise Edition 15.6-5
* Tuleap Enterprise Edition 15.5-6
* Tuleap Enterprise Edition 15.4-8
* Tuleap Enterprise Edition 15.3-6
* Tuleap Enterprise Edition 15.2-5
* Tuleap Enterprise Edition 15.1-9
* Tuleap Enterprise Edition 15.0-9
* Tuleap Enterprise Edition 14.12-6

### For more information

If you have any questions or comments about this advisory, reach out to us via the contact information provided on the [Tuleap.org security page](https://www.tuleap.org/security/).

### References

* [request #37545 Deleting or moving an artifact can delete values from unrelated artifacts](https://tuleap.net/plugins/tracker/?aid=37545)
* [a0ba0ae](https://github.com/Enalean/tuleap/commit/a0ba0ae82a29eb8bfacef286778e5e49954f5316)
* <https://tuleap.net/plugins/git/tuleap/tuleap/stable?a=commit&h=a0ba0ae82a29eb8bfacef286778e5e49954f5316>

### Severity

High

7.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
High

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:L

### CVE ID

CVE-2024-30246

### Weaknesses

[CWE-440](/advisories?query=cwe%3A440)

### Credits

* [![@gbonnefille](https://avatars.githubusercontent.com/u/14096450?s=40&v=4)](/gbonnefille)
  [gbonnefille](/gbonnefille)
  Finder

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from tuleap.net_558b271d_20250110_215518.html ===

[Skip to main content](#main-content-start)

[Get help](/help/)
[Documentation](/doc/en/)

[Release Note](https://www.tuleap.org/resources/release-notes/tuleap-16-3/?utm_source=tuleap&utm_medium=forge&utm_campaign=tuleap-forge-icon-help-RN-link)

[API](/api/explorer/)
[Terms](/tos/tos.php)
[Contact](/contact.php)
Shortcuts

# Keyboard shortcuts

| Description | Shortcut |
| --- | --- |

Close

[Login](/account/login.php?return_to=%2Fplugins%2Fgit%2Ftuleap%2Ftuleap%2Fstable%3Fa%3Dcommit%26h%3Da0ba0ae82a29eb8bfacef286778e5e49954f5316 "Login")
[New User](/account/register.php "New User")

# Public

Project privacy set to public. By default, its content is available to everyone (authenticated or not). Please note that more restrictive permissions might exist on some items.

[ðŸŒ· Tuleap](/projects/tuleap "Tuleap")

[Git repositories](/plugins/git/tuleap/ "Git repositories")

[Fork repositories](/plugins/git/?group_id=101&action=fork_repositories "Fork repositories")

[tuleap/stable](/plugins/git/tuleap/tuleap/stable "tuleap/stable")

# stable

Clone

# Clone or download

HTTPS (Default)
Read-only

SSH

[Files](/plugins/git/tuleap/tuleap/stable?a=tree&hb=a0ba0ae82a29eb8bfacef286778e5e49954f5316)
[Commits](/plugins/git/tuleap/tuleap/stable?a=commit&h=a0ba0ae82a29eb8bfacef286778e5e49954f5316)
[Pull requests
0](/plugins/git/?action=pull-requests&repo_id=58&group_id=101&tab=homepage)

## fix: [request #37545](https://tuleap.net/goto?key=request&val=37545&group_id=101 "Artefact - Bugs") Deleting or moving an artifact can delete values from unrelated artifacts

[Download](?a=commitdiff_plain&h=a0ba0ae82a29eb8bfacef286778e5e49954f5316&noheader=1 "Download commit as plain text file")
[Browse](?a=tree&hb=a0ba0ae82a29eb8bfacef286778e5e49954f5316 "Browse repository at this commit")

Issue has been introduced by [git #tuleap/stable/7f2e5e974596196bd96c2146c533353ecbcc592f](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F7f2e5e974596196bd96c2146c533353ecbcc592f&group_id=101 "plugin_git:reference_commit_desc_key").
Change-Id: I04ac31d1803abcd5ce46f121e1411825f063247b

+28
âˆ’70

Author
[![](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)
Thomas Gerbet (tgerbet)](/users/tgerbet)
 2024-03-28 16:33

Committer
[![](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)
Thomas Gerbet (tgerbet)](/users/tgerbet)
 2024-03-28 17:34

Hash
a0ba0ae82a29eb8bfacef286778e5e49954f5316

Parent
[7a8781e708fec86d0d2297d7eda13005968f0847](?a=commit&h=7a8781e708fec86d0d2297d7eda13005968f0847)

Reference
git #tuleap/stable/a0ba0ae82a29eb8bfacef286778e5e49954f5316

## Modified Files

 List

[Side by side diff](?a=commitdiff&h=a0ba0ae82a29eb8bfacef286778e5e49954f5316&o=side-by-side)

[Inline diff](?a=commitdiff&h=a0ba0ae82a29eb8bfacef286778e5e49954f5316)

|  | Name |  |  |  |
| --- | --- | --- | --- | --- |
| M | plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArchiveAndDeleteArtifactTaskBuilder.php | +0 | âˆ’1 | [Go to diff](?a=blobdiff&h=06470477089ddf54b08e55350c42ed5d46f243f7&hp=e112f7c332cc0ecabd3174cd7088d6713edbb939&hb=a0ba0ae82a29eb8bfacef286778e5e49954f5316&f=plugins%2Ftracker%2Finclude%2FTracker%2FArtifact%2FArtifactsDeletion%2FArchiveAndDeleteArtifactTaskBuilder.php)  [View file](?a=blob&h=06470477089ddf54b08e55350c42ed5d46f243f7&hb=a0ba0ae82a29eb8bfacef286778e5e49954f5316&f=plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArchiveAndDeleteArtifactTaskBuilder.php) |
| D | plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArtifactChangesetValueDeletorDAO.php | +0 | âˆ’61 | [Go to diff](?a=blobdiff&h=0000000000000000000000000000000000000000&hp=964f2616f8a1c6ae2602ab1b982bf5b66c5bada1&hb=a0ba0ae82a29eb8bfacef286778e5e49954f5316&f=plugins%2Ftracker%2Finclude%2FTracker%2FArtifact%2FArtifactsDeletion%2FArtifactChangesetValueDeletorDAO.php)  [View file](?a=blob&h=0000000000000000000000000000000000000000&hb=a0ba0ae82a29eb8bfacef286778e5e49954f5316&f=plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArtifactChangesetValueDeletorDAO.php) |
| M | plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArtifactDependenciesCleaner.php | +0 | âˆ’2 | [Go to diff](?a=blobdiff&h=f34f6889a8f45da9351aaa69138b44822aef3cf6&hp=d78fc8bfa72534e99884359901c0056dd8f7c354&hb=a0ba0ae82a29eb8bfacef286778e5e49954f5316&f=plugins%2Ftracker%2Finclude%2FTracker%2FArtifact%2FArtifactsDeletion%2FArtifactDependenciesCleaner.php)  [View file](?a=blob&h=f34f6889a8f45da9351aaa69138b44822aef3cf6&hb=a0ba0ae82a29eb8bfacef286778e5e49954f5316&f=plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArtifactDependenciesCleaner.php) |
| M | plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/PendingArtifactRemovalDao.php | +28 | âˆ’3 | [Go to diff](?a=blobdiff&h=3a0b08ca753cb6fb1fd62fac5d5f722a30709964&hp=fba30c56f20916d0f13e3c6edd5e882ce975b2bd&hb=a0ba0ae82a29eb8bfacef286778e5e49954f5316&f=plugins%2Ftracker%2Finclude%2FTracker%2FArtifact%2FArtifactsDeletion%2FPendingArtifactRemovalDao.php)  [View file](?a=blob&h=3a0b08ca753cb6fb1fd62fac5d5f722a30709964&hb=a0ba0ae82a29eb8bfacef286778e5e49954f5316&f=plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/PendingArtifactRemovalDao.php) |
| M | plugins/tracker/tests/unit/Tracker/Artifact/ArtifactsDeletion/ArtifactDependenciesDeletorTest.php | +0 | âˆ’3 | [Go to diff](?a=blobdiff&h=ecb00d1f1ab356abc8038cd23ea317292b5ba673&hp=c2510d050962937967ba4446b252da5d52105aea&hb=a0ba0ae82a29eb8bfacef286778e5e49954f5316&f=plugins%2Ftracker%2Ftests%2Funit%2FTracker%2FArtifact%2FArtifactsDeletion%2FArtifactDependenciesDeletorTest.php)  [View file](?a=blob&h=ecb00d1f1ab356abc8038cd23ea317292b5ba673&hb=a0ba0ae82a29eb8bfacef286778e5e49954f5316&f=plugins/tracker/tests/unit/Tracker/Artifact/ArtifactsDeletion/ArtifactDependenciesDeletorTest.php) |



=== Content from tuleap.net_031af925_20250110_215518.html ===

[Skip to main content](#main-content)

[Get help](/help/)
[Documentation](/doc/en/)

[Release Note](https://www.tuleap.org/resources/release-notes/tuleap-16-3/?utm_source=tuleap&utm_medium=forge&utm_campaign=tuleap-forge-icon-help-RN-link)

[API](/api/explorer/)
[Terms](/tos/tos.php)
[Contact](/contact.php)
[Shortcuts](#help-modal-shortcuts)

### Keyboard shortcuts

| Description | Shortcut |
| --- | --- |

Close

[Login](/account/login.php?return_to=%2Fplugins%2Ftracker%2F%3Faid%3D37545)
[New User](/account/register.php)

# Public

Project privacy set to public. By default, its content is available to everyone (authenticated or not). Please note that more restrictive permissions might exist on some items.

[ðŸŒ· Tuleap](/projects/tuleap "Tuleap")

[Trackers](/plugins/tracker/?group_id=101 "Trackers")

[Requests](/plugins/tracker/?tracker=140 "Requests")
Shortcuts
[Requests Kanban](/kanban/70 "Requests Kanban")

[request #37545](/plugins/tracker/?aid=37545 "request #37545")

* request #37545
  Deleting or moving an artifact can delete values from unrelated artifacts

Actions

* Create Git branch and pull request

* [Artifact](/plugins/tracker/?aid=37545)

| Infos |  |
| --- | --- |

| Artifact ID[#37545](/plugins/tracker/?aid=37545)Submitted byThomas Gerbet (tgerbet) | Last Modified On2024-05-07 11:10Submitted on2024-03-28 16:09Rank39167 |
| --- | --- |

| Details |  |
| --- | --- |

| Summary \*Deleting or moving an artifact can delete values from unrelated artifacts |
| --- |

Original Submission

Moving or deleting an artifact can lead to the removal of information on other unrelated artifacts on the instance.

### Impact

A malicious user could exploit this issue on purpose to delete information on the instance. It is however not possible to control exactly which information is deleted.

Information from the following fields can be impacted:

* Date
* File
* Float
* Int
* List (checkbox, selectbox, radio button, multi-selectbox)
* OpenList
* Text
* String
* Permissions on artifact (for the history visualization, actual permissions are not affected, see details below)

Issue is present since Tuleap 14.11.99.34 ([git #tuleap/stable/7f2e5e974596196bd96c2146c533353ecbcc592f](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F7f2e5e974596196bd96c2146c533353ecbcc592f&group_id=101 "plugin_git:reference_commit_desc_key"))

CVSSv3.1 score: 7.1 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:L)

#### Details on the "Permissions on artifact" field

Data stored in the `tracker_changeset_value_permissionsonartifact` database table can be affected by this issue. This affects features such as the diff of values in changeset history, CSV export, REST API and webhooks data, etc.

However, the set of permissions that are currently enforced for a given artifact are stored in another database table named `permissions` which **is not affected** by this issue. As a result, there are two possible cases for an artifact where the "Permissions on artifact" value has been affected by this issue:

1. If the "Permissions on artifact" value has never changed since the affected value, the permissions that had been set are still in effect. User groups that had permission to see the artifact can still see it, user groups that did not have permission are still rejected. Confidentiality is preserved, but changeset history, CSV export, REST API will have a gap for this field.
2. If the "Permissions on artifact" value has changed (or will change) since the affected value, the new permissions will apply as usual. Confidentiality is preserved.

### References

[CWE-440](https://cwe.mitre.org/data/definitions/440.html)

CVE-2024-30246

### Acknowledgements

This issue was identified and reported by Guilhem Bonnefille from [CS Group](https://www.csgroup.eu/fr/).

| CategoryTrackers | Reported in versionAllPlatformEmpty |
| --- | --- |

Is an Enhancement or an internal improvement?

* [ ] enhancement
* [ ] internal improvement
CC listEmpty

| Stage |  |
| --- | --- |

| Assigned toThomas Gerbet (tgerbet) | StatusClosedClose date2024-03-29 |
| --- | --- |

| Attachments |  |
| --- | --- |

Connected artifacts
##### Artifact links

## Releases

## Fixed in

  | Artifact ID | Project | Tracker | Summary | Status | Last Update Date | Submitted By | Assigned to ||  | [rel #36797](/plugins/tracker/?aid=36797) | Tuleap | Releases | 15.8 | Delivered | 2024-04-24 13:48 | [Manuel Vacelet (vaceletm)](/users/vaceletm) |  |

##### Reverse artifact links

EmptyAttachmentsBy [Thomas Gerbet (tgerbet)](/users/tgerbet)(2 MB)[CVE-2024-30246\_14490449103aee2.phar](/plugins/tracker/attachments/2681-CVE-2024-30246_14490449103aee2.phar "Tool to identify and possibly repair corrupted data")Tool to identify and possibly repair corrupted data

| References |  |
| --- | --- |

Cross references
##### Referencing request #37545

# Artifact Tracker v5

[request #37592

Mitigate risks of data loss in DB](https://tuleap.net/goto?key=request&val=37592&group_id=101)

# Git commit

## tuleap/tuleap/stable

[fix: request #37545 Deleting or moving an artifact can delete values from unrelated artifacts

a0ba0ae82a

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)

Thomas Gerbet (tgerbet)

,
2024-03-28 17:34](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2Fa0ba0ae82a29eb8bfacef286778e5e49954f5316&group_id=101)
[Merge commit 'refs/changes/85/30785/3' of ssh://gerrit.tuleap.net:29418/tuleap into HEAD

04e68bbe7c

![User avatar](https://tuleap.net/users/jmasson/avatar-6fd7cfc62428df447515eeadedf7bea16e9d93e717c093794ff0c53ddcd6b734.png)

Joris MASSON (jmasson)

,
2024-03-29 10:54](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F04e68bbe7cc63d6b49521d434c931cf70a6c1b9b&group_id=101)
[feat: Attempt to identify and fix changesets affected by CVE-2024-30246

8881e29531

![User avatar](https://tuleap.net/users/jmasson/avatar-6fd7cfc62428df447515eeadedf7bea16e9d93e717c093794ff0c53ddcd6b734.png)

Joris MASSON (jmasson)

,
2024-04-19 09:38](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F8881e29531b0d65f9b70562af10178df83206d59&group_id=101)
[fix: CVE-2024-30246 correction tool should output a valid SQL file

6bba89c349

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)

Thomas Gerbet (tgerbet)

,
2024-04-19 10:59](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F6bba89c349a0f3916fdbcd67fc189736f43f3b68&group_id=101)
[feat: CVE-2024-30246 correction tool now allows to set all DB options

29e105c85a

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)

Thomas Gerbet (tgerbet)

,
2024-04-19 11:53](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F29e105c85a419aef1cfe59aeeab0d0e635f2b466&group_id=101)
[fix: Avoid to display info that can be misinterpreted when running `CVE-2024-30246.phar identify`

d55f7de254

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)

Thomas Gerbet (tgerbet)

,
2024-04-26 10:17](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2Fd55f7de25441b545afbe0d043dbe0b0b71321cf3&group_id=101)

Show items referenced by request #37545

##### Referenced by request #37545

# Artifact Tracker v5

[rel #36797

15.8](https://tuleap.net/goto?key=rel&val=36797&group_id=101)

# Git commit

## tuleap/tuleap/stable

[Comments are duplicate multiples times at artifact move

7f2e5e9745

![User avatar](https://tuleap.net/users/marieange/avatar-fc91e7a577e6e9dce6f132bec6cca1d483a5ba88cb410ba785f1744500e9c4a2.png)

Marie Ange Garnier (marieange)

,
2023-07-26 15:50](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F7f2e5e974596196bd96c2146c533353ecbcc592f&group_id=101)
[feat: Attempt to identify and fix changesets affected by CVE-2024-30246

8881e29531

![User avatar](https://tuleap.net/users/jmasson/avatar-6fd7cfc62428df447515eeadedf7bea16e9d93e717c093794ff0c53ddcd6b734.png)

Joris MASSON (jmasson)

,
2024-04-19 09:38](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F8881e29531b0d65f9b70562af10178df83206d59&group_id=101)

# Other

[gerrit #30785](https://tuleap.net/goto?key=gerrit&val=30785&group_id=101)
[gerrit #30979](https://tuleap.net/goto?key=gerrit&val=30979&group_id=101)

Display settings

* [Comments are in reversed order](#invert-order)
* Changes are displayed
# Follow-ups

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-05-07 11:10

* **Attachments** CVE-2024-30246\_0ab35aa8b09.phar removed; [CVE-2024-30246\_14490449103aee2.phar](https://tuleap.net/plugins/tracker/attachments/2681-CVE-2024-30246_14490449103aee2.phar) added
![User avatar](https://tuleap.net/users/rossettoy/avatar-4d474c3409a601810664edcbee1c716e0b91d07548f3251e4ea7039376464aee.png)[Yannis ROSSETTO (rossettoy)](/users/rossettoy)2024-05-06 14:10

[gerrit #30979](https://tuleap.net/goto?key=gerrit&val=30979&group_id=101 "gerrit") (fix: Avoid to display info that can be misinterpreted when running `CVE-2024-30246.phar identify`) integrated into Tuleap 15.8.99.53

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-04-19 14:41
last edited by:
[Thomas Gerbet (tgerbet)](/users/tgerbet)
2024-05-07 11:11

Attaching a tool ([git #tuleap/stable/8881e29531b0d65f9b70562af10178df83206d59](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F8881e29531b0d65f9b70562af10178df83206d59&group_id=101 "plugin_git:reference_commit_desc_key")) to help identify and retrieve corrupted data from a backup.
The tool works in 2 steps.

The first step is expected to be executed against the current production DB of a Tuleap instance. It will try to identify changeset values that might have been affected by the issue. It will output something looking like that:

```
$> /opt/remi/php82/root/usr/bin/php ./CVE-2024-30246_14490449103aee2.phar identify --dbhost=127.0.0.1 --dbname=tuleap --dbusername=tuleapadm --output-file=/path/to/write/suspected_changeset_values_document.json
Password for DB user 'tuleapadm':
Searching...
Maximum changeset_id = '20415'
Submission date of the last affected changeset: '2018-04-16T15:52:00+00:00'
Estimated date of update to Tuleap higher than 14.11 = '2023-09-07 07:13:50'
Submission date of the last affected changeset for complex fields: '2018-06-01T08:26:33+00:00'
Estimated date of update to Tuleap higher than 14.11 = '2023-09-07 07:13:50'
End of report

```

The second part of the tool will use the document that has been generated by the first one to generate SQL queries to fix the corrupted values. The second part of the tool must be executed against a restored backup of the DB. You will want to restore a backup around the indicated date of the 14.11 upgrade to restore corrupted values created before this date.

```
$> /opt/remi/php82/root/usr/bin/php ./CVE-2024-30246_0ab35aa8b09.phar retrieve --dbhost=127.0.0.1 --dbname=tuleap_backup --dbusername=tuleapadm --input-file=/path/to/suspected_changeset_values_document.json --output-file=/path/to/write/sql_queries.sql
Password for DB user 'tuleapadm':
Checking text fields...
Checking list fields...
Checking computed fields...
Checking float fields...
Checking int fields...
Checking date fields...
Checking file fields...
Checking openlist fields...
Checking artifact link fields...
Checking permissions on artifact fields...

```

The generated SQL file can then be applied on your current production DB.

---

* **Attachments** ~~CVE-2024-30246\_0ab35aa8b09.phar~~ added
![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-04-19 10:46

Adjusting the CVSS score with the additional details on the "permissions on artifact" field

---

* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
![User avatar](https://tuleap.net/users/gbonnefille/avatar-9ae894d39a155c14d299eec3a799d070877b9129cd4dfa6109026b54ce6ced9a.png)[Guilhem Bonnefille (CS) (gbonnefille)](/users/gbonnefille)2024-04-04 08:41

As a reminder, here is the script I imagined to retrieve lost data from a live MySQL backup, providing the missing Artifact Changeset as argument:

```
#!/bin/sh

#
# For authentication, set $MYSQL_PWD
#

CHANGESETS=`echo $* | tr ' ' ','`

IDS=`mysql -u tuleapadm -B -N -e "SELECT id FROM tracker_changeset_value WHERE changeset_id IN ($CHANGESETS)" tuleap | tr '\n' ',' | sed 's/,$//'`

for table in tracker_changeset_value_artifactlink tracker_changeset_value_computedfield_manual_value tracker_changeset_value_date tracker_changeset_value_file tracker_changeset_value_float tracker_changeset_value_int tracker_changeset_value_list tracker_changeset_value_openlist tracker_changeset_value_permissionsonartifact tracker_changeset_value_text
do
  mysqldump -u tuleapadm -y -n -t tuleap $table --where "changeset_value_id in ($IDS)"
done

```

![User avatar](https://tuleap.net/users/jmasson/avatar-6fd7cfc62428df447515eeadedf7bea16e9d93e717c093794ff0c53ddcd6b734.png)[Joris MASSON (jmasson)](/users/jmasson)2024-04-02 15:36

Added details on the impacts for the "Permissions on artifact" field.

---

* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
![User avatar](https://tuleap.net/users/jmasson/avatar-6fd7cfc62428df447515eeadedf7bea16e9d93e717c093794ff0c53ddcd6b734.png)[Joris MASSON (jmasson)](/users/jmasson)2024-03-29 17:38

Added "String" field type and added details for List field types

---

* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-03-29 17:37

* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-03-29 15:25

CVE-2024-30246 has been assigned to this issue.

---

* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-03-29 12:26

* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
![User avatar](https://tuleap.net/users/jmasson/avatar-6fd7cfc62428df447515eeadedf7bea16e9d93e717c093794ff0c53ddcd6b734.png)[Joris MASSON (jmasson)](/users/jmasson)2024-03-29 10:58

* **Status**  changed from Under review to Closed
* **Connected artifacts**
  + Added Fixed in: [rel #36797](https://tuleap.net/goto?key=rel&val=36797&group_id=101)
* **Close date** set to 2024-03-29
![User avatar](https://tuleap.net/users/gbonnefille/avatar-9ae894d39a155c14d299eec3a799d070877b9129cd4dfa6109026b54ce6ced9a.png)[Guilhem Bonnefille (CS) (gbonnefille)](/users/gbonnefille)2024-03-29 08:58

[@tgerbet](https://tuleap.net/users/tgerbet) it's OK for me.

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-03-29 08:35

Flagging this as an security issue since it impacts data integrity and there is at least one offensive scenario where a bad actor can exploit it to wreak havoc on purpose.

[@gbonnefille](https://tuleap.net/users/gbonnefille) Is it fine if we credit you and CS Group in the advisory?

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-03-28 16:42

See [gerrit #30785](https://tuleap.net/goto?key=gerrit&val=30785&group_id=101 "gerrit")

---

* **Summary** -Deleting an artifact can delete values from unrelated ~~artifact~~Â +Deleting or moving an artifact can delete values from unrelated artifacts
* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
* **Status**  changed from Under implementation to Under review
![User avatar](https://tuleap.net/users/gbonnefille/avatar-9ae894d39a155c14d299eec3a799d070877b9129cd4dfa6109026b54ce6ced9a.png)[Guilhem Bonnefille (CS) (gbonnefille)](/users/gbonnefille)2024-03-28 16:34

Furthermore, as the deletion did not select the right elements, the database also contains orphans 'values'.
We can find them with:

```
SELECT * FROM tracker_changeset_value_all vv
WHERE NOT EXISTS (SELECT id FROM tracker_changeset_value v WHERE v.id = vv.changeset_value_id);

```

![User avatar](https://tuleap.net/users/gbonnefille/avatar-9ae894d39a155c14d299eec3a799d070877b9129cd4dfa6109026b54ce6ced9a.png)[Guilhem Bonnefille (CS) (gbonnefille)](/users/gbonnefille)2024-03-28 16:18
last edited by:
[Guilhem Bonnefille (CS) (gbonnefille)](/users/gbonnefille)
2024-03-28 16:24

It is possible to identify the affected changesets with the following SQL requests:

```
CREATE TEMPORARY TABLE tracker_changeset_value_all (PRIMARY KEY my_pkey (changeset_value_id)) SELECT * FROM (
SELECT changeset_value_id FROM
tracker_changeset_value_artifactlink
UNION
SELECT changeset_value_id FROM tracker_changeset_value_computedfield_manual_value
UNION
SELECT changeset_value_id FROM tracker_changeset_value_date UNION   SELECT changeset_value_id FROM tracker_changeset_value_file UNION   SELECT changeset_value_id FROM tracker_changeset_value_float
UNION
SELECT changeset_value_id FROM tracker_changeset_value_int UNION   SELECT changeset_value_id FROM tracker_changeset_value_list
UNION
SELECT changeset_value_id FROM tracker_changeset_value_openlist UNION   SELECT changeset_value_id FROM tracker_changeset_value_permissionsonartifact
UNION
SELECT changeset_value_id FROM tracker_changeset_value_text ) AS foo;

SELECT c.id, FROM_UNIXTIME(c.submitted_on), c.artifact_id, a.id, a.tracker_id, t.name, g.group_name FROM tracker_changeset c
LEFT JOIN tracker_artifact a ON c.artifact_id = a.id
LEFT JOIN tracker t ON t.id = a.tracker_id
LEFT JOIN groups g ON g.group_id = t.group_id
WHERE NOT EXISTS (SELECT cv.id FROM tracker_changeset_value cv WHERE c.id = cv.changeset_id AND EXISTS (SELECT * FROM tracker_changeset_value_all WHERE changeset_value_id = cv.id)) AND NOT EXISTS (SELECT * FROM tracker_changeset_comment cm WHERE c.id = cm.changeset_id) ;

```



=== Content from github.com_afa32ab5_20250110_215517.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FEnalean%2Ftuleap%2Fcommit%2Fa0ba0ae82a29eb8bfacef286778e5e49954f5316)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FEnalean%2Ftuleap%2Fcommit%2Fa0ba0ae82a29eb8bfacef286778e5e49954f5316)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=Enalean%2Ftuleap)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Enalean](/Enalean)
/
**[tuleap](/Enalean/tuleap)**
Public

* [Notifications](/login?return_to=%2FEnalean%2Ftuleap) You must be signed in to change notification settings
* [Fork
  285](/login?return_to=%2FEnalean%2Ftuleap)
* [Star
   1k](/login?return_to=%2FEnalean%2Ftuleap)

* [Code](/Enalean/tuleap)
* [Pull requests
  3](/Enalean/tuleap/pulls)
* [Security](/Enalean/tuleap/security)
* [Insights](/Enalean/tuleap/pulse)

Additional navigation options

* [Code](/Enalean/tuleap)
* [Pull requests](/Enalean/tuleap/pulls)
* [Security](/Enalean/tuleap/security)
* [Insights](/Enalean/tuleap/pulse)

## Commit

[Permalink](/Enalean/tuleap/commit/a0ba0ae82a29eb8bfacef286778e5e49954f5316)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix: request #37545 Deleting or moving an artifact can delete values â€¦

[Browse files](/Enalean/tuleap/tree/a0ba0ae82a29eb8bfacef286778e5e49954f5316)
Browse the repository at this point in the history

```
â€¦from unrelated artifacts

Issue has been introduced by git #tuleap/stable/7f2e5e974596196bd96c2146c533353ecbcc592f.

Change-Id: I04ac31d1803abcd5ce46f121e1411825f063247b
```

* Loading branch information

[![@LeSuisse](https://avatars.githubusercontent.com/u/737767?s=40&v=4)](/LeSuisse)

[LeSuisse](/Enalean/tuleap/commits?author=LeSuisse "View all commits by LeSuisse")
committed
Mar 28, 2024

1 parent
[7a8781e](/Enalean/tuleap/commit/7a8781e708fec86d0d2297d7eda13005968f0847)

commit a0ba0ae

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**28 additions**
and
**70 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* plugins/tracker

  + include/Tracker/Artifact/ArtifactsDeletion

    - plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArchiveAndDeleteArtifactTaskBuilder.php
      [ArchiveAndDeleteArtifactTaskBuilder.php](#diff-2587c7aee2bce8ce974c8e64563c5f09187df8a048fbba3d860463e6960dec89)
    - plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArtifactChangesetValueDeletorDAO.php
      [ArtifactChangesetValueDeletorDAO.php](#diff-23c8ae89453f4d7314b4dc71a7272f4f801d8ef036e37e04da986c55a397e470)
    - plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArtifactDependenciesCleaner.php
      [ArtifactDependenciesCleaner.php](#diff-868d4aef78b71c4e3b0a3cf6989bc97022f84b23e4e2e2c84ecd9b965854dec1)
    - plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/PendingArtifactRemovalDao.php
      [PendingArtifactRemovalDao.php](#diff-54434094484ac9489fde9657cadfe91d32d775b14ce0acf55caf13fbf9fdc0b1)
  + tests/unit/Tracker/Artifact/ArtifactsDeletion

    - plugins/tracker/tests/unit/Tracker/Artifact/ArtifactsDeletion/ArtifactDependenciesDeletorTest.php
      [ArtifactDependenciesDeletorTest.php](#diff-07e200157f918f3fd7c87625627f5a485b0521ac787f348f0fd694f9b7d91245)

## There are no files selected for viewing

1 change: 0 additions & 1 deletion

1
[...racker/include/Tracker/Artifact/ArtifactsDeletion/ArchiveAndDeleteArtifactTaskBuilder.php](#diff-2587c7aee2bce8ce974c8e64563c5f09187df8a048fbba3d860463e6960dec89 "plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArchiveAndDeleteArtifactTaskBuilder.php")

Show comments

[View file](/Enalean/tuleap/blob/a0ba0ae82a29eb8bfacef286778e5e49954f5316/plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArchiveAndDeleteArtifactTaskBuilder.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -217,7 +217,6 @@ public function build(LoggerInterface $logger): ArchiveAndDeleteArtifactTask |
|  |  | new ComputedFieldDaoCache(new ComputedFieldDao()), |
|  |  | new RecentlyVisitedDao(), |
|  |  | new PendingArtifactRemovalDao(), |
|  |  | new ArtifactChangesetValueDeletorDAO(), |
|  |  | new PostArtifactMoveReferencesCleaner( |
|  |  | $cross\_reference\_manager, |
|  |  | new ReverseLinksRetriever(new ReverseLinksDao(), $tracker\_artifact\_factory), |
| Expand Down | |  |

61 changes: 0 additions & 61 deletions

61
[...s/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArtifactChangesetValueDeletorDAO.php](#diff-23c8ae89453f4d7314b4dc71a7272f4f801d8ef036e37e04da986c55a397e470 "plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArtifactChangesetValueDeletorDAO.php")

Show comments

[View file](/Enalean/tuleap/blob/7a8781e708fec86d0d2297d7eda13005968f0847/plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArtifactChangesetValueDeletorDAO.php)
Edit file

Delete file

Load diff

This file was deleted.

Oops, something went wrong.

Retry

2 changes: 0 additions & 2 deletions

2
[plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArtifactDependenciesCleaner.php](#diff-868d4aef78b71c4e3b0a3cf6989bc97022f84b23e4e2e2c84ecd9b965854dec1 "plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArtifactDependenciesCleaner.php")

Show comments

[View file](/Enalean/tuleap/blob/a0ba0ae82a29eb8bfacef286778e5e49954f5316/plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/ArtifactDependenciesCleaner.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -36,7 +36,6 @@ public function \_\_construct( |
|  |  | private readonly ComputedFieldDaoCache $computed\_dao\_cache, |
|  |  | private readonly RecentlyVisitedDao $recently\_visited\_dao, |
|  |  | private readonly PendingArtifactRemovalDao $artifact\_removal, |
|  |  | private readonly ArtifactChangesetValueDeletorDAO $changeset\_value\_deletor\_DAO, |
|  |  | private readonly PostArtifactMoveReferencesCleaner $post\_artifact\_move\_references\_cleaner, |
|  |  | private readonly PostArtifactDeletionCleaner $artifact\_deletion\_cleaner, |
|  |  | ) { |
| Expand All | | @@ -48,7 +47,6 @@ public function cleanDependencies(Artifact $artifact, DeletionContext $context, |
|  |  |  |
|  |  | $this->cleanReferences($artifact, $context, $user); |
|  |  |  |
|  |  | $this->changeset\_value\_deletor\_DAO->cleanAllChangesetValueInTransaction($artifact); |
|  |  | $this->dao->deleteUnsubscribeNotificationForArtifact($artifact->getId()); |
|  |  | // We do not keep trace of the history change here because it doesn't have any sense |
|  |  | $this->tracker\_artifact\_priority\_manager->deletePriority($artifact); |
| Expand Down | |  |

31 changes: 28 additions & 3 deletions

31
[plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/PendingArtifactRemovalDao.php](#diff-54434094484ac9489fde9657cadfe91d32d775b14ce0acf55caf13fbf9fdc0b1 "plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/PendingArtifactRemovalDao.php")

Show comments

[View file](/Enalean/tuleap/blob/a0ba0ae82a29eb8bfacef286778e5e49954f5316/plugins/tracker/include/Tracker/Artifact/ArtifactsDeletion/PendingArtifactRemovalDao.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -41,10 +41,35 @@ public function getPendingArtifactById($artifact\_id) |
|  |  | return $this->getDB()->row($sql, $artifact\_id); |
|  |  | } |
|  |  |  |
|  |  | public function removeArtifact($artifact\_id) |
|  |  | public function removeArtifact($artifact\_id): void |
|  |  | { |
|  |  | $sql = 'DELETE FROM plugin\_tracker\_artifact\_pending\_removal |
|  |  | WHERE id = ?'; |
|  |  | $tables\_to\_clean\_with\_join = [ |
|  |  | 'tracker\_changeset' => 'tracker\_changeset.artifact\_id = plugin\_tracker\_artifact\_pending\_removal.id', |
|  |  | 'tracker\_changeset\_comment' => 'tracker\_changeset\_comment.changeset\_id = tracker\_changeset.id', |
|  |  | 'tracker\_changeset\_comment\_fulltext' => 'tracker\_changeset\_comment\_fulltext.comment\_id = tracker\_changeset\_comment.id', |
|  |  | 'tracker\_changeset\_incomingmail' => 'tracker\_changeset\_incomingmail.changeset\_id = tracker\_changeset.id', |
|  |  | 'tracker\_changeset\_value' => 'tracker\_changeset\_value.changeset\_id = tracker\_changeset.id', |
|  |  | 'tracker\_changeset\_value\_artifactlink' => 'tracker\_changeset\_value\_artifactlink.changeset\_value\_id = tracker\_changeset\_value.id', |
|  |  | 'tracker\_changeset\_value\_computedfield\_manual\_value' => 'tracker\_changeset\_value\_computedfield\_manual\_value.changeset\_value\_id = tracker\_changeset\_value.id', |
|  |  | 'tracker\_changeset\_value\_date' => 'tracker\_changeset\_value\_date.changeset\_value\_id = tracker\_changeset\_value.id', |
|  |  | 'tracker\_changeset\_value\_file' => 'tracker\_changeset\_value\_file.changeset\_value\_id = tracker\_changeset\_value.id', |
|  |  | 'tracker\_changeset\_value\_float' => 'tracker\_changeset\_value\_float.changeset\_value\_id = tracker\_changeset\_value.id', |
|  |  | 'tracker\_changeset\_value\_int' => 'tracker\_changeset\_value\_int.changeset\_value\_id = tracker\_changeset\_value.id', |
|  |  | 'tracker\_changeset\_value\_list' => 'tracker\_changeset\_value\_list.changeset\_value\_id = tracker\_changeset\_value.id', |
|  |  | 'tracker\_changeset\_value\_openlist' => 'tracker\_changeset\_value\_openlist.changeset\_value\_id = tracker\_changeset\_value.id', |
|  |  | 'tracker\_changeset\_value\_permissionsonartifact' => 'tracker\_changeset\_value\_permissionsonartifact.changeset\_value\_id = tracker\_changeset\_value.id', |
|  |  | 'tracker\_changeset\_value\_text' => 'tracker\_changeset\_value\_text.changeset\_value\_id = tracker\_changeset\_value.id', |
|  |  | ]; |
|  |  |  |
|  |  | $tables = \Psl\Str\join(array\_keys($tables\_to\_clean\_with\_join), ', '); |
|  |  | $joins = ''; |
|  |  | foreach ($tables\_to\_clean\_with\_join as $table => $join) { |
|  |  | $joins = $joins . sprintf('LEFT JOIN %s ON (%s) ', $table, $join); |
|  |  | } |
|  |  |  |
|  |  | $sql = "DELETE plugin\_tracker\_artifact\_pending\_removal, $tables |
|  |  | FROM plugin\_tracker\_artifact\_pending\_removal $joins |
|  |  | WHERE plugin\_tracker\_artifact\_pending\_removal.id = ?"; |
|  |  |  |
|  |  | $this->getDB()->run($sql, $artifact\_id); |
|  |  | } |
| Expand Down | |  |

3 changes: 0 additions & 3 deletions

3
[...tracker/tests/unit/Tracker/Artifact/ArtifactsDeletion/ArtifactDependenciesDeletorTest.php](#diff-07e200157f918f3fd7c87625627f5a485b0521ac787f348f0fd694f9b7d91245 "plugins/tracker/tests/unit/Tracker/Artifact/ArtifactsDeletion/ArtifactDependenciesDeletorTest.php")

Show comments

[View file](/Enalean/tuleap/blob/a0ba0ae82a29eb8bfacef286778e5e49954f5316/plugins/tracker/tests/unit/Tracker/Artifact/ArtifactsDeletion/ArtifactDependenciesDeletorTest.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -52,7 +52,6 @@ protected function setUp(): void |
|  |  | $computed\_dao\_cache = $this->createStub(ComputedFieldDaoCache::class); |
|  |  | $recently\_visited\_dao = $this->createStub(RecentlyVisitedDao::class); |
|  |  | $artifact\_removal = $this->createStub(PendingArtifactRemovalDao::class); |
|  |  | $value\_deletor = $this->createStub(ArtifactChangesetValueDeletorDAO::class); |
|  |  | $this->post\_move\_deletor = $this->createStub(PostArtifactMoveReferencesCleaner::class); |
|  |  | $this->artifact\_deletor = $this->createStub(PostArtifactDeletionCleaner::class); |
|  |  |  |
| Expand All | | @@ -62,7 +61,6 @@ protected function setUp(): void |
|  |  | $computed\_dao\_cache->expects(self::atLeastOnce())->method('deleteAllArtifactCacheValues'); |
|  |  | $recently\_visited\_dao->expects(self::atLeastOnce())->method('deleteVisitByArtifactId'); |
|  |  | $artifact\_removal->expects(self::atLeastOnce())->method('removeArtifact'); |
|  |  | $value\_deletor->expects(self::atLeastOnce())->method('cleanAllChangesetValueInTransaction'); |
|  |  |  |
|  |  | $this->deletor = new ArtifactDependenciesCleaner( |
|  |  | $permissions\_manager, |
| Expand All | | @@ -71,7 +69,6 @@ protected function setUp(): void |
|  |  | $computed\_dao\_cache, |
|  |  | $recently\_visited\_dao, |
|  |  | $artifact\_removal, |
|  |  | $value\_deletor, |
|  |  | $this->post\_move\_deletor, |
|  |  | $this->artifact\_deletor |
|  |  | ); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a0ba0ae`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FEnalean%2Ftuleap%2Fcommit%2Fa0ba0ae82a29eb8bfacef286778e5e49954f5316) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


