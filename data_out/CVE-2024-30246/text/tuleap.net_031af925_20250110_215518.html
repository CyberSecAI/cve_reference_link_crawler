
[Skip to main content](#main-content)

[Get help](/help/)
[Documentation](/doc/en/)

[Release Note](https://www.tuleap.org/resources/release-notes/tuleap-16-3/?utm_source=tuleap&utm_medium=forge&utm_campaign=tuleap-forge-icon-help-RN-link)

[API](/api/explorer/)
[Terms](/tos/tos.php)
[Contact](/contact.php)
[Shortcuts](#help-modal-shortcuts)

### Keyboard shortcuts

| Description | Shortcut |
| --- | --- |

Close

[Login](/account/login.php?return_to=%2Fplugins%2Ftracker%2F%3Faid%3D37545)
[New User](/account/register.php)

# Public

Project privacy set to public. By default, its content is available to everyone (authenticated or not). Please note that more restrictive permissions might exist on some items.

[ðŸŒ· Tuleap](/projects/tuleap "Tuleap")

[Trackers](/plugins/tracker/?group_id=101 "Trackers")

[Requests](/plugins/tracker/?tracker=140 "Requests")
Shortcuts
[Requests Kanban](/kanban/70 "Requests Kanban")

[request #37545](/plugins/tracker/?aid=37545 "request #37545")

* request #37545
  Deleting or moving an artifact can delete values from unrelated artifacts

Actions

* Create Git branch and pull request

* [Artifact](/plugins/tracker/?aid=37545)

| Infos |  |
| --- | --- |

| Artifact ID[#37545](/plugins/tracker/?aid=37545)Submitted byThomas Gerbet (tgerbet) | Last Modified On2024-05-07 11:10Submitted on2024-03-28 16:09Rank39167 |
| --- | --- |

| Details |  |
| --- | --- |

| Summary \*Deleting or moving an artifact can delete values from unrelated artifacts |
| --- |

Original Submission

Moving or deleting an artifact can lead to the removal of information on other unrelated artifacts on the instance.

### Impact

A malicious user could exploit this issue on purpose to delete information on the instance. It is however not possible to control exactly which information is deleted.

Information from the following fields can be impacted:

* Date
* File
* Float
* Int
* List (checkbox, selectbox, radio button, multi-selectbox)
* OpenList
* Text
* String
* Permissions on artifact (for the history visualization, actual permissions are not affected, see details below)

Issue is present since Tuleap 14.11.99.34 ([git #tuleap/stable/7f2e5e974596196bd96c2146c533353ecbcc592f](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F7f2e5e974596196bd96c2146c533353ecbcc592f&group_id=101 "plugin_git:reference_commit_desc_key"))

CVSSv3.1 score: 7.1 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:L)

#### Details on the "Permissions on artifact" field

Data stored in the `tracker_changeset_value_permissionsonartifact` database table can be affected by this issue. This affects features such as the diff of values in changeset history, CSV export, REST API and webhooks data, etc.

However, the set of permissions that are currently enforced for a given artifact are stored in another database table named `permissions` which **is not affected** by this issue. As a result, there are two possible cases for an artifact where the "Permissions on artifact" value has been affected by this issue:

1. If the "Permissions on artifact" value has never changed since the affected value, the permissions that had been set are still in effect. User groups that had permission to see the artifact can still see it, user groups that did not have permission are still rejected. Confidentiality is preserved, but changeset history, CSV export, REST API will have a gap for this field.
2. If the "Permissions on artifact" value has changed (or will change) since the affected value, the new permissions will apply as usual. Confidentiality is preserved.

### References

[CWE-440](https://cwe.mitre.org/data/definitions/440.html)

CVE-2024-30246

### Acknowledgements

This issue was identified and reported by Guilhem Bonnefille from [CS Group](https://www.csgroup.eu/fr/).

| CategoryTrackers | Reported in versionAllPlatformEmpty |
| --- | --- |

Is an Enhancement or an internal improvement?

* [ ] enhancement
* [ ] internal improvement
CC listEmpty

| Stage |  |
| --- | --- |

| Assigned toThomas Gerbet (tgerbet) | StatusClosedClose date2024-03-29 |
| --- | --- |

| Attachments |  |
| --- | --- |

Connected artifacts
##### Artifact links

## Releases

## Fixed in

  | Artifact ID | Project | Tracker | Summary | Status | Last Update Date | Submitted By | Assigned to ||  | [rel #36797](/plugins/tracker/?aid=36797) | Tuleap | Releases | 15.8 | Delivered | 2024-04-24 13:48 | [Manuel Vacelet (vaceletm)](/users/vaceletm) |  |

##### Reverse artifact links

EmptyAttachmentsBy [Thomas Gerbet (tgerbet)](/users/tgerbet)(2 MB)[CVE-2024-30246\_14490449103aee2.phar](/plugins/tracker/attachments/2681-CVE-2024-30246_14490449103aee2.phar "Tool to identify and possibly repair corrupted data")Tool to identify and possibly repair corrupted data

| References |  |
| --- | --- |

Cross references
##### Referencing request #37545

# Artifact Tracker v5

[request #37592

Mitigate risks of data loss in DB](https://tuleap.net/goto?key=request&val=37592&group_id=101)

# Git commit

## tuleap/tuleap/stable

[fix: request #37545 Deleting or moving an artifact can delete values from unrelated artifacts

a0ba0ae82a

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)

Thomas Gerbet (tgerbet)

,
2024-03-28 17:34](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2Fa0ba0ae82a29eb8bfacef286778e5e49954f5316&group_id=101)
[Merge commit 'refs/changes/85/30785/3' of ssh://gerrit.tuleap.net:29418/tuleap into HEAD

04e68bbe7c

![User avatar](https://tuleap.net/users/jmasson/avatar-6fd7cfc62428df447515eeadedf7bea16e9d93e717c093794ff0c53ddcd6b734.png)

Joris MASSON (jmasson)

,
2024-03-29 10:54](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F04e68bbe7cc63d6b49521d434c931cf70a6c1b9b&group_id=101)
[feat: Attempt to identify and fix changesets affected by CVE-2024-30246

8881e29531

![User avatar](https://tuleap.net/users/jmasson/avatar-6fd7cfc62428df447515eeadedf7bea16e9d93e717c093794ff0c53ddcd6b734.png)

Joris MASSON (jmasson)

,
2024-04-19 09:38](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F8881e29531b0d65f9b70562af10178df83206d59&group_id=101)
[fix: CVE-2024-30246 correction tool should output a valid SQL file

6bba89c349

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)

Thomas Gerbet (tgerbet)

,
2024-04-19 10:59](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F6bba89c349a0f3916fdbcd67fc189736f43f3b68&group_id=101)
[feat: CVE-2024-30246 correction tool now allows to set all DB options

29e105c85a

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)

Thomas Gerbet (tgerbet)

,
2024-04-19 11:53](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F29e105c85a419aef1cfe59aeeab0d0e635f2b466&group_id=101)
[fix: Avoid to display info that can be misinterpreted when running `CVE-2024-30246.phar identify`

d55f7de254

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)

Thomas Gerbet (tgerbet)

,
2024-04-26 10:17](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2Fd55f7de25441b545afbe0d043dbe0b0b71321cf3&group_id=101)

Show items referenced by request #37545

##### Referenced by request #37545

# Artifact Tracker v5

[rel #36797

15.8](https://tuleap.net/goto?key=rel&val=36797&group_id=101)

# Git commit

## tuleap/tuleap/stable

[Comments are duplicate multiples times at artifact move

7f2e5e9745

![User avatar](https://tuleap.net/users/marieange/avatar-fc91e7a577e6e9dce6f132bec6cca1d483a5ba88cb410ba785f1744500e9c4a2.png)

Marie Ange Garnier (marieange)

,
2023-07-26 15:50](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F7f2e5e974596196bd96c2146c533353ecbcc592f&group_id=101)
[feat: Attempt to identify and fix changesets affected by CVE-2024-30246

8881e29531

![User avatar](https://tuleap.net/users/jmasson/avatar-6fd7cfc62428df447515eeadedf7bea16e9d93e717c093794ff0c53ddcd6b734.png)

Joris MASSON (jmasson)

,
2024-04-19 09:38](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F8881e29531b0d65f9b70562af10178df83206d59&group_id=101)

# Other

[gerrit #30785](https://tuleap.net/goto?key=gerrit&val=30785&group_id=101)
[gerrit #30979](https://tuleap.net/goto?key=gerrit&val=30979&group_id=101)

Display settings

* [Comments are in reversed order](#invert-order)
* Changes are displayed
# Follow-ups

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-05-07 11:10

* **Attachments** CVE-2024-30246\_0ab35aa8b09.phar removed; [CVE-2024-30246\_14490449103aee2.phar](https://tuleap.net/plugins/tracker/attachments/2681-CVE-2024-30246_14490449103aee2.phar) added
![User avatar](https://tuleap.net/users/rossettoy/avatar-4d474c3409a601810664edcbee1c716e0b91d07548f3251e4ea7039376464aee.png)[Yannis ROSSETTO (rossettoy)](/users/rossettoy)2024-05-06 14:10

[gerrit #30979](https://tuleap.net/goto?key=gerrit&val=30979&group_id=101 "gerrit") (fix: Avoid to display info that can be misinterpreted when running `CVE-2024-30246.phar identify`) integrated into Tuleap 15.8.99.53

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-04-19 14:41
last edited by:
[Thomas Gerbet (tgerbet)](/users/tgerbet)
2024-05-07 11:11

Attaching a tool ([git #tuleap/stable/8881e29531b0d65f9b70562af10178df83206d59](https://tuleap.net/goto?key=git&val=tuleap%2Fstable%2F8881e29531b0d65f9b70562af10178df83206d59&group_id=101 "plugin_git:reference_commit_desc_key")) to help identify and retrieve corrupted data from a backup.
The tool works in 2 steps.

The first step is expected to be executed against the current production DB of a Tuleap instance. It will try to identify changeset values that might have been affected by the issue. It will output something looking like that:

```
$> /opt/remi/php82/root/usr/bin/php ./CVE-2024-30246_14490449103aee2.phar identify --dbhost=127.0.0.1 --dbname=tuleap --dbusername=tuleapadm --output-file=/path/to/write/suspected_changeset_values_document.json
Password for DB user 'tuleapadm':
Searching...
Maximum changeset_id = '20415'
Submission date of the last affected changeset: '2018-04-16T15:52:00+00:00'
Estimated date of update to Tuleap higher than 14.11 = '2023-09-07 07:13:50'
Submission date of the last affected changeset for complex fields: '2018-06-01T08:26:33+00:00'
Estimated date of update to Tuleap higher than 14.11 = '2023-09-07 07:13:50'
End of report

```

The second part of the tool will use the document that has been generated by the first one to generate SQL queries to fix the corrupted values. The second part of the tool must be executed against a restored backup of the DB. You will want to restore a backup around the indicated date of the 14.11 upgrade to restore corrupted values created before this date.

```
$> /opt/remi/php82/root/usr/bin/php ./CVE-2024-30246_0ab35aa8b09.phar retrieve --dbhost=127.0.0.1 --dbname=tuleap_backup --dbusername=tuleapadm --input-file=/path/to/suspected_changeset_values_document.json --output-file=/path/to/write/sql_queries.sql
Password for DB user 'tuleapadm':
Checking text fields...
Checking list fields...
Checking computed fields...
Checking float fields...
Checking int fields...
Checking date fields...
Checking file fields...
Checking openlist fields...
Checking artifact link fields...
Checking permissions on artifact fields...

```

The generated SQL file can then be applied on your current production DB.

---

* **Attachments** ~~CVE-2024-30246\_0ab35aa8b09.phar~~ added
![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-04-19 10:46

Adjusting the CVSS score with the additional details on the "permissions on artifact" field

---

* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
![User avatar](https://tuleap.net/users/gbonnefille/avatar-9ae894d39a155c14d299eec3a799d070877b9129cd4dfa6109026b54ce6ced9a.png)[Guilhem Bonnefille (CS) (gbonnefille)](/users/gbonnefille)2024-04-04 08:41

As a reminder, here is the script I imagined to retrieve lost data from a live MySQL backup, providing the missing Artifact Changeset as argument:

```
#!/bin/sh

#
# For authentication, set $MYSQL_PWD
#

CHANGESETS=`echo $* | tr ' ' ','`

IDS=`mysql -u tuleapadm -B -N -e "SELECT id FROM tracker_changeset_value WHERE changeset_id IN ($CHANGESETS)" tuleap | tr '\n' ',' | sed 's/,$//'`

for table in tracker_changeset_value_artifactlink tracker_changeset_value_computedfield_manual_value tracker_changeset_value_date tracker_changeset_value_file tracker_changeset_value_float tracker_changeset_value_int tracker_changeset_value_list tracker_changeset_value_openlist tracker_changeset_value_permissionsonartifact tracker_changeset_value_text
do
  mysqldump -u tuleapadm -y -n -t tuleap $table --where "changeset_value_id in ($IDS)"
done

```

![User avatar](https://tuleap.net/users/jmasson/avatar-6fd7cfc62428df447515eeadedf7bea16e9d93e717c093794ff0c53ddcd6b734.png)[Joris MASSON (jmasson)](/users/jmasson)2024-04-02 15:36

Added details on the impacts for the "Permissions on artifact" field.

---

* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
![User avatar](https://tuleap.net/users/jmasson/avatar-6fd7cfc62428df447515eeadedf7bea16e9d93e717c093794ff0c53ddcd6b734.png)[Joris MASSON (jmasson)](/users/jmasson)2024-03-29 17:38

Added "String" field type and added details for List field types

---

* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-03-29 17:37

* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-03-29 15:25

CVE-2024-30246 has been assigned to this issue.

---

* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-03-29 12:26

* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
![User avatar](https://tuleap.net/users/jmasson/avatar-6fd7cfc62428df447515eeadedf7bea16e9d93e717c093794ff0c53ddcd6b734.png)[Joris MASSON (jmasson)](/users/jmasson)2024-03-29 10:58

* **Status**  changed from Under review to Closed
* **Connected artifacts**
  + Added Fixed in: [rel #36797](https://tuleap.net/goto?key=rel&val=36797&group_id=101)
* **Close date** set to 2024-03-29
![User avatar](https://tuleap.net/users/gbonnefille/avatar-9ae894d39a155c14d299eec3a799d070877b9129cd4dfa6109026b54ce6ced9a.png)[Guilhem Bonnefille (CS) (gbonnefille)](/users/gbonnefille)2024-03-29 08:58

[@tgerbet](https://tuleap.net/users/tgerbet) it's OK for me.

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-03-29 08:35

Flagging this as an security issue since it impacts data integrity and there is at least one offensive scenario where a bad actor can exploit it to wreak havoc on purpose.

[@gbonnefille](https://tuleap.net/users/gbonnefille) Is it fine if we credit you and CS Group in the advisory?

![User avatar](https://tuleap.net/users/tgerbet/avatar-d5a7ff7a4f4ce5a22b3f6785bfb799b78c072e974420ef9b03e90c45d7438480.png)[Thomas Gerbet (tgerbet)](/users/tgerbet)2024-03-28 16:42

See [gerrit #30785](https://tuleap.net/goto?key=gerrit&val=30785&group_id=101 "gerrit")

---

* **Summary** -Deleting an artifact can delete values from unrelated ~~artifact~~Â +Deleting or moving an artifact can delete values from unrelated artifacts
* **Original Submission**
   Show diff

   Switch to markup diff

  Something went wrong, the follow up content couldn't be loaded

  Only formatting have been changed, you should switch to markup to see the changes
* **Status**  changed from Under implementation to Under review
![User avatar](https://tuleap.net/users/gbonnefille/avatar-9ae894d39a155c14d299eec3a799d070877b9129cd4dfa6109026b54ce6ced9a.png)[Guilhem Bonnefille (CS) (gbonnefille)](/users/gbonnefille)2024-03-28 16:34

Furthermore, as the deletion did not select the right elements, the database also contains orphans 'values'.
We can find them with:

```
SELECT * FROM tracker_changeset_value_all vv
WHERE NOT EXISTS (SELECT id FROM tracker_changeset_value v WHERE v.id = vv.changeset_value_id);

```

![User avatar](https://tuleap.net/users/gbonnefille/avatar-9ae894d39a155c14d299eec3a799d070877b9129cd4dfa6109026b54ce6ced9a.png)[Guilhem Bonnefille (CS) (gbonnefille)](/users/gbonnefille)2024-03-28 16:18
last edited by:
[Guilhem Bonnefille (CS) (gbonnefille)](/users/gbonnefille)
2024-03-28 16:24

It is possible to identify the affected changesets with the following SQL requests:

```
CREATE TEMPORARY TABLE tracker_changeset_value_all (PRIMARY KEY my_pkey (changeset_value_id)) SELECT * FROM (
SELECT changeset_value_id FROM
tracker_changeset_value_artifactlink
UNION
SELECT changeset_value_id FROM tracker_changeset_value_computedfield_manual_value
UNION
SELECT changeset_value_id FROM tracker_changeset_value_date UNION   SELECT changeset_value_id FROM tracker_changeset_value_file UNION   SELECT changeset_value_id FROM tracker_changeset_value_float
UNION
SELECT changeset_value_id FROM tracker_changeset_value_int UNION   SELECT changeset_value_id FROM tracker_changeset_value_list
UNION
SELECT changeset_value_id FROM tracker_changeset_value_openlist UNION   SELECT changeset_value_id FROM tracker_changeset_value_permissionsonartifact
UNION
SELECT changeset_value_id FROM tracker_changeset_value_text ) AS foo;

SELECT c.id, FROM_UNIXTIME(c.submitted_on), c.artifact_id, a.id, a.tracker_id, t.name, g.group_name FROM tracker_changeset c
LEFT JOIN tracker_artifact a ON c.artifact_id = a.id
LEFT JOIN tracker t ON t.id = a.tracker_id
LEFT JOIN groups g ON g.group_id = t.group_id
WHERE NOT EXISTS (SELECT cv.id FROM tracker_changeset_value cv WHERE c.id = cv.changeset_id AND EXISTS (SELECT * FROM tracker_changeset_value_all WHERE changeset_value_id = cv.id)) AND NOT EXISTS (SELECT * FROM tracker_changeset_comment cm WHERE c.id = cm.changeset_id) ;

```

