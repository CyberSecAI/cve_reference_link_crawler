=== Content from plugins.trac.wordpress.org_0e2fdfe8_20250110_143443.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3168605%2540all-in-one-wp-migration%26old%3D3168605%2540all-in-one-wp-migration)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3159417/all-in-one-wp-migration "Changeset 3159417 for all-in-one-wp-migration")
* [Next Change](/changeset/3168606/all-in-one-wp-migration "Changeset 3168606 for all-in-one-wp-migration") →

---

# Changeset [3168605](/changeset/3168605 "Show full changeset") for [all-in-one-wp-migration](/browser/all-in-one-wp-migration?rev=3168605 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/14/2024 01:28:46 PM
([3 months](/timeline?from=2024-10-14T13%3A28%3A46Z&precision=second "See timeline at 10/14/2024 01:28:46 PM") ago)

Author:
bangelov
Message:

Adding v7.87 to trunk

Location:
[all-in-one-wp-migration/trunk](/browser/all-in-one-wp-migration/trunk?rev=3168605)
Files:

5 deleted
14 edited

* [all-in-one-wp-migration.php](/browser/all-in-one-wp-migration/trunk/all-in-one-wp-migration.php?rev=3168605 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [constants.php](/browser/all-in-one-wp-migration/trunk/constants.php?rev=3168605 "Show entry in browser")
  (modified)
  ([3 diffs](#file1 "Show differences"))
* [functions.php](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3168605 "Show entry in browser")
  (modified)
  ([6 diffs](#file2 "Show differences"))
* [lib/controller/class-ai1wm-export-controller.php](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php?rev=3168605 "Show entry in browser")
  (modified)
  ([5 diffs](#file3 "Show differences"))
* [lib/controller/class-ai1wm-import-controller.php](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-import-controller.php?rev=3168605 "Show entry in browser")
  (modified)
  ([4 diffs](#file4 "Show differences"))
* [lib/controller/class-ai1wm-main-controller.php](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3168605 "Show entry in browser")
  (modified)
  ([8 diffs](#file5 "Show differences"))
* [lib/model/class-ai1wm-handler.php](/browser/all-in-one-wp-migration/trunk/lib/model/class-ai1wm-handler.php?rev=3168605 "Show entry in browser")
  (modified)
  ([2 diffs](#file6 "Show differences"))
* [lib/model/class-ai1wm-log.php](/browser/all-in-one-wp-migration/trunk/lib/model/class-ai1wm-log.php?rev=3168605 "Show entry in browser")
  (modified)
  ([2 diffs](#file7 "Show differences"))
* [lib/model/export/class-ai1wm-export-config-file.php](/browser/all-in-one-wp-migration/trunk/lib/model/export/class-ai1wm-export-config-file.php?rev=3168605 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [lib/view/assets/img/reset/database.png](/browser/all-in-one-wp-migration/trunk/lib/view/assets/img/reset/database.png?rev=3045858 "Show what was removed (content at revision 3168604)")
  (deleted)
* [lib/view/assets/img/reset/media-files.png](/browser/all-in-one-wp-migration/trunk/lib/view/assets/img/reset/media-files.png?rev=3045858 "Show what was removed (content at revision 3168604)")
  (deleted)
* [lib/view/assets/img/reset/plugins.png](/browser/all-in-one-wp-migration/trunk/lib/view/assets/img/reset/plugins.png?rev=3045858 "Show what was removed (content at revision 3168604)")
  (deleted)
* [lib/view/assets/img/reset/reset-all.png](/browser/all-in-one-wp-migration/trunk/lib/view/assets/img/reset/reset-all.png?rev=3045858 "Show what was removed (content at revision 3168604)")
  (deleted)
* [lib/view/assets/img/reset/themes.png](/browser/all-in-one-wp-migration/trunk/lib/view/assets/img/reset/themes.png?rev=3045858 "Show what was removed (content at revision 3168604)")
  (deleted)
* [lib/view/assets/javascript/backups.min.js](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605 "Show entry in browser")
  (modified)
  ([19 diffs](#file14 "Show differences"))
* [lib/view/assets/javascript/export.min.js](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3168605 "Show entry in browser")
  (modified)
  ([7 diffs](#file15 "Show differences"))
* [lib/view/assets/javascript/import.min.js](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3168605 "Show entry in browser")
  (modified)
  ([12 diffs](#file16 "Show differences"))
* [lib/view/assets/javascript/util.min.js](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/util.min.js?rev=3168605 "Show entry in browser")
  (modified)
  ([1 diff](#file17 "Show differences"))
* [readme.txt](/browser/all-in-one-wp-migration/trunk/readme.txt?rev=3168605 "Show entry in browser")
  (modified)
  ([2 diffs](#file18 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [all-in-one-wp-migration/trunk/all-in-one-wp-migration.php](/changeset/3168605/all-in-one-wp-migration/trunk/all-in-one-wp-migration.php "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/all-in-one-wp-migration.php")

  | [r3134502](/browser/all-in-one-wp-migration/trunk/all-in-one-wp-migration.php?rev=3134502#L6 "Show revision 3134502 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/all-in-one-wp-migration.php?rev=3168605#L6 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* Author: ServMask |
  | 7 | 7 | \* Author URI: https://servmask.com/ |
  | 8 |  | \* Version: 7.8~~6~~ |
  |  | 8 | \* Version: 7.87 |
  | 9 | 9 | \* Text Domain: all-in-one-wp-migration |
  | 10 | 10 | \* Domain Path: /languages |
* ## [all-in-one-wp-migration/trunk/constants.php](/changeset/3168605/all-in-one-wp-migration/trunk/constants.php "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/constants.php")

  | [r3134502](/browser/all-in-one-wp-migration/trunk/constants.php?rev=3134502#L36 "Show revision 3134502 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/constants.php?rev=3168605#L36 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 36 | 36 | // = Plugin Version = |
  | 37 | 37 | // ================== |
  | 38 |  | define( 'AI1WM\_VERSION', '7.8~~6~~' ); |
  |  | 38 | define( 'AI1WM\_VERSION', '7.87' ); |
  | 39 | 39 |  |
  | 40 | 40 | // =============== |
  | […](/browser/all-in-one-wp-migration/trunk/constants.php?rev=3134502#L301) | […](/browser/all-in-one-wp-migration/trunk/constants.php?rev=3168605#L301) |  |
  | 301 | 301 | // = Error Log Name = |
  | 302 | 302 | // ================== |
  | 303 |  | define( 'AI1WM\_ERROR\_NAME', 'error.log' ); |
  |  | 303 | define( 'AI1WM\_ERROR\_NAME', 'error-log-%s.log' ); |
  | 304 | 304 |  |
  | 305 | 305 | // ============== |
  | […](/browser/all-in-one-wp-migration/trunk/constants.php?rev=3134502#L472) | […](/browser/all-in-one-wp-migration/trunk/constants.php?rev=3168605#L472) |  |
  | 472 | 472 | define( 'AI1WM\_MAX\_STORAGE\_CLEANUP', 24 \* 60 \* 60 ); |
  | 473 | 473 |  |
  |  | 474 | // =================== |
  |  | 475 | // = Max Log Cleanup = |
  |  | 476 | // =================== |
  |  | 477 | define( 'AI1WM\_MAX\_LOG\_CLEANUP', 7 \* 24 \* 60 \* 60 ); |
  |  | 478 |  |
  | 474 | 479 | // ===================== |
  | 475 | 480 | // = Disk Space Factor = |
* ## [all-in-one-wp-migration/trunk/functions.php](/changeset/3168605/all-in-one-wp-migration/trunk/functions.php "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/functions.php")

  | [r3099274](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3099274#L67 "Show revision 3099274 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3168605#L67 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 67 | 67 | if ( ai1wm\_validate\_file( $params['archive'] ) !== 0 ) { |
  | 68 | 68 | throw new Ai1wm\_Archive\_Exception( \_\_( 'Your archive file name contains invalid characters. It cannot contain: < > : " | ? \* \0. <a href="https://help.servmask.com/knowledgebase/invalid-archive-name/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ) ); |
  |  | 69 | } |
  |  | 70 |  |
  |  | 71 | // Validate file extension |
  |  | 72 | if ( ! ai1wm\_is\_filename\_supported( $params['archive'] ) ) { |
  |  | 73 | throw new Ai1wm\_Archive\_Exception( \_\_( 'Invalid archive file type. Only .wpress files are allowed. <a href="https://help.servmask.com/knowledgebase/invalid-file-type/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ) ); |
  | 69 | 74 | } |
  | 70 | 75 |  |
  | […](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3099274#L111) | […](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3168605#L116) |  |
  | 111 | 116 | } |
  | 112 | 117 |  |
  |  | 118 | // Validate file extension |
  |  | 119 | if ( ! ai1wm\_is\_filename\_supported( $params['archive'] ) ) { |
  |  | 120 | throw new Ai1wm\_Archive\_Exception( \_\_( 'Invalid archive file type. Only .wpress files are allowed. <a href="https://help.servmask.com/knowledgebase/invalid-file-type/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ) ); |
  |  | 121 | } |
  |  | 122 |  |
  | 113 | 123 | // Get archive path |
  | 114 | 124 | if ( empty( $params['ai1wm\_manual\_restore'] ) ) { |
  | […](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3099274#L292) | […](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3168605#L302) |  |
  | 292 | 302 | \* Get error log absolute path |
  | 293 | 303 | \* |
  | 294 |  | \* @return string |
  | 295 |  | \*/ |
  | 296 |  | function ai1wm\_error\_path() { |
  | 297 |  | return AI1WM\_STORAGE\_PATH . DIRECTORY\_SEPARATOR . AI1WM\_ERROR\_NAME; |
  |  | 304 | \* @param  string $nonce Log nonce |
  |  | 305 | \* @return string |
  |  | 306 | \*/ |
  |  | 307 | function ai1wm\_error\_path( $nonce ) { |
  |  | 308 | return AI1WM\_STORAGE\_PATH . DIRECTORY\_SEPARATOR . sprintf( AI1WM\_ERROR\_NAME, $nonce ); |
  | 298 | 309 | } |
  | 299 | 310 |  |
  | […](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3099274#L499) | […](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3168605#L510) |  |
  | 499 | 510 |  |
  | 500 | 511 | // Add unique identifier |
  | 501 |  | $name[] = ai1wm\_generate\_random\_string( ~~6~~, false ); |
  |  | 512 | $name[] = ai1wm\_generate\_random\_string( 12, false ); |
  | 502 | 513 |  |
  | 503 | 514 | return sprintf( '%s.wpress', strtolower( implode( '-', $name ) ) ); |
  | […](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3099274#L948) | […](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3168605#L959) |  |
  | 948 | 959 | ) |
  | 949 | 960 | ); |
  | 950 |  |  |
  | 951 |  | ~~return $filters;~~ |
  | 952 | 961 | } |
  | 953 | 962 |  |
  | […](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3099274#L1751) | […](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3168605#L1760) |  |
  | 1751 | 1760 | @ob\_end\_clean(); |
  | 1752 | 1761 | } |
  | 1753 |  |  |
  | 1754 |  | // Set error handler |
  |  | 1762 | } |
  |  | 1763 |  |
  |  | 1764 | /\*\* |
  |  | 1765 | \* PHP register error handlers |
  |  | 1766 | \* |
  |  | 1767 | \* @return void |
  |  | 1768 | \*/ |
  |  | 1769 | function ai1wm\_setup\_errors() { |
  | 1755 | 1770 | @set\_error\_handler( 'Ai1wm\_Handler::error' ); |
  | 1756 |  |  |
  | 1757 |  | ~~// Set shutdown handler~~ |
  | 1758 | 1771 | @register\_shutdown\_function( 'Ai1wm\_Handler::shutdown' ); |
  | 1759 | 1772 | } |
* ## [all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php](/changeset/3168605/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php")

  | [r3112499](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php?rev=3112499#L36 "Show revision 3112499 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php?rev=3168605#L36 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 36 | 36 | public static function export( $params = array() ) { |
  | 37 | 37 | global $ai1wm\_params; |
  | 38 |  | ~~ai1wm\_setup\_environment();~~ |
  | 39 | 38 |  |
  | 40 | 39 | // Set params |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php?rev=3112499#L47) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php?rev=3168605#L46) |  |
  | 47 | 46 | $params['priority'] = 5; |
  | 48 | 47 | } |
  |  | 48 |  |
  |  | 49 | $ai1wm\_params = $params; |
  | 49 | 50 |  |
  | 50 | 51 | // Set secret key |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php?rev=3112499#L53) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php?rev=3168605#L54) |  |
  | 53 | 54 | $secret\_key = trim( $params['secret\_key'] ); |
  | 54 | 55 | } |
  |  | 56 |  |
  |  | 57 | ai1wm\_setup\_environment(); |
  |  | 58 | ai1wm\_setup\_errors(); |
  | 55 | 59 |  |
  | 56 | 60 | try { |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php?rev=3112499#L60) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php?rev=3168605#L64) |  |
  | 60 | 64 | exit; |
  | 61 | 65 | } |
  | 62 |  |  |
  | 63 |  | ~~$ai1wm\_params = $params;~~ |
  | 64 | 66 |  |
  | 65 | 67 | // Loop over filters |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php?rev=3112499#L267) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-export-controller.php?rev=3168605#L269) |  |
  | 267 | 269 | foreach ( $iterator as $item ) { |
  | 268 | 270 | try { |
  | 269 |  | if ( $item->getMTime() < ( time() - AI1WM\_MAX\_STORAGE\_CLEANUP ) ) { |
  |  | 271 | if ( $item->isFile() && $item->getExtension() === 'log' ) { |
  |  | 272 | if ( $item->getMTime() < ( time() - AI1WM\_MAX\_LOG\_CLEANUP ) ) { |
  |  | 273 | Ai1wm\_File::delete( $item->getPathname() ); |
  |  | 274 | } |
  |  | 275 | } elseif ( $item->getMTime() < ( time() - AI1WM\_MAX\_STORAGE\_CLEANUP ) ) { |
  | 270 | 276 | if ( $item->isDir() ) { |
  | 271 | 277 | Ai1wm\_Directory::delete( $item->getPathname() ); |
* ## [all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-import-controller.php](/changeset/3168605/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-import-controller.php "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-import-controller.php")

  | [r3112499](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-import-controller.php?rev=3112499#L36 "Show revision 3112499 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-import-controller.php?rev=3168605#L36 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 36 | 36 | public static function import( $params = array() ) { |
  | 37 | 37 | global $ai1wm\_params; |
  | 38 |  | ~~ai1wm\_setup\_environment();~~ |
  | 39 | 38 |  |
  | 40 | 39 | // Set params |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-import-controller.php?rev=3112499#L47) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-import-controller.php?rev=3168605#L46) |  |
  | 47 | 46 | $params['priority'] = 10; |
  | 48 | 47 | } |
  |  | 48 |  |
  |  | 49 | $ai1wm\_params = $params; |
  | 49 | 50 |  |
  | 50 | 51 | // Set secret key |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-import-controller.php?rev=3112499#L53) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-import-controller.php?rev=3168605#L54) |  |
  | 53 | 54 | $secret\_key = trim( $params['secret\_key'] ); |
  | 54 | 55 | } |
  |  | 56 |  |
  |  | 57 | ai1wm\_setup\_environment(); |
  |  | 58 | ai1wm\_setup\_errors(); |
  | 55 | 59 |  |
  | 56 | 60 | try { |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-import-controller.php?rev=3112499#L60) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-import-controller.php?rev=3168605#L64) |  |
  | 60 | 64 | exit; |
  | 61 | 65 | } |
  | 62 |  |  |
  | 63 |  | ~~$ai1wm\_params = $params;~~ |
  | 64 | 66 |  |
  | 65 | 67 | // Loop over filters |
* ## [all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php](/changeset/3168605/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php")

  | [r3112499](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3112499#L795 "Show revision 3112499 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3168605#L795 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 795 | 795 | 'url' => wp\_make\_link\_relative( add\_query\_arg( array( 'ai1wm\_import' => 1, 'secret\_key' => get\_option( AI1WM\_SECRET\_KEY ) ), admin\_url( 'admin-ajax.php?action=ai1wm\_status' ) ) ), |
  | 796 | 796 | ), |
  |  | 797 | 'storage'    => array( |
  |  | 798 | 'url' => AI1WM\_STORAGE\_URL, |
  |  | 799 | ), |
  |  | 800 | 'error\_log'  => array( |
  |  | 801 | 'pattern' => AI1WM\_ERROR\_NAME, |
  |  | 802 | ), |
  | 797 | 803 | 'secret\_key' => get\_option( AI1WM\_SECRET\_KEY ), |
  | 798 | 804 | ) |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3112499#L819) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3168605#L825) |  |
  | 819 | 825 | 'backups\_count\_plural'                => \_\_( 'You have %d backups', AI1WM\_PLUGIN\_NAME ), |
  | 820 | 826 | 'archive\_browser\_download\_error'      => \_\_( 'Error while downloading file', AI1WM\_PLUGIN\_NAME ), |
  |  | 827 | 'view\_error\_log\_button'               => \_\_( 'View Error Log', AI1WM\_PLUGIN\_NAME ), |
  | 821 | 828 | ) |
  | 822 | 829 | ); |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3112499#L891) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3168605#L898) |  |
  | 891 | 898 | 'status'     => array( |
  | 892 | 899 | 'url' => wp\_make\_link\_relative( add\_query\_arg( array( 'ai1wm\_import' => 1, 'secret\_key' => get\_option( AI1WM\_SECRET\_KEY ) ), admin\_url( 'admin-ajax.php?action=ai1wm\_status' ) ) ), |
  |  | 900 | ), |
  |  | 901 | 'storage'    => array( |
  |  | 902 | 'url' => AI1WM\_STORAGE\_URL, |
  |  | 903 | ), |
  |  | 904 | 'error\_log'  => array( |
  |  | 905 | 'pattern' => AI1WM\_ERROR\_NAME, |
  | 893 | 906 | ), |
  | 894 | 907 | 'secret\_key' => get\_option( AI1WM\_SECRET\_KEY ), |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3112499#L944) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3168605#L957) |  |
  | 944 | 957 | 'repeat\_password'                     => \_\_( 'Repeat the password', AI1WM\_PLUGIN\_NAME ), |
  | 945 | 958 | 'passwords\_do\_not\_match'              => \_\_( 'The passwords do not match', AI1WM\_PLUGIN\_NAME ), |
  |  | 959 | 'view\_error\_log\_button'               => \_\_( 'View Error Log', AI1WM\_PLUGIN\_NAME ), |
  | 946 | 960 | 'import\_from\_file'                    => sprintf( |
  | 947 | 961 | \_\_( |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3112499#L1039) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3168605#L1053) |  |
  | 1039 | 1053 | 'url' => wp\_make\_link\_relative( add\_query\_arg( array( 'ai1wm\_import' => 1, 'secret\_key' => get\_option( AI1WM\_SECRET\_KEY ) ), admin\_url( 'admin-ajax.php?action=ai1wm\_status' ) ) ), |
  | 1040 | 1054 | ), |
  |  | 1055 | 'storage'    => array( |
  |  | 1056 | 'url' => AI1WM\_STORAGE\_URL, |
  |  | 1057 | ), |
  |  | 1058 | 'error\_log'  => array( |
  |  | 1059 | 'pattern' => AI1WM\_ERROR\_NAME, |
  |  | 1060 | ), |
  | 1041 | 1061 | 'secret\_key' => get\_option( AI1WM\_SECRET\_KEY ), |
  | 1042 | 1062 | ) |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3112499#L1052) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3168605#L1072) |  |
  | 1052 | 1072 | 'status'     => array( |
  | 1053 | 1073 | 'url' => wp\_make\_link\_relative( add\_query\_arg( array( 'ai1wm\_import' => 1, 'secret\_key' => get\_option( AI1WM\_SECRET\_KEY ) ), admin\_url( 'admin-ajax.php?action=ai1wm\_status' ) ) ), |
  |  | 1074 | ), |
  |  | 1075 | 'storage'    => array( |
  |  | 1076 | 'url' => AI1WM\_STORAGE\_URL, |
  |  | 1077 | ), |
  |  | 1078 | 'error\_log'  => array( |
  |  | 1079 | 'pattern' => AI1WM\_ERROR\_NAME, |
  | 1054 | 1080 | ), |
  | 1055 | 1081 | 'secret\_key' => get\_option( AI1WM\_SECRET\_KEY ), |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3112499#L1143) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3168605#L1169) |  |
  | 1143 | 1169 | 'repeat\_password'                     => \_\_( 'Repeat the password', AI1WM\_PLUGIN\_NAME ), |
  | 1144 | 1170 | 'passwords\_do\_not\_match'              => \_\_( 'The passwords do not match', AI1WM\_PLUGIN\_NAME ), |
  | 1145 |  |  |
  |  | 1171 | 'view\_error\_log\_button'               => \_\_( 'View Error Log', AI1WM\_PLUGIN\_NAME ), |
  | 1146 | 1172 | ) |
  | 1147 | 1173 | ); |
  | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3112499#L1287) | […](/browser/all-in-one-wp-migration/trunk/lib/controller/class-ai1wm-main-controller.php?rev=3168605#L1313) |  |
  | 1287 | 1313 | \*/ |
  | 1288 | 1314 | public function init() { |
  | 1289 |  | $user  = false; |
  | 1290 |  | $password = false; |
  |  | 1315 | $user = $password = false; |
  |  | 1316 |  |
  | 1291 | 1317 | // Set username |
  | 1292 | 1318 | if ( isset( $\_SERVER['PHP\_AUTH\_USER'] ) ) { |
* ## [all-in-one-wp-migration/trunk/lib/model/class-ai1wm-handler.php](/changeset/3168605/all-in-one-wp-migration/trunk/lib/model/class-ai1wm-handler.php "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/lib/model/class-ai1wm-handler.php")

  | [r3038703](/browser/all-in-one-wp-migration/trunk/lib/model/class-ai1wm-handler.php?rev=3038703#L40 "Show revision 3038703 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/lib/model/class-ai1wm-handler.php?rev=3168605#L40 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 40 | 40 | \*/ |
  | 41 | 41 | public static function error( $errno, $errstr, $errfile, $errline ) { |
  | 42 |  | Ai1wm\_Log::error( |
  | 43 |  | array( |
  | 44 |  | 'Number'  => $errno, |
  | 45 |  | 'Message' => $errstr, |
  | 46 |  | 'File'    => $errfile, |
  | 47 |  | 'Line'    => $errline, |
  | 48 |  | ) |
  | 49 |  | ); |
  |  | 42 | global $ai1wm\_params; |
  |  | 43 | if ( ! empty( $ai1wm\_params['storage'] ) ) { |
  |  | 44 | Ai1wm\_Log::error( $ai1wm\_params['storage'], array( 'Number' => $errno, 'Message' => $errstr, 'File' => $errfile, 'Line' => $errline ) ); |
  |  | 45 | } |
  | 50 | 46 | } |
  | 51 | 47 |  |
  | […](/browser/all-in-one-wp-migration/trunk/lib/model/class-ai1wm-handler.php?rev=3038703#L56) | […](/browser/all-in-one-wp-migration/trunk/lib/model/class-ai1wm-handler.php?rev=3168605#L52) |  |
  | 56 | 52 | \*/ |
  | 57 | 53 | public static function shutdown() { |
  | 58 |  | if ( ( $error = error\_get\_last() ) ) { |
  | 59 |  | Ai1wm\_Log::error( $error ); |
  |  | 54 | global $ai1wm\_params; |
  |  | 55 | if ( ! empty( $ai1wm\_params['storage'] ) ) { |
  |  | 56 | if ( ( $error = error\_get\_last() ) ) { |
  |  | 57 | Ai1wm\_Log::error( $ai1wm\_params['storage'], $error ); |
  |  | 58 | } |
  | 60 | 59 | } |
  | 61 | 60 | } |
* ## [all-in-one-wp-migration/trunk/lib/model/class-ai1wm-log.php](/changeset/3168605/all-in-one-wp-migration/trunk/lib/model/class-ai1wm-log.php "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/lib/model/class-ai1wm-log.php")

  | [r3038703](/browser/all-in-one-wp-migration/trunk/lib/model/class-ai1wm-log.php?rev=3038703#L30 "Show revision 3038703 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/lib/model/class-ai1wm-log.php?rev=3168605#L30 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 30 | 30 | class Ai1wm\_Log { |
  | 31 | 31 |  |
  | 32 |  | public static function error( $params ) { |
  |  | 32 | public static function error( $nonce, $params ) { |
  | 33 | 33 | $data = array(); |
  | 34 | 34 |  |
  | […](/browser/all-in-one-wp-migration/trunk/lib/model/class-ai1wm-log.php?rev=3038703#L43) | […](/browser/all-in-one-wp-migration/trunk/lib/model/class-ai1wm-log.php?rev=3168605#L43) |  |
  | 43 | 43 |  |
  | 44 | 44 | // Write log data |
  | 45 |  | if ( $handle = ai1wm\_open( ai1wm\_error\_path(), 'a' ) ) { |
  |  | 45 | if ( $handle = ai1wm\_open( ai1wm\_error\_path( $nonce ), 'a' ) ) { |
  | 46 | 46 | ai1wm\_write( $handle, implode( PHP\_EOL, $data ) ); |
  | 47 | 47 | ai1wm\_close( $handle ); |
* ## [all-in-one-wp-migration/trunk/lib/model/export/class-ai1wm-export-config-file.php](/changeset/3168605/all-in-one-wp-migration/trunk/lib/model/export/class-ai1wm-export-config-file.php "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/lib/model/export/class-ai1wm-export-config-file.php")

  | [r3038703](/browser/all-in-one-wp-migration/trunk/lib/model/export/class-ai1wm-export-config-file.php?rev=3038703#L31 "Show revision 3038703 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/lib/model/export/class-ai1wm-export-config-file.php?rev=3168605#L31 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 31 | 31 |  |
  | 32 | 32 | public static function execute( $params ) { |
  | 33 |  |  |
  | 34 | 33 | $package\_bytes\_written = 0; |
  | 35 | 34 |  |
* ## [all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js](/changeset/3168605/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js")

  | [r3112499](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L149 "Show revision 3112499 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L149 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 149 | 149 | type: 'error', |
  | 150 | 150 | title: ai1wm\_locale.unable\_to\_export, |
  | 151 |  | message: error.message |
  |  | 151 | message: error.message, |
  |  | 152 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 152 | 153 | }); |
  | 153 | 154 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L161) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L162) |  |
  | 161 | 162 | type: 'error', |
  | 162 | 163 | title: ai1wm\_locale.unable\_to\_export, |
  | 163 |  | message: ai1wm\_locale.unable\_to\_start\_the\_export |
  |  | 164 | message: ai1wm\_locale.unable\_to\_start\_the\_export, |
  |  | 165 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 164 | 166 | }); |
  | 165 | 167 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L207) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L209) |  |
  | 207 | 209 | type: 'error', |
  | 208 | 210 | title: ai1wm\_locale.unable\_to\_export, |
  | 209 |  | message: error.message |
  |  | 211 | message: error.message, |
  |  | 212 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 210 | 213 | }); |
  | 211 | 214 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L219) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L222) |  |
  | 219 | 222 | type: 'error', |
  | 220 | 223 | title: ai1wm\_locale.unable\_to\_export, |
  | 221 |  | message: ai1wm\_locale.unable\_to\_run\_the\_export |
  |  | 224 | message: ai1wm\_locale.unable\_to\_run\_the\_export, |
  |  | 225 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 222 | 226 | }); |
  | 223 | 227 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L287) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L291) |  |
  | 287 | 291 | type: 'error', |
  | 288 | 292 | title: ai1wm\_locale.unable\_to\_export, |
  | 289 |  | message: error.message |
  |  | 293 | message: error.message, |
  |  | 294 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 290 | 295 | }); |
  | 291 | 296 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L299) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L304) |  |
  | 299 | 304 | type: 'error', |
  | 300 | 305 | title: ai1wm\_locale.unable\_to\_export, |
  | 301 |  | message: ai1wm\_locale.unable\_to\_stop\_the\_export |
  |  | 306 | message: ai1wm\_locale.unable\_to\_stop\_the\_export, |
  |  | 307 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 302 | 308 | }); |
  | 303 | 309 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L427) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L433) |  |
  | 427 | 433 | header.append(title); // Append header and message to section |
  | 428 | 434 |  |
  | 429 |  | section.append(header).append(message); // Append section and action to container |
  |  | 435 | section.append(header).append(message); // Create view log button |
  |  | 436 |  |
  |  | 437 | if (params.nonce) { |
  |  | 438 | var logButton = $('<a target="\_blank"></a>'); |
  |  | 439 | logButton.text(ai1wm\_locale.view\_error\_log\_button); |
  |  | 440 | logButton.prop('href', ai1wm\_export.storage.url + '/' + ai1wm\_export.error\_log.pattern.replace('%s', params.nonce)); |
  |  | 441 | section.append($('<div></div>').append(logButton)); |
  |  | 442 | } // Append section and action to container |
  |  | 443 |  |
  | 430 | 444 |  |
  | 431 | 445 | container.append(section).append(action); // Render modal |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L714) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L728) |  |
  | 714 | 728 | type: 'error', |
  | 715 | 729 | title: ai1wm\_locale.unable\_to\_import, |
  | 716 |  | message: error.message |
  |  | 730 | message: error.message, |
  |  | 731 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 717 | 732 | }); |
  | 718 | 733 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L726) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L741) |  |
  | 726 | 741 | type: 'error', |
  | 727 | 742 | title: ai1wm\_locale.unable\_to\_import, |
  | 728 |  | message: ai1wm\_locale.unable\_to\_start\_the\_import |
  |  | 743 | message: ai1wm\_locale.unable\_to\_start\_the\_import, |
  |  | 744 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 729 | 745 | }); |
  | 730 | 746 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L772) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L788) |  |
  | 772 | 788 | type: 'error', |
  | 773 | 789 | title: ai1wm\_locale.unable\_to\_import, |
  | 774 |  | message: error.message |
  |  | 790 | message: error.message, |
  |  | 791 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 775 | 792 | }); |
  | 776 | 793 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L833) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L850) |  |
  | 833 | 850 | type: 'error', |
  | 834 | 851 | title: ai1wm\_locale.unable\_to\_import, |
  | 835 |  | message: error.message |
  |  | 852 | message: error.message, |
  |  | 853 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 836 | 854 | }); |
  | 837 | 855 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L845) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L863) |  |
  | 845 | 863 | type: 'error', |
  | 846 | 864 | title: ai1wm\_locale.unable\_to\_import, |
  | 847 |  | message: ai1wm\_locale.unable\_to\_check\_decryption\_password |
  |  | 865 | message: ai1wm\_locale.unable\_to\_check\_decryption\_password, |
  |  | 866 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 848 | 867 | }); |
  | 849 | 868 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L906) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L925) |  |
  | 906 | 925 | type: 'error', |
  | 907 | 926 | title: ai1wm\_locale.unable\_to\_import, |
  | 908 |  | message: error.message |
  |  | 927 | message: error.message, |
  |  | 928 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 909 | 929 | }); |
  | 910 | 930 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L918) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L938) |  |
  | 918 | 938 | type: 'error', |
  | 919 | 939 | title: ai1wm\_locale.unable\_to\_import, |
  | 920 |  | message: ai1wm\_locale.unable\_to\_confirm\_the\_import |
  |  | 940 | message: ai1wm\_locale.unable\_to\_confirm\_the\_import, |
  |  | 941 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 921 | 942 | }); |
  | 922 | 943 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L1000) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L1021) |  |
  | 1000 | 1021 | type: 'error', |
  | 1001 | 1022 | title: ai1wm\_locale.unable\_to\_import, |
  | 1002 |  | message: error.message |
  |  | 1023 | message: error.message, |
  |  | 1024 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 1003 | 1025 | }); |
  | 1004 | 1026 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L1012) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L1034) |  |
  | 1012 | 1034 | type: 'error', |
  | 1013 | 1035 | title: ai1wm\_locale.unable\_to\_import, |
  | 1014 |  | message: ai1wm\_locale.unable\_to\_prepare\_blogs\_on\_import |
  |  | 1036 | message: ai1wm\_locale.unable\_to\_prepare\_blogs\_on\_import, |
  |  | 1037 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 1015 | 1038 | }); |
  | 1016 | 1039 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L1077) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L1100) |  |
  | 1077 | 1100 | type: 'error', |
  | 1078 | 1101 | title: ai1wm\_locale.unable\_to\_import, |
  | 1079 |  | message: error.message |
  |  | 1102 | message: error.message, |
  |  | 1103 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 1080 | 1104 | }); |
  | 1081 | 1105 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L1089) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L1113) |  |
  | 1089 | 1113 | type: 'error', |
  | 1090 | 1114 | title: ai1wm\_locale.unable\_to\_import, |
  | 1091 |  | message: ai1wm\_locale.unable\_to\_stop\_the\_import |
  |  | 1115 | message: ai1wm\_locale.unable\_to\_stop\_the\_import, |
  |  | 1116 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 1092 | 1117 | }); |
  | 1093 | 1118 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3112499#L1238) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/backups.min.js?rev=3168605#L1263) |  |
  | 1238 | 1263 | header.append(title); // Append header and message to section |
  | 1239 | 1264 |  |
  | 1240 |  | section.append(header).append(message); // Append section and action to container |
  |  | 1265 | section.append(header).append(message); // Create view log button |
  |  | 1266 |  |
  |  | 1267 | if (params.nonce) { |
  |  | 1268 | var logButton = $('<a target="\_blank"></a>'); |
  |  | 1269 | logButton.text(ai1wm\_locale.view\_error\_log\_button); |
  |  | 1270 | logButton.prop('href', ai1wm\_export.storage.url + '/' + ai1wm\_export.error\_log.pattern.replace('%s', params.nonce)); |
  |  | 1271 | section.append($('<div></div>').append(logButton)); |
  |  | 1272 | } // Append section and action to container |
  |  | 1273 |  |
  | 1241 | 1274 |  |
  | 1242 | 1275 | container.append(section).append(action); // Render modal |
* ## [all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js](/changeset/3168605/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js")

  | [r3112499](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3112499#L109 "Show revision 3112499 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3168605#L109 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 109 | 109 | type: 'error', |
  | 110 | 110 | title: ai1wm\_locale.unable\_to\_export, |
  | 111 |  | message: error.message |
  |  | 111 | message: error.message, |
  |  | 112 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 112 | 113 | }); |
  | 113 | 114 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3112499#L121) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3168605#L122) |  |
  | 121 | 122 | type: 'error', |
  | 122 | 123 | title: ai1wm\_locale.unable\_to\_export, |
  | 123 |  | message: ai1wm\_locale.unable\_to\_start\_the\_export |
  |  | 124 | message: ai1wm\_locale.unable\_to\_start\_the\_export, |
  |  | 125 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 124 | 126 | }); |
  | 125 | 127 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3112499#L167) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3168605#L169) |  |
  | 167 | 169 | type: 'error', |
  | 168 | 170 | title: ai1wm\_locale.unable\_to\_export, |
  | 169 |  | message: error.message |
  |  | 171 | message: error.message, |
  |  | 172 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 170 | 173 | }); |
  | 171 | 174 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3112499#L179) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3168605#L182) |  |
  | 179 | 182 | type: 'error', |
  | 180 | 183 | title: ai1wm\_locale.unable\_to\_export, |
  | 181 |  | message: ai1wm\_locale.unable\_to\_run\_the\_export |
  |  | 184 | message: ai1wm\_locale.unable\_to\_run\_the\_export, |
  |  | 185 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 182 | 186 | }); |
  | 183 | 187 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3112499#L247) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3168605#L251) |  |
  | 247 | 251 | type: 'error', |
  | 248 | 252 | title: ai1wm\_locale.unable\_to\_export, |
  | 249 |  | message: error.message |
  |  | 253 | message: error.message, |
  |  | 254 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 250 | 255 | }); |
  | 251 | 256 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3112499#L259) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3168605#L264) |  |
  | 259 | 264 | type: 'error', |
  | 260 | 265 | title: ai1wm\_locale.unable\_to\_export, |
  | 261 |  | message: ai1wm\_locale.unable\_to\_stop\_the\_export |
  |  | 266 | message: ai1wm\_locale.unable\_to\_stop\_the\_export, |
  |  | 267 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 262 | 268 | }); |
  | 263 | 269 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3112499#L387) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/export.min.js?rev=3168605#L393) |  |
  | 387 | 393 | header.append(title); // Append header and message to section |
  | 388 | 394 |  |
  | 389 |  | section.append(header).append(message); // Append section and action to container |
  |  | 395 | section.append(header).append(message); // Create view log button |
  |  | 396 |  |
  |  | 397 | if (params.nonce) { |
  |  | 398 | var logButton = $('<a target="\_blank"></a>'); |
  |  | 399 | logButton.text(ai1wm\_locale.view\_error\_log\_button); |
  |  | 400 | logButton.prop('href', ai1wm\_export.storage.url + '/' + ai1wm\_export.error\_log.pattern.replace('%s', params.nonce)); |
  |  | 401 | section.append($('<div></div>').append(logButton)); |
  |  | 402 | } // Append section and action to container |
  |  | 403 |  |
  | 390 | 404 |  |
  | 391 | 405 | container.append(section).append(action); // Render modal |
* ## [all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js](/changeset/3168605/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js")

  | [r3112499](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3112499#L133 "Show revision 3112499 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3168605#L133 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 133 | 133 | type: 'error', |
  | 134 | 134 | title: ai1wm\_locale.unable\_to\_import, |
  | 135 |  | message: error.message |
  |  | 135 | message: error.message, |
  |  | 136 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 136 | 137 | }); |
  | 137 | 138 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3112499#L145) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3168605#L146) |  |
  | 145 | 146 | type: 'error', |
  | 146 | 147 | title: ai1wm\_locale.unable\_to\_import, |
  | 147 |  | message: ai1wm\_locale.unable\_to\_start\_the\_import |
  |  | 148 | message: ai1wm\_locale.unable\_to\_start\_the\_import, |
  |  | 149 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 148 | 150 | }); |
  | 149 | 151 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3112499#L191) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3168605#L193) |  |
  | 191 | 193 | type: 'error', |
  | 192 | 194 | title: ai1wm\_locale.unable\_to\_import, |
  | 193 |  | message: error.message |
  |  | 195 | message: error.message, |
  |  | 196 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 194 | 197 | }); |
  | 195 | 198 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3112499#L252) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3168605#L255) |  |
  | 252 | 255 | type: 'error', |
  | 253 | 256 | title: ai1wm\_locale.unable\_to\_import, |
  | 254 |  | message: error.message |
  |  | 257 | message: error.message, |
  |  | 258 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 255 | 259 | }); |
  | 256 | 260 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3112499#L264) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3168605#L268) |  |
  | 264 | 268 | type: 'error', |
  | 265 | 269 | title: ai1wm\_locale.unable\_to\_import, |
  | 266 |  | message: ai1wm\_locale.unable\_to\_check\_decryption\_password |
  |  | 270 | message: ai1wm\_locale.unable\_to\_check\_decryption\_password, |
  |  | 271 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 267 | 272 | }); |
  | 268 | 273 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3112499#L325) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3168605#L330) |  |
  | 325 | 330 | type: 'error', |
  | 326 | 331 | title: ai1wm\_locale.unable\_to\_import, |
  | 327 |  | message: error.message |
  |  | 332 | message: error.message, |
  |  | 333 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 328 | 334 | }); |
  | 329 | 335 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3112499#L337) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3168605#L343) |  |
  | 337 | 343 | type: 'error', |
  | 338 | 344 | title: ai1wm\_locale.unable\_to\_import, |
  | 339 |  | message: ai1wm\_locale.unable\_to\_confirm\_the\_import |
  |  | 345 | message: ai1wm\_locale.unable\_to\_confirm\_the\_import, |
  |  | 346 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 340 | 347 | }); |
  | 341 | 348 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3112499#L419) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3168605#L426) |  |
  | 419 | 426 | type: 'error', |
  | 420 | 427 | title: ai1wm\_locale.unable\_to\_import, |
  | 421 |  | message: error.message |
  |  | 428 | message: error.message, |
  |  | 429 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 422 | 430 | }); |
  | 423 | 431 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3112499#L431) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3168605#L439) |  |
  | 431 | 439 | type: 'error', |
  | 432 | 440 | title: ai1wm\_locale.unable\_to\_import, |
  | 433 |  | message: ai1wm\_locale.unable\_to\_prepare\_blogs\_on\_import |
  |  | 441 | message: ai1wm\_locale.unable\_to\_prepare\_blogs\_on\_import, |
  |  | 442 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 434 | 443 | }); |
  | 435 | 444 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3112499#L496) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3168605#L505) |  |
  | 496 | 505 | type: 'error', |
  | 497 | 506 | title: ai1wm\_locale.unable\_to\_import, |
  | 498 |  | message: error.message |
  |  | 507 | message: error.message, |
  |  | 508 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 499 | 509 | }); |
  | 500 | 510 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3112499#L508) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3168605#L518) |  |
  | 508 | 518 | type: 'error', |
  | 509 | 519 | title: ai1wm\_locale.unable\_to\_import, |
  | 510 |  | message: ai1wm\_locale.unable\_to\_stop\_the\_import |
  |  | 520 | message: ai1wm\_locale.unable\_to\_stop\_the\_import, |
  |  | 521 | nonce: Ai1wm.Util.findValueByName(params, 'storage') |
  | 511 | 522 | }); |
  | 512 | 523 | return; |
  | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3112499#L657) | […](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/import.min.js?rev=3168605#L668) |  |
  | 657 | 668 | header.append(title); // Append header and message to section |
  | 658 | 669 |  |
  | 659 |  | section.append(header).append(message); // Append section and action to container |
  |  | 670 | section.append(header).append(message); // Create view log button |
  |  | 671 |  |
  |  | 672 | if (params.nonce) { |
  |  | 673 | var logButton = $('<a target="\_blank"></a>'); |
  |  | 674 | logButton.text(ai1wm\_locale.view\_error\_log\_button); |
  |  | 675 | logButton.prop('href', ai1wm\_export.storage.url + '/' + ai1wm\_export.error\_log.pattern.replace('%s', params.nonce)); |
  |  | 676 | section.append($('<div></div>').append(logButton)); |
  |  | 677 | } // Append section and action to container |
  |  | 678 |  |
  | 660 | 679 |  |
  | 661 | 680 | container.append(section).append(action); // Render modal |
* ## [all-in-one-wp-migration/trunk/lib/view/assets/javascript/util.min.js](/changeset/3168605/all-in-one-wp-migration/trunk/lib/view/assets/javascript/util.min.js "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/lib/view/assets/javascript/util.min.js")

  | [r3038703](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/util.min.js?rev=3038703#L68 "Show revision 3038703 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/lib/view/assets/javascript/util.min.js?rev=3168605#L68 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 68 | 68 |  |
  | 69 | 69 | return input; |
  |  | 70 | }, |
  |  | 71 | findValueByName: function findValueByName(input, name) { |
  |  | 72 | if (name in input) { |
  |  | 73 | return input[name]; |
  |  | 74 | } |
  |  | 75 |  |
  |  | 76 | var result = input.find(function (item) { |
  |  | 77 | return item.name === name; |
  |  | 78 | }); |
  |  | 79 |  |
  |  | 80 | if (result) { |
  |  | 81 | return result.value; |
  |  | 82 | } |
  | 70 | 83 | }, |
  | 71 | 84 | json: function json(input) { |
* ## [all-in-one-wp-migration/trunk/readme.txt](/changeset/3168605/all-in-one-wp-migration/trunk/readme.txt "Show the changeset 3168605 restricted to all-in-one-wp-migration/trunk/readme.txt")

  | [r3147475](/browser/all-in-one-wp-migration/trunk/readme.txt?rev=3147475#L3 "Show revision 3147475 of this file in browser") | [r3168605](/browser/all-in-one-wp-migration/trunk/readme.txt?rev=3168605#L3 "Show revision 3168605 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | Tags: backup, transfer, copy, move, clone |
  | 4 | 4 | Requires at least: 3.3 |
  | 5 |  | Tested up to: 6.~~6~~ |
  |  | 5 | Tested up to: 6.7 |
  | 6 | 6 | Requires PHP: 5.3 |
  | 7 |  | Stable tag: 7.8~~6~~ |
  |  | 7 | Stable tag: 7.87 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 |  |
  | […](/browser/all-in-one-wp-migration/trunk/readme.txt?rev=3147475#L99) | […](/browser/all-in-one-wp-migration/trunk/readme.txt?rev=3168605#L99) |  |
  | 99 | 99 |  |
  | 100 | 100 | == Changelog == |
  |  | 101 | = 7.87 = |
  |  | 102 | \*\*Added\*\* |
  |  | 103 |  |
  |  | 104 | \* Validation to ensure archive names contain the .wpress extension |
  |  | 105 |  |
  |  | 106 | \*\*Fixed\*\* |
  |  | 107 |  |
  |  | 108 | \* Resolved a vulnerability where error logs were publicly accessible with a known name by appending random affixes to error log filenames, making them unguessable. Error logs are now automatically deleted daily and during plugin updates. Special thanks to villu164 for responsibly disclosing this issue. |
  |  | 109 |  |
  | 101 | 110 | = 7.86 = |
  | 102 | 111 | \*\*Fixed\*\* |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3168605)
* [Zip Archive](?format=zip&new=3168605)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_82da2178_20250110_143441.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fall-in-one-wp-migration%2Ftags%2F7.86%2Ffunctions.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3045858 "Revision 3045858")
* [Next Revision](/browser/all-in-one-wp-migration/trunk/functions.php?rev=3168605 "Revision 3168605") →
* [Blame](/browser/all-in-one-wp-migration/trunk/functions.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/all-in-one-wp-migration/tags/7.86/functions.php)

---

# [source:](/browser?order=name "Go to repository root") [all-in-one-wp-migration](/browser/all-in-one-wp-migration?order=name "View all-in-one-wp-migration")/[tags](/browser/all-in-one-wp-migration/tags?order=name "View tags")/[7.86](/browser/all-in-one-wp-migration/tags/7.86?order=name "View 7.86")/[functions.php](/browser/all-in-one-wp-migration/tags/7.86/functions.php?order=name "View functions.php")

View diff against:

View revision:

| [Last change](/changeset/3099274/all-in-one-wp-migration/trunk/functions.php "View differences") on this file was [3099274](/changeset/3099274/ "View changeset 3099274"), checked in by bangelov, [7 months ago](/timeline?from=2024-06-07T11%3A22%3A48Z&precision=second "See timeline at 06/07/2024 11:22:48 AM") |
| --- |
| Adding v7.83 to trunk |
| **File size:** 54.3 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Copyright (C) 2014-2023 ServMask Inc. |
| [4](#L4) | \* |
| [5](#L5) | \* This program is free software: you can redistribute it and/or modify |
| [6](#L6) | \* it under the terms of the GNU General Public License as published by |
| [7](#L7) | \* the Free Software Foundation, either version 3 of the License, or |
| [8](#L8) | \* (at your option) any later version. |
| [9](#L9) | \* |
| [10](#L10) | \* This program is distributed in the hope that it will be useful, |
| [11](#L11) | \* but WITHOUT ANY WARRANTY; without even the implied warranty of |
| [12](#L12) | \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the |
| [13](#L13) | \* GNU General Public License for more details. |
| [14](#L14) | \* |
| [15](#L15) | \* You should have received a copy of the GNU General Public License |
| [16](#L16) | \* along with this program.  If not, see <http://www.gnu.org/licenses/>. |
| [17](#L17) | \* |
| [18](#L18) | \* ███████╗███████╗██████╗ ██╗   ██╗███╗   ███╗ █████╗ ███████╗██╗  ██╗ |
| [19](#L19) | \* ██╔════╝██╔════╝██╔══██╗██║   ██║████╗ ████║██╔══██╗██╔════╝██║ ██╔╝ |
| [20](#L20) | \* ███████╗█████╗  ██████╔╝██║   ██║██╔████╔██║███████║███████╗█████╔╝ |
| [21](#L21) | \* ╚════██║██╔══╝  ██╔══██╗╚██╗ ██╔╝██║╚██╔╝██║██╔══██║╚════██║██╔═██╗ |
| [22](#L22) | \* ███████║███████╗██║  ██║ ╚████╔╝ ██║ ╚═╝ ██║██║  ██║███████║██║  ██╗ |
| [23](#L23) | \* ╚══════╝╚══════╝╚═╝  ╚═╝  ╚═══╝  ╚═╝     ╚═╝╚═╝  ╚═╝╚══════╝╚═╝  ╚═╝ |
| [24](#L24) | \*/ |
| [25](#L25) |  |
| [26](#L26) | if ( ! defined( 'ABSPATH' ) ) { |
| [27](#L27) | die( 'Kangaroos cannot jump here' ); |
| [28](#L28) | } |
| [29](#L29) |  |
| [30](#L30) | /\*\* |
| [31](#L31) | \* Get storage absolute path |
| [32](#L32) | \* |
| [33](#L33) | \* @param  array  $params Request parameters |
| [34](#L34) | \* @return string |
| [35](#L35) | \*/ |
| [36](#L36) | function ai1wm\_storage\_path( $params ) { |
| [37](#L37) | if ( empty( $params['storage'] ) ) { |
| [38](#L38) | throw new Ai1wm\_Storage\_Exception( \_\_( 'Unable to locate storage path. <a href="https://help.servmask.com/knowledgebase/invalid-storage-path/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ) ); |
| [39](#L39) | } |
| [40](#L40) |  |
| [41](#L41) | // Validate storage path |
| [42](#L42) | if ( ai1wm\_validate\_file( $params['storage'] ) !== 0 ) { |
| [43](#L43) | throw new Ai1wm\_Storage\_Exception( \_\_( 'Your storage directory name contains invalid characters. It cannot contain: < > : " | ? \* \0. <a href="https://help.servmask.com/knowledgebase/invalid-storage-name/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ) ); |
| [44](#L44) | } |
| [45](#L45) |  |
| [46](#L46) | // Get storage path |
| [47](#L47) | $storage = AI1WM\_STORAGE\_PATH . DIRECTORY\_SEPARATOR . basename( $params['storage'] ); |
| [48](#L48) | if ( ! is\_dir( $storage ) ) { |
| [49](#L49) | mkdir( $storage, 0777, true ); |
| [50](#L50) | } |
| [51](#L51) |  |
| [52](#L52) | return $storage; |
| [53](#L53) | } |
| [54](#L54) |  |
| [55](#L55) | /\*\* |
| [56](#L56) | \* Get backup absolute path |
| [57](#L57) | \* |
| [58](#L58) | \* @param  array  $params Request parameters |
| [59](#L59) | \* @return string |
| [60](#L60) | \*/ |
| [61](#L61) | function ai1wm\_backup\_path( $params ) { |
| [62](#L62) | if ( empty( $params['archive'] ) ) { |
| [63](#L63) | throw new Ai1wm\_Archive\_Exception( \_\_( 'Unable to locate archive path. <a href="https://help.servmask.com/knowledgebase/invalid-archive-path/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ) ); |
| [64](#L64) | } |
| [65](#L65) |  |
| [66](#L66) | // Validate archive path |
| [67](#L67) | if ( ai1wm\_validate\_file( $params['archive'] ) !== 0 ) { |
| [68](#L68) | throw new Ai1wm\_Archive\_Exception( \_\_( 'Your archive file name contains invalid characters. It cannot contain: < > : " | ? \* \0. <a href="https://help.servmask.com/knowledgebase/invalid-archive-name/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ) ); |
| [69](#L69) | } |
| [70](#L70) |  |
| [71](#L71) | return AI1WM\_BACKUPS\_PATH . DIRECTORY\_SEPARATOR . $params['archive']; |
| [72](#L72) | } |
| [73](#L73) |  |
| [74](#L74) | /\*\* |
| [75](#L75) | \* Validates a file name and path against an allowed set of rules |
| [76](#L76) | \* |
| [77](#L77) | \* @param  string  $file          File path |
| [78](#L78) | \* @param  array   $allowed\_files Array of allowed files |
| [79](#L79) | \* @return integer |
| [80](#L80) | \*/ |
| [81](#L81) | function ai1wm\_validate\_file( $file, $allowed\_files = array() ) { |
| [82](#L82) | $file = str\_replace( '\\', '/', $file ); |
| [83](#L83) |  |
| [84](#L84) | // Validates special characters that are illegal in filenames on certain |
| [85](#L85) | // operating systems and special characters requiring special escaping |
| [86](#L86) | // to manipulate at the command line |
| [87](#L87) | $invalid\_chars = array( '<', '>', ':', '"', '|', '?', '\*', chr( 0 ) ); |
| [88](#L88) | foreach ( $invalid\_chars as $char ) { |
| [89](#L89) | if ( strpos( $file, $char ) !== false ) { |
| [90](#L90) | return 1; |
| [91](#L91) | } |
| [92](#L92) | } |
| [93](#L93) |  |
| [94](#L94) | return validate\_file( $file, $allowed\_files ); |
| [95](#L95) | } |
| [96](#L96) |  |
| [97](#L97) | /\*\* |
| [98](#L98) | \* Get archive absolute path |
| [99](#L99) | \* |
| [100](#L100) | \* @param  array  $params Request parameters |
| [101](#L101) | \* @return string |
| [102](#L102) | \*/ |
| [103](#L103) | function ai1wm\_archive\_path( $params ) { |
| [104](#L104) | if ( empty( $params['archive'] ) ) { |
| [105](#L105) | throw new Ai1wm\_Archive\_Exception( \_\_( 'Unable to locate archive path. <a href="https://help.servmask.com/knowledgebase/invalid-archive-path/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ) ); |
| [106](#L106) | } |
| [107](#L107) |  |
| [108](#L108) | // Validate archive path |
| [109](#L109) | if ( ai1wm\_validate\_file( $params['archive'] ) !== 0 ) { |
| [110](#L110) | throw new Ai1wm\_Archive\_Exception( \_\_( 'Your archive file name contains invalid characters. It cannot contain: < > : " | ? \* \0. <a href="https://help.servmask.com/knowledgebase/invalid-archive-name/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ) ); |
| [111](#L111) | } |
| [112](#L112) |  |
| [113](#L113) | // Get archive path |
| [114](#L114) | if ( empty( $params['ai1wm\_manual\_restore'] ) ) { |
| [115](#L115) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . $params['archive']; |
| [116](#L116) | } |
| [117](#L117) |  |
| [118](#L118) | return ai1wm\_backup\_path( $params ); |
| [119](#L119) | } |
| [120](#L120) |  |
| [121](#L121) | /\*\* |
| [122](#L122) | \* Get multipart.list absolute path |
| [123](#L123) | \* |
| [124](#L124) | \* @param  array  $params Request parameters |
| [125](#L125) | \* @return string |
| [126](#L126) | \*/ |
| [127](#L127) | function ai1wm\_multipart\_path( $params ) { |
| [128](#L128) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_MULTIPART\_NAME; |
| [129](#L129) | } |
| [130](#L130) |  |
| [131](#L131) | /\*\* |
| [132](#L132) | \* Get content.list absolute path |
| [133](#L133) | \* |
| [134](#L134) | \* @param  array  $params Request parameters |
| [135](#L135) | \* @return string |
| [136](#L136) | \*/ |
| [137](#L137) | function ai1wm\_content\_list\_path( $params ) { |
| [138](#L138) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_CONTENT\_LIST\_NAME; |
| [139](#L139) | } |
| [140](#L140) |  |
| [141](#L141) | /\*\* |
| [142](#L142) | \* Get media.list absolute path |
| [143](#L143) | \* |
| [144](#L144) | \* @param  array  $params Request parameters |
| [145](#L145) | \* @return string |
| [146](#L146) | \*/ |
| [147](#L147) | function ai1wm\_media\_list\_path( $params ) { |
| [148](#L148) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_MEDIA\_LIST\_NAME; |
| [149](#L149) | } |
| [150](#L150) |  |
| [151](#L151) | /\*\* |
| [152](#L152) | \* Get plugins.list absolute path |
| [153](#L153) | \* |
| [154](#L154) | \* @param  array  $params Request parameters |
| [155](#L155) | \* @return string |
| [156](#L156) | \*/ |
| [157](#L157) | function ai1wm\_plugins\_list\_path( $params ) { |
| [158](#L158) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_PLUGINS\_LIST\_NAME; |
| [159](#L159) | } |
| [160](#L160) |  |
| [161](#L161) | /\*\* |
| [162](#L162) | \* Get themes.list absolute path |
| [163](#L163) | \* |
| [164](#L164) | \* @param  array  $params Request parameters |
| [165](#L165) | \* @return string |
| [166](#L166) | \*/ |
| [167](#L167) | function ai1wm\_themes\_list\_path( $params ) { |
| [168](#L168) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_THEMES\_LIST\_NAME; |
| [169](#L169) | } |
| [170](#L170) |  |
| [171](#L171) | /\*\* |
| [172](#L172) | \* Get tables.list absolute path |
| [173](#L173) | \* |
| [174](#L174) | \* @param  array  $params Request parameters |
| [175](#L175) | \* @return string |
| [176](#L176) | \*/ |
| [177](#L177) | function ai1wm\_tables\_list\_path( $params ) { |
| [178](#L178) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_TABLES\_LIST\_NAME; |
| [179](#L179) | } |
| [180](#L180) |  |
| [181](#L181) | /\*\* |
| [182](#L182) | \* Get incremental.content.list absolute path |
| [183](#L183) | \* |
| [184](#L184) | \* @param  array  $params Request parameters |
| [185](#L185) | \* @return string |
| [186](#L186) | \*/ |
| [187](#L187) | function ai1wm\_incremental\_content\_list\_path( $params ) { |
| [188](#L188) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_INCREMENTAL\_CONTENT\_LIST\_NAME; |
| [189](#L189) | } |
| [190](#L190) |  |
| [191](#L191) | /\*\* |
| [192](#L192) | \* Get incremental.media.list absolute path |
| [193](#L193) | \* |
| [194](#L194) | \* @param  array  $params Request parameters |
| [195](#L195) | \* @return string |
| [196](#L196) | \*/ |
| [197](#L197) | function ai1wm\_incremental\_media\_list\_path( $params ) { |
| [198](#L198) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_INCREMENTAL\_MEDIA\_LIST\_NAME; |
| [199](#L199) | } |
| [200](#L200) |  |
| [201](#L201) | /\*\* |
| [202](#L202) | \* Get incremental.plugins.list absolute path |
| [203](#L203) | \* |
| [204](#L204) | \* @param  array  $params Request parameters |
| [205](#L205) | \* @return string |
| [206](#L206) | \*/ |
| [207](#L207) | function ai1wm\_incremental\_plugins\_list\_path( $params ) { |
| [208](#L208) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_INCREMENTAL\_PLUGINS\_LIST\_NAME; |
| [209](#L209) | } |
| [210](#L210) |  |
| [211](#L211) | /\*\* |
| [212](#L212) | \* Get incremental.themes.list absolute path |
| [213](#L213) | \* |
| [214](#L214) | \* @param  array  $params Request parameters |
| [215](#L215) | \* @return string |
| [216](#L216) | \*/ |
| [217](#L217) | function ai1wm\_incremental\_themes\_list\_path( $params ) { |
| [218](#L218) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_INCREMENTAL\_THEMES\_LIST\_NAME; |
| [219](#L219) | } |
| [220](#L220) |  |
| [221](#L221) | /\*\* |
| [222](#L222) | \* Get incremental.backups.list absolute path |
| [223](#L223) | \* |
| [224](#L224) | \* @param  array  $params Request parameters |
| [225](#L225) | \* @return string |
| [226](#L226) | \*/ |
| [227](#L227) | function ai1wm\_incremental\_backups\_list\_path( $params ) { |
| [228](#L228) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_INCREMENTAL\_BACKUPS\_LIST\_NAME; |
| [229](#L229) | } |
| [230](#L230) |  |
| [231](#L231) | /\*\* |
| [232](#L232) | \* Get package.json absolute path |
| [233](#L233) | \* |
| [234](#L234) | \* @param  array  $params Request parameters |
| [235](#L235) | \* @return string |
| [236](#L236) | \*/ |
| [237](#L237) | function ai1wm\_package\_path( $params ) { |
| [238](#L238) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_PACKAGE\_NAME; |
| [239](#L239) | } |
| [240](#L240) |  |
| [241](#L241) | /\*\* |
| [242](#L242) | \* Get multisite.json absolute path |
| [243](#L243) | \* |
| [244](#L244) | \* @param  array  $params Request parameters |
| [245](#L245) | \* @return string |
| [246](#L246) | \*/ |
| [247](#L247) | function ai1wm\_multisite\_path( $params ) { |
| [248](#L248) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_MULTISITE\_NAME; |
| [249](#L249) | } |
| [250](#L250) |  |
| [251](#L251) | /\*\* |
| [252](#L252) | \* Get blogs.json absolute path |
| [253](#L253) | \* |
| [254](#L254) | \* @param  array  $params Request parameters |
| [255](#L255) | \* @return string |
| [256](#L256) | \*/ |
| [257](#L257) | function ai1wm\_blogs\_path( $params ) { |
| [258](#L258) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_BLOGS\_NAME; |
| [259](#L259) | } |
| [260](#L260) |  |
| [261](#L261) | /\*\* |
| [262](#L262) | \* Get settings.json absolute path |
| [263](#L263) | \* |
| [264](#L264) | \* @param  array  $params Request parameters |
| [265](#L265) | \* @return string |
| [266](#L266) | \*/ |
| [267](#L267) | function ai1wm\_settings\_path( $params ) { |
| [268](#L268) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_SETTINGS\_NAME; |
| [269](#L269) | } |
| [270](#L270) |  |
| [271](#L271) | /\*\* |
| [272](#L272) | \* Get database.sql absolute path |
| [273](#L273) | \* |
| [274](#L274) | \* @param  array  $params Request parameters |
| [275](#L275) | \* @return string |
| [276](#L276) | \*/ |
| [277](#L277) | function ai1wm\_database\_path( $params ) { |
| [278](#L278) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_DATABASE\_NAME; |
| [279](#L279) | } |
| [280](#L280) |  |
| [281](#L281) | /\*\* |
| [282](#L282) | \* Get cookies.txt absolute path |
| [283](#L283) | \* |
| [284](#L284) | \* @param  array  $params Request parameters |
| [285](#L285) | \* @return string |
| [286](#L286) | \*/ |
| [287](#L287) | function ai1wm\_cookies\_path( $params ) { |
| [288](#L288) | return ai1wm\_storage\_path( $params ) . DIRECTORY\_SEPARATOR . AI1WM\_COOKIES\_NAME; |
| [289](#L289) | } |
| [290](#L290) |  |
| [291](#L291) | /\*\* |
| [292](#L292) | \* Get error log absolute path |
| [293](#L293) | \* |
| [294](#L294) | \* @return string |
| [295](#L295) | \*/ |
| [296](#L296) | function ai1wm\_error\_path() { |
| [297](#L297) | return AI1WM\_STORAGE\_PATH . DIRECTORY\_SEPARATOR . AI1WM\_ERROR\_NAME; |
| [298](#L298) | } |
| [299](#L299) |  |
| [300](#L300) | /\*\* |
| [301](#L301) | \* Get archive name |
| [302](#L302) | \* |
| [303](#L303) | \* @param  array  $params Request parameters |
| [304](#L304) | \* @return string |
| [305](#L305) | \*/ |
| [306](#L306) | function ai1wm\_archive\_name( $params ) { |
| [307](#L307) | return basename( $params['archive'] ); |
| [308](#L308) | } |
| [309](#L309) |  |
| [310](#L310) | /\*\* |
| [311](#L311) | \* Get backup URL address |
| [312](#L312) | \* |
| [313](#L313) | \* @param  array  $params Request parameters |
| [314](#L314) | \* @return string |
| [315](#L315) | \*/ |
| [316](#L316) | function ai1wm\_backup\_url( $params ) { |
| [317](#L317) | static $backups\_base\_url = ''; |
| [318](#L318) | if ( empty( $backups\_base\_url ) ) { |
| [319](#L319) | if ( Ai1wm\_Backups::are\_in\_wp\_content\_folder() ) { |
| [320](#L320) | $backups\_base\_url = str\_replace( untrailingslashit( WP\_CONTENT\_DIR ), '', AI1WM\_BACKUPS\_PATH ); |
| [321](#L321) | $backups\_base\_url = content\_url( |
| [322](#L322) | ai1wm\_replace\_directory\_separator\_with\_forward\_slash( $backups\_base\_url ) |
| [323](#L323) | ); |
| [324](#L324) | } else { |
| [325](#L325) | $backups\_base\_url = str\_replace( untrailingslashit( ABSPATH ), '', AI1WM\_BACKUPS\_PATH ); |
| [326](#L326) | $backups\_base\_url = site\_url( |
| [327](#L327) | ai1wm\_replace\_directory\_separator\_with\_forward\_slash( $backups\_base\_url ) |
| [328](#L328) | ); |
| [329](#L329) | } |
| [330](#L330) | } |
| [331](#L331) |  |
| [332](#L332) | return $backups\_base\_url . '/' . ai1wm\_replace\_directory\_separator\_with\_forward\_slash( $params['archive'] ); |
| [333](#L333) | } |
| [334](#L334) |  |
| [335](#L335) | /\*\* |
| [336](#L336) | \* Get archive size in bytes |
| [337](#L337) | \* |
| [338](#L338) | \* @param  array   $params Request parameters |
| [339](#L339) | \* @return integer |
| [340](#L340) | \*/ |
| [341](#L341) | function ai1wm\_archive\_bytes( $params ) { |
| [342](#L342) | return filesize( ai1wm\_archive\_path( $params ) ); |
| [343](#L343) | } |
| [344](#L344) |  |
| [345](#L345) | /\*\* |
| [346](#L346) | \* Get archive modified time in seconds |
| [347](#L347) | \* |
| [348](#L348) | \* @param  array   $params Request parameters |
| [349](#L349) | \* @return integer |
| [350](#L350) | \*/ |
| [351](#L351) | function ai1wm\_archive\_mtime( $params ) { |
| [352](#L352) | return filemtime( ai1wm\_archive\_path( $params ) ); |
| [353](#L353) | } |
| [354](#L354) |  |
| [355](#L355) | /\*\* |
| [356](#L356) | \* Get backup size in bytes |
| [357](#L357) | \* |
| [358](#L358) | \* @param  array   $params Request parameters |
| [359](#L359) | \* @return integer |
| [360](#L360) | \*/ |
| [361](#L361) | function ai1wm\_backup\_bytes( $params ) { |
| [362](#L362) | return filesize( ai1wm\_backup\_path( $params ) ); |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | /\*\* |
| [366](#L366) | \* Get database size in bytes |
| [367](#L367) | \* |
| [368](#L368) | \* @param  array   $params Request parameters |
| [369](#L369) | \* @return integer |
| [370](#L370) | \*/ |
| [371](#L371) | function ai1wm\_database\_bytes( $params ) { |
| [372](#L372) | return filesize( ai1wm\_database\_path( $params ) ); |
| [373](#L373) | } |
| [374](#L374) |  |
| [375](#L375) | /\*\* |
| [376](#L376) | \* Get package size in bytes |
| [377](#L377) | \* |
| [378](#L378) | \* @param  array   $params Request parameters |
| [379](#L379) | \* @return integer |
| [380](#L380) | \*/ |
| [381](#L381) | function ai1wm\_package\_bytes( $params ) { |
| [382](#L382) | return filesize( ai1wm\_package\_path( $params ) ); |
| [383](#L383) | } |
| [384](#L384) |  |
| [385](#L385) | /\*\* |
| [386](#L386) | \* Get multisite size in bytes |
| [387](#L387) | \* |
| [388](#L388) | \* @param  array   $params Request parameters |
| [389](#L389) | \* @return integer |
| [390](#L390) | \*/ |
| [391](#L391) | function ai1wm\_multisite\_bytes( $params ) { |
| [392](#L392) | return filesize( ai1wm\_multisite\_path( $params ) ); |
| [393](#L393) | } |
| [394](#L394) |  |
| [395](#L395) | /\*\* |
| [396](#L396) | \* Get archive size as text |
| [397](#L397) | \* |
| [398](#L398) | \* @param  array  $params Request parameters |
| [399](#L399) | \* @return string |
| [400](#L400) | \*/ |
| [401](#L401) | function ai1wm\_archive\_size( $params ) { |
| [402](#L402) | return ai1wm\_size\_format( filesize( ai1wm\_archive\_path( $params ) ) ); |
| [403](#L403) | } |
| [404](#L404) |  |
| [405](#L405) | /\*\* |
| [406](#L406) | \* Get backup size as text |
| [407](#L407) | \* |
| [408](#L408) | \* @param  array  $params Request parameters |
| [409](#L409) | \* @return string |
| [410](#L410) | \*/ |
| [411](#L411) | function ai1wm\_backup\_size( $params ) { |
| [412](#L412) | return ai1wm\_size\_format( filesize( ai1wm\_backup\_path( $params ) ) ); |
| [413](#L413) | } |
| [414](#L414) |  |
| [415](#L415) | /\*\* |
| [416](#L416) | \* Parse file size |
| [417](#L417) | \* |
| [418](#L418) | \* @param  string $size    File size |
| [419](#L419) | \* @param  string $default Default size |
| [420](#L420) | \* @return string |
| [421](#L421) | \*/ |
| [422](#L422) | function ai1wm\_parse\_size( $size, $default = null ) { |
| [423](#L423) | $suffixes = array( |
| [424](#L424) | ''  => 1, |
| [425](#L425) | 'k' => 1000, |
| [426](#L426) | 'm' => 1000000, |
| [427](#L427) | 'g' => 1000000000, |
| [428](#L428) | ); |
| [429](#L429) |  |
| [430](#L430) | // Parse size format |
| [431](#L431) | if ( preg\_match( '/([0-9]+)\s\*(k|m|g)?(b?(ytes?)?)/i', $size, $matches ) ) { |
| [432](#L432) | return $matches[1] \* $suffixes[ strtolower( $matches[2] ) ]; |
| [433](#L433) | } |
| [434](#L434) |  |
| [435](#L435) | return $default; |
| [436](#L436) | } |
| [437](#L437) |  |
| [438](#L438) | /\*\* |
| [439](#L439) | \* Format file size into human-readable string |
| [440](#L440) | \* |
| [441](#L441) | \* Fixes the WP size\_format bug: size\_format( '0' ) => false |
| [442](#L442) | \* |
| [443](#L443) | \* @param  int|string   $bytes            Number of bytes. Note max integer size for integers. |
| [444](#L444) | \* @param  int          $decimals         Optional. Precision of number of decimal places. Default 0. |
| [445](#L445) | \* @return string|false False on failure. Number string on success. |
| [446](#L446) | \*/ |
| [447](#L447) | function ai1wm\_size\_format( $bytes, $decimals = 0 ) { |
| [448](#L448) | if ( strval( $bytes ) === '0' ) { |
| [449](#L449) | return size\_format( 0, $decimals ); |
| [450](#L450) | } |
| [451](#L451) |  |
| [452](#L452) | return size\_format( $bytes, $decimals ); |
| [453](#L453) | } |
| [454](#L454) |  |
| [455](#L455) | /\*\* |
| [456](#L456) | \* Get current site name |
| [457](#L457) | \* |
| [458](#L458) | \* @param  integer $blog\_id Blog ID |
| [459](#L459) | \* @return string |
| [460](#L460) | \*/ |
| [461](#L461) | function ai1wm\_site\_name( $blog\_id = null ) { |
| [462](#L462) | return parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_HOST ); |
| [463](#L463) | } |
| [464](#L464) |  |
| [465](#L465) | /\*\* |
| [466](#L466) | \* Get archive file name |
| [467](#L467) | \* |
| [468](#L468) | \* @param  integer $blog\_id Blog ID |
| [469](#L469) | \* @return string |
| [470](#L470) | \*/ |
| [471](#L471) | function ai1wm\_archive\_file( $blog\_id = null ) { |
| [472](#L472) | $name = array(); |
| [473](#L473) |  |
| [474](#L474) | // Add domain |
| [475](#L475) | if ( defined( 'AI1WM\_KEEP\_DOMAIN\_NAME' ) ) { |
| [476](#L476) | $name[] = parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_HOST ); |
| [477](#L477) | } elseif ( ( $domain = explode( '.', parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_HOST ) ) ) ) { |
| [478](#L478) | foreach ( $domain as $subdomain ) { |
| [479](#L479) | if ( ( $subdomain = strtolower( $subdomain ) ) ) { |
| [480](#L480) | $name[] = $subdomain; |
| [481](#L481) | } |
| [482](#L482) | } |
| [483](#L483) | } |
| [484](#L484) |  |
| [485](#L485) | // Add path |
| [486](#L486) | if ( ( $path = parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_PATH ) ) ) { |
| [487](#L487) | foreach ( explode( '/', $path ) as $directory ) { |
| [488](#L488) | if ( ( $directory = strtolower( preg\_replace( '/[^A-Za-z0-9\-]/', '', $directory ) ) ) ) { |
| [489](#L489) | $name[] = $directory; |
| [490](#L490) | } |
| [491](#L491) | } |
| [492](#L492) | } |
| [493](#L493) |  |
| [494](#L494) | // Add year, month and day |
| [495](#L495) | $name[] = date\_i18n( 'Ymd' ); |
| [496](#L496) |  |
| [497](#L497) | // Add hours, minutes and seconds |
| [498](#L498) | $name[] = date\_i18n( 'His' ); |
| [499](#L499) |  |
| [500](#L500) | // Add unique identifier |
| [501](#L501) | $name[] = ai1wm\_generate\_random\_string( 6, false ); |
| [502](#L502) |  |
| [503](#L503) | return sprintf( '%s.wpress', strtolower( implode( '-', $name ) ) ); |
| [504](#L504) | } |
| [505](#L505) |  |
| [506](#L506) | /\*\* |
| [507](#L507) | \* Get archive folder name |
| [508](#L508) | \* |
| [509](#L509) | \* @param  integer $blog\_id Blog ID |
| [510](#L510) | \* @return string |
| [511](#L511) | \*/ |
| [512](#L512) | function ai1wm\_archive\_folder( $blog\_id = null ) { |
| [513](#L513) | $name = array(); |
| [514](#L514) |  |
| [515](#L515) | // Add domain |
| [516](#L516) | if ( defined( 'AI1WM\_KEEP\_DOMAIN\_NAME' ) ) { |
| [517](#L517) | $name[] = parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_HOST ); |
| [518](#L518) | } elseif ( ( $domain = explode( '.', parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_HOST ) ) ) ) { |
| [519](#L519) | foreach ( $domain as $subdomain ) { |
| [520](#L520) | if ( ( $subdomain = strtolower( $subdomain ) ) ) { |
| [521](#L521) | $name[] = $subdomain; |
| [522](#L522) | } |
| [523](#L523) | } |
| [524](#L524) | } |
| [525](#L525) |  |
| [526](#L526) | // Add path |
| [527](#L527) | if ( ( $path = parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_PATH ) ) ) { |
| [528](#L528) | foreach ( explode( '/', $path ) as $directory ) { |
| [529](#L529) | if ( ( $directory = strtolower( preg\_replace( '/[^A-Za-z0-9\-]/', '', $directory ) ) ) ) { |
| [530](#L530) | $name[] = $directory; |
| [531](#L531) | } |
| [532](#L532) | } |
| [533](#L533) | } |
| [534](#L534) |  |
| [535](#L535) | return strtolower( implode( '-', $name ) ); |
| [536](#L536) | } |
| [537](#L537) |  |
| [538](#L538) | /\*\* |
| [539](#L539) | \* Get archive bucket name |
| [540](#L540) | \* |
| [541](#L541) | \* @param  integer $blog\_id Blog ID |
| [542](#L542) | \* @return string |
| [543](#L543) | \*/ |
| [544](#L544) | function ai1wm\_archive\_bucket( $blog\_id = null ) { |
| [545](#L545) | $name = array(); |
| [546](#L546) |  |
| [547](#L547) | // Add domain |
| [548](#L548) | if ( ( $domain = explode( '.', parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_HOST ) ) ) ) { |
| [549](#L549) | foreach ( $domain as $subdomain ) { |
| [550](#L550) | if ( ( $subdomain = strtolower( $subdomain ) ) ) { |
| [551](#L551) | $name[] = $subdomain; |
| [552](#L552) | } |
| [553](#L553) | } |
| [554](#L554) | } |
| [555](#L555) |  |
| [556](#L556) | // Add path |
| [557](#L557) | if ( ( $path = parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_PATH ) ) ) { |
| [558](#L558) | foreach ( explode( '/', $path ) as $directory ) { |
| [559](#L559) | if ( ( $directory = strtolower( preg\_replace( '/[^A-Za-z0-9\-]/', '', $directory ) ) ) ) { |
| [560](#L560) | $name[] = $directory; |
| [561](#L561) | } |
| [562](#L562) | } |
| [563](#L563) | } |
| [564](#L564) |  |
| [565](#L565) | return strtolower( implode( '-', $name ) ); |
| [566](#L566) | } |
| [567](#L567) |  |
| [568](#L568) | /\*\* |
| [569](#L569) | \* Get archive vault name |
| [570](#L570) | \* |
| [571](#L571) | \* @param  integer $blog\_id Blog ID |
| [572](#L572) | \* @return string |
| [573](#L573) | \*/ |
| [574](#L574) | function ai1wm\_archive\_vault( $blog\_id = null ) { |
| [575](#L575) | $name = array(); |
| [576](#L576) |  |
| [577](#L577) | // Add domain |
| [578](#L578) | if ( ( $domain = explode( '.', parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_HOST ) ) ) ) { |
| [579](#L579) | foreach ( $domain as $subdomain ) { |
| [580](#L580) | if ( ( $subdomain = strtolower( $subdomain ) ) ) { |
| [581](#L581) | $name[] = $subdomain; |
| [582](#L582) | } |
| [583](#L583) | } |
| [584](#L584) | } |
| [585](#L585) |  |
| [586](#L586) | // Add path |
| [587](#L587) | if ( ( $path = parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_PATH ) ) ) { |
| [588](#L588) | foreach ( explode( '/', $path ) as $directory ) { |
| [589](#L589) | if ( ( $directory = strtolower( preg\_replace( '/[^A-Za-z0-9\-]/', '', $directory ) ) ) ) { |
| [590](#L590) | $name[] = $directory; |
| [591](#L591) | } |
| [592](#L592) | } |
| [593](#L593) | } |
| [594](#L594) |  |
| [595](#L595) | return strtolower( implode( '-', $name ) ); |
| [596](#L596) | } |
| [597](#L597) |  |
| [598](#L598) | /\*\* |
| [599](#L599) | \* Get archive project name |
| [600](#L600) | \* |
| [601](#L601) | \* @param  integer $blog\_id Blog ID |
| [602](#L602) | \* @return string |
| [603](#L603) | \*/ |
| [604](#L604) | function ai1wm\_archive\_project( $blog\_id = null ) { |
| [605](#L605) | $name = array(); |
| [606](#L606) |  |
| [607](#L607) | // Add domain |
| [608](#L608) | if ( ( $domain = explode( '.', parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_HOST ) ) ) ) { |
| [609](#L609) | foreach ( $domain as $subdomain ) { |
| [610](#L610) | if ( ( $subdomain = strtolower( $subdomain ) ) ) { |
| [611](#L611) | $name[] = $subdomain; |
| [612](#L612) | } |
| [613](#L613) | } |
| [614](#L614) | } |
| [615](#L615) |  |
| [616](#L616) | // Add path |
| [617](#L617) | if ( ( $path = parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_PATH ) ) ) { |
| [618](#L618) | foreach ( explode( '/', $path ) as $directory ) { |
| [619](#L619) | if ( ( $directory = strtolower( preg\_replace( '/[^A-Za-z0-9\-]/', '', $directory ) ) ) ) { |
| [620](#L620) | $name[] = $directory; |
| [621](#L621) | } |
| [622](#L622) | } |
| [623](#L623) | } |
| [624](#L624) |  |
| [625](#L625) | return strtolower( implode( '-', $name ) ); |
| [626](#L626) | } |
| [627](#L627) |  |
| [628](#L628) | /\*\* |
| [629](#L629) | \* Get archive share name |
| [630](#L630) | \* |
| [631](#L631) | \* @param  integer $blog\_id Blog ID |
| [632](#L632) | \* @return string |
| [633](#L633) | \*/ |
| [634](#L634) | function ai1wm\_archive\_share( $blog\_id = null ) { |
| [635](#L635) | $name = array(); |
| [636](#L636) |  |
| [637](#L637) | // Add domain |
| [638](#L638) | if ( ( $domain = explode( '.', parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_HOST ) ) ) ) { |
| [639](#L639) | foreach ( $domain as $subdomain ) { |
| [640](#L640) | if ( ( $subdomain = strtolower( $subdomain ) ) ) { |
| [641](#L641) | $name[] = $subdomain; |
| [642](#L642) | } |
| [643](#L643) | } |
| [644](#L644) | } |
| [645](#L645) |  |
| [646](#L646) | // Add path |
| [647](#L647) | if ( ( $path = parse\_url( get\_site\_url( $blog\_id ), PHP\_URL\_PATH ) ) ) { |
| [648](#L648) | foreach ( explode( '/', $path ) as $directory ) { |
| [649](#L649) | if ( ( $directory = strtolower( preg\_replace( '/[^A-Za-z0-9\-]/', '', $directory ) ) ) ) { |
| [650](#L650) | $name[] = $directory; |
| [651](#L651) | } |
| [652](#L652) | } |
| [653](#L653) | } |
| [654](#L654) |  |
| [655](#L655) | return strtolower( implode( '-', $name ) ); |
| [656](#L656) | } |
| [657](#L657) |  |
| [658](#L658) | /\*\* |
| [659](#L659) | \* Generate random string |
| [660](#L660) | \* |
| [661](#L661) | \* @param  integer $length              String length |
| [662](#L662) | \* @param  boolean $mixed\_chars         Whether to include mixed characters |
| [663](#L663) | \* @param  boolean $special\_chars       Whether to include special characters |
| [664](#L664) | \* @param  boolean $extra\_special\_chars Whether to include extra special characters |
| [665](#L665) | \* @return string |
| [666](#L666) | \*/ |
| [667](#L667) | function ai1wm\_generate\_random\_string( $length = 12, $mixed\_chars = true, $special\_chars = false, $extra\_special\_chars = false ) { |
| [668](#L668) | $chars = 'abcdefghijklmnopqrstuvwxyz0123456789'; |
| [669](#L669) | if ( $mixed\_chars ) { |
| [670](#L670) | $chars .= 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'; |
| [671](#L671) | } |
| [672](#L672) |  |
| [673](#L673) | if ( $special\_chars ) { |
| [674](#L674) | $chars .= '!@#$%^&\*()'; |
| [675](#L675) | } |
| [676](#L676) |  |
| [677](#L677) | if ( $extra\_special\_chars ) { |
| [678](#L678) | $chars .= '-\_ []{}<>~`+=,.;:/?|'; |
| [679](#L679) | } |
| [680](#L680) |  |
| [681](#L681) | $str = ''; |
| [682](#L682) | for ( $i = 0; $i < $length; $i++ ) { |
| [683](#L683) | $str .= substr( $chars, wp\_rand( 0, strlen( $chars ) - 1 ), 1 ); |
| [684](#L684) | } |
| [685](#L685) |  |
| [686](#L686) | return $str; |
| [687](#L687) | } |
| [688](#L688) |  |
| [689](#L689) | /\*\* |
| [690](#L690) | \* Get storage folder name |
| [691](#L691) | \* |
| [692](#L692) | \* @return string |
| [693](#L693) | \*/ |
| [694](#L694) | function ai1wm\_storage\_folder() { |
| [695](#L695) | return uniqid(); |
| [696](#L696) | } |
| [697](#L697) |  |
| [698](#L698) | /\*\* |
| [699](#L699) | \* Check whether blog ID is main site |
| [700](#L700) | \* |
| [701](#L701) | \* @param  integer $blog\_id Blog ID |
| [702](#L702) | \* @return boolean |
| [703](#L703) | \*/ |
| [704](#L704) | function ai1wm\_is\_mainsite( $blog\_id = null ) { |
| [705](#L705) | return $blog\_id === null || $blog\_id === 0 || $blog\_id === 1; |
| [706](#L706) | } |
| [707](#L707) |  |
| [708](#L708) | /\*\* |
| [709](#L709) | \* Get files absolute path by blog ID |
| [710](#L710) | \* |
| [711](#L711) | \* @param  integer $blog\_id Blog ID |
| [712](#L712) | \* @return string |
| [713](#L713) | \*/ |
| [714](#L714) | function ai1wm\_blog\_files\_abspath( $blog\_id = null ) { |
| [715](#L715) | if ( ai1wm\_is\_mainsite( $blog\_id ) ) { |
| [716](#L716) | return ai1wm\_get\_uploads\_dir(); |
| [717](#L717) | } |
| [718](#L718) |  |
| [719](#L719) | return WP\_CONTENT\_DIR . DIRECTORY\_SEPARATOR . 'blogs.dir' . DIRECTORY\_SEPARATOR . $blog\_id . DIRECTORY\_SEPARATOR . 'files'; |
| [720](#L720) | } |
| [721](#L721) |  |
| [722](#L722) | /\*\* |
| [723](#L723) | \* Get blogs.dir absolute path by blog ID |
| [724](#L724) | \* |
| [725](#L725) | \* @param  integer $blog\_id Blog ID |
| [726](#L726) | \* @return string |
| [727](#L727) | \*/ |
| [728](#L728) | function ai1wm\_blog\_blogsdir\_abspath( $blog\_id = null ) { |
| [729](#L729) | if ( ai1wm\_is\_mainsite( $blog\_id ) ) { |
| [730](#L730) | return ai1wm\_get\_uploads\_dir(); |
| [731](#L731) | } |
| [732](#L732) |  |
| [733](#L733) | return WP\_CONTENT\_DIR . DIRECTORY\_SEPARATOR . 'blogs.dir' . DIRECTORY\_SEPARATOR . $blog\_id; |
| [734](#L734) | } |
| [735](#L735) |  |
| [736](#L736) | /\*\* |
| [737](#L737) | \* Get sites absolute path by blog ID |
| [738](#L738) | \* |
| [739](#L739) | \* @param  integer $blog\_id Blog ID |
| [740](#L740) | \* @return string |
| [741](#L741) | \*/ |
| [742](#L742) | function ai1wm\_blog\_sites\_abspath( $blog\_id = null ) { |
| [743](#L743) | if ( ai1wm\_is\_mainsite( $blog\_id ) ) { |
| [744](#L744) | return ai1wm\_get\_uploads\_dir(); |
| [745](#L745) | } |
| [746](#L746) |  |
| [747](#L747) | return ai1wm\_get\_uploads\_dir() . DIRECTORY\_SEPARATOR . 'sites' . DIRECTORY\_SEPARATOR . $blog\_id; |
| [748](#L748) | } |
| [749](#L749) |  |
| [750](#L750) | /\*\* |
| [751](#L751) | \* Get files relative path by blog ID |
| [752](#L752) | \* |
| [753](#L753) | \* @param  integer $blog\_id Blog ID |
| [754](#L754) | \* @return string |
| [755](#L755) | \*/ |
| [756](#L756) | function ai1wm\_blog\_files\_relpath( $blog\_id = null ) { |
| [757](#L757) | if ( ai1wm\_is\_mainsite( $blog\_id ) ) { |
| [758](#L758) | return 'uploads'; |
| [759](#L759) | } |
| [760](#L760) |  |
| [761](#L761) | return 'blogs.dir' . DIRECTORY\_SEPARATOR . $blog\_id . DIRECTORY\_SEPARATOR . 'files'; |
| [762](#L762) | } |
| [763](#L763) |  |
| [764](#L764) | /\*\* |
| [765](#L765) | \* Get blogs.dir relative path by blog ID |
| [766](#L766) | \* |
| [767](#L767) | \* @param  integer $blog\_id Blog ID |
| [768](#L768) | \* @return string |
| [769](#L769) | \*/ |
| [770](#L770) | function ai1wm\_blog\_blogsdir\_relpath( $blog\_id = null ) { |
| [771](#L771) | if ( ai1wm\_is\_mainsite( $blog\_id ) ) { |
| [772](#L772) | return 'uploads'; |
| [773](#L773) | } |
| [774](#L774) |  |
| [775](#L775) | return 'blogs.dir' . DIRECTORY\_SEPARATOR . $blog\_id; |
| [776](#L776) | } |
| [777](#L777) |  |
| [778](#L778) | /\*\* |
| [779](#L779) | \* Get sites relative path by blog ID |
| [780](#L780) | \* |
| [781](#L781) | \* @param  integer $blog\_id Blog ID |
| [782](#L782) | \* @return string |
| [783](#L783) | \*/ |
| [784](#L784) | function ai1wm\_blog\_sites\_relpath( $blog\_id = null ) { |
| [785](#L785) | if ( ai1wm\_is\_mainsite( $blog\_id ) ) { |
| [786](#L786) | return 'uploads'; |
| [787](#L787) | } |
| [788](#L788) |  |
| [789](#L789) | return 'uploads' . DIRECTORY\_SEPARATOR . 'sites' . DIRECTORY\_SEPARATOR . $blog\_id; |
| [790](#L790) | } |
| [791](#L791) |  |
| [792](#L792) | /\*\* |
| [793](#L793) | \* Get files URL by blog ID |
| [794](#L794) | \* |
| [795](#L795) | \* @param  integer $blog\_id Blog ID |
| [796](#L796) | \* @return string |
| [797](#L797) | \*/ |
| [798](#L798) | function ai1wm\_blog\_files\_url( $blog\_id = null ) { |
| [799](#L799) | if ( ai1wm\_is\_mainsite( $blog\_id ) ) { |
| [800](#L800) | return '/wp-content/uploads/'; |
| [801](#L801) | } |
| [802](#L802) |  |
| [803](#L803) | return sprintf( '/wp-content/blogs.dir/%d/files/', $blog\_id ); |
| [804](#L804) | } |
| [805](#L805) |  |
| [806](#L806) | /\*\* |
| [807](#L807) | \* Get blogs.dir URL by blog ID |
| [808](#L808) | \* |
| [809](#L809) | \* @param  integer $blog\_id Blog ID |
| [810](#L810) | \* @return string |
| [811](#L811) | \*/ |
| [812](#L812) | function ai1wm\_blog\_blogsdir\_url( $blog\_id = null ) { |
| [813](#L813) | if ( ai1wm\_is\_mainsite( $blog\_id ) ) { |
| [814](#L814) | return '/wp-content/uploads/'; |
| [815](#L815) | } |
| [816](#L816) |  |
| [817](#L817) | return sprintf( '/wp-content/blogs.dir/%d/', $blog\_id ); |
| [818](#L818) | } |
| [819](#L819) |  |
| [820](#L820) | /\*\* |
| [821](#L821) | \* Get sites URL by blog ID |
| [822](#L822) | \* |
| [823](#L823) | \* @param  integer $blog\_id Blog ID |
| [824](#L824) | \* @return string |
| [825](#L825) | \*/ |
| [826](#L826) | function ai1wm\_blog\_sites\_url( $blog\_id = null ) { |
| [827](#L827) | if ( ai1wm\_is\_mainsite( $blog\_id ) ) { |
| [828](#L828) | return '/wp-content/uploads/'; |
| [829](#L829) | } |
| [830](#L830) |  |
| [831](#L831) | return sprintf( '/wp-content/uploads/sites/%d/', $blog\_id ); |
| [832](#L832) | } |
| [833](#L833) |  |
| [834](#L834) | /\*\* |
| [835](#L835) | \* Get uploads URL by blog ID |
| [836](#L836) | \* |
| [837](#L837) | \* @param  integer $blog\_id Blog ID |
| [838](#L838) | \* @return string |
| [839](#L839) | \*/ |
| [840](#L840) | function ai1wm\_blog\_uploads\_url( $blog\_id = null ) { |
| [841](#L841) | if ( ai1wm\_is\_mainsite( $blog\_id ) ) { |
| [842](#L842) | return sprintf( '/%s/', ai1wm\_get\_uploads\_path() ); |
| [843](#L843) | } |
| [844](#L844) |  |
| [845](#L845) | return sprintf( '/%s/sites/%d/', ai1wm\_get\_uploads\_path(), $blog\_id ); |
| [846](#L846) | } |
| [847](#L847) |  |
| [848](#L848) | /\*\* |
| [849](#L849) | \* Get ServMask table prefix by blog ID |
| [850](#L850) | \* |
| [851](#L851) | \* @param  integer $blog\_id Blog ID |
| [852](#L852) | \* @return string |
| [853](#L853) | \*/ |
| [854](#L854) | function ai1wm\_servmask\_prefix( $blog\_id = null ) { |
| [855](#L855) | if ( ai1wm\_is\_mainsite( $blog\_id ) ) { |
| [856](#L856) | return AI1WM\_TABLE\_PREFIX; |
| [857](#L857) | } |
| [858](#L858) |  |
| [859](#L859) | return AI1WM\_TABLE\_PREFIX . $blog\_id . '\_'; |
| [860](#L860) | } |
| [861](#L861) |  |
| [862](#L862) | /\*\* |
| [863](#L863) | \* Get WordPress table prefix by blog ID |
| [864](#L864) | \* |
| [865](#L865) | \* @param  integer $blog\_id Blog ID |
| [866](#L866) | \* @return string |
| [867](#L867) | \*/ |
| [868](#L868) | function ai1wm\_table\_prefix( $blog\_id = null ) { |
| [869](#L869) | global $wpdb; |
| [870](#L870) |  |
| [871](#L871) | // Set base table prefix |
| [872](#L872) | if ( ai1wm\_is\_mainsite( $blog\_id ) ) { |
| [873](#L873) | return $wpdb->base\_prefix; |
| [874](#L874) | } |
| [875](#L875) |  |
| [876](#L876) | return $wpdb->base\_prefix . $blog\_id . '\_'; |
| [877](#L877) | } |
| [878](#L878) |  |
| [879](#L879) | /\*\* |
| [880](#L880) | \* Get default content filters |
| [881](#L881) | \* |
| [882](#L882) | \* @param  array $filters List of files and directories |
| [883](#L883) | \* @return array |
| [884](#L884) | \*/ |
| [885](#L885) | function ai1wm\_content\_filters( $filters = array() ) { |
| [886](#L886) | return array\_merge( |
| [887](#L887) | $filters, |
| [888](#L888) | array( |
| [889](#L889) | AI1WM\_BACKUPS\_PATH, |
| [890](#L890) | AI1WM\_BACKUPS\_NAME, |
| [891](#L891) | AI1WM\_PACKAGE\_NAME, |
| [892](#L892) | AI1WM\_MULTISITE\_NAME, |
| [893](#L893) | AI1WM\_DATABASE\_NAME, |
| [894](#L894) | AI1WM\_W3TC\_CONFIG\_FILE, |
| [895](#L895) | ) |
| [896](#L896) | ); |
| [897](#L897) | } |
| [898](#L898) |  |
| [899](#L899) | /\*\* |
| [900](#L900) | \* Get default media filters |
| [901](#L901) | \* |
| [902](#L902) | \* @param  array $filters List of files and directories |
| [903](#L903) | \* @return array |
| [904](#L904) | \*/ |
| [905](#L905) | function ai1wm\_media\_filters( $filters = array() ) { |
| [906](#L906) | return array\_merge( |
| [907](#L907) | $filters, |
| [908](#L908) | array( |
| [909](#L909) | AI1WM\_BACKUPS\_PATH, |
| [910](#L910) | ) |
| [911](#L911) | ); |
| [912](#L912) | } |
| [913](#L913) |  |
| [914](#L914) | /\*\* |
| [915](#L915) | \* Get default plugin filters |
| [916](#L916) | \* |
| [917](#L917) | \* @param  array $filters List of plugins |
| [918](#L918) | \* @return array |
| [919](#L919) | \*/ |
| [920](#L920) | function ai1wm\_plugin\_filters( $filters = array() ) { |
| [921](#L921) | return array\_merge( |
| [922](#L922) | $filters, |
| [923](#L923) | array( |
| [924](#L924) | AI1WM\_BACKUPS\_PATH, |
| [925](#L925) | AI1WM\_PLUGIN\_BASEDIR, |
| [926](#L926) | AI1WMZE\_PLUGIN\_BASEDIR, |
| [927](#L927) | AI1WMAE\_PLUGIN\_BASEDIR, |
| [928](#L928) | AI1WMVE\_PLUGIN\_BASEDIR, |
| [929](#L929) | AI1WMBE\_PLUGIN\_BASEDIR, |
| [930](#L930) | AI1WMIE\_PLUGIN\_BASEDIR, |
| [931](#L931) | AI1WMXE\_PLUGIN\_BASEDIR, |
| [932](#L932) | AI1WMDE\_PLUGIN\_BASEDIR, |
| [933](#L933) | AI1WMTE\_PLUGIN\_BASEDIR, |
| [934](#L934) | AI1WMFE\_PLUGIN\_BASEDIR, |
| [935](#L935) | AI1WMCE\_PLUGIN\_BASEDIR, |
| [936](#L936) | AI1WMGE\_PLUGIN\_BASEDIR, |
| [937](#L937) | AI1WMRE\_PLUGIN\_BASEDIR, |
| [938](#L938) | AI1WMEE\_PLUGIN\_BASEDIR, |
| [939](#L939) | AI1WMME\_PLUGIN\_BASEDIR, |
| [940](#L940) | AI1WMOE\_PLUGIN\_BASEDIR, |
| [941](#L941) | AI1WMPE\_PLUGIN\_BASEDIR, |
| [942](#L942) | AI1WMKE\_PLUGIN\_BASEDIR, |
| [943](#L943) | AI1WMNE\_PLUGIN\_BASEDIR, |
| [944](#L944) | AI1WMSE\_PLUGIN\_BASEDIR, |
| [945](#L945) | AI1WMUE\_PLUGIN\_BASEDIR, |
| [946](#L946) | AI1WMLE\_PLUGIN\_BASEDIR, |
| [947](#L947) | AI1WMWE\_PLUGIN\_BASEDIR, |
| [948](#L948) | ) |
| [949](#L949) | ); |
| [950](#L950) |  |
| [951](#L951) | return $filters; |
| [952](#L952) | } |
| [953](#L953) |  |
| [954](#L954) | /\*\* |
| [955](#L955) | \* Get default theme filters |
| [956](#L956) | \* |
| [957](#L957) | \* @param  array $filters List of files and directories |
| [958](#L958) | \* @return array |
| [959](#L959) | \*/ |
| [960](#L960) | function ai1wm\_theme\_filters( $filters = array() ) { |
| [961](#L961) | return array\_merge( |
| [962](#L962) | $filters, |
| [963](#L963) | array( |
| [964](#L964) | AI1WM\_BACKUPS\_PATH, |
| [965](#L965) | ) |
| [966](#L966) | ); |
| [967](#L967) | } |
| [968](#L968) |  |
| [969](#L969) | /\*\* |
| [970](#L970) | \* Get active ServMask plugins |
| [971](#L971) | \* |
| [972](#L972) | \* @return array |
| [973](#L973) | \*/ |
| [974](#L974) | function ai1wm\_active\_servmask\_plugins( $plugins = array() ) { |
| [975](#L975) | // WP Migration Plugin |
| [976](#L976) | if ( defined( 'AI1WM\_PLUGIN\_BASENAME' ) ) { |
| [977](#L977) | $plugins[] = AI1WM\_PLUGIN\_BASENAME; |
| [978](#L978) | } |
| [979](#L979) |  |
| [980](#L980) | // Microsoft Azure Extension |
| [981](#L981) | if ( defined( 'AI1WMZE\_PLUGIN\_BASENAME' ) ) { |
| [982](#L982) | $plugins[] = AI1WMZE\_PLUGIN\_BASENAME; |
| [983](#L983) | } |
| [984](#L984) |  |
| [985](#L985) | // Backblaze B2 Extension |
| [986](#L986) | if ( defined( 'AI1WMAE\_PLUGIN\_BASENAME' ) ) { |
| [987](#L987) | $plugins[] = AI1WMAE\_PLUGIN\_BASENAME; |
| [988](#L988) | } |
| [989](#L989) |  |
| [990](#L990) | // Backup Plugin |
| [991](#L991) | if ( defined( 'AI1WMVE\_PLUGIN\_BASENAME' ) ) { |
| [992](#L992) | $plugins[] = AI1WMVE\_PLUGIN\_BASENAME; |
| [993](#L993) | } |
| [994](#L994) |  |
| [995](#L995) | // Box Extension |
| [996](#L996) | if ( defined( 'AI1WMBE\_PLUGIN\_BASENAME' ) ) { |
| [997](#L997) | $plugins[] = AI1WMBE\_PLUGIN\_BASENAME; |
| [998](#L998) | } |
| [999](#L999) |  |
| [1000](#L1000) | // DigitalOcean Spaces Extension |
| [1001](#L1001) | if ( defined( 'AI1WMIE\_PLUGIN\_BASENAME' ) ) { |
| [1002](#L1002) | $plugins[] = AI1WMIE\_PLUGIN\_BASENAME; |
| [1003](#L1003) | } |
| [1004](#L1004) |  |
| [1005](#L1005) | // Direct Extension |
| [1006](#L1006) | if ( defined( 'AI1WMXE\_PLUGIN\_BASENAME' ) ) { |
| [1007](#L1007) | $plugins[] = AI1WMXE\_PLUGIN\_BASENAME; |
| [1008](#L1008) | } |
| [1009](#L1009) |  |
| [1010](#L1010) | // Dropbox Extension |
| [1011](#L1011) | if ( defined( 'AI1WMDE\_PLUGIN\_BASENAME' ) ) { |
| [1012](#L1012) | $plugins[] = AI1WMDE\_PLUGIN\_BASENAME; |
| [1013](#L1013) | } |
| [1014](#L1014) |  |
| [1015](#L1015) | // File Extension |
| [1016](#L1016) | if ( defined( 'AI1WMTE\_PLUGIN\_BASENAME' ) ) { |
| [1017](#L1017) | $plugins[] = AI1WMTE\_PLUGIN\_BASENAME; |
| [1018](#L1018) | } |
| [1019](#L1019) |  |
| [1020](#L1020) | // FTP Extension |
| [1021](#L1021) | if ( defined( 'AI1WMFE\_PLUGIN\_BASENAME' ) ) { |
| [1022](#L1022) | $plugins[] = AI1WMFE\_PLUGIN\_BASENAME; |
| [1023](#L1023) | } |
| [1024](#L1024) |  |
| [1025](#L1025) | // Google Cloud Storage Extension |
| [1026](#L1026) | if ( defined( 'AI1WMCE\_PLUGIN\_BASENAME' ) ) { |
| [1027](#L1027) | $plugins[] = AI1WMCE\_PLUGIN\_BASENAME; |
| [1028](#L1028) | } |
| [1029](#L1029) |  |
| [1030](#L1030) | // Google Drive Extension |
| [1031](#L1031) | if ( defined( 'AI1WMGE\_PLUGIN\_BASENAME' ) ) { |
| [1032](#L1032) | $plugins[] = AI1WMGE\_PLUGIN\_BASENAME; |
| [1033](#L1033) | } |
| [1034](#L1034) |  |
| [1035](#L1035) | // Amazon Glacier Extension |
| [1036](#L1036) | if ( defined( 'AI1WMRE\_PLUGIN\_BASENAME' ) ) { |
| [1037](#L1037) | $plugins[] = AI1WMRE\_PLUGIN\_BASENAME; |
| [1038](#L1038) | } |
| [1039](#L1039) |  |
| [1040](#L1040) | // Mega Extension |
| [1041](#L1041) | if ( defined( 'AI1WMEE\_PLUGIN\_BASENAME' ) ) { |
| [1042](#L1042) | $plugins[] = AI1WMEE\_PLUGIN\_BASENAME; |
| [1043](#L1043) | } |
| [1044](#L1044) |  |
| [1045](#L1045) | // Multisite Extension |
| [1046](#L1046) | if ( defined( 'AI1WMME\_PLUGIN\_BASENAME' ) ) { |
| [1047](#L1047) | $plugins[] = AI1WMME\_PLUGIN\_BASENAME; |
| [1048](#L1048) | } |
| [1049](#L1049) |  |
| [1050](#L1050) | // OneDrive Extension |
| [1051](#L1051) | if ( defined( 'AI1WMOE\_PLUGIN\_BASENAME' ) ) { |
| [1052](#L1052) | $plugins[] = AI1WMOE\_PLUGIN\_BASENAME; |
| [1053](#L1053) | } |
| [1054](#L1054) |  |
| [1055](#L1055) | // pCloud Extension |
| [1056](#L1056) | if ( defined( 'AI1WMPE\_PLUGIN\_BASENAME' ) ) { |
| [1057](#L1057) | $plugins[] = AI1WMPE\_PLUGIN\_BASENAME; |
| [1058](#L1058) | } |
| [1059](#L1059) |  |
| [1060](#L1060) | // Pro Plugin |
| [1061](#L1061) | if ( defined( 'AI1WMKE\_PLUGIN\_BASENAME' ) ) { |
| [1062](#L1062) | $plugins[] = AI1WMKE\_PLUGIN\_BASENAME; |
| [1063](#L1063) | } |
| [1064](#L1064) |  |
| [1065](#L1065) | // S3 Client Extension |
| [1066](#L1066) | if ( defined( 'AI1WMNE\_PLUGIN\_BASENAME' ) ) { |
| [1067](#L1067) | $plugins[] = AI1WMNE\_PLUGIN\_BASENAME; |
| [1068](#L1068) | } |
| [1069](#L1069) |  |
| [1070](#L1070) | // Amazon S3 Extension |
| [1071](#L1071) | if ( defined( 'AI1WMSE\_PLUGIN\_BASENAME' ) ) { |
| [1072](#L1072) | $plugins[] = AI1WMSE\_PLUGIN\_BASENAME; |
| [1073](#L1073) | } |
| [1074](#L1074) |  |
| [1075](#L1075) | // Unlimited Extension |
| [1076](#L1076) | if ( defined( 'AI1WMUE\_PLUGIN\_BASENAME' ) ) { |
| [1077](#L1077) | $plugins[] = AI1WMUE\_PLUGIN\_BASENAME; |
| [1078](#L1078) | } |
| [1079](#L1079) |  |
| [1080](#L1080) | // URL Extension |
| [1081](#L1081) | if ( defined( 'AI1WMLE\_PLUGIN\_BASENAME' ) ) { |
| [1082](#L1082) | $plugins[] = AI1WMLE\_PLUGIN\_BASENAME; |
| [1083](#L1083) | } |
| [1084](#L1084) |  |
| [1085](#L1085) | // WebDAV Extension |
| [1086](#L1086) | if ( defined( 'AI1WMWE\_PLUGIN\_BASENAME' ) ) { |
| [1087](#L1087) | $plugins[] = AI1WMWE\_PLUGIN\_BASENAME; |
| [1088](#L1088) | } |
| [1089](#L1089) |  |
| [1090](#L1090) | return $plugins; |
| [1091](#L1091) | } |
| [1092](#L1092) |  |
| [1093](#L1093) | /\*\* |
| [1094](#L1094) | \* Get active sitewide plugins |
| [1095](#L1095) | \* |
| [1096](#L1096) | \* @return array |
| [1097](#L1097) | \*/ |
| [1098](#L1098) | function ai1wm\_active\_sitewide\_plugins() { |
| [1099](#L1099) | return array\_keys( get\_site\_option( AI1WM\_ACTIVE\_SITEWIDE\_PLUGINS, array() ) ); |
| [1100](#L1100) | } |
| [1101](#L1101) |  |
| [1102](#L1102) | /\*\* |
| [1103](#L1103) | \* Get active plugins |
| [1104](#L1104) | \* |
| [1105](#L1105) | \* @return array |
| [1106](#L1106) | \*/ |
| [1107](#L1107) | function ai1wm\_active\_plugins() { |
| [1108](#L1108) | return array\_values( get\_option( AI1WM\_ACTIVE\_PLUGINS, array() ) ); |
| [1109](#L1109) | } |
| [1110](#L1110) |  |
| [1111](#L1111) | /\*\* |
| [1112](#L1112) | \* Set active sitewide plugins (inspired by WordPress activate\_plugins() function) |
| [1113](#L1113) | \* |
| [1114](#L1114) | \* @param  array   $plugins List of plugins |
| [1115](#L1115) | \* @return boolean |
| [1116](#L1116) | \*/ |
| [1117](#L1117) | function ai1wm\_activate\_sitewide\_plugins( $plugins ) { |
| [1118](#L1118) | $current = get\_site\_option( AI1WM\_ACTIVE\_SITEWIDE\_PLUGINS, array() ); |
| [1119](#L1119) |  |
| [1120](#L1120) | // Add plugins |
| [1121](#L1121) | foreach ( $plugins as $plugin ) { |
| [1122](#L1122) | if ( ! isset( $current[ $plugin ] ) && ! is\_wp\_error( validate\_plugin( $plugin ) ) ) { |
| [1123](#L1123) | $current[ $plugin ] = time(); |
| [1124](#L1124) | } |
| [1125](#L1125) | } |
| [1126](#L1126) |  |
| [1127](#L1127) | return update\_site\_option( AI1WM\_ACTIVE\_SITEWIDE\_PLUGINS, $current ); |
| [1128](#L1128) | } |
| [1129](#L1129) |  |
| [1130](#L1130) | /\*\* |
| [1131](#L1131) | \* Set active plugins (inspired by WordPress activate\_plugins() function) |
| [1132](#L1132) | \* |
| [1133](#L1133) | \* @param  array   $plugins List of plugins |
| [1134](#L1134) | \* @return boolean |
| [1135](#L1135) | \*/ |
| [1136](#L1136) | function ai1wm\_activate\_plugins( $plugins ) { |
| [1137](#L1137) | $current = get\_option( AI1WM\_ACTIVE\_PLUGINS, array() ); |
| [1138](#L1138) |  |
| [1139](#L1139) | // Add plugins |
| [1140](#L1140) | foreach ( $plugins as $plugin ) { |
| [1141](#L1141) | if ( ! in\_array( $plugin, $current ) && ! is\_wp\_error( validate\_plugin( $plugin ) ) ) { |
| [1142](#L1142) | $current[] = $plugin; |
| [1143](#L1143) | } |
| [1144](#L1144) | } |
| [1145](#L1145) |  |
| [1146](#L1146) | return update\_option( AI1WM\_ACTIVE\_PLUGINS, $current ); |
| [1147](#L1147) | } |
| [1148](#L1148) |  |
| [1149](#L1149) | /\*\* |
| [1150](#L1150) | \* Get active template |
| [1151](#L1151) | \* |
| [1152](#L1152) | \* @return string |
| [1153](#L1153) | \*/ |
| [1154](#L1154) | function ai1wm\_active\_template() { |
| [1155](#L1155) | return get\_option( AI1WM\_ACTIVE\_TEMPLATE ); |
| [1156](#L1156) | } |
| [1157](#L1157) |  |
| [1158](#L1158) | /\*\* |
| [1159](#L1159) | \* Get active stylesheet |
| [1160](#L1160) | \* |
| [1161](#L1161) | \* @return string |
| [1162](#L1162) | \*/ |
| [1163](#L1163) | function ai1wm\_active\_stylesheet() { |
| [1164](#L1164) | return get\_option( AI1WM\_ACTIVE\_STYLESHEET ); |
| [1165](#L1165) | } |
| [1166](#L1166) |  |
| [1167](#L1167) | /\*\* |
| [1168](#L1168) | \* Set active template |
| [1169](#L1169) | \* |
| [1170](#L1170) | \* @param  string  $template Template name |
| [1171](#L1171) | \* @return boolean |
| [1172](#L1172) | \*/ |
| [1173](#L1173) | function ai1wm\_activate\_template( $template ) { |
| [1174](#L1174) | return update\_option( AI1WM\_ACTIVE\_TEMPLATE, $template ); |
| [1175](#L1175) | } |
| [1176](#L1176) |  |
| [1177](#L1177) | /\*\* |
| [1178](#L1178) | \* Set active stylesheet |
| [1179](#L1179) | \* |
| [1180](#L1180) | \* @param  string  $stylesheet Stylesheet name |
| [1181](#L1181) | \* @return boolean |
| [1182](#L1182) | \*/ |
| [1183](#L1183) | function ai1wm\_activate\_stylesheet( $stylesheet ) { |
| [1184](#L1184) | return update\_option( AI1WM\_ACTIVE\_STYLESHEET, $stylesheet ); |
| [1185](#L1185) | } |
| [1186](#L1186) |  |
| [1187](#L1187) | /\*\* |
| [1188](#L1188) | \* Set inactive sitewide plugins (inspired by WordPress deactivate\_plugins() function) |
| [1189](#L1189) | \* |
| [1190](#L1190) | \* @param  array   $plugins List of plugins |
| [1191](#L1191) | \* @return boolean |
| [1192](#L1192) | \*/ |
| [1193](#L1193) | function ai1wm\_deactivate\_sitewide\_plugins( $plugins ) { |
| [1194](#L1194) | $current = get\_site\_option( AI1WM\_ACTIVE\_SITEWIDE\_PLUGINS, array() ); |
| [1195](#L1195) |  |
| [1196](#L1196) | // Add plugins |
| [1197](#L1197) | foreach ( $plugins as $plugin ) { |
| [1198](#L1198) | if ( isset( $current[ $plugin ] ) ) { |
| [1199](#L1199) | unset( $current[ $plugin ] ); |
| [1200](#L1200) | } |
| [1201](#L1201) | } |
| [1202](#L1202) |  |
| [1203](#L1203) | return update\_site\_option( AI1WM\_ACTIVE\_SITEWIDE\_PLUGINS, $current ); |
| [1204](#L1204) | } |
| [1205](#L1205) |  |
| [1206](#L1206) |  |
| [1207](#L1207) | /\*\* |
| [1208](#L1208) | \* Set inactive plugins (inspired by WordPress deactivate\_plugins() function) |
| [1209](#L1209) | \* |
| [1210](#L1210) | \* @param  array   $plugins List of plugins |
| [1211](#L1211) | \* @return boolean |
| [1212](#L1212) | \*/ |
| [1213](#L1213) | function ai1wm\_deactivate\_plugins( $plugins ) { |
| [1214](#L1214) | $current = get\_option( AI1WM\_ACTIVE\_PLUGINS, array() ); |
| [1215](#L1215) |  |
| [1216](#L1216) | // Remove plugins |
| [1217](#L1217) | foreach ( $plugins as $plugin ) { |
| [1218](#L1218) | if ( ( $key = array\_search( $plugin, $current ) ) !== false ) { |
| [1219](#L1219) | unset( $current[ $key ] ); |
| [1220](#L1220) | } |
| [1221](#L1221) | } |
| [1222](#L1222) |  |
| [1223](#L1223) | return update\_option( AI1WM\_ACTIVE\_PLUGINS, $current ); |
| [1224](#L1224) | } |
| [1225](#L1225) |  |
| [1226](#L1226) | /\*\* |
| [1227](#L1227) | \* Deactivate Jetpack modules |
| [1228](#L1228) | \* |
| [1229](#L1229) | \* @param  array   $modules List of modules |
| [1230](#L1230) | \* @return boolean |
| [1231](#L1231) | \*/ |
| [1232](#L1232) | function ai1wm\_deactivate\_jetpack\_modules( $modules ) { |
| [1233](#L1233) | $current = get\_option( AI1WM\_JETPACK\_ACTIVE\_MODULES, array() ); |
| [1234](#L1234) |  |
| [1235](#L1235) | // Remove modules |
| [1236](#L1236) | foreach ( $modules as $module ) { |
| [1237](#L1237) | if ( ( $key = array\_search( $module, $current ) ) !== false ) { |
| [1238](#L1238) | unset( $current[ $key ] ); |
| [1239](#L1239) | } |
| [1240](#L1240) | } |
| [1241](#L1241) |  |
| [1242](#L1242) | return update\_option( AI1WM\_JETPACK\_ACTIVE\_MODULES, $current ); |
| [1243](#L1243) | } |
| [1244](#L1244) |  |
| [1245](#L1245) | /\*\* |
| [1246](#L1246) | \* Deactivate Swift Optimizer rules |
| [1247](#L1247) | \* |
| [1248](#L1248) | \* @param  array   $rules List of rules |
| [1249](#L1249) | \* @return boolean |
| [1250](#L1250) | \*/ |
| [1251](#L1251) | function ai1wm\_deactivate\_swift\_optimizer\_rules( $rules ) { |
| [1252](#L1252) | $current = get\_option( AI1WM\_SWIFT\_OPTIMIZER\_PLUGIN\_ORGANIZER, array() ); |
| [1253](#L1253) |  |
| [1254](#L1254) | // Remove rules |
| [1255](#L1255) | foreach ( $rules as $rule ) { |
| [1256](#L1256) | unset( $current['rules'][ $rule ] ); |
| [1257](#L1257) | } |
| [1258](#L1258) |  |
| [1259](#L1259) | return update\_option( AI1WM\_SWIFT\_OPTIMIZER\_PLUGIN\_ORGANIZER, $current ); |
| [1260](#L1260) | } |
| [1261](#L1261) |  |
| [1262](#L1262) | /\*\* |
| [1263](#L1263) | \* Deactivate sitewide Revolution Slider |
| [1264](#L1264) | \* |
| [1265](#L1265) | \* @param  string  $basename Plugin basename |
| [1266](#L1266) | \* @return boolean |
| [1267](#L1267) | \*/ |
| [1268](#L1268) | function ai1wm\_deactivate\_sitewide\_revolution\_slider( $basename ) { |
| [1269](#L1269) | if ( ( $plugins = get\_plugins() ) ) { |
| [1270](#L1270) | if ( isset( $plugins[ $basename ]['Version'] ) && ( $version = $plugins[ $basename ]['Version'] ) ) { |
| [1271](#L1271) | if ( version\_compare( PHP\_VERSION, '7.3', '>=' ) && version\_compare( $version, '5.4.8.3', '<' ) ) { |
| [1272](#L1272) | return ai1wm\_deactivate\_sitewide\_plugins( array( $basename ) ); |
| [1273](#L1273) | } |
| [1274](#L1274) |  |
| [1275](#L1275) | if ( version\_compare( PHP\_VERSION, '7.2', '>=' ) && version\_compare( $version, '5.4.6', '<' ) ) { |
| [1276](#L1276) | return ai1wm\_deactivate\_sitewide\_plugins( array( $basename ) ); |
| [1277](#L1277) | } |
| [1278](#L1278) |  |
| [1279](#L1279) | if ( version\_compare( PHP\_VERSION, '7.1', '>=' ) && version\_compare( $version, '5.4.1', '<' ) ) { |
| [1280](#L1280) | return ai1wm\_deactivate\_sitewide\_plugins( array( $basename ) ); |
| [1281](#L1281) | } |
| [1282](#L1282) |  |
| [1283](#L1283) | if ( version\_compare( PHP\_VERSION, '7.0', '>=' ) && version\_compare( $version, '4.6.5', '<' ) ) { |
| [1284](#L1284) | return ai1wm\_deactivate\_sitewide\_plugins( array( $basename ) ); |
| [1285](#L1285) | } |
| [1286](#L1286) | } |
| [1287](#L1287) | } |
| [1288](#L1288) |  |
| [1289](#L1289) | return false; |
| [1290](#L1290) | } |
| [1291](#L1291) |  |
| [1292](#L1292) | /\*\* |
| [1293](#L1293) | \* Deactivate Revolution Slider |
| [1294](#L1294) | \* |
| [1295](#L1295) | \* @param  string  $basename Plugin basename |
| [1296](#L1296) | \* @return boolean |
| [1297](#L1297) | \*/ |
| [1298](#L1298) | function ai1wm\_deactivate\_revolution\_slider( $basename ) { |
| [1299](#L1299) | if ( ( $plugins = get\_plugins() ) ) { |
| [1300](#L1300) | if ( isset( $plugins[ $basename ]['Version'] ) && ( $version = $plugins[ $basename ]['Version'] ) ) { |
| [1301](#L1301) | if ( version\_compare( PHP\_VERSION, '7.3', '>=' ) && version\_compare( $version, '5.4.8.3', '<' ) ) { |
| [1302](#L1302) | return ai1wm\_deactivate\_plugins( array( $basename ) ); |
| [1303](#L1303) | } |
| [1304](#L1304) |  |
| [1305](#L1305) | if ( version\_compare( PHP\_VERSION, '7.2', '>=' ) && version\_compare( $version, '5.4.6', '<' ) ) { |
| [1306](#L1306) | return ai1wm\_deactivate\_plugins( array( $basename ) ); |
| [1307](#L1307) | } |
| [1308](#L1308) |  |
| [1309](#L1309) | if ( version\_compare( PHP\_VERSION, '7.1', '>=' ) && version\_compare( $version, '5.4.1', '<' ) ) { |
| [1310](#L1310) | return ai1wm\_deactivate\_plugins( array( $basename ) ); |
| [1311](#L1311) | } |
| [1312](#L1312) |  |
| [1313](#L1313) | if ( version\_compare( PHP\_VERSION, '7.0', '>=' ) && version\_compare( $version, '4.6.5', '<' ) ) { |
| [1314](#L1314) | return ai1wm\_deactivate\_plugins( array( $basename ) ); |
| [1315](#L1315) | } |
| [1316](#L1316) | } |
| [1317](#L1317) | } |
| [1318](#L1318) |  |
| [1319](#L1319) | return false; |
| [1320](#L1320) | } |
| [1321](#L1321) |  |
| [1322](#L1322) | /\*\* |
| [1323](#L1323) | \* Initial DB version |
| [1324](#L1324) | \* |
| [1325](#L1325) | \* @return boolean |
| [1326](#L1326) | \*/ |
| [1327](#L1327) | function ai1wm\_initial\_db\_version() { |
| [1328](#L1328) | if ( ! get\_option( AI1WM\_DB\_VERSION ) ) { |
| [1329](#L1329) | return update\_option( AI1WM\_DB\_VERSION, get\_option( AI1WM\_INITIAL\_DB\_VERSION ) ); |
| [1330](#L1330) | } |
| [1331](#L1331) |  |
| [1332](#L1332) | return false; |
| [1333](#L1333) | } |
| [1334](#L1334) |  |
| [1335](#L1335) | /\*\* |
| [1336](#L1336) | \* Discover plugin basename |
| [1337](#L1337) | \* |
| [1338](#L1338) | \* @param  string $basename Plugin basename |
| [1339](#L1339) | \* @return string |
| [1340](#L1340) | \*/ |
| [1341](#L1341) | function ai1wm\_discover\_plugin\_basename( $basename ) { |
| [1342](#L1342) | if ( ( $plugins = get\_plugins() ) ) { |
| [1343](#L1343) | foreach ( $plugins as $plugin => $info ) { |
| [1344](#L1344) | if ( strpos( dirname( $plugin ), dirname( $basename ) ) !== false ) { |
| [1345](#L1345) | if ( basename( $plugin ) === basename( $basename ) ) { |
| [1346](#L1346) | return $plugin; |
| [1347](#L1347) | } |
| [1348](#L1348) | } |
| [1349](#L1349) | } |
| [1350](#L1350) | } |
| [1351](#L1351) |  |
| [1352](#L1352) | return $basename; |
| [1353](#L1353) | } |
| [1354](#L1354) |  |
| [1355](#L1355) | /\*\* |
| [1356](#L1356) | \* Validate plugin basename |
| [1357](#L1357) | \* |
| [1358](#L1358) | \* @param  string  $basename Plugin basename |
| [1359](#L1359) | \* @return boolean |
| [1360](#L1360) | \*/ |
| [1361](#L1361) | function ai1wm\_validate\_plugin\_basename( $basename ) { |
| [1362](#L1362) | if ( ( $plugins = get\_plugins() ) ) { |
| [1363](#L1363) | foreach ( $plugins as $plugin => $info ) { |
| [1364](#L1364) | if ( $plugin === $basename ) { |
| [1365](#L1365) | return true; |
| [1366](#L1366) | } |
| [1367](#L1367) | } |
| [1368](#L1368) | } |
| [1369](#L1369) |  |
| [1370](#L1370) | return false; |
| [1371](#L1371) | } |
| [1372](#L1372) |  |
| [1373](#L1373) | /\*\* |
| [1374](#L1374) | \* Validate theme basename |
| [1375](#L1375) | \* |
| [1376](#L1376) | \* @param  string  $basename Theme basename |
| [1377](#L1377) | \* @return boolean |
| [1378](#L1378) | \*/ |
| [1379](#L1379) | function ai1wm\_validate\_theme\_basename( $basename ) { |
| [1380](#L1380) | if ( ( $themes = search\_theme\_directories() ) ) { |
| [1381](#L1381) | foreach ( $themes as $theme => $info ) { |
| [1382](#L1382) | if ( $info['theme\_file'] === $basename ) { |
| [1383](#L1383) | return true; |
| [1384](#L1384) | } |
| [1385](#L1385) | } |
| [1386](#L1386) | } |
| [1387](#L1387) |  |
| [1388](#L1388) | return false; |
| [1389](#L1389) | } |
| [1390](#L1390) |  |
| [1391](#L1391) | /\*\* |
| [1392](#L1392) | \* Flush WP options cache |
| [1393](#L1393) | \* |
| [1394](#L1394) | \* @return void |
| [1395](#L1395) | \*/ |
| [1396](#L1396) | function ai1wm\_cache\_flush() { |
| [1397](#L1397) | wp\_cache\_init(); |
| [1398](#L1398) | wp\_cache\_flush(); |
| [1399](#L1399) |  |
| [1400](#L1400) | // Reset WP options cache |
| [1401](#L1401) | wp\_cache\_set( 'alloptions', array(), 'options' ); |
| [1402](#L1402) | wp\_cache\_set( 'notoptions', array(), 'options' ); |
| [1403](#L1403) |  |
| [1404](#L1404) | // Reset WP sitemeta cache |
| [1405](#L1405) | wp\_cache\_set( '1:notoptions', array(), 'site-options' ); |
| [1406](#L1406) | wp\_cache\_set( '1:ms\_files\_rewriting', false, 'site-options' ); |
| [1407](#L1407) | wp\_cache\_set( '1:active\_sitewide\_plugins', false, 'site-options' ); |
| [1408](#L1408) |  |
| [1409](#L1409) | // Delete WP options cache |
| [1410](#L1410) | wp\_cache\_delete( 'alloptions', 'options' ); |
| [1411](#L1411) | wp\_cache\_delete( 'notoptions', 'options' ); |
| [1412](#L1412) |  |
| [1413](#L1413) | // Delete WP sitemeta cache |
| [1414](#L1414) | wp\_cache\_delete( '1:notoptions', 'site-options' ); |
| [1415](#L1415) | wp\_cache\_delete( '1:ms\_files\_rewriting', 'site-options' ); |
| [1416](#L1416) | wp\_cache\_delete( '1:active\_sitewide\_plugins', 'site-options' ); |
| [1417](#L1417) |  |
| [1418](#L1418) | // Remove WP options filter |
| [1419](#L1419) | remove\_all\_filters( 'sanitize\_option\_home' ); |
| [1420](#L1420) | remove\_all\_filters( 'sanitize\_option\_siteurl' ); |
| [1421](#L1421) | remove\_all\_filters( 'default\_site\_option\_ms\_files\_rewriting' ); |
| [1422](#L1422) | } |
| [1423](#L1423) |  |
| [1424](#L1424) | /\*\* |
| [1425](#L1425) | \* Flush Elementor cache |
| [1426](#L1426) | \* |
| [1427](#L1427) | \* @return void |
| [1428](#L1428) | \*/ |
| [1429](#L1429) | function ai1wm\_elementor\_cache\_flush() { |
| [1430](#L1430) | delete\_post\_meta\_by\_key( '\_elementor\_css' ); |
| [1431](#L1431) | delete\_option( '\_elementor\_global\_css' ); |
| [1432](#L1432) | delete\_option( 'elementor-custom-breakpoints-files' ); |
| [1433](#L1433) | } |
| [1434](#L1434) |  |
| [1435](#L1435) | /\*\* |
| [1436](#L1436) | \* Set WooCommerce Force SSL checkout |
| [1437](#L1437) | \* |
| [1438](#L1438) | \* @param  boolean $yes Force SSL checkout |
| [1439](#L1439) | \* @return void |
| [1440](#L1440) | \*/ |
| [1441](#L1441) | function ai1wm\_woocommerce\_force\_ssl( $yes = true ) { |
| [1442](#L1442) | if ( get\_option( 'woocommerce\_force\_ssl\_checkout' ) ) { |
| [1443](#L1443) | if ( $yes ) { |
| [1444](#L1444) | update\_option( 'woocommerce\_force\_ssl\_checkout', 'yes' ); |
| [1445](#L1445) | } else { |
| [1446](#L1446) | update\_option( 'woocommerce\_force\_ssl\_checkout', 'no' ); |
| [1447](#L1447) | } |
| [1448](#L1448) | } |
| [1449](#L1449) | } |
| [1450](#L1450) |  |
| [1451](#L1451) | /\*\* |
| [1452](#L1452) | \* Set URL scheme |
| [1453](#L1453) | \* |
| [1454](#L1454) | \* @param  string $url    URL value |
| [1455](#L1455) | \* @param  string $scheme URL scheme |
| [1456](#L1456) | \* @return string |
| [1457](#L1457) | \*/ |
| [1458](#L1458) | function ai1wm\_url\_scheme( $url, $scheme = '' ) { |
| [1459](#L1459) | if ( empty( $scheme ) ) { |
| [1460](#L1460) | return preg\_replace( '#^\w+://#', '//', $url ); |
| [1461](#L1461) | } |
| [1462](#L1462) |  |
| [1463](#L1463) | return preg\_replace( '#^\w+://#', $scheme . '://', $url ); |
| [1464](#L1464) | } |
| [1465](#L1465) |  |
| [1466](#L1466) | /\*\* |
| [1467](#L1467) | \* Opens a file in specified mode |
| [1468](#L1468) | \* |
| [1469](#L1469) | \* @param  string   $file Path to the file to open |
| [1470](#L1470) | \* @param  string   $mode Mode in which to open the file |
| [1471](#L1471) | \* @return resource |
| [1472](#L1472) | \* @throws Ai1wm\_Not\_Accessible\_Exception |
| [1473](#L1473) | \*/ |
| [1474](#L1474) | function ai1wm\_open( $file, $mode ) { |
| [1475](#L1475) | $file\_handle = @fopen( $file, $mode ); |
| [1476](#L1476) | if ( false === $file\_handle ) { |
| [1477](#L1477) | throw new Ai1wm\_Not\_Accessible\_Exception( sprintf( \_\_( 'Unable to open %s with mode %s. <a href="https://help.servmask.com/knowledgebase/invalid-file-permissions/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ), $file, $mode ) ); |
| [1478](#L1478) | } |
| [1479](#L1479) |  |
| [1480](#L1480) | return $file\_handle; |
| [1481](#L1481) | } |
| [1482](#L1482) |  |
| [1483](#L1483) | /\*\* |
| [1484](#L1484) | \* Write contents to a file |
| [1485](#L1485) | \* |
| [1486](#L1486) | \* @param  resource $handle  File handle to write to |
| [1487](#L1487) | \* @param  string   $content Contents to write to the file |
| [1488](#L1488) | \* @return integer |
| [1489](#L1489) | \* @throws Ai1wm\_Not\_Writable\_Exception |
| [1490](#L1490) | \* @throws Ai1wm\_Quota\_Exceeded\_Exception |
| [1491](#L1491) | \*/ |
| [1492](#L1492) | function ai1wm\_write( $handle, $content ) { |
| [1493](#L1493) | $write\_result = @fwrite( $handle, $content ); |
| [1494](#L1494) | if ( false === $write\_result ) { |
| [1495](#L1495) | if ( ( $meta = stream\_get\_meta\_data( $handle ) ) ) { |
| [1496](#L1496) | throw new Ai1wm\_Not\_Writable\_Exception( sprintf( \_\_( 'Unable to write to: %s. <a href="https://help.servmask.com/knowledgebase/invalid-file-permissions/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ), $meta['uri'] ) ); |
| [1497](#L1497) | } |
| [1498](#L1498) | } elseif ( null === $write\_result ) { |
| [1499](#L1499) | return strlen( $content ); |
| [1500](#L1500) | } elseif ( strlen( $content ) !== $write\_result ) { |
| [1501](#L1501) | if ( ( $meta = stream\_get\_meta\_data( $handle ) ) ) { |
| [1502](#L1502) | throw new Ai1wm\_Quota\_Exceeded\_Exception( sprintf( \_\_( 'Out of disk space. Unable to write to: %s. <a href="https://help.servmask.com/knowledgebase/out-of-disk-space/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ), $meta['uri'] ) ); |
| [1503](#L1503) | } |
| [1504](#L1504) | } |
| [1505](#L1505) |  |
| [1506](#L1506) | return $write\_result; |
| [1507](#L1507) | } |
| [1508](#L1508) |  |
| [1509](#L1509) | /\*\* |
| [1510](#L1510) | \* Read contents from a file |
| [1511](#L1511) | \* |
| [1512](#L1512) | \* @param  resource $handle File handle to read from |
| [1513](#L1513) | \* @param  integer  $length Up to length number of bytes read |
| [1514](#L1514) | \* @return string |
| [1515](#L1515) | \* @throws Ai1wm\_Not\_Readable\_Exception |
| [1516](#L1516) | \*/ |
| [1517](#L1517) | function ai1wm\_read( $handle, $length ) { |
| [1518](#L1518) | if ( $length > 0 ) { |
| [1519](#L1519) | $read\_result = @fread( $handle, $length ); |
| [1520](#L1520) | if ( false === $read\_result ) { |
| [1521](#L1521) | if ( ( $meta = stream\_get\_meta\_data( $handle ) ) ) { |
| [1522](#L1522) | throw new Ai1wm\_Not\_Readable\_Exception( sprintf( \_\_( 'Unable to read file: %s. <a href="https://help.servmask.com/knowledgebase/invalid-file-permissions/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ), $meta['uri'] ) ); |
| [1523](#L1523) | } |
| [1524](#L1524) | } |
| [1525](#L1525) |  |
| [1526](#L1526) | return $read\_result; |
| [1527](#L1527) | } |
| [1528](#L1528) |  |
| [1529](#L1529) | return false; |
| [1530](#L1530) | } |
| [1531](#L1531) |  |
| [1532](#L1532) | /\*\* |
| [1533](#L1533) | \* Seeks on a file pointer |
| [1534](#L1534) | \* |
| [1535](#L1535) | \* @param  resource $handle File handle |
| [1536](#L1536) | \* @param  integer  $offset File offset |
| [1537](#L1537) | \* @param  integer  $mode   Offset mode |
| [1538](#L1538) | \* @return integer |
| [1539](#L1539) | \*/ |
| [1540](#L1540) | function ai1wm\_seek( $handle, $offset, $mode = SEEK\_SET ) { |
| [1541](#L1541) | $seek\_result = @fseek( $handle, $offset, $mode ); |
| [1542](#L1542) | if ( -1 === $seek\_result ) { |
| [1543](#L1543) | if ( ( $meta = stream\_get\_meta\_data( $handle ) ) ) { |
| [1544](#L1544) | throw new Ai1wm\_Not\_Seekable\_Exception( sprintf( \_\_( 'Unable to seek to offset %d on %s. <a href="https://help.servmask.com/knowledgebase/php-32bit/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ), $offset, $meta['uri'] ) ); |
| [1545](#L1545) | } |
| [1546](#L1546) | } |
| [1547](#L1547) |  |
| [1548](#L1548) | return $seek\_result; |
| [1549](#L1549) | } |
| [1550](#L1550) |  |
| [1551](#L1551) | /\*\* |
| [1552](#L1552) | \* Returns the current position of the file read/write pointer |
| [1553](#L1553) | \* |
| [1554](#L1554) | \* @param  resource $handle File handle |
| [1555](#L1555) | \* @return integer |
| [1556](#L1556) | \*/ |
| [1557](#L1557) | function ai1wm\_tell( $handle ) { |
| [1558](#L1558) | $tell\_result = @ftell( $handle ); |
| [1559](#L1559) | if ( false === $tell\_result ) { |
| [1560](#L1560) | if ( ( $meta = stream\_get\_meta\_data( $handle ) ) ) { |
| [1561](#L1561) | throw new Ai1wm\_Not\_Tellable\_Exception( sprintf( \_\_( 'Unable to get current pointer position of %s. <a href="https://help.servmask.com/knowledgebase/php-32bit/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ), $meta['uri'] ) ); |
| [1562](#L1562) | } |
| [1563](#L1563) | } |
| [1564](#L1564) |  |
| [1565](#L1565) | return $tell\_result; |
| [1566](#L1566) | } |
| [1567](#L1567) |  |
| [1568](#L1568) | /\*\* |
| [1569](#L1569) | \* Write fields to a file |
| [1570](#L1570) | \* |
| [1571](#L1571) | \* @param  resource $handle File handle to write to |
| [1572](#L1572) | \* @param  array    $fields Fields to write to the file |
| [1573](#L1573) | \* @return integer |
| [1574](#L1574) | \* @throws Ai1wm\_Not\_Writable\_Exception |
| [1575](#L1575) | \*/ |
| [1576](#L1576) | function ai1wm\_putcsv( $handle, $fields ) { |
| [1577](#L1577) | $write\_result = @fputcsv( $handle, $fields ); |
| [1578](#L1578) | if ( false === $write\_result ) { |
| [1579](#L1579) | if ( ( $meta = stream\_get\_meta\_data( $handle ) ) ) { |
| [1580](#L1580) | throw new Ai1wm\_Not\_Writable\_Exception( sprintf( \_\_( 'Unable to write to: %s. <a href="https://help.servmask.com/knowledgebase/invalid-file-permissions/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ), $meta['uri'] ) ); |
| [1581](#L1581) | } |
| [1582](#L1582) | } |
| [1583](#L1583) |  |
| [1584](#L1584) | return $write\_result; |
| [1585](#L1585) | } |
| [1586](#L1586) |  |
| [1587](#L1587) | /\*\* |
| [1588](#L1588) | \* Closes a file handle |
| [1589](#L1589) | \* |
| [1590](#L1590) | \* @param  resource $handle File handle to close |
| [1591](#L1591) | \* @return boolean |
| [1592](#L1592) | \*/ |
| [1593](#L1593) | function ai1wm\_close( $handle ) { |
| [1594](#L1594) | return @fclose( $handle ); |
| [1595](#L1595) | } |
| [1596](#L1596) |  |
| [1597](#L1597) | /\*\* |
| [1598](#L1598) | \* Deletes a file |
| [1599](#L1599) | \* |
| [1600](#L1600) | \* @param  string  $file Path to file to delete |
| [1601](#L1601) | \* @return boolean |
| [1602](#L1602) | \*/ |
| [1603](#L1603) | function ai1wm\_unlink( $file ) { |
| [1604](#L1604) | return @unlink( $file ); |
| [1605](#L1605) | } |
| [1606](#L1606) |  |
| [1607](#L1607) | /\*\* |
| [1608](#L1608) | \* Sets modification time of a file |
| [1609](#L1609) | \* |
| [1610](#L1610) | \* @param  string  $file Path to file to change modification time |
| [1611](#L1611) | \* @param  integer $time File modification time |
| [1612](#L1612) | \* @return boolean |
| [1613](#L1613) | \*/ |
| [1614](#L1614) | function ai1wm\_touch( $file, $mtime ) { |
| [1615](#L1615) | return @touch( $file, $mtime ); |
| [1616](#L1616) | } |
| [1617](#L1617) |  |
| [1618](#L1618) | /\*\* |
| [1619](#L1619) | \* Changes file mode |
| [1620](#L1620) | \* |
| [1621](#L1621) | \* @param  string  $file Path to file to change mode |
| [1622](#L1622) | \* @param  integer $time File mode |
| [1623](#L1623) | \* @return boolean |
| [1624](#L1624) | \*/ |
| [1625](#L1625) | function ai1wm\_chmod( $file, $mode ) { |
| [1626](#L1626) | return @chmod( $file, $mode ); |
| [1627](#L1627) | } |
| [1628](#L1628) |  |
| [1629](#L1629) | /\*\* |
| [1630](#L1630) | \* Copies one file's contents to another |
| [1631](#L1631) | \* |
| [1632](#L1632) | \* @param  string $source\_file      File to copy the contents from |
| [1633](#L1633) | \* @param  string $destination\_file File to copy the contents to |
| [1634](#L1634) | \*/ |
| [1635](#L1635) | function ai1wm\_copy( $source\_file, $destination\_file ) { |
| [1636](#L1636) | $source\_handle      = ai1wm\_open( $source\_file, 'rb' ); |
| [1637](#L1637) | $destination\_handle = ai1wm\_open( $destination\_file, 'ab' ); |
| [1638](#L1638) | while ( $buffer = ai1wm\_read( $source\_handle, 4096 ) ) { |
| [1639](#L1639) | ai1wm\_write( $destination\_handle, $buffer ); |
| [1640](#L1640) | } |
| [1641](#L1641) | ai1wm\_close( $source\_handle ); |
| [1642](#L1642) | ai1wm\_close( $destination\_handle ); |
| [1643](#L1643) | } |
| [1644](#L1644) |  |
| [1645](#L1645) | /\*\* |
| [1646](#L1646) | \* Check whether file size is supported by current PHP version |
| [1647](#L1647) | \* |
| [1648](#L1648) | \* @param  string  $file         Path to file |
| [1649](#L1649) | \* @param  integer $php\_int\_size Size of PHP integer |
| [1650](#L1650) | \* @return boolean $php\_int\_max  Max value of PHP integer |
| [1651](#L1651) | \*/ |
| [1652](#L1652) | function ai1wm\_is\_filesize\_supported( $file, $php\_int\_size = PHP\_INT\_SIZE, $php\_int\_max = PHP\_INT\_MAX ) { |
| [1653](#L1653) | $size\_result = true; |
| [1654](#L1654) |  |
| [1655](#L1655) | // Check whether file size is less than 2GB in PHP 32bits |
| [1656](#L1656) | if ( $php\_int\_size === 4 ) { |
| [1657](#L1657) | if ( ( $file\_handle = @fopen( $file, 'r' ) ) ) { |
| [1658](#L1658) | if ( @fseek( $file\_handle, $php\_int\_max, SEEK\_SET ) !== -1 ) { |
| [1659](#L1659) | if ( @fgetc( $file\_handle ) !== false ) { |
| [1660](#L1660) | $size\_result = false; |
| [1661](#L1661) | } |
| [1662](#L1662) | } |
| [1663](#L1663) |  |
| [1664](#L1664) | @fclose( $file\_handle ); |
| [1665](#L1665) | } |
| [1666](#L1666) | } |
| [1667](#L1667) |  |
| [1668](#L1668) | return $size\_result; |
| [1669](#L1669) | } |
| [1670](#L1670) |  |
| [1671](#L1671) | /\*\* |
| [1672](#L1672) | \* Check whether file name is supported by All-in-One WP Migration |
| [1673](#L1673) | \* |
| [1674](#L1674) | \* @param  string  $file       Path to file |
| [1675](#L1675) | \* @param  array   $extensions File extensions |
| [1676](#L1676) | \* @return boolean |
| [1677](#L1677) | \*/ |
| [1678](#L1678) | function ai1wm\_is\_filename\_supported( $file, $extensions = array( 'wpress' ) ) { |
| [1679](#L1679) | if ( in\_array( pathinfo( $file, PATHINFO\_EXTENSION ), $extensions ) ) { |
| [1680](#L1680) | return true; |
| [1681](#L1681) | } |
| [1682](#L1682) |  |
| [1683](#L1683) | return false; |
| [1684](#L1684) | } |
| [1685](#L1685) |  |
| [1686](#L1686) | /\*\* |
| [1687](#L1687) | \* Verify secret key |
| [1688](#L1688) | \* |
| [1689](#L1689) | \* @param  string  $secret\_key Secret key |
| [1690](#L1690) | \* @return boolean |
| [1691](#L1691) | \* @throws Ai1wm\_Not\_Valid\_Secret\_Key\_Exception |
| [1692](#L1692) | \*/ |
| [1693](#L1693) | function ai1wm\_verify\_secret\_key( $secret\_key ) { |
| [1694](#L1694) | if ( $secret\_key !== get\_option( AI1WM\_SECRET\_KEY ) ) { |
| [1695](#L1695) | throw new Ai1wm\_Not\_Valid\_Secret\_Key\_Exception( \_\_( 'Unable to authenticate the secret key. <a href="https://help.servmask.com/knowledgebase/invalid-secret-key/" target="\_blank">Technical details</a>', AI1WM\_PLUGIN\_NAME ) ); |
| [1696](#L1696) | } |
| [1697](#L1697) |  |
| [1698](#L1698) | return true; |
| [1699](#L1699) | } |
| [1700](#L1700) |  |
| [1701](#L1701) | /\*\* |
| [1702](#L1702) | \* Is scheduled backup? |
| [1703](#L1703) | \* |
| [1704](#L1704) | \* @return boolean |
| [1705](#L1705) | \*/ |
| [1706](#L1706) | function ai1wm\_is\_scheduled\_backup() { |
| [1707](#L1707) | if ( isset( $\_GET['ai1wm\_manual\_export'] ) || isset( $\_POST['ai1wm\_manual\_export'] ) ) { |
| [1708](#L1708) | return false; |
| [1709](#L1709) | } |
| [1710](#L1710) |  |
| [1711](#L1711) | if ( isset( $\_GET['ai1wm\_manual\_import'] ) || isset( $\_POST['ai1wm\_manual\_import'] ) ) { |
| [1712](#L1712) | return false; |
| [1713](#L1713) | } |
| [1714](#L1714) |  |
| [1715](#L1715) | if ( isset( $\_GET['ai1wm\_manual\_restore'] ) || isset( $\_POST['ai1wm\_manual\_restore'] ) ) { |
| [1716](#L1716) | return false; |
| [1717](#L1717) | } |
| [1718](#L1718) |  |
| [1719](#L1719) | if ( isset( $\_GET['ai1wm\_manual\_reset'] ) || isset( $\_POST['ai1wm\_manual\_reset'] ) ) { |
| [1720](#L1720) | return false; |
| [1721](#L1721) | } |
| [1722](#L1722) |  |
| [1723](#L1723) | return true; |
| [1724](#L1724) | } |
| [1725](#L1725) |  |
| [1726](#L1726) | /\*\* |
| [1727](#L1727) | \* PHP setup environment |
| [1728](#L1728) | \* |
| [1729](#L1729) | \* @return void |
| [1730](#L1730) | \*/ |
| [1731](#L1731) | function ai1wm\_setup\_environment() { |
| [1732](#L1732) | // Set whether a client disconnect should abort script execution |
| [1733](#L1733) | @ignore\_user\_abort( true ); |
| [1734](#L1734) |  |
| [1735](#L1735) | // Set maximum execution time |
| [1736](#L1736) | @set\_time\_limit( 0 ); |
| [1737](#L1737) |  |
| [1738](#L1738) | // Set maximum time in seconds a script is allowed to parse input data |
| [1739](#L1739) | @ini\_set( 'max\_input\_time', '-1' ); |
| [1740](#L1740) |  |
| [1741](#L1741) | // Set maximum backtracking steps |
| [1742](#L1742) | @ini\_set( 'pcre.backtrack\_limit', PHP\_INT\_MAX ); |
| [1743](#L1743) |  |
| [1744](#L1744) | // Set binary safe encoding |
| [1745](#L1745) | if ( @function\_exists( 'mb\_internal\_encoding' ) && ( @ini\_get( 'mbstring.func\_overload' ) & 2 ) ) { |
| [1746](#L1746) | @mb\_internal\_encoding( 'ISO-8859-1' ); |
| [1747](#L1747) | } |
| [1748](#L1748) |  |
| [1749](#L1749) | // Clean (erase) the output buffer and turn off output buffering |
| [1750](#L1750) | if ( @ob\_get\_length() ) { |
| [1751](#L1751) | @ob\_end\_clean(); |
| [1752](#L1752) | } |
| [1753](#L1753) |  |
| [1754](#L1754) | // Set error handler |
| [1755](#L1755) | @set\_error\_handler( 'Ai1wm\_Handler::error' ); |
| [1756](#L1756) |  |
| [1757](#L1757) | // Set shutdown handler |
| [1758](#L1758) | @register\_shutdown\_function( 'Ai1wm\_Handler::shutdown' ); |
| [1759](#L1759) | } |
| [1760](#L1760) |  |
| [1761](#L1761) | /\*\* |
| [1762](#L1762) | \* Get WordPress time zone string |
| [1763](#L1763) | \* |
| [1764](#L1764) | \* @return string |
| [1765](#L1765) | \*/ |
| [1766](#L1766) | function ai1wm\_get\_timezone\_string() { |
| [1767](#L1767) | if ( ( $timezone\_string = get\_option( 'timezone\_string' ) ) ) { |
| [1768](#L1768) | return $timezone\_string; |
| [1769](#L1769) | } |
| [1770](#L1770) |  |
| [1771](#L1771) | if ( ( $gmt\_offset = get\_option( 'gmt\_offset' ) ) ) { |
| [1772](#L1772) | if ( $gmt\_offset > 0 ) { |
| [1773](#L1773) | return sprintf( 'UTC+%s', abs( $gmt\_offset ) ); |
| [1774](#L1774) | } elseif ( $gmt\_offset < 0 ) { |
| [1775](#L1775) | return sprintf( 'UTC-%s', abs( $gmt\_offset ) ); |
| [1776](#L1776) | } |
| [1777](#L1777) | } |
| [1778](#L1778) |  |
| [1779](#L1779) | return 'UTC'; |
| [1780](#L1780) | } |
| [1781](#L1781) |  |
| [1782](#L1782) | /\*\* |
| [1783](#L1783) | \* Get WordPress filter hooks |
| [1784](#L1784) | \* |
| [1785](#L1785) | \* @param  string $tag The name of the filter hook |
| [1786](#L1786) | \* @return array |
| [1787](#L1787) | \*/ |
| [1788](#L1788) | function ai1wm\_get\_filters( $tag ) { |
| [1789](#L1789) | global $wp\_filter; |
| [1790](#L1790) |  |
| [1791](#L1791) | // Get WordPress filter hooks |
| [1792](#L1792) | $filters = array(); |
| [1793](#L1793) | if ( isset( $wp\_filter[ $tag ] ) ) { |
| [1794](#L1794) | if ( ( $filters = $wp\_filter[ $tag ] ) ) { |
| [1795](#L1795) | // WordPress 4.7 introduces new class for working with filters/actions called WP\_Hook |
| [1796](#L1796) | // which adds another level of abstraction and we need to address it. |
| [1797](#L1797) | if ( isset( $filters->callbacks ) ) { |
| [1798](#L1798) | $filters = $filters->callbacks; |
| [1799](#L1799) | } |
| [1800](#L1800) | } |
| [1801](#L1801) |  |
| [1802](#L1802) | ksort( $filters ); |
| [1803](#L1803) | } |
| [1804](#L1804) |  |
| [1805](#L1805) | return $filters; |
| [1806](#L1806) | } |
| [1807](#L1807) |  |
| [1808](#L1808) | /\*\* |
| [1809](#L1809) | \* Get WordPress plugins directories |
| [1810](#L1810) | \* |
| [1811](#L1811) | \* @return array |
| [1812](#L1812) | \*/ |
| [1813](#L1813) | function ai1wm\_get\_themes\_dirs() { |
| [1814](#L1814) | $theme\_dirs = array(); |
| [1815](#L1815) | foreach ( search\_theme\_directories() as $theme\_name => $theme\_info ) { |
| [1816](#L1816) | if ( isset( $theme\_info['theme\_root'] ) ) { |
| [1817](#L1817) | if ( ! in\_array( $theme\_info['theme\_root'], $theme\_dirs ) ) { |
| [1818](#L1818) | $theme\_dirs[] = untrailingslashit( $theme\_info['theme\_root'] ); |
| [1819](#L1819) | } |
| [1820](#L1820) | } |
| [1821](#L1821) | } |
| [1822](#L1822) |  |
| [1823](#L1823) | return $theme\_dirs; |
| [1824](#L1824) | } |
| [1825](#L1825) |  |
| [1826](#L1826) | /\*\* |
| [1827](#L1827) | \* Get WordPress plugins directory |
| [1828](#L1828) | \* |
| [1829](#L1829) | \* @return string |
| [1830](#L1830) | \*/ |
| [1831](#L1831) | function ai1wm\_get\_plugins\_dir() { |
| [1832](#L1832) | return untrailingslashit( WP\_PLUGIN\_DIR ); |
| [1833](#L1833) | } |
| [1834](#L1834) |  |
| [1835](#L1835) | /\*\* |
| [1836](#L1836) | \* Get WordPress uploads directory |
| [1837](#L1837) | \* |
| [1838](#L1838) | \* @return string |
| [1839](#L1839) | \*/ |
| [1840](#L1840) | function ai1wm\_get\_uploads\_dir() { |
| [1841](#L1841) | if ( ( $upload\_dir = wp\_upload\_dir() ) ) { |
| [1842](#L1842) | if ( isset( $upload\_dir['basedir'] ) ) { |
| [1843](#L1843) | return untrailingslashit( $upload\_dir['basedir'] ); |
| [1844](#L1844) | } |
| [1845](#L1845) | } |
| [1846](#L1846) | } |
| [1847](#L1847) |  |
| [1848](#L1848) | /\*\* |
| [1849](#L1849) | \* Get WordPress uploads URL |
| [1850](#L1850) | \* |
| [1851](#L1851) | \* @return string |
| [1852](#L1852) | \*/ |
| [1853](#L1853) | function ai1wm\_get\_uploads\_url() { |
| [1854](#L1854) | if ( ( $upload\_dir = wp\_upload\_dir() ) ) { |
| [1855](#L1855) | if ( isset( $upload\_dir['baseurl'] ) ) { |
| [1856](#L1856) | return trailingslashit( $upload\_dir['baseurl'] ); |
| [1857](#L1857) | } |
| [1858](#L1858) | } |
| [1859](#L1859) | } |
| [1860](#L1860) |  |
| [1861](#L1861) | /\*\* |
| [1862](#L1862) | \* Get WordPress uploads path |
| [1863](#L1863) | \* |
| [1864](#L1864) | \* @return string |
| [1865](#L1865) | \*/ |
| [1866](#L1866) | function ai1wm\_get\_uploads\_path() { |
| [1867](#L1867) | if ( ( $upload\_dir = wp\_upload\_dir() ) ) { |
| [1868](#L1868) | if ( isset( $upload\_dir['basedir'] ) ) { |
| [1869](#L1869) | return str\_replace( ABSPATH, '', $upload\_dir['basedir'] ); |
| [1870](#L1870) | } |
| [1871](#L1871) | } |
| [1872](#L1872) | } |
| [1873](#L1873) |  |
| [1874](#L1874) | /\*\* |
| [1875](#L1875) | \* i18n friendly version of basename() |
| [1876](#L1876) | \* |
| [1877](#L1877) | \* @param  string $path   File path |
| [1878](#L1878) | \* @param  string $suffix If the filename ends in suffix this will also be cut off |
| [1879](#L1879) | \* @return string |
| [1880](#L1880) | \*/ |
| [1881](#L1881) | function ai1wm\_basename( $path, $suffix = '' ) { |
| [1882](#L1882) | return urldecode( basename( str\_replace( array( '%2F', '%5C' ), '/', urlencode( $path ) ), $suffix ) ); |
| [1883](#L1883) | } |
| [1884](#L1884) |  |
| [1885](#L1885) | /\*\* |
| [1886](#L1886) | \* i18n friendly version of dirname() |
| [1887](#L1887) | \* |
| [1888](#L1888) | \* @param  string $path File path |
| [1889](#L1889) | \* @return string |
| [1890](#L1890) | \*/ |
| [1891](#L1891) | function ai1wm\_dirname( $path ) { |
| [1892](#L1892) | return urldecode( dirname( str\_replace( array( '%2F', '%5C' ), '/', urlencode( $path ) ) ) ); |
| [1893](#L1893) | } |
| [1894](#L1894) |  |
| [1895](#L1895) | /\*\* |
| [1896](#L1896) | \* Replace forward slash with current directory separator |
| [1897](#L1897) | \* |
| [1898](#L1898) | \* @param  string $path Path |
| [1899](#L1899) | \* @return string |
| [1900](#L1900) | \*/ |
| [1901](#L1901) | function ai1wm\_replace\_forward\_slash\_with\_directory\_separator( $path ) { |
| [1902](#L1902) | return str\_replace( '/', DIRECTORY\_SEPARATOR, $path ); |
| [1903](#L1903) | } |
| [1904](#L1904) |  |
| [1905](#L1905) | /\*\* |
| [1906](#L1906) | \* Replace current directory separator with forward slash |
| [1907](#L1907) | \* |
| [1908](#L1908) | \* @param  string $path Path |
| [1909](#L1909) | \* @return string |
| [1910](#L1910) | \*/ |
| [1911](#L1911) | function ai1wm\_replace\_directory\_separator\_with\_forward\_slash( $path ) { |
| [1912](#L1912) | return str\_replace( DIRECTORY\_SEPARATOR, '/', $path ); |
| [1913](#L1913) | } |
| [1914](#L1914) |  |
| [1915](#L1915) | /\*\* |
| [1916](#L1916) | \* Escape Windows directory separator |
| [1917](#L1917) | \* |
| [1918](#L1918) | \* @param  string $path Path |
| [1919](#L1919) | \* @return string |
| [1920](#L1920) | \*/ |
| [1921](#L1921) | function ai1wm\_escape\_windows\_directory\_separator( $path ) { |
| [1922](#L1922) | return preg\_replace( '/[\\\\]+/', '\\\\\\\\', $path ); |
| [1923](#L1923) | } |
| [1924](#L1924) |  |
| [1925](#L1925) | /\*\* |
| [1926](#L1926) | \* Should reset WordPress permalinks? |
| [1927](#L1927) | \* |
| [1928](#L1928) | \* @param  array   $params Request parameters |
| [1929](#L1929) | \* @return boolean |
| [1930](#L1930) | \*/ |
| [1931](#L1931) | function ai1wm\_should\_reset\_permalinks( $params ) { |
| [1932](#L1932) | global $wp\_rewrite, $is\_apache; |
| [1933](#L1933) |  |
| [1934](#L1934) | // Permalinks are not supported |
| [1935](#L1935) | if ( empty( $params['using\_permalinks'] ) ) { |
| [1936](#L1936) | if ( $wp\_rewrite->using\_permalinks() ) { |
| [1937](#L1937) | if ( $is\_apache ) { |
| [1938](#L1938) | if ( ! apache\_mod\_loaded( 'mod\_rewrite', false ) ) { |
| [1939](#L1939) | return true; |
| [1940](#L1940) | } |
| [1941](#L1941) | } |
| [1942](#L1942) | } |
| [1943](#L1943) | } |
| [1944](#L1944) |  |
| [1945](#L1945) | return false; |
| [1946](#L1946) | } |
| [1947](#L1947) |  |
| [1948](#L1948) | /\*\* |
| [1949](#L1949) | \* Get .htaccess file content |
| [1950](#L1950) | \* |
| [1951](#L1951) | \* @return string |
| [1952](#L1952) | \*/ |
| [1953](#L1953) | function ai1wm\_get\_htaccess() { |
| [1954](#L1954) | if ( is\_file( AI1WM\_WORDPRESS\_HTACCESS ) ) { |
| [1955](#L1955) | return @file\_get\_contents( AI1WM\_WORDPRESS\_HTACCESS ); |
| [1956](#L1956) | } |
| [1957](#L1957) |  |
| [1958](#L1958) | return ''; |
| [1959](#L1959) | } |
| [1960](#L1960) |  |
| [1961](#L1961) | /\*\* |
| [1962](#L1962) | \* Get web.config file content |
| [1963](#L1963) | \* |
| [1964](#L1964) | \* @return string |
| [1965](#L1965) | \*/ |
| [1966](#L1966) | function ai1wm\_get\_webconfig() { |
| [1967](#L1967) | if ( is\_file( AI1WM\_WORDPRESS\_WEBCONFIG ) ) { |
| [1968](#L1968) | return @file\_get\_contents( AI1WM\_WORDPRESS\_WEBCONFIG ); |
| [1969](#L1969) | } |
| [1970](#L1970) |  |
| [1971](#L1971) | return ''; |
| [1972](#L1972) | } |
| [1973](#L1973) |  |
| [1974](#L1974) | /\*\* |
| [1975](#L1975) | \* Get available space on filesystem or disk partition |
| [1976](#L1976) | \* |
| [1977](#L1977) | \* @param  string $path Directory of the filesystem or disk partition |
| [1978](#L1978) | \* @return mixed |
| [1979](#L1979) | \*/ |
| [1980](#L1980) | function ai1wm\_disk\_free\_space( $path ) { |
| [1981](#L1981) | if ( function\_exists( 'disk\_free\_space' ) ) { |
| [1982](#L1982) | return @disk\_free\_space( $path ); |
| [1983](#L1983) | } |
| [1984](#L1984) | } |
| [1985](#L1985) |  |
| [1986](#L1986) | /\*\* |
| [1987](#L1987) | \* Set response header to json end echo data |
| [1988](#L1988) | \* |
| [1989](#L1989) | \* @param array $data |
| [1990](#L1990) | \* @param int $options |
| [1991](#L1991) | \* @param int $depth |
| [1992](#L1992) | \* @return void |
| [1993](#L1993) | \*/ |
| [1994](#L1994) | function ai1wm\_json\_response( $data, $options = 0 ) { |
| [1995](#L1995) | if ( ! headers\_sent() ) { |
| [1996](#L1996) | header( 'Content-Type: application/json; charset=' . get\_option( 'blog\_charset', 'utf-8' ) ); |
| [1997](#L1997) | } |
| [1998](#L1998) |  |
| [1999](#L1999) | echo json\_encode( $data, $options ); |
| [2000](#L2000) | } |
| [2001](#L2001) |  |
| [2002](#L2002) | /\*\* |
| [2003](#L2003) | \* Determines if the server can encrypt backups |
| [2004](#L2004) | \* |
| [2005](#L2005) | \* @return boolean |
| [2006](#L2006) | \*/ |
| [2007](#L2007) | function ai1wm\_can\_encrypt() { |
| [2008](#L2008) | if ( ! function\_exists( 'openssl\_encrypt' ) ) { |
| [2009](#L2009) | return false; |
| [2010](#L2010) | } |
| [2011](#L2011) |  |
| [2012](#L2012) | if ( ! function\_exists( 'openssl\_random\_pseudo\_bytes' ) ) { |
| [2013](#L2013) | return false; |
| [2014](#L2014) | } |
| [2015](#L2015) |  |
| [2016](#L2016) | if ( ! function\_exists( 'openssl\_cipher\_iv\_length' ) ) { |
| [2017](#L2017) | return false; |
| [2018](#L2018) | } |
| [2019](#L2019) |  |
| [2020](#L2020) | if ( ! function\_exists( 'sha1' ) ) { |
| [2021](#L2021) | return false; |
| [2022](#L2022) | } |
| [2023](#L2023) |  |
| [2024](#L2024) | if ( ! in\_array( AI1WM\_CIPHER\_NAME, array\_map( 'strtoupper', openssl\_get\_cipher\_methods() ) ) ) { |
| [2025](#L2025) | return false; |
| [2026](#L2026) | } |
| [2027](#L2027) |  |
| [2028](#L2028) | return true; |
| [2029](#L2029) | } |
| [2030](#L2030) |  |
| [2031](#L2031) | /\*\* |
| [2032](#L2032) | \* Determines if the server can decrypt backups |
| [2033](#L2033) | \* |
| [2034](#L2034) | \* @return boolean |
| [2035](#L2035) | \*/ |
| [2036](#L2036) | function ai1wm\_can\_decrypt() { |
| [2037](#L2037) | if ( ! function\_exists( 'openssl\_decrypt' ) ) { |
| [2038](#L2038) | return false; |
| [2039](#L2039) | } |
| [2040](#L2040) |  |
| [2041](#L2041) | if ( ! function\_exists( 'openssl\_random\_pseudo\_bytes' ) ) { |
| [2042](#L2042) | return false; |
| [2043](#L2043) | } |
| [2044](#L2044) |  |
| [2045](#L2045) | if ( ! function\_exists( 'openssl\_cipher\_iv\_length' ) ) { |
| [2046](#L2046) | return false; |
| [2047](#L2047) | } |
| [2048](#L2048) |  |
| [2049](#L2049) | if ( ! function\_exists( 'sha1' ) ) { |
| [2050](#L2050) | return false; |
| [2051](#L2051) | } |
| [2052](#L2052) |  |
| [2053](#L2053) | if ( ! in\_array( AI1WM\_CIPHER\_NAME, array\_map( 'strtoupper', openssl\_get\_cipher\_methods() ) ) ) { |
| [2054](#L2054) | return false; |
| [2055](#L2055) | } |
| [2056](#L2056) |  |
| [2057](#L2057) | return true; |
| [2058](#L2058) | } |
| [2059](#L2059) |  |
| [2060](#L2060) | /\*\* |
| [2061](#L2061) | \* Encrypts a string with a key |
| [2062](#L2062) | \* |
| [2063](#L2063) | \* @param string $string String to encrypt |
| [2064](#L2064) | \* @param string $key    Key to encrypt the string with |
| [2065](#L2065) | \* @return string |
| [2066](#L2066) | \* @throws Ai1wm\_Not\_Encryptable\_Exception |
| [2067](#L2067) | \*/ |
| [2068](#L2068) | function ai1wm\_encrypt\_string( $string, $key ) { |
| [2069](#L2069) | $iv\_length = ai1wm\_crypt\_iv\_length(); |
| [2070](#L2070) | $key       = substr( sha1( $key, true ), 0, $iv\_length ); |
| [2071](#L2071) |  |
| [2072](#L2072) | $iv = openssl\_random\_pseudo\_bytes( $iv\_length ); |
| [2073](#L2073) | if ( $iv === false ) { |
| [2074](#L2074) | throw new Ai1wm\_Not\_Encryptable\_Exception( \_\_( 'Unable to generate random bytes.', AI1WM\_PLUGIN\_NAME ) ); |
| [2075](#L2075) | } |
| [2076](#L2076) |  |
| [2077](#L2077) | $encrypted\_string = openssl\_encrypt( $string, AI1WM\_CIPHER\_NAME, $key, OPENSSL\_RAW\_DATA, $iv ); |
| [2078](#L2078) | if ( $encrypted\_string === false ) { |
| [2079](#L2079) | throw new Ai1wm\_Not\_Encryptable\_Exception( \_\_( 'Unable to encrypt data.', AI1WM\_PLUGIN\_NAME ) ); |
| [2080](#L2080) | } |
| [2081](#L2081) |  |
| [2082](#L2082) | return sprintf( '%s%s', $iv, $encrypted\_string ); |
| [2083](#L2083) | } |
| [2084](#L2084) |  |
| [2085](#L2085) | /\*\* |
| [2086](#L2086) | \* Returns encrypt/decrypt iv length |
| [2087](#L2087) | \* |
| [2088](#L2088) | \* @return int |
| [2089](#L2089) | \* @throws Ai1wm\_Not\_Encryptable\_Exception |
| [2090](#L2090) | \*/ |
| [2091](#L2091) | function ai1wm\_crypt\_iv\_length() { |
| [2092](#L2092) | $iv\_length = openssl\_cipher\_iv\_length( AI1WM\_CIPHER\_NAME ); |
| [2093](#L2093) | if ( $iv\_length === false ) { |
| [2094](#L2094) | throw new Ai1wm\_Not\_Encryptable\_Exception( \_\_( 'Unable to obtain cipher length.', AI1WM\_PLUGIN\_NAME ) ); |
| [2095](#L2095) | } |
| [2096](#L2096) |  |
| [2097](#L2097) | return $iv\_length; |
| [2098](#L2098) | } |
| [2099](#L2099) |  |
| [2100](#L2100) | /\*\* |
| [2101](#L2101) | \* Decrypts a string with a eky |
| [2102](#L2102) | \* |
| [2103](#L2103) | \* @param string $encrypted\_string String to decrypt |
| [2104](#L2104) | \* @param string $key              Key to decrypt the string with |
| [2105](#L2105) | \* @return string |
| [2106](#L2106) | \* @throws Ai1wm\_Not\_Encryptable\_Exception |
| [2107](#L2107) | \* @throws Ai1wm\_Not\_Decryptable\_Exception |
| [2108](#L2108) | \*/ |
| [2109](#L2109) | function ai1wm\_decrypt\_string( $encrypted\_string, $key ) { |
| [2110](#L2110) | $iv\_length = ai1wm\_crypt\_iv\_length(); |
| [2111](#L2111) | $key       = substr( sha1( $key, true ), 0, $iv\_length ); |
| [2112](#L2112) | $iv        = substr( $encrypted\_string, 0, $iv\_length ); |
| [2113](#L2113) |  |
| [2114](#L2114) | $decrypted\_string = openssl\_decrypt( substr( $encrypted\_string, $iv\_length ), AI1WM\_CIPHER\_NAME, $key, OPENSSL\_RAW\_DATA, $iv ); |
| [2115](#L2115) | if ( $decrypted\_string === false ) { |
| [2116](#L2116) | throw new Ai1wm\_Not\_Decryptable\_Exception( \_\_( 'Unable to decrypt data.', AI1WM\_PLUGIN\_NAME ) ); |
| [2117](#L2117) | } |
| [2118](#L2118) |  |
| [2119](#L2119) | return $decrypted\_string; |
| [2120](#L2120) | } |
| [2121](#L2121) |  |
| [2122](#L2122) | /\*\* |
| [2123](#L2123) | \* Checks if decryption password is valid |
| [2124](#L2124) | \* |
| [2125](#L2125) | \* @param string $encrypted\_signature |
| [2126](#L2126) | \* @param string $password |
| [2127](#L2127) | \* @return bool |
| [2128](#L2128) | \*/ |
| [2129](#L2129) | function ai1wm\_is\_decryption\_password\_valid( $encrypted\_signature, $password ) { |
| [2130](#L2130) | try { |
| [2131](#L2131) | $encrypted\_signature = base64\_decode( $encrypted\_signature ); |
| [2132](#L2132) |  |
| [2133](#L2133) | return ai1wm\_decrypt\_string( $encrypted\_signature, $password ) === AI1WM\_SIGN\_TEXT; |
| [2134](#L2134) | } catch ( Ai1wm\_Not\_Decryptable\_Exception $exception ) { |
| [2135](#L2135) | return false; |
| [2136](#L2136) | } |
| [2137](#L2137) | } |
| [2138](#L2138) |  |
| [2139](#L2139) | function ai1wm\_populate\_roles() { |
| [2140](#L2140) | if ( ! function\_exists( 'populate\_roles' ) && ! function\_exists( 'populate\_options' ) && ! function\_exists( 'populate\_network' ) ) { |
| [2141](#L2141) | require\_once( ABSPATH . 'wp-admin/includes/schema.php' ); |
| [2142](#L2142) | } |
| [2143](#L2143) |  |
| [2144](#L2144) | if ( function\_exists( 'populate\_roles' ) ) { |
| [2145](#L2145) | populate\_roles(); |
| [2146](#L2146) | } |
| [2147](#L2147) | } |
| [2148](#L2148) |  |
| [2149](#L2149) | /\*\* |
| [2150](#L2150) | \* Set basic auth header to request |
| [2151](#L2151) | \* |
| [2152](#L2152) | \* @param array $headers |
| [2153](#L2153) | \* |
| [2154](#L2154) | \* @return array |
| [2155](#L2155) | \*/ |
| [2156](#L2156) | function ai1wm\_auth\_headers( $headers = array() ) { |
| [2157](#L2157) | if ( $hash = get\_option( AI1WM\_AUTH\_HEADER ) ) { |
| [2158](#L2158) | $headers['Authorization'] = sprintf( 'Basic %s', $hash ); |
| [2159](#L2159) | } |
| [2160](#L2160) |  |
| [2161](#L2161) | if ( ( $user = get\_option( AI1WM\_AUTH\_USER ) ) && ( $password = get\_option( AI1WM\_AUTH\_PASSWORD ) ) ) { |
| [2162](#L2162) | if ( ! isset( $headers['Authorization'] ) && ( $hash = base64\_encode( sprintf( '%s:%s', $user, $password ) ) ) ) { |
| [2163](#L2163) | update\_option( AI1WM\_AUTH\_HEADER, $hash ); |
| [2164](#L2164) | $headers['Authorization'] = sprintf( 'Basic %s', $hash ); |
| [2165](#L2165) | } |
| [2166](#L2166) | delete\_option( AI1WM\_AUTH\_USER ); |
| [2167](#L2167) | delete\_option( AI1WM\_AUTH\_PASSWORD ); |
| [2168](#L2168) | } |
| [2169](#L2169) |  |
| [2170](#L2170) | return $headers; |
| [2171](#L2171) | } |
| [2172](#L2172) |  |
| [2173](#L2173) | /\*\* |
| [2174](#L2174) | \* Check if direct download of backup supported |
| [2175](#L2175) | \* |
| [2176](#L2176) | \* @return bool |
| [2177](#L2177) | \*/ |
| [2178](#L2178) | function ai1wm\_direct\_download\_supported() { |
| [2179](#L2179) | return ! ( $\_SERVER['SERVER\_NAME'] === 'playground.wordpress.net' || $\_SERVER['SERVER\_SOFTWARE'] === 'PHP.wasm' ); |
| [2180](#L2180) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/all-in-one-wp-migration/tags/7.86/functions.php?format=txt)
* [Original Format](/export/3220278/all-in-one-wp-migration/tags/7.86/functions.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_60140999_20250110_143444.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# All-in-One WP Migration and Backup <= 7.86 - Unauthenticated Information Disclosure via Error Logs

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   All-in-One WP Migration and Backup <= 7.86 - Unauthenticated Information Disclosure via Error Logs

5.3

**Exposure of Sensitive Information to an Unauthorized Actor**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N)

| CVE | [CVE-2024-8852](https://www.cve.org/CVERecord?id=CVE-2024-8852) |
| --- | --- |
| CVSS | 5.3 (Medium) |
| Publicly Published | October 21, 2024 |
| Last Updated | October 22, 2024 |
| Researcher | [villu164](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/villu164) |

### Description

The All-in-One WP Migration and Backup plugin for WordPress is vulnerable to Sensitive Information Exposure in all versions up to, and including, 7.86 through publicly exposed log files. This makes it possible for unauthenticated attackers to view potentially sensitive information such as full paths contained in the exposed log files.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/all-in-one-wp-migration/tags/7.86/functions.php#L297)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3168605%40all-in-one-wp-migration&new=3168605%40all-in-one-wp-migration&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fall-in-one-wp-migration%2Fall-in-one-wp-migration-and-backup-786-unauthenticated-information-disclosure-via-error-logs&t=All-in-One%20WP%20Migration%20and%20Backup%20%3C%3D%207.86%20-%20Unauthenticated%20Information%20Disclosure%20via%20Error%20Logs "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fall-in-one-wp-migration%2Fall-in-one-wp-migration-and-backup-786-unauthenticated-information-disclosure-via-error-logs&text=All-in-One%20WP%20Migration%20and%20Backup%20%3C%3D%207.86%20-%20Unauthenticated%20Information%20Disclosure%20via%20Error%20Logs "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fall-in-one-wp-migration%2Fall-in-one-wp-migration-and-backup-786-unauthenticated-information-disclosure-via-error-logs "LinkedIn")
Email

## Vulnerability Details for All-in-One WP Migration and Backup

#### [All-in-One WP Migration and Backup](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/all-in-one-wp-migration)

| Software Type | Plugin |
| --- | --- |
| Software Slug | all-in-one-wp-migration [(view on wordpress.org)](https://wordpress.org/plugins/all-in-one-wp-migration) |
| Patched? | Yes |
| Remediation | Update to version 7.87, or a newer patched version |
| Affected Version | * <= 7.86 |
| Patched Version | * 7.87 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


