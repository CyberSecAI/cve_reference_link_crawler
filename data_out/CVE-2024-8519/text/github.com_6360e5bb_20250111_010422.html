
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fultimatemember%2Fultimatemember%2Fblob%2F7b8a7a7c039bde4539c07e049b19036192f1c133%2Fincludes%2Fcore%2Fclass-shortcodes.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fultimatemember%2Fultimatemember%2Fblob%2F7b8a7a7c039bde4539c07e049b19036192f1c133%2Fincludes%2Fcore%2Fclass-shortcodes.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=ultimatemember%2Fultimatemember)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ultimatemember](/ultimatemember)
/
**[ultimatemember](/ultimatemember/ultimatemember)**
Public

* [Notifications](/login?return_to=%2Fultimatemember%2Fultimatemember) You must be signed in to change notification settings
* [Fork
  185](/login?return_to=%2Fultimatemember%2Fultimatemember)
* [Star
   250](/login?return_to=%2Fultimatemember%2Fultimatemember)

* [Code](/ultimatemember/ultimatemember)
* [Issues
  199](/ultimatemember/ultimatemember/issues)
* [Pull requests
  27](/ultimatemember/ultimatemember/pulls)
* [Actions](/ultimatemember/ultimatemember/actions)
* [Projects
  0](/ultimatemember/ultimatemember/projects)
* [Wiki](/ultimatemember/ultimatemember/wiki)
* [Security](/ultimatemember/ultimatemember/security)
* [Insights](/ultimatemember/ultimatemember/pulse)

Additional navigation options

* [Code](/ultimatemember/ultimatemember)
* [Issues](/ultimatemember/ultimatemember/issues)
* [Pull requests](/ultimatemember/ultimatemember/pulls)
* [Actions](/ultimatemember/ultimatemember/actions)
* [Projects](/ultimatemember/ultimatemember/projects)
* [Wiki](/ultimatemember/ultimatemember/wiki)
* [Security](/ultimatemember/ultimatemember/security)
* [Insights](/ultimatemember/ultimatemember/pulse)

## Files

 7b8a7a7
## Breadcrumbs

1. [ultimatemember](/ultimatemember/ultimatemember/tree/7b8a7a7c039bde4539c07e049b19036192f1c133)
2. /[includes](/ultimatemember/ultimatemember/tree/7b8a7a7c039bde4539c07e049b19036192f1c133/includes)
3. /[core](/ultimatemember/ultimatemember/tree/7b8a7a7c039bde4539c07e049b19036192f1c133/includes/core)
/
# class-shortcodes.php

Copy path Blame  Blame
## Latest commit

## History

[History](/ultimatemember/ultimatemember/commits/7b8a7a7c039bde4539c07e049b19036192f1c133/includes/core/class-shortcodes.php)1461 lines (1245 loc) · 41.4 KB 7b8a7a7
## Breadcrumbs

1. [ultimatemember](/ultimatemember/ultimatemember/tree/7b8a7a7c039bde4539c07e049b19036192f1c133)
2. /[includes](/ultimatemember/ultimatemember/tree/7b8a7a7c039bde4539c07e049b19036192f1c133/includes)
3. /[core](/ultimatemember/ultimatemember/tree/7b8a7a7c039bde4539c07e049b19036192f1c133/includes/core)
/
# class-shortcodes.php

Top
## File metadata and controls

* Code
* Blame

1461 lines (1245 loc) · 41.4 KB[Raw](https://github.com/ultimatemember/ultimatemember/raw/7b8a7a7c039bde4539c07e049b19036192f1c133/includes/core/class-shortcodes.php)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000<?phpnamespace um\core;
if ( ! defined( 'ABSPATH' ) ) { exit;}
if ( ! class\_exists( 'um\core\Shortcodes' ) ) {
 /\*\* \* Class Shortcodes \* @package um\core \*/ class Shortcodes {
 /\*\* \* @var array \*/ public $forms\_exist = array();
 /\*\* \* @var string \*/ public $profile\_role = '';
 /\*\* \* @var bool \*/ public $message\_mode = false;
 /\*\* \* @var string \*/ public $custom\_message = '';
 /\*\* \* @var array \*/ public $loop = array();
 /\*\* \* @var array \*/ public $emoji = array();
 /\*\* \* @var null|int \*/ public $form\_id = null;
 /\*\* \* @var null|string \*/ public $form\_status = null;
 /\*\* \* @var array \*/ public $set\_args = array();
 /\*\* \* Shortcodes constructor. \*/ public function \_\_construct() { add\_shortcode( 'ultimatemember', array( &$this, 'ultimatemember' ) );
 add\_shortcode( 'ultimatemember\_login', array( &$this, 'ultimatemember\_login' ) ); add\_shortcode( 'ultimatemember\_register', array( &$this, 'ultimatemember\_register' ) ); add\_shortcode( 'ultimatemember\_profile', array( &$this, 'ultimatemember\_profile' ) ); add\_shortcode( 'ultimatemember\_directory', array( &$this, 'ultimatemember\_directory' ) );
 add\_shortcode( 'um\_loggedin', array( &$this, 'um\_loggedin' ) ); add\_shortcode( 'um\_loggedout', array( &$this, 'um\_loggedout' ) ); add\_shortcode( 'um\_show\_content', array( &$this, 'um\_shortcode\_show\_content\_for\_role' ) ); add\_shortcode( 'ultimatemember\_searchform', array( &$this, 'ultimatemember\_searchform' ) );
 add\_shortcode( 'um\_author\_profile\_link', array( &$this, 'author\_profile\_link' ) );
 add\_filter( 'body\_class', array( &$this, 'body\_class' ), 0 );
 add\_filter( 'um\_shortcode\_args\_filter', array( &$this, 'display\_logout\_form' ), 99 ); add\_filter( 'um\_shortcode\_args\_filter', array( &$this, 'parse\_shortcode\_args' ), 99 );
 /\*\* \* UM hook \* \* @type filter \* @title um\_emoji\_base\_uri \* @description Change Emoji base URL \* @input\_vars \* [{"var":"$url","type":"string","desc":"Base URL"}] \* @change\_log \* ["Since: 2.0"] \* @usage \* <?php add\_filter( 'um\_emoji\_base\_uri', 'function\_name', 10, 1 ); ?> \* @example \* <?php \* add\_filter( 'um\_emoji\_base\_uri', 'my\_emoji\_base\_uri', 10, 1 ); \* function my\_emoji\_base\_uri( $url ) { \* // your code here \* return $url; \* } \* ?> \*/ $base\_uri = apply\_filters( 'um\_emoji\_base\_uri', 'https://s.w.org/images/core/emoji/' );
 $this->emoji[':)'] = $base\_uri . '72x72/1f604.png'; $this->emoji[':smiley:'] = $base\_uri . '72x72/1f603.png'; $this->emoji[':D'] = $base\_uri . '72x72/1f600.png'; $this->emoji[':$'] = $base\_uri . '72x72/1f60a.png'; $this->emoji[':relaxed:'] = $base\_uri . '72x72/263a.png'; $this->emoji[';)'] = $base\_uri . '72x72/1f609.png'; $this->emoji[':heart\_eyes:'] = $base\_uri . '72x72/1f60d.png'; $this->emoji[':kissing\_heart:'] = $base\_uri . '72x72/1f618.png'; $this->emoji[':kissing\_closed\_eyes:'] = $base\_uri . '72x72/1f61a.png'; $this->emoji[':kissing:'] = $base\_uri . '72x72/1f617.png'; $this->emoji[':kissing\_smiling\_eyes:'] = $base\_uri . '72x72/1f619.png'; $this->emoji[';P'] = $base\_uri . '72x72/1f61c.png'; $this->emoji[':P'] = $base\_uri . '72x72/1f61b.png'; $this->emoji[':stuck\_out\_tongue\_closed\_eyes:'] = $base\_uri . '72x72/1f61d.png'; $this->emoji[':flushed:'] = $base\_uri . '72x72/1f633.png'; $this->emoji[':grin:'] = $base\_uri . '72x72/1f601.png'; $this->emoji[':pensive:'] = $base\_uri . '72x72/1f614.png'; $this->emoji[':relieved:'] = $base\_uri . '72x72/1f60c.png'; $this->emoji[':unamused'] = $base\_uri . '72x72/1f612.png'; $this->emoji[':('] = $base\_uri . '72x72/1f61e.png'; $this->emoji[':persevere:'] = $base\_uri . '72x72/1f623.png'; $this->emoji[":'("] = $base\_uri . '72x72/1f622.png'; $this->emoji[':joy:'] = $base\_uri . '72x72/1f602.png'; $this->emoji[':sob:'] = $base\_uri . '72x72/1f62d.png'; $this->emoji[':sleepy:'] = $base\_uri . '72x72/1f62a.png'; $this->emoji[':disappointed\_relieved:'] = $base\_uri . '72x72/1f625.png'; $this->emoji[':cold\_sweat:'] = $base\_uri . '72x72/1f630.png'; $this->emoji[':sweat\_smile:'] = $base\_uri . '72x72/1f605.png'; $this->emoji[':sweat:'] = $base\_uri . '72x72/1f613.png'; $this->emoji[':weary:'] = $base\_uri . '72x72/1f629.png'; $this->emoji[':tired\_face:'] = $base\_uri . '72x72/1f62b.png'; $this->emoji[':fearful:'] = $base\_uri . '72x72/1f628.png'; $this->emoji[':scream:'] = $base\_uri . '72x72/1f631.png'; $this->emoji[':angry:'] = $base\_uri . '72x72/1f620.png'; $this->emoji[':rage:'] = $base\_uri . '72x72/1f621.png'; $this->emoji[':triumph'] = $base\_uri . '72x72/1f624.png'; $this->emoji[':confounded:'] = $base\_uri . '72x72/1f616.png'; $this->emoji[':laughing:'] = $base\_uri . '72x72/1f606.png'; $this->emoji[':yum:'] = $base\_uri . '72x72/1f60b.png'; $this->emoji[':mask:'] = $base\_uri . '72x72/1f637.png'; $this->emoji[':cool:'] = $base\_uri . '72x72/1f60e.png'; $this->emoji[':sleeping:'] = $base\_uri . '72x72/1f634.png'; $this->emoji[':dizzy\_face:'] = $base\_uri . '72x72/1f635.png'; $this->emoji[':astonished:'] = $base\_uri . '72x72/1f632.png'; $this->emoji[':worried:'] = $base\_uri . '72x72/1f61f.png'; $this->emoji[':frowning:'] = $base\_uri . '72x72/1f626.png'; $this->emoji[':anguished:'] = $base\_uri . '72x72/1f627.png'; $this->emoji[':smiling\_imp:'] = $base\_uri . '72x72/1f608.png'; $this->emoji[':imp:'] = $base\_uri . '72x72/1f47f.png'; $this->emoji[':open\_mouth:'] = $base\_uri . '72x72/1f62e.png'; $this->emoji[':grimacing:'] = $base\_uri . '72x72/1f62c.png'; $this->emoji[':neutral\_face:'] = $base\_uri . '72x72/1f610.png'; $this->emoji[':confused:'] = $base\_uri . '72x72/1f615.png'; $this->emoji[':hushed:'] = $base\_uri . '72x72/1f62f.png'; $this->emoji[':no\_mouth:'] = $base\_uri . '72x72/1f636.png'; $this->emoji[':innocent:'] = $base\_uri . '72x72/1f607.png'; $this->emoji[':smirk:'] = $base\_uri . '72x72/1f60f.png'; $this->emoji[':expressionless:'] = $base\_uri . '72x72/1f611.png'; }
 /\*\* \* Conditional logout form \* \* @param array $args \* \* @return array \*/ function display\_logout\_form( $args ) { if ( is\_user\_logged\_in() && isset( $args['mode'] ) && $args['mode'] == 'login' ) {
 if ( isset( UM()->user()->preview ) && UM()->user()->preview ) { return $args; }
 if ( get\_current\_user\_id() != um\_user( 'ID' ) ) { um\_fetch\_user( get\_current\_user\_id() ); }
 $args['template'] = 'logout'; }
 return $args; }
 /\*\* \* Filter shortcode args \* \* @param array $args \* \* @return array \*/ function parse\_shortcode\_args( $args ) { if ( $this->message\_mode == true ) { if ( ! empty( $\_REQUEST['um\_role'] ) ) { $args['template'] = 'message'; $roleID = sanitize\_key( $\_REQUEST['um\_role'] ); $role = UM()->roles()->role\_data( $roleID );
 if ( ! empty( $role ) && ! empty( $role['status'] ) ) { $message\_key = $role['status'] . '\_message'; $this->custom\_message = ! empty( $role[ $message\_key ] ) ? $this->convert\_user\_tags( stripslashes( $role[ $message\_key ] ) ) : ''; } } }
 foreach ( $args as $k => $v ) { $args[ $k ] = maybe\_unserialize( $args[ $k ] ); }
 return $args; }
 /\*\* \* Emoji support \* \* @param $content \* \* @return mixed|string \*/ function emotize( $content ) { $content = stripslashes( $content ); foreach ( $this->emoji as $code => $val ) { $regex = str\_replace(array('(', ')'), array("\\" . '(', "\\" . ')'), $code); $content = preg\_replace('/(' . $regex . ')(\s|$)/', '<img src="' . $val . '" alt="' . $code . '" title="' . $code . '" class="emoji" />$2', $content); } return $content; }
 /\*\* \* Remove wpautop filter for post content if it's UM core page \*/ function is\_um\_page() { if ( is\_ultimatemember() ) { remove\_filter( 'the\_content', 'wpautop' ); } }
 /\*\* \* Extend body classes. \* \* @param array $classes \* \* @return array \*/ public function body\_class( $classes ) { $array = UM()->config()->permalinks; if ( ! $array ) { return $classes; }
 foreach ( $array as $slug => $info ) { if ( um\_is\_core\_page( $slug ) ) { $classes[] = 'um-page'; $classes[] = 'um-page-' . $slug;
 if ( is\_user\_logged\_in() ) { $classes[] = 'um-page-loggedin'; } else { $classes[] = 'um-page-loggedout'; } } }
 if ( um\_is\_core\_page( 'user' ) && um\_is\_user\_himself() ) { $classes[] = 'um-own-profile'; }
 return $classes; }
 /\*\* \* Retrieve core login form \* \* @return int \*/ function core\_login\_form() { $forms = get\_posts(array('post\_type' => 'um\_form', 'posts\_per\_page' => 1, 'meta\_key' => '\_um\_core', 'meta\_value' => 'login')); $form\_id = isset( $forms[0]->ID ) ? $forms[0]->ID: 0;
 return $form\_id; }
 /\*\* \* Load a compatible template \* \* @param $tpl \*/ function load\_template( $tpl ) { $loop = ( $this->loop ) ? $this->loop : array();
 if ( isset( $this->set\_args ) && is\_array( $this->set\_args ) ) { $args = $this->set\_args;
 unset( $args['file'], $args['theme\_file'], $args['tpl'] );
 $args = apply\_filters( 'um\_template\_load\_args', $args, $tpl );
 /\* \* This use of extract() cannot be removed. There are many possible ways that \* templates could depend on variables that it creates existing, and no way to \* detect and deprecate it. \* \* Passing the EXTR\_SKIP flag is the safest option, ensuring globals and \* function variables cannot be overwritten. \*/ // phpcs:ignore WordPress.PHP.DontExtract.extract\_extract extract( $args, EXTR\_SKIP ); }
 $file = UM\_PATH . "templates/{$tpl}.php"; $theme\_file = get\_stylesheet\_directory() . "/ultimate-member/templates/{$tpl}.php"; if ( file\_exists( $theme\_file ) ) { $file = $theme\_file; }
 if ( file\_exists( $file ) ) { // Avoid Directory Traversal vulnerability by the checking the realpath. // Templates can be situated only in the get\_stylesheet\_directory() or plugindir templates. $real\_file = wp\_normalize\_path( realpath( $file ) ); if ( 0 === strpos( $real\_file, wp\_normalize\_path( UM\_PATH . "templates" . DIRECTORY\_SEPARATOR ) ) || 0 === strpos( $real\_file, wp\_normalize\_path( get\_stylesheet\_directory() . DIRECTORY\_SEPARATOR . 'ultimate-member' . DIRECTORY\_SEPARATOR . 'templates' . DIRECTORY\_SEPARATOR ) ) ) { include $file; } } }
 /\*\* \* Add class based on shortcode \* \* @param $mode \* @param array $args \* \* @return mixed|string|void \*/ function get\_class($mode, $args = array()) {
 $classes = 'um-' . $mode;
 if (is\_admin()) { $classes .= ' um-in-admin'; }
 if (isset(UM()->form()->errors) && UM()->form()->errors) { $classes .= ' um-err'; }
 if ( true === UM()->fields()->editing ) { $classes .= ' um-editing'; }
 if ( true === UM()->fields()->viewing ) { $classes .= ' um-viewing'; }
 if (isset($args['template']) && $args['template'] != $args['mode']) { $classes .= ' um-' . $args['template']; }
 /\*\* \* UM hook \* \* @type filter \* @title um\_form\_official\_classes\_\_hook \* @description Change official form classes \* @input\_vars \* [{"var":"$classes","type":"string","desc":"Classes string"}] \* @change\_log \* ["Since: 2.0"] \* @usage \* <?php add\_filter( 'um\_form\_official\_classes\_\_hook', 'function\_name', 10, 1 ); ?> \* @example \* <?php \* add\_filter( 'um\_form\_official\_classes\_\_hook', 'my\_form\_official\_classes', 10, 1 ); \* function my\_form\_official\_classes( $classes ) { \* // your code here \* return $classes; \* } \* ?> \*/ $classes = apply\_filters( 'um\_form\_official\_classes\_\_hook', $classes ); return $classes; }
 /\*\* \* Logged-in only content \* \* @param array $args \* @param string $content \* \* @return string \*/ function um\_loggedin( $args = array(), $content = "" ) { ob\_start();
 $args = shortcode\_atts( array( 'lock\_text' => \_\_( 'This content has been restricted to logged in users only. Please <a href="{login\_referrer}">login</a> to view this content.', 'ultimate-member' ), 'show\_lock' => 'yes', ), $args, 'um\_loggedin' );
 if ( ! is\_user\_logged\_in() ) { if ( 'no' === $args['show\_lock'] ) { echo ''; } else { $args['lock\_text'] = $this->convert\_locker\_tags( $args['lock\_text'] ); UM()->get\_template( 'login-to-view.php', '', $args, true ); } } else { if ( version\_compare( get\_bloginfo('version'),'5.4', '<' ) ) { echo do\_shortcode( $this->convert\_locker\_tags( wpautop( $content ) ) ); } else { echo apply\_shortcodes( $this->convert\_locker\_tags( wpautop( $content ) ) ); } }
 $output = ob\_get\_clean();
 return htmlspecialchars\_decode( $output, ENT\_NOQUOTES ); }
 /\*\* \* Logged-out only content \* \* @param array $args \* @param string $content \* \* @return string \*/ function um\_loggedout( $args = array(), $content = '' ) { ob\_start();
 // Hide for logged in users if ( is\_user\_logged\_in() ) { echo ''; } else { if ( version\_compare( get\_bloginfo('version'),'5.4', '<' ) ) { echo do\_shortcode( wpautop( $content ) ); } else { echo apply\_shortcodes( wpautop( $content ) ); } }
 $output = ob\_get\_clean(); return $output; }
 /\*\* \* Display post author's link to UM User Profile. \* \* @since 2.8.2 \* \* Example 1: [um\_author\_profile\_link] current post author User Profile URL \* Example 2: [um\_author\_profile\_link title="User profile" user\_id="29"] \* Example 3: [um\_author\_profile\_link title="User profile" user\_id="29"]Visit Author Profile[/um\_author\_profile\_link] \* Example 4: [um\_author\_profile\_link raw="1"] for result like http://localhost:8000/user/janedoe/ \* \* @param array $attr { \* Attributes of the shortcode. \* \* @type string $class A link class. \* @type string $title A link text. \* @type int $user\_id User ID. Author ID if empty. \* @type bool $raw Get raw URL or link layout. `false` by default. \* } \* @param string $content \* @return string Profile link HTML or profile link URL if the link text is empty. \*/ public function author\_profile\_link( $attr = array(), $content = '' ) { $default\_user\_id = 0; if ( is\_singular() ) { $default\_user\_id = get\_post()->post\_author; } elseif ( is\_author() ) { $default\_user\_id = get\_the\_author\_meta( 'ID' ); }
 $defaults\_atts = array( 'class' => 'um-link um-profile-link', 'title' => \_\_( 'Go to profile', 'ultimate-member' ), 'user\_id' => $default\_user\_id, 'raw' => false, );
 $atts = shortcode\_atts( $defaults\_atts, $attr, 'um\_author\_profile\_link' );
 if ( empty( $atts['user\_id'] ) ) { return ''; }
 $user\_id = absint( $atts['user\_id'] ); $url = um\_user\_profile\_url( $user\_id ); if ( empty( $url ) ) { return ''; }
 if ( ! empty( $atts['raw'] ) ) { return $url; }
 $title = ! empty( $atts['title'] ) ? $atts['title'] : \_\_( 'Go to profile', 'ultimate-member' ); $link\_html = empty( $content ) ? $title : $content;
 return '<a class="' . esc\_attr( $atts['class'] ) . '" href="' . esc\_url( $url ) . '" title="' . esc\_attr( $title ) . '">' . wp\_kses\_post( $link\_html ) . '</a>'; }
 /\*\* \* @param array $args \* \* @return string \*/ function ultimatemember\_login( $args = array() ) { global $wpdb;
 $args = ! empty( $args ) ? $args : array();
 $default\_login = $wpdb->get\_var( "SELECT pm.post\_id FROM {$wpdb->postmeta} pm LEFT JOIN {$wpdb->postmeta} pm2 ON( pm.post\_id = pm2.post\_id AND pm2.meta\_key = '\_um\_is\_default' ) WHERE pm.meta\_key = '\_um\_mode' AND pm.meta\_value = 'login' AND pm2.meta\_value = '1'" );
 $args['form\_id'] = $default\_login; $shortcode\_attrs = ''; foreach ( $args as $key => $value ) { $shortcode\_attrs .= " {$key}=\"{$value}\""; }
 if ( version\_compare( get\_bloginfo('version'),'5.4', '<' ) ) { return do\_shortcode( "[ultimatemember {$shortcode\_attrs} /]" ); } else { return apply\_shortcodes( "[ultimatemember {$shortcode\_attrs} /]" ); } }
 /\*\* \* @param array $args \* \* @return string \*/ function ultimatemember\_register( $args = array() ) { global $wpdb;
 $args = ! empty( $args ) ? $args : array();
 $default\_register = $wpdb->get\_var( "SELECT pm.post\_id FROM {$wpdb->postmeta} pm LEFT JOIN {$wpdb->postmeta} pm2 ON( pm.post\_id = pm2.post\_id AND pm2.meta\_key = '\_um\_is\_default' ) WHERE pm.meta\_key = '\_um\_mode' AND pm.meta\_value = 'register' AND pm2.meta\_value = '1'" );
 $args['form\_id'] = $default\_register; $shortcode\_attrs = ''; foreach ( $args as $key => $value ) { $shortcode\_attrs .= " {$key}=\"{$value}\""; }
 if ( version\_compare( get\_bloginfo('version'),'5.4', '<' ) ) { return do\_shortcode( "[ultimatemember {$shortcode\_attrs} /]" ); } else { return apply\_shortcodes( "[ultimatemember {$shortcode\_attrs} /]" ); } }
 /\*\* \* @param array $args \* \* @return string \*/ function ultimatemember\_profile( $args = array() ) { global $wpdb;
 $args = ! empty( $args ) ? $args : array();
 $default\_profile = $wpdb->get\_var( "SELECT pm.post\_id FROM {$wpdb->postmeta} pm LEFT JOIN {$wpdb->postmeta} pm2 ON( pm.post\_id = pm2.post\_id AND pm2.meta\_key = '\_um\_is\_default' ) WHERE pm.meta\_key = '\_um\_mode' AND pm.meta\_value = 'profile' AND pm2.meta\_value = '1'" );
 $args['form\_id'] = $default\_profile;
 $shortcode\_attrs = ''; foreach ( $args as $key => $value ) { $shortcode\_attrs .= " {$key}=\"{$value}\""; }
 if ( version\_compare( get\_bloginfo('version'),'5.4', '<' ) ) { return do\_shortcode( "[ultimatemember {$shortcode\_attrs} /]" ); } else { return apply\_shortcodes( "[ultimatemember {$shortcode\_attrs} /]" ); } }
 /\*\* \* @param array $args \* \* @return string \*/ function ultimatemember\_directory( $args = array() ) { global $wpdb;
 $args = ! empty( $args ) ? $args : array();
 $default\_directory = $wpdb->get\_var( "SELECT pm.post\_id FROM {$wpdb->postmeta} pm LEFT JOIN {$wpdb->postmeta} pm2 ON( pm.post\_id = pm2.post\_id AND pm2.meta\_key = '\_um\_is\_default' ) WHERE pm.meta\_key = '\_um\_mode' AND pm.meta\_value = 'directory' AND pm2.meta\_value = '1'" );
 $args['form\_id'] = $default\_directory;
 $shortcode\_attrs = ''; foreach ( $args as $key => $value ) { $shortcode\_attrs .= " {$key}=\"{$value}\""; }
 if ( version\_compare( get\_bloginfo('version'),'5.4', '<' ) ) { return do\_shortcode( "[ultimatemember {$shortcode\_attrs} /]" ); } else { return apply\_shortcodes( "[ultimatemember {$shortcode\_attrs} /]" ); } }
 /\*\* \* Shortcode \* \* @param array $args \* \* @return string \*/ public function ultimatemember( $args = array() ) { // There is possible to use 'shortcode\_atts\_ultimatemember' filter for getting customized `$args`. $args = shortcode\_atts( array( 'form\_id' => '', 'is\_block' => false, ), $args, 'ultimatemember' );
 // Sanitize shortcode arguments. $args['form\_id'] = ! empty( $args['form\_id'] ) ? absint( $args['form\_id'] ) : ''; $args['is\_block'] = (bool) $args['is\_block'];
 /\*\* \* Filters variable for enable singleton shortcode loading on the same page. \* Note: Set it to `false` if you don't need to render the same form twice or more on the same page. \* \* @since 2.6.8 \* @since 2.6.9 $disable argument set to `true` by default \* \* @hook um\_ultimatemember\_shortcode\_disable\_singleton \* \* @param {bool} $disable Disabled singleton. By default, it's `true`. \* @param {array} $args Shortcode arguments. \* \* @return {bool} Disabled singleton or not. \* \* @example <caption>Turn off ability to use ultimatemember shortcode twice.</caption> \* add\_filter( 'um\_ultimatemember\_shortcode\_disable\_singleton', '\_\_return\_false' ); \*/ $disable\_singleton\_shortcode = apply\_filters( 'um\_ultimatemember\_shortcode\_disable\_singleton', true, $args ); if ( false === $disable\_singleton\_shortcode ) { if ( isset( $args['form\_id'] ) ) { $id = $args['form\_id']; if ( isset( $this->forms\_exist[ $id ] ) && true === $this->forms\_exist[ $id ] ) { return ''; } $this->forms\_exist[ $id ] = true; } }
 return $this->load( $args ); }
 /\*\* \* Load a module with global function \* \* @param $args \* \* @return string \*/ public function load( $args ) { $defaults = array(); $args = wp\_parse\_args( $args, $defaults );
 // When to not continue. if ( ! array\_key\_exists( 'form\_id', $args ) ) { return ''; }
 $this->form\_id = $args['form\_id']; if ( empty( $this->form\_id ) ) { return ''; }
 $this->form\_status = get\_post\_status( $this->form\_id ); if ( 'publish' !== $this->form\_status ) { return ''; }
 UM()->fields()->set\_id = absint( $this->form\_id );
 // get data into one global array $post\_data = UM()->query()->post\_data( $this->form\_id ); $args = array\_merge( $args, $post\_data );
 ob\_start();
 /\*\* \* Filters arguments for loading Ultimate Member shortcodes. \* \* @since 1.3.x \* @hook um\_pre\_args\_setup \* \* @param {array} $args Data for loading shortcode. \* \* @return {array} Data for loading shortcode. \* \* @example <caption>Change arguments on load shortcode.</caption> \* function my\_pre\_args\_setup( $args ) { \* // your code here \* return $args; \* } \* add\_filter( 'um\_pre\_args\_setup', 'my\_pre\_args\_setup' ); \*/ $args = apply\_filters( 'um\_pre\_args\_setup', $args );
 if ( ! isset( $args['template'] ) ) { $args['template'] = ''; }
 if ( isset( $post\_data['template'] ) && $post\_data['template'] !== $args['template'] ) { $args['template'] = $post\_data['template']; }
 if ( ! $this->template\_exists( $args['template'] ) ) { $args['template'] = $post\_data['mode']; }
 if ( ! isset( $post\_data['template'] ) ) { $post\_data['template'] = $post\_data['mode']; }
 if ( 'directory' === $args['mode'] ) { wp\_enqueue\_script( 'um\_members' ); wp\_enqueue\_style( 'um\_members' ); }
 if ( 'directory' !== $args['mode'] ) { $args = array\_merge( $post\_data, $args );
 if ( empty( $args['use\_custom\_settings'] ) ) { $args = array\_merge( $args, $this->get\_css\_args( $args ) ); } else { $args = array\_merge( $this->get\_css\_args( $args ), $args ); } }
 /\*\* \* Filters change arguments on load shortcode. \* \* @since 1.3.x \* @hook um\_shortcode\_args\_filter \* \* @param {array} $args Shortcode arguments. \* \* @return {array} Shortcode arguments. \* \* @example <caption>Change arguments on load shortcode.</caption> \* function my\_shortcode\_args( $args ) { \* // your code here \* return $args; \* } \* add\_filter( 'um\_shortcode\_args\_filter', 'my\_shortcode\_args' ); \*/ $args = apply\_filters( 'um\_shortcode\_args\_filter', $args );
 if ( ! array\_key\_exists( 'mode', $args ) || ! array\_key\_exists( 'template', $args ) ) { ob\_get\_clean(); return ''; } $mode = $args['mode'];
 // Not display on admin preview. if ( empty( $\_POST['act\_id'] ) || 'um\_admin\_preview\_form' !== sanitize\_key( $\_POST['act\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification /\*\* \* Filters the ability to show registration form for the logged-in users. \* Set it to true for displaying registration form for the logged-in users. \* \* @since 2.1.20 \* @hook um\_registration\_for\_loggedin\_users \* \* @param {bool} $show Show registration form for the logged-in users. By default, it's false \* @param {array} $args Shortcode arguments. \* \* @return {bool} Show registration form for the logged-in users. \* \* @example <caption>Show registration form for the logged-in users for all UM registration forms on your website.</caption> \* add\_filter( 'um\_registration\_for\_loggedin\_users', '\_\_return\_true' ); \*/ $enable\_loggedin\_registration = apply\_filters( 'um\_registration\_for\_loggedin\_users', false, $args );
 if ( ! $enable\_loggedin\_registration && 'register' === $mode && is\_user\_logged\_in() ) { ob\_get\_clean(); return \_\_( 'You are already registered.', 'ultimate-member' ); } }
 if ( 'profile' === $mode && ! empty( $args['is\_block'] ) && ! is\_user\_logged\_in() ) { ob\_get\_clean(); return ''; }
 // For profiles only. if ( 'profile' === $mode && um\_profile\_id() ) { // Set requested user if it's not setup from permalinks (for not profile page in edit mode). if ( ! um\_get\_requested\_user() ) { um\_set\_requested\_user( um\_profile\_id() ); }
 if ( ! empty( $args['use\_custom\_settings'] ) && ! empty( $args['role'] ) ) { // Option "Apply custom settings to this form". Option "Make this profile form role-specific". // Show the first Profile Form with role selected, don't show profile forms below the page with other role-specific setting. if ( empty( $this->profile\_role ) ) { $current\_user\_roles = UM()->roles()->get\_all\_user\_roles( um\_profile\_id() );
 if ( empty( $current\_user\_roles ) ) { ob\_get\_clean(); return ''; } if ( is\_array( $args['role'] ) ) { if ( ! count( array\_intersect( $args['role'], $current\_user\_roles ) ) ) { ob\_get\_clean(); return ''; } } elseif ( ! in\_array( $args['role'], $current\_user\_roles, true ) ) { ob\_get\_clean(); return ''; }
 $this->profile\_role = $args['role']; } elseif ( $this->profile\_role !== $args['role'] ) { ob\_get\_clean(); return ''; } } }
 $content = apply\_filters( 'um\_force\_shortcode\_render', false, $args ); if ( false !== $content ) { ob\_get\_clean(); return $content; }
 /\*\* \* Fires before loading form shortcode. \* \* Note: $mode can be 'profile', 'login', 'register', 'account'. \* \* @since 1.3.x \* @hook um\_pre\_{$mode}\_shortcode \* \* @param {array} $args Form shortcode arguments. \* \* @example <caption>Make any custom action before loading a registration form shortcode.</caption> \* function my\_pre\_register\_shortcode( $args ) { \* // your code here \* } \* add\_action( 'um\_pre\_register\_shortcode', 'my\_pre\_register\_shortcode' ); \* @example <caption>Make any custom action before loading a login form shortcode.</caption> \* function my\_pre\_login\_shortcode( $args ) { \* // your code here \* } \* add\_action( 'um\_pre\_login\_shortcode', 'my\_pre\_login\_shortcode' ); \* @example <caption>Make any custom action before loading a password reset form shortcode.</caption> \* function my\_pre\_password\_shortcode( $args ) { \* // your code here \* } \* add\_action( 'um\_pre\_password\_shortcode', 'my\_pre\_password\_shortcode' ); \* @example <caption>Make any custom action before loading a profile form shortcode.</caption> \* function my\_pre\_profile\_shortcode( $args ) { \* // your code here \* } \* add\_action( 'um\_pre\_profile\_shortcode', 'my\_pre\_profile\_shortcode' ); \* @example <caption>Make any custom action before loading an account form shortcode.</caption> \* function my\_pre\_account\_shortcode( $args ) { \* // your code here \* } \* add\_action( 'um\_pre\_account\_shortcode', 'my\_pre\_account\_shortcode' ); \*/ do\_action( "um\_pre\_{$mode}\_shortcode", $args ); /\*\* \* Fires before loading form shortcode. \* \* @since 1.3.x \* @hook um\_before\_form\_is\_loaded \* \* @param {array} $args Form shortcode arguments. \* \* @example <caption>Make any custom action before loading UM form shortcode.</caption> \* function my\_pre\_shortcode( $args ) { \* // your code here \* } \* add\_action( 'um\_before\_form\_is\_loaded', 'my\_pre\_shortcode', 10, 1 ); \*/ do\_action( 'um\_before\_form\_is\_loaded', $args ); /\*\* \* Fires before loading a form shortcode. \* \* @since 1.3.x \* @todo Deprecate since 2.7.0. Use `um\_pre\_{$mode}\_shortcode` or `um\_before\_form\_is\_loaded` instead. \* @hook um\_before\_{$mode}\_form\_is\_loaded \* \* @param {array} $args Form shortcode arguments. \*/ do\_action( "um\_before\_{$mode}\_form\_is\_loaded", $args );
 $this->template\_load( $args['template'], $args );
 $this->dynamic\_css( $args );
 if ( 'logout' === $mode || um\_get\_requested\_user() ) { um\_reset\_user(); }
 /\*\* \* Fires after load shortcode content. \* \* @since 2.0 \* @hook um\_after\_everything\_output \* \* @param {array} $args Form shortcode arguments. \* \* @example <caption>Make any custom action after load shortcode content.</caption> \* function my\_pre\_shortcode() { \* // your code here \* } \* add\_action( 'um\_after\_everything\_output', 'my\_pre\_shortcode', 10 ); \*/ do\_action( 'um\_after\_everything\_output' );
 return ob\_get\_clean(); }
 /\*\* \* Get dynamic CSS args \* \* @param $args \* @return array \*/ public function get\_css\_args( $args ) { $arr = um\_styling\_defaults( $args['mode'] ); $arr = array\_merge( $arr, array( 'form\_id' => $args['form\_id'], 'mode' => $args['mode'], ) ); return $arr; }
 /\*\* \* Load dynamic CSS. \* \* @param array $args \* \* @return string[View remainder of file in raw view](https://github.com/ultimatemember/ultimatemember/raw/7b8a7a7c039bde4539c07e049b19036192f1c133/includes/core/class-shortcodes.php)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

