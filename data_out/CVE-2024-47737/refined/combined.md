=== Content from git.kernel.org_51bff8c5_20250110_160748.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c6b16e700cf4d959af524bd9d3978407ff7ce462)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c6b16e700cf4d959af524bd9d3978407ff7ce462)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c6b16e700cf4d959af524bd9d3978407ff7ce462)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c6b16e700cf4d959af524bd9d3978407ff7ce462)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Guoqing Jiang <guoqing.jiang@linux.dev> | 2024-08-21 22:03:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:20:32 +0100 |
| commit | [c6b16e700cf4d959af524bd9d3978407ff7ce462](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c6b16e700cf4d959af524bd9d3978407ff7ce462) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c6b16e700cf4d959af524bd9d3978407ff7ce462)) | |
| tree | [e1f791e92fbbee91ae36c2e4633384ed70c2a051](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c6b16e700cf4d959af524bd9d3978407ff7ce462) | |
| parent | [4b2fbba4e44630a59b09d32627b63c4ffdf70f78](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4b2fbba4e44630a59b09d32627b63c4ffdf70f78) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c6b16e700cf4d959af524bd9d3978407ff7ce462&id2=4b2fbba4e44630a59b09d32627b63c4ffdf70f78)) | |
| download | [linux-c6b16e700cf4d959af524bd9d3978407ff7ce462.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c6b16e700cf4d959af524bd9d3978407ff7ce462.tar.gz) | |

nfsd: call cache\_put if xdr\_reserve\_space returns NULL[ Upstream commit d078cbf5c38de83bc31f83c47dcd2184c04a50c7 ]
If not enough buffer space available, but idmap\_lookup has triggered
lookup\_fn which calls cache\_get and returns successfully. Then we
missed to call cache\_put here which pairs with cache\_get.
Fixes: ddd1ea563672 ("nfsd4: use xdr\_reserve\_space in attribute encoding")
Signed-off-by: Guoqing Jiang <guoqing.jiang@linux.dev>
Reviwed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c6b16e700cf4d959af524bd9d3978407ff7ce462)

| -rw-r--r-- | [fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfsd/nfs4idmap.c?id=c6b16e700cf4d959af524bd9d3978407ff7ce462) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 4 deletions

| diff --git a/fs/nfsd/nfs4idmap.c b/fs/nfsd/nfs4idmap.cindex d1f285245af802..06d7404354b99b 100644--- a/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=4b2fbba4e44630a59b09d32627b63c4ffdf70f78)+++ b/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=c6b16e700cf4d959af524bd9d3978407ff7ce462)@@ -566,6 +566,7 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, .id = id, .type = type, };+ \_\_be32 status = nfs\_ok; \_\_be32 \*p; int ret; struct nfsd\_net \*nn = net\_generic(SVC\_NET(rqstp), nfsd\_net\_id);@@ -578,12 +579,16 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, return nfserrno(ret); ret = strlen(item->name); WARN\_ON\_ONCE(ret > IDMAP\_NAMESZ);+ p = xdr\_reserve\_space(xdr, ret + 4);- if (!p)- return nfserr\_resource;- p = xdr\_encode\_opaque(p, item->name, ret);+ if (unlikely(!p)) {+ status = nfserr\_resource;+ goto out\_put;+ }+ xdr\_encode\_opaque(p, item->name, ret);+out\_put: cache\_put(&item->h, nn->idtoname\_cache);- return 0;+ return status; }  static bool |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:06:26 +0000



=== Content from git.kernel.org_b67c7931_20250110_160747.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9f03f0016ff797932551881c7e06ae50e9c39134)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9f03f0016ff797932551881c7e06ae50e9c39134)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9f03f0016ff797932551881c7e06ae50e9c39134)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9f03f0016ff797932551881c7e06ae50e9c39134)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Guoqing Jiang <guoqing.jiang@linux.dev> | 2024-08-21 22:03:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:07:55 +0200 |
| commit | [9f03f0016ff797932551881c7e06ae50e9c39134](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9f03f0016ff797932551881c7e06ae50e9c39134) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9f03f0016ff797932551881c7e06ae50e9c39134)) | |
| tree | [73892f6da5047c9f8ee8800429b4eccd4a1efbde](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9f03f0016ff797932551881c7e06ae50e9c39134) | |
| parent | [40d57873549998c0cc8917330da4e53de809b09f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=40d57873549998c0cc8917330da4e53de809b09f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9f03f0016ff797932551881c7e06ae50e9c39134&id2=40d57873549998c0cc8917330da4e53de809b09f)) | |
| download | [linux-9f03f0016ff797932551881c7e06ae50e9c39134.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9f03f0016ff797932551881c7e06ae50e9c39134.tar.gz) | |

nfsd: call cache\_put if xdr\_reserve\_space returns NULL[ Upstream commit d078cbf5c38de83bc31f83c47dcd2184c04a50c7 ]
If not enough buffer space available, but idmap\_lookup has triggered
lookup\_fn which calls cache\_get and returns successfully. Then we
missed to call cache\_put here which pairs with cache\_get.
Fixes: ddd1ea563672 ("nfsd4: use xdr\_reserve\_space in attribute encoding")
Signed-off-by: Guoqing Jiang <guoqing.jiang@linux.dev>
Reviwed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9f03f0016ff797932551881c7e06ae50e9c39134)

| -rw-r--r-- | [fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfsd/nfs4idmap.c?id=9f03f0016ff797932551881c7e06ae50e9c39134) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 4 deletions

| diff --git a/fs/nfsd/nfs4idmap.c b/fs/nfsd/nfs4idmap.cindex 5e9809aff37ebc..717e400b16b867 100644--- a/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=40d57873549998c0cc8917330da4e53de809b09f)+++ b/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=9f03f0016ff797932551881c7e06ae50e9c39134)@@ -581,6 +581,7 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, .id = id, .type = type, };+ \_\_be32 status = nfs\_ok; \_\_be32 \*p; int ret; struct nfsd\_net \*nn = net\_generic(SVC\_NET(rqstp), nfsd\_net\_id);@@ -593,12 +594,16 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, return nfserrno(ret); ret = strlen(item->name); WARN\_ON\_ONCE(ret > IDMAP\_NAMESZ);+ p = xdr\_reserve\_space(xdr, ret + 4);- if (!p)- return nfserr\_resource;- p = xdr\_encode\_opaque(p, item->name, ret);+ if (unlikely(!p)) {+ status = nfserr\_resource;+ goto out\_put;+ }+ xdr\_encode\_opaque(p, item->name, ret);+out\_put: cache\_put(&item->h, nn->idtoname\_cache);- return 0;+ return status; }  static bool |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:06:25 +0000



=== Content from git.kernel.org_938e5b48_20250110_160746.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8d0765f86135e27f0bb5c950c136495719b4c834)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8d0765f86135e27f0bb5c950c136495719b4c834)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8d0765f86135e27f0bb5c950c136495719b4c834)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8d0765f86135e27f0bb5c950c136495719b4c834)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Guoqing Jiang <guoqing.jiang@linux.dev> | 2024-08-21 22:03:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-04 16:38:17 +0200 |
| commit | [8d0765f86135e27f0bb5c950c136495719b4c834](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8d0765f86135e27f0bb5c950c136495719b4c834) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8d0765f86135e27f0bb5c950c136495719b4c834)) | |
| tree | [e4e4911b0217350beaf37cecb514940e8fa31bfe](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8d0765f86135e27f0bb5c950c136495719b4c834) | |
| parent | [507bc31cf3dd16f8b591b8b608149b099b1d70b1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=507bc31cf3dd16f8b591b8b608149b099b1d70b1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8d0765f86135e27f0bb5c950c136495719b4c834&id2=507bc31cf3dd16f8b591b8b608149b099b1d70b1)) | |
| download | [linux-8d0765f86135e27f0bb5c950c136495719b4c834.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8d0765f86135e27f0bb5c950c136495719b4c834.tar.gz) | |

nfsd: call cache\_put if xdr\_reserve\_space returns NULL[ Upstream commit d078cbf5c38de83bc31f83c47dcd2184c04a50c7 ]
If not enough buffer space available, but idmap\_lookup has triggered
lookup\_fn which calls cache\_get and returns successfully. Then we
missed to call cache\_put here which pairs with cache\_get.
Fixes: ddd1ea563672 ("nfsd4: use xdr\_reserve\_space in attribute encoding")
Signed-off-by: Guoqing Jiang <guoqing.jiang@linux.dev>
Reviwed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8d0765f86135e27f0bb5c950c136495719b4c834)

| -rw-r--r-- | [fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfsd/nfs4idmap.c?id=8d0765f86135e27f0bb5c950c136495719b4c834) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 4 deletions

| diff --git a/fs/nfsd/nfs4idmap.c b/fs/nfsd/nfs4idmap.cindex 7a806ac13e317e..8cca1329f3485c 100644--- a/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=507bc31cf3dd16f8b591b8b608149b099b1d70b1)+++ b/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=8d0765f86135e27f0bb5c950c136495719b4c834)@@ -581,6 +581,7 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, .id = id, .type = type, };+ \_\_be32 status = nfs\_ok; \_\_be32 \*p; int ret; struct nfsd\_net \*nn = net\_generic(SVC\_NET(rqstp), nfsd\_net\_id);@@ -593,12 +594,16 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, return nfserrno(ret); ret = strlen(item->name); WARN\_ON\_ONCE(ret > IDMAP\_NAMESZ);+ p = xdr\_reserve\_space(xdr, ret + 4);- if (!p)- return nfserr\_resource;- p = xdr\_encode\_opaque(p, item->name, ret);+ if (unlikely(!p)) {+ status = nfserr\_resource;+ goto out\_put;+ }+ xdr\_encode\_opaque(p, item->name, ret);+out\_put: cache\_put(&item->h, nn->idtoname\_cache);- return 0;+ return status; }  static bool |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:06:23 +0000



=== Content from git.kernel.org_6c7c91b0_20250110_160749.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d078cbf5c38de83bc31f83c47dcd2184c04a50c7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d078cbf5c38de83bc31f83c47dcd2184c04a50c7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d078cbf5c38de83bc31f83c47dcd2184c04a50c7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d078cbf5c38de83bc31f83c47dcd2184c04a50c7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Guoqing Jiang <guoqing.jiang@linux.dev> | 2024-08-21 22:03:18 +0800 |
| --- | --- | --- |
| committer | Chuck Lever <chuck.lever@oracle.com> | 2024-09-20 19:31:03 -0400 |
| commit | [d078cbf5c38de83bc31f83c47dcd2184c04a50c7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d078cbf5c38de83bc31f83c47dcd2184c04a50c7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d078cbf5c38de83bc31f83c47dcd2184c04a50c7)) | |
| tree | [eb6da0d10591eab12c89485f93d5ee37bdcbf51f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d078cbf5c38de83bc31f83c47dcd2184c04a50c7) | |
| parent | [ba017fd391e05aba3d8a96c06d0287ffeeb8458c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ba017fd391e05aba3d8a96c06d0287ffeeb8458c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d078cbf5c38de83bc31f83c47dcd2184c04a50c7&id2=ba017fd391e05aba3d8a96c06d0287ffeeb8458c)) | |
| download | [linux-d078cbf5c38de83bc31f83c47dcd2184c04a50c7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d078cbf5c38de83bc31f83c47dcd2184c04a50c7.tar.gz) | |

nfsd: call cache\_put if xdr\_reserve\_space returns NULLIf not enough buffer space available, but idmap\_lookup has triggered
lookup\_fn which calls cache\_get and returns successfully. Then we
missed to call cache\_put here which pairs with cache\_get.
Fixes: ddd1ea563672 ("nfsd4: use xdr\_reserve\_space in attribute encoding")
Signed-off-by: Guoqing Jiang <guoqing.jiang@linux.dev>
Reviwed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d078cbf5c38de83bc31f83c47dcd2184c04a50c7)

| -rw-r--r-- | [fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfsd/nfs4idmap.c?id=d078cbf5c38de83bc31f83c47dcd2184c04a50c7) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 4 deletions

| diff --git a/fs/nfsd/nfs4idmap.c b/fs/nfsd/nfs4idmap.cindex 7a806ac13e317e..8cca1329f3485c 100644--- a/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=ba017fd391e05aba3d8a96c06d0287ffeeb8458c)+++ b/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=d078cbf5c38de83bc31f83c47dcd2184c04a50c7)@@ -581,6 +581,7 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, .id = id, .type = type, };+ \_\_be32 status = nfs\_ok; \_\_be32 \*p; int ret; struct nfsd\_net \*nn = net\_generic(SVC\_NET(rqstp), nfsd\_net\_id);@@ -593,12 +594,16 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, return nfserrno(ret); ret = strlen(item->name); WARN\_ON\_ONCE(ret > IDMAP\_NAMESZ);+ p = xdr\_reserve\_space(xdr, ret + 4);- if (!p)- return nfserr\_resource;- p = xdr\_encode\_opaque(p, item->name, ret);+ if (unlikely(!p)) {+ status = nfserr\_resource;+ goto out\_put;+ }+ xdr\_encode\_opaque(p, item->name, ret);+out\_put: cache\_put(&item->h, nn->idtoname\_cache);- return 0;+ return status; }  static bool |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:06:26 +0000



=== Content from git.kernel.org_0d8a5f24_20250110_160746.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=81821617312988096f5deccf0f7da6f888e98056)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=81821617312988096f5deccf0f7da6f888e98056)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=81821617312988096f5deccf0f7da6f888e98056)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=81821617312988096f5deccf0f7da6f888e98056)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Guoqing Jiang <guoqing.jiang@linux.dev> | 2024-08-21 22:03:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:21:08 +0200 |
| commit | [81821617312988096f5deccf0f7da6f888e98056](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=81821617312988096f5deccf0f7da6f888e98056) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=81821617312988096f5deccf0f7da6f888e98056)) | |
| tree | [1e8153328099e8c75a96a97bd57958d50ee91d46](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=81821617312988096f5deccf0f7da6f888e98056) | |
| parent | [44e1ecc70272942249621326deb6a26e3dbf7a40](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=44e1ecc70272942249621326deb6a26e3dbf7a40) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=81821617312988096f5deccf0f7da6f888e98056&id2=44e1ecc70272942249621326deb6a26e3dbf7a40)) | |
| download | [linux-81821617312988096f5deccf0f7da6f888e98056.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-81821617312988096f5deccf0f7da6f888e98056.tar.gz) | |

nfsd: call cache\_put if xdr\_reserve\_space returns NULL[ Upstream commit d078cbf5c38de83bc31f83c47dcd2184c04a50c7 ]
If not enough buffer space available, but idmap\_lookup has triggered
lookup\_fn which calls cache\_get and returns successfully. Then we
missed to call cache\_put here which pairs with cache\_get.
Fixes: ddd1ea563672 ("nfsd4: use xdr\_reserve\_space in attribute encoding")
Signed-off-by: Guoqing Jiang <guoqing.jiang@linux.dev>
Reviwed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=81821617312988096f5deccf0f7da6f888e98056)

| -rw-r--r-- | [fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfsd/nfs4idmap.c?id=81821617312988096f5deccf0f7da6f888e98056) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 4 deletions

| diff --git a/fs/nfsd/nfs4idmap.c b/fs/nfsd/nfs4idmap.cindex 5e9809aff37ebc..717e400b16b867 100644--- a/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=44e1ecc70272942249621326deb6a26e3dbf7a40)+++ b/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=81821617312988096f5deccf0f7da6f888e98056)@@ -581,6 +581,7 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, .id = id, .type = type, };+ \_\_be32 status = nfs\_ok; \_\_be32 \*p; int ret; struct nfsd\_net \*nn = net\_generic(SVC\_NET(rqstp), nfsd\_net\_id);@@ -593,12 +594,16 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, return nfserrno(ret); ret = strlen(item->name); WARN\_ON\_ONCE(ret > IDMAP\_NAMESZ);+ p = xdr\_reserve\_space(xdr, ret + 4);- if (!p)- return nfserr\_resource;- p = xdr\_encode\_opaque(p, item->name, ret);+ if (unlikely(!p)) {+ status = nfserr\_resource;+ goto out\_put;+ }+ xdr\_encode\_opaque(p, item->name, ret);+out\_put: cache\_put(&item->h, nn->idtoname\_cache);- return 0;+ return status; }  static bool |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:06:23 +0000



=== Content from git.kernel.org_44134e0c_20250110_160745.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3e8081ebff12bec1347deaceb6bce0765cce54df)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3e8081ebff12bec1347deaceb6bce0765cce54df)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3e8081ebff12bec1347deaceb6bce0765cce54df)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3e8081ebff12bec1347deaceb6bce0765cce54df)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Guoqing Jiang <guoqing.jiang@linux.dev> | 2024-08-21 22:03:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:19:07 +0100 |
| commit | [3e8081ebff12bec1347deaceb6bce0765cce54df](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3e8081ebff12bec1347deaceb6bce0765cce54df) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3e8081ebff12bec1347deaceb6bce0765cce54df)) | |
| tree | [fdb8a725119be8962e97db15077141e4b1d1313e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3e8081ebff12bec1347deaceb6bce0765cce54df) | |
| parent | [20cbc281033ef5324f67f2d54bc539968f937255](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=20cbc281033ef5324f67f2d54bc539968f937255) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3e8081ebff12bec1347deaceb6bce0765cce54df&id2=20cbc281033ef5324f67f2d54bc539968f937255)) | |
| download | [linux-3e8081ebff12bec1347deaceb6bce0765cce54df.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3e8081ebff12bec1347deaceb6bce0765cce54df.tar.gz) | |

nfsd: call cache\_put if xdr\_reserve\_space returns NULL[ Upstream commit d078cbf5c38de83bc31f83c47dcd2184c04a50c7 ]
If not enough buffer space available, but idmap\_lookup has triggered
lookup\_fn which calls cache\_get and returns successfully. Then we
missed to call cache\_put here which pairs with cache\_get.
Fixes: ddd1ea563672 ("nfsd4: use xdr\_reserve\_space in attribute encoding")
Signed-off-by: Guoqing Jiang <guoqing.jiang@linux.dev>
Reviwed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3e8081ebff12bec1347deaceb6bce0765cce54df)

| -rw-r--r-- | [fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfsd/nfs4idmap.c?id=3e8081ebff12bec1347deaceb6bce0765cce54df) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 4 deletions

| diff --git a/fs/nfsd/nfs4idmap.c b/fs/nfsd/nfs4idmap.cindex a5bb76593ce72c..de6bab641b20cd 100644--- a/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=20cbc281033ef5324f67f2d54bc539968f937255)+++ b/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=3e8081ebff12bec1347deaceb6bce0765cce54df)@@ -565,6 +565,7 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, .id = id, .type = type, };+ \_\_be32 status = nfs\_ok; \_\_be32 \*p; int ret; struct nfsd\_net \*nn = net\_generic(SVC\_NET(rqstp), nfsd\_net\_id);@@ -577,12 +578,16 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, return nfserrno(ret); ret = strlen(item->name); WARN\_ON\_ONCE(ret > IDMAP\_NAMESZ);+ p = xdr\_reserve\_space(xdr, ret + 4);- if (!p)- return nfserr\_resource;- p = xdr\_encode\_opaque(p, item->name, ret);+ if (unlikely(!p)) {+ status = nfserr\_resource;+ goto out\_put;+ }+ xdr\_encode\_opaque(p, item->name, ret);+out\_put: cache\_put(&item->h, nn->idtoname\_cache);- return 0;+ return status; }  static bool |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:06:22 +0000



=== Content from git.kernel.org_675b2dbd_20250110_160749.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e32ee6a61041925d1a05c14d10352dcfce9ef029)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e32ee6a61041925d1a05c14d10352dcfce9ef029)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e32ee6a61041925d1a05c14d10352dcfce9ef029)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e32ee6a61041925d1a05c14d10352dcfce9ef029)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Guoqing Jiang <guoqing.jiang@linux.dev> | 2024-08-21 22:03:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-04 16:33:13 +0200 |
| commit | [e32ee6a61041925d1a05c14d10352dcfce9ef029](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e32ee6a61041925d1a05c14d10352dcfce9ef029) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e32ee6a61041925d1a05c14d10352dcfce9ef029)) | |
| tree | [2c0b301b17fd1c30203bd5dde3602334b7ed51e0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e32ee6a61041925d1a05c14d10352dcfce9ef029) | |
| parent | [d1cb8394545b4270c4b844adccdfcf9fcf56ed4e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d1cb8394545b4270c4b844adccdfcf9fcf56ed4e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e32ee6a61041925d1a05c14d10352dcfce9ef029&id2=d1cb8394545b4270c4b844adccdfcf9fcf56ed4e)) | |
| download | [linux-e32ee6a61041925d1a05c14d10352dcfce9ef029.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e32ee6a61041925d1a05c14d10352dcfce9ef029.tar.gz) | |

nfsd: call cache\_put if xdr\_reserve\_space returns NULL[ Upstream commit d078cbf5c38de83bc31f83c47dcd2184c04a50c7 ]
If not enough buffer space available, but idmap\_lookup has triggered
lookup\_fn which calls cache\_get and returns successfully. Then we
missed to call cache\_put here which pairs with cache\_get.
Fixes: ddd1ea563672 ("nfsd4: use xdr\_reserve\_space in attribute encoding")
Signed-off-by: Guoqing Jiang <guoqing.jiang@linux.dev>
Reviwed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e32ee6a61041925d1a05c14d10352dcfce9ef029)

| -rw-r--r-- | [fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfsd/nfs4idmap.c?id=e32ee6a61041925d1a05c14d10352dcfce9ef029) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 4 deletions

| diff --git a/fs/nfsd/nfs4idmap.c b/fs/nfsd/nfs4idmap.cindex 7a806ac13e317e..8cca1329f3485c 100644--- a/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=d1cb8394545b4270c4b844adccdfcf9fcf56ed4e)+++ b/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=e32ee6a61041925d1a05c14d10352dcfce9ef029)@@ -581,6 +581,7 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, .id = id, .type = type, };+ \_\_be32 status = nfs\_ok; \_\_be32 \*p; int ret; struct nfsd\_net \*nn = net\_generic(SVC\_NET(rqstp), nfsd\_net\_id);@@ -593,12 +594,16 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, return nfserrno(ret); ret = strlen(item->name); WARN\_ON\_ONCE(ret > IDMAP\_NAMESZ);+ p = xdr\_reserve\_space(xdr, ret + 4);- if (!p)- return nfserr\_resource;- p = xdr\_encode\_opaque(p, item->name, ret);+ if (unlikely(!p)) {+ status = nfserr\_resource;+ goto out\_put;+ }+ xdr\_encode\_opaque(p, item->name, ret);+out\_put: cache\_put(&item->h, nn->idtoname\_cache);- return 0;+ return status; }  static bool |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:06:27 +0000



=== Content from git.kernel.org_316e4312_20250110_160747.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9803ab882d565a8fb2dde5999d98866d1c499dfd)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9803ab882d565a8fb2dde5999d98866d1c499dfd)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9803ab882d565a8fb2dde5999d98866d1c499dfd)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9803ab882d565a8fb2dde5999d98866d1c499dfd)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Guoqing Jiang <guoqing.jiang@linux.dev> | 2024-08-21 22:03:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:11:04 +0200 |
| commit | [9803ab882d565a8fb2dde5999d98866d1c499dfd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9803ab882d565a8fb2dde5999d98866d1c499dfd) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9803ab882d565a8fb2dde5999d98866d1c499dfd)) | |
| tree | [e01d26bae6b1f997337f17d46dce1c34a532d3cf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9803ab882d565a8fb2dde5999d98866d1c499dfd) | |
| parent | [85a84de8e3602a04417ea3d2b006ef316f3dd723](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=85a84de8e3602a04417ea3d2b006ef316f3dd723) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9803ab882d565a8fb2dde5999d98866d1c499dfd&id2=85a84de8e3602a04417ea3d2b006ef316f3dd723)) | |
| download | [linux-9803ab882d565a8fb2dde5999d98866d1c499dfd.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9803ab882d565a8fb2dde5999d98866d1c499dfd.tar.gz) | |

nfsd: call cache\_put if xdr\_reserve\_space returns NULL[ Upstream commit d078cbf5c38de83bc31f83c47dcd2184c04a50c7 ]
If not enough buffer space available, but idmap\_lookup has triggered
lookup\_fn which calls cache\_get and returns successfully. Then we
missed to call cache\_put here which pairs with cache\_get.
Fixes: ddd1ea563672 ("nfsd4: use xdr\_reserve\_space in attribute encoding")
Signed-off-by: Guoqing Jiang <guoqing.jiang@linux.dev>
Reviwed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9803ab882d565a8fb2dde5999d98866d1c499dfd)

| -rw-r--r-- | [fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfsd/nfs4idmap.c?id=9803ab882d565a8fb2dde5999d98866d1c499dfd) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 4 deletions

| diff --git a/fs/nfsd/nfs4idmap.c b/fs/nfsd/nfs4idmap.cindex 5e9809aff37ebc..717e400b16b867 100644--- a/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=85a84de8e3602a04417ea3d2b006ef316f3dd723)+++ b/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=9803ab882d565a8fb2dde5999d98866d1c499dfd)@@ -581,6 +581,7 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, .id = id, .type = type, };+ \_\_be32 status = nfs\_ok; \_\_be32 \*p; int ret; struct nfsd\_net \*nn = net\_generic(SVC\_NET(rqstp), nfsd\_net\_id);@@ -593,12 +594,16 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, return nfserrno(ret); ret = strlen(item->name); WARN\_ON\_ONCE(ret > IDMAP\_NAMESZ);+ p = xdr\_reserve\_space(xdr, ret + 4);- if (!p)- return nfserr\_resource;- p = xdr\_encode\_opaque(p, item->name, ret);+ if (unlikely(!p)) {+ status = nfserr\_resource;+ goto out\_put;+ }+ xdr\_encode\_opaque(p, item->name, ret);+out\_put: cache\_put(&item->h, nn->idtoname\_cache);- return 0;+ return status; }  static bool |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:06:24 +0000



=== Content from git.kernel.org_f48a6fe0_20250110_160748.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a1afbbb5276f943ad7173d0b4c626b8c75a260da)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a1afbbb5276f943ad7173d0b4c626b8c75a260da)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a1afbbb5276f943ad7173d0b4c626b8c75a260da)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a1afbbb5276f943ad7173d0b4c626b8c75a260da)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Guoqing Jiang <guoqing.jiang@linux.dev> | 2024-08-21 22:03:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-04 16:29:35 +0200 |
| commit | [a1afbbb5276f943ad7173d0b4c626b8c75a260da](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a1afbbb5276f943ad7173d0b4c626b8c75a260da) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a1afbbb5276f943ad7173d0b4c626b8c75a260da)) | |
| tree | [c313215e34a7dd77f099daf035c80794e93de031](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a1afbbb5276f943ad7173d0b4c626b8c75a260da) | |
| parent | [b743922b5aadbe714e08545d4002f23554162b4f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b743922b5aadbe714e08545d4002f23554162b4f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a1afbbb5276f943ad7173d0b4c626b8c75a260da&id2=b743922b5aadbe714e08545d4002f23554162b4f)) | |
| download | [linux-a1afbbb5276f943ad7173d0b4c626b8c75a260da.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a1afbbb5276f943ad7173d0b4c626b8c75a260da.tar.gz) | |

nfsd: call cache\_put if xdr\_reserve\_space returns NULL[ Upstream commit d078cbf5c38de83bc31f83c47dcd2184c04a50c7 ]
If not enough buffer space available, but idmap\_lookup has triggered
lookup\_fn which calls cache\_get and returns successfully. Then we
missed to call cache\_put here which pairs with cache\_get.
Fixes: ddd1ea563672 ("nfsd4: use xdr\_reserve\_space in attribute encoding")
Signed-off-by: Guoqing Jiang <guoqing.jiang@linux.dev>
Reviwed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a1afbbb5276f943ad7173d0b4c626b8c75a260da)

| -rw-r--r-- | [fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfsd/nfs4idmap.c?id=a1afbbb5276f943ad7173d0b4c626b8c75a260da) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 4 deletions

| diff --git a/fs/nfsd/nfs4idmap.c b/fs/nfsd/nfs4idmap.cindex 7a806ac13e317e..8cca1329f3485c 100644--- a/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=b743922b5aadbe714e08545d4002f23554162b4f)+++ b/[fs/nfsd/nfs4idmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/nfs4idmap.c?id=a1afbbb5276f943ad7173d0b4c626b8c75a260da)@@ -581,6 +581,7 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, .id = id, .type = type, };+ \_\_be32 status = nfs\_ok; \_\_be32 \*p; int ret; struct nfsd\_net \*nn = net\_generic(SVC\_NET(rqstp), nfsd\_net\_id);@@ -593,12 +594,16 @@ static \_\_be32 idmap\_id\_to\_name(struct xdr\_stream \*xdr, return nfserrno(ret); ret = strlen(item->name); WARN\_ON\_ONCE(ret > IDMAP\_NAMESZ);+ p = xdr\_reserve\_space(xdr, ret + 4);- if (!p)- return nfserr\_resource;- p = xdr\_encode\_opaque(p, item->name, ret);+ if (unlikely(!p)) {+ status = nfserr\_resource;+ goto out\_put;+ }+ xdr\_encode\_opaque(p, item->name, ret);+out\_put: cache\_put(&item->h, nn->idtoname\_cache);- return 0;+ return status; }  static bool |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:06:25 +0000


