
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fflatpak%2Fflatpak%2Fsecurity%2Fadvisories%2FGHSA-7hgv-f2j8-xw87)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fflatpak%2Fflatpak%2Fsecurity%2Fadvisories%2FGHSA-7hgv-f2j8-xw87)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=flatpak%2Fflatpak)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[flatpak](/flatpak)
/
**[flatpak](/flatpak/flatpak)**
Public

* [Notifications](/login?return_to=%2Fflatpak%2Fflatpak) You must be signed in to change notification settings
* [Fork
  407](/login?return_to=%2Fflatpak%2Fflatpak)
* [Star
   4.3k](/login?return_to=%2Fflatpak%2Fflatpak)

* [Code](/flatpak/flatpak)
* [Issues
  986](/flatpak/flatpak/issues)
* [Pull requests
  70](/flatpak/flatpak/pulls)
* [Actions](/flatpak/flatpak/actions)
* [Projects
  0](/flatpak/flatpak/projects)
* [Wiki](/flatpak/flatpak/wiki)
* [Security](/flatpak/flatpak/security)
* [Insights](/flatpak/flatpak/pulse)

Additional navigation options

* [Code](/flatpak/flatpak)
* [Issues](/flatpak/flatpak/issues)
* [Pull requests](/flatpak/flatpak/pulls)
* [Actions](/flatpak/flatpak/actions)
* [Projects](/flatpak/flatpak/projects)
* [Wiki](/flatpak/flatpak/wiki)
* [Security](/flatpak/flatpak/security)
* [Insights](/flatpak/flatpak/pulse)

# CVE-2024-42472: Access to files outside sandbox for apps using persistent= (--persist)

High

[smcv](/smcv)
published
GHSA-7hgv-f2j8-xw87
Aug 14, 2024

## Package

Flatpak
(freedesktop.org)

## Affected versions

all ≤ 1.14.8, 1.15x ≤ 1.15.9

## Patched versions

1.14.x ≥ 1.14.10, all ≥ 1.15.10

## Description

Chris Williams discovered an issue with how flatpak mounts persistent directories, which can allow an application using them to access host files.

### Impact

A malicious or compromised Flatpak app using persistent directories could read and write files in locations it would not normally have access to, which is an attack on integrity and confidentiality.

### Description

When `persistent=subdir` is used in the application permissions (represented as `--persist=subdir` in the command-line interface), that means that an application which otherwise doesn't have access to the real user home directory will see an empty home directory with a writeable subdirectory `subdir`. Behind the scenes, this directory is actually a bind mount and the data is stored in the per-application directory as `~/.var/app/$APPID/subdir`. This allows existing apps that are not aware of the per-application directory to still work as intended without general home directory access.

However, the application does have write access to the application directory `~/.var/app/$APPID` where this directory is stored. If the source directory for the `persistent`/`--persist` option is replaced by a symlink, then the next time the application is started, the bind mount will follow the symlink and mount whatever it points to into the sandbox.

For example, `org.mozilla.Thunderbird` has `persistent=.thunderbird`, and is not meant to be able to access `~/.ssh`.

In this example, `%` represents a shell prompt on the host system, and `$` represents a shell prompt inside the app sandbox.

```
% flatpak run --command=sh org.mozilla.Thunderbird
$ mv ~/.var/app/org.mozilla.Thunderbird/.thunderbird{,.save}
$ ln -s ~/.ssh ~/.var/app/org.mozilla.Thunderbird/.thunderbird
$ exit
% flatpak run --command=sh org.mozilla.Thunderbird
$ ls ~/.thunderbird
{contents of ~/.ssh/}

```
### Patches

Partial protection against this vulnerability can be provided by patching Flatpak:

* [3caeb16c "Don't follow symlinks when mounting persisted directories"](https://github.com/flatpak/flatpak/commit/3caeb16c31a3ed62d744e2aaf01d684f7991051a)
  + Backport for 1.14.x and older: [8a18137d](https://github.com/flatpak/flatpak/commit/8a18137d7e80f0575e8defabf677d81e5cc3a788)
* [2cdd1e1e "Add test coverage for --persist"](https://github.com/flatpak/flatpak/commit/2cdd1e1e5ae90d7c3a4b60ce2e36e4d609e44e72)
  + Backport for 1.14.x and older: [db3a7852](https://github.com/flatpak/flatpak/commit/db3a785241fda63bf53f0ec12bb519aa5210de19)

However, this leaves a race condition that could be exploited by two instances of a malicious app running in parallel. Closing the race condition requires updating or patching the version of bubblewrap that is used by Flatpak to add the new `--bind-fd` option:

* [a253257c "Add --bind-fd and --ro-bind-fd to let you bind a O\_PATH fd"](https://github.com/containers/bubblewrap/commit/a253257cd298892da43e15201d83f9a02c9b58b5), available in bubblewrap ≥ 0.10.0
  + Backport available in bubblewrap 0.6.x ≥ 0.6.3: [68e75c30](https://github.com/containers/bubblewrap/commit/68e75c3091c87583c28a439b45c45627a94d622c)

and then patching Flatpak to use it:

* [6bd603f6 "persist directories: Pass using new bwrap --bind-fd option"](https://github.com/flatpak/flatpak/commit/6bd603f6836e9b38b9b937d3b78f3fbf36e7ff75)
  + Backport for 1.14.x and older: [7c63e53b](https://github.com/flatpak/flatpak/commit/7c63e53bb2af0aae9097fd2edfd6a9ba9d453e97)

If Flatpak has been configured at build-time with `-Dsystem_bubblewrap=bwrap` (1.15.x) or `--with-system-bubblewrap=bwrap` (1.14.x or older), or a similar option, then the version of bubblewrap that needs to be patched or updated is a system copy that is distributed separately, typically `/usr/bin/bwrap`. This configuration is the one that is typically used in Linux distributions.

If Flatpak has been configured at build-time with `-Dsystem_bubblewrap=` (1.15.x) or with `--without-system-bubblewrap` (1.14.x or older), then it is the bundled version of bubblewrap that is included with Flatpak that must be patched. This is typically installed as `/usr/libexec/flatpak-bwrap`. This configuration is the default when building from source code.

For the 1.14.x stable branch, these changes are included in Flatpak 1.14.10. The bundled version of bubblewrap included in this release has been updated to 0.6.3.

For the 1.15.x development branch, these changes are included in Flatpak 1.15.10. The bundled version of bubblewrap in this release is a Meson "wrap" subproject, which has been updated to 0.10.0.

The 1.12.x and 1.10.x branches have reached end-of-life and will not receive new releases for this vulnerability. Long-term support OS distributions should update to newer versions if their stability policy allows it, or backport the individual changes into their versions of Flatpak and bubblewrap (the backported versions from Flatpak 1.14.x are more compatible with older GLib releases).

### Compatibility issues

If users have manually replaced a Flatpak app's persistent directory with a symlink, the persistent directory will now be ignored for security reasons, and the most likely result is that the app will fail to save its state. If an affected app is run from a terminal with `flatpak run`, Flatpak will show a warning message similar to:

`F: Failed to create persist path foobar: Symbolic link "foobar" not allowed to avoid sandbox escape`

and the persistent directory will not be used.

If users find that they need to move persistent directories onto another filesystem due to lack of space, using bind mounts for this purpose is preferable to using symlinks.

### Workarounds

This only affects applications using the `persistent` (`--persist`) permission. You can list all apps using this feature like this:

```
$ for app in $(flatpak list --app --columns=application | tail -n +1) ; do \
    flatpak info -m $app | grep persistent= -H --label="$app"; \
done

```

### Severity

High

### CVE ID

CVE-2024-42472

### Weaknesses

No CWEs

### Credits

* [![@chrisawi](https://avatars.githubusercontent.com/u/12790968?s=40&v=4)](/chrisawi)
  [chrisawi](/chrisawi)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

