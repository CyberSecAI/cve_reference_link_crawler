<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/mandoc.css" type="text/css" media="all">
  <title>pledge(2) - OpenBSD manual pages</title>
</head>
<body>
<header>
<section>
<h1><a href="https://www.openbsd.org/">OpenBSD</a> manual page server</h1>
</section>
<form role="search" action="/" method="get" autocomplete="off" autocapitalize="none">
  <fieldset>
    <legend>Manual Page Search Parameters</legend>
    <label>Search query:
      <input type="search" name="query" value="pledge" size="40">
    </label>
    <button type="submit" name="apropos" value="0">man</button>
    <button type="submit" name="apropos" value="1">apropos</button>
    <br/>
    <select name="sec" aria-label="Manual section">
      <option value="0">All Sections</option>
      <option value="1">1 - General Commands</option>
      <option value="2" selected="selected">2 - System Calls</option>
      <option value="3">3 - Library Functions</option>
      <option value="3p">3p - Perl Library</option>
      <option value="4">4 - Device Drivers</option>
      <option value="5">5 - File Formats</option>
      <option value="6">6 - Games</option>
      <option value="7">7 - Miscellaneous Information</option>
      <option value="8">8 - System Manager's Manual</option>
      <option value="9">9 - Kernel Developer's Manual</option>
    </select>
    <select name="arch" aria-label="CPU architecture">
      <option value="default" selected="selected">All Architectures</option>
      <option>amd64</option>
      <option>alpha</option>
      <option>armv7</option>
      <option>arm64</option>
      <option>hppa</option>
      <option>i386</option>
      <option>landisk</option>
      <option>loongson</option>
      <option>luna88k</option>
      <option>macppc</option>
      <option>mips64</option>
      <option>octeon</option>
      <option>powerpc64</option>
      <option>riscv64</option>
      <option>sparc64</option>
      <option>amiga</option>
      <option>arc</option>
      <option>armish</option>
      <option>arm32</option>
      <option>atari</option>
      <option>aviion</option>
      <option>beagle</option>
      <option>cats</option>
      <option>hppa64</option>
      <option>hp300</option>
      <option>ia64</option>
      <option>mac68k</option>
      <option>mvme68k</option>
      <option>mvme88k</option>
      <option>mvmeppc</option>
      <option>palm</option>
      <option>pc532</option>
      <option>pegasos</option>
      <option>pmax</option>
      <option>powerpc</option>
      <option>sgi</option>
      <option>socppc</option>
      <option>solbourne</option>
      <option>sparc</option>
      <option>sun3</option>
      <option>vax</option>
      <option>wgrisc</option>
      <option>x68k</option>
      <option>zaurus</option>
    </select>
    <select name="manpath" aria-label="Manual path">
      <option selected="selected">OpenBSD-current</option>
      <option>OpenBSD-7.6</option>
      <option>OpenBSD-7.5</option>
      <option>OpenBSD-7.4</option>
      <option>OpenBSD-7.3</option>
      <option>OpenBSD-7.2</option>
      <option>OpenBSD-7.1</option>
      <option>OpenBSD-7.0</option>
      <option>OpenBSD-6.9</option>
      <option>OpenBSD-6.8</option>
      <option>OpenBSD-6.7</option>
      <option>OpenBSD-6.6</option>
      <option>OpenBSD-6.5</option>
      <option>OpenBSD-6.4</option>
      <option>OpenBSD-6.3</option>
      <option>OpenBSD-6.2</option>
      <option>OpenBSD-6.1</option>
      <option>OpenBSD-6.0</option>
      <option>OpenBSD-5.9</option>
      <option>OpenBSD-5.8</option>
      <option>OpenBSD-5.7</option>
      <option>OpenBSD-5.6</option>
      <option>OpenBSD-5.5</option>
      <option>OpenBSD-5.4</option>
      <option>OpenBSD-5.3</option>
      <option>OpenBSD-5.2</option>
      <option>OpenBSD-5.1</option>
      <option>OpenBSD-5.0</option>
      <option>OpenBSD-4.9</option>
      <option>OpenBSD-4.8</option>
      <option>OpenBSD-4.7</option>
      <option>OpenBSD-4.6</option>
      <option>OpenBSD-4.5</option>
      <option>OpenBSD-4.4</option>
      <option>OpenBSD-4.3</option>
      <option>OpenBSD-4.2</option>
      <option>OpenBSD-4.1</option>
      <option>OpenBSD-4.0</option>
      <option>OpenBSD-3.9</option>
      <option>OpenBSD-3.8</option>
      <option>OpenBSD-3.7</option>
      <option>OpenBSD-3.6</option>
      <option>OpenBSD-3.5</option>
      <option>OpenBSD-3.4</option>
      <option>OpenBSD-3.3</option>
      <option>OpenBSD-3.2</option>
      <option>OpenBSD-3.1</option>
      <option>OpenBSD-3.0</option>
      <option>OpenBSD-2.9</option>
      <option>OpenBSD-2.8</option>
      <option>OpenBSD-2.7</option>
      <option>OpenBSD-2.6</option>
      <option>OpenBSD-2.5</option>
      <option>OpenBSD-2.4</option>
      <option>OpenBSD-2.3</option>
      <option>OpenBSD-2.2</option>
    </select>
  </fieldset>
</form>
</header>
<hr>
<div class="head" role="doc-pageheader" aria-label="Manual header
  line"><span class="head-ltitle">PLEDGE(2)</span> <span class="head-vol">System
  Calls Manual</span> <span class="head-rtitle">PLEDGE(2)</span></div>
<main class="manual-text">
<section class="Sh">
<h2 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h2>
<p class="Pp"><code class="Nm">pledge</code> &#x2014;
    <span class="Nd" role="doc-subtitle">restrict system operations</span></p>
</section>
<section class="Sh">
<h2 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h2>
<p class="Pp"><code class="In">#include
    &lt;<a class="In">unistd.h</a>&gt;</code></p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">pledge</code>(<var class="Fa" style="white-space: nowrap;">const
    char *promises</var>, <var class="Fa" style="white-space: nowrap;">const
    char *execpromises</var>);</p>
</section>
<section class="Sh">
<h2 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h2>
<p class="Pp">The
    <a class="permalink" href="#pledge"><code class="Fn" id="pledge">pledge</code></a>()
    system call forces the current process into a restricted-service operating
    mode. A few subsets are available, roughly described as computation, memory
    management, read-write operations on file descriptors, opening of files,
    networking (and notably separate, DNS resolution). In general, these modes
    were selected by studying the operation of many programs using libc and
    other such interfaces, and setting <var class="Fa">promises</var> or
    <var class="Fa">execpromises</var>.</p>
<p class="Pp" id="pledge~2">Use of
    <a class="permalink" href="#pledge~2"><code class="Fn">pledge</code></a>()
    in an application will require at least some study and understanding of the
    interfaces called. Subsequent calls to <code class="Fn">pledge</code>() can
    reduce the abilities further, but abilities can never be regained.</p>
<p class="Pp">A process which attempts a restricted operation is killed with an
    uncatchable <code class="Dv">SIGABRT</code>, delivering a core file if
    possible. A process currently running with pledge has state
    &#x2018;p&#x2019; in <a class="Xr" href="/ps.1" aria-label="ps, section
    1">ps(1)</a> output; a process that was terminated due to a pledge violation
    is accounted by <a class="Xr" href="/lastcomm.1" aria-label="lastcomm,
    section 1">lastcomm(1)</a> with the &#x2018;P&#x2019; flag.</p>
<p class="Pp">A <var class="Fa">promises</var> value of &quot;&quot; restricts
    the process to the <a class="Xr" href="/_exit.2" aria-label="_exit, section
    2">_exit(2)</a> system call. This can be used for pure computation operating
    on memory shared with another process.</p>
<p class="Pp">Passing <code class="Dv">NULL</code> to
    <var class="Fa">promises</var> or <var class="Fa">execpromises</var>
    specifies to not change the current value.</p>
<p class="Pp">Some system calls, when allowed, have restrictions applied to
    them:</p>
<dl class="Bl-ohang Bd-indent">
  <dt><a class="Xr" href="/access.2" aria-label="access, section
    2">access(2)</a>:</dt>
  <dd>May check for existence of <span class="Pa">/etc/localtime</span>.</dd>
  <dt><a class="Xr" href="/adjtime.2" aria-label="adjtime, section
    2">adjtime(2)</a>:</dt>
  <dd>Read-only, for <a class="Xr" href="/ntpd.8" aria-label="ntpd, section
      8">ntpd(8)</a>.</dd>
  <dt><a class="Xr" href="/chmod.2" aria-label="chmod, section 2">chmod(2)</a>,
    <a class="Xr" href="/fchmod.2" aria-label="fchmod, section 2">fchmod(2)</a>,
    <a class="Xr" href="/fchmodat.2" aria-label="fchmodat, section
    2">fchmodat(2)</a>, <a class="Xr" href="/chown.2" aria-label="chown, section
    2">chown(2)</a>, <a class="Xr" href="/lchown.2" aria-label="lchown, section
    2">lchown(2)</a>, <a class="Xr" href="/fchown.2" aria-label="fchown, section
    2">fchown(2)</a>, <a class="Xr" href="/fchownat.2" aria-label="fchownat,
    section 2">fchownat(2)</a>,
    <a class="Xr" href="/mkfifo.2" aria-label="mkfifo, section 2">mkfifo(2)</a>,
    and <a class="Xr" href="/mknod.2" aria-label="mknod, section
    2">mknod(2)</a>:</dt>
  <dd>Setuid/setgid/sticky bits are ignored. The user or group cannot be changed
      on a file.</dd>
  <dt><a class="Xr" href="/ioctl.2" aria-label="ioctl, section
    2">ioctl(2)</a>:</dt>
  <dd>Only the <code class="Dv">FIONREAD</code>,
      <code class="Dv">FIONBIO</code>, <code class="Dv">FIOCLEX</code>, and
      <code class="Dv">FIONCLEX</code> operations are allowed by default.
      Various ioctl requests are allowed against specific file descriptors based
      upon the requests <code class="Cm">audio</code>,
      <code class="Cm">bpf</code>, <code class="Cm">disklabel</code>,
      <code class="Cm">drm</code>, <code class="Cm">inet</code>,
      <code class="Cm">pf</code>, <code class="Cm">route</code>,
      <code class="Cm">wroute</code>, <code class="Cm">tape</code>,
      <code class="Cm">tty</code>, <code class="Cm">video</code>, and
      <code class="Cm">vmm</code>.</dd>
  <dt id="PROT_EXEC"><a class="Xr" href="/mmap.2" aria-label="mmap, section
    2">mmap(2)</a> and <a class="Xr" href="/mprotect.2" aria-label="mprotect,
    section 2">mprotect(2)</a>:</dt>
  <dd><a class="permalink" href="#PROT_EXEC"><code class="Dv">PROT_EXEC</code></a>
      isn't allowed.</dd>
  <dt><a class="Xr" href="/open.2" aria-label="open, section
    2">open(2)</a>:</dt>
  <dd>May open <span class="Pa">/etc/localtime</span> and any files below
      <span class="Pa">/usr/share/zoneinfo</span>.</dd>
  <dt><a class="Xr" href="/profil.2" aria-label="profil, section
    2">profil(2)</a>:</dt>
  <dd>Can only disable profiling.</dd>
  <dt id="pledge~3"><a class="permalink" href="#pledge~3"><code class="Fn">pledge</code></a>():</dt>
  <dd>Can only reduce permissions for <var class="Fa">promises</var> and
      <var class="Fa">execpromises</var>.</dd>
  <dt><a class="Xr" href="/sysctl.2" aria-label="sysctl, section
    2">sysctl(2)</a>:</dt>
  <dd>A small set of read-only operations are allowed, sufficient to support:
      <a class="Xr" href="/getdomainname.3" aria-label="getdomainname, section
      3">getdomainname(3)</a>,
      <a class="Xr" href="/gethostname.3" aria-label="gethostname, section
      3">gethostname(3)</a>,
      <a class="Xr" href="/getifaddrs.3" aria-label="getifaddrs, section
      3">getifaddrs(3)</a>, <a class="Xr" href="/uname.3" aria-label="uname,
      section 3">uname(3)</a>, and system sensor readings.</dd>
</dl>
<p class="Pp">The <var class="Fa">promises</var> argument is specified as a
    string, with space separated keywords:</p>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt id="stdio"><a class="permalink" href="#stdio"><code class="Cm">stdio</code></a></dt>
  <dd>The following system calls are permitted.
      <a class="Xr" href="/sendto.2" aria-label="sendto, section
      2">sendto(2)</a> is only permitted if its destination socket address is
      <code class="Dv">NULL</code>. As a result, all the expected
      functionalities of libc stdio work.
    <p class="Pp"><a class="Xr" href="/clock_getres.2" aria-label="clock_getres,
        section 2">clock_getres(2)</a>,
        <a class="Xr" href="/clock_gettime.2" aria-label="clock_gettime, section
        2">clock_gettime(2)</a>,
        <a class="Xr" href="/close.2" aria-label="close, section
        2">close(2)</a>,
        <a class="Xr" href="/closefrom.2" aria-label="closefrom, section
        2">closefrom(2)</a>, <a class="Xr" href="/dup.2" aria-label="dup,
        section 2">dup(2)</a>, <a class="Xr" href="/dup2.2" aria-label="dup2,
        section 2">dup2(2)</a>, <a class="Xr" href="/dup3.2" aria-label="dup3,
        section 2">dup3(2)</a>,
        <a class="Xr" href="/fchdir.2" aria-label="fchdir, section
        2">fchdir(2)</a>, <a class="Xr" href="/fcntl.2" aria-label="fcntl,
        section 2">fcntl(2)</a>,
        <a class="Xr" href="/fstat.2" aria-label="fstat, section
        2">fstat(2)</a>, <a class="Xr" href="/fsync.2" aria-label="fsync,
        section 2">fsync(2)</a>,
        <a class="Xr" href="/ftruncate.2" aria-label="ftruncate, section
        2">ftruncate(2)</a>,
        <a class="Xr" href="/getdtablecount.2" aria-label="getdtablecount,
        section 2">getdtablecount(2)</a>,
        <a class="Xr" href="/getegid.2" aria-label="getegid, section
        2">getegid(2)</a>,
        <a class="Xr" href="/getentropy.2" aria-label="getentropy, section
        2">getentropy(2)</a>,
        <a class="Xr" href="/geteuid.2" aria-label="geteuid, section
        2">geteuid(2)</a>, <a class="Xr" href="/getgid.2" aria-label="getgid,
        section 2">getgid(2)</a>,
        <a class="Xr" href="/getgroups.2" aria-label="getgroups, section
        2">getgroups(2)</a>,
        <a class="Xr" href="/getitimer.2" aria-label="getitimer, section
        2">getitimer(2)</a>,
        <a class="Xr" href="/getlogin.2" aria-label="getlogin, section
        2">getlogin(2)</a>, <a class="Xr" href="/getpgid.2" aria-label="getpgid,
        section 2">getpgid(2)</a>,
        <a class="Xr" href="/getpgrp.2" aria-label="getpgrp, section
        2">getpgrp(2)</a>, <a class="Xr" href="/getpid.2" aria-label="getpid,
        section 2">getpid(2)</a>,
        <a class="Xr" href="/getppid.2" aria-label="getppid, section
        2">getppid(2)</a>,
        <a class="Xr" href="/getresgid.2" aria-label="getresgid, section
        2">getresgid(2)</a>,
        <a class="Xr" href="/getresuid.2" aria-label="getresuid, section
        2">getresuid(2)</a>,
        <a class="Xr" href="/getrlimit.2" aria-label="getrlimit, section
        2">getrlimit(2)</a>,
        <a class="Xr" href="/getrtable.2" aria-label="getrtable, section
        2">getrtable(2)</a>, <a class="Xr" href="/getsid.2" aria-label="getsid,
        section 2">getsid(2)</a>,
        <a class="Xr" href="/getthrid.2" aria-label="getthrid, section
        2">getthrid(2)</a>,
        <a class="Xr" href="/gettimeofday.2" aria-label="gettimeofday, section
        2">gettimeofday(2)</a>,
        <a class="Xr" href="/getuid.2" aria-label="getuid, section
        2">getuid(2)</a>,
        <a class="Xr" href="/issetugid.2" aria-label="issetugid, section
        2">issetugid(2)</a>, <a class="Xr" href="/kevent.2" aria-label="kevent,
        section 2">kevent(2)</a>,
        <a class="Xr" href="/kqueue.2" aria-label="kqueue, section
        2">kqueue(2)</a>, <a class="Xr" href="/kqueue1.2" aria-label="kqueue1,
        section 2">kqueue1(2)</a>,
        <a class="Xr" href="/lseek.2" aria-label="lseek, section
        2">lseek(2)</a>, <a class="Xr" href="/madvise.2" aria-label="madvise,
        section 2">madvise(2)</a>,
        <a class="Xr" href="/minherit.2" aria-label="minherit, section
        2">minherit(2)</a>, <a class="Xr" href="/mmap.2" aria-label="mmap,
        section 2">mmap(2)</a>,
        <a class="Xr" href="/mprotect.2" aria-label="mprotect, section
        2">mprotect(2)</a>, <a class="Xr" href="/mquery.2" aria-label="mquery,
        section 2">mquery(2)</a>,
        <a class="Xr" href="/munmap.2" aria-label="munmap, section
        2">munmap(2)</a>,
        <a class="Xr" href="/nanosleep.2" aria-label="nanosleep, section
        2">nanosleep(2)</a>, <a class="Xr" href="/pipe.2" aria-label="pipe,
        section 2">pipe(2)</a>, <a class="Xr" href="/pipe2.2" aria-label="pipe2,
        section 2">pipe2(2)</a>, <a class="Xr" href="/poll.2" aria-label="poll,
        section 2">poll(2)</a>, <a class="Xr" href="/pread.2" aria-label="pread,
        section 2">pread(2)</a>,
        <a class="Xr" href="/preadv.2" aria-label="preadv, section
        2">preadv(2)</a>, <a class="Xr" href="/profil.2" aria-label="profil,
        section 2">profil(2)</a>,
        <a class="Xr" href="/pwrite.2" aria-label="pwrite, section
        2">pwrite(2)</a>, <a class="Xr" href="/pwritev.2" aria-label="pwritev,
        section 2">pwritev(2)</a>,
        <a class="Xr" href="/read.2" aria-label="read, section 2">read(2)</a>,
        <a class="Xr" href="/readv.2" aria-label="readv, section
        2">readv(2)</a>, <a class="Xr" href="/recvfrom.2" aria-label="recvfrom,
        section 2">recvfrom(2)</a>,
        <a class="Xr" href="/recvmsg.2" aria-label="recvmsg, section
        2">recvmsg(2)</a>, <a class="Xr" href="/select.2" aria-label="select,
        section 2">select(2)</a>,
        <a class="Xr" href="/sendmsg.2" aria-label="sendmsg, section
        2">sendmsg(2)</a>,
        <a class="Xr" href="/sendsyslog.2" aria-label="sendsyslog, section
        2">sendsyslog(2)</a>, <a class="Xr" href="/sendto.2" aria-label="sendto,
        section 2">sendto(2)</a>,
        <a class="Xr" href="/setitimer.2" aria-label="setitimer, section
        2">setitimer(2)</a>,
        <a class="Xr" href="/shutdown.2" aria-label="shutdown, section
        2">shutdown(2)</a>,
        <a class="Xr" href="/sigaction.2" aria-label="sigaction, section
        2">sigaction(2)</a>,
        <a class="Xr" href="/sigprocmask.2" aria-label="sigprocmask, section
        2">sigprocmask(2)</a>,
        <a class="Xr" href="/sigreturn.2" aria-label="sigreturn, section
        2">sigreturn(2)</a>,
        <a class="Xr" href="/socketpair.2" aria-label="socketpair, section
        2">socketpair(2)</a>, <a class="Xr" href="/umask.2" aria-label="umask,
        section 2">umask(2)</a>,
        <a class="Xr" href="/wait4.2" aria-label="wait4, section
        2">wait4(2)</a>, <a class="Xr" href="/waitid.2" aria-label="waitid,
        section 2">waitid(2)</a>,
        <a class="Xr" href="/write.2" aria-label="write, section
        2">write(2)</a>, <a class="Xr" href="/writev.2" aria-label="writev,
        section 2">writev(2)</a></p>
  </dd>
  <dt id="rpath"><a class="permalink" href="#rpath"><code class="Cm">rpath</code></a></dt>
  <dd>A number of system calls are allowed if they only cause read-only effects
      on the filesystem, or expose filenames to programs:
    <p class="Pp"><a class="Xr" href="/chdir.2" aria-label="chdir, section
        2">chdir(2)</a>, <a class="Xr" href="/getcwd.3" aria-label="getcwd,
        section 3">getcwd(3)</a>,
        <a class="Xr" href="/getdents.2" aria-label="getdents, section
        2">getdents(2)</a>, <a class="Xr" href="/openat.2" aria-label="openat,
        section 2">openat(2)</a>,
        <a class="Xr" href="/fstatat.2" aria-label="fstatat, section
        2">fstatat(2)</a>,
        <a class="Xr" href="/faccessat.2" aria-label="faccessat, section
        2">faccessat(2)</a>,
        <a class="Xr" href="/readlinkat.2" aria-label="readlinkat, section
        2">readlinkat(2)</a>, <a class="Xr" href="/lstat.2" aria-label="lstat,
        section 2">lstat(2)</a>,
        <a class="Xr" href="/chmod.2" aria-label="chmod, section
        2">chmod(2)</a>, <a class="Xr" href="/fchmod.2" aria-label="fchmod,
        section 2">fchmod(2)</a>,
        <a class="Xr" href="/fchmodat.2" aria-label="fchmodat, section
        2">fchmodat(2)</a>, <a class="Xr" href="/chflags.2" aria-label="chflags,
        section 2">chflags(2)</a>,
        <a class="Xr" href="/chflagsat.2" aria-label="chflagsat, section
        2">chflagsat(2)</a>, <a class="Xr" href="/chown.2" aria-label="chown,
        section 2">chown(2)</a>,
        <a class="Xr" href="/fchown.2" aria-label="fchown, section
        2">fchown(2)</a>, <a class="Xr" href="/fchownat.2" aria-label="fchownat,
        section 2">fchownat(2)</a>,
        <a class="Xr" href="/fstat.2" aria-label="fstat, section
        2">fstat(2)</a>,
        <a class="Xr" href="/getfsstat.2" aria-label="getfsstat, section
        2">getfsstat(2)</a></p>
  </dd>
  <dt id="wpath"><a class="permalink" href="#wpath"><code class="Cm">wpath</code></a></dt>
  <dd>A number of system calls are allowed and may cause write-effects on the
      filesystem:
    <p class="Pp"><a class="Xr" href="/getcwd.3" aria-label="getcwd, section
        3">getcwd(3)</a>, <a class="Xr" href="/openat.2" aria-label="openat,
        section 2">openat(2)</a>,
        <a class="Xr" href="/fstatat.2" aria-label="fstatat, section
        2">fstatat(2)</a>,
        <a class="Xr" href="/faccessat.2" aria-label="faccessat, section
        2">faccessat(2)</a>,
        <a class="Xr" href="/readlinkat.2" aria-label="readlinkat, section
        2">readlinkat(2)</a>, <a class="Xr" href="/lstat.2" aria-label="lstat,
        section 2">lstat(2)</a>,
        <a class="Xr" href="/chmod.2" aria-label="chmod, section
        2">chmod(2)</a>, <a class="Xr" href="/fchmod.2" aria-label="fchmod,
        section 2">fchmod(2)</a>,
        <a class="Xr" href="/fchmodat.2" aria-label="fchmodat, section
        2">fchmodat(2)</a>, <a class="Xr" href="/chflags.2" aria-label="chflags,
        section 2">chflags(2)</a>,
        <a class="Xr" href="/chflagsat.2" aria-label="chflagsat, section
        2">chflagsat(2)</a>, <a class="Xr" href="/chown.2" aria-label="chown,
        section 2">chown(2)</a>,
        <a class="Xr" href="/fchown.2" aria-label="fchown, section
        2">fchown(2)</a>, <a class="Xr" href="/fchownat.2" aria-label="fchownat,
        section 2">fchownat(2)</a>,
        <a class="Xr" href="/fstat.2" aria-label="fstat, section
      2">fstat(2)</a></p>
  </dd>
  <dt id="cpath"><a class="permalink" href="#cpath"><code class="Cm">cpath</code></a></dt>
  <dd>A number of system calls and sub-modes are allowed, which may create new
      files or directories in the filesystem:
    <p class="Pp"><a class="Xr" href="/rename.2" aria-label="rename, section
        2">rename(2)</a>, <a class="Xr" href="/renameat.2" aria-label="renameat,
        section 2">renameat(2)</a>,
        <a class="Xr" href="/link.2" aria-label="link, section 2">link(2)</a>,
        <a class="Xr" href="/linkat.2" aria-label="linkat, section
        2">linkat(2)</a>, <a class="Xr" href="/symlink.2" aria-label="symlink,
        section 2">symlink(2)</a>,
        <a class="Xr" href="/symlinkat.2" aria-label="symlinkat, section
        2">symlinkat(2)</a>, <a class="Xr" href="/unlink.2" aria-label="unlink,
        section 2">unlink(2)</a>,
        <a class="Xr" href="/unlinkat.2" aria-label="unlinkat, section
        2">unlinkat(2)</a>, <a class="Xr" href="/mkdir.2" aria-label="mkdir,
        section 2">mkdir(2)</a>,
        <a class="Xr" href="/mkdirat.2" aria-label="mkdirat, section
        2">mkdirat(2)</a>, <a class="Xr" href="/rmdir.2" aria-label="rmdir,
        section 2">rmdir(2)</a></p>
  </dd>
  <dt id="dpath"><a class="permalink" href="#dpath"><code class="Cm">dpath</code></a></dt>
  <dd>A number of system calls are allowed to create special files:
    <p class="Pp"><a class="Xr" href="/mkfifo.2" aria-label="mkfifo, section
        2">mkfifo(2)</a>, <a class="Xr" href="/mknod.2" aria-label="mknod,
        section 2">mknod(2)</a></p>
  </dd>
  <dt id="tmppath"><a class="permalink" href="#tmppath"><code class="Cm">tmppath</code></a></dt>
  <dd>A number of system calls are allowed to do operations in the
      <span class="Pa">/tmp</span> directory, including create, read, or write:
    <p class="Pp"><a class="Xr" href="/lstat.2" aria-label="lstat, section
        2">lstat(2)</a>, <a class="Xr" href="/chmod.2" aria-label="chmod,
        section 2">chmod(2)</a>,
        <a class="Xr" href="/chflags.2" aria-label="chflags, section
        2">chflags(2)</a>, <a class="Xr" href="/chown.2" aria-label="chown,
        section 2">chown(2)</a>,
        <a class="Xr" href="/unlink.2" aria-label="unlink, section
        2">unlink(2)</a>, <a class="Xr" href="/fstat.2" aria-label="fstat,
        section 2">fstat(2)</a></p>
  </dd>
  <dt id="inet"><a class="permalink" href="#inet"><code class="Cm">inet</code></a></dt>
  <dd>The following system calls are allowed to operate in the
      <code class="Dv">AF_INET</code> and <code class="Dv">AF_INET6</code>
      domains (though <a class="Xr" href="/setsockopt.2" aria-label="setsockopt,
      section 2">setsockopt(2)</a> has been substantially reduced in
      functionality):
    <p class="Pp"><a class="Xr" href="/socket.2" aria-label="socket, section
        2">socket(2)</a>, <a class="Xr" href="/listen.2" aria-label="listen,
        section 2">listen(2)</a>, <a class="Xr" href="/bind.2" aria-label="bind,
        section 2">bind(2)</a>,
        <a class="Xr" href="/connect.2" aria-label="connect, section
        2">connect(2)</a>, <a class="Xr" href="/accept4.2" aria-label="accept4,
        section 2">accept4(2)</a>,
        <a class="Xr" href="/accept.2" aria-label="accept, section
        2">accept(2)</a>,
        <a class="Xr" href="/getpeername.2" aria-label="getpeername, section
        2">getpeername(2)</a>,
        <a class="Xr" href="/getsockname.2" aria-label="getsockname, section
        2">getsockname(2)</a>,
        <a class="Xr" href="/setsockopt.2" aria-label="setsockopt, section
        2">setsockopt(2)</a>,
        <a class="Xr" href="/getsockopt.2" aria-label="getsockopt, section
        2">getsockopt(2)</a></p>
  </dd>
  <dt id="mcast"><a class="permalink" href="#mcast"><code class="Cm">mcast</code></a></dt>
  <dd>In combination with <code class="Cm">inet</code> give back functionality
      to <a class="Xr" href="/setsockopt.2" aria-label="setsockopt, section
      2">setsockopt(2)</a> for operating on multicast sockets.</dd>
  <dt id="fattr"><a class="permalink" href="#fattr"><code class="Cm">fattr</code></a></dt>
  <dd>The following system calls are allowed to make explicit changes to fields
      in <var class="Vt">struct stat</var> relating to a file:
    <p class="Pp"><a class="Xr" href="/utimes.2" aria-label="utimes, section
        2">utimes(2)</a>, <a class="Xr" href="/futimes.2" aria-label="futimes,
        section 2">futimes(2)</a>,
        <a class="Xr" href="/utimensat.2" aria-label="utimensat, section
        2">utimensat(2)</a>,
        <a class="Xr" href="/futimens.2" aria-label="futimens, section
        2">futimens(2)</a>, <a class="Xr" href="/chmod.2" aria-label="chmod,
        section 2">chmod(2)</a>,
        <a class="Xr" href="/fchmod.2" aria-label="fchmod, section
        2">fchmod(2)</a>, <a class="Xr" href="/fchmodat.2" aria-label="fchmodat,
        section 2">fchmodat(2)</a>,
        <a class="Xr" href="/chflags.2" aria-label="chflags, section
        2">chflags(2)</a>,
        <a class="Xr" href="/chflagsat.2" aria-label="chflagsat, section
        2">chflagsat(2)</a>, <a class="Xr" href="/chown.2" aria-label="chown,
        section 2">chown(2)</a>,
        <a class="Xr" href="/fchownat.2" aria-label="fchownat, section
        2">fchownat(2)</a>, <a class="Xr" href="/lchown.2" aria-label="lchown,
        section 2">lchown(2)</a>,
        <a class="Xr" href="/fchown.2" aria-label="fchown, section
        2">fchown(2)</a>, <a class="Xr" href="/utimes.2" aria-label="utimes,
        section 2">utimes(2)</a></p>
  </dd>
  <dt id="chown"><a class="permalink" href="#chown"><code class="Cm">chown</code></a></dt>
  <dd>The <a class="Xr" href="/chown.2" aria-label="chown, section
      2">chown(2)</a> family is allowed to change the user or group on a
    file.</dd>
  <dt id="flock"><a class="permalink" href="#flock"><code class="Cm">flock</code></a></dt>
  <dd>File locking via <a class="Xr" href="/fcntl.2" aria-label="fcntl, section
      2">fcntl(2)</a>, <a class="Xr" href="/flock.2" aria-label="flock, section
      2">flock(2)</a>, <a class="Xr" href="/lockf.3" aria-label="lockf, section
      3">lockf(3)</a>, and <a class="Xr" href="/open.2" aria-label="open,
      section 2">open(2)</a> is allowed. No distinction is made between shared
      and exclusive locks. This promise is required for unlock as well as
    lock.</dd>
  <dt id="unix"><a class="permalink" href="#unix"><code class="Cm">unix</code></a></dt>
  <dd>The following system calls are allowed to operate in the
      <code class="Dv">AF_UNIX</code> domain:
    <p class="Pp"><a class="Xr" href="/socket.2" aria-label="socket, section
        2">socket(2)</a>, <a class="Xr" href="/listen.2" aria-label="listen,
        section 2">listen(2)</a>, <a class="Xr" href="/bind.2" aria-label="bind,
        section 2">bind(2)</a>,
        <a class="Xr" href="/connect.2" aria-label="connect, section
        2">connect(2)</a>, <a class="Xr" href="/accept4.2" aria-label="accept4,
        section 2">accept4(2)</a>,
        <a class="Xr" href="/accept.2" aria-label="accept, section
        2">accept(2)</a>,
        <a class="Xr" href="/getpeername.2" aria-label="getpeername, section
        2">getpeername(2)</a>,
        <a class="Xr" href="/getsockname.2" aria-label="getsockname, section
        2">getsockname(2)</a>,
        <a class="Xr" href="/setsockopt.2" aria-label="setsockopt, section
        2">setsockopt(2)</a>,
        <a class="Xr" href="/getsockopt.2" aria-label="getsockopt, section
        2">getsockopt(2)</a></p>
  </dd>
  <dt id="dns"><a class="permalink" href="#dns"><code class="Cm">dns</code></a></dt>
  <dd>Subsequent to a successful <a class="Xr" href="/open.2" aria-label="open,
      section 2">open(2)</a> of <span class="Pa">/etc/resolv.conf</span>, a few
      system calls become able to allow DNS network transactions:
    <p class="Pp"><a class="Xr" href="/sendto.2" aria-label="sendto, section
        2">sendto(2)</a>, <a class="Xr" href="/recvfrom.2" aria-label="recvfrom,
        section 2">recvfrom(2)</a>,
        <a class="Xr" href="/socket.2" aria-label="socket, section
        2">socket(2)</a>, <a class="Xr" href="/connect.2" aria-label="connect,
        section 2">connect(2)</a></p>
  </dd>
  <dt id="getpw"><a class="permalink" href="#getpw"><code class="Cm">getpw</code></a></dt>
  <dd>This allows read-only opening of files in <span class="Pa">/etc</span> for
      the <a class="Xr" href="/getpwnam.3" aria-label="getpwnam, section
      3">getpwnam(3)</a>, <a class="Xr" href="/getgrnam.3" aria-label="getgrnam,
      section 3">getgrnam(3)</a>,
      <a class="Xr" href="/getgrouplist.3" aria-label="getgrouplist, section
      3">getgrouplist(3)</a>, and
      <a class="Xr" href="/initgroups.3" aria-label="initgroups, section
      3">initgroups(3)</a> family of functions, including lookups via the
      <a class="Xr" href="/yp.8" aria-label="yp, section 8">yp(8)</a> protocol
      for YP and LDAP databases.</dd>
  <dt id="sendfd"><a class="permalink" href="#sendfd"><code class="Cm">sendfd</code></a></dt>
  <dd>Allows sending of file descriptors using
      <a class="Xr" href="/sendmsg.2" aria-label="sendmsg, section
      2">sendmsg(2)</a>. File descriptors referring to directories may not be
      passed.</dd>
  <dt id="recvfd"><a class="permalink" href="#recvfd"><code class="Cm">recvfd</code></a></dt>
  <dd>Allows receiving of file descriptors using
      <a class="Xr" href="/recvmsg.2" aria-label="recvmsg, section
      2">recvmsg(2)</a>. File descriptors referring to directories may not be
      passed.</dd>
  <dt id="tape"><a class="permalink" href="#tape"><code class="Cm">tape</code></a></dt>
  <dd>Allow <code class="Dv">MTIOCGET</code> and
      <code class="Dv">MTIOCTOP</code> operations against tape drives.</dd>
  <dt id="tty"><a class="permalink" href="#tty"><code class="Cm">tty</code></a></dt>
  <dd>In addition to allowing read-write operations on
      <span class="Pa">/dev/tty</span>, this opens up a variety of
      <a class="Xr" href="/ioctl.2" aria-label="ioctl, section 2">ioctl(2)</a>
      requests used by tty devices. If <code class="Cm">tty</code> is
      accompanied with <code class="Cm">rpath</code>,
      <a class="Xr" href="/revoke.2" aria-label="revoke, section
      2">revoke(2)</a> is permitted. Otherwise only the following
      <a class="Xr" href="/ioctl.2" aria-label="ioctl, section 2">ioctl(2)</a>
      requests are permitted:
    <p class="Pp"><code class="Dv">TIOCSPGRP</code>,
        <code class="Dv">TIOCGETA</code>, <code class="Dv">TIOCGPGRP</code>,
        <code class="Dv">TIOCGWINSZ</code>, <code class="Dv">TIOCSWINSZ</code>,
        <code class="Dv">TIOCSBRK</code>, <code class="Dv">TIOCCDTR</code>,
        <code class="Dv">TIOCSETA</code>, <code class="Dv">TIOCSETAW</code>,
        <code class="Dv">TIOCSETAF</code>, <code class="Dv">TIOCUCNTL</code></p>
  </dd>
  <dt id="proc"><a class="permalink" href="#proc"><code class="Cm">proc</code></a></dt>
  <dd>Allows the following process relationship operations:
    <p class="Pp"><a class="Xr" href="/fork.2" aria-label="fork, section
        2">fork(2)</a>, <a class="Xr" href="/vfork.2" aria-label="vfork, section
        2">vfork(2)</a>, <a class="Xr" href="/kill.2" aria-label="kill, section
        2">kill(2)</a>,
        <a class="Xr" href="/getpriority.2" aria-label="getpriority, section
        2">getpriority(2)</a>,
        <a class="Xr" href="/setpriority.2" aria-label="setpriority, section
        2">setpriority(2)</a>,
        <a class="Xr" href="/setrlimit.2" aria-label="setrlimit, section
        2">setrlimit(2)</a>,
        <a class="Xr" href="/setpgid.2" aria-label="setpgid, section
        2">setpgid(2)</a>, <a class="Xr" href="/setsid.2" aria-label="setsid,
        section 2">setsid(2)</a></p>
  </dd>
  <dt id="exec"><a class="permalink" href="#exec"><code class="Cm">exec</code></a></dt>
  <dd>Allows a process to call
      <a class="Xr" href="/execve.2" aria-label="execve, section
      2">execve(2)</a>. Coupled with the <code class="Cm">proc</code> promise,
      this allows a process to fork and execute another program. If
      <var class="Fa">execpromises</var> has been previously set the new program
      begins with those promises, unless setuid/setgid bits are set in which
      case execution is blocked with <code class="Er">EACCES</code>. Otherwise
      the new program starts running without pledge active, and hopefully makes
      a new pledge soon.</dd>
  <dt id="prot_exec"><a class="permalink" href="#prot_exec"><code class="Cm">prot_exec</code></a></dt>
  <dd>Allows the use of <code class="Dv">PROT_EXEC</code> with
      <a class="Xr" href="/mmap.2" aria-label="mmap, section 2">mmap(2)</a> and
      <a class="Xr" href="/mprotect.2" aria-label="mprotect, section
      2">mprotect(2)</a>.</dd>
  <dt id="settime"><a class="permalink" href="#settime"><code class="Cm">settime</code></a></dt>
  <dd>Allows the setting of system time, via the
      <a class="Xr" href="/settimeofday.2" aria-label="settimeofday, section
      2">settimeofday(2)</a>,
      <a class="Xr" href="/adjtime.2" aria-label="adjtime, section
      2">adjtime(2)</a>, and
      <a class="Xr" href="/adjfreq.2" aria-label="adjfreq, section
      2">adjfreq(2)</a> system calls.</dd>
  <dt id="ps"><a class="permalink" href="#ps"><code class="Cm">ps</code></a></dt>
  <dd>Allows enough <a class="Xr" href="/sysctl.2" aria-label="sysctl, section
      2">sysctl(2)</a> interfaces to allow inspection of processes operating on
      the system using programs like <a class="Xr" href="/ps.1" aria-label="ps,
      section 1">ps(1)</a>.</dd>
  <dt id="vminfo"><a class="permalink" href="#vminfo"><code class="Cm">vminfo</code></a></dt>
  <dd>Allows enough <a class="Xr" href="/sysctl.2" aria-label="sysctl, section
      2">sysctl(2)</a> interfaces to allow inspection of the system's virtual
      memory by programs like <a class="Xr" href="/top.1" aria-label="top,
      section 1">top(1)</a> and
      <a class="Xr" href="/vmstat.8" aria-label="vmstat, section
      8">vmstat(8)</a>.</dd>
  <dt id="id"><a class="permalink" href="#id"><code class="Cm">id</code></a></dt>
  <dd>Allows the following system calls which can change the rights of a
      process:
    <p class="Pp"><a class="Xr" href="/setuid.2" aria-label="setuid, section
        2">setuid(2)</a>, <a class="Xr" href="/seteuid.2" aria-label="seteuid,
        section 2">seteuid(2)</a>,
        <a class="Xr" href="/setreuid.2" aria-label="setreuid, section
        2">setreuid(2)</a>,
        <a class="Xr" href="/setresuid.2" aria-label="setresuid, section
        2">setresuid(2)</a>, <a class="Xr" href="/setgid.2" aria-label="setgid,
        section 2">setgid(2)</a>,
        <a class="Xr" href="/setegid.2" aria-label="setegid, section
        2">setegid(2)</a>,
        <a class="Xr" href="/setregid.2" aria-label="setregid, section
        2">setregid(2)</a>,
        <a class="Xr" href="/setresgid.2" aria-label="setresgid, section
        2">setresgid(2)</a>,
        <a class="Xr" href="/setgroups.2" aria-label="setgroups, section
        2">setgroups(2)</a>,
        <a class="Xr" href="/setlogin.2" aria-label="setlogin, section
        2">setlogin(2)</a>,
        <a class="Xr" href="/setrlimit.2" aria-label="setrlimit, section
        2">setrlimit(2)</a>,
        <a class="Xr" href="/getpriority.2" aria-label="getpriority, section
        2">getpriority(2)</a>,
        <a class="Xr" href="/setpriority.2" aria-label="setpriority, section
        2">setpriority(2)</a>,
        <a class="Xr" href="/setrtable.2" aria-label="setrtable, section
        2">setrtable(2)</a></p>
  </dd>
  <dt id="pf"><a class="permalink" href="#pf"><code class="Cm">pf</code></a></dt>
  <dd>Allows a subset of <a class="Xr" href="/ioctl.2" aria-label="ioctl,
      section 2">ioctl(2)</a> operations on the
      <a class="Xr" href="/pf.4" aria-label="pf, section 4">pf(4)</a> device:
    <p class="Pp"><code class="Dv">DIOCADDRULE</code>,
        <code class="Dv">DIOCGETSTATUS</code>,
        <code class="Dv">DIOCNATLOOK</code>,
        <code class="Dv">DIOCRADDTABLES</code>,
        <code class="Dv">DIOCRCLRADDRS</code>,
        <code class="Dv">DIOCRCLRTABLES</code>,
        <code class="Dv">DIOCRCLRTSTATS</code>,
        <code class="Dv">DIOCRGETTSTATS</code>,
        <code class="Dv">DIOCRSETADDRS</code>,
        <code class="Dv">DIOCXBEGIN</code>,
      <code class="Dv">DIOCXCOMMIT</code></p>
  </dd>
  <dt id="route"><a class="permalink" href="#route"><code class="Cm">route</code></a></dt>
  <dd>Allow inspection of the routing table.</dd>
  <dt id="wroute"><a class="permalink" href="#wroute"><code class="Cm">wroute</code></a></dt>
  <dd>Allow changes to the routing table.</dd>
  <dt id="audio"><a class="permalink" href="#audio"><code class="Cm">audio</code></a></dt>
  <dd>Allows a subset of <a class="Xr" href="/ioctl.2" aria-label="ioctl,
      section 2">ioctl(2)</a> operations on
      <a class="Xr" href="/audio.4" aria-label="audio, section 4">audio(4)</a>
      devices (see <a class="Xr" href="/sio_open.3" aria-label="sio_open,
      section 3">sio_open(3)</a> for more information):
    <p class="Pp"><code class="Dv">AUDIO_GETPOS</code>,
        <code class="Dv">AUDIO_GETPAR</code>,
        <code class="Dv">AUDIO_SETPAR</code>,
        <code class="Dv">AUDIO_START</code>, <code class="Dv">AUDIO_STOP</code>,
        <code class="Dv">AUDIO_MIXER_DEVINFO</code>,
        <code class="Dv">AUDIO_MIXER_READ</code>,
        <code class="Dv">AUDIO_MIXER_WRITE</code></p>
  </dd>
  <dt id="video"><a class="permalink" href="#video"><code class="Cm">video</code></a></dt>
  <dd>Allows a subset of <a class="Xr" href="/ioctl.2" aria-label="ioctl,
      section 2">ioctl(2)</a> operations on
      <a class="Xr" href="/video.4" aria-label="video, section 4">video(4)</a>
      devices:
    <p class="Pp"><code class="Dv">VIDIOC_DQBUF</code>,
        <code class="Dv">VIDIOC_ENUM_FMT</code>,
        <code class="Dv">VIDIOC_ENUM_FRAMEINTERVALS</code>,
        <code class="Dv">VIDIOC_ENUM_FRAMESIZES</code>,
        <code class="Dv">VIDIOC_G_CTRL</code>,
        <code class="Dv">VIDIOC_G_PARM</code>,
        <code class="Dv">VIDIOC_QBUF</code>,
        <code class="Dv">VIDIOC_QUERYBUF</code>,
        <code class="Dv">VIDIOC_QUERYCAP</code>,
        <code class="Dv">VIDIOC_QUERYCTRL</code>,
        <code class="Dv">VIDIOC_S_CTRL</code>,
        <code class="Dv">VIDIOC_S_FMT</code>,
        <code class="Dv">VIDIOC_S_PARM</code>,
        <code class="Dv">VIDIOC_STREAMOFF</code>,
        <code class="Dv">VIDIOC_STREAMON</code>,
        <code class="Dv">VIDIOC_TRY_FMT</code>,
        <code class="Dv">VIDIOC_REQBUFS</code></p>
  </dd>
  <dt id="bpf"><a class="permalink" href="#bpf"><code class="Cm">bpf</code></a></dt>
  <dd>Allow <code class="Dv">BIOCGSTATS</code> operation for statistics
      collection from a <a class="Xr" href="/bpf.4" aria-label="bpf, section
      4">bpf(4)</a> device.</dd>
  <dt id="unveil"><a class="permalink" href="#unveil"><code class="Cm">unveil</code></a></dt>
  <dd>Allow <a class="Xr" href="/unveil.2" aria-label="unveil, section
      2">unveil(2)</a> to be called.</dd>
  <dt id="error"><a class="permalink" href="#error"><code class="Cm">error</code></a></dt>
  <dd>Rather than killing the process upon violation, indicate error with
      <code class="Er">ENOSYS</code>.
    <p class="Pp" id="pledge~4">Also when
        <a class="permalink" href="#pledge~4"><code class="Fn">pledge</code></a>()
        is called with higher <var class="Fa">promises</var> or
        <var class="Fa">execpromises</var>, those changes will be ignored and
        return success. This is useful when a parent enforces
        <var class="Fa">execpromises</var> but an execve'd child has a different
        idea.</p>
  </dd>
</dl>
</div>
</section>
<section class="Sh">
<h2 class="Sh" id="RETURN_VALUES"><a class="permalink" href="#RETURN_VALUES">RETURN
  VALUES</a></h2>
<p class="Pp">Upon successful completion, the value&#x00A0;0 is returned;
    otherwise the value&#x00A0;-1 is returned and the global variable
    <var class="Va">errno</var> is set to indicate the error.</p>
</section>
<section class="Sh">
<h2 class="Sh" id="ERRORS"><a class="permalink" href="#ERRORS">ERRORS</a></h2>
<p class="Pp"><code class="Fn">pledge</code>() will fail if:</p>
<dl class="Bl-tag">
  <dt id="EFAULT">[<a class="permalink" href="#EFAULT"><code class="Er">EFAULT</code></a>]</dt>
  <dd><var class="Fa">promises</var> or <var class="Fa">execpromises</var>
      points outside the process's allocated address space.</dd>
  <dt id="EINVAL">[<a class="permalink" href="#EINVAL"><code class="Er">EINVAL</code></a>]</dt>
  <dd><var class="Fa">promises</var> is malformed or contains invalid
    keywords.</dd>
  <dt id="EPERM">[<a class="permalink" href="#EPERM"><code class="Er">EPERM</code></a>]</dt>
  <dd>This process is attempting to increase permissions.</dd>
</dl>
</section>
<section class="Sh">
<h2 class="Sh" id="HISTORY"><a class="permalink" href="#HISTORY">HISTORY</a></h2>
<p class="Pp">The <code class="Fn">pledge</code>() system call first appeared in
    <span class="Ux">OpenBSD 5.9</span>.</p>
</section>
</main>
<div class="foot" role="doc-pagefooter" aria-label="Manual footer
  line"><span class="foot-left"></span><span class="foot-date">September 17,
  2024</span> <span class="foot-os">OpenBSD-current</span></div>
</body>
</html>
