

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=acb53e47db1fbc7cd37ab10b46388f045a76e383)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=acb53e47db1fbc7cd37ab10b46388f045a76e383)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=acb53e47db1fbc7cd37ab10b46388f045a76e383)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=acb53e47db1fbc7cd37ab10b46388f045a76e383)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pavel Skripkin <paskripkin@gmail.com> | 2021-11-21 23:22:39 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-17 10:30:12 +0100 |
| commit | [acb53e47db1fbc7cd37ab10b46388f045a76e383](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=acb53e47db1fbc7cd37ab10b46388f045a76e383) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=acb53e47db1fbc7cd37ab10b46388f045a76e383)) | |
| tree | [405d66cd7451bce0f1566eb0db7eb41b1965562e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=acb53e47db1fbc7cd37ab10b46388f045a76e383) | |
| parent | [c0d44c58afdd56de3c223d92fcf3072721e87642](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c0d44c58afdd56de3c223d92fcf3072721e87642) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=acb53e47db1fbc7cd37ab10b46388f045a76e383&id2=c0d44c58afdd56de3c223d92fcf3072721e87642)) | |
| download | [linux-acb53e47db1fbc7cd37ab10b46388f045a76e383.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-acb53e47db1fbc7cd37ab10b46388f045a76e383.tar.gz) | |

RDMA: Fix use-after-free in rxe\_queue\_cleanup[ Upstream commit 84b01721e8042cdd1e8ffeb648844a09cd4213e0 ]
On error handling path in rxe\_qp\_from\_init() qp->sq.queue is freed and
then rxe\_create\_qp() will drop last reference to this object. qp clean up
function will try to free this queue one time and it causes UAF bug.
Fix it by zeroing queue pointer after freeing queue in rxe\_qp\_from\_init().
Fixes: 514aee660df4 ("RDMA: Globally allocate and release QP memory")
Link: [https://lore.kernel.org/r/20211121202239.3129-1-paskripkin@gmail.com](https://lore.kernel.org/r/20211121202239.3129-1-paskripkin%40gmail.com)
Reported-by: syzbot+aab53008a5adf26abe91@syzkaller.appspotmail.com
Signed-off-by: Pavel Skripkin <paskripkin@gmail.com>
Reviewed-by: Zhu Yanjun <zyjzyj2000@gmail.com>
Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=acb53e47db1fbc7cd37ab10b46388f045a76e383)

| -rw-r--r-- | [drivers/infiniband/sw/rxe/rxe\_qp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/sw/rxe/rxe_qp.c?id=acb53e47db1fbc7cd37ab10b46388f045a76e383) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/infiniband/sw/rxe/rxe\_qp.c b/drivers/infiniband/sw/rxe/rxe\_qp.cindex 1ab6af7ddb2549..ed326d82725cd1 100644--- a/[drivers/infiniband/sw/rxe/rxe\_qp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/sw/rxe/rxe_qp.c?id=c0d44c58afdd56de3c223d92fcf3072721e87642)+++ b/[drivers/infiniband/sw/rxe/rxe\_qp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/sw/rxe/rxe_qp.c?id=acb53e47db1fbc7cd37ab10b46388f045a76e383)@@ -367,6 +367,7 @@ int rxe\_qp\_from\_init(struct rxe\_dev \*rxe, struct rxe\_qp \*qp, struct rxe\_pd \*pd,  err2: rxe\_queue\_cleanup(qp->sq.queue);+ qp->sq.queue = NULL; err1: qp->pd = NULL; qp->rcq = NULL; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:02:33 +0000

