

| [cgit logo](/cgi-bin/cgit.cgi/) | [index](/cgi-bin/cgit.cgi/) : [mupdf.git](/cgi-bin/cgit.cgi/mupdf.git/ "mupdf.git") | 1.18.x 1.19.x 1.20.x 1.21.x 1.22.x 1.23.x 1.24.x 1.25.x android-muso android-muso-signing android-openjpeg-2.3.1 css fontconfig java-empty-store lcms lcms2 line\_art\_filter master muso muso-3.9-release muso-temporary-hack objc-openjpeg-2.3.1 release-1.10a release\_1.8 so so-tess2 stext-flags win-openjpeg-2.3.1 winRT winphone |
| --- | --- | --- |
| MuPDF library | Chris Liddell |

| [summary](/cgi-bin/cgit.cgi/mupdf.git/)[refs](/cgi-bin/cgit.cgi/mupdf.git/refs/?id=05720b4ee3dbae57e65546dc2eecc3021c08eeea)[log](/cgi-bin/cgit.cgi/mupdf.git/log/)[tree](/cgi-bin/cgit.cgi/mupdf.git/tree/?id=05720b4ee3dbae57e65546dc2eecc3021c08eeea)[commit](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=05720b4ee3dbae57e65546dc2eecc3021c08eeea)[diff](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=05720b4ee3dbae57e65546dc2eecc3021c08eeea) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Robin Watts <Robin.Watts@artifex.com> | 2020-09-24 16:30:45 +0100 |
| --- | --- | --- |
| committer | Robin Watts <Robin.Watts@artifex.com> | 2020-09-24 17:48:57 +0100 |
| commit | [05720b4ee3dbae57e65546dc2eecc3021c08eeea](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=05720b4ee3dbae57e65546dc2eecc3021c08eeea) ([patch](/cgi-bin/cgit.cgi/mupdf.git/patch/?id=05720b4ee3dbae57e65546dc2eecc3021c08eeea)) | |
| tree | [328ed0c63cc711d2c70df01b6a6b9e7c580764a7](/cgi-bin/cgit.cgi/mupdf.git/tree/?id=05720b4ee3dbae57e65546dc2eecc3021c08eeea) | |
| parent | [e888b13c61856890032452cf6a0b0581acf1dc53](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=e888b13c61856890032452cf6a0b0581acf1dc53) ([diff](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=05720b4ee3dbae57e65546dc2eecc3021c08eeea&id2=e888b13c61856890032452cf6a0b0581acf1dc53)) | |

Bug 702566: Avoid leaking run\_obj from pdf\_add\_cid\_font\_widthsWhen we hit curr\_code == face->num\_glyphs we should publish any
run\_obj we have (and certainly drop it).
[Diffstat](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=05720b4ee3dbae57e65546dc2eecc3021c08eeea)

| -rw-r--r-- | [source/pdf/pdf-font-add.c](/cgi-bin/cgit.cgi/mupdf.git/diff/source/pdf/pdf-font-add.c?id=05720b4ee3dbae57e65546dc2eecc3021c08eeea) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 0 deletions

| diff --git a/source/pdf/pdf-font-add.c b/source/pdf/pdf-font-add.cindex 56e127766..f68b74c02 100644--- a/[source/pdf/pdf-font-add.c](/cgi-bin/cgit.cgi/mupdf.git/tree/source/pdf/pdf-font-add.c?id=e888b13c61856890032452cf6a0b0581acf1dc53)+++ b/[source/pdf/pdf-font-add.c](/cgi-bin/cgit.cgi/mupdf.git/tree/source/pdf/pdf-font-add.c?id=05720b4ee3dbae57e65546dc2eecc3021c08eeea)@@ -317,13 +317,22 @@ pdf\_add\_cid\_font\_widths(fz\_context \*ctx, pdf\_document \*doc, pdf\_obj \*fobj, fz\_fo prev\_code = curr\_code; } + if (pdf\_array\_len(ctx, run\_obj) > 0)+ {+ pdf\_array\_push\_int(ctx, fw, first\_code);+ pdf\_array\_push(ctx, fw, run\_obj);+ }+ if (font->width\_table != NULL) pdf\_dict\_put\_int(ctx, fobj, PDF\_NAME(DW), font->width\_default); if (pdf\_array\_len(ctx, fw) > 0) pdf\_dict\_put(ctx, fobj, PDF\_NAME(W), fw); } fz\_always(ctx)+ { pdf\_drop\_obj(ctx, fw);+ pdf\_drop\_obj(ctx, run\_obj);+ } fz\_catch(ctx) fz\_rethrow(ctx); } |
| --- |

generated by [cgit v1.2.3](https://git.zx2c4.com/cgit/about/) ([git 2.25.1](https://git-scm.com/)) at 2025-01-11 02:06:22 +0000

