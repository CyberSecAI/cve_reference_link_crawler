

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3022981%2540photo-gallery%252Ftrunk%26old%3D3013021%2540photo-gallery%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3013021/photo-gallery/trunk?old=3022981&old_path=%2Fphoto-gallery%2Ftrunk)

---

# Changes in [photo-gallery/trunk](/browser/photo-gallery/trunk?rev=3022981 "Show entry in browser") [[3013021:3022981]](/log/photo-gallery/trunk?rev=3022981&stop_rev=3013021 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[photo-gallery/trunk](/browser/photo-gallery/trunk?rev=3022981)
Files:

3 edited

* [filemanager/controller.php](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3022981 "Show entry in browser")
  (modified)
  ([6 diffs](#file0 "Show differences"))
* [photo-gallery.php](/browser/photo-gallery/trunk/photo-gallery.php?rev=3022981 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [readme.txt](/browser/photo-gallery/trunk/readme.txt?rev=3022981 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [photo-gallery/trunk/filemanager/controller.php](/changeset/3022981/photo-gallery/trunk/filemanager/controller.php?old=2883713&old_path=photo-gallery%2Ftrunk%2Ffilemanager%2Fcontroller.php "Show the [3013021:3022981] differences restricted to photo-gallery/trunk/filemanager/controller.php")

  | [r3013021](/browser/photo-gallery/trunk/filemanager/controller.php?rev=2883713#L290 "Show revision 3013021 of this file in browser") | [r3022981](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3022981#L290 "Show revision 3022981 of this file in browser") |  |
  | --- | --- | --- |
  | 290 | 290 | $file\_name = htmlspecialchars\_decode($file\_name, ENT\_COMPAT | ENT\_QUOTES); |
  | 291 | 291 | $file\_name = str\_replace('../', '', $file\_name); |
  |  | 292 | $file\_name = basename($file\_name); |
  | 292 | 293 |  |
  | 293 | 294 | $file\_new\_name = (isset($\_REQUEST['file\_new\_name']) ? stripslashes(WDWLibrary::get('file\_new\_name','','sanitize\_text\_field','REQUEST')) : ''); |
  | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=2883713#L295) | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3022981#L296) |  |
  | 295 | 296 | $file\_new\_name = htmlspecialchars\_decode($file\_new\_name, ENT\_COMPAT | ENT\_QUOTES); |
  | 296 | 297 | $file\_new\_name = $this->esc\_dir($file\_new\_name); |
  |  | 298 | $file\_new\_name = basename($file\_new\_name); |
  | 297 | 299 |  |
  | 298 | 300 | $file\_path = $cur\_dir\_path . '/' . $file\_name; |
  | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=2883713#L363) | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3022981#L365) |  |
  | 363 | 365 | } |
  | 364 | 366 | elseif ((strrpos($file\_name, '.') !== false)) { |
  | 365 |  | $file\_extension = substr($file\_name, strrpos($file\_name, '.') + 1); |
  | 366 |  | if (rename($file\_path, $cur\_dir\_path . '/' . $file\_new\_name . '.' . $file\_extension) == false) { |
  |  | 367 | $allowed\_extensions\_list = array('jpg','jpeg', 'png','gif','svg'); |
  |  | 368 | $file\_extension = strtolower(substr($file\_name, strrpos($file\_name, '.') + 1)); |
  |  | 369 |  |
  |  | 370 | if (!in\_array($file\_extension, $allowed\_extensions\_list) || rename($file\_path, $cur\_dir\_path . '/' . $file\_new\_name . '.' . $file\_extension) == false) { |
  | 367 | 371 | $msg = \_\_("Can't rename the file.", 'photo-gallery'); |
  | 368 | 372 | } |
  | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=2883713#L438) | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3022981#L442) |  |
  | 438 | 442 | $file\_path\_tbl = $wpdb->prefix . 'bwg\_file\_paths'; |
  | 439 | 443 | foreach ($file\_names as $file\_name) { |
  | 440 |  | $file\_name = htmlspecialchars\_decode($file\_name, ENT\_COMPAT | ENT\_QUOTES); |
  | 441 |  | $file\_name = str\_replace('../', '', $file\_name); |
  | 442 |  | $file\_path = $cur\_dir\_path . '/' . $file\_name; |
  | 443 |  | $thumb\_file\_path = $cur\_dir\_path . '/thumb/' . $file\_name; |
  | 444 |  | $original\_file\_path = $cur\_dir\_path . '/.original/' . $file\_name; |
  | 445 |  | if (file\_exists($file\_path) == false) { |
  | 446 |  | $msg = \_\_("Some of the files couldn't be removed.", 'photo-gallery'); |
  | 447 |  | } |
  | 448 |  | else { |
  | 449 |  | if ( is\_dir($file\_path) == true ) { |
  | 450 |  | $paths = $this->getRecursivePathLists($path, $file\_name); |
  | 451 |  | if ( !empty($paths) ) { |
  | 452 |  | $wpdb->delete( $file\_path\_tbl, array('path' => $path, 'name' => $file\_name), array('%s','%s')); |
  | 453 |  | foreach( $paths as $val ) { |
  | 454 |  | $wpdb->delete( $file\_path\_tbl, array('path' => $val), array('%s') ); |
  | 455 |  | } |
  | 456 |  | } |
  |  | 444 | $file\_name = htmlspecialchars\_decode($file\_name, ENT\_COMPAT | ENT\_QUOTES); |
  |  | 445 | $file\_name = str\_replace('../', '', $file\_name); |
  |  | 446 | $file\_name = basename($file\_name); |
  |  | 447 |  |
  |  | 448 | $allowed\_extensions\_list = array('jpg','jpeg', 'png','gif','svg'); |
  |  | 449 | $file\_extension = strtolower(substr($file\_name, strrpos($file\_name, '.') + 1)); |
  |  | 450 | $file\_path = $cur\_dir\_path . '/' . $file\_name; |
  |  | 451 |  |
  |  | 452 | $thumb\_file\_path = $cur\_dir\_path . '/thumb/' . $file\_name; |
  |  | 453 | $original\_file\_path = $cur\_dir\_path . '/.original/' . $file\_name; |
  |  | 454 | if (!in\_array($file\_extension, $allowed\_extensions\_list) || file\_exists($file\_path) == false) { |
  |  | 455 | $msg = \_\_("Some of the files couldn't be removed.", 'photo-gallery'); |
  | 457 | 456 | } |
  | 458 | 457 | else { |
  | 459 |  | $wpdb->delete( $file\_path\_tbl, array('path' => $path, 'name' => $file\_name), array('%s','%s') ); |
  |  | 458 | if ( is\_dir($file\_path) == true ) { |
  |  | 459 | $paths = $this->getRecursivePathLists($path, $file\_name); |
  |  | 460 | if ( !empty($paths) ) { |
  |  | 461 | $wpdb->delete( $file\_path\_tbl, array('path' => $path, 'name' => $file\_name), array('%s','%s')); |
  |  | 462 | foreach( $paths as $val ) { |
  |  | 463 | $wpdb->delete( $file\_path\_tbl, array('path' => $val), array('%s') ); |
  |  | 464 | } |
  |  | 465 | } |
  |  | 466 | } |
  |  | 467 | else { |
  |  | 468 | $wpdb->delete( $file\_path\_tbl, array('path' => $path, 'name' => $file\_name), array('%s','%s') ); |
  |  | 469 | } |
  |  | 470 | $this->remove\_file\_dir($file\_path, $input\_dir, $file\_name); |
  |  | 471 | if (file\_exists($thumb\_file\_path)) { |
  |  | 472 | $this->remove\_file\_dir($thumb\_file\_path); |
  |  | 473 | } |
  |  | 474 | if (file\_exists($original\_file\_path)) { |
  |  | 475 | $this->remove\_file\_dir($original\_file\_path); |
  |  | 476 | } |
  | 460 | 477 | } |
  | 461 |  | ~~$this->remove\_file\_dir($file\_path, $input\_dir, $file\_name);~~ |
  | 462 |  | ~~if (file\_exists($thumb\_file\_path)) {~~ |
  | 463 |  | ~~$this->remove\_file\_dir($thumb\_file\_path);~~ |
  | 464 |  | ~~}~~ |
  | 465 |  | ~~if (file\_exists($original\_file\_path)) {~~ |
  | 466 |  | ~~$this->remove\_file\_dir($original\_file\_path);~~ |
  | 467 |  | ~~}~~ |
  | 468 |  | ~~}~~ |
  | 469 | 478 | } |
  | 470 | 479 | $\_REQUEST['file\_names'] = ''; |
  | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=2883713#L518) | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3022981#L527) |  |
  | 518 | 527 | $file\_name = htmlspecialchars\_decode($file\_name, ENT\_COMPAT | ENT\_QUOTES); |
  | 519 | 528 | $file\_name = str\_replace('../', '', $file\_name); |
  |  | 529 | $file\_name = basename($file\_name); |
  |  | 530 | $allowed\_extensions\_list = array('jpg','jpeg', 'png','gif','svg'); |
  |  | 531 | $file\_extension = strtolower(substr($file\_name, strrpos($file\_name, '.') + 1)); |
  | 520 | 532 | $src = $src\_dir . '/' . $file\_name; |
  | 521 |  | if (file\_exists($src) == false) { |
  |  | 533 | if (!in\_array($file\_extension, $allowed\_extensions\_list) || file\_exists($src) == false) { |
  | 522 | 534 | $msg = "Failed to copy some of the files."; |
  | 523 | 535 | $msg = $file\_name; |
  | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=2883713#L592) | […](/browser/photo-gallery/trunk/filemanager/controller.php?rev=3022981#L604) |  |
  | 592 | 604 | $file\_name = htmlspecialchars\_decode($file\_name, ENT\_COMPAT | ENT\_QUOTES); |
  | 593 | 605 | $file\_name = str\_replace('../', '', $file\_name); |
  | 594 |  | $src = $src\_dir . '/' . $file\_name; |
  |  | 606 | $allowed\_extensions\_list = array('jpg','jpeg', 'png','gif','svg'); |
  |  | 607 | $file\_extension = strtolower(substr($file\_name, strrpos($file\_name, '.') + 1)); |
  |  | 608 |  |
  |  | 609 | $src = $src\_dir . '/' . $file\_name; |
  | 595 | 610 | $dest = $dest\_dir . '/' . $file\_name; |
  | 596 | 611 |  |
  | 597 |  | if ( (file\_exists($src) == FALSE) || (file\_exists($dest) == TRUE) ) { |
  |  | 612 | if ( !in\_array($file\_extension, $allowed\_extensions\_list) || (file\_exists($src) == FALSE) || (file\_exists($dest) == TRUE) ) { |
  | 598 | 613 | $flag = FALSE; |
  | 599 | 614 | } else { |
* ## [photo-gallery/trunk/photo-gallery.php](/changeset/3022981/photo-gallery/trunk/photo-gallery.php?old=3013021&old_path=photo-gallery%2Ftrunk%2Fphoto-gallery.php "Show the [3013021:3022981] differences restricted to photo-gallery/trunk/photo-gallery.php")

  | [r3013021](/browser/photo-gallery/trunk/photo-gallery.php?rev=3013021#L4 "Show revision 3013021 of this file in browser") | [r3022981](/browser/photo-gallery/trunk/photo-gallery.php?rev=3022981#L4 "Show revision 3022981 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://10web.io/plugins/wordpress-photo-gallery/?utm\_source=photo\_gallery&utm\_medium=free\_plugin |
  | 5 | 5 | \* Description: This plugin is a fully responsive gallery plugin with advanced functionality.  It allows having different image galleries for your posts and pages. You can create unlimited number of galleries, combine them into albums, and provide descriptions and tags. |
  | 6 |  | \* Version: 1.8.~~19~~ |
  |  | 6 | \* Version: 1.8.20 |
  | 7 | 7 | \* Author: Photo Gallery Team |
  | 8 | 8 | \* Author URI: https://10web.io/plugins/?utm\_source=photo\_gallery&utm\_medium=free\_plugin |
  | […](/browser/photo-gallery/trunk/photo-gallery.php?rev=3013021#L109) | […](/browser/photo-gallery/trunk/photo-gallery.php?rev=3022981#L109) |  |
  | 109 | 109 | $this->front\_url = $this->plugin\_url; |
  | 110 | 110 | $this->main\_file = plugin\_basename(\_\_FILE\_\_); |
  | 111 |  | $this->plugin\_version = '1.8.~~19~~'; |
  | 112 |  | $this->db\_version = '1.8.~~19~~'; |
  |  | 111 | $this->plugin\_version = '1.8.20'; |
  |  | 112 | $this->db\_version = '1.8.20'; |
  | 113 | 113 | $this->prefix = 'bwg'; |
  | 114 | 114 | $this->nicename = \_\_('Photo Gallery', 'photo-gallery'); |
* ## [photo-gallery/trunk/readme.txt](/changeset/3022981/photo-gallery/trunk/readme.txt?old=3013021&old_path=photo-gallery%2Ftrunk%2Freadme.txt "Show the [3013021:3022981] differences restricted to photo-gallery/trunk/readme.txt")

  | [r3013021](/browser/photo-gallery/trunk/readme.txt?rev=3013021#L4 "Show revision 3013021 of this file in browser") | [r3022981](/browser/photo-gallery/trunk/readme.txt?rev=3022981#L4 "Show revision 3022981 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 4.6 |
  | 5 | 5 | Tested up to: 6.4 |
  | 6 |  | Stable tag: 1.8.~~19~~ |
  |  | 6 | Stable tag: 1.8.20 |
  | 7 | 7 | License: GPLv2 or later |
  | 8 | 8 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/photo-gallery/trunk/readme.txt?rev=3013021#L273) | […](/browser/photo-gallery/trunk/readme.txt?rev=3022981#L273) |  |
  | 273 | 273 |  |
  | 274 | 274 | == Changelog == |
  |  | 275 |  |
  |  | 276 | = 1.8.20 = |
  |  | 277 | \* Fixed: Security vulnerability. |
  | 275 | 278 |  |
  | 276 | 279 | = 1.8.19 = |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3022981&old=3013021&new_path=%2Fphoto-gallery%2Ftrunk&old_path=%2Fphoto-gallery%2Ftrunk)
* [Zip Archive](?format=zip&new=3022981&old=3013021&new_path=%2Fphoto-gallery%2Ftrunk&old_path=%2Fphoto-gallery%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

