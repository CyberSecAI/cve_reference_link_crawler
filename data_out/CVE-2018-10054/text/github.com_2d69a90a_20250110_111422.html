
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fh2database%2Fh2database%2Fissues%2F1808)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fh2database%2Fh2database%2Fissues%2F1808)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=h2database%2Fh2database)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[h2database](/h2database)
/
**[h2database](/h2database/h2database)**
Public

* [Notifications](/login?return_to=%2Fh2database%2Fh2database) You must be signed in to change notification settings
* [Fork
  1.2k](/login?return_to=%2Fh2database%2Fh2database)
* [Star
   4.3k](/login?return_to=%2Fh2database%2Fh2database)

* [Code](/h2database/h2database)
* [Issues
  361](/h2database/h2database/issues)
* [Pull requests
  17](/h2database/h2database/pulls)
* [Actions](/h2database/h2database/actions)
* [Projects
  0](/h2database/h2database/projects)
* [Security](/h2database/h2database/security)
* [Insights](/h2database/h2database/pulse)

Additional navigation options

* [Code](/h2database/h2database)
* [Issues](/h2database/h2database/issues)
* [Pull requests](/h2database/h2database/pulls)
* [Actions](/h2database/h2database/actions)
* [Projects](/h2database/h2database/projects)
* [Security](/h2database/h2database/security)
* [Insights](/h2database/h2database/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fh2database%2Fh2database%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fh2database%2Fh2database%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Sporadic NullPointerException in LobStorageMap in 1.4.199 #1808

Closed

[bwaldvogel](/bwaldvogel) opened this issue
Mar 13, 2019
¬∑ 39 comments

Closed

# [Sporadic NullPointerException in LobStorageMap in 1.4.199](#top) #1808

[bwaldvogel](/bwaldvogel) opened this issue
Mar 13, 2019
¬∑ 39 comments

## Comments

[![@bwaldvogel](https://avatars.githubusercontent.com/u/29931?s=80&u=2a2b671be6ec28ca9be08149b36d30594e4f877b&v=4)](/bwaldvogel)

Copy link

### **[bwaldvogel](/bwaldvogel)** commented [Mar 13, 2019](#issue-420632951) ‚Ä¢ edited Loading

| After upgrading H2 from 1.4.197 to 1.4.199 I started to see sporadic NullPointerExceptions in LobStorageMap:  ``` Caused by: java.lang.NullPointerException 	at org.h2.store.LobStorageMap.copyLob(LobStorageMap.java:255) 	at org.h2.value.ValueLobDb.copyToResult(ValueLobDb.java:554) 	at org.h2.value.ValueLobDb.copyToResult(ValueLobDb.java:40) 	at org.h2.result.LocalResultImpl.cloneLobs(LocalResultImpl.java:280) 	at org.h2.result.LocalResultImpl.addRow(LocalResultImpl.java:315) 	at org.h2.command.dml.Select.queryFlat(Select.java:744) 	at org.h2.command.dml.Select.queryWithoutCache(Select.java:884) 	at org.h2.command.dml.Query.queryWithoutCacheLazyCheck(Query.java:151) 	at org.h2.command.dml.Query.query(Query.java:435) 	at org.h2.command.dml.Query.query(Query.java:397) 	at org.h2.command.CommandContainer.query(CommandContainer.java:145) 	at org.h2.command.Command.executeQuery(Command.java:202)  ```  ~~I‚Äôve not yet had the time to create a minimized test case that reproduces this issue.~~ *Update:* see [my next comment](https://github.com/h2database/h2database/issues/1808#issuecomment-473380416). |
| --- |
| The text was updated successfully, but these errors were encountered: |

 üëç
2
 virgo47 and gnefedev reacted with thumbs up emoji

All reactions

* üëç
  2 reactions

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=80&v=4)](/katzyn)

Copy link

Contributor

### **[katzyn](/katzyn)** commented [Mar 14, 2019](#issuecomment-472670052)

| There were no significant changes in `LobStorageMap` since 1.4.197, perhaps this issue was revealed by some other changes. How your query looks like? Where these LOBs came from? Is their concurrent deletion possible?  A test case would be nice, of course. |
| --- |

All reactions

Sorry, something went wrong.

[![@bwaldvogel](https://avatars.githubusercontent.com/u/29931?s=80&u=2a2b671be6ec28ca9be08149b36d30594e4f877b&v=4)](/bwaldvogel)

Copy link

Author

### **[bwaldvogel](/bwaldvogel)** commented [Mar 15, 2019](#issuecomment-473380416)

| Here‚Äôs a minimized test case that reliably fails for me with the `NullPointerException` in `LobStorageMap` as mentioned in the issue description:  ``` Connection conn1 = DriverManager.getConnection("jdbc:h2:mem:testdb");  String createTable = "create table t1 (id int, ver bigint, data text, primary key (id));"; conn1.prepareStatement(createTable).executeUpdate();  String insert = "insert into t1 (id, ver, data) values (1, 0, ?)"; PreparedStatement insertStmt = conn1.prepareStatement(insert); String largeData = org.h2.util.StringUtils.pad("", 512, "x", false); insertStmt.setString(1, largeData); insertStmt.executeUpdate();  new Thread() {     @Override     public void run() {         try {             Connection conn2 = DriverManager.getConnection("jdbc:h2:mem:testdb");             String update = "update t1 set ver = ver + 1 where id = 1";             while (!Thread.currentThread().isInterrupted()) {                 conn2.prepareStatement(update).executeUpdate();             }         } catch (Exception e) {             throw new RuntimeException(e);         }     } }.start();  while (true) {     conn1.prepareStatement("select * from t1 where id = 1").executeQuery(); } ```  It fails for me in `1.4.198` and `1.4.199` but throws no exception in `1.4.197`. |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=80&v=4)](/katzyn)

Copy link

Contributor

### **[katzyn](/katzyn)** commented [Mar 15, 2019](#issuecomment-473473377)

| Thank you for a test case. I can reproduce this issue with it.  Unfortunately, this issue is complicated. Perhaps it never worked reliably, but it was revealed only due to higher concurrency of 1.4.198. |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=80&v=4)](/katzyn)

Copy link

Contributor

### **[katzyn](/katzyn)** commented [Mar 16, 2019](#issuecomment-473479498)

| There are two problems.   1. H2 allocates a new copy of LOB when a row is inserted or updated, it is not efficient. 2. When a row is removed or updated, old LOBs are going to be removed on commit of the current session. But other sessions may still use the old row.   `SELECT FOR UPDATE` instead of a plain `SELECT` can be used as a temporary workaround. |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=80&v=4)](/katzyn)

Copy link

Contributor

### **[katzyn](/katzyn)** commented [Mar 16, 2019](#issuecomment-473502014)

| When a LOB column is used inside a `WHERE` criteria `SELECT ‚Ä¶ FOR UPDATE` will not work too.  We need to preserve LOBs until all snapshot of a table (map) that were taken before LOB deletion are released, or introduce LOB copying in a `TableFilter`, but it may slow down operations on tables with LOBs. |
| --- |

All reactions

Sorry, something went wrong.

[![@grandinj](https://avatars.githubusercontent.com/u/796121?s=80&v=4)](/grandinj)

Copy link

Contributor

### **[grandinj](/grandinj)** commented [Mar 16, 2019](#issuecomment-473503637)

| 1. H2 allocates a new copy of LOB when a row is inserted or updated, it is not efficient.  Sure, however, the strategy is that the "top" LOB table just has foreign keys to the actual data, so we are copying a fairly small row. The strategy is that when all of the "top" LOB table rows that refer to a specific LOB are gone, we can delete the LOB. We may need to add some extra functionality to the MVStore to ask it what the oldest "live" version of a specific row is. |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=80&v=4)](/katzyn)

Copy link

Contributor

### **[katzyn](/katzyn)** commented [Mar 16, 2019](#issuecomment-473504662)

| But each updated copy of a row has different identities of LOBs (even when LOB is not changed). Due to copy-on-write nature row that was updated multiple times may have a lot of copies with different identities and all these identities may be used by running queries. |
| --- |

All reactions

Sorry, something went wrong.

[![@grandinj](https://avatars.githubusercontent.com/u/796121?s=80&v=4)](/grandinj)

Copy link

Contributor

### **[grandinj](/grandinj)** commented [Mar 16, 2019](#issuecomment-473575694)

| I don't have any genius ideas right now. The easiest thing (IMO) to do would be to keep an in-memory data structure, that tracked when a given LOB was still in use by any active transactions, and then deleted it when the last active reference went away. However, that would leave us vulnerable to leaking LOBs on a crash, which is, I think, a reasonable tradeoff. |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=80&v=4)](/katzyn)

Copy link

Contributor

### **[katzyn](/katzyn)** commented [Mar 17, 2019](#issuecomment-473604471)

| LOB reference may exist only on disk in an older version of a map, that was already open by a long-running query.   1. LOBs can be garbage collected only when they aren't referenced any more. This way may increase database size too much on intensive operations. 2. Table filter can copy the LOBs immediately, and rescan the row for actual (not snapshot) data on failure. In this way we need to know whether such columns are accessed or not (if not, no reason to copy unused data) and we possibly need to disable index-sorted optimization (for the same reasons as in `FOR UPDATE` where the locked row may change its sorting position due to changed values). Perhaps such copies needs to be freed when they weren't included in result. Also we can't implement higher isolation levels with such change. 3. We can try to delay LOB removal to the commit of all running transactions (not only the current one as now). New transactions should not be awaited, because they can't see such old data. |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=80&v=4)](/katzyn)

Copy link

Contributor

### **[katzyn](/katzyn)** commented [Mar 17, 2019](#issuecomment-473626507)

| For option (3) LOB may be removed when all commands that were running at commit end will be completed. There is no need to wait for the whole transactions for now, because H2 doesn't have repeatable read and serializable isolation. |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=80&v=4)](/katzyn)

Copy link

Contributor

### **[katzyn](/katzyn)** commented [Mar 17, 2019](#issuecomment-473626675)

| But it also means that on abnormal process termination unused LOBs may stay alive. They need to be marked for deletion somehow to allow their deallocation during next database startup. |
| --- |

All reactions

Sorry, something went wrong.

[![@grandinj](https://avatars.githubusercontent.com/u/796121?s=80&v=4)](/grandinj)

Copy link

Contributor

### **[grandinj](/grandinj)** commented [Mar 17, 2019](#issuecomment-473705871)

| One scenario with these proposed solutons that is unpleasant is this: user does  ``` SELECT * FROM very_large_table_with_a_lob_colmn  ```  which requires us to store a ton of in-memory data noting that all those LOBs are in-use.  Is it possible we could fix this by making LobStorageMap go via TransactionStore instead of using MVStore directly? It feels like we are talking about reproducing the functionality we already have there. |
| --- |

All reactions

Sorry, something went wrong.

[![@bwaldvogel](https://avatars.githubusercontent.com/u/29931?s=80&u=2a2b671be6ec28ca9be08149b36d30594e4f877b&v=4)](/bwaldvogel)

Copy link

Author

### **[bwaldvogel](/bwaldvogel)** commented [Mar 17, 2019](#issuecomment-473714530)

| I noticed that the NullPointerException does not appear if the LOB column is not selected:  ``` while (true) {     conn1.prepareStatement("select id, ver from t1 where id = 1").executeQuery(); } ```  So in some scenarios this could be a workaround for `1.4.198` and `1.4.199`. |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=80&v=4)](/katzyn)

Copy link

Contributor

### **[katzyn](/katzyn)** commented [Mar 18, 2019](#issuecomment-473733767)

| `SELECT * FROM very_large_table_with_a_lob_colmn`  `LocalResultImpl` currently performs a copy of each LOB during execution of that statement.  which requires us to store a ton of in-memory data noting that all those LOBs are in-use.  No, we only need to additionally preserve a LOB after `UPDATE` / `DELETE` / `MERGE` for a short time (if there are no long-running queries). Actually all these LOBs are already gathered by a session, but it purges them all on commit. This operation should be delayed a little bit more until completion of all currently running commands.  Is it possible we could fix this by making LobStorageMap go via TransactionStore instead of using MVStore directly?  With `TransactionStore` we need to operate on the same version of a map during `SELECT` execution, perhaps it isn't really possible, because cursor of a `SELECT` statement iterates over a snapshot of a map and snapshot of another map with LOBs may be not consistent with it.  `SELECT FOR UPDATE` is even more complicated, because it needs to see both old snapshot of LOB map and its current state. Old for the first evalution of a `WHERE` criteria (it may use some condition on a LOB column) and current for the second evalutation when matched row is already locked. |
| --- |

All reactions

Sorry, something went wrong.

[![@grandinj](https://avatars.githubusercontent.com/u/796121?s=80&v=4)](/grandinj)

Copy link

Contributor

### **[grandinj](/grandinj)** commented [Mar 18, 2019](#issuecomment-473917637)

| This operation should be delayed a little bit more until completion of all currently running commands.  That sounds reasonable. It'll slow things down a bit, but LOBs are not exactly speedy to start with. |
| --- |

All reactions

Sorry, something went wrong.

[![@andreitokar](https://avatars.githubusercontent.com/u/8950218?s=80&u=88b07e2933228893ab0ffbc651738148e74ecf09&v=4)](/andreitokar)

Copy link

Contributor

### **[andreitokar](/andreitokar)** commented [Mar 18, 2019](#issuecomment-474134504)

| [@katzyn](https://github.com/katzyn),  With TransactionStore we need to operate on the same version of a map during SELECT execution, perhaps it isn't really possible, because cursor of a SELECT statement iterates over a snapshot of a map and snapshot of another map with LOBs may be not consistent with it.  This should not be a problem. We can get a coherent snapshot of multiple maps, if we need to (i.e. as in TransactionMap.sizeAsLong()). We would need something like that, when (and if) we are going to implement "repeatable read" or "snapshot" isolation level. |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=80&v=4)](/katzyn)

Copy link

Contributor

### **[katzyn](/katzyn)** commented [Mar 19, 2019](#issuecomment-474196832)

| Thanks for the pointer. OK, it's possible, but we need to change our `LobStorageInterface` significantly. |
| --- |

All reactions

Sorry, something went wrong.

[terrypacker](/terrypacker)
added a commit
to MangoAutomation/ma-core-public
that referenced
this issue
[May 16, 2019](#ref-commit-4053e9d)
[![@terrypacker](https://avatars.githubusercontent.com/u/3905204?s=40&u=18f9651f004c148242b8407fa712690192e621dc&v=4)](/terrypacker)

`[H2Proxy revert MV Store engine use, force PageStore.](/MangoAutomation/ma-core-public/commit/4053e9d09f5a64bd130cae6f8c3020fb150b73b8 "H2Proxy revert MV Store engine use, force PageStore.

Page store seems like a poor choice at present:
https://github.com/h2database/h2database/issues/1808")`
‚Ä¶

`[4053e9d](/MangoAutomation/ma-core-public/commit/4053e9d09f5a64bd130cae6f8c3020fb150b73b8)`

```
Page store seems like a poor choice at present:
[h2database/h2database#1808](https://github.com/h2database/h2database/issues/1808)
```

[![@rgoede](https://avatars.githubusercontent.com/u/6567529?s=80&v=4)](/rgoede)

Copy link

### **[rgoede](/rgoede)** commented [Oct 28, 2019](#issuecomment-547001199)

| I get the same error in my unit tests since 1.4.198. It is still present in 1.4.200. I reverted to 1.4.197 but this has two associated vulnarabilities ([CVE-2018-10054](https://github.com/advisories/GHSA-9pf8-qqhm-7w64 "CVE-2018-10054") and [CVE-2018-14335](https://github.com/advisories/GHSA-wm64-883p-84j3 "CVE-2018-14335")). |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=80&v=4)](/katzyn)

Copy link

Contributor

### **[katzyn](/katzyn)** commented [Oct 28, 2019](#issuecomment-547004720)

| 1.4.198 is a beta-quality version, don't use it.  And both these CVEs are fake ones, if you don't use stupid insecure configurations you will not be affected. |
| --- |

All reactions

Sorry, something went wrong.

[![@tsegall](https://avatars.githubusercontent.com/u/2955355?s=80&u=cc9f4ee55ddc8a139a18cd226da3c2c9cc546487&v=4)](/tsegall)

Copy link

### **[tsegall](/tsegall)** commented [Oct 28, 2019](#issuecomment-547056053)

| So we are currently stuck on 1.4.196 due to the issues mentioned above with LOBs. Is this likely to be addressed any time soon - or should we be looking at other options? |
| --- |

All reactions

Sorry, something went wrong.

[![@vineetvdubey](https://avatars.githubusercontent.com/u/35378726?s=80&u=344777b1d54e00c7c6a81ea40bc09719fcb0f0dd&v=4)](/vineetvdubey)

Copy link

### **[vineetvdubey](/vineetvdubey)** commented [Nov 25, 2019](#issuecomment-558125663) ‚Ä¢ edited Loading

| This issue is still present in 1.4.200 but not in 1.4.197 and is still reproducible using the test case provided by [@bwaldvogel](https://github.com/bwaldvogel)  On a side note: Adding the below statement, just after creating connection, passes the minimized test: `conn1.prepareStatement("SET MAX_LENGTH_INPLACE_LOB 1024;").execute();`  Is the `MAX_LENGTH_INPLACE_LOB` parameter related in any way with this issue [@katzyn](https://github.com/katzyn) ? |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=80&v=4)](/katzyn)

Copy link

Contributor

### **[katzyn](/katzyn)** commented [Nov 25, 2019](#issuecomment-558128340)

| Small LOBs aren't stored separately as larger ones. Only LOBs from a LOB storage are affected by this issue, small LOBs are fine. You can use this setting in your unit tests (if you don't have really large LOBs), but it's not a solution for a production environment. |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=40&v=4)](/katzyn)
[katzyn](/katzyn)
mentioned this issue
[Dec 9, 2019](#ref-issue-534743334)

[NullPointerException when select blob after parallel update
#2322](/h2database/h2database/issues/2322)

Closed

[![@NicoleG25](https://avatars.githubusercontent.com/u/50918335?s=80&u=c3406b4813cac2098db848ca294c34426efcc15d&v=4)](/NicoleG25)

Copy link

### **[NicoleG25](/NicoleG25)** commented [Mar 15, 2020](#issuecomment-599199701)

| Hi [@katzyn](https://github.com/katzyn) , I understand that if you do not use stupid configurations you wont be affected by [CVE-2018-10054](https://github.com/advisories/GHSA-9pf8-qqhm-7w64 "CVE-2018-10054"), that being said, these 'stupid configurations' only affect 1.4.197 onward or also 1.4.196 and lower?  Thanks in advance ! :) |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=80&v=4)](/katzyn)

Copy link

Contributor

### **[katzyn](/katzyn)** commented [Mar 15, 2020](#issuecomment-599203115)

| All **old** versions allow remote database creation if TCP, PG/ODBC, or web server is started. If you use them, you must also ensure that your server is protected from unauthorized access. All versions of H2 allow connections only from localhost by default and it can be enough in many use cases (unless you have sessions of multiple users on the same terminal server or something like it). When you enable remote access, you need to guard your ports somehow from connections from untrusted systems. Actually you should normally guard ports of all database systems that you use, not only the ports of H2.  In the recent versions of H2 remote database creation is disallowed even when remote access is enabled. It improves security of such configurations. But, again, remote access from untrusted sources to a database in not a good idea at all. At least you should also use strong passwords for users of your databases, and use the `-baseDir` option to disallow access to databases from other places in the file system.  Remote database creation is dangerous because it gives `ADMIN` privileges to a newly created database, but users with such privileges of existing databases can also do everything with JVM and underlying system. Database is not a secure container, `ADMIN` users have access to the system by design.  If you use embedded databases only and don't start network servers, you aren't affected by anything.  [CVE-2018-10054](https://github.com/advisories/GHSA-9pf8-qqhm-7w64 "CVE-2018-10054") is not about the H2, it is about Datomic that uses insecurely configured H2.  [CVE-2018-14335](https://github.com/advisories/GHSA-wm64-883p-84j3 "CVE-2018-14335") is about H2 Console that also was incorrectly configured by somebody to allow access from untrusted users. It is more secure in recent versions of H2, however; tools aren't available any more for regular users of console. In you want to use it in old versions of H2, make sure that it is not available for others; for example, don't enable the remote access to H2's own web server, and if you use a H2 Console as a servlet on an application server, use the appropriate configuration with security constraints. <https://h2database.com/html/tutorial.html#usingH2ConsoleServlet> |
| --- |

All reactions

Sorry, something went wrong.

[![@NicoleG25](https://avatars.githubusercontent.com/u/50918335?s=80&u=c3406b4813cac2098db848ca294c34426efcc15d&v=4)](/NicoleG25)

Copy link

### **[NicoleG25](/NicoleG25)** commented [Mar 15, 2020](#issuecomment-599204927)

| All **old** versions allow remote database creation if TCP, PG/ODBC, or web server is started. If you use them, you must also ensure that your server is protected from unauthorized access. All versions of H2 allow connections only from localhost by default and it can be enough in many use cases (unless you have sessions of multiple users on the same terminal server or something like it). When you enable remote access, you need to guard your ports somehow from connections from untrusted systems. Actually you should normally guard ports of all database systems that you use, not only the ports of H2.  In the recent versions of H2 remote database creation is disallowed even when remote access is enabled. It improves security of such configurations. But, again, remote access from untrusted sources to a database in not a good idea at all. At least you should also use strong passwords for users of your databases, and use the `-baseDir` option to disallow access to databases from other places in the file system.  Remote database creation is dangerous because it gives `ADMIN` privileges to a newly created database, but users with such privileges of existing databases can also do everything with JVM and underlying system. Database is not a secure container, `ADMIN` users have access to the system by design.  If you use embedded databases only and don't start network servers, you aren't affected by anything.  CVE-2018-10054 is not about the H2, it is about Datomic that uses insecurely configured H2.  CVE-2018-14335 is about H2 Console that also was incorrectly configured by somebody to allow access from untrusted users. It is more secure in recent versions of H2, however; tools aren't available any more for regular users of console. In you want to use it in old versions of H2, make sure that it is not available for others; for example, don't enable the remote access to H2's own web server, and if you use a H2 Console as a servlet on an application server, use the appropriate configuration with security constraints. <https://h2database.com/html/tutorial.html#usingH2ConsoleServlet>  Thank you very much for your detailed reply ! It's very appreciated. |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=40&v=4)](/katzyn)
[katzyn](/katzyn)
mentioned this issue
[Mar 31, 2020](#ref-issue-590954980)

[feature: store LOB data in files external to the database
#2531](/h2database/h2database/issues/2531)

Open

[dutoitc](/dutoitc)
pushed a commit
to dutoitc/copper
that referenced
this issue
[May 19, 2020](#ref-commit-e0c16aa)

`[Forced H2 1.4.197 because of](/dutoitc/copper/commit/e0c16aa340dc853535e2d0114ed7b9e3d4feffd7 "Forced H2 1.4.197 because of https://github.com/h2database/h2database/issues/1808") [h2database/h2database#1808](https://github.com/h2database/h2database/issues/1808)`

`[e0c16aa](/dutoitc/copper/commit/e0c16aa340dc853535e2d0114ed7b9e3d4feffd7)`

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=40&v=4)](/katzyn)
[katzyn](/katzyn)
mentioned this issue
[Jul 3, 2020](#ref-issue-650612062)

[NPE on a select query where BLOB are present
#2732](/h2database/h2database/issues/2732)

Closed

[![@ade90036](https://avatars.githubusercontent.com/u/6196152?s=80&v=4)](/ade90036)

Copy link

### **[ade90036](/ade90036)** commented [Jul 3, 2020](#issuecomment-653568950) ‚Ä¢ edited Loading

| I don't have any genius ideas right now. The easiest thing (IMO) to do would be to keep an in-memory data structure, that tracked when a given LOB was still in use by any active transactions, and then deleted it when the last active reference went away.  [WeakHashMap](https://docs.oracle.com/javase/8/docs/api/java/util/WeakHashMap.html) |
| --- |

All reactions

Sorry, something went wrong.

[![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=40&v=4)](/katzyn)
[katzyn](/katzyn)
mentioned this issue
[Jul 22, 2020](#ref-issue-577464323)

[Release H2 2.0.202
#2491](/h2database/h2database/issues/2491)

Closed

[![@anmalysh-yb](https://avatars.githubusercontent.com/u/80941592?s=40&v=4)](/anmalysh-yb)
[anmalysh-yb](/anmalysh-yb)
mentioned this issue
[Apr 23, 2021](#ref-issue-866006099)

[[Platform] Fix BackupUniverseTest
yugabyte/yugabyte-db#8145](/yugabyte/yugabyte-db/issues/8145)

Open

[![@abelom](https://avatars.githubusercontent.com/u/575495?s=80&v=4)](/abelom)

Copy link

### **[abelom](/abelom)** commented [Feb 22, 2022](#issuecomment-1048000101)

| Hello from 2022. We are still affected by this sporadic issue :( |
| --- |

All reactions

Sorry, something went wrong.

[![@ade90036](https://avatars.githubusercontent.com/u/6196152?s=80&v=4)](/ade90036)

Copy link

### **[ade90036](/ade90036)** commented [Feb 22, 2022](#issuecomment-1048035397) ‚Ä¢ edited Loading

| [@abelom](https://github.com/abelom) what version are you using? 202+?  Can you provide the full exception?  I ended up refactoring the database myself.  I have blobs stored in a specially purposed table (`create table blob (ID, BLOB_CONTENT)`).  I then use `blobID` in the refering table, the one that does heaving concurrent updates.  Now when I need to fetch the blob I perform asubsequent query. There is a overhead in performing the extra query but we never had any more issues with NPE.  We have implemented a distributed job queue service and the same table gets hammered from 40+ nodes and we have been able to achieve significant level of concurrency. |
| --- |

All reactions

Sorry, something went wrong.

[![@abelom](https://avatars.githubusercontent.com/u/575495?s=80&v=4)](/abelom)

Copy link

### **[abelom](/abelom)** commented [Feb 22, 2022](#issuecomment-1048052882)

| 2.1.210  ``` Caused by: java.lang.NullPointerException          at org.h2.mvstore.db.LobStorageMap.copyLob(LobStorageMap.java:252)          at org.h2.value.ValueLob.copyToResult(ValueLob.java:291)          at org.h2.result.LocalResult.cloneLobs(LocalResult.java:357)          at org.h2.result.LocalResult.addRow(LocalResult.java:409)          at org.h2.command.query.Select.queryFlat(Select.java:730)          at org.h2.command.query.Select.queryWithoutCache(Select.java:833)          at org.h2.command.query.Query.queryWithoutCacheLazyCheck(Query.java:197)          at org.h2.command.query.Query.query(Query.java:494)          at org.h2.command.query.Query.query(Query.java:457)          at org.h2.command.CommandContainer.query(CommandContainer.java:256)          at org.h2.command.Command.executeQuery(Command.java:190)          ... 36 more  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@grandinj](https://avatars.githubusercontent.com/u/796121?s=80&v=4)](/grandinj)

Copy link

Contributor

### **[grandinj](/grandinj)** commented [Feb 24, 2022](#issuecomment-1049700324)

| OK, so as far as I can tell, the problem appears to be that LobStorageMap::copyLob should be operating on a snapshot of the lobMap, taken from when the query started. Otherwise, if a LOB is updated while we are querying a table, the lobId might no longer be in the current version of the map.  [@andreitokar](https://github.com/andreitokar) Does that sound like a legimate theory? And any ideas how best to implement a fix? |
| --- |

All reactions

Sorry, something went wrong.

[![@ade90036](https://avatars.githubusercontent.com/u/6196152?s=80&v=4)](/ade90036)

Copy link

### **[ade90036](/ade90036)** commented [Feb 24, 2022](#issuecomment-1050080290)

| Can we double check if the code sample which was provided before from [@bwaldvogel](https://github.com/bwaldvogel) is still able to reproduce the issue? |
| --- |

All reactions

Sorry, something went wrong.

[![@bwaldvogel](https://avatars.githubusercontent.com/u/29931?s=80&u=2a2b671be6ec28ca9be08149b36d30594e4f877b&v=4)](/bwaldvogel)

Copy link

Author

### **[bwaldvogel](/bwaldvogel)** commented [Feb 25, 2022](#issuecomment-1050639110)

| I ran my reproducer with Java 17.0.2 and H2 version `2.1.210`.  I immediately see the following exception:  ``` Exception in thread "main" org.h2.jdbc.JdbcSQLNonTransientException: General error: "java.lang.NullPointerException: Cannot read field ""streamStoreId"" because ""<local11>"" is null"; SQL statement: select * from t1 where id = 1 [50000-210] 	at org.h2.message.DbException.getJdbcSQLException(DbException.java:573) 	at org.h2.message.DbException.getJdbcSQLException(DbException.java:496) 	at org.h2.message.DbException.get(DbException.java:216) 	at org.h2.message.DbException.convert(DbException.java:414) 	at org.h2.command.Command.executeQuery(Command.java:211) 	at org.h2.jdbc.JdbcPreparedStatement.executeQuery(JdbcPreparedStatement.java:128) 	at de.bwaldvogel.H2Issue1808Reproducer.main(Reproducer.java:38) Caused by: java.lang.NullPointerException: Cannot read field "streamStoreId" because "<local11>" is null 	at org.h2.mvstore.db.LobStorageMap.copyLob(LobStorageMap.java:252) 	at org.h2.value.ValueLob.copyToResult(ValueLob.java:291) 	at org.h2.result.LocalResult.cloneLobs(LocalResult.java:357) 	at org.h2.result.LocalResult.addRow(LocalResult.java:409) 	at org.h2.command.query.Select.queryFlat(Select.java:730) 	at org.h2.command.query.Select.queryWithoutCache(Select.java:833) 	at org.h2.command.query.Query.queryWithoutCacheLazyCheck(Query.java:197) 	at org.h2.command.query.Query.query(Query.java:494) 	at org.h2.command.query.Query.query(Query.java:457) 	at org.h2.command.CommandContainer.query(CommandContainer.java:256) 	at org.h2.command.Command.executeQuery(Command.java:190) 	... 2 more  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@grandinj](https://avatars.githubusercontent.com/u/796121?s=80&v=4)](/grandinj)

Copy link

Contributor

### **[grandinj](/grandinj)** commented [Mar 1, 2022](#issuecomment-1055100692)

| Noting that I cannot come up with a scheme for LOBs that does not require updating a table even just for SELECT. i.e. even just reading a table with LOBs will trigger writes to the DB file.  I am afraid this got a lot harder when we switched to a fully MVCC backend, there is now a lot more concurrency to deal with. |
| --- |

All reactions

Sorry, something went wrong.

[grandinj](/grandinj)
added a commit
to grandinj/h2database
that referenced
this issue
[Mar 2, 2022](#ref-commit-cc11a95)
[![@grandinj](https://avatars.githubusercontent.com/u/796121?s=40&v=4)](/grandinj)

`[h2database#1808](https://github.com/h2database/h2database/issues/1808) [fix concurrent update of LOB](/grandinj/h2database/commit/cc11a953b1f0a8beab823d19433054f250748aad "#1808 fix concurrent update of LOB")`

`[cc11a95](/grandinj/h2database/commit/cc11a953b1f0a8beab823d19433054f250748aad)`

[![@grandinj](https://avatars.githubusercontent.com/u/796121?s=40&v=4)](/grandinj)
[grandinj](/grandinj)
mentioned this issue
[Mar 2, 2022](#ref-pullrequest-1156923982)

[#1808 fix concurrent update of LOB
#3451](/h2database/h2database/pull/3451)
 Closed

[![@andreitokar](https://avatars.githubusercontent.com/u/8950218?s=40&u=88b07e2933228893ab0ffbc651738148e74ecf09&v=4)](/andreitokar)
[andreitokar](/andreitokar)
mentioned this issue
[Mar 15, 2022](#ref-pullrequest-1169123878)

[Alternative fix for #1808
#3455](/h2database/h2database/pull/3455)
 Merged

[andreitokar](/andreitokar)
added a commit
that referenced
this issue
[Mar 15, 2022](#ref-commit-1bed7e2)
[![@andreitokar](https://avatars.githubusercontent.com/u/8950218?s=40&u=88b07e2933228893ab0ffbc651738148e74ecf09&v=4)](/andreitokar)

`[Merge pull request](/h2database/h2database/commit/1bed7e27f87b3d2e7523ec1722e2ff3b14c9ab02 "Merge pull request #3455 from andreitokar/LOB-AT

Alternative fix for #1808") [#3455](https://github.com/h2database/h2database/pull/3455) [from andreitokar/LOB-AT](/h2database/h2database/commit/1bed7e27f87b3d2e7523ec1722e2ff3b14c9ab02 "Merge pull request #3455 from andreitokar/LOB-AT

Alternative fix for #1808")`
‚Ä¶

`[1bed7e2](/h2database/h2database/commit/1bed7e27f87b3d2e7523ec1722e2ff3b14c9ab02)`

```
Alternative fix for [#1808](https://github.com/h2database/h2database/issues/1808)
```

[![@andreitokar](https://avatars.githubusercontent.com/u/8950218?s=80&u=88b07e2933228893ab0ffbc651738148e74ecf09&v=4)](/andreitokar)

Copy link

Contributor

### **[andreitokar](/andreitokar)** commented [Mar 15, 2022](#issuecomment-1068379022)

| Hopefully for good, this time around. |
| --- |

All reactions

Sorry, something went wrong.

[![@andreitokar](https://avatars.githubusercontent.com/u/8950218?s=40&u=88b07e2933228893ab0ffbc651738148e74ecf09&v=4)](/andreitokar)
[andreitokar](/andreitokar)
closed this as [completed](/h2database/h2database/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Mar 15, 2022](#event-6245843477)

[![@rusefillc](https://avatars.githubusercontent.com/u/48498823?s=80&u=5fc65a4810a17e6a87281b12d733e6a212011a94&v=4)](/rusefillc)

Copy link

### **[rusefillc](/rusefillc)** commented [Mar 15, 2022](#issuecomment-1068438498)

| Wow that's huge! What is the plan on next release? :) |
| --- |

All reactions

Sorry, something went wrong.

[![@ade90036](https://avatars.githubusercontent.com/u/6196152?s=80&v=4)](/ade90036)

Copy link

### **[ade90036](/ade90036)** commented [Mar 16, 2022](#issuecomment-1069208227)

| ill give it a test, with out workloads to see if it still throwing issues. |
| --- |

All reactions

Sorry, something went wrong.

[![@ade90036](https://avatars.githubusercontent.com/u/6196152?s=80&v=4)](/ade90036)

Copy link

### **[ade90036](/ade90036)** commented [Apr 1, 2022](#issuecomment-1086275518)

| I have given a fair bit of testing and it seems to have resolved the issue on my end.  Maybe can we get [@bwaldvogel](https://github.com/bwaldvogel) and [@abelom](https://github.com/abelom) to retest latest version (can be build from master) to see if they can still reproduce the issue?  I'm happy that in my particular workflow it is now behaving as expected.  [@andreitokar](https://github.com/andreitokar) so was the issue on the writing/flushing the transaction that subsequent read where loading an older blob, one that could have been going out of scope? |
| --- |

All reactions

Sorry, something went wrong.

[![@bwaldvogel](https://avatars.githubusercontent.com/u/29931?s=80&u=2a2b671be6ec28ca9be08149b36d30594e4f877b&v=4)](/bwaldvogel)

Copy link

Author

### **[bwaldvogel](/bwaldvogel)** commented [Apr 6, 2022](#issuecomment-1089875381)

| Thanks for your work, I can confirm that my reproducer works on current `master`! üëç üöÄ  I even ran a quick bisect (for the fun of it üòÖ) and can confirm that [610bc5a](https://github.com/h2database/h2database/commit/610bc5a5b0acb23e09644b16206915ec6da5b220) fixes my reproducer. |
| --- |

 ‚ù§Ô∏è
1
 ade90036 reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![@ade90036](https://avatars.githubusercontent.com/u/6196152?s=80&v=4)](/ade90036)

Copy link

### **[ade90036](/ade90036)** commented [Apr 6, 2022](#issuecomment-1090354721) via email

| When can we expect a release? ‚Ä¶ On Wed, 6 Apr 2022 at 07:34, Benedikt Waldvogel \*\*\*@\*\*\*.\*\*\*> wrote: Thanks for your work, I can confirm that my reproducer works on current master! üëç üöÄ I even ran a quick bisect (for the fun of it üòÖ) and can confirm that [610bc5a](https://github.com/h2database/h2database/commit/610bc5a5b0acb23e09644b16206915ec6da5b220) <[610bc5a](https://github.com/h2database/h2database/commit/610bc5a5b0acb23e09644b16206915ec6da5b220)> fixes my reproducer. ‚Äî Reply to this email directly, view it on GitHub <[#1808 (comment)](https://github.com/h2database/h2database/issues/1808#issuecomment-1089875381)>, or unsubscribe <<https://github.com/notifications/unsubscribe-auth/ABPIXODD5LAAOXHBVCN7AHTVDUV7PANCNFSM4G5YAT6A>> . You are receiving this because you commented.Message ID: \*\*\*@\*\*\*.\*\*\*> |
| --- |

All reactions

Sorry, something went wrong.

[anmalysh-yb](/anmalysh-yb)
added a commit
to yugabyte/yugabyte-db
that referenced
this issue
[Apr 20, 2022](#ref-commit-8221b8c)
[![@anmalysh-yb](https://avatars.githubusercontent.com/u/80941592?s=40&v=4)](/anmalysh-yb)

`[[](/yugabyte/yugabyte-db/commit/8221b8c37500b2bea0da53d0bf2c8d3bc6dc8a42 "[PLAT-3752] Up-version H2 db to fix NPE

Summary: Bug https://github.com/h2database/h2database/issues/1808 is finally fixed and available in H2 version 2.1.212

Test Plan: sbt test

Reviewers: sb-yb, nsingh

Reviewed By: nsingh

Subscribers: jenkins-bot, yugaware

Differential Revision: https://phabricator.dev.yugabyte.com/D16618")[PLAT-3752](https://yugabyte.atlassian.net/browse/PLAT-3752)[] Up-version H2 db to fix NPE](/yugabyte/yugabyte-db/commit/8221b8c37500b2bea0da53d0bf2c8d3bc6dc8a42 "[PLAT-3752] Up-version H2 db to fix NPE

Summary: Bug https://github.com/h2database/h2database/issues/1808 is finally fixed and available in H2 version 2.1.212

Test Plan: sbt test

Reviewers: sb-yb, nsingh

Reviewed By: nsingh

Subscribers: jenkins-bot, yugaware

Differential Revision: https://phabricator.dev.yugabyte.com/D16618")`
‚Ä¶

`[8221b8c](/yugabyte/yugabyte-db/commit/8221b8c37500b2bea0da53d0bf2c8d3bc6dc8a42)`

```
Summary: Bug [h2database/h2database#1808](https://github.com/h2database/h2database/issues/1808) is finally fixed and available in H2 version 2.1.212

Test Plan: sbt test

Reviewers: sb-yb, nsingh

Reviewed By: nsingh

Subscribers: jenkins-bot, yugaware

Differential Revision: <https://phabricator.dev.yugabyte.com/D16618>
```

[anmalysh-yb](/anmalysh-yb)
added a commit
to yugabyte/yugabyte-db
that referenced
this issue
[Apr 20, 2022](#ref-commit-2d78ffe)
[![@anmalysh-yb](https://avatars.githubusercontent.com/u/80941592?s=40&v=4)](/anmalysh-yb)

`[[Backport 2.12][](/yugabyte/yugabyte-db/commit/2d78ffe1f6a6b4ebaf72fb34fa587260ff2eddd6 "[Backport 2.12][PLAT-3752] Up-version H2 db to fix NPE

Summary:
Bug https://github.com/h2database/h2database/issues/1808 is finally fixed and available in H2 version 2.1.212

Original diff: https://phabricator.dev.yugabyte.com/D16618

Test Plan: sbt test

Reviewers: sb-yb, nsingh

Reviewed By: nsingh

Subscribers: jenkins-bot, yugaware

Differential Revision: https://phabricator.dev.yugabyte.com/D16619")[PLAT-3752](https://yugabyte.atlassian.net/browse/PLAT-3752)[] Up-version H2 db to fix NPE](/yugabyte/yugabyte-db/commit/2d78ffe1f6a6b4ebaf72fb34fa587260ff2eddd6 "[Backport 2.12][PLAT-3752] Up-version H2 db to fix NPE

Summary:
Bug https://github.com/h2database/h2database/issues/1808 is finally fixed and available in H2 version 2.1.212

Original diff: https://phabricator.dev.yugabyte.com/D16618

Test Plan: sbt test

Reviewers: sb-yb, nsingh

Reviewed By: nsingh

Subscribers: jenkins-bot, yugaware

Differential Revision: https://phabricator.dev.yugabyte.com/D16619")`
‚Ä¶

`[2d78ffe](/yugabyte/yugabyte-db/commit/2d78ffe1f6a6b4ebaf72fb34fa587260ff2eddd6)`

```
Summary:
Bug [h2database/h2database#1808](https://github.com/h2database/h2database/issues/1808) is finally fixed and available in H2 version 2.1.212

Original diff: <https://phabricator.dev.yugabyte.com/D16618>

Test Plan: sbt test

Reviewers: sb-yb, nsingh

Reviewed By: nsingh

Subscribers: jenkins-bot, yugaware

Differential Revision: <https://phabricator.dev.yugabyte.com/D16619>
```

[anmalysh-yb](/anmalysh-yb)
added a commit
to yugabyte/yugabyte-db
that referenced
this issue
[Apr 20, 2022](#ref-commit-b080823)
[![@anmalysh-yb](https://avatars.githubusercontent.com/u/80941592?s=40&v=4)](/anmalysh-yb)

`[[Backport 2.8][](/yugabyte/yugabyte-db/commit/b0808239e7c80dfb388b7346fa2f8554f78f4d13 "[Backport 2.8][PLAT-3752] Up-version H2 db to fix NPE

Summary:
Bug https://github.com/h2database/h2database/issues/1808 is finally fixed and available in H2 version 2.1.212

Original diff: https://phabricator.dev.yugabyte.com/D16618

Test Plan: sbt test

Reviewers: sb-yb, nsingh

Reviewed By: nsingh

Subscribers: jenkins-bot, yugaware

Differential Revision: https://phabricator.dev.yugabyte.com/D16620")[PLAT-3752](https://yugabyte.atlassian.net/browse/PLAT-3752)[] Up-version H2 db to fix NPE](/yugabyte/yugabyte-db/commit/b0808239e7c80dfb388b7346fa2f8554f78f4d13 "[Backport 2.8][PLAT-3752] Up-version H2 db to fix NPE

Summary:
Bug https://github.com/h2database/h2database/issues/1808 is finally fixed and available in H2 version 2.1.212

Original diff: https://phabricator.dev.yugabyte.com/D16618

Test Plan: sbt test

Reviewers: sb-yb, nsingh

Reviewed By: nsingh

Subscribers: jenkins-bot, yugaware

Differential Revision: https://phabricator.dev.yugabyte.com/D16620")`
‚Ä¶

`[b080823](/yugabyte/yugabyte-db/commit/b0808239e7c80dfb388b7346fa2f8554f78f4d13)`

```
Summary:
Bug [h2database/h2database#1808](https://github.com/h2database/h2database/issues/1808) is finally fixed and available in H2 version 2.1.212

Original diff: <https://phabricator.dev.yugabyte.com/D16618>

Test Plan: sbt test

Reviewers: sb-yb, nsingh

Reviewed By: nsingh

Subscribers: jenkins-bot, yugaware

Differential Revision: <https://phabricator.dev.yugabyte.com/D16620>
```

[anmalysh-yb](/anmalysh-yb)
added a commit
to yugabyte/yugabyte-db
that referenced
this issue
[Apr 20, 2022](#ref-commit-61c077e)
[![@anmalysh-yb](https://avatars.githubusercontent.com/u/80941592?s=40&v=4)](/anmalysh-yb)

`[[Backport 2.6][](/yugabyte/yugabyte-db/commit/61c077ec705546f2eeee2ddb4916538977c791fb "[Backport 2.6][PLAT-3752] Up-version H2 db to fix NPE

Summary:
Bug https://github.com/h2database/h2database/issues/1808 is finally fixed and available in H2 version 2.1.212

Original diff: https://phabricator.dev.yugabyte.com/D16618

Test Plan: sbt test

Reviewers: sb-yb, nsingh

Reviewed By: nsingh

Subscribers: jenkins-bot, yugaware

Differential Revision: https://phabricator.dev.yugabyte.com/D16621")[PLAT-3752](https://yugabyte.atlassian.net/browse/PLAT-3752)[] Up-version H2 db to fix NPE](/yugabyte/yugabyte-db/commit/61c077ec705546f2eeee2ddb4916538977c791fb "[Backport 2.6][PLAT-3752] Up-version H2 db to fix NPE

Summary:
Bug https://github.com/h2database/h2database/issues/1808 is finally fixed and available in H2 version 2.1.212

Original diff: https://phabricator.dev.yugabyte.com/D16618

Test Plan: sbt test

Reviewers: sb-yb, nsingh

Reviewed By: nsingh

Subscribers: jenkins-bot, yugaware

Differential Revision: https://phabricator.dev.yugabyte.com/D16621")`
‚Ä¶

`[61c077e](/yugabyte/yugabyte-db/commit/61c077ec705546f2eeee2ddb4916538977c791fb)`

```
Summary:
Bug [h2database/h2database#1808](https://github.com/h2database/h2database/issues/1808) is finally fixed and available in H2 version 2.1.212

Original diff: <https://phabricator.dev.yugabyte.com/D16618>

Test Plan: sbt test

Reviewers: sb-yb, nsingh

Reviewed By: nsingh

Subscribers: jenkins-bot, yugaware

Differential Revision: <https://phabricator.dev.yugabyte.com/D16621>
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fh2database%2Fh2database%2Fissues%2F1808)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [#1808 fix concurrent update of LOB](/h2database/h2database/pull/3451)
 [grandinj/h2database](/grandinj/h2database)

11 participants

[![@bwaldvogel](https://avatars.githubusercontent.com/u/29931?s=52&v=4)](/bwaldvogel) [![@abelom](https://avatars.githubusercontent.com/u/575495?s=52&v=4)](/abelom) [![@grandinj](https://avatars.githubusercontent.com/u/796121?s=52&v=4)](/grandinj) [![@tsegall](https://avatars.githubusercontent.com/u/2955355?s=52&v=4)](/tsegall) [![@ade90036](https://avatars.githubusercontent.com/u/6196152?s=52&v=4)](/ade90036) [![@rgoede](https://avatars.githubusercontent.com/u/6567529?s=52&v=4)](/rgoede) [![@andreitokar](https://avatars.githubusercontent.com/u/8950218?s=52&v=4)](/andreitokar) [![@katzyn](https://avatars.githubusercontent.com/u/23182944?s=52&v=4)](/katzyn) [![@vineetvdubey](https://avatars.githubusercontent.com/u/35378726?s=52&v=4)](/vineetvdubey) [![@rusefillc](https://avatars.githubusercontent.com/u/48498823?s=52&v=4)](/rusefillc) [![@NicoleG25](https://avatars.githubusercontent.com/u/50918335?s=52&v=4)](/NicoleG25)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.

