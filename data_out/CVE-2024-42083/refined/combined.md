=== Content from git.kernel.org_57afdc24_20250111_152619.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e3f02f32a05009a688a87f5799e049ed6b55bab5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e3f02f32a05009a688a87f5799e049ed6b55bab5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e3f02f32a05009a688a87f5799e049ed6b55bab5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e3f02f32a05009a688a87f5799e049ed6b55bab5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Taehee Yoo <ap420073@gmail.com> | 2024-06-20 10:58:08 +0000 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2024-06-21 11:30:43 +0100 |
| commit | [e3f02f32a05009a688a87f5799e049ed6b55bab5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e3f02f32a05009a688a87f5799e049ed6b55bab5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e3f02f32a05009a688a87f5799e049ed6b55bab5)) | |
| tree | [f1b9c9f7852cbe38e85838d9f28960621b1950a7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e3f02f32a05009a688a87f5799e049ed6b55bab5) | |
| parent | [7eadf50095bc35c0e17e66cab617a934888edc20](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7eadf50095bc35c0e17e66cab617a934888edc20) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e3f02f32a05009a688a87f5799e049ed6b55bab5&id2=7eadf50095bc35c0e17e66cab617a934888edc20)) | |
| download | [linux-e3f02f32a05009a688a87f5799e049ed6b55bab5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e3f02f32a05009a688a87f5799e049ed6b55bab5.tar.gz) | |

ionic: fix kernel panic due to multi-buffer handlingCurrently, the ionic\_run\_xdp() doesn't handle multi-buffer packets
properly for XDP\_TX and XDP\_REDIRECT.
When a jumbo frame is received, the ionic\_run\_xdp() first makes xdp
frame with all necessary pages in the rx descriptor.
And if the action is either XDP\_TX or XDP\_REDIRECT, it should unmap
dma-mapping and reset page pointer to NULL for all pages, not only the
first page.
But it doesn't for SG pages. So, SG pages unexpectedly will be reused.
It eventually causes kernel panic.
Oops: general protection fault, probably for non-canonical address 0x504f4e4dbebc64ff: 0000 [#1] PREEMPT SMP NOPTI
CPU: 3 PID: 0 Comm: swapper/3 Not tainted 6.10.0-rc3+ #25
RIP: 0010:xdp\_return\_frame+0x42/0x90
Code: 01 75 12 5b 4c 89 e6 5d 31 c9 41 5c 31 d2 41 5d e9 73 fd ff ff 44 8b 6b 20 0f b7 43 0a 49 81 ed 68 01 00 00 49 29 c5 49 01 fd <41> 80 7d0
RSP: 0018:ffff99d00122ce08 EFLAGS: 00010202
RAX: 0000000000005453 RBX: ffff8d325f904000 RCX: 0000000000000001
RDX: 00000000670e1000 RSI: 000000011f90d000 RDI: 504f4e4d4c4b4a49
RBP: ffff99d003907740 R08: 0000000000000000 R09: 0000000000000000
R10: 000000011f90d000 R11: 0000000000000000 R12: ffff8d325f904010
R13: 504f4e4dbebc64fd R14: ffff8d3242b070c8 R15: ffff99d0039077c0
FS: 0000000000000000(0000) GS:ffff8d399f780000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f41f6c85e38 CR3: 000000037ac30000 CR4: 00000000007506f0
PKRU: 55555554
Call Trace:
<IRQ>
? die\_addr+0x33/0x90
? exc\_general\_protection+0x251/0x2f0
? asm\_exc\_general\_protection+0x22/0x30
? xdp\_return\_frame+0x42/0x90
ionic\_tx\_clean+0x211/0x280 [ionic 15881354510e6a9c655c59c54812b319ed2cd015]
ionic\_tx\_cq\_service+0xd3/0x210 [ionic 15881354510e6a9c655c59c54812b319ed2cd015]
ionic\_txrx\_napi+0x41/0x1b0 [ionic 15881354510e6a9c655c59c54812b319ed2cd015]
\_\_napi\_poll.constprop.0+0x29/0x1b0
net\_rx\_action+0x2c4/0x350
handle\_softirqs+0xf4/0x320
irq\_exit\_rcu+0x78/0xa0
common\_interrupt+0x77/0x90
Fixes: 5377805dc1c0 ("ionic: implement xdp frags support")
Signed-off-by: Taehee Yoo <ap420073@gmail.com>
Reviewed-by: Shannon Nelson <shannon.nelson@amd.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e3f02f32a05009a688a87f5799e049ed6b55bab5)

| -rw-r--r-- | [drivers/net/ethernet/pensando/ionic/ionic\_txrx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/pensando/ionic/ionic_txrx.c?id=e3f02f32a05009a688a87f5799e049ed6b55bab5) | 27 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 18 insertions, 9 deletions

| diff --git a/drivers/net/ethernet/pensando/ionic/ionic\_txrx.c b/drivers/net/ethernet/pensando/ionic/ionic\_txrx.cindex 2427610f4306d9..aed7d9cbce038f 100644--- a/[drivers/net/ethernet/pensando/ionic/ionic\_txrx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/pensando/ionic/ionic_txrx.c?id=7eadf50095bc35c0e17e66cab617a934888edc20)+++ b/[drivers/net/ethernet/pensando/ionic/ionic\_txrx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/pensando/ionic/ionic_txrx.c?id=e3f02f32a05009a688a87f5799e049ed6b55bab5)@@ -480,6 +480,20 @@ int ionic\_xdp\_xmit(struct net\_device \*netdev, int n, return nxmit; } +static void ionic\_xdp\_rx\_put\_bufs(struct ionic\_queue \*q,+ struct ionic\_buf\_info \*buf\_info,+ int nbufs)+{+ int i;++ for (i = 0; i < nbufs; i++) {+ dma\_unmap\_page(q->dev, buf\_info->dma\_addr,+ IONIC\_PAGE\_SIZE, DMA\_FROM\_DEVICE);+ buf\_info->page = NULL;+ buf\_info++;+ }+}+ static bool ionic\_run\_xdp(struct ionic\_rx\_stats \*stats, struct net\_device \*netdev, struct bpf\_prog \*xdp\_prog,@@ -493,6 +507,7 @@ static bool ionic\_run\_xdp(struct ionic\_rx\_stats \*stats, struct netdev\_queue \*nq; struct xdp\_frame \*xdpf; int remain\_len;+ int nbufs = 1; int frag\_len; int err = 0; @@ -542,6 +557,7 @@ static bool ionic\_run\_xdp(struct ionic\_rx\_stats \*stats, if (page\_is\_pfmemalloc(bi->page)) xdp\_buff\_set\_frag\_pfmemalloc(&xdp\_buf); } while (remain\_len > 0);+ nbufs += sinfo->nr\_frags; }  xdp\_action = bpf\_prog\_run\_xdp(xdp\_prog, &xdp\_buf);@@ -574,9 +590,6 @@ static bool ionic\_run\_xdp(struct ionic\_rx\_stats \*stats, goto out\_xdp\_abort; } - dma\_unmap\_page(rxq->dev, buf\_info->dma\_addr,- IONIC\_PAGE\_SIZE, DMA\_FROM\_DEVICE);- err = ionic\_xdp\_post\_frame(txq, xdpf, XDP\_TX, buf\_info->page, buf\_info->page\_offset,@@ -586,23 +599,19 @@ static bool ionic\_run\_xdp(struct ionic\_rx\_stats \*stats, netdev\_dbg(netdev, "tx ionic\_xdp\_post\_frame err %d\n", err); goto out\_xdp\_abort; }- buf\_info->page = NULL;+ ionic\_xdp\_rx\_put\_bufs(rxq, buf\_info, nbufs); stats->xdp\_tx++;  /\* the Tx completion will free the buffers \*/ break;  case XDP\_REDIRECT:- /\* unmap the pages before handing them to a different device \*/- dma\_unmap\_page(rxq->dev, buf\_info->dma\_addr,- IONIC\_PAGE\_SIZE, DMA\_FROM\_DEVICE);- err = xdp\_do\_redirect(netdev, &xdp\_buf, xdp\_prog); if (err) { netdev\_dbg(netdev, "xdp\_do\_redirect err %d\n", err); goto out\_xdp\_abort; }- buf\_info->page = NULL;+ ionic\_xdp\_rx\_put\_bufs(rxq, buf\_info, nbufs); rxq->xdp\_flush = true; stats->xdp\_redirect++; break; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:24:56 +0000



=== Content from git.kernel.org_8a92b82a_20250111_152619.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8ae401525ae84228a8986bb369224a6224e4d22f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8ae401525ae84228a8986bb369224a6224e4d22f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8ae401525ae84228a8986bb369224a6224e4d22f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ae401525ae84228a8986bb369224a6224e4d22f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Taehee Yoo <ap420073@gmail.com> | 2024-06-20 10:58:08 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-05 09:37:52 +0200 |
| commit | [8ae401525ae84228a8986bb369224a6224e4d22f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8ae401525ae84228a8986bb369224a6224e4d22f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8ae401525ae84228a8986bb369224a6224e4d22f)) | |
| tree | [58bc6bc9de3f1b567540e364ef9a56fae75f7213](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8ae401525ae84228a8986bb369224a6224e4d22f) | |
| parent | [17a3d0d4dc6cf127119f5c2dc714d64b7b517f80](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=17a3d0d4dc6cf127119f5c2dc714d64b7b517f80) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ae401525ae84228a8986bb369224a6224e4d22f&id2=17a3d0d4dc6cf127119f5c2dc714d64b7b517f80)) | |
| download | [linux-8ae401525ae84228a8986bb369224a6224e4d22f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8ae401525ae84228a8986bb369224a6224e4d22f.tar.gz) | |

ionic: fix kernel panic due to multi-buffer handling[ Upstream commit e3f02f32a05009a688a87f5799e049ed6b55bab5 ]
Currently, the ionic\_run\_xdp() doesn't handle multi-buffer packets
properly for XDP\_TX and XDP\_REDIRECT.
When a jumbo frame is received, the ionic\_run\_xdp() first makes xdp
frame with all necessary pages in the rx descriptor.
And if the action is either XDP\_TX or XDP\_REDIRECT, it should unmap
dma-mapping and reset page pointer to NULL for all pages, not only the
first page.
But it doesn't for SG pages. So, SG pages unexpectedly will be reused.
It eventually causes kernel panic.
Oops: general protection fault, probably for non-canonical address 0x504f4e4dbebc64ff: 0000 [#1] PREEMPT SMP NOPTI
CPU: 3 PID: 0 Comm: swapper/3 Not tainted 6.10.0-rc3+ #25
RIP: 0010:xdp\_return\_frame+0x42/0x90
Code: 01 75 12 5b 4c 89 e6 5d 31 c9 41 5c 31 d2 41 5d e9 73 fd ff ff 44 8b 6b 20 0f b7 43 0a 49 81 ed 68 01 00 00 49 29 c5 49 01 fd <41> 80 7d0
RSP: 0018:ffff99d00122ce08 EFLAGS: 00010202
RAX: 0000000000005453 RBX: ffff8d325f904000 RCX: 0000000000000001
RDX: 00000000670e1000 RSI: 000000011f90d000 RDI: 504f4e4d4c4b4a49
RBP: ffff99d003907740 R08: 0000000000000000 R09: 0000000000000000
R10: 000000011f90d000 R11: 0000000000000000 R12: ffff8d325f904010
R13: 504f4e4dbebc64fd R14: ffff8d3242b070c8 R15: ffff99d0039077c0
FS: 0000000000000000(0000) GS:ffff8d399f780000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f41f6c85e38 CR3: 000000037ac30000 CR4: 00000000007506f0
PKRU: 55555554
Call Trace:
<IRQ>
? die\_addr+0x33/0x90
? exc\_general\_protection+0x251/0x2f0
? asm\_exc\_general\_protection+0x22/0x30
? xdp\_return\_frame+0x42/0x90
ionic\_tx\_clean+0x211/0x280 [ionic 15881354510e6a9c655c59c54812b319ed2cd015]
ionic\_tx\_cq\_service+0xd3/0x210 [ionic 15881354510e6a9c655c59c54812b319ed2cd015]
ionic\_txrx\_napi+0x41/0x1b0 [ionic 15881354510e6a9c655c59c54812b319ed2cd015]
\_\_napi\_poll.constprop.0+0x29/0x1b0
net\_rx\_action+0x2c4/0x350
handle\_softirqs+0xf4/0x320
irq\_exit\_rcu+0x78/0xa0
common\_interrupt+0x77/0x90
Fixes: 5377805dc1c0 ("ionic: implement xdp frags support")
Signed-off-by: Taehee Yoo <ap420073@gmail.com>
Reviewed-by: Shannon Nelson <shannon.nelson@amd.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ae401525ae84228a8986bb369224a6224e4d22f)

| -rw-r--r-- | [drivers/net/ethernet/pensando/ionic/ionic\_txrx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/pensando/ionic/ionic_txrx.c?id=8ae401525ae84228a8986bb369224a6224e4d22f) | 27 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 18 insertions, 9 deletions

| diff --git a/drivers/net/ethernet/pensando/ionic/ionic\_txrx.c b/drivers/net/ethernet/pensando/ionic/ionic\_txrx.cindex 2427610f4306d9..aed7d9cbce038f 100644--- a/[drivers/net/ethernet/pensando/ionic/ionic\_txrx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/pensando/ionic/ionic_txrx.c?id=17a3d0d4dc6cf127119f5c2dc714d64b7b517f80)+++ b/[drivers/net/ethernet/pensando/ionic/ionic\_txrx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/pensando/ionic/ionic_txrx.c?id=8ae401525ae84228a8986bb369224a6224e4d22f)@@ -480,6 +480,20 @@ int ionic\_xdp\_xmit(struct net\_device \*netdev, int n, return nxmit; } +static void ionic\_xdp\_rx\_put\_bufs(struct ionic\_queue \*q,+ struct ionic\_buf\_info \*buf\_info,+ int nbufs)+{+ int i;++ for (i = 0; i < nbufs; i++) {+ dma\_unmap\_page(q->dev, buf\_info->dma\_addr,+ IONIC\_PAGE\_SIZE, DMA\_FROM\_DEVICE);+ buf\_info->page = NULL;+ buf\_info++;+ }+}+ static bool ionic\_run\_xdp(struct ionic\_rx\_stats \*stats, struct net\_device \*netdev, struct bpf\_prog \*xdp\_prog,@@ -493,6 +507,7 @@ static bool ionic\_run\_xdp(struct ionic\_rx\_stats \*stats, struct netdev\_queue \*nq; struct xdp\_frame \*xdpf; int remain\_len;+ int nbufs = 1; int frag\_len; int err = 0; @@ -542,6 +557,7 @@ static bool ionic\_run\_xdp(struct ionic\_rx\_stats \*stats, if (page\_is\_pfmemalloc(bi->page)) xdp\_buff\_set\_frag\_pfmemalloc(&xdp\_buf); } while (remain\_len > 0);+ nbufs += sinfo->nr\_frags; }  xdp\_action = bpf\_prog\_run\_xdp(xdp\_prog, &xdp\_buf);@@ -574,9 +590,6 @@ static bool ionic\_run\_xdp(struct ionic\_rx\_stats \*stats, goto out\_xdp\_abort; } - dma\_unmap\_page(rxq->dev, buf\_info->dma\_addr,- IONIC\_PAGE\_SIZE, DMA\_FROM\_DEVICE);- err = ionic\_xdp\_post\_frame(txq, xdpf, XDP\_TX, buf\_info->page, buf\_info->page\_offset,@@ -586,23 +599,19 @@ static bool ionic\_run\_xdp(struct ionic\_rx\_stats \*stats, netdev\_dbg(netdev, "tx ionic\_xdp\_post\_frame err %d\n", err); goto out\_xdp\_abort; }- buf\_info->page = NULL;+ ionic\_xdp\_rx\_put\_bufs(rxq, buf\_info, nbufs); stats->xdp\_tx++;  /\* the Tx completion will free the buffers \*/ break;  case XDP\_REDIRECT:- /\* unmap the pages before handing them to a different device \*/- dma\_unmap\_page(rxq->dev, buf\_info->dma\_addr,- IONIC\_PAGE\_SIZE, DMA\_FROM\_DEVICE);- err = xdp\_do\_redirect(netdev, &xdp\_buf, xdp\_prog); if (err) { netdev\_dbg(netdev, "xdp\_do\_redirect err %d\n", err); goto out\_xdp\_abort; }- buf\_info->page = NULL;+ ionic\_xdp\_rx\_put\_bufs(rxq, buf\_info, nbufs); rxq->xdp\_flush = true; stats->xdp\_redirect++; break; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:24:56 +0000


