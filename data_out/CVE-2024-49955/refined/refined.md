Based on the provided content, here's the vulnerability information:

**CVE-2024-49955**

*   **Root cause:** A double-free vulnerability exists in the ACPI battery driver. When a battery hook returns an error during the addition of a new battery, the hook is automatically unregistered. However, the battery hook provider is unaware of this and may subsequently attempt to unregister the same hook, leading to a crash.
*   **Weaknesses/vulnerabilities:**
    *   **Double Free**: The core issue lies in the potential for `battery_hook_unregister()` to be called on an already unregistered hook. This happens because the hook is automatically unregistered on error, and the caller isn't notified to avoid a second unregister attempt.
*   **Impact of exploitation:** A crash can occur due to the double free. This can result in a denial of service.
*  **Attack vectors:** The vulnerability is triggered when a battery hook returns an error during battery addition. This leads to the hook being automatically unregistered, and a subsequent call to `battery_hook_unregister()` on the same hook causes the crash.
*   **Required attacker capabilities/position:** An attacker would need to be able to trigger the error condition during the addition of a new battery such that a battery hook returns an error, and also control the execution to call `battery_hook_unregister()` on the same hook.

**Additional Notes:**
*   The fix involves modifying the `battery_hook_unregister_unlocked` function to use `list_del_init(&hook->list)` instead of `list_del(&hook->list)`, and adding a check in `battery_hook_unregister` to see if the list is empty. This prevents double unregistration by initializing the list head upon first unregistration, and ignoring further unregistration attempts on the already unregistered hook based on the list status.
*   The vulnerability is present due to the fact that `battery_hook_unregister` is called without checking if unregistration has already been performed implicitly on an error condition.
*   The fix is backported to multiple stable branches.