=== Content from bugbounty.tillitis.se_cc20b048_20250110_161120.html ===


* [About](https://bugbounty.tillitis.se/about/)
* [Contact](https://bugbounty.tillitis.se/contact/)
  [![Tillitis](https://bugbounty.tillitis.se/content/themes/tillitis/src/img/tillitis_blue.svg)](/)    Menu

* [Bounty](https://bugbounty.tillitis.se/)
* [Security Bulletins](https://bugbounty.tillitis.se/security-bulletins/)
* [Threat Model](https://tillitis.se/products/threat-model/)
* [Hall of Fame](https://bugbounty.tillitis.se/hall-of-fame/)
* [tillitis.se](https://tillitis.se)

* [Bounty](https://bugbounty.tillitis.se/)
* [Security Bulletins](https://bugbounty.tillitis.se/security-bulletins/)
* [Threat Model](https://tillitis.se/products/threat-model/)
* [Hall of Fame](https://bugbounty.tillitis.se/hall-of-fame/)
* [tillitis.se](https://tillitis.se)
 [Buy](https://shop.tillitis.se)

---

* [About](https://bugbounty.tillitis.se/about/)
* [Contact](https://bugbounty.tillitis.se/contact/)
# Tillitis Security Bulletin 240115-1

## Summary

Severity: Low.

A vulnerability has been found in [tkey-device-signer](https://github.com/tillitis/tkey-device-signer) and [verisigner](https://github.com/tillitis/tkey-verification) that makes it possible to disclose portions of the TKey’s data in RAM over the USB interface. To exploit the vulnerability an attacker needs to use a custom client application and to touch the TKey.

The [threat model](https://tillitis.se/products/threat-model/) defines a set of assets, attack types and threat actors.
This vulnerability analysis shows that the attack is of software type and,

* a threat actor can read portions of RAM content, but no sensitive assets, from a device that runs tkey-device-signer or verisigner that have been compiled by [Tillitis](https://tillitis.se/download/).
* a skilled threat actor\* could potentially read out asset information from a device that runs tkey-device-signer or verisigner that have been compiled by other parties and generates a different SHA512 digest, see [reproducible builds](#reproducible-builds) below.

\**type 1, 2 or 3 as defined in the threat model.*

## User action

Tillitis recommends:

* Update any client application\* that uses verisigner to [tkey-device-signer version 1.0.0](https://github.com/tillitis/tkey-device-signer/releases). verisigner is being deprecated.
* Update any client application\* that uses [tkey-device-signer](https://github.com/tillitis/tkey-device-signer) to version 1.0.0.
* If you are building tkey-device-signer from source code, Tillitis recommends using the provided [OCI image](https://dev.tillitis.se/tools/#toolchain-container-tkey-builder).

\*Custom client applications using tkey-device-signer are also recommended to be updated.

**Note:** Updating the device application changes the identity, meaning that the Ed25519 key pair also changes. All services using your current identity need to be updated with the new identity. See this [guide](https://tillitis.se/guides/guide-migrating-to-new-version-of-tkey-ssh-agent/).

## Affected applications

All client applications running tkey-device-signer version 0.0.7 and 0.0.8.
From Tillitis this includes:

* tkey-ssh-agent v0.0.6 and earlier
  embedding tkey-device-signer v0.0.7
* tkey-sign-cli v0.0.8
  embedding tkey-device-signer v0.0.8

All client applications running verisigner v0.0.3 and earlier.
From Tillitis this includes:

* tkey-verification v0.0.2.
  embedding verisigner v0.0.3.

## Patching

The following release contain security updates that address the vulnerability described in this bulletin:

* [tkey-device-signer, v1.0.0](https://github.com/tillitis/tkey-device-signer/releases)

The following client applications are updated to embed tkey-device-signer v1.0.0:

* [tkey-ssh-agent, v1.0.0](https://github.com/tillitis/tkey-ssh-agent/releases)
* [tkey-sign-cli, v1.0.0](https://github.com/tillitis/tkey-sign-cli/releases)
* tkey-verification, v1.0.0 (see [GitHub repository](https://github.com/tillitis/tkey-verification) for release status)

For user compiled applications, see section [Reproducible builds](#reproducible-builds) below.

**Note:** verisigner is going to be deprecated in favor of using tkey-device-signer v1.0.0 in the forthcoming tkey-verification v1.0.0.

## Technical details

The vulnerability is of type CWE-367: Time-of-check Time-of-use (TOCTOU). If this is exploited it allows for a CWE-125: Out-of-bounds Read.

An exploit is made by setting an increasingly larger size of the message to sign (using CMD\_SET\_SIZE) and relying on the TOCTOU bug to get additional data in the message.

First the message size is set to 4096 bytes (maximum size), then immediately a new message size of 4097 bytes is set. The device app will return an error but still use the new size (4097). Another variable that keeps track of what is left to be sent by the client keeps the old value (4096).

When 4096 bytes of data is sent from client to TKey, this creates a signature of the sent data plus the extra byte in memory according to the new message size (4097). Repeating this method again, but using a size of 4098 bytes, will include yet another byte of RAM in the signature. This is continued with 4099, 4100, …

The signature returned is computed over an unknown byte every time. One can iterate over every possible value of the last byte (brute forcing) and do a signature verification. When the signature verifies correctly the unknown byte is revealed.

Eventually the signing operation’s own memory is part of the message to sign. The message itself will change during the signing operation, making it much harder and probably impossible to produce verifiable signatures over a known message. This stops the exploit.

### The signing context stops the exploit

There are a few interesting assets in RAM:

1. The message, since this is the start of the data included in the signature.
2. The private key.
3. The context of the signing operation.

The locations in memory are:

| **Version** | **location of message** | **location of private key** | **location of signing context** |
| --- | --- | --- | --- |
| 0.0.7, verisigner-v0.0.3 | message = 0x4001ec20 | local\_cdi = 0x4001ebc0 | ctx = 0x4001fd40 |
| 0.0.8 | message =0x4001ee98 | secret\_key = 0x4001edf8 | r = 0x4001ebe0\* |

\*location of the variable r , which is part of the signing context.

The memory visualized for v0.0.7 and verisigner-0.0.3:

```

--------------------------- <--- 0x40020000
| STACK                   |
| ..                      |
| Signing context         | <--- An exploit stops here
| ..                      |
| message ↑               | <--- start of exploit, grows
| ..                      |       towards higher addresses
|                         |
| Private key             |
| ..                      |
| - - - - - - - - - - - - |
| ..                      |
|                         |
| Unused area,            |
| randomized at power up  |
|                         |
| ..                      |
| - - - - - - - - - - - - |
| APP                     |
--------------------------- <--- 0x40000000
```

The memory visualized for v0.0.8:

```

--------------------------- <--- 0x40020000
| STACK                   |
| ..                      |
| message ↑               | <--- start of exploit, grows
| ..                      |       towards higher addresses                                        |                         |
| Private key             |
| ..                      |
| Signing context         | <--- An exploit stops here
| ..                      |
| - - - - - - - - - - - - |
| ..                      |
|                         |
| Unused area,            |
| randomized at power up  |
|                         |
| ..                      |
| - - - - - - - - - - - - |
| APP                     | <--- Wraps and continue to read upwards
--------------------------- <--- 0x40000000
```

The message buffer contains the data to be signed and grows towards higher addresses, so the out-of-bounds read occur on addresses above the message buffer’s end. In order to include the private key in the signing operation, all the previous content in RAM needs to be leaked first.

The signing context is located in between the message and the private key for all versions, v0.0.7, v0.0.8, and verisigner-v0.0.3. The difference in v0.0.8 is the need to wrap around and continue to read from the start of RAM. The possibility to wrap around and continue to read from the beginning of RAM is an unwanted behavior in the FPGA design. This is addressed in release [TK1-2024.03](https://github.com/tillitis/tillitis-key1/releases/tag/TK1-24.03).

The location of the signing context on the stack is crucial for stopping an exploit. The signing context is used by the Ed25519 signing operation to store intermediate calculations. In order to leak it you have to include the signing context as part of the message being signed. However, during the signing the message is used in two separate hash operations. Since the execution is in series this means that the context, which is included in the message to be signed, will change between these two function calls. This makes it impossible to create a valid signature over a known message.

The implementations differ, but the same operations are performed. The details below are from v0.0.8, but the same general idea applies for v0.0.7 and verisigner-v0.0.3.

When generating a signature the function call looks like this:

```
static void ed25519_dom_sign(u8 signature [64],
                             const u8 secret_key[32],
                             const u8 *dom, size_t dom_size,
                             const u8 *message,
                                          size_t message_size)
{
	u8 a[64];  // secret scalar and prefix
	u8 r[32];  // secret deterministic "random" nonce
	u8 h[32];  // publically verifiable hash of the
                      message (not wiped)
	u8 R[32];  // first half of the signature (allows
                      overlapping inputs)
	const u8 *pk = secret_key + 32;

	crypto_sha512(a, secret_key, 32);
	crypto_eddsa_trim_scalar(a, a);
	hash_reduce(r, dom, dom_size, a + 32, 32, message,                     message_size, 0, 0);
	crypto_eddsa_scalarbase(R, r);
	hash_reduce(h, dom, dom_size, R, 32, pk, 32, message,                     message_size);
	COPY(signature, R, 32);
	crypto_eddsa_mul_add(signature + 32, h, a, r);

	WIPE_BUFFER(a);
	WIPE_BUFFER(r);
}

```

The interesting section in this function is:

```
hash_reduce(r, dom, dom_size, a + 32, 32, message,
            message_size, 0, 0);
crypto_eddsa_scalarbase(R, r);
hash_reduce(h, dom, dom_size, R, 32, pk, 32, message,
            message_size);
```

The message, which is a pointer to a location on the stack, is used twice in order to calculate the signature. The variable r, which is of type u8 r[32], stores the return value of hash\_reduce() on the stack. This gives that, when the context is included in the message to be signed, the content of message will change before the next function call of hash\_reduce(). Also note that a, which is used in the first hash\_reduce(), is derived from the secret key so r cannot be considered guessable or known.

### Reproducible builds

The exploit is effectively stopped by the order of the data on the stack. C compilers don’t provide any guarantee for how the data is ordered, and can be vastly different depending on compiler, compiler version, and compiler optimization level.

Tillitis have reproducible builds and verification of both tkey-device-signer and verisigner in place, so the analysis above covers binaries built with other compiler versions as long as they have the same SHA512 digests. The digests are included in the repositories. The recommended way of building is to use the OCI image, [tkey-builder](https://dev.tillitis.se/tools/#toolchain-container-tkey-builder), with the right version for the device application’s tag. See the device applications’ documentation in the repositories for more information.

## Timeline

* January 15, 2024 – Tillitis receives the report through security@tillitis.se
* January 17, 2024 – Confirmed that an out-of-bounds read is possible.
* January 29, 2024 – Confirmed that this also affects verisigner in tkey-verification.
* March 25, 2024 – Released new version of hardware design with hardware RAM wraparound protection, TK1-24.03.
* April 16, 2024 – Released new versions of tkey-device-signer, including the TOCTOU fix and hardening with explicit protocol state machine, as well as official client apps using tkey-device-signer.

## Credits

We would like to thank the security researcher Sergei Volokitin of Hexplot, who discovered the vulnerability and reported it through our bug bounty program.

## Change log

2024-04-16 17:00 CEST: Initial publication

         ![Tillitis](https://bugbounty.tillitis.se/content/themes/tillitis/src/img/tillitis_white.svg)

Tillitis AB
 Ekelundsgatan 4
 411 18 Göteborg
 Sweden

hello@tillitis.se

 [Join one of our mailinglists](https://lists.tillitis.se/)

* [![](https://bugbounty.tillitis.se/content/themes/tillitis/src/img/matrix.svg) #tillitis:matrix.org](https://matrix.to/#/#tillitis:matrix.org)
* ![](https://bugbounty.tillitis.se/content/themes/tillitis/src/img/oftc.svg) #tillitis @ OFTC
* [![X / Twitter](https://bugbounty.tillitis.se/content/themes/tillitis/src/img/x.svg) tillitisab](https://twitter.com/TillitisAB)
* [![](https://bugbounty.tillitis.se/content/themes/tillitis/src/img/linkedin.svg) tillitis-ab/](https://www.linkedin.com/company/tillitis-ab/)
* [![Github](https://bugbounty.tillitis.se/content/themes/tillitis/src/img/github-mark-white.svg) tillitis](https://github.com/tillitis)
* [![Mastodon](https://bugbounty.tillitis.se/content/themes/tillitis/src/img/mastodon.svg) tillitis](https://mastodon.online/%40tillitis)
 ![Stay safe!](https://bugbounty.tillitis.se/content/themes/tillitis/src/img/ant_stay_safe.svg)

=== Content from github.com_3095cb82_20250110_161121.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftillitis%2Ftkey-device-signer%2Fsecurity%2Fadvisories%2FGHSA-frqc-62hv-379p)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftillitis%2Ftkey-device-signer%2Fsecurity%2Fadvisories%2FGHSA-frqc-62hv-379p)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=tillitis%2Ftkey-device-signer)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tillitis](/tillitis)
/
**[tkey-device-signer](/tillitis/tkey-device-signer)**
Public

* [Notifications](/login?return_to=%2Ftillitis%2Ftkey-device-signer) You must be signed in to change notification settings
* [Fork
  1](/login?return_to=%2Ftillitis%2Ftkey-device-signer)
* [Star
   1](/login?return_to=%2Ftillitis%2Ftkey-device-signer)

* [Code](/tillitis/tkey-device-signer)
* [Issues
  5](/tillitis/tkey-device-signer/issues)
* [Pull requests
  1](/tillitis/tkey-device-signer/pulls)
* [Actions](/tillitis/tkey-device-signer/actions)
* [Projects
  0](/tillitis/tkey-device-signer/projects)
* [Security](/tillitis/tkey-device-signer/security)
* [Insights](/tillitis/tkey-device-signer/pulse)

Additional navigation options

* [Code](/tillitis/tkey-device-signer)
* [Issues](/tillitis/tkey-device-signer/issues)
* [Pull requests](/tillitis/tkey-device-signer/pulls)
* [Actions](/tillitis/tkey-device-signer/actions)
* [Projects](/tillitis/tkey-device-signer/projects)
* [Security](/tillitis/tkey-device-signer/security)
* [Insights](/tillitis/tkey-device-signer/pulse)

# Possible RAM disclosure

Low

[SallSim](/SallSim)
published
GHSA-frqc-62hv-379p
Apr 23, 2024

## Package

tkey-sign-cli
(TKey client application)

## Affected versions

< 0.0.8

## Patched versions

1.0.0

tkey-ssh-agent
(TKey client application )

< 0.0.6

1.0.0

## Description

### Impact

A vulnerability has been found that makes it possible to disclose portions of the TKey’s data in RAM over the USB interface. To exploit the vulnerability an attacker needs to use a custom client application and to touch the TKey. No secret is disclosed.

### Patches

All client applications integrating tkey-device-signer should upgrade to version 1.0.0.

### Workarounds

There is no workaround.

### References

<https://bugbounty.tillitis.se/security-bulletins/tillitis-security-bulletin-240115-1/>

### Severity

Low

2.2

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
High

Privileges required
Low

User interaction
Required

Scope
Unchanged

Confidentiality
Low

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:H/PR:L/UI:R/S:U/C:L/I:N/A:N

### CVE ID

CVE-2024-32482

### Weaknesses

[CWE-125](/advisories?query=cwe%3A125) [CWE-367](/advisories?query=cwe%3A367)

### Credits

* [![@volokitinss](https://avatars.githubusercontent.com/u/2284156?s=40&v=4)](/volokitinss)
  [volokitinss](/volokitinss)
  Reporter
* [![@dehanj](https://avatars.githubusercontent.com/u/26005650?s=40&v=4)](/dehanj)
  [dehanj](/dehanj)
  Remediation verifier
* [![@mchack-work](https://avatars.githubusercontent.com/u/95036749?s=40&v=4)](/mchack-work)
  [mchack-work](/mchack-work)
  Remediation developer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


