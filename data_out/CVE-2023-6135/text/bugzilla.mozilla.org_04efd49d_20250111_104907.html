

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1853908)
* [XML](/show_bug.cgi?ctype=xml&id=1853908)

Closed
[Bug 1853908](/show_bug.cgi?id=1853908)
(CVE-2023-6135)

Opened 1 year ago
Closed 1 year ago

# Minerva attack on P-256 and P-384 in NSS

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Minerva attack on P-256 and P-384 in NSS

## Categories

### (NSS :: Libraries, defect, P1)

[Product:](/describecomponents.cgi?product=NSS)

NSS
▾

NSS
Network Security Services - a cross-platform
security library ([more info](http://www.mozilla.org/projects/security/pki/nss/))
[See Open Bugs in This Product](/buglist.cgi?product=NSS&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=NSS)
Watch This Product

[Component:](/describecomponents.cgi?product=NSS&component=Libraries#Libraries)

Libraries
▾

NSS :: Libraries
Libraries for client support of SSL v2 and v3, TLS, PKCS #5,
PKCS #7, PKCS #11, PKCS #12, S/MIME, X.509 v3 certificates,
and other security standards
[See Open Bugs in This Component](/buglist.cgi?product=NSS&component=Libraries&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=NSS&component=Libraries&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=NSS&component=Libraries)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

other

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

## Tracking

### (firefox-esr115 wontfix, firefox120 wontfix, firefox121 fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

3.95

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=wontfix) |
| firefox120 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox120&o1=equals&v1=wontfix) |
| firefox121 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr115 | --- | wontfix |
| firefox-esr128 | --- | --- |
| firefox120 |  | wontfix |
| firefox121 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gpantela, Assigned: jschanck)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/291ff310b7805a4159d7f46af196813e?d=mm&size=40)  [jschanck](/user_profile?user_id=689878)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/086bd981b6b3a9a29539de07445d5301?d=mm&size=40)  [gpantela](/user_profile?user_id=734632)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/38f561698d679a724938d4600c0f8b52?d=mm&size=40)  [beurdouche](/user_profile?user_id=622637)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

14 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1861728](/show_bug.cgi?id=1861728 "RESOLVED FIXED - Include P-256 Scalar Validation from HACL*"), [1863605](/show_bug.cgi?id=1863605 "RESOLVED FIXED - Include P-384 and P-521 Scalar Validation from HACL*")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1853908&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1853908)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-side-channel, reporter-external, sec-high, Whiteboard: [post-critsmash-triage][adv-main121+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2023-6135

[Keywords:](/describekeywords.cgi)

[csectype-side-channel](/buglist.cgi?keywords=csectype-side-channel&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main121+]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [avaida](/user_profile?user_id=488993) | [qe-verify](#a6547164_488993 "1 year ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files)

| [In this zip file there are 2 png images. One is called conf\_interval\_plot\_median\_before\_K\_generation and the other conf\_interval\_plot\_median\_K\_generation](/attachment.cgi?id=9353882)  [1 year ago](#c0)  [gpantela](/user_profile?user_id=734632)   80.59 KB, application/zip |  | [Details](/attachment.cgi?id=9353882&action=edit) |
| --- | --- | --- |
| [Minerva\_timing.zip](/attachment.cgi?id=9362322)  [1 year ago](#c11)  [gpantela](/user_profile?user_id=734632)   116.45 KB, application/octet-stream |  | [Details](/attachment.cgi?id=9362322&action=edit) |
| [conf\_interval\_plot\_all\_k\_sizes\_median\_0-10.png](/attachment.cgi?id=9364858)  [1 year ago](#c15)  [gpantela](/user_profile?user_id=734632)   53.41 KB, image/png |  | [Details](/attachment.cgi?id=9364858&action=edit) |
| [P-521.diff](/attachment.cgi?id=9365211)  [1 year ago](#c17)  [Alicja Kario](/user_profile?user_id=487652)   649.74 KB, patch |  | [Details](/attachment.cgi?id=9365211&action=edit) | [Diff](/attachment.cgi?id=9365211&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1853908&attachment=9365211) |
| [Plot of the amount of time need for nss to sign data with ecdsa. No side channel detected.](/attachment.cgi?id=9366886)  [1 year ago](#c19)  [gpantela](/user_profile?user_id=734632)   59.79 KB, image/png |  | [Details](/attachment.cgi?id=9366886&action=edit) |
| [advisory.txt](/attachment.cgi?id=9367976)  [1 year ago](#c21)  [Jason Kratzer [:jkratzer]](/user_profile?user_id=586683)   210 bytes, text/plain |  | [Details](/attachment.cgi?id=9367976&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [gpantela](/user_profile?user_id=734632)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1853908#c0)• 1 year ago |
|  | |

Attached file
[In this zip file there are 2 png images. One is called conf\_interval\_plot\_median\_before\_K\_generation and the other conf\_interval\_plot\_median\_K\_generation](attachment.cgi?id=9353882)
— [Details](attachment.cgi?id=9353882&action=edit)

Steps to reproduce:

My team and I have tested NSS and we found that it is vulnerable to the Minerva attack and we have now identified the first piece of code that contributes to the side channel.

The test scenario is that we are signing random messages using the SEC\_SignData API and then using the private key to extract the K value from the signatures. Then based on the bit size of the extracted nonce we compare full-sized nonces to smaller ones and use the statistical tests to compare the signature times.

Actual results:

Now we have executed the test to verify that all the code from SEC\_SignData up to line <https://github.com/nss-dev/nss/blob/master/lib/freebl/ec.c#L978> is not leaky and then we have verified that the code in lines <https://github.com/nss-dev/nss/blob/master/lib/freebl/ec.c#L979-L986> does leak. We suspect that the side channel is caused by the fact that K is an MPI object, and thus subject to normalization (automatic memory management based on bit size). You can see the results of the analysis below.

For testing, we built nss statically from hg and used the master checkout from 2023-09-14 for both nss and nspr.

The result in the attachment namedconf\_interval\_plot\_median\_before\_K\_generation.png represents code from SEC\_SignData up to line 978 of file lib/freebl/ec.c and as you can see in this code there is no leak found. The sample tested has 102,723,896 observations.

The result in the attachment named conf\_interval\_plot\_median\_K\_generation.png represents code from line 979 to line 986 in file lib/freebl/ec.c and we can clearly see that there is a leak: there is a clear dependency between the bit size of K and the size of the side channel. The sample tested has 129,438,263 observations.

Because we have identified this piece of code as leaky we won't be able to exclude the possibility of a side-channel in the subsequent code. We will need to run the test again after the leaking piece of code is fixed to be able to verify that NSS is not valuable to Minerva anymore (overall we have found a side-channel of ~50 ns and in the k-generating piece of code is only ~45 ns, although the extra 5 ns could be the effect of this piece of code not being side-channel free on the subsequent signature code).

Expected results:

The code should have no side-channels.

|  | [Dana Keeler (she/her) (use needinfo) [:keeler]](/user_profile?user_id=349244) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1853908#a10659_349244)• 1 year ago |

Component: Tools → Libraries

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1853908#a118665_1689)• 1 year ago |

Flags: needinfo?(bbeurdouche)

|  | [Benjamin Beurdouche [:beurdouche]](/user_profile?user_id=622637) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1853908#a177836_622637)• 1 year ago |

Flags: needinfo?(bbeurdouche)

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1853908#c1)• 1 year ago |
|  | |

Thanks for this report. We're working on a fix.

Severity: -- → S2Status: UNCONFIRMED → NEWEver confirmed: truePriority: -- → P2

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1853908#c2)• 1 year ago |
|  | |

John: how bad is this attack for Firefox users in practice? sec-high? sec-moderate?

Flags: needinfo?(jschanck)

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1853908#c3)• 1 year ago |
|  | |

This code is accessible from WebCrypto and ipcclientcerts, so Firefox is affected. A 50ns difference is going to be difficult to observe over the network. However, reliable observation leads to the disclosure of signing keys, so I think it's a sec-high.

Flags: needinfo?(jschanck)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1853908#a2364055_406194)• 1 year ago |

Keywords: [csectype-side-channel](/buglist.cgi?keywords=csectype-side-channel&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1853908#c4)• 1 year ago |
|  | |

Our partners at Cryspen are going to fix this. I'm self-assigning as they don't have access to sec bugs, and the patch will not be attached to this bug.

Assignee: nobody → jschanckStatus: NEW → ASSIGNEDPriority: P2 → P1

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1853908#c5)• 1 year ago |
|  | |

This is being handled as part of ongoing work on integrating formally verified implementations of the NIST P-curves into NSS ([Bug 1615555](/show_bug.cgi?id=1615555 "RESOLVED FIXED - Integration of HACL* P-256"), [Bug 1854438](/show_bug.cgi?id=1854438 "RESOLVED FIXED - Integrate HACL* P-384"), [Bug 1854439](/show_bug.cgi?id=1854439 "RESOLVED FIXED - Integrate HACL* P-521")), which will be finished soon.

|  | [Alicja Kario](/user_profile?user_id=487652) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1853908#c6)• 1 year ago |
|  | |

@John, but we've tested the P-256 code *after* <https://hg.mozilla.org/projects/nss/rev/88262a8e60126b5168d0b96306ed5fd2de4867bb> was merged...

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1853908#c7)• 1 year ago |
|  | |

It's being done as part of that line of work. The fix is not part of that patch.

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1853908#a3307672_689878)• 1 year ago |

Depends on: [1861728](/show_bug.cgi?id=1861728 "RESOLVED FIXED - Include P-256 Scalar Validation from HACL*")

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1853908#c8)• 1 year ago |
|  | |

Hubert, the fix for P-256 has been merged to NSS trunk <https://hg.mozilla.org/projects/nss/rev/e68b42b773657000078d104aaccbe26e71a1e0be>.

Depends on: [1854438](/show_bug.cgi?id=1854438 "RESOLVED FIXED - Integrate HACL* P-384"), [1854439](/show_bug.cgi?id=1854439 "RESOLVED FIXED - Integrate HACL* P-521")

|  | [Robert Relyea](/user_profile?user_id=11099) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1853908#c9)• 1 year ago |
|  | |

re [comment 8](/show_bug.cgi?id=1853908#c8 "RESOLVED FIXED - Minerva attack on P-256 and P-384 in NSS"): That looks like the code that we thought was the issue.

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1853908#c10)• 1 year ago |
|  | |

It seems likely that Cryspen won't have the other curves ready in time for the next NSS release. So I'll write patches for those.

@gpantela, I'd like to confirm our fix for P-256 and also evaluate the size of the side channel for the other curves. Could you share your timing code?

Flags: needinfo?(gpantela)

|  | [gpantela](/user_profile?user_id=734632)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1853908#c11)• 1 year ago |
|  | |

Attached file
[Minerva\_timing.zip](attachment.cgi?id=9362322)
— [Details](attachment.cgi?id=9362322&action=edit)

Hello, I am attaching Minerva\_timing.zip which includes result graphs from the fix on NIST256p and the requested scripts.

For the scripts, there is a readme.md file that explains how to use them.

To elaborate more on the fix. Unfortunately, we do not have enough data yet to say with absolute certainty that the side channel was eliminated completely but the side channel was reduced after the fix to single-digit ns. This means that the fix is improving the situation. We will continue to collect the data and will provide you with additional information later. When you do have the patches for NIST384p and NIST521p feel free to send them to us so we can test them.

Flags: needinfo?(gpantela)

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1853908#a4261757_689878)• 1 year ago |

Depends on: [1863605](/show_bug.cgi?id=1863605 "RESOLVED FIXED - Include P-384 and P-521 Scalar Validation from HACL*")

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1853908#c12)• 1 year ago |
|  | |

Thanks! I've attached a patch for P-384 and P-521 to [Bug 1863605](/show_bug.cgi?id=1863605 "RESOLVED FIXED - Include P-384 and P-521 Scalar Validation from HACL*").

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1853908#c13)• 1 year ago |
|  | |

The patch for P-384 and P-521 has landed in NSS trunk. I'm confident, from inspection of the code and from the timing tests, that there's no longer a network observable timing side-channel here.

Status: ASSIGNED → RESOLVEDClosed: 1 year agoResolution: --- → FIXED

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1853908#a4440559_689878)• 1 year ago |

No longer depends on: [1854438](/show_bug.cgi?id=1854438 "RESOLVED FIXED - Integrate HACL* P-384"), [1854439](/show_bug.cgi?id=1854439 "RESOLVED FIXED - Integrate HACL* P-521")

|  | [gpantela](/user_profile?user_id=734632)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1853908#a4499476_734632)• 1 year ago |

Status: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [Alicja Kario](/user_profile?user_id=487652) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1853908#c14)• 1 year ago |
|  | |

1. testing for P-256 is not finished
2. This is a security issue, we need a CVE assigned
3. We even haven't started testing P-384 or P-521

So, no, I don't think we can consider Minerva to be done and finished as a topic.

Flags: needinfo?(jschanck)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1853908#a4870154_578488)• 1 year ago |

Alias: CVE-2023-6135

|  | [gpantela](/user_profile?user_id=734632)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1853908#c15)• 1 year ago |
|  | |

Attached image
[conf\_interval\_plot\_all\_k\_sizes\_median\_0-10.png](attachment.cgi?id=9364858)
— [Details](attachment.cgi?id=9364858&action=edit)

Hello,

We have tested the fixed version on P-521 and we found out that the fix did NOT work fully. It has definitely helped the side channel's size but the side channel is still there. Also in the P-521 curve, there is a "step" from 513 to 512 that needs a bit more attention.

I am attaching a graph with the first 10 nonce sizes that show the side channels and the "step".

Thank you very much for all your time and efforts!

For reference, the p-values of the first 10 nonce sizes are:

K size of 521: n=25992110, pvalue=0.1773705822345769

K size of 520: n=118800233, pvalue=1.1532642817636213e-06

K size of 519: n=69254593, pvalue=0.0006259390728389119

K size of 518: n=37681393, pvalue=7.724653206901568e-09

K size of 517: n=19696178, pvalue=5.492816419730179e-06

K size of 516: n=10082674, pvalue=7.63628467844954e-08

K size of 515: n=5092416, pvalue=0.6586284140275034

K size of 514: n=2561652, pvalue=0.9357608648292923

K size of 513: n=1284527, pvalue=0.04931945934013337

K size of 512: n=642243, pvalue=8.043381228577995e-05

K size of 511: n=322084, pvalue=0.07956264294715022

For any questions feel free to contact us!

Sincerely,

George and Hubert

|  | [gpantela](/user_profile?user_id=734632)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1853908#c16)• 1 year ago |
|  | |

As a follow-up to the previous comment:

The version we tested was the head of mercurial on 15/11/2023. It seems to us that the patches for P-384 and P-521 are not integrated completely. There are some changes but the code from bugs 1854438, and 1854439 is not there yet. We tried to apply the patches but they were not applied cleanly. Perhaps a rebase if needed to apply the patches. When you do rebase, we can retest it to verify that the side channels are eliminated before it is merged.

|  | [Alicja Kario](/user_profile?user_id=487652) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1853908#c17)• 1 year ago |
|  | |

Attached patch

[P-521.diff](attachment.cgi?id=9365211&action=diff)
— [Details](attachment.cgi?id=9365211&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1853908&attachment=9365211)

Since we're most worried about P-521 (as the non multiple of 64 size makes implementation tricky), I've done a quick rebase of the patch from [bug 1854439](/show_bug.cgi?id=1854439 "RESOLVED FIXED - Integrate HACL* P-521"). We'll start testing it.

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1853908#c18)• 1 year ago |
|  | |

Thanks for the update. We are aware of timing side-channels in the existing P-384 and P-521 code, and we're also aware of timing side-channels in the work-in-progress replacements from [Bug 1854438](/show_bug.cgi?id=1854438 "RESOLVED FIXED - Integrate HACL* P-384") and [Bug 1854439](/show_bug.cgi?id=1854439 "RESOLVED FIXED - Integrate HACL* P-521"). The Cryspen team is working on resolving the known issues and plans to have those patches ready early next year.

Given the very low prevalence of P-521 in deployment, and the fact that the timing side-channel is visible in only 1 in 512 nonces, I would not rank the remaining defect as a sec-high. It's important to track that there was a sec-high for P-256 here, so I'm going to split the remaining P-521 defect off into a new bug ([Bug 1866848](/show_bug.cgi?id=1866848 "REOPENED")). Feel free to split P-384 off into a new bug if you find that you are still able to detect a side-channel.

Status: REOPENED → RESOLVEDClosed: 1 year ago → 1 year agoFlags: needinfo?(jschanck)Resolution: --- → FIXEDSummary: Minerva attack on NSS → Minerva attack on P-256 and P-384 in NSS

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1853908#a5992117_75935)• 1 year ago |

Group: crypto-core-security → core-security-release
[status-firefox120](/buglist.cgi?f1=cf_status_firefox120&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox120&o1=equals&v1=wontfix)
[status-firefox121](/buglist.cgi?f1=cf_status_firefox121&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=fixed)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=wontfix)Target Milestone: --- → 3.95

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1853908#a6547164_488993)• 1 year ago |

Flags: qe-verify-Whiteboard: [post-critsmash-triage]

|  | [gpantela](/user_profile?user_id=734632)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1853908#c19)• 1 year ago |
|  | |

Attached image
[Plot of the amount of time need for nss to sign data with ecdsa. No side channel detected.](attachment.cgi?id=9366886)
— [Details](attachment.cgi?id=9366886&action=edit)

Hello, my team and I have gathered 701,794,739 samples of singing with NSS ECDSA keys and we can verify that the fix for the NIST256p curve eliminated the side channel in x86\_64 architecture.

Also, attaching a plot that shows that there is no visible side channel.

|  | [gpantela](/user_profile?user_id=734632)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1853908#c20)• 1 year ago |
|  | |

Follow up on [Comment 19](/show_bug.cgi?id=1853908#c19 "RESOLVED FIXED - Minerva attack on P-256 and P-384 in NSS"):

The version of NSS tested was commit 3e25d69ba6b2 for nspr and 46a7d596d718 for nss. Default branch. The gatherer run on 28-11-2023.

|  | [Jason Kratzer [:jkratzer]](/user_profile?user_id=586683) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1853908#a7179229_586683)• 1 year ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main121+]

|  | [Jason Kratzer [:jkratzer]](/user_profile?user_id=586683) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1853908#c21)• 1 year ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9367976)
— [Details](attachment.cgi?id=9367976&action=edit)

|  | [Mike Hommey [:glandium]](/user_profile?user_id=47192) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1853908#c22)• 1 year ago |
|  | |

This CVE is not listed on <https://www.mozilla.org/en-US/security/known-vulnerabilities/nss/>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1853908#c23)• 9 months ago |
|  | |

Bulk-unhiding security bugs fixed in Firefox 119-121 (Fall 2023). Use "moo-doctrine-subsidy" to filter

Group: core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1853908#c24)• 7 months ago |
|  | |

Sorry for the burst of bugspam: filter on tinkling-glitter-filtrate

Adding `reporter-external` keyword to security bugs found by non-employees for accounting reasons

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1853908&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [gpantela](/user_profile?user_id=734632)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

