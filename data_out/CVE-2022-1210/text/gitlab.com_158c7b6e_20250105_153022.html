

[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Tiff conversion to PS crashed due to incorrect memory size request

OS: ubuntu 20.04

LIBTIFF, Version 4.3.0

Command: ./tiff2ps -2 -a Poc.tiff

POC:
[![example](data:image/gif;base64...)](/-/project/4720790/uploads/c3da94e53cf1e1e8e6d4d3780dc8c42f/example.tiff)

ASAN Report:
==1860246==ERROR: AddressSanitizer: allocator is out of memory trying to allocate 0x2000000000 bytes
#0 0x499d1d in \_\_interceptor\_malloc (/home/user/libtiff/tools/.libs/tiff2ps+0x499d1d)
[#1 (closed)](/libtiff/libtiff/-/issues/1 "[BZ#1893] tiff2pdf produce unreadable file if TIFF is compressed with JPEG") 0x7ffff7a46193 in \_init (/lib/x86\_64-linux-gnu/libjbig.so.0+0x1193)
[#2 (closed)](/libtiff/libtiff/-/issues/2 "[BZ#1941] Win64 problem with tif_win32.c's TIFFOpen() use of HANDLE (w/patch)") 0x7ffff7db3407 (/home/user/libtiff/libtiff/.libs/libtiff.so.5+0x3407)

==1860246==HINT: if you don't care about these errors you may set allocator\_may\_return\_null=1
SUMMARY: AddressSanitizer: out-of-memory (/home/user/libtiff/tools/.libs/tiff2ps+0x499d1d) in \_\_interceptor\_malloc
==1860246==ABORTING

---

Crashing thread backtrace:

#0 0x00007ffff78bb03b in \_\_GI\_raise (/lib/x86\_64-linux-gnu/libc.so.6)
at ../sysdeps/unix/sysv/linux/raise.c:50

[#1 (closed)](/libtiff/libtiff/-/issues/1 "[BZ#1893] tiff2pdf produce unreadable file if TIFF is compressed with JPEG") 0x00007ffff789a859 in \_\_GI\_abort (/lib/x86\_64-linux-gnu/libc.so.6)
at abort.c:79

[#2 (closed)](/libtiff/libtiff/-/issues/2 "[BZ#1941] Win64 problem with tif_win32.c's TIFFOpen() use of HANDLE (w/patch)") 0x00007ffff7c5d1a3 in /lib/x86\_64-linux-gnu/libjbig.so.0

[#3 (closed)](/libtiff/libtiff/-/issues/3 "[BZ#1960] tiff2pdf: Line shift in right tiff tiles of output pdf (if jpeg compressed tiles in input tiff)") 0x00007ffff7c62803 in jbg\_dec\_in (/lib/x86\_64-linux-gnu/libjbig.so.0)

[#4 (closed)](/libtiff/libtiff/-/issues/4 "[BZ#2047] icc profile not read") 0x00000000004e3c85 in JBIGDecode (/home/user/libtiff/tools/tiff2ps)
49: int JBIGDecode(tif = (TIFF \*)0x922bd0, buffer = (uint8\_t *)0x929940 "TZif2", size = (tmsize\_t)147456, s = (uint16\_t)) {
||:
||: /* Local reference: int decodeStatus = 0; */
||: /* Local reference: struct jbg\_dec\_state decoder = {d = 0, dl = 0, xd = 43136, yd = 3221258240, planes = 16, l0 = 49152, stripes = 65537, order = 0, options = 0, mx = 0, my = 0, dppriv = 0x0, ii = {0, 0, 0}, lhp = {0x925... */
||: /* Local reference: TIFF \* tif = 0x922bd0; */
76: #endif /* HAVE\_JBG\_NEWLEN */
77:
78: decodeStatus = jbg\_dec\_in(&decoder, (unsigned char*)tif->tif\_rawcp,
||:
--: }
at tif\_jbig.c:78

[#5](/libtiff/libtiff/-/issues/5 "[BZ#2073] TIFFWriteScanline corrupts buffer when compression with predication is enabled") 0x0000000000660080 in TIFFReadEncodedStrip (/home/user/libtiff/tools/tiff2ps)
504: tmsize\_t TIFFReadEncodedStrip(tif = (TIFF \*)0x922bd0, strip = (uint32\_t)0, buf = (void *)0x929940, size = (tmsize\_t)147456) {
|||:
|||: /* Local reference: TIFF \* tif = 0x922bd0; */
|||: /* Local reference: uint32\_t strip = 0; */
|||: /* Local reference: tmsize\_t stripsize = ; */
|||: /* Local reference: uint16\_t plane = 0; */
|||: /* Local reference: void \* buf = 0x929940; \*/
534: if (!TIFFFillStrip(tif,strip))
535: return((tmsize\_t)(-1));
536: if ((\*tif->tif\_decodestrip)(tif,buf,stripsize,plane)<=0)
|||:
---: }
at tif\_read.c:536

[#6](/libtiff/libtiff/-/issues/6 "[BZ#2101] C# wrapper for libtiff is available") 0x00000000002c7ba1 in PS\_Lvl2page (/home/user/libtiff/tools/tiff2ps)
????: int PS\_Lvl2page(fd = (FILE \*), tif = (TIFF *)0x922bd0, w = (uint32\_t)0, h = (uint32\_t)6) {
||||:
||||: /* Local reference: tsize\_t chunk\_size = 147456; */
||||: /* Local reference: tsize\_t byte\_count = ; */
||||: /* Local reference: TIFF \* tif = 0x922bd0; \*/
2262: chunk\_size);
2263: else
2264: byte\_count = TIFFReadEncodedStrip(tif,
||||:
----: }
at tiff2ps.c:2264

[#7 (closed)](/libtiff/libtiff/-/issues/7 "[BZ#2110] Fax3Encode2DRow reads memory after refline's end") 0x00000000002c7ba1 in PSpage (/home/user/libtiff/tools/tiff2ps)
2360: void PSpage(fd = (FILE \*), tif = (TIFF *), w = (uint32\_t), h = (uint32\_t)) {
||||:
||||: /* Local reference: char \* imageOp = ; */
||||: /* Local reference: FILE \* fd = ; */
||||: /* Local reference: TIFF \* tif = ; */
||||: /* Local reference: uint32\_t w = ; */
||||: /* Local reference: uint32\_t h = ; \*/
2365: imageOp = "imagemask";
2366:
2367: if ((level2 || level3) && PS\_Lvl2page(fd, tif, w, h))
||||:
----: }
at tiff2ps.c:2367

[#8 (closed)](/libtiff/libtiff/-/issues/8 "[BZ#2112] tag name handling with TIFFMergeFieldInfo()") 0x0000000000276ec1 in TIFF2PS (/home/user/libtiff/tools/tiff2ps)
????: int TIFF2PS(fd = (FILE \*)0x7ffff7a656a0 <\_IO\_2\_1\_stdout\_>, tif = (TIFF *)0x922bd0, pgwidth = (double)0, pgheight = (double)0, lm = (double)0, bm = (double)0, center = (int)) {
||||:
||||: /* Local reference: double left\_offset = 0; */
||||: /* Local reference: FILE \* fd = 0x7ffff7a656a0 <\_IO\_2\_1\_stdout\_>; */
||||: /* Local reference: double bottom\_offset = 0; */
||||: /* Local reference: double psheight = 6; */
||||: /* Local reference: double scale = ; */
||||: /* Local reference: double pswidth = 65535; \*/
1079: case 180: fprintf (fd, "%f %f translate\n", left\_offset ? left\_offset : 0.0,
1080: bottom\_offset ? bottom\_offset : reqheight - (psheight \* scale));
1081: fprintf (fd, "%f %f scale\n1 1 translate 180 rotate\n", pswidth \* scale, psheight \* scale);
||||:
----: }
at tiff2ps.c:1081

[#9 (closed)](/libtiff/libtiff/-/issues/9 "[BZ#2115] tiff converts to empty pdf") 0x0000000000276ec1 in main (/home/user/libtiff/tools/tiff2ps)
260: int main(argc = (int)4, argv = (char \**)0x7fffffffdbe8) {
|||:
|||: /* Local reference: int np = 32512; */
|||: /* Local reference: FILE \* output = 0x7ffff7a656a0 <\_IO\_2\_1\_stdout\_>; */
|||: /* Local reference: TIFF \* tif = 0x922bd0; */
|||: /* Local reference: double pageWidth = 0; */
|||: /* Local reference: double pageHeight = 0; \*/
500: return (EXIT\_FAILURE);
501: }
502: np = TIFF2PS(output, tif, pageWidth, pageHeight,
|||:
---: }
at tiff2ps.c:502

Edited Apr 02, 2022 by [mqrsv](/mqrsv)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.

