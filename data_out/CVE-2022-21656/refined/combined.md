=== Content from github.com_7ff0d576_20250108_131512.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fenvoyproxy%2Fenvoy%2Fsecurity%2Fadvisories%2FGHSA-c9g7-xwcv-pjx2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fenvoyproxy%2Fenvoy%2Fsecurity%2Fadvisories%2FGHSA-c9g7-xwcv-pjx2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=envoyproxy%2Fenvoy)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[envoyproxy](/envoyproxy)
/
**[envoy](/envoyproxy/envoy)**
Public

* [Notifications](/login?return_to=%2Fenvoyproxy%2Fenvoy) You must be signed in to change notification settings
* [Fork
  4.8k](/login?return_to=%2Fenvoyproxy%2Fenvoy)
* [Star
   25.3k](/login?return_to=%2Fenvoyproxy%2Fenvoy)

* [Code](/envoyproxy/envoy)
* [Issues
  1.5k](/envoyproxy/envoy/issues)
* [Pull requests
  141](/envoyproxy/envoy/pulls)
* [Actions](/envoyproxy/envoy/actions)
* [Projects
  0](/envoyproxy/envoy/projects)
* [Wiki](/envoyproxy/envoy/wiki)
* [Security](/envoyproxy/envoy/security)
* [Insights](/envoyproxy/envoy/pulse)

Additional navigation options

* [Code](/envoyproxy/envoy)
* [Issues](/envoyproxy/envoy/issues)
* [Pull requests](/envoyproxy/envoy/pulls)
* [Actions](/envoyproxy/envoy/actions)
* [Projects](/envoyproxy/envoy/projects)
* [Wiki](/envoyproxy/envoy/wiki)
* [Security](/envoyproxy/envoy/security)
* [Insights](/envoyproxy/envoy/pulse)

# X.509 subjectAltName matching (and nameConstraints) bypass

Low

[mattklein123](/mattklein123)
published
GHSA-c9g7-xwcv-pjx2
Feb 22, 2022

## Package

envoy
(C++)

## Affected versions

1.20.1 and earlier

## Patched versions

1.20.2

## Description

### Summary

A certificate authentication bypass allows malformed certificates issued by a malicious CA to be accepted as valid for a host.

### Description

The API for matching Subject Alternative Names in X.509 certificates does not take into consideration the Subject Alternative Name type. A malicious CA that issues a malformed certificate, such as encoding a DNS hostname within an rfc822Name Subject Alternative Name or an email address within a uniformResourceIndicator Subject Alternative Name, will have that certificate successfully match against the configured name. Due to the malformed nature of the certificate, this may result in bypassing configured constraints, such as nameConstraints that restrict which DNS hostnames or email addresses a CA may issue for.

CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:N, Low

### Impact

This may allow for monster-in-the-middle attacks for Envoy users that rely on the X.509 nameConstraints extension to restrict the capabilities for CAs. This includes users who use common, commercially-available CAs that issue widely-trusted certificates, as they rely on nameConstraints to technically constrain subordinate CAs. Users that use enterprise-managed CAs and which do not use nameConstraints to restrict access to CAs may not be affected, as they already completely trust the CA to not issue malformed certificates.

### Patches

Envoy version 1.20.1 adds the ability to specify type of SAN along with the value to match against.

IMPORTANT: Further action is required after upgrading to the patched version. Replace all usage of [envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_subject\_alt\_names](https://github.com/envoyproxy/envoy/blob/9d5627a0879b0a029e90515137c108e1d2884bfc/api/envoy/extensions/transport_sockets/tls/v3/common.proto#L454) with [envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_typed\_subject\_alt\_names](https://github.com/envoyproxy/envoy/blob/9d5627a0879b0a029e90515137c108e1d2884bfc/api/envoy/extensions/transport_sockets/tls/v3/common.proto#L450) which will ensure the matching considers the type of Subject Alternative Name in use, as well as all appropriate nameConstraints.

### Workarounds

None.

### References

<https://blog.envoyproxy.io>

<https://github.com/envoyproxy/envoy/releases>

### For more information

Open an issue in [Envoy repo](https://github.com/envoyproxy/envoy/issues)

Email us at [envoy-security](https://github.com/envoyproxy/envoy/security/advisories/envoy-security%40googlegroups.com)

### Severity

Low

3.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:N

### CVE ID

CVE-2022-21656

### Weaknesses

[CWE-295](/advisories?query=cwe%3A295)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_99a4e8e0_20250108_131511.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fenvoyproxy%2Fenvoy%2Fcommit%2Fbb95af848c939cfe5b5ee33c5b1770558077e64e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fenvoyproxy%2Fenvoy%2Fcommit%2Fbb95af848c939cfe5b5ee33c5b1770558077e64e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=envoyproxy%2Fenvoy)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[envoyproxy](/envoyproxy)
/
**[envoy](/envoyproxy/envoy)**
Public

* [Notifications](/login?return_to=%2Fenvoyproxy%2Fenvoy) You must be signed in to change notification settings
* [Fork
  4.8k](/login?return_to=%2Fenvoyproxy%2Fenvoy)
* [Star
   25.3k](/login?return_to=%2Fenvoyproxy%2Fenvoy)

* [Code](/envoyproxy/envoy)
* [Issues
  1.5k](/envoyproxy/envoy/issues)
* [Pull requests
  141](/envoyproxy/envoy/pulls)
* [Actions](/envoyproxy/envoy/actions)
* [Projects
  0](/envoyproxy/envoy/projects)
* [Wiki](/envoyproxy/envoy/wiki)
* [Security](/envoyproxy/envoy/security)
* [Insights](/envoyproxy/envoy/pulse)

Additional navigation options

* [Code](/envoyproxy/envoy)
* [Issues](/envoyproxy/envoy/issues)
* [Pull requests](/envoyproxy/envoy/pulls)
* [Actions](/envoyproxy/envoy/actions)
* [Projects](/envoyproxy/envoy/projects)
* [Wiki](/envoyproxy/envoy/wiki)
* [Security](/envoyproxy/envoy/security)
* [Insights](/envoyproxy/envoy/pulse)

## Commit

[Permalink](/envoyproxy/envoy/commit/bb95af848c939cfe5b5ee33c5b1770558077e64e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Specify type for matching Subject Alternative Name. ([#18628](https://github.com/envoyproxy/envoy/pull/18628))

[Browse files](/envoyproxy/envoy/tree/bb95af848c939cfe5b5ee33c5b1770558077e64e)
Browse the repository at this point in the history

```

Signed-off-by: Pradeep Rao <pcrao@google.com>
```

* Loading branch information

[![@pradeepcrao](https://avatars.githubusercontent.com/u/84025829?s=40&v=4)](/pradeepcrao)

[pradeepcrao](/envoyproxy/envoy/commits?author=pradeepcrao "View all commits by pradeepcrao")
authored
Nov 24, 2021

1 parent
[25bf301](/envoyproxy/envoy/commit/25bf30156731777bf60e3f801773f08b38cf02b2)

commit bb95af8

 Show file tree

 Hide file tree

Showing
**45 changed files**
with
**666 additions**
and
**172 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* api/envoy/extensions/transport\_sockets/tls/v3

  + api/envoy/extensions/transport\_sockets/tls/v3/common.proto
    [common.proto](#diff-e18722c3190aeb921472834ba2f4725bcfa5dfae5c024d9d7aca8cd2ecefeaee)
  + api/envoy/extensions/transport\_sockets/tls/v3/tls\_spiffe\_validator\_config.proto
    [tls\_spiffe\_validator\_config.proto](#diff-a075f261fe41caaac9d33b3508106877f16cd7149ecac360e8c7c4fa79515c46)
* configs

  + configs/envoy\_double\_proxy.template.yaml
    [envoy\_double\_proxy.template.yaml](#diff-0e962e49bd5acbd21c5f5b74746d4cda85b5dfd0df26e8762dba08facf44e24e)
  + configs/envoy\_service\_to\_service.template.yaml
    [envoy\_service\_to\_service.template.yaml](#diff-efdeee6345c631afcdb7fd3e158723425ed67d83bf7ef3ec1cfd6ca269f30a5c)
* docs/root

  + intro/arch\_overview/security

    - \_include

      * docs/root/intro/arch\_overview/security/\_include/ssl.yaml
        [ssl.yaml](#diff-f0943fe64d0633416a553345b21275e0a1100d709f0b18c0742e69b214793408)
    - docs/root/intro/arch\_overview/security/ssl.rst
      [ssl.rst](#diff-0254b256eddbdde024357d5d3ccb58ed975d4b3f7eda4d2d22aee72388e2b9df)
  + start/quick-start

    - \_include

      * docs/root/start/quick-start/\_include/envoy-demo-tls-client-auth.yaml
        [envoy-demo-tls-client-auth.yaml](#diff-ce2e3e7b2961ec3260636d75bc6e3641be816be08ba50b2403c91088d60297d5)
      * docs/root/start/quick-start/\_include/envoy-demo-tls-validation.yaml
        [envoy-demo-tls-validation.yaml](#diff-63b626296cfe60bf3bb9ad01937fc3c36fe54ca75c580342b973d9c46ee1d61c)
    - docs/root/start/quick-start/securing.rst
      [securing.rst](#diff-a1faab40daffec0bc28acd2b19d41088009f91133c7fab4b70b8d71072bbae65)
  + version\_history

    - docs/root/version\_history/current.rst
      [current.rst](#diff-486ddf71f632f6537c18c0735baa4eb49e33ce2646092a74f2ba7f63a346ed09)
* envoy/ssl

  + envoy/ssl/certificate\_validation\_context\_config.h
    [certificate\_validation\_context\_config.h](#diff-e841326c25ac5e409806d5f3bde0599789339aabb7dfa7835fc27773314a8362)
* examples/double-proxy

  + examples/double-proxy/envoy-backend.yaml
    [envoy-backend.yaml](#diff-e3cf2720e8fc79372b175135b4043e2a287c17985186532b28c665d29ecd07ea)
  + examples/double-proxy/envoy-frontend.yaml
    [envoy-frontend.yaml](#diff-1ee73ee40d5ef3851c99532707004d013b94041eeaf60230d461185e5b849a61)
* source

  + common/ssl

    - source/common/ssl/BUILD
      [BUILD](#diff-92d56f286991907337a784c459e75ffd3f5d4c8a8bcea8814f4dc019bd61741e)
    - source/common/ssl/certificate\_validation\_context\_config\_impl.cc
      [certificate\_validation\_context\_config\_impl.cc](#diff-cf088136dc052ddf1762fb3c96c0e8de472f3031f288e7e300558e6e72c8e129)
    - source/common/ssl/certificate\_validation\_context\_config\_impl.h
      [certificate\_validation\_context\_config\_impl.h](#diff-c82a07b7bbba106401349c81387452c985e667285bd642bcbed890cb91b61b62)
  + extensions/transport\_sockets/tls/cert\_validator

    - source/extensions/transport\_sockets/tls/cert\_validator/BUILD
      [BUILD](#diff-665e8a53465d1b412be1d8dd491c22091b081ef0a5e1cd7cfd09ff4738de471e)
    - source/extensions/transport\_sockets/tls/cert\_validator/default\_validator.cc
      [default\_validator.cc](#diff-4c9dddfcf45c99ffeaf3fde9707cefe0783482d2f1d141a5fa82956729128ab6)
    - source/extensions/transport\_sockets/tls/cert\_validator/default\_validator.h
      [default\_validator.h](#diff-2dd5317bb74df5ba8b1df4e44f8a4de3674b7760bc248bf7bc1c25b0fb381791)
    - source/extensions/transport\_sockets/tls/cert\_validator/san\_matcher.cc
      [san\_matcher.cc](#diff-ea79996f60e64751d9f9de09df112e7824a5d71fde07dbcb43be328fb7da5d0e)
    - source/extensions/transport\_sockets/tls/cert\_validator/san\_matcher.h
      [san\_matcher.h](#diff-3e37b7437ef60027dc4ad79eb90b08f09d89d84dd89893a69126c18d6c57d1a8)
    - spiffe

      * source/extensions/transport\_sockets/tls/cert\_validator/spiffe/spiffe\_validator.cc
        [spiffe\_validator.cc](#diff-067aae04811b0f9ec5191388ebd58efe08012c3bc75e0951c028448ec87e2d70)
      * source/extensions/transport\_sockets/tls/cert\_validator/spiffe/spiffe\_validator.h
        [spiffe\_validator.h](#diff-65b35c13ecaf19b077fb2c44b490dc7e1d448202270dc044609e7efd9fd1b698)
* test

  + common

    - quic

      * test/common/quic/envoy\_quic\_proof\_source\_test.cc
        [envoy\_quic\_proof\_source\_test.cc](#diff-48701750145f9deea8ed8195d7e101dbf832b2fa0288d1a2b55be49d84baede3)
      * test/common/quic/envoy\_quic\_proof\_verifier\_test.cc
        [envoy\_quic\_proof\_verifier\_test.cc](#diff-e23811eb8148c3e520dcf98c383dfb82137a702399100942cb7434ee65f20391)
    - secret

      * test/common/secret/sds\_api\_test.cc
        [sds\_api\_test.cc](#diff-8e5f56463d7c4e0a70b111fef53b4e4d535b3c690b901441834fc4c891989167)
      * test/common/secret/secret\_manager\_impl\_test.cc
        [secret\_manager\_impl\_test.cc](#diff-127086107bf1e6e7e79876e088badea26fa05d322c18ce4f9bb16224b7054a3a)
    - upstream

      * test/common/upstream/upstream\_impl\_test.cc
        [upstream\_impl\_test.cc](#diff-738214aaeb955bc9a3e511c9584cb59aa459283cbb0805565da57a1325a33d4f)
  + config

    - test/config/utility.cc
      [utility.cc](#diff-ce04c82dd2b166c6df41e514e7c253ceeb276f7db1d186ddc16f8f1841ad9496)
    - test/config/utility.h
      [utility.h](#diff-a00c6efc42fc025c0cea76be1b3c81c6993b65edb65c77e5001ed22157236386)
  + extensions/transport\_sockets/tls

    - cert\_validator

      * test/extensions/transport\_sockets/tls/cert\_validator/BUILD
        [BUILD](#diff-5e7e92c980a27baafce4f02e8cedd15fbf4df820821c7120911bee0ca90fd2bb)
      * test/extensions/transport\_sockets/tls/cert\_validator/default\_validator\_test.cc
        [default\_validator\_test.cc](#diff-374faf1e01ce7c1673328a32f63daa371fdcfcc712a9b352ec63f57aacc2fb7f)
      * test/extensions/transport\_sockets/tls/cert\_validator/san\_matcher\_test.cc
        [san\_matcher\_test.cc](#diff-00e99036a5a94f67ca4a09e7f78e763e177698bc2665e4a3e57bd600f1ed2e97)
      * spiffe

        + test/extensions/transport\_sockets/tls/cert\_validator/spiffe/spiffe\_validator\_integration\_test.cc
          [spiffe\_validator\_integration\_test.cc](#diff-66910c8603054627f43dc384020e22b4aeeb0c699db22c1e666fba0bee2fb6d9)
        + test/extensions/transport\_sockets/tls/cert\_validator/spiffe/spiffe\_validator\_integration\_test.h
          [spiffe\_validator\_integration\_test.h](#diff-fa96433a8aac7c185c9f454732be85a8926d2e58ced134e7285d5b2544c1476e)
        + test/extensions/transport\_sockets/tls/cert\_validator/spiffe/spiffe\_validator\_test.cc
          [spiffe\_validator\_test.cc](#diff-ee57e8aee637e17f1f512cef5e2bff807c263ab67922c85659721654913242f4)
      * test/extensions/transport\_sockets/tls/cert\_validator/test\_common.h
        [test\_common.h](#diff-faa5d4c4bbc04b75ef4c1588d2d2837ed2d542acace663cebd75351e9fd42637)
    - test/extensions/transport\_sockets/tls/context\_impl\_test.cc
      [context\_impl\_test.cc](#diff-261682e5d32e5df186506d3ceca938e3a5efa52f7f5677314d5210a4e2f32601)
    - test/extensions/transport\_sockets/tls/ssl\_socket\_test.cc
      [ssl\_socket\_test.cc](#diff-974cbb9719b3f533dcccd494c16e0314d6bcfaac051eaa58d728373b972d5cea)
  + integration

    - test/integration/ads\_integration.cc
      [ads\_integration.cc](#diff-42e3bc5c7c87a94967c381085f3dbd270bd913ceadaf7c37f7880c72db24e992)
    - test/integration/ssl\_utility.cc
      [ssl\_utility.cc](#diff-97b2dc1342a4497840e9ad432569a6dc41cc35d1ebe638c307e05b67e68acdcc)
    - test/integration/xfcc\_integration\_test.cc
      [xfcc\_integration\_test.cc](#diff-ce4ba6cbe0209d8449e24ec061a99a3b6fef150be87a61c8786c0d1071247169)
  + mocks/ssl

    - test/mocks/ssl/mocks.h
      [mocks.h](#diff-c72ac4dd0f6d64e9ad3f92b12d7c56218ea01be75e2c4634c43c1912ad62c218)
  + test/per\_file\_coverage.sh
    [per\_file\_coverage.sh](#diff-0ac04ef31c616358d8234bd473469c1a233ecf37947a13475cce764e7f6c43ee)
  + server

    - test/server/listener\_manager\_impl\_quic\_only\_test.cc
      [listener\_manager\_impl\_quic\_only\_test.cc](#diff-d685d9a0117ab86cf8aa837f200e6a75cd87f90237075de858055580febcdf75)

## There are no files selected for viewing

41 changes: 35 additions & 6 deletions

41
[api/envoy/extensions/transport\_sockets/tls/v3/common.proto](#diff-e18722c3190aeb921472834ba2f4725bcfa5dfae5c024d9d7aca8cd2ecefeaee "api/envoy/extensions/transport_sockets/tls/v3/common.proto")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/api/envoy/extensions/transport_sockets/tls/v3/common.proto)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -9,6 +9,7 @@ import "envoy/type/matcher/v3/string.proto"; |
|  |  | import "google/protobuf/any.proto"; |
|  |  | import "google/protobuf/wrappers.proto"; |
|  |  |  |
|  |  | import "envoy/annotations/deprecation.proto"; |
|  |  | import "udpa/annotations/migrate.proto"; |
|  |  | import "udpa/annotations/sensitive.proto"; |
|  |  | import "udpa/annotations/status.proto"; |
| Expand Down  Expand Up | | @@ -268,7 +269,26 @@ message CertificateProviderPluginInstance { |
|  |  | string certificate\_name = 2; |
|  |  | } |
|  |  |  |
|  |  | // [#next-free-field: 15] |
|  |  | // Matcher for subject alternative names, to match both type and value of the SAN. |
|  |  | message SubjectAltNameMatcher { |
|  |  | // Indicates the choice of GeneralName as defined in section 4.2.1.5 of RFC 5280 to match |
|  |  | // against. |
|  |  | enum SanType { |
|  |  | SAN\_TYPE\_UNSPECIFIED = 0; |
|  |  | EMAIL = 1; |
|  |  | DNS = 2; |
|  |  | URI = 3; |
|  |  | IP\_ADDRESS = 4; |
|  |  | } |
|  |  |  |
|  |  | // Specification of type of SAN. Note that the default enum value is an invalid choice. |
|  |  | SanType san\_type = 1 [(validate.rules).enum = {defined\_only: true not\_in: 0}]; |
|  |  |  |
|  |  | // Matcher for SAN value. |
|  |  | type.matcher.v3.StringMatcher matcher = 2 [(validate.rules).message = {required: true}]; |
|  |  | } |
|  |  |  |
|  |  | // [#next-free-field: 16] |
|  |  | message CertificateValidationContext { |
|  |  | option (udpa.annotations.versioning).previous\_message\_type = |
|  |  | "envoy.api.v2.auth.CertificateValidationContext"; |
| Expand Down  Expand Up | | @@ -298,8 +318,8 @@ message CertificateValidationContext { |
|  |  | // <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.verify\_certificate\_spki>`, |
|  |  | // :ref:`verify\_certificate\_hash |
|  |  | // <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.verify\_certificate\_hash>`, or |
|  |  | // :ref:`match\_subject\_alt\_names |
|  |  | // <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_subject\_alt\_names>`) is also |
|  |  | // :ref:`match\_typed\_subject\_alt\_names |
|  |  | // <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_typed\_subject\_alt\_names>`) is also |
|  |  | // specified. |
|  |  | // |
|  |  | // It can optionally contain certificate revocation lists, in which case Envoy will verify |
| Expand Down  Expand Up | | @@ -406,6 +426,8 @@ message CertificateValidationContext { |
|  |  |  |
|  |  | // An optional list of Subject Alternative name matchers. If specified, Envoy will verify that the |
|  |  | // Subject Alternative Name of the presented certificate matches one of the specified matchers. |
|  |  | // The matching uses "any" semantics, that is to say, the SAN is verified if at least one matcher is |
|  |  | // matched. |
|  |  | // |
|  |  | // When a certificate has wildcard DNS SAN entries, to match a specific client, it should be |
|  |  | // configured with exact match type in the :ref:`string matcher <envoy\_v3\_api\_msg\_type.matcher.v3.StringMatcher>`. |
| Expand All | | @@ -414,15 +436,22 @@ message CertificateValidationContext { |
|  |  | // |
|  |  | // .. code-block:: yaml |
|  |  | // |
|  |  | // match\_subject\_alt\_names: |
|  |  | // exact: "api.example.com" |
|  |  | // match\_typed\_subject\_alt\_names: |
|  |  | // - san\_type: DNS |
|  |  | // matcher: |
|  |  | // exact: "api.example.com" |
|  |  | // |
|  |  | // .. attention:: |
|  |  | // |
|  |  | // Subject Alternative Names are easily spoofable and verifying only them is insecure, |
|  |  | // therefore this option must be used together with :ref:`trusted\_ca |
|  |  | // <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.trusted\_ca>`. |
|  |  | repeated type.matcher.v3.StringMatcher match\_subject\_alt\_names = 9; |
|  |  | repeated SubjectAltNameMatcher match\_typed\_subject\_alt\_names = 15; |
|  |  |  |
|  |  | // This field is deprecated in favor of ref:`match\_typed\_subject\_alt\_names |
|  |  | // <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_typed\_subject\_alt\_names>` |
|  |  | repeated type.matcher.v3.StringMatcher match\_subject\_alt\_names = 9 |
|  |  | [deprecated = true, (envoy.annotations.deprecated\_at\_minor\_version) = "3.0"]; |
|  |  |  |
|  |  | // [#not-implemented-hide:] Must present signed certificate time-stamp. |
|  |  | google.protobuf.BoolValue require\_signed\_certificate\_timestamp = 6; |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[api/envoy/extensions/transport\_sockets/tls/v3/tls\_spiffe\_validator\_config.proto](#diff-a075f261fe41caaac9d33b3508106877f16cd7149ecac360e8c7c4fa79515c46 "api/envoy/extensions/transport_sockets/tls/v3/tls_spiffe_validator_config.proto")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/api/envoy/extensions/transport_sockets/tls/v3/tls_spiffe_validator_config.proto)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -42,7 +42,7 @@ option (udpa.annotations.file\_status).package\_version\_status = ACTIVE; |
|  |  | // Note that SPIFFE validator inherits and uses the following options from :ref:`CertificateValidationContext <envoy\_v3\_api\_msg\_extensions.transport\_sockets.tls.v3.CertificateValidationContext>`. |
|  |  | // |
|  |  | // - :ref:`allow\_expired\_certificate <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.allow\_expired\_certificate>` to allow expired certificates. |
|  |  | // - :ref:`match\_subject\_alt\_names <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_subject\_alt\_names>` to match \*\*URI\*\* SAN of certificates. Unlike the default validator, SPIFFE validator only matches \*\*URI\*\* SAN (which equals to SVID in SPIFFE terminology) and ignore other SAN types. |
|  |  | // - :ref:`match\_typed\_subject\_alt\_names <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_typed\_subject\_alt\_names>` to match \*\*URI\*\* SAN of certificates. Unlike the default validator, SPIFFE validator only matches \*\*URI\*\* SAN (which equals to SVID in SPIFFE terminology) and ignore other SAN types. |
|  |  | // |
|  |  | message SPIFFECertValidatorConfig { |
|  |  | message TrustDomain { |
| Expand Down | |  |

12 changes: 8 additions & 4 deletions

12
[configs/envoy\_double\_proxy.template.yaml](#diff-0e962e49bd5acbd21c5f5b74746d4cda85b5dfd0df26e8762dba08facf44e24e "configs/envoy_double_proxy.template.yaml")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/configs/envoy_double_proxy.template.yaml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -149,8 +149,10 @@ static\_resources: |
|  |  | validation\_context: |
|  |  | trusted\_ca: |
|  |  | filename: certs/cacert.pem |
|  |  | match\_subject\_alt\_names: |
|  |  | exact: "front-proxy.yourcompany.net" |
|  |  | match\_typed\_subject\_alt\_names: |
|  |  | - san\_type: DNS |
|  |  | matcher: |
|  |  | exact: "front-proxy.yourcompany.net" |
|  |  | typed\_extension\_protocol\_options: |
|  |  | envoy.extensions.upstreams.http.v3.HttpProtocolOptions: |
|  |  | "@type": type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions |
| Expand Down  Expand Up | | @@ -188,8 +190,10 @@ static\_resources: |
|  |  | validation\_context: |
|  |  | trusted\_ca: |
|  |  | filename: certs/cacert.pem |
|  |  | match\_subject\_alt\_names: |
|  |  | exact: "collector-grpc.lightstep.com" |
|  |  | match\_typed\_subject\_alt\_names: |
|  |  | - san\_type: DNS |
|  |  | matcher: |
|  |  | exact: "collector-grpc.lightstep.com" |
|  |  | flags\_path: "/etc/envoy/flags" |
|  |  | stats\_sinks: |
|  |  | - name: envoy.stat\_sinks.statsd |
| Expand Down | |  |

12 changes: 8 additions & 4 deletions

12
[configs/envoy\_service\_to\_service.template.yaml](#diff-efdeee6345c631afcdb7fd3e158723425ed67d83bf7ef3ec1cfd6ca269f30a5c "configs/envoy_service_to_service.template.yaml")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/configs/envoy_service_to_service.template.yaml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -350,8 +350,10 @@ static\_resources: |
|  |  | trusted\_ca: |
|  |  | filename: certs/cacert.pem |
|  |  | {% if host.get('verify\_subject\_alt\_name', False) %} |
|  |  | match\_subject\_alt\_names: |
|  |  | exact: "{{host['verify\_subject\_alt\_name'] }}" |
|  |  | match\_typed\_subject\_alt\_names: |
|  |  | - san\_type: DNS |
|  |  | matcher: |
|  |  | exact: "{{host['verify\_subject\_alt\_name'] }}" |
|  |  | {% endif %} |
|  |  | {% if host.get('sni', False) %} |
|  |  | sni: "{{ host['sni'] }}" |
| Expand Down  Expand Up | | @@ -520,8 +522,10 @@ static\_resources: |
|  |  | validation\_context: |
|  |  | trusted\_ca: |
|  |  | filename: certs/cacert.pem |
|  |  | match\_subject\_alt\_names: |
|  |  | exact: "collector-grpc.lightstep.com" |
|  |  | match\_typed\_subject\_alt\_names: |
|  |  | - san\_type: DNS |
|  |  | matcher: |
|  |  | exact: "collector-grpc.lightstep.com" |
|  |  | - name: cds\_cluster |
|  |  | connect\_timeout: 0.25s |
|  |  | type: STRICT\_DNS |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[docs/root/intro/arch\_overview/security/\_include/ssl.yaml](#diff-f0943fe64d0633416a553345b21275e0a1100d709f0b18c0742e69b214793408 "docs/root/intro/arch_overview/security/_include/ssl.yaml")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/docs/root/intro/arch_overview/security/_include/ssl.yaml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -50,7 +50,9 @@ static\_resources: |
|  |  | private\_key: {"filename": "certs/serverkey.pem"} |
|  |  | ocsp\_staple: {"filename": "certs/server\_ocsp\_resp.der"} |
|  |  | validation\_context: |
|  |  | match\_subject\_alt\_names: |
|  |  | - exact: "foo" |
|  |  | match\_typed\_subject\_alt\_names: |
|  |  | - san\_type: DNS |
|  |  | matcher: |
|  |  | exact: "foo" |
|  |  | trusted\_ca: |
|  |  | filename: /etc/ssl/certs/ca-certificates.crt |

2 changes: 1 addition & 1 deletion

2
[docs/root/intro/arch\_overview/security/ssl.rst](#diff-0254b256eddbdde024357d5d3ccb58ed975d4b3f7eda4d2d22aee72388e2b9df "docs/root/intro/arch_overview/security/ssl.rst")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/docs/root/intro/arch_overview/security/ssl.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -76,7 +76,7 @@ Example configuration |
|  |  |  |
|  |  | \*/etc/ssl/certs/ca-certificates.crt\* is the default path for the system CA bundle on Debian systems. |
|  |  | :ref:`trusted\_ca <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.trusted\_ca>` along with |
|  |  | :ref:`match\_subject\_alt\_names <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_subject\_alt\_names>` |
|  |  | :ref:`match\_typed\_subject\_alt\_names <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_typed\_subject\_alt\_names>` |
|  |  | makes Envoy verify the server identity of \*127.0.0.1:1234\* as "foo" in the same way as e.g. cURL |
|  |  | does on standard Debian installations. Common paths for system CA bundles on Linux and BSD are: |
|  |  |  |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[docs/root/start/quick-start/\_include/envoy-demo-tls-client-auth.yaml](#diff-ce2e3e7b2961ec3260636d75bc6e3641be816be08ba50b2403c91088d60297d5 "docs/root/start/quick-start/_include/envoy-demo-tls-client-auth.yaml")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/docs/root/start/quick-start/_include/envoy-demo-tls-client-auth.yaml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -34,8 +34,10 @@ static\_resources: |
|  |  | validation\_context: |
|  |  | trusted\_ca: |
|  |  | filename: certs/cacert.pem |
|  |  | match\_subject\_alt\_names: |
|  |  | - exact: proxy-postgres-frontend.example.com |
|  |  | match\_typed\_subject\_alt\_names: |
|  |  | - san\_type: DNS |
|  |  | matcher: |
|  |  | exact: proxy-postgres-frontend.example.com |
|  |  | tls\_certificates: |
|  |  | - certificate\_chain: |
|  |  | filename: certs/servercert.pem |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[docs/root/start/quick-start/\_include/envoy-demo-tls-validation.yaml](#diff-63b626296cfe60bf3bb9ad01937fc3c36fe54ca75c580342b973d9c46ee1d61c "docs/root/start/quick-start/_include/envoy-demo-tls-validation.yaml")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/docs/root/start/quick-start/_include/envoy-demo-tls-validation.yaml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -48,5 +48,7 @@ static\_resources: |
|  |  | validation\_context: |
|  |  | trusted\_ca: |
|  |  | filename: certs/cacert.pem |
|  |  | match\_subject\_alt\_names: |
|  |  | - exact: proxy-postgres-backend.example.com |
|  |  | match\_typed\_subject\_alt\_names: |
|  |  | - san\_type: DNS |
|  |  | matcher: |
|  |  | exact: proxy-postgres-backend.example.com |

12 changes: 6 additions & 6 deletions

12
[docs/root/start/quick-start/securing.rst](#diff-a1faab40daffec0bc28acd2b19d41088009f91133c7fab4b70b8d71072bbae65 "docs/root/start/quick-start/securing.rst")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/docs/root/start/quick-start/securing.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -100,7 +100,7 @@ certificate is valid for. |
|  |  | .. note:: |
|  |  |  |
|  |  | If the "Subject Alternative Names" for a certificate are for a wildcard domain, eg ``\*.example.com``, |
|  |  | this is what you should use when matching with ``match\_subject\_alt\_names``. |
|  |  | this is what you should use when matching with ``match\_typed\_subject\_alt\_names``. |
|  |  |  |
|  |  | .. note:: |
|  |  |  |
| Expand All | | @@ -122,20 +122,20 @@ and specify a mutually trusted certificate authority: |
|  |  | :language: yaml |
|  |  | :linenos: |
|  |  | :lineno-start: 27 |
|  |  | :lines: 27-39 |
|  |  | :lines: 27-41 |
|  |  | :emphasize-lines: 6, 8-10 |
|  |  | :caption: :download:`envoy-demo-tls-client-auth.yaml <\_include/envoy-demo-tls-client-auth.yaml>` |
|  |  |  |
|  |  | You can further restrict the authentication of connecting clients by specifying the allowed |
|  |  | "Subject Alternative Names" in |
|  |  | :ref:`match\_subject\_alt\_names <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_subject\_alt\_names>`, |
|  |  | :ref:`match\_typed\_subject\_alt\_names <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_typed\_subject\_alt\_names>`, |
|  |  | similar to validating upstream certificates :ref:`described above <start\_quick\_start\_securing\_validation>`. |
|  |  |  |
|  |  | .. literalinclude:: \_include/envoy-demo-tls-client-auth.yaml |
|  |  | :language: yaml |
|  |  | :linenos: |
|  |  | :lineno-start: 27 |
|  |  | :lines: 27-39 |
|  |  | :lines: 27-41 |
|  |  | :emphasize-lines: 7, 11-12 |
|  |  | :caption: :download:`envoy-demo-tls-client-auth.yaml <\_include/envoy-demo-tls-client-auth.yaml>` |
|  |  |  |
| Expand All | | @@ -154,8 +154,8 @@ When connecting to an upstream with client certificates you can set them as foll |
|  |  | .. literalinclude:: \_include/envoy-demo-tls-client-auth.yaml |
|  |  | :language: yaml |
|  |  | :linenos: |
|  |  | :lineno-start: 44 |
|  |  | :lines: 44-68 |
|  |  | :lineno-start: 46 |
|  |  | :lines: 46-70 |
|  |  | :emphasize-lines: 20-25 |
|  |  | :caption: :download:`envoy-demo-tls-client-auth.yaml <\_include/envoy-demo-tls-client-auth.yaml>` |
|  |  |  |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[docs/root/version\_history/current.rst](#diff-486ddf71f632f6537c18c0735baa4eb49e33ce2646092a74f2ba7f63a346ed09 "docs/root/version_history/current.rst")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/docs/root/version_history/current.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -80,6 +80,7 @@ New Features |
|  |  | \* thrift\_proxy: add host level success/error metrics where success is a reply of type success and error is any other response to a call. |
|  |  | \* thrift\_proxy: support header flags. |
|  |  | \* thrift\_proxy: support subset lb when using request or route metadata. |
|  |  | \* tls: added support for :ref:`match\_typed\_subject\_alt\_names <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_typed\_subject\_alt\_names>` for subject alternative names to enforce specifying the subject alternative name type for the matcher to prevent matching against an unintended type in the certificate. |
|  |  | \* tls: added support for only verifying the leaf CRL in the certificate chain with :ref:`only\_verify\_leaf\_cert\_crl <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.only\_verify\_leaf\_cert\_crl>`. |
|  |  | \* tls: support loading certificate chain and private key via :ref:`pkcs12 <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.TlsCertificate.pkcs12>`. |
|  |  | \* tls\_inspector filter: added :ref:`enable\_ja3\_fingerprinting <envoy\_v3\_api\_field\_extensions.filters.listener.tls\_inspector.v3.TlsInspector.enable\_ja3\_fingerprinting>` to create JA3 fingerprint hash from Client Hello message. |
| Expand All | | @@ -95,4 +96,5 @@ Deprecated |
|  |  | \* bootstrap: :ref:`dns\_resolution\_config <envoy\_v3\_api\_field\_config.bootstrap.v3.Bootstrap.dns\_resolution\_config>` is deprecated in favor of :ref:`typed\_dns\_resolver\_config <envoy\_v3\_api\_field\_config.bootstrap.v3.Bootstrap.typed\_dns\_resolver\_config>`. |
|  |  | \* cluster: :ref:`dns\_resolution\_config <envoy\_v3\_api\_field\_config.cluster.v3.Cluster.dns\_resolution\_config>` is deprecated in favor of :ref:`typed\_dns\_resolver\_config <envoy\_v3\_api\_field\_config.cluster.v3.Cluster.typed\_dns\_resolver\_config>`. |
|  |  | \* dns\_cache: :ref:`dns\_resolution\_config <envoy\_v3\_api\_field\_extensions.common.dynamic\_forward\_proxy.v3.DnsCacheConfig.dns\_resolution\_config>` is deprecated in favor of :ref:`typed\_dns\_resolver\_config <envoy\_v3\_api\_field\_extensions.common.dynamic\_forward\_proxy.v3.DnsCacheConfig.typed\_dns\_resolver\_config>`. |
|  |  | \* tls: :ref:`match\_subject\_alt\_names <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_subject\_alt\_names>` has been deprecated in favor of the :ref:`match\_typed\_subject\_alt\_names <envoy\_v3\_api\_field\_extensions.transport\_sockets.tls.v3.CertificateValidationContext.match\_typed\_subject\_alt\_names>`. |
|  |  | \* dns\_filter: :ref:`dns\_resolution\_config <envoy\_v3\_api\_field\_extensions.filters.udp.dns\_filter.v3.DnsFilterConfig.ClientContextConfig.dns\_resolution\_config>` is deprecated in favor of :ref:`typed\_dns\_resolver\_config <envoy\_v3\_api\_field\_extensions.filters.udp.dns\_filter.v3.DnsFilterConfig.ClientContextConfig.typed\_dns\_resolver\_config>`. |

3 changes: 2 additions & 1 deletion

3
[envoy/ssl/certificate\_validation\_context\_config.h](#diff-e841326c25ac5e409806d5f3bde0599789339aabb7dfa7835fc27773314a8362 "envoy/ssl/certificate_validation_context_config.h")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/envoy/ssl/certificate_validation_context_config.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,6 +7,7 @@ |
|  |  | #include "envoy/api/api.h" |
|  |  | #include "envoy/common/pure.h" |
|  |  | #include "envoy/extensions/transport\_sockets/tls/v3/cert.pb.h" |
|  |  | #include "envoy/extensions/transport\_sockets/tls/v3/common.pb.h" |
|  |  | #include "envoy/type/matcher/v3/string.pb.h" |
|  |  |  |
|  |  | #include "absl/types/optional.h" |
| Expand Down  Expand Up | | @@ -43,7 +44,7 @@ class CertificateValidationContextConfig { |
|  |  | /\*\* |
|  |  | \* @return The subject alt name matchers to be verified, if enabled. |
|  |  | \*/ |
|  |  | virtual const std::vector<envoy::type::matcher::v3::StringMatcher>& |
|  |  | virtual const std::vector<envoy::extensions::transport\_sockets::tls::v3::SubjectAltNameMatcher>& |
|  |  | subjectAltNameMatchers() const PURE; |
|  |  |  |
|  |  | /\*\* |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[examples/double-proxy/envoy-backend.yaml](#diff-e3cf2720e8fc79372b175135b4043e2a287c17985186532b28c665d29ecd07ea "examples/double-proxy/envoy-backend.yaml")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/examples/double-proxy/envoy-backend.yaml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -26,8 +26,10 @@ static\_resources: |
|  |  | private\_key: |
|  |  | filename: certs/serverkey.pem |
|  |  | validation\_context: |
|  |  | match\_subject\_alt\_names: |
|  |  | - exact: proxy-postgres-frontend.example.com |
|  |  | match\_typed\_subject\_alt\_names: |
|  |  | - san\_type: DNS |
|  |  | matcher: |
|  |  | exact: proxy-postgres-frontend.example.com |
|  |  | trusted\_ca: |
|  |  | filename: certs/cacert.pem |
|  |  |  |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[examples/double-proxy/envoy-frontend.yaml](#diff-1ee73ee40d5ef3851c99532707004d013b94041eeaf60230d461185e5b849a61 "examples/double-proxy/envoy-frontend.yaml")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/examples/double-proxy/envoy-frontend.yaml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -36,7 +36,9 @@ static\_resources: |
|  |  | private\_key: |
|  |  | filename: certs/clientkey.pem |
|  |  | validation\_context: |
|  |  | match\_subject\_alt\_names: |
|  |  | - exact: proxy-postgres-backend.example.com |
|  |  | match\_typed\_subject\_alt\_names: |
|  |  | - san\_type: DNS |
|  |  | matcher: |
|  |  | exact: proxy-postgres-backend.example.com |
|  |  | trusted\_ca: |
|  |  | filename: certs/cacert.pem |

1 change: 1 addition & 0 deletions

1
[source/common/ssl/BUILD](#diff-92d56f286991907337a784c459e75ffd3f5d4c8a8bcea8814f4dc019bd61741e "source/common/ssl/BUILD")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/source/common/ssl/BUILD)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,6 +32,7 @@ envoy\_cc\_library( |
|  |  | "//envoy/ssl:certificate\_validation\_context\_config\_interface", |
|  |  | "//source/common/common:empty\_string", |
|  |  | "//source/common/config:datasource\_lib", |
|  |  | "@envoy\_api//envoy/config/core/v3:pkg\_cc\_proto", |
|  |  | "@envoy\_api//envoy/extensions/transport\_sockets/tls/v3:pkg\_cc\_proto", |
|  |  | "@envoy\_api//envoy/type/matcher/v3:pkg\_cc\_proto", |
|  |  | ], |
| Expand Down | |  |

35 changes: 33 additions & 2 deletions

35
[source/common/ssl/certificate\_validation\_context\_config\_impl.cc](#diff-cf088136dc052ddf1762fb3c96c0e8de472f3031f288e7e300558e6e72c8e129 "source/common/ssl/certificate_validation_context_config_impl.cc")

Show comments

[View file](/envoyproxy/envoy/blob/bb95af848c939cfe5b5ee33c5b1770558077e64e/source/common/ssl/certificate_validation_context_config_impl.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,10 +1,13 @@ |
|  |  | #include "source/common/ssl/certificate\_validation\_context\_config\_impl.h" |
|  |  |  |
|  |  | #include "envoy/common/exception.h" |
|  |  | #include "envoy/config/core/v3/extension.pb.h" |
|  |  | #include "envoy/extensions/transport\_sockets/tls/v3/cert.pb.h" |
|  |  | #include "envoy/extensions/transport\_sockets/tls/v3/common.pb.h" |
|  |  |  |
|  |  | #include "source/common/common/empty\_string.h" |
|  |  | #include "source/common/common/fmt.h" |
|  |  | #include "source/common/common/logger.h" |
|  |  | #include "source/common/config/datasource.h" |
|  |  |  |
|  |  | namespace Envoy { |
| Expand All | | @@ -22,8 +25,7 @@ CertificateValidationContextConfigImpl::CertificateValidationContextConfigImpl( |
|  |  | certificate\_revocation\_list\_path\_( |
|  |  | Config::DataSource::getPath(config.crl()) |
|  |  | .value\_or(certificate\_revocation\_list\_.empty() ? EMPTY\_STRING : INLINE\_STRING)), |
|  |  | subject\_alt\_name\_matchers\_(config.match\_subject\_alt\_names().begin(), |
|  |  | config.match\_subject\_alt\_names().end()), |
|  |  | subject\_alt\_name\_matchers\_(getSubjectAltNameMatchers(config)), |
|  |  | verify\_certificate\_hash\_list\_(config.verify\_certificate\_hash().begin(), |
|  |  | config.verify\_certificate\_hash().end()), |
|  |  | verify\_certificate\_spki\_list\_(config.verify\_certificate\_spki().begin(), |
| Expand Down  Expand Up | | @@ -51,5 +53,34 @@ CertificateValidationContextConfigImpl::CertificateValidationContextConfigImpl( |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | std::vector<envoy::extensions::transport\_sockets::tls::v3::SubjectAltNameMatcher> |
|  |  | CertificateValidationContextConfigImpl::getSubjectAltNameMatchers( |
|  |  | const envoy::extensions::transport\_sockets::tls::v3::CertificateValidationContext& config) { |
|  |  | if (!config.match\_typed\_subject\_alt\_names().empty() && |
|  |  | !config.match\_subject\_alt\_names().empty()) { |
|  |  | throw EnvoyException("SAN-based verification using both match\_typed\_subject\_alt\_names and " |
|  |  | "the deprecated match\_subject\_alt\_names is not allowed"); |
|  |  | } |
|  |  | std::vector<envoy::extensions::transport\_sockets::tls::v3::SubjectAltNameMatcher> |
|  |  | subject\_alt\_name\_matchers(config.match\_typed\_subject\_alt\_names().begin(), |
|  |  | config.match\_typed\_subject\_alt\_names().end()); |
|  |  | // Handle deprecated string type san matchers without san type specified, by |
|  |  | // creating a matcher for each supported type. |
|  |  | for (const envoy::type::matcher::v3::StringMatcher& matcher : config.match\_subject\_alt\_names()) { |
|  |  | static constexpr std::array< |
|  |  | envoy::extensions::transport\_sockets::tls::v3::SubjectAltNameMatcher::SanType, 4> |
|  |  | san\_types{envoy::extensions::transport\_sockets::tls::v3::SubjectAltNameMatcher::DNS, |
|  |  | envoy::extensions::transport\_sockets::tls::v3::SubjectAltNameMatcher::URI, |
|  |  | envoy::extensions::transport\_sockets::tls::v3::SubjectAltNameMatcher::EMAIL, |
|  |  | envoy::extensions::transport\_sockets::tls::v3::SubjectAltNameMatcher::IP\_ADDRESS}; |
|  |  | for (const auto san\_type : san\_types) { |
|  |  | subject\_alt\_name\_matchers.emplace\_back(); |
|  |  | subject\_alt\_name\_matchers.back().set\_san\_type(san\_type); |
|  |  | \*subject\_alt\_name\_matchers.back().mutable\_matcher() = matcher; |
|  |  | } |
|  |  | } |
|  |  | return subject\_alt\_name\_matchers; |
|  |  | } |
|  |  |  |
|  |  | } // namespace Ssl |
|  |  | } // namespace Envoy |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `bb95af8`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fenvoyproxy%2Fenvoy%2Fcommit%2Fbb95af848c939cfe5b5ee33c5b1770558077e64e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


