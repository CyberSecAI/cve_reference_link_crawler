

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3023398)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3023397 "Changeset 3023397")
* [Next Changeset](/changeset/3023399 "Changeset 3023399") →

---

# Changeset 3023398

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
01/18/2024 09:39:19 AM
([12 months](/timeline?from=2024-01-18T09%3A39%3A19Z&precision=second "See timeline at 01/18/2024 09:39:19 AM") ago)

Author:
cifi
Message:

Increase plugin security against CSS

Location:
[squirrly-seo/trunk](/browser/squirrly-seo/trunk?rev=3023398)
Files:

2 edited

* [classes/helpers/Sanitize.php](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398 "Show entry in browser")
  (modified)
  ([19 diffs](#file0 "Show differences"))
* [models/Settings.php](/browser/squirrly-seo/trunk/models/Settings.php?rev=3023398 "Show entry in browser")
  (modified)
  ([4 diffs](#file1 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [squirrly-seo/trunk/classes/helpers/Sanitize.php](/changeset/3023398/squirrly-seo/trunk/classes/helpers/Sanitize.php "Show the changeset 3023398 restricted to squirrly-seo/trunk/classes/helpers/Sanitize.php")

  | [r2961460](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L87 "Show revision 2961460 of this file in browser") | [r3023398](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L87 "Show revision 3023398 of this file in browser") |  |
  | --- | --- | --- |
  | 87 | 87 | return $description; |
  | 88 | 88 | } |
  |  | 89 |  |
  |  | 90 | /\*\* |
  |  | 91 | \* Clear the field string |
  |  | 92 | \* |
  |  | 93 | \* @param  $value |
  |  | 94 | \* @return mixed|null|string|string[] |
  |  | 95 | \*/ |
  |  | 96 | public static function sanitizeField($value) |
  |  | 97 | { |
  |  | 98 |  |
  |  | 99 | if(is\_array($value)){ |
  |  | 100 | return array\_map(array('SQ\_Classes\_Helpers\_Sanitize', 'sanitizeField'), $value); |
  |  | 101 | } |
  |  | 102 |  |
  |  | 103 | if (is\_string($value) && $value <> '') { |
  |  | 104 |  |
  |  | 105 | $search = array( |
  |  | 106 | "'<!--(.\*?)-->'is", |
  |  | 107 | "'<script[^>]\*?>.\*?<\/script>'si", // strip out javascript |
  |  | 108 | "'<style[^>]\*?>.\*?<\/style>'si", // strip out styles |
  |  | 109 | "'<form.\*?<\/form>'si", |
  |  | 110 | "'<iframe.\*?<\/iframe>'si", |
  |  | 111 | "'&lt;!--(.\*?)--&gt;'is", |
  |  | 112 | "'&lt;script&gt;.\*?&lt;\/script&gt;'si", // strip out javascript |
  |  | 113 | "'&lt;style&gt;.\*?&lt;\/style&gt;'si", // strip out styles |
  |  | 114 | ); |
  |  | 115 | $value = preg\_replace($search, "", $value); |
  |  | 116 |  |
  |  | 117 | $search = array( |
  |  | 118 | "/&nbsp;/si", |
  |  | 119 | "/\s{2,}/", |
  |  | 120 | ); |
  |  | 121 | $value = preg\_replace($search, " ", $value); |
  |  | 122 |  |
  |  | 123 | //more sanitization |
  |  | 124 | $value = wp\_strip\_all\_tags($value); |
  |  | 125 | $value = ent2ncr($value); |
  |  | 126 | $value = trim($value); |
  |  | 127 |  |
  |  | 128 | $value = SQ\_Classes\_Helpers\_Sanitize::i18n($value); |
  |  | 129 |  |
  |  | 130 | } |
  |  | 131 |  |
  |  | 132 | return $value; |
  |  | 133 | } |
  | 89 | 134 |  |
  | 90 | 135 | /\*\* |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L240) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L285) |  |
  | 240 | 285 | { |
  | 241 | 286 | if ($phone <> '') { |
  | 242 |  | $phone = '+' . ltrim($phone, '+'); |
  |  | 287 | $phone = self::sanitizeField($phone); |
  |  | 288 | $phone = '+' . ltrim($phone, '+'); |
  | 243 | 289 | } |
  | 244 | 290 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L267) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L313) |  |
  | 267 | 313 | if ($code == '') SQ\_Classes\_Error::setError(esc\_html\_\_("The code for Google Webmaster Tool is incorrect.", 'squirrly-seo')); |
  | 268 | 314 | } |
  | 269 |  | return $code; |
  |  | 315 |  |
  |  | 316 | return self::sanitizeField($code); |
  | 270 | 317 | } |
  | 271 | 318 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L296) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L343) |  |
  | 296 | 343 | } |
  | 297 | 344 | } |
  | 298 |  | return trim($code); |
  |  | 345 |  |
  |  | 346 | return self::sanitizeField($code); |
  | 299 | 347 | } |
  | 300 | 348 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L328) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L376) |  |
  | 328 | 376 | } |
  | 329 | 377 | } else { |
  | 330 |  | ~~return $code~~; |
  |  | 378 | return self::sanitizeField($code); |
  | 331 | 379 | } |
  | 332 | 380 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L360) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L408) |  |
  | 360 | 408 | if ($code == '') SQ\_Classes\_Error::setError(esc\_html\_\_("The code for Pinterest is incorrect.", 'squirrly-seo')); |
  | 361 | 409 | } |
  | 362 |  | return $code; |
  |  | 410 |  |
  |  | 411 | return self::sanitizeField($code); |
  | 363 | 412 | } |
  | 364 | 413 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L386) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L435) |  |
  | 386 | 435 | if ($code == '') SQ\_Classes\_Error::setError(esc\_html\_\_("The code for Bing is incorrect.", 'squirrly-seo')); |
  | 387 | 436 | } |
  | 388 |  | return $code; |
  |  | 437 |  |
  |  | 438 | return self::sanitizeField($code); |
  | 389 | 439 | } |
  | 390 | 440 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L412) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L462) |  |
  | 412 | 462 | if ($code == '') SQ\_Classes\_Error::setError(esc\_html\_\_("The code for Baidu is incorrect.", 'squirrly-seo')); |
  | 413 | 463 | } |
  | 414 |  | return $code; |
  |  | 464 |  |
  |  | 465 | return self::sanitizeField($code); |
  | 415 | 466 | } |
  | 416 | 467 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L438) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L489) |  |
  | 438 | 489 | if ($code == '') SQ\_Classes\_Error::setError(esc\_html\_\_("The code for Yandex is incorrect.", 'squirrly-seo')); |
  | 439 | 490 | } |
  | 440 |  | return $code; |
  |  | 491 |  |
  |  | 492 | return self::sanitizeField($code); |
  | 441 | 493 | } |
  | 442 | 494 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L453) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L505) |  |
  | 453 | 505 | } |
  | 454 | 506 |  |
  | 455 |  | return ~~$account~~; |
  |  | 507 | return esc\_url($account); |
  | 456 | 508 | } |
  | 457 | 509 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L474) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L526) |  |
  | 474 | 526 | } |
  | 475 | 527 |  |
  | 476 |  | ~~return $account~~; |
  |  | 528 | return self::sanitizeField($account); |
  | 477 | 529 | } |
  | 478 | 530 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L488) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L540) |  |
  | 488 | 540 | $account = 'https://plus.google.com/' . $account; |
  | 489 | 541 | } |
  | 490 |  | return ~~str\_replace(" ", "+", $account~~); |
  |  | 542 | return esc\_url(str\_replace(" ", "+", $account)); |
  | 491 | 543 | } |
  | 492 | 544 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L502) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L554) |  |
  | 502 | 554 | $account = 'https://www.linkedin.com/in/' . $account; |
  | 503 | 555 | } |
  | 504 |  | return ~~$account~~; |
  |  | 556 | return esc\_url($account); |
  | 505 | 557 | } |
  | 506 | 558 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L516) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L568) |  |
  | 516 | 568 | $account = 'https://www.facebook.com/' . $account; |
  | 517 | 569 | } |
  | 518 |  | return ~~$account~~; |
  |  | 570 | return esc\_url($account); |
  | 519 | 571 | } |
  | 520 | 572 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L530) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L582) |  |
  | 530 | 582 | $account = 'https://www.pinterest.com/' . $account; |
  | 531 | 583 | } |
  | 532 |  | return ~~$account~~; |
  |  | 584 | return esc\_url($account); |
  | 533 | 585 | } |
  | 534 | 586 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L544) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L596) |  |
  | 544 | 596 | $account = 'https://www.instagram.com/' . $account; |
  | 545 | 597 | } |
  | 546 |  | return ~~$account~~; |
  |  | 598 | return esc\_url($account); |
  | 547 | 599 | } |
  | 548 | 600 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L560) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L612) |  |
  | 560 | 612 | } |
  | 561 | 613 | } |
  | 562 |  | return ~~$account~~; |
  |  | 614 | return esc\_url($account); |
  | 563 | 615 | } |
  | 564 | 616 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L576) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L628) |  |
  | 576 | 628 | } |
  | 577 | 629 | } |
  | 578 |  | return ~~$code~~; |
  |  | 630 | return self::sanitizeField($code); |
  | 579 | 631 | } |
  | 580 | 632 |  |
  | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=2961460#L592) | […](/browser/squirrly-seo/trunk/classes/helpers/Sanitize.php?rev=3023398#L644) |  |
  | 592 | 644 | } |
  | 593 | 645 | } |
  | 594 |  | return ~~$code~~; |
  |  | 646 | return self::sanitizeField($code); |
  | 595 | 647 | } |
  | 596 | 648 |  |
* ## [squirrly-seo/trunk/models/Settings.php](/changeset/3023398/squirrly-seo/trunk/models/Settings.php "Show the changeset 3023398 restricted to squirrly-seo/trunk/models/Settings.php")

  | [r2995638](/browser/squirrly-seo/trunk/models/Settings.php?rev=2995638#L104 "Show revision 2995638 of this file in browser") | [r3023398](/browser/squirrly-seo/trunk/models/Settings.php?rev=3023398#L104 "Show revision 3023398 of this file in browser") |  |
  | --- | --- | --- |
  | 104 | 104 | if ( in\_array( $key, array\_keys( SQ\_Classes\_Helpers\_Tools::$options ) ) ) { |
  | 105 | 105 |  |
  |  | 106 | //Sanitize each value from subarray |
  |  | 107 | $value = SQ\_Classes\_Helpers\_Tools::getValue( $key ); |
  |  | 108 | $value = SQ\_Classes\_Helpers\_Sanitize::sanitizeField( $value ); |
  |  | 109 |  |
  | 106 | 110 | //Initialize the array for some options |
  | 107 | 111 | if ( in\_array( $key, array( 'sq\_sla\_exclude\_post\_types' ) ) ) { |
  | […](/browser/squirrly-seo/trunk/models/Settings.php?rev=2995638#L111) | […](/browser/squirrly-seo/trunk/models/Settings.php?rev=3023398#L115) |  |
  | 111 | 115 | if ( is\_array( SQ\_Classes\_Helpers\_Tools::$options[ $key ] ) ) { |
  | 112 | 116 |  |
  | 113 |  | //Sanitize each value from subarray |
  | 114 |  | $array = SQ\_Classes\_Helpers\_Tools::getValue( $key ); |
  |  | 117 | //Save the array values |
  |  | 118 | if ( is\_array( $value ) ) { |
  |  | 119 | if ( ! empty( $value ) ) { |
  | 115 | 120 |  |
  | 116 |  | //Save the array values |
  | 117 |  | if ( is\_array( $array ) ) { |
  | 118 |  | if ( ! empty( $array ) ) { |
  | 119 |  | foreach ( $array as $subkey => $subvalue ) { |
  |  | 121 | foreach ( $value as $subkey => $subvalue ) { |
  |  | 122 |  |
  | 120 | 123 | switch ( $subkey ) { |
  | 121 | 124 | case 'google\_wt': |
  | […](/browser/squirrly-seo/trunk/models/Settings.php?rev=2995638#L172) | […](/browser/squirrly-seo/trunk/models/Settings.php?rev=3023398#L175) |  |
  | 172 | 175 | break; |
  | 173 | 176 | } |
  |  | 177 |  |
  | 174 | 178 | SQ\_Classes\_Helpers\_Tools::$options[ $key ][ $subkey ] = $subvalue; |
  | 175 | 179 | } |
  | […](/browser/squirrly-seo/trunk/models/Settings.php?rev=2995638#L177) | […](/browser/squirrly-seo/trunk/models/Settings.php?rev=3023398#L181) |  |
  | 177 | 181 | } |
  | 178 | 182 |  |
  | 179 |  | //~~sanitize the value and save it~~ |
  |  | 183 | // save options in db |
  | 180 | 184 | SQ\_Classes\_Helpers\_Tools::saveOptions(); |
  |  | 185 |  |
  | 181 | 186 | } else { |
  | 182 |  |  |
  | 183 |  | //sanitize the value and save it |
  | 184 |  | SQ\_Classes\_Helpers\_Tools::saveOptions( $key, SQ\_Classes\_Helpers\_Tools::getValue( $key ) ); |
  |  | 187 | // save option in db |
  |  | 188 | SQ\_Classes\_Helpers\_Tools::saveOptions( $key, $value ); |
  | 185 | 189 | } |
  | 186 | 190 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3023398)
* [Zip Archive](?format=zip&new=3023398)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

