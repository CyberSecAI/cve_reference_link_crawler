
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffreedomofpress%2Fdangerzone%2Fpull%2F491)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffreedomofpress%2Fdangerzone%2Fpull%2F491)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=freedomofpress%2Fdangerzone)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[freedomofpress](/freedomofpress)
/
**[dangerzone](/freedomofpress/dangerzone)**
Public

* [Notifications](/login?return_to=%2Ffreedomofpress%2Fdangerzone) You must be signed in to change notification settings
* [Fork
  178](/login?return_to=%2Ffreedomofpress%2Fdangerzone)
* [Star
   3.9k](/login?return_to=%2Ffreedomofpress%2Fdangerzone)

* [Code](/freedomofpress/dangerzone)
* [Issues
  179](/freedomofpress/dangerzone/issues)
* [Pull requests
  5](/freedomofpress/dangerzone/pulls)
* [Discussions](/freedomofpress/dangerzone/discussions)
* [Actions](/freedomofpress/dangerzone/actions)
* [Projects
  1](/freedomofpress/dangerzone/projects)
* [Wiki](/freedomofpress/dangerzone/wiki)
* [Security](/freedomofpress/dangerzone/security)
* [Insights](/freedomofpress/dangerzone/pulse)

Additional navigation options

* [Code](/freedomofpress/dangerzone)
* [Issues](/freedomofpress/dangerzone/issues)
* [Pull requests](/freedomofpress/dangerzone/pulls)
* [Discussions](/freedomofpress/dangerzone/discussions)
* [Actions](/freedomofpress/dangerzone/actions)
* [Projects](/freedomofpress/dangerzone/projects)
* [Wiki](/freedomofpress/dangerzone/wiki)
* [Security](/freedomofpress/dangerzone/security)
* [Insights](/freedomofpress/dangerzone/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Ffreedomofpress%2Fdangerzone%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Ffreedomofpress%2Fdangerzone%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Sanitize sandbox output #491

 Merged

[apyrgio](/apyrgio)
merged 9 commits into
[main](/freedomofpress/dangerzone/tree/main "freedomofpress/dangerzone:main")
from
[2023-07-sanitize-progress-update](/freedomofpress/dangerzone/tree/2023-07-sanitize-progress-update "freedomofpress/dangerzone:2023-07-sanitize-progress-update")

Aug 1, 2023

 Merged

# [Sanitize sandbox output](#top) #491

[apyrgio](/apyrgio)
merged 9 commits into
[main](/freedomofpress/dangerzone/tree/main "freedomofpress/dangerzone:main")
from
[2023-07-sanitize-progress-update](/freedomofpress/dangerzone/tree/2023-07-sanitize-progress-update "freedomofpress/dangerzone:2023-07-sanitize-progress-update")

Aug 1, 2023

[Conversation
5](/freedomofpress/dangerzone/pull/491)
[Commits
9](/freedomofpress/dangerzone/pull/491/commits)
[Checks
0](/freedomofpress/dangerzone/pull/491/checks)
[Files changed](/freedomofpress/dangerzone/pull/491/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![apyrgio](https://avatars.githubusercontent.com/u/2507626?s=60&v=4)](/apyrgio)

Copy link

Contributor

### @apyrgio **[apyrgio](/apyrgio)** commented [Jul 31, 2023](#issue-1828758801)

Sanitize the output that the container/disposable VM sends back to the user, before displaying it on screen/terminal. Also tackle some issues that are closely related to the sanitization logic, and add some tests.

Sorry, something went wrong.

All reactions

 [![@apyrgio](https://avatars.githubusercontent.com/u/2507626?s=40&u=4eee9caa771456a939b68681e83c774a3892e83d&v=4)](/apyrgio)
[apyrgio](/apyrgio)
[force-pushed](/freedomofpress/dangerzone/compare/3e5e28035a95a076416f2e9a5b6073cfcb9cad29..2d3457d90bb15d781766db5e52fb7ab3b24aa3b2)
the
2023-07-sanitize-progress-update

branch
from
[`3e5e280`](/freedomofpress/dangerzone/commit/3e5e28035a95a076416f2e9a5b6073cfcb9cad29) to
[`2d3457d`](/freedomofpress/dangerzone/commit/2d3457d90bb15d781766db5e52fb7ab3b24aa3b2)  [Compare](/freedomofpress/dangerzone/compare/3e5e28035a95a076416f2e9a5b6073cfcb9cad29..2d3457d90bb15d781766db5e52fb7ab3b24aa3b2)
[July 31, 2023 11:08](#event-9962514498)

[![deeplow](https://avatars.githubusercontent.com/u/47065258?s=60&v=4)](/deeplow)

**[deeplow](/deeplow)**
approved these changes
[Jul 31, 2023](#pullrequestreview-1554548960)

 [View reviewed changes](/freedomofpress/dangerzone/pull/491/files)

Copy link

Contributor

### @deeplow **[deeplow](/deeplow)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

One tiny comment, but otherwise a quite a good hardening. And thanks for catching also the GUI plaintext part.

Sorry, something went wrong.

All reactions

[dangerzone/isolation\_provider/base.py](/freedomofpress/dangerzone/pull/491/files#diff-35352ce9d51f52831cedb264204c4df8392e3576971a27efdad766e00ca51eb7)

Show resolved

Hide resolved

[![deeplow](https://avatars.githubusercontent.com/u/47065258?s=60&v=4)](/deeplow)

**[deeplow](/deeplow)**
reviewed
[Aug 1, 2023](#pullrequestreview-1556399207)

 [View reviewed changes](/freedomofpress/dangerzone/pull/491/files)

[Makefile](/freedomofpress/dangerzone/pull/491/files#diff-76ed074a9305c04054cdebb9e9aad2d818052b07091de1f20cad0bbac34ffb52)

Show resolved

Hide resolved

 [apyrgio](/apyrgio)
and others
added 9 commits
[August 1, 2023 14:38](#commits-pushed-9768714)

[![@apyrgio](https://avatars.githubusercontent.com/u/2507626?s=40&v=4)](/apyrgio)

`[Make isort compatible with Black](/freedomofpress/dangerzone/pull/491/commits/9768714b4a83a541390dab0f32f6388043adbd23 "Make isort compatible with Black

The isort tool is not compatible with Black by default. This leads to a
tug of war between these tools, when we run `make lint-apply` -> `make
lint`. Fix this by forcing isort to be compatible with Black.")`
 …

`[9768714](/freedomofpress/dangerzone/pull/491/commits/9768714b4a83a541390dab0f32f6388043adbd23)`

```
The isort tool is not compatible with Black by default. This leads to a
tug of war between these tools, when we run `make lint-apply` -> `make
lint`. Fix this by forcing isort to be compatible with Black.
```

[![@apyrgio](https://avatars.githubusercontent.com/u/2507626?s=40&v=4)](/apyrgio)

`[Add missing reset ANSI sequence](/freedomofpress/dangerzone/pull/491/commits/77f4b8115c109a4002cd58aa8ba069ed53f0a42e "Add missing reset ANSI sequence

Do not forget to reset the red text once we print an error string to the
terminal")`
 …

`[77f4b81](/freedomofpress/dangerzone/pull/491/commits/77f4b8115c109a4002cd58aa8ba069ed53f0a42e)`

```
Do not forget to reset the red text once we print an error string to the
terminal
```

[![@apyrgio](https://avatars.githubusercontent.com/u/2507626?s=40&v=4)](/apyrgio)

`[Run GUI tests on separate processes](/freedomofpress/dangerzone/pull/491/commits/a72a31980d43e3463db45bef9f1d47654065678e "Run GUI tests on separate processes

Run our GUI tests on separate processes, because the combination of
Ubuntu Focal, Qt5, PySide6, and pytest-qt somehow leads to segfaults,
probably due to stale global state.

Closes #493")`
 …

`[a72a319](/freedomofpress/dangerzone/pull/491/commits/a72a31980d43e3463db45bef9f1d47654065678e)`

```
Run our GUI tests on separate processes, because the combination of
Ubuntu Focal, Qt5, PySide6, and pytest-qt somehow leads to segfaults,
probably due to stale global state.

Closes [#493](https://github.com/freedomofpress/dangerzone/issues/493)
```

[![@apyrgio](https://avatars.githubusercontent.com/u/2507626?s=40&v=4)](/apyrgio)

`[Force rendering of error messages as plain text](/freedomofpress/dangerzone/pull/491/commits/cb08c198ad3c349d34a0ddd6b20a180e8162a4b0 "Force rendering of error messages as plain text

Make the `error_label` widget always render messages as plain text,
instead of auto discovering if the text is rich. We need this because
the error message may contain input from the sandbox, which we consider
untrusted.")`
 …

`[cb08c19](/freedomofpress/dangerzone/pull/491/commits/cb08c198ad3c349d34a0ddd6b20a180e8162a4b0)`

```
Make the `error_label` widget always render messages as plain text,
instead of auto discovering if the text is rich. We need this because
the error message may contain input from the sandbox, which we consider
untrusted.
```

[![@deeplow](https://avatars.githubusercontent.com/u/47065258?s=40&v=4)](/deeplow) [![@apyrgio](https://avatars.githubusercontent.com/u/2507626?s=40&v=4)](/apyrgio)

`[Add utility for sanitizing strings](/freedomofpress/dangerzone/pull/491/commits/3788139d26556b39896de329e6a2f2b2b1a2d406 "Add utility for sanitizing strings

Add `replace_control_chars()` function in `util.py`, which can be used
to sanitize strings from ANSI escape sequences or weird Unicode symbols.")`
 …

`[3788139](/freedomofpress/dangerzone/pull/491/commits/3788139d26556b39896de329e6a2f2b2b1a2d406)`

```
Add `replace_control_chars()` function in `util.py`, which can be used
to sanitize strings from ANSI escape sequences or weird Unicode symbols.
```

[![@apyrgio](https://avatars.githubusercontent.com/u/2507626?s=40&v=4)](/apyrgio)

`[Sanitize filenames before logging them](/freedomofpress/dangerzone/pull/491/commits/cfa0c01d8fe87d2f3ff187a93a5e984d64352067 "Sanitize filenames before logging them

Sanitize filenames in various places in the code, before we write them
to the user's terminal. Filenames, especially in Linux, can contain
virtually any character except for '\0' and '/', so it's important to
sanitize them.")`
 …

`[cfa0c01](/freedomofpress/dangerzone/pull/491/commits/cfa0c01d8fe87d2f3ff187a93a5e984d64352067)`

```
Sanitize filenames in various places in the code, before we write them
to the user's terminal. Filenames, especially in Linux, can contain
virtually any character except for '\0' and '/', so it's important to
sanitize them.
```

[![@apyrgio](https://avatars.githubusercontent.com/u/2507626?s=40&v=4)](/apyrgio)

`[Sanitize progress reports in a provider-agnostic way](/freedomofpress/dangerzone/pull/491/commits/9410b68c1df82b03d568e584bf87942d5224d865 "Sanitize progress reports in a provider-agnostic way

Update the common `print_progress()` method in the base
`IsolationProvider` class, with two extra features:

1. Always sanitize the provided text argument.
2. Mark the sanitized text argument as untrusted.

This is default behavior from now on, since this function is commonly
used to parse progress reports from the conversion sandbox.")`
 …

`[9410b68](/freedomofpress/dangerzone/pull/491/commits/9410b68c1df82b03d568e584bf87942d5224d865)`

```
Update the common `print_progress()` method in the base
`IsolationProvider` class, with two extra features:

1. Always sanitize the provided text argument.
2. Mark the sanitized text argument as untrusted.

This is default behavior from now on, since this function is commonly
used to parse progress reports from the conversion sandbox.
```

[![@deeplow](https://avatars.githubusercontent.com/u/47065258?s=40&v=4)](/deeplow) [![@apyrgio](https://avatars.githubusercontent.com/u/2507626?s=40&v=4)](/apyrgio)

`[container: Improve parsing of progress reports](/freedomofpress/dangerzone/pull/491/commits/72536a05ac3e6114ccd1261dac64c46041fff6b8 "container: Improve parsing of progress reports

Improve the `parse_progress()` method of the container isolation
provider in the following ways:

1. Make sure that the fields of the progress report have the expected
   type.
2. In case of a JSON parsing error, sanitize the invalid string so that
   it doesn't contain escape sequences, or the user considers it as
   trusted.")`
 …

`[72536a0](/freedomofpress/dangerzone/pull/491/commits/72536a05ac3e6114ccd1261dac64c46041fff6b8)`

```
Improve the `parse_progress()` method of the container isolation
provider in the following ways:

1. Make sure that the fields of the progress report have the expected
   type.
2. In case of a JSON parsing error, sanitize the invalid string so that
   it doesn't contain escape sequences, or the user considers it as
   trusted.
```

[![@apyrgio](https://avatars.githubusercontent.com/u/2507626?s=40&v=4)](/apyrgio)

`[qubes: Mark Dangerzone messages as trusted](/freedomofpress/dangerzone/pull/491/commits/6c374d8a7e994f796bfcbbed71b15602a81a39b7 "qubes: Mark Dangerzone messages as trusted

Mark the messages that Dangerzone creates once a conversion step
finishes as trusted, since they do not contain any string not controlled
by us.")`
 …

`[6c374d8](/freedomofpress/dangerzone/pull/491/commits/6c374d8a7e994f796bfcbbed71b15602a81a39b7)`

```
Mark the messages that Dangerzone creates once a conversion step
finishes as trusted, since they do not contain any string not controlled
by us.
```

 [![@apyrgio](https://avatars.githubusercontent.com/u/2507626?s=40&u=4eee9caa771456a939b68681e83c774a3892e83d&v=4)](/apyrgio)
[apyrgio](/apyrgio)
[force-pushed](/freedomofpress/dangerzone/compare/09f866fbbf37afa750f308b5751b20e0a9c883e9..6c374d8a7e994f796bfcbbed71b15602a81a39b7)
the
2023-07-sanitize-progress-update

branch
from
[`09f866f`](/freedomofpress/dangerzone/commit/09f866fbbf37afa750f308b5751b20e0a9c883e9) to
[`6c374d8`](/freedomofpress/dangerzone/commit/6c374d8a7e994f796bfcbbed71b15602a81a39b7)  [Compare](/freedomofpress/dangerzone/compare/09f866fbbf37afa750f308b5751b20e0a9c883e9..6c374d8a7e994f796bfcbbed71b15602a81a39b7)
[August 1, 2023 11:44](#event-9975504790)

[![@apyrgio](https://avatars.githubusercontent.com/u/2507626?s=40&u=4eee9caa771456a939b68681e83c774a3892e83d&v=4)](/apyrgio)
[apyrgio](/apyrgio)
merged commit [`6c374d8`](/freedomofpress/dangerzone/commit/6c374d8a7e994f796bfcbbed71b15602a81a39b7)
into
main

[Aug 1, 2023](https://github.com/freedomofpress/dangerzone/pull/491#event-9975840947)

 [![@deeplow](https://avatars.githubusercontent.com/u/47065258?s=40&u=8ef9a95c82083b58fa757ba4c09a393cfac23b35&v=4)](/deeplow)
[deeplow](/deeplow)
deleted the
2023-07-sanitize-progress-update

branch
[August 9, 2023 07:37](#event-10043447659)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Ffreedomofpress%2Fdangerzone%2Fpull%2F491)

Reviewers

[![@deeplow](https://avatars.githubusercontent.com/u/47065258?s=40&v=4)](/deeplow) [deeplow](/deeplow)

deeplow approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@apyrgio](https://avatars.githubusercontent.com/u/2507626?s=52&v=4)](/apyrgio) [![@deeplow](https://avatars.githubusercontent.com/u/47065258?s=52&v=4)](/deeplow)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

