Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**

The vulnerability stems from the `BaseUser.login` function in the Piccolo ORM. The function's implementation caused different response times based on whether a user existed or not. If a user did not exist, the function returned `None` immediately. If a user existed, it proceeded to perform a time-expensive hash comparison. This difference in response times allowed for user enumeration.

**Weaknesses/Vulnerabilities Present:**

*   **Time-based user enumeration:** The primary vulnerability is the ability to determine whether a user exists on the platform by observing the time it takes for the server to respond to login requests.

**Impact of Exploitation:**

*   **User enumeration:** Attackers could generate lists of valid usernames on a Piccolo-based platform.
*   **Password spray attacks:** The generated user lists could be used in password spray attacks, attempting to gain access to user accounts.

**Attack Vectors:**

*   **Network requests:** The attacker sends login requests to the server with different usernames and measures the response times.

**Required Attacker Capabilities/Position:**

*   **Network access:** The attacker needs to be able to send HTTP requests to the login endpoint.
*   **Basic scripting skills:** The attacker needs to be able to write a script to automate requests and measure response times.
*  **No authentication required**: The vulnerability is exposed to any unauthenticated user.

**Additional Details:**

*   The provided proof of concept (PoC) demonstrates the vulnerability by sending requests with valid and invalid user credentials and showing a clear time difference in responses.
*   The vulnerability was present in versions <= 0.120.0.
*   The patch in version 0.121.0 mitigates the issue by calling the `hash_password` function even when a user is not found, to provide consistent timing.

**Code Changes in the Patch**

The code diff in the provided content shows that the fix includes adding a call to `cls.hash_password(password)` before returning `None`, when no user is found, to mitigate the ability to enumerate users via response timings.