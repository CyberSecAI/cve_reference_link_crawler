=== Content from www.wordfence.com_d75e8f5f_20250111_151403.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# jQuery T(-) Countdown Widget <= 2.3.25 - Authenticated (Contributor+) Stored Cross-Site Scripting via tminus Shortcode

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   jQuery T(-) Countdown Widget <= 2.3.25 - Authenticated (Contributor+) Stored Cross-Site Scripting via tminus Shortcode

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-4783](https://www.cve.org/CVERecord?id=CVE-2024-4783) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | May 22, 2024 |
| Last Updated | July 2, 2024 |
| Researcher | [Krzysztof Zając - CERT PL](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/krzysztof-zajac) |

### Description

The jQuery T(-) Countdown Widget plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the plugin's tminus shortcode in all versions up to, and including, 2.3.25 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers, with contributor-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page. CVE-2024-37247 may be a duplicate of this issue.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/jquery-t-countdown-widget/trunk/countdown-timer.php#L768)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fjquery-t-countdown-widget%2Fjquery-t-countdown-widget-2325-authenticated-contributor-stored-cross-site-scripting-via-tminus-shortcode&t=jQuery%20T%28-%29%20Countdown%20Widget%20%3C%3D%202.3.25%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20tminus%20Shortcode "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fjquery-t-countdown-widget%2Fjquery-t-countdown-widget-2325-authenticated-contributor-stored-cross-site-scripting-via-tminus-shortcode&text=jQuery%20T%28-%29%20Countdown%20Widget%20%3C%3D%202.3.25%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20tminus%20Shortcode "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fjquery-t-countdown-widget%2Fjquery-t-countdown-widget-2325-authenticated-contributor-stored-cross-site-scripting-via-tminus-shortcode "LinkedIn")
Email

## Vulnerability Details for jQuery T(-) Countdown Widget

#### [jQuery T(-) Countdown Widget](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/jquery-t-countdown-widget)

| Software Type | Plugin |
| --- | --- |
| Software Slug | jquery-t-countdown-widget [(view on wordpress.org)](https://wordpress.org/plugins/jquery-t-countdown-widget) |
| Patched? | No |
| Remediation | No known patch available. Please review the vulnerability's details in depth and employ mitigations based on your organization's risk tolerance. It may be best to uninstall the affected software and find a replacement. |
| Affected Version | * <= 2.3.25 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_a77a4479_20250111_151402.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fjquery-t-countdown-widget%2Ftrunk%2Fcountdown-timer.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/jquery-t-countdown-widget/trunk/countdown-timer.php?rev=2846659 "Revision 2846659")
* Next Revision →
* [Blame](/browser/jquery-t-countdown-widget/trunk/countdown-timer.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/jquery-t-countdown-widget/trunk/countdown-timer.php)

---

# [source:](/browser?order=name "Go to repository root") [jquery-t-countdown-widget](/browser/jquery-t-countdown-widget?order=name "View jquery-t-countdown-widget")/[trunk](/browser/jquery-t-countdown-widget/trunk?order=name "View trunk")/[countdown-timer.php](/browser/jquery-t-countdown-widget/trunk/countdown-timer.php?order=name "View countdown-timer.php")

View diff against:

View revision:

| [Last change](/changeset/3003598/jquery-t-countdown-widget/trunk/countdown-timer.php "View differences") on this file was [3003598](/changeset/3003598/ "View changeset 3003598"), checked in by baden03, [14 months ago](/timeline?from=2023-11-30T07%3A42%3A25Z&precision=second "See timeline at 11/30/2023 07:42:25 AM") |
| --- |
| fixing issue wiht printf function |
| **File size:** 43.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | Plugin Name: jQuery T(-) Countdown Widget |
| [4](#L4) | Text Domain: jquery-t-countdown-widget |
| [5](#L5) | Plugin URI: https://pluginoven.com/plugins/t-countdown/ |
| [6](#L6) | Description: Display and configure multiple T(-) Countdown timers using a shortcode or sidebar widget. |
| [7](#L7) | Version: 2.3.25 |
| [8](#L8) | Author: twinpictures, baden03 |
| [9](#L9) | Author URI: https://www.twinpictures.de/ |
| [10](#L10) | License: GPL2 |
| [11](#L11) | \*/ |
| [12](#L12) |  |
| [13](#L13) | class WP\_TMinusCD { |
| [14](#L14) | var $plugin\_name = 'jQuery T(-) Countdown Widget'; |
| [15](#L15) | var $version = '2.3.25'; |
| [16](#L16) | var $domain = 'tminus'; |
| [17](#L17) | var $plguin\_options\_page\_title = 'jQuery T(-) Countdown Widget Options'; |
| [18](#L18) | var $plugin\_options\_menue\_title = 'jQuery T(-) Countdown Widget'; |
| [19](#L19) | var $plugin\_options\_slug = 't-countdown'; |
| [20](#L20) |  |
| [21](#L21) | var $options\_name = 'WP\_TMC\_options'; |
| [22](#L22) | /\*\* |
| [23](#L23) | \* @var array |
| [24](#L24) | \*/ |
| [25](#L25) | var $options = array( |
| [26](#L26) | 'custom\_css' => '', |
| [27](#L27) | 'rockstar' => '', |
| [28](#L28) | 'force\_css' => '', |
| [29](#L29) | ); |
| [30](#L30) |  |
| [31](#L31) | var $license\_group = 'tminus\_countdown\_licenseing'; |
| [32](#L32) | var $license\_name = 'WP\_tminus\_countdown\_license'; |
| [33](#L33) |  |
| [34](#L34) | var $license\_options = array( |
| [35](#L35) | 'tminus\_event\_license\_key' => '', |
| [36](#L36) | 'tminus\_event\_license\_status' => '', |
| [37](#L37) | ); |
| [38](#L38) |  |
| [39](#L39) | function \_\_construct() { |
| [40](#L40) | $this->\_set\_options(); |
| [41](#L41) |  |
| [42](#L42) | // add actions |
| [43](#L43) | add\_action( 'admin\_menu', array( $this, 'admin\_menu' ) ); |
| [44](#L44) | add\_action( 'admin\_enqueue\_scripts', array( $this, 'tminus\_admin\_scripts' ) ); |
| [45](#L45) | add\_action( 'plugin\_action\_links\_' . plugin\_basename(\_\_FILE\_\_), array( $this, 'plugin\_actions' ) ); |
| [46](#L46) | add\_action( 'admin\_init', array( $this, 'admin\_init' ) ); |
| [47](#L47) | add\_action( 'wp\_head', array( $this, 'plugin\_head\_inject' ) ); |
| [48](#L48) | add\_action( 'wp\_enqueue\_scripts', array( $this, 'countdown\_scripts' ) ); |
| [49](#L49) | add\_action( 'plugins\_loaded', array( $this, 'tminus\_load\_textdomain' ) ); |
| [50](#L50) | // add\_action( 'admin\_notices', array( $this, 'tminus\_version\_notice' ) ); |
| [51](#L51) | } |
| [52](#L52) |  |
| [53](#L53) | /\*\* |
| [54](#L54) | \* Callback admin\_menu |
| [55](#L55) | \*/ |
| [56](#L56) | function admin\_menu() { |
| [57](#L57) | if ( function\_exists( 'add\_options\_page' ) AND current\_user\_can( 'manage\_options' ) ) { |
| [58](#L58) | // add options page |
| [59](#L59) | $options\_page = add\_options\_page($this->plguin\_options\_page\_title, $this->plugin\_options\_menue\_title, 'manage\_options', $this->plugin\_options\_slug, array( $this, 'options\_page' )); |
| [60](#L60) | } |
| [61](#L61) | } |
| [62](#L62) |  |
| [63](#L63) | /\*\* |
| [64](#L64) | \* Callback admin\_init |
| [65](#L65) | \*/ |
| [66](#L66) | function admin\_init() { |
| [67](#L67) | register\_setting( $this->domain, $this->options\_name ); |
| [68](#L68) | if( is\_plugin\_active( 't-countdown-events/t-countdown-events.php' ) ){ |
| [69](#L69) | register\_setting( $this->license\_group, $this->license\_name, array('WP\_TminusEvents', 'edd\_sanitize\_license') ); |
| [70](#L70) | } |
| [71](#L71) | } |
| [72](#L72) |  |
| [73](#L73) | /\*\* |
| [74](#L74) | \* Load textdomain. |
| [75](#L75) | \* |
| [76](#L76) | \* @since 2.5.6 |
| [77](#L77) | \*/ |
| [78](#L78) | function tminus\_load\_textdomain() { |
| [79](#L79) | load\_plugin\_textdomain( 'jquery-t-countdown-widget' ); |
| [80](#L80) | } |
| [81](#L81) |  |
| [82](#L82) | function tminus\_version\_notice() { |
| [83](#L83) | ?> |
| [84](#L84) | <div class="notice notice-warning is-dismissible"> |
| [85](#L85) | <p><?php printf( \_\_('Notice: jQuery T(-) Countdown Widget is a legacy plugin and will no longer be supported. Please update to the actively developed version: %sT(-) Countdown%s', 'jquery-t-countdown-widget'), '<a href="https://wordpress.org/plugins/t-countdown/" target="\_blank">', '</a>' ); ?></p> |
| [86](#L86) | </div> |
| [87](#L87) | <?php |
| [88](#L88) | } |
| [89](#L89) |  |
| [90](#L90) | // Add link to options page from plugin list |
| [91](#L91) | function plugin\_actions($links) { |
| [92](#L92) | $new\_links = array(); |
| [93](#L93) | $new\_links[] = '<a href="options-general.php?page='.$this->plugin\_options\_slug.'">' . \_\_('Settings', 'jquery-t-countdown-widget') . '</a>'; |
| [94](#L94) | return array\_merge($new\_links, $links); |
| [95](#L95) | } |
| [96](#L96) |  |
| [97](#L97) | //plugin header inject |
| [98](#L98) | function plugin\_head\_inject(){ |
| [99](#L99) | // custom script |
| [100](#L100) | echo "<script type='text/javascript'>\n"; |
| [101](#L101) | $response = array( 'now' => date( 'n/j/Y H:i:s', strtotime(current\_time('mysql')))); |
| [102](#L102) | echo "var tminusnow = '".json\_encode($response)."';\n"; |
| [103](#L103) | echo "</script>"; |
| [104](#L104) |  |
| [105](#L105) | // custom css |
| [106](#L106) | if( !empty( $this->options['custom\_css'] ) ){ |
| [107](#L107) | echo "<style>\n"; |
| [108](#L108) | echo $this->options['custom\_css']; |
| [109](#L109) | echo "\n</style>\n"; |
| [110](#L110) | } |
| [111](#L111) | } |
| [112](#L112) |  |
| [113](#L113) | //load scripts on the widget admin page |
| [114](#L114) | function tminus\_admin\_scripts($hook){ |
| [115](#L115) | global $pagenow; |
| [116](#L116) | if( $hook == 'widgets.php' && $pagenow != 'customize.php'){ |
| [117](#L117) | //jquery datepicker |
| [118](#L118) | wp\_enqueue\_script( 'jquery-ui-datepicker' ); |
| [119](#L119) | wp\_enqueue\_script( 'jquery-ui-slider' ); |
| [120](#L120) |  |
| [121](#L121) | wp\_register\_style('jquery-ui-css', '//ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css', array (), '1.11.4' ); |
| [122](#L122) | wp\_enqueue\_style('jquery-ui-css'); |
| [123](#L123) |  |
| [124](#L124) |  |
| [125](#L125) | $plugin\_url = plugins\_url() .'/'. dirname( plugin\_basename(\_\_FILE\_\_) ); |
| [126](#L126) |  |
| [127](#L127) | //jquery widget scripts |
| [128](#L128) | wp\_register\_script('jquery-ui-timepicker-addon', $plugin\_url.'/js/jquery-ui-timepicker-addon.min.js', array ('jquery'), '1.6.3', true); |
| [129](#L129) | wp\_enqueue\_script('jquery-ui-timepicker-addon'); |
| [130](#L130) |  |
| [131](#L131) | wp\_register\_style('jquery-datepicker-css', $plugin\_url.'/admin/jquery-ui-timepicker-addon.min.css' ); |
| [132](#L132) | wp\_enqueue\_style('jquery-datepicker-css'); |
| [133](#L133) |  |
| [134](#L134) | wp\_register\_script('tminus-admin-script', $plugin\_url.'/js/jquery.collapse.js', array ('jquery', 'jquery-ui-datepicker', 'jquery-ui-slider', 'jquery-ui-timepicker-addon'), '1.2.2', true); |
| [135](#L135) | wp\_enqueue\_script('tminus-admin-script'); |
| [136](#L136) |  |
| [137](#L137) | wp\_register\_style('collapse-admin-css', $plugin\_url.'/admin/collapse-style.css' ); |
| [138](#L138) | wp\_enqueue\_style('collapse-admin-css'); |
| [139](#L139) | } |
| [140](#L140) | } |
| [141](#L141) |  |
| [142](#L142) | //load front-end countdown scripts |
| [143](#L143) | function countdown\_scripts(){ |
| [144](#L144) | $plugin\_url = plugins\_url() .'/'. dirname( plugin\_basename(\_\_FILE\_\_) ); |
| [145](#L145) |  |
| [146](#L146) | //lwtCountdown script |
| [147](#L147) | wp\_register\_script('countdown-script', $plugin\_url.'/js/jquery.t-countdown.js', array ('jquery'), '2.4.0', 'true'); |
| [148](#L148) | wp\_enqueue\_script('countdown-script'); |
| [149](#L149) |  |
| [150](#L150) | //force load styles |
| [151](#L151) | if( !empty( $this->options['force\_css'] ) ){ |
| [152](#L152) | $style = $this->options['force\_css']; |
| [153](#L153) | $style\_file\_url = plugins\_url('/css/'.$style.'/style.css', \_\_FILE\_\_); |
| [154](#L154) | wp\_register\_style( 'countdown-'.$style.'-css', $style\_file\_url, array(), '2.0'); |
| [155](#L155) | wp\_enqueue\_style( 'countdown-'.$style.'-css' ); |
| [156](#L156) | } |
| [157](#L157) |  |
| [158](#L158) | // callback for t(-) events |
| [159](#L159) | wp\_localize\_script( 'countdown-script', 'tCountAjax', array( |
| [160](#L160) | 'ajaxurl' => admin\_url( 'admin-ajax.php' ), |
| [161](#L161) | 'countdownNonce' => wp\_create\_nonce( 'tountajax-countdownonce-nonce' ), |
| [162](#L162) | )); |
| [163](#L163) | } |
| [164](#L164) |  |
| [165](#L165) |  |
| [166](#L166) | /\*\* |
| [167](#L167) | \* Admin options page |
| [168](#L168) | \*/ |
| [169](#L169) | function options\_page() { |
| [170](#L170) | $like\_it\_arr = array( |
| [171](#L171) | \_\_('made you feel all warm and fuzzy on the inside', 'jquery-t-countdown-widget'), |
| [172](#L172) | \_\_('restored your faith in humanity... even if only for a fleeting second', 'jquery-t-countdown-widget'), |
| [173](#L173) | \_\_('rocked your world', 'provided a positive vision of future living', 'jquery-t-countdown-widget'), |
| [174](#L174) | \_\_('inspired you to commit a random act of kindness', 'jquery-t-countdown-widget'), |
| [175](#L175) | \_\_('encouraged more regular flossing of the teeth', 'jquery-t-countdown-widget'), |
| [176](#L176) | \_\_('helped organize your life in the small ways that matter', 'jquery-t-countdown-widget'), |
| [177](#L177) | \_\_('saved your minutes--if not tens of minutes--writing your own solution', 'jquery-t-countdown-widget'), |
| [178](#L178) | \_\_('brightened your day... or darkened it if sleeping in', 'jquery-t-countdown-widget'), |
| [179](#L179) | \_\_('caused you to dance a little jig of joy and joyousness', 'jquery-t-countdown-widget'), |
| [180](#L180) | \_\_('inspired you to tweet a little @twinpictues social love', 'jquery-t-countdown-widget'), |
| [181](#L181) | \_\_('tasted great, while also being less filling', 'jquery-t-countdown-widget'), |
| [182](#L182) | \_\_('caused you to shout: "everybody spread love, give me some mo!"', 'jquery-t-countdown-widget'), |
| [183](#L183) | \_\_('really tied the room together, Dude', 'jquery-t-countdown-widget'), |
| [184](#L184) | \_\_('helped you keep the funk alive', 'jquery-t-countdown-widget'), |
| [185](#L185) | \_\_('<a href="https://www.youtube.com/watch?v=dvQ28F5fOdU" target="\_blank">soften hands while you do dishes</a>', 'jquery-t-countdown-widget'), |
| [186](#L186) | \_\_('helped that little old lady <a href="https://www.youtube.com/watch?v=Ug75diEyiA0" target="\_blank">find the beef</a>', 'jquery-t-countdown-widget') |
| [187](#L187) | ); |
| [188](#L188) | $rand\_key = array\_rand($like\_it\_arr); |
| [189](#L189) | $like\_it = $like\_it\_arr[$rand\_key]; |
| [190](#L190) |  |
| [191](#L191) | $share\_it\_arr = array( |
| [192](#L192) | 'https://www.facebook.com/twinpictures', |
| [193](#L193) | 'https://twitter.com/twinpictures', |
| [194](#L194) | 'https://plus.google.com/+TwinpicturesDe', |
| [195](#L195) | 'https://wordpress.org/support/view/plugin-reviews/jquery-t-countdown-widget' |
| [196](#L196) | ); |
| [197](#L197) | $rand\_key = array\_rand($share\_it\_arr); |
| [198](#L198) | $share\_it = $share\_it\_arr[$rand\_key]; |
| [199](#L199) |  |
| [200](#L200) | ?> |
| [201](#L201) | <div class="wrap"> |
| [202](#L202) | <h2><?php echo $this->plguin\_options\_page\_title; ?></h2> |
| [203](#L203) | </div> |
| [204](#L204) |  |
| [205](#L205) | <div class="postbox-container metabox-holder meta-box-sortables" style="width: 69%"> |
| [206](#L206) | <div style="margin:0 5px;"> |
| [207](#L207) | <div class="postbox"> |
| [208](#L208) | <div class="handlediv" title="<?php \_e( 'Click to toggle', 'jquery-t-countdown-widget' ) ?>"><br/></div> |
| [209](#L209) | <h3 class="handle"><?php \_e( 'T(-) Countdown Settings', 'jquery-t-countdown-widget' ) ?></h3> |
| [210](#L210) | <div class="inside"> |
| [211](#L211) | <form method="post" action="options.php"> |
| [212](#L212) | <?php |
| [213](#L213) | settings\_fields( $this->domain ); |
| [214](#L214) | $options = $this->options; |
| [215](#L215) | ?> |
| [216](#L216) |  |
| [217](#L217) | <table class="form-table"> |
| [218](#L218) | <tr> |
| [219](#L219) | <th><?php \_e( 'Rockstar Features', 'jquery-t-countdown-widget' ) ?>:</th> |
| [220](#L220) | <td><label><input type="checkbox" id="<?php echo $this->options\_name ?>[rockstar]" name="<?php echo $this->options\_name ?>[rockstar]" value="rockstar"  <?php echo checked( $options['rockstar'], 'rockstar' ); ?> /> <?php \_e('Enable', 'jquery-t-countdown-widget'); ?> |
| [221](#L221) | <br /><span class="description"><?php \_e('Enable rockstar features.', 'jquery-t-countdown-widget'); ?></span></label> |
| [222](#L222) | </td> |
| [223](#L223) | </tr> |
| [224](#L224) |  |
| [225](#L225) |  |
| [226](#L226) | <tr> |
| [227](#L227) | <th><?php \_e( 'Force Load CSS', 'jquery-t-countdown-widget' ) ?>:</th> |
| [228](#L228) | <td><label> |
| [229](#L229) | <select name="<?php echo $this->options\_name ?>[force\_css]" id="<?php echo $this->options\_name ?>[force\_css]"> |
| [230](#L230) | <option value=''> </option> |
| [231](#L231) | <?php |
| [232](#L232) | $styles\_arr = CountDownTimer::get\_styles(); |
| [233](#L233) | foreach($styles\_arr as $style\_name){ |
| [234](#L234) | $selected = ""; |
| [235](#L235) | if($options['force\_css'] == $style\_name){ |
| [236](#L236) | $selected = 'SELECTED'; |
| [237](#L237) | } |
| [238](#L238) | echo '<option value="'.$style\_name.'" '.$selected.'>'.$style\_name.'</option>'; |
| [239](#L239) | } |
| [240](#L240) | ?> |
| [241](#L241) | </select> |
| [242](#L242) | <br /><span class="description"><?php \_e('Force a css style to load in the header', 'jquery-t-countdown-widget'); ?></span></label> |
| [243](#L243) | </td> |
| [244](#L244) | </tr> |
| [245](#L245) |  |
| [246](#L246) | <tr> |
| [247](#L247) | <th><?php \_e( 'Custom CSS', 'jquery-t-countdown-widget' ) ?>:</th> |
| [248](#L248) | <td><label><textarea id="<?php echo $this->options\_name ?>[custom\_css]" name="<?php echo $this->options\_name ?>[custom\_css]" style="width: 100%; height: 537px;"><?php echo $options['custom\_css']; ?></textarea> |
| [249](#L249) | <br /><span class="description"><?php \_e( 'Custom CSS style for <em>ultimate flexibility</em>', 'jquery-t-countdown-widget' ) ?></span></label> |
| [250](#L250) | </td> |
| [251](#L251) | </tr> |
| [252](#L252) | </table> |
| [253](#L253) | <p class="submit" style="margin-bottom: 20px;"> |
| [254](#L254) | <input class="button-primary" type="submit" value="<?php \_e( 'Save Changes', 'jquery-t-countdown-widget' ) ?>" style="float: right;" /> |
| [255](#L255) | </p> |
| [256](#L256) | </form> |
| [257](#L257) | </div> |
| [258](#L258) | </div> |
| [259](#L259) | </div> |
| [260](#L260) | </div> |
| [261](#L261) |  |
| [262](#L262) | <div class="postbox-container side metabox-holder" style="width:29%;"> |
| [263](#L263) | <div style="margin:0 5px;"> |
| [264](#L264) | <div class="postbox"> |
| [265](#L265) | <h3><?php \_e( 'About' ) ?></h3> |
| [266](#L266) | <div class="inside"> |
| [267](#L267) | <h4><?php echo $this->plugin\_name; ?> <?php \_e('Version', 'jquery-t-countdown-widget'); ?> <?php echo $this->version; ?></h4> |
| [268](#L268) | <p><?php printf( \_\_('Notice: jQuery T(-) Countdown Widget is a legacy plugin and will no longer be supported. Please update to the actively developed version: %sT(-) Countdown%s', 'jquery-t-countdown-widget'), '<a href="https://wordpress.org/plugins/t-countdown/">', '</a>'); ?></p> |
| [269](#L269) | <p><?php \_e( 'T(-) Countdown is a highly customizable, HTML5 countdown timer that can be displayed as a sidebar widget or in a post or page using a shortcode.', 'jquery-t-countdown-widget') ?></p> |
| [270](#L270) | <ul> |
| [271](#L271) | <li><?php printf( \_\_( '%sDetailed documentation%s, complete with working demonstrations of all shortcode attributes, is available for your instructional enjoyment.', 'jquery-t-countdown-widget'),'<a href="https://pluginoven.com/plugins/t-countdown/documentation/" target="\_blank">', '</a>'); ?></li> |
| [272](#L272) | <li><?php printf( \_\_( 'A %sCommunity translation%s tool has been set up that allows anyone to assist in translating T(-) Countdown.','jquery-t-countdown-widget'), '<a href="https://translate.wordpress.org/projects/wp-plugins/jquery-t-countdown-widget/" target="\_blank">', '</a>'); ?></li> |
| [273](#L273) | <li><?php printf( \_\_( 'If this plugin %s, please consider %ssharing your story%s with others.', 'jquery-t-countdown-widget' ), $like\_it, '<a href="'.$share\_it.'" target="\_blank">', '</a>'); ?></li> |
| [274](#L274) | <li><a href="https://wordpress.org/plugins/jquery-t-countdown-widget/" target="\_blank">WordPress.org</a> | <a href="https://pluginoven.com/plugins/t-countdown/" target="\_blank">Twinpictues Plugin Oven</a></li> |
| [275](#L275) | </ul> |
| [276](#L276) | </ul> |
| [277](#L277) | </div> |
| [278](#L278) | </div> |
| [279](#L279) | </div> |
| [280](#L280) | </div> |
| [281](#L281) |  |
| [282](#L282) | <div class="postbox-container side metabox-holder meta-box-sortables" style="width:29%;"> |
| [283](#L283) | <div style="margin:0 5px;"> |
| [284](#L284) | <div class="postbox"> |
| [285](#L285) | <div class="handlediv" title="<?php \_e( 'Click to toggle' ) ?>"><br/></div> |
| [286](#L286) | <h3 class="handle"><?php \_e( 'T(-) Countdown Control' ) ?></h3> |
| [287](#L287) | <div class="inside"> |
| [288](#L288) | <p><?php printf(\_\_( '%sT(-) Countdown Control%s is our premium plugin that manages and schedules multiple recurring countdown timers for repeating events.', 'jquery-t-countdown-widget' ), '<a href="https://plugins.twinpictures.de/premium-plugins/t-minus-countdown-control/?utm\_source=t-countdown&utm\_medium=plugin-settings-page&utm\_content=t-countdown&utm\_campaign=t-control-sidebar">', '</a>'); ?></p> |
| [289](#L289) | <?php /\*<p style="padding: 5px; border: 1px dashed #cccc66; background: #EEE;"><strong>Last Chance for 2015 Prices:</strong> <a href="https://plugins.twinpictures.de/premium-plugins/t-minus-countdown-control/?utm\_source=t-countdown-widget&utm\_medium=plugin-settings-page&utm\_content=t-countdown-control&utm\_campaign=t-control-year-end">Update to T(-) Countdown Control</a> before January 2016 to take advantage of 2015 pricing.</p>\*/ ?> |
| [290](#L290) | <h4><?php \_e('Reasons To Go Pro', 'jquery-t-countdown-widget'); ?></h4> |
| [291](#L291) | <ol> |
| [292](#L292) | <li><?php \_e('Schedule and manage multiple recurring countdowns', 'jquery-t-countdown-widget'); ?></li> |
| [293](#L293) | <li><?php \_e('Highly responsive professional support', 'jquery-t-countdown-widget'); ?></li> |
| [294](#L294) | <li><?php printf(\_\_('%sT(-) Countdown Control Testimonials%s', 'jquery-t-countdown-widget'), '<a href="https://plugins.twinpictures.de/testimonial/t-countdown-control-testimonias/" target="\_blank">', '</a>'); ?></li> |
| [295](#L295) | <?php /\*<li><?php \_e("You'd like to take advantage of 2015 pricing while it's still 2015", "jquery-t-countdown-widget"); ?></li>\*/ ?> |
| [296](#L296) | </ol> |
| [297](#L297) | </div> |
| [298](#L298) | </div> |
| [299](#L299) | </div> |
| [300](#L300) | <div class="clear"></div> |
| [301](#L301) | </div> |
| [302](#L302) |  |
| [303](#L303) | <?php if( is\_plugin\_active( 't-countdown-events/t-countdown-events.php' ) ) : ?> |
| [304](#L304) |  |
| [305](#L305) | <div class="postbox-container side metabox-holder" style="width:29%;"> |
| [306](#L306) | <div style="margin:0 5px;"> |
| [307](#L307) | <div class="postbox"> |
| [308](#L308) | <h3 class="handle"><?php \_e( 'Register T(-) Countdown Events', 'jquery-t-countdown-widget') ?></h3> |
| [309](#L309) | <div class="inside"> |
| [310](#L310) | <p><?php printf( \_\_('To receive plugin updates you must register your plugin. Enter your T(-) Countdown Events licence key below. Licence keys may be viewed and managed by logging into %syour account%s.', 'jquery-t-countdown-widget'), '<a href="https://plugins.twinpictures.de/your-account/" target="\_blank">', '</a>'); ?></p> |
| [311](#L311) | <form method="post" action="options.php"> |
| [312](#L312) | <?php |
| [313](#L313) | settings\_fields( $this->license\_group ); |
| [314](#L314) | $options = get\_option($this->license\_name); |
| [315](#L315) | $tce\_licence = ( !isset( $options['tminus\_event\_license\_key'] ) ) ? '' : $options['tminus\_event\_license\_key']; |
| [316](#L316) | ?> |
| [317](#L317) | <fieldset> |
| [318](#L318) | <table style="width: 100%"> |
| [319](#L319) | <tbody> |
| [320](#L320) | <tr> |
| [321](#L321) | <th><?php \_e( 'License Key', 'jquery-t-countdown-widget' ) ?>:</th> |
| [322](#L322) | <td><label for="<?php echo $this->license\_name ?>[tminus\_event\_license\_key]"><input type="password" id="<?php echo $this->license\_name ?>[tminus\_event\_license\_key]" name="<?php echo $this->license\_name ?>[tminus\_event\_license\_key]" value="<?php esc\_attr\_e( $tce\_licence ); ?>" style="width: 100%" /> |
| [323](#L323) | <br /><span class="description"><?php \_e('Enter your license key', 'jquery-t-countdown-widget'); ?></span></label> |
| [324](#L324) | </td> |
| [325](#L325) |  |
| [326](#L326) | </tr> |
| [327](#L327) |  |
| [328](#L328) | <?php if( isset($options['tminus\_event\_license\_key']) ) { ?> |
| [329](#L329) | <tr valign="top"> |
| [330](#L330) | <th><?php \_e('License Status', 'jquery-t-countdown-widget'); ?>:</th> |
| [331](#L331) | <td> |
| [332](#L332) | <?php if( isset($options['tminus\_event\_license\_status']) && $options['tminus\_event\_license\_status'] == 'valid' ) { ?> |
| [333](#L333) | <span style="color:green;"><?php \_e('active'); ?></span><br/> |
| [334](#L334) | <input type="submit" class="button-secondary" name="edd\_tce\_license\_deactivate" value="<?php \_e('Deactivate License'); ?>"/> |
| [335](#L335) | <?php } else { |
| [336](#L336) | if( isset($options['tminus\_event\_license\_status'])){ ?> |
| [337](#L337) | <span style="color: red"><?php echo $options['tminus\_event\_license\_status']; ?></span><br/> |
| [338](#L338) | <?php } else { ?> |
| [339](#L339) | <span style="color: grey">inactive</span><br/> |
| [340](#L340) | <?php } ?> |
| [341](#L341) | <input type="submit" class="button-secondary" name="edd\_tce\_license\_activate" value="<?php \_e('Activate License'); ?>"/> |
| [342](#L342) | <?php } ?> |
| [343](#L343) | </td> |
| [344](#L344) | </tr> |
| [345](#L345) | <?php } ?> |
| [346](#L346) | </tbody> |
| [347](#L347) | </table> |
| [348](#L348) | </fieldset> |
| [349](#L349) | <?php submit\_button( \_\_( 'Register', 'jquery-t-countdown-widget') ); ?> |
| [350](#L350) | </form> |
| [351](#L351) | </div> |
| [352](#L352) | </div> |
| [353](#L353) | </div> |
| [354](#L354) | </div> |
| [355](#L355) | <?php else: ?> |
| [356](#L356) | <div class="postbox-container side metabox-holder meta-box-sortables" style="width:29%;"> |
| [357](#L357) | <div style="margin:0 5px;"> |
| [358](#L358) | <div class="postbox"> |
| [359](#L359) | <div class="handlediv" title="<?php \_e( 'Click to toggle', 'colomat' ) ?>"><br/></div> |
| [360](#L360) | <h3 class="hndle">T(-) Countdown Events</h3> |
| [361](#L361) | <div class="inside"> |
| [362](#L362) | <p><?php printf( \_\_('%sT(-) Countdown Events%s is a new add-on plugin for T(-) Countdown Control that adds multiple event scheduling. Trigger events, such as changing content or firing a javascript function at specific times while the countdown is running.', 'jquery-t-countdown-widget'), '<a href="https://plugins.twinpictures.de/premium-plugins/t-countdown-events/?utm\_source=t-countdown&utm\_medium=plugin-settings-page&utm\_content=t-countdown&utm\_campaign=t-events-sidebar" target="\_blank">', '</a>'); ?></p> |
| [363](#L363) | </div> |
| [364](#L364) | </div> |
| [365](#L365) | </div> |
| [366](#L366) | <div class="clear"></div> |
| [367](#L367) | </div> |
| [368](#L368) | <?php endif; ?> |
| [369](#L369) | <?php |
| [370](#L370) | } |
| [371](#L371) |  |
| [372](#L372) | function \_set\_options() { |
| [373](#L373) | // set options |
| [374](#L374) | $saved\_options = get\_option( $this->options\_name ); |
| [375](#L375) |  |
| [376](#L376) | // set all options |
| [377](#L377) | if ( ! empty( $saved\_options ) ) { |
| [378](#L378) | foreach ( $this->options AS $key => $option ) { |
| [379](#L379) | $this->options[ $key ] = ( empty( $saved\_options[ $key ] ) ) ? '' : $saved\_options[ $key ]; |
| [380](#L380) | } |
| [381](#L381) | } |
| [382](#L382) | } |
| [383](#L383) |  |
| [384](#L384) | } |
| [385](#L385) | $WP\_TMinusCD = new WP\_TMinusCD; |
| [386](#L386) |  |
| [387](#L387) | //style folders array |
| [388](#L388) | function folder\_array($path, $exclude = ".|..") { |
| [389](#L389) | if(is\_dir($path)){ |
| [390](#L390) | $dh = opendir($path); |
| [391](#L391) | $exclude\_array = explode("|", $exclude); |
| [392](#L392) | $result = array(); |
| [393](#L393) | while(false !==($file = readdir($dh))) { |
| [394](#L394) | if( !in\_array(strtolower($file), $exclude\_array) && substr($file, 0, 1) != '.' ){ |
| [395](#L395) | $result[] = $file; |
| [396](#L396) | } |
| [397](#L397) | } |
| [398](#L398) | closedir($dh); |
| [399](#L399) | return $result; |
| [400](#L400) | } |
| [401](#L401) | } |
| [402](#L402) |  |
| [403](#L403) | /\*\* |
| [404](#L404) | \* CountDownTimer Class |
| [405](#L405) | \*/ |
| [406](#L406) | class CountDownTimer extends WP\_Widget { |
| [407](#L407) | /\*\* constructor \*/ |
| [408](#L408) | function \_\_construct() { |
| [409](#L409) |  |
| [410](#L410) | $widget\_ops = array( |
| [411](#L411) | 'classname'             => 'CountDownTimer', |
| [412](#L412) | 'description'   => \_\_( 'A highly customizable jQuery countdown timer by Twinpictures', 'jquery-t-countdown-widget' ) |
| [413](#L413) | ); |
| [414](#L414) |  |
| [415](#L415) | parent::\_\_construct( 'CountDownTimer', \_\_( 'T(-) Countdown', 'jquery-t-countdown-widget' ), $widget\_ops ); |
| [416](#L416) |  |
| [417](#L417) | } |
| [418](#L418) |  |
| [419](#L419) |  |
| [420](#L420) | /\*\* Widget \*/ |
| [421](#L421) | function widget($args, $instance) { |
| [422](#L422) | global $add\_my\_script; |
| [423](#L423) | extract( $args ); |
| [424](#L424) |  |
| [425](#L425) | if(empty($instance['id'])){ |
| [426](#L426) | $instance['id'] = $args['widget\_id']; |
| [427](#L427) | } |
| [428](#L428) |  |
| [429](#L429) | if( empty($instance['t']) ){ |
| [430](#L430) | //ancient |
| [431](#L431) | if( !empty($instance['year']) ){ |
| [432](#L432) | $instance['t'] = $instance['year'].'-'.$instance['month'].'-'.$instance['day'].' '.$instance['hour'].':'.$instance['min'].':'.$instance['sec']; |
| [433](#L433) | $instance['year'] = ''; |
| [434](#L434) | $instance['month'] = ''; |
| [435](#L435) | $instance['day'] = ''; |
| [436](#L436) | $instance['hour'] = ''; |
| [437](#L437) | $instance['min'] = ''; |
| [438](#L438) | $instance['sec'] = ''; |
| [439](#L439) | } |
| [440](#L440) | //old |
| [441](#L441) | else if( !empty( $instance['date'] )){ |
| [442](#L442) | $instance['t'] = $instance['date'].' '.$instance['hour'].':'.$instance['min'].':'.$instance['sec']; |
| [443](#L443) | $instance['date'] = ''; |
| [444](#L444) | $instance['hour'] = ''; |
| [445](#L445) | $instance['min'] = ''; |
| [446](#L446) | $instance['sec'] = ''; |
| [447](#L447) | } |
| [448](#L448) | //empty |
| [449](#L449) | else{ |
| [450](#L450) | $instance['t'] = '2015-05-04 12:00:00'; |
| [451](#L451) | } |
| [452](#L452) | } |
| [453](#L453) |  |
| [454](#L454) | if(!empty($instance['tophtml'])){ |
| [455](#L455) | $instance['before'] = $instance['tophtml']; |
| [456](#L456) | $instance['tophtml'] = ''; |
| [457](#L457) | } |
| [458](#L458) |  |
| [459](#L459) | if(!empty($instance['bothtml'])){ |
| [460](#L460) | $instance['after'] = $instance['bothtml']; |
| [461](#L461) | $instance['bothtml'] = ''; |
| [462](#L462) | } |
| [463](#L463) |  |
| [464](#L464) | $content = ''; |
| [465](#L465) | if(!empty($instance['launchhtml'])){ |
| [466](#L466) | $content = $instance['launchhtml']; |
| [467](#L467) | $instance['launchhtml'] = ''; |
| [468](#L468) | } |
| [469](#L469) |  |
| [470](#L470) | echo $args['before\_widget']; |
| [471](#L471) |  |
| [472](#L472) | if ( !empty($instance['title']) ){ |
| [473](#L473) | echo $args['before\_title']. $instance['title'] . $args['after\_title']; |
| [474](#L474) | } |
| [475](#L475) |  |
| [476](#L476) | $sc\_atts = ''; |
| [477](#L477) | /\* on by one \*/ |
| [478](#L478) | /\* |
| [479](#L479) | if(!empty($instance['id'])){ |
| [480](#L480) | $sc\_atts .= 'id = "'.$instance['id'].'" '; |
| [481](#L481) | } |
| [482](#L482) | \*/ |
| [483](#L483) |  |
| [484](#L484) | /\* filter by key \*/ |
| [485](#L485) | $ok\_keys\_arr = array('id','t','weeks','days','hours','minutes','seconds','omitweeks','style','before','after','width','height','launchwidth','launchheight','launchtarget','jsplacement','event\_id'); |
| [486](#L486) | foreach($instance AS $key => $value){ |
| [487](#L487) | if(in\_array($key, $ok\_keys\_arr) && !empty($value)){ |
| [488](#L488) | if($key == 'before' || $key == 'after'){ |
| [489](#L489) | $value = htmlspecialchars($value); |
| [490](#L490) | } |
| [491](#L491) | $sc\_atts .= $key . '="'.(string) esc\_attr($value).'" '; |
| [492](#L492) | } |
| [493](#L493) | } |
| [494](#L494) |  |
| [495](#L495) | echo do\_shortcode('[tminus '.$sc\_atts.']'.$content.'[/tminus]'); |
| [496](#L496) |  |
| [497](#L497) | echo $args['after\_widget']; |
| [498](#L498) | } |
| [499](#L499) |  |
| [500](#L500) | static function get\_styles($custom\_css = null) { |
| [501](#L501) | //default styles |
| [502](#L502) | $styles\_arr = folder\_array(WP\_PLUGIN\_DIR.'/'. dirname( plugin\_basename(\_\_FILE\_\_) ).'/css'); |
| [503](#L503) | if( !empty( $custom\_css ) ){ |
| [504](#L504) | preg\_match\_all("/.(\w+)-dashboard/", $custom\_css, $custom\_styles); |
| [505](#L505) | $styles\_arr = array\_merge($styles\_arr, $custom\_styles[1]); |
| [506](#L506) | } |
| [507](#L507) | natcasesort($styles\_arr); |
| [508](#L508) | return $styles\_arr; |
| [509](#L509) | } |
| [510](#L510) |  |
| [511](#L511) | function update( $new\_instance, $old\_instance ) { |
| [512](#L512) | $instance = array\_merge($old\_instance, $new\_instance); |
| [513](#L513) |  |
| [514](#L514) | $instance['title'] = (empty( $new\_instance['title'])) ? '' : esc\_attr( $new\_instance['title'] ); |
| [515](#L515) | $instance['omitweeks'] = (empty($new\_instance['omitweeks'])) ? '' : $new\_instance['omitweeks']; |
| [516](#L516) | $instance['jsplacement'] = (empty($new\_instance['jsplacement'])) ? '' : $new\_instance['jsplacement']; |
| [517](#L517) |  |
| [518](#L518) | return $instance; |
| [519](#L519) | } |
| [520](#L520) |  |
| [521](#L521) | /\*\* Form \*/ |
| [522](#L522) | function form($instance) { |
| [523](#L523) | $options = get\_option('WP\_TMC\_options'); |
| [524](#L524) |  |
| [525](#L525) | extract(shortcode\_atts(array( |
| [526](#L526) | 'title' => '', |
| [527](#L527) | 'id' => '', |
| [528](#L528) | 't' => '', |
| [529](#L529) | 'weeks' => '', |
| [530](#L530) | 'days' => '', |
| [531](#L531) | 'hours' => '', |
| [532](#L532) | 'minutes' => '', |
| [533](#L533) | 'seconds' => '', |
| [534](#L534) | 'omitweeks' => '', |
| [535](#L535) | 'style' => 'jedi', |
| [536](#L536) | 'before' => '', |
| [537](#L537) | 'after' => '', |
| [538](#L538) | 'width' => '', |
| [539](#L539) | 'height' => '', |
| [540](#L540) | 'launchwidth' => '', |
| [541](#L541) | 'launchheight' => '', |
| [542](#L542) | 'launchtarget' => 'countdown', |
| [543](#L543) | 'jsplacement' => '', |
| [544](#L544) | 'event\_id' => '', |
| [545](#L545) | ), $instance)); |
| [546](#L546) |  |
| [547](#L547) | //var\_dump($instance); |
| [548](#L548) | if( empty($t) ){ |
| [549](#L549) | //ancient |
| [550](#L550) | if( !empty($instance['year']) ){ |
| [551](#L551) | $t = $instance['year'].'-'.$instance['month'].'-'.$instance['day'].' '.$instance['hour'].':'.$instance['min'].':'.$instance['sec']; |
| [552](#L552) | } |
| [553](#L553) | //old |
| [554](#L554) | else if( !empty( $instance['date'] )){ |
| [555](#L555) | $t = $instance['date'].' '.$instance['hour'].':'.$instance['min'].':'.$instance['sec']; |
| [556](#L556) | } |
| [557](#L557) | } |
| [558](#L558) |  |
| [559](#L559) | //old values remove in a few versions |
| [560](#L560) | if(!empty($instance['jsplacement']) && $instance['jsplacement'] == 'footer'){ |
| [561](#L561) | $jsplacement = ''; |
| [562](#L562) | } |
| [563](#L563) | if(!empty($instance['weektitle'])){ |
| [564](#L564) | $weeks = $instance['weektitle']; |
| [565](#L565) | } |
| [566](#L566) | if(!empty($instance['daytitle'])){ |
| [567](#L567) | $days = $instance['daytitle']; |
| [568](#L568) | } |
| [569](#L569) | if(!empty($instance['hourtitle'])){ |
| [570](#L570) | $hours = $instance['hourtitle']; |
| [571](#L571) | } |
| [572](#L572) | if(!empty($instance['mintitle'])){ |
| [573](#L573) | $minutes = $instance['mintitle']; |
| [574](#L574) | } |
| [575](#L575) | if(!empty($instance['sectitle'])){ |
| [576](#L576) | $seconds = $instance['sectitle']; |
| [577](#L577) | } |
| [578](#L578) |  |
| [579](#L579) | $isrockstar = empty($options['rockstar']) ? '' : $options['rockstar']; |
| [580](#L580) |  |
| [581](#L581) | //rockstar features |
| [582](#L582) | if($isrockstar){ |
| [583](#L583) | $tophtml = empty($instance['tophtml']) ? '' : apply\_filters('widget\_tophtml', stripslashes($instance['tophtml'])); |
| [584](#L584) | $bothtml = empty($instance['bothtml']) ? '' : apply\_filters('widget\_bothtml', stripslashes($instance['bothtml'])); |
| [585](#L585) | $launchhtml = empty($instance['launchhtml']) ? '' : apply\_filters('widget\_launchhtml', stripslashes($instance['launchhtml'])); |
| [586](#L586) |  |
| [587](#L587) | //old values - remove in a vew versions |
| [588](#L588) | if($launchtarget == 'Above Countdown'){ |
| [589](#L589) | $launchtarget = 'above'; |
| [590](#L590) | } |
| [591](#L591) | else if($launchtarget == 'Below Countdown'){ |
| [592](#L592) | $launchtarget = 'below'; |
| [593](#L593) | } |
| [594](#L594) | else if($launchtarget == 'Entire Widget'){ |
| [595](#L595) | $launchtarget = 'countdown'; |
| [596](#L596) | } |
| [597](#L597) | else if($launchtarget == 'Count Up'){ |
| [598](#L598) | $launchtarget = 'countup'; |
| [599](#L599) | } |
| [600](#L600) | } |
| [601](#L601) | ?> |
| [602](#L602) | <p><label><?php \_e('Title:', 'jquery-t-countdown-widget'); ?> <input class="widefat" id="<?php echo $this->get\_field\_id('title'); ?>" name="<?php echo $this->get\_field\_name('title'); ?>" type="text" value="<?php echo esc\_attr($title); ?>" /></label></p> |
| [603](#L603) |  |
| [604](#L604) | <p><label><?php \_e('Target:', 'jquery-t-countdown-widget'); ?> <input style="width: 230px;" id="<?php echo $this->get\_field\_id('t'); ?>" name="<?php echo $this->get\_field\_name('t'); ?>" type="text" value="<?php echo esc\_attr($t); ?>" class="t-datepicker"/></label></p> |
| [605](#L605) | <?php |
| [606](#L606) | if( is\_plugin\_active( 't-countdown-events/t-countdown-events.php' ) ){ |
| [607](#L607) | echo '<p><label>Event: <select name="'.$this->get\_field\_name('event\_id').'" id="'.$this->get\_field\_name('event\_id').'">'; |
| [608](#L608) | echo '<option value="">'.\_\_('Select Event', 'jquery-t-countdown-widget').'</option>'; |
| [609](#L609) | $args = array( |
| [610](#L610) | 'post\_type' => 't-countdown-events', |
| [611](#L611) | 'posts\_per\_page' => -1, |
| [612](#L612) | 'post\_parent' => 0 |
| [613](#L613) | ); |
| [614](#L614) | $event\_query = new WP\_Query($args); |
| [615](#L615) |  |
| [616](#L616) | while ($event\_query->have\_posts()) : $event\_query->the\_post(); |
| [617](#L617) | $eventID = get\_the\_ID(); |
| [618](#L618) | $selected = ""; |
| [619](#L619) | if($event\_id == $eventID){ |
| [620](#L620) | $selected = 'SELECTED'; |
| [621](#L621) | } |
| [622](#L622) | echo '<option value="'.$eventID.'" '.$selected.'>'.get\_the\_title().'</option>'; |
| [623](#L623) | endwhile; |
| [624](#L624) | wp\_reset\_postdata(); |
| [625](#L625) | echo '</select></p>'; |
| [626](#L626) | } |
| [627](#L627) | ?> |
| [628](#L628) | <p><?php \_e('Style:', 'jquery-t-countdown-widget'); ?> <select name="<?php echo $this->get\_field\_name('style'); ?>" id="<?php echo $this->get\_field\_name('style'); ?>"> |
| [629](#L629) | <?php |
| [630](#L630) | $styles\_arr = $this->get\_styles($options['custom\_css']); |
| [631](#L631) | foreach($styles\_arr as $style\_name){ |
| [632](#L632) | $selected = ""; |
| [633](#L633) | if($style == $style\_name){ |
| [634](#L634) | $selected = 'SELECTED'; |
| [635](#L635) | } |
| [636](#L636) | echo '<option value="'.$style\_name.'" '.$selected.'>'.$style\_name.'</option>'; |
| [637](#L637) | } |
| [638](#L638) | ?> |
| [639](#L639) | </select></p> |
| [640](#L640) |  |
| [641](#L641) | <p><label><input type="checkbox" id="<?php echo $this->get\_field\_id('omitweeks'); ?>" name="<?php echo $this->get\_field\_name('omitweeks'); ?>" value="true"  <?php echo checked( $omitweeks, 'true' ); ?> /> <?php \_e('Omit weeks from timer.', 'jquery-t-countdown-widget'); ?></label></p> |
| [642](#L642) |  |
| [643](#L643) | <p><label><input type="checkbox" id="<?php echo $this->get\_field\_id('jsplacement'); ?>" name="<?php echo $this->get\_field\_name('jsplacement'); ?>" value="inline"  <?php echo checked( $jsplacement, 'inline' ); ?> /> <?php \_e('Inject JavaScript Inline.', 'jquery-t-countdown-widget'); ?></label></p> |
| [644](#L644) |  |
| [645](#L645) | <?php |
| [646](#L646) | echo '<h3>'.\_\_('Rockstar Features', 'jquery-t-countdown-widget').'</h3>'; |
| [647](#L647) | if($isrockstar){ |
| [648](#L648) | ?> |
| [649](#L649) | <a class="collapseomatic" id="tophtml<?php echo $this->get\_field\_id('tophtml'); ?>"><?php \_e('Above Countdown', 'jquery-t-countdown-widget'); ?></a> |
| [650](#L650) | <div id="target-tophtml<?php echo $this->get\_field\_id('tophtml'); ?>" class="collapseomatic\_content"> |
| [651](#L651) | <p><label for="<?php echo $this->get\_field\_id('tophtml'); ?>"><?php \_e('Top HTML:', 'jquery-t-countdown-widget'); ?></label> <textarea id="<?php echo $this->get\_field\_id('tophtml'); ?>" name="<?php echo $this->get\_field\_name('tophtml'); ?>"><?php echo $tophtml; ?></textarea></p> |
| [652](#L652) | </div> |
| [653](#L653) | <br/> |
| [654](#L654) | <a class="collapseomatic" id="bothtml<?php echo $this->get\_field\_id('bothtml'); ?>"><?php \_e('Below Countdown', 'jquery-t-countdown-widget'); ?></a> |
| [655](#L655) | <div id="target-bothtml<?php echo $this->get\_field\_id('bothtml'); ?>" class="collapseomatic\_content"> |
| [656](#L656) | <p><label for="<?php echo $this->get\_field\_id('bothtml'); ?>"><?php \_e('Bottom HTML:', 'jquery-t-countdown-widget'); ?></label> <textarea id="<?php echo $this->get\_field\_id('bothtml'); ?>" name="<?php echo $this->get\_field\_name('bothtml'); ?>"><?php echo $bothtml; ?></textarea></p> |
| [657](#L657) | </div> |
| [658](#L658) | <br/> |
| [659](#L659) | <a class="collapseomatic" id="launchhtml<?php echo $this->get\_field\_id('launchhtml'); ?>"><?php \_e('When Countdown Reaches Zero', 'jquery-t-countdown-widget'); ?></a> |
| [660](#L660) | <div id="target-launchhtml<?php echo $this->get\_field\_id('launchhtml'); ?>" class="collapseomatic\_content"> |
| [661](#L661) | <p><label for="<?php echo $this->get\_field\_id('launchhtml'); ?>"><?php \_e('Launch Event HTML:', 'jquery-t-countdown-widget'); ?></label> <textarea id="<?php echo $this->get\_field\_id('launchhtml'); ?>" name="<?php echo $this->get\_field\_name('launchhtml'); ?>"><?php echo $launchhtml; ?></textarea></p> |
| [662](#L662) | <p><?php \_e('Launch Target:', 'jquery-t-countdown-widget'); ?> <select name="<?php echo $this->get\_field\_name('launchtarget'); ?>" id="<?php echo $this->get\_field\_name('launchtarget'); ?>"> |
| [663](#L663) | <?php |
| [664](#L664) | $target\_arr = array( |
| [665](#L665) | 'tophtml' => \_\_('Above Countdown', 'jquery-t-countdown-widget'), |
| [666](#L666) | 'bothtml' => \_\_('Below Countdown', 'jquery-t-countdown-widget'), |
| [667](#L667) | 'countdown' => \_\_('Entire Countdown', 'jquery-t-countdown-widget'), |
| [668](#L668) | 'countup' => \_\_('Count Up', 'jquery-t-countdown-widget') |
| [669](#L669) | ); |
| [670](#L670) | foreach($target\_arr as $key => $val){ |
| [671](#L671) | $selected = ""; |
| [672](#L672) | if($launchtarget == $key){ |
| [673](#L673) | $selected = 'SELECTED'; |
| [674](#L674) | } |
| [675](#L675) | echo '<option value="'.$key.'" '.$selected.'>'.$val.'</option>'; |
| [676](#L676) | } |
| [677](#L677) | ?> |
| [678](#L678) | </select></p> |
| [679](#L679) | </div> |
| [680](#L680) | <br/> |
| [681](#L681) | <a class="collapseomatic" id="titles<?php echo $this->get\_field\_id('weeks'); ?>"><?php \_e('Digit Titles', 'jquery-t-countdown-widget'); ?></a> |
| [682](#L682) | <div id="target-titles<?php echo $this->get\_field\_id('weeks'); ?>" class="collapseomatic\_content"> |
| [683](#L683) | <p><label for="<?php echo $this->get\_field\_id('weeks'); ?>"><?php \_e('How do you spell "weeks"?:', 'jquery-t-countdown-widget'); ?> <input class="widefat" id="<?php echo $this->get\_field\_id('weeks'); ?>" name="<?php echo $this->get\_field\_name('weeks'); ?>" type="text" value="<?php echo $weeks; ?>" /></label></p> |
| [684](#L684) | <p><label for="<?php echo $this->get\_field\_id('days'); ?>"><?php \_e('How do you spell "days"?:', 'jquery-t-countdown-widget'); ?> <input class="widefat" id="<?php echo $this->get\_field\_id('days'); ?>" name="<?php echo $this->get\_field\_name('days'); ?>" type="text" value="<?php echo $days; ?>" /></label></p> |
| [685](#L685) | <p><label for="<?php echo $this->get\_field\_id('hours'); ?>"><?php \_e('How do you spell "hours"?:', 'jquery-t-countdown-widget'); ?> <input class="widefat" id="<?php echo $this->get\_field\_id('hours'); ?>" name="<?php echo $this->get\_field\_name('hours'); ?>" type="text" value="<?php echo $hours; ?>" /></label></p> |
| [686](#L686) | <p><label for="<?php echo $this->get\_field\_id('minutes'); ?>"><?php \_e('How do you spell "minutes"?:', 'jquery-t-countdown-widget'); ?> <input class="widefat" id="<?php echo $this->get\_field\_id('minutes'); ?>" name="<?php echo $this->get\_field\_name('minutes'); ?>" type="text" value="<?php echo $minutes; ?>" /></label></p> |
| [687](#L687) | <p><label for="<?php echo $this->get\_field\_id('seconds'); ?>"><?php \_e('And "seconds" are spelled:', 'jquery-t-countdown-widget'); ?> <input class="widefat" id="<?php echo $this->get\_field\_id('seconds'); ?>" name="<?php echo $this->get\_field\_name('seconds'); ?>" type="text" value="<?php echo $seconds; ?>" /></label></p> |
| [688](#L688) | </div> |
| [689](#L689) |  |
| [690](#L690) | <?php |
| [691](#L691) | } |
| [692](#L692) | else{ |
| [693](#L693) | $like\_it\_arr = array('makes me feel warm and fuzzy inside... in a good way', 'restores my faith in humanity... if only for a fleating second', 'rocked my world and is totally worth 3 bucks', 'offered me a positive vision of future living', 'inspires me to commit random acts of kindness', 'helped organize my life in one of the small ways that matter', 'saved me minutes if not tens of minutes writing your own solution', 'brightened my day... or darkened it since I wanted to sleep in anyway', 'is totally worth 3 bucks'); |
| [694](#L694) | $rand\_key = array\_rand($like\_it\_arr); |
| [695](#L695) | $like\_it = $like\_it\_arr[$rand\_key]; |
| [696](#L696) | ?> |
| [697](#L697) | <p> |
| [698](#L698) | <?php printf( \_\_('T(-) Countdown %s!', 'jquery-t-countdown-widget'), $like\_it); ?> |
| [699](#L699) | <a href="options-general.php?page=t-countdown"><?php \_e('Enable Rockstar Features', 'jquery-t-countdown-widget'); ?></a> |
| [700](#L700) | </p> |
| [701](#L701) | <?php } //end if not rockstar ?> |
| [702](#L702) |  |
| [703](#L703) | <br/> |
| [704](#L704) | <a class="collapseomatic" id="tccc<?php echo $this->get\_field\_id('isrockstar'); ?>"><?php \_e('Schedule Recurring Countdown', 'jquery-t-countdown-widget'); ?></a> |
| [705](#L705) | <div id="target-tccc<?php echo $this->get\_field\_id('isrockstar'); ?>" class="collapseomatic\_content"> |
| [706](#L706) | <p><?php printf(\_\_('%sT(-) Countdown Control%s is a premium countdown plugin that includes the ability to schedule and manage multiple recurring T(-) Countdowns... the Jedi way.', 'jquery-t-countdown-widget'), '<a href="https://plugins.twinpictures.de/premium-plugins/t-minus-countdown-control/?utm\_source=t-countdown&utm\_medium=widget-settings&utm\_content=t-countdown-control&utm\_campaign=t-countdown-widget" target="blank" title="(-) Countdown Control">', '</a>'); ?></p> |
| [707](#L707) | </div> |
| [708](#L708) | <br/><br/> |
| [709](#L709) | <?php |
| [710](#L710) | } |
| [711](#L711) | } // class CountDownTimer |
| [712](#L712) |  |
| [713](#L713) | // register CountDownTimer widget |
| [714](#L714) | function tminus\_register\_widget() { |
| [715](#L715) | register\_widget( 'CountDownTimer' ); |
| [716](#L716) | } |
| [717](#L717) | add\_action( 'widgets\_init', 'tminus\_register\_widget' ); |
| [718](#L718) |  |
| [719](#L719) | //code for the footer |
| [720](#L720) | add\_action('wp\_footer', 'print\_my\_script', 99); |
| [721](#L721) |  |
| [722](#L722) | function print\_my\_script() { |
| [723](#L723) | global $add\_my\_script; |
| [724](#L724) | if ( ! $add\_my\_script ){ |
| [725](#L725) | return; |
| [726](#L726) | } |
| [727](#L727) |  |
| [728](#L728) | ?> |
| [729](#L729) | <script language="javascript" type="text/javascript"> |
| [730](#L730) | jQuery(document).ready(function($) { |
| [731](#L731) | <?php |
| [732](#L732) | //var\_dump('hey dude', $add\_my\_script); |
| [733](#L733) | foreach((array) $add\_my\_script as $script){ |
| [734](#L734) | ?> |
| [735](#L735) | $('#<?php echo $script['id']; ?>-dashboard').tminusCountDown({ |
| [736](#L736) | targetDate: { |
| [737](#L737) | 'day':  <?php echo $script['day']; ?>, |
| [738](#L738) | 'month': <?php echo $script['month']; ?>, |
| [739](#L739) | 'year': <?php echo $script['year']; ?>, |
| [740](#L740) | 'hour': <?php echo $script['hour']; ?>, |
| [741](#L741) | 'min':  <?php echo $script['min']; ?>, |
| [742](#L742) | 'sec':  <?php echo $script['sec']; ?>, |
| [743](#L743) | 'localtime': '<?php echo $script['localtime']; ?>', |
| [744](#L744) | }, |
| [745](#L745) | style: '<?php echo $script['style']; ?>', |
| [746](#L746) | launchtarget: '<?php echo $script['launchtarget']; ?>', |
| [747](#L747) | omitWeeks: '<?php echo $script['omitweeks']; ?>', |
| [748](#L748) | id: '<?php echo $script['id']; ?>', |
| [749](#L749) | event\_id: '<?php echo $script['event\_id']; ?>' |
| [750](#L750) | <?php |
| [751](#L751) | if(!empty($script['content'])){ |
| [752](#L752) | echo ", onComplete: function() { |
| [753](#L753) | $('#".$script['id']."-".$script['launchtarget']."').css({'width' : '".$script['launchwidth']."', 'height' : '".$script['launchheight']."'}); |
| [754](#L754) | $('#".$script['id']."-".$script['launchtarget']."').html(".$script['content']."); |
| [755](#L755) | }"; |
| [756](#L756) | } |
| [757](#L757) | ?> |
| [758](#L758) | }); |
| [759](#L759) | <?php |
| [760](#L760) | } |
| [761](#L761) | ?> |
| [762](#L762) | }); |
| [763](#L763) | </script> |
| [764](#L764) | <?php |
| [765](#L765) | } |
| [766](#L766) |  |
| [767](#L767) | //the short code |
| [768](#L768) | function tminuscountdown($atts, $content=null) { |
| [769](#L769) | global $add\_my\_script; |
| [770](#L770) | //find a random number, if no id was assigned |
| [771](#L771) | $ran = uniqid(); |
| [772](#L772) | extract(shortcode\_atts(array( |
| [773](#L773) | 'id' => $ran, |
| [774](#L774) | 't' => '', |
| [775](#L775) | 'weeks' => \_\_('weeks', 'jquery-t-countdown-widget'), |
| [776](#L776) | 'days' => \_\_('days', 'jquery-t-countdown-widget'), |
| [777](#L777) | 'hours' => \_\_('hours', 'jquery-t-countdown-widget'), |
| [778](#L778) | 'minutes' => \_\_('minutes', 'jquery-t-countdown-widget'), |
| [779](#L779) | 'seconds' => \_\_('seconds', 'jquery-t-countdown-widget'), |
| [780](#L780) | 'omitweeks' => 'false', |
| [781](#L781) | 'style' => 'jedi', |
| [782](#L782) | 'before' => '', |
| [783](#L783) | 'after' => '', |
| [784](#L784) | 'width' => 'auto', |
| [785](#L785) | 'height' => 'auto', |
| [786](#L786) | 'launchwidth' => 'auto', |
| [787](#L787) | 'launchheight' => 'auto', |
| [788](#L788) | 'launchtarget' => 'countdown', |
| [789](#L789) | 'jsplacement' => 'footer', |
| [790](#L790) | 'event\_id' => '', |
| [791](#L791) | ), $atts)); |
| [792](#L792) |  |
| [793](#L793) | if(empty($t)){ |
| [794](#L794) | return; |
| [795](#L795) | } |
| [796](#L796) |  |
| [797](#L797) | //insert some style into your life |
| [798](#L798) | $style\_file\_url = plugins\_url('/css/'.$style.'/style.css', \_\_FILE\_\_); |
| [799](#L799) |  |
| [800](#L800) | if ( file\_exists( \_\_DIR\_\_ .'/css/'.$style.'/style.css' ) ) { |
| [801](#L801) | if (! wp\_style\_is( 'countdown-'.$style.'-css', 'registered' )) { |
| [802](#L802) | wp\_register\_style( 'countdown-'.$style.'-css', $style\_file\_url, array(), '2.0'); |
| [803](#L803) | } |
| [804](#L804) | wp\_enqueue\_style( 'countdown-'.$style.'-css' ); |
| [805](#L805) | } |
| [806](#L806) |  |
| [807](#L807) | $now = strtotime(current\_time('mysql')); |
| [808](#L808) | $target = strtotime($t, $now); |
| [809](#L809) |  |
| [810](#L810) | //difference in seconds |
| [811](#L811) | $diffSecs = $target - $now; |
| [812](#L812) |  |
| [813](#L813) | $day = date ( 'd', $target ); |
| [814](#L814) | $month = date ( 'm', $target ); |
| [815](#L815) | $year = date ( 'Y', $target ); |
| [816](#L816) | $hour = date ( 'H', $target ); |
| [817](#L817) | $min = date ( 'i', $target ); |
| [818](#L818) | $sec = date ( 's', $target ); |
| [819](#L819) |  |
| [820](#L820) | //countdown digits |
| [821](#L821) | $date\_arr = array(); |
| [822](#L822) | $date\_arr['secs'] = $diffSecs % 60; |
| [823](#L823) | $date\_arr['mins'] = floor($diffSecs/60)%60; |
| [824](#L824) | $date\_arr['hours'] = floor($diffSecs/60/60)%24; |
| [825](#L825) |  |
| [826](#L826) | if($omitweeks == 'false'){ |
| [827](#L827) | $dash\_omitweeks\_class = ''; |
| [828](#L828) | $date\_arr['days'] = floor($diffSecs/60/60/24)%7; |
| [829](#L829) | } |
| [830](#L830) | else{ |
| [831](#L831) | $dash\_omitweeks\_class = 'omitweeks'; |
| [832](#L832) | $date\_arr['days'] = floor($diffSecs/60/60/24); |
| [833](#L833) | } |
| [834](#L834) | $date\_arr['weeks']      = floor($diffSecs/60/60/24/7); |
| [835](#L835) |  |
| [836](#L836) | foreach ($date\_arr as $i => $d) { |
| [837](#L837) | $d1 = $d%10; |
| [838](#L838) | if($d < 100){ |
| [839](#L839) | $d2 = ($d-$d1) / 10; |
| [840](#L840) | $d3 = 0; |
| [841](#L841) | } |
| [842](#L842) | else{ |
| [843](#L843) | $dr = $d%100; |
| [844](#L844) | $dm = $d-$dr; |
| [845](#L845) | $d2 = ($d-$dm-$d1) / 10; |
| [846](#L846) | $d3 = $dm / 100; |
| [847](#L847) | } |
| [848](#L848) | /\* here is where the 1000's support will go... someday. \*/ |
| [849](#L849) |  |
| [850](#L850) | //now assign all the digits to the array |
| [851](#L851) | $date\_arr[$i] = array( |
| [852](#L852) | (int)$d3, |
| [853](#L853) | (int)$d2, |
| [854](#L854) | (int)$d1, |
| [855](#L855) | (int)$d |
| [856](#L856) | ); |
| [857](#L857) | } |
| [858](#L858) |  |
| [859](#L859) | if(is\_numeric($width)){ |
| [860](#L860) | $width .= 'px'; |
| [861](#L861) | } |
| [862](#L862) | if(is\_numeric($height)){ |
| [863](#L863) | $height .= 'px'; |
| [864](#L864) | } |
| [865](#L865) | $tminus = '<div id="'.esc\_attr($id).'-countdown" class="tminus\_countdown" style="width:'.esc\_attr($width).'; height:'.esc\_attr($height).';">'; |
| [866](#L866) | $tminus .= '<div class="'.esc\_attr($style).'-countdown '.$dash\_omitweeks\_class.'">'; |
| [867](#L867) | $tminus .= '<div id="'.esc\_attr($id).'-tophtml" class="'.esc\_attr($style).'-tophtml">'; |
| [868](#L868) | if($before){ |
| [869](#L869) | $tminus .=  htmlspecialchars\_decode($before); |
| [870](#L870) | } |
| [871](#L871) | $tminus .=  '</div>'; |
| [872](#L872) |  |
| [873](#L873) | //drop in the dashboard |
| [874](#L874) | $tminus .=  '<div id="'.esc\_attr($id).'-dashboard" class="'.esc\_attr($style).'-dashboard">'; |
| [875](#L875) | if($omitweeks == 'false'){ |
| [876](#L876) | //set up correct style class for double or triple digit love |
| [877](#L877) | $wclass = esc\_attr($style).'-dash '.esc\_attr($style).'-weeks\_dash'; |
| [878](#L878) | if($date\_arr['weeks'][0] > 0){ |
| [879](#L879) | $wclass = esc\_attr($style).'-tripdash '.esc\_attr($style).'-weeks\_trip\_dash'; |
| [880](#L880) | } |
| [881](#L881) |  |
| [882](#L882) | $tminus .=  '<div class="'.esc\_attr($wclass).'"><div class="'.esc\_attr($style).'-dash\_title">'.esc\_attr($weeks).'</div>'; |
| [883](#L883) | if($date\_arr['weeks'][0] > 0){ |
| [884](#L884) | $tminus .=  '<div class="'.esc\_attr($style).'-digit">'.$date\_arr['weeks'][0].'</div>'; |
| [885](#L885) | } |
| [886](#L886) | $tminus .=  '<div class="'.esc\_attr($style).'-digit">'.$date\_arr['weeks'][1].'</div><div class="'.esc\_attr($style).'-digit">'.$date\_arr['weeks'][2].'</div></div>'; |
| [887](#L887) | } |
| [888](#L888) |  |
| [889](#L889) | //set up correct style class for double or triple digit love |
| [890](#L890) | $dclass = esc\_attr($style).'-dash '.esc\_attr($style).'-days\_dash'; |
| [891](#L891) |  |
| [892](#L892) | if($omitweeks == 'true' && abs($date\_arr['days'][3]) > 99){ |
| [893](#L893) | $dclass = esc\_attr($style).'-tripdash '.esc\_attr($style).'-days\_trip\_dash'; |
| [894](#L894) | } |
| [895](#L895) |  |
| [896](#L896) | $tminus .= '<div class="'.$dclass.'"><div class="'.esc\_attr($style).'-dash\_title">'.$days.'</div>'; |
| [897](#L897) |  |
| [898](#L898) | if($omitweeks == 'true' && abs($date\_arr['days'][3]) > 99){ |
| [899](#L899) | $tminus .= '<div class="'.esc\_attr($style).'-digit">'.$date\_arr['days'][0].'</div>'; |
| [900](#L900) | } |
| [901](#L901) | $tminus .= '<div class="'.esc\_attr($style).'-digit">'.$date\_arr['days'][1].'</div><div class="'.esc\_attr($style).'-digit">'.$date\_arr['days'][2].'</div>'; |
| [902](#L902) | $tminus .= '</div>'; |
| [903](#L903) | $tminus .= '<div class="'.esc\_attr($style).'-dash '.esc\_attr($style).'-hours\_dash">'; |
| [904](#L904) | $tminus .= '<div class="'.esc\_attr($style).'-dash\_title">'.$hours.'</div>'; |
| [905](#L905) | $tminus .= '<div class="'.esc\_attr($style).'-digit">'.$date\_arr['hours'][1].'</div>'; |
| [906](#L906) | $tminus .= '<div class="'.esc\_attr($style).'-digit">'.$date\_arr['hours'][2].'</div>'; |
| [907](#L907) | $tminus .= '</div>'; |
| [908](#L908) | $tminus .= '<div class="'.esc\_attr($style).'-dash '.esc\_attr($style).'-minutes\_dash">'; |
| [909](#L909) | $tminus .= '<div class="'.esc\_attr($style).'-dash\_title">'.$minutes.'</div>'; |
| [910](#L910) | $tminus .= '<div class="'.esc\_attr($style).'-digit">'.$date\_arr['mins'][1].'</div>'; |
| [911](#L911) | $tminus .= '<div class="'.esc\_attr($style).'-digit">'.$date\_arr['mins'][2].'</div>'; |
| [912](#L912) | $tminus .= '</div>'; |
| [913](#L913) | $tminus .= '<div class="'.esc\_attr($style).'-dash '.esc\_attr($style).'-seconds\_dash">'; |
| [914](#L914) | $tminus .= '<div class="'.esc\_attr($style).'-dash\_title">'.$seconds.'</div>'; |
| [915](#L915) | $tminus .= '<div class="'.esc\_attr($style).'-digit">'.$date\_arr['secs'][1].'</div>'; |
| [916](#L916) | $tminus .= '<div class="'.esc\_attr($style).'-digit">'.$date\_arr['secs'][2].'</div>'; |
| [917](#L917) | $tminus .= '</div>'; |
| [918](#L918) | $tminus .= '</div>'; //close the dashboard |
| [919](#L919) |  |
| [920](#L920) | $tminus .= '<div id="'.$id.'-bothtml" class="'.esc\_attr($style).'-bothtml">'; |
| [921](#L921) | if($after){ |
| [922](#L922) | $tminus .= htmlspecialchars\_decode($after); |
| [923](#L923) | } |
| [924](#L924) | $tminus .= '</div></div></div>'; |
| [925](#L925) |  |
| [926](#L926) | $t = date( 'n/j/Y H:i:s', strtotime(current\_time('mysql')) ); |
| [927](#L927) |  |
| [928](#L928) | if(is\_numeric($launchwidth)){ |
| [929](#L929) | $launchwidth .= 'px'; |
| [930](#L930) | } |
| [931](#L931) | if(is\_numeric($launchheight)){ |
| [932](#L932) | $launchheight .= 'px'; |
| [933](#L933) | } |
| [934](#L934) |  |
| [935](#L935) | $content = json\_encode(do\_shortcode($content)); |
| [936](#L936) | $content = str\_replace(array('\r\n', '\r', '\n<p>', '\n', '""'), '', $content); |
| [937](#L937) |  |
| [938](#L938) | if($jsplacement == "footer"){ |
| [939](#L939) | $add\_my\_script[$id] = array( |
| [940](#L940) | 'id' => $id, |
| [941](#L941) | 'day' => $day, |
| [942](#L942) | 'month' => $month, |
| [943](#L943) | 'year' => $year, |
| [944](#L944) | 'hour' => $hour, |
| [945](#L945) | 'min' => $min, |
| [946](#L946) | 'sec' => $sec, |
| [947](#L947) | 'localtime' => $t, |
| [948](#L948) | 'style' => $style, |
| [949](#L949) | 'omitweeks' => $omitweeks, |
| [950](#L950) | 'content' => $content, |
| [951](#L951) | 'launchtarget' => $launchtarget, |
| [952](#L952) | 'launchwidth' => $launchwidth, |
| [953](#L953) | 'launchheight' => $launchheight, |
| [954](#L954) | 'event\_id' => $event\_id, |
| [955](#L955) | ); |
| [956](#L956) | } |
| [957](#L957) | else{ |
| [958](#L958) | $tminus .= "<script language='javascript' type='text/javascript'> |
| [959](#L959) | jQuery(document).ready(function($) { |
| [960](#L960) | $('#".$id."-dashboard').tminusCountDown({ |
| [961](#L961) | targetDate: { |
| [962](#L962) | 'day':  ".$day.", |
| [963](#L963) | 'month': ".$month.", |
| [964](#L964) | 'year': ".$year.", |
| [965](#L965) | 'hour': ".$hour.", |
| [966](#L966) | 'min':  ".$min.", |
| [967](#L967) | 'sec':  ".$sec.", |
| [968](#L968) | 'localtime': '".$t."' |
| [969](#L969) | }, |
| [970](#L970) | style: '".$style."', |
| [971](#L971) | id: '".$id."', |
| [972](#L972) | event\_id: '".$event\_id."', |
| [973](#L973) | launchtarget: '".$launchtarget."', |
| [974](#L974) | omitWeeks: '".$omitweeks."'"; |
| [975](#L975) |  |
| [976](#L976) | if(!empty($content)){ |
| [977](#L977) | $tminus .= ", onComplete: function() { |
| [978](#L978) | $('#".$id."-".$launchtarget."').css({'width' : '".$launchwidth."', 'height' : '".$launchheight."'}); |
| [979](#L979) | $('#".$id."-".$launchtarget."').html(".$content."); |
| [980](#L980) | }"; |
| [981](#L981) | } |
| [982](#L982) | $tminus .= "}); |
| [983](#L983) | }); |
| [984](#L984) | </script>"; |
| [985](#L985) | } |
| [986](#L986) | return $tminus; |
| [987](#L987) | } |
| [988](#L988) | add\_shortcode('tminus', 'tminuscountdown'); |
| [989](#L989) |  |
| [990](#L990) | add\_action('wp\_ajax\_tminusevents', 'tminusevents\_callback'); |
| [991](#L991) | add\_action('wp\_ajax\_nopriv\_tminusevents', 'tminusevents\_callback'); |
| [992](#L992) |  |
| [993](#L993) | function tminusevents\_callback() { |
| [994](#L994) | $nonce = $\_POST['countdownNonce']; |
| [995](#L995) | if ( ! wp\_verify\_nonce( $nonce, 'tountajax-countdownonce-nonce' ) ){ |
| [996](#L996) | die ( 'Busted!'); |
| [997](#L997) | } |
| [998](#L998) |  |
| [999](#L999) | echo WP\_TminusEvents::tminusEvents( $\_POST['event\_id'] ); |
| [1000](#L1000) | wp\_die(); |
| [1001](#L1001) | } |
| [1002](#L1002) |  |
| [1003](#L1003) | ?> |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/jquery-t-countdown-widget/trunk/countdown-timer.php?format=txt)
* [Original Format](/export/3220757/jquery-t-countdown-widget/trunk/countdown-timer.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


