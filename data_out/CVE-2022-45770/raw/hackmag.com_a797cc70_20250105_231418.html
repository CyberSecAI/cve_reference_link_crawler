<!doctype html>
<html class="no-js" lang="en-US" >
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<link rel="icon" href="//hackmag.com/wp-content/themes/FoundationPress/assets/images/icons/favicon.ico" type="image/x-icon">
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="//hackmag.com/wp-content/themes/FoundationPress/assets/images/icons/apple-touch-icon-144x144-precomposed.png">
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="//hackmag.com/wp-content/themes/FoundationPress/assets/images/icons/apple-touch-icon-114x114-precomposed.png">
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="//hackmag.com/wp-content/themes/FoundationPress/assets/images/icons/apple-touch-icon-72x72-precomposed.png">
		<link rel="apple-touch-icon-precomposed" href="//hackmag.com/wp-content/themes/FoundationPress/assets/images/icons/apple-touch-icon-precomposed.png">

		<title>Sad Guard. Identifying and exploiting vulnerability in AdGuard driver for Windows &#8211; HackMag</title>
<meta name='robots' content='max-image-preview:large' />
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	<link rel='dns-prefetch' href='//js.stripe.com' />
<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//checkout.stripe.com' />
<link rel='stylesheet' id='wp-color-picker-css' href='//hackmag.com/wp-admin/css/color-picker.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='stripe-checkout-button-css' href='//checkout.stripe.com/v3/checkout/button.css' type='text/css' media='all' />
<link rel='stylesheet' id='simpay-public-css' href='//hackmag.com/wp-content/plugins/stripe/includes/core/assets/css/simpay-public.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='main-stylesheet-css' href='//hackmag.com/wp-content/themes/FoundationPress/assets/stylesheets/foundation.css' type='text/css' media='all' />
<link rel='stylesheet' id='xakep-css-css' href='//hackmag.com/wp-content/themes/FoundationPress/xakep/style.css' type='text/css' media='all' />
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js" id="jquery-js"></script>
<script type="text/javascript" src="//hackmag.com/wp-content/themes/FoundationPress/assets/javascript/vendor/modernizr.js" id="modernizr-js"></script>
<script type="text/javascript" src="//hackmag.com/wp-content/themes/FoundationPress/assets/javascript/vendor/fastclick.js" id="fastclick-js"></script>
<link rel="https://api.w.org/" href="https://hackmag.com/wp-json/" /><link rel="alternate" title="JSON" type="application/json" href="https://hackmag.com/wp-json/wp/v2/posts/5471" /><link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://hackmag.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fhackmag.com%2Fsecurity%2Faguard-cve%2F" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://hackmag.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fhackmag.com%2Fsecurity%2Faguard-cve%2F&#038;format=xml" />
<style type="text/css">
    .sticky-container {
		/*background-color: #333;*/
		padding: 0px;
		margin: 0px;
		position: fixed;
		right: -129px;
		top:130px;
		width: 200px;

	}

	.sticky li {
		list-style-type: none;
		//background-color: #333;
		color: #efefef;
		height: 43px;
		padding: 0px;
		margin: 0px 0px 1px 0px;
		-webkit-transition:all 0.25s ease-in-out;
		-moz-transition:all 0.25s ease-in-out;
		-o-transition:all 0.25s ease-in-out;
		transition:all 0.25s ease-in-out;
		cursor: pointer;
		filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale");
                filter: gray;
                -webkit-filter: grayscale(100%);
				

	}

	.sticky li:hover {
		margin-left: -115px;
		/*-webkit-transform: translateX(-115px);
		-moz-transform: translateX(-115px);
		-o-transform: translateX(-115px);
		-ms-transform: translateX(-115px);
		transform:translateX(-115px);*/
		/*background-color: #8e44ad;*/
		filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'1 0 0 0 0, 0 1 0 0 0, 0 0 1 0 0, 0 0 0 1 0\'/></filter></svg>#grayscale");
                -webkit-filter: grayscale(0%);
	}

	.sticky li a img {
		float: left;
		margin: 5px 5px;
		margin-right: 10px;

	}

	.sticky li a p {
		padding: 0px;
		margin: 0px;
		text-transform: uppercase;
		line-height: 43px;
        text-decoration: none !important;
        color: #ECF0F1;
        font-family: "Lato";
    }
</style>
<meta name="viewport" content="width=device-width, minimum-scale=1" /><style type="text/css">
    #wpadminbar .quicklinks {margin: 0 4px;}
    #wpadminbar .quicklinks a {color: #aaa !important;}
    #wpadminbar .quicklinks a strong {color: #fff; font-weight: bold;}
    #wpadminbar .quicklinks li:hover>a,
    #wpadminbar .quicklinks li a:hover,
    #wpadminbar .quicklinks li a:focus {color: #fff !important; background-color: transparent !important;}
    #wpadminbar .quicklinks #wp-admin-bar-bp-login,
    #wpadminbar .quicklinks #wp-admin-bar-bp-register {display: none;}
    #wpadminbar .quicklinks #wp-admin-bar-login,
    #wpadminbar .quicklinks #wp-admin-bar-register {float: right;}
    @media screen and (max-width: 782px){
      #wpadminbar .quicklinks #wp-admin-bar-login,
      #wpadminbar .quicklinks #wp-admin-bar-register {display: block; padding: 0 12px;}
    }
    #acf-upgrade-notice,
    #wpfooter {display:none !important;}
  </style>		<link rel='stylesheet' id='xakep-xmd-css' href='//hackmag.com/wp-content/themes/FoundationPress/xakep/files/xmd.css' type='text/css' media='all' />

<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5666adfbb0d91e48" async="async"></script>

<script type='text/javascript'>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-60367324-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('require', 'displayfeatures');
  ga('require', 'ecommerce');
  ga('send', 'pageview');

  /* Accurate bounce rate by time */
  if (!document.referrer || document.referrer.split('/')[2].indexOf(location.hostname) != 0)
    setTimeout(function(){ga('send', 'event', 'Новый посетитель', location.pathname);}, 15000);
</script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter34804575 = new Ya.Metrika({
                    id:34804575,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true,
                    webvisor:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/34804575" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','//connect.facebook.net/en_US/fbevents.js');

fbq('init', '804064559705226');
fbq('track', "PageView");</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=804064559705226&ev=PageView&noscript=1"
/></noscript>
<!-- End Facebook Pixel Code -->	</head>
	<body class="post-template-default single single-post postid-5471 single-format-standard offcanvas">
	
	
	<div class="off-canvas-wrap" data-offcanvas>
	<div class="inner-wrap">
	
	
	
<nav class="tab-bar">
  <section class="left-small">
    <a class="left-off-canvas-toggle menu-icon" href="#"><span></span></a>
  </section>
  <section class="middle tab-bar-section">

    <h1 class="title">
      HackMag    </h1>

  </section>
</nav>

<aside class="left-off-canvas-menu" aria-hidden="true">
    <ul id="menu-main-menu" class="off-canvas-list"><li id="menu-item-3115" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3115"><a href="https://hackmag.com/category/mobile/">Mobile</a></li>
<li id="menu-item-382" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-382"><a href="https://hackmag.com/category/security/">Security</a></li>
<li id="menu-item-3114" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3114"><a href="https://hackmag.com/category/malware/">Malware</a></li>
<li id="menu-item-395" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-395"><a href="https://hackmag.com/category/coding/">Coding</a></li>
<li id="menu-item-379" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-379"><a href="https://hackmag.com/category/unix/">Unix</a></li>
<li id="menu-item-381" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-381"><a href="https://hackmag.com/category/devops/">Devops</a></li>
</ul></aside>

	<div class="top-bar-container contain-to-grid">
    <nav class="top-bar" data-topbar role="navigation">
        <ul class="title-area top-bar-left">
            <li class="name">
                <h1><a href="https://hackmag.com">HackMag</a></h1>
            </li>
            <li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li>
        </ul>
        <section class="top-bar-section">
            <ul id="menu-main-menu-1" class="top-bar-menu left"><li class="divider"></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3115"><a href="https://hackmag.com/category/mobile/">Mobile</a></li>
<li class="divider"></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-382"><a href="https://hackmag.com/category/security/">Security</a></li>
<li class="divider"></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3114"><a href="https://hackmag.com/category/malware/">Malware</a></li>
<li class="divider"></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-395"><a href="https://hackmag.com/category/coding/">Coding</a></li>
<li class="divider"></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-379"><a href="https://hackmag.com/category/unix/">Unix</a></li>
<li class="divider"></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-381"><a href="https://hackmag.com/category/devops/">Devops</a></li>
</ul>            <ul id="menu-user-menu" class="top-bar-menu right"><li class="divider"></li><li id="menu-item-4409" class="user-not-logged menu-item menu-item-type-custom menu-item-object-custom menu-item-4409"><a href="/wp-signup.php">Sign Up</a></li>
<li class="divider"></li><li id="menu-item-4212" class="user-not-logged menu-item menu-item-type-custom menu-item-object-custom menu-item-4212"><a href="/wp-login.php">Log In</a></li>
<li class="divider"></li><li id="menu-item-4217" class="user-logged menu-item menu-item-type-custom menu-item-object-custom menu-item-4217"><a href="/wp-admin/users.php?page=paywall_subscribes">Subscriptions</a></li>
<li class="divider"></li><li id="menu-item-4211" class="user-logged menu-item menu-item-type-custom menu-item-object-custom menu-item-4211"><a href="/wp-login.php?action=logout">Log Out</a></li>
</ul>        </section>
    </nav>
</div>

<section class="container" role="document">
	
<div class="row">
	<div class="small-12 large-8 columns" role="main">

	
			<article class="post-5471 post type-post status-publish format-standard has-post-thumbnail hentry category-security" id="post-5471">
			<header>
				<h1 class="entry-title">Sad Guard. Identifying and exploiting vulnerability in AdGuard driver for Windows</h1>
				<p class="byline author">Written by <a href="https://hackmag.com/author/marsel-shagiev/" rel="author" class="fn">Marsel Shagiev</a></p>			</header>
						<div class="entry-content">

							<div class="row">
					<div class="column">
						<img width="1500" height="1000" src="https://hackmag.com/wp-content/uploads/2023/04/guardian-socials.jpg" class="single_featured-image wp-post-image" alt="" decoding="async" fetchpriority="high" srcset="https://hackmag.com/wp-content/uploads/2023/04/guardian-socials.jpg 1500w, https://hackmag.com/wp-content/uploads/2023/04/guardian-socials-300x200.jpg 300w, https://hackmag.com/wp-content/uploads/2023/04/guardian-socials-1024x683.jpg 1024w, https://hackmag.com/wp-content/uploads/2023/04/guardian-socials-768x512.jpg 768w" sizes="(max-width: 1500px) 100vw, 1500px" />					</div>
				</div>
						<!-- <div class="addthis_native_toolbox"></div> -->
			<div class="addthis_sharing_toolbox"></div>

			<article id=article5471 class='xmd security'><div id="lead1" class="lead">Last year, I discovered a binary bug in the AdGuard driver. Its ID in the National Vulnerability Database is CVE-2022-45770. I was disassembling the ad blocker and found a way to use the identified vulnerability for local privilege escalation. As a bonus, this article gives insight into the low-level Windows structure.</div>
<span id="more-5471"></span>

<div id="panel1" class="panel info"><div class="info-inner">
<h4>info</h4>
<p id="p1">I am grateful to <a id="link1" href="https://twitter.com/Denis_Skvortcov">@Denis_Skvortcov</a> for useful consultations in the course of this research. In <a id="link2" href="https://the-deniss.github.io/">his blog</a>, you can find cool articles describing the exploitation of vulnerabilities in Windows antiviruses. Currently, Denis is exploring Avast.</p>
</div></div>

<div id="panel2" class="panel warning"><div class="warning-inner">
<h4>warning</h4>
<p id="p2">This article is intended for security specialists operating under a contract; all information provided in it is for educational purposes only. Neither the author nor the Editorial Board can be held liable for any damages caused by improper usage of this publication. Distribution of malware, disruption of systems, and violation of secrecy of correspondence are prosecuted by law.</p>
</div></div>
<h2 id="h2-1">Background</h2>
<p id="p3">I had a little idea about Windows drivers before reading the book <a id="link3" href="https://leanpub.com/windowskernelprogrammingsecondedition">Windows Kernel Programming</a> by Pavel Yosifovich. The book begins with a simple Hello World driver and ends with a complex filter driver. It also addresses driver debugging on a virtual PC with WinDbg on the host and describes typical driver programming errors. Of course, after reading it, I was eager to put my knowledge into practice and disassemble a driver. Maybe I get lucky and find a vulnerability?..</p>
<div id="panel3" class="panel info"><div class="info-inner">
<h4>info</h4>
<p id="p4">This article is intended for <del>hackers</del> security specialists who have some idea of reverse engineering and the C programming language. It doesn&#8217;t address in detail the reverse engineering process. For more information, see my first article: <a id="link4" href="https://hackmag.com/security/gsoapnote-rce/">Quarrel on the heap. Heap exploitation on a vulnerable SOAP server in Linux</a>.</p>
</div></div>
<h2 id="h2-2">Why AdGuard?</h2>
<p id="p5"><a id="link5" href="https://adguard.com/en/welcome.html">AdGuard</a> is a cool ad blocker that supports encrypted DNS (DoH, DoT, and DoQ). The WDM driver is used to block ad requests sent by all applications, not just the browser. Let&#8217;s install AdGuard on Windows 10 running on a virtual PC and examine it.</p>
<p id="p6">Since I installed the x86 assembly, I am going to research the 32-bit driver.</p>
<h2 id="h2-3">Attack surface</h2>
<p id="p7">First of all, I have to make sure that the driver is on the attack surface. In other words, an unprivileged app can open this driver for interaction (i.e. reading, writing, and sending IOCTL). A few lines in PowerShell with the <a id="link6" href="https://www.powershellgallery.com/packages/NtObjectManager/1.1.33">NtObjectManager</a> library by James Forshaw will help me in this.</p>
<p id="p8">The <a id="link7" href="https://github.com/microsoft/AttackSurfaceAnalyzer#attack-surface-analyzer">Attack Surface Analyzer</a> utility by Microsoft will be used to detect artifacts (i.e. files and registry keys) in the studied product. With its help, I am going to assemble two OS snapshots: (1) prior to the installation of the studied program; and (2) after its installation. Then I will create a diff showing the installed artifacts and determine the path of the device in Object-Manager:</p>
<code id="code1" class="highlight plaintext"><div class="wrapper"><div class="l l1"><span class="none">\</span><span class="none">Device\</span><span class="none">CtrlSM_</span><span class="none">Protected2adgnetworkwfpdrv
</span></div></div></code><figure id="figure1" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29559/get-ntfile-error.png" alt="Error opening driver" title="Error opening driver"><figcaption class="wp-caption-text">Error opening driver</figcaption></figure><p id="p9">The driver cannot be opened. But the error is 0xC000010 <code id="code2">STATUS_INVALID_DEVICE_REQUEST</code>, not 0xC0000022 <code id="code3">ACCESS_DENIED</code>! This means that I have access to the driver, but the driver doesn&#8217;t like something in my request. Such strange behavior is a good reason to start reversing it. Let&#8217;s open the driver in IDA and have a look at several important sections in it.</p>
<p id="p10">The first such section is the driver initialization code in the <code id="code4">DriverEntry</code> function.</p>
<figure id="figure2" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29523/iocreatedevice.png" alt="Create device function" title="Create device function"><figcaption class="wp-caption-text">Create device function</figcaption></figure><p id="p11">The <code id="code5">IoCreateDevice(<wbr></wbr>)</code> function is potentially unsafe since it doesn&#8217;t allow you to explicitly specify DACL. Accordingly, DACL is taken either from the .INF file or from the DACL thread or process that creates it. Also note that the device is created with nonexclusive access (<code id="code6">EXCLUSIVE_FALSE</code>).</p>
<div id="panel4" class="panel info"><div class="info-inner">
<h4>info</h4>
<p id="p12">It&#8217;s better to use <code id="code7">IoCreateDeviceSecure(<wbr></wbr>)</code> where DACL can be passed explicitly.</p>
</div></div>
<p id="p13">The <code id="code8">FILE_DEVICE_SECURE_OPEN</code> argument is present. If it were not there, then the strict DACL could be bypassed by opening an arbitrary file on this device.</p>
<p id="p14">The <code id="code9">DO_DIRECT_IO</code> flag indicates that user-mode buffers for <code id="code10">WriteFile(<wbr></wbr>)</code> and <code id="code11">ReadFile(<wbr></wbr>)</code> calls will be mapped to the kernel space and I can deliver the TOCTOU attack &#8211; provided that a <a id="link8" href="https://msrc-blog.microsoft.com/2008/10/14/ms08-061-the-case-of-the-kernel-mode-double-fetch/">double fetch</a> vulnerability is present in the driver code. If there were the <code id="code12">METHOD_NEITHER</code> flag instead of <code id="code13">DO_DIRECT_IO</code>, the case would be even more interesting.</p>
<p id="p15">So far, everything is fine; let&#8217;s move on.</p>
<p id="p16">The second place of interest is the function acting as a driver opening handler. It&#8217;s easy to find it. In the driver initialization code, you must explicitly specify handlers to the <code id="code14">OpenFile(<wbr></wbr>)</code>, <code id="code15">WriteFile(<wbr></wbr>)</code>, and <code id="code16">ReadFile(<wbr></wbr>)</code> functions.</p>
<figure id="figure3" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29549/adgdriverdispatch.png" alt="Dispatchers of user-mode requests in the driver code" title="Dispatchers of user-mode requests in the driver code"><figcaption class="wp-caption-text">Dispatchers of user-mode requests in the driver code</figcaption></figure><p id="p17">On the IDA screenshots, you see names that I have assigned to variables and functions during the reverse. Of course, no one will tell you symbols used in the original binary.</p>
<div id="panel5" class="panel default"><div class="default-inner">
<h4> OSR Online IOCTL Decoder</h4>
<p id="p18">The <code id="code17">DO_DIRECT_IO</code> flag affects the method used to pass data from the user mode to the kernel for <code id="code18">FileRead(<wbr></wbr>)</code> and <code id="code19">FileWrite(<wbr></wbr>)</code> only. For <code id="code20">DeviceIoControl(<wbr></wbr>)</code>, the method is hardcoded in the IOCTL code. See <a id="link9" href="https://www.osronline.com/article.cfm%5Earticle=229.htm">osronline.com</a> for more detail.</p>
<figure id="figure4" class="wp-caption no-text"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29521/osronline.png" alt="" title=""><figcaption class="wp-caption-text"></figcaption></figure>
</div></div>
<p id="p19">It&#8217;s not a big deal to find the driver opening handler.</p>
<figure id="figure5" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29524/adg-open.png" alt="Handler IRP_MJ_CREATE" title="Handler IRP_MJ_CREATE"><figcaption class="wp-caption-text">Handler IRP_MJ_CREATE</figcaption></figure><p id="p20">Custom exclusive access to the driver is implemented as follows: the PID of the process that has opened it is stored in the global variable <code id="code21">hasOwner</code>. The next attempt to open the driver returns a <code id="code22">STATUS_INVALID_REQUEST</code> error.</p>
<p id="p21">So, what&#8217;s this PID? What process has opened the driver first? It&#8217;s the <code id="code23">AdguardSvc.<wbr></wbr>exe</code> service process. Can I manipulate it in any way? Surprisingly, yes. I don&#8217;t have enough rights to kill it with <code id="code24">Terminate(<wbr></wbr>)</code>, but the <code id="code25">AdguardUI.<wbr></wbr>exe</code> UI process has the &#8220;Disable protection&#8221; button.</p>
<figure id="figure6" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29558/adgui-shutdown.png" alt="AdGuard shutdown window" title="AdGuard shutdown window"><figcaption class="wp-caption-text">AdGuard shutdown window</figcaption></figure><p id="p22">I close the <code id="code26">AdguardSvc.<wbr></wbr>exe</code> process and try to open the driver again.</p>
<figure id="figure7" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29557/get-ntfile-ok.png" alt="Get-NtFile() with the same arguments returns a different result" title="Get-NtFile() with the same arguments returns a different result"><figcaption class="wp-caption-text">Get-NtFile() with the same arguments returns a different result</figcaption></figure><p id="p23">Great! I can read, write, and send IOCTLs on behalf of an unprivileged user. The attack surface is defined.</p>
<p id="p24">At this stage of my research, two errors can be noted.</p>
<ol id="ol1">
<li id="li1">Custom implementation of exclusive access to the driver instead of the required arguments in <code id="code27">IoCreateDevice(<wbr></wbr>EXCLUSIVE_TRUE)</code>. This isn&#8217;t critical; and </li>
<li id="li2">The architecture implies that a privileged service process exclusively opens the device. In that case, it would be logical to assign a respective DACL to the device, but, in fact, everyone has access to it. This error is critical since it can break the entire attack chain.
</li>
</ol>
<p id="p25">Generally speaking, I could finish this research after an unsuccessful attempt to open the driver, but the careful examination of the error code gave me the first clue.</p>
<p id="p26">By the way, you can check the DACL of any device using the following command:</p>
<code id="code28" class="highlight python"><div class="wrapper"><div class="l l1"><span class="n">icacls</span><span class="p">.</span><span class="n">exe</span> \\<span class="p">.</span>\<span class="n">Device</span>\<span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span></div></div></code><p id="p27">or:</p>
<code id="code29" class="highlight python"><div class="wrapper"><div class="l l1"><span class="n">accesschk</span><span class="p">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">l</span> \\<span class="p">.</span>\<span class="n">GLOBALROOT</span>\<span class="n">Device</span>\<span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span></div></div></code><p id="p28">As you have likely noticed, the disassembler listing contains plenty of IOCTL handlers. Should I reverse each of them? Or is there an alternative?</p>
<h2 id="h2-4">Fuzzing</h2>
<p id="p29">Fuzzing drivers is somewhat more complicated compared to fuzzing user-mode applications: you deal not with virtual space of a single process, but with the entire OS. Accordingly, the infrastructure becomes more sophisticated: you install the agent on a virtual PC and run it in QEMU/KVM (for instance, this approach is implemented in the <a id="link10" href="https://github.com/IntelLabs/kAFL">kAFL</a> fuzzer).</p>
<p id="p30">But to avoid multiplying entities beyond necessity, let&#8217;s try to find a simpler solution; if it doesn&#8217;t work, then I&#8217;ll start upgrading the infrastructure with agents and virtualization. Such a simple solution is the fuzzer called <a id="link11" href="https://github.com/nccgroup/DIBF">Dynamic Ioctl Brute-Forcer (DIBF)</a>. This utility just sends random IOCTLs from the user mode to the driver. No tricky mutations, no coverage collection, no stack trace saving, nothing.</p>
<h3 id="h3-1">Preparations</h3>
<p id="p31">To enhance fuzzing quality, I&#8217;m going to use two Windows features.</p>
<p id="p32">First, I enable additional verifications for the studied driver using the <a id="link12" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/devtest/driver-verifier">Driver Verifier</a> utility. This will increase the bug detection probability.</p>
<figure id="figure8" class="wp-caption no-text"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29556/verifier.png" alt="" title=""><figcaption class="wp-caption-text"></figcaption></figure><p id="p33">Second, I <a id="link13" href="https://winbuzzer.com/2020/06/23/how-to-configure-blue-screen-crash-bsod-dump-files-in-windows-10-xcxwbt/">kindly ask</a> Windows to collect complete memory dumps after BSOD crashes. This will help in crash analysis.</p>
<figure id="figure9" class="wp-caption no-text"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29555/setup-and-recovery.png" alt="" title=""><figcaption class="wp-caption-text"></figcaption></figure><h3 id="h3-2">DIBF</h3>
<p id="p34">I run DIBF using the command:</p>
<code id="code30" class="highlight python"><div class="wrapper"><div class="l l1"><span class="n">dibf</span><span class="p">.</span><span class="n">exe</span> \\<span class="p">.</span>\<span class="n">CtrlSM_Protected2adgnetworkwfpdrv</span></div></div></code><p id="p35">With no arguments, DIBF brute-forces IOCTL codes and also brute-forces the size of input buffers for IOCTL. When DIBF is run for the first time, the <code id="code31">dibf-bf-results.<wbr></wbr>txt</code> file is created.</p>
<code id="code32" class="highlight python"><div class="wrapper"><div class="l l1"><span class="err">$</span> <span class="nb">type</span> <span class="n">dibf</span><span class="o">-</span><span class="n">bf</span><span class="o">-</span><span class="n">results</span><span class="p">.</span><span class="n">txt</span></div><div class="l l2">\\<span class="p">.</span>\<span class="n">CtrlSM_Protected2adgnetworkwfpdrv</span></div><div class="l l3"><span class="mi">22019</span><span class="n">c</span> <span class="mi">0</span> <span class="mi">2000</span> <span class="o">&lt;</span><span class="o">---</span> <span class="n">IOCTL</span><span class="p">,</span> <span class="nb">min</span> <span class="nb">buffer</span> <span class="n">size</span><span class="p">,</span> <span class="nb">max</span> <span class="nb">buffer</span> <span class="n">size</span></div><div class="l l4"><span class="mi">22019</span><span class="n">d</span> <span class="mi">0</span> <span class="mi">2000</span></div><div class="l l5"><span class="p">..</span><span class="p">.</span></div></div></code><p id="p36">When DIBF is run for the second time, it reads IOCTL from the file, and fuzzing begins. I wait fifteen minutes and get the result. This is one of those rare occasions when a BSOD crash makes you happy since it occurred in the studied driver!</p>
<figure id="figure10" class="wp-caption no-text"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29520/bsod.png" alt="" title=""><figcaption class="wp-caption-text"></figcaption></figure><p id="p37">Thanks to Occam and his razor for fuzzing without excessive entities! Now let&#8217;s analyze the results. I open the <code id="code33">MEMORY.<wbr></wbr>DMP</code> file created by Windows after the crash in WinDbg, run the <code id="code34">analyze <wbr></wbr>-v</code> command and look at the stack trace.</p>
<figure id="figure11" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29553/crashdump.png" alt="Stack trace after the OS crash" title="Stack trace after the OS crash"><figcaption class="wp-caption-text">Stack trace after the OS crash</figcaption></figure><p id="p38">In WinDbg, I have a RAM snapshot at the time of the crash. I extract from it the base address of the <code id="code35">adgnetworkwfpdrv.<wbr></wbr>sys</code> module and start precisely examining it.</p>
<h2 id="h2-5">Reversing driver</h2>
<p id="p39">Below is the function where the crash occurred.</p>
<figure id="figure12" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29552/crash-disassm-code.png" alt="BSOD location" title="BSOD location"><figcaption class="wp-caption-text">BSOD location</figcaption></figure><p id="p40">As you can see, some list is traversed in the <code id="code36">while</code> loop. To save time, I&#8217;ll go straight to the reversal results and show the data the driver interacts with.</p>
<p id="p41">So, the driver creates a nonpaged memory pool with the <code id="code37">FLT3</code> tag. It contains a list of pointers to the headers of singly-linked lists.</p>
<figure id="figure13" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29548/driver-reverse-init.png" alt="Address space is conditionally divided into user mode and kernel mode. FLT3 is located in kernel mode" title="Address space is conditionally divided into user mode and kernel mode. FLT3 is located in kernel mode"><figcaption class="wp-caption-text">Address space is conditionally divided into user mode and kernel mode. FLT3 is located in kernel mode</figcaption></figure><p id="p42">The <code id="code38">g_AdgItemsCounter</code> global variable stores the number of <code id="code39">AdgItem</code> structures (to be addressed in more detail later). I have access to the IOCTL that adds an element to the list: <code id="code40">ADG_INSERT_ITEM</code>.</p>
<figure id="figure14" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29516/driver-reverse-insert-1.png" alt="Kernel memory after ADG_INSERT_ITEM IOCTL call" title="Kernel memory after ADG_INSERT_ITEM IOCTL call"><figcaption class="wp-caption-text">Kernel memory after ADG_INSERT_ITEM IOCTL call</figcaption></figure><p id="p43">The current value of <code id="code41">g_AdgItemsCounter</code> is written to <code id="code42">AdgItem.<wbr></wbr>index</code> and returned in the response.</p>
<p id="p44">The list size is 0xBCB. If you add to it an element whose number is 0xBCC or more, then such an element will be added to the list &#8216;at the next level&#8217;.</p>
<figure id="figure15" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29542/driver-reverse-insert-many.png" alt="Kernel memory after multiple ADG_INSERT_ITEM IOCTL calls" title="Kernel memory after multiple ADG_INSERT_ITEM IOCTL calls"><figcaption class="wp-caption-text">Kernel memory after multiple ADG_INSERT_ITEM IOCTL calls</figcaption></figure>
<div id="panel6" class="panel info"><div class="info-inner">
<h4>info</h4>
<p id="p45">This looks like a sophisticated multilevel list, and I still cannot understand what is it for. If you are familiar with such data organization, feel free to share your knowledge in comments.</p>
</div></div>
<p id="p46">In addition, I have access to the <code id="code43">ADG_EDIT_ITEM</code> IOCTL call, which enables me to edit <code id="code44">AdgItem</code> using the index. The controlled data are marked by red color.</p>
<figure id="figure16" class="wp-caption no-text"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29541/driver-reverse-edit.png" alt="" title=""><figcaption class="wp-caption-text"></figcaption></figure><p id="p47"><strong>I control the address of the next element in the list!</strong> Important: data are edited only after the passed index is successfully compared with <code id="code45">adgItem.<wbr></wbr>index</code> for equality</p>
<h2 id="h2-6">In the wake of the fuzzer</h2>
<p id="p48">DIBF has called <code id="code46">ADG_INSERT_ITEM</code> multiple times, then corrupted one of the list elements using <code id="code47">ADG_EDIT_ITEM</code>. The next time <code id="code48">ADG_EDIT_ITEM</code> is called, this list is traversed in a <code id="code49">while</code> loop until the desired element is found. Again, I provide the listing of the function where the BSOD crash occurred &#8211; but this time with explanations.</p>
<figure id="figure17" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29546/adggetbyindexfrompool-explained.png" alt="Function searching the list for an element by its index" title="Function searching the list for an element by its index"><figcaption class="wp-caption-text">Function searching the list for an element by its index</figcaption></figure><p id="p49">Accordingly, at a certain point, when <code id="code50">adgItem.<wbr></wbr>index</code> is dereferenced, the program follows the corrupted pointer.</p>
<figure id="figure18" class="wp-caption no-text"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29547/driver-reverse-dibf-bsod.png" alt="" title=""><figcaption class="wp-caption-text"></figcaption></figure><h2 id="h2-7">Some more reverse engineering</h2>
<p id="p50">Using cross-references to the <code id="code51">AdgGetByIndexFromPool(<wbr></wbr>)</code> function, I found one more important IOCTL: <code id="code52">ADG_UNLINK_ITEM</code>. It removes an element from a singly-linked list based on it index.</p>
<figure id="figure19" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29545/driver-reverse-unlink.png" alt="Removing an element from the list. Data controlled by the attacker are passed directly to FLT3" title="Removing an element from the list. Data controlled by the attacker are passed directly to FLT3"><figcaption class="wp-caption-text">Removing an element from the list. Data controlled by the attacker are passed directly to FLT3</figcaption></figure><p id="p51">Since I am in control of <code id="code53">AdgItem.<wbr></wbr>pNextItem</code>, I can write my data directly into the FLT3 memory area using a single DWORD.</p>
<h2 id="h2-8">Primitives</h2>
<p id="p52">Using various combinations of the found IOCTLs, I assemble two powerful primitives. In both cases, their cornerstone is corruption of a single-linked list.</p>
<p id="p53"><strong>Primitive 1.</strong> The combination of <code id="code54">ADG_INSERT_ITEM</code>, <code id="code55">ADG_EDIT_ITEM</code>, and <code id="code56">ADG_UNLINK_ITEM</code> enables you to write a sequence of bytes to the FLT3 pool. This makes it possible to craft fake structures in the kernel memory and bypass SMAP.</p>
<figure id="figure20" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29537/primitive-1.png" alt="Primitive 1. Bytes are sequentially written to FLT3" title="Primitive 1. Bytes are sequentially written to FLT3"><figcaption class="wp-caption-text">Primitive 1. Bytes are sequentially written to FLT3</figcaption></figure><p id="p54">However, such a primitive is of little use if you don&#8217;t know the address of the written data. KASLR deploys FLT3 at a random address.</p>
<p id="p55"><strong>Primitive 2.</strong> The previous combination is upgraded. Valid kernel addresses are passed to the <code id="code57">ADG_EDIT_ITEM</code> IOCTL, and a another call, <code id="code58">ADG_EDIT_ITEM</code>, is added to the IOCTL chain. As a result, I got an extremely powerful &#8220;arbitrary write 16 bytes to kernel memory&#8221; primitive.</p>
<figure id="figure21" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29536/primitive-2.png" alt="Primitive 2. Sixteen bytes are written to kernel memory" title="Primitive 2. Sixteen bytes are written to kernel memory"><figcaption class="wp-caption-text">Primitive 2. Sixteen bytes are written to kernel memory</figcaption></figure><p id="p56">Note that the first five DWORDs in FLT3 can be used, for instance, to create structures; while the sixth one, for the &#8220;arbitrary write&#8221; primitive.</p>
<p id="p57">At this research stage, a potential exploit takes shape. Using the above primitives, I can create my own objects in the kernel.</p>
<p id="p58">But to make full use of these primitives, three critical problems have to be solved.</p>
<h3 id="h3-3">Problems 1 and 2. KASLR</h3>
<p id="p59">Binary mitigations in Windows complicate exploitation. It&#8217;s definitely great that I can populate FLT3 with controlled data, but it&#8217;s not enough. If I want to craft some kind of kernel object there, I have to know the address to be able to use it. In addition, I have to know the address of some kernel object in order to relink the list to it.</p>
<p id="p60">I am going to use the <a id="link14" href="https://github.com/sam-b/windows_kernel_address_leaks">Windows Kernel Address Leaks</a> repository. Even though its last commit is dated 2017, its techniques still work well.</p>
<figure id="figure22" class="wp-caption no-text"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29543/windows-kernel-address-leaks.png" alt="" title=""><figcaption class="wp-caption-text"></figcaption></figure><p id="p61">Most of these techniques are based on the following undocumented function from ntdll:</p>
<code id="code59" class="highlight plaintext"><div class="wrapper"><div class="l l1"><span class="none">NtQuerySystemInformation()
</span></div></div></code><p id="p62">One of the calls can leak addresses of all nonpaged pools where you can easily find the <code id="code60">FLT3</code> tag. Another call leaks addresses of EPROCESS structures, tokens, etc. But prior to choosing a kernel structure, Problem 3 has to be solved.</p>
<h3 id="h3-4">Problem 3. Comparison with index</h3>
<p id="p63">Even though I am researching a 32-bit driver, the index is stored in the <code id="code61">adgItem</code> structure in two DWORDs. And the value of <code id="code62">g_AdgItemsCounter</code> used to initialize it is stored in one DWORD. Therefore, the second DWORD must always be equal to zero.</p>
<figure id="figure23" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29538/adgitem-mem-layout.png" alt="adgItem in kernel memory" title="adgItem in kernel memory"><figcaption class="wp-caption-text">adgItem in kernel memory</figcaption></figure>
<div id="panel7" class="panel info"><div class="info-inner">
<h4>info</h4>
<p id="p64">I suppose that this is because the _aullrem instruction is used for division with remainder: this instruction works with 64-bit integers on 32-bit systems.</p>
</div></div>
<p id="p65">0xBCC is <code id="code63">adgItem.<wbr></wbr>index</code>. It is always followed by a NULL DWORD (shown in the red frame). If I manage to relink a singly-linked list to some kernel object matching the &#8220;predictable DWORD, NULL DWORD&#8221; pattern, then I would be able to pass the check and write next 16 bytes of controlled data (shown in the black frame in the figure above).</p>
<figure id="figure24" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29535/adgedititem-cmp.png" alt="Function that writes 16 controlled bytes to the kernel memory" title="Function that writes 16 controlled bytes to the kernel memory"><figcaption class="wp-caption-text">Function that writes 16 controlled bytes to the kernel memory</figcaption></figure><p id="p66">Why the first DWORD must be predictable (i.e. why should I know it in advance from the user mode)? I have to pass the index of the element that will be compared with this DWORD to the <code id="code64">ADG_EDIT_ITEM</code> IOCTL. If the equality check fails, then the driver code will continue the traversal of the singly-linked list, and a BSOD crash will occur (like it was during fuzzing).</p>
<p id="p67">Overall, the kernel object suitable for arbitrary writing must meet the following criteria:</p>
<ul id="ul1">
<li id="li3">object address leaks through Windows Kernel Address Leaks;
</li>
<li id="li4">object layout includes a memory area that matches the &#8220;predictable DWORD, NULL DWORD&#8221; pattern. A DWORD with flags would fit perfectly as the predictable DWORD; and </li>
<li id="li5">changes in the 16 bytes located in the kernel object after the pattern should result in privilege escalation.
</li>
</ul>
<p id="p68">I already have a key that enables me to write 16 bytes to the kernel; now all I have to do is find a lock fitting this key.</p>
<h2 id="h2-9">Exploitation</h2>
<p id="p69">I thoroughly examine the Windows Kernel Address Leaks repository, identify kernel structures that are leaking, and look for something that matches the above criteria.</p>
<p id="p70">It&#8217;s possible to leak the address of the <code id="code65">EPROCESS</code> structure and calculate the address of <code id="code66">OBJECT_HEADER</code>:</p>
<code id="code67" class="highlight plaintext"><div class="wrapper"><div class="l l1"><span class="none">EPROCESS </span><span class="none">- </span><span class="none">sizeof(</span><span class="none">OBJECT_</span><span class="none">HEADER)
</span></div></div></code><p id="p71">Let&#8217;s examine the <code id="code68">OBJECT_HEADER</code> structure in the <code id="code69">AdguardSvc.<wbr></wbr>exe</code> service process.</p>
<div id="panel8" class="panel info"><div class="info-inner">
<h4>info</h4>
<p id="p72">For exploitation purposes, you can use the <code id="code70">OBJECT_HEADER</code> structure of any privileged process; I just chose a service process from the same vendor.</p>
</div></div>
<figure id="figure25" class="wp-caption no-text"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29533/sd.png" alt="" title=""><figcaption class="wp-caption-text"></figcaption></figure><p id="p73">Memory area matching the pattern is shown in the red frame: the predictable DWORD is equal to six, and it&#8217;s followed by a NULL DWORD. Six is the number of open handles for the <code id="code71">OBJECT_HEADER.<wbr></wbr>HandleCount</code> process object.</p>
<p id="p74">The exploit isn&#8217;t 100% reliable because I cannot control entities that open handles. For instance, if the antivirus decides to scan memory and opens AdguardSvc.exe, then this value would become equal to seven, and the exploit will cause a BSOD crash. But I am not writing an exploit for sale, but just examining the Windows structure; therefore, absolute reliability in this particular case isn&#8217;t required.</p>
<p id="p75">I found a suitable pattern and now can overwrite the next 16 bytes, including a pointer to the Security Descriptor! This pointer belongs to the <code id="code72">EX_FAST_REF</code> type and points to a structure that contains DACL and describes access rights to the object.</p>
<div id="panel9" class="panel www"><div class="www-inner">
<h4>www</h4>
<p id="p76">More information about <a id="link15" href="https://codemachine.com/articles/exfastref_pointers.html%20type">EX_FAST_REF pointers</a> can be found on the CodeMachine website.</p>
</div></div>
<figure id="figure26" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29522/sd-and-prochacker.png" alt="Security Descriptor of a highly privileged process" title="Security Descriptor of a highly privileged process"><figcaption class="wp-caption-text">Security Descriptor of a highly privileged process</figcaption></figure><p id="p77">Note the <code id="code73">SE_DACL_PRESENT</code> and <code id="code74">SE_SACL_PRESENT</code> flags. Their presence means that the DACL and SACL are set explicitly. The DACL contains two ACEs (i.e. highly privileged NT SYSTEM users), and members of the Administrators group can open process handles for various operations.</p>
<p id="p78">The situation with SACL is not so obvious. The System Access Control List (SACL) contains not only the object access logging attributes, but also its integrity level. This field is very important when it comes to the protection of objects in Windows. In this particular case, the <code id="code75">ML_SYSTEM</code> integrity level is high.</p>
<p id="p79">What happens if I turn these flags off? DACL and SACL will become NULL.</p>
<figure id="figure27" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29525/edit-sd.png" alt="Security Descriptor after turning the flags off" title="Security Descriptor after turning the flags off"><figcaption class="wp-caption-text">Security Descriptor after turning the flags off</figcaption></figure><p id="p80">How does a NULL pointer in these fields affect a security descriptor? Let&#8217;s open MSDN and see what it <a id="link16" href="https://learn.microsoft.com/en-us/windows/win32/secauthz/null-dacls-and-empty-dacls">says</a>: a null DACL grants full access to any user that requests it. Sounds promising! And a null SACL <a id="link17" href="https://learn.microsoft.com/en-us/windows/win32/secauthz/mandatory-integrity-control">means</a> that &#8220;the object will be treated as if it had medium integrity.&#8221; Normally, an ordinary user has a medium integrity level.</p>
<p id="p81">In other words, a privileged object with a NULL DACL/SACL can be opened by an unprivileged user, which translates into local privilege escalation.</p>
<p id="p82">To check this, I open <code id="code76">AdguardSvc.<wbr></wbr>exe</code> after turning <code id="code77">SE_DACL_PRESENT</code> and <code id="code78">SE_SACL_PRESENT</code> off and try to inject some DLL into the process. Success!</p>
<figure id="figure28" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29532/dll-inject-poc.png" alt="DLL injected into a privileged process after turning the `SE_DACL_PRESENT` and `SE_SACL_PRESENT` flags off" title="DLL injected into a privileged process after turning the `SE_DACL_PRESENT` and `SE_SACL_PRESENT` flags off"><figcaption class="wp-caption-text">DLL injected into a privileged process after turning the `SE_DACL_PRESENT` and `SE_SACL_PRESENT` flags off</figcaption></figure>
<div id="panel10" class="panel info"><div class="info-inner">
<h4>info</h4>
<p id="p83">Generally speaking, when a subject opens an object, Windows Security Reference Monitor compares the SID in the subject (user) token with the ACE in the object&#8217;s security descriptor.</p>
</div></div>
<p id="p84">This means that I can craft a weak Security Descriptor in the FLT3 memory area using the first primitive and rewrite the pointer to it using the second primitive.</p>
<p id="p85">However, using the primitive, I overwrite 16 bytes, while the pointer occupies only four of them. Let&#8217;s take another look at <code id="code79">OBJECT_HEADER</code> and examine the remaining 12 bytes.</p>
<figure id="figure29" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29515/type-ind-not-ok.png" alt="16 bytes (4 DWORDs) that are mandatorily overwritten (shown in black frames)" title="16 bytes (4 DWORDs) that are mandatorily overwritten (shown in black frames)"><figcaption class="wp-caption-text">16 bytes (4 DWORDs) that are mandatorily overwritten (shown in black frames)</figcaption></figure><p id="p86">The remaining 12 bytes (out of the 16) must be checked as well. <code id="code80">ObjectCreateInfo</code> can be overwritten with zeros, and BSOD won&#8217;t occur (verified experimentally). The security descriptor has already been discussed. <code id="code81">EPROECSS.<wbr></wbr>Header.<wbr></wbr>Lock</code> has a constant value of 3 and can be easily overwritten with the same value. The same applies to flags 0x88. Only one byte remains: 0xC4 <code id="code82">OBJECT_HEADER.<wbr></wbr>TypeIndex</code>.</p>
<p id="p87">In Windows 10, <code id="code83">OBJECT_HEADER.<wbr></wbr>TypeIndex</code> is a pointer to the <code id="code84">nt!<wbr></wbr>ObTypeIndexTable</code> table, and it&#8217;s <strong>XORed</strong> with <code id="code85">nt!<wbr></wbr>ObHeaderCookie</code>. Too bad, the <code id="code86">nt!<wbr></wbr>ObHeaderCookie</code> value is unknown to us, user-mode <del>hackers</del> pentesters. This means that I have no idea how to overwrite it using my primitive.</p>
<div id="panel11" class="panel www"><div class="www-inner">
<h4>www</h4>
<p id="p88"><a id="link18" href="https://medium.com/@ashabdalhalim/a-light-on-windows-10s-object-header-typeindex-value-e8f907e7073a">A Light on Windows 10&#8217;s &#8220;OBJECT_HEADER-&gt;TypeIndex&#8221;</a> is a useful article describing TypeIndex in various OS versions.</p>
</div></div>
<p id="p89">This is how Windows prevents attacks involving the <code id="code87">ObfDereferenceObject(<wbr></wbr>)</code> function. If you manage to corrupt <code id="code88">TypeIndex</code>, you can seize control in the kernel. For more information see the article <a id="link19" href="https://research.nccgroup.com/2020/05/18/cve-2018-8611-exploiting-windows-ktm-part-4-5-from-race-win-to-kernel-read-and-write-primitive/">CVE-2018-8611 Exploiting Windows</a> by Aaron Adams.</p>
<p id="p90">Does this break my exploitation scheme? In fact, no. First, corrupt <code id="code89">OBJECT_HEADER.<wbr></wbr>TypeIndex</code> doesn&#8217;t crash Windows. Instead of BSOD, you just get an error when you call <code id="code90">CreateProcess(<wbr></wbr>)</code> from the user mode.</p>
<p id="p91">Let&#8217;s perform a simple experiment: open <code id="code91">notepad.<wbr></wbr>exe</code>, damage its <code id="code92">TypeIndex</code> in WinDbg, and try to open the process.</p>
<figure id="figure30" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29540/type-index-corrupt-and-test.png" alt="Error opening a process with damaged OBJECT_HEADER.TypeIndex" title="Error opening a process with damaged OBJECT_HEADER.TypeIndex"><figcaption class="wp-caption-text">Error opening a process with damaged OBJECT_HEADER.TypeIndex</figcaption></figure><p id="p92">Then I restore its value and make another attempt.</p>
<figure id="figure31" class="wp-caption"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29539/type-index-restore-and-test.png" alt="Command executed successfully" title="Command executed successfully"><figcaption class="wp-caption-text">Command executed successfully</figcaption></figure><p id="p93">Since <code id="code93">TypeIndex</code> is just one byte, it can be quickly brute-forced. So, I can use the &#8220;arbitrary write 16 bytes&#8221; primitive with a new <code id="code94">OBJECT_HEADER.<wbr></wbr>TypeIndex</code> (but with the same security descriptor) and try calling the following function:</p>
<code id="code95" class="highlight plaintext"><div class="wrapper"><div class="l l1"><span class="none">CreateProcess(</span><span class="none">PROCESS_</span><span class="none">ALL_</span><span class="none">ACCESS)
</span></div></div></code><p id="p94">As soon as I guess the required value, the process handle will be returned to me. After that, the service process will be under my full control, and I can inject into it whatever I want. I&#8217;m going to use the classic combination <code id="code96">WriteProcessMemory(<wbr></wbr>)</code> + <code id="code97">CreateRemoteThread(<wbr></wbr>)</code>.</p>
<p id="p95">The attack chain is ready. Let&#8217;s go through its steps again.</p>
<p id="p96"><strong>Step 0.</strong> Initial state. The FLT3 pool is empty. The service process is protected by a strong security descriptor.</p>
<figure id="figure32" class="wp-caption no-text"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29530/stage-0.png" alt="" title=""><figcaption class="wp-caption-text"></figcaption></figure><p id="p97"><strong>Step 1.</strong> I leak the FLT3 and EPROCESS AdguardSvc.exe addresses in the kernel space.</p>
<figure id="figure33" class="wp-caption no-text"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29529/stage-1.png" alt="" title=""><figcaption class="wp-caption-text"></figcaption></figure><p id="p98">Important: <code id="code98">SYSTEM_HANDLE_INFORMATION</code> leaks addresses of EPROCESS structures, and an address itself isn&#8217;t enough to understand which user-mode process it belongs to. Therefore, I have to use heuristics:</p>
<ul id="ul2">
<li id="li6">collect all EPROCESS addresses for the first time;
</li>
<li id="li7">start the service (since this operation is available to an unprivileged user). The <code id="code99">AdguardSvc.<wbr></wbr>exe</code> process starts;
</li>
<li id="li8">collect all EPROCESS addresses for the second time; and </li>
<li id="li9">identify the difference between the two sets: the only found EPROCESS belongs to <code id="code100">AdguardSvc.<wbr></wbr>exe</code>.
</li>
</ul>
<p id="p99">Proceeding further.</p>
<p id="p100"><strong>Step 2.</strong> Inject a weak security descriptor (NULL DACL/SACL) into FLT3 using the &#8220;write to FLT3&#8221; primitive. Since I know the FLT3 address from the previous step, I know the kernel address the writing occurred at.</p>
<figure id="figure34" class="wp-caption no-text"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29518/stage-2.png" alt="" title=""><figcaption class="wp-caption-text"></figcaption></figure><p id="p101">Important: <code id="code101">Chunk</code> in FLT3 consists of four DWORDs: <code id="code102">{<wbr></wbr>NULL, <wbr></wbr>8, <wbr></wbr>NULL, <wbr></wbr>NULL}</code>. They must be placed before the security descriptor to prevent an <code id="code103">INVALID_REF_COUNT</code> BSOD. I suppose that it contains service info of the heap manager.</p>
<p id="p102"><strong>Step 3.</strong> Using the &#8220;arbitrary write 16 bytes primitive&#8221;, I overwrite the pointer to the security descriptor: the original strong descriptor is substituted by a weak one.</p>
<figure id="figure35" class="wp-caption no-text"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29517/stage-3.png" alt="" title=""><figcaption class="wp-caption-text"></figcaption></figure><p id="p103"><strong>Step 4.</strong> Using the same primitive, I brute-force <code id="code104">OBJECT_HEADER.<wbr></wbr>TypeIndex</code> until I get the service process handle.</p>
<figure id="figure36" class="wp-caption no-text"><img decoding="async" src="https://static.xakep.ru/images/5496015497f44075d2bb96ae97487d1c/29527/stage-4.png" alt="" title=""><figcaption class="wp-caption-text"></figcaption></figure><p id="p104"><strong>Step 5.</strong> I &#8216;inject myself&#8217; into the service process, thus, seizing control over it. As a result, my privileges in the system have been elevated. The exploit code is available in <a id="link20" href="https://github.com/Marsel-marsel/CVE-2022-45770/blob/master/exploit.cpp">my GitHub repository</a>.</p>
<div id="panel12" class="panel www"><div class="www-inner">
<h4>www</h4>
<p id="p105">Demonstration video can be viewed at https://www.youtube.com/watch?v=Zc7jImfTkg4.</p>
</div></div>

<div id="panel13" class="panel default"><div class="default-inner">
<h4> Timeline</h4>
<ul id="ul3">
<li id="li10">August 17, 2022 &#8211; vulnerability reported to vendor;
</li>
<li id="li11">August 17, 2022 &#8211; vendor accepted report for verification;
</li>
<li id="li12">August 26, 2022 &#8211; vendor acknowledged the vulnerability; bug bounty paid;
</li>
<li id="li13">October 24, 2022 &#8211; <a id="link21" href="https://adguard.com/en/versions/windows/release.html#version-71140780">vulnerability fixed in version 7.11</a>; and </li>
<li id="li14">January 27, 2023 &#8211; publication (in Russian).
</li>
</ul>

</div></div>
</article>			</div>
			<footer>
								<p></p>
				<!-- <div class="addthis_native_toolbox"></div> -->
				<div class="addthis_sharing_toolbox"></div>
				<br/>
			</footer>
							<section id="comments">
        <h3>2 Responses to &#8220;Sad Guard. Identifying and exploiting vulnerability in AdGuard driver for Windows&#8221;</h3>
        <ol class="comment-list">

    
        <li class="comment even thread-even depth-1 parent" id="comment-124518">
            <article id="comment-body-124518" class="comment-body">



		<header class="comment-author">

			<img src="https://secure.gravatar.com/avatar/2c549cdae9eba202cc6a5e9c61bcb213?s=48&d=mm&r=g" />
			<div class="author-meta vcard author">

			<cite class="fn">teo</cite>			<time datetime="2023-05-06T02:00:35+00:00"><a href="https://hackmag.com/security/aguard-cve/#comment-124518">May 6, 2023</a></time>

			</div><!-- /.comment-author -->

		</header>

                <section id="comment-content-124518" class="comment">
                    <p>Does adguard have bug bounty program?</p>
                                    </section><!-- /.comment-content -->

                <div class="comment-meta comment-meta-data hide">
                    <a href="https://hackmag.com/security/aguard-cve/#comment-124518">May 6, 2023 at 2:00 am</a>                 </div><!-- /.comment-meta -->

                <div class="reply">
                    <a rel="nofollow" class="comment-reply-link" href="https://hackmag.com/security/aguard-cve/?replytocom=124518#respond" data-commentid="124518" data-postid="5471" data-belowelement="comment-124518" data-respondelement="respond" data-replyto="Reply to teo" aria-label="Reply to teo">Reply</a>                </div><!-- /.reply -->
            </article><!-- /.comment-body -->

    
                <ul class="children">
    
        <li class="comment odd alt depth-2" id="comment-126019">
            <article id="comment-body-126019" class="comment-body">



		<header class="comment-author">

			<img src="https://secure.gravatar.com/avatar/49a56dbb3fd2d6a2740eac9a78a8439d?s=48&d=mm&r=g" />
			<div class="author-meta vcard author">

			<cite class="fn">Marsel Shagiev</cite>			<time datetime="2023-06-07T14:32:19+00:00"><a href="https://hackmag.com/security/aguard-cve/#comment-126019">June 7, 2023</a></time>

			</div><!-- /.comment-author -->

		</header>

                <section id="comment-content-126019" class="comment">
                    <p>Hello. Sorry for long respond. Adguard doesn&#8217;t present in public bug bounty program like hackerone. I&#8217;ve found CTO&#8217;s email and reported vuln directly to him. Thank them for paying.</p>
                                    </section><!-- /.comment-content -->

                <div class="comment-meta comment-meta-data hide">
                    <a href="https://hackmag.com/security/aguard-cve/#comment-126019">June 7, 2023 at 2:32 pm</a>                 </div><!-- /.comment-meta -->

                <div class="reply">
                    <a rel="nofollow" class="comment-reply-link" href="https://hackmag.com/security/aguard-cve/?replytocom=126019#respond" data-commentid="126019" data-postid="5471" data-belowelement="comment-126019" data-respondelement="respond" data-replyto="Reply to Marsel Shagiev" aria-label="Reply to Marsel Shagiev">Reply</a>                </div><!-- /.reply -->
            </article><!-- /.comment-body -->

    
        </li><!-- /#comment-' . get_comment_ID() . ' -->

    
		</ul><!-- /.children -->

    
        </li><!-- /#comment-' . get_comment_ID() . ' -->

    
    </ol><!-- /#comment-list -->

    
 	</section>


<section id="respond">
	<h3>Leave a Reply</h3>
	<p class="cancel-comment-reply"><a rel="nofollow" id="cancel-comment-reply-link" href="/security/aguard-cve/#respond" style="display:none;">Click here to cancel reply.</a></p>
		<form action="https://hackmag.com/wp-comments-post.php" method="post" id="commentform">
				<p>
			<label for="author">
				Name (required)			</label>
			<input type="text" class="five" name="author" id="author" value="" size="22" tabindex="1" aria-required='true'>
		</p>
		<p>
			<label for="email">
				Email (will not be published) (required)			</label>
			<input type="text" class="five" name="email" id="email" value="" size="22" tabindex="2" aria-required='true'>
		</p>
		<p>
			<label for="url">
				Website			</label>
			<input type="text" class="five" name="url" id="url" value="" size="22" tabindex="3">
		</p>
				<p>
			<label for="comment">
					Comment			</label>
			<textarea name="comment" id="comment" tabindex="4"></textarea>
		</p>
		<p id="allowed_tags" class="small"><strong>XHTML:</strong> 
			You can use these tags: 
			<code>
				&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;s&gt; &lt;strike&gt; &lt;strong&gt; 			</code>
		</p>
		<p><input name="submit" class="button" type="submit" id="submit" tabindex="5" value="Submit Comment"></p>
		<input type='hidden' name='comment_post_ID' value='5471' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
		<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="42908593c8" /></p><p style="display: none !important;" class="akismet-fields-container" data-prefix="ak_"><label>&#916;<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js_1" name="ak_js" value="149"/><script>document.getElementById( "ak_js_1" ).setAttribute( "value", ( new Date() ).getTime() );</script></p>	</form>
	</section>
					</article>
	
	
	</div>
	<aside id="sidebar" class="small-12 large-4 columns">
	  	<article id="search-2" class="row widget widget_search"><div class="small-12 columns"><form role="search" method="get" id="searchform" action="https://hackmag.com/">
	<div class="row collapse">
				<div class="small-8 columns">
			<input type="text" value="" name="s" id="s" placeholder="Search">
		</div>
				<div class="small-4 columns">
			<input type="submit" id="searchsubmit" value="Search" class="prefix button">
		</div>
			</div>
</form>
</div></article><article id="custom_html-2" class="widget_text row widget widget_custom_html"><div class="widget_text small-12 columns"><div class="textwidget custom-html-widget"><a href="https://qrator.net/en/" target="_blank" style="display:block;width:240px;margin:20px auto"><img src="https://hackmag.com/wp-content/uploads/2019/07/q240x400.jpg" alt="Protected by Qrator Labs" /></a></div></div></article>
		<article id="recent-posts-2" class="row widget widget_recent_entries"><div class="small-12 columns">
		<h6>Recent Posts</h6>
		<ul>
											<li>
					<a href="https://hackmag.com/security/malformed-elf/">Malformed ELFs. How to make executable Linux files debug-resistant</a>
									</li>
											<li>
					<a href="https://hackmag.com/security/effective-yara/">YARA to the maximum. Learn to write effective YARA rules by examples</a>
									</li>
											<li>
					<a href="https://hackmag.com/mobile/hacking-smartphone/">Cyberphone. Transforming an Android smartphone into a hacker tool</a>
									</li>
											<li>
					<a href="https://hackmag.com/security/karma-guide/">KARMAgeddon. Attacking client devices with Karma</a>
									</li>
											<li>
					<a href="https://hackmag.com/security/wifi-bruteforce/">Brute-force on-the-fly. Attacking wireless networks in a simple and effective way</a>
									</li>
					</ul>

		</div></article><article id="recent-comments-2" class="row widget widget_recent_comments"><div class="small-12 columns"><h6>Recent Comments</h6><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link">Lev Emeliyanov</span> on <a href="https://hackmag.com/security/diy-pineapple/#comment-135941">Poisonous fruit. How to assemble your own Wi-Fi Pineapple and put it to use</a></li><li class="recentcomments"><span class="comment-author-link">big_bad_wolfe</span> on <a href="https://hackmag.com/security/diy-pineapple/#comment-134935">Poisonous fruit. How to assemble your own Wi-Fi Pineapple and put it to use</a></li><li class="recentcomments"><span class="comment-author-link">John Smith</span> on <a href="https://hackmag.com/security/hack-cams/#comment-133081">Keep your eyes open! Hacking others IP and Web cameras while keeping yours safe</a></li><li class="recentcomments"><span class="comment-author-link">John Smith</span> on <a href="https://hackmag.com/security/hack-cams/#comment-133080">Keep your eyes open! Hacking others IP and Web cameras while keeping yours safe</a></li><li class="recentcomments"><span class="comment-author-link">Denis</span> on <a href="https://hackmag.com/security/software-for-cracking-software/#comment-133008">Software for cracking software. Selecting tools for reverse engineering</a></li></ul></div></article><article id="democracy-2" class="row widget widget_democracy"><div class="small-12 columns">
<style id="democracy-poll">.democracy:after{content:'';display:table;clear:both}.democracy ul li,.democracy ul{background:0 0;padding:0;margin:0}.democracy ul li:before{display:none}.democracy input[type=radio],.democracy input[type=checkbox]{margin:0;vertical-align:middle}.democracy input[type=radio]:focus,.democracy input[type=checkbox]:focus{outline:none}.democracy ul{list-style:none !important;border:none !important}.democracy ul li{list-style:none !important}input[type=submit].dem-button,a.dem-button,.dem-button{position:relative;display:inline-block;text-decoration:none;line-height:1;border:0;margin:0;padding:0;cursor:pointer;white-space:nowrap;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}input[type=submit].dem-button:focus,a.dem-button:focus,.dem-button:focus{outline:none}input[type=submit].dem-button:disabled,a.dem-button:disabled,.dem-button:disabled{opacity:.6;cursor:not-allowed}a.dem-button:hover{text-decoration:none !important}.democracy{position:relative;margin:0 auto}.democracy input[type=radio],.democracy input[type=checkbox]{margin-right:.2em}.dem-screen{position:relative;line-height:1.3}.democracy ul.dem-vote{margin-bottom:1em}.democracy ul.dem-vote li{padding-bottom:0;margin-bottom:0}.democracy ul.dem-vote li>*{margin-bottom:.6em}.democracy ul.dem-answers li{padding-bottom:1em}.dem-answers .dem-label{margin-bottom:.2em;line-height:1.2}.dem-graph{position:relative;color:#555;color:rgba(0,0,0,.6);box-sizing:content-box;width:100%;display:table;height:1.2em;line-height:1.2em}.dem-fill{position:absolute;top:0;left:0;height:100%;background-color:#7cb4dd}.dem-voted-this .dem-fill{background-color:#ffc45a}.dem-votes-txt,.dem-percent-txt{position:relative;display:table-cell;padding-left:.3em;vertical-align:middle;font-size:90%}.dem-poll-info{padding-bottom:1em}.dem-poll-info:after{content:'';display:table;clear:both}.dem-poll-info>*{font-size:85%;display:block;float:right;clear:both;text-align:right;opacity:.7;line-height:1.3}.dem-vote label{float:none;display:block}.dem-results-link{display:inline-block;line-height:1;margin:.8em 1em}.dem-vote .dem-disabled{opacity:.5}.democracy .dem-bottom{padding-bottom:1em}.dem-bottom{text-align:center}.dem-bottom:after{content:'';display:table;clear:both}.dem-poll-title{display:block;margin-bottom:1.5em;margin-top:1.2em;font-size:120%}.dem-notice{z-index:10;position:absolute;top:0;border-radius:2px;width:100%;padding:1.5em 2em;text-align:center;background:rgba(247,241,212,.8);color:#6d6214}.dem-notice-close{position:absolute;top:0;right:0;padding:5px;cursor:pointer;line-height:.6;font-size:150%}.dem-notice-close:hover{color:#d26616}.dem-star{font-size:90%;vertical-align:baseline;padding-left:.3em;color:#ff4e00}.dem-poll-note{font-size:90%;padding:.5em;opacity:.8;line-height:1.3}.democracy .dem-copyright{position:absolute;bottom:-1em;right:0;text-decoration:none;border-bottom:0;color:#b2b2b2;opacity:.5;line-height:1}.democracy .dem-copyright:hover{opacity:1}.dem-add-answer{position:relative}.dem-add-answer>*{display:block}.dem-add-answer a{display:inline-block}input.dem-add-answer-txt{width:100%;box-sizing:border-box}.dem-add-answer-close{position:absolute;right:0;padding:0 .7em;cursor:pointer;color:#333}.dem-add-answer-close:hover{color:#ff2700}.dem-edit-link{display:block;position:absolute;top:0;right:0;line-height:1;text-decoration:none !important;border:none !important}.dem-edit-link svg{width:1.2em!important;fill:#6c6c6c}.dem-edit-link:hover svg{fill:#35a91d}.dem-loader{display:none;position:absolute;top:0;left:0;width:100%;height:100%}.dem-loader>*{display:table-cell;vertical-align:middle;text-align:center}.dem-loader svg{width:20%;max-width:100px;min-width:80px;margin-bottom:15%}.dem-loader [class^=dem-]{margin-bottom:15%!important}.dem__collapser{display:block;cursor:pointer;text-align:center;font-size:150%;line-height:1}.dem__collapser:hover{color:#f31;background:rgba(255,255,255,.3)}.dem__collapser.expanded{position:relative;height:1em}.dem__collapser.collapsed{position:absolute;top:0;bottom:0;right:0;left:0}.dem__collapser .arr{display:block;position:absolute;bottom:0;width:100%}.dem__collapser.collapsed .arr:before{content:"▾"}.dem__collapser.expanded .arr:before{content:"▴"}.dem-poll-shortcode{margin-bottom:1.5em}.dem-archives .dem-elem-wrap{margin-bottom:2em;padding-bottom:20px;border-bottom:1px dashed rgba(0,0,0,.1)}.dem-archives .dem-archive-link{display:none}.dem-paging{text-align:center;margin:1.5em auto}.dem-paging>*{display:inline-block;padding:.3em .8em;border-radius:.2em;background:#e2e2e2;color:#333;text-decoration:none;text-transform:lowercase;user-select:none}.dem-paging>a{color:#333}.dem-paging>a:hover{background:#ccc;color:#333;text-decoration:none}.dem-paging .current{background:#656565;color:#fff}.dem-paging .dots{background:0 0}.dem-poll-title{text-align:center}.dem-link{display:inline-block;margin:.8em 0}.dem-link{font-size:90%}.dem-vote-link:before{content:'◂ '}.dem-vote label{opacity:.9}.dem-vote label:hover{opacity:1}.dem-results-link{display:block}.dem-graph{background-color:#f2f2f2;background-color:rgba(0,0,0,.1);height:.4em;line-height:.4em}.dem-voted-this{font-weight:700}.dem-label-percent-txt{display:inline;font-size:80%;opacity:.8}.dem-label-percent-txt:before{content:'('}.dem-label-percent-txt:after{content:')'}.dem-votes-txt,.dem-percent-txt{display:none}input[type=submit].dem-button,a.dem-button,.dem-button{font-size:90%;font-family:tahoma,arial,sans-serif;padding:.8em 1.6em !important;color:#fff;background:#61a9de;text-transform:uppercase}input[type=submit].dem-button:hover,a.dem-button:hover,.dem-button:hover{color:#fff;background:#3b8bc6}a.dem-button:visited{color:#fff}.dem-loader .fill{fill:#000 !important}.dem-loader .css-fill{background-color:#000 !important}.dem-loader .stroke{stroke:#000 !important}</style>
<div id="democracy-2" class="democracy" data-opts='{"ajax_url":"https:\/\/hackmag.com\/wp-admin\/admin-ajax.php","pid":2,"max_answs":0,"answs_max_height":500,"anim_speed":400,"line_anim_speed":1500}' ><h6>What do you think about HackMag.com domain name?</h6><div class="dem-screen vote"><form method="POST" action="#democracy-2"><ul class="dem-vote">
					<li data-aid="8">
						<label class="dem__radio_label">
							<input class="dem__radio"  type="radio" value="8" name="answer_ids[]"><span class="dem__spot"></span> Cool, attractive and reflect content
						</label>
					</li>
					<li data-aid="6">
						<label class="dem__radio_label">
							<input class="dem__radio"  type="radio" value="6" name="answer_ids[]"><span class="dem__spot"></span> Sounds OK, I like it
						</label>
					</li>
					<li data-aid="7">
						<label class="dem__radio_label">
							<input class="dem__radio"  type="radio" value="7" name="answer_ids[]"><span class="dem__spot"></span> It has some negative connotations
						</label>
					</li><li class="dem-add-answer"><a href="javascript:void(0);" rel="nofollow" data-dem-act="newAnswer" class="dem-link">Add your answer</a></li></ul><div class="dem-bottom"><input type="hidden" name="dem_act" value="vote"><input type="hidden" name="dem_pid" value="2"><div class="dem-vote-button"><input class="dem-button " type="submit" value="Vote" data-dem-act="vote"></div></div></form></div><noscript>Poll Options are limited because JavaScript is disabled in your browser.</noscript><div class="dem-loader"><div><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-ring">
  <rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect>
  <defs>
    <filter id="uil-ring-shadow" x="-100%" y="-100%" width="300%" height="300%">
      <feOffset result="offOut" in="SourceGraphic" dx="0" dy="0"></feOffset>
      <feGaussianBlur result="blurOut" in="offOut" stdDeviation="0"></feGaussianBlur>
      <feBlend in="SourceGraphic" in2="blurOut" mode="normal"></feBlend>
    </filter>
  </defs>
  <path class="fill" fill="#f56800" filter="url(#uil-ring-shadow)" d="M10,50c0,0,0,0.5,0.1,1.4c0,0.5,0.1,1,0.2,1.7c0,0.3,0.1,0.7,0.1,1.1c0.1,0.4,0.1,0.8,0.2,1.2c0.2,0.8,0.3,1.8,0.5,2.8 c0.3,1,0.6,2.1,0.9,3.2c0.3,1.1,0.9,2.3,1.4,3.5c0.5,1.2,1.2,2.4,1.8,3.7c0.3,0.6,0.8,1.2,1.2,1.9c0.4,0.6,0.8,1.3,1.3,1.9 c1,1.2,1.9,2.6,3.1,3.7c2.2,2.5,5,4.7,7.9,6.7c3,2,6.5,3.4,10.1,4.6c3.6,1.1,7.5,1.5,11.2,1.6c4-0.1,7.7-0.6,11.3-1.6 c3.6-1.2,7-2.6,10-4.6c3-2,5.8-4.2,7.9-6.7c1.2-1.2,2.1-2.5,3.1-3.7c0.5-0.6,0.9-1.3,1.3-1.9c0.4-0.6,0.8-1.3,1.2-1.9 c0.6-1.3,1.3-2.5,1.8-3.7c0.5-1.2,1-2.4,1.4-3.5c0.3-1.1,0.6-2.2,0.9-3.2c0.2-1,0.4-1.9,0.5-2.8c0.1-0.4,0.1-0.8,0.2-1.2 c0-0.4,0.1-0.7,0.1-1.1c0.1-0.7,0.1-1.2,0.2-1.7C90,50.5,90,50,90,50s0,0.5,0,1.4c0,0.5,0,1,0,1.7c0,0.3,0,0.7,0,1.1 c0,0.4-0.1,0.8-0.1,1.2c-0.1,0.9-0.2,1.8-0.4,2.8c-0.2,1-0.5,2.1-0.7,3.3c-0.3,1.2-0.8,2.4-1.2,3.7c-0.2,0.7-0.5,1.3-0.8,1.9 c-0.3,0.7-0.6,1.3-0.9,2c-0.3,0.7-0.7,1.3-1.1,2c-0.4,0.7-0.7,1.4-1.2,2c-1,1.3-1.9,2.7-3.1,4c-2.2,2.7-5,5-8.1,7.1 c-0.8,0.5-1.6,1-2.4,1.5c-0.8,0.5-1.7,0.9-2.6,1.3L66,87.7l-1.4,0.5c-0.9,0.3-1.8,0.7-2.8,1c-3.8,1.1-7.9,1.7-11.8,1.8L47,90.8 c-1,0-2-0.2-3-0.3l-1.5-0.2l-0.7-0.1L41.1,90c-1-0.3-1.9-0.5-2.9-0.7c-0.9-0.3-1.9-0.7-2.8-1L34,87.7l-1.3-0.6 c-0.9-0.4-1.8-0.8-2.6-1.3c-0.8-0.5-1.6-1-2.4-1.5c-3.1-2.1-5.9-4.5-8.1-7.1c-1.2-1.2-2.1-2.7-3.1-4c-0.5-0.6-0.8-1.4-1.2-2 c-0.4-0.7-0.8-1.3-1.1-2c-0.3-0.7-0.6-1.3-0.9-2c-0.3-0.7-0.6-1.3-0.8-1.9c-0.4-1.3-0.9-2.5-1.2-3.7c-0.3-1.2-0.5-2.3-0.7-3.3 c-0.2-1-0.3-2-0.4-2.8c-0.1-0.4-0.1-0.8-0.1-1.2c0-0.4,0-0.7,0-1.1c0-0.7,0-1.2,0-1.7C10,50.5,10,50,10,50z">
    <animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" repeatCount="indefinite" dur=".7s"></animateTransform>
  </path>
</svg></div></div></div><!--democracy-->
			<!--noindex-->
			<div class="dem-cache-screens" style="display:none;" data-opt_logs="1"><div class="dem-screen-cache vote"><form method="POST" action="#democracy-2"><ul class="dem-vote"> <li data-aid="8"> <label class="dem__radio_label"> <input class="dem__radio" type="radio" value="8" name="answer_ids[]"><span class="dem__spot"></span> Cool, attractive and reflect content </label> </li> <li data-aid="6"> <label class="dem__radio_label"> <input class="dem__radio" type="radio" value="6" name="answer_ids[]"><span class="dem__spot"></span> Sounds OK, I like it </label> </li> <li data-aid="7"> <label class="dem__radio_label"> <input class="dem__radio" type="radio" value="7" name="answer_ids[]"><span class="dem__spot"></span> It has some negative connotations </label> </li><li class="dem-add-answer"><a href="javascript:void(0);" rel="nofollow" data-dem-act="newAnswer" class="dem-link">Add your answer</a></li></ul><div class="dem-bottom"><input type="hidden" name="dem_act" value="vote"><input type="hidden" name="dem_pid" value="2"> <div class="dem-notice dem-youarevote" style="display:none;"> <div class="dem-notice-close" onclick="jQuery(this).parent().fadeOut();">&times;</div> You or your IP had already vote. </div> <span class="dem-revote-button-wrap" style="display:none;"> <form action="#democracy-2" method="POST"> <input type="hidden" name="dem_act" value="delVoted"> <input type="hidden" name="dem_pid" value="2"> <input type="submit" value="Revote" class="dem-revote-link dem-revote-button dem-button " data-dem-act="delVoted" data-confirm-text="Are you sure you want cancel the votes?"> </form> </span><div class="dem-vote-button"><input class="dem-button " type="submit" value="Vote" data-dem-act="vote"></div></div></form></div>
			</div>
			<!--/noindex--></div></article><article id="search-2" class="row widget widget_search"><div class="small-12 columns"><form role="search" method="get" id="searchform" action="https://hackmag.com/">
	<div class="row collapse">
				<div class="small-8 columns">
			<input type="text" value="" name="s" id="s" placeholder="Search">
		</div>
				<div class="small-4 columns">
			<input type="submit" id="searchsubmit" value="Search" class="prefix button">
		</div>
			</div>
</form>
</div></article>
		<article id="recent-posts-2" class="row widget widget_recent_entries"><div class="small-12 columns">
		<h6>Recent Posts</h6>
		<ul>
											<li>
					<a href="https://hackmag.com/security/malformed-elf/">Malformed ELFs. How to make executable Linux files debug-resistant</a>
									</li>
											<li>
					<a href="https://hackmag.com/security/effective-yara/">YARA to the maximum. Learn to write effective YARA rules by examples</a>
									</li>
											<li>
					<a href="https://hackmag.com/mobile/hacking-smartphone/">Cyberphone. Transforming an Android smartphone into a hacker tool</a>
									</li>
											<li>
					<a href="https://hackmag.com/security/karma-guide/">KARMAgeddon. Attacking client devices with Karma</a>
									</li>
											<li>
					<a href="https://hackmag.com/security/wifi-bruteforce/">Brute-force on-the-fly. Attacking wireless networks in a simple and effective way</a>
									</li>
					</ul>

		</div></article><article id="recent-comments-2" class="row widget widget_recent_comments"><div class="small-12 columns"><h6>Recent Comments</h6><ul id="recentcomments-2"><li class="recentcomments"><span class="comment-author-link">Lev Emeliyanov</span> on <a href="https://hackmag.com/security/diy-pineapple/#comment-135941">Poisonous fruit. How to assemble your own Wi-Fi Pineapple and put it to use</a></li><li class="recentcomments"><span class="comment-author-link">big_bad_wolfe</span> on <a href="https://hackmag.com/security/diy-pineapple/#comment-134935">Poisonous fruit. How to assemble your own Wi-Fi Pineapple and put it to use</a></li><li class="recentcomments"><span class="comment-author-link">John Smith</span> on <a href="https://hackmag.com/security/hack-cams/#comment-133081">Keep your eyes open! Hacking others IP and Web cameras while keeping yours safe</a></li><li class="recentcomments"><span class="comment-author-link">John Smith</span> on <a href="https://hackmag.com/security/hack-cams/#comment-133080">Keep your eyes open! Hacking others IP and Web cameras while keeping yours safe</a></li><li class="recentcomments"><span class="comment-author-link">Denis</span> on <a href="https://hackmag.com/security/software-for-cracking-software/#comment-133008">Software for cracking software. Selecting tools for reverse engineering</a></li></ul></div></article>	</aside></div>
<div class="sticky-container">
    <ul class="sticky">
                               		
                                     <li style="background-color:#333333">
                        <a target="_blank" href="https://www.facebook.com/HackerMag/">
                            <img width="32" height="32" alt="" src="https://hackmag.com/wp-content/plugins/sticky-social-icon/icon/facebook.png" />
                            <p>Facebook</p>
                        </a>
                    </li>
           		                                            		
                                     <li style="background-color:#333333">
                        <a target="_blank" href="https://twitter.com/hack_mag">
                            <img width="32" height="32" alt="" src="https://hackmag.com/wp-content/plugins/sticky-social-icon/icon/twitter.png" />
                            <p>Twitter</p>
                        </a>
                    </li>
           		                                                                                                                            		
                                     <li style="background-color:#333333">
                        <a target="_blank" href="https://hackmag.com/feed/">
                            <img width="32" height="32" alt="" src="https://hackmag.com/wp-content/plugins/sticky-social-icon/icon/rss.png" />
                            <p>Rss</p>
                        </a>
                    </li>
           		                                                                                                                                                                                        		
                                        </ul>
</div>

</section>
<div id="footer-container">
  <footer id="footer">
            
    <p><strong>HackMag.com &copy; 2025</strong></p>
    <a href="/">HackMag.com</a> publishes high-quality translated content about information security, cyber security, hacking, malware and devops.
  </footer>
</div>


<a class="exit-off-canvas"></a>

	
	</div>
</div>

<!-- Google Code for HackMag Conversion Page -->
<script type="text/javascript">
/* <![CDATA[ */
var google_conversion_id = 938271264;
var google_conversion_language = "en";
var google_conversion_format = "3";
var google_conversion_color = "ffffff";
var google_conversion_label = "cFzHCJ7iiWIQoMSzvwM";
var google_conversion_value = 14.00;
var google_conversion_currency = "USD";
var google_custom_params = window.google_tag_params;
var google_remarketing_only = true;
/* ]]> */
</script>
<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">
</script>
<noscript>
<div style="display:inline;">
<img height="1" width="1" style="border-style:none;" alt="" src="//www.googleadservices.com/pagead/conversion/938271264/?value=14.00&amp;currency_code=USD&amp;label=cFzHCJ7iiWIQoMSzvwM&amp;guid=ON&amp;script=0"/>
<!-- <img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/938271264/?value=0&amp;guid=ON&amp;script=0"/> -->
</div>
</noscript>



<script id="democracy-poll">/*!
 * JavaScript Cookie v2.2.0
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */
!function(e){var t;if("function"==typeof define&&define.amd&&(define(e),t=!0),"object"==typeof exports&&(module.exports=e(),t=!0),!t){var n=window.Cookies,i=window.Cookies=e();i.noConflict=function(){return window.Cookies=n,i}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(i){function o(){}function a(t,n,a){if("undefined"!=typeof document){"number"==typeof(a=e({path:"/"},o.defaults,a)).expires&&(a.expires=new Date(1*new Date+864e5*a.expires)),a.expires=a.expires?a.expires.toUTCString():"";try{var s=JSON.stringify(n);/^[\{\[]/.test(s)&&(n=s)}catch(e){}n=i.write?i.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var d="";for(var r in a)a[r]&&(d+="; "+r,!0!==a[r]&&(d+="="+a[r].split(";")[0]));return document.cookie=t+"="+n+d}}function s(e,n){if("undefined"!=typeof document){for(var o={},a=document.cookie?document.cookie.split("; "):[],s=0;s<a.length;s++){var d=a[s].split("="),r=d.slice(1).join("=");n||'"'!==r.charAt(0)||(r=r.slice(1,-1));try{var c=t(d[0]);if(r=(i.read||i)(r,c)||t(r),n)try{r=JSON.parse(r)}catch(e){}if(o[c]=r,e===c)break}catch(e){}}return e?o[e]:o}}return o.set=a,o.get=function(e){return s(e,!1)},o.getJSON=function(e){return s(e,!0)},o.remove=function(t,n){a(t,"",e(n,{expires:-1}))},o.defaults={},o.withConverter=n,o}((function(){}))}));var demwaitjquery=setInterval((function(){"undefined"!=typeof jQuery&&(clearInterval(demwaitjquery),jQuery(document).ready(democracyInit))}),50);function democracyInit(e){var t=".democracy",n=e(t);if(n.length){var i,o=".dem-screen",a=".dem-add-answer-txt",s=e(".dem-loader:first"),d={};d.opts=n.first().data("opts"),d.ajaxurl=d.opts.ajax_url,d.answMaxHeight=d.opts.answs_max_height,d.animSpeed=parseInt(d.opts.anim_speed),d.lineAnimSpeed=parseInt(d.opts.line_anim_speed),setTimeout((function(){var t=n.find(o).filter(":visible"),i=function(){t.each((function(){d.setHeight(e(this),1)}))};t.demInitActions(1),e(window).on("resize.demsetheight",i),e(window).on("load",i),d.maxAnswLimitInit();var a=e(".dem-cache-screens");a.length>0&&a.demCacheInit()}),1),e.fn.demInitActions=function(t){return this.each((function(){var n=e(this),i="data-dem-act";n.find("["+i+"]").each((function(){var t=e(this);t.attr("href",""),t.on("click",(function(e){e.preventDefault(),t.blur().demDoAction(t.attr(i))}))})),!!n.find("input[type=radio][data-dem-act=vote]").first().length&&n.find(".dem-vote-button").hide(),d.setAnswsMaxHeight(n),d.lineAnimSpeed&&n.find(".dem-fill").each((function(){var t=e(this);setTimeout((function(){t.animate({width:t.data("width")},d.lineAnimSpeed)}),d.animSpeed,"linear")})),d.setHeight(n,t),n.find("form").on("submit",(function(t){t.preventDefault(),e(this).find('input[name="dem_act"]').val()&&e(this).demDoAction(e(this).find('input[name="dem_act"]').val())}))}))},e.fn.demSetLoader=function(){var e=this;return s.length?e.closest(o).append(s.clone().css("display","table")):i=setTimeout((function(){d.demLoadingDots(e)}),50),this},e.fn.demUnsetLoader=function(){return s.length?this.closest(o).find(".dem-loader").remove():clearTimeout(i),this},e.fn.demAddAnswer=function(){var t=this.first(),n=t.closest(o),i=n.find("[type=checkbox]").length>0,s=e('<input type="text" class="'+a.replace(/\./,"")+'" value="">');if(n.find(".dem-vote-button").show(),n.find("[type=radio]").each((function(){e(this).on("click",(function(){t.fadeIn(300),e(a).remove()})),"radio"===e(this)[0].type&&(this.checked=!1)})),t.hide().parent("li").append(s),s.hide().fadeIn(300).focus(),i){var d=n.find(a);e('<span class="dem-add-answer-close">×</span>').insertBefore(d).css("line-height",d.outerHeight()+"px").on("click",(function(){var t=e(this).parent("li");t.find("input").remove(),t.find("a").fadeIn(300),e(this).remove()}))}return!1},e.fn.demCollectAnsw=function(){var t=this.closest("form"),n=t.find("[type=checkbox],[type=radio],[type=text]"),i=t.find(a).val(),o=[],s=n.filter("[type=checkbox]:checked");if(s.length>0)s.each((function(){o.push(e(this).val())}));else{var d=n.filter("[type=radio]:checked");d.length&&o.push(d.val())}return i&&o.push(i),(o=o.join("~"))||""},e.fn.demDoAction=function(n){var i=this.first(),a=i.closest(t),s={dem_pid:a.data("opts").pid,dem_act:n,action:"dem_ajax"};return void 0===s.dem_pid?(console.log("Poll id is not defined!"),!1):"vote"!==n||(s.answer_ids=i.demCollectAnsw(),s.answer_ids)?!("delVoted"===n&&!confirm(i.data("confirm-text")))&&("newAnswer"===n?(i.demAddAnswer(),!1):(i.demSetLoader(),e.post(d.ajaxurl,s,(function(t){i.demUnsetLoader(),i.closest(o).html(t).demInitActions(),setTimeout((function(){e("html:first,body:first").animate({scrollTop:a.offset().top-70},500)}),200)})),!1)):(d.demShake(i),!1)},e.fn.demCacheShowNotice=function(e){var t=this.first(),n=t.find(".dem-youarevote").first();return"blockForVisitor"===e&&(t.find(".dem-revote-button").remove(),n=t.find(".dem-only-users").first()),t.prepend(n.show()),setTimeout((function(){n.slideUp("slow")}),1e4),this},d.cacheSetAnswrs=function(t,n){var i=n.split(/,/);if(t.hasClass("voted")){var o=t.find(".dem-answers"),a=o.data("voted-class"),s=o.data("voted-txt");e.each(i,(function(n,i){t.find('[data-aid="'+i+'"]').addClass(a).attr("title",(function(){return s+e(this).attr("title")}))})),t.find(".dem-vote-link").remove()}else{var d=t.find("[data-aid]"),r=t.find(".dem-voted-button");e.each(i,(function(e,t){d.filter('[data-aid="'+t+'"]').find("input").prop("checked","checked")})),d.find("input").prop("disabled","disabled"),t.find(".dem-vote-button").remove(),r.length?r.show():(t.find('input[value="vote"]').remove(),t.find(".dem-revote-button-wrap").show())}},e.fn.demCacheInit=function(){return this.each((function(){var n=e(this),i=n.prevAll(t+":first");if(i.length||(i=n.closest(t)),i.length){var a=i.find(o).first(),s=i.data("opts").pid,r=Cookies.get("demPoll_"+s),c="notVote"===r,f=!(void 0===r||c),l=n.find(o+"-cache.vote").html(),h=n.find(o+"-cache.voted").html();if(l){var u=f&&h;if(a.html((u?h:l)+"\x3c!--cache--\x3e").removeClass("vote voted").addClass(u?"voted":"vote"),f&&d.cacheSetAnswrs(a,r),a.demInitActions(1),!c&&!f&&1==n.data("opt_logs")){var m,p=function(){m=setTimeout((function(){if(!i.hasClass("checkAnswDone")){i.addClass("checkAnswDone");var t=i.find(".dem-link").first();t.demSetLoader(),e.post(d.ajaxurl,{dem_pid:i.data("opts").pid,dem_act:"getVotedIds",action:"dem_ajax"},(function(e){t.demUnsetLoader(),e&&(a.html(h),d.cacheSetAnswrs(a,e),a.demInitActions(),a.demCacheShowNotice(e))}))}}),700)};i.on("mouseenter",p).on("mouseleave",(function(){clearTimeout(m)})),i.on("click",p)}}}else console.warn("Democracy: Main dem div not found")}))},d.detectRealHeight=function(e){var t=e.clone().css({height:"auto"}).insertBefore(e),n="border-box"===t.css("box-sizing")?parseInt(t.css("height")):t.height();return t.remove(),n},d.setHeight=function(t,n){var i=d.detectRealHeight(t);n?t.css({height:i}):t.css({opacity:0}).animate({height:i},d.animSpeed,(function(){e(this).animate({opacity:1},1.5*d.animSpeed)}))},d.setAnswsMaxHeight=function(t){if("-1"!==d.answMaxHeight&&"0"!==d.answMaxHeight&&d.answMaxHeight){var n=t.find(".dem-vote, .dem-answers").first(),i=parseInt(d.answMaxHeight);if(n.css({"max-height":"none","overflow-y":"visible"}),("border-box"===n.css("box-sizing")?parseInt(n.css("height")):n.height())-i>100){n.css("position","relative");var o,a=e('<span class="dem__collapser"><span class="arr"></span></span>').appendTo(n),s=function(){a.addClass("expanded").removeClass("collapsed")},r=function(){a.addClass("collapsed").removeClass("expanded")};t.data("expanded")?s():(r(),n.height(i).css("overflow-y","hidden")),a.on("mouseenter",(function(){t.data("expanded")||(o=setTimeout((function(){a.trigger("click")}),1e3))})).on("mouseleave",(function(){clearTimeout(o)})),a.on("click",(function(){if(clearTimeout(o),t.data("expanded"))r(),t.data("expanded",!1),t.height("auto"),n.stop().css("overflow-y","hidden").animate({height:i},d.animSpeed,(function(){d.setHeight(t,!0)}));else{s();var e=d.detectRealHeight(n);e+=7,t.data("expanded",!0),t.height("auto"),n.stop().animate({height:e},d.animSpeed,(function(){d.setHeight(t,!0),n.css("overflow-y","visible")}))}}))}}},d.maxAnswLimitInit=function(){n.on("change",'input[type="checkbox"]',(function(){var n=e(this).closest(t).data("opts").max_answs,i=e(this).closest(o).find('input[type="checkbox"]');i.filter(":checked").length>=n?i.filter(":not(:checked)").each((function(){e(this).prop("disabled",!0).closest("li").addClass("dem-disabled")})):i.each((function(){e(this).prop("disabled",!1).closest("li").removeClass("dem-disabled")}))}))},d.demShake=function(e){var t=e.css("position");for(t&&"static"!==t||e.css("position","relative"),t=1;2>=t;t++)e.animate({left:-10},50).animate({left:10},100).animate({left:0},50)},d.demLoadingDots=function(e){var t=e,n=t.is("input"),o=n?t.val():t.html();"..."===o.substring(o.length-3)?n?t[0].value=o.substring(0,o.length-3):t[0].innerHTML=o.substring(0,o.length-3):n?t[0].value+=".":t[0].innerHTML+=".",i=setTimeout((function(){d.demLoadingDots(t)}),200)}}}</script>
<script type="text/javascript" src="//js.stripe.com/v3/" id="sandhills-stripe-js-v3-js"></script>
<script type="text/javascript" src="//hackmag.com/wp-content/plugins/stripe/includes/core/assets/js/vendor/accounting.min.js" id="simpay-accounting-js"></script>
<script type="text/javascript" src="//hackmag.com/wp-includes/js/dist/dom-ready.min.js" id="wp-dom-ready-js"></script>
<script type="text/javascript" src="//hackmag.com/wp-includes/js/dist/hooks.min.js" id="wp-hooks-js"></script>
<script type="text/javascript" src="//hackmag.com/wp-includes/js/dist/i18n.min.js" id="wp-i18n-js"></script>
<script type="text/javascript" id="wp-i18n-js-after">
/* <![CDATA[ */
wp.i18n.setLocaleData( { 'text direction\u0004ltr': [ 'ltr' ] } );
/* ]]> */
</script>
<script type="text/javascript" src="//hackmag.com/wp-includes/js/dist/a11y.min.js" id="wp-a11y-js"></script>
<script type="text/javascript" src="//hackmag.com/wp-includes/js/dist/vendor/wp-polyfill.min.js" id="wp-polyfill-js"></script>
<script type="text/javascript" src="//hackmag.com/wp-includes/js/dist/url.min.js" id="wp-url-js"></script>
<script type="text/javascript" src="//hackmag.com/wp-includes/js/dist/api-fetch.min.js" id="wp-api-fetch-js"></script>
<script type="text/javascript" id="wp-api-fetch-js-after">
/* <![CDATA[ */
wp.apiFetch.use( wp.apiFetch.createRootURLMiddleware( "https://hackmag.com/wp-json/" ) );
wp.apiFetch.nonceMiddleware = wp.apiFetch.createNonceMiddleware( "e07ffce030" );
wp.apiFetch.use( wp.apiFetch.nonceMiddleware );
wp.apiFetch.use( wp.apiFetch.mediaUploadMiddleware );
wp.apiFetch.nonceEndpoint = "https://hackmag.com/wp-admin/admin-ajax.php?action=rest-nonce";
/* ]]> */
</script>
<script type="text/javascript" id="simpay-public-js-extra">
/* <![CDATA[ */
var simplePayForms = [];
var simplePayForms = [];
/* ]]> */
</script>
<script type="text/javascript" src="//hackmag.com/wp-content/plugins/stripe/includes/core/assets/js/dist/simpay-public-upe.js" id="simpay-public-js"></script>
<script type="text/javascript" src="//hackmag.com/wp-content/themes/FoundationPress/assets/javascript/foundation.js" id="foundation-js"></script>
<script type="text/javascript" src="//hackmag.com/wp-includes/js/comment-reply.min.js" id="comment-reply-js" async="async" data-wp-strategy="async"></script>
<script defer type="text/javascript" src="//hackmag.com/wp-content/plugins/akismet/_inc/akismet-frontend.js" id="akismet-frontend-js"></script>
</body>
</html>
