=== Content from git.kernel.org_5b75e4ff_20250111_200242.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ca36d6c1a49b6965c86dd528a73f38bc62d9c625)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ca36d6c1a49b6965c86dd528a73f38bc62d9c625)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ca36d6c1a49b6965c86dd528a73f38bc62d9c625)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ca36d6c1a49b6965c86dd528a73f38bc62d9c625)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gerd Bayer <gbayer@linux.ibm.com> | 2024-09-10 10:53:51 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:08:06 +0200 |
| commit | [ca36d6c1a49b6965c86dd528a73f38bc62d9c625](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ca36d6c1a49b6965c86dd528a73f38bc62d9c625) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ca36d6c1a49b6965c86dd528a73f38bc62d9c625)) | |
| tree | [618ff57b1bdad65da32d1fea74d272dfe99eeb58](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ca36d6c1a49b6965c86dd528a73f38bc62d9c625) | |
| parent | [fd7fcd802edb210a08d4eabe69b53712799d7072](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fd7fcd802edb210a08d4eabe69b53712799d7072) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ca36d6c1a49b6965c86dd528a73f38bc62d9c625&id2=fd7fcd802edb210a08d4eabe69b53712799d7072)) | |
| download | [linux-ca36d6c1a49b6965c86dd528a73f38bc62d9c625.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ca36d6c1a49b6965c86dd528a73f38bc62d9c625.tar.gz) | |

net/mlx5: Fix error path in multi-packet WQE transmit[ Upstream commit 2bcae12c795f32ddfbf8c80d1b5f1d3286341c32 ]
Remove the erroneous unmap in case no DMA mapping was established
The multi-packet WQE transmit code attempts to obtain a DMA mapping for
the skb. This could fail, e.g. under memory pressure, when the IOMMU
driver just can't allocate more memory for page tables. While the code
tries to handle this in the path below the err\_unmap label it erroneously
unmaps one entry from the sq's FIFO list of active mappings. Since the
current map attempt failed this unmap is removing some random DMA mapping
that might still be required. If the PCI function now presents that IOVA,
the IOMMU may assumes a rogue DMA access and e.g. on s390 puts the PCI
function in error state.
The erroneous behavior was seen in a stress-test environment that created
memory pressure.
Fixes: 5af75c747e2a ("net/mlx5e: Enhanced TX MPWQE for SKBs")
Signed-off-by: Gerd Bayer <gbayer@linux.ibm.com>
Reviewed-by: Zhu Yanjun <yanjun.zhu@linux.dev>
Acked-by: Maxim Mikityanskiy <maxtram95@gmail.com>
Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ca36d6c1a49b6965c86dd528a73f38bc62d9c625)

| -rw-r--r-- | [drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=ca36d6c1a49b6965c86dd528a73f38bc62d9c625) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c b/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.cindex 37366806807151..9b1e43ff8ae1e3 100644--- a/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=fd7fcd802edb210a08d4eabe69b53712799d7072)+++ b/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=ca36d6c1a49b6965c86dd528a73f38bc62d9c625)@@ -601,7 +601,6 @@ mlx5e\_sq\_xmit\_mpwqe(struct mlx5e\_txqsq \*sq, struct sk\_buff \*skb, return;  err\_unmap:- mlx5e\_dma\_unmap\_wqe\_err(sq, 1); sq->stats->dropped++; dev\_kfree\_skb\_any(skb); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:01:20 +0000



=== Content from git.kernel.org_d480bd94_20250111_200242.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8bb8c12fb5e2b1f03d603d493c92941676f109b5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8bb8c12fb5e2b1f03d603d493c92941676f109b5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8bb8c12fb5e2b1f03d603d493c92941676f109b5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8bb8c12fb5e2b1f03d603d493c92941676f109b5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gerd Bayer <gbayer@linux.ibm.com> | 2024-09-10 10:53:51 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 12:02:56 +0200 |
| commit | [8bb8c12fb5e2b1f03d603d493c92941676f109b5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8bb8c12fb5e2b1f03d603d493c92941676f109b5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8bb8c12fb5e2b1f03d603d493c92941676f109b5)) | |
| tree | [9d2fb9a10ce1a9d6aeefc2cb55ae727e92a556b9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8bb8c12fb5e2b1f03d603d493c92941676f109b5) | |
| parent | [e28013f39ab8112c427f66a43ca267fa268f8ed1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e28013f39ab8112c427f66a43ca267fa268f8ed1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8bb8c12fb5e2b1f03d603d493c92941676f109b5&id2=e28013f39ab8112c427f66a43ca267fa268f8ed1)) | |
| download | [linux-8bb8c12fb5e2b1f03d603d493c92941676f109b5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8bb8c12fb5e2b1f03d603d493c92941676f109b5.tar.gz) | |

net/mlx5: Fix error path in multi-packet WQE transmit[ Upstream commit 2bcae12c795f32ddfbf8c80d1b5f1d3286341c32 ]
Remove the erroneous unmap in case no DMA mapping was established
The multi-packet WQE transmit code attempts to obtain a DMA mapping for
the skb. This could fail, e.g. under memory pressure, when the IOMMU
driver just can't allocate more memory for page tables. While the code
tries to handle this in the path below the err\_unmap label it erroneously
unmaps one entry from the sq's FIFO list of active mappings. Since the
current map attempt failed this unmap is removing some random DMA mapping
that might still be required. If the PCI function now presents that IOVA,
the IOMMU may assumes a rogue DMA access and e.g. on s390 puts the PCI
function in error state.
The erroneous behavior was seen in a stress-test environment that created
memory pressure.
Fixes: 5af75c747e2a ("net/mlx5e: Enhanced TX MPWQE for SKBs")
Signed-off-by: Gerd Bayer <gbayer@linux.ibm.com>
Reviewed-by: Zhu Yanjun <yanjun.zhu@linux.dev>
Acked-by: Maxim Mikityanskiy <maxtram95@gmail.com>
Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8bb8c12fb5e2b1f03d603d493c92941676f109b5)

| -rw-r--r-- | [drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=8bb8c12fb5e2b1f03d603d493c92941676f109b5) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c b/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.cindex b09e9abd39f37f..f8c7912abe0e3f 100644--- a/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=e28013f39ab8112c427f66a43ca267fa268f8ed1)+++ b/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=8bb8c12fb5e2b1f03d603d493c92941676f109b5)@@ -642,7 +642,6 @@ mlx5e\_sq\_xmit\_mpwqe(struct mlx5e\_txqsq \*sq, struct sk\_buff \*skb, return;  err\_unmap:- mlx5e\_dma\_unmap\_wqe\_err(sq, 1); sq->stats->dropped++; dev\_kfree\_skb\_any(skb); mlx5e\_tx\_flush(sq); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:01:19 +0000



=== Content from git.kernel.org_b552b18c_20250111_200244.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fc357e78176945ca7bcacf92ab794b9ccd41b4f4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fc357e78176945ca7bcacf92ab794b9ccd41b4f4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fc357e78176945ca7bcacf92ab794b9ccd41b4f4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fc357e78176945ca7bcacf92ab794b9ccd41b4f4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gerd Bayer <gbayer@linux.ibm.com> | 2024-09-10 10:53:51 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:21:30 +0200 |
| commit | [fc357e78176945ca7bcacf92ab794b9ccd41b4f4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fc357e78176945ca7bcacf92ab794b9ccd41b4f4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fc357e78176945ca7bcacf92ab794b9ccd41b4f4)) | |
| tree | [88b4f3b5c6f6f663c6b57385ed570d473e027b21](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fc357e78176945ca7bcacf92ab794b9ccd41b4f4) | |
| parent | [523a1f3420e12647624a4f8467f818ab4867ff98](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=523a1f3420e12647624a4f8467f818ab4867ff98) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fc357e78176945ca7bcacf92ab794b9ccd41b4f4&id2=523a1f3420e12647624a4f8467f818ab4867ff98)) | |
| download | [linux-fc357e78176945ca7bcacf92ab794b9ccd41b4f4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fc357e78176945ca7bcacf92ab794b9ccd41b4f4.tar.gz) | |

net/mlx5: Fix error path in multi-packet WQE transmit[ Upstream commit 2bcae12c795f32ddfbf8c80d1b5f1d3286341c32 ]
Remove the erroneous unmap in case no DMA mapping was established
The multi-packet WQE transmit code attempts to obtain a DMA mapping for
the skb. This could fail, e.g. under memory pressure, when the IOMMU
driver just can't allocate more memory for page tables. While the code
tries to handle this in the path below the err\_unmap label it erroneously
unmaps one entry from the sq's FIFO list of active mappings. Since the
current map attempt failed this unmap is removing some random DMA mapping
that might still be required. If the PCI function now presents that IOVA,
the IOMMU may assumes a rogue DMA access and e.g. on s390 puts the PCI
function in error state.
The erroneous behavior was seen in a stress-test environment that created
memory pressure.
Fixes: 5af75c747e2a ("net/mlx5e: Enhanced TX MPWQE for SKBs")
Signed-off-by: Gerd Bayer <gbayer@linux.ibm.com>
Reviewed-by: Zhu Yanjun <yanjun.zhu@linux.dev>
Acked-by: Maxim Mikityanskiy <maxtram95@gmail.com>
Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fc357e78176945ca7bcacf92ab794b9ccd41b4f4)

| -rw-r--r-- | [drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=fc357e78176945ca7bcacf92ab794b9ccd41b4f4) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c b/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.cindex e6e792a38a6407..7aea25c09f72be 100644--- a/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=523a1f3420e12647624a4f8467f818ab4867ff98)+++ b/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=fc357e78176945ca7bcacf92ab794b9ccd41b4f4)@@ -633,7 +633,6 @@ mlx5e\_sq\_xmit\_mpwqe(struct mlx5e\_txqsq \*sq, struct sk\_buff \*skb, return;  err\_unmap:- mlx5e\_dma\_unmap\_wqe\_err(sq, 1); sq->stats->dropped++; dev\_kfree\_skb\_any(skb); mlx5e\_tx\_flush(sq); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:01:21 +0000



=== Content from git.kernel.org_fd489150_20250111_200243.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ecf310aaf256acbc8182189fe0aa1021c3ddef72)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ecf310aaf256acbc8182189fe0aa1021c3ddef72)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ecf310aaf256acbc8182189fe0aa1021c3ddef72)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ecf310aaf256acbc8182189fe0aa1021c3ddef72)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gerd Bayer <gbayer@linux.ibm.com> | 2024-09-10 10:53:51 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 12:00:04 +0200 |
| commit | [ecf310aaf256acbc8182189fe0aa1021c3ddef72](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ecf310aaf256acbc8182189fe0aa1021c3ddef72) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ecf310aaf256acbc8182189fe0aa1021c3ddef72)) | |
| tree | [568e2c28eba0fc07bdc91310c8208858ae6616ab](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ecf310aaf256acbc8182189fe0aa1021c3ddef72) | |
| parent | [b28bb7df6225e563eebc3c685b1ee437740bb229](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b28bb7df6225e563eebc3c685b1ee437740bb229) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ecf310aaf256acbc8182189fe0aa1021c3ddef72&id2=b28bb7df6225e563eebc3c685b1ee437740bb229)) | |
| download | [linux-ecf310aaf256acbc8182189fe0aa1021c3ddef72.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ecf310aaf256acbc8182189fe0aa1021c3ddef72.tar.gz) | |

net/mlx5: Fix error path in multi-packet WQE transmit[ Upstream commit 2bcae12c795f32ddfbf8c80d1b5f1d3286341c32 ]
Remove the erroneous unmap in case no DMA mapping was established
The multi-packet WQE transmit code attempts to obtain a DMA mapping for
the skb. This could fail, e.g. under memory pressure, when the IOMMU
driver just can't allocate more memory for page tables. While the code
tries to handle this in the path below the err\_unmap label it erroneously
unmaps one entry from the sq's FIFO list of active mappings. Since the
current map attempt failed this unmap is removing some random DMA mapping
that might still be required. If the PCI function now presents that IOVA,
the IOMMU may assumes a rogue DMA access and e.g. on s390 puts the PCI
function in error state.
The erroneous behavior was seen in a stress-test environment that created
memory pressure.
Fixes: 5af75c747e2a ("net/mlx5e: Enhanced TX MPWQE for SKBs")
Signed-off-by: Gerd Bayer <gbayer@linux.ibm.com>
Reviewed-by: Zhu Yanjun <yanjun.zhu@linux.dev>
Acked-by: Maxim Mikityanskiy <maxtram95@gmail.com>
Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ecf310aaf256acbc8182189fe0aa1021c3ddef72)

| -rw-r--r-- | [drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=ecf310aaf256acbc8182189fe0aa1021c3ddef72) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c b/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.cindex b09e9abd39f37f..f8c7912abe0e3f 100644--- a/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=b28bb7df6225e563eebc3c685b1ee437740bb229)+++ b/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=ecf310aaf256acbc8182189fe0aa1021c3ddef72)@@ -642,7 +642,6 @@ mlx5e\_sq\_xmit\_mpwqe(struct mlx5e\_txqsq \*sq, struct sk\_buff \*skb, return;  err\_unmap:- mlx5e\_dma\_unmap\_wqe\_err(sq, 1); sq->stats->dropped++; dev\_kfree\_skb\_any(skb); mlx5e\_tx\_flush(sq); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:01:20 +0000



=== Content from git.kernel.org_827c766b_20250111_200241.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=26fad69b34fcba80d5c7d9e651f628e6ac927754)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=26fad69b34fcba80d5c7d9e651f628e6ac927754)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=26fad69b34fcba80d5c7d9e651f628e6ac927754)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=26fad69b34fcba80d5c7d9e651f628e6ac927754)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gerd Bayer <gbayer@linux.ibm.com> | 2024-09-10 10:53:51 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 11:57:14 +0200 |
| commit | [26fad69b34fcba80d5c7d9e651f628e6ac927754](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=26fad69b34fcba80d5c7d9e651f628e6ac927754) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=26fad69b34fcba80d5c7d9e651f628e6ac927754)) | |
| tree | [c96dfaee2d811f307ae4832fcfa0c4b230865c9b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=26fad69b34fcba80d5c7d9e651f628e6ac927754) | |
| parent | [70db858273c761da6b8c8a781658e127765f9e20](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=70db858273c761da6b8c8a781658e127765f9e20) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=26fad69b34fcba80d5c7d9e651f628e6ac927754&id2=70db858273c761da6b8c8a781658e127765f9e20)) | |
| download | [linux-26fad69b34fcba80d5c7d9e651f628e6ac927754.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-26fad69b34fcba80d5c7d9e651f628e6ac927754.tar.gz) | |

net/mlx5: Fix error path in multi-packet WQE transmit[ Upstream commit 2bcae12c795f32ddfbf8c80d1b5f1d3286341c32 ]
Remove the erroneous unmap in case no DMA mapping was established
The multi-packet WQE transmit code attempts to obtain a DMA mapping for
the skb. This could fail, e.g. under memory pressure, when the IOMMU
driver just can't allocate more memory for page tables. While the code
tries to handle this in the path below the err\_unmap label it erroneously
unmaps one entry from the sq's FIFO list of active mappings. Since the
current map attempt failed this unmap is removing some random DMA mapping
that might still be required. If the PCI function now presents that IOVA,
the IOMMU may assumes a rogue DMA access and e.g. on s390 puts the PCI
function in error state.
The erroneous behavior was seen in a stress-test environment that created
memory pressure.
Fixes: 5af75c747e2a ("net/mlx5e: Enhanced TX MPWQE for SKBs")
Signed-off-by: Gerd Bayer <gbayer@linux.ibm.com>
Reviewed-by: Zhu Yanjun <yanjun.zhu@linux.dev>
Acked-by: Maxim Mikityanskiy <maxtram95@gmail.com>
Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=26fad69b34fcba80d5c7d9e651f628e6ac927754)

| -rw-r--r-- | [drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=26fad69b34fcba80d5c7d9e651f628e6ac927754) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c b/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.cindex 3001a52e1ac2ec..85d6334308e318 100644--- a/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=70db858273c761da6b8c8a781658e127765f9e20)+++ b/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=26fad69b34fcba80d5c7d9e651f628e6ac927754)@@ -642,7 +642,6 @@ mlx5e\_sq\_xmit\_mpwqe(struct mlx5e\_txqsq \*sq, struct sk\_buff \*skb, return;  err\_unmap:- mlx5e\_dma\_unmap\_wqe\_err(sq, 1); sq->stats->dropped++; dev\_kfree\_skb\_any(skb); mlx5e\_tx\_flush(sq); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:01:18 +0000



=== Content from git.kernel.org_eb14456b_20250111_200243.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ce828b347cf1b3c1b12b091d02463c35ce5097f5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ce828b347cf1b3c1b12b091d02463c35ce5097f5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ce828b347cf1b3c1b12b091d02463c35ce5097f5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ce828b347cf1b3c1b12b091d02463c35ce5097f5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gerd Bayer <gbayer@linux.ibm.com> | 2024-09-10 10:53:51 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:11:19 +0200 |
| commit | [ce828b347cf1b3c1b12b091d02463c35ce5097f5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ce828b347cf1b3c1b12b091d02463c35ce5097f5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ce828b347cf1b3c1b12b091d02463c35ce5097f5)) | |
| tree | [5c7f66d7082c8c7f2b940311a3b80547f77f8211](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ce828b347cf1b3c1b12b091d02463c35ce5097f5) | |
| parent | [ee57897c7f655ab0aaef309618b16ba417d6a052](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee57897c7f655ab0aaef309618b16ba417d6a052) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ce828b347cf1b3c1b12b091d02463c35ce5097f5&id2=ee57897c7f655ab0aaef309618b16ba417d6a052)) | |
| download | [linux-ce828b347cf1b3c1b12b091d02463c35ce5097f5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ce828b347cf1b3c1b12b091d02463c35ce5097f5.tar.gz) | |

net/mlx5: Fix error path in multi-packet WQE transmit[ Upstream commit 2bcae12c795f32ddfbf8c80d1b5f1d3286341c32 ]
Remove the erroneous unmap in case no DMA mapping was established
The multi-packet WQE transmit code attempts to obtain a DMA mapping for
the skb. This could fail, e.g. under memory pressure, when the IOMMU
driver just can't allocate more memory for page tables. While the code
tries to handle this in the path below the err\_unmap label it erroneously
unmaps one entry from the sq's FIFO list of active mappings. Since the
current map attempt failed this unmap is removing some random DMA mapping
that might still be required. If the PCI function now presents that IOVA,
the IOMMU may assumes a rogue DMA access and e.g. on s390 puts the PCI
function in error state.
The erroneous behavior was seen in a stress-test environment that created
memory pressure.
Fixes: 5af75c747e2a ("net/mlx5e: Enhanced TX MPWQE for SKBs")
Signed-off-by: Gerd Bayer <gbayer@linux.ibm.com>
Reviewed-by: Zhu Yanjun <yanjun.zhu@linux.dev>
Acked-by: Maxim Mikityanskiy <maxtram95@gmail.com>
Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ce828b347cf1b3c1b12b091d02463c35ce5097f5)

| -rw-r--r-- | [drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=ce828b347cf1b3c1b12b091d02463c35ce5097f5) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c b/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.cindex 6813279b57f893..7ec8a5ae7ea746 100644--- a/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=ee57897c7f655ab0aaef309618b16ba417d6a052)+++ b/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=ce828b347cf1b3c1b12b091d02463c35ce5097f5)@@ -685,7 +685,6 @@ mlx5e\_sq\_xmit\_mpwqe(struct mlx5e\_txqsq \*sq, struct sk\_buff \*skb, return;  err\_unmap:- mlx5e\_dma\_unmap\_wqe\_err(sq, 1); sq->stats->dropped++; dev\_kfree\_skb\_any(skb); mlx5e\_tx\_flush(sq); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:01:20 +0000



=== Content from git.kernel.org_b03714ad_20250111_200241.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2bcae12c795f32ddfbf8c80d1b5f1d3286341c32)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2bcae12c795f32ddfbf8c80d1b5f1d3286341c32)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2bcae12c795f32ddfbf8c80d1b5f1d3286341c32)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2bcae12c795f32ddfbf8c80d1b5f1d3286341c32)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gerd Bayer <gbayer@linux.ibm.com> | 2024-09-10 10:53:51 +0200 |
| --- | --- | --- |
| committer | Saeed Mahameed <saeedm@nvidia.com> | 2024-09-25 13:15:44 -0700 |
| commit | [2bcae12c795f32ddfbf8c80d1b5f1d3286341c32](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2bcae12c795f32ddfbf8c80d1b5f1d3286341c32) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2bcae12c795f32ddfbf8c80d1b5f1d3286341c32)) | |
| tree | [33296397916350875dc746390ad911a8612e5738](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2bcae12c795f32ddfbf8c80d1b5f1d3286341c32) | |
| parent | [0cbfd45fbcf0cb26d85c981b91c62fe73cdee01c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0cbfd45fbcf0cb26d85c981b91c62fe73cdee01c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2bcae12c795f32ddfbf8c80d1b5f1d3286341c32&id2=0cbfd45fbcf0cb26d85c981b91c62fe73cdee01c)) | |
| download | [linux-2bcae12c795f32ddfbf8c80d1b5f1d3286341c32.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2bcae12c795f32ddfbf8c80d1b5f1d3286341c32.tar.gz) | |

net/mlx5: Fix error path in multi-packet WQE transmitRemove the erroneous unmap in case no DMA mapping was established
The multi-packet WQE transmit code attempts to obtain a DMA mapping for
the skb. This could fail, e.g. under memory pressure, when the IOMMU
driver just can't allocate more memory for page tables. While the code
tries to handle this in the path below the err\_unmap label it erroneously
unmaps one entry from the sq's FIFO list of active mappings. Since the
current map attempt failed this unmap is removing some random DMA mapping
that might still be required. If the PCI function now presents that IOVA,
the IOMMU may assumes a rogue DMA access and e.g. on s390 puts the PCI
function in error state.
The erroneous behavior was seen in a stress-test environment that created
memory pressure.
Fixes: 5af75c747e2a ("net/mlx5e: Enhanced TX MPWQE for SKBs")
Signed-off-by: Gerd Bayer <gbayer@linux.ibm.com>
Reviewed-by: Zhu Yanjun <yanjun.zhu@linux.dev>
Acked-by: Maxim Mikityanskiy <maxtram95@gmail.com>
Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2bcae12c795f32ddfbf8c80d1b5f1d3286341c32)

| -rw-r--r-- | [drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=2bcae12c795f32ddfbf8c80d1b5f1d3286341c32) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c b/drivers/net/ethernet/mellanox/mlx5/core/en\_tx.cindex b09e9abd39f37f..f8c7912abe0e3f 100644--- a/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=0cbfd45fbcf0cb26d85c981b91c62fe73cdee01c)+++ b/[drivers/net/ethernet/mellanox/mlx5/core/en\_tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c?id=2bcae12c795f32ddfbf8c80d1b5f1d3286341c32)@@ -642,7 +642,6 @@ mlx5e\_sq\_xmit\_mpwqe(struct mlx5e\_txqsq \*sq, struct sk\_buff \*skb, return;  err\_unmap:- mlx5e\_dma\_unmap\_wqe\_err(sq, 1); sq->stats->dropped++; dev\_kfree\_skb\_any(skb); mlx5e\_tx\_flush(sq); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:01:19 +0000


