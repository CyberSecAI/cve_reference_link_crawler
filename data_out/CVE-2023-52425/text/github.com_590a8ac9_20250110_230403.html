
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibexpat%2Flibexpat%2Fpull%2F789)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibexpat%2Flibexpat%2Fpull%2F789)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=libexpat%2Flibexpat)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libexpat](/libexpat)
/
**[libexpat](/libexpat/libexpat)**
Public

* [Notifications](/login?return_to=%2Flibexpat%2Flibexpat) You must be signed in to change notification settings
* [Fork
  447](/login?return_to=%2Flibexpat%2Flibexpat)
* [Star
   1.1k](/login?return_to=%2Flibexpat%2Flibexpat)

* [Code](/libexpat/libexpat)
* [Issues
  13](/libexpat/libexpat/issues)
* [Pull requests
  5](/libexpat/libexpat/pulls)
* [Actions](/libexpat/libexpat/actions)
* [Security](/libexpat/libexpat/security)
* [Insights](/libexpat/libexpat/pulse)

Additional navigation options

* [Code](/libexpat/libexpat)
* [Issues](/libexpat/libexpat/issues)
* [Pull requests](/libexpat/libexpat/pulls)
* [Actions](/libexpat/libexpat/actions)
* [Security](/libexpat/libexpat/security)
* [Insights](/libexpat/libexpat/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Flibexpat%2Flibexpat%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Flibexpat%2Flibexpat%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [CVE-2023-52425] Speed up parsing of big tokens #789

 Merged

[hartwork](/hartwork)
merged 16 commits into
[libexpat:master](/libexpat/libexpat/tree/master "libexpat/libexpat:master")
from
[SonyMobile:partial-token-perf](/SonyMobile/libexpat-contrib/tree/partial-token-perf "SonyMobile/libexpat-contrib:partial-token-perf")

Jan 30, 2024

 Merged

# [[CVE-2023-52425] Speed up parsing of big tokens](#top) #789

[hartwork](/hartwork)
merged 16 commits into
[libexpat:master](/libexpat/libexpat/tree/master "libexpat/libexpat:master")
from
[SonyMobile:partial-token-perf](/SonyMobile/libexpat-contrib/tree/partial-token-perf "SonyMobile/libexpat-contrib:partial-token-perf")

Jan 30, 2024

[Conversation
73](/libexpat/libexpat/pull/789)
[Commits
16](/libexpat/libexpat/pull/789/commits)
[Checks
34](/libexpat/libexpat/pull/789/checks)
[Files changed](/libexpat/libexpat/pull/789/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=60&v=4)](/Snild-Sony)

Copy link

Contributor

### @Snild-Sony **[Snild-Sony](/Snild-Sony)** commented [Nov 15, 2023](#issue-1994748147) • edited Loading

When parsing a really big token that requires multiple buffer fills to complete, expat has to re-parse the token from start multiple times, which takes time. These patches introduce a heuristic that, when having failed on the same token multiple times, defers further parsing until there's significantly more data available.

Here's a comparison in the extreme case (an *infinitely* long token; we stop when expat says "no more memory", or when the time limit of 2 hours is reached) for different buffer fill sizes:

[![fill-speed](https://private-user-images.githubusercontent.com/18738465/283125484-e51ee1bc-e30f-45ac-8cb0-1407323adfdf.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NTA1NDAsIm5iZiI6MTczNjU1MDI0MCwicGF0aCI6Ii8xODczODQ2NS8yODMxMjU0ODQtZTUxZWUxYmMtZTMwZi00NWFjLThjYjAtMTQwNzMyM2FkZmRmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDIzMDQwMFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTQyYmIzNmExYWU1YmMyZjhlMDY0MjI2YTc5YzkyYTllYTY5OWEyNmMxMjViZjkwNmE4ZjM1N2EwMTk3YzRiOTYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.jivce5kJoV7kR_lYK4oi88MWS5VTHaK-VxaXoiWrLA4)](https://private-user-images.githubusercontent.com/18738465/283125484-e51ee1bc-e30f-45ac-8cb0-1407323adfdf.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NTA1NDAsIm5iZiI6MTczNjU1MDI0MCwicGF0aCI6Ii8xODczODQ2NS8yODMxMjU0ODQtZTUxZWUxYmMtZTMwZi00NWFjLThjYjAtMTQwNzMyM2FkZmRmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDIzMDQwMFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTQyYmIzNmExYWU1YmMyZjhlMDY0MjI2YTc5YzkyYTllYTY5OWEyNmMxMjViZjkwNmE4ZjM1N2EwMTk3YzRiOTYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.jivce5kJoV7kR_lYK4oi88MWS5VTHaK-VxaXoiWrLA4)

[![fill-speed-zoom](https://private-user-images.githubusercontent.com/18738465/283125489-c76a4dee-226e-4dfc-a4b1-ea2f58ceff29.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NTA1NDAsIm5iZiI6MTczNjU1MDI0MCwicGF0aCI6Ii8xODczODQ2NS8yODMxMjU0ODktYzc2YTRkZWUtMjI2ZS00ZGZjLWE0YjEtZWEyZjU4Y2VmZjI5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDIzMDQwMFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVlYmJkZDIwOGU1Y2I1YjgzMDE1ODdiNzdjMzRkYmJiZTA0MTg2NmI4YjUwY2EwZjFhYjQ2ZmZjZWM5YmE1MDcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.VeFIuwZ2pMhjVXSTWUsibqVUSDZYFRV2-Db3ZCJvbkQ)](https://private-user-images.githubusercontent.com/18738465/283125489-c76a4dee-226e-4dfc-a4b1-ea2f58ceff29.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NTA1NDAsIm5iZiI6MTczNjU1MDI0MCwicGF0aCI6Ii8xODczODQ2NS8yODMxMjU0ODktYzc2YTRkZWUtMjI2ZS00ZGZjLWE0YjEtZWEyZjU4Y2VmZjI5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDIzMDQwMFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVlYmJkZDIwOGU1Y2I1YjgzMDE1ODdiNzdjMzRkYmJiZTA0MTg2NmI4YjUwY2EwZjFhYjQ2ZmZjZWM5YmE1MDcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.VeFIuwZ2pMhjVXSTWUsibqVUSDZYFRV2-Db3ZCJvbkQ)

(the second image is just a zoomed-in view of the first.)

Sorry, something went wrong.

 👍
3
 hartwork, agustingomes-therapieland, and rhyanndev reacted with thumbs up emoji

All reactions

* 👍
  3 reactions

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Nov 15, 2023](#issuecomment-1812514201)

| Proof of linearity Before the heuristic patch, we have $a = O(n²)$. With the heuristic patch, we have $a = O(n)$, assuming $r &gt; 1$. I will now attempt to prove this.  $n$: The size of a big token, in bytes. $a$: How many bytes we have scanned in *attempts* to parse the token. $r$: The ratio set for the heuristic.  The very worst possible parse of a big token is one that parses as often as possible. This would be the sequence $s\_0 = 1, s\_i = r \cdot s\_{i-1}$, i.e. $1, r, r², r³, ..., r^c, n$ where $r^c &lt; n \le r^{c+1}$.  The sum of this sequence gives us $a$, the number of bytes we have handled in parse attempts:  $$ a = n + \sum\_{i=0}^{c} s\_i = n + \sum\_{i=0}^{c} r^i $$  That's a sum of a geometric sequence. Since $r &gt; 1$, [it can be simplified](https://en.wikipedia.org/wiki/Geometric_series#Sum) to  $$ a = n + \frac{1 - r^{c+1}}{1 - r} $$  Not very clear. But a better understanding of $c$ helps:  $$ r^c < n \le r^{c+1}, c \in \mathbb{N} $$  $$ c = \lfloor\log\_r{n}\rfloor - \epsilon $$  $$ c < \log\_r{n} $$  Plug that into our expression for $a$, remembering $x^{\log\_x{y}} = y$ from Mr. Nimhed's class in high school:  $$ a = n + \frac{1 - r^{\lfloor\log\_r{n}\rfloor-\epsilon+1}}{1 - r} < n + \frac{1 - r^{\log\_r{n}+1}}{1 - r} = n + \frac{1 - r \cdot n}{1 - r} = O(n) $$  But this was in math-land. Unfortunately, we live in reality, where one can't parse 1.21 bytes at a time. We always add at least one byte, so our sequence is actually $z\_0 = 1, z\_i = \lceil r \cdot z\_{i-1} \rceil$. Does that make a difference?  No, it doesn't. We can consider three scenarios:   1. We have more $z\_i$ elements than $s\_i$.    * This is impossible: the $z\_i$ sequence grows at least as fast as $s\_i$, and must therefore reach $n$ in the same or fewer steps. 2. We have the same number of elements ($c$) in the $z\_i$ and $s\_i$ sequences.    * The sequence elements can then be paired up such that $z\_i &lt; r \cdot s\_i$.    * If they couldn't, we would have some $i$ where $z\_i \ge r \cdot s\_i = s\_{i+1}$, which means we have skipped a "step", and can not have the same number of elements (which would be a contradiction).    * Therefore: $$\sum\_{i=0}^{c+1}{z\_i} &lt; \sum\_{i=0}^{c+1}{r \cdot s\_i} = r \cdot \sum\_{i=0}^{c+1}{s\_i}$$, which is still $O(n)$. 3. We have fewer $z\_i$ elements than $s\_i$.    * All the $z\_i$ can then be paired up with different $s\_j$ such that $z\_i &lt; r \cdot s\_j$.    * The remaining $s\_j$ can be paired with zeroes: $0 &lt; r \cdot s\_j$.    * Therefore: $$\sum{z\_i} &lt; \sum\_{i=0}^{c+1}{r \cdot s\_i} = r \cdot \sum\_{i=0}^{c+1}{s\_i}$$, which is still $O(n)$.   Therefore, $a$ is $O(n)$, in both math-land and reality. Or I'm bad at math. Or both. :)  Caveats:   * Small $r$ values still technically give $a = O(n)$, though the coefficients may be terrible. * Tiny $r$ values may suffer from floating point rounding errors that make them ineffectual.  Memory-performance tradeoff High values for $r$ can increase the buffer size required for parsing a token (since the heuristic may overshoot the true token size). We'd like to find a good tradeoff between performance and buffer size inflation.  Now that we have an expression for $a$, we can calculate the theoretical maximum "amplification factor" $a / n$ for various $r$ settings:  $$ \frac{a}{n} < \frac{n + \frac{1 - r \cdot n}{1 - r}}{n} = 1 + \frac{1 - r \cdot n}{n - r \cdot n} = 1 + \frac{1}{n - r \cdot n} - \frac{r \cdot n}{n - r \cdot n} = 1 + \frac{1}{n - r \cdot n} + \frac{r \cdot n}{r \cdot n - n} = 1 + \frac{1}{n - r \cdot n} + \frac{r}{r - 1} $$  $$ \lim\_{n \rightarrow \infty}{ (1 + \frac{1}{n - r \cdot n} + \frac{r}{r - 1} )} = 1 + 0 + \frac{r}{r - 1} = 1 + \frac{r}{r - 1}$$  ``` >>> for r in (1.0001, 1.0005, 1.001, 1.005, 1.01, 1.05, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2, 2.2, 2.4, 2.6, 2.8, 3, 4, 5, 6, 7, 8, 9, 10): ...   print('%7.4f %9.3f' % (r, 1 + r/(r-1))) ...   1.0001 10002.000  1.0005  2002.000  1.0010  1002.000  1.0050   202.000  1.0100   102.000  1.0500    22.000  1.1000    12.000  1.2000     7.000  1.3000     5.333  1.4000     4.500  1.5000     4.000  1.6000     3.667  1.7000     3.429  1.8000     3.250  1.9000     3.111  2.0000     3.000  2.2000     2.833  2.4000     2.714  2.6000     2.625  2.8000     2.556  3.0000     2.500  4.0000     2.333  5.0000     2.250  6.0000     2.200  7.0000     2.167  8.0000     2.143  9.0000     2.125 10.0000     2.111  ```  The improvement in amplification factor falls off quite quickly as $r$ increases. There's not much of a point to anything above $r = 4$. At the other end, amplification rises very quickly as $r$ approaches $1$. I'm happy with $1.1$ as a good balance. |
| --- |

 👍
5
 hartwork, mortenschioler, lixiaoshuai666, kgrodzicki, and instance01 reacted with thumbs up emoji

All reactions

* 👍
  5 reactions

Sorry, something went wrong.

 [![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=40&v=4)](/Snild-Sony)
[Snild-Sony](/Snild-Sony)
marked this pull request as ready for review
[November 15, 2023 13:13](#event-10967306481)

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=40&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)
[hartwork](/hartwork)
added
the
[enhancement](/libexpat/libexpat/labels/enhancement)
label
[Nov 15, 2023](#event-10968315695)

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=40&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)
[hartwork](/hartwork)
added this to the [2.6.0](/libexpat/libexpat/milestone/27) milestone
[Nov 15, 2023](#event-10968316187)

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=40&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)
[hartwork](/hartwork)
mentioned this pull request
[Nov 15, 2023](#ref-pullrequest-1955554959)

[Prepare release 2.6.0 (part of #775)
#776](/libexpat/libexpat/pull/776)
 Merged

35 tasks

 [![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=40&v=4)](/Snild-Sony)
[Snild-Sony](/Snild-Sony)
[force-pushed](/libexpat/libexpat/compare/3b9abf5c61ceeaf295d0289c0067c0e6ee8e5f05..3f7d4584c3466a3bbc07e664275bae7ab4afa0da)
the
partial-token-perf

branch
from
[`3b9abf5`](/libexpat/libexpat/commit/3b9abf5c61ceeaf295d0289c0067c0e6ee8e5f05) to
[`3f7d458`](/libexpat/libexpat/commit/3f7d4584c3466a3bbc07e664275bae7ab4afa0da)  [Compare](/libexpat/libexpat/compare/3b9abf5c61ceeaf295d0289c0067c0e6ee8e5f05..3f7d4584c3466a3bbc07e664275bae7ab4afa0da)
[November 15, 2023 15:42](#event-10969056974)

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Nov 15, 2023](#issuecomment-1812776123)

| Getting some CI failures here. One has:  ``` 1/2 Test #1: runtests .........................***Failed    6.39 sec [...] FAIL [chunksize=0 defer_ratio=2.0]: test_big_tokens_take_linear_time (max_slowdown=10 text="<e><aaaaaa/></e>" at /home/runner/work/libexpat/libexpat/expat/tests/basic_tests.c:5276) FAIL [chunksize=0 defer_ratio=1000000.0]: test_big_tokens_take_linear_time (max_slowdown=10 text="<e><aaaaaa/></e>" at /home/runner/work/libexpat/libexpat/expat/tests/basic_tests.c:5276) FAIL [chunksize=1 defer_ratio=2.0]: test_suspend_resume_internal_entity (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/chardata.c:114) FAIL [chunksize=1 defer_ratio=1000000.0]: test_utf8_in_start_tags (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/basic_tests.c:4690) FAIL [chunksize=2 defer_ratio=1000000.0]: test_utf8_in_start_tags (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/basic_tests.c:4690) FAIL [chunksize=3 defer_ratio=1.1]: test_suspend_resume_internal_entity (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/chardata.c:114) FAIL [chunksize=3 defer_ratio=2.0]: test_suspend_resume_internal_entity (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/chardata.c:114) FAIL [chunksize=3 defer_ratio=1000000.0]: test_utf8_in_start_tags (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/basic_tests.c:4690) FAIL [chunksize=4 defer_ratio=2.0]: test_suspend_resume_internal_entity (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/chardata.c:114) FAIL [chunksize=4 defer_ratio=1000000.0]: test_utf8_in_start_tags (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/basic_tests.c:4690) FAIL [chunksize=5 defer_ratio=1.1]: test_suspend_resume_internal_entity (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/chardata.c:114) 99%: Checks: 8592, Failed: 11  2/2 Test #2: runtests_cxx .....................***Failed    6.43 sec [...] FAIL [chunksize=0 defer_ratio=2.0]: test_big_tokens_take_linear_time (max_slowdown=10 text="<e><aaaaaa/></e>" at /home/runner/work/libexpat/libexpat/expat/tests/basic_tests.c:5276) FAIL [chunksize=0 defer_ratio=1000000.0]: test_big_tokens_take_linear_time (max_slowdown=10 text="<e><aaaaaa/></e>" at /home/runner/work/libexpat/libexpat/expat/tests/basic_tests.c:5276) FAIL [chunksize=1 defer_ratio=2.0]: test_suspend_resume_internal_entity (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/chardata.c:114) FAIL [chunksize=1 defer_ratio=1000000.0]: test_utf8_in_start_tags (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/basic_tests.c:4690) FAIL [chunksize=2 defer_ratio=1000000.0]: test_utf8_in_start_tags (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/basic_tests.c:4690) FAIL [chunksize=3 defer_ratio=1.1]: test_suspend_resume_internal_entity (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/chardata.c:114) FAIL [chunksize=3 defer_ratio=2.0]: test_suspend_resume_internal_entity (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/chardata.c:114) FAIL [chunksize=3 defer_ratio=1000000.0]: test_utf8_in_start_tags (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/basic_tests.c:4690) FAIL [chunksize=4 defer_ratio=2.0]: test_suspend_resume_internal_entity (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/chardata.c:114) FAIL [chunksize=4 defer_ratio=1000000.0]: test_utf8_in_start_tags (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/basic_tests.c:4690) FAIL [chunksize=5 defer_ratio=1.1]: test_suspend_resume_internal_entity (during actual test at /home/runner/work/libexpat/libexpat/expat/tests/chardata.c:114) 99%: Checks: 8592, Failed: 11  ```  The first two should be resolved by increasing max\_slowdown a little. Clearly the ratio=1.1 variant has gone through.  The others I was surprised to see, since I would've expected to get them locally (but didn't). Rebasing on top of latest master (358872 "Merge pull request [#787](https://github.com/libexpat/libexpat/pull/787)") instead of where I was ([df1e3d6](https://github.com/libexpat/libexpat/commit/df1e3d6f1eced0c607110eb3a3e3dc19313c5c25) "Merge pull request [#788](https://github.com/libexpat/libexpat/pull/788)") makes me reproduce those failures locally.   * test\_utf8\_in\_start\_tags calls \_XML\_Parse\_SINGLE\_BYTES() with isFinal=XML\_FALSE and expects all the input bytes to be consumed. This is not always the case when the heuristic is active. Setting XML\_TRUE introduces new possible errors (incomplete tokens, too-short document...), so that's not a quick fix. I opted to disable the heuristic for this test. * test\_suspend\_resume\_internal\_entity was more complicated: the \_XML\_Parse\_SINGLE\_BYTES() there returns early when suspension happens, meaning that not all input is actually sent to Expat. Since the isFinal=XML\_TRUE call *also* didn't happen, this was not detected by the test as it stood. Since there is currently no way to figure out how many SINGLE\_BYTES actually sent into the parser, I opted to simply go back to using XML\_Parse(). I feel like I should've caught this in my review of [tests: Migrate more tests to variable chunk size parsing #787](https://github.com/libexpat/libexpat/pull/787), but obviously I didn't look closely enough.   With these two changes (one of which was squashed into an existing commit), the tests now pass locally for me. I added a small increase to max\_slowdown. Hopefully, these changes will make us pass CI.  I ordered the commits so the test fixes happen *before* any commit that would break the tests. That way, bisecting into this sequence of commits won't be broken. |
| --- |

 👍
1
 hartwork reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

 [![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=40&v=4)](/Snild-Sony)
[Snild-Sony](/Snild-Sony)
[force-pushed](/libexpat/libexpat/compare/3f7d4584c3466a3bbc07e664275bae7ab4afa0da..68f1216ab286bf98791caa55d509873536098e32)
the
partial-token-perf

branch
from
[`3f7d458`](/libexpat/libexpat/commit/3f7d4584c3466a3bbc07e664275bae7ab4afa0da) to
[`68f1216`](/libexpat/libexpat/commit/68f1216ab286bf98791caa55d509873536098e32)  [Compare](/libexpat/libexpat/compare/3f7d4584c3466a3bbc07e664275bae7ab4afa0da..68f1216ab286bf98791caa55d509873536098e32)
[November 15, 2023 16:59](#event-10969953917)

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Nov 15, 2023](#issuecomment-1812920243)

| Got some more slowdown failures. 12 isn't enough. But we're getting close -- <https://github.com/libexpat/libexpat/actions/runs/6879563216/job/18712209490?pr=789> passed in runtests but not runtests\_cxx, and the failures were in the line at the end of the test (not the early failure in the middle of the test).  Moved to 14, and added a bit more info when it fails (the clock counts and calculated slowdown value).  Also added a line to lib/libexpat.def.cmake -- thanks for the pointer, [@hartwork](https://github.com/hartwork). |
| --- |

All reactions

Sorry, something went wrong.

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Nov 15, 2023](#issuecomment-1813023878) • edited Loading

| Alright, the Visual Studio compiler is not happy with me.  ```     12>ClCompile:          xmlparse.c     11>C:\projects\libexpat\expat\tests\basic_tests.c(5305,29): error C2220: the following warning is treated as an error [c:\projects\libexpat\runtests_cxx.vcxproj]     13>CustomBuild:          Building Custom Rule C:/projects/libexpat/expat/CMakeLists.txt        VcpkgTripletSelection:          Using triplet "x64-windows" from "C:\Tools\vcpkg\installed\x64-windows\"          Using normalized configuration "Release"        ClCompile:          C:\Program Files\Microsoft Visual Studio\2022\Community\VC\Tools\MSVC\14.37.32822\bin\HostX64\x64\CL.exe /c /IC:\projects\libexpat /IC:\projects\libexpat\expat\lib /I"C:\Tools\vcpkg\installed\x64-windows\include" /Zi /nologo /W3 /WX /diagnostics:column /Od /Ob0 /D _MBCS /D WIN32 /D _WINDOWS /D XML_STATIC /D XML_UNICODE /D XML_UNICODE_WCHAR_T /D _CRT_SECURE_NO_WARNINGS /D "CMAKE_INTDIR=\"Debug\"" /Gm- /RTC1 /MDd /GS /fp:precise /Zc:wchar_t /Zc:forScope /Zc:inline /Fo"runtests.dir\Debug\\" /Fd"runtests.dir\Debug\vc143.pdb" /external:W3 /Gd /TC /wd4996 /errorReport:queue C:\projects\libexpat\expat\tests\acc_tests.c C:\projects\libexpat\expat\tests\alloc_tests.c C:\projects\libexpat\expat\tests\basic_tests.c C:\projects\libexpat\expat\tests\chardata.c C:\projects\libexpat\expat\tests\common.c C:\projects\libexpat\expat\tests\dummy.c C:\projects\libexpat\expat\tests\handlers.c C:\projects\libexpat\expat\tests\memcheck.c C:\projects\libexpat\expat\tests\minicheck.c C:\projects\libexpat\expat\tests\misc_tests.c C:\projects\libexpat\expat\tests\ns_tests.c C:\projects\libexpat\expat\tests\nsalloc_tests.c C:\projects\libexpat\expat\tests\runtests.c C:\projects\libexpat\expat\tests\structdata.c C:\projects\libexpat\expat\lib\xmlparse.c C:\projects\libexpat\expat\lib\xmlrole.c C:\projects\libexpat\expat\lib\xmltok.c     12>C:\projects\libexpat\expat\lib\xmlparse.c(627,7): error C2220: the following warning is treated as an error [c:\projects\libexpat\expat.vcxproj]     12>C:\projects\libexpat\expat\lib\xmlparse.c(627,7): warning C4305: 'initializing': truncation from 'double' to 'float' [c:\projects\libexpat\expat.vcxproj]        ClCompile:          acc_tests.c          alloc_tests.c          basic_tests.c     11>C:\projects\libexpat\expat\tests\basic_tests.c(5305,29): warning C4305: 'initializing': truncation from 'double' to 'const float' [c:\projects\libexpat\runtests_cxx.vcxproj]     11>C:\projects\libexpat\expat\tests\basic_tests.c(5305,37): warning C4305: 'initializing': truncation from 'double' to 'const float' [c:\projects\libexpat\runtests_cxx.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5230,15): error C2057: expected constant expression [c:\projects\libexpat\runtests.vcxproj]     11>C:\projects\libexpat\expat\tests\basic_tests.c(5373,60): warning C4267: 'initializing': conversion from 'size_t' to 'int', possible loss of data [c:\projects\libexpat\runtests_cxx.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5230,23): error C2466: cannot allocate an array of constant size 0 [c:\projects\libexpat\runtests.vcxproj]     11>C:\projects\libexpat\expat\tests\basic_tests.c(5373,27): warning C4267: 'initializing': conversion from 'size_t' to 'const int', possible loss of data [c:\projects\libexpat\runtests_cxx.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5230,8): error C2133: 'aaaaaa': unknown size [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5308,15): error C2057: expected constant expression [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5308,23): error C2466: cannot allocate an array of constant size 0 [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5308,8): error C2133: 'eeeeee': unknown size [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5305,25): warning C4305: 'initializing': truncation from 'double' to 'const float' [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5373,60): warning C4267: 'initializing': conversion from 'size_t' to 'const int', possible loss of data [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5374,55): warning C4267: 'initializing': conversion from 'size_t' to 'const int', possible loss of data [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5417,15): error C2057: expected constant expression [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5417,23): error C2466: cannot allocate an array of constant size 0 [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5417,8): error C2133: 'eeeeee': unknown size [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5418,15): error C2057: expected constant expression [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5418,23): error C2466: cannot allocate an array of constant size 0 [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5418,8): error C2133: 'spaces': unknown size [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5476,58): warning C4267: 'initializing': conversion from 'size_t' to 'const int', possible loss of data [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5477,53): warning C4267: 'initializing': conversion from 'size_t' to 'const int', possible loss of data [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5496,25): warning C4305: 'initializing': truncation from 'double' to 'const float' [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5533,15): error C2057: expected constant expression [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5533,23): error C2466: cannot allocate an array of constant size 0 [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5533,8): error C2133: 'iiiiii': unknown size [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5583,3): warning C4305: 'function': truncation from 'double' to 'float' [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5585,3): warning C4305: 'function': truncation from 'double' to 'float' [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5588,3): warning C4305: 'function': truncation from 'double' to 'float' [c:\projects\libexpat\runtests.vcxproj]     13>C:\projects\libexpat\expat\tests\basic_tests.c(5591,3): warning C4305: 'function': truncation from 'double' to 'float' [c:\projects\libexpat\runtests.vcxproj]          chardata.c     11>C:\projects\libexpat\expat\tests\basic_tests.c(5374,55): warning C4267: 'initializing': conversion from 'size_t' to 'int', possible loss of data [c:\projects\libexpat\runtests_cxx.vcxproj]     11>C:\projects\libexpat\expat\tests\basic_tests.c(5374,29): warning C4267: 'initializing': conversion from 'size_t' to 'const int', possible loss of data [c:\projects\libexpat\runtests_cxx.vcxproj]     11>C:\projects\libexpat\expat\tests\basic_tests.c(5476,58): warning C4267: 'initializing': conversion from 'size_t' to 'int', possible loss of data [c:\projects\libexpat\runtests_cxx.vcxproj]        ClCompile:          common.c     11>C:\projects\libexpat\expat\tests\basic_tests.c(5476,25): warning C4267: 'initializing': conversion from 'size_t' to 'const int', possible loss of data [c:\projects\libexpat\runtests_cxx.vcxproj]     11>C:\projects\libexpat\expat\tests\basic_tests.c(5477,53): warning C4267: 'initializing': conversion from 'size_t' to 'int', possible loss of data [c:\projects\libexpat\runtests_cxx.vcxproj]     11>C:\projects\libexpat\expat\tests\basic_tests.c(5477,27): warning C4267: 'initializing': conversion from 'size_t' to 'const int', possible loss of data [c:\projects\libexpat\runtests_cxx.vcxproj]     11>C:\projects\libexpat\expat\tests\basic_tests.c(5496,29): warning C4305: 'initializing': truncation from 'double' to 'const float' [c:\projects\libexpat\runtests_cxx.vcxproj]     11>C:\projects\libexpat\expat\tests\basic_tests.c(5496,37): warning C4305: 'initializing': truncation from 'double' to 'const float' [c:\projects\libexpat\runtests_cxx.vcxproj]     11>C:\projects\libexpat\expat\tests\basic_tests.c(5583,3): warning C4305: 'argument': truncation from 'double' to 'float' [c:\projects\libexpat\runtests_cxx.vcxproj]     11>C:\projects\libexpat\expat\tests\basic_tests.c(5585,3): warning C4305: 'argument': truncation from 'double' to 'float' [c:\projects\libexpat\runtests_cxx.vcxproj]     11>C:\projects\libexpat\expat\tests\basic_tests.c(5588,3): warning C4305: 'argument': truncation from 'double' to 'float' [c:\projects\libexpat\runtests_cxx.vcxproj]        ClCompile:          dummy.c     11>C:\projects\libexpat\expat\tests\basic_tests.c(5591,3): warning C4305: 'argument': truncation from 'double' to 'float' [c:\projects\libexpat\runtests_cxx.vcxproj]          chardata_cxx.cpp          common_cxx.cpp          dummy_cxx.cpp  ```  Most things look pretty simple to fix, it'll just be a lot of work to fix each thing in the *correct commit*. Some seem annoying, like the multiple "your `const int` is not const enough for this array declaration!" errors. I'll get them fixed tomorrow. May take some trial and error, since I don't have a VS environment. |
| --- |

All reactions

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Nov 16, 2023](#issuecomment-1813626767) • edited Loading

| Alright, the Visual Studio compiler is not happy with me. [..] Most things look pretty simple to fix, it'll just be a lot of work to fix each thing in the *correct commit*. Some seem annoying, like the multiple "your `const int` is not const enough for this array declaration!" errors. I'll get them fixed tomorrow. May take some trial and error, since I don't have a VS environment.  [@Snild-Sony](https://github.com/Snild-Sony) given that I won't be around in the morning to push the "Approve and run" button when you'll likely work on it, I have teamed up with the AppVeyor CI just now and put [**5 commits** on a temporary branch `partial-token-perf-debugging`](https://github.com/libexpat/libexpat/commits/partial-token-perf-debugging) (4 commits of value) for you to just slice and squash into the commits where they belong, to make the [MSVC build green](https://ci.appveyor.com/project/libexpat/libexpat/builds/48535480). That should quickstart things up a bit on your side and take some frustration out also maybe 😃  Besides the array and `int` topics, I'm also adding a commit for <https://github.com/libexpat/libexpat/actions/runs/6880472525/job/18722191070?pr=789#step:9:20> .  I'll leave the interesting part — <https://github.com/libexpat/libexpat/actions/runs/6880472530/job/18722195077?pr=789#step:6:434> — to you for now:  ``` lib/xmlparse.c:2016:16: runtime error: null pointer passed as argument 2, which is declared to never be null [..] SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior /home/runner/work/libexpat/libexpat/expat/lib/xmlparse.c:2016:16 in   ```  Clang UBSan deserves every bit of praise, I've already mentioned them in the upcoming changelog. |
| --- |

All reactions

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Nov 16, 2023](#issuecomment-1814343400)

| [@Snild-Sony](https://github.com/Snild-Sony) interesting idea about resolving the variable length arrays. I like it 70% 😃 |
| --- |

All reactions

Sorry, something went wrong.

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Nov 16, 2023](#issuecomment-1814343677)

| I have teamed up with the AppVeyor CI just now and put 5 commits on a temporary branch  Thanks for the help.  to push the "approve run" button  As the GitHub noob that I am, I've just learned that this might not be necessary -- CI runs on <https://github.com/SonyMobile/libexpat-contrib/tree/partial-token-perf> as soon as I upload it there.  I'll leave the interesting part to you for now  False advertising! It really wasn't that interesting -- just the `s==NULL && len == 0` case (the only way we let a `NULL` through). A memcpy with `NULL` as the src arg is not allowed, even when the size arg is 0. Which I find overly strict, but whatever.  I chose a different way to handle the VLA errors than your suggestion, I hope that's OK.  I'll keep stacking commits on top of yours for now, and then start cleaning the history up by squashing into the appropriate commits once all the CI is happy. I just noticed that my latest push fails on clang-format... :) |
| --- |

All reactions

Sorry, something went wrong.

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Nov 16, 2023](#issuecomment-1814348034)

| [@Snild-Sony](https://github.com/Snild-Sony) interesting idea about resolving the variable length arrays. I like it 70% 😃  Uh-oh... 🚓 |
| --- |

All reactions

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Nov 16, 2023](#issuecomment-1814361529)

| CI runs on <https://github.com/SonyMobile/libexpat-contrib/tree/partial-token-perf> as soon as I upload it there.  [@Snild-Sony](https://github.com/Snild-Sony) everything but AppVeyor, I suppose.  I'll leave the interesting part to you for now  False advertising!  Okay sorry 😆  It really wasn't that interesting -- just the `s==NULL && len == 0` case (the only way we let a `NULL` through). A memcpy with `NULL` as the src arg is not allowed, even when the size arg is 0. Which I find overly strict, but whatever.  I chose a different way to handle the VLA errors than your suggestion, I hope that's OK.  Sure! |
| --- |

All reactions

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Nov 16, 2023](#issuecomment-1814367139)

| [@Snild-Sony](https://github.com/Snild-Sony) did you see…  ``` taken=36 baseline=1 slowdown=36 max_slowdown=22 [..] taken=29 baseline=1 slowdown=29 max_slowdown=14 [..] taken=28 baseline=1 slowdown=28 max_slowdown=14  ```  …at <https://github.com/libexpat/libexpat/actions/runs/6890708475/job/18744393157?pr=789#step:6:480>  Seems like we need 30 and 40 or something for maximum slowdown. |
| --- |

All reactions

Sorry, something went wrong.

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Nov 16, 2023](#issuecomment-1814394496)

| did you see…  Yes.  The extra-verbose logs are paying off:  ``` taken=33 baseline=1 slowdown=33 max_slowdown=22 ERROR: Compared to the baseline runtime of the first test, this test has a slowdown of more than <max_slowdown>. Please keep increasing the value by 1 until it reliably passes the test on your hardware and open a bug sharing that number with us. Thanks in advance! taken=27 baseline=1 slowdown=27 max_slowdown=14 Expat version: expat_2.5.0 FAIL [chunksize=0 defer_ratio=1.1]: test_big_tokens_take_linear_time (max_slowdown=22 text="<e><aaaaaa/></e>" at /home/runner/work/libexpat-contrib/libexpat-contrib/expat/tests/basic_tests.c:5292) FAIL [chunksize=0 defer_ratio=1000000.0]: test_big_tokens_take_linear_time (max_slowdown=14 text="<e><aaaaaa/></e>" at /home/runner/work/libexpat-contrib/libexpat-contrib/expat/tests/basic_tests.c:5292)  ```  How does it get baseline=*1*?!  On my laptop, I get a baseline around 1450-1500 for chunksize=0. Sure, it's far from a performance monster, but I don't believe that the CI server's single-core performance is 1000 times higher.  So I guess that means that CLOCKS\_PER\_SEC is different, which *is* allowed, but... it seems to be different to the point of uselessness here. I don't want to make the test baseline run for a whole second.  So... I guess I need another timing function. `clock` was nice because it's standard C, simple, and seemed to be good enough for what I needed. Maybe `clock_gettime` will work better. |
| --- |

All reactions

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Nov 16, 2023](#issuecomment-1814413334) • edited Loading

| So... I guess I need another timing function.  [@Snild-Sony](https://github.com/Snild-Sony) seems like it, a diff of 1 doesn't really seem to help for the baseline.  `clock` was nice because it's standard C, simple, and seemed to be good enough for what I needed. Maybe `clock_gettime` will work better.  `clock_gettime` will probably not work for non-posix windows?!  An alternative to switching to a different time function could be to run the code for baseline say 10 times and divide the result by 10? Would need a change to floating point though. Just an idea. |
| --- |

All reactions

Sorry, something went wrong.

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Nov 16, 2023](#issuecomment-1814447772)

| `clock_gettime` will probably not work for non-posix windows?!  Right, I forgot it's not just MinGW...  run the code for baseline say 10 times and divide the result by 10?  10 wouldn't be enough -- it'd have to be like 1000 or at least 100 to get decent resolution. And that means 1000 or 100 ms of runtime for just the baseline (which happens once for each chunksize \* ratio combination). I think it'd make the test suite unreasonably slow.  How about we just exclude this test on platforms that don't have enough resolution in `clock()`? The important part is that CI catches any regression, so excluding a few "bad" platforms should be fine. For example, we could do it by `CLOCKS_PER_SEC >= 100000` (a hundred thousand; my man page says that XSI requires it to be a million).  What do you think? |
| --- |

All reactions

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Nov 16, 2023](#issuecomment-1814471015)

| run the code for baseline say 10 times and divide the result by 10?  10 wouldn't be enough -- it'd have to be like 1000 or at least 100 to get decent resolution. And that means 1000 or 100 ms of runtime for just the baseline (which happens once for each chunksize \* ratio combination). I think it'd make the test suite unreasonably slow.  [@Snild-Sony](https://github.com/Snild-Sony) I think you meant seconds rather than milliseconds? That would indeed be sadly slow.  How about we just exclude this test on platforms that don't have enough resolution in `clock()`? The important part is that CI catches any regression, so excluding a few "bad" platforms should be fine. For example, we could do it by `CLOCKS_PER_SEC >= 100000` (a hundred thousand; my man page says that XSI requires it to be a million).  Unfortunately it says…  XSI requires that CLOCKS\_PER\_SEC equals 1000000 **independent of the actual resolution**.  … — emphasis mine. I'm reading that as it's virtual and made up and potentially not good to be used in tests.  I'm wondering two things now:   * What is `CLOCKS_PER_SEC` in reality on MinGW (local or CI)? Let me try test that locally in a second. * if should maybe just exclude MinGW explicitly rather than looking at the clock resolution value… but that depends on the answer to the first question to some extent.   What do you think? |
| --- |

All reactions

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Nov 16, 2023](#issuecomment-1814484896)

| * Let me try test that locally in a second.  [@Snild-Sony](https://github.com/Snild-Sony) here you go:  ``` # WINEDEBUG=-all wine ./clock_play.exe  diff 0, res 1000  # ./clock_play  diff 1, res 1000000  # cat clock_play.c #include <time.h> #include <stdio.h>  int main() {   clock_t one = clock();   clock_t two = clock();   clock_t diff = two - one;   printf("diff %d, res %d\n", diff, CLOCKS_PER_SEC);   return 0; } ```  So inspecting `CLOCKS_PER_SEC` would probably work unless CI MinGW is another planet again (refering to what we saw with `malloc` last time). |
| --- |

All reactions

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Nov 16, 2023](#issuecomment-1814495692) • edited Loading

| [@Snild-Sony](https://github.com/Snild-Sony) regarding the second latest push: `|| defined(_WIN64)` can be dropped because:  `_WIN32` Defined for both 32-bit **and 64-bit** environments [1](http://msdn.microsoft.com/en-us/library/ff540443.aspx)  (from <https://sourceforge.net/p/predef/wiki/OperatingSystems/#windows>)  For "backward compatibility" 😃 |
| --- |

All reactions

Sorry, something went wrong.

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Nov 16, 2023](#issuecomment-1814543238)

| `|| defined(_WIN64)` can be dropped  Okay, will do.  CI-wise, the latest push is looking good. Just the coverage left. I'll start trying to find the correct commits to squash each fix into... but may not have time to finish it today. |
| --- |

All reactions

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Nov 16, 2023](#issuecomment-1814574874)

| CI-wise, the latest push is looking good.  [@Snild-Sony](https://github.com/Snild-Sony) 32bit(!) msvc seems to still have some issues at <https://ci.appveyor.com/project/libexpat/libexpat/builds/48540472> .  Just the coverage left.  There's some flakiness left in it (already on `master`), it needs up to three times to be green sometimes, pretty annoying. (If you feel like investigating that some time, definitely welcome!)  I'll start trying to find the correct commits to squash each fix into... but may not have time to finish it today.  No problem, probably see you tomorrow then 👋 |
| --- |

All reactions

Sorry, something went wrong.

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Nov 16, 2023](#issuecomment-1814894941)

| The win32 failures, e.g. [here](https://ci.appveyor.com/project/libexpat/libexpat/builds/48540472/job/558pqy4d116ab37r), are:  ``` FAIL [chunksize=0 defer_ratio=1.0]: test_bypass_heuristic_when_close_to_maxbuf (loop fill=510 at c:\projects\libexpat\expat\tests\basic_tests.c:5677) FAIL [chunksize=0 defer_ratio=1.1]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=0 defer_ratio=2.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=0 defer_ratio=1000000.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=1 defer_ratio=1.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=1 defer_ratio=1.1]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=1 defer_ratio=2.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=1 defer_ratio=1000000.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=2 defer_ratio=1.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=2 defer_ratio=1.1]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=2 defer_ratio=2.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=2 defer_ratio=1000000.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=3 defer_ratio=1.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=3 defer_ratio=1.1]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=3 defer_ratio=2.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=3 defer_ratio=1000000.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=4 defer_ratio=1.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=4 defer_ratio=1.1]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=4 defer_ratio=2.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=4 defer_ratio=1000000.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=5 defer_ratio=1.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=5 defer_ratio=1.1]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=5 defer_ratio=2.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904) FAIL [chunksize=5 defer_ratio=1000000.0]: test_buffer_can_grow_to_max ("" at c:\projects\libexpat\expat\tests\basic_tests.c:2904)  ```  Those are the two test functions with the MINGW32 allocation workarounds. So that makes some sense, and maybe we do need to apply that for WIN32 as well...  *However*, I don't understand why `test_buffer_can_grow_to_max` fails with my changes, and not on `master`. This PR doesn't change the test, and I can't think of any changes in lib/xmlparse.c that would cause it to fail so easily. So I'd like to figure that out before just applying the workaround blindly.  There's some flakiness left in it (already on `master`), it needs up to three times to be green sometimes, pretty annoying.  Did this flakiness start recently (e.g. since [#788](https://github.com/libexpat/libexpat/pull/788)), and does it happen in `test_buffer_can_grow_to_max`? If so, it might be the same problem (and that means the problem is not in this PR, which would be good to know). Note that this assumes that the Appveyor machines are inconsistent in how much memory they can allocate. Otherwise, it would be consistently failing. |
| --- |

All reactions

Sorry, something went wrong.

 [![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=40&v=4)](/Snild-Sony)
[Snild-Sony](/Snild-Sony)
[force-pushed](/libexpat/libexpat/compare/54a586150a0c8b888d86fa33fe8e678aba7b638f..f5225d9964b3ac6b7c5ac5c01d3cf0e72cd94962)
the
partial-token-perf

branch
from
[`54a5861`](/libexpat/libexpat/commit/54a586150a0c8b888d86fa33fe8e678aba7b638f) to
[`f5225d9`](/libexpat/libexpat/commit/f5225d9964b3ac6b7c5ac5c01d3cf0e72cd94962)  [Compare](/libexpat/libexpat/compare/54a586150a0c8b888d86fa33fe8e678aba7b638f..f5225d9964b3ac6b7c5ac5c01d3cf0e72cd94962)
[November 16, 2023 17:31](#event-10983895294)

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Nov 16, 2023](#issuecomment-1815023840) • edited Loading

| *However*, I don't understand why `test_buffer_can_grow_to_max` fails with my changes, and not on `master`. This PR doesn't change the test, and I can't think of any changes in lib/xmlparse.c that would cause it to fail so easily. So I'd like to figure that out before just applying the workaround blindly.  [@Snild-Sony](https://github.com/Snild-Sony) good point!  There's some flakiness left in it (already on `master`), it needs up to three times to be green sometimes, pretty annoying.  Did this flakiness start recently (e.g. since [#788](https://github.com/libexpat/libexpat/pull/788))  No, way before we met. I think the symptom is diff…  ``` -Passed: 1801 -Failed: 8 +Passed: 1800 +Failed: 9 ```  …and that's from target `run-xmltest` that exists in both build systems.   * Example: <https://github.com/libexpat/libexpat/actions/runs/6419272521/job/17428766228> * All: <https://github.com/libexpat/libexpat/actions/workflows/coverage.yml?query=branch%3Amaster+is%3Afailure>   Note that it's only so few failures because I re-run most until they succeed and GitHub Actions replaces the run on re-run, that's why.  , and does it happen in `test_buffer_can_grow_to_max`? If so, it might be the same problem (and that means the problem is not in this PR, which would be good to know). Note that this assumes that the Appveyor machines are inconsistent in how much memory they can allocate. Otherwise, it would be consistently failing.  Interesting theory. Given that I learned from <https://github.com/mpartel/bindfs/blob/20897c7bde3a7d3afaba0f5dc2f9091cfd7923db/.github/workflows/linux.yml#L138-L144> the other day that there is some roulette going on whether your CI runner has KVM acceleration available or not, maybe that would not even be super surprising then?  Let me force a re-run of AppVeyor for current `master` ([3588720](https://github.com/libexpat/libexpat/commit/358872061331352da1954a451237216eb16fba64)) to see how it does.   * Same commit when merged 3 days ago: <https://ci.appveyor.com/project/libexpat/libexpat/builds/48508892> * Re-run (different SHA1) just now, still running: <https://ci.appveyor.com/project/libexpat/libexpat/builds/48543118> |
| --- |

All reactions

Sorry, something went wrong.

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Nov 17, 2023](#issuecomment-1815877141)

| No, way before we met.  Oh, okay. That won't help me here, then.  Let me force a re-run of AppVeyor for current master ([3588720](https://github.com/libexpat/libexpat/commit/358872061331352da1954a451237216eb16fba64)) to see how it does.  Both seem to have passed. Okay then, I'll start bisecting-through-force-pushes. :) |
| --- |

All reactions

Sorry, something went wrong.

 [![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=40&v=4)](/Snild-Sony)
[Snild-Sony](/Snild-Sony)
[force-pushed](/libexpat/libexpat/compare/a4c9154778da5b878c0a035490abfb789b045220..2cf9744b62b3715e9806ea1eafc4b0ea30c0bec6)
the
partial-token-perf

branch
2 times, most recently
from
[`a4c9154`](/libexpat/libexpat/commit/a4c9154778da5b878c0a035490abfb789b045220) to
[`2cf9744`](/libexpat/libexpat/commit/2cf9744b62b3715e9806ea1eafc4b0ea30c0bec6)  [Compare](/libexpat/libexpat/compare/a4c9154778da5b878c0a035490abfb789b045220..2cf9744b62b3715e9806ea1eafc4b0ea30c0bec6)
[November 17, 2023 08:13](#event-10990913466)

70 hidden items

Load more…

[![@shreyaskulkarni-1](https://avatars.githubusercontent.com/u/90887302?s=80&v=4)](/shreyaskulkarni-1)

Copy link

### **[shreyaskulkarni-1](/shreyaskulkarni-1)** commented [Feb 21, 2024](#issuecomment-1956340561)

| Hi, is the [CVE-2023-52425](https://github.com/advisories/GHSA-gh68-jm46-84rf) vulnerability related to 2.3.0?  Yes, as far as we know, it affects all Expat versions before 2.6.0.  May I know if there is a way to reproduce this CVE?  The easiest way to test reproduction on any version of Expat is to time xmlwf on the large files added in `testdata/` by this PR, e.g. `aaaaaa_attr.xml` or `aaaaaa_tag.xml`. With the fix, it should finish *well* below one second.  Note that the `-r` flag to xmlwf is very important (without it, xmlwf may mmap the whole file and send the whole thing into Expat in a single call). Adding `-g 1` makes the effect much more pronounced, as it's dependent on buffer fill size, but is not strictly necessary if your xmlwf version doesn't have it.  At [60dffa1](https://github.com/libexpat/libexpat/commit/60dffa148c3ce26799cb933afdb0dc3581ad2098), just before the main part of the fix:  ``` :expat$ time xmlwf/xmlwf -r -g 1 ../testdata/largefiles/aaaaaa_tag.xml  ^C  real	6m8,218s user	6m7,947s sys	0m0,220s  :expat$ time xmlwf/xmlwf -r -g 1024 ../testdata/largefiles/aaaaaa_tag.xml   real	1m37,176s user	1m37,101s sys	0m0,074s  :expat$ time xmlwf/xmlwf -r ../testdata/largefiles/aaaaaa_tag.xml   real	0m11,456s user	0m11,422s sys	0m0,026s  ```  Note that the first one (with `-g 1`) didn't finish, I just got tired of waiting and interrupted it after about 6 minutes.  At [9cdf9b8](https://github.com/libexpat/libexpat/commit/9cdf9b8d77d5c2c2a27d15fb68dd3f83cafb45a1):  ``` :expat$ time xmlwf/xmlwf -r -g 1 ../testdata/largefiles/aaaaaa_tag.xml   real	0m2,502s user	0m0,920s sys	0m1,583s  :expat$ time xmlwf/xmlwf -r -g 1024 ../testdata/largefiles/aaaaaa_tag.xml   real	0m0,257s user	0m0,237s sys	0m0,021s  :expat$ time xmlwf/xmlwf -r ../testdata/largefiles/aaaaaa_tag.xml   real	0m0,268s user	0m0,255s sys	0m0,014s  ```  And is there any adaptation patch for lower versions like 2.4.1?  There is not. Is there a reason you can't upgrade to 2.6.0?  I upgraded libexpat1 to 2.6.0-1 and I still see the vulnerability flagged in X-ray scans and this time it says the affected version is in 2.6.0-1. Am I missing something here? Wasn't it fixed in 2.6.0-1? |
| --- |

All reactions

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Feb 21, 2024](#issuecomment-1956349942) • edited Loading

| I upgraded libexpat1 to 2.6.0-1 and I still see the vulnerability flagged in X-ray scans and this time it says the affected version is in 2.6.0-1. Am I missing something here? Wasn't it fixed in 2.6.0-1?  [@shreyaskulkarni-1](https://github.com/shreyaskulkarni-1) which distro is this about, what is an X-ray scan and where can we find that very report about it? PS: This is still the wrong place to start yet another new discussions. We have issues for that. |
| --- |

All reactions

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Feb 21, 2024](#issuecomment-1956359092)

| Regarding backporting:  I think it's fair to say that complex security fixes and refactoring are not friends to backporting, and the fact that often backporting is trivial and just works hides the fact that backporting in general has problems with regard to risk and cost due to complexity. The recent [case of ext4 curruption from incomplete backporting in the Linux kernel](https://news.ycombinator.com/item?id=38589389) already highlighted some of that. To all those who have a choice and/or can violate backporting protocol, I would clearly recommend to instead of backporting complex Expat fixes to do a full upgrade to 2.6.0 because of risk and cost. Fixing other software for recent Expat will likely be cheaper and more stable overall.  CC [@PshySimon](https://github.com/PshySimon) [@kraptor](https://github.com/kraptor) |
| --- |

 👍
1
 kraptor reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@AB-xdev](https://avatars.githubusercontent.com/u/45384811?s=80&u=a94a7f6f808db08e27c327ae901ad323f71da054&v=4)](/AB-xdev)

Copy link

### **[AB-xdev](/AB-xdev)** commented [Feb 22, 2024](#issuecomment-1958897321)

| Not sure if this is the right place but I also have a question regarding [CVE-2023-52425](https://github.com/advisories/GHSA-gh68-jm46-84rf):  Why is Attack Vector = Network? As far as I know this library doesn't have network capabilities. Or am I overlooking something?  [CVE-2023-52426](https://github.com/advisories/GHSA-mp2w-hjcj-f5g9) for comparison has Attack Vector = Local. What is the difference here?  I'm asking this because this library is used in `fontconfig` (which is required for `java` and causes problems at e.g. [Docker because people are unable to ad hoc rebuild their "affected" images to fix the vulnerability](https://github.com/adoptium/containers/issues/501), but that's a different story) and as far as I know `fontconfig` also has no network capabilities... |
| --- |

All reactions

Sorry, something went wrong.

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Feb 22, 2024](#issuecomment-1958954243)

| Why is Attack Vector = Network?  This problem occured based on the data that the application feeds to the Expat parser. To the best of my knowledge, this can be remotely triggered *only if* the calling application gets the data from the network.  I don't know NIST's exact definition of a "network" attack vector, but I guess one could argue that Expat is often used on documents coming from over the network, not always with user interaction, and that qualifies? That does not explain why the other CVE you linked was judged differently. |
| --- |

 👍
1
 AB-xdev reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Feb 22, 2024](#issuecomment-1960204537) • edited Loading

| Hi [@AB-xdev](https://github.com/AB-xdev),  [@Snild-Sony](https://github.com/Snild-Sony) already addressed the "remote" part. With regard to [CVE-2023-52426](https://github.com/advisories/GHSA-mp2w-hjcj-f5g9 "CVE-2023-52426") being mis(!)classified as local I can say that (1) I did report it as "remote" to Mitre when filing the CVE request and that they confirmed it as "remote" to me in their e-mail reply, I still have it around. I can only guess how that happened, maybe someone later decided they know better. Personally I expect very little from vulnerability metadata quality by now, details are off frequently.  Regarding the Alpine Docker image (or any Docker image) my recommendation is to always apply all available distro updates on top manually (a la `apt-get update && apt-get dist-upgrade` on Debian) late in the Dockerfile so that Docker build cache has less of a chance to render it a no-op and to deploy frequently so that all fixes end up in production with little delay. |
| --- |

 👍
1
 AB-xdev reacted with thumbs up emoji
 👀
1
 AB-xdev reacted with eyes emoji

All reactions

* 👍
  1 reaction
* 👀
  1 reaction

Sorry, something went wrong.

[![@PshySimon](https://avatars.githubusercontent.com/u/31642968?s=80&v=4)](/PshySimon)

Copy link

### **[PshySimon](/PshySimon)** commented [Feb 26, 2024](#issuecomment-1963602971)

| I have one more point to confirm, if this CVE issue is only very time-consuming when parsing big incomplete tokens, and attackers may exploit this issue to make the server's CPU fully occupied for a long time, resulting in denial of service? Is this CVE related to memory as well (at least it seems to have nothing to do with the buffer for now)?I'm very confused about the description on NVD `libexpat through 2.5.0 allows a denial of service (resource consumption) because many full reparsings are required in the case of a large token for which multiple buffer fills are needed.`.It mentions multiple buffers, but it seems that this CVE doesn't have much to do with buffers.  By the way, this fix is quite brilliant, I like it!! |
| --- |

All reactions

Sorry, something went wrong.

[![@PshySimon](https://avatars.githubusercontent.com/u/31642968?s=80&v=4)](/PshySimon)

Copy link

### **[PshySimon](/PshySimon)** commented [Feb 26, 2024](#issuecomment-1963611734) • edited Loading

| I think `multiple buffer` refers to the fact that the number of times an incomplete token reaches the buffer limit and needs to reapply for new memory, but it seems that there will be no impact.Is that right?  Also, what is the consideration behind providing a ReparseDeferralEnabled switch?😂 If this switch is turned off, wouldn't that mean the CVE is not fixed? |
| --- |

All reactions

Sorry, something went wrong.

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Feb 26, 2024](#issuecomment-1963709551)

| I have one more point to confirm, if this CVE issue is only very time-consuming when parsing big incomplete tokens, and attackers may exploit this issue to make the server's CPU fully occupied for a long time, resulting in denial of service? Is this CVE related to memory as well (at least it seems to have nothing to do with the buffer for now)?  Memory usage for the parser's internal buffer scales linearly with the size of the incoming data, and is therefore easy for the application to limit. It can also be limited by providing specialized memory handling functions to Expat.  Before this PR, CPU usage could scale quadratically with the size of the incoming data. It was hard for the application to set a limit based on size, since CPU cost would vary based on the content: a 10 MiB could be no problem at all, or very costly, and there is (AFAICT) no way to tell ahead of time which it is.  I'm very confused about the description on NVD `libexpat through 2.5.0 allows a denial of service (resource consumption) because many full reparsings are required in the case of a large token for which multiple buffer fills are needed.`  Allow me to break that sentence up, hopefully clarifying it:   * in the case of a large token for which multiple buffer fills are needed: * many full reparsings are required * which (through high CPU usage) allows a denial of service   It mentions multiple buffers, but it seems that this CVE doesn't have much to do with buffers. I think multiple buffer refers to the fact that the number of times an incomplete token reaches the buffer limit and needs to reapply for new memory  The key is multiple buffer *fills*, i.e. multiple `XML_Parse` or `XML_ParseBuffer` calls. On each one, Expat had to re-try parsing of the unfinished token.  Reallocation of the buffer was not directly related to the issue.  Also, what is the consideration behind providing a ReparseDeferralEnabled switch?😂 If this switch is turned off, wouldn't that mean the CVE is not fixed?  That is correct.  That switch can, however, be useful for applications that make assumptions about how incoming data is "chunked", expecting callbacks from the parser at specific times. The typical example seems to be applications using streamed XML as an interactive communication protocol, where communication may deadlock if one side doesn't "flush" a received message through the parser.  With the switch, such applications can continue to work -- at the cost of staying vulnerable to this kind of DoS. Depending on the application, it may be possible to disable deferral *temporarily* at specific points (e.g. when a read from the stream times out), allowing them to at least reduce the impact a little. |
| --- |

All reactions

Sorry, something went wrong.

[![@kraptor](https://avatars.githubusercontent.com/u/7249728?s=80&u=3fb65d2b24f04ce8960e819fc3781397a63a9bc8&v=4)](/kraptor)

Copy link

### **[kraptor](/kraptor)** commented [Feb 28, 2024](#issuecomment-1968862413)

| No way I can backport this (and all other related PRs that [@Snild-Sony](https://github.com/Snild-Sony) mentioned) to 2.4.x and I've been trying like 10 days now...  There are many embedded devices and long-term support distro versions that cannot be just upgraded without major pain (or even possible to do it).  Is there a way we can involve upstream to help here? Maybe not fixing it, but having a way to mitigate it somehow would be really appreciated. |
| --- |

All reactions

Sorry, something went wrong.

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Feb 28, 2024](#issuecomment-1968909118)

| I don't think it's fair to ask [@hartwork](https://github.com/hartwork) -- a volunteer maintainer -- to spend extra effort maintaining multiple versions of Expat. He is not responsible for those embedded devices or LTS distros.  The problem can be mitigated by ensuring larger buffer fills (i.e. bigger `len` args to `XML_Parse()`). Parsing of large tokens will still be O(n²), but with a lower factor. Unfortunately, the fill size is controlled by the application, so the only way to apply this mitigation is to fix the individual applications.  Alternatively, it's possible to make Expat defer parsing until some threshold is reached ... but that's getting very close to what this PR does (and probably brings with it the need for the same related fixes), so I don't think that would be any easier to adapt to old releases. |
| --- |

 👍
1
 kraptor reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Feb 28, 2024](#issuecomment-1969027473)

| No way I can backport this (and all other related PRs that [@Snild-Sony](https://github.com/Snild-Sony) mentioned) to 2.4.x and I've been trying like 10 days now...  There are many embedded devices and long-term support distro versions that cannot be just upgraded without major pain (or even possible to do it).  Is there a way we can involve upstream to help here? Maybe not fixing it, but having a way to mitigate it somehow would be really appreciated.  Hi [@kraptor](https://github.com/kraptor), allow me to reply bullet style this time:   * I did [offer a voice call](https://github.com/libexpat/libexpat/pull/789#issuecomment-1949406452) on the topic earlier, that offer is still standing, my GitHub profile has my e-mail so we can find a time that works for both of us, if wanted. * It is not clear to me what you have in mind with "a way to mitigate it somehow". * I would like to note that my time on Expat is voluntary unpaid work. * I would like to note that "long term support" means that someone made a promise to invest themselves in supporting things beyond what upstream provides free of cost to increase value of their own project or product offering. Is that picture missing something? * I would like to persist that making the rest of the stack work with Expat 2.6.0 will likely be more feasible. I'll be curious to learn about details that prove otherwise, here or off-GitHub. |
| --- |

All reactions

Sorry, something went wrong.

[![@kraptor](https://avatars.githubusercontent.com/u/7249728?s=80&u=3fb65d2b24f04ce8960e819fc3781397a63a9bc8&v=4)](/kraptor)

Copy link

### **[kraptor](/kraptor)** commented [Feb 28, 2024](#issuecomment-1969131024)

| It was never my intention to provoke a heated discussion neither to waste anyone's time. I was just highlighting an issue all downstream distros have for stable/old codebases (and bringing other examples to the table).  I would like to note that my time on Expat is voluntary unpaid work.  This is the very reason that I'd never annoy anyone over a voice call, specially regarding free software. There is absolutely no excuse to do so.  I would like to persist that making the rest of the stack work with Expat 2.6.0 will likely be more feasible.  Following your previous advice, I was already doing this in parallel (but it takes time). This said, should I finish the backport successfully I'll share and I will be very grateful if anyone from upstream could review it.  Finally, if I sounded imperative or demanding at some point, please accept my apologies (it was probably lost in translation, I'm not english-native). |
| --- |

 👍
1
 hartwork reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Feb 28, 2024](#issuecomment-1969675934)

| [@kraptor](https://github.com/kraptor) no worries. Sorry for not making it more clear that I took no offense in what you wrote earlier 🍻 |
| --- |

All reactions

Sorry, something went wrong.

[![@lixiaoshuai666](https://avatars.githubusercontent.com/u/17995575?s=80&u=9a5e12bc9c4373c29e3e918cfd6554e48c4bda0b&v=4)](/lixiaoshuai666)

Copy link

### **[lixiaoshuai666](/lixiaoshuai666)** commented [Mar 5, 2024](#issuecomment-1978329017)

| Hi, is there any plan to fix the [CVE-2023-52425](https://github.com/advisories/GHSA-gh68-jm46-84rf "CVE-2023-52425") vulnerability in 2.3.0? [@hartwork](https://github.com/hartwork) [@Snild-Sony](https://github.com/Snild-Sony) |
| --- |

All reactions

Sorry, something went wrong.

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=80&v=4)](/Snild-Sony)

Copy link

Contributor

Author

### **[Snild-Sony](/Snild-Sony)** commented [Mar 5, 2024](#issuecomment-1978341652)

| No. |
| --- |

 👍
1
 hartwork reacted with thumbs up emoji
 😄
2
 hartwork and lixiaoshuai666 reacted with laugh emoji

All reactions

* 👍
  1 reaction
* 😄
  2 reactions

Sorry, something went wrong.

[![@se7entyse7en](https://avatars.githubusercontent.com/u/5599208?s=40&v=4)](/se7entyse7en)
[se7entyse7en](/se7entyse7en)
mentioned this pull request
[Mar 5, 2024](#ref-issue-2169670845)

[CVE-2023-52425⁠ - Rebuild alpine-based images
docker-library/python#908](/docker-library/python/issues/908)

Closed

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=80&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)

Copy link

Member

### **[hartwork](/hartwork)** commented [Mar 5, 2024](#issuecomment-1979503556)

| Hi, is there any plan to fix the [CVE-2023-52425](https://github.com/advisories/GHSA-gh68-jm46-84rf) vulnerability in 2.3.0? [@hartwork](https://github.com/hartwork) [@Snild-Sony](https://github.com/Snild-Sony)  [@lixiaoshuai666](https://github.com/lixiaoshuai666) a backport to 2.3.0 is anything but trivial and of no value upstream, so there are no plans to do that, no. Version 2.3.0 in 2024 is likely a lost cause, please consider upgrading to 2.6.0. |
| --- |

 👍
1
 lixiaoshuai666 reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=40&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)
[hartwork](/hartwork)
mentioned this pull request
[Mar 5, 2024](#ref-issue-2170089651)

[[>=2.6.0] StartElementHandler not triggered in some cases?
#840](/libexpat/libexpat/issues/840)

Closed

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this pull request
[Mar 11, 2024](#ref-issue-2178265111)

[CVE-2023-52425
ministryofjustice/hmpps-probation-integration-services#3451](/ministryofjustice/hmpps-probation-integration-services/issues/3451)

Closed

[![@davidscn](https://avatars.githubusercontent.com/u/33414590?s=40&v=4)](/davidscn)
[davidscn](/davidscn)
mentioned this pull request
[Mar 21, 2024](#ref-pullrequest-2114528151)

[Release v3 compatible ASTE version
precice/aste#182](/precice/aste/pull/182)
 Merged

4 tasks

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=40&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)
[hartwork](/hartwork)
mentioned this pull request
[Apr 5, 2024](#ref-issue-2228373121)

[Debian and Ubuntu packages failing with version 2.6.2
#857](/libexpat/libexpat/issues/857)

Closed

[![@JGSweets](https://avatars.githubusercontent.com/u/7725753?s=40&v=4)](/JGSweets)
[JGSweets](/JGSweets)
mentioned this pull request
[Apr 19, 2024](#ref-issue-2253911571)

[CVE-2023-52425⁠ in debian based images
docker-library/buildpack-deps#156](/docker-library/buildpack-deps/issues/156)

Closed

This was referenced Jul 22, 2024

[SNYK: Resource Exhaustion
N5GEH/n5geh.tools.mqtt-gateway#43](/N5GEH/n5geh.tools.mqtt-gateway/issues/43)

Closed

[SNYK: Resource Exhaustion
N5GEH/n5geh.tools.mqtt-gateway#85](/N5GEH/n5geh.tools.mqtt-gateway/issues/85)

Closed

[Snyk Security Alert: Resource Exhaustion - high
N5GEH/n5geh.tools.mqtt-gateway#162](/N5GEH/n5geh.tools.mqtt-gateway/issues/162)

Closed

[Snyk Security Alert: Resource Exhaustion - high
N5GEH/n5geh.tools.mqtt-gateway#204](/N5GEH/n5geh.tools.mqtt-gateway/issues/204)

Closed

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=40&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)
[hartwork](/hartwork)
mentioned this pull request
[Aug 28, 2024](#ref-issue-2492785448)

[[>=2.6.0] Event handler call is delayed in some cases?
#895](/libexpat/libexpat/issues/895)

Closed

[rkausch-fender](/rkausch-fender)
added a commit
to cclsoftware/libexpat
that referenced
this pull request
[Oct 18, 2024](#ref-commit-bf82337)
[![@rkausch-fender](https://avatars.githubusercontent.com/u/149786908?s=40&u=32c3f7ca8e43cc0fb24240496f0fa7dc9594f752&v=4)](/rkausch-fender)

`[Pull in changes up to version 2.6.3](/cclsoftware/libexpat/commit/bf8233786be3cf222e79ee3ef6db682624c852c2 "Pull in changes up to version 2.6.3

commit 88b3ed553d8ad335559254863a33360d55b9f1d6
Merge: 29ef43a0 f9cfbb7f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Sep 4 12:20:17 2024 +0200

    Merge pull request #896 from libexpat/issue-894-prepare-release

    Prepare release 2.6.3 (part of #894, ETA 2024-09-04)

commit f9cfbb7fcedabc40326dc287ed35f83de406224d
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Sep 1 21:14:19 2024 +0200

    Sync file headers

commit 156d4bab9d54ba230927b00d89b1b3bf8a9bec15
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Sep 1 21:03:50 2024 +0200

    Set release date for 2.6.3

commit 8707e02e1f20d5a4bb9101773b7b8736303cc029
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Sep 1 20:59:53 2024 +0200

    Bump version to 2.6.3

commit 93e5971fb513f2390e011f8444be6de18e480fe4
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Sep 1 20:59:06 2024 +0200

    Bump version info from 10:2:9 to 10:3:9

    See https://verbump.de/ for what these numbers do

commit 71e487dc1b87f1e70bf28117158cfef07fc6105e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Sep 1 20:25:10 2024 +0200

    Changes: Document changes in release Expat 2.6.3

commit 29ef43a0bab633b41e71dd6d900fff5f6b3ad5e4
Merge: b8a7dca4 9bf0f2c1
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Sep 3 18:18:03 2024 +0200

    Merge pull request #892 from libexpat/taiyou-nextscaffoldpart-overflow

    [CVE-2024-45492] lib: Detect integer overflow in function `nextScaffoldPart` (fixes #889)

commit b8a7dca4670973347892cfc452b24d9001dcd6f5
Merge: e5d6bf01 8e439a99
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Sep 3 18:17:46 2024 +0200

    Merge pull request #891 from libexpat/taiyou-dtdcopy-malloc-overflow

    [CVE-2024-45491] lib: Detect integer overflow in `dtdCopy` (fixes #888)

commit e5d6bf015ee531df0a8751baa618d25b2de73a7c
Merge: 234654c5 2db23301
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Sep 3 18:17:32 2024 +0200

    Merge pull request #890 from libexpat/taiyou-xml-parsebuffer-len

    [CVE-2024-45490] lib: Reject negative len for `XML_ParseBuffer` (fixes #887)

commit 234654c58b3833b881b5a32fc8b57b09d39ecd81
Merge: ed4090af c158a62e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Sep 1 16:45:32 2024 +0200

    Merge pull request #886 from berkayurun/master

    Remove `XML_DTD` guards before `is_param` accesses

commit 8e439a9947e9dc80a395c0c7456545d8d9d9e421
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Aug 19 22:34:13 2024 +0200

    lib: Detect integer overflow in dtdCopy

    Reported by TaiYou

commit 2db233019f551fe4c701bbbc5eb0fa58ff349daa
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Aug 25 19:09:51 2024 +0200

    doc: Document that XML_Parse/XML_ParseBuffer reject \"len < 0\"

commit c12f039b8024d6b9a11c20858370495ff6ff5245
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Aug 20 22:57:12 2024 +0200

    tests: Cover \"len < 0\" for both XML_Parse and XML_ParseBuffer

commit 5c1a31642e243f4870c0bd1f2afc7597976521bf
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Aug 19 22:26:07 2024 +0200

    lib: Reject negative len for XML_ParseBuffer

    Reported by TaiYou

commit 9bf0f2c16ee86f644dd1432507edff94c08dc232
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Aug 19 22:37:16 2024 +0200

    lib: Detect integer overflow in function nextScaffoldPart

    Reported by TaiYou

commit c158a62e57f6b2e8c61a7735dc458a22181ca0d7
Author: Berkay Eren Ürün <berkay.ueruen@siemens.com>
Date:   Wed Aug 21 12:49:34 2024 +0200

    Remove XML_DTD guards before is_param accesses

    As a part of the ENTITY struct, is_param is correctly initialized even
    when XML_DTD is not defined. This can be seen in the 'lookup' function,
    which sets all the ENTITY memory, including the is_param flag, to zero
    during the ENTITY creation. Additionally, is_param can only be assigned
    XML_TRUE when XML_DTD is defined, which makes XML_DTD checks before
    is_param accesses not necessary.

    Currently, some of the is_param accesses are guarded by the XML_DTD and
    some not. This commit removes all XML_DTD guards that are meant for
    is_param accesses.

commit ed4090af841ebd8a7b2e367280407d74e748a7dd
Merge: b1ab4745 35753a8c
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Aug 21 19:57:51 2024 +0200

    Merge pull request #885 from libexpat/fix-in-code-comment-typo

    Fix typo in a code comment

commit 35753a8ccccaac17387b58934049a709e501e46a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Aug 20 21:15:17 2024 +0200

    lib: Fix typo in a code comment

commit b1ab4745f39bcbee65fe2ef9b4fa3b9fa46b06ce
Merge: dfa90b81 05735b8f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Aug 19 20:30:43 2024 +0200

    Merge pull request #884 from libexpat/dependabot/github_actions/codespell-project/actions-codespell-2.1

    Actions(deps): Bump codespell-project/actions-codespell from 2.0 to 2.1

commit 05735b8f68d4e6cc2f7f664450467ec2dae32057
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Aug 19 12:32:12 2024 +0000

    Actions(deps): Bump codespell-project/actions-codespell from 2.0 to 2.1

    Bumps [codespell-project/actions-codespell](https://github.com/codespell-project/actions-codespell) from 2.0 to 2.1.
    - [Release notes](https://github.com/codespell-project/actions-codespell/releases)
    - [Commits](https://github.com/codespell-project/actions-codespell/compare/94259cd8be02ad2903ba34a22d9c13de21a74461...406322ec52dd7b488e48c1c4b82e2a8b3a1bf630)

    ---
    updated-dependencies:
    - dependency-name: codespell-project/actions-codespell
      dependency-type: direct:production
      update-type: version-update:semver-minor
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit dfa90b81153a18555d78d4441697aba68ee61a68
Merge: a8898cdb 61886f8d
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Aug 12 22:54:04 2024 +0200

    Merge pull request #883 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.6

    Actions(deps): Bump actions/upload-artifact from 4.3.5 to 4.3.6

commit 61886f8dbddf39500a137bfe3ab605a3d10d8ea5
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Aug 12 12:16:07 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.3.5 to 4.3.6

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.3.5 to 4.3.6.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/89ef406dd8d7e03cfd12d9e0a4a378f454709029...834a144ee995460fba8ed112a2fc961b36a5ec5a)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit a8898cdb1e0c9cc8c0ec1f7468601e6b8fd243a0
Merge: 6b3f93c6 1f9da870
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Aug 6 20:21:17 2024 +0200

    Merge pull request #882 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.5

    Actions(deps): Bump actions/upload-artifact from 4.3.4 to 4.3.5

commit 1f9da870e197dc91360e68c5d6b1ea3ef8652f48
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Aug 5 12:38:32 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.3.4 to 4.3.5

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.3.4 to 4.3.5.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/0b2256b8c012f0828dc542b3febcab082c67f72b...89ef406dd8d7e03cfd12d9e0a4a378f454709029)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 6b3f93c6caa0308455beeced0268cfae04df3584
Merge: 0b6ab7cd e19e5233
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jul 13 20:19:27 2024 +0200

    Merge pull request #880 from libexpat/readme-promote-call-for-help

    `README.md`: Promote call for help in the Changes file

commit e19e52331b20a15699a3ea26f2ebc301c80fd20c
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jul 13 17:48:38 2024 +0200

    README.md: Promote call for help in the Changes file

    Documentation on the used Markdown extension:
    - https://github.blog/changelog/2023-12-14-new-markdown-extension-alerts-provide-distinctive-styling-for-significant-content/
    - https://docs.github.com/en/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax#alerts

commit 0b6ab7cd20a73cfb6bc1424a4770d54c247e5938
Merge: feb65c62 09f8eddd
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jul 13 02:01:40 2024 +0200

    Merge pull request #879 from libexpat/autotools-sync-cmake-files

    autotools: Sync CMake templates with CMake 3.28

commit feb65c625ce5dcc3b5459e75c01bbf9afb214589
Merge: 4c3f8641 0e9863e4
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jul 13 00:46:25 2024 +0200

    Merge pull request #878 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.4

    Actions(deps): Bump actions/upload-artifact from 4.3.3 to 4.3.4

commit 09f8eddd8ef2150f0f2b8d07d3723b13e4f07b75
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jul 13 00:13:25 2024 +0200

    autotools: Sync CMake templates with CMake 3.28

commit 0e9863e4832a9ee7d024c40ce5690bdb2763b5c0
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Jul 8 12:49:27 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.3.3 to 4.3.4

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.3.3 to 4.3.4.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/65462800fd760344b1a7b4382951275a0abb4808...0b2256b8c012f0828dc542b3febcab082c67f72b)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 4c3f8641a71625860928641ca87b393827274028
Merge: bfd178c6 9269f9e6
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Jun 17 21:01:31 2024 +0200

    Merge pull request #876 from libexpat/dependabot/github_actions/actions/checkout-4.1.7

    Actions(deps): Bump actions/checkout from 4.1.6 to 4.1.7

commit 9269f9e68ff8dc469f2726a39bbda843f3d243d2
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Jun 17 12:07:06 2024 +0000

    Actions(deps): Bump actions/checkout from 4.1.6 to 4.1.7

    Bumps [actions/checkout](https://github.com/actions/checkout) from 4.1.6 to 4.1.7.
    - [Release notes](https://github.com/actions/checkout/releases)
    - [Changelog](https://github.com/actions/checkout/blob/main/CHANGELOG.md)
    - [Commits](https://github.com/actions/checkout/compare/a5ac7e51b41094c92402da3b24376905380afc29...692973e3d937129bcbf40652eb9f2f61becf3332)

    ---
    updated-dependencies:
    - dependency-name: actions/checkout
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit bfd178c6350bbb46dbc71dae299a1d531468bf8a
Merge: 322ab5ff 1ee828c7
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue May 21 01:45:03 2024 +0200

    Merge pull request #874 from libexpat/dependabot/github_actions/actions/checkout-4.1.6

    Actions(deps): Bump actions/checkout from 4.1.5 to 4.1.6

commit 1ee828c752e102f6305749a88eae77ab7837975a
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon May 20 12:54:15 2024 +0000

    Actions(deps): Bump actions/checkout from 4.1.5 to 4.1.6

    Bumps [actions/checkout](https://github.com/actions/checkout) from 4.1.5 to 4.1.6.
    - [Release notes](https://github.com/actions/checkout/releases)
    - [Changelog](https://github.com/actions/checkout/blob/main/CHANGELOG.md)
    - [Commits](https://github.com/actions/checkout/compare/44c2b7a8a4ea60a981eaca3cf939b5f4305c123b...a5ac7e51b41094c92402da3b24376905380afc29)

    ---
    updated-dependencies:
    - dependency-name: actions/checkout
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 322ab5ff7a0edd8de5300ce04731c0b4390f8827
Merge: 2703c85b 4f44375e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun May 19 15:58:40 2024 +0200

    Merge pull request #873 from libexpat/fix-coverage-ci

    `coverage.yml`: Fix for image `ubuntu-22.04` of `20240514.2.0`

commit 4f44375e3f84c354b4ced2073fce44e3b0168376
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun May 19 14:13:10 2024 +0200

    coverage.yml: Fix for image ubuntu-22.04 of 20240514.2.0

commit 2703c85b0a84d7dbc56c9d733476a631a5edd4fd
Merge: 3ec84e45 197275e3
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed May 15 20:11:25 2024 +0200

    Merge pull request #871 from libexpat/dependabot/github_actions/actions/checkout-4.1.5

    Actions(deps): Bump actions/checkout from 4.1.4 to 4.1.5

commit 197275e39110e43fde1a7c7939d288001ff01a50
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon May 13 21:16:53 2024 +0000

    Actions(deps): Bump actions/checkout from 4.1.4 to 4.1.5

    Bumps [actions/checkout](https://github.com/actions/checkout) from 4.1.4 to 4.1.5.
    - [Release notes](https://github.com/actions/checkout/releases)
    - [Changelog](https://github.com/actions/checkout/blob/main/CHANGELOG.md)
    - [Commits](https://github.com/actions/checkout/compare/0ad4b8fadaa221de15dcec353f45205ec38ea70b...44c2b7a8a4ea60a981eaca3cf939b5f4305c123b)

    ---
    updated-dependencies:
    - dependency-name: actions/checkout
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 3ec84e457fc0ae8026ee43504c0e3b60645afab7
Merge: da88e9a4 b0e67383
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon May 13 23:16:12 2024 +0200

    Merge pull request #872 from libexpat/fix-clang-format-ci

    `lib/siphash.h`: Apply clang-format 18.1.5

commit b0e673830e963c092cd1a2b71691c344ef2b0be9
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon May 13 22:00:56 2024 +0200

    lib/siphash.h: Apply clang-format 18.1.5

commit da88e9a4443dba37daea123f5e51b18a2611e03b
Merge: b58b3871 1253273f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun May 5 15:21:03 2024 +0200

    Merge pull request #869 from dag-erling/des/non-gnu-sed

    Drop dependency on GNU sed

commit 1253273fe4cfb322efd1834debda84118edff950
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Thu May 2 17:20:26 2024 +0200

    Drop dependency on GNU sed.

    GNU sed supports `-i` (in-place editing) with an optional suffix for the
    backup copy.  Non-GNU implementations also support `-i`, but the suffix
    is not optional.  Replacing all occurrences of naked `-i` with `-i.bak`
    ensures our scripts work equally well with both.

commit b58b38719507f6700dd5a7898d88c36c8b95154a
Merge: c40938db 59295bef
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat May 4 16:06:51 2024 +0200

    Merge pull request #863 from dag-erling/des/fix-xmltest-log

    Don't require dos2unix.

commit c40938dbe02282e5975157b502c47da21350627e
Merge: e0cf7c85 54400c2e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat May 4 16:04:40 2024 +0200

    Merge pull request #870 from dag-erling/des/sizeof-void-p

    Simplify handling of `SIZEOF_VOID_P`

commit 54400c2e0c86acce56e13acc260cc8bf7ee28719
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Fri May 3 01:20:31 2024 +0200

    autotools: Simplify handling of `SIZEOF_VOID_P`.

commit 59295befca67d9af43e5c4338076b7fdde91996a
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Mon Apr 22 16:37:00 2024 +0200

    fix-xmltest-log.sh: Rewrite in pure sed.

    This removes the need for installing dos2unix in development and CI
    environments.

commit e0cf7c85446261fb5d9cd11747b675ca731678ff
Merge: 9cbdb916 2f205773
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri May 3 00:52:18 2024 +0200

    Merge pull request #868 from dag-erling/des/update-ci

    Fix various CI issues

commit 2f2057733f837c4dbfa1c9a770b70b5ab7bc37bc
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Thu May 2 23:17:16 2024 +0200

    github-ci: Drop requirement for GNU coreutils.

commit 58539734545fbd2e271f6cb3f798c253390024cd
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Thu May 2 21:36:16 2024 +0200

    github-ci: Remove obsolete comments referencing Travis CI.

commit 2083722b95e2f6decba4113be3c5fa499de7dcc6
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Wed May 1 12:24:11 2024 +0200

    github-ci: Install docbook-xml.

    Some tests use the xmlwf documentation as sample input.  It is written in
    DocBook, and the tests appear to be failing because they try to fetch it
    at run time, which is not allowed.  Work around this by installing it in
    advance.

commit 26be7c3f117dd7488bfa3091f5cfdc488accff74
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Wed May 1 12:16:29 2024 +0200

    github-ci: Enable exhaustive branch analysis in cppcheck job.

commit d69aee5244a270417fa32535361b966c394a586d
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Wed May 1 11:57:50 2024 +0200

    github-ci: Switch macOS tests over to supported releases.

commit 85e01c40046684d9464637addd62f144b2959ed2
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Wed May 1 11:55:02 2024 +0200

    github-ci: Drop requirement for GNU find.

commit 8e7c117e8ff7ae7ec1224780b95153b61152f748
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Wed May 1 11:54:07 2024 +0200

    github-ci: Don't die if  already exists.

commit 9cbdb916de2a7bd1aa649e55efc38d2426680359
Merge: c82ca17b 73627c74
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed May 1 21:47:08 2024 +0200

    Merge pull request #865 from Ferenc-/fix-define-for-linux-syscall

    Fix `check_c_source_compiles` of `HAVE_SYSCALL_GETRANDOM`

commit 73627c7456db80db5d537f178132978b686c6fb7
Author: Ferenc Géczi <ferenc.gm@gmail.com>
Date:   Sat Apr 27 00:00:01 2024 +0000

    Use feature test macro for syscall prototype

    In order to cover the largest number of glibc and musl libc versions,
    withouth warnings, the decision here is to use `_GNU_SOURCE`,
    even if it enables a larger than necessary feature set.

    A feature macro is needed, because otherwise the `check_c_source_compiles`
    for `HAVE_SYSCALL_GETRANDOM` fails in cases when for example
    the default compiler flags include `-std=c99`:

    ````
    src.c:6:13: error: implicit declaration of function ‘syscall’ [-Wimplicit-function-declaration]
        6 |             syscall(SYS_getrandom, NULL, 0, 0);
          |             ^~~~~~~
    ````
    But this check should pass, as `SYS_getrandom` is available,
    only the declaration of `syscall` in `unistd.h` is conditional behind a macro.

    The exact minimal public macros, for enabling this are in `features.h`, and
    are version dependent.

    According to [5.04](
    https://mirrors.edge.kernel.org/pub/linux/docs/man-pages/Archive/man-pages-5.04.tar.gz)
    and older versions of the `man 2 syscall` page,
    the recommended feature test macro is `_GNU_SOURCE`.
    Later on in [5.05](
    https://mirrors.edge.kernel.org/pub/linux/docs/man-pages/Archive/man-pages-5.05.tar.gz)
    this statement has changed, to provide a smaller minimal feature set.
    Namely up to `glibc 2.18`  is `_BSD_SOURCE || _SVID_SOURCE`,
    but after that the `_DEFAULT_SOURCE` is recommended,
    and `_BSD_SOURCE || _SVID_SOURCE` is deprecated, and emits warning in later versions.
    Regardless of that the `_GNU_SOURCE` is still fully supported
    in every version and is suitable for our purposes.

    The musl libc doesn't use `_SVID_SOURCE` at all, but `_BSD_SOURCE` always works,
    plus in some newer versions `_DEFAULT_SOURCE` also sets `_BSD_SOURCE`,
    but `_GNU_SOURCE` covers the largest set of versions and is unlikely
    to be deprecated in the future.

    Further info about feature test macros:

    In glibc:
    https://www.gnu.org/software/libc/manual/html_node/Feature-Test-Macros.html

    In musl libc under the `Feature Test Macros Supported by musl` section:
    https://musl.libc.org/doc/1.1.24/manual.html

    Signed-off-by: Ferenc Géczi <ferenc.gm@gmail.com>

commit c82ca17b61de7e37d3b748b55b33adfd1a091392
Merge: 1f1ac992 2ddf759f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Apr 30 01:09:12 2024 +0200

    Merge pull request #866 from libexpat/dependabot/github_actions/actions/checkout-4.1.4

    Actions(deps): Bump actions/checkout from 4.1.3 to 4.1.4

commit 1f1ac992bffc4ba2bc123fb020a971c63bf3566d
Merge: a2b44bd2 33ed8172
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Apr 29 22:40:37 2024 +0200

    Merge pull request #867 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.3

    Actions(deps): Bump actions/upload-artifact from 4.3.2 to 4.3.3

commit 33ed8172fb5e70df2f460b90d6d1adad17e64274
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Apr 29 12:06:24 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.3.2 to 4.3.3

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.3.2 to 4.3.3.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/1746f4ab65b179e0ea60a494b83293b640dd5bba...65462800fd760344b1a7b4382951275a0abb4808)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 2ddf759f591fc10ed2241cb5bd77e04f3c66ef67
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Apr 29 12:06:18 2024 +0000

    Actions(deps): Bump actions/checkout from 4.1.3 to 4.1.4

    Bumps [actions/checkout](https://github.com/actions/checkout) from 4.1.3 to 4.1.4.
    - [Release notes](https://github.com/actions/checkout/releases)
    - [Changelog](https://github.com/actions/checkout/blob/main/CHANGELOG.md)
    - [Commits](https://github.com/actions/checkout/compare/1d96c772d19495a3b5c517cd2bc0cb401ea0529f...0ad4b8fadaa221de15dcec353f45205ec38ea70b)

    ---
    updated-dependencies:
    - dependency-name: actions/checkout
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit a2b44bd2d28a6638c1cece06882b093a2fafd05f
Merge: 9134d0d6 abb1c4a3
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Apr 27 23:19:35 2024 +0200

    Merge pull request #864 from dag-erling/des/tests-readme

    tests: Convert README to Markdown and update.

commit abb1c4a3805967febb94d4d375f1be22b5580b5d
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Tue Apr 23 11:28:24 2024 +0200

    tests: Convert README to Markdown and update.

commit 9134d0d6e073ed505f26bdb8c23747961c575e79
Merge: 46062b60 1b6a4f19
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Apr 23 03:17:22 2024 +0200

    Merge pull request #861 from dag-erling/des/mkdir-m4

    Ensure that the m4 directory always exists.

commit 46062b600d1f375c3358492b97273783d0f49df7
Merge: 8fd3e86f 886f7ea7
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Apr 23 03:09:57 2024 +0200

    Merge pull request #862 from dag-erling/des/squiggle

    Protect us against Emacs users.

commit 8fd3e86f28016cad3d4e41ea9cadaf28c180f8b6
Merge: 4c64d111 f16b7aa1
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Apr 22 23:41:55 2024 +0200

    Merge pull request #859 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.2

    Actions(deps): Bump actions/upload-artifact from 4.3.1 to 4.3.2

commit 4c64d11182655fa5c5c916c3ff9ac47be575afc2
Merge: e48ab660 cd363842
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Apr 22 23:40:34 2024 +0200

    Merge pull request #860 from libexpat/dependabot/github_actions/actions/checkout-4.1.3

    Actions(deps): Bump actions/checkout from 4.1.2 to 4.1.3

commit 886f7ea7b7c8dd51b8a6f294009bdd794d399856
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Mon Apr 22 16:37:53 2024 +0200

    Protect us against Emacs users.

commit 1b6a4f19c6f97643b41a0640180084567fca8c2f
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Mon Apr 22 16:34:07 2024 +0200

    Ensure that the m4 directory always exists.

commit cd363842314fa24c85482796c25b7b3b89f607d5
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Apr 22 12:20:20 2024 +0000

    Actions(deps): Bump actions/checkout from 4.1.2 to 4.1.3

    Bumps [actions/checkout](https://github.com/actions/checkout) from 4.1.2 to 4.1.3.
    - [Release notes](https://github.com/actions/checkout/releases)
    - [Changelog](https://github.com/actions/checkout/blob/main/CHANGELOG.md)
    - [Commits](https://github.com/actions/checkout/compare/9bb56186c3b09b4f86b1c65136769dd318469633...1d96c772d19495a3b5c517cd2bc0cb401ea0529f)

    ---
    updated-dependencies:
    - dependency-name: actions/checkout
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit f16b7aa1ec0e6f394601a99713f2650d8ca08864
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Apr 22 12:20:09 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.3.1 to 4.3.2

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.3.1 to 4.3.2.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/5d5d22a31266ced268874388b861e4b58bb5c2f3...1746f4ab65b179e0ea60a494b83293b640dd5bba)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit e48ab6604f04ee71f311b3e8170379b48ce77c2b
Merge: ef50fb20 d420c32d
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Apr 7 22:30:04 2024 +0200

    Merge pull request #851 from libexpat/autotools-sync-cmake-files

    autotools: Sync CMake templates with CMake 3.27

commit ef50fb208b9b448ae76fbecb464b3c15f2f4e865
Merge: 059a4aa7 26f7cbbf
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Apr 4 18:31:28 2024 +0200

    Merge pull request #855 from libexpat/issue-854-cmake-fix-use-of-check-symbol-exists

    cmake: Fix check for symbols `size_t` and `off_t` (fixes #854)

commit 059a4aa71df6c0f5ef90306db64e2ee546696db7
Merge: 5434a740 13e84bb3
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Apr 4 01:09:38 2024 +0200

    Merge pull request #856 from libexpat/fix-main

    Fix `main()` to `main(void)`

commit 26f7cbbf4abc019fc814fc4e960864c3e7ccea0f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Apr 3 00:44:10 2024 +0200

    cmake: Fix check for symbols `size_t` and `off_t`

    The two issues with the previous approach were that:

    1. `check_symbol_exists` would store \"1\" or \"\" into
       variable `off_t` rather than string \"off_t\", and

    2. (`check_symbol_exists` would not find `off_t` or
       `size_t` on modern Linux).

    Was reported with NetBSD 9.3.

    `size_t` is part of C99 (which Expat requires), so
    only the `off_t` half remains.

commit 5434a74081a39bb43fb95cdec291dbb61cb9acd0
Merge: d450c1b4 2b8492d6
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Apr 3 23:51:03 2024 +0200

    Merge pull request #853 from bluhm/find-path

    Always provide path to find(1) for portability

commit 13e84bb374237fde1815cf0315a8b93c2c46e16b
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Apr 3 02:20:46 2024 +0200

    Fix `main()` to `main(void)`

commit 2b8492d622913829ff69c803acfbe2ae6673f471
Author: Alexander Bluhm <alexander.bluhm@gmx.net>
Date:   Mon Apr 1 22:56:49 2024 +0200

    Always provide path to find.

    Running find without path is a GNU extension.  GNU find uses current
    directory as starting-point in this case.  Better always use an
    explicit . in build scripts to support find on other systems.

commit d420c32d67d1b4829883ad05b9f024b3f4ed649a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Mar 29 22:17:56 2024 +0100

    autotools: Sync CMake templates with CMake 3.27

commit d450c1b439ab56bfd04def5146d2c728666e0f00
Merge: d04f8ef8 2874a26e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Mar 23 19:37:22 2024 +0100

    Merge pull request #741 from libexpat/drop-support-msvc-2017

    [>=2024-04-02] Drop support for Visual Studio 15 2017

commit 2874a26eeb33a2c6f1ad05ef94373d453eaf98d7
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Mar 23 17:52:37 2024 +0100

    win32/build_expat_iss.bat: Add missing \"-A Win32\" for Visual Studio 16 2019

commit f8fb85ec8c1f3749c3ac8d932ce8909f0051632a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Sep 2 21:33:35 2023 +0200

    Drop support for Visual Studio 15 2017

commit d04f8ef8874c2829b624cb6c832bb5b9f7ce8dc2
Merge: a59c3edf 571a62c8
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Mar 19 22:50:07 2024 +0100

    Merge pull request #850 from libexpat/dependabot/github_actions/actions/checkout-4.1.2

    Actions(deps): Bump actions/checkout from 4.1.1 to 4.1.2

commit 571a62c8f5f979232e96691b29223dbae8bb603b
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Mar 18 12:03:05 2024 +0000

    Actions(deps): Bump actions/checkout from 4.1.1 to 4.1.2

    Bumps [actions/checkout](https://github.com/actions/checkout) from 4.1.1 to 4.1.2.
    - [Release notes](https://github.com/actions/checkout/releases)
    - [Changelog](https://github.com/actions/checkout/blob/main/CHANGELOG.md)
    - [Commits](https://github.com/actions/checkout/compare/b4ffde65f46336ab88eb53be808477a3936bae11...9bb56186c3b09b4f86b1c65136769dd318469633)

    ---
    updated-dependencies:
    - dependency-name: actions/checkout
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit a59c3edffa54a77b8d7b268ef527da541076ca6a
Merge: fa75b965 91116dfa
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Mar 17 23:00:53 2024 +0100

    Merge pull request #849 from libexpat/allow-triggering-github-actions-workflows-manually

    Allow triggering GitHub Actions workflows manually

commit 91116dfa7eabcb0b3e115dd5b028fd0a39caf3b9
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Mar 17 15:28:36 2024 +0100

    Allow triggering GitHub Actions workflows manually

    Some already had \"workflow_dispatch\" enabled.

commit fa75b96546c069d17b8f80d91e0f4ef0cde3790d
Merge: 5bf8ed66 8548bc03
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Mar 13 17:37:37 2024 +0100

    Merge pull request #843 from libexpat/issue-838-prepare-release

    Prepare release 2.6.2 (part of #838, ETA 2024-03-13)

commit 8548bc03fdb887c8720f01e95440f1406bd15ffa
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Mar 9 16:30:09 2024 +0100

    Changes: Add call for help

commit 86d6052c5ec63fad3ef564cbdef1e1ac3d18f30e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Mar 8 13:17:12 2024 +0100

    Set release date for 2.6.2

commit 13cff445fa383733da1d6011d593d0ecd9d456ab
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Mar 8 13:12:02 2024 +0100

    Bump version to 2.6.2

commit 557f1255f9f431646e27b84b1a2fe63380352b70
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Mar 8 13:07:38 2024 +0100

    Bump version info from 10:1:9 to 10:2:9

    See https://verbump.de/ for what these numbers do

commit 98ee1baef80da27e148e55d4b2ae96143716064f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Mar 8 13:07:00 2024 +0100

    Changes: Document changes in release Expat 2.6.2

commit 5bf8ed66efd5672da960f89fceed3fda92f10cee
Merge: 50262138 c32ed081
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Mar 13 14:22:48 2024 +0100

    Merge pull request #847 from TomasKorbar/doc-makefile

    [2.6.1] Fix DOCBOOK_TO_MAN variable use in doc Makefile

commit c32ed08191f21206ef14c30852f9846ef6977276
Author: Tomas Korbar <tkorbar@redhat.com>
Date:   Wed Mar 13 11:01:52 2024 +0100

    Fix DOCBOOK_TO_MAN variable use in doc Makefile

    Not using quotes causes problems when DOCBOOK_TO_MAN contains
    command and argument

commit 5026213864ba1a11ef03ba2e8111af8654e9404d
Merge: 27525ada 072eca0b
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Mar 7 22:14:09 2024 +0100

    Merge pull request #842 from libexpat/issue-839-billion-laughs-isolated-external-parser

    Prevent billion laughs attacks in isolated external parser (part of #839)

commit 27525adabdac2a48a5ce5d2f5588fce741a0c8e3
Merge: 6bcb9915 565ab44a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Mar 7 20:24:13 2024 +0100

    Merge pull request #841 from libexpat/issue-839-reject-direct-parameter-entity-recursion

    Reject direct parameter entity recursion (part of #839)

commit 072eca0b72373da103ce15f8f62d1d7b52695454
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Mar 5 22:43:03 2024 +0100

    tests: Cover amplification tracking for isolated external parser

commit 1d50b80cf31de87750103656f6eb693746854aa8
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Mar 4 23:49:06 2024 +0100

    lib/xmlparse.c: Detect billion laughs attack with isolated external parser

    When parsing DTD content with code like ..

      XML_Parser parser = XML_ParserCreate(NULL);
      XML_Parser ext_parser = XML_ExternalEntityParserCreate(parser, NULL, NULL);
      enum XML_Status status = XML_Parse(ext_parser, doc, (int)strlen(doc), XML_TRUE);

    .. there are 0 bytes accounted as direct input and all input from `doc` accounted
    as indirect input.  Now function accountingGetCurrentAmplification cannot calculate
    the current amplification ratio as \"(direct + indirect) / direct\", and it did refuse
    to divide by 0 as one would expect, but it returned 1.0 for this case to indicate
    no amplification over direct input.  As a result, billion laughs attacks from
    DTD-only input were not detected with this isolated way of using an external parser.

    The new approach is to assume direct input of length not 0 but 22 -- derived from
    ghost input \"<!ENTITY a SYSTEM 'b'>\", the shortest possible way to include an external
    DTD --, and do the usual \"(direct + indirect) / direct\" math with \"direct := 22\".

    GitHub issue #839 has more details on this issue and its origin in ClusterFuzz
    finding 66812.

commit 565ab44a42ac1c973fcc2f47ae0a9ba23b6c5f07
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Mar 3 01:35:35 2024 +0100

    tests: Cover rejection of direct parameter entity recursion

commit a4c86a395ee447c59175c762af3d17f7107b2261
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Mar 3 02:19:58 2024 +0100

    lib/xmlparse.c: Reject directly recursive parameter entities

commit 6bcb991574a084b3ed6d79c4ef9d78d14285d85f
Merge: a590b2d5 8f75c536
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Mar 1 20:15:09 2024 +0100

    Merge pull request #837 from libexpat/extend-2-6-1-change-log

    Add missing #821 #824 to 2.6.1 change log

commit 8f75c536158fd480f950925333fcd0730bac0142
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Feb 29 22:09:53 2024 +0100

    Changes: Add missing #821 #824 to 2.6.1 change log

commit a590b2d5846865412182805b853dd91d18f38c8d
Merge: 1cf882e7 58ff7c39
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Feb 29 21:19:01 2024 +0100

    Merge pull request #834 from libexpat/issue-832-prepare-release

    Prepare release 2.6.1 (part of #832, ETA 2024-02-29)

commit 1cf882e79cbacbd68a406b24a3859a12033465fa
Merge: a387201c ea528347
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Feb 29 20:07:11 2024 +0100

    Merge pull request #836 from libexpat/issue-828-expose-billion-laughs-api-with-xml-dtd-without-xml-ge

    Expose billion laughs API with `XML_DTD` without `XML_GE` (fixes #828)

commit 58ff7c39eae53215da9bba028c316ed85348d31b
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 23:52:42 2024 +0100

    Sync file headers

commit fce4b9f3b300a9e5c05f6cd170dce3d4d10fe04a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 23:38:45 2024 +0100

    Set release date for 2.6.1

commit dfe043fe6aa8d35a3fa1d7ea96299f0925fe8114
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 23:43:09 2024 +0100

    Bump version to 2.6.1

commit fbe7b9345b22f9d5cce61735219a253b34504000
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 23:41:24 2024 +0100

    Bump version info from 10:0:9 to 10:1:9

    See https://verbump.de/ for what these numbers do

commit 3dc137ea05a0c108cd89c91ef68d85798920653d
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 23:36:50 2024 +0100

    Changes: Document changes in release Expat 2.6.1

commit ea528347091bf56d4c02858da16ea4eecfb5fb2b
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Feb 28 20:29:47 2024 +0100

    doc/reference.html: Drop inaccurate statement about XML_* macros

    The statement is falsified by these macros:
    - XML_ATTR_INFO
    - XML_DTD
    - XML_GE

commit 1e028f2ef751b366ab2b4b9b682ae5691013e42e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Feb 28 20:44:53 2024 +0100

    lib/expat.h: Expose billion laughs API for XML_DTD without XML_GE

    Regression from commit caa27198637683b15d810737bb8a6a81af19bfa5 .

commit a387201ca4fb68629b09cb2201145f7f004e736c
Merge: 9dcb74f5 0106682e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Feb 28 00:55:34 2024 +0100

    Merge pull request #833 from libexpat/configure-ac-protect-multilib

    `configure.ac`: Protect against `expat_config.h.in` defining `SIZEOF_VOID_P`

commit 0106682ea6be456de3d850f037781d03603ff95e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 23:12:45 2024 +0100

    configure.ac: Protect against expat_config.h.in defining SIZEOF_VOID_P

commit 9dcb74f552d5f1604c8574665b2b37c8bc52ad2a
Merge: 5b940f4a 7e2a0da9
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 21:41:30 2024 +0100

    Merge pull request #829 from libexpat/hide-test-only-code-behind-new-macro

    Hide test-only code behind new (internal) macro `XML_TESTING` (alternative to #826)

commit 7e2a0da9ba6581c073484ff400a98fd4037b5c73
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Feb 21 12:53:48 2024 +0100

    lib: Hide some test-only code behind new macro XML_TESTING

commit a4a420eedcc5426f67b8ed64bbf88f70fce53963
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Feb 21 12:53:03 2024 +0100

    Autotools: Turn libexpatinternal.la into standalone library

    .. so that we can now have code in say xmlparse.c that does not
    end up in libexpat.so but still runs when executing the test suite.

commit 5b940f4a650bd1d1d04dd1280d6e920547f0c580
Merge: b7e1a110 0f6b39d2
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 20 20:40:41 2024 +0100

    Merge pull request #824 from libexpat/issue-821-improve-make-clean-for-configure-without-docbook

    Autotools: Re-work handling of xmlwf.1 (fixes #821)

commit 0f6b39d2f513aae16c7377fc802c25ab81551c42
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 13 19:42:04 2024 +0100

    Autotools: Re-work handling of xmlwf.1

    File \"doc/xmlwf.1\" should not be cleaned when building with
    \"./configure --without-docbook\", and re-compilation of the file
    should take precedence over a pre-built copy where available.

    Also, variable CLEANFILES can be used to simplify things a bit
    in Makefile.am.

commit b7e1a1101133725c79e2170b0870cca8543e5323
Merge: 4ff4c544 dc8499f2
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 13 18:30:35 2024 +0100

    Merge pull request #817 from SonyMobile/clockless-test

    tests: Replace clock counting with counting scanned bytes

commit dc8499f295bcb5e0b1ff89aa3ca5ca65ddb4ca7b
Author: Snild Dolkow <snild@sony.com>
Date:   Wed Feb 7 13:00:45 2024 +0100

    tests: Replace clock counting with scanned bytes in linear-time test

    This removes the dependency on CLOCKS_PER_SEC that prevented this test
    from running properly on some platforms, as well as the inherent
    flakiness of time measurements.

    Since later commits have introduced g_bytesScanned (and before that,
    g_parseAttempts), we can use that value as a proxy for parse time
    instead of clock().

commit fe0177cd3fe73ab2ad2e5e749a6badbbd7ec1d83
Author: Snild Dolkow <snild@sony.com>
Date:   Wed Feb 7 12:57:19 2024 +0100

    tests: Replace g_parseAttempts with g_bytesScanned

    This was used to estimate the number of scanned bytes. Just exposing
    that number directly will be more precise.

commit 4ff4c544aa2a3912afb2735d31681dfefe8a732e
Merge: 226201d1 aed1ed76
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 12 14:52:18 2024 +0100

    Merge pull request #820 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.1

    Actions(deps): Bump actions/upload-artifact from 4.3.0 to 4.3.1

commit aed1ed769d01ee9e616286282d3447094f608237
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Feb 12 12:09:58 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.3.0 to 4.3.1

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.3.0 to 4.3.1.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/26f96dfa697d77e81fd5907df203aa23a56210a8...5d5d22a31266ced268874388b861e4b58bb5c2f3)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 226201d10dd63e4995955b6d43c96e71437f19ca
Merge: 4033d6dc 3f60a47c
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Feb 11 16:45:16 2024 +0100

    Merge pull request #819 from th1722/patch-1

    Fix compiler warnings

commit 3f60a47cb5716bb810789a12ef6024c1dc448164
Author: Taichi Haradaguchi <20001722@ymail.ne.jp>
Date:   Fri Feb 9 19:28:35 2024 +0900

    Fix compiler warnings

    > In file included from ./../lib/internal.h:149,
    >                  from codepage.c:38:
    > ./../lib/expat.h:1045:5: warning: \"XML_GE\" is not defined, evaluates to 0 [-Wundef]
    >  1045 | #if XML_GE == 1
    >       |     ^~~~~~
    > ./../lib/internal.h:158:5: warning: \"XML_GE\" is not defined, evaluates to 0 [-Wundef]
    >   158 | #if XML_GE == 1
    >       |     ^~~~~~

commit 4033d6dc5797eca420bb1e109a89a3953e50036e
Merge: 849da3e3 d4f958e3
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Feb 8 17:24:26 2024 +0100

    Merge pull request #818 from libexpat/fix-clang-format-ci

    Get clang-format CI back in sync

commit d4f958e345163a6028f69c0efa2f62f5189845be
Author: clang-format 18.1.0 <clang-format@tool.invalid>
Date:   Thu Feb 8 15:18:43 2024 +0100

    Mass-apply clang-format 18.1.0

commit 849da3e3fe727fccef5e96ef35482d66447f06a2
Merge: 8198e4bf 2a10e173
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 17:49:41 2024 +0100

    Merge pull request #776 from libexpat/issue-775-prepare-release

    Prepare release 2.6.0 (part of #775, ETA is 2024-02-07)

commit 2a10e173ab6a2468ee47b9426fce274168e4ea66
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 14:13:00 2024 +0100

    Sync file headers

commit 92f10eb800bac5477010eb4dc32005e698ba406a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 12:32:08 2024 +0100

    .mailmap: Add Joyce Brum and Owain Davies

commit b5ae2481b0dcd8e682fcdd7f378506e1f4901ecd
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Feb 2 19:31:02 2024 +0100

    Set release date for 2.6.0

commit 310a1977f471b6211a37c7d73e05c1a26eeaa9df
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Feb 2 19:27:52 2024 +0100

    Bump version to 2.6.0

commit b9fd46523161147c12468f8e1da2cd0235518228
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Feb 2 19:23:22 2024 +0100

    Bump version info from 9:10:8 to 10:0:9

    See https://verbump.de/ for what these numbers do

commit ae06168b64e7520b0adaa2a8b7f9837df187a17a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Oct 21 18:07:47 2023 +0200

    Changes: Document changes in release Expat 2.6.0

commit 8198e4bfede103c11ededa0167b634d0e88c7f77
Merge: 9944b712 9c16d1c5
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 11:09:42 2024 +0100

    Merge pull request #815 from libexpat/fix-pkg-config-file-for-static-build-on-windows

    pkg-config: Add missing `-DXML_STATIC` for Windows (alternative to #805)

commit 9c16d1c5b4959bed843bc0f1d065ad25a5e1b778
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 00:10:09 2024 +0100

    pkg-config: Add missing -DXML_STATIC (for Windows)

    This affects the output of command \"pkg-config --cflags --static expat\".

commit 9944b71234d96d529cff01a80b52776d974838fd
Merge: b6243248 bc7490a4
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 00:16:23 2024 +0100

    Merge pull request #813 from libexpat/issue-812-protect-against-closing-entities-out-of-order

    Protect against closing entities out of order (fixes #812)

commit b6243248a97026aacdf343a2bab7af53e66e1ea2
Merge: 127aa340 aba268e2
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 00:00:00 2024 +0100

    Merge pull request #814 from libexpat/fix-make-check-for-arm64-freebsd

    tests: Fix `CLOCKS_PER_SEC` guard for arm64 FreeBSD reality

commit aba268e2c00069818a60809aed986d993f8dd397
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Feb 2 17:50:43 2024 +0100

    tests/basic_tests.c: Fix CLOCKS_PER_SEC guard for arm64 FreeBSD reality

    CLOCKS_PER_SEC turned out to be as small as 128 in practice
    on machine cfarm240.cfarm.net .

commit 127aa340d3435ba0e83ee643362419e3486eb5a1
Merge: 34b598c5 7352d303
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Jan 31 01:49:59 2024 +0100

    Merge pull request #809 from libexpat/clang-format-18

    CI: Upgrade to clang-format 18

commit 7352d3035bb7881fc87e596b754e46bf35136ca9
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Jan 30 22:58:48 2024 +0100

    clang-*.yml: Fix accidental trailing whitespace

commit 37d018478161ad932405da7181af80ca9e52909c
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Jan 26 15:51:17 2024 +0100

    clang-format.yml: Bump to clang-format 18

commit 137a57808748d799558a88056a4aef4d04994320
Author: clang-format 18.1.0 <clang-format@tool.invalid>
Date:   Sat Jan 27 19:24:45 2024 +0100

    Mass-apply clang-format 18.1.0

commit c594eedfa802f85df3d2226b25ace52b902a63f4
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jan 27 19:21:13 2024 +0100

    apply-clang-format.sh: Drop workaround for lib/siphash.h

    Does not seem needed anymore (or running the script would
    produce a diff).

commit 5d2a438af25e16297c1681539fe6d19852327320
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jan 27 19:17:25 2024 +0100

    apply-clang-format.sh: Use \"git ls-files\" rather than \"find\"

    .. and reduce difference with sibling script apply-clang-tidy.sh .

commit 34b598c5f594b015c513c73f06e7ced3323edbf1
Merge: 2becc8a8 d5b02e96
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Jan 30 22:54:37 2024 +0100

    Merge pull request #789 from SonyMobile/partial-token-perf

    Speed up parsing of big tokens

commit bc7490a4a79ab9302d9c76dcad8c0ce88f43d93f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Jan 29 21:37:16 2024 +0100

    tests/misc_tests.c: Add regression test for closing entities out of order

commit c4208e7fd1aecb82dc9a44918df7134594560df5
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Jan 30 01:34:43 2024 +0100

    lib/xmlparse.c: Protect against closing entities out of order

commit d5b02e96ab95d2a7ae0aea72d00054b9d036d76d
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Nov 9 19:28:05 2023 +0100

    xmlwf: Document argument \"-q\"

    Rebased-and-adapted-by: Snild Dolkow <snild@sony.com>

commit 09fdf998e7cf3f8f9327e6602077791095aedd4d
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Nov 9 19:14:14 2023 +0100

    xmlwf: Support disabling reparse deferral

    Rebased-and-adapted-by: Snild Dolkow <snild@sony.com>

commit 8f8aaf5c8e8a6e812dd8dadd96cf9bd044bc085a
Author: Snild Dolkow <snild@sony.com>
Date:   Fri Nov 24 16:31:56 2023 +0100

    tests: Check heuristic bypass with varying buffer fill sizes

    The bypass works on the assumption that the application uses a
    consistent fill size. Let's make some assertions about what should
    happen when the application doesn't do that -- most importantly,
    that parsing does happen eventually, and that the number of scanned
    bytes doesn't explode.

commit 182bbc350ed8b3c547133a9a44a4f30a0ba3b77e
Author: Snild Dolkow <snild@sony.com>
Date:   Mon Jan 29 16:43:32 2024 +0100

    tests: Make it clear to clang-tidy that assert_true may not return

    The key is to have __attribute__((noreturn)) somewhere that clang-tidy
    can see it. In this case, this is the _fail() function, which is
    conditionally called from the assert_true() macro.

    This will ensure that clang-tidy doesn't complain about NULL values
    that we've asserted against in tests.

commit 2becc8a81d9694bdfb5810eeafee50050d55b43a
Merge: 183270d5 b04a01d4
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Jan 29 17:58:59 2024 +0100

    Merge pull request #811 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.0

    Actions(deps): Bump actions/upload-artifact from 4.2.0 to 4.3.0

commit 3d8141d26a3b01ff948e00956cb0723a89dadf7f
Author: Snild Dolkow <snild@sony.com>
Date:   Mon Nov 20 16:11:24 2023 +0100

    Bypass partial token heuristic when nearing full buffer

    ...instead of only when approaching the maximum buffer size INT/2+1.

    We'd like to give applications a chance to finish parsing a large token
    before buffer reallocation, in case the reallocation fails.

    By bypassing the reparse deferral heuristic when getting close to the
    filling the buffer, we give them this chance -- if the whole token is
    present in the buffer, it will be parsed at that time.

    This may come at the cost of some extra reparse attempts. For a token
    of n bytes, these extra parses cause us to scan over a maximum of
    2n bytes (... + n/8 + n/4 + n/2 + n). Therefore, parsing of big tokens
    remains O(n) in regard how many bytes we scan in attempts to parse. The
    cost in reality is lower than that, since the reparses that happen due
    to the bypass will affect m_partialTokenBytesBefore, delaying the next
    ratio-based reparse. Furthermore, only the first token that \"breaks
    through\" a buffer ceiling takes that extra reparse attempt; subsequent
    large tokens will only bypass the heuristic if they manage to hit the
    new buffer ceiling.

    Note that this cost analysis depends on the assumption that Expat grows
    its buffer by doubling it (or, more generally, grows it exponentially).
    If this changes, the cost of this bypass may increase. Hopefully, this
    would be caught by test_big_tokens_take_linear_time or the new test.

    The bypass logic assumes that the application uses a consistent fill.
    If the app increases its fill size, it may miss the bypass (and the
    normal heuristic will apply). If the app decreases its fill size, the
    bypass may be hit multiple times for the same buffer size. The very
    worst case would be to always fill half of the remaining buffer space,
    in which case parsing of a large n-byte token becomes O(n log n).

    As an added bonus, the new test case should be faster than the old one,
    since it doesn't have to go all the way to 1GiB to check the behavior.

    Finally, this change necessitated a small modification to two existing
    tests related to reparse deferral. These tests are testing the deferral
    enabled setting, and assume that reparsing will not happen for any other
    reason. By pre-growing the buffer, we make sure that this new deferral
    does not affect those test cases.

commit 60b74209899a67d426d208662674b55a5eed918c
Author: Snild Dolkow <snild@sony.com>
Date:   Wed Oct 4 16:00:14 2023 +0200

    Bypass partial token heuristic when close to maximum buffer size

    For huge tokens, we may end up in a situation where the partial token
    parse deferral heuristic demands more bytes than Expat's maximum buffer
    size (currently ~half of INT_MAX) could fit.

    INT_MAX/2 is 1024 MiB on most systems. Clearly, a token of 950 MiB could
    fit in that buffer, but the reparse threshold might be such that
    callProcessor() will defer it, allowing the app to keep filling the
    buffer until XML_GetBuffer() eventually returns a memory error.

    By bypassing the heuristic when we're getting close to the maximum
    buffer size, it will once again be possible to parse tokens in the size
    range INT_MAX/2/ratio < size < INT_MAX/2 reliably.

    We subtract the last buffer fill size as a way to detect that the next
    XML_GetBuffer() call has a risk of returning a memory error -- assuming
    that the application is likely to keep using the same (or smaller) fill.

    We subtract XML_CONTEXT_BYTES because that's the maximum amount of bytes
    that could remain at the start of the buffer, preceding the partial
    token. Technically, it could be fewer bytes, but XML_CONTEXT_BYTES is
    normally small relative to INT_MAX, and is much simpler to use.

    Co-authored-by: Sebastian Pipping <sebastian@pipping.org>

commit ad9c01be8ee5d3d5cac2bfd3949ad764541d35e7
Author: Snild Dolkow <snild@sony.com>
Date:   Thu Oct 26 13:55:02 2023 +0200

    Make external entity parser inherit partial token heuristic setting

    The test is essentially a copy of the existing test for the setter,
    adapted to run on the external parser instead of the original one.

    Suggested-by: Sebastian Pipping <sebastian@pipping.org>
    CI-fighting-assistance-by: Sebastian Pipping <sebastian@pipping.org>

commit 8ddd8e86aa446d02eb8d398972d3b10d4cad908a
Author: Snild Dolkow <snild@sony.com>
Date:   Fri Sep 29 10:14:59 2023 +0200

    Try to parse even when incoming len is zero

    If the reparse deferral setting has changed, it may be possible to
    finish a token.

commit 1d3162da8a85a398ab451aadd6c2ad19587e5a68
Author: Snild Dolkow <snild@sony.com>
Date:   Mon Sep 11 15:31:24 2023 +0200

    Add app setting for enabling/disabling reparse heuristic

    Suggested-by: Sebastian Pipping <sebastian@pipping.org>
    CI-fighting-assistance-by: Sebastian Pipping <sebastian@pipping.org>

commit 09957b8ced725b96a95acff150facda93f03afe1
Author: Snild Dolkow <snild@sony.com>
Date:   Thu Oct 26 10:41:00 2023 +0200

    Allow XML_GetBuffer() with len=0 on a fresh parser

    len=0 was previously OK if there had previously been a non-zero call.
    It makes sense to allow an application to work the same way on a
    newly-created parser, and not have to care if its incoming buffer
    happens to be 0.

commit f1eea784d0429bc4813a3d66a8e24e6c9df56be7
Author: Snild Dolkow <snild@sony.com>
Date:   Mon Nov 6 09:22:48 2023 +0100

    tests: Add max_slowdown info in test_big_tokens_take_linear_time

    Suggested-by: Sebastian Pipping <sebastian@pipping.org>

commit 9fe3672459c1bf10926b85f013aa1b623d855545
Author: Snild Dolkow <snild@sony.com>
Date:   Mon Sep 18 20:32:55 2023 +0200

    tests: Run both with and without partial token heuristic

    If we always run with the heuristic enabled, it may hide some bugs by
    grouping up input into bigger parse attempts.

    CI-fighting-assistance-by: Sebastian Pipping <sebastian@pipping.org>

commit 1b9d398517befeb944cbbadadf10992b07e96fa2
Author: Snild Dolkow <snild@sony.com>
Date:   Mon Sep 4 17:21:14 2023 +0200

    Don't update partial token heuristic on error

    Suggested-by: Sebastian Pipping <sebastian@pipping.org>

commit 9cdf9b8d77d5c2c2a27d15fb68dd3f83cafb45a1
Author: Snild Dolkow <snild@sony.com>
Date:   Thu Aug 17 16:25:26 2023 +0200

    Skip parsing after repeated partials on the same token

    When the parse buffer contains the starting bytes of a token but not
    all of them, we cannot parse the token to completion. We call this a
    partial token.  When this happens, the parse position is reset to the
    start of the token, and the parse() call returns. The client is then
    expected to provide more data and call parse() again.

    In extreme cases, this means that the bytes of a token may be parsed
    many times: once for every buffer refill required before the full token
    is present in the buffer.

    Math:
      Assume there's a token of T bytes
      Assume the client fills the buffer in chunks of X bytes
      We'll try to parse X, 2X, 3X, 4X ... until mX == T (technically >=)
      That's (m²+m)X/2 = (T²/X+T)/2 bytes parsed (arithmetic progression)
      While it is alleviated by larger refills, this amounts to O(T²)

    Expat grows its internal buffer by doubling it when necessary, but has
    no way to inform the client about how much space is available. Instead,
    we add a heuristic that skips parsing when we've repeatedly stopped on
    an incomplete token. Specifically:

     * Only try to parse if we have a certain amount of data buffered
     * Every time we stop on an incomplete token, double the threshold
     * As soon as any token completes, the threshold is reset

    This means that when we get stuck on an incomplete token, the threshold
    grows exponentially, effectively making the client perform larger buffer
    fills, limiting how many times we can end up re-parsing the same bytes.

    Math:
      Assume there's a token of T bytes
      Assume the client fills the buffer in chunks of X bytes
      We'll try to parse X, 2X, 4X, 8X ... until (2^k)X == T (or larger)
      That's (2^(k+1)-1)X bytes parsed -- e.g. 15X if T = 8X
      This is equal to 2T-X, which amounts to O(T)

    We could've chosen a faster growth rate, e.g. 4 or 8. Those seem to
    increase performance further, at the cost of further increasing the
    risk of growing the buffer more than necessary. This can easily be
    adjusted in the future, if desired.

    This is all completely transparent to the client, except for:
    1. possible delay of some callbacks (when our heuristic overshoots)
    2. apps that never do isFinal=XML_TRUE could miss data at the end

    For the affected testdata, this change shows a 100-400x speedup.
    The recset.xml benchmark shows no clear change either way.

    Before:
    benchmark -n ../testdata/largefiles/recset.xml 65535 3
      3 loops, with buffer size 65535. Average time per loop: 0.270223
    benchmark -n ../testdata/largefiles/aaaaaa_attr.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 15.033048
    benchmark -n ../testdata/largefiles/aaaaaa_cdata.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.018027
    benchmark -n ../testdata/largefiles/aaaaaa_comment.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 11.775362
    benchmark -n ../testdata/largefiles/aaaaaa_tag.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 11.711414
    benchmark -n ../testdata/largefiles/aaaaaa_text.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.019362

    After:
    ./run.sh benchmark -n ../testdata/largefiles/recset.xml 65535 3
      3 loops, with buffer size 65535. Average time per loop: 0.269030
    ./run.sh benchmark -n ../testdata/largefiles/aaaaaa_attr.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.044794
    ./run.sh benchmark -n ../testdata/largefiles/aaaaaa_cdata.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.016377
    ./run.sh benchmark -n ../testdata/largefiles/aaaaaa_comment.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.027022
    ./run.sh benchmark -n ../testdata/largefiles/aaaaaa_tag.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.099360
    ./run.sh benchmark -n ../testdata/largefiles/aaaaaa_text.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.017956

commit 60dffa148c3ce26799cb933afdb0dc3581ad2098
Author: Snild Dolkow <snild@sony.com>
Date:   Wed Nov 15 15:54:37 2023 +0100

    tests: Use normal XML_Parse in test_suspend_resume_internal_entity

    When the parser is suspended, _XML_Parse_SINGLE_BYTES() will return
    early. At that point, there could be some amount of bytes that haven't
    been fed into Expat at all yet. This leaves us with an incomplete
    document.

    Furthermore, the last internal XML_Parse() call with isFinal=XML_TRUE
    will not have happened, so the parser will not know that no more input
    is to be expected. This is what allowed the test to pass when it was
    originally changed to use SINGLE_BYTES.

    With the new partial token heuristic, the lack of a final parse call
    means that we don't even reach the \"Ho\" text, and fail the test.

    The simplest solution is to go back to using XML_Parse() in this test.
    Another option would be to let SINGLE_BYTES expose how far it got in
    its loop, allowing for later continuation, but it doesn't seem worth the
    extra complexity.

commit 3484383fa75e0ea2aa716360088813c3b205b261
Author: Snild Dolkow <snild@sony.com>
Date:   Thu Aug 17 16:53:12 2023 +0200

    Add aaaaaa_*.xml with unreasonably large tokens

    Some of these currently take a very long time to parse. I set those to
    only run one loop in the run-benchmark make target.

    4096 may be a fairly small buffer, and definitely make the problem worse
    than it otherwise would've been, but similar sizes exist in real code:

     * 2048 bytes in cpython Modules/pyexpat.c
     * 4096 bytes in skia SkXMLParser.cpp
     * BUFSIZ bytes (8192 on my machine) in expat/examples

    The files, too, are inspired by real-life examples: Android stores
    depth and gain maps as base64-encoded JPEGs inside the XMP data of
    other JPEGs. Sometimes as a text element, sometimes as an attribute
    value. I've seen attribute values slightly over 5 MiB in size.

commit b04a01d43108d891bb475a362e861570c3ef6857
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Jan 29 12:14:39 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.2.0 to 4.3.0

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.2.0 to 4.3.0.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/694cdabd8bdb0f10b2cea11669e1bf5453eed0a6...26f96dfa697d77e81fd5907df203aa23a56210a8)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-minor
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 183270d5654b7376fbc7b34bc2101c7898d7dee2
Merge: f7ada131 6880fe49
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Jan 26 19:10:31 2024 +0100

    Merge pull request #810 from libexpat/clang-18

    CI: Upgrade to Clang 18 (except clang-tidy and clang-format)

commit f7ada131b775e850e3a31a202c3fb410a1c6d379
Merge: abd9542b 7acda8d1
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Jan 26 18:30:17 2024 +0100

    Merge pull request #808 from libexpat/clang-tidy-18

    CI: Upgrade to clang-tidy 18

commit 6880fe4948121ad121ea3341f4c0f8ab082139d0
Author: Sebastian Pipping <sebastian@pippi…")`
…

`[bf82337](/cclsoftware/libexpat/commit/bf8233786be3cf222e79ee3ef6db682624c852c2)`

```
commit 88b3ed553d8ad335559254863a33360d55b9f1d6
Merge: 29ef43a0 f9cfbb7f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Sep 4 12:20:17 2024 +0200

    Merge pull request #896 from libexpat/issue-894-prepare-release

    Prepare release 2.6.3 (part of #894, ETA 2024-09-04)

commit f9cfbb7fcedabc40326dc287ed35f83de406224d
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Sep 1 21:14:19 2024 +0200

    Sync file headers

commit 156d4bab9d54ba230927b00d89b1b3bf8a9bec15
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Sep 1 21:03:50 2024 +0200

    Set release date for 2.6.3

commit 8707e02e1f20d5a4bb9101773b7b8736303cc029
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Sep 1 20:59:53 2024 +0200

    Bump version to 2.6.3

commit 93e5971fb513f2390e011f8444be6de18e480fe4
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Sep 1 20:59:06 2024 +0200

    Bump version info from 10:2:9 to 10:3:9

    See https://verbump.de/ for what these numbers do

commit 71e487dc1b87f1e70bf28117158cfef07fc6105e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Sep 1 20:25:10 2024 +0200

    Changes: Document changes in release Expat 2.6.3

commit 29ef43a0bab633b41e71dd6d900fff5f6b3ad5e4
Merge: b8a7dca4 9bf0f2c1
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Sep 3 18:18:03 2024 +0200

    Merge pull request #892 from libexpat/taiyou-nextscaffoldpart-overflow

    [CVE-2024-45492] lib: Detect integer overflow in function `nextScaffoldPart` (fixes #889)

commit b8a7dca4670973347892cfc452b24d9001dcd6f5
Merge: e5d6bf01 8e439a99
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Sep 3 18:17:46 2024 +0200

    Merge pull request #891 from libexpat/taiyou-dtdcopy-malloc-overflow

    [CVE-2024-45491] lib: Detect integer overflow in `dtdCopy` (fixes #888)

commit e5d6bf015ee531df0a8751baa618d25b2de73a7c
Merge: 234654c5 2db23301
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Sep 3 18:17:32 2024 +0200

    Merge pull request #890 from libexpat/taiyou-xml-parsebuffer-len

    [CVE-2024-45490] lib: Reject negative len for `XML_ParseBuffer` (fixes #887)

commit 234654c58b3833b881b5a32fc8b57b09d39ecd81
Merge: ed4090af c158a62e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Sep 1 16:45:32 2024 +0200

    Merge pull request #886 from berkayurun/master

    Remove `XML_DTD` guards before `is_param` accesses

commit 8e439a9947e9dc80a395c0c7456545d8d9d9e421
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Aug 19 22:34:13 2024 +0200

    lib: Detect integer overflow in dtdCopy

    Reported by TaiYou

commit 2db233019f551fe4c701bbbc5eb0fa58ff349daa
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Aug 25 19:09:51 2024 +0200

    doc: Document that XML_Parse/XML_ParseBuffer reject "len < 0"

commit c12f039b8024d6b9a11c20858370495ff6ff5245
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Aug 20 22:57:12 2024 +0200

    tests: Cover "len < 0" for both XML_Parse and XML_ParseBuffer

commit 5c1a31642e243f4870c0bd1f2afc7597976521bf
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Aug 19 22:26:07 2024 +0200

    lib: Reject negative len for XML_ParseBuffer

    Reported by TaiYou

commit 9bf0f2c16ee86f644dd1432507edff94c08dc232
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Aug 19 22:37:16 2024 +0200

    lib: Detect integer overflow in function nextScaffoldPart

    Reported by TaiYou

commit c158a62e57f6b2e8c61a7735dc458a22181ca0d7
Author: Berkay Eren Ürün <berkay.ueruen@siemens.com>
Date:   Wed Aug 21 12:49:34 2024 +0200

    Remove XML_DTD guards before is_param accesses

    As a part of the ENTITY struct, is_param is correctly initialized even
    when XML_DTD is not defined. This can be seen in the 'lookup' function,
    which sets all the ENTITY memory, including the is_param flag, to zero
    during the ENTITY creation. Additionally, is_param can only be assigned
    XML_TRUE when XML_DTD is defined, which makes XML_DTD checks before
    is_param accesses not necessary.

    Currently, some of the is_param accesses are guarded by the XML_DTD and
    some not. This commit removes all XML_DTD guards that are meant for
    is_param accesses.

commit ed4090af841ebd8a7b2e367280407d74e748a7dd
Merge: b1ab4745 35753a8c
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Aug 21 19:57:51 2024 +0200

    Merge pull request #885 from libexpat/fix-in-code-comment-typo

    Fix typo in a code comment

commit 35753a8ccccaac17387b58934049a709e501e46a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Aug 20 21:15:17 2024 +0200

    lib: Fix typo in a code comment

commit b1ab4745f39bcbee65fe2ef9b4fa3b9fa46b06ce
Merge: dfa90b81 05735b8f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Aug 19 20:30:43 2024 +0200

    Merge pull request #884 from libexpat/dependabot/github_actions/codespell-project/actions-codespell-2.1

    Actions(deps): Bump codespell-project/actions-codespell from 2.0 to 2.1

commit 05735b8f68d4e6cc2f7f664450467ec2dae32057
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Aug 19 12:32:12 2024 +0000

    Actions(deps): Bump codespell-project/actions-codespell from 2.0 to 2.1

    Bumps [codespell-project/actions-codespell](https://github.com/codespell-project/actions-codespell) from 2.0 to 2.1.
    - [Release notes](https://github.com/codespell-project/actions-codespell/releases)
    - [Commits](https://github.com/codespell-project/actions-codespell/compare/94259cd8be02ad2903ba34a22d9c13de21a74461...406322ec52dd7b488e48c1c4b82e2a8b3a1bf630)

    ---
    updated-dependencies:
    - dependency-name: codespell-project/actions-codespell
      dependency-type: direct:production
      update-type: version-update:semver-minor
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit dfa90b81153a18555d78d4441697aba68ee61a68
Merge: a8898cdb 61886f8d
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Aug 12 22:54:04 2024 +0200

    Merge pull request #883 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.6

    Actions(deps): Bump actions/upload-artifact from 4.3.5 to 4.3.6

commit 61886f8dbddf39500a137bfe3ab605a3d10d8ea5
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Aug 12 12:16:07 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.3.5 to 4.3.6

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.3.5 to 4.3.6.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/89ef406dd8d7e03cfd12d9e0a4a378f454709029...834a144ee995460fba8ed112a2fc961b36a5ec5a)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit a8898cdb1e0c9cc8c0ec1f7468601e6b8fd243a0
Merge: 6b3f93c6 1f9da870
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Aug 6 20:21:17 2024 +0200

    Merge pull request #882 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.5

    Actions(deps): Bump actions/upload-artifact from 4.3.4 to 4.3.5

commit 1f9da870e197dc91360e68c5d6b1ea3ef8652f48
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Aug 5 12:38:32 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.3.4 to 4.3.5

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.3.4 to 4.3.5.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/0b2256b8c012f0828dc542b3febcab082c67f72b...89ef406dd8d7e03cfd12d9e0a4a378f454709029)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 6b3f93c6caa0308455beeced0268cfae04df3584
Merge: 0b6ab7cd e19e5233
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jul 13 20:19:27 2024 +0200

    Merge pull request #880 from libexpat/readme-promote-call-for-help

    `README.md`: Promote call for help in the Changes file

commit e19e52331b20a15699a3ea26f2ebc301c80fd20c
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jul 13 17:48:38 2024 +0200

    README.md: Promote call for help in the Changes file

    Documentation on the used Markdown extension:
    - https://github.blog/changelog/2023-12-14-new-markdown-extension-alerts-provide-distinctive-styling-for-significant-content/
    - https://docs.github.com/en/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax#alerts

commit 0b6ab7cd20a73cfb6bc1424a4770d54c247e5938
Merge: feb65c62 09f8eddd
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jul 13 02:01:40 2024 +0200

    Merge pull request #879 from libexpat/autotools-sync-cmake-files

    autotools: Sync CMake templates with CMake 3.28

commit feb65c625ce5dcc3b5459e75c01bbf9afb214589
Merge: 4c3f8641 0e9863e4
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jul 13 00:46:25 2024 +0200

    Merge pull request #878 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.4

    Actions(deps): Bump actions/upload-artifact from 4.3.3 to 4.3.4

commit 09f8eddd8ef2150f0f2b8d07d3723b13e4f07b75
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jul 13 00:13:25 2024 +0200

    autotools: Sync CMake templates with CMake 3.28

commit 0e9863e4832a9ee7d024c40ce5690bdb2763b5c0
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Jul 8 12:49:27 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.3.3 to 4.3.4

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.3.3 to 4.3.4.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/65462800fd760344b1a7b4382951275a0abb4808...0b2256b8c012f0828dc542b3febcab082c67f72b)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 4c3f8641a71625860928641ca87b393827274028
Merge: bfd178c6 9269f9e6
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Jun 17 21:01:31 2024 +0200

    Merge pull request #876 from libexpat/dependabot/github_actions/actions/checkout-4.1.7

    Actions(deps): Bump actions/checkout from 4.1.6 to 4.1.7

commit 9269f9e68ff8dc469f2726a39bbda843f3d243d2
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Jun 17 12:07:06 2024 +0000

    Actions(deps): Bump actions/checkout from 4.1.6 to 4.1.7

    Bumps [actions/checkout](https://github.com/actions/checkout) from 4.1.6 to 4.1.7.
    - [Release notes](https://github.com/actions/checkout/releases)
    - [Changelog](https://github.com/actions/checkout/blob/main/CHANGELOG.md)
    - [Commits](https://github.com/actions/checkout/compare/a5ac7e51b41094c92402da3b24376905380afc29...692973e3d937129bcbf40652eb9f2f61becf3332)

    ---
    updated-dependencies:
    - dependency-name: actions/checkout
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit bfd178c6350bbb46dbc71dae299a1d531468bf8a
Merge: 322ab5ff 1ee828c7
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue May 21 01:45:03 2024 +0200

    Merge pull request #874 from libexpat/dependabot/github_actions/actions/checkout-4.1.6

    Actions(deps): Bump actions/checkout from 4.1.5 to 4.1.6

commit 1ee828c752e102f6305749a88eae77ab7837975a
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon May 20 12:54:15 2024 +0000

    Actions(deps): Bump actions/checkout from 4.1.5 to 4.1.6

    Bumps [actions/checkout](https://github.com/actions/checkout) from 4.1.5 to 4.1.6.
    - [Release notes](https://github.com/actions/checkout/releases)
    - [Changelog](https://github.com/actions/checkout/blob/main/CHANGELOG.md)
    - [Commits](https://github.com/actions/checkout/compare/44c2b7a8a4ea60a981eaca3cf939b5f4305c123b...a5ac7e51b41094c92402da3b24376905380afc29)

    ---
    updated-dependencies:
    - dependency-name: actions/checkout
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 322ab5ff7a0edd8de5300ce04731c0b4390f8827
Merge: 2703c85b 4f44375e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun May 19 15:58:40 2024 +0200

    Merge pull request #873 from libexpat/fix-coverage-ci

    `coverage.yml`: Fix for image `ubuntu-22.04` of `20240514.2.0`

commit 4f44375e3f84c354b4ced2073fce44e3b0168376
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun May 19 14:13:10 2024 +0200

    coverage.yml: Fix for image ubuntu-22.04 of 20240514.2.0

commit 2703c85b0a84d7dbc56c9d733476a631a5edd4fd
Merge: 3ec84e45 197275e3
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed May 15 20:11:25 2024 +0200

    Merge pull request #871 from libexpat/dependabot/github_actions/actions/checkout-4.1.5

    Actions(deps): Bump actions/checkout from 4.1.4 to 4.1.5

commit 197275e39110e43fde1a7c7939d288001ff01a50
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon May 13 21:16:53 2024 +0000

    Actions(deps): Bump actions/checkout from 4.1.4 to 4.1.5

    Bumps [actions/checkout](https://github.com/actions/checkout) from 4.1.4 to 4.1.5.
    - [Release notes](https://github.com/actions/checkout/releases)
    - [Changelog](https://github.com/actions/checkout/blob/main/CHANGELOG.md)
    - [Commits](https://github.com/actions/checkout/compare/0ad4b8fadaa221de15dcec353f45205ec38ea70b...44c2b7a8a4ea60a981eaca3cf939b5f4305c123b)

    ---
    updated-dependencies:
    - dependency-name: actions/checkout
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 3ec84e457fc0ae8026ee43504c0e3b60645afab7
Merge: da88e9a4 b0e67383
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon May 13 23:16:12 2024 +0200

    Merge pull request #872 from libexpat/fix-clang-format-ci

    `lib/siphash.h`: Apply clang-format 18.1.5

commit b0e673830e963c092cd1a2b71691c344ef2b0be9
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon May 13 22:00:56 2024 +0200

    lib/siphash.h: Apply clang-format 18.1.5

commit da88e9a4443dba37daea123f5e51b18a2611e03b
Merge: b58b3871 1253273f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun May 5 15:21:03 2024 +0200

    Merge pull request #869 from dag-erling/des/non-gnu-sed

    Drop dependency on GNU sed

commit 1253273fe4cfb322efd1834debda84118edff950
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Thu May 2 17:20:26 2024 +0200

    Drop dependency on GNU sed.

    GNU sed supports `-i` (in-place editing) with an optional suffix for the
    backup copy.  Non-GNU implementations also support `-i`, but the suffix
    is not optional.  Replacing all occurrences of naked `-i` with `-i.bak`
    ensures our scripts work equally well with both.

commit b58b38719507f6700dd5a7898d88c36c8b95154a
Merge: c40938db 59295bef
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat May 4 16:06:51 2024 +0200

    Merge pull request #863 from dag-erling/des/fix-xmltest-log

    Don't require dos2unix.

commit c40938dbe02282e5975157b502c47da21350627e
Merge: e0cf7c85 54400c2e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat May 4 16:04:40 2024 +0200

    Merge pull request #870 from dag-erling/des/sizeof-void-p

    Simplify handling of `SIZEOF_VOID_P`

commit 54400c2e0c86acce56e13acc260cc8bf7ee28719
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Fri May 3 01:20:31 2024 +0200

    autotools: Simplify handling of `SIZEOF_VOID_P`.

commit 59295befca67d9af43e5c4338076b7fdde91996a
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Mon Apr 22 16:37:00 2024 +0200

    fix-xmltest-log.sh: Rewrite in pure sed.

    This removes the need for installing dos2unix in development and CI
    environments.

commit e0cf7c85446261fb5d9cd11747b675ca731678ff
Merge: 9cbdb916 2f205773
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri May 3 00:52:18 2024 +0200

    Merge pull request #868 from dag-erling/des/update-ci

    Fix various CI issues

commit 2f2057733f837c4dbfa1c9a770b70b5ab7bc37bc
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Thu May 2 23:17:16 2024 +0200

    github-ci: Drop requirement for GNU coreutils.

commit 58539734545fbd2e271f6cb3f798c253390024cd
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Thu May 2 21:36:16 2024 +0200

    github-ci: Remove obsolete comments referencing Travis CI.

commit 2083722b95e2f6decba4113be3c5fa499de7dcc6
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Wed May 1 12:24:11 2024 +0200

    github-ci: Install docbook-xml.

    Some tests use the xmlwf documentation as sample input.  It is written in
    DocBook, and the tests appear to be failing because they try to fetch it
    at run time, which is not allowed.  Work around this by installing it in
    advance.

commit 26be7c3f117dd7488bfa3091f5cfdc488accff74
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Wed May 1 12:16:29 2024 +0200

    github-ci: Enable exhaustive branch analysis in cppcheck job.

commit d69aee5244a270417fa32535361b966c394a586d
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Wed May 1 11:57:50 2024 +0200

    github-ci: Switch macOS tests over to supported releases.

commit 85e01c40046684d9464637addd62f144b2959ed2
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Wed May 1 11:55:02 2024 +0200

    github-ci: Drop requirement for GNU find.

commit 8e7c117e8ff7ae7ec1224780b95153b61152f748
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Wed May 1 11:54:07 2024 +0200

    github-ci: Don't die if  already exists.

commit 9cbdb916de2a7bd1aa649e55efc38d2426680359
Merge: c82ca17b 73627c74
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed May 1 21:47:08 2024 +0200

    Merge pull request #865 from Ferenc-/fix-define-for-linux-syscall

    Fix `check_c_source_compiles` of `HAVE_SYSCALL_GETRANDOM`

commit 73627c7456db80db5d537f178132978b686c6fb7
Author: Ferenc Géczi <ferenc.gm@gmail.com>
Date:   Sat Apr 27 00:00:01 2024 +0000

    Use feature test macro for syscall prototype

    In order to cover the largest number of glibc and musl libc versions,
    withouth warnings, the decision here is to use `_GNU_SOURCE`,
    even if it enables a larger than necessary feature set.

    A feature macro is needed, because otherwise the `check_c_source_compiles`
    for `HAVE_SYSCALL_GETRANDOM` fails in cases when for example
    the default compiler flags include `-std=c99`:

    ````
    src.c:6:13: error: implicit declaration of function ‘syscall’ [-Wimplicit-function-declaration]
        6 |             syscall(SYS_getrandom, NULL, 0, 0);
          |             ^~~~~~~
    ````
    But this check should pass, as `SYS_getrandom` is available,
    only the declaration of `syscall` in `unistd.h` is conditional behind a macro.

    The exact minimal public macros, for enabling this are in `features.h`, and
    are version dependent.

    According to [5.04](
    https://mirrors.edge.kernel.org/pub/linux/docs/man-pages/Archive/man-pages-5.04.tar.gz)
    and older versions of the `man 2 syscall` page,
    the recommended feature test macro is `_GNU_SOURCE`.
    Later on in [5.05](
    https://mirrors.edge.kernel.org/pub/linux/docs/man-pages/Archive/man-pages-5.05.tar.gz)
    this statement has changed, to provide a smaller minimal feature set.
    Namely up to `glibc 2.18`  is `_BSD_SOURCE || _SVID_SOURCE`,
    but after that the `_DEFAULT_SOURCE` is recommended,
    and `_BSD_SOURCE || _SVID_SOURCE` is deprecated, and emits warning in later versions.
    Regardless of that the `_GNU_SOURCE` is still fully supported
    in every version and is suitable for our purposes.

    The musl libc doesn't use `_SVID_SOURCE` at all, but `_BSD_SOURCE` always works,
    plus in some newer versions `_DEFAULT_SOURCE` also sets `_BSD_SOURCE`,
    but `_GNU_SOURCE` covers the largest set of versions and is unlikely
    to be deprecated in the future.

    Further info about feature test macros:

    In glibc:
    https://www.gnu.org/software/libc/manual/html_node/Feature-Test-Macros.html

    In musl libc under the `Feature Test Macros Supported by musl` section:
    https://musl.libc.org/doc/1.1.24/manual.html

    Signed-off-by: Ferenc Géczi <ferenc.gm@gmail.com>

commit c82ca17b61de7e37d3b748b55b33adfd1a091392
Merge: 1f1ac992 2ddf759f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Apr 30 01:09:12 2024 +0200

    Merge pull request #866 from libexpat/dependabot/github_actions/actions/checkout-4.1.4

    Actions(deps): Bump actions/checkout from 4.1.3 to 4.1.4

commit 1f1ac992bffc4ba2bc123fb020a971c63bf3566d
Merge: a2b44bd2 33ed8172
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Apr 29 22:40:37 2024 +0200

    Merge pull request #867 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.3

    Actions(deps): Bump actions/upload-artifact from 4.3.2 to 4.3.3

commit 33ed8172fb5e70df2f460b90d6d1adad17e64274
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Apr 29 12:06:24 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.3.2 to 4.3.3

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.3.2 to 4.3.3.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/1746f4ab65b179e0ea60a494b83293b640dd5bba...65462800fd760344b1a7b4382951275a0abb4808)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 2ddf759f591fc10ed2241cb5bd77e04f3c66ef67
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Apr 29 12:06:18 2024 +0000

    Actions(deps): Bump actions/checkout from 4.1.3 to 4.1.4

    Bumps [actions/checkout](https://github.com/actions/checkout) from 4.1.3 to 4.1.4.
    - [Release notes](https://github.com/actions/checkout/releases)
    - [Changelog](https://github.com/actions/checkout/blob/main/CHANGELOG.md)
    - [Commits](https://github.com/actions/checkout/compare/1d96c772d19495a3b5c517cd2bc0cb401ea0529f...0ad4b8fadaa221de15dcec353f45205ec38ea70b)

    ---
    updated-dependencies:
    - dependency-name: actions/checkout
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit a2b44bd2d28a6638c1cece06882b093a2fafd05f
Merge: 9134d0d6 abb1c4a3
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Apr 27 23:19:35 2024 +0200

    Merge pull request #864 from dag-erling/des/tests-readme

    tests: Convert README to Markdown and update.

commit abb1c4a3805967febb94d4d375f1be22b5580b5d
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Tue Apr 23 11:28:24 2024 +0200

    tests: Convert README to Markdown and update.

commit 9134d0d6e073ed505f26bdb8c23747961c575e79
Merge: 46062b60 1b6a4f19
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Apr 23 03:17:22 2024 +0200

    Merge pull request #861 from dag-erling/des/mkdir-m4

    Ensure that the m4 directory always exists.

commit 46062b600d1f375c3358492b97273783d0f49df7
Merge: 8fd3e86f 886f7ea7
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Apr 23 03:09:57 2024 +0200

    Merge pull request #862 from dag-erling/des/squiggle

    Protect us against Emacs users.

commit 8fd3e86f28016cad3d4e41ea9cadaf28c180f8b6
Merge: 4c64d111 f16b7aa1
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Apr 22 23:41:55 2024 +0200

    Merge pull request #859 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.2

    Actions(deps): Bump actions/upload-artifact from 4.3.1 to 4.3.2

commit 4c64d11182655fa5c5c916c3ff9ac47be575afc2
Merge: e48ab660 cd363842
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Apr 22 23:40:34 2024 +0200

    Merge pull request #860 from libexpat/dependabot/github_actions/actions/checkout-4.1.3

    Actions(deps): Bump actions/checkout from 4.1.2 to 4.1.3

commit 886f7ea7b7c8dd51b8a6f294009bdd794d399856
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Mon Apr 22 16:37:53 2024 +0200

    Protect us against Emacs users.

commit 1b6a4f19c6f97643b41a0640180084567fca8c2f
Author: Dag-Erling Smørgrav <des@des.dev>
Date:   Mon Apr 22 16:34:07 2024 +0200

    Ensure that the m4 directory always exists.

commit cd363842314fa24c85482796c25b7b3b89f607d5
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Apr 22 12:20:20 2024 +0000

    Actions(deps): Bump actions/checkout from 4.1.2 to 4.1.3

    Bumps [actions/checkout](https://github.com/actions/checkout) from 4.1.2 to 4.1.3.
    - [Release notes](https://github.com/actions/checkout/releases)
    - [Changelog](https://github.com/actions/checkout/blob/main/CHANGELOG.md)
    - [Commits](https://github.com/actions/checkout/compare/9bb56186c3b09b4f86b1c65136769dd318469633...1d96c772d19495a3b5c517cd2bc0cb401ea0529f)

    ---
    updated-dependencies:
    - dependency-name: actions/checkout
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit f16b7aa1ec0e6f394601a99713f2650d8ca08864
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Apr 22 12:20:09 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.3.1 to 4.3.2

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.3.1 to 4.3.2.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/5d5d22a31266ced268874388b861e4b58bb5c2f3...1746f4ab65b179e0ea60a494b83293b640dd5bba)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit e48ab6604f04ee71f311b3e8170379b48ce77c2b
Merge: ef50fb20 d420c32d
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Apr 7 22:30:04 2024 +0200

    Merge pull request #851 from libexpat/autotools-sync-cmake-files

    autotools: Sync CMake templates with CMake 3.27

commit ef50fb208b9b448ae76fbecb464b3c15f2f4e865
Merge: 059a4aa7 26f7cbbf
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Apr 4 18:31:28 2024 +0200

    Merge pull request #855 from libexpat/issue-854-cmake-fix-use-of-check-symbol-exists

    cmake: Fix check for symbols `size_t` and `off_t` (fixes #854)

commit 059a4aa71df6c0f5ef90306db64e2ee546696db7
Merge: 5434a740 13e84bb3
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Apr 4 01:09:38 2024 +0200

    Merge pull request #856 from libexpat/fix-main

    Fix `main()` to `main(void)`

commit 26f7cbbf4abc019fc814fc4e960864c3e7ccea0f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Apr 3 00:44:10 2024 +0200

    cmake: Fix check for symbols `size_t` and `off_t`

    The two issues with the previous approach were that:

    1. `check_symbol_exists` would store "1" or "" into
       variable `off_t` rather than string "off_t", and

    2. (`check_symbol_exists` would not find `off_t` or
       `size_t` on modern Linux).

    Was reported with NetBSD 9.3.

    `size_t` is part of C99 (which Expat requires), so
    only the `off_t` half remains.

commit 5434a74081a39bb43fb95cdec291dbb61cb9acd0
Merge: d450c1b4 2b8492d6
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Apr 3 23:51:03 2024 +0200

    Merge pull request #853 from bluhm/find-path

    Always provide path to find(1) for portability

commit 13e84bb374237fde1815cf0315a8b93c2c46e16b
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Apr 3 02:20:46 2024 +0200

    Fix `main()` to `main(void)`

commit 2b8492d622913829ff69c803acfbe2ae6673f471
Author: Alexander Bluhm <alexander.bluhm@gmx.net>
Date:   Mon Apr 1 22:56:49 2024 +0200

    Always provide path to find.

    Running find without path is a GNU extension.  GNU find uses current
    directory as starting-point in this case.  Better always use an
    explicit . in build scripts to support find on other systems.

commit d420c32d67d1b4829883ad05b9f024b3f4ed649a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Mar 29 22:17:56 2024 +0100

    autotools: Sync CMake templates with CMake 3.27

commit d450c1b439ab56bfd04def5146d2c728666e0f00
Merge: d04f8ef8 2874a26e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Mar 23 19:37:22 2024 +0100

    Merge pull request #741 from libexpat/drop-support-msvc-2017

    [>=2024-04-02] Drop support for Visual Studio 15 2017

commit 2874a26eeb33a2c6f1ad05ef94373d453eaf98d7
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Mar 23 17:52:37 2024 +0100

    win32/build_expat_iss.bat: Add missing "-A Win32" for Visual Studio 16 2019

commit f8fb85ec8c1f3749c3ac8d932ce8909f0051632a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Sep 2 21:33:35 2023 +0200

    Drop support for Visual Studio 15 2017

commit d04f8ef8874c2829b624cb6c832bb5b9f7ce8dc2
Merge: a59c3edf 571a62c8
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Mar 19 22:50:07 2024 +0100

    Merge pull request #850 from libexpat/dependabot/github_actions/actions/checkout-4.1.2

    Actions(deps): Bump actions/checkout from 4.1.1 to 4.1.2

commit 571a62c8f5f979232e96691b29223dbae8bb603b
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Mar 18 12:03:05 2024 +0000

    Actions(deps): Bump actions/checkout from 4.1.1 to 4.1.2

    Bumps [actions/checkout](https://github.com/actions/checkout) from 4.1.1 to 4.1.2.
    - [Release notes](https://github.com/actions/checkout/releases)
    - [Changelog](https://github.com/actions/checkout/blob/main/CHANGELOG.md)
    - [Commits](https://github.com/actions/checkout/compare/b4ffde65f46336ab88eb53be808477a3936bae11...9bb56186c3b09b4f86b1c65136769dd318469633)

    ---
    updated-dependencies:
    - dependency-name: actions/checkout
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit a59c3edffa54a77b8d7b268ef527da541076ca6a
Merge: fa75b965 91116dfa
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Mar 17 23:00:53 2024 +0100

    Merge pull request #849 from libexpat/allow-triggering-github-actions-workflows-manually

    Allow triggering GitHub Actions workflows manually

commit 91116dfa7eabcb0b3e115dd5b028fd0a39caf3b9
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Mar 17 15:28:36 2024 +0100

    Allow triggering GitHub Actions workflows manually

    Some already had "workflow_dispatch" enabled.

commit fa75b96546c069d17b8f80d91e0f4ef0cde3790d
Merge: 5bf8ed66 8548bc03
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Mar 13 17:37:37 2024 +0100

    Merge pull request #843 from libexpat/issue-838-prepare-release

    Prepare release 2.6.2 (part of #838, ETA 2024-03-13)

commit 8548bc03fdb887c8720f01e95440f1406bd15ffa
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Mar 9 16:30:09 2024 +0100

    Changes: Add call for help

commit 86d6052c5ec63fad3ef564cbdef1e1ac3d18f30e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Mar 8 13:17:12 2024 +0100

    Set release date for 2.6.2

commit 13cff445fa383733da1d6011d593d0ecd9d456ab
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Mar 8 13:12:02 2024 +0100

    Bump version to 2.6.2

commit 557f1255f9f431646e27b84b1a2fe63380352b70
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Mar 8 13:07:38 2024 +0100

    Bump version info from 10:1:9 to 10:2:9

    See https://verbump.de/ for what these numbers do

commit 98ee1baef80da27e148e55d4b2ae96143716064f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Mar 8 13:07:00 2024 +0100

    Changes: Document changes in release Expat 2.6.2

commit 5bf8ed66efd5672da960f89fceed3fda92f10cee
Merge: 50262138 c32ed081
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Mar 13 14:22:48 2024 +0100

    Merge pull request #847 from TomasKorbar/doc-makefile

    [2.6.1] Fix DOCBOOK_TO_MAN variable use in doc Makefile

commit c32ed08191f21206ef14c30852f9846ef6977276
Author: Tomas Korbar <tkorbar@redhat.com>
Date:   Wed Mar 13 11:01:52 2024 +0100

    Fix DOCBOOK_TO_MAN variable use in doc Makefile

    Not using quotes causes problems when DOCBOOK_TO_MAN contains
    command and argument

commit 5026213864ba1a11ef03ba2e8111af8654e9404d
Merge: 27525ada 072eca0b
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Mar 7 22:14:09 2024 +0100

    Merge pull request #842 from libexpat/issue-839-billion-laughs-isolated-external-parser

    Prevent billion laughs attacks in isolated external parser (part of #839)

commit 27525adabdac2a48a5ce5d2f5588fce741a0c8e3
Merge: 6bcb9915 565ab44a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Mar 7 20:24:13 2024 +0100

    Merge pull request #841 from libexpat/issue-839-reject-direct-parameter-entity-recursion

    Reject direct parameter entity recursion (part of #839)

commit 072eca0b72373da103ce15f8f62d1d7b52695454
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Mar 5 22:43:03 2024 +0100

    tests: Cover amplification tracking for isolated external parser

commit 1d50b80cf31de87750103656f6eb693746854aa8
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Mar 4 23:49:06 2024 +0100

    lib/xmlparse.c: Detect billion laughs attack with isolated external parser

    When parsing DTD content with code like ..

      XML_Parser parser = XML_ParserCreate(NULL);
      XML_Parser ext_parser = XML_ExternalEntityParserCreate(parser, NULL, NULL);
      enum XML_Status status = XML_Parse(ext_parser, doc, (int)strlen(doc), XML_TRUE);

    .. there are 0 bytes accounted as direct input and all input from `doc` accounted
    as indirect input.  Now function accountingGetCurrentAmplification cannot calculate
    the current amplification ratio as "(direct + indirect) / direct", and it did refuse
    to divide by 0 as one would expect, but it returned 1.0 for this case to indicate
    no amplification over direct input.  As a result, billion laughs attacks from
    DTD-only input were not detected with this isolated way of using an external parser.

    The new approach is to assume direct input of length not 0 but 22 -- derived from
    ghost input "<!ENTITY a SYSTEM 'b'>", the shortest possible way to include an external
    DTD --, and do the usual "(direct + indirect) / direct" math with "direct := 22".

    GitHub issue #839 has more details on this issue and its origin in ClusterFuzz
    finding 66812.

commit 565ab44a42ac1c973fcc2f47ae0a9ba23b6c5f07
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Mar 3 01:35:35 2024 +0100

    tests: Cover rejection of direct parameter entity recursion

commit a4c86a395ee447c59175c762af3d17f7107b2261
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Mar 3 02:19:58 2024 +0100

    lib/xmlparse.c: Reject directly recursive parameter entities

commit 6bcb991574a084b3ed6d79c4ef9d78d14285d85f
Merge: a590b2d5 8f75c536
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Mar 1 20:15:09 2024 +0100

    Merge pull request #837 from libexpat/extend-2-6-1-change-log

    Add missing #821 #824 to 2.6.1 change log

commit 8f75c536158fd480f950925333fcd0730bac0142
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Feb 29 22:09:53 2024 +0100

    Changes: Add missing #821 #824 to 2.6.1 change log

commit a590b2d5846865412182805b853dd91d18f38c8d
Merge: 1cf882e7 58ff7c39
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Feb 29 21:19:01 2024 +0100

    Merge pull request #834 from libexpat/issue-832-prepare-release

    Prepare release 2.6.1 (part of #832, ETA 2024-02-29)

commit 1cf882e79cbacbd68a406b24a3859a12033465fa
Merge: a387201c ea528347
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Feb 29 20:07:11 2024 +0100

    Merge pull request #836 from libexpat/issue-828-expose-billion-laughs-api-with-xml-dtd-without-xml-ge

    Expose billion laughs API with `XML_DTD` without `XML_GE` (fixes #828)

commit 58ff7c39eae53215da9bba028c316ed85348d31b
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 23:52:42 2024 +0100

    Sync file headers

commit fce4b9f3b300a9e5c05f6cd170dce3d4d10fe04a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 23:38:45 2024 +0100

    Set release date for 2.6.1

commit dfe043fe6aa8d35a3fa1d7ea96299f0925fe8114
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 23:43:09 2024 +0100

    Bump version to 2.6.1

commit fbe7b9345b22f9d5cce61735219a253b34504000
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 23:41:24 2024 +0100

    Bump version info from 10:0:9 to 10:1:9

    See https://verbump.de/ for what these numbers do

commit 3dc137ea05a0c108cd89c91ef68d85798920653d
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 23:36:50 2024 +0100

    Changes: Document changes in release Expat 2.6.1

commit ea528347091bf56d4c02858da16ea4eecfb5fb2b
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Feb 28 20:29:47 2024 +0100

    doc/reference.html: Drop inaccurate statement about XML_* macros

    The statement is falsified by these macros:
    - XML_ATTR_INFO
    - XML_DTD
    - XML_GE

commit 1e028f2ef751b366ab2b4b9b682ae5691013e42e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Feb 28 20:44:53 2024 +0100

    lib/expat.h: Expose billion laughs API for XML_DTD without XML_GE

    Regression from commit caa27198637683b15d810737bb8a6a81af19bfa5 .

commit a387201ca4fb68629b09cb2201145f7f004e736c
Merge: 9dcb74f5 0106682e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Feb 28 00:55:34 2024 +0100

    Merge pull request #833 from libexpat/configure-ac-protect-multilib

    `configure.ac`: Protect against `expat_config.h.in` defining `SIZEOF_VOID_P`

commit 0106682ea6be456de3d850f037781d03603ff95e
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 23:12:45 2024 +0100

    configure.ac: Protect against expat_config.h.in defining SIZEOF_VOID_P

commit 9dcb74f552d5f1604c8574665b2b37c8bc52ad2a
Merge: 5b940f4a 7e2a0da9
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 26 21:41:30 2024 +0100

    Merge pull request #829 from libexpat/hide-test-only-code-behind-new-macro

    Hide test-only code behind new (internal) macro `XML_TESTING` (alternative to #826)

commit 7e2a0da9ba6581c073484ff400a98fd4037b5c73
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Feb 21 12:53:48 2024 +0100

    lib: Hide some test-only code behind new macro XML_TESTING

commit a4a420eedcc5426f67b8ed64bbf88f70fce53963
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Feb 21 12:53:03 2024 +0100

    Autotools: Turn libexpatinternal.la into standalone library

    .. so that we can now have code in say xmlparse.c that does not
    end up in libexpat.so but still runs when executing the test suite.

commit 5b940f4a650bd1d1d04dd1280d6e920547f0c580
Merge: b7e1a110 0f6b39d2
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 20 20:40:41 2024 +0100

    Merge pull request #824 from libexpat/issue-821-improve-make-clean-for-configure-without-docbook

    Autotools: Re-work handling of xmlwf.1 (fixes #821)

commit 0f6b39d2f513aae16c7377fc802c25ab81551c42
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 13 19:42:04 2024 +0100

    Autotools: Re-work handling of xmlwf.1

    File "doc/xmlwf.1" should not be cleaned when building with
    "./configure --without-docbook", and re-compilation of the file
    should take precedence over a pre-built copy where available.

    Also, variable CLEANFILES can be used to simplify things a bit
    in Makefile.am.

commit b7e1a1101133725c79e2170b0870cca8543e5323
Merge: 4ff4c544 dc8499f2
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 13 18:30:35 2024 +0100

    Merge pull request #817 from SonyMobile/clockless-test

    tests: Replace clock counting with counting scanned bytes

commit dc8499f295bcb5e0b1ff89aa3ca5ca65ddb4ca7b
Author: Snild Dolkow <snild@sony.com>
Date:   Wed Feb 7 13:00:45 2024 +0100

    tests: Replace clock counting with scanned bytes in linear-time test

    This removes the dependency on CLOCKS_PER_SEC that prevented this test
    from running properly on some platforms, as well as the inherent
    flakiness of time measurements.

    Since later commits have introduced g_bytesScanned (and before that,
    g_parseAttempts), we can use that value as a proxy for parse time
    instead of clock().

commit fe0177cd3fe73ab2ad2e5e749a6badbbd7ec1d83
Author: Snild Dolkow <snild@sony.com>
Date:   Wed Feb 7 12:57:19 2024 +0100

    tests: Replace g_parseAttempts with g_bytesScanned

    This was used to estimate the number of scanned bytes. Just exposing
    that number directly will be more precise.

commit 4ff4c544aa2a3912afb2735d31681dfefe8a732e
Merge: 226201d1 aed1ed76
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Feb 12 14:52:18 2024 +0100

    Merge pull request #820 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.1

    Actions(deps): Bump actions/upload-artifact from 4.3.0 to 4.3.1

commit aed1ed769d01ee9e616286282d3447094f608237
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Feb 12 12:09:58 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.3.0 to 4.3.1

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.3.0 to 4.3.1.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/26f96dfa697d77e81fd5907df203aa23a56210a8...5d5d22a31266ced268874388b861e4b58bb5c2f3)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-patch
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 226201d10dd63e4995955b6d43c96e71437f19ca
Merge: 4033d6dc 3f60a47c
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sun Feb 11 16:45:16 2024 +0100

    Merge pull request #819 from th1722/patch-1

    Fix compiler warnings

commit 3f60a47cb5716bb810789a12ef6024c1dc448164
Author: Taichi Haradaguchi <20001722@ymail.ne.jp>
Date:   Fri Feb 9 19:28:35 2024 +0900

    Fix compiler warnings

    > In file included from ./../lib/internal.h:149,
    >                  from codepage.c:38:
    > ./../lib/expat.h:1045:5: warning: "XML_GE" is not defined, evaluates to 0 [-Wundef]
    >  1045 | #if XML_GE == 1
    >       |     ^~~~~~
    > ./../lib/internal.h:158:5: warning: "XML_GE" is not defined, evaluates to 0 [-Wundef]
    >   158 | #if XML_GE == 1
    >       |     ^~~~~~

commit 4033d6dc5797eca420bb1e109a89a3953e50036e
Merge: 849da3e3 d4f958e3
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Feb 8 17:24:26 2024 +0100

    Merge pull request #818 from libexpat/fix-clang-format-ci

    Get clang-format CI back in sync

commit d4f958e345163a6028f69c0efa2f62f5189845be
Author: clang-format 18.1.0 <clang-format@tool.invalid>
Date:   Thu Feb 8 15:18:43 2024 +0100

    Mass-apply clang-format 18.1.0

commit 849da3e3fe727fccef5e96ef35482d66447f06a2
Merge: 8198e4bf 2a10e173
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 17:49:41 2024 +0100

    Merge pull request #776 from libexpat/issue-775-prepare-release

    Prepare release 2.6.0 (part of #775, ETA is 2024-02-07)

commit 2a10e173ab6a2468ee47b9426fce274168e4ea66
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 14:13:00 2024 +0100

    Sync file headers

commit 92f10eb800bac5477010eb4dc32005e698ba406a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 12:32:08 2024 +0100

    .mailmap: Add Joyce Brum and Owain Davies

commit b5ae2481b0dcd8e682fcdd7f378506e1f4901ecd
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Feb 2 19:31:02 2024 +0100

    Set release date for 2.6.0

commit 310a1977f471b6211a37c7d73e05c1a26eeaa9df
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Feb 2 19:27:52 2024 +0100

    Bump version to 2.6.0

commit b9fd46523161147c12468f8e1da2cd0235518228
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Feb 2 19:23:22 2024 +0100

    Bump version info from 9:10:8 to 10:0:9

    See https://verbump.de/ for what these numbers do

commit ae06168b64e7520b0adaa2a8b7f9837df187a17a
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Oct 21 18:07:47 2023 +0200

    Changes: Document changes in release Expat 2.6.0

commit 8198e4bfede103c11ededa0167b634d0e88c7f77
Merge: 9944b712 9c16d1c5
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 11:09:42 2024 +0100

    Merge pull request #815 from libexpat/fix-pkg-config-file-for-static-build-on-windows

    pkg-config: Add missing `-DXML_STATIC` for Windows (alternative to #805)

commit 9c16d1c5b4959bed843bc0f1d065ad25a5e1b778
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 00:10:09 2024 +0100

    pkg-config: Add missing -DXML_STATIC (for Windows)

    This affects the output of command "pkg-config --cflags --static expat".

commit 9944b71234d96d529cff01a80b52776d974838fd
Merge: b6243248 bc7490a4
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 00:16:23 2024 +0100

    Merge pull request #813 from libexpat/issue-812-protect-against-closing-entities-out-of-order

    Protect against closing entities out of order (fixes #812)

commit b6243248a97026aacdf343a2bab7af53e66e1ea2
Merge: 127aa340 aba268e2
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Feb 6 00:00:00 2024 +0100

    Merge pull request #814 from libexpat/fix-make-check-for-arm64-freebsd

    tests: Fix `CLOCKS_PER_SEC` guard for arm64 FreeBSD reality

commit aba268e2c00069818a60809aed986d993f8dd397
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Feb 2 17:50:43 2024 +0100

    tests/basic_tests.c: Fix CLOCKS_PER_SEC guard for arm64 FreeBSD reality

    CLOCKS_PER_SEC turned out to be as small as 128 in practice
    on machine cfarm240.cfarm.net .

commit 127aa340d3435ba0e83ee643362419e3486eb5a1
Merge: 34b598c5 7352d303
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Wed Jan 31 01:49:59 2024 +0100

    Merge pull request #809 from libexpat/clang-format-18

    CI: Upgrade to clang-format 18

commit 7352d3035bb7881fc87e596b754e46bf35136ca9
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Jan 30 22:58:48 2024 +0100

    clang-*.yml: Fix accidental trailing whitespace

commit 37d018478161ad932405da7181af80ca9e52909c
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Jan 26 15:51:17 2024 +0100

    clang-format.yml: Bump to clang-format 18

commit 137a57808748d799558a88056a4aef4d04994320
Author: clang-format 18.1.0 <clang-format@tool.invalid>
Date:   Sat Jan 27 19:24:45 2024 +0100

    Mass-apply clang-format 18.1.0

commit c594eedfa802f85df3d2226b25ace52b902a63f4
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jan 27 19:21:13 2024 +0100

    apply-clang-format.sh: Drop workaround for lib/siphash.h

    Does not seem needed anymore (or running the script would
    produce a diff).

commit 5d2a438af25e16297c1681539fe6d19852327320
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Sat Jan 27 19:17:25 2024 +0100

    apply-clang-format.sh: Use "git ls-files" rather than "find"

    .. and reduce difference with sibling script apply-clang-tidy.sh .

commit 34b598c5f594b015c513c73f06e7ced3323edbf1
Merge: 2becc8a8 d5b02e96
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Jan 30 22:54:37 2024 +0100

    Merge pull request #789 from SonyMobile/partial-token-perf

    Speed up parsing of big tokens

commit bc7490a4a79ab9302d9c76dcad8c0ce88f43d93f
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Jan 29 21:37:16 2024 +0100

    tests/misc_tests.c: Add regression test for closing entities out of order

commit c4208e7fd1aecb82dc9a44918df7134594560df5
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Tue Jan 30 01:34:43 2024 +0100

    lib/xmlparse.c: Protect against closing entities out of order

commit d5b02e96ab95d2a7ae0aea72d00054b9d036d76d
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Nov 9 19:28:05 2023 +0100

    xmlwf: Document argument "-q"

    Rebased-and-adapted-by: Snild Dolkow <snild@sony.com>

commit 09fdf998e7cf3f8f9327e6602077791095aedd4d
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Thu Nov 9 19:14:14 2023 +0100

    xmlwf: Support disabling reparse deferral

    Rebased-and-adapted-by: Snild Dolkow <snild@sony.com>

commit 8f8aaf5c8e8a6e812dd8dadd96cf9bd044bc085a
Author: Snild Dolkow <snild@sony.com>
Date:   Fri Nov 24 16:31:56 2023 +0100

    tests: Check heuristic bypass with varying buffer fill sizes

    The bypass works on the assumption that the application uses a
    consistent fill size. Let's make some assertions about what should
    happen when the application doesn't do that -- most importantly,
    that parsing does happen eventually, and that the number of scanned
    bytes doesn't explode.

commit 182bbc350ed8b3c547133a9a44a4f30a0ba3b77e
Author: Snild Dolkow <snild@sony.com>
Date:   Mon Jan 29 16:43:32 2024 +0100

    tests: Make it clear to clang-tidy that assert_true may not return

    The key is to have __attribute__((noreturn)) somewhere that clang-tidy
    can see it. In this case, this is the _fail() function, which is
    conditionally called from the assert_true() macro.

    This will ensure that clang-tidy doesn't complain about NULL values
    that we've asserted against in tests.

commit 2becc8a81d9694bdfb5810eeafee50050d55b43a
Merge: 183270d5 b04a01d4
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Mon Jan 29 17:58:59 2024 +0100

    Merge pull request #811 from libexpat/dependabot/github_actions/actions/upload-artifact-4.3.0

    Actions(deps): Bump actions/upload-artifact from 4.2.0 to 4.3.0

commit 3d8141d26a3b01ff948e00956cb0723a89dadf7f
Author: Snild Dolkow <snild@sony.com>
Date:   Mon Nov 20 16:11:24 2023 +0100

    Bypass partial token heuristic when nearing full buffer

    ...instead of only when approaching the maximum buffer size INT/2+1.

    We'd like to give applications a chance to finish parsing a large token
    before buffer reallocation, in case the reallocation fails.

    By bypassing the reparse deferral heuristic when getting close to the
    filling the buffer, we give them this chance -- if the whole token is
    present in the buffer, it will be parsed at that time.

    This may come at the cost of some extra reparse attempts. For a token
    of n bytes, these extra parses cause us to scan over a maximum of
    2n bytes (... + n/8 + n/4 + n/2 + n). Therefore, parsing of big tokens
    remains O(n) in regard how many bytes we scan in attempts to parse. The
    cost in reality is lower than that, since the reparses that happen due
    to the bypass will affect m_partialTokenBytesBefore, delaying the next
    ratio-based reparse. Furthermore, only the first token that "breaks
    through" a buffer ceiling takes that extra reparse attempt; subsequent
    large tokens will only bypass the heuristic if they manage to hit the
    new buffer ceiling.

    Note that this cost analysis depends on the assumption that Expat grows
    its buffer by doubling it (or, more generally, grows it exponentially).
    If this changes, the cost of this bypass may increase. Hopefully, this
    would be caught by test_big_tokens_take_linear_time or the new test.

    The bypass logic assumes that the application uses a consistent fill.
    If the app increases its fill size, it may miss the bypass (and the
    normal heuristic will apply). If the app decreases its fill size, the
    bypass may be hit multiple times for the same buffer size. The very
    worst case would be to always fill half of the remaining buffer space,
    in which case parsing of a large n-byte token becomes O(n log n).

    As an added bonus, the new test case should be faster than the old one,
    since it doesn't have to go all the way to 1GiB to check the behavior.

    Finally, this change necessitated a small modification to two existing
    tests related to reparse deferral. These tests are testing the deferral
    enabled setting, and assume that reparsing will not happen for any other
    reason. By pre-growing the buffer, we make sure that this new deferral
    does not affect those test cases.

commit 60b74209899a67d426d208662674b55a5eed918c
Author: Snild Dolkow <snild@sony.com>
Date:   Wed Oct 4 16:00:14 2023 +0200

    Bypass partial token heuristic when close to maximum buffer size

    For huge tokens, we may end up in a situation where the partial token
    parse deferral heuristic demands more bytes than Expat's maximum buffer
    size (currently ~half of INT_MAX) could fit.

    INT_MAX/2 is 1024 MiB on most systems. Clearly, a token of 950 MiB could
    fit in that buffer, but the reparse threshold might be such that
    callProcessor() will defer it, allowing the app to keep filling the
    buffer until XML_GetBuffer() eventually returns a memory error.

    By bypassing the heuristic when we're getting close to the maximum
    buffer size, it will once again be possible to parse tokens in the size
    range INT_MAX/2/ratio < size < INT_MAX/2 reliably.

    We subtract the last buffer fill size as a way to detect that the next
    XML_GetBuffer() call has a risk of returning a memory error -- assuming
    that the application is likely to keep using the same (or smaller) fill.

    We subtract XML_CONTEXT_BYTES because that's the maximum amount of bytes
    that could remain at the start of the buffer, preceding the partial
    token. Technically, it could be fewer bytes, but XML_CONTEXT_BYTES is
    normally small relative to INT_MAX, and is much simpler to use.

    Co-authored-by: Sebastian Pipping <sebastian@pipping.org>

commit ad9c01be8ee5d3d5cac2bfd3949ad764541d35e7
Author: Snild Dolkow <snild@sony.com>
Date:   Thu Oct 26 13:55:02 2023 +0200

    Make external entity parser inherit partial token heuristic setting

    The test is essentially a copy of the existing test for the setter,
    adapted to run on the external parser instead of the original one.

    Suggested-by: Sebastian Pipping <sebastian@pipping.org>
    CI-fighting-assistance-by: Sebastian Pipping <sebastian@pipping.org>

commit 8ddd8e86aa446d02eb8d398972d3b10d4cad908a
Author: Snild Dolkow <snild@sony.com>
Date:   Fri Sep 29 10:14:59 2023 +0200

    Try to parse even when incoming len is zero

    If the reparse deferral setting has changed, it may be possible to
    finish a token.

commit 1d3162da8a85a398ab451aadd6c2ad19587e5a68
Author: Snild Dolkow <snild@sony.com>
Date:   Mon Sep 11 15:31:24 2023 +0200

    Add app setting for enabling/disabling reparse heuristic

    Suggested-by: Sebastian Pipping <sebastian@pipping.org>
    CI-fighting-assistance-by: Sebastian Pipping <sebastian@pipping.org>

commit 09957b8ced725b96a95acff150facda93f03afe1
Author: Snild Dolkow <snild@sony.com>
Date:   Thu Oct 26 10:41:00 2023 +0200

    Allow XML_GetBuffer() with len=0 on a fresh parser

    len=0 was previously OK if there had previously been a non-zero call.
    It makes sense to allow an application to work the same way on a
    newly-created parser, and not have to care if its incoming buffer
    happens to be 0.

commit f1eea784d0429bc4813a3d66a8e24e6c9df56be7
Author: Snild Dolkow <snild@sony.com>
Date:   Mon Nov 6 09:22:48 2023 +0100

    tests: Add max_slowdown info in test_big_tokens_take_linear_time

    Suggested-by: Sebastian Pipping <sebastian@pipping.org>

commit 9fe3672459c1bf10926b85f013aa1b623d855545
Author: Snild Dolkow <snild@sony.com>
Date:   Mon Sep 18 20:32:55 2023 +0200

    tests: Run both with and without partial token heuristic

    If we always run with the heuristic enabled, it may hide some bugs by
    grouping up input into bigger parse attempts.

    CI-fighting-assistance-by: Sebastian Pipping <sebastian@pipping.org>

commit 1b9d398517befeb944cbbadadf10992b07e96fa2
Author: Snild Dolkow <snild@sony.com>
Date:   Mon Sep 4 17:21:14 2023 +0200

    Don't update partial token heuristic on error

    Suggested-by: Sebastian Pipping <sebastian@pipping.org>

commit 9cdf9b8d77d5c2c2a27d15fb68dd3f83cafb45a1
Author: Snild Dolkow <snild@sony.com>
Date:   Thu Aug 17 16:25:26 2023 +0200

    Skip parsing after repeated partials on the same token

    When the parse buffer contains the starting bytes of a token but not
    all of them, we cannot parse the token to completion. We call this a
    partial token.  When this happens, the parse position is reset to the
    start of the token, and the parse() call returns. The client is then
    expected to provide more data and call parse() again.

    In extreme cases, this means that the bytes of a token may be parsed
    many times: once for every buffer refill required before the full token
    is present in the buffer.

    Math:
      Assume there's a token of T bytes
      Assume the client fills the buffer in chunks of X bytes
      We'll try to parse X, 2X, 3X, 4X ... until mX == T (technically >=)
      That's (m²+m)X/2 = (T²/X+T)/2 bytes parsed (arithmetic progression)
      While it is alleviated by larger refills, this amounts to O(T²)

    Expat grows its internal buffer by doubling it when necessary, but has
    no way to inform the client about how much space is available. Instead,
    we add a heuristic that skips parsing when we've repeatedly stopped on
    an incomplete token. Specifically:

     * Only try to parse if we have a certain amount of data buffered
     * Every time we stop on an incomplete token, double the threshold
     * As soon as any token completes, the threshold is reset

    This means that when we get stuck on an incomplete token, the threshold
    grows exponentially, effectively making the client perform larger buffer
    fills, limiting how many times we can end up re-parsing the same bytes.

    Math:
      Assume there's a token of T bytes
      Assume the client fills the buffer in chunks of X bytes
      We'll try to parse X, 2X, 4X, 8X ... until (2^k)X == T (or larger)
      That's (2^(k+1)-1)X bytes parsed -- e.g. 15X if T = 8X
      This is equal to 2T-X, which amounts to O(T)

    We could've chosen a faster growth rate, e.g. 4 or 8. Those seem to
    increase performance further, at the cost of further increasing the
    risk of growing the buffer more than necessary. This can easily be
    adjusted in the future, if desired.

    This is all completely transparent to the client, except for:
    1. possible delay of some callbacks (when our heuristic overshoots)
    2. apps that never do isFinal=XML_TRUE could miss data at the end

    For the affected testdata, this change shows a 100-400x speedup.
    The recset.xml benchmark shows no clear change either way.

    Before:
    benchmark -n ../testdata/largefiles/recset.xml 65535 3
      3 loops, with buffer size 65535. Average time per loop: 0.270223
    benchmark -n ../testdata/largefiles/aaaaaa_attr.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 15.033048
    benchmark -n ../testdata/largefiles/aaaaaa_cdata.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.018027
    benchmark -n ../testdata/largefiles/aaaaaa_comment.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 11.775362
    benchmark -n ../testdata/largefiles/aaaaaa_tag.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 11.711414
    benchmark -n ../testdata/largefiles/aaaaaa_text.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.019362

    After:
    ./run.sh benchmark -n ../testdata/largefiles/recset.xml 65535 3
      3 loops, with buffer size 65535. Average time per loop: 0.269030
    ./run.sh benchmark -n ../testdata/largefiles/aaaaaa_attr.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.044794
    ./run.sh benchmark -n ../testdata/largefiles/aaaaaa_cdata.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.016377
    ./run.sh benchmark -n ../testdata/largefiles/aaaaaa_comment.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.027022
    ./run.sh benchmark -n ../testdata/largefiles/aaaaaa_tag.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.099360
    ./run.sh benchmark -n ../testdata/largefiles/aaaaaa_text.xml 4096 3
      3 loops, with buffer size 4096. Average time per loop: 0.017956

commit 60dffa148c3ce26799cb933afdb0dc3581ad2098
Author: Snild Dolkow <snild@sony.com>
Date:   Wed Nov 15 15:54:37 2023 +0100

    tests: Use normal XML_Parse in test_suspend_resume_internal_entity

    When the parser is suspended, _XML_Parse_SINGLE_BYTES() will return
    early. At that point, there could be some amount of bytes that haven't
    been fed into Expat at all yet. This leaves us with an incomplete
    document.

    Furthermore, the last internal XML_Parse() call with isFinal=XML_TRUE
    will not have happened, so the parser will not know that no more input
    is to be expected. This is what allowed the test to pass when it was
    originally changed to use SINGLE_BYTES.

    With the new partial token heuristic, the lack of a final parse call
    means that we don't even reach the "Ho" text, and fail the test.

    The simplest solution is to go back to using XML_Parse() in this test.
    Another option would be to let SINGLE_BYTES expose how far it got in
    its loop, allowing for later continuation, but it doesn't seem worth the
    extra complexity.

commit 3484383fa75e0ea2aa716360088813c3b205b261
Author: Snild Dolkow <snild@sony.com>
Date:   Thu Aug 17 16:53:12 2023 +0200

    Add aaaaaa_*.xml with unreasonably large tokens

    Some of these currently take a very long time to parse. I set those to
    only run one loop in the run-benchmark make target.

    4096 may be a fairly small buffer, and definitely make the problem worse
    than it otherwise would've been, but similar sizes exist in real code:

     * 2048 bytes in cpython Modules/pyexpat.c
     * 4096 bytes in skia SkXMLParser.cpp
     * BUFSIZ bytes (8192 on my machine) in expat/examples

    The files, too, are inspired by real-life examples: Android stores
    depth and gain maps as base64-encoded JPEGs inside the XMP data of
    other JPEGs. Sometimes as a text element, sometimes as an attribute
    value. I've seen attribute values slightly over 5 MiB in size.

commit b04a01d43108d891bb475a362e861570c3ef6857
Author: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Date:   Mon Jan 29 12:14:39 2024 +0000

    Actions(deps): Bump actions/upload-artifact from 4.2.0 to 4.3.0

    Bumps [actions/upload-artifact](https://github.com/actions/upload-artifact) from 4.2.0 to 4.3.0.
    - [Release notes](https://github.com/actions/upload-artifact/releases)
    - [Commits](https://github.com/actions/upload-artifact/compare/694cdabd8bdb0f10b2cea11669e1bf5453eed0a6...26f96dfa697d77e81fd5907df203aa23a56210a8)

    ---
    updated-dependencies:
    - dependency-name: actions/upload-artifact
      dependency-type: direct:production
      update-type: version-update:semver-minor
    ...

    Signed-off-by: dependabot[bot] <support@github.com>

commit 183270d5654b7376fbc7b34bc2101c7898d7dee2
Merge: f7ada131 6880fe49
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Jan 26 19:10:31 2024 +0100

    Merge pull request #810 from libexpat/clang-18

    CI: Upgrade to Clang 18 (except clang-tidy and clang-format)

commit f7ada131b775e850e3a31a202c3fb410a1c6d379
Merge: abd9542b 7acda8d1
Author: Sebastian Pipping <sebastian@pipping.org>
Date:   Fri Jan 26 18:30:17 2024 +0100

    Merge pull request #808 from libexpat/clang-tidy-18

    CI: Upgrade to clang-tidy 18

commit 6880fe4948121ad121ea3341f4c0f8ab082139d0
Author: Sebastian Pipping <sebastian@pippi…
```

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=40&u=89efa37b8b3dbc2796e254fa444f3b64cae02242&v=4)](/hartwork)
[hartwork](/hartwork)
mentioned this pull request
[Nov 25, 2024](#ref-issue-2692394069)

[Changes in XML parser from expat version before 2.6.3?
#929](/libexpat/libexpat/issues/929)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Flibexpat%2Flibexpat%2Fpull%2F789)

Reviewers

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=40&v=4)](/hartwork) [hartwork](/hartwork)

hartwork approved these changes

Assignees

No one assigned

Labels

[enhancement](/libexpat/libexpat/labels/enhancement)
[security](/libexpat/libexpat/labels/security)

Projects

None yet

Milestone

 [**2.6.0**](/libexpat/libexpat/milestone/27 "2.6.0")

Development

Successfully merging this pull request may close these issues.

8 participants

[![@Snild-Sony](https://avatars.githubusercontent.com/u/18738465?s=52&v=4)](/Snild-Sony) [![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=52&v=4)](/hartwork) [![@serhiy-storchaka](https://avatars.githubusercontent.com/u/3659035?s=52&v=4)](/serhiy-storchaka) [![@kraptor](https://avatars.githubusercontent.com/u/7249728?s=52&v=4)](/kraptor) [![@lixiaoshuai666](https://avatars.githubusercontent.com/u/17995575?s=52&v=4)](/lixiaoshuai666) [![@PshySimon](https://avatars.githubusercontent.com/u/31642968?s=52&v=4)](/PshySimon) [![@shreyaskulkarni-1](https://avatars.githubusercontent.com/u/90887302?s=52&v=4)](/shreyaskulkarni-1) [![@AB-xdev](https://avatars.githubusercontent.com/u/45384811?s=52&v=4)](/AB-xdev)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

