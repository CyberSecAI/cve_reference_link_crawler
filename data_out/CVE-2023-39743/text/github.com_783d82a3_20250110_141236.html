
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpete4abw%2Flrzip-next%2Fissues%2F132)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpete4abw%2Flrzip-next%2Fissues%2F132)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=pete4abw%2Flrzip-next)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[pete4abw](/pete4abw)
/
**[lrzip-next](/pete4abw/lrzip-next)**
Public

* [Notifications](/login?return_to=%2Fpete4abw%2Flrzip-next) You must be signed in to change notification settings
* [Fork
  10](/login?return_to=%2Fpete4abw%2Flrzip-next)
* [Star
   51](/login?return_to=%2Fpete4abw%2Flrzip-next)

* [Code](/pete4abw/lrzip-next)
* [Issues
  2](/pete4abw/lrzip-next/issues)
* [Pull requests
  0](/pete4abw/lrzip-next/pulls)
* [Discussions](/pete4abw/lrzip-next/discussions)
* [Actions](/pete4abw/lrzip-next/actions)
* [Projects
  0](/pete4abw/lrzip-next/projects)
* [Wiki](/pete4abw/lrzip-next/wiki)
* [Security](/pete4abw/lrzip-next/security)
* [Insights](/pete4abw/lrzip-next/pulse)

Additional navigation options

* [Code](/pete4abw/lrzip-next)
* [Issues](/pete4abw/lrzip-next/issues)
* [Pull requests](/pete4abw/lrzip-next/pulls)
* [Discussions](/pete4abw/lrzip-next/discussions)
* [Actions](/pete4abw/lrzip-next/actions)
* [Projects](/pete4abw/lrzip-next/projects)
* [Wiki](/pete4abw/lrzip-next/wiki)
* [Security](/pete4abw/lrzip-next/security)
* [Insights](/pete4abw/lrzip-next/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fpete4abw%2Flrzip-next%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fpete4abw%2Flrzip-next%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Read zero page memory #132

Closed

[huanglei3](/huanglei3) opened this issue
Aug 5, 2023
· 1 comment

Closed

# [Read zero page memory](#top) #132

[huanglei3](/huanglei3) opened this issue
Aug 5, 2023
· 1 comment

Assignees
[![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=40&v=4)](/pete4abw)

Labels
[bug](/pete4abw/lrzip-next/labels/bug)

## Comments

[![@huanglei3](https://avatars.githubusercontent.com/u/42806521?s=80&v=4)](/huanglei3)

Copy link

### **[huanglei3](/huanglei3)** commented [Aug 5, 2023](#issue-1837526801)

| lrzip-next Version lzma 23.01(default) lrzip-next command line ./lrzip-next -vvt file What happened? ./lrzip-next -vvt poc The following options are in effect for this INTEGRITY TEST. Threading is ENABLED. Number of CPUs detected: 4 Detected 8,287,764,480 bytes ram Nice Value: 19 Show Progress Max Verbose Test file integrity Temporary Directory set as: /tmp/ Malloced 2,762,588,160 for tmp\_outbuf Detected lrzip version 0.6 file. MD5 being used for integrity testing. Validating file for consistency...[OK] Detected lrzip version 0.6 file. Decompressing... Reading chunk\_bytes at 24 Expected size: 8,324,128 Chunk byte width: 2 Reading eof flag at 25 EOF: 1 Reading expected chunksize at 26 Chunk size: 4,096 Reading stream 0 header at 29 Reading stream 1 header at 36 Reading ucomp header at 43 Fill\_buffer stream 0 c\_len 2 u\_len 10 last\_head 0 Starting thread 0 to decompress 2 bytes from stream 0 AddressSanitizer:DEADLYSIGNAL ==3820161==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000008 (pc 0x7f367294d769 bp 0x000000000002 sp 0x7f35c9cee600 T1) ==3820161==The signal is caused by a READ memory access. ==3820161==Hint: address points to the zero page. #0 0x7f367294d768 in bz3\_decode\_block src/libbz3.c:619 [#1](https://github.com/pete4abw/lrzip-next/issues/1) 0x5647df109fe8 in bzip3\_decompress\_buf /home/tanzheng/fuzz\_zip\_next/lrzip-next/src/stream.c:632 [#2](https://github.com/pete4abw/lrzip-next/issues/2) 0x5647df109fe8 in ucompthread /home/tanzheng/fuzz\_zip\_next/lrzip-next/src/stream.c:1918 [#3](https://github.com/pete4abw/lrzip-next/issues/3) 0x7f367280e608 in start\_thread /build/glibc-SzIz7B/glibc-2.31/nptl/pthread\_create.c:477 [#4](https://github.com/pete4abw/lrzip-next/issues/4) 0x7f36723e5132 in \_\_clone (/lib/x86\_64-linux-gnu/libc.so.6+0x11f132)  AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV src/libbz3.c:619 in bz3\_decode\_block Thread T1 created by T0 here: #0 0x7f3672ad7815 in \_\_interceptor\_pthread\_create ../../../../src/libsanitizer/asan/asan\_interceptors.cc:208 [#1](https://github.com/pete4abw/lrzip-next/issues/1) 0x5647df10edb9 in create\_pthread /home/tanzheng/fuzz\_zip\_next/lrzip-next/src/stream.c:145  ==3820161==ABORTING What was expected behavior? work well Steps to reproduce 1.install bzip3 2.install lrzip-next 3.exec:./lrzip-next -vvt poc Relevant log output *No response* Please provide system details OS Distro: Kernel Version (uname -a): Linux ubuntu 5.15.0-78-generic [#85](https://github.com/pete4abw/lrzip-next/pull/85)~20.04.1-Ubuntu SMP Mon Jul 17 09:42:39 UTC 2023 x86\_64 x86\_64 x86\_64 GNU/Linux System ram (free -h): total used free shared buff/cache available Mem: 7.7Gi 4.8Gi 546Mi 4.0Mi 2.4Gi 2.6Gi Swap: 2.0Gi 1.0Mi 2.0Gi Additional Context you can download poc file from this link : <https://github.com/huanglei3/lrzip-next-poc/tree/main> |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@huanglei3](https://avatars.githubusercontent.com/u/42806521?s=40&v=4)](/huanglei3)
[huanglei3](/huanglei3)
added
the
[bug](/pete4abw/lrzip-next/labels/bug)
label
[Aug 5, 2023](#event-10014188905)

[![@huanglei3](https://avatars.githubusercontent.com/u/42806521?s=40&v=4)](/huanglei3)
[huanglei3](/huanglei3)
assigned [pete4abw](/pete4abw)
[Aug 5, 2023](#event-10014188921)

[![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=80&u=3a314b9dd5df99d938f84682f8ddbaa4a7c72dff&v=4)](/pete4abw)

Copy link

Owner

### **[pete4abw](/pete4abw)** commented [Aug 5, 2023](#issuecomment-1666478665)

| While I normally do not like to deal with files that `lrzip-next` did not create, this bug was interesting. The macro `unlikely(v1)` and `unlikely(v2)` macros did not function as predicted. This fix deals with your issue. We struggled over the years with protecting against bad data and this is one more fix...  ``` diff --git a/src/stream.c b/src/stream.c index 9d74383..00dd660 100644 --- a/src/stream.c +++ b/src/stream.c @@ -1491,11 +1491,12 @@ again:                                 print_err("Wrong password?\n");                         goto failed;                 } -               if (unlikely(v1)) { +               /* protect again 0 length c_ and u_ len */ +               if (v1 < 1) {                         print_err("Unexpected initial c_len %'"PRId64" in streams %'"PRId64"\n", v1, v2);                         goto failed;                 } -               if (unlikely(v2)) { +               if (v2 < 1) {                         print_err("Unexpected initial u_len %'"PRId64" in streams\n", v2);                         goto failed;                 }  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=40&u=3a314b9dd5df99d938f84682f8ddbaa4a7c72dff&v=4)](/pete4abw)
[pete4abw](/pete4abw)
closed this as [completed](/pete4abw/lrzip-next/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[4fe3dde](/pete4abw/lrzip-next/commit/4fe3dde35e51608ae4c10c321b51645703dc7e13)`
[Aug 5, 2023](#event-10015070857)

[![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=40&u=3a314b9dd5df99d938f84682f8ddbaa4a7c72dff&v=4)](/pete4abw)
[pete4abw](/pete4abw)
mentioned this issue
[Aug 5, 2023](#ref-issue-1831061476)

[Huanglei3 reported a bug in lrzip that is not duplicated here
#131](/pete4abw/lrzip-next/issues/131)

Closed

[pete4abw](/pete4abw)
added a commit
that referenced
this issue
[Aug 17, 2023](#ref-commit-8f8ba5e)
[![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=40&u=3a314b9dd5df99d938f84682f8ddbaa4a7c72dff&v=4)](/pete4abw)

`[Correct fix for](/pete4abw/lrzip-next/commit/8f8ba5edaecba5e978cbfa2cf378fd35d451576a "Correct fix for #132 that caused decompress and test to fail.") [#132](https://github.com/pete4abw/lrzip-next/issues/132) [that caused decompress and test to fail.](/pete4abw/lrzip-next/commit/8f8ba5edaecba5e978cbfa2cf378fd35d451576a "Correct fix for #132 that caused decompress and test to fail.")`

`[8f8ba5e](/pete4abw/lrzip-next/commit/8f8ba5edaecba5e978cbfa2cf378fd35d451576a)`

[pete4abw](/pete4abw)
added a commit
that referenced
this issue
[Aug 17, 2023](#ref-commit-7d7b656)
[![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=40&u=3a314b9dd5df99d938f84682f8ddbaa4a7c72dff&v=4)](/pete4abw)

`[Correct fix for](/pete4abw/lrzip-next/commit/7d7b656bd93f309bef75d7bd65be9ca64b700ec2 "Correct fix for #132 that caused decompress and test to fail.") [#132](https://github.com/pete4abw/lrzip-next/issues/132) [that caused decompress and test to fail.](/pete4abw/lrzip-next/commit/7d7b656bd93f309bef75d7bd65be9ca64b700ec2 "Correct fix for #132 that caused decompress and test to fail.")`

`[7d7b656](/pete4abw/lrzip-next/commit/7d7b656bd93f309bef75d7bd65be9ca64b700ec2)`

[pete4abw](/pete4abw)
added a commit
that referenced
this issue
[Aug 25, 2023](#ref-commit-b8c41cb)
[![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=40&u=3a314b9dd5df99d938f84682f8ddbaa4a7c72dff&v=4)](/pete4abw)

`[FIX (again) for](/pete4abw/lrzip-next/commit/b8c41cbff594a0dfda47b75305cb3f8300d98704 "FIX (again) for #132. Revert to code from 0.12.0

For somne reason, I tried to overengineer a problem.
The POC presented was handled in the ZPAQ code.") [#132](https://github.com/pete4abw/lrzip-next/issues/132)[. Revert to code from 0.12.0](/pete4abw/lrzip-next/commit/b8c41cbff594a0dfda47b75305cb3f8300d98704 "FIX (again) for #132. Revert to code from 0.12.0

For somne reason, I tried to overengineer a problem.
The POC presented was handled in the ZPAQ code.")`
…

`[b8c41cb](/pete4abw/lrzip-next/commit/b8c41cbff594a0dfda47b75305cb3f8300d98704)`

```
For somne reason, I tried to overengineer a problem.
The POC presented was handled in the ZPAQ code.
```

[pete4abw](/pete4abw)
added a commit
that referenced
this issue
[Aug 25, 2023](#ref-commit-62cdbd3)
[![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=40&u=3a314b9dd5df99d938f84682f8ddbaa4a7c72dff&v=4)](/pete4abw)

`[Update WHATS-NEW for bugfix reversion in](/pete4abw/lrzip-next/commit/62cdbd39b09a42c21dbbf89558c1e5ff6a03207c "Update WHATS-NEW for bugfix reversion in #132.") [#132](https://github.com/pete4abw/lrzip-next/issues/132)[.](/pete4abw/lrzip-next/commit/62cdbd39b09a42c21dbbf89558c1e5ff6a03207c "Update WHATS-NEW for bugfix reversion in #132.")`

`[62cdbd3](/pete4abw/lrzip-next/commit/62cdbd39b09a42c21dbbf89558c1e5ff6a03207c)`

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fpete4abw%2Flrzip-next%2Fissues%2F132)

Assignees

[![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=40&v=4)](/pete4abw) [pete4abw](/pete4abw)

Labels

[bug](/pete4abw/lrzip-next/labels/bug)

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=52&v=4)](/pete4abw) [![@huanglei3](https://avatars.githubusercontent.com/u/42806521?s=52&v=4)](/huanglei3)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

