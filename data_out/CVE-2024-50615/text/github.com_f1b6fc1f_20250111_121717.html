
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fleethomason%2Ftinyxml2%2Fissues%2F997)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fleethomason%2Ftinyxml2%2Fissues%2F997)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=leethomason%2Ftinyxml2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[leethomason](/leethomason)
/
**[tinyxml2](/leethomason/tinyxml2)**
Public

* [Notifications](/login?return_to=%2Fleethomason%2Ftinyxml2) You must be signed in to change notification settings
* [Fork
  1.9k](/login?return_to=%2Fleethomason%2Ftinyxml2)
* [Star
   5.2k](/login?return_to=%2Fleethomason%2Ftinyxml2)

* [Code](/leethomason/tinyxml2)
* [Issues
  112](/leethomason/tinyxml2/issues)
* [Pull requests
  3](/leethomason/tinyxml2/pulls)
* [Actions](/leethomason/tinyxml2/actions)
* [Projects
  0](/leethomason/tinyxml2/projects)
* [Wiki](/leethomason/tinyxml2/wiki)
* [Security](/leethomason/tinyxml2/security)
* [Insights](/leethomason/tinyxml2/pulse)

Additional navigation options

* [Code](/leethomason/tinyxml2)
* [Issues](/leethomason/tinyxml2/issues)
* [Pull requests](/leethomason/tinyxml2/pulls)
* [Actions](/leethomason/tinyxml2/actions)
* [Projects](/leethomason/tinyxml2/projects)
* [Wiki](/leethomason/tinyxml2/wiki)
* [Security](/leethomason/tinyxml2/security)
* [Insights](/leethomason/tinyxml2/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fleethomason%2Ftinyxml2%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fleethomason%2Ftinyxml2%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Reachable assertion 'digit == 0 || mult <= UINT\_MAX / digit' failed in tinyxml2::XMLUtil::GetCharacterRef #997

Open

[4n0nym4u5](/4n0nym4u5) opened this issue
Aug 30, 2024
· 4 comments

Open

# [Reachable assertion 'digit == 0 || mult <= UINT\_MAX / digit' failed in tinyxml2::XMLUtil::GetCharacterRef](#top) #997

[4n0nym4u5](/4n0nym4u5) opened this issue
Aug 30, 2024
· 4 comments

## Comments

[![@4n0nym4u5](https://avatars.githubusercontent.com/u/38467329?s=80&u=dfb7713cccd132d97e9c34b1f05f77b9d6875492&v=4)](/4n0nym4u5)

Copy link

### **[4n0nym4u5](/4n0nym4u5)** commented [Aug 30, 2024](#issue-2496680414)

| Description The latest version of tinyxml2 was discovered to contain a reachable assertion `digit == 0 || mult <= UINT_MAX / digit failed` vulnerability in tinyxml2.cpp:545 tinyxml2::XMLUtil::GetCharacterRef() when parsing a specially crafted XML file. This vulnerability leads to a Denial of Service (DoS). ASAN Log ``` Summary: CRASH detected in __pthread_kill_implementation leading to SIGABRT (si_signo=6) / SI_TKILL (si_code=-6) Command line: ./build/xmltest @@ Testcase: crashes/id:000016,sig:06,src:000252,time:303091,execs:1126236,op:MOpt_havoc,rep:4 Crash bucket: 32110997dc013b116690743bf4d34b7b  Crashing thread backtrace: #0  0x00007ffff789eb1c in __pthread_kill_implementation (/lib/x86_64-linux-gnu/libc.so.6)                        at ./nptl/pthread_kill.c:44  #1  0x00007ffff789eb1c in __pthread_kill_internal (/lib/x86_64-linux-gnu/libc.so.6)                        at ./nptl/pthread_kill.c:78  #2  0x00007ffff789eb1c in __GI___pthread_kill (/lib/x86_64-linux-gnu/libc.so.6)                        at ./nptl/pthread_kill.c:89  #3  0x00007ffff784526e in __GI_raise (/lib/x86_64-linux-gnu/libc.so.6)                        at ../sysdeps/posix/raise.c:26  #4  0x00007ffff78288ff in __GI_abort (/lib/x86_64-linux-gnu/libc.so.6)                        at ./stdlib/abort.c:79  #5  0x00007ffff782881b in __assert_fail_base (/lib/x86_64-linux-gnu/libc.so.6)                        at ./assert/assert.c:94  #6  0x00007ffff783b507 in __assert_fail (/lib/x86_64-linux-gnu/libc.so.6)                        at ./assert/assert.c:103  #7  0x00007ffff7f99886 in tinyxml2::XMLUtil::GetCharacterRef (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        470: const tinyxml2::XMLUtil::GetCharacterRef(p = (const char *)0x55555579e8ed "&#01%E>0</m:mi> \301\336\322\32200000000006000000001;E>0</m:mi> \301\336\322\32200000&#x1;000000000&#1;", '0' <repeats 13 times>, "\317yle scriptlev=l=\00400", value = (char *)0x7ffffffe01aa "", length = (int *)0x7ffffffe01a4) {                        |||:                        |||: /* Local reference: const unsigned int digit = 6; */                        |||: /* Local reference: const char * q = 0x55555579e90b "6000000001;E>0</m:mi> \301\336\322\32200000&#x1;000000000&#1;", '0' <repeats 13 times>, "\317yle scriptlev=l=\00400"; */                        |||: /* Local reference: unsigned int mult = 1000000000; */                        543:                     const unsigned int digit = *q - '0';                        544:                     TIXMLASSERT( digit < 10 );                        545:                     TIXMLASSERT( digit == 0 || mult <= UINT_MAX / digit );                        |||:                        ---: }                        at ../tinyxml2.cpp:545  #8  0x00007ffff7f98878 in tinyxml2::StrPair::GetStr (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        281: const tinyxml2::StrPair::GetStr(this = (class tinyxml2::StrPair *)0x55555579fa40) {                        |||:                        |||: /* Local reference: char [10] buf = "\000\000\000\000\000\000\000\000\000"; */                        |||: /* Local reference: const int buflen = 10; */                        |||: /* Local reference: int len = 0; */                        |||: /* Local reference: const char * adjusted = 0x7ffff7f9aeeb <tinyxml2::XMLUtil::StringEqual(char const*, char const*, int)+443> "\203", <incomplete sequence \370>; */                        |||: /* Local reference: const char * p = 0x55555579e8ed "&#01%E>0</m:mi> \301\336\322\32200000000006000000001;E>0</m:mi> \301\336\322\32200000&#x1;000000000&#1;", '0' <repeats 13 times>, "\317yle scriptlev=l=\00400"; */                        325:                         char buf[buflen] = { 0 };                        326:                         int len = 0;                        327:                         const char* adjusted = const_cast<char*>( XMLUtil::GetCharacterRef( p, buf, &len ) );                        |||:                        ---: }                        at ../tinyxml2.cpp:327  #9  0x00007ffff7fa1fb9 in tinyxml2::XMLAttribute::Value (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        1445: const tinyxml2::XMLAttribute::Value(this = (const class tinyxml2::XMLAttribute *)0x55555579fa20) {                        1446: {                        1447:     return _value.GetStr();                        ||||:                        ----: }                        at ../tinyxml2.cpp:1447  #10 0x00007ffff7fa3331 in tinyxml2::XMLElement::Attribute (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        1635: const tinyxml2::XMLElement::Attribute(this = (const class tinyxml2::XMLElement *)0x55555579ea70, name = (const char *)0x55555579e95e "style", value = (const char *)0x0) {                        ||||:                        ||||: /* Local reference: const class tinyxml2::XMLAttribute * a = 0x55555579fa20; */                        ||||: /* Local reference: const char * value = 0x0; */                        1640:     }                        1641:     if ( !value || XMLUtil::StringEqual( a->Value(), value )) {                        1642:         return a->Value();                        ||||:                        ----: }                        at ../tinyxml2.cpp:1642  #11 0x00007ffff7fa5ba8 in tinyxml2::XMLElement::ParseAttributes (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        1967: char tinyxml2::XMLElement::ParseAttributes(this = (class tinyxml2::XMLElement *)0x55555579ea70, p = (char *)0x55555579e975 "", curLineNumPtr = (int *)0x55555579d350) {                        ||||:                        ||||: /* Local reference: class tinyxml2::XMLAttribute * attrib = 0x55555579fa70; */                        ||||: /* Local reference: char * p = 0x55555579e975 ""; */                        ||||: /* Local reference: int * curLineNumPtr = 0x55555579d350; */                        1986:                         1987:             p = attrib->ParseDeep( p, _document->ProcessEntities(), curLineNumPtr );                        1988:             if ( !p || Attribute( attrib->Name() ) ) {                        ||||:                        ----: }                        at ../tinyxml2.cpp:1988  #12 0x00007ffff7fa6973 in tinyxml2::XMLElement::ParseDeep (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        2083: char tinyxml2::XMLElement::ParseDeep(this = (class tinyxml2::XMLElement *)0x55555579ea70, p = (char *)0x55555579e8db " style", parentEndTag = (class tinyxml2::StrPair *)0x7ffffffe0400, curLineNumPtr = (int *)0x55555579d350) {                        ||||:                        ||||: /* Local reference: char * p = 0x55555579e8db " style"; */                        ||||: /* Local reference: int * curLineNumPtr = 0x55555579d350; */                        2099:     }                        2100:                         2101:     p = ParseAttributes( p, curLineNumPtr );                        ||||:                        ----: }                        at ../tinyxml2.cpp:2101  #13 0x00007ffff7f9ebb2 in tinyxml2::XMLNode::ParseDeep (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        1080: char tinyxml2::XMLNode::ParseDeep(this = (class tinyxml2::XMLNode *)0x55555579e9f8, p = (char *)0x55555579e8d7 "m:mi style", parentEndTag = (class tinyxml2::StrPair *)0x7ffffffe05c0, curLineNumPtr = (int *)0x55555579d350) {                        ||||:                        ||||: /* Local reference: class tinyxml2::StrPair endTag = {_flags = 0, _start = 0x0, _end = 0x0}; */                        ||||: /* Local reference: class tinyxml2::XMLNode * node = 0x55555579ea70; */                        ||||: /* Local reference: char * p = 0x55555579e8d7 "m:mi style"; */                        ||||: /* Local reference: int * curLineNumPtr = 0x55555579d350; */                        1115:                         1116:         StrPair endTag;                        1117:         p = node->ParseDeep( p, &endTag, curLineNumPtr );                        ||||:                        ----: }                        at ../tinyxml2.cpp:1117  #14 0x00007ffff7fa6a89 in tinyxml2::XMLElement::ParseDeep (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        2083: char tinyxml2::XMLElement::ParseDeep(this = (class tinyxml2::XMLElement *)0x55555579e9f8, p = (char *)0x55555579e844 "\n<!--00\3170000-", '0' <repeats 11 times>, "M", '0' <repeats 17 times>, "U\322>\n<p><mIET:math><m:mstyle sel=\"0\"scmi></m:mst", '\r' <repeats 12 times>, "00000000\377d=\"\"><xht:del t=\"\"><xht:h0 r=000--> <m:mi style", parentEndTag = (class tinyxml2::StrPair *)0x7ffffffe05c0, curLineNumPtr = (int *)0x55555579d350) {                        ||||:                        ||||: /* Local reference: char * p = 0x55555579e844 "\n<!--00\3170000-", '0' <repeats 11 times>, "M", '0' <repeats 17 times>, "U\322>\n<p><mIET:math><m:mstyle sel=\"0\"scmi></m:mst", '\r' <repeats 12 times>, "00000000\377d=\"\... */                        ||||: /* Local reference: class tinyxml2::StrPair * parentEndTag = 0x7ffffffe05c0; */                        ||||: /* Local reference: int * curLineNumPtr = 0x55555579d350; */                        2104:     }                        2105:                         2106:     p = XMLNode::ParseDeep( p, parentEndTag, curLineNumPtr );                        ||||:                        ----: }                        at ../tinyxml2.cpp:2106  #15 0x00007ffff7f9ebb2 in tinyxml2::XMLNode::ParseDeep (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        1080: char tinyxml2::XMLNode::ParseDeep(this = (class tinyxml2::XMLNode *)0x55555579e980, p = (char *)0x55555579e83f "body>\n<!--00\3170000-", '0' <repeats 11 times>, "M", '0' <repeats 17 times>, "U\322>\n<p><mIET:math><m:mstyle sel=\"0\"scmi></m:mst", '\r' <repeats 12 times>, "00000000\377d=\"\"><xht:del t=\"\"><xht:h0 r=000--> <m:mi style", parentEndTag = (class tinyxml2::StrPair *)0x7ffffffe0780, curLineNumPtr = (int *)0x55555579d350) {                        ||||:                        ||||: /* Local reference: class tinyxml2::StrPair endTag = {_flags = 0, _start = 0x0, _end = 0x0}; */                        ||||: /* Local reference: class tinyxml2::XMLNode * node = 0x55555579e9f8; */                        ||||: /* Local reference: char * p = 0x55555579e83f "body>\n<!--00\3170000-", '0' <repeats 11 times>, "M", '0' <repeats 17 times>, "U\322>\n<p><mIET:math><m:mstyle sel=\"0\"scmi></m:mst", '\r' <repeats 12 times>, "00000000\377... */                        ||||: /* Local reference: int * curLineNumPtr = 0x55555579d350; */                        1115:                         1116:         StrPair endTag;                        1117:         p = node->ParseDeep( p, &endTag, curLineNumPtr );                        ||||:                        ----: }                        at ../tinyxml2.cpp:1117  #16 0x00007ffff7fa6a89 in tinyxml2::XMLElement::ParseDeep (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        2083: char tinyxml2::XMLElement::ParseDeep(this = (class tinyxml2::XMLElement *)0x55555579e980, p = (char *)0x55555579e83e "<body>\n<!--00\3170000-", '0' <repeats 11 times>, "M", '0' <repeats 17 times>, "U\322>\n<p><mIET:math><m:mstyle sel=\"0\"scmi></m:mst", '\r' <repeats 12 times>, "00000000\377d=\"\"><xht:del t=\"\"><xht:h0 r=000--> <m:mi style", parentEndTag = (class tinyxml2::StrPair *)0x7ffffffe0780, curLineNumPtr = (int *)0x55555579d350) {                        ||||:                        ||||: /* Local reference: char * p = 0x55555579e83e "<body>\n<!--00\3170000-", '0' <repeats 11 times>, "M", '0' <repeats 17 times>, "U\322>\n<p><mIET:math><m:mstyle sel=\"0\"scmi></m:mst", '\r' <repeats 12 times>, "00000000\37... */                        ||||: /* Local reference: class tinyxml2::StrPair * parentEndTag = 0x7ffffffe0780; */                        ||||: /* Local reference: int * curLineNumPtr = 0x55555579d350; */                        2104:     }                        2105:                         2106:     p = XMLNode::ParseDeep( p, parentEndTag, curLineNumPtr );                        ||||:                        ----: }                        at ../tinyxml2.cpp:2106  #17 0x00007ffff7f9ebb2 in tinyxml2::XMLNode::ParseDeep (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        1080: char tinyxml2::XMLNode::ParseDeep(this = (class tinyxml2::XMLNode *)0x55555579d2b0, p = (char *)0x55555579e821 "html xmlns", parentEndTag = (class tinyxml2::StrPair *)0x0, curLineNumPtr = (int *)0x55555579d350) {                        ||||:                        ||||: /* Local reference: class tinyxml2::StrPair endTag = {_flags = 0, _start = 0x0, _end = 0x0}; */                        ||||: /* Local reference: class tinyxml2::XMLNode * node = 0x55555579e980; */                        ||||: /* Local reference: char * p = 0x55555579e821 "html xmlns"; */                        ||||: /* Local reference: int * curLineNumPtr = 0x55555579d350; */                        1115:                         1116:         StrPair endTag;                        1117:         p = node->ParseDeep( p, &endTag, curLineNumPtr );                        ||||:                        ----: }                        at ../tinyxml2.cpp:1117  #18 0x00007ffff7fa9725 in tinyxml2::XMLDocument::Parse (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        2558: void tinyxml2::XMLDocument::Parse(this = (class tinyxml2::XMLDocument *)0x55555579d2b0) {                        ||||:                        ||||: /* Local reference: char * p = 0x55555579e820 "<html xmlns"; */                        2569:         return;                        2570:     }                        2571:     ParseDeep(p, 0, &_parseCurLineNum );                        ||||:                        ----: }                        at ../tinyxml2.cpp:2571  #19 0x00007ffff7fa950d in tinyxml2::XMLDocument::LoadFile (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        2371: enum tinyxml2::XMLDocument::LoadFile(this = (class tinyxml2::XMLDocument *)0x55555579d2b0, fp = (FILE *)0x55555579d630) {                        ||||:                        ||||: /* Local reference: const size_t size = 341; */                        2418:     _charBuffer[size] = 0;                        2419:                         2420:     Parse();                        ||||:                        ----: }                        at ../tinyxml2.cpp:2420  #20 0x00007ffff7fa8f83 in tinyxml2::XMLDocument::LoadFile (/home/user/fuzzing_targets/tinyxml2/build/libtinyxml2.so.10)                        2352: enum tinyxml2::XMLDocument::LoadFile(this = (class tinyxml2::XMLDocument *)0x55555579d2b0, filename = (const char *)0x7fffffffe14d "crashes/id:000016,sig:06,src:000252,time:303091,execs:1126236,op:MOpt_havoc,rep:4") {                        ||||:                        ||||: /* Local reference: FILE * fp = 0x55555579d630; */                        2364:         return _errorID;                        2365:     }                        2366:     LoadFile( fp );                        ||||:                        ----: }                        at ../tinyxml2.cpp:2366  #21 0x000055555555c01f in main (/home/user/fuzzing_targets/tinyxml2/build/xmltest)                        300: int main(argc = (int)2, argv = (const char **)0x7fffffffdd98) {                        |||:                        |||: /* Local reference: class tinyxml2::XMLDocument * doc = 0x55555579d2b0; */                        |||: /* Local reference: clock_t startTime = 2753; */                        |||: /* Local reference: const char ** argv = 0x7fffffffdd98; */                        317:         XMLDocument* doc = new XMLDocument();                        318:         clock_t startTime = clock();                        319:         doc->LoadFile( argv[1] );                        |||:                        ---: }                        at ../xmltest.cpp:319  Crash context: Execution stopped here ==> 0x00007ffff789eb1c: mov    r14d,eax  Register info:     rax - 0x0000000000000000 (0)     rbx - 0x000000000011f2f4 (1176308)     rcx - 0x00007ffff789eb1c (140737346399004)     rdx - 0x0000000000000006 (6)     rsi - 0x000000000011f2f4 (1176308)     rdi - 0x000000000011f2f4 (1176308)     rbp - 0x00007ffffffdff70 (0x7ffffffdff70)     rsp - 0x00007ffffffdff30 (0x7ffffffdff30)      r8 - 0x000055555578b010 (93824994553872)      r9 - 0x0000000000000007 (7)     r10 - 0x0000000000000008 (8)     r11 - 0x0000000000000246 (582)     r12 - 0x0000000000000006 (6)     r13 - 0x00007ffff7fb301b (140737353822235)     r14 - 0x0000000000000016 (22)     r15 - 0x00007ffff7fb32f4 (140737353822964)     rip - 0x00007ffff789eb1c (0x7ffff789eb1c <__GI___pthread_kill+284>)  eflags - 0x00000246 ([ PF ZF IF ])      cs - 0x00000033 (51)      ss - 0x0000002b (43)      ds - 0x00000000 (0)      es - 0x00000000 (0)      fs - 0x00000000 (0)      gs - 0x00000000 (0) fs_base - 0x00007ffff7f3f7c0 (140737353349056) gs_base - 0x0000000000000000 (0) ``` Proof-of-Concept Files [poc](https://github.com/4n0nym4u5/CVE/raw/main/tinyxml2_poc/reachable_assertion_digit/poc) Reproduction ``` git clone https://github.com/leethomason/tinyxml2 cd tinyxml2 CC=clang CXX=clang++ meson setup build CC=clang CXX=clang++ sudo ninja -C build install ./build/xmltest poc ``` Results ``` ➜  tinyxml2 git:(master) ✗ ./build/xmltest tinyxml2_poc/reachable_assertion_digit/poc xmltest: ../tinyxml2.cpp:545: static const char *tinyxml2::XMLUtil::GetCharacterRef(const char *, char *, int *): Assertion `digit == 0 || mult <= UINT_MAX / digit' failed. [1]    1177540 IOT instruction  ./build/xmltest tinyxml2_poc/reachable_assertion_digit/poc ``` Environment ``` Linux Mint 22 Wilma  Ubuntu clang version 18.1.3 (1ubuntu1) gcc (Ubuntu 13.2.0-23ubuntu4) 13.2.0  ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@4n0nym4u5](https://avatars.githubusercontent.com/u/38467329?s=40&u=dfb7713cccd132d97e9c34b1f05f77b9d6875492&v=4)](/4n0nym4u5)
[4n0nym4u5](/4n0nym4u5)
changed the title
~~Reachable assertion 'digit == 0 || mult <= UINT\_MAX / digit' failed in tinyxml2::XMLUtil::GetCharacterRef #996~~
Reachable assertion 'digit == 0 || mult <= UINT\_MAX / digit' failed in tinyxml2::XMLUtil::GetCharacterRef
[Aug 31, 2024](#event-14091951637)

[![@carnil](https://avatars.githubusercontent.com/u/773068?s=80&u=54a9fd1cfc2b1abb34a487f17e07eb8a03cecdae&v=4)](/carnil)

Copy link

### **[carnil](/carnil)** commented [Oct 28, 2024](#issuecomment-2442627329)

| This issue got associated with [CVE-2024-50615](https://github.com/advisories/GHSA-884x-p7qm-gq3f "CVE-2024-50615") |
| --- |

All reactions

Sorry, something went wrong.

[![@obernin](https://avatars.githubusercontent.com/u/5502607?s=80&v=4)](/obernin)

Copy link

### **[obernin](/obernin)** commented [Nov 11, 2024](#issuecomment-2468227613)

| Hi,  If the assertion is only triggered in debug mode, what happens when the code is compiled and running in non-debug mode ? Presumably the assertion is not triggered, but does the error condition detected by the assertion in debug mode not cause a different error in non-debug mode ? And what is the impact of that error (crash, malfunction, etc ...) ?  If the crash is avoided in non debug mode, it seems that this could be a mitigation for the CVE, no ? |
| --- |

All reactions

Sorry, something went wrong.

[![@VirtualTim](https://avatars.githubusercontent.com/u/5424257?s=80&u=0ce9c3d4b907122d07ee2055ec9c0af1ce246389&v=4)](/VirtualTim)

Copy link

### **[VirtualTim](/VirtualTim)** commented [Nov 25, 2024](#issuecomment-2496616443)

| If anyone, like me, was curious, here's the code:     [tinyxml2/tinyxml2.cpp](https://github.com/leethomason/tinyxml2/blob/6b6d1214a7169af62f9f5d1cef49dbf686232f37/tinyxml2.cpp#L520)  Line 520 in [6b6d121](/leethomason/tinyxml2/commit/6b6d1214a7169af62f9f5d1cef49dbf686232f37)   |  | TIXMLASSERT( digit == 0 || mult <= UINT\_MAX / digit ); | | --- | --- |      Where `TIXMLASSERT` is defined as:   [tinyxml2/tinyxml2.h](https://github.com/leethomason/tinyxml2/blob/6b6d1214a7169af62f9f5d1cef49dbf686232f37/tinyxml2.h#L82-L97)  Lines 82 to 97 in [6b6d121](/leethomason/tinyxml2/commit/6b6d1214a7169af62f9f5d1cef49dbf686232f37)   |  | #if !defined(TIXMLASSERT) | | --- | --- | |  | #if defined(TINYXML2\_DEBUG) | |  | # if defined(\_MSC\_VER) | |  | # // "(void)0," is for suppressing C4127 warning in "assert(false)", "assert(true)" and the like | |  | # define TIXMLASSERT( x ) do { if ( !((void)0,(x))) { \_\_debugbreak(); } } while(false) | |  | # elif defined (ANDROID\_NDK) | |  | # include <android/log.h> | |  | # define TIXMLASSERT( x ) do { if ( !(x)) { \_\_android\_log\_assert( "assert", "grinliz", "ASSERT in '%s' at %d.", \_\_FILE\_\_, \_\_LINE\_\_ ); } } while(false) | |  | # else | |  | # include <assert.h> | |  | # define TIXMLASSERT assert | |  | # endif | |  | #else | |  | # define TIXMLASSERT( x ) do {} while(false) | |  | #endif | |  | #endif |      And `TINYXML2_DEBUG` is defined as:   [tinyxml2/tinyxml2.h](https://github.com/leethomason/tinyxml2/blob/6b6d1214a7169af62f9f5d1cef49dbf686232f37/tinyxml2.h#L56-L60)  Lines 56 to 60 in [6b6d121](/leethomason/tinyxml2/commit/6b6d1214a7169af62f9f5d1cef49dbf686232f37)   |  | #if defined( \_DEBUG ) || defined (\_\_DEBUG\_\_) | | --- | --- | |  | # ifndef TINYXML2\_DEBUG | |  | # define TINYXML2\_DEBUG | |  | # endif | |  | #endif |      So the TLDR is that this "reachable assertion" is only reachable in debug builds. Personally I'm not sure that things that are only exploitable in debug build should have a CVE score. |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

 👍
1
 ped7g reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@ped7g](https://avatars.githubusercontent.com/u/236664?s=80&u=56da2c854805db741e3f73443a58b111162384f7&v=4)](/ped7g)

Copy link

### **[ped7g](/ped7g)** commented [Nov 25, 2024](#issuecomment-2498433908)

| So the TLDR is that this "reachable assertion" is only reachable in debug builds.  EDIT: after writing almost whole post and finishing the conclusions, I realized that indeed the CVE is about DoS through assert itself and I sort of agree with you, I find it questionable to give it CVE. I think it should be at least reflected in its score, that in regular production build there shouldn't be any DoS caused by this.  I will keep the rest of the post as it was, investigating other aspects of this bug, just in case I will be ever bored enough to refactor this piece of code to my liking (which would make the asserts to not trigger on valid XML files, but you would be still able to trigger it by XML containing invalid value, so what's the point... checking now the proposed PR to fix the CVE, it's also technically wrong, heh, but will not trigger assert I guess ... assuming from 10 seconds quick review look):   ---   ~~Without checking this particular bug/details, you are highly likely misunderstanding the CVE and root cause.~~  It's not about what the assert itself does (ie. line 520 in tinyxml2.cpp) as assert is not part of release build. It's about the conditions being unexpected from the point of view of original author, ie. it's likely the following code is not handling the situation correctly or well.  Now you made me curious to look at that code, it's parsing of hexa-encoded character references like `&#x01234;`. Whoa, that's kinda ... not a code I personally would write... but let's focus on security implications here, I could maybe do MR later.  The assertion is triggered when either:   1. non-hexa digit is encountered (not sure if this was filtered out on higher levels or this will be real encounter here), those will work as digit zero, ie. `&#x1g2;` would parse by that part of code (if it would be reached in the first place) as value 0x102 = 258. 2. the total value did overflow `UINT_MAX` (for some strange reason the other assert checking total sum of so far parsed digits compares to `ULONG_MAX` BTW). In such case value like `&#xF45670123CDEF89AB;` will evaluate as 0x45670123CDEF89AB truncating leading F to oblivion (assuming `unsigned` is 64bit, if it's 32bit, the truncation will happen sooner ... again a bit of code smell IMHO using different types in the evaluation, `mult` is `unsigned` and `ucs` is `unsigned long`).   This has further "issue" that ([according to wiki](https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references)):  The hhhh (or nnnn) may be any number of hexadecimal (or decimal) digits and may include leading zeros. The hhhh for hexadecimal digits may mix uppercase and lowercase letters, though uppercase is the usual style.  So in debug build you will hit that assertion even with legit XML content like `&#x00000000000000001234`, but the parsed value will be correct 0x1234, so in such case it's benign, but ... did I mention this parser is written not in my style? I did, ok, let's leave it at that remark. (EDIT: the proposed PR [#1003](https://github.com/leethomason/tinyxml2/pull/1003) will not parse this because the string is too long for it)  So with specially crafted XML you can make the internal `ucs` and `digitScaled` values overflow and parse truncated value and in release build the `ConvertUTF32ToUTF8( ucs, value, length );` will be called with such truncated value. The truncated value will be usually too large for that routine to produce any output so the CharRef entity will just evaporate, but with specially crafted XML you can get any other 24bit value encoded as 32bit utf8 codepoint.  None of this should be any more dangerous than including the utf8 codepoint directly in the file without that hexa encoding, so the CVE really is about hitting the assert... 🙄 ... so some people are running debug build in production? Is this like prevalent? Every day I learn something new.... even after almost ~40 years of coding... |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fleethomason%2Ftinyxml2%2Fissues%2F997)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

5 participants

[![@ped7g](https://avatars.githubusercontent.com/u/236664?s=52&v=4)](/ped7g) [![@carnil](https://avatars.githubusercontent.com/u/773068?s=52&v=4)](/carnil) [![@VirtualTim](https://avatars.githubusercontent.com/u/5424257?s=52&v=4)](/VirtualTim) [![@obernin](https://avatars.githubusercontent.com/u/5502607?s=52&v=4)](/obernin) [![@4n0nym4u5](https://avatars.githubusercontent.com/u/38467329?s=52&v=4)](/4n0nym4u5)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

