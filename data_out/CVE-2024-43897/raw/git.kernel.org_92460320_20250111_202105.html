<!DOCTYPE html>
<html lang='en'>
<head>
<title>net: drop bad gso csum_start and offset in virtio_net_hdr - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='6772c4868a8e7ad5305957cdb834ce881793acb7'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='6772c4868a8e7ad5305957cdb834ce881793acb7'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='6772c4868a8e7ad5305957cdb834ce881793acb7'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Willem de Bruijn &lt;willemb@google.com&gt;</td><td class='right'>2024-07-29 16:10:12 -0400</td></tr>
<tr><th>committer</th><td>Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;</td><td class='right'>2024-08-14 13:58:48 +0200</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>6772c4868a8e7ad5305957cdb834ce881793acb7</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>a74756e64318caa0580cad4f76f54c104e8d32fc</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=12f98cc6fb07580ba6039a164d9b1317351fdbfc'>12f98cc6fb07580ba6039a164d9b1317351fdbfc</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6772c4868a8e7ad5305957cdb834ce881793acb7&amp;id2=12f98cc6fb07580ba6039a164d9b1317351fdbfc'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6772c4868a8e7ad5305957cdb834ce881793acb7.tar.gz'>linux-6772c4868a8e7ad5305957cdb834ce881793acb7.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>net: drop bad gso csum_start and offset in virtio_net_hdr</div><div class='commit-msg'>commit 89add40066f9ed9abe5f7f886fe5789ff7e0c50e upstream.

Tighten csum_start and csum_offset checks in virtio_net_hdr_to_skb
for GSO packets.

The function already checks that a checksum requested with
VIRTIO_NET_HDR_F_NEEDS_CSUM is in skb linear. But for GSO packets
this might not hold for segs after segmentation.

Syzkaller demonstrated to reach this warning in skb_checksum_help

	offset = skb_checksum_start_offset(skb);
	ret = -EINVAL;
	if (WARN_ON_ONCE(offset &gt;= skb_headlen(skb)))

By injecting a TSO packet:

WARNING: CPU: 1 PID: 3539 at net/core/dev.c:3284 skb_checksum_help+0x3d0/0x5b0
 ip_do_fragment+0x209/0x1b20 net/ipv4/ip_output.c:774
 ip_finish_output_gso net/ipv4/ip_output.c:279 [inline]
 __ip_finish_output+0x2bd/0x4b0 net/ipv4/ip_output.c:301
 iptunnel_xmit+0x50c/0x930 net/ipv4/ip_tunnel_core.c:82
 ip_tunnel_xmit+0x2296/0x2c70 net/ipv4/ip_tunnel.c:813
 __gre_xmit net/ipv4/ip_gre.c:469 [inline]
 ipgre_xmit+0x759/0xa60 net/ipv4/ip_gre.c:661
 __netdev_start_xmit include/linux/netdevice.h:4850 [inline]
 netdev_start_xmit include/linux/netdevice.h:4864 [inline]
 xmit_one net/core/dev.c:3595 [inline]
 dev_hard_start_xmit+0x261/0x8c0 net/core/dev.c:3611
 __dev_queue_xmit+0x1b97/0x3c90 net/core/dev.c:4261
 packet_snd net/packet/af_packet.c:3073 [inline]

The geometry of the bad input packet at tcp_gso_segment:

[   52.003050][ T8403] skb len=12202 headroom=244 headlen=12093 tailroom=0
[   52.003050][ T8403] mac=(168,24) mac_len=24 net=(192,52) trans=244
[   52.003050][ T8403] shinfo(txflags=0 nr_frags=1 gso(size=1552 type=3 segs=0))
[   52.003050][ T8403] csum(0x60000c7 start=199 offset=1536
ip_summed=3 complete_sw=0 valid=0 level=0)

Mitigate with stricter input validation.

csum_offset: for GSO packets, deduce the correct value from gso_type.
This is already done for USO. Extend it to TSO. Let UFO be:
udp[46]_ufo_fragment ignores these fields and always computes the
checksum in software.

csum_start: finding the real offset requires parsing to the transport
header. Do not add a parser, use existing segmentation parsing. Thanks
to SKB_GSO_DODGY, that also catches bad packets that are hw offloaded.
Again test both TSO and USO. Do not test UFO for the above reason, and
do not test UDP tunnel offload.

GSO packet are almost always CHECKSUM_PARTIAL. USO packets may be
CHECKSUM_NONE since commit 10154dbded6d6 ("udp: Allow GSO transmit
from devices with no checksum offload"), but then still these fields
are initialized correctly in udp4_hwcsum/udp6_hwcsum_outgoing. So no
need to test for ip_summed == CHECKSUM_PARTIAL first.

This revises an existing fix mentioned in the Fixes tag, which broke
small packets with GSO offload, as detected by kselftests.

Link: <a href="https://syzkaller.appspot.com/bug?extid=e1db31216c789f552871">https://syzkaller.appspot.com/bug?extid=e1db31216c789f552871</a>
Link: <a href="https://lore.kernel.org/netdev/20240723223109.2196886-1-kuba@kernel.org">https://lore.kernel.org/netdev/20240723223109.2196886-1-kuba@kernel.org</a>
Fixes: e269d79c7d35 ("net: missing check virtio")
Cc: stable@vger.kernel.org
Signed-off-by: Willem de Bruijn &lt;willemb@google.com&gt;
Link: <a href="https://patch.msgid.link/20240729201108.1615114-1-willemdebruijn.kernel@gmail.com">https://patch.msgid.link/20240729201108.1615114-1-willemdebruijn.kernel@gmail.com</a>
Signed-off-by: Jakub Kicinski &lt;kuba@kernel.org&gt;
Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/virtio_net.h?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>include/linux/virtio_net.h</a></td><td class='right'>16</td><td class='graph'><table summary='file diffstat' width='16%'><tr><td class='add' style='width: 31.2%;'/><td class='rem' style='width: 68.8%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/ipv4/tcp_offload.c?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>net/ipv4/tcp_offload.c</a></td><td class='right'>3</td><td class='graph'><table summary='file diffstat' width='16%'><tr><td class='add' style='width: 18.8%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 81.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/ipv4/udp_offload.c?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>net/ipv4/udp_offload.c</a></td><td class='right'>4</td><td class='graph'><table summary='file diffstat' width='16%'><tr><td class='add' style='width: 25.0%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 75.0%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>3 files changed, 12 insertions, 11 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/include/linux/virtio_net.h b/include/linux/virtio_net.h<br/>index d1d7825318c32d..6c395a2600e8d1 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/virtio_net.h?id=12f98cc6fb07580ba6039a164d9b1317351fdbfc'>include/linux/virtio_net.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/virtio_net.h?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>include/linux/virtio_net.h</a></div><div class='hunk'>@@ -56,7 +56,6 @@ static inline int virtio_net_hdr_to_skb(struct sk_buff *skb,</div><div class='ctx'> 	unsigned int thlen = 0;</div><div class='ctx'> 	unsigned int p_off = 0;</div><div class='ctx'> 	unsigned int ip_proto;</div><div class='del'>-	u64 ret, remainder, gso_size;</div><div class='ctx'> </div><div class='ctx'> 	if (hdr-&gt;gso_type != VIRTIO_NET_HDR_GSO_NONE) {</div><div class='ctx'> 		switch (hdr-&gt;gso_type &amp; ~VIRTIO_NET_HDR_GSO_ECN) {</div><div class='hunk'>@@ -99,16 +98,6 @@ static inline int virtio_net_hdr_to_skb(struct sk_buff *skb,</div><div class='ctx'> 		u32 off = __virtio16_to_cpu(little_endian, hdr-&gt;csum_offset);</div><div class='ctx'> 		u32 needed = start + max_t(u32, thlen, off + sizeof(__sum16));</div><div class='ctx'> </div><div class='del'>-		if (hdr-&gt;gso_size) {</div><div class='del'>-			gso_size = __virtio16_to_cpu(little_endian, hdr-&gt;gso_size);</div><div class='del'>-			ret = div64_u64_rem(skb-&gt;len, gso_size, &amp;remainder);</div><div class='del'>-			if (!(ret &amp;&amp; (hdr-&gt;gso_size &gt; needed) &amp;&amp;</div><div class='del'>-						((remainder &gt; needed) || (remainder == 0)))) {</div><div class='del'>-				return -EINVAL;</div><div class='del'>-			}</div><div class='del'>-			skb_shinfo(skb)-&gt;tx_flags |= SKBFL_SHARED_FRAG;</div><div class='del'>-		}</div><div class='del'>-</div><div class='ctx'> 		if (!pskb_may_pull(skb, needed))</div><div class='ctx'> 			return -EINVAL;</div><div class='ctx'> </div><div class='hunk'>@@ -182,6 +171,11 @@ retry:</div><div class='ctx'> 			if (gso_type != SKB_GSO_UDP_L4)</div><div class='ctx'> 				return -EINVAL;</div><div class='ctx'> 			break;</div><div class='add'>+		case SKB_GSO_TCPV4:</div><div class='add'>+		case SKB_GSO_TCPV6:</div><div class='add'>+			if (skb-&gt;csum_offset != offsetof(struct tcphdr, check))</div><div class='add'>+				return -EINVAL;</div><div class='add'>+			break;</div><div class='ctx'> 		}</div><div class='ctx'> </div><div class='ctx'> 		/* Kernel has a special handling for GSO_BY_FRAGS. */</div><div class='head'>diff --git a/net/ipv4/tcp_offload.c b/net/ipv4/tcp_offload.c<br/>index 8311c38267b55b..69e6012ae82fbd 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/tcp_offload.c?id=12f98cc6fb07580ba6039a164d9b1317351fdbfc'>net/ipv4/tcp_offload.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/tcp_offload.c?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>net/ipv4/tcp_offload.c</a></div><div class='hunk'>@@ -73,6 +73,9 @@ struct sk_buff *tcp_gso_segment(struct sk_buff *skb,</div><div class='ctx'> 	if (thlen &lt; sizeof(*th))</div><div class='ctx'> 		goto out;</div><div class='ctx'> </div><div class='add'>+	if (unlikely(skb_checksum_start(skb) != skb_transport_header(skb)))</div><div class='add'>+		goto out;</div><div class='add'>+</div><div class='ctx'> 	if (!pskb_may_pull(skb, thlen))</div><div class='ctx'> 		goto out;</div><div class='ctx'> </div><div class='head'>diff --git a/net/ipv4/udp_offload.c b/net/ipv4/udp_offload.c<br/>index e5971890d637d1..9cb13a50011efb 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/udp_offload.c?id=12f98cc6fb07580ba6039a164d9b1317351fdbfc'>net/ipv4/udp_offload.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/udp_offload.c?id=6772c4868a8e7ad5305957cdb834ce881793acb7'>net/ipv4/udp_offload.c</a></div><div class='hunk'>@@ -278,6 +278,10 @@ struct sk_buff *__udp_gso_segment(struct sk_buff *gso_skb,</div><div class='ctx'> 	if (gso_skb-&gt;len &lt;= sizeof(*uh) + mss)</div><div class='ctx'> 		return ERR_PTR(-EINVAL);</div><div class='ctx'> </div><div class='add'>+	if (unlikely(skb_checksum_start(gso_skb) !=</div><div class='add'>+		     skb_transport_header(gso_skb)))</div><div class='add'>+		return ERR_PTR(-EINVAL);</div><div class='add'>+</div><div class='ctx'> 	if (skb_gso_ok(gso_skb, features | NETIF_F_GSO_ROBUST)) {</div><div class='ctx'> 		/* Packet is from an untrusted source, reset gso_segs. */</div><div class='ctx'> 		skb_shinfo(gso_skb)-&gt;gso_segs = DIV_ROUND_UP(gso_skb-&gt;len - sizeof(*uh),</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-11 20:19:42 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
