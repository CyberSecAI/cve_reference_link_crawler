=== Content from github.com_63402c26_20250111_164341.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fcommit%2F9f8c3cf74223ed0a8a834134be9c917b9f10ceb5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fcommit%2F9f8c3cf74223ed0a8a834134be9c917b9f10ceb5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=xerial%2Fsnappy-java)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xerial](/xerial)
/
**[snappy-java](/xerial/snappy-java)**
Public

* [Notifications](/login?return_to=%2Fxerial%2Fsnappy-java) You must be signed in to change notification settings
* [Fork
  234](/login?return_to=%2Fxerial%2Fsnappy-java)
* [Star
   1k](/login?return_to=%2Fxerial%2Fsnappy-java)

* [Code](/xerial/snappy-java)
* [Issues
  47](/xerial/snappy-java/issues)
* [Pull requests
  6](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects
  0](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

Additional navigation options

* [Code](/xerial/snappy-java)
* [Issues](/xerial/snappy-java/issues)
* [Pull requests](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

## Commit

[Permalink](/xerial/snappy-java/commit/9f8c3cf74223ed0a8a834134be9c917b9f10ceb5)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-55g7-9cwv-5qfv](https://github.com/advisories/GHSA-55g7-9cwv-5qfv "GHSA-55g7-9cwv-5qfv")

[Browse files](/xerial/snappy-java/tree/9f8c3cf74223ed0a8a834134be9c917b9f10ceb5)
Browse the repository at this point in the history

```
* Validate chunk size to be within a configured maximum

* Add constructors to have max size configurable

* Code cleanup

* Use 512MB for consistency

---------

Co-authored-by: Taro L. Saito <leo@xerial.org>
```

* Loading branch information

[![@xerial](https://avatars.githubusercontent.com/u/57538?s=40&v=4)](/xerial)

BD
and
[xerial](/xerial/snappy-java/commits?author=xerial "View all commits by xerial")
authored
Sep 23, 2023

1 parent
[49d7001](/xerial/snappy-java/commit/49d700175f18ed5f8c5d371b7c2f80c75979bd68)

commit 9f8c3cf

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**60 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + main/java/org/xerial/snappy

    - src/main/java/org/xerial/snappy/SnappyHadoopCompatibleOutputStream.java
      [SnappyHadoopCompatibleOutputStream.java](#diff-8eecb8de3b970d47e2032349f327fac2382b83b7652878c7d1260377ce0e02e2)
    - src/main/java/org/xerial/snappy/SnappyInputStream.java
      [SnappyInputStream.java](#diff-c3e53610267092989965e8c7dd2d4417d355ff7f560f9e8075b365f32569079f)
    - src/main/java/org/xerial/snappy/SnappyOutputStream.java
      [SnappyOutputStream.java](#diff-d61ec5e5039416357dae685f4b2315bddf4dbba68f5829e8894a40740fbf13d4)
  + test/java/org/xerial/snappy

    - src/test/java/org/xerial/snappy/SnappyOutputStreamTest.java
      [SnappyOutputStreamTest.java](#diff-96ebfb4495813356e06da7e263ddf73bddc07cc53c68dc4ba1c9075d4f62453e)
    - src/test/java/org/xerial/snappy/SnappyTest.java
      [SnappyTest.java](#diff-f82b2093a98cc73850ae6c42eb512c8affda0141c6b4e4523a55ae3660ae74f5)

## There are no files selected for viewing

4 changes: 2 additions & 2 deletions

4
[src/main/java/org/xerial/snappy/SnappyHadoopCompatibleOutputStream.java](#diff-8eecb8de3b970d47e2032349f327fac2382b83b7652878c7d1260377ce0e02e2 "src/main/java/org/xerial/snappy/SnappyHadoopCompatibleOutputStream.java")

Show comments

[View file](/xerial/snappy-java/blob/9f8c3cf74223ed0a8a834134be9c917b9f10ceb5/src/main/java/org/xerial/snappy/SnappyHadoopCompatibleOutputStream.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,9 +1,9 @@ |
|  |  | package org.xerial.snappy; |
|  |  |  |
|  |  | import java.io.OutputStream; |
|  |  |  |
|  |  | import org.xerial.snappy.buffer.CachedBufferAllocator; |
|  |  |  |
|  |  | import java.io.OutputStream; |
|  |  |  |
|  |  | public class SnappyHadoopCompatibleOutputStream extends SnappyOutputStream |
|  |  | { |
|  |  | public SnappyHadoopCompatibleOutputStream(OutputStream out) |
| Expand Down | |  |

23 changes: 23 additions & 0 deletions

23
[src/main/java/org/xerial/snappy/SnappyInputStream.java](#diff-c3e53610267092989965e8c7dd2d4417d355ff7f560f9e8075b365f32569079f "src/main/java/org/xerial/snappy/SnappyInputStream.java")

Show comments

[View file](/xerial/snappy-java/blob/9f8c3cf74223ed0a8a834134be9c917b9f10ceb5/src/main/java/org/xerial/snappy/SnappyInputStream.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -36,8 +36,11 @@ |
|  |  | public class SnappyInputStream |
|  |  | extends InputStream |
|  |  | { |
|  |  | public static final int MAX\_CHUNK\_SIZE = 512 \* 1024 \* 1024; // 512 MiB |
|  |  |  |
|  |  | private boolean finishedReading = false; |
|  |  | protected final InputStream in; |
|  |  | private final int maxChunkSize; |
|  |  |  |
|  |  | private byte[] compressed; |
|  |  | private byte[] uncompressed; |
| Expand All | | @@ -55,6 +58,21 @@ public class SnappyInputStream |
|  |  | public SnappyInputStream(InputStream input) |
|  |  | throws IOException |
|  |  | { |
|  |  | this(input, MAX\_CHUNK\_SIZE); |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Create a filter for reading compressed data as a uncompressed stream with provided maximum chunk size |
|  |  | \* |
|  |  | \* @param input |
|  |  | \* @param maxChunkSize |
|  |  | \* @throws IOException |
|  |  | \*/ |
|  |  | public SnappyInputStream(InputStream input, int maxChunkSize) |
|  |  | throws IOException |
|  |  | { |
|  |  | this.maxChunkSize = maxChunkSize; |
|  |  | this.in = input; |
|  |  | readHeader(); |
|  |  | } |
| Expand Down  Expand Up | | @@ -422,6 +440,11 @@ protected boolean hasNextChunk() |
|  |  | throw new SnappyError(SnappyErrorCode.INVALID\_CHUNK\_SIZE, "chunkSize is too big or negative : " + chunkSize); |
|  |  | } |
|  |  |  |
|  |  | // chunkSize is big |
|  |  | if (chunkSize > maxChunkSize) { |
|  |  | throw new SnappyError(SnappyErrorCode.FAILED\_TO\_UNCOMPRESS, String.format("Received chunkSize %,d is greater than max configured chunk size %,d", chunkSize, maxChunkSize)); |
|  |  | } |
|  |  |  |
|  |  | // extend the compressed data buffer size |
|  |  | if (compressed == null || chunkSize > compressed.length) { |
|  |  | // chunkSize exceeds limit |
| Expand Down | |  |

6 changes: 5 additions & 1 deletion

6
[src/main/java/org/xerial/snappy/SnappyOutputStream.java](#diff-d61ec5e5039416357dae685f4b2315bddf4dbba68f5829e8894a40740fbf13d4 "src/main/java/org/xerial/snappy/SnappyOutputStream.java")

Show comments

[View file](/xerial/snappy-java/blob/9f8c3cf74223ed0a8a834134be9c917b9f10ceb5/src/main/java/org/xerial/snappy/SnappyOutputStream.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -59,6 +59,7 @@ |
|  |  | public class SnappyOutputStream |
|  |  | extends OutputStream |
|  |  | { |
|  |  | public static final int MAX\_BLOCK\_SIZE = 512 \* 1024 \* 1024; // 512 MiB |
|  |  | static final int MIN\_BLOCK\_SIZE = 1 \* 1024; |
|  |  | static final int DEFAULT\_BLOCK\_SIZE = 32 \* 1024; // Use 32kb for the default block size |
|  |  |  |
| Expand All | | @@ -84,7 +85,7 @@ public SnappyOutputStream(OutputStream out) |
|  |  | /\*\* |
|  |  | \* @param out |
|  |  | \* @param blockSize byte size of the internal buffer size |
|  |  | \* @throws IOException |
|  |  | \* @throws IllegalArgumentException when blockSize is larger than 512 MiB |
|  |  | \*/ |
|  |  | public SnappyOutputStream(OutputStream out, int blockSize) |
|  |  | { |
| Expand All | | @@ -95,6 +96,9 @@ public SnappyOutputStream(OutputStream out, int blockSize, BufferAllocatorFactor |
|  |  | { |
|  |  | this.out = out; |
|  |  | this.blockSize = Math.max(MIN\_BLOCK\_SIZE, blockSize); |
|  |  | if (this.blockSize > MAX\_BLOCK\_SIZE){ |
|  |  | throw new IllegalArgumentException(String.format("Provided chunk size %,d larger than max %,d", this.blockSize, MAX\_BLOCK\_SIZE)); |
|  |  | } |
|  |  | int inputSize = blockSize; |
|  |  | int outputSize = SnappyCodec.HEADER\_SIZE + 4 + Snappy.maxCompressedLength(blockSize); |
|  |  |  |
| Expand Down | |  |

12 changes: 12 additions & 0 deletions

12
[src/test/java/org/xerial/snappy/SnappyOutputStreamTest.java](#diff-96ebfb4495813356e06da7e263ddf73bddc07cc53c68dc4ba1c9075d4f62453e "src/test/java/org/xerial/snappy/SnappyOutputStreamTest.java")

Show comments

[View file](/xerial/snappy-java/blob/9f8c3cf74223ed0a8a834134be9c917b9f10ceb5/src/test/java/org/xerial/snappy/SnappyOutputStreamTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -34,6 +34,7 @@ |
|  |  | import java.nio.ByteOrder; |
|  |  |  |
|  |  | import org.junit.Test; |
|  |  | import org.junit.Assert; |
|  |  | import org.xerial.snappy.buffer.BufferAllocatorFactory; |
|  |  | import org.xerial.snappy.buffer.CachedBufferAllocator; |
|  |  | import org.xerial.snappy.buffer.DefaultBufferAllocator; |
| Expand Down  Expand Up | | @@ -106,6 +107,17 @@ public void bufferSize() |
|  |  | is.close(); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected = IllegalArgumentException.class) |
|  |  | public void invalidBlockSize() |
|  |  | throws Exception |
|  |  | { |
|  |  | // We rely on catch below, if there is no error this test will pass |
|  |  | // This can be done better with Assertions.assertThrows |
|  |  | Boolean exceptionThrown = false; |
|  |  | ByteArrayOutputStream b = new ByteArrayOutputStream(); |
|  |  | SnappyOutputStream os = new SnappyOutputStream(b, 1024 \* 1024 \* 1024); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | public void smallWrites() |
|  |  | throws Exception |
| Expand Down | |  |

18 changes: 18 additions & 0 deletions

18
[src/test/java/org/xerial/snappy/SnappyTest.java](#diff-f82b2093a98cc73850ae6c42eb512c8affda0141c6b4e4523a55ae3660ae74f5 "src/test/java/org/xerial/snappy/SnappyTest.java")

Show comments

[View file](/xerial/snappy-java/blob/9f8c3cf74223ed0a8a834134be9c917b9f10ceb5/src/test/java/org/xerial/snappy/SnappyTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -379,6 +379,24 @@ public void isInvalidChunkLengthForSnappyInputStreamOutOfMemory() |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | Tests sad cases for SnappyInputStream.read method |
|  |  | - Expects a failed to compress exception due to upper bounds chunk size |
|  |  | - {-126, 'S', 'N', 'A', 'P', 'P', 'Y', 0, 0, 0, 0, 0, 0, 0, 0, 0,(byte) 0x7f, (byte) 0xff, (byte) 0xff, (byte) 0xff} |
|  |  | \*/ |
|  |  | @Test |
|  |  | public void isInvalidChunkLengthForSnappyInputStream() |
|  |  | throws Exception { |
|  |  | byte[] data = {-126, 'S', 'N', 'A', 'P', 'P', 'Y', 0, 0, 0, 0, 0, 0, 0, 0, 0, (byte) 0x7f, (byte) 0xff, (byte) 0xff, (byte) 0xff}; |
|  |  | SnappyInputStream in = new SnappyInputStream(new ByteArrayInputStream(data)); |
|  |  | byte[] out = new byte[50]; |
|  |  | try { |
|  |  | in.read(out); |
|  |  | } catch (SnappyError error) { |
|  |  | Assert.assertEquals(error.errorCode, SnappyErrorCode.FAILED\_TO\_UNCOMPRESS); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | Tests happy cases for BitShuffle.shuffle method |
|  |  | - double: 0, 10 |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9f8c3cf`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fcommit%2F9f8c3cf74223ed0a8a834134be9c917b9f10ceb5) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_714d842a_20250111_164341.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fsecurity%2Fadvisories%2FGHSA-55g7-9cwv-5qfv)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fsecurity%2Fadvisories%2FGHSA-55g7-9cwv-5qfv)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=xerial%2Fsnappy-java)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xerial](/xerial)
/
**[snappy-java](/xerial/snappy-java)**
Public

* [Notifications](/login?return_to=%2Fxerial%2Fsnappy-java) You must be signed in to change notification settings
* [Fork
  234](/login?return_to=%2Fxerial%2Fsnappy-java)
* [Star
   1k](/login?return_to=%2Fxerial%2Fsnappy-java)

* [Code](/xerial/snappy-java)
* [Issues
  47](/xerial/snappy-java/issues)
* [Pull requests
  6](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects
  0](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

Additional navigation options

* [Code](/xerial/snappy-java)
* [Issues](/xerial/snappy-java/issues)
* [Pull requests](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

# Missing upper bound check on chunk length in snappy-java can lead to Denial of Service (DoS) impact

High

[xerial](/xerial)
published
GHSA-55g7-9cwv-5qfv
Sep 23, 2023

## Package

maven

snappy-java
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

<= 1.1.10.3

## Patched versions

1.1.10.4

## Description

### Summary

snappy-java is a data compression library in Java. Its SnappyInputStream was found to be vulnerable to Denial of Service (DoS) attacks when decompressing data with a too-large chunk size. Due to missing upper bound check on chunk length, an unrecoverable fatal error can occur.

### Scope

All versions of snappy-java including the latest released version 1.1.10.3. A fix is applied in 1.1.10.4

### Details

While performing mitigation efforts related to [CVE-2023-34455](https://nvd.nist.gov/vuln/detail/CVE-2023-34455) in Confluent products, our Application Security team closely analyzed the fix that was accepted and merged into snappy-java version 1.1.10.1 in [this](https://github.com/xerial/snappy-java/commit/3bf67857fcf70d9eea56eed4af7c925671e8eaea) commit. The check on [line 421](https://github.com/xerial/snappy-java/commit/3bf67857fcf70d9eea56eed4af7c925671e8eaea#diff-c3e53610267092989965e8c7dd2d4417d355ff7f560f9e8075b365f32569079fR421) only attempts to check if chunkSize is not a negative value. We believe that this is an inadequate fix as it misses an upper-bounds check for overly positive values such as 0x7FFFFFFF (or (2,147,483,647 in decimal) before actually [attempting to allocate](https://github.com/xerial/snappy-java/commit/3bf67857fcf70d9eea56eed4af7c925671e8eaea#diff-c3e53610267092989965e8c7dd2d4417d355ff7f560f9e8075b365f32569079fR429) the provided unverified number of bytes via the “chunkSize” variable. This missing upper-bounds check can lead to the applications depending upon snappy-java to allocate an inappropriate number of bytes on the heap which can then cause an java.lang.OutOfMemoryError exception. Under some specific conditions and contexts, this can lead to a Denial-of-Service (DoS) attack with a direct impact on the availability of the dependent implementations based on the usage of the snappy-java library for compression/decompression needs.

### PoC

Compile and run the following code:

```
package org.example;
import org.xerial.snappy.SnappyInputStream;

import java.io.*;

public class Main {

    public static void main(String[] args) throws IOException {
        byte[] data = {-126, 'S', 'N', 'A', 'P', 'P', 'Y', 0, 0, 0, 0, 0, 0, 0, 0, 0,(byte) 0x7f, (byte) 0xff, (byte) 0xff, (byte) 0xff};
        SnappyInputStream in = new SnappyInputStream(new ByteArrayInputStream(data));
        byte[] out = new byte[50];
        try {
            in.read(out);
        }
        catch (Exception ignored) {
        }
    }
}

```
### Impact

Denial of Service of applications dependent on snappy-java especially if `ExitOnOutOfMemoryError` or `CrashOnOutOfMemoryError` is configured on the JVM.

### Credits

Jan Werner, Mukul Khullar and Bharadwaj Machiraju from Confluent's Application Security team.

We kindly request for a new CVE ID to be assigned once you acknowledge this vulnerability.

### Severity

High

7.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H

### CVE ID

CVE-2023-43642

### Weaknesses

[CWE-770](/advisories?query=cwe%3A770)

### Credits

* [![@mkcops](https://avatars.githubusercontent.com/u/74949424?s=40&v=4)](/mkcops)
  [mkcops](/mkcops)
  Reporter
* [![@janjwerner-confluent](https://avatars.githubusercontent.com/u/105367074?s=40&v=4)](/janjwerner-confluent)
  [janjwerner-confluent](/janjwerner-confluent)
  Reporter
* [![@flabbergastedbd](https://avatars.githubusercontent.com/u/2751016?s=40&v=4)](/flabbergastedbd)
  [flabbergastedbd](/flabbergastedbd)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


