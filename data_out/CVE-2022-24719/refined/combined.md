=== Content from github.com_748a0060_20250108_134946.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffluture-js%2Ffluture-node%2Fsecurity%2Fadvisories%2FGHSA-32x6-qvw6-mxj4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffluture-js%2Ffluture-node%2Fsecurity%2Fadvisories%2FGHSA-32x6-qvw6-mxj4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=fluture-js%2Ffluture-node)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fluture-js](/fluture-js)
/
**[fluture-node](/fluture-js/fluture-node)**
Public

* [Notifications](/login?return_to=%2Ffluture-js%2Ffluture-node) You must be signed in to change notification settings
* [Fork
  1](/login?return_to=%2Ffluture-js%2Ffluture-node)
* [Star
   19](/login?return_to=%2Ffluture-js%2Ffluture-node)

* [Code](/fluture-js/fluture-node)
* [Issues
  0](/fluture-js/fluture-node/issues)
* [Pull requests
  2](/fluture-js/fluture-node/pulls)
* [Actions](/fluture-js/fluture-node/actions)
* [Security](/fluture-js/fluture-node/security)
* [Insights](/fluture-js/fluture-node/pulse)

Additional navigation options

* [Code](/fluture-js/fluture-node)
* [Issues](/fluture-js/fluture-node/issues)
* [Pull requests](/fluture-js/fluture-node/pulls)
* [Actions](/fluture-js/fluture-node/actions)
* [Security](/fluture-js/fluture-node/security)
* [Insights](/fluture-js/fluture-node/pulse)

# Forwarding of confidentials headers to third parties in fluture-node

High

[Avaq](/Avaq)
published
GHSA-32x6-qvw6-mxj4
Mar 1, 2022

## Package

npm

fluture-node
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

4.0.0, 4.0.1

## Patched versions

4.0.2

## Description

### Impact

Using `followRedirects` or `followRedirectsWith` with any of the redirection strategies built into fluture-node 4.0.0 or 4.0.1, paired with a request that includes confidential headers such as Authorization or Cookie, exposes you to a vulnerability where, if the destination server were to redirect the request to a server on a third-party domain, or the same domain over unencrypted HTTP, the headers would be included in the follow-up request and be exposed to the third party, or potential http traffic sniffing.

### Patches

The redirection strategies made available in version 4.0.2 automatically redact confidential headers when a redirect is followed across to another origin.

### Workarounds

Use a custom redirection strategy via the `followRedirectsWith` function. The custom strategy can be based on the new strategies available in fluture-node@4.0.2.

### References

* This vulnerability was discovered after the announcement of similar vulnerabilities in the `follow-redirects` package. There is more information there: [GHSA-74fj-2j2h-c42q](https://github.com/advisories/GHSA-74fj-2j2h-c42q "GHSA-74fj-2j2h-c42q") and <https://huntr.dev/bounties/7cf2bf90-52da-4d59-8028-a73b132de0db/>
* Fixed in [125e447](https://github.com/fluture-js/fluture-node/commit/125e4474f910c1507f8ec3232848626fbc0f55c4) and [0c99bc5](https://github.com/fluture-js/fluture-node/commit/0c99bc511533d48be17dc6bfe641f7d0aeb34d77)

### Severity

High

### CVE ID

CVE-2022-24719

### Weaknesses

[CWE-359](/advisories?query=cwe%3A359)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4e9ff0b7_20250108_134949.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpsf%2Frequests%2Fpull%2F4718)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpsf%2Frequests%2Fpull%2F4718)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=psf%2Frequests)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[psf](/psf)
/
**[requests](/psf/requests)**
Public

* [Notifications](/login?return_to=%2Fpsf%2Frequests) You must be signed in to change notification settings
* [Fork
  9.3k](/login?return_to=%2Fpsf%2Frequests)
* [Star
   52.3k](/login?return_to=%2Fpsf%2Frequests)

* [Code](/psf/requests)
* [Issues
  184](/psf/requests/issues)
* [Pull requests
  78](/psf/requests/pulls)
* [Actions](/psf/requests/actions)
* [Wiki](/psf/requests/wiki)
* [Security](/psf/requests/security)
* [Insights](/psf/requests/pulse)

Additional navigation options

* [Code](/psf/requests)
* [Issues](/psf/requests/issues)
* [Pull requests](/psf/requests/pulls)
* [Actions](/psf/requests/actions)
* [Wiki](/psf/requests/wiki)
* [Security](/psf/requests/security)
* [Insights](/psf/requests/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fpsf%2Frequests%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fpsf%2Frequests%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Strip Authorization header whenever root URL changes #4718

 Merged

[nateprewitt](/nateprewitt)
merged 2 commits into
[psf:master](/psf/requests/tree/master "psf/requests:master")
from
[bmerry:fix-4716](/bmerry/requests/tree/fix-4716 "bmerry/requests:fix-4716")

Sep 14, 2018

 Merged

# [Strip Authorization header whenever root URL changes](#top) #4718

[nateprewitt](/nateprewitt)
merged 2 commits into
[psf:master](/psf/requests/tree/master "psf/requests:master")
from
[bmerry:fix-4716](/bmerry/requests/tree/fix-4716 "bmerry/requests:fix-4716")

Sep 14, 2018

[Conversation
39](/psf/requests/pull/4718)
[Commits
2](/psf/requests/pull/4718/commits)
[Checks
0](/psf/requests/pull/4718/checks)
[Files changed](/psf/requests/pull/4718/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![bmerry](https://avatars.githubusercontent.com/u/1963944?s=60&v=4)](/bmerry)

Copy link

Contributor

### @bmerry **[bmerry](/bmerry)** commented [Jun 28, 2018](#issue-336654286)

Previously the header was stripped only if the hostname changed, but in

an https -> http redirect that can leak the credentials on the wire

([#4716](https://github.com/psf/requests/issues/4716)). Based on with RFC 7235 section 2.2, the header is now stripped

if the "canonical root URL" (scheme+authority) has changed.

Closes [#4716](https://github.com/psf/requests/issues/4716).

Sorry, something went wrong.

All reactions

[![@codecov-io](https://avatars.githubusercontent.com/u/8655789?s=80&u=4694f03b321aa2287d9fe05155adcddb23272e81&v=4)](/codecov-io)

Copy link

### **[codecov-io](/codecov-io)** commented [Jun 28, 2018](#issuecomment-401066126) • edited Loading

|  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://codecov.io/gh/requests/requests/pull/4718?src=pr&el=h1) Report Merging [#4718](https://codecov.io/gh/requests/requests/pull/4718?src=pr&el=desc) into [master](https://codecov.io/gh/requests/requests/commit/33b41c7880a02166d12915ca9c4cfc13de2d9fb7?src=pr&el=desc) will **decrease** coverage by `0.02%`. The diff coverage is `90%`.  [Impacted file tree graph](https://codecov.io/gh/requests/requests/pull/4718?src=pr&el=tree)  ``` @@            Coverage Diff             @@ ##           master    #4718      +/-   ## ========================================== - Coverage   66.79%   66.77%   -0.03%      ==========================================   Files          15       15                 Lines        1563     1568       +5      ========================================== + Hits         1044     1047       +3      - Misses        519      521       +2 ```  | [Impacted Files](https://codecov.io/gh/requests/requests/pull/4718?src=pr&el=tree) | Coverage Δ |  | | --- | --- | --- | | [requests/sessions.py](https://codecov.io/gh/requests/requests/pull/4718/diff?src=pr&el=tree#diff-cmVxdWVzdHMvc2Vzc2lvbnMucHk=) | `76.34% <90%> (+0.06%)` | ⬆️ | | [requests/models.py](https://codecov.io/gh/requests/requests/pull/4718/diff?src=pr&el=tree#diff-cmVxdWVzdHMvbW9kZWxzLnB5) | `77.35% <0%> (-0.23%)` | ⬇️ |   ---   [Continue to review full report at Codecov](https://codecov.io/gh/requests/requests/pull/4718?src=pr&el=continue).  **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta) `Δ = absolute <relative> (impact)`, `ø = not affected`, `? = missing data` Powered by [Codecov](https://codecov.io/gh/requests/requests/pull/4718?src=pr&el=footer). Last update [33b41c7...2f24e02](https://codecov.io/gh/requests/requests/pull/4718?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments). |

All reactions

Sorry, something went wrong.

[![nateprewitt](https://avatars.githubusercontent.com/u/5271761?s=60&v=4)](/nateprewitt)

**[nateprewitt](/nateprewitt)**
requested changes
[Jun 28, 2018](#pullrequestreview-132958228)

 [View reviewed changes](/psf/requests/pull/4718/files)

Copy link

Member

### @nateprewitt **[nateprewitt](/nateprewitt)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Hi [@bmerry](https://github.com/bmerry), thanks for contributing to Requests! I agree that this behavior does seem wrong and we ideally shouldn’t be sending credentials across the wire in clear view. I took a quick look but was surprisingly unable to find this discussed before. While I’m inclined to merge this, there’s likely some concern about breaking users relying on us not doing the right thing here. I’d like [@sigmavirus24](https://github.com/sigmavirus24) to weigh in with his thoughts before we move forward.

In the meantime, I’ve left a couple minor notes on some of the changes.

Sorry, something went wrong.

All reactions

[requests/sessions.py](/psf/requests/pull/4718/files#diff-c80d84057edadb04b5615f7169c55f88ccda358d7c20af966afb20c0d0d1056a)
Outdated

|  |  | @@ -239,10 +239,10 @@ def rebuild\_auth(self, prepared\_request, response): | |
| --- | --- | --- | --- |
|  |  | if 'Authorization' in headers: |
|  |  | # If we get redirected to a new host, we should strip out any |
|  |  | # authentication headers. |
|  |  | original\_parsed = urlparse(response.request.url) |
|  |  | redirect\_parsed = urlparse(url) |
|  |  | original\_root = urljoin(response.request.url, '/') |

Copy link

Member

### @nateprewitt **[nateprewitt](/nateprewitt)** [Jun 28, 2018](#discussion_r198934960)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

We may want to do the explicit check on scheme, hostname, and port here. Otherwise a url with credentials that’s redirected without credentials may have the Authorization header unnecessarily stripped.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @bmerry **[bmerry](/bmerry)** [Jun 28, 2018](#discussion_r198938488)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Fair enough, I hadn't spotted that the username and password are still present in response.request.url.

Sorry, something went wrong.

All reactions

[tests/test\_requests.py](/psf/requests/pull/4718/files#diff-05180dda5cdc530f95d400932961d6152bd515a6447af23d22c7f335b390b9d8)
Outdated

|  |  | verify=httpbin\_ca\_bundle |
| --- | --- | --- |
|  |  | ) |
|  |  | assert r.history[0].request.headers['Authorization'] |
|  |  | assert not r.request.headers.get('Authorization', '') |

Copy link

Member

### @nateprewitt **[nateprewitt](/nateprewitt)** [Jun 28, 2018](#discussion_r198935315)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

We should be explicit here and validate that `Authorization` is not in the request headers rather than checking if the value is falsey.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @bmerry **[bmerry](/bmerry)** [Jun 28, 2018](#discussion_r198938605)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I was just copying the test above it, but I agree that would be an improvement. Will fix it tomorrow.

Sorry, something went wrong.

All reactions

[![@bmerry](https://avatars.githubusercontent.com/u/1963944?s=80&v=4)](/bmerry)

Copy link

Contributor

Author

### **[bmerry](/bmerry)** commented [Jun 28, 2018](#issuecomment-401127874)

| While I’m inclined to merge this, there’s likely some concern about breaking users relying on us not doing the right thing here.  Totally understood. There is always [someone](https://xkcd.com/1172/). |
| --- |

All reactions

Sorry, something went wrong.

[![@sethmlarson](https://avatars.githubusercontent.com/u/18519037?s=80&u=41090cc65ae0a34aee49c7a35cfbd40e2e12eb53&v=4)](/sethmlarson)

Copy link

Member

### **[sethmlarson](/sethmlarson)** commented [Jun 28, 2018](#issuecomment-401145957)

| I'll just leave this here: [urllib3/urllib3#1346](https://github.com/urllib3/urllib3/pull/1346) |
| --- |

 👍
1
 danielpsf reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@nateprewitt](https://avatars.githubusercontent.com/u/5271761?s=80&u=1ef6aa21d55fa14a7b435d16509013bd1267f602&v=4)](/nateprewitt)

Copy link

Member

### **[nateprewitt](/nateprewitt)** commented [Jun 28, 2018](#issuecomment-401163910)

| [@SethMichaelLarson](https://github.com/SethMichaelLarson) we currently perform the redirects manually because we’ve got a few more steps we perform. I’ve looked at moving to urllib3 with 1.23 but don’t know if I see an easy route that guarantees we maintain our 2.X expectations. |
| --- |

 👍
1
 sethmlarson reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@sethmlarson](https://avatars.githubusercontent.com/u/18519037?s=80&u=41090cc65ae0a34aee49c7a35cfbd40e2e12eb53&v=4)](/sethmlarson)

Copy link

Member

### **[sethmlarson](/sethmlarson)** commented [Jun 28, 2018](#issuecomment-401167379)

| [@nateprewitt](https://github.com/nateprewitt) TIL! Thanks for teaching me that. :) |
| --- |

All reactions

Sorry, something went wrong.

 [![@bmerry](https://avatars.githubusercontent.com/u/1963944?s=40&v=4)](/bmerry)
[bmerry](/bmerry)
[force-pushed](/psf/requests/compare/f8b45f0271ecf084ce83c7b7f1d0e6558a0c20d4..3fbdd888a6406108edcf0633637dac8cbff757bc)
the
fix-4716

branch
from
[`f8b45f0`](/psf/requests/commit/f8b45f0271ecf084ce83c7b7f1d0e6558a0c20d4) to
[`3fbdd88`](/psf/requests/commit/3fbdd888a6406108edcf0633637dac8cbff757bc)  [Compare](/psf/requests/compare/f8b45f0271ecf084ce83c7b7f1d0e6558a0c20d4..3fbdd888a6406108edcf0633637dac8cbff757bc)
[June 29, 2018 07:09](#event-1707987559)

[![@bmerry](https://avatars.githubusercontent.com/u/1963944?s=80&v=4)](/bmerry)

Copy link

Contributor

Author

### **[bmerry](/bmerry)** commented [Jun 29, 2018](#issuecomment-401268557)

| [@nateprewitt](https://github.com/nateprewitt) I've made the changes you suggested.  [@SethMichaelLarson](https://github.com/SethMichaelLarson) so what behaviour does urllib3 have on https->http redirects to the same host? |
| --- |

All reactions

Sorry, something went wrong.

[![@sigmavirus24](https://avatars.githubusercontent.com/u/240830?s=80&u=cfe7ddccc58238bedb4176ff2a8dbc200c6a314d&v=4)](/sigmavirus24)

Copy link

Contributor

### **[sigmavirus24](/sigmavirus24)** commented [Jun 29, 2018](#issuecomment-401418508)

| [@nateprewitt](https://github.com/nateprewitt) this shouldn't break too many people. The major breaking change already happened years ago. I'm 100% 👍 on this. I haven't reviewed the code though. |
| --- |

All reactions

Sorry, something went wrong.

[![sigmavirus24](https://avatars.githubusercontent.com/u/240830?s=60&v=4)](/sigmavirus24)

**[sigmavirus24](/sigmavirus24)**
reviewed
[Jun 29, 2018](#pullrequestreview-133309157)

 [View reviewed changes](/psf/requests/pull/4718/files)

[tests/test\_requests.py](/psf/requests/pull/4718/files#diff-05180dda5cdc530f95d400932961d6152bd515a6447af23d22c7f335b390b9d8)
Outdated

|  |  | verify=httpbin\_ca\_bundle |
| --- | --- | --- |
|  |  | ) |
|  |  | assert r.history[0].request.headers['Authorization'] |
|  |  | assert 'Authorization' not in r.request.headers |

Copy link

Contributor

### @sigmavirus24 **[sigmavirus24](/sigmavirus24)** [Jun 29, 2018](#discussion_r199226219)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

`r.json()['headers']` should also be a way to verify that it wasn't *sent*

Sorry, something went wrong.

All reactions

[![sigmavirus24](https://avatars.githubusercontent.com/u/240830?s=60&v=4)](/sigmavirus24)

**[sigmavirus24](/sigmavirus24)**
reviewed
[Jun 29, 2018](#pullrequestreview-133309445)

 [View reviewed changes](/psf/requests/pull/4718/files)

[requests/sessions.py](/psf/requests/pull/4718/files#diff-c80d84057edadb04b5615f7169c55f88ccda358d7c20af966afb20c0d0d1056a)
Outdated

|  |  | if (original\_parsed.hostname != redirect\_parsed.hostname): |
| --- | --- | --- |
|  |  | if (original\_parsed.hostname != redirect\_parsed.hostname |
|  |  | or original\_parsed.port != redirect\_parsed.port |
|  |  | or original\_parsed.scheme != redirect\_parsed.scheme): |

Copy link

Contributor

### @sigmavirus24 **[sigmavirus24](/sigmavirus24)** [Jun 29, 2018](#discussion_r199226444)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I think this might need to be a bit different. I think if someone sent credentials over `HTTP` and we're being redirected to the same domain but it's `HTTPS` we should allow that. That's a secure upgrade. The opposite should not be allowed.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @bmerry **[bmerry](/bmerry)** [Jun 29, 2018](#discussion_r199236189)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I did it this way based on RFC 7235:

> A protection space is defined by the canonical root URI (the scheme
>
> and authority components of the effective request URI; see Section
>
> 5.5 of [RFC7230]) of the server being accessed, in combination with
>
> the realm value if present.

...

> The protection space determines the domain over which credentials can
>
> be automatically applied. If a prior request has been authorized,
>
> the user agent MAY reuse the same credentials for all other requests
>
> within that protection space for a period of time determined by the
>
> authentication scheme, parameters, and/or user preferences (such as a
>
> configurable inactivity timeout).

While it's not explicit, the implication is that a user agent may not automatically reuse the credentials outside the protection space, and a change from http -> https is a change in protection space.

Sorry, something went wrong.

All reactions

Copy link

Member

### @nateprewitt **[nateprewitt](/nateprewitt)** [Jul 2, 2018](#discussion_r199569417)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@bmerry](https://github.com/bmerry), just to be clear, the spec you’re referencing is specifically about the realm attribute, which is different that what we’re doing here.

If we look at browsers for reference here, upgrade redirects maintain Authorization headers. Breaking this will make a common pattern pretty painful for most users.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @bmerry **[bmerry](/bmerry)** [Jul 2, 2018](#discussion_r199577864)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Strange, I thought I'd tested the http -> https case with Firefox and Chromium and neither had sent the Authorization header. I'll take a closer look at my test when I'm in the office tomorrow.

Just to check that I'm testing the same thing that you're referring to: my test is a localhost Apache server listening on http and https. On http it is set up to require basic auth, and on some path it is set up to send a 302 redirect to somewhere on https. I point the browser at the http port, I get a WWW-Authenticate challenge and I type in username+password, I then get redirected to https and the browser either does or doesn't automatically send the same credentials immediately without another WWW-Authenticate challenge?

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @bmerry **[bmerry](/bmerry)** [Jul 3, 2018](#discussion_r199720262)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I've redone my test, using `openssl s_server` to see the request headers that the browser sends to the https port after the redirect. Firefox definitely isn't preserving the Authorization header across the redirect. Let me know if you'd like more details to reproduce the test (httpd.conf etc) using Docker.

Sorry, something went wrong.

All reactions

Load more…

Copy link

Contributor

Author

### @bmerry **[bmerry](/bmerry)** [Aug 13, 2018](#discussion_r209660749)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Yes

```
>>> print(urllib.parse.urlparse('http://example.com/').port)
None
>>> print(urllib.parse.urlparse('http://example.com:80/').port)
80
```

Sorry, something went wrong.

All reactions

Copy link

Member

### @sethmlarson **[sethmlarson](/sethmlarson)** [Aug 13, 2018](#discussion_r209665887)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

So we'd have to account for that in our comparison above as we want `http://example.com:80` -> `https://example.com` to work the same as `http://example.com` -> `https://example.com`.

Sorry, something went wrong.

All reactions

Copy link

Member

### @nateprewitt **[nateprewitt](/nateprewitt)** [Aug 13, 2018](#discussion_r209668067)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

At this point there’s enough complexity in this implementation we should probably move it into it’s own check function.

I think Seth’s assessment is right here. We want to check the following:

1. The hostnames match.
2. The schemes match...
   * Except in the case of http->https
   * If scheme change is http->https, origin port may be 80 or None and destination port may be 443 or None.
3. Ports match, except in above scenario.
4. Same scheme and hostname but varied port results in stripped auth.

Sorry, something went wrong.

 👍
1
 sethmlarson reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Copy link

Contributor

Author

### @bmerry **[bmerry](/bmerry)** [Aug 14, 2018](#discussion_r209917194)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Sounds sensible to me. I've implemented that in the latest push.

I've left the logic in a public method of SessionRedirectMixin, because that gives the user the option to override it in a subclass, but let me know if I should move it to utils.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @bmerry **[bmerry](/bmerry)** [Aug 23, 2018](#discussion_r212280641)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Ping? I think I've addressed the comments so far.

Sorry, something went wrong.

All reactions

[![@bmerry](https://avatars.githubusercontent.com/u/1963944?s=80&v=4)](/bmerry)

Copy link

Contributor

Author

### **[bmerry](/bmerry)** commented [Sep 5, 2018](#issuecomment-418638287)

| [@nateprewitt](https://github.com/nateprewitt) is there anything still outstanding here? |
| --- |

All reactions

Sorry, something went wrong.

[![sethmlarson](https://avatars.githubusercontent.com/u/18519037?s=60&v=4)](/sethmlarson)

**[sethmlarson](/sethmlarson)**
previously approved these changes
[Sep 5, 2018](#pullrequestreview-152489974)

 [View reviewed changes](/psf/requests/pull/4718/files)

[![nateprewitt](https://avatars.githubusercontent.com/u/5271761?s=60&v=4)](/nateprewitt)

**[nateprewitt](/nateprewitt)**
previously approved these changes
[Sep 5, 2018](#pullrequestreview-152555114)

 [View reviewed changes](/psf/requests/pull/4718/files)

Copy link

Member

### @nateprewitt **[nateprewitt](/nateprewitt)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Ok, I think this is set to go. Thanks for driving this, [@bmerry](https://github.com/bmerry)!

Sorry, something went wrong.

All reactions

[![@nateprewitt](https://avatars.githubusercontent.com/u/5271761?s=80&u=1ef6aa21d55fa14a7b435d16509013bd1267f602&v=4)](/nateprewitt)

Copy link

Member

### **[nateprewitt](/nateprewitt)** commented [Sep 5, 2018](#issuecomment-418774296)

| Actually sorry [@bmerry](https://github.com/bmerry), it looks like this isn’t rebased onto master. Would you mind rebasing really quickly and then we can get this merged. |
| --- |

All reactions

Sorry, something went wrong.

 [![@bmerry](https://avatars.githubusercontent.com/u/1963944?s=40&v=4)](/bmerry)
[bmerry](/bmerry)
dismissed stale reviews from [nateprewitt](/nateprewitt) and [sethmlarson](/sethmlarson)
via
`[2f24e02](/psf/requests/commit/2f24e02d3c86b4f437ac41cd6574c5a51e983f07)`
[September 5, 2018 16:09](#event-1828280014)

 [![@bmerry](https://avatars.githubusercontent.com/u/1963944?s=40&v=4)](/bmerry)
[bmerry](/bmerry)
[force-pushed](/psf/requests/compare/548a0e04660fca37b24186c7743fb8e5a69aaa1b..2f24e02d3c86b4f437ac41cd6574c5a51e983f07)
the
fix-4716

branch
from
[`548a0e0`](/psf/requests/commit/548a0e04660fca37b24186c7743fb8e5a69aaa1b) to
[`2f24e02`](/psf/requests/commit/2f24e02d3c86b4f437ac41cd6574c5a51e983f07)  [Compare](/psf/requests/compare/548a0e04660fca37b24186c7743fb8e5a69aaa1b..2f24e02d3c86b4f437ac41cd6574c5a51e983f07)
[September 5, 2018 16:09](#event-1828280016)

[![@bmerry](https://avatars.githubusercontent.com/u/1963944?s=80&v=4)](/bmerry)

Copy link

Contributor

Author

### **[bmerry](/bmerry)** commented [Sep 5, 2018](#issuecomment-418788545)

| Ok, I've rebased. |
| --- |

All reactions

Sorry, something went wrong.

[![nateprewitt](https://avatars.githubusercontent.com/u/5271761?s=60&v=4)](/nateprewitt)

**[nateprewitt](/nateprewitt)**
previously approved these changes
[Sep 5, 2018](#pullrequestreview-152578619)

 [View reviewed changes](/psf/requests/pull/4718/files)

 [bmerry](/bmerry)
added 2 commits
[September 14, 2018 10:44](#commits-pushed-3331e2a)

[![@bmerry](https://avatars.githubusercontent.com/u/1963944?s=40&v=4)](/bmerry)

`[Strip Authorization header whenever root URL changes](/psf/requests/pull/4718/commits/3331e2aecdbf575dd60abef4df79c52d78610a83 "Strip Authorization header whenever root URL changes

Previously the header was stripped only if the hostname changed, but in
an https -> http redirect that can leak the credentials on the wire
(#4716). Based on with RFC 7235 section 2.2, the header is now stripped
if the \"canonical root URL\" (scheme+authority) has changed, by checking
scheme, hostname and port.")`
 …

`[3331e2a](/psf/requests/pull/4718/commits/3331e2aecdbf575dd60abef4df79c52d78610a83)`

```
Previously the header was stripped only if the hostname changed, but in
an https -> http redirect that can leak the credentials on the wire
([psf#4716](https://github.com/psf/requests/issues/4716)). Based on with RFC 7235 section 2.2, the header is now stripped
if the "canonical root URL" (scheme+authority) has changed, by checking
scheme, hostname and port.
```

[![@bmerry](https://avatars.githubusercontent.com/u/1963944?s=40&v=4)](/bmerry)

`[Rework authorization stripping logic as discussed](/psf/requests/pull/4718/commits/857e9b7ac20c3accf4cc328f594aecb8b6a644a6 "Rework authorization stripping logic as discussed

The exception for http->https upgrade now requires the standard HTTP(S)
ports to be used, either implicitly (no port specified) or explicitly.")`
 …

`[857e9b7](/psf/requests/pull/4718/commits/857e9b7ac20c3accf4cc328f594aecb8b6a644a6)`

```
The exception for http->https upgrade now requires the standard HTTP(S)
ports to be used, either implicitly (no port specified) or explicitly.
```

 [![@bmerry](https://avatars.githubusercontent.com/u/1963944?s=40&v=4)](/bmerry)
[bmerry](/bmerry)
dismissed
[nateprewitt](/nateprewitt)’s [stale review](#pullrequestreview-152578619)
via
`[857e9b7](/psf/requests/commit/857e9b7ac20c3accf4cc328f594aecb8b6a644a6)`
[September 14, 2018 08:45](#event-1845528930)

 [![@bmerry](https://avatars.githubusercontent.com/u/1963944?s=40&v=4)](/bmerry)
[bmerry](/bmerry)
[force-pushed](/psf/requests/compare/2f24e02d3c86b4f437ac41cd6574c5a51e983f07..857e9b7ac20c3accf4cc328f594aecb8b6a644a6)
the
fix-4716

branch
from
[`2f24e02`](/psf/requests/commit/2f24e02d3c86b4f437ac41cd6574c5a51e983f07) to
[`857e9b7`](/psf/requests/commit/857e9b7ac20c3accf4cc328f594aecb8b6a644a6)  [Compare](/psf/requests/compare/2f24e02d3c86b4f437ac41cd6574c5a51e983f07..857e9b7ac20c3accf4cc328f594aecb8b6a644a6)
[September 14, 2018 08:45](#event-1845528931)

[![@bmerry](https://avatars.githubusercontent.com/u/1963944?s=80&v=4)](/bmerry)

Copy link

Contributor

Author

### **[bmerry](/bmerry)** commented [Sep 14, 2018](#issuecomment-421276916)

| And I've rebased again. |
| --- |

All reactions

Sorry, something went wrong.

[![nateprewitt](https://avatars.githubusercontent.com/u/5271761?s=60&v=4)](/nateprewitt)

**[nateprewitt](/nateprewitt)**
approved these changes
[Sep 14, 2018](#pullrequestreview-155466028)

 [View reviewed changes](/psf/requests/pull/4718/files/857e9b7ac20c3accf4cc328f594aecb8b6a644a6)

Copy link

Member

### @nateprewitt **[nateprewitt](/nateprewitt)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Ok, this still looks good. Thanks again for driving this [@bmerry](https://github.com/bmerry)!

Sorry, something went wrong.

All reactions

[![@nateprewitt](https://avatars.githubusercontent.com/u/5271761?s=40&u=1ef6aa21d55fa14a7b435d16509013bd1267f602&v=4)](/nateprewitt)
[nateprewitt](/nateprewitt)
merged commit [`c45d7c4`](/psf/requests/commit/c45d7c49ea75133e52ab22a8e9e13173938e36ff)
into
psf:master

[Sep 14, 2018](https://github.com/psf/requests/pull/4718#event-1845949830)

[![@ofek](https://avatars.githubusercontent.com/u/9677399?s=80&u=386c330f212ce467ce7119d9615c75d0e9b9f1ce&v=4)](/ofek)

Copy link

Contributor

### **[ofek](/ofek)** commented [Oct 11, 2018](#issuecomment-429097874)

| Are there plans to release this security fix soon? |
| --- |

All reactions

Sorry, something went wrong.

[![@nateprewitt](https://avatars.githubusercontent.com/u/5271761?s=80&u=1ef6aa21d55fa14a7b435d16509013bd1267f602&v=4)](/nateprewitt)

Copy link

Member

### **[nateprewitt](/nateprewitt)** commented [Oct 11, 2018](#issuecomment-429099394)

| [@ofek](https://github.com/ofek), it’d be preferable to coordinate with urllib3 to avoid having to do multiple releases. I don’t think we have a timeline to commit to, but we may be able to do something in the next 3-8 weeks. If it’s going to go beyond that, we can look at cutting a Requests release without urllib3. |
| --- |

 👍
1
 ofek reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@sethmlarson](https://avatars.githubusercontent.com/u/18519037?s=80&u=41090cc65ae0a34aee49c7a35cfbd40e2e12eb53&v=4)](/sethmlarson)

Copy link

Member

### **[sethmlarson](/sethmlarson)** commented [Oct 11, 2018](#issuecomment-429103541)

| [@nateprewitt](https://github.com/nateprewitt) feel free to ping one of us if ya'll want to make a release with us, we've been due for a release as well. Reminder: the next release of urllib3 will have dropped Python 2.6 support. |
| --- |

 🎉
1
 ofek reacted with hooray emoji

All reactions

* 🎉
  1 reaction

Sorry, something went wrong.

[![@nateprewitt](https://avatars.githubusercontent.com/u/5271761?s=80&u=1ef6aa21d55fa14a7b435d16509013bd1267f602&v=4)](/nateprewitt)

Copy link

Member

### **[nateprewitt](/nateprewitt)** commented [Oct 11, 2018](#issuecomment-429112272)

| [@SethMichaelLarson](https://github.com/SethMichaelLarson) Yep, we’ll make sure that’s surfaced in the release notes. I’ll ping you and/or Thea this weekend and we can work out a timeline. |
| --- |

 ❤️
1
 ofek reacted with heart emoji

All reactions

* ❤️
  1 reaction

Sorry, something went wrong.

[![@kbabioch](https://avatars.githubusercontent.com/u/1918279?s=80&u=563047beb7e01ddeda5f5c5e9b2522d108752557&v=4)](/kbabioch)

Copy link

### **[kbabioch](/kbabioch)** commented [Oct 12, 2018](#issuecomment-429270047)

| This has been assigned [CVE-2018-18074](https://github.com/advisories/GHSA-x84v-xcm2-53pg "CVE-2018-18074") |
| --- |

 👍
2
 JeremyVriens and joshuarli reacted with thumbs up emoji

All reactions

* 👍
  2 reactions

Sorry, something went wrong.

[![@webmaven](https://avatars.githubusercontent.com/u/438502?s=40&v=4)](/webmaven)
[webmaven](/webmaven)
mentioned this pull request
[Oct 16, 2018](#ref-pullrequest-370689050)

[CVE URLs update: www sub-subdomain no longer valid
#4827](/psf/requests/pull/4827)
 Merged

[![@ofek](https://avatars.githubusercontent.com/u/9677399?s=40&u=386c330f212ce467ce7119d9615c75d0e9b9f1ce&v=4)](/ofek)
[ofek](/ofek)
mentioned this pull request
[Oct 17, 2018](#ref-pullrequest-371218896)

[Allow urllib3 1.24
#4836](/psf/requests/pull/4836)
 Closed

[![@nateprewitt](https://avatars.githubusercontent.com/u/5271761?s=40&u=1ef6aa21d55fa14a7b435d16509013bd1267f602&v=4)](/nateprewitt)
[nateprewitt](/nateprewitt)
mentioned this pull request
[Oct 29, 2018](#ref-pullrequest-374876069)

[proper handling for default ports in auth stripping
#4851](/psf/requests/pull/4851)
 Merged

[paicha](/paicha)
added a commit
to paicha/gxgk-wechat-server
that referenced
this pull request
[Oct 30, 2018](#ref-commit-1e44e16)
[![@paicha](https://avatars.githubusercontent.com/u/5148245?s=40&u=780afcd3e7e232f8cc0988768832eee9bfce4efb&v=4)](/paicha)

`[Update requirements.txt](/paicha/gxgk-wechat-server/commit/1e44e1603495d0aa77953237e84502b87a6372b1 "Update requirements.txt

https://github.com/requests/requests/pull/4718")`
…

`[1e44e16](/paicha/gxgk-wechat-server/commit/1e44e1603495d0aa77953237e84502b87a6372b1)`

```
[psf/requests#4718](https://github.com/psf/requests/pull/4718)
```

[![@nateprewitt](https://avatars.githubusercontent.com/u/5271761?s=40&u=1ef6aa21d55fa14a7b435d16509013bd1267f602&v=4)](/nateprewitt)
[nateprewitt](/nateprewitt)
mentioned this pull request
[Dec 12, 2018](#ref-issue-390330768)

[Address CVE-2018-20060
#4907](/psf/requests/issues/4907)

Closed

[artemv](/artemv)
referenced
this pull request
in artemv/papertrail-python-cli
[Feb 12, 2019](#ref-commit-ed3c879)
[![@artemv](https://avatars.githubusercontent.com/u/11217?s=40&u=598e55ee9740de3e5c8b84f94bdfaa310dc70f58&v=4)](/artemv)

`[chore(deps): upgrade requests](/artemv/papertrail-python-cli/commit/ed3c879550771e5a3ce099c151c96214103a33e8 "chore(deps): upgrade requests

as per GitHub advise re CVE-2018-20060

re https://github.com/kennethreitz/requests/pull/4718")`
…

`[ed3c879](/artemv/papertrail-python-cli/commit/ed3c879550771e5a3ce099c151c96214103a33e8)`

```
as per GitHub advise re [CVE-2018-20060](https://github.com/advisories/GHSA-www2-v7xj-xrc6 "CVE-2018-20060")

re <https://github.com/kennethreitz/requests/pull/4718>
```

[artemv](/artemv)
referenced
this pull request
in artemv/papertrail-python-cli
[Feb 14, 2019](#ref-commit-b644968)
[![@artemv](https://avatars.githubusercontent.com/u/11217?s=40&u=598e55ee9740de3e5c8b84f94bdfaa310dc70f58&v=4)](/artemv)

`[chore(deps): upgrade requests](/artemv/papertrail-python-cli/commit/b6449680e5746a675bd0ae7d006a29bd2ebc8fb4 "chore(deps): upgrade requests

as per GitHub advise re CVE-2018-20060

re https://github.com/kennethreitz/requests/pull/4718")`
…

`[b644968](/artemv/papertrail-python-cli/commit/b6449680e5746a675bd0ae7d006a29bd2ebc8fb4)`

```
as per GitHub advise re [CVE-2018-20060](https://github.com/advisories/GHSA-www2-v7xj-xrc6 "CVE-2018-20060")

re <https://github.com/kennethreitz/requests/pull/4718>
```

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
locked as **resolved** and limited conversation to collaborators
[Sep 1, 2021](#event-5235883085)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpsf%2Frequests%2Fpull%2F4718).

Reviewers

[![@sigmavirus24](https://avatars.githubusercontent.com/u/240830?s=40&v=4)](/sigmavirus24) [sigmavirus24](/sigmavirus24)

sigmavirus24 left review comments

[![@nateprewitt](https://avatars.githubusercontent.com/u/5271761?s=40&v=4)](/nateprewitt) [nateprewitt](/nateprewitt)

nateprewitt approved these changes

[![@sethmlarson](https://avatars.githubusercontent.com/u/18519037?s=40&v=4)](/sethmlarson) [sethmlarson](/sethmlarson)

sethmlarson left review comments

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

8 participants

[![@bmerry](https://avatars.githubusercontent.com/u/1963944?s=52&v=4)](/bmerry) [![@codecov-io](https://avatars.githubusercontent.com/u/8655789?s=52&v=4)](/codecov-io) [![@sethmlarson](https://avatars.githubusercontent.com/u/18519037?s=52&v=4)](/sethmlarson) [![@nateprewitt](https://avatars.githubusercontent.com/u/5271761?s=52&v=4)](/nateprewitt) [![@sigmavirus24](https://avatars.githubusercontent.com/u/240830?s=52&v=4)](/sigmavirus24) [![@ofek](https://avatars.githubusercontent.com/u/9677399?s=52&v=4)](/ofek) [![@kbabioch](https://avatars.githubusercontent.com/u/1918279?s=52&v=4)](/kbabioch) [![@quickwind](https://avatars.githubusercontent.com/u/6889221?s=52&v=4)](/quickwind)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_49bc63a0_20250108_134945.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffluture-js%2Ffluture-node%2Fcommit%2F0c99bc511533d48be17dc6bfe641f7d0aeb34d77)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffluture-js%2Ffluture-node%2Fcommit%2F0c99bc511533d48be17dc6bfe641f7d0aeb34d77)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=fluture-js%2Ffluture-node)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fluture-js](/fluture-js)
/
**[fluture-node](/fluture-js/fluture-node)**
Public

* [Notifications](/login?return_to=%2Ffluture-js%2Ffluture-node) You must be signed in to change notification settings
* [Fork
  1](/login?return_to=%2Ffluture-js%2Ffluture-node)
* [Star
   19](/login?return_to=%2Ffluture-js%2Ffluture-node)

* [Code](/fluture-js/fluture-node)
* [Issues
  0](/fluture-js/fluture-node/issues)
* [Pull requests
  2](/fluture-js/fluture-node/pulls)
* [Actions](/fluture-js/fluture-node/actions)
* [Security](/fluture-js/fluture-node/security)
* [Insights](/fluture-js/fluture-node/pulse)

Additional navigation options

* [Code](/fluture-js/fluture-node)
* [Issues](/fluture-js/fluture-node/issues)
* [Pull requests](/fluture-js/fluture-node/pulls)
* [Actions](/fluture-js/fluture-node/actions)
* [Security](/fluture-js/fluture-node/security)
* [Insights](/fluture-js/fluture-node/pulse)

## Commit

[Permalink](/fluture-js/fluture-node/commit/0c99bc511533d48be17dc6bfe641f7d0aeb34d77)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix notion of cross-origin to include scheme changes

[Browse files](/fluture-js/fluture-node/tree/0c99bc511533d48be17dc6bfe641f7d0aeb34d77)
Browse the repository at this point in the history

* Loading branch information

[![@Avaq](https://avatars.githubusercontent.com/u/1217745?s=40&v=4)](/Avaq)

[Avaq](/fluture-js/fluture-node/commits?author=Avaq "View all commits by Avaq")
committed
Mar 1, 2022

1 parent
[2a5c6f4](/fluture-js/fluture-node/commit/2a5c6f47a45904adbf5d415657a989a2e53519a6)

commit 0c99bc5

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**10 additions**
and
**4 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* index.js
  [index.js](#diff-e727e4bdf3657fd1d798edcd6b099d6e092f8573cba266154583a746bba0f346)
* test

  + test/index.js
    [index.js](#diff-5bb8db779819ddef5956a5d9d5949c05ef7445237656ca37bf2f02720271440b)

## There are no files selected for viewing

9 changes: 5 additions & 4 deletions

9
[index.js](#diff-e727e4bdf3657fd1d798edcd6b099d6e092f8573cba266154583a746bba0f346 "index.js")

Show comments

[View file](/fluture-js/fluture-node/blob/0c99bc511533d48be17dc6bfe641f7d0aeb34d77/index.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -541,11 +541,12 @@ const mergeUrls = (base, input) => ( |
|  |  | base |
|  |  | ); |
|  |  |  |
|  |  | // sameHost :: (Url, Url) -> Boolean |
|  |  | const sameHost = (parent, child) => { |
|  |  | // sameOrigin :: (Url, Url) -> Boolean |
|  |  | const sameOrigin = (parent, child) => { |
|  |  | const p = new URL (parent); |
|  |  | const c = new URL (child); |
|  |  | return p.host === c.host || c.host.endsWith ('.' + p.host); |
|  |  | return (p.protocol === c.protocol || c.protocol === 'https:') && |
|  |  | (p.host === c.host || c.host.endsWith ('.' + p.host)); |
|  |  | }; |
|  |  |  |
|  |  | // overHeaders :: (Request, Array2 String String -> Array2 String String) |
| Expand Down  Expand Up | | @@ -583,7 +584,7 @@ export const redirectAnyRequest = response => { |
|  |  | (newUrl) |
|  |  | (Request.body (original)); |
|  |  |  |
|  |  | return sameHost (oldUrl, newUrl) ? request : overHeaders (request, xs => ( |
|  |  | return sameOrigin (oldUrl, newUrl) ? request : overHeaders (request, xs => ( |
|  |  | xs.filter (([name]) => !confidentialHeaders.includes (name.toLowerCase ())) |
|  |  | )); |
|  |  | }; |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[test/index.js](#diff-5bb8db779819ddef5956a5d9d5949c05ef7445237656ca37bf2f02720271440b "test/index.js")

Show comments

[View file](/fluture-js/fluture-node/blob/0c99bc511533d48be17dc6bfe641f7d0aeb34d77/test/index.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -284,6 +284,11 @@ test ('redirectAnyRequest', () => Promise.all ([ |
|  |  | headers: {location: 'https://elsewhere.com/'}, |
|  |  | request: fn.Request ({headers: {cookie: 'yum'}}) ('https://example.com') (fn.emptyStream)}))) |
|  |  | (fn.Request ({headers: {}}) ('https://elsewhere.com/') (fn.emptyStream)), |
|  |  | assertResolves (fl.map (fn.redirectAnyRequest) |
|  |  | (mockResponse ({code: 301, |
|  |  | headers: {location: 'http://example.com/'}, |
|  |  | request: fn.Request ({headers: {cookie: 'yum'}}) ('https://example.com') (fn.emptyStream)}))) |
|  |  | (fn.Request ({headers: {}}) ('http://example.com/') (fn.emptyStream)), |
|  |  | ])); |
|  |  |  |
|  |  | test ('redirectIfGetMethod', () => Promise.all ([ |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0c99bc5`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffluture-js%2Ffluture-node%2Fcommit%2F0c99bc511533d48be17dc6bfe641f7d0aeb34d77) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1ffc2685_20250108_134946.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffluture-js%2Ffluture-node%2Fcommit%2F125e4474f910c1507f8ec3232848626fbc0f55c4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffluture-js%2Ffluture-node%2Fcommit%2F125e4474f910c1507f8ec3232848626fbc0f55c4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=fluture-js%2Ffluture-node)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fluture-js](/fluture-js)
/
**[fluture-node](/fluture-js/fluture-node)**
Public

* [Notifications](/login?return_to=%2Ffluture-js%2Ffluture-node) You must be signed in to change notification settings
* [Fork
  1](/login?return_to=%2Ffluture-js%2Ffluture-node)
* [Star
   19](/login?return_to=%2Ffluture-js%2Ffluture-node)

* [Code](/fluture-js/fluture-node)
* [Issues
  0](/fluture-js/fluture-node/issues)
* [Pull requests
  2](/fluture-js/fluture-node/pulls)
* [Actions](/fluture-js/fluture-node/actions)
* [Security](/fluture-js/fluture-node/security)
* [Insights](/fluture-js/fluture-node/pulse)

Additional navigation options

* [Code](/fluture-js/fluture-node)
* [Issues](/fluture-js/fluture-node/issues)
* [Pull requests](/fluture-js/fluture-node/pulls)
* [Actions](/fluture-js/fluture-node/actions)
* [Security](/fluture-js/fluture-node/security)
* [Insights](/fluture-js/fluture-node/pulse)

## Commit

[Permalink](/fluture-js/fluture-node/commit/125e4474f910c1507f8ec3232848626fbc0f55c4)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Update redirection strategies to drop confidential headers

[Browse files](/fluture-js/fluture-node/tree/125e4474f910c1507f8ec3232848626fbc0f55c4)
Browse the repository at this point in the history

* Loading branch information

[![@Avaq](https://avatars.githubusercontent.com/u/1217745?s=40&v=4)](/Avaq)

[Avaq](/fluture-js/fluture-node/commits?author=Avaq "View all commits by Avaq")
committed
Mar 1, 2022

1 parent
[a17d0bd](/fluture-js/fluture-node/commit/a17d0bdc9430f3b73472efd1ab5e819e440e19b4)

commit 125e447

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**56 additions**
and
**11 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* index.js
  [index.js](#diff-e727e4bdf3657fd1d798edcd6b099d6e092f8573cba266154583a746bba0f346)
* test

  + test/index.js
    [index.js](#diff-5bb8db779819ddef5956a5d9d5949c05ef7445237656ca37bf2f02720271440b)

## There are no files selected for viewing

41 changes: 33 additions & 8 deletions

41
[index.js](#diff-e727e4bdf3657fd1d798edcd6b099d6e092f8573cba266154583a746bba0f346 "index.js")

Show comments

[View file](/fluture-js/fluture-node/blob/125e4474f910c1507f8ec3232848626fbc0f55c4/index.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -534,13 +534,20 @@ export const matchStatus = f => fs => res => { |
|  |  | return (hasProp (statusCode) (fs) ? fs[statusCode] : f) (res); |
|  |  | }; |
|  |  |  |
|  |  | // mergeUrls :: Url -> Any -> String |
|  |  | const mergeUrls = base => input => ( |
|  |  | // mergeUrls :: (Url, Any) -> String |
|  |  | const mergeUrls = (base, input) => ( |
|  |  | typeof input === 'string' ? |
|  |  | new URL (input, base).href : |
|  |  | base |
|  |  | ); |
|  |  |  |
|  |  | // sameHost :: (Url, Url) -> Boolean |
|  |  | const sameHost = (parent, child) => { |
|  |  | const p = new URL (parent); |
|  |  | const c = new URL (child); |
|  |  | return p.host === c.host || c.host.endsWith ('.' + p.host); |
|  |  | }; |
|  |  |  |
|  |  | // overHeaders :: (Request, Array2 String String -> Array2 String String) |
|  |  | // -> Request |
|  |  | const overHeaders = (request, f) => { |
| Expand All | | @@ -551,21 +558,34 @@ const overHeaders = (request, f) => { |
|  |  | (Request.body (request)); |
|  |  | }; |
|  |  |  |
|  |  | // confidentialHeaders :: Array String |
|  |  | const confidentialHeaders = [ |
|  |  | 'authorization', |
|  |  | 'cookie', |
|  |  | ]; |
|  |  |  |
|  |  | //# redirectAnyRequest :: Response -> Request |
|  |  | //. |
|  |  | //. A redirection strategy that simply reissues the original Request to the |
|  |  | //. Location specified in the given Response. |
|  |  | //. |
|  |  | //. If the new location is on an external host, then any confidential headers |
|  |  | //. (such as the cookie header) will be dropped from the new request. |
|  |  | //. |
|  |  | //. Used in the [`defaultRedirectionPolicy`](#defaultRedirectionPolicy) and |
|  |  | //. the [`aggressiveRedirectionPolicy`](#aggressiveRedirectionPolicy). |
|  |  | export const redirectAnyRequest = response => { |
|  |  | const {headers: {location}} = Response.message (response); |
|  |  | const original = Response.request (response); |
|  |  | const oldUrl = Request.url (original); |
|  |  | const newUrl = mergeUrls (oldUrl) (location); |
|  |  | return (Request (Request.options (original)) |
|  |  | (newUrl) |
|  |  | (Request.body (original))); |
|  |  | const newUrl = mergeUrls (oldUrl, location); |
|  |  | const request = Request (Request.options (original)) |
|  |  | (newUrl) |
|  |  | (Request.body (original)); |
|  |  |  |
|  |  | return sameHost (oldUrl, newUrl) ? request : overHeaders (request, xs => ( |
|  |  | xs.filter (([name]) => !confidentialHeaders.includes (name.toLowerCase ())) |
|  |  | )); |
|  |  | }; |
|  |  |  |
|  |  | //# redirectIfGetMethod :: Response -> Request |
| Expand All | | @@ -574,6 +594,9 @@ export const redirectAnyRequest = response => { |
|  |  | //. Location specified in the given Response, but only if the original request |
|  |  | //. was using the GET method. |
|  |  | //. |
|  |  | //. If the new location is on an external host, then any confidential headers |
|  |  | //. (such as the cookie header) will be dropped from the new request. |
|  |  | //. |
|  |  | //. Used in [`followRedirectsStrict`](#followRedirectsStrict). |
|  |  | export const redirectIfGetMethod = response => { |
|  |  | const {method} = cleanRequestOptions (Response.request (response)); |
| Expand All | | @@ -590,8 +613,10 @@ export const redirectIfGetMethod = response => { |
|  |  | //. request to the Location specified in the given Response. If the response |
|  |  | //. does not contain a valid location, the request is not redirected. |
|  |  | //. |
|  |  | //. The original request method and body are discarded, but all the options |
|  |  | //. are preserved. |
|  |  | //. The original request method and body are discarded, but other options |
|  |  | //. are preserved. If the new location is on an external host, then any |
|  |  | //. confidential headers (such as the cookie header) will be dropped from the |
|  |  | //. new request. |
|  |  | //. |
|  |  | //. Used in the [`defaultRedirectionPolicy`](#defaultRedirectionPolicy) and |
|  |  | //. the [`aggressiveRedirectionPolicy`](#aggressiveRedirectionPolicy). |
| Expand Down | |  |

26 changes: 23 additions & 3 deletions

26
[test/index.js](#diff-5bb8db779819ddef5956a5d9d5949c05ef7445237656ca37bf2f02720271440b "test/index.js")

Show comments

[View file](/fluture-js/fluture-node/blob/125e4474f910c1507f8ec3232848626fbc0f55c4/test/index.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -259,18 +259,38 @@ test ('redirectAnyRequest', () => Promise.all ([ |
|  |  | assertResolves (fl.map (fn.redirectAnyRequest) (mockResponse ({}))) |
|  |  | (getRequest), |
|  |  | assertResolves (fl.map (fn.redirectAnyRequest) (getResponse (301) ('ftp://xxx'))) |
|  |  | (fn.Request ({}) ('ftp://xxx/') (fn.emptyStream)), |
|  |  | (fn.Request ({headers: {}}) ('ftp://xxx/') (fn.emptyStream)), |
|  |  | assertResolves (fl.map (fn.redirectAnyRequest) (getResponse (301) ('/echo'))) |
|  |  | (fn.Request ({}) ('https://example.com/echo') (fn.emptyStream)), |
|  |  | assertResolves (fl.map (fn.redirectAnyRequest) (postResponse (301) ('/echo'))) |
|  |  | (fn.Request ({method: 'POST'}) ('https://example.com/echo') (fn.streamOf (Buffer.from ('test')))), |
|  |  | assertResolves (fl.map (fn.redirectAnyRequest) |
|  |  | (mockResponse ({code: 301, |
|  |  | headers: {location: 'https://example.com/path'}, |
|  |  | request: fn.Request ({headers: {cookie: 'yum'}}) ('https://example.com') (fn.emptyStream)}))) |
|  |  | (fn.Request ({headers: {cookie: 'yum'}}) ('https://example.com/path') (fn.emptyStream)), |
|  |  | assertResolves (fl.map (fn.redirectAnyRequest) |
|  |  | (mockResponse ({code: 301, |
|  |  | headers: {location: 'https://sub.example.com/'}, |
|  |  | request: fn.Request ({headers: {cookie: 'yum'}}) ('https://example.com') (fn.emptyStream)}))) |
|  |  | (fn.Request ({headers: {cookie: 'yum'}}) ('https://sub.example.com/') (fn.emptyStream)), |
|  |  | assertResolves (fl.map (fn.redirectAnyRequest) |
|  |  | (mockResponse ({code: 301, |
|  |  | headers: {location: 'https://bigsub.example.com/'}, |
|  |  | request: fn.Request ({headers: {cookie: 'yum'}}) ('https://example.com') (fn.emptyStream)}))) |
|  |  | (fn.Request ({headers: {cookie: 'yum'}}) ('https://bigsub.example.com/') (fn.emptyStream)), |
|  |  | assertResolves (fl.map (fn.redirectAnyRequest) |
|  |  | (mockResponse ({code: 301, |
|  |  | headers: {location: 'https://elsewhere.com/'}, |
|  |  | request: fn.Request ({headers: {cookie: 'yum'}}) ('https://example.com') (fn.emptyStream)}))) |
|  |  | (fn.Request ({headers: {}}) ('https://elsewhere.com/') (fn.emptyStream)), |
|  |  | ])); |
|  |  |  |
|  |  | test ('redirectIfGetMethod', () => Promise.all ([ |
|  |  | assertResolves (fl.map (fn.redirectIfGetMethod) (mockResponse ({}))) |
|  |  | (getRequest), |
|  |  | assertResolves (fl.map (fn.redirectIfGetMethod) (getResponse (301) ('ftp://xxx'))) |
|  |  | (fn.Request ({}) ('ftp://xxx/') (fn.emptyStream)), |
|  |  | (fn.Request ({headers: {}}) ('ftp://xxx/') (fn.emptyStream)), |
|  |  | assertResolves (fl.map (fn.redirectIfGetMethod) (getResponse (301) ('/echo'))) |
|  |  | (fn.Request ({}) ('https://example.com/echo') (fn.emptyStream)), |
|  |  | assertResolves (fl.map (fn.redirectIfGetMethod) (postResponse (301) ('/echo'))) |
| Expand All | | @@ -281,7 +301,7 @@ test ('redirectUsingGetMethod', () => Promise.all ([ |
|  |  | assertResolves (fl.map (fn.redirectUsingGetMethod) (mockResponse ({}))) |
|  |  | (fn.Request ({method: 'GET'}) ('https://example.com') (fn.emptyStream)), |
|  |  | assertResolves (fl.map (fn.redirectUsingGetMethod) (getResponse (301) ('ftp://xxx'))) |
|  |  | (fn.Request ({method: 'GET'}) ('ftp://xxx/') (fn.emptyStream)), |
|  |  | (fn.Request ({method: 'GET', headers: {}}) ('ftp://xxx/') (fn.emptyStream)), |
|  |  | assertResolves (fl.map (fn.redirectUsingGetMethod) (getResponse (200) ('/echo'))) |
|  |  | (fn.Request ({method: 'GET'}) ('https://example.com/echo') (fn.emptyStream)), |
|  |  | assertResolves (fl.map (fn.redirectUsingGetMethod) (postResponse (200) ('/echo'))) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `125e447`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffluture-js%2Ffluture-node%2Fcommit%2F125e4474f910c1507f8ec3232848626fbc0f55c4) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


