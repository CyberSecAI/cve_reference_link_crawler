

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kees Cook <keescook@chromium.org> | 2024-04-24 15:01:01 -0700 |
| --- | --- | --- |
| committer | Johannes Berg <johannes.berg@intel.com> | 2024-05-03 09:20:26 +0200 |
| commit | [838c7b8f1f278404d9d684c34a8cb26dc41aaaa1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)) | |
| tree | [dda74becf98e11f5e06e983067f2ebca3c0dc75a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1) | |
| parent | [3d913719df14c28c4d3819e7e6d150760222bda4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3d913719df14c28c4d3819e7e6d150760222bda4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1&id2=3d913719df14c28c4d3819e7e6d150760222bda4)) | |
| download | [linux-838c7b8f1f278404d9d684c34a8cb26dc41aaaa1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-838c7b8f1f278404d9d684c34a8cb26dc41aaaa1.tar.gz) | |

wifi: nl80211: Avoid address calculations via out of bounds array indexingBefore request->channels[] can be used, request->n\_channels must be set.
Additionally, address calculations for memory after the "channels" array
need to be calculated from the allocation base ("request") rather than
via the first "out of bounds" index of "channels", otherwise run-time
bounds checking will throw a warning.
Reported-by: Nathan Chancellor <nathan@kernel.org>
Fixes: e3eac9f32ec0 ("wifi: cfg80211: Annotate struct cfg80211\_scan\_request with \_\_counted\_by")
Signed-off-by: Kees Cook <keescook@chromium.org>
Tested-by: Nathan Chancellor <nathan@kernel.org>
Link: [https://msgid.link/20240424220057.work.819-kees@kernel.org](https://msgid.link/20240424220057.work.819-kees%40kernel.org)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)

| -rw-r--r-- | [net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/wireless/nl80211.c?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 7 deletions

| diff --git a/net/wireless/nl80211.c b/net/wireless/nl80211.cindex 30ff9a47081348..65c416e8d25eb9 100644--- a/[net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/wireless/nl80211.c?id=3d913719df14c28c4d3819e7e6d150760222bda4)+++ b/[net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/wireless/nl80211.c?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)@@ -9162,6 +9162,7 @@ static int nl80211\_trigger\_scan(struct sk\_buff \*skb, struct genl\_info \*info) struct wiphy \*wiphy; int err, tmp, n\_ssids = 0, n\_channels, i; size\_t ie\_len, size;+ size\_t ssids\_offset, ie\_offset;  wiphy = &rdev->wiphy; @@ -9207,21 +9208,20 @@ static int nl80211\_trigger\_scan(struct sk\_buff \*skb, struct genl\_info \*info) return -EINVAL;  size = struct\_size(request, channels, n\_channels);+ ssids\_offset = size; size = size\_add(size, array\_size(sizeof(\*request->ssids), n\_ssids));+ ie\_offset = size; size = size\_add(size, ie\_len); request = kzalloc(size, GFP\_KERNEL); if (!request) return -ENOMEM;+ request->n\_channels = n\_channels;  if (n\_ssids)- request->ssids = (void \*)&request->channels[n\_channels];+ request->ssids = (void \*)request + ssids\_offset; request->n\_ssids = n\_ssids;- if (ie\_len) {- if (n\_ssids)- request->ie = (void \*)(request->ssids + n\_ssids);- else- request->ie = (void \*)(request->channels + n\_channels);- }+ if (ie\_len)+ request->ie = (void \*)request + ie\_offset;  i = 0; if (scan\_freqs) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:18:10 +0000

