=== Content from git.kernel.org_226e1299_20250110_171932.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4e2a5566462b53db7d4c4722da86eedf0b8f546c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4e2a5566462b53db7d4c4722da86eedf0b8f546c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4e2a5566462b53db7d4c4722da86eedf0b8f546c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4e2a5566462b53db7d4c4722da86eedf0b8f546c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kees Cook <keescook@chromium.org> | 2024-04-24 15:01:01 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-30 09:49:20 +0200 |
| commit | [4e2a5566462b53db7d4c4722da86eedf0b8f546c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4e2a5566462b53db7d4c4722da86eedf0b8f546c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4e2a5566462b53db7d4c4722da86eedf0b8f546c)) | |
| tree | [b46d3acb987d95e74a63acdaa4957f85c517b1b1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4e2a5566462b53db7d4c4722da86eedf0b8f546c) | |
| parent | [daee2eaed03d6e3fa778bea14c118dcaa76ec29a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=daee2eaed03d6e3fa778bea14c118dcaa76ec29a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4e2a5566462b53db7d4c4722da86eedf0b8f546c&id2=daee2eaed03d6e3fa778bea14c118dcaa76ec29a)) | |
| download | [linux-4e2a5566462b53db7d4c4722da86eedf0b8f546c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4e2a5566462b53db7d4c4722da86eedf0b8f546c.tar.gz) | |

wifi: nl80211: Avoid address calculations via out of bounds array indexing[ Upstream commit 838c7b8f1f278404d9d684c34a8cb26dc41aaaa1 ]
Before request->channels[] can be used, request->n\_channels must be set.
Additionally, address calculations for memory after the "channels" array
need to be calculated from the allocation base ("request") rather than
via the first "out of bounds" index of "channels", otherwise run-time
bounds checking will throw a warning.
Reported-by: Nathan Chancellor <nathan@kernel.org>
Fixes: e3eac9f32ec0 ("wifi: cfg80211: Annotate struct cfg80211\_scan\_request with \_\_counted\_by")
Signed-off-by: Kees Cook <keescook@chromium.org>
Tested-by: Nathan Chancellor <nathan@kernel.org>
Link: [https://msgid.link/20240424220057.work.819-kees@kernel.org](https://msgid.link/20240424220057.work.819-kees%40kernel.org)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4e2a5566462b53db7d4c4722da86eedf0b8f546c)

| -rw-r--r-- | [net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/wireless/nl80211.c?id=4e2a5566462b53db7d4c4722da86eedf0b8f546c) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 7 deletions

| diff --git a/net/wireless/nl80211.c b/net/wireless/nl80211.cindex daac83aa8988e0..4e7b517c78bfd7 100644--- a/[net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/wireless/nl80211.c?id=daee2eaed03d6e3fa778bea14c118dcaa76ec29a)+++ b/[net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/wireless/nl80211.c?id=4e2a5566462b53db7d4c4722da86eedf0b8f546c)@@ -9148,6 +9148,7 @@ static int nl80211\_trigger\_scan(struct sk\_buff \*skb, struct genl\_info \*info) struct wiphy \*wiphy; int err, tmp, n\_ssids = 0, n\_channels, i; size\_t ie\_len, size;+ size\_t ssids\_offset, ie\_offset;  wiphy = &rdev->wiphy; @@ -9193,21 +9194,20 @@ static int nl80211\_trigger\_scan(struct sk\_buff \*skb, struct genl\_info \*info) return -EINVAL;  size = struct\_size(request, channels, n\_channels);+ ssids\_offset = size; size = size\_add(size, array\_size(sizeof(\*request->ssids), n\_ssids));+ ie\_offset = size; size = size\_add(size, ie\_len); request = kzalloc(size, GFP\_KERNEL); if (!request) return -ENOMEM;+ request->n\_channels = n\_channels;  if (n\_ssids)- request->ssids = (void \*)&request->channels[n\_channels];+ request->ssids = (void \*)request + ssids\_offset; request->n\_ssids = n\_ssids;- if (ie\_len) {- if (n\_ssids)- request->ie = (void \*)(request->ssids + n\_ssids);- else- request->ie = (void \*)(request->channels + n\_channels);- }+ if (ie\_len)+ request->ie = (void \*)request + ie\_offset;  i = 0; if (scan\_freqs) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:18:09 +0000



=== Content from git.kernel.org_34b897de_20250110_171933.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8fa4d56564ee7cc2ee348258d88efe191d70dd7f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8fa4d56564ee7cc2ee348258d88efe191d70dd7f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8fa4d56564ee7cc2ee348258d88efe191d70dd7f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8fa4d56564ee7cc2ee348258d88efe191d70dd7f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kees Cook <keescook@chromium.org> | 2024-04-24 15:01:01 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-30 09:44:30 +0200 |
| commit | [8fa4d56564ee7cc2ee348258d88efe191d70dd7f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8fa4d56564ee7cc2ee348258d88efe191d70dd7f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8fa4d56564ee7cc2ee348258d88efe191d70dd7f)) | |
| tree | [cdad557bbebe4581d5633bc212b46b1f8c653682](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8fa4d56564ee7cc2ee348258d88efe191d70dd7f) | |
| parent | [e1a825cafedeb69f7340c3ca09a17f30263b013c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e1a825cafedeb69f7340c3ca09a17f30263b013c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8fa4d56564ee7cc2ee348258d88efe191d70dd7f&id2=e1a825cafedeb69f7340c3ca09a17f30263b013c)) | |
| download | [linux-8fa4d56564ee7cc2ee348258d88efe191d70dd7f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8fa4d56564ee7cc2ee348258d88efe191d70dd7f.tar.gz) | |

wifi: nl80211: Avoid address calculations via out of bounds array indexing[ Upstream commit 838c7b8f1f278404d9d684c34a8cb26dc41aaaa1 ]
Before request->channels[] can be used, request->n\_channels must be set.
Additionally, address calculations for memory after the "channels" array
need to be calculated from the allocation base ("request") rather than
via the first "out of bounds" index of "channels", otherwise run-time
bounds checking will throw a warning.
Reported-by: Nathan Chancellor <nathan@kernel.org>
Fixes: e3eac9f32ec0 ("wifi: cfg80211: Annotate struct cfg80211\_scan\_request with \_\_counted\_by")
Signed-off-by: Kees Cook <keescook@chromium.org>
Tested-by: Nathan Chancellor <nathan@kernel.org>
Link: [https://msgid.link/20240424220057.work.819-kees@kernel.org](https://msgid.link/20240424220057.work.819-kees%40kernel.org)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8fa4d56564ee7cc2ee348258d88efe191d70dd7f)

| -rw-r--r-- | [net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/wireless/nl80211.c?id=8fa4d56564ee7cc2ee348258d88efe191d70dd7f) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 7 deletions

| diff --git a/net/wireless/nl80211.c b/net/wireless/nl80211.cindex 30ff9a47081348..65c416e8d25eb9 100644--- a/[net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/wireless/nl80211.c?id=e1a825cafedeb69f7340c3ca09a17f30263b013c)+++ b/[net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/wireless/nl80211.c?id=8fa4d56564ee7cc2ee348258d88efe191d70dd7f)@@ -9162,6 +9162,7 @@ static int nl80211\_trigger\_scan(struct sk\_buff \*skb, struct genl\_info \*info) struct wiphy \*wiphy; int err, tmp, n\_ssids = 0, n\_channels, i; size\_t ie\_len, size;+ size\_t ssids\_offset, ie\_offset;  wiphy = &rdev->wiphy; @@ -9207,21 +9208,20 @@ static int nl80211\_trigger\_scan(struct sk\_buff \*skb, struct genl\_info \*info) return -EINVAL;  size = struct\_size(request, channels, n\_channels);+ ssids\_offset = size; size = size\_add(size, array\_size(sizeof(\*request->ssids), n\_ssids));+ ie\_offset = size; size = size\_add(size, ie\_len); request = kzalloc(size, GFP\_KERNEL); if (!request) return -ENOMEM;+ request->n\_channels = n\_channels;  if (n\_ssids)- request->ssids = (void \*)&request->channels[n\_channels];+ request->ssids = (void \*)request + ssids\_offset; request->n\_ssids = n\_ssids;- if (ie\_len) {- if (n\_ssids)- request->ie = (void \*)(request->ssids + n\_ssids);- else- request->ie = (void \*)(request->channels + n\_channels);- }+ if (ie\_len)+ request->ie = (void \*)request + ie\_offset;  i = 0; if (scan\_freqs) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:18:10 +0000



=== Content from git.kernel.org_fa0f8946_20250110_171933.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kees Cook <keescook@chromium.org> | 2024-04-24 15:01:01 -0700 |
| --- | --- | --- |
| committer | Johannes Berg <johannes.berg@intel.com> | 2024-05-03 09:20:26 +0200 |
| commit | [838c7b8f1f278404d9d684c34a8cb26dc41aaaa1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)) | |
| tree | [dda74becf98e11f5e06e983067f2ebca3c0dc75a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1) | |
| parent | [3d913719df14c28c4d3819e7e6d150760222bda4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3d913719df14c28c4d3819e7e6d150760222bda4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1&id2=3d913719df14c28c4d3819e7e6d150760222bda4)) | |
| download | [linux-838c7b8f1f278404d9d684c34a8cb26dc41aaaa1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-838c7b8f1f278404d9d684c34a8cb26dc41aaaa1.tar.gz) | |

wifi: nl80211: Avoid address calculations via out of bounds array indexingBefore request->channels[] can be used, request->n\_channels must be set.
Additionally, address calculations for memory after the "channels" array
need to be calculated from the allocation base ("request") rather than
via the first "out of bounds" index of "channels", otherwise run-time
bounds checking will throw a warning.
Reported-by: Nathan Chancellor <nathan@kernel.org>
Fixes: e3eac9f32ec0 ("wifi: cfg80211: Annotate struct cfg80211\_scan\_request with \_\_counted\_by")
Signed-off-by: Kees Cook <keescook@chromium.org>
Tested-by: Nathan Chancellor <nathan@kernel.org>
Link: [https://msgid.link/20240424220057.work.819-kees@kernel.org](https://msgid.link/20240424220057.work.819-kees%40kernel.org)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)

| -rw-r--r-- | [net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/wireless/nl80211.c?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 7 deletions

| diff --git a/net/wireless/nl80211.c b/net/wireless/nl80211.cindex 30ff9a47081348..65c416e8d25eb9 100644--- a/[net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/wireless/nl80211.c?id=3d913719df14c28c4d3819e7e6d150760222bda4)+++ b/[net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/wireless/nl80211.c?id=838c7b8f1f278404d9d684c34a8cb26dc41aaaa1)@@ -9162,6 +9162,7 @@ static int nl80211\_trigger\_scan(struct sk\_buff \*skb, struct genl\_info \*info) struct wiphy \*wiphy; int err, tmp, n\_ssids = 0, n\_channels, i; size\_t ie\_len, size;+ size\_t ssids\_offset, ie\_offset;  wiphy = &rdev->wiphy; @@ -9207,21 +9208,20 @@ static int nl80211\_trigger\_scan(struct sk\_buff \*skb, struct genl\_info \*info) return -EINVAL;  size = struct\_size(request, channels, n\_channels);+ ssids\_offset = size; size = size\_add(size, array\_size(sizeof(\*request->ssids), n\_ssids));+ ie\_offset = size; size = size\_add(size, ie\_len); request = kzalloc(size, GFP\_KERNEL); if (!request) return -ENOMEM;+ request->n\_channels = n\_channels;  if (n\_ssids)- request->ssids = (void \*)&request->channels[n\_channels];+ request->ssids = (void \*)request + ssids\_offset; request->n\_ssids = n\_ssids;- if (ie\_len) {- if (n\_ssids)- request->ie = (void \*)(request->ssids + n\_ssids);- else- request->ie = (void \*)(request->channels + n\_channels);- }+ if (ie\_len)+ request->ie = (void \*)request + ie\_offset;  i = 0; if (scan\_freqs) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:18:10 +0000



=== Content from git.kernel.org_d7f8d65b_20250110_171934.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ed74398642fcb19f6ff385c35a7d512c6663e17b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ed74398642fcb19f6ff385c35a7d512c6663e17b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ed74398642fcb19f6ff385c35a7d512c6663e17b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ed74398642fcb19f6ff385c35a7d512c6663e17b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kees Cook <keescook@chromium.org> | 2024-04-24 15:01:01 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-12 11:11:48 +0200 |
| commit | [ed74398642fcb19f6ff385c35a7d512c6663e17b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ed74398642fcb19f6ff385c35a7d512c6663e17b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ed74398642fcb19f6ff385c35a7d512c6663e17b)) | |
| tree | [35db1364552071466b3d49b9dacb4425e126af64](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ed74398642fcb19f6ff385c35a7d512c6663e17b) | |
| parent | [166c9d2eef74dfb506adc2ec8fa034c2052349e5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=166c9d2eef74dfb506adc2ec8fa034c2052349e5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ed74398642fcb19f6ff385c35a7d512c6663e17b&id2=166c9d2eef74dfb506adc2ec8fa034c2052349e5)) | |
| download | [linux-ed74398642fcb19f6ff385c35a7d512c6663e17b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ed74398642fcb19f6ff385c35a7d512c6663e17b.tar.gz) | |

wifi: nl80211: Avoid address calculations via out of bounds array indexing[ Upstream commit 838c7b8f1f278404d9d684c34a8cb26dc41aaaa1 ]
Before request->channels[] can be used, request->n\_channels must be set.
Additionally, address calculations for memory after the "channels" array
need to be calculated from the allocation base ("request") rather than
via the first "out of bounds" index of "channels", otherwise run-time
bounds checking will throw a warning.
Reported-by: Nathan Chancellor <nathan@kernel.org>
Fixes: e3eac9f32ec0 ("wifi: cfg80211: Annotate struct cfg80211\_scan\_request with \_\_counted\_by")
Signed-off-by: Kees Cook <keescook@chromium.org>
Tested-by: Nathan Chancellor <nathan@kernel.org>
Link: [https://msgid.link/20240424220057.work.819-kees@kernel.org](https://msgid.link/20240424220057.work.819-kees%40kernel.org)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ed74398642fcb19f6ff385c35a7d512c6663e17b)

| -rw-r--r-- | [net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/wireless/nl80211.c?id=ed74398642fcb19f6ff385c35a7d512c6663e17b) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 7 deletions

| diff --git a/net/wireless/nl80211.c b/net/wireless/nl80211.cindex c4f08f7eb741d9..8f8f077e6cd401 100644--- a/[net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/wireless/nl80211.c?id=166c9d2eef74dfb506adc2ec8fa034c2052349e5)+++ b/[net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/wireless/nl80211.c?id=ed74398642fcb19f6ff385c35a7d512c6663e17b)@@ -9153,6 +9153,7 @@ static int nl80211\_trigger\_scan(struct sk\_buff \*skb, struct genl\_info \*info) struct wiphy \*wiphy; int err, tmp, n\_ssids = 0, n\_channels, i; size\_t ie\_len, size;+ size\_t ssids\_offset, ie\_offset;  wiphy = &rdev->wiphy; @@ -9198,21 +9199,20 @@ static int nl80211\_trigger\_scan(struct sk\_buff \*skb, struct genl\_info \*info) return -EINVAL;  size = struct\_size(request, channels, n\_channels);+ ssids\_offset = size; size = size\_add(size, array\_size(sizeof(\*request->ssids), n\_ssids));+ ie\_offset = size; size = size\_add(size, ie\_len); request = kzalloc(size, GFP\_KERNEL); if (!request) return -ENOMEM;+ request->n\_channels = n\_channels;  if (n\_ssids)- request->ssids = (void \*)&request->channels[n\_channels];+ request->ssids = (void \*)request + ssids\_offset; request->n\_ssids = n\_ssids;- if (ie\_len) {- if (n\_ssids)- request->ie = (void \*)(request->ssids + n\_ssids);- else- request->ie = (void \*)(request->channels + n\_channels);- }+ if (ie\_len)+ request->ie = (void \*)request + ie\_offset;  i = 0; if (scan\_freqs) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:18:11 +0000


