

[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Unauthorized member is able to view project deploy keys as well as change its title misleading the maintainers/owners of project.

⚠ **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #2037814](https://hackerone.com/reports/2037814)** by `theluci` on 2023-06-25, assigned to [@greg](/greg "Greg Myers"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

Hello,

This report is similar to [CVE-2022-2095](https://gitlab.com/gitlab-org/gitlab/-/issues/365415 "Non project members can view public projects Deploy Keys") in the sense that an unauthorized member can view project deploy keys.

But this report also shows that the unauthorized member is also able to make changes to the deploy key’s title.

#### Background

Gitlab provides a feature to set up [Deploy Keys.](https://docs.gitlab.com/ee/user/project/deploy_keys/)

Only the owner/maintainer of a project can [view project’s deploy keys.](https://docs.gitlab.com/ee/user/project/deploy_keys/#view-deploy-keys)

Changing deploy key’s title is also something that only maintainer/owner of a project can do.

#### Vulnerability

While fetching the Privately accessible deploy keys, gitlab doesn’t check whether the member has access to the deploy keys or not.

As a result,

An unauthorized member, for example, a guest (`attacker`) of a `victim-project` can create a new project `attacker-project` goes to its Settings->Repository, *Expand Deploy keys* and can view `victim-project` deploy keys under **Privately accessible deploy keys**.

[![25jun-1.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/340c24128831b5315dd93f4f529091a2b0f7694e/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f37656531663034622d386537632d343535312d613931392d3832313135666562316235392f32356a756e2d312e706e67)

[![25jun-2.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/91c8838ac30868f8287193616327ef1115cb656c/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f36356261663234312d353537382d346234652d626235372d3537343738323531333230332f32356a756e2d322e706e67)

`attacker` is also able to change deploy key’s title misleading the maintainers/owners of `victim-project`.

[![25jun-3.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/c50462d79eb41384c9cb59b4e318ccdd82dd64eb/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f65366530383963392d646333632d346461352d613536312d6165303738333730653665352f32356a756e2d332e706e67)

**Moreover,

After the deploy keys** ***has been enabled*** **in `attacker-project`, even if the `attacker` is removed from `victim-project`, the `attacker` can continue to view deploy keys as well as change their title.**

[![25jun-3.5.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/d5c945afb9f73e469895ada1ef788e9e076ebee9/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f34393563623838392d396130352d343430362d383130382d6361643363343138663734612f32356a756e2d332e352e706e67)

[![25jun-4.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/11cd05de6ce769cac32c5b6f5139ab0cb9118e20/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f61346535336461352d383736622d343138342d383231652d3165666138396436613364332f32356a756e2d342e706e67)

**That is a removed member can continue to view `victim-project` deploy keys as well as change their title misleading maintainers/owners of `victim-project`.**

<--------------------------------------------------------Important------------------------------------------------------->

This [comment](https://gitlab.com/gitlab-org/gitlab/-/issues/365415#note_993400903 "Non project members can view public projects Deploy Keys") led me to believe that there is information exposure in the deploy key’s title (“deploy key for internal\_server\_name”).

Also, an unauthorized member changing the deploy key’s title to `USELESS_DEPLOY_KEY`,`KEY_TO_BE_DELETED`, `DELETE_KEY_ON_23rd` etc. can mislead the other maintainers/owners into deleting the deploy key, which will affect the services that depend on the key.

<------------------------------------------------------------------------------------------------------------------------->

#### Steps to reproduce

1. `victim` creates a group `victim-group` and a project `victim-project` inside.
2. `victim` goes to `https://gitlab.com/<victim-group>/<victim-project>/-/settings/repository`, **Expand Deploy keys** and adds a few deploy keys.

In a real-world scenario, there will already be a few keys added to the project.

3. `victim` goes to `victim-group` membership page `https://gitlab.com/groups/<victim-group>/-/group_members` and adds `attacker` as guest.
4. `attacker` visits `victim-project` and is unable to view deploy keys.

This is the expected behaviour.

5. `attacker` creates a new group `attacker-group` and a project `attacker-project` inside.
6. `attacker` goes to `https://gitlab.com/<attacker-group>/<attacker-project>/-/settings/repository`, **Expand Deploy keys** and selects *Privately accessible deploy keys*.
7. `attacker` is able to view `victim-project` deploy keys.

Information disclosure in the title of the deploy key (according to this [comment](https://gitlab.com/gitlab-org/gitlab/-/issues/365415#note_993400903 "Non project members can view public projects Deploy Keys")).

8. `attacker` clicks on edit next to an **important deploy key** and changes title as `USELESS_KEY_TO_BE_DELETED`.

`attacker` is able to mislead one of the maintainers or owner of the project into deleting an important deploy key, affecting the services that depend on the key.

<----------------------------**Important - Removing attacker**--------------------------->

9. `attacker` enables all the deploy keys under *Privately accessible deploy keys*.
10. `victim` removes `attacker` from `victim-group`.
11. `victim` goes to `https://gitlab.com/<victim-group>/<victim-project>/-/settings/repository`, **Expand Deploy keys** and changes the title of a deploy key.
12. `attacker` goes to `https://gitlab.com/<attacker-group>/<attacker-project>/-/settings/repository`, **Expand Deploy keys** and can view the updated deploy keys.

Information disclosure in the title of the deploy key (according to this [comment](https://gitlab.com/gitlab-org/gitlab/-/issues/365415#note_993400903 "Non project members can view public projects Deploy Keys")).

13. `attacker` clicks on edit next to an **important deploy key** and changes title as `USELESS_KEY_TO_BE_DELETED`.

`attacker` is able to mislead one of the maintainers or owner of the project into deleting an important deploy key, affecting the services that depend on the key.

As can be seen, a non-project member `attacker` is able to view `victim-project` deploy keys, as well as make changes to its title.

#### POC

[poc-25jun.mp4](https://user-content.gitlab-static.net/ecd3b11d7518dbde2c420b58ae406eef2ac39118/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f31316461653836352d383562362d346534642d623265642d3333663632386530623330612f706f632d32356a756e2e6d7034 "Download 'poc-25jun.mp4'")

#### Output of checks

This bug happens on GitLab.com (Probably on instance too).

#### Impact

Unauthorized member (*Members with insufficient role* or *Removed member*) is able to view project deploy keys as well as change its title to ***mislead*** the maintainers/owners of project.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [25jun-1.png](https://h1.sec.gitlab.net/a/7ee1f04b-8e7c-4551-a919-82115feb1b59/25jun-1.png)
* [25jun-2.png](https://h1.sec.gitlab.net/a/65baf241-5578-4b4e-bb57-574782513203/25jun-2.png)
* [25jun-3.png](https://h1.sec.gitlab.net/a/e6e089c9-dc3c-4da5-a561-ae078370e6e5/25jun-3.png)
* [25jun-3.5.png](https://h1.sec.gitlab.net/a/495cb889-9a05-4406-8108-cad3c418f74a/25jun-3.5.png)
* [25jun-4.png](https://h1.sec.gitlab.net/a/a4e53da5-876b-4184-821e-1efa89d6a3d3/25jun-4.png)
* [poc-25jun.mp4](https://h1.sec.gitlab.net/a/11dae865-85b6-4e4d-b2ed-33f628e0b30a/poc-25jun.mp4)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.

