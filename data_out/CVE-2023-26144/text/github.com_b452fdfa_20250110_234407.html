
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql%2Fgraphql-js%2Fissues%2F3955)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql%2Fgraphql-js%2Fissues%2F3955)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=graphql%2Fgraphql-js)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[graphql](/graphql)
/
**[graphql-js](/graphql/graphql-js)**
Public

* [Notifications](/login?return_to=%2Fgraphql%2Fgraphql-js) You must be signed in to change notification settings
* [Fork
  2k](/login?return_to=%2Fgraphql%2Fgraphql-js)
* [Star
   20.1k](/login?return_to=%2Fgraphql%2Fgraphql-js)

* [Code](/graphql/graphql-js)
* [Issues
  87](/graphql/graphql-js/issues)
* [Pull requests
  64](/graphql/graphql-js/pulls)
* [Discussions](/graphql/graphql-js/discussions)
* [Actions](/graphql/graphql-js/actions)
* [Projects
  0](/graphql/graphql-js/projects)
* [Wiki](/graphql/graphql-js/wiki)
* [Security](/graphql/graphql-js/security)
* [Insights](/graphql/graphql-js/pulse)

Additional navigation options

* [Code](/graphql/graphql-js)
* [Issues](/graphql/graphql-js/issues)
* [Pull requests](/graphql/graphql-js/pulls)
* [Discussions](/graphql/graphql-js/discussions)
* [Actions](/graphql/graphql-js/actions)
* [Projects](/graphql/graphql-js/projects)
* [Wiki](/graphql/graphql-js/wiki)
* [Security](/graphql/graphql-js/security)
* [Insights](/graphql/graphql-js/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgraphql%2Fgraphql-js%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgraphql%2Fgraphql-js%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Resource exhaustion exploit when parsing queries #3955

Closed

[tadhglewis](/tadhglewis) opened this issue
Aug 18, 2023
¬∑ 7 comments
 ¬∑ Fixed by [#3958](https://github.com/graphql/graphql-js/pull/3958)

Closed

# [Resource exhaustion exploit when parsing queries](#top) #3955

[tadhglewis](/tadhglewis) opened this issue
Aug 18, 2023
¬∑ 7 comments
 ¬∑ Fixed by [#3958](https://github.com/graphql/graphql-js/pull/3958)

## Comments

[![@tadhglewis](https://avatars.githubusercontent.com/u/53756558?s=80&u=89b171a45ec22fc0a11c222392326877efc593b8&v=4)](/tadhglewis)

Copy link

### **[tadhglewis](/tadhglewis)** commented [Aug 18, 2023](#issue-1855898635) ‚Ä¢ edited Loading

| Re-posting here as advised in [apollographql/apollo-server#7688](https://github.com/apollographql/apollo-server/issues/7688). Without digging into source code I'm not exactly sure which part of graphql-js is causing this. Issue Description We've identified a potential resource exhaustion vector which has a significant impact on our CPU and response times. We're currently experiencing this on AS 3 however we're able to reproduce on AS 4.  We have a [custom query complexity calc plugin](https://github.com/tadhglewis/apollo-koa-minimal/blob/main/index.mjs#L33) which is intended to handle this scenario and others however it seems before we get to `didResolveOperation` event/stage, there is some processing that takes a long time.  I'm assuming this is an underlying dependancy in Apollo however I'm not 100% sure so any ideas or suggestions on how we can mitigate this would be great. Link to Reproduction <https://github.com/tadhglewis/apollo-koa-minimal> Reproduction Steps  1. `pnpm install && pnpm start` 2. Run  ``` curl \ --data "{\"query\":\"{ $(python3 -c "print('%s' % ('__typename ' * 1000))")}\"}" \ --header 'Content-Type: application/json' \ --include \ --request POST \ https://example.com/graphql ```  This will take ~2.5s and increase to ~21s if you change the number of `__typename` to `3000` [Screenshot 2023-08-16 at 10 33 30 pm](https://private-user-images.githubusercontent.com/53756558/261008553-3227af55-1a90-4374-bac0-4daf6e28bc55.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NTI5NDcsIm5iZiI6MTczNjU1MjY0NywicGF0aCI6Ii81Mzc1NjU1OC8yNjEwMDg1NTMtMzIyN2FmNTUtMWE5MC00Mzc0LWJhYzAtNGRhZjZlMjhiYzU1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDIzNDQwN1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTUyOTY4N2M0MmRmN2RhYmUyZWU5OTA0YWFiODEzZDFiZGNhODMxNzg3M2Q5MzllNTM5MzA5OWY4N2VmZTczNzQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.O9flFo5vGPHi82aZghlNv7hpoAvrRLWnID9WvGmAYsc) Notes   * On subsequent requests there seems to be some caching and response time goes to ~10ms however if you change the number of `__typename` by one it will bypass this * This isn't limited to `__typename`, it can also be hit when using `hello` and I imagine introspection as well |
| --- |
| The text was updated successfully, but these errors were encountered: |

 üëç
5
 samchungy, tadhglewis, JasonZzy0528, AaronMoat, and savemuse reacted with thumbs up emoji

All reactions

* üëç
  5 reactions

[![@trevor-scheer](https://avatars.githubusercontent.com/u/29644393?s=80&u=08f78a8d121d09f4eeb64f20934d5d3c2b74d11b&v=4)](/trevor-scheer)

Copy link

Contributor

### **[trevor-scheer](/trevor-scheer)** commented [Aug 18, 2023](#issuecomment-1684502070)

| üëã Apollo Server maintainer here. Going to follow along on this issue to track updates. For [@IvanGoncharov](https://github.com/IvanGoncharov) 's sake it would be nice to minimize the reproduction to exclude apollo server (and add certainty that it's a `graphql-js` problem). |
| --- |

All reactions

Sorry, something went wrong.

[![@tadhglewis](https://avatars.githubusercontent.com/u/53756558?s=80&u=89b171a45ec22fc0a11c222392326877efc593b8&v=4)](/tadhglewis)

Copy link

Author

### **[tadhglewis](/tadhglewis)** commented [Aug 21, 2023](#issuecomment-1685448666) ‚Ä¢ edited Loading

| [@trevor-scheer](https://github.com/trevor-scheer) I'll look at just testing against graphql-js this week and post an update |
| --- |

All reactions

Sorry, something went wrong.

[![@tadhglewis](https://avatars.githubusercontent.com/u/53756558?s=80&u=89b171a45ec22fc0a11c222392326877efc593b8&v=4)](/tadhglewis)

Copy link

Author

### **[tadhglewis](/tadhglewis)** commented [Aug 24, 2023](#issuecomment-1690922037) ‚Ä¢ edited Loading

| I've added a [minimal graphql-js example in the same repo](https://github.com/tadhglewis/apollo-koa-minimal). You can run it using `node graphql-js.mjs`.  The slow parsing performance is still observed here  ``` // 1000 __typename query = Took 1999.3179998397827 milliseconds // 2000 __typename query = Took 8064.870334148407 milliseconds  ```  We've also reproduced this in a real world scenario on a API and due to it's impact, I consider it a critical issue. |
| --- |

All reactions

Sorry, something went wrong.

[![@AaronMoat](https://avatars.githubusercontent.com/u/2937187?s=80&v=4)](/AaronMoat)

Copy link

Contributor

### **[AaronMoat](/AaronMoat)** commented [Aug 24, 2023](#issuecomment-1691458723)

| It looks like (nearly) all the time is spent in `OverlappingFieldsCanBeMergedRule`. |
| --- |

All reactions

Sorry, something went wrong.

[![@AaronMoat](https://avatars.githubusercontent.com/u/2937187?s=40&v=4)](/AaronMoat)
[AaronMoat](/AaronMoat)
mentioned this issue
[Aug 24, 2023](#ref-pullrequest-1864968631)

[OverlappingFieldsCanBeMergedRule: Fix performance degradation
#3958](/graphql/graphql-js/pull/3958)
 Merged

[![@AaronMoat](https://avatars.githubusercontent.com/u/2937187?s=80&v=4)](/AaronMoat)

Copy link

Contributor

### **[AaronMoat](/AaronMoat)** commented [Aug 24, 2023](#issuecomment-1691512644) ‚Ä¢ edited Loading

| Ran a bisect, discovered the performance degradation was [5caff03](https://github.com/graphql/graphql-js/commit/5caff039f1f6df0ae85a58c2e1f682804eddce67) ([#3457](https://github.com/graphql/graphql-js/pull/3457)). Raised [#3958](https://github.com/graphql/graphql-js/pull/3958)  cc: [@IvanGoncharov](https://github.com/IvanGoncharov) |
| --- |

 üëÄ
1
 tadhglewis reacted with eyes emoji

All reactions

* üëÄ
  1 reaction

Sorry, something went wrong.

[![@tadhglewis](https://avatars.githubusercontent.com/u/53756558?s=40&u=89b171a45ec22fc0a11c222392326877efc593b8&v=4)](/tadhglewis)
[tadhglewis](/tadhglewis)
changed the title
~~Poor performance when parsing large queries~~
Resource exhaustion exploit when parsing queries
[Aug 28, 2023](#event-10204125997)

[![@IvanGoncharov](https://avatars.githubusercontent.com/u/8336157?s=40&u=11fea344da2b258c03eda28ba3e479e078227492&v=4)](/IvanGoncharov)
[IvanGoncharov](/IvanGoncharov)
closed this as [completed](/graphql/graphql-js/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#3958](/graphql/graphql-js/pull/3958)
[Sep 5, 2023](#event-10286846819)

[IvanGoncharov](/IvanGoncharov)
pushed a commit
that referenced
this issue
[Sep 5, 2023](#ref-commit-f94b511)
[![@AaronMoat](https://avatars.githubusercontent.com/u/2937187?s=40&v=4)](/AaronMoat)

`[OverlappingFieldsCanBeMergedRule: Fix performance degradation (](/graphql/graphql-js/commit/f94b511386c7e47bd0380dcd56553dc063320226 "OverlappingFieldsCanBeMergedRule: Fix performance degradation (#3958)

Co-authored-by: AaronMoat <AaronMoat@users.noreply.github.com>
Co-authored-by: Ivan Goncharov <ivan.goncharov.ua@gmail.com>
Resolves https://github.com/graphql/graphql-js/issues/3955 (at least")[#3958](https://github.com/graphql/graphql-js/pull/3958)[)](/graphql/graphql-js/commit/f94b511386c7e47bd0380dcd56553dc063320226 "OverlappingFieldsCanBeMergedRule: Fix performance degradation (#3958)

Co-authored-by: AaronMoat <AaronMoat@users.noreply.github.com>
Co-authored-by: Ivan Goncharov <ivan.goncharov.ua@gmail.com>
Resolves https://github.com/graphql/graphql-js/issues/3955 (at least")`
‚Ä¶

`[f94b511](/graphql/graphql-js/commit/f94b511386c7e47bd0380dcd56553dc063320226)`

```
Co-authored-by: AaronMoat <AaronMoat@users.noreply.github.com>
Co-authored-by: Ivan Goncharov <ivan.goncharov.ua@gmail.com>
Resolves [#3955](https://github.com/graphql/graphql-js/issues/3955) (at least
```

[![@trevor-scheer](https://avatars.githubusercontent.com/u/29644393?s=40&u=08f78a8d121d09f4eeb64f20934d5d3c2b74d11b&v=4)](/trevor-scheer)
[trevor-scheer](/trevor-scheer)
mentioned this issue
[Sep 5, 2023](#ref-issue-1853143494)

[Resource exhaustion exploit when parsing queries
apollographql/apollo-server#7688](/apollographql/apollo-server/issues/7688)

Closed

[![@AaronMoat](https://avatars.githubusercontent.com/u/2937187?s=80&v=4)](/AaronMoat)

Copy link

Contributor

### **[AaronMoat](/AaronMoat)** commented [Sep 5, 2023](#issuecomment-1707397334)

| Raised [#3967](https://github.com/graphql/graphql-js/pull/3967) for 16 |
| --- |

All reactions

Sorry, something went wrong.

[![@AaronMoat](https://avatars.githubusercontent.com/u/2937187?s=80&v=4)](/AaronMoat)

Copy link

Contributor

### **[AaronMoat](/AaronMoat)** commented [Sep 14, 2023](#issuecomment-1719209803)

| [@IvanGoncharov](https://github.com/IvanGoncharov) or others on this thread. Can we please organise a release for v16? As per [#3967](https://github.com/graphql/graphql-js/pull/3967).  I would argue this issue should not be marked complete until consumers can use a fixed version of this security/performance hole, on a stable (non-beta) release channel. |
| --- |

 üëç
1
 tadhglewis reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@AaronMoat](https://avatars.githubusercontent.com/u/2937187?s=40&v=4)](/AaronMoat)
[AaronMoat](/AaronMoat)
mentioned this issue
[Sep 19, 2023](#ref-pullrequest-1901972895)

[Release 16.8.1 to address resource exhaustion vulnerability
#3972](/graphql/graphql-js/pull/3972)
 Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql%2Fgraphql-js%2Fissues%2F3955)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [OverlappingFieldsCanBeMergedRule: Fix performance degradation](/graphql/graphql-js/pull/3958)

3 participants

[![@AaronMoat](https://avatars.githubusercontent.com/u/2937187?s=52&v=4)](/AaronMoat) [![@trevor-scheer](https://avatars.githubusercontent.com/u/29644393?s=52&v=4)](/trevor-scheer) [![@tadhglewis](https://avatars.githubusercontent.com/u/53756558?s=52&v=4)](/tadhglewis)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.

