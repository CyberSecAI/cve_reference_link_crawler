

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9a5f471ae380f9fcb9756d453c12ca1f8595a93c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9a5f471ae380f9fcb9756d453c12ca1f8595a93c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9a5f471ae380f9fcb9756d453c12ca1f8595a93c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9a5f471ae380f9fcb9756d453c12ca1f8595a93c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jonas Malaco <jonas@protocubo.io> | 2022-02-03 13:49:52 -0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-16 12:56:33 +0100 |
| commit | [9a5f471ae380f9fcb9756d453c12ca1f8595a93c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9a5f471ae380f9fcb9756d453c12ca1f8595a93c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9a5f471ae380f9fcb9756d453c12ca1f8595a93c)) | |
| tree | [3d0cd6bdb5288e9b80329d8194e37f8407d010f4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9a5f471ae380f9fcb9756d453c12ca1f8595a93c) | |
| parent | [decb36e9a9f02dc9e1e0ede0a93f968e12d86539](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=decb36e9a9f02dc9e1e0ede0a93f968e12d86539) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9a5f471ae380f9fcb9756d453c12ca1f8595a93c&id2=decb36e9a9f02dc9e1e0ede0a93f968e12d86539)) | |
| download | [linux-9a5f471ae380f9fcb9756d453c12ca1f8595a93c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9a5f471ae380f9fcb9756d453c12ca1f8595a93c.tar.gz) | |

eeprom: ee1004: limit i2c reads to I2C\_SMBUS\_BLOCK\_MAXcommit c0689e46be23160d925dca95dfc411f1a0462708 upstream.
Commit effa453168a7 ("i2c: i801: Don't silently correct invalid transfer
size") revealed that ee1004\_eeprom\_read() did not properly limit how
many bytes to read at once.
In particular, i2c\_smbus\_read\_i2c\_block\_data\_or\_emulated() takes the
length to read as an u8. If count == 256 after taking into account the
offset and page boundary, the cast to u8 overflows. And this is common
when user space tries to read the entire EEPROM at once.
To fix it, limit each read to I2C\_SMBUS\_BLOCK\_MAX (32) bytes, already
the maximum length i2c\_smbus\_read\_i2c\_block\_data\_or\_emulated() allows.
Fixes: effa453168a7 ("i2c: i801: Don't silently correct invalid transfer size")
Cc: stable@vger.kernel.org
Reviewed-by: Heiner Kallweit <hkallweit1@gmail.com>
Signed-off-by: Jonas Malaco <jonas@protocubo.io>
Link: [https://lore.kernel.org/r/20220203165024.47767-1-jonas@protocubo.io](https://lore.kernel.org/r/20220203165024.47767-1-jonas%40protocubo.io)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9a5f471ae380f9fcb9756d453c12ca1f8595a93c)

| -rw-r--r-- | [drivers/misc/eeprom/ee1004.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/misc/eeprom/ee1004.c?id=9a5f471ae380f9fcb9756d453c12ca1f8595a93c) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/drivers/misc/eeprom/ee1004.c b/drivers/misc/eeprom/ee1004.cindex bb9c4512c968c8..9fbfe784d71015 100644--- a/[drivers/misc/eeprom/ee1004.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/misc/eeprom/ee1004.c?id=decb36e9a9f02dc9e1e0ede0a93f968e12d86539)+++ b/[drivers/misc/eeprom/ee1004.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/misc/eeprom/ee1004.c?id=9a5f471ae380f9fcb9756d453c12ca1f8595a93c)@@ -114,6 +114,9 @@ static ssize\_t ee1004\_eeprom\_read(struct i2c\_client \*client, char \*buf, if (offset + count > EE1004\_PAGE\_SIZE) count = EE1004\_PAGE\_SIZE - offset; + if (count > I2C\_SMBUS\_BLOCK\_MAX)+ count = I2C\_SMBUS\_BLOCK\_MAX;+ return i2c\_smbus\_read\_i2c\_block\_data\_or\_emulated(client, offset, count, buf); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:48:48 +0000

