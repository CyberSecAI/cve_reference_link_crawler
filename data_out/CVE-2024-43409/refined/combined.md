=== Content from github.com_2e17ea11_20250111_063155.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTryGhost%2FGhost%2Fcommit%2Fdac25612520b571f58679764ecc27109e641d1db)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTryGhost%2FGhost%2Fcommit%2Fdac25612520b571f58679764ecc27109e641d1db)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=TryGhost%2FGhost)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TryGhost](/TryGhost)
/
**[Ghost](/TryGhost/Ghost)**
Public

* [Notifications](/login?return_to=%2FTryGhost%2FGhost) You must be signed in to change notification settings
* [Fork
  10.5k](/login?return_to=%2FTryGhost%2FGhost)
* [Star
   48k](/login?return_to=%2FTryGhost%2FGhost)

* [Code](/TryGhost/Ghost)
* [Issues
  29](/TryGhost/Ghost/issues)
* [Pull requests
  144](/TryGhost/Ghost/pulls)
* [Actions](/TryGhost/Ghost/actions)
* [Security](/TryGhost/Ghost/security)
* [Insights](/TryGhost/Ghost/pulse)

Additional navigation options

* [Code](/TryGhost/Ghost)
* [Issues](/TryGhost/Ghost/issues)
* [Pull requests](/TryGhost/Ghost/pulls)
* [Actions](/TryGhost/Ghost/actions)
* [Security](/TryGhost/Ghost/security)
* [Insights](/TryGhost/Ghost/pulse)

## Commit

[Permalink](/TryGhost/Ghost/commit/dac25612520b571f58679764ecc27109e641d1db)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

ðŸ”’ Added uuid verification to member endpoints not requiring a session

[Browse files](/TryGhost/Ghost/tree/dac25612520b571f58679764ecc27109e641d1db)
Browse the repository at this point in the history

```
ref <https://linear.app/tryghost/issue/ENG-1364>
ref <https://linear.app/tryghost/issue/ENG-1464>

- credits to <https://github.com/1337Nerd>
- added a hashed value to endpoints that do not require a member sign in in order to verify the source of the link and resulting request
- added redirect to sign in page when trying to access newsletter
management
```

* Loading branch information

[![@9larsons](https://avatars.githubusercontent.com/u/21961100?s=40&v=4)](/9larsons) [![@daniellockyer](https://avatars.githubusercontent.com/u/964245?s=40&v=4)](/daniellockyer)

[9larsons](/TryGhost/Ghost/commits?author=9larsons "View all commits by 9larsons")
authored and
[daniellockyer](/TryGhost/Ghost/commits?author=daniellockyer "View all commits by daniellockyer")
committed
Aug 20, 2024

1 parent
[beb70e9](/TryGhost/Ghost/commit/beb70e9c11079bcf1e080feedf6adfba13c1cf02)

commit dac2561

 Show file tree

 Hide file tree

Showing
**32 changed files**
with
**1,027 additions**
and
**290 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* apps/portal

  + apps/portal/package.json
    [package.json](#diff-25eb88ecdd98232ac5806cbe48ee850274ba7ba1a2d374e1d8c767f6faacae4d)
  + src

    - apps/portal/src/App.js
      [App.js](#diff-e1eb9ae4190f8d5a9a3d7401f75a79cc08e8d12e7e175c9104b91a648aa845f9)
    - components/pages

      * apps/portal/src/components/pages/AccountEmailPage.js
        [AccountEmailPage.js](#diff-4f0bafef18082d489e29fa072d6ce6b92bfbdc8259fd2e4c1aa99679f025c639)
      * apps/portal/src/components/pages/AccountEmailPage.test.js
        [AccountEmailPage.test.js](#diff-79ca2e211aad340f6e1e5f46814839b116aeb2700a731e85c57f57924dd078ca)
      * apps/portal/src/components/pages/FeedbackPage.js
        [FeedbackPage.js](#diff-cea58678b7d7f97c6904a45c630832e762beb7f972b26f56130b37fc4a66cc09)
      * apps/portal/src/components/pages/FeedbackPage.test.js
        [FeedbackPage.test.js](#diff-2ffacf707223aa83932b966976a6c47d1e5c9d9aa987d3586f5c0b78c49d9b86)
      * apps/portal/src/components/pages/LoadingPage.js
        [LoadingPage.js](#diff-53bf88f596a83b8910f148fd210699da5b23e4b3e83e3eda56aad85ce3352a90)
      * apps/portal/src/components/pages/UnsubscribePage.js
        [UnsubscribePage.js](#diff-c3174d6f8a6ab89397ed3773e941f40a2f06fb767c1a66bebc7a772df956f013)
    - tests

      * apps/portal/src/tests/EmailSubscriptionsFlow.test.js
        [EmailSubscriptionsFlow.test.js](#diff-c5d43d234e4c90117f65d43b997156928150b919660ee9ab9b886180fc41454c)
      * apps/portal/src/tests/FeedbackFlow.test.js
        [FeedbackFlow.test.js](#diff-9451de859f127b48b820d23bd1bd41f702998c89509f6db09e1e3f8943cc0a55)
    - utils

      * apps/portal/src/utils/api.js
        [api.js](#diff-99ee3cf3aab539d5c89499b2b6cbf4700de6f90c51413299c8f71a0b0937991f)
      * apps/portal/src/utils/fixtures-generator.js
        [fixtures-generator.js](#diff-b016cfe99a3e37b668f82ec2a6843a0276fc337fa8a2387afeb91034ef232578)
      * apps/portal/src/utils/fixtures.js
        [fixtures.js](#diff-04468eb0001aeb03504b7ebd3e0a8ab3301ebb4b680802686259df67aeddab77)
* ghost

  + audience-feedback

    - lib

      * ghost/audience-feedback/lib/AudienceFeedbackService.js
        [AudienceFeedbackService.js](#diff-e0e984bf537ce6690e23ed69108650ed2d8a34dd6279fd1774556713840e37eb)
    - test

      * ghost/audience-feedback/test/AudienceFeedbackService.test.js
        [AudienceFeedbackService.test.js](#diff-f4b468926d6006cef1e60c2fe83157ae476e2d09cfe6e5ccf21c5b1309d87eb3)
  + core

    - core

      * frontend/services/routing/controllers

        + ghost/core/core/frontend/services/routing/controllers/unsubscribe.js
          [unsubscribe.js](#diff-9e325620394122a2b5f3f126dd257b7b1d471663ae1e6761db19b1babd1a60db)
      * server

        + services

          - members

            * ghost/core/core/server/services/members/middleware.js
              [middleware.js](#diff-15d0c22de659b45fa3fa476dc92ac4051de9a9691475b893a14e40f8f26338ec)
          - settings-helpers

            * ghost/core/core/server/services/settings-helpers/SettingsHelpers.js
              [SettingsHelpers.js](#diff-3d07a61711ec29b09f22324da98738c6535167eda09731f34aefd2a0d148161d)
        + web/members

          - ghost/core/core/server/web/members/app.js
            [app.js](#diff-51ce445ab78102cc1cf312572da235ee2f00e0ac0656937baa842da3c6994e02)
      * shared/config

        + ghost/core/core/shared/config/defaults.json
          [defaults.json](#diff-dbdff8cc3148ae38177ccc6f005f7fb8d6a0c9dde0127369fcc3dc5cb1f02034)
        + env

          - ghost/core/core/shared/config/env/config.development.json
            [config.development.json](#diff-aaa688dcaed7c0fbf50adeab13667374119ae8bf95b2211367d5e93ffa959f38)
    - test

      * e2e-api

        + admin

          - \_\_snapshots\_\_

            * ghost/core/test/e2e-api/admin/\_\_snapshots\_\_/email-previews.test.js.snap
              [email-previews.test.js.snap](#diff-8b3b213f29d256871ec1a0c4574a909ab5851111137cf159737a329565e7faf8)
            * ghost/core/test/e2e-api/admin/\_\_snapshots\_\_/emails.test.js.snap
              [emails.test.js.snap](#diff-4d2e018f6837058cedf4a08755841c77df77f03d1cdacd3cca5716aaae2a3329)
          - ghost/core/test/e2e-api/admin/email-previews.test.js
            [email-previews.test.js](#diff-bf1289fa244b5b0c4be94bde8883522de9d898dbf846c020d259d19a7ec26fcd)
          - ghost/core/test/e2e-api/admin/emails.test.js
            [emails.test.js](#diff-820f9aa5953a9e82a010658d8329140deb9cf4ee3688ceba85d8b755dab0fc88)
        + members

          - \_\_snapshots\_\_

            * ghost/core/test/e2e-api/members/\_\_snapshots\_\_/feedback.test.js.snap
              [feedback.test.js.snap](#diff-95eeb7f2aeb774bb4ff5bf7cfb63941a3082142bb687d47bb2646f3528c27f7f)
          - ghost/core/test/e2e-api/members/feedback.test.js
            [feedback.test.js](#diff-2a4dde5d0de7ec8db06861751b68e658f46cce49005a250884ab641cf2993c09)
          - ghost/core/test/e2e-api/members/middleware.test.js
            [middleware.test.js](#diff-c85ac7db3c5f4bd002011f05c3565008226171ab28268244cc2f2b1d4f47140a)
      * e2e-frontend

        + ghost/core/test/e2e-frontend/members.test.js
          [members.test.js](#diff-9c59e89dcd119b489b8a9c8b53308a5116d3f186542cac6a4c263cec58874bea)
      * unit/server/services/members

        + ghost/core/test/unit/server/services/members/middleware.test.js
          [middleware.test.js](#diff-35799e14f94fd57bf2d18987fed4f70f50fcce1a23d4f03c5069050332fabe2d)
  + email-service

    - lib

      * ghost/email-service/lib/EmailRenderer.js
        [EmailRenderer.js](#diff-fe496d91af709a72c145b5039abb557b94c66d5e792fca2f448768adff92bd9a)
    - test

      * ghost/email-service/test/email-renderer.test.js
        [email-renderer.test.js](#diff-85caf1314a0c4bea66a67f1cee0fc610b99d37e787a21f70ec7eef93ece5ad5d)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[apps/portal/package.json](#diff-25eb88ecdd98232ac5806cbe48ee850274ba7ba1a2d374e1d8c767f6faacae4d "apps/portal/package.json")

Show comments

[View file](/TryGhost/Ghost/blob/dac25612520b571f58679764ecc27109e641d1db/apps/portal/package.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,6 @@ |
|  |  | { |
|  |  | "name": "@tryghost/portal", |
|  |  | "version": "2.38.0", |
|  |  | "version": "2.39.0", |
|  |  | "license": "MIT", |
|  |  | "repository": { |
|  |  | "type": "git", |
| Expand Down | |  |

70 changes: 48 additions & 22 deletions

70
[apps/portal/src/App.js](#diff-e1eb9ae4190f8d5a9a3d7401f75a79cc08e8d12e7e175c9104b91a648aa845f9 "apps/portal/src/App.js")

Show comments

[View file](/TryGhost/Ghost/blob/dac25612520b571f58679764ecc27109e641d1db/apps/portal/src/App.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -211,7 +211,7 @@ export default class App extends React.Component { |
|  |  | async fetchData() { |
|  |  | const {site: apiSiteData, member} = await this.fetchApiData(); |
|  |  | const {site: devSiteData, ...restDevData} = this.fetchDevData(); |
|  |  | const {site: linkSiteData, ...restLinkData} = this.fetchLinkData(apiSiteData); |
|  |  | const {site: linkSiteData, ...restLinkData} = this.fetchLinkData(apiSiteData, member); |
|  |  | const {site: previewSiteData, ...restPreviewData} = this.fetchPreviewData(); |
|  |  | const {site: notificationSiteData, ...restNotificationData} = this.fetchNotificationData(); |
|  |  | let page = ''; |
| Expand Down  Expand Up | | @@ -420,18 +420,32 @@ export default class App extends React.Component { |
|  |  | } |
|  |  |  |
|  |  | /\*\* Fetch state from Portal Links \*/ |
|  |  | fetchLinkData(site) { |
|  |  | fetchLinkData(site, member) { |
|  |  | const qParams = new URLSearchParams(window.location.search); |
|  |  | if (qParams.get('uuid') && qParams.get('action') === 'unsubscribe') { |
|  |  | return { |
|  |  | showPopup: true, |
|  |  | page: 'unsubscribe', |
|  |  | pageData: { |
|  |  | uuid: qParams.get('uuid'), |
|  |  | newsletterUuid: qParams.get('newsletter'), |
|  |  | comments: qParams.get('comments') |
|  |  | } |
|  |  | }; |
|  |  | if (qParams.get('action') === 'unsubscribe') { |
|  |  | // if the user is unsubscribing from a newsletter with an old unsubscribe link that we can't validate, push them to newsletter mgmt where they have to log in |
|  |  | if (qParams.get('key') && qParams.get('uuid')) { |
|  |  | return { |
|  |  | showPopup: true, |
|  |  | page: 'unsubscribe', |
|  |  | pageData: { |
|  |  | uuid: qParams.get('uuid'), |
|  |  | key: qParams.get('key'), |
|  |  | newsletterUuid: qParams.get('newsletter'), |
|  |  | comments: qParams.get('comments') |
|  |  | } |
|  |  | }; |
|  |  | } else { // any malformed unsubscribe links should simply go to email prefs |
|  |  | return { |
|  |  | showPopup: true, |
|  |  | page: 'accountEmail', |
|  |  | pageData: { |
|  |  | newsletterUuid: qParams.get('newsletter'), |
|  |  | action: 'unsubscribe', |
|  |  | redirect: site.url + '#/portal/account/newsletters' |
|  |  | } |
|  |  | }; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if (hasRecommendations({site}) && qParams.get('action') === 'signup' && qParams.get('success') === 'true') { |
| Expand All | | @@ -453,19 +467,31 @@ export default class App extends React.Component { |
|  |  | const linkRegex = /^\/portal\/?(?:\/(\w+(?:\/\w+)\*))?\/?$/; |
|  |  | const feedbackRegex = /^\/feedback\/(\w+?)\/(\w+?)\/?$/; |
|  |  |  |
|  |  | if (path && feedbackRegex.test(path) && hashQuery.get('uuid')) { |
|  |  | if (path && feedbackRegex.test(path)) { |
|  |  | const [, postId, scoreString] = path.match(feedbackRegex); |
|  |  | const score = parseInt(scoreString); |
|  |  | if (score === 1 || score === 0) { |
|  |  | return { |
|  |  | showPopup: true, |
|  |  | page: 'feedback', |
|  |  | pageData: { |
|  |  | uuid: hashQuery.get('uuid'), |
|  |  | postId, |
|  |  | score |
|  |  | } |
|  |  | }; |
|  |  | // if logged in, submit feedback |
|  |  | if (member || (hashQuery.get('uuid') && hashQuery.get('key'))) { |
|  |  | return { |
|  |  | showPopup: true, |
|  |  | page: 'feedback', |
|  |  | pageData: { |
|  |  | uuid: member ? null : hashQuery.get('uuid'), |
|  |  | key: member ? null : hashQuery.get('key'), |
|  |  | postId, |
|  |  | score |
|  |  | } |
|  |  | }; |
|  |  | } else { |
|  |  | return { |
|  |  | showPopup: true, |
|  |  | page: 'signin', |
|  |  | pageData: { |
|  |  | redirect: site.url + `#/feedback/${postId}/${score}/` |
|  |  | } |
|  |  | }; |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | if (path && linkRegex.test(path)) { |
| Expand Down | |  |

76 changes: 69 additions & 7 deletions

76
[apps/portal/src/components/pages/AccountEmailPage.js](#diff-4f0bafef18082d489e29fa072d6ce6b92bfbdc8259fd2e4c1aa99679f025c639 "apps/portal/src/components/pages/AccountEmailPage.js")

Show comments

[View file](/TryGhost/Ghost/blob/dac25612520b571f58679764ecc27109e641d1db/apps/portal/src/components/pages/AccountEmailPage.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,22 +1,84 @@ |
|  |  | import AppContext from '../../AppContext'; |
|  |  | import {useContext, useEffect, useState} from 'react'; |
|  |  | import {isPaidMember} from '../../utils/helpers'; |
|  |  | import {isPaidMember, getSiteNewsletters} from '../../utils/helpers'; |
|  |  | import {SYNTAX\_I18NEXT} from '@doist/react-interpolate'; |
|  |  | import NewsletterManagement from '../common/NewsletterManagement'; |
|  |  | import Interpolate from '@doist/react-interpolate'; |
|  |  |  |
|  |  | export default function AccountEmailPage() { |
|  |  | const {member, onAction, site, t} = useContext(AppContext); |
|  |  | const {member, onAction, site, t, pageData} = useContext(AppContext); |
|  |  | let newsletterUuid; |
|  |  | let action; |
|  |  | if (pageData) { |
|  |  | newsletterUuid = pageData.newsletterUuid; |
|  |  | action = pageData.action; |
|  |  | } |
|  |  | const [hasInteracted, setHasInteracted] = useState(true); |
|  |  | const siteNewsletters = getSiteNewsletters({site}); |
|  |  |  |
|  |  | // Redirect to signin page if member is not available |
|  |  | useEffect(() => { |
|  |  | if (!member) { |
|  |  | onAction('switchPage', { |
|  |  | page: 'signin', |
|  |  | pageData: { |
|  |  | redirect: window.location.href // This includes the search/fragment of the URL (#/portal/account) which is missing from the default referer header |
|  |  | } |
|  |  | page: 'signin' |
|  |  | }); |
|  |  | } |
|  |  | }, [member, onAction]); |
|  |  |  |
|  |  | // this results in an infinite loop, needs to run only once... |
|  |  | useEffect(() => { |
|  |  | // attempt auto-unsubscribe if we were redirected here from an unsubscribe link |
|  |  | if (newsletterUuid && action === 'unsubscribe') { |
|  |  | // Filter out the newsletter that matches the uuid |
|  |  | const remainingNewsletterSubscriptions = member?.newsletters.filter(n => n.uuid !== newsletterUuid); |
|  |  | setSubscribedNewsletters(remainingNewsletterSubscriptions); |
|  |  | setHasInteracted(false); // this shows the dialog |
|  |  | onAction('updateNewsletterPreference', {newsletters: remainingNewsletterSubscriptions}); |
|  |  | } |
|  |  | }, []); |
|  |  |  |
|  |  | const HeaderNotification = () => { |
|  |  | if (pageData.comments && commentsEnabled) { |
|  |  | const hideClassName = hasInteracted ? 'gh-portal-hide' : ''; |
|  |  | return ( |
|  |  | <> |
|  |  | <p className={`gh-portal-text-center gh-portal-header-message ${hideClassName}`}> |
|  |  | <Interpolate |
|  |  | syntax={SYNTAX\_I18NEXT} |
|  |  | string={t('{{memberEmail}} will no longer receive emails when someone replies to your comments.')} |
|  |  | mapping={{ |
|  |  | memberEmail: <strong>{member?.email}</strong> |
|  |  | }} |
|  |  | /> |
|  |  | </p> |
|  |  | </> |
|  |  | ); |
|  |  | } |
|  |  | const unsubscribedNewsletter = siteNewsletters?.find((d) => { |
|  |  | return d.uuid === pageData.newsletterUuid; |
|  |  | }); |
|  |  |  |
|  |  | if (!unsubscribedNewsletter) { |
|  |  | return null; |
|  |  | } |
|  |  |  |
|  |  | const hideClassName = hasInteracted ? 'gh-portal-hide' : ''; |
|  |  | return ( |
|  |  | <> |
|  |  | <p className={`gh-portal-text-center gh-portal-header-message ${hideClassName}`}> |
|  |  | <Interpolate |
|  |  | syntax={SYNTAX\_I18NEXT} |
|  |  | string={t('{{memberEmail}} will no longer receive {{newsletterName}} newsletter.')} |
|  |  | mapping={{ |
|  |  | memberEmail: <strong>{member?.email}</strong>, |
|  |  | newsletterName: <strong>{unsubscribedNewsletter?.name}</strong> |
|  |  | }} |
|  |  | /> |
|  |  | </p> |
|  |  | </> |
|  |  | ); |
|  |  | }; |
|  |  |  |
|  |  | const defaultSubscribedNewsletters = [...(member?.newsletters || [])]; |
|  |  | const [subscribedNewsletters, setSubscribedNewsletters] = useState(defaultSubscribedNewsletters); |
|  |  | const {comments\_enabled: commentsEnabled} = site; |
| Expand All | | @@ -28,7 +90,7 @@ export default function AccountEmailPage() { |
|  |  |  |
|  |  | return ( |
|  |  | <NewsletterManagement |
|  |  | notification={null} |
|  |  | notification={newsletterUuid ? HeaderNotification : null} |
|  |  | subscribedNewsletters={subscribedNewsletters} |
|  |  | updateSubscribedNewsletters={(updatedNewsletters) => { |
|  |  | setSubscribedNewsletters(updatedNewsletters); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[apps/portal/src/components/pages/AccountEmailPage.test.js](#diff-79ca2e211aad340f6e1e5f46814839b116aeb2700a731e85c57f57924dd078ca "apps/portal/src/components/pages/AccountEmailPage.test.js")

Show comments

[View file](/TryGhost/Ghost/blob/dac25612520b571f58679764ecc27109e641d1db/apps/portal/src/components/pages/AccountEmailPage.test.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -112,6 +112,6 @@ describe('Account Email Page', () => { |
|  |  | newsletters: newsletterData |
|  |  | }); |
|  |  | const {mockOnActionFn} = setup({site: siteData, member: null}); |
|  |  | expect(mockOnActionFn).toHaveBeenCalledWith('switchPage', {page: 'signin', pageData: {redirect: window.location.href}}); |
|  |  | expect(mockOnActionFn).toHaveBeenCalledWith('switchPage', {page: 'signin'}); |
|  |  | }); |
|  |  | }); |

14 changes: 6 additions & 8 deletions

14
[apps/portal/src/components/pages/FeedbackPage.js](#diff-cea58678b7d7f97c6904a45c630832e762beb7f972b26f56130b37fc4a66cc09 "apps/portal/src/components/pages/FeedbackPage.js")

Show comments

[View file](/TryGhost/Ghost/blob/dac25612520b571f58679764ecc27109e641d1db/apps/portal/src/components/pages/FeedbackPage.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -258,9 +258,9 @@ const ConfirmDialog = ({onConfirm, loading, initialScore}) => { |
|  |  | ); |
|  |  | }; |
|  |  |  |
|  |  | async function sendFeedback({siteUrl, uuid, postId, score}) { |
|  |  | const ghostApi = setupGhostApi({siteUrl}); |
|  |  | await ghostApi.feedback.add({uuid, postId, score}); |
|  |  | async function sendFeedback({siteUrl, uuid, key, postId, score}, api) { |
|  |  | const ghostApi = api || setupGhostApi({siteUrl}); |
|  |  | await ghostApi.feedback.add({uuid, postId, key, score}); |
|  |  | } |
|  |  |  |
|  |  | const LoadingFeedbackView = ({action, score}) => { |
| Expand Down  Expand Up | | @@ -301,11 +301,10 @@ const ConfirmFeedback = ({positive}) => { |
|  |  | }; |
|  |  |  |
|  |  | export default function FeedbackPage() { |
|  |  | const {site, pageData, member, t} = useContext(AppContext); |
|  |  | const {uuid, postId, score: initialScore} = pageData; |
|  |  | const {site, pageData, member, t, api} = useContext(AppContext); |
|  |  | const {uuid, key, postId, score: initialScore} = pageData; |
|  |  | const [score, setScore] = useState(initialScore); |
|  |  | const positive = score === 1; |
|  |  |  |
|  |  | const isLoggedIn = !!member; |
|  |  |  |
|  |  | const [confirmed, setConfirmed] = useState(isLoggedIn); |
| Expand All | | @@ -315,7 +314,7 @@ export default function FeedbackPage() { |
|  |  | const doSendFeedback = async (selectedScore) => { |
|  |  | setLoading(true); |
|  |  | try { |
|  |  | await sendFeedback({siteUrl: site.url, uuid, postId, score: selectedScore}); |
|  |  | await sendFeedback({siteUrl: site.url, uuid, key, postId, score: selectedScore}, api); |
|  |  | setScore(selectedScore); |
|  |  | } catch (e) { |
|  |  | const text = HumanReadableError.getMessageFromError(e, t('There was a problem submitting your feedback. Please try again a little later.')); |
| Expand All | | @@ -341,6 +340,5 @@ export default function FeedbackPage() { |
|  |  | return <LoadingFeedbackView action={doSendFeedback} score={score} />; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | return (<ConfirmFeedback positive={positive} />); |
|  |  | } |

40 changes: 40 additions & 0 deletions

40
[apps/portal/src/components/pages/FeedbackPage.test.js](#diff-2ffacf707223aa83932b966976a6c47d1e5c9d9aa987d3586f5c0b78c49d9b86 "apps/portal/src/components/pages/FeedbackPage.test.js")

Show comments

[View file](/TryGhost/Ghost/blob/dac25612520b571f58679764ecc27109e641d1db/apps/portal/src/components/pages/FeedbackPage.test.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,40 @@ |
|  |  | import {getMemberData, getSiteData} from '../../utils/fixtures-generator'; |
|  |  | import {render} from '../../utils/test-utils'; |
|  |  | import FeedbackPage from './FeedbackPage'; |
|  |  |  |
|  |  | const setup = (overrides) => { |
|  |  | const {mockOnActionFn, ...utils} = render( |
|  |  | <FeedbackPage />, |
|  |  | { |
|  |  | overrideContext: { |
|  |  | ...overrides |
|  |  | } |
|  |  | } |
|  |  | ); |
|  |  | return { |
|  |  | mockOnActionFn, |
|  |  | ...utils |
|  |  | }; |
|  |  | }; |
|  |  |  |
|  |  | describe('FeedbackPage', () => { |
|  |  | const siteData = getSiteData(); |
|  |  | const posts = siteData.posts; |
|  |  | const member = getMemberData(); |
|  |  |  |
|  |  | // we need the API to actually test the component, so the bulk of tests will be in the FeedbackFlow file |
|  |  | test('renders', () => { |
|  |  | // mock what the larger app would process and set |
|  |  | const pageData = { |
|  |  | uuid: member.uuid, |
|  |  | key: 'key', |
|  |  | postId: posts[0].id, |
|  |  | score: 1 |
|  |  | }; |
|  |  | const {getByTestId} = setup({pageData}); |
|  |  |  |
|  |  | const loaderIcon = getByTestId('loaderIcon'); |
|  |  |  |
|  |  | expect(loaderIcon).toBeInTheDocument(); |
|  |  | }); |
|  |  | }); |

2 changes: 1 addition & 1 deletion

2
[apps/portal/src/components/pages/LoadingPage.js](#diff-53bf88f596a83b8910f148fd210699da5b23e4b3e83e3eda56aad85ce3352a90 "apps/portal/src/components/pages/LoadingPage.js")

Show comments

[View file](/TryGhost/Ghost/blob/dac25612520b571f58679764ecc27109e641d1db/apps/portal/src/components/pages/LoadingPage.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,7 +6,7 @@ export default class LoadingPage extends React.Component { |
|  |  | return ( |
|  |  | <div style={{display: 'flex', flexDirection: 'column', color: '#313131'}}> |
|  |  | <div style={{paddingLeft: '16px', paddingRight: '16px', paddingTop: '12px', height: '50px'}}> |
|  |  | <LoaderIcon className={'gh-portal-loadingicon dark'} /> |
|  |  | <LoaderIcon className={'gh-portal-loadingicon dark'} data-testid="loaderIcon" /> |
|  |  | </div> |
|  |  | </div> |
|  |  | ); |
| Expand Down | |  |

10 changes: 5 additions & 5 deletions

10
[apps/portal/src/components/pages/UnsubscribePage.js](#diff-c3174d6f8a6ab89397ed3773e941f40a2f06fb767c1a66bebc7a772df956f013 "apps/portal/src/components/pages/UnsubscribePage.js")

Show comments

[View file](/TryGhost/Ghost/blob/dac25612520b571f58679764ecc27109e641d1db/apps/portal/src/components/pages/UnsubscribePage.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,9 +32,9 @@ function AccountHeader() { |
|  |  | ); |
|  |  | } |
|  |  |  |
|  |  | async function updateMemberNewsletters({api, memberUuid, newsletters, enableCommentNotifications}) { |
|  |  | async function updateMemberNewsletters({api, memberUuid, key, newsletters, enableCommentNotifications}) { |
|  |  | try { |
|  |  | return await api.member.updateNewsletters({uuid: memberUuid, newsletters, enableCommentNotifications}); |
|  |  | return await api.member.updateNewsletters({uuid: memberUuid, key, newsletters, enableCommentNotifications}); |
|  |  | } catch (e) { |
|  |  | // ignore auto unsubscribe error |
|  |  | } |
| Expand Down  Expand Up | | @@ -62,7 +62,7 @@ export default function UnsubscribePage() { |
|  |  | // when we have a member logged in, we need to update the newsletters in the context |
|  |  | onAction('updateNewsletterPreference', {newsletters}); |
|  |  | } else { |
|  |  | await updateMemberNewsletters({api, memberUuid: pageData.uuid, newsletters}); |
|  |  | await updateMemberNewsletters({api, memberUuid: pageData.uuid, key: pageData.key, newsletters}); |
|  |  | } |
|  |  | setSubscribedNewsletters(newsletters); |
|  |  | }; |
| Expand All | | @@ -74,7 +74,7 @@ export default function UnsubscribePage() { |
|  |  | await onAction('updateNewsletterPreference', {enableCommentNotifications: enabled}); |
|  |  | updatedData = {...loggedInMember, enable\_comment\_notifications: enabled}; |
|  |  | } else { |
|  |  | updatedData = await updateMemberNewsletters({api, memberUuid: pageData.uuid, enableCommentNotifications: enabled}); |
|  |  | updatedData = await updateMemberNewsletters({api, memberUuid: pageData.uuid, key: pageData.key, enableCommentNotifications: enabled}); |
|  |  | } |
|  |  | setMember(updatedData); |
|  |  | }; |
| Expand Down  Expand Up | | @@ -102,7 +102,7 @@ export default function UnsubscribePage() { |
|  |  | (async () => { |
|  |  | let memberData; |
|  |  | try { |
|  |  | memberData = await api.member.newsletters({uuid: pageData.uuid}); |
|  |  | memberData = await api.member.newsletters({uuid: pageData.uuid, key: pageData.key}); |
|  |  | setMember(memberData ?? null); |
|  |  | setLoading(false); |
|  |  | } catch (e) { |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `dac2561`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTryGhost%2FGhost%2Fcommit%2Fdac25612520b571f58679764ecc27109e641d1db) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_0d940aa9_20250111_063156.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTryGhost%2FGhost%2Fsecurity%2Fadvisories%2FGHSA-78x2-cwp9-5j42)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTryGhost%2FGhost%2Fsecurity%2Fadvisories%2FGHSA-78x2-cwp9-5j42)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=TryGhost%2FGhost)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TryGhost](/TryGhost)
/
**[Ghost](/TryGhost/Ghost)**
Public

* [Notifications](/login?return_to=%2FTryGhost%2FGhost) You must be signed in to change notification settings
* [Fork
  10.5k](/login?return_to=%2FTryGhost%2FGhost)
* [Star
   48k](/login?return_to=%2FTryGhost%2FGhost)

* [Code](/TryGhost/Ghost)
* [Issues
  29](/TryGhost/Ghost/issues)
* [Pull requests
  144](/TryGhost/Ghost/pulls)
* [Actions](/TryGhost/Ghost/actions)
* [Security](/TryGhost/Ghost/security)
* [Insights](/TryGhost/Ghost/pulse)

Additional navigation options

* [Code](/TryGhost/Ghost)
* [Issues](/TryGhost/Ghost/issues)
* [Pull requests](/TryGhost/Ghost/pulls)
* [Actions](/TryGhost/Ghost/actions)
* [Security](/TryGhost/Ghost/security)
* [Insights](/TryGhost/Ghost/pulse)

# Improper authentication allows access to member information and actions

Moderate

[daniellockyer](/daniellockyer)
published
GHSA-78x2-cwp9-5j42
Aug 20, 2024

## Package

npm

ghost
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

>=4.46.0 <5.89.5

## Patched versions

5.89.5

## Description

### Impact

Improper authentication on some endpoints used for member actions would allow an attacker to perform member-only actions, and read member information.

### Vulnerable versions

This security vulnerability is present in Ghost v4.46.0-v5.89.5.

Ghost(Pro) customers are automatically updated to fixed versions ahead of disclosure.

If you're a self-hoster, please follow our [update instructions](https://ghost.org/docs/update).

### Patches

v5.89.5 contains a fix for this issue.

### Workarounds

Disable site membership in Ghost settings.

### For more information

If you have any questions or comments about this advisory:

* Email us at security@ghost.org

### Severity

Moderate

5.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
Low

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N

### CVE ID

CVE-2024-43409

### Weaknesses

No CWEs

### Credits

* [![@1337Nerd](https://avatars.githubusercontent.com/u/26494273?s=40&v=4)](/1337Nerd)
  [1337Nerd](/1337Nerd)
  Reporter

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


