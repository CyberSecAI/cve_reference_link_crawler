
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fissues%2F2197)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fissues%2F2197)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=opencontainers%2Frunc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[opencontainers](/opencontainers)
/
**[runc](/opencontainers/runc)**
Public

* [Notifications](/login?return_to=%2Fopencontainers%2Frunc) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fopencontainers%2Frunc)
* [Star
   12k](/login?return_to=%2Fopencontainers%2Frunc)

* [Code](/opencontainers/runc)
* [Issues
  278](/opencontainers/runc/issues)
* [Pull requests
  86](/opencontainers/runc/pulls)
* [Discussions](/opencontainers/runc/discussions)
* [Actions](/opencontainers/runc/actions)
* [Projects
  0](/opencontainers/runc/projects)
* [Wiki](/opencontainers/runc/wiki)
* [Security](/opencontainers/runc/security)
* [Insights](/opencontainers/runc/pulse)

Additional navigation options

* [Code](/opencontainers/runc)
* [Issues](/opencontainers/runc/issues)
* [Pull requests](/opencontainers/runc/pulls)
* [Discussions](/opencontainers/runc/discussions)
* [Actions](/opencontainers/runc/actions)
* [Projects](/opencontainers/runc/projects)
* [Wiki](/opencontainers/runc/wiki)
* [Security](/opencontainers/runc/security)
* [Insights](/opencontainers/runc/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fopencontainers%2Frunc%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fopencontainers%2Frunc%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [CVE-2019-19921]: Volume mount race condition with shared mounts #2197

Closed

[leoluk](/leoluk) opened this issue
Jan 1, 2020
· 12 comments
 · Fixed by [#2207](https://github.com/opencontainers/runc/pull/2207)

Closed

# [[CVE-2019-19921]: Volume mount race condition with shared mounts](#top) #2197

[leoluk](/leoluk) opened this issue
Jan 1, 2020
· 12 comments
 · Fixed by [#2207](https://github.com/opencontainers/runc/pull/2207)

## Comments

[![@leoluk](https://avatars.githubusercontent.com/u/859697?s=80&u=7b48717d874db97a9e010be91a8064ef31753e09&v=4)](/leoluk)

Copy link

### **[leoluk](/leoluk)** commented [Jan 1, 2020](#issue-544355271)

| Disclosed in [#2190](https://github.com/opencontainers/runc/pull/2190).  Here's the original report to security@opencontainers.org:  Hi all,  an attacker who controls the container image for two containers that share a volume can race volume mounts during container initialization, by adding a symlink to the rootfs that points to a directory on the volume. The second container won't be able to see the actual mount, but it can race it by modifying the mount point on the volume.  This can be exploited for a full container breakout by racing readonly/mask mounts, allowing writes to dangerous paths like `/proc/sys/kernel/core_pattern`.  Example:   * The rootfs of container A has a symlink `/proc` -> `/evil/level1` * Container A specifies a named volume mounted to `/evil` * Container B, started before container A, shares this named volume and repeatedly swaps `/evil/level1` and `/evil/level1~` * Container A mounts procfs to `/evil/level1~/level2`, but when it remounts `/proc/sys`, it does so at `/evil/level1/level2/sys`.   This can reliably be reproduced using runc and podman on Fedora 30 (takes about 0-5s to win the race for me): <https://gist.github.com/leoluk/82965ad9df58247202aa0e1878439092>  SELinux would ordinarily prevent the exploit by disallowing `container_t` from writing `usermodehelper_t`, but it can be disabled by symlinking `/proc/self/task/1/attr/exec` to something benign like `/proc/self/sched` (bypassing the procfs check). AppArmor can be disabled similarly.  Docker specifies the mounts in a different order and mounts procfs after it mounts the volumes, mounting over the /proc symlink, which appears to prevent at least the /proc approach. I haven't tested other runc usage scenarios, for instance, k8s+cri-o might be vulnerable as well.  Fabian of Cure53 (in CC) created a minimal PoC that uses runc directly: <https://gist.github.com/LiveOverflow/c937820b688922eb127fb760ce06dab9>  There are other container init steps after the volume mount that can be raced, obvious ones being utils.CloseExecFrom and the AppArmor/SELinux attrs but there might be others, especially in mountToRootfs (like tricking remount into mounting the rootfs as rshared if there's another volume that specifies the flag, but I haven't tried that).  This is similar to the vulnerability I reported that Adam Iwaniuk disclosed during their Dragon Sector CTF ([#2128](https://github.com/opencontainers/runc/issues/2128)) and a similar crun one ([containers/crun#111](https://github.com/containers/crun/issues/111)).  The fix for the mounts is probably what Aleksa outlined here, using /proc/self/fd to resolve the path: [containers/crun#111 (comment)](https://github.com/containers/crun/issues/111#issuecomment-536495867) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@leoluk](https://avatars.githubusercontent.com/u/859697?s=40&u=7b48717d874db97a9e010be91a8064ef31753e09&v=4)](/leoluk)
[leoluk](/leoluk)
mentioned this issue
[Jan 1, 2020](#ref-pullrequest-541248947)

[Adding Security audit
#2190](/opencontainers/runc/pull/2190)
 Merged

[![@cyphar](https://avatars.githubusercontent.com/u/2888411?s=80&u=96f0216b5c50fdb0eb6e06bdf1e86c7bc226555d&v=4)](/cyphar)

Copy link

Member

### **[cyphar](/cyphar)** commented [Jan 1, 2020](#issuecomment-570055971) • edited Loading

| My proposed ("stop the bleeding") patch was something like the following:  ``` commit 81a9af6677b1f87e70b87e9a655cb4f4d06a0503 (HEAD -> fix-double-volume-attack) Author: Aleksa Sarai <asarai@suse.de> Date:   Sat Dec 21 23:40:17 2019 +1100      rootfs: do not permit /proc mounts to non-directories          mount(2) will blindly follow symlinks, which is a problem because it     allows a malicious container to trick runc into mounting /proc to an     entirely different location (and thus within the attacker's control for     a rename-exchange attack).          This is just a hotfix, and the more complete fix would be finish     libpathrs and port runc to it (to avoid these types of attacks entirely,     and defend against a variety of other /proc-related attacks).          Fixes: CVE-YYYY-XXXX     Signed-off-by: Aleksa Sarai <asarai@suse.de>  diff --git a/libcontainer/rootfs_linux.go b/libcontainer/rootfs_linux.go index 291021440a1a..6e896bc4fdaa 100644 --- a/libcontainer/rootfs_linux.go +++ b/libcontainer/rootfs_linux.go @@ -297,17 +297,49 @@ func mountToRootfs(m *configs.Mount, rootfs, mountLabel string, enableCgroupns b                 dest = filepath.Join(rootfs, dest)         }   +       // For "special" filesystems, we have to be quite careful about mounting -- +       // we must make sure that the destination is what we expect. This is done +       // by opening the destination as an O_PATH descriptor, and using the +       // /proc/self/fd/... as the mount target. Unfortunately this is actually +       // possible to bypass with a little bit of thought, but the complete +       // solution for this will be to port runc to libpathrs.         switch m.Device { -       case "proc", "sysfs": +       case "proc", "sysfs", "mqueue": +               // NOTE: If the container controls any part of dest, this is unsafe.                 if err := os.MkdirAll(dest, 0755); err != nil {                         return err                 } +               destFd, err := unix.Open(dest, unix.O_PATH|unix.O_CLOEXEC, 0) +               if err != nil { +                       return err +               } +               defer unix.Close(destFd) + +               // Check that the path is exactly what we expect. +               // NOTE: If the path contains an attacker-controlled bind-mount, this +               //       check won't do anything. In addition, if procfs is fraudulent, +               //       it will also be useless. As above, the solution is to switch +               //       to libpathrs. +               destFdPath := fmt.Sprintf("/proc/self/fd/%d", destFd) +               destUnsafePath, err := os.Readlink(destFdPath) +               if err != nil { +                       return err +               } +               if destUnsafePath != dest { +                       return fmt.Errorf("detected possible breakout: trying to mount '%s' on '%s' was actually targeted to '%s'", m.Device, dest, destUnsafePath) +               } + +               // Okay, now we can use destFdPath. +               dest = destFdPath +               m.Destination = destFdPath +       } + +       // Now actually do the mount. +       switch m.Device { +       case "proc", "sysfs":                 // Selinux kernels do not support labeling of /proc or /sys                 return mountPropagate(m, rootfs, "")         case "mqueue": -               if err := os.MkdirAll(dest, 0755); err != nil { -                       return err -               }                 if err := mountPropagate(m, rootfs, mountLabel); err != nil {                         // older kernels do not support labeling of /dev/mqueue                         if err := mountPropagate(m, rootfs, ""); err != nil { ```  Unfortunately this is not sufficient if `/` is shared with another container, because then you can do the same trick (but this time on `/` directly). It also needs some more work to work around the fact that there are `m.Destination`-based checks elsewhere in `rootfs_linux.go`. |
| --- |

All reactions

Sorry, something went wrong.

[![@leoluk](https://avatars.githubusercontent.com/u/859697?s=80&u=7b48717d874db97a9e010be91a8064ef31753e09&v=4)](/leoluk)

Copy link

Author

### **[leoluk](/leoluk)** commented [Jan 4, 2020](#issuecomment-570793686)

| Your patch does stop the bleeding, though - most runc use cases do not share the rootfs. Mounting a volume on `/` breaks all kinds of things. Haven't managed to do anything useful using either cri-o or podman. |
| --- |

All reactions

Sorry, something went wrong.

[![@cyphar](https://avatars.githubusercontent.com/u/2888411?s=80&u=96f0216b5c50fdb0eb6e06bdf1e86c7bc226555d&v=4)](/cyphar)

Copy link

Member

### **[cyphar](/cyphar)** commented [Jan 4, 2020](#issuecomment-570824350)

| Alright, I'll prepare a PR. Thanks [@leoluk](https://github.com/leoluk) -- and sorry for the response time issues (as well as how the disclosure happened). |
| --- |

All reactions

Sorry, something went wrong.

[![@liggitt](https://avatars.githubusercontent.com/u/980082?s=80&u=e6d3a90de563c894207290d21eb6987a1d45391a&v=4)](/liggitt)

Copy link

Contributor

### **[liggitt](/liggitt)** commented [Jan 13, 2020](#issuecomment-573830382)

| any ETA on the workaround to unblock rc10? |
| --- |

 👀
1
 BenTheElder reacted with eyes emoji

All reactions

* 👀
  1 reaction

Sorry, something went wrong.

[![@liggitt](https://avatars.githubusercontent.com/u/980082?s=40&u=e6d3a90de563c894207290d21eb6987a1d45391a&v=4)](/liggitt)
[liggitt](/liggitt)
mentioned this issue
[Jan 13, 2020](#ref-pullrequest-539772987)

[Fix race checking for process exit and waiting for exec fifo
#2185](/opencontainers/runc/pull/2185)
 Merged

[![@cyphar](https://avatars.githubusercontent.com/u/2888411?s=80&u=96f0216b5c50fdb0eb6e06bdf1e86c7bc226555d&v=4)](/cyphar)

Copy link

Member

### **[cyphar](/cyphar)** commented [Jan 14, 2020](#issuecomment-573970338) • edited Loading

| I've been off the face of the earth for the past 2ish weeks. I will prepare a PR tomorrow. |
| --- |

All reactions

Sorry, something went wrong.

[![@liggitt](https://avatars.githubusercontent.com/u/980082?s=40&u=e6d3a90de563c894207290d21eb6987a1d45391a&v=4)](/liggitt)
[liggitt](/liggitt)
mentioned this issue
[Jan 14, 2020](#ref-issue-538490398)

["OCI runtime start failed" runc race causes many CI failures/flakes
kubernetes/kubernetes#86312](/kubernetes/kubernetes/issues/86312)

Closed

16 tasks

[![@cyphar](https://avatars.githubusercontent.com/u/2888411?s=40&u=96f0216b5c50fdb0eb6e06bdf1e86c7bc226555d&v=4)](/cyphar)
[cyphar](/cyphar)
mentioned this issue
[Jan 14, 2020](#ref-pullrequest-549327120)

[rootfs: do not permit /proc mounts to non-directories
#2207](/opencontainers/runc/pull/2207)
 Merged

[![@cyphar](https://avatars.githubusercontent.com/u/2888411?s=80&u=96f0216b5c50fdb0eb6e06bdf1e86c7bc226555d&v=4)](/cyphar)

Copy link

Member

### **[cyphar](/cyphar)** commented [Jan 14, 2020](#issuecomment-573997784)

| [#2207](https://github.com/opencontainers/runc/pull/2207) contains a very simplified version of the above patch (the patch I posted above doesn't work because `rootfs_linux.go` has a very fun relationship with pathnames that I don't have time to debug right now). |
| --- |

All reactions

Sorry, something went wrong.

[![@mrunalp](https://avatars.githubusercontent.com/u/53798?s=40&v=4)](/mrunalp)
[mrunalp](/mrunalp)
closed this as [completed](/opencontainers/runc/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#2207](/opencontainers/runc/pull/2207)
[Jan 22, 2020](#event-2970641890)

[CameronNemo](/CameronNemo)
added a commit
to CameronNemo/void-packages
that referenced
this issue
[Jan 24, 2020](#ref-commit-6762c1d)
[![@CameronNemo](https://avatars.githubusercontent.com/u/3212452?s=40&v=4)](/CameronNemo)

`[runc: update to 1.0.0rc9.](/CameronNemo/void-packages/commit/6762c1d51ceab32007174817f3ea927dabeffa2e "runc: update to 1.0.0rc9.

Fix CVE-2019-19921

See https://github.com/opencontainers/runc/issues/2197")`
…

`[6762c1d](/CameronNemo/void-packages/commit/6762c1d51ceab32007174817f3ea927dabeffa2e)`

```
Fix [CVE-2019-19921](https://github.com/advisories/GHSA-fh74-hm69-rqjw "CVE-2019-19921")

See [opencontainers/runc#2197](https://github.com/opencontainers/runc/issues/2197)
```

[![@CameronNemo](https://avatars.githubusercontent.com/u/3212452?s=40&v=4)](/CameronNemo)
[CameronNemo](/CameronNemo)
mentioned this issue
[Jan 24, 2020](#ref-pullrequest-554550645)

[runc: update to 1.0.0rc10.
void-linux/void-packages#18526](/void-linux/void-packages/pull/18526)
 Merged

[CameronNemo](/CameronNemo)
added a commit
to CameronNemo/void-packages
that referenced
this issue
[Jan 24, 2020](#ref-commit-90c94ff)
[![@CameronNemo](https://avatars.githubusercontent.com/u/3212452?s=40&v=4)](/CameronNemo)

`[runc: update to 1.0.0rc10.](/CameronNemo/void-packages/commit/90c94ffb22325141e6396ba30a0f7e253a2ab69d "runc: update to 1.0.0rc10.

Fix CVE-2019-19921

See https://github.com/opencontainers/runc/issues/2197")`
…

`[90c94ff](/CameronNemo/void-packages/commit/90c94ffb22325141e6396ba30a0f7e253a2ab69d)`

```
Fix [CVE-2019-19921](https://github.com/advisories/GHSA-fh74-hm69-rqjw "CVE-2019-19921")

See [opencontainers/runc#2197](https://github.com/opencontainers/runc/issues/2197)
```

[Hoshpak](/Hoshpak)
pushed a commit
to void-linux/void-packages
that referenced
this issue
[Jan 24, 2020](#ref-commit-1702166)
[![@CameronNemo](https://avatars.githubusercontent.com/u/3212452?s=40&v=4)](/CameronNemo) [![@Hoshpak](https://avatars.githubusercontent.com/u/13802545?s=40&v=4)](/Hoshpak)

`[runc: update to 1.0.0rc10.](/void-linux/void-packages/commit/17021665cad7f84cf95fde6e94e84285786c9920 "runc: update to 1.0.0rc10.

Fix CVE-2019-19921

See https://github.com/opencontainers/runc/issues/2197")`
…

`[1702166](/void-linux/void-packages/commit/17021665cad7f84cf95fde6e94e84285786c9920)`

```
Fix [CVE-2019-19921](https://github.com/advisories/GHSA-fh74-hm69-rqjw "CVE-2019-19921")

See [opencontainers/runc#2197](https://github.com/opencontainers/runc/issues/2197)
```

This was referenced Jan 24, 2020

[Bump to opencontainers/runc new version - v1.0.0-rc10
containerd/containerd#3973](/containerd/containerd/pull/3973)
 Merged

[update runc to v1.0.0-rc10 (CVE-2019-19921)
moby/moby#40404](/moby/moby/pull/40404)
 Merged

[![@kolyshkin](https://avatars.githubusercontent.com/u/4522509?s=40&v=4)](/kolyshkin)
[kolyshkin](/kolyshkin)
mentioned this issue
[Jan 5, 2021](#ref-issue-744522059)

[tmpfs and symlink resolution
#2683](/opencontainers/runc/issues/2683)

Closed

[![@Beuc](https://avatars.githubusercontent.com/u/980977?s=80&u=ebd1a7b491cae0a6c408db9296b6739bd5c423ad&v=4)](/Beuc)

Copy link

### **[Beuc](/Beuc)** commented [Feb 20, 2023](#issuecomment-1437276049)

| Hi,  I'm part of the Debian Long Term Support (LTS) team, and I'm attempting to fix [CVE-2019-19921](https://github.com/advisories/GHSA-fh74-hm69-rqjw "CVE-2019-19921") in our past releases that package "runc". (apologizes for digging up this old issue :))  I'm still able to reproduce the vulnerability (using the runc [reproducer](https://gist.github.com/LiveOverflow/c937820b688922eb127fb760ce06dab9) linked in the original topic), in the following situations:   * backporting the fix [2fc03cc](https://github.com/opencontainers/runc/commit/2fc03cc11c775b7a8b2e48d7ee447cb9bef32ad0) to 1.0.0~rc6 (Debian 10 "buster"/"old-stable") * more annoyingly, with 1.0.0~rc93, as shipped in Debian 11 "bullseye"/current; for reference the fix was pushed to rc10   AFAICS the fix does make the exploit less likely, but does not stop it entirely: within a few minutes I'm still able to overwrite my root system's /proc/sys/kernel/core\_pattern from container-2.  Is this expected (as in, it's a mitigation but not a bullet-proof fix)? Or is there a follow-up fix that I missed?  Thanks for your attention and best regards. |
| --- |

All reactions

Sorry, something went wrong.

[![@leoluk](https://avatars.githubusercontent.com/u/859697?s=80&u=7b48717d874db97a9e010be91a8064ef31753e09&v=4)](/leoluk)

Copy link

Author

### **[leoluk](/leoluk)** commented [Feb 20, 2023](#issuecomment-1437343803) • edited Loading

| [2fc03cc](https://github.com/opencontainers/runc/commit/2fc03cc11c775b7a8b2e48d7ee447cb9bef32ad0) should completely prevent the exploit. It adds a check to avoid mounting procfs to `/proc` in the rootfs if the target is something other than a directory or absent, which makes it impossible to point it to an attacker-controlled bind mount. It's not possible to race `/proc` itself in this setup (the rootfs is not attacker-accessible during early setup).  Either there's a regression or something's wrong with the Debian backport. |
| --- |

All reactions

Sorry, something went wrong.

[![@leoluk](https://avatars.githubusercontent.com/u/859697?s=80&u=7b48717d874db97a9e010be91a8064ef31753e09&v=4)](/leoluk)

Copy link

Author

### **[leoluk](/leoluk)** commented [Feb 20, 2023](#issuecomment-1437364156)

| The code is definitely included in Debian 1.0.0~rc93: [https://salsa.debian.org/go-team/packages/runc/-/blob/debian/1.0.0\_rc93+ds1-5+deb11u2/libcontainer/rootfs\_linux.go#L314](https://salsa.debian.org/go-team/packages/runc/-/blob/debian/1.0.0_rc93%2Bds1-5%2Bdeb11u2/libcontainer/rootfs_linux.go#L314) |
| --- |

All reactions

Sorry, something went wrong.

[![@Beuc](https://avatars.githubusercontent.com/u/980977?s=80&u=ebd1a7b491cae0a6c408db9296b6739bd5c423ad&v=4)](/Beuc)

Copy link

### **[Beuc](/Beuc)** commented [Feb 20, 2023](#issuecomment-1437617334)

| Thanks for your fast feedback!  Debian might have different dependency versions, because it mostly removes vendor/\* and uses the packaged versions. Thus I tried with a Ubuntu Focal (20.04) VM where 'runc' is built with the built-in vendor/\*, to make sure if that was the reason.  Interestingly:   * 1.0.0~rc10-0ubuntu1 correctly blocs the mount attempt early and 'runc run container-[12]' fails ("must be mounted on ordinary directory") * 1.0.0~rc95-0ubuntu1~20.04.2 is vulnerable to the PoC * 1.1.0-0ubuntu1~20.04.2 is vulnerable to the PoC   So AFAICS, despite the presence of the fix in all versions, some other commit re-introduced the issue. (and similarly the fix alone didn't appear to fix ~rc6 in my previous message)  If you've got further insights I'd be grateful :) Otherwise I can try and bisect to pinpoint when the fix lost its effectiveness (probably tomorrow). |
| --- |

All reactions

Sorry, something went wrong.

[![@Beuc](https://avatars.githubusercontent.com/u/980977?s=80&u=ebd1a7b491cae0a6c408db9296b6739bd5c423ad&v=4)](/Beuc)

Copy link

### **[Beuc](/Beuc)** commented [Feb 21, 2023](#issuecomment-1438208699)

| After a bit of digging, ironically it looks like the fix for this vulnerability ([CVE-2019-19921](https://github.com/advisories/GHSA-fh74-hm69-rqjw "CVE-2019-19921")) was broken by the one for [CVE-2021-30465](https://github.com/advisories/GHSA-c3xm-pvg7-gh7r "CVE-2021-30465"): [0ca91f4](https://github.com/opencontainers/runc/commit/0ca91f44f1664da834bc61115a849b56d22f595f) This sounds like a regression as you suspected.  Do you want me to open a new ticket for this? And register a new CVE (if you confirm)? |
| --- |

All reactions

Sorry, something went wrong.

[![@Beuc](https://avatars.githubusercontent.com/u/980977?s=40&u=ebd1a7b491cae0a6c408db9296b6739bd5c423ad&v=4)](/Beuc)
[Beuc](/Beuc)
mentioned this issue
[Feb 24, 2023](#ref-issue-1599144908)

[CVE-2019-19921 re-introduction/regression
#3751](/opencontainers/runc/issues/3751)

Closed

[![@butterflyhack](https://avatars.githubusercontent.com/u/11525772?s=80&u=07a0a8f4df77c838a85d458e29e25c0aba582596&v=4)](/butterflyhack)

Copy link

### **[butterflyhack](/butterflyhack)** commented [Apr 24, 2023](#issuecomment-1519962534)

| hi，I can not reproduce the vulnerability, I use debian 10, kernel version: Linux runc 4.19.0-23-amd64 [#1](https://github.com/opencontainers/runc/issues/1) SMP Debian 4.19.269-1 (2022-12-20) x86\_64 x86\_64 x86\_64 GNU/Linux. runc version: 1.0.0~rc93+ds1-5+deb11u2. When I run pwn in container-1, the error is "SYS\_renameat2: Permission denied", can not change "/poc/layer". |
| --- |

All reactions

Sorry, something went wrong.

[![@eshafaq1](https://avatars.githubusercontent.com/u/133929829?s=40&v=4)](/eshafaq1)
[eshafaq1](/eshafaq1)
mentioned this issue
[Aug 8, 2023](#ref-issue-1840569317)

[gosu binary Vuln with thirdparty github.com/opencontainers/runc (CVE-2023-27561)
tianon/gosu#130](/tianon/gosu/issues/130)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fissues%2F2197)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [rootfs: do not permit /proc mounts to non-directories](/opencontainers/runc/pull/2207)

5 participants

[![@leoluk](https://avatars.githubusercontent.com/u/859697?s=52&v=4)](/leoluk) [![@liggitt](https://avatars.githubusercontent.com/u/980082?s=52&v=4)](/liggitt) [![@Beuc](https://avatars.githubusercontent.com/u/980977?s=52&v=4)](/Beuc) [![@cyphar](https://avatars.githubusercontent.com/u/2888411?s=52&v=4)](/cyphar) [![@butterflyhack](https://avatars.githubusercontent.com/u/11525772?s=52&v=4)](/butterflyhack)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

