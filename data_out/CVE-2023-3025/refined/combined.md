=== Content from plugins.trac.wordpress.org_93c2a05f_20250111_152652.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fdropbox-folder-share%2Ftrunk%2FHynoTech%2FDropboxFolderShare%2FPrincipal.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/dropbox-folder-share/trunk/HynoTech/DropboxFolderShare/Principal.php?rev=2904670 "Revision 2904670")
* Next Revision →
* [Blame](/browser/dropbox-folder-share/trunk/HynoTech/DropboxFolderShare/Principal.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/dropbox-folder-share/trunk/HynoTech/DropboxFolderShare/Principal.php)

---

# [source:](/browser?order=name "Go to repository root") [dropbox-folder-share](/browser/dropbox-folder-share?order=name "View dropbox-folder-share")/[trunk](/browser/dropbox-folder-share/trunk?order=name "View trunk")/[HynoTech](/browser/dropbox-folder-share/trunk/HynoTech?order=name "View HynoTech")/[DropboxFolderShare](/browser/dropbox-folder-share/trunk/HynoTech/DropboxFolderShare?order=name "View DropboxFolderShare")/[Principal.php](/browser/dropbox-folder-share/trunk/HynoTech/DropboxFolderShare/Principal.php?order=name "View Principal.php")

View diff against:

View revision:

| [Last change](/changeset/2909685/dropbox-folder-share/trunk/HynoTech/DropboxFolderShare/Principal.php "View differences") on this file was [2909685](/changeset/2909685/ "View changeset 2909685"), checked in by antony\_salas, [20 months ago](/timeline?from=2023-05-08T17%3A11%3A11Z&precision=second "See timeline at 05/08/2023 05:11:11 PM") |
| --- |
| Cambio Boton Donaciones |
| **File size:** 42.5 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Created by PhpStorm. |
| [4](#L4) | \* User: antony |
| [5](#L5) | \* Date: 06/08/18 |
| [6](#L6) | \* Time: 11:14 PM |
| [7](#L7) | \*/ |
| [8](#L8) |  |
| [9](#L9) | namespace HynoTech\DropboxFolderShare; |
| [10](#L10) |  |
| [11](#L11) |  |
| [12](#L12) | use HynoTech\Drives\Cloud\Dropbox; |
| [13](#L13) |  |
| [14](#L14) | Class Principal |
| [15](#L15) | { |
| [16](#L16) |  |
| [17](#L17) | const \_VERSION\_GENERAL\_ = "1.9"; |
| [18](#L18) | const \_VERSION\_JS\_ = "1.9"; |
| [19](#L19) | const \_VERSION\_CSS\_ = "1.9"; |
| [20](#L20) | const \_VERSION\_ADMIN\_ = "3.0"; |
| [21](#L21) | const \_VERSION\_CSS\_DROPBOX\_ = "3.0"; |
| [22](#L22) |  |
| [23](#L23) | const \_PARENT\_PAGE\_ = "options-general.php"; |
| [24](#L24) | const \_OPT\_SEETINGS\_ = "dropbox-folder-share-options"; |
| [25](#L25) | const \_PERMISOS\_REQUERIDOS\_ = 'manage\_options'; |
| [26](#L26) |  |
| [27](#L27) | var $formSections = array(); |
| [28](#L28) | var $settings = array(); //Almacena los opciones actuales del Plugin |
| [29](#L29) | var $opcDefault = array( |
| [30](#L30) | "showIcons" => '1', |
| [31](#L31) | "showSize" => '1', |
| [32](#L32) | "showChange" => '1', |
| [33](#L33) | "showThumbnail" => '1', |
| [34](#L34) | "allowDownload" => '1', |
| [35](#L35) | "allowBrowseFolder" => '1', |
| [36](#L36) | "allowDownloadFolder" => '1', |
| [37](#L37) | "showInEditor" => '1', |
| [38](#L38) | "dbNativeViewer" => '1', |
| [39](#L39) | "imagesPopup" => '1', |
| [40](#L40) | "link2Folder" => '1', |
| [41](#L41) | "datetimeFormat" => 'd/m/Y H:i', |
| [42](#L42) | "thickboxTypes" => 'txt,html,htm', |
| [43](#L43) | "defaultHeight" => '300px' |
| [44](#L44) | ); |
| [45](#L45) |  |
| [46](#L46) | public function \_\_construct() { |
| [47](#L47) |  |
| [48](#L48) | $zone = explode("\_", get\_locale()); |
| [49](#L49) |  |
| [50](#L50) | setlocale(LC\_TIME, get\_locale()); |
| [51](#L51) |  |
| [52](#L52) | \Carbon\Carbon::setLocale($zone[0]); |
| [53](#L53) |  |
| [54](#L54) | \Carbon\Carbon::setToStringFormat(get\_option('date\_format') . " " . get\_option('time\_format')); |
| [55](#L55) |  |
| [56](#L56) | load\_plugin\_textdomain("dropbox-folder-share", false, "dropbox-folder-share" . '/languages/'); |
| [57](#L57) |  |
| [58](#L58) | $objDFS\_Admin = new Admin(); |
| [59](#L59) | add\_action('admin\_menu', array(&$objDFS\_Admin, 'pagAdmin')); |
| [60](#L60) | add\_action('admin\_init', array(&$objDFS\_Admin, 'plugin\_admin\_init')); |
| [61](#L61) |  |
| [62](#L62) | add\_filter('plugin\_action\_links\_' . DROPBOX\_FOLDER\_SHARE\_PLUGIN\_BASENAME, array(&$this, 'add\_settings\_link'), 10, 2); |
| [63](#L63) |  |
| [64](#L64) | $this->inicializarVariables(); |
| [65](#L65) | } |
| [66](#L66) |  |
| [67](#L67) | public function inicializarVariables() { |
| [68](#L68) | if (get\_option(self::\_OPT\_SEETINGS\_) == null) { |
| [69](#L69) | update\_option(self::\_OPT\_SEETINGS\_, $this->opcDefault); |
| [70](#L70) | } |
| [71](#L71) | } |
| [72](#L72) |  |
| [73](#L73) | public function formatSizeUnits($bytes) { |
| [74](#L74) | if ($bytes >= 1073741824) { |
| [75](#L75) | $bytes = number\_format($bytes / 1073741824, 2) . ' GB'; |
| [76](#L76) | } elseif ($bytes >= 1048576) { |
| [77](#L77) | $bytes = number\_format($bytes / 1048576, 2) . ' MB'; |
| [78](#L78) | } elseif ($bytes >= 1024) { |
| [79](#L79) | $bytes = number\_format($bytes / 1024, 2) . ' KB'; |
| [80](#L80) | } elseif ($bytes > 1) { |
| [81](#L81) | $bytes = $bytes . ' bytes'; |
| [82](#L82) | } elseif ($bytes == 1) { |
| [83](#L83) | $bytes = $bytes . ' byte'; |
| [84](#L84) | } else { |
| [85](#L85) | $bytes = '0 bytes'; |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | return $bytes; |
| [89](#L89) | } |
| [90](#L90) |  |
| [91](#L91) |  |
| [92](#L92) | function getMetaTags($str) { |
| [93](#L93) | $pattern = ' |
| [94](#L94) | ~<\s\*meta\s |
| [95](#L95) |  |
| [96](#L96) | # using lookahead to capture type to $1 |
| [97](#L97) | (?=[^>]\*? |
| [98](#L98) | \b(?:name|property|http-equiv)\s\*=\s\* |
| [99](#L99) | (?|"\s\*([^"]\*?)\s\*"|\'\s\*([^\']\*?)\s\*\'| |
| [100](#L100) | ([^"\'>]\*?)(?=\s\*/?\s\*>|\s\w+\s\*=)) |
| [101](#L101) | ) |
| [102](#L102) |  |
| [103](#L103) | # capture content to $2 |
| [104](#L104) | [^>]\*?\bcontent\s\*=\s\* |
| [105](#L105) | (?|"\s\*([^"]\*?)\s\*"|\'\s\*([^\']\*?)\s\*\'| |
| [106](#L106) | ([^"\'>]\*?)(?=\s\*/?\s\*>|\s\w+\s\*=)) |
| [107](#L107) | [^>]\*> |
| [108](#L108) |  |
| [109](#L109) | ~ix'; |
| [110](#L110) |  |
| [111](#L111) | if (preg\_match\_all($pattern, $str, $out)) { |
| [112](#L112) | return array\_combine($out[1], $out[2]); |
| [113](#L113) | } |
| [114](#L114) |  |
| [115](#L115) | return array(); |
| [116](#L116) | } |
| [117](#L117) |  |
| [118](#L118) | function ajaxGetHeaders() { |
| [119](#L119) | $content = $this->fetch\_url($\_POST['link']); |
| [120](#L120) |  |
| [121](#L121) | $content = $this->getMetaTags($content->response); |
| [122](#L122) |  |
| [123](#L123) | header('Content-type: application/json; charset=utf-8'); |
| [124](#L124) | echo json\_encode($content); |
| [125](#L125) | exit(); |
| [126](#L126) | } |
| [127](#L127) |  |
| [128](#L128) | function ajaxReplaceShortcode($atts) { |
| [129](#L129) |  |
| [130](#L130) | if (!isset($\_POST['dfs\_nonce']) || !wp\_verify\_nonce($\_POST['dfs\_nonce'], 'dfs\_nonce')) |
| [131](#L131) | die(\_\_("Error de seguridad", "dropbox-folder-share")); |
| [132](#L132) |  |
| [133](#L133) |  |
| [134](#L134) | // set defaults |
| [135](#L135) | $opciones = get\_option(self::\_OPT\_SEETINGS\_); |
| [136](#L136) | extract(shortcode\_atts(array( |
| [137](#L137) | 'link' => $\_POST['link'], |
| [138](#L138) | 'show\_icon' => $\_POST['showIcons'], |
| [139](#L139) | 'show\_size' => $\_POST['showSize'], |
| [140](#L140) | 'show\_change' => $\_POST['showChange'] |
| [141](#L141) | ), $atts)); |
| [142](#L142) |  |
| [143](#L143) | $opciones\_shortcode = array( |
| [144](#L144) | 'link' => $link, |
| [145](#L145) | 'showIcons' => $show\_icon, |
| [146](#L146) | 'showSize' => $show\_size, |
| [147](#L147) | 'showChange' => $show\_change |
| [148](#L148) | ); |
| [149](#L149) |  |
| [150](#L150) | $idContent = $\_POST['idContent']; |
| [151](#L151) | $titleBar = @$\_POST["titleBar"]; |
| [152](#L152) |  |
| [153](#L153) | echo $this->get\_folder($opciones\_shortcode, $idContent, $titleBar); |
| [154](#L154) | die(); |
| [155](#L155) | } |
| [156](#L156) |  |
| [157](#L157) | function scriptAjax($opciones\_shortcode, $idContent) { |
| [158](#L158) | //$idContent = "DFS".rand(1,99999); |
| [159](#L159) | $url\_imgLoader = DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . "/src/img/gears.svg"; |
| [160](#L160) |  |
| [161](#L161) | $data = json\_encode($opciones\_shortcode); |
| [162](#L162) |  |
| [163](#L163) | $regresarScript = "<div id='$idContent'>"; |
| [164](#L164) | //$regresarScript .= "<div class=\"loader\">Loading...</div>"; |
| [165](#L165) | $regresarScript .= "<div style='text-align: center'><img src=\"{$url\_imgLoader}\"></div>"; |
| [166](#L166) | $regresarScript .= "</div>"; |
| [167](#L167) | $regresarScript .= "<script>"; |
| [168](#L168) | $regresarScript .= "loadContenDFS('$data', '$idContent')"; |
| [169](#L169) | $regresarScript .= "</script>"; |
| [170](#L170) | return $regresarScript; |
| [171](#L171) | } |
| [172](#L172) |  |
| [173](#L173) | function replace\_shortcode($atts) { |
| [174](#L174) | $idContent = "DFS" . mt\_rand(1, 99999); |
| [175](#L175) | // set defaults |
| [176](#L176) | $opciones = get\_option(self::\_OPT\_SEETINGS\_); |
| [177](#L177) | extract(shortcode\_atts(array( |
| [178](#L178) | 'link' => 'https://www.dropbox.com/sh/8ifs95x8qgcaf71/1TCmt\_bBy1', |
| [179](#L179) | 'show\_icon' => $opciones['showIcons'], |
| [180](#L180) | 'show\_size' => $opciones['showSize'], |
| [181](#L181) | 'show\_change' => $opciones['showChange'] |
| [182](#L182) | ), $atts)); |
| [183](#L183) |  |
| [184](#L184) | $opciones\_shortcode = array( |
| [185](#L185) | 'link' => $link, |
| [186](#L186) | 'showIcons' => (($show\_icon === 'true') || ($show\_icon === '1')) ? '1' : '', |
| [187](#L187) | 'showSize' => (($show\_size === 'true') || ($show\_size === '1')) ? '1' : '', |
| [188](#L188) | 'showChange' => (($show\_change === 'true') || ($show\_change === '1')) ? '1' : '' |
| [189](#L189) | ); |
| [190](#L190) | return $this->scriptAjax($opciones\_shortcode, $idContent); |
| [191](#L191) |  |
| [192](#L192) | // |
| [193](#L193) |  |
| [194](#L194) | } |
| [195](#L195) |  |
| [196](#L196) |  |
| [197](#L197) | function fetch\_url($url, $headers = false, $tipo = 'get', $data = [], $cookies = []) { |
| [198](#L198) |  |
| [199](#L199) | if (function\_exists("curl\_init")) { |
| [200](#L200) |  |
| [201](#L201) | $txtLocale = str\_replace("\_", "-", get\_locale()); |
| [202](#L202) |  |
| [203](#L203) | $curl = new \Curl\Curl(); |
| [204](#L204) | $curl->setopt(CURLOPT\_RETURNTRANSFER, TRUE); |
| [205](#L205) | $curl->setopt(CURLOPT\_SSL\_VERIFYPEER, FALSE); |
| [206](#L206) |  |
| [207](#L207) | /\* |
| [208](#L208) | if(wp\_is\_mobile()){ |
| [209](#L209) | $curl->setUserAgent('Mozilla/5.0 (Linux; U; Android 4.0.3; ko-kr; LG-L160L Build/IML74K) AppleWebkit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30'); |
| [210](#L210) | } |
| [211](#L211) | \*/ |
| [212](#L212) | if ($headers) { |
| [213](#L213) | $curl->setopt(CURLOPT\_HEADER, true); |
| [214](#L214) | $curl->setopt(CURLOPT\_NOBODY, true); |
| [215](#L215) |  |
| [216](#L216) | } |
| [217](#L217) | $curl->setopt(CURLOPT\_FOLLOWLOCATION, true); |
| [218](#L218) | $curl->setHeader('Accept-Language', $txtLocale); |
| [219](#L219) |  |
| [220](#L220) | //$curl->setCookie('key', 'value'); |
| [221](#L221) | $curl->setCookies($cookies); |
| [222](#L222) |  |
| [223](#L223) | switch ($tipo) { |
| [224](#L224) | case 'post': |
| [225](#L225) | $curl->post($url, $data); |
| [226](#L226) | break; |
| [227](#L227) | case 'options': |
| [228](#L228) | $curl->options($url, $data); |
| [229](#L229) | break; |
| [230](#L230) | default: |
| [231](#L231) | $curl->get($url); |
| [232](#L232) | break; |
| [233](#L233) | } |
| [234](#L234) |  |
| [235](#L235) | return ($headers) ? $curl->responseHeaders : $curl; |
| [236](#L236) | } else { |
| [237](#L237) | echo "<h3>ERROR: curl disabled</h3>"; |
| [238](#L238) | return false; |
| [239](#L239) | } |
| [240](#L240) |  |
| [241](#L241) | return false; |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) | function get\_folder($opciones\_shortcode, $id\_content = null, $titleBar = null) { |
| [245](#L245) | $opcion = get\_option(self::\_OPT\_SEETINGS\_); |
| [246](#L246) |  |
| [247](#L247) | $link = $opciones\_shortcode['link']; |
| [248](#L248) |  |
| [249](#L249) | $opcion = array\_merge($opcion, $opciones\_shortcode); |
| [250](#L250) |  |
| [251](#L251) | $url\_data = $link; |
| [252](#L252) |  |
| [253](#L253) | $data = json\_encode($opciones\_shortcode); |
| [254](#L254) | $data = str\_replace("\"", "\\'", $data); |
| [255](#L255) | $data = 'rev\_' . $data; |
| [256](#L256) |  |
| [257](#L257) | $reintentos = 0; |
| [258](#L258) | do { |
| [259](#L259) | $response = new Dropbox($url\_data); |
| [260](#L260) | // $response = new Dropbox('https://www.dropbox.com/sh/8ifs95x8qgcaf71/AAAUdBHtQXdzkZRYpPsE1x3SMa?dl=0'); |
| [261](#L261) | $dataCarpeta = $response->dataContenido('array'); |
| [262](#L262) | $reintentos++; |
| [263](#L263) | } while (is\_null($dataCarpeta->id) && $reintentos < 5); |
| [264](#L264) |  |
| [265](#L265) |  |
| [266](#L266) | $dataCarpeta->numSubCarpetas(); |
| [267](#L267) | $dataCarpeta->numArchivos(); |
| [268](#L268) | //        echo "<pre>"; |
| [269](#L269) | //        print\_r($dataCarpeta); |
| [270](#L270) | //        echo "</pre>"; |
| [271](#L271) |  |
| [272](#L272) | if (is\_null($dataCarpeta->id)) { |
| [273](#L273) | $retorno = ' |
| [274](#L274) | <div class="err sl-list-container" style="width: 100%; text-align: center;"> |
| [275](#L275) | <img src="' . DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . '/src/img/error\_404.png" alt="" width="30%"> |
| [276](#L276) | <h4 class="sl-empty-folder-message">' . \_\_("No encontramos lo que buscas.", "dropbox-folder-share") . '</h4> |
| [277](#L277) | </div> |
| [278](#L278) | '; |
| [279](#L279) | return json\_encode(['html' => $retorno, 'imgs' => []]); |
| [280](#L280) | } |
| [281](#L281) |  |
| [282](#L282) | $jsonExtensiones = file\_get\_contents(\_\_DIR\_\_ . '/json/extensiones.json'); |
| [283](#L283) |  |
| [284](#L284) | $domRetorno = new \DOMDocument('1.0', 'UTF-8'); |
| [285](#L285) | $datosCarpetaLocal = [ |
| [286](#L286) | "nombre" => $dataCarpeta->nombre, |
| [287](#L287) | "path" => $dataCarpeta->linkSubPath, |
| [288](#L288) | "linkKey" => $dataCarpeta->linkKey, |
| [289](#L289) | "secureHash" => $dataCarpeta->linkSecureHash, |
| [290](#L290) | "link" => $dataCarpeta->href, |
| [291](#L291) | "propietario" => $dataCarpeta->propietario, |
| [292](#L292) | "archivos" => $dataCarpeta->archivos, |
| [293](#L293) | "carpetas" => $dataCarpeta->subCarpetas, |
| [294](#L294) | ]; |
| [295](#L295) |  |
| [296](#L296) |  |
| [297](#L297) | $detalleURL = parse\_url($datosCarpetaLocal["link"]); |
| [298](#L298) |  |
| [299](#L299) | $html\_ol['breadcrumb'] = $domRetorno->createElement('ol'); |
| [300](#L300) | $html\_ol['breadcrumb']->setAttribute('class', 'breadcrumb'); |
| [301](#L301) | $html\_ol['breadcrumb']->setAttribute('style', 'font-size: 16px; margin:0px;'); |
| [302](#L302) |  |
| [303](#L303) |  |
| [304](#L304) | $addLIZip = $domRetorno->createElement('li'); |
| [305](#L305) | if ($opcion['allowDownloadFolder'] === '1') { |
| [306](#L306) |  |
| [307](#L307) | $query\_params['dl'] = 1; |
| [308](#L308) | $detalleURL['query'] = http\_build\_query($query\_params); |
| [309](#L309) |  |
| [310](#L310) | $lnkDescarga = http\_build\_url($link, |
| [311](#L311) | $detalleURL, |
| [312](#L312) | HTTP\_URL\_STRIP\_AUTH | HTTP\_URL\_JOIN\_PATH | HTTP\_URL\_JOIN\_QUERY | HTTP\_URL\_STRIP\_FRAGMENT |
| [313](#L313) | ); |
| [314](#L314) |  |
| [315](#L315) |  |
| [316](#L316) | $addIMGZip = $domRetorno->createElement('img'); |
| [317](#L317) | $addIMGZip->setAttribute('src', DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . 'src/img/zip.png'); |
| [318](#L318) | $addIMGZip->setAttribute('title', \_\_('Descargar carpeta actual (zip)', 'dropbox-folder-share')); |
| [319](#L319) |  |
| [320](#L320) | $addAZip = $domRetorno->createElement('a'); |
| [321](#L321) | $addAZip->setAttribute('href', $lnkDescarga); |
| [322](#L322) | $addAZip->setAttribute('target', "\_blank"); |
| [323](#L323) | $addAZip->appendChild($addIMGZip); |
| [324](#L324) |  |
| [325](#L325) | $addLIZip->setAttribute('class', 'pull-right'); //creado fuera del IF |
| [326](#L326) | $addLIZip->appendChild($addAZip); |
| [327](#L327) |  |
| [328](#L328) | } |
| [329](#L329) |  |
| [330](#L330) |  |
| [331](#L331) | //solo entra si existe una barra de titulo, es decir si es sub carpeta |
| [332](#L332) | if ($titleBar != null) { |
| [333](#L333) | $titleBar = str\_replace('\\"', '"', $titleBar); |
| [334](#L334) | $titleBar = str\_replace("\\'", "'", $titleBar); |
| [335](#L335) | $titleBar = str\_replace("\\\\", "\\", $titleBar); |
| [336](#L336) |  |
| [337](#L337) | $titleBar = $this->limpiahtml($titleBar); |
| [338](#L338) |  |
| [339](#L339) | $doc = new \DOMDocument(); |
| [340](#L340) |  |
| [341](#L341) | $doc->loadHTML(mb\_convert\_encoding($titleBar, 'HTML-ENTITIES', 'UTF-8')); |
| [342](#L342) |  |
| [343](#L343) | $elemLiBreadcrumb = $doc->getElementsByTagName('li'); |
| [344](#L344) |  |
| [345](#L345) | $elemOlBreadcrumb = $doc->getElementsByTagName('ol'); |
| [346](#L346) |  |
| [347](#L347) | $lnkSup = false; |
| [348](#L348) | foreach ($elemLiBreadcrumb as $li) { |
| [349](#L349) |  |
| [350](#L350) | if ($li->getAttribute('class') == 'pull-right') { |
| [351](#L351) | $li->parentNode->removeChild($li); |
| [352](#L352) | } else { |
| [353](#L353) | $html\_ol['breadcrumb']->appendChild($domRetorno->importNode($li, true)); |
| [354](#L354) | if ($li->getAttribute('data-id') == $datosCarpetaLocal["secureHash"]) { |
| [355](#L355) | $lnkSup = true; |
| [356](#L356) | break; |
| [357](#L357) | } |
| [358](#L358) | } |
| [359](#L359) | } |
| [360](#L360) |  |
| [361](#L361) | $elemA\_1 = $domRetorno->createElement('a', $datosCarpetaLocal["nombre"]); |
| [362](#L362) | $elemA\_1->setAttribute('href', $link); |
| [363](#L363) | $elemA\_1->setAttribute('onclick', "loadContenDFS('{$data}', '{$id\_content}'); varTitulo = 1; return false;"); |
| [364](#L364) | $elemA\_1->setAttribute('data-titulo', '1'); |
| [365](#L365) |  |
| [366](#L366) | $elemIMG\_2 = $domRetorno->createElement('img'); |
| [367](#L367) | $elemIMG\_2->setAttribute('width', '12px'); |
| [368](#L368) | $elemIMG\_2->setAttribute('src', DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . '/src/img/ico-external-link.png'); |
| [369](#L369) |  |
| [370](#L370) | $elemA\_2 = $domRetorno->createElement('a'); |
| [371](#L371) | $elemA\_2->setAttribute('href', $link); |
| [372](#L372) | $elemA\_2->setAttribute('target', '\_blank'); |
| [373](#L373) | $elemA\_2->appendChild($elemIMG\_2); |
| [374](#L374) |  |
| [375](#L375) | $elemLi = $domRetorno->createElement('li'); |
| [376](#L376) | $elemLi->setAttribute('data-id', $datosCarpetaLocal["secureHash"]); |
| [377](#L377) | $elemLi->appendChild($elemA\_1); |
| [378](#L378) | $elemLi->appendChild($elemA\_2); |
| [379](#L379) |  |
| [380](#L380) | if (!$lnkSup) { |
| [381](#L381) | $html\_ol['breadcrumb']->appendChild($elemLi); |
| [382](#L382) | } |
| [383](#L383) |  |
| [384](#L384) | if ($opcion['allowDownloadFolder'] === '1') { |
| [385](#L385) | $html\_ol['breadcrumb']->appendChild($addLIZip); |
| [386](#L386) | } |
| [387](#L387) |  |
| [388](#L388) | } |
| [389](#L389) | else { |
| [390](#L390) | $html\_i['fa-dropbox'] = $domRetorno->createElement('i'); |
| [391](#L391) | $html\_i['fa-dropbox']->setAttribute('class', 'fa fa-dropbox'); |
| [392](#L392) | $html\_i['fa-dropbox']->setAttribute('style', 'color: #0082E6;'); |
| [393](#L393) |  |
| [394](#L394) | $html\_li[0] = $domRetorno->createElement('li'); |
| [395](#L395) | $html\_li[0]->appendChild($html\_i['fa-dropbox']); |
| [396](#L396) |  |
| [397](#L397) | $html\_a['ajax'] = $domRetorno->createElement('a', $datosCarpetaLocal["nombre"]); |
| [398](#L398) | $html\_a['ajax']->setAttribute('href', $link); |
| [399](#L399) | $html\_a['ajax']->setAttribute('data-titulo', '1'); |
| [400](#L400) | $html\_a['ajax']->setAttribute('onclick', "loadContenDFS('{$data}', '{$id\_content}'); varTitulo = 1; return false;"); |
| [401](#L401) |  |
| [402](#L402) | $html\_img['ext\_icon'] = $domRetorno->createElement('img'); |
| [403](#L403) | $html\_img['ext\_icon']->setAttribute('width', '12px'); |
| [404](#L404) | $html\_img['ext\_icon']->setAttribute('src', DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . "src/img/ico-external-link.png"); |
| [405](#L405) |  |
| [406](#L406) | $html\_a['blank'] = $domRetorno->createElement('a'); |
| [407](#L407) | $html\_a['blank']->setAttribute('href', $link); |
| [408](#L408) | $html\_a['blank']->setAttribute('target', '\_blank'); |
| [409](#L409) | $html\_a['blank']->appendChild($html\_img['ext\_icon']); |
| [410](#L410) |  |
| [411](#L411) | $html\_li[1] = $domRetorno->createElement('li'); |
| [412](#L412) | $html\_li[1]->setAttribute('data-id', $datosCarpetaLocal["secureHash"]); |
| [413](#L413) | $html\_li[1]->appendChild($html\_a['ajax']); |
| [414](#L414) | $html\_li[1]->appendChild($html\_a['blank']); |
| [415](#L415) |  |
| [416](#L416) | //$html\_ol['breadcrumb'] creado al inicio del if de este else y superior |
| [417](#L417) | $html\_ol['breadcrumb']->appendChild($html\_li[0]); |
| [418](#L418) | $html\_ol['breadcrumb']->appendChild($html\_li[1]); |
| [419](#L419) | if ($opcion['allowDownloadFolder'] === '1') { |
| [420](#L420) | $html\_ol['breadcrumb']->appendChild($addLIZip); |
| [421](#L421) | } |
| [422](#L422) |  |
| [423](#L423) | } |
| [424](#L424) |  |
| [425](#L425) |  |
| [426](#L426) | $cantData = count($datosCarpetaLocal["carpetas"]) + count($datosCarpetaLocal["archivos"]); |
| [427](#L427) |  |
| [428](#L428) | if ($cantData > 0) { |
| [429](#L429) |  |
| [430](#L430) |  |
| [431](#L431) | if ($opcion['link2Folder'] != '1') { |
| [432](#L432) |  |
| [433](#L433) | $domRetorno->appendChild($html\_ol['breadcrumb']); |
| [434](#L434) |  |
| [435](#L435) | $this->EliminarTAG($domRetorno, '//a'); |
| [436](#L436) | $this->EliminarTAG($domRetorno, '//img[@width="12px"]'); |
| [437](#L437) |  |
| [438](#L438) | } |
| [439](#L439) |  |
| [440](#L440) |  |
| [441](#L441) | $displaySize = "auto"; |
| [442](#L442) | $displayChange = "auto"; |
| [443](#L443) | $seccionesLista = [58.6, 19.5, 21.9]; |
| [444](#L444) | if (($opcion['allowDownload'] === '1') || ($opcion['allowDownloadFolder'] === '1')) { |
| [445](#L445) | $seccionesLista = [58.6, 16.5, 18.9]; |
| [446](#L446) | } |
| [447](#L447) | if(wp\_is\_mobile()){ |
| [448](#L448) | $seccionesLista = [100, 0, 0]; |
| [449](#L449) | if (($opcion['allowDownload'] === '1') || ($opcion['allowDownloadFolder'] === '1')) { |
| [450](#L450) | $seccionesLista = [94, 0, 0]; |
| [451](#L451) | } |
| [452](#L452) | $displaySize = "none"; |
| [453](#L453) | $displayChange = "none"; |
| [454](#L454) | } |
| [455](#L455) | else{ |
| [456](#L456) | if ($opcion['showSize'] != '1') { |
| [457](#L457) | $displaySize = "none"; |
| [458](#L458) | $seccionesLista[0] += $seccionesLista[1]; |
| [459](#L459) | $seccionesLista[1] = 0; |
| [460](#L460) | } |
| [461](#L461) |  |
| [462](#L462) |  |
| [463](#L463) | if ($opcion['showChange'] != '1') { |
| [464](#L464) | $displayChange = "none"; |
| [465](#L465) | $seccionesLista[0] += $seccionesLista[2]; |
| [466](#L466) | $seccionesLista[2] = 0; |
| [467](#L467) | } |
| [468](#L468) | } |
| [469](#L469) |  |
| [470](#L470) |  |
| [471](#L471) | $html\_ol['sl-list-body'] = $domRetorno->createElement('ol');//revisar separacion |
| [472](#L472) | $html\_ol['sl-list-body']->setAttribute('class', 'sl-list-body o-list-ui o-list-ui--dividers'); |
| [473](#L473) | $html\_ol['sl-list-body']->setAttribute('style', "max-height:" . (($opcion['defaultHeight'] != '0') ? $opcion['defaultHeight'] : 'auto') . "; overflow:auto; margin: 0px !important"); |
| [474](#L474) | foreach ($datosCarpetaLocal["carpetas"] as $carpeta) { |
| [475](#L475) | $folderName = $carpeta->nombre; |
| [476](#L476) | $folderHref = $carpeta->href; |
| [477](#L477) | $opciones\_shortcode['link'] = $folderHref; |
| [478](#L478) |  |
| [479](#L479) | $data = json\_encode($opciones\_shortcode); |
| [480](#L480) | $data = str\_replace("\"", "\\'", $data); |
| [481](#L481) | $data = 'rev\_' . $data; |
| [482](#L482) |  |
| [483](#L483) | $displayIcon = "auto"; |
| [484](#L484) | if ($opcion['showIcons'] != '1') { |
| [485](#L485) | $displayIcon = "none"; |
| [486](#L486) | } |
| [487](#L487) |  |
| [488](#L488) | $html\_li\_div\_a\_div\_div\_img\_lista = $domRetorno->createElement('img'); |
| [489](#L489) | $html\_li\_div\_a\_div\_div\_img\_lista->setAttribute('class', 'sprite sprite\_web s\_web\_folder\_32 icon'); |
| [490](#L490) | $html\_li\_div\_a\_div\_div\_img\_lista->setAttribute('src', DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . 'src/img/icon\_spacer.gif'); |
| [491](#L491) |  |
| [492](#L492) | $html\_li\_div\_a\_div\_div\_lista = $domRetorno->createElement('div'); |
| [493](#L493) | $html\_li\_div\_a\_div\_div\_lista->setAttribute('class', 'o-flag\_\_fix'); |
| [494](#L494) | $html\_li\_div\_a\_div\_div\_lista->setAttribute('style', "display: {$displayIcon} "); |
| [495](#L495) | $html\_li\_div\_a\_div\_div\_lista->appendChild($html\_li\_div\_a\_div\_div\_img\_lista); |
| [496](#L496) |  |
| [497](#L497) | $html\_li\_div\_a\_div\_div2\_lista = $domRetorno->createElement('div', $folderName); |
| [498](#L498) | $html\_li\_div\_a\_div\_div2\_lista->setAttribute('class', 'o-flag\_\_flex'); |
| [499](#L499) | $html\_li\_div\_a\_div\_div2\_lista->setAttribute('style', 'flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;'); |
| [500](#L500) | //$html\_li\_div\_a\_div\_div2\_lista->setAttribute('style',"display: {$displayIcon} "); |
| [501](#L501) |  |
| [502](#L502) | $html\_li\_div\_a\_div\_lista = $domRetorno->createElement('div'); |
| [503](#L503) | $html\_li\_div\_a\_div\_lista->setAttribute('class', 'o-flag'); |
| [504](#L504) | $html\_li\_div\_a\_div\_lista->appendChild($html\_li\_div\_a\_div\_div\_lista); |
| [505](#L505) | $html\_li\_div\_a\_div\_lista->appendChild($html\_li\_div\_a\_div\_div2\_lista); |
| [506](#L506) |  |
| [507](#L507) |  |
| [508](#L508) | $html\_li\_div\_a\_lista = $domRetorno->createElement('a'); |
| [509](#L509) | $html\_li\_div\_a\_lista->setAttribute('href', $folderHref); |
| [510](#L510) | $html\_li\_div\_a\_lista->setAttribute('data-titulo', '1'); |
| [511](#L511) | if ($opcion['allowBrowseFolder'] == '1') { |
| [512](#L512) | $html\_li\_div\_a\_lista->setAttribute('onclick', "loadContenDFS('{$data}', '{$id\_content}'); varTitulo = 1; return false;"); |
| [513](#L513) | } else { |
| [514](#L514) | $html\_li\_div\_a\_lista->setAttribute('onclick', "return false;"); |
| [515](#L515) | } |
| [516](#L516) | $html\_li\_div\_a\_lista->setAttribute('class', 'sl-file-link'); |
| [517](#L517) | $html\_li\_div\_a\_lista->appendChild($html\_li\_div\_a\_div\_lista); |
| [518](#L518) |  |
| [519](#L519) | $html\_li\_div\_lista = $domRetorno->createElement('div'); |
| [520](#L520) | $html\_li\_div\_lista->setAttribute('class', 'sl-list-column sl-list-column--filename'); |
| [521](#L521) | $html\_li\_div\_lista->setAttribute('style', "width: {$seccionesLista[0]}% !important;"); |
| [522](#L522) | $html\_li\_div\_lista->appendChild($html\_li\_div\_a\_lista); |
| [523](#L523) |  |
| [524](#L524) | $html\_li\_div2\_lista = $domRetorno->createElement('div', '--'); |
| [525](#L525) | $html\_li\_div2\_lista->setAttribute('class', 'sl-list-column sl-list-column--filesize'); |
| [526](#L526) | $html\_li\_div2\_lista->setAttribute('style', "width: {$seccionesLista[1]}% !important;; display: {$displaySize} "); |
| [527](#L527) |  |
| [528](#L528) | $html\_li\_div3\_lista = $domRetorno->createElement('div', '--'); |
| [529](#L529) | $html\_li\_div3\_lista->setAttribute('class', 'sl-list-column sl-list-column--modified'); |
| [530](#L530) | $html\_li\_div3\_lista->setAttribute('style', "width: {$seccionesLista[2]}% !important;; display: {$displayChange} "); |
| [531](#L531) |  |
| [532](#L532) | $html\_li\_div4\_lista = $domRetorno->createElement('span'); |
| [533](#L533) | if ($opcion['allowDownloadFolder'] === '1') { |
| [534](#L534) | $fileLinkMostrar = $this->downloadLinkGenerator($folderHref); |
| [535](#L535) | $lnkOrigDescarga = $fileLinkMostrar; |
| [536](#L536) |  |
| [537](#L537) | $aDescarga = $domRetorno->createElement('a'); |
| [538](#L538) | $aDescarga->setAttribute('href', $lnkOrigDescarga); |
| [539](#L539) | //$aDescarga->setAttribute('target', '\_blank'); |
| [540](#L540) |  |
| [541](#L541) | $html\_li\_div4\_lista = $domRetorno->createElement('i'); |
| [542](#L542) | $html\_li\_div4\_lista->setAttribute('class', 'fa fa-file-archive-o'); |
| [543](#L543) | $html\_li\_div4\_lista->setAttribute('style', 'color: #0082E6;'); |
| [544](#L544) | $aDescarga->appendChild($html\_li\_div4\_lista); |
| [545](#L545) | $html\_li\_div4\_lista = $aDescarga; |
| [546](#L546) | } |
| [547](#L547) |  |
| [548](#L548) | //<i class="fas fa-download"></i> |
| [549](#L549) |  |
| [550](#L550) |  |
| [551](#L551) | $html\_li\_lista = $domRetorno->createElement('li'); |
| [552](#L552) | $html\_li\_lista->setAttribute('class', 'sl-list-row clearfix'); |
| [553](#L553) | $html\_li\_lista->appendChild($html\_li\_div\_lista); |
| [554](#L554) | $html\_li\_lista->appendChild($html\_li\_div2\_lista); |
| [555](#L555) | $html\_li\_lista->appendChild($html\_li\_div3\_lista); |
| [556](#L556) | $html\_li\_lista->appendChild($html\_li\_div4\_lista); |
| [557](#L557) |  |
| [558](#L558) | $html\_ol['sl-list-body']->appendChild($html\_li\_lista); |
| [559](#L559) |  |
| [560](#L560) | } |
| [561](#L561) |  |
| [562](#L562) |  |
| [563](#L563) | $arrayIMG = array(); |
| [564](#L564) |  |
| [565](#L565) | foreach ($datosCarpetaLocal["archivos"] as $archivo) { |
| [566](#L566) |  |
| [567](#L567) |  |
| [568](#L568) | $file\_link = $archivo->href; |
| [569](#L569) |  |
| [570](#L570) | $file\_name = $archivo->nombre; |
| [571](#L571) |  |
| [572](#L572) | $bytes = $archivo->peso; |
| [573](#L573) | $creado = $archivo->fechaCreacion; |
| [574](#L574) |  |
| [575](#L575) | $displayIcon = "auto"; |
| [576](#L576) | if ($opcion['showIcons'] != '1') { |
| [577](#L577) | $displayIcon = "none"; |
| [578](#L578) | } |
| [579](#L579) |  |
| [580](#L580) | $fileLinkMostrar = $file\_link; |
| [581](#L581) |  |
| [582](#L582) | if ($opcion['allowDownload'] === '1') { |
| [583](#L583) | $fileLinkMostrar = $this->downloadLinkGenerator($file\_link); |
| [584](#L584) | } |
| [585](#L585) |  |
| [586](#L586) | $arrayExtThickbox = explode(",", $opcion['thickboxTypes']); |
| [587](#L587) | $classThickBox = ""; |
| [588](#L588) | $relThickBox = ""; |
| [589](#L589) |  |
| [590](#L590) | $lightbox = false; |
| [591](#L591) | if (in\_array($archivo->extension, $arrayExtThickbox)) { |
| [592](#L592) | $lightbox = true; |
| [593](#L593) | } |
| [594](#L594) | else { |
| [595](#L595) | if (($opcion['imagesPopup'] === '1') && ($archivo->icono == 'page\_white\_picture\_32'))  { |
| [596](#L596) | $lightbox = true; |
| [597](#L597) | $relThickBox = "gal\_" . $id\_content; |
| [598](#L598) | } |
| [599](#L599) | } |
| [600](#L600) |  |
| [601](#L601) | if ($lightbox) { |
| [602](#L602) | $classThickBox = "lightbox"; |
| [603](#L603) | $dataWidth = "1000"; |
| [604](#L604) |  |
| [605](#L605) | if ($opcion['dbNativeViewer'] === '1' && $archivo->previsualizacion !== null) { |
| [606](#L606) | $fileLinkMostrar = $archivo->previsualizacion; |
| [607](#L607) | } |
| [608](#L608) | else { |
| [609](#L609) | $fileLinkMostrar = $this->downloadLinkGenerator($file\_link); |
| [610](#L610) | $fileLinkMostrar = "https://docs.google.com/viewer?url=" . $fileLinkMostrar . "&embedded=true&KeepThis=true&TB\_iframe=true&height=400&width=800"; |
| [611](#L611) | } |
| [612](#L612) |  |
| [613](#L613) | } |
| [614](#L614) |  |
| [615](#L615) | if ($opcion['showThumbnail'] === '1' && $archivo->miniatura != null) { |
| [616](#L616) | $html\_li\_div\_a\_div\_div\_img\_lista = $domRetorno->createElement('img'); |
| [617](#L617) | $html\_li\_div\_a\_div\_div\_img\_lista->setAttribute('class', "icon thumbnail-image--loaded"); |
| [618](#L618) | $html\_li\_div\_a\_div\_div\_img\_lista->setAttribute('id', $archivo->id); |
| [619](#L619) | $html\_li\_div\_a\_div\_div\_img\_lista->setAttribute('src', $archivo->miniatura . '?size=32x32&size\_mode=1'); |
| [620](#L620) | } |
| [621](#L621) | else { |
| [622](#L622) | $html\_li\_div\_a\_div\_div\_img\_lista = $domRetorno->createElement('img'); |
| [623](#L623) | $html\_li\_div\_a\_div\_div\_img\_lista->setAttribute('class', "sprite sprite\_web s\_web\_" . $archivo->icono . " icon"); |
| [624](#L624) | $html\_li\_div\_a\_div\_div\_img\_lista->setAttribute('id', $archivo->id); |
| [625](#L625) | $html\_li\_div\_a\_div\_div\_img\_lista->setAttribute('src', DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . 'src/img/icon\_spacer.gif'); |
| [626](#L626) | } |
| [627](#L627) |  |
| [628](#L628) |  |
| [629](#L629) | $html\_li\_div\_a\_div\_div\_lista = $domRetorno->createElement('div'); |
| [630](#L630) | $html\_li\_div\_a\_div\_div\_lista->setAttribute('class', 'o-flag\_\_fix'); |
| [631](#L631) | $html\_li\_div\_a\_div\_div\_lista->setAttribute('style', "display: {$displayIcon} "); |
| [632](#L632) | $html\_li\_div\_a\_div\_div\_lista->appendChild($html\_li\_div\_a\_div\_div\_img\_lista); |
| [633](#L633) |  |
| [634](#L634) | $html\_li\_div\_a\_div\_div2\_lista = $domRetorno->createElement('div', $file\_name); |
| [635](#L635) | $html\_li\_div\_a\_div\_div2\_lista->setAttribute('class', 'o-flag\_\_flex'); |
| [636](#L636) | $html\_li\_div\_a\_div\_div2\_lista->setAttribute('style', 'flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;'); |
| [637](#L637) |  |
| [638](#L638) | $html\_li\_div\_a\_div\_lista = $domRetorno->createElement('div'); |
| [639](#L639) | $html\_li\_div\_a\_div\_lista->setAttribute('class', 'o-flag'); |
| [640](#L640) | $html\_li\_div\_a\_div\_lista->appendChild($html\_li\_div\_a\_div\_div\_lista); |
| [641](#L641) | $html\_li\_div\_a\_div\_lista->appendChild($html\_li\_div\_a\_div\_div2\_lista); |
| [642](#L642) |  |
| [643](#L643) | $html\_li\_div\_a\_lista = $domRetorno->createElement('a'); |
| [644](#L644) | $html\_li\_div\_a\_lista->setAttribute('href', $fileLinkMostrar); |
| [645](#L645) | //$html\_li\_div\_a\_lista->setAttribute('class','sl-file-link '.$classThickBox); |
| [646](#L646) | $html\_li\_div\_a\_lista->setAttribute('class', 'sl-file-link '); |
| [647](#L647) | $html\_li\_div\_a\_lista->setAttribute('title', $file\_name); |
| [648](#L648) | if ($relThickBox != "") { |
| [649](#L649) | $html\_li\_div\_a\_lista->setAttribute('data-gallery', $relThickBox); |
| [650](#L650) | } |
| [651](#L651) | $html\_li\_div\_a\_lista->setAttribute('data-title', $file\_name); |
| [652](#L652) | $html\_li\_div\_a\_lista->setAttribute('data-toggle', $classThickBox); |
| [653](#L653) | if (isset($dataWidth)) { |
| [654](#L654) | $html\_li\_div\_a\_lista->setAttribute('data-width', $dataWidth); |
| [655](#L655) | } |
| [656](#L656) | //$html\_li\_div\_a\_lista->setAttribute('data-remote', $fileLinkMostrar); |
| [657](#L657) | //$html\_li\_div\_a\_lista->setAttribute('rel',$relThickBox); |
| [658](#L658) | $html\_li\_div\_a\_lista->appendChild($html\_li\_div\_a\_div\_lista); |
| [659](#L659) |  |
| [660](#L660) | $html\_li\_div\_lista = $domRetorno->createElement('div'); |
| [661](#L661) | $html\_li\_div\_lista->setAttribute('class', 'sl-list-column sl-list-column--filename'); |
| [662](#L662) | $html\_li\_div\_lista->setAttribute('style', "width: {$seccionesLista[0]}% !important;"); |
| [663](#L663) | $html\_li\_div\_lista->appendChild($html\_li\_div\_a\_lista); |
| [664](#L664) |  |
| [665](#L665) | $html\_li\_div2\_lista = $domRetorno->createElement('div', (($opcion['showSize'] != '1') ? "" : self::formatSizeUnits($bytes))); |
| [666](#L666) | $html\_li\_div2\_lista->setAttribute('class', 'sl-list-column sl-list-column--filesize'); |
| [667](#L667) | $html\_li\_div2\_lista->setAttribute('style', "width: {$seccionesLista[1]}% !important;; display: {$displaySize} "); |
| [668](#L668) |  |
| [669](#L669) | $strFecha = \Carbon\Carbon::createFromTimestamp($creado)->format(isset($opcion['datetimeFormat']) ? $opcion['datetimeFormat'] : get\_option('date\_format') . " " . get\_option('time\_format')); |
| [670](#L670) | //$strFecha = \Carbon\Carbon::createFromTimestamp($creado)->format(get\_option('date\_format')." ". get\_option('time\_format')); |
| [671](#L671) | if ((\Carbon\Carbon::createFromTimestamp($creado)->diffInDays()) <= 30) { |
| [672](#L672) | $strFecha = \Carbon\Carbon::createFromTimestamp($creado)->diffForHumans(); |
| [673](#L673) | } |
| [674](#L674) |  |
| [675](#L675) | $html\_li\_div3\_lista = $domRetorno->createElement('div', $strFecha); |
| [676](#L676) | $html\_li\_div3\_lista->setAttribute('class', 'sl-list-column sl-list-column--modified'); |
| [677](#L677) | $html\_li\_div3\_lista->setAttribute('style', "width: {$seccionesLista[2]}% !important;; display: {$displayChange} "); |
| [678](#L678) |  |
| [679](#L679) | $html\_li\_div4\_lista = $domRetorno->createElement('span'); |
| [680](#L680) | if ($opcion['allowDownload'] === '1') { |
| [681](#L681) | $fileLinkMostrar = $this->downloadLinkGenerator($file\_link); |
| [682](#L682) | $lnkOrigDescarga = $fileLinkMostrar; |
| [683](#L683) |  |
| [684](#L684) | $aDescarga = $domRetorno->createElement('a'); |
| [685](#L685) | $aDescarga->setAttribute('href', $lnkOrigDescarga); |
| [686](#L686) | //$aDescarga->setAttribute('target', '\_blank'); |
| [687](#L687) |  |
| [688](#L688) | $html\_li\_div4\_lista = $domRetorno->createElement('i'); |
| [689](#L689) | $html\_li\_div4\_lista->setAttribute('class', 'fa fa-download'); |
| [690](#L690) | $html\_li\_div4\_lista->setAttribute('style', 'color: #0082E6;'); |
| [691](#L691) |  |
| [692](#L692) | $aDescarga->appendChild($html\_li\_div4\_lista); |
| [693](#L693) | $html\_li\_div4\_lista = $aDescarga; |
| [694](#L694) | } |
| [695](#L695) |  |
| [696](#L696) | $html\_li\_lista = $domRetorno->createElement('li'); |
| [697](#L697) | $html\_li\_lista->setAttribute('class', 'sl-list-row clearfix'); |
| [698](#L698) | $html\_li\_lista->appendChild($html\_li\_div\_lista); |
| [699](#L699) | $html\_li\_lista->appendChild($html\_li\_div2\_lista); |
| [700](#L700) | $html\_li\_lista->appendChild($html\_li\_div3\_lista); |
| [701](#L701) | $html\_li\_lista->appendChild($html\_li\_div4\_lista); |
| [702](#L702) |  |
| [703](#L703) | $domRetorno->appendChild($html\_li\_lista); |
| [704](#L704) |  |
| [705](#L705) | //d($domRetorno->saveHTML($html\_li\_lista)); |
| [706](#L706) |  |
| [707](#L707) | $html\_ol['sl-list-body']->appendChild($html\_li\_lista); |
| [708](#L708) |  |
| [709](#L709) | } |
| [710](#L710) | //d($domRetorno->saveHTML($html\_ol\_lista)); |
| [711](#L711) | //d($datosCarpetaLocal); |
| [712](#L712) |  |
| [713](#L713) |  |
| [714](#L714) | /\*\* |
| [715](#L715) | \* DATOS NECESARIOS |
| [716](#L716) | \*/ |
| [717](#L717) |  |
| [718](#L718) |  |
| [719](#L719) | $html\_div['Hyno\_Breadcrumbs'] = $domRetorno->createElement('div');//content $txtNavegacion |
| [720](#L720) | $html\_div['Hyno\_Breadcrumbs']->setAttribute('class', 'row'); |
| [721](#L721) | $html\_div['Hyno\_Breadcrumbs']->setAttribute('id', "Hyno\_Breadcrumbs\_{$id\_content}"); |
| [722](#L722) | $html\_div['Hyno\_Breadcrumbs']->appendChild($domRetorno->importNode($html\_ol['breadcrumb'])); |
| [723](#L723) |  |
| [724](#L724) | $html\_div['Hyno\_Header'] = $domRetorno->createElement('div');//contenido $txtCarpeta |
| [725](#L725) | $html\_div['Hyno\_Header']->setAttribute('class', 'sl-header clearfix'); |
| [726](#L726) | $html\_div['Hyno\_Header']->setAttribute('id', "Hyno\_Header\_{$id\_content}"); |
| [727](#L727) | //$html\_div['Hyno\_Header']->appendChild($domRetorno->importNode($elemOlBreadcrumbPrincipal, true)); |
| [728](#L728) |  |
| [729](#L729) | //-----bloque grande --- |
| [730](#L730) | $html\_div['filename'] = $domRetorno->createElement('div', \_\_('Nombre', 'dropbox-folder-share')); |
| [731](#L731) | $html\_div['filename']->setAttribute('class', 'sl-list-column sl-list-column--filename'); |
| [732](#L732) | $html\_div['filename']->setAttribute('style', "width: {$seccionesLista[0]}% !important;"); |
| [733](#L733) |  |
| [734](#L734) | $html\_div['filesize'] = $domRetorno->createElement('div', \_\_('Tamaño', 'dropbox-folder-share')); |
| [735](#L735) | $html\_div['filesize']->setAttribute('class', 'sl-list-column sl-list-column--filesize'); |
| [736](#L736) | $html\_div['filesize']->setAttribute('style', "width: {$seccionesLista[1]}% !important; display: {$displaySize} "); |
| [737](#L737) |  |
| [738](#L738) | $html\_div['modified'] = $domRetorno->createElement('div', \_\_('Modificado', 'dropbox-folder-share')); |
| [739](#L739) | $html\_div['modified']->setAttribute('class', 'sl-list-column sl-list-column--modified'); |
| [740](#L740) | $html\_div['modified']->setAttribute('style', "width: {$seccionesLista[2]}% !important; display: {$displayChange} "); |
| [741](#L741) |  |
| [742](#L742) |  |
| [743](#L743) | $html\_div['accion'] = $domRetorno->createElement('span'); |
| [744](#L744) | if ($opcion['allowDownload'] === '1') { |
| [745](#L745) | $html\_div['accion'] = $domRetorno->createElement('div', ''); |
| [746](#L746) | $html\_div['accion']->setAttribute('class', 'sl-list-column'); |
| [747](#L747) | $html\_div['accion']->setAttribute('style', "width: 4% !important; display: {$displayChange} "); |
| [748](#L748) | } |
| [749](#L749) |  |
| [750](#L750) |  |
| [751](#L751) | $html\_div['sl-list-row'] = $domRetorno->createElement('div'); |
| [752](#L752) | $html\_div['sl-list-row']->setAttribute('class', 'sl-list-row clearfix'); |
| [753](#L753) | $html\_div['sl-list-row']->appendChild($html\_div['filename']); |
| [754](#L754) | $html\_div['sl-list-row']->appendChild($html\_div['filesize']); |
| [755](#L755) | $html\_div['sl-list-row']->appendChild($html\_div['modified']); |
| [756](#L756) | $html\_div['sl-list-row']->appendChild($html\_div['accion']); |
| [757](#L757) |  |
| [758](#L758) | $html\_div['sl-list-header'] = $domRetorno->createElement('div'); |
| [759](#L759) | $html\_div['sl-list-header']->setAttribute('class', 'sl-list-header'); |
| [760](#L760) | $html\_div['sl-list-header']->setAttribute('style', "border-bottom: solid 1px; "); |
| [761](#L761) | $html\_div['sl-list-header']->appendChild($html\_div['sl-list-row']); |
| [762](#L762) |  |
| [763](#L763) | $html\_div['sl-list-container'] = $domRetorno->createElement('div'); |
| [764](#L764) | $html\_div['sl-list-container']->setAttribute('class', 'sl-list-container'); |
| [765](#L765) | $html\_div['sl-list-container']->appendChild($html\_div['sl-list-header']); |
| [766](#L766) | $html\_div['sl-list-container']->appendChild($html\_ol['sl-list-body']); |
| [767](#L767) |  |
| [768](#L768) | $html\_div['sl-body'] = $domRetorno->createElement('div'); |
| [769](#L769) | $html\_div['sl-body']->setAttribute('class', 'sl-body'); |
| [770](#L770) | $html\_div['sl-body']->appendChild($html\_div['sl-list-container']); |
| [771](#L771) | //--------------------------------------------------------- |
| [772](#L772) |  |
| [773](#L773) | $html\_div['sl-page-body'] = $domRetorno->createElement('div');//content $txtNavegacion |
| [774](#L774) | $html\_div['sl-page-body']->setAttribute('class', 'sl-page-body'); |
| [775](#L775) | $html\_div['sl-page-body']->appendChild($html\_div['Hyno\_Breadcrumbs']); |
| [776](#L776) | $html\_div['sl-page-body']->appendChild($html\_div['Hyno\_Header']); |
| [777](#L777) | $html\_div['sl-page-body']->appendChild($html\_div['sl-body']); |
| [778](#L778) |  |
| [779](#L779) | $html\_div['sl-body']->setAttribute('class', 'sl-body'); |
| [780](#L780) |  |
| [781](#L781) |  |
| [782](#L782) | $html\_div['Hyno\_ContenFolder'] = $domRetorno->createElement('div'); |
| [783](#L783) | $html\_div['Hyno\_ContenFolder']->setAttribute('class', 'Hyno\_ContenFolder'); |
| [784](#L784) | $html\_div['Hyno\_ContenFolder']->appendChild($html\_div['sl-page-body']); |
| [785](#L785) |  |
| [786](#L786) |  |
| [787](#L787) | $retorno = json\_encode(['html' => $domRetorno->saveHTML($html\_div['Hyno\_ContenFolder']), 'imgs' => $arrayIMG]); |
| [788](#L788) | } |
| [789](#L789) | else { |
| [790](#L790) |  |
| [791](#L791) | $html\_div['Hyno\_Breadcrumbs'] = $domRetorno->createElement('div');//content $txtNavegacion |
| [792](#L792) | $html\_div['Hyno\_Breadcrumbs']->setAttribute('class', 'row'); |
| [793](#L793) | $html\_div['Hyno\_Breadcrumbs']->setAttribute('id', "Hyno\_Breadcrumbs\_{$id\_content}"); |
| [794](#L794) | $html\_div['Hyno\_Breadcrumbs']->appendChild($domRetorno->importNode($html\_ol['breadcrumb'])); |
| [795](#L795) |  |
| [796](#L796) | $html\_div['Hyno\_Header'] = $domRetorno->createElement('div');//contenido $txtCarpeta |
| [797](#L797) | $html\_div['Hyno\_Header']->setAttribute('class', 'sl-header clearfix'); |
| [798](#L798) | $html\_div['Hyno\_Header']->setAttribute('id', "Hyno\_Header\_{$id\_content}"); |
| [799](#L799) |  |
| [800](#L800) | $html\_img['sl-empty'] = $domRetorno->createElement('img'); |
| [801](#L801) | $html\_img['sl-empty']->setAttribute('class', 'sl-empty-folder-icon'); |
| [802](#L802) | $html\_img['sl-empty']->setAttribute('src', DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . 'src/img/carpeta.png'); |
| [803](#L803) |  |
| [804](#L804) | $html\_h4['sl-empty'] = $domRetorno->createElement('h4', \_\_("Esta carpeta está vacía", "dropbox-folder-share")); |
| [805](#L805) | $html\_h4['sl-empty']->setAttribute('class', 'sl-empty-folder-message'); |
| [806](#L806) |  |
| [807](#L807) | $html\_div['sl-body'] = $domRetorno->createElement('div'); |
| [808](#L808) | $html\_div['sl-body']->setAttribute('class', 'sl-body sl-body--empty-folder'); |
| [809](#L809) | $html\_div['sl-body']->appendChild($html\_img['sl-empty']); |
| [810](#L810) | $html\_div['sl-body']->appendChild($html\_h4['sl-empty']); |
| [811](#L811) |  |
| [812](#L812) | $html\_div['sl-page-body'] = $domRetorno->createElement('div');//content $txtNavegacion |
| [813](#L813) | $html\_div['sl-page-body']->setAttribute('class', 'sl-page-body sl-list-container'); |
| [814](#L814) | $html\_div['sl-page-body']->appendChild($html\_div['Hyno\_Breadcrumbs']); |
| [815](#L815) | $html\_div['sl-page-body']->appendChild($html\_div['Hyno\_Header']); |
| [816](#L816) | $html\_div['sl-page-body']->appendChild($html\_div['sl-body']); |
| [817](#L817) |  |
| [818](#L818) | $html\_div['Hyno\_ContenFolder'] = $domRetorno->createElement('div'); |
| [819](#L819) | $html\_div['Hyno\_ContenFolder']->setAttribute('class', 'Hyno\_ContenFolder'); |
| [820](#L820) | $html\_div['Hyno\_ContenFolder']->appendChild($html\_div['sl-page-body']); |
| [821](#L821) |  |
| [822](#L822) | $retorno = json\_encode(['html' => $domRetorno->saveHTML($html\_div['Hyno\_ContenFolder']), 'imgs' => []]); |
| [823](#L823) |  |
| [824](#L824) |  |
| [825](#L825) | } |
| [826](#L826) |  |
| [827](#L827) |  |
| [828](#L828) | return $retorno; |
| [829](#L829) | } |
| [830](#L830) |  |
| [831](#L831) | function downloadLinkGenerator($link, $query\_params = array()) { |
| [832](#L832) | if (count($query\_params) === 0) |
| [833](#L833) | $query\_params['dl'] = 1; |
| [834](#L834) | $detalleURL['query'] = http\_build\_query($query\_params); |
| [835](#L835) |  |
| [836](#L836) | $newUrl = http\_build\_url($link, |
| [837](#L837) | $detalleURL, |
| [838](#L838) | HTTP\_URL\_STRIP\_AUTH | HTTP\_URL\_JOIN\_QUERY | HTTP\_URL\_STRIP\_FRAGMENT |
| [839](#L839) | ); |
| [840](#L840) | return $newUrl; |
| [841](#L841) | } |
| [842](#L842) |  |
| [843](#L843) | function add\_settings\_link($links, $file) { |
| [844](#L844) | if (DROPBOX\_FOLDER\_SHARE\_PLUGIN\_BASENAME === $file && current\_user\_can(self::\_PERMISOS\_REQUERIDOS\_)) { |
| [845](#L845) | $links[] = '<a href="' . esc\_url($this->plugin\_options\_url()) . '" alt="' . esc\_attr\_\_('Dropbox Folder Share - Configuracion', "dropbox-folder-share") . '">' . esc\_html\_\_('Configurar', "dropbox-folder-share") . '</a>'; |
| [846](#L846) | } |
| [847](#L847) | return $links; |
| [848](#L848) | } |
| [849](#L849) |  |
| [850](#L850) | function plugin\_options\_url() { |
| [851](#L851) | return add\_query\_arg('page', DROPBOX\_FOLDER\_SHARE\_PLUGIN\_NOMBRE, admin\_url(self::\_PARENT\_PAGE\_)); |
| [852](#L852) | } |
| [853](#L853) |  |
| [854](#L854) | function EliminarTAG(DOMDocument $dom, $query\_xpath) { |
| [855](#L855) | $xpath = new DOMXPath($dom); |
| [856](#L856) | foreach ($xpath->query($query\_xpath) as $link) { |
| [857](#L857) | // Move all link tag content to its parent node just before it. |
| [858](#L858) | while ($link->hasChildNodes()) { |
| [859](#L859) | $child = $link->removeChild($link->firstChild); |
| [860](#L860) | $link->parentNode->insertBefore($child, $link); |
| [861](#L861) | } |
| [862](#L862) | // Remove the link tag. |
| [863](#L863) | $link->parentNode->removeChild($link); |
| [864](#L864) | } |
| [865](#L865) | } |
| [866](#L866) |  |
| [867](#L867) | function dropbox\_foldershare\_styles\_and\_scripts($posts) { |
| [868](#L868) | if (empty($posts)) { |
| [869](#L869) | return $posts; |
| [870](#L870) | } |
| [871](#L871) | $shortcode\_found = false; // usamos shortcode\_found para saber si nuestro plugin esta siendo utilizado |
| [872](#L872) | foreach ($posts as $post) { |
| [873](#L873) |  |
| [874](#L874) | if (stripos($post->post\_content, 'dropbox-foldershare-hyno')) { //shortcode a buscar |
| [875](#L875) | $shortcode\_found = true; // bingo! |
| [876](#L876) | break; |
| [877](#L877) | } |
| [878](#L878) | if (stripos($post->post\_content, 'DFS')) { //shortcode a buscar |
| [879](#L879) | $shortcode\_found = true; // bingo! |
| [880](#L880) | break; |
| [881](#L881) | } |
| [882](#L882) |  |
| [883](#L883) | if (stripos($post->post\_content, 'hyno\_learn\_more')) { //cambiamos testiy por cualquier shortcode |
| [884](#L884) | $shortcode\_found = true; // bingo! |
| [885](#L885) | break; |
| [886](#L886) | } |
| [887](#L887) | } |
| [888](#L888) | if ($shortcode\_found) { |
| [889](#L889) |  |
| [890](#L890) | self::incluir\_JS\_CSS(); |
| [891](#L891) |  |
| [892](#L892) | //wp\_enqueue\_script('bible-post-script', plugins\_url('scripts-hyno.js', \_\_FILE\_\_)); //en caso de necesitar la ruta de nuestro script js |
| [893](#L893) | } |
| [894](#L894) |  |
| [895](#L895) | return $posts; |
| [896](#L896) | } |
| [897](#L897) |  |
| [898](#L898) | function incluir\_JS\_CSS() { |
| [899](#L899) | // enqueue |
| [900](#L900) | wp\_enqueue\_script('jquery'); |
| [901](#L901) | //wp\_enqueue\_script( 'thickbox' ); |
| [902](#L902) | wp\_enqueue\_script('jquery-ui-tooltip'); |
| [903](#L903) |  |
| [904](#L904) | wp\_enqueue\_script('bootstrap-js', '//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js', array('jquery'), true); // all the bootstrap javascript goodness |
| [905](#L905) | wp\_enqueue\_script('ekko-lightbox', 'https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.js', array('jquery'), true); // all the bootstrap javascript goodness |
| [906](#L906) | wp\_enqueue\_script('DFS-Script', DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . 'src/js/scripts-hyno.js', array('jquery')); |
| [907](#L907) |  |
| [908](#L908) | $url\_imgLoader = DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . "/src/img/gears.svg"; |
| [909](#L909) |  |
| [910](#L910) | wp\_localize\_script('DFS-Script', 'objDFS', |
| [911](#L911) | array( |
| [912](#L912) | 'ajax\_url' => admin\_url('admin-ajax.php'), |
| [913](#L913) | 'dfs\_nonce' => wp\_create\_nonce('dfs\_nonce'), |
| [914](#L914) | 'url\_imgLoader' => $url\_imgLoader |
| [915](#L915) | ) |
| [916](#L916) | ); |
| [917](#L917) |  |
| [918](#L918) | //wp\_enqueue\_style( 'thickbox' ); |
| [919](#L919) | wp\_enqueue\_style('bootstrap', '//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css'); |
| [920](#L920) | wp\_enqueue\_style('ekko-lightbox', 'https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css'); |
| [921](#L921) | wp\_enqueue\_style('font-awesome', 'https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'); |
| [922](#L922) | wp\_enqueue\_style('DFS-Style', DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . 'src/css/styles-hyno.css'); //la ruta de nuestro css |
| [923](#L923) | } |
| [924](#L924) |  |
| [925](#L925) | function limpiahtml($codigo) { |
| [926](#L926) | $buscar = array('/\>[^\S ]+/s', '/[^\S ]+\</s', '/(\s)+/s'); |
| [927](#L927) | $reemplazar = array('>', '<', '\\1'); |
| [928](#L928) | $codigo = preg\_replace($buscar, $reemplazar, $codigo); |
| [929](#L929) | $codigo = str\_replace("> <", "><", $codigo); |
| [930](#L930) |  |
| [931](#L931) | return $codigo; |
| [932](#L932) | } |
| [933](#L933) |  |
| [934](#L934) |  |
| [935](#L935) | function nota\_actualizacion() { |
| [936](#L936) | //if(!current\_user\_can( 'manage\_options')) return; |
| [937](#L937) | //$class = 'notice updated is-dismissible'; |
| [938](#L938) | $message = '<strong>' . esc\_html\_\_('Dropbox Folder Share ha mejorado!', 'dropbox-folder-share') . '</strong><br/>'; |
| [939](#L939) | $message .= '<em>' . esc\_html\_\_('Seccion en editor.', 'dropbox-folder-share') . ' — ' . esc\_html\_\_('Añadido la posibilidad de Widget', 'dropbox-folder-share') . '</em><br/>'; |
| [940](#L940) | $message .= sprintf(\_\_('Por favor <a href="%s">revisa las configuraciones</a> para asegurarte de que todo esta bien.', 'dropbox-folder-share'), admin\_url('options-general.php?page=dropbox-folder-share')) . '<br/>'; |
| [941](#L941) | $message .= '<em>' . esc\_html\_\_('Gracias por Utilizar este plugin. Me gustaria leer sugerencias u opiniones para que juntos mejoremos esta herramienta, cualquier sugerencia para mejorar el plugin o reportar algun error nos ayuda muchisimo, no duden en hacernoslo saber. ', "dropbox-folder-share") . '</em>'; |
| [942](#L942) | $message .= '<em>' . esc\_html\_\_('Pueden hacernos llegar sus sugerencias, opiniones y/o criticas a travez del formulario de contactos de', "dropbox-folder-share") . '<a href="http://www.hynotech.com"> HynoTech.com</a></em>'; |
| [943](#L943) | $message .= '<br>'; |
| [944](#L944) | $message .= '<em>' . esc\_html\_\_('Considera hacer una donacion para ayudarnos con el proyecto. Lo tendremos en gran valor.', "dropbox-folder-share") . '</em>'; |
| [945](#L945) | $message .= DROPBOX\_FOLDER\_SHARE\_HTML\_DONACIONES; |
| [946](#L946) |  |
| [947](#L947) | return $message; |
| [948](#L948) | //echo '<div data-tipo="actualizacion" class="'.$class.'"><p>'.$message.'</p></div>'; |
| [949](#L949) | } |
| [950](#L950) |  |
| [951](#L951) | //https://premium.wpmudev.org/blog/adding-admin-notices/?utm\_expid=3606929-101.\_J2UGKNuQ6e7Of8gblmOTA.0&utm\_referrer=https%3A%2F%2Fwww.google.com.pe%2F |
| [952](#L952) | function nota\_donacion() { |
| [953](#L953) |  |
| [954](#L954) | $message = "<div class='wrap'> |
| [955](#L955) | <div class='wpmm-wrapper'> |
| [956](#L956) | <div class='wrapper-cell'> |
| [957](#L957) | <div id='SugerenciasComments' class='stuffbox' style='border: 0px;'> |
| [958](#L958) | <div class='inside'> |
| [959](#L959) | <h3>" . \_\_('Dropbox Folder Share NECESITA TU AYUDA!', 'dropbox-folder-share') . "</h3> |
| [960](#L960) | <p class='popular-tags'>" . \_\_('¡Hola! Gracias por utilizar nuestro plugin gratuito en tu sitio web de WordPress. Nos esforzamos por proporcionar herramientas útiles para la comunidad de WordPress y estamos felices de que hayas encontrado nuestro plugin útil. Sin embargo, mantener y mejorar nuestro plugin requiere tiempo y recursos significativos. Si te gusta nuestro trabajo y estás interesado en apoyarnos, considera hacer una donación. Cualquier contribución sería muy apreciada y nos ayudaría a seguir mejorando el plugin y a brindarte un mejor servicio. Si decides hacer una donación, ¡te agradecemos mucho! Si tienes alguna pregunta o comentario, no dudes en ponerte en contacto con nosotros. ¡Gracias de nuevo por tu apoyo!', 'dropbox-folder-share') . " </p> |
| [961](#L961) | <!--<p class='popular-tags'>" . \_\_('Cualquier donacion que puedan hacer sera muy bien recibido y estare muy agradecido por ello.', 'dropbox-folder-share') . " </p>--> |
| [962](#L962) | <!--p class='popular-tags'>" . \_\_('No quiero dejar pasar esta oportunidad de dar gracias a los 2 amigos de FRANCIA que tuvieron a bien donar el año 2014. MUCHAS GRACIAS', 'dropbox-folder-share') . " </p--> |
| [963](#L963) | <img align='right' src='" . DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . 'src/img/AntonySalas\_signature.png' . "'> |
| [964](#L964) | <br> |
| [965](#L965) | <br> |
| [966](#L966) | <br> |
| [967](#L967) | </div> |
| [968](#L968) | </div> |
| [969](#L969) | </div> |
| [970](#L970) | <div id='sidebar' class='wrapper-cell'> |
| [971](#L971) |  |
| [972](#L972) | <div class='sidebar\_box info\_box'> |
| [973](#L973) | <h3>" . \_\_('Donaciones', 'dropbox-folder-share') . "</h3> |
| [974](#L974) | <div class='inside'> |
| [975](#L975) | <div class='misc-pub-section center'> |
| [976](#L976) | ". DROPBOX\_FOLDER\_SHARE\_HTML\_DONACIONES ." |
| [977](#L977) | </div> |
| [978](#L978) | </div> |
| [979](#L979) | </div> |
| [980](#L980) |  |
| [981](#L981) | <div class='sidebar\_box info\_box'> |
| [982](#L982) | <div class='inside'> |
| [983](#L983) | <div class='misc-pub-section center'> |
| [984](#L984) |  |
| [985](#L985) | <img width='150px' src='" . DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . 'src/img/DropBox-Folder-Share-300x300.png' . "'> |
| [986](#L986) |  |
| [987](#L987) | </div> |
| [988](#L988) | </div> |
| [989](#L989) | </div> |
| [990](#L990) | </div> |
| [991](#L991) | </div> |
| [992](#L992) | </div>"; |
| [993](#L993) |  |
| [994](#L994) |  |
| [995](#L995) | return $message; |
| [996](#L996) |  |
| [997](#L997) | } |
| [998](#L998) |  |
| [999](#L999) | function nota\_assets() { |
| [1000](#L1000) | //ddd("HOLAAAAA"); |
| [1001](#L1001) | //wp\_enqueue\_script( 'my-notice-update', plugins\_url( '/js/notice-update.js', \_\_FILE\_\_ ), array( 'jquery' ), '1.0', true  ); |
| [1002](#L1002) | wp\_enqueue\_script('DFS-Script-Admin', DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . 'src/js/scripts-hyno.js', array('jquery')); |
| [1003](#L1003) | wp\_enqueue\_script('font-awesome', 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js'); |
| [1004](#L1004) | wp\_enqueue\_style('DFS-Style-Admin', DROPBOX\_FOLDER\_SHARE\_PLUGIN\_URL . 'src/css/styles-hyno-admin.css'); //la ruta de nuestro |
| [1005](#L1005) | //wp\_enqueue\_style('font-awesome', 'https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'); |
| [1006](#L1006) | } |
| [1007](#L1007) |  |
| [1008](#L1008) |  |
| [1009](#L1009) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/dropbox-folder-share/trunk/HynoTech/DropboxFolderShare/Principal.php?format=txt)
* [Original Format](/export/3220766/dropbox-folder-share/trunk/HynoTech/DropboxFolderShare/Principal.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_f1a916c4_20250111_152653.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Dropbox Folder Share <= 1.9.7 - Unauthenticated Server-Side Request Forgery via 'link'

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Dropbox Folder Share <= 1.9.7 - Unauthenticated Server-Side Request Forgery via 'link'

7.2

**Server-Side Request Forgery (SSRF)**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2023-3025](https://www.cve.org/CVERecord?id=CVE-2023-3025) |
| --- | --- |
| CVSS | 7.2 (High) |
| Publicly Published | September 15, 2023 |
| Last Updated | January 22, 2024 |
| Researcher | [Alex Thomas - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/alex-thomas) |

### Description

The Dropbox Folder Share plugin for WordPress is vulnerable to Server-Side Request Forgery in versions up to, and including, 1.9.7 via the 'link' parameter. This can allow unauthenticated attackers to make web requests to arbitrary locations originating from the web application and can be used to query and modify information from internal services.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/dropbox-folder-share/trunk/HynoTech/DropboxFolderShare/Principal.php#L118)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fdropbox-folder-share%2Fdropbox-folder-share-197-unauthenticated-server-side-request-forgery-via-link&t=Dropbox%20Folder%20Share%20%3C%3D%201.9.7%20-%20Unauthenticated%20Server-Side%20Request%20Forgery%20via%20%27link%27 "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fdropbox-folder-share%2Fdropbox-folder-share-197-unauthenticated-server-side-request-forgery-via-link&text=Dropbox%20Folder%20Share%20%3C%3D%201.9.7%20-%20Unauthenticated%20Server-Side%20Request%20Forgery%20via%20%27link%27 "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fdropbox-folder-share%2Fdropbox-folder-share-197-unauthenticated-server-side-request-forgery-via-link "LinkedIn")
Email

## Vulnerability Details for Dropbox Folder Share

#### [Dropbox Folder Share](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/dropbox-folder-share)

| Software Type | Plugin |
| --- | --- |
| Software Slug | dropbox-folder-share [(view on wordpress.org)](https://wordpress.org/plugins/dropbox-folder-share) |
| Patched? | No |
| Remediation | No known patch available. Please review the vulnerability's details in depth and employ mitigations based on your organization's risk tolerance. It may be best to uninstall the affected software and find a replacement. |
| Affected Version | * <= 1.9.7 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


