



<!DOCTYPE html>
<html class="gl-light ui-gray with-top-bar with-header " lang="en">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>gnome-remote-desktop: multiple security issues and recommendations (#196) · Issues · GNOME / gnome-remote-desktop · GitLab</title>
<script>
//<![CDATA[
window.gon={};gon.api_version="v4";gon.default_avatar_url="https://gitlab.gnome.org/assets/no_avatar-849f9c04a3a0d0cea2424ae97b27447dc64a7dbfae83c036c45b403392f0e8ba.png";gon.max_file_size=500;gon.asset_host=null;gon.webpack_public_path="/assets/webpack/";gon.relative_url_root="";gon.user_color_mode="gl-light";gon.user_color_scheme="white";gon.markdown_surround_selection=null;gon.markdown_automatic_lists=null;gon.math_rendering_limits_enabled=true;gon.recaptcha_api_server_url="https://www.recaptcha.net/recaptcha/api.js";gon.recaptcha_sitekey="6Lfhei8UAAAAAKwEVuEwxJX09r0AGdMm-DUTWNAQ";gon.gitlab_url="https://gitlab.gnome.org";gon.promo_url="https://about.gitlab.com";gon.forum_url="https://forum.gitlab.com";gon.docs_url="https://docs.gitlab.com";gon.revision="065e0c2f057";gon.feature_category="team_planning";gon.gitlab_logo="/assets/gitlab_logo-2957169c8ef64c58616a1ac3f4fc626e8a35ce4eb3ed31bb0d873712f2a041a0.png";gon.secure=true;gon.sprite_icons="/assets/icons-8791a66659d025e0a4c801978c79a1fbd82db1d27d85f044a35728ea7cf0ae80.svg";gon.sprite_file_icons="/assets/file_icons/file_icons-7cd3d6c3b29a6d972895f36472978a4b5adb4b37f9b5d0716a380e82389f7e0e.svg";gon.emoji_sprites_css_path="/assets/emoji_sprites-d746ae2450a3e9c626d338d77a101b84ff33a47c0c281b676d75c4a6ed2948a4.css";gon.emoji_backend_version=4;gon.gridstack_css_path="/assets/lazy_bundles/gridstack-5fcfd4ffbea1db04eaf7f16521bcab19ae3af042c8b4afe8d16781eda5a70799.css";gon.test_env=false;gon.disable_animations=null;gon.suggested_label_colors={"#cc338b":"Magenta-pink","#dc143c":"Crimson","#c21e56":"Rose red","#cd5b45":"Dark coral","#ed9121":"Carrot orange","#eee600":"Titanium yellow","#009966":"Green-cyan","#8fbc8f":"Dark sea green","#6699cc":"Blue-gray","#e6e6fa":"Lavender","#9400d3":"Dark violet","#330066":"Deep violet","#36454f":"Charcoal grey","#808080":"Gray"};gon.first_day_of_week=1;gon.time_display_relative=true;gon.time_display_format=0;gon.ee=false;gon.jh=false;gon.dot_com=false;gon.uf_error_prefix="UF";gon.pat_prefix="ggopat";gon.keyboard_shortcuts_enabled=true;gon.diagramsnet_url="https://embed.diagrams.net";gon.features={"sourceEditorToolbar":false,"vscodeWebIde":true,"uiForOrganizations":false,"organizationSwitching":false,"findAndReplace":false,"removeMonitorMetrics":true,"workItemsViewPreference":false,"searchButtonTopRight":false,"asyncSidebarCounts":false,"preserveMarkdown":false,"issuesGridView":false,"serviceDeskTicket":false,"issuesListDrawer":false,"notificationsTodosButtons":false,"glqlIntegration":false,"workItems":true,"workItemsBeta":false,"workItemsAlpha":false,"epicWidgetEditConfirmation":false,"namespaceLevelWorkItems":false};
//]]>
</script>


<script>
//<![CDATA[
var gl = window.gl || {};
gl.startup_calls = {"/GNOME/gnome-remote-desktop/-/issues/196/related_branches":{},"/GNOME/gnome-remote-desktop/-/issues/196/discussions.json?per_page=20":{},"/GNOME/gnome-remote-desktop/-/issues/196.json?serializer=sidebar_extras":{}};
gl.startup_graphql_calls = [{"query":"query getDesignList($fullPath: ID!, $iid: String!, $atVersion: DesignManagementVersionID) {\n  project(fullPath: $fullPath) {\n    __typename\n    id\n    issue(iid: $iid) {\n      __typename\n      id\n      designCollection {\n        __typename\n        copyState\n        designs(atVersion: $atVersion) {\n          __typename\n          nodes {\n            __typename\n            id\n            event\n            filename\n            notesCount\n            image\n            imageV432x230\n            currentUserTodos(state: pending) {\n              __typename\n              nodes {\n                __typename\n                id\n              }\n            }\n          }\n        }\n        versions {\n          __typename\n          nodes {\n            __typename\n            id\n            sha\n            createdAt\n            author {\n              __typename\n              id\n              name\n              avatarUrl\n            }\n          }\n        }\n      }\n    }\n  }\n}\n","variables":{"fullPath":"GNOME/gnome-remote-desktop","iid":"196","atVersion":null}},{"query":"query permissions($fullPath: ID!, $iid: String!) {\n  project(fullPath: $fullPath) {\n    __typename\n    id\n    issue(iid: $iid) {\n      __typename\n      id\n      userPermissions {\n        __typename\n        createDesign\n      }\n    }\n  }\n}\n","variables":{"fullPath":"GNOME/gnome-remote-desktop","iid":"196"}}];

if (gl.startup_calls && window.fetch) {
  Object.keys(gl.startup_calls).forEach(apiCall => {
   gl.startup_calls[apiCall] = {
      fetchCall: fetch(apiCall, {
        // Emulate XHR for Rails AJAX request checks
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        },
        // fetch won’t send cookies in older browsers, unless you set the credentials init option.
        // We set to `same-origin` which is default value in modern browsers.
        // See https://github.com/whatwg/fetch/pull/585 for more information.
        credentials: 'same-origin'
      })
    };
  });
}
if (gl.startup_graphql_calls && window.fetch) {
  const headers = {"X-CSRF-Token":"4c6v4JABFGP-punzerJDBRbyz0CRQog8GCUDOOwZnQSgiQrw2t1L6eHuDFatH5Ui0q3U1aOP4GlD73nvtEvgGA","x-gitlab-feature-category":"team_planning"};
  const url = `https://gitlab.gnome.org/api/graphql`

  const opts = {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      ...headers,
    }
  };

  gl.startup_graphql_calls = gl.startup_graphql_calls.map(call => ({
    ...call,
    fetchCall: fetch(url, {
      ...opts,
      credentials: 'same-origin',
      body: JSON.stringify(call)
    })
  }))
}


//]]>
</script>



<link rel="stylesheet" href="/assets/application-2e69a08e74e113997b5ba7fc5cd3e020a6f407d9ad552675adc6d78c2b23d0f7.css" />
<link rel="stylesheet" href="/assets/page_bundles/design_management-55b7f0d1f8549b24ba19c0b5aaf18a17a8d3828677fad074d37dd2e69d08da2b.css" /><link rel="stylesheet" href="/assets/page_bundles/incidents-6598dbf61fe32a8ddb1b06150f2301451ad41554975581e771efc5f890d0443f.css" /><link rel="stylesheet" href="/assets/page_bundles/issuable-01914381150850b46ac12e613a08df1d9b815aa305882ef8482ccd64eda0773f.css" /><link rel="stylesheet" href="/assets/page_bundles/notes_shared-caf98f77b75b4b5399bdde69c069ee023fefdaa986d687c937e8010218785f51.css" /><link rel="stylesheet" href="/assets/page_bundles/issues_show-785541c300108b8ecf7c08fd02bd67f4d6b9d59c86918ecfbf91bae5e1c8ffa8.css" /><link rel="stylesheet" href="/assets/page_bundles/work_items-cbc6a2e1633c4e847a617e35cc4833b85b80816db688d3d6dd3cd31d4251bc53.css" /><link rel="stylesheet" href="/assets/page_bundles/labels-3508460b8d6f839e9d60de1f2065fdaf7f057efab04cf71966acef6a86fe9b41.css" /><link rel="stylesheet" href="/assets/page_bundles/commit_description-1e2cba4dda3c7b30dd84924809020c569f1308dea51520fe1dd5d4ce31403195.css" />
<link rel="stylesheet" href="/assets/application_utilities-0bfb919a8a7eb0e89544dfe328e69461ccb276a565685fdb6ae3b14f3db3f41b.css" />
<link rel="stylesheet" href="/assets/tailwind-016e83140c37d97dbdff0cef9c063fcd43d214866665fb783774776747928853.css" />


<link rel="stylesheet" href="/assets/fonts-fae5d3f79948bd85f18b6513a025f863b19636e85b09a1492907eb4b1bb0557b.css" />
<link rel="stylesheet" href="/assets/highlight/themes/white-5ffbb706faebead681b01c8b52e92c6c0d35ad5b1c11d39012c90bcaf7892ca8.css" />


<link rel="preload" href="/assets/application_utilities-0bfb919a8a7eb0e89544dfe328e69461ccb276a565685fdb6ae3b14f3db3f41b.css" as="style" type="text/css">
<link rel="preload" href="/assets/application-2e69a08e74e113997b5ba7fc5cd3e020a6f407d9ad552675adc6d78c2b23d0f7.css" as="style" type="text/css">
<link rel="preload" href="/assets/highlight/themes/white-5ffbb706faebead681b01c8b52e92c6c0d35ad5b1c11d39012c90bcaf7892ca8.css" as="style" type="text/css">




<script src="/assets/webpack/runtime.68fcb180.bundle.js" defer="defer"></script>
<script src="/assets/webpack/main.a4c9ae4f.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.admin.topics.edit-pages.admin.topics.new-pages.dashboar-c8f1318b.54872cef.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.dashboard.issues-pages.dashboard.milestones.show-pages.-13e11bbf.1a73330b.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.dashboard.issues-pages.groups.boards-pages.groups.issue-8dfa5f96.20262e8b.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.dashboard.issues-pages.groups.boards-pages.groups.issue-f804d6c2.d4f467df.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.groups.new-pages.import.gitlab_projects.new-pages.import.manifest.new-pages.projects.n-44c6c18e.800b02b5.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.search.show-super_sidebar.98a5daf8.chunk.js" defer="defer"></script>
<script src="/assets/webpack/super_sidebar.839aed14.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.projects-pages.projects.activity-pages.projects.alert_management.details-pages.project-2cf3f004.cf930f47.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.admin.topics.edit-pages.admin.topics.new-pages.groups.m-b59cd8e6.af19401d.chunk.js" defer="defer"></script>
<script src="/assets/webpack/5.7a5f7362.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.admin.topics.edit-pages.admin.topics.new-pages.groups.m-bfc75f5d.bc5ed18e.chunk.js" defer="defer"></script>
<script src="/assets/webpack/9.bc4d8be7.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.admin.topics.edit-pages.admin.topics.new-pages.groups.m-74b1dcb9.25b64210.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports-pages.admin.abuse_reports.show-pages.admin.groups.index-pages.admi-e271b53c.4fcbe683.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.topics.edit-pages.admin.topics.new-pages.groups.milestones.edit-pages.groups.mil-2f72a3d7.5269b7ea.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.dashboard.milestones.show-pages.groups.merge_requests-p-6152ef8e.1d43fc45.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.dashboard.milestones.show-pages.groups.merge_requests-pages.groups.milestones.edit-pag-8e438287.4a86321e.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.dashboard.issues-pages.groups.issues-pages.groups.merge_requests-pages.groups.work_ite-dc744cb1.d70eece9.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.groups.issues-pages.groups.merge_requests-pages.groups.work_items-pages.groups.work_it-ed595783.87e56f63.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.groups.milestones.edit-pages.groups.milestones.new-pages.groups.milestones.show-pages.-7486cfee.c1a8fe55.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.groups.merge_requests-pages.groups.work_items-pages.groups.work_items.show-pages.proje-a6a6c699.b1ed2339.chunk.js" defer="defer"></script>
<script src="/assets/webpack/pages.projects.issues.show.af28b7e0.chunk.js" defer="defer"></script>

<meta content="object" property="og:type">
<meta content="GitLab" property="og:site_name">
<meta content="gnome-remote-desktop: multiple security issues and recommendations (#196) · Issues · GNOME / gnome-remote-desktop · GitLab" property="og:title">
<meta content="Hello GNOME security, this issue is about the gnome-remote-desktop project 1. I am a member of the SUSE security team and I have conducted..." property="og:description">
<meta content="https://gitlab.gnome.org/assets/twitter_card-570ddb06edf56a2312253c5872489847a0f385112ddbcd71ccfa1570febab5d2.jpg" property="og:image">
<meta content="64" property="og:image:width">
<meta content="64" property="og:image:height">
<meta content="https://gitlab.gnome.org/GNOME/gnome-remote-desktop/-/issues/196" property="og:url">
<meta content="summary" property="twitter:card">
<meta content="gnome-remote-desktop: multiple security issues and recommendations (#196) · Issues · GNOME / gnome-remote-desktop · GitLab" property="twitter:title">
<meta content="Hello GNOME security, this issue is about the gnome-remote-desktop project 1. I am a member of the SUSE security team and I have conducted..." property="twitter:description">
<meta content="https://gitlab.gnome.org/assets/twitter_card-570ddb06edf56a2312253c5872489847a0f385112ddbcd71ccfa1570febab5d2.jpg" property="twitter:image">
<meta property="twitter:label1" content="Author"><meta property="twitter:data1" content="Matthias Gerstner">
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="N__vqBjgaamuXu22BQMhtPrxmDeFUxOe511cWaVzFVV2uEq4Ujw2I7EWCBPSrveTPq6Doreee8u8lyaO_SFoSQ" />
<meta name="csp-nonce" />
<meta name="action-cable-url" content="/-/cable" />
<link href="/-/manifest.json" rel="manifest">
<link rel="icon" type="image/png" href="/uploads/-/system/appearance/favicon/1/GnomeLogoVertical.svg.png" id="favicon" data-original-href="/uploads/-/system/appearance/favicon/1/GnomeLogoVertical.svg.png" />
<link rel="apple-touch-icon" type="image/x-icon" href="/assets/apple-touch-icon-b049d4bc0dd9626f31db825d61880737befc7835982586d015bded10b4435460.png" />
<link href="/search/opensearch.xml" rel="search" title="Search GitLab" type="application/opensearchdescription+xml">




<meta content="Hello GNOME security, this issue is about the gnome-remote-desktop project 1. I am a member of the SUSE security team and I have conducted..." name="description">
<meta content="#28272d" name="theme-color">
</head>

<body class="tab-width-8 gl-browser-chrome gl-platform-windows" data-find-file="/GNOME/gnome-remote-desktop/-/find_file/master" data-group="GNOME" data-group-full-path="GNOME" data-namespace-id="8" data-page="projects:issues:show" data-page-type-id="196" data-project="gnome-remote-desktop" data-project-full-path="GNOME/gnome-remote-desktop" data-project-id="36">
<script>
//<![CDATA[
gl = window.gl || {};
gl.GfmAutoComplete = gl.GfmAutoComplete || {};
gl.GfmAutoComplete.dataSources = {"members":"/GNOME/gnome-remote-desktop/-/autocomplete_sources/members?type=Issue\u0026type_id=196","issues":"/GNOME/gnome-remote-desktop/-/autocomplete_sources/issues","mergeRequests":"/GNOME/gnome-remote-desktop/-/autocomplete_sources/merge_requests","labels":"/GNOME/gnome-remote-desktop/-/autocomplete_sources/labels?type=Issue\u0026type_id=196","milestones":"/GNOME/gnome-remote-desktop/-/autocomplete_sources/milestones","commands":"/GNOME/gnome-remote-desktop/-/autocomplete_sources/commands?type=Issue\u0026type_id=196","snippets":"/GNOME/gnome-remote-desktop/-/autocomplete_sources/snippets","contacts":"/GNOME/gnome-remote-desktop/-/autocomplete_sources/contacts?type=Issue\u0026type_id=196","wikis":"/GNOME/gnome-remote-desktop/-/autocomplete_sources/wikis"};


//]]>
</script>
<script>
//<![CDATA[
gl = window.gl || {};
gl.client = {"isChrome":true,"isWindows":true};


//]]>
</script>


<header class="header-logged-out" data-testid="navbar">
<a class="gl-sr-only gl-accessibility" href="#content-body">Skip to content</a>
<div class="container-fluid">
<nav aria-label="Explore GitLab" class="header-logged-out-nav gl-flex gl-gap-3 gl-justify-between">
<div class="gl-flex gl-items-center gl-gap-1">
<span class="gl-sr-only">GitLab</span>
<a title="Homepage" id="logo" class="header-logged-out-logo has-tooltip" aria-label="Homepage" href="/"><img class="brand-header-logo lazy" alt="" data-src="/uploads/-/system/appearance/header_logo/1/GnomeLogoHorizontal.svg" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" />
</a></div>
<ul class="gl-list-none gl-p-0 gl-m-0 gl-flex gl-gap-3 gl-items-center gl-grow">
<li class="header-logged-out-nav-item">
<a class="" href="/explore">Explore</a>
</li>
</ul>
<ul class="gl-list-none gl-p-0 gl-m-0 gl-flex gl-gap-3 gl-items-center gl-justify-end">
<li class="header-logged-out-nav-item">
<a href="/users/sign_in?redirect_to_referer=yes">Sign in</a>
</li>
</ul>
</nav>
</div>
</header>

<div class="layout-page page-gutter right-sidebar-expanded page-with-super-sidebar">
<aside class="js-super-sidebar super-sidebar super-sidebar-loading" data-command-palette="{&quot;project_files_url&quot;:&quot;/GNOME/gnome-remote-desktop/-/files/master?format=json&quot;,&quot;project_blob_url&quot;:&quot;/GNOME/gnome-remote-desktop/-/blob/master&quot;}" data-force-desktop-expanded-sidebar="" data-is-saas="false" data-root-path="/" data-sidebar="{&quot;is_logged_in&quot;:false,&quot;context_switcher_links&quot;:[{&quot;title&quot;:&quot;Explore&quot;,&quot;link&quot;:&quot;/explore&quot;,&quot;icon&quot;:&quot;compass&quot;}],&quot;current_menu_items&quot;:[{&quot;id&quot;:&quot;project_overview&quot;,&quot;title&quot;:&quot;gnome-remote-desktop&quot;,&quot;entity_id&quot;:36,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop&quot;,&quot;link_classes&quot;:&quot;shortcuts-project&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;manage_menu&quot;,&quot;title&quot;:&quot;Manage&quot;,&quot;icon&quot;:&quot;users&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/activity&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;activity&quot;,&quot;title&quot;:&quot;Activity&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/activity&quot;,&quot;link_classes&quot;:&quot;shortcuts-project-activity&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;members&quot;,&quot;title&quot;:&quot;Members&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/project_members&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;labels&quot;,&quot;title&quot;:&quot;Labels&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/labels&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;plan_menu&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;icon&quot;:&quot;planning&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues&quot;,&quot;is_active&quot;:true,&quot;items&quot;:[{&quot;id&quot;:&quot;project_issue_list&quot;,&quot;title&quot;:&quot;Issues&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues&quot;,&quot;pill_count&quot;:&quot;28&quot;,&quot;link_classes&quot;:&quot;shortcuts-issues has-sub-items&quot;,&quot;is_active&quot;:true},{&quot;id&quot;:&quot;boards&quot;,&quot;title&quot;:&quot;Issue boards&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/boards&quot;,&quot;link_classes&quot;:&quot;shortcuts-issue-boards&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;milestones&quot;,&quot;title&quot;:&quot;Milestones&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/milestones&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;project_wiki&quot;,&quot;title&quot;:&quot;Wiki&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/wikis/home&quot;,&quot;link_classes&quot;:&quot;shortcuts-wiki&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;code_menu&quot;,&quot;title&quot;:&quot;Code&quot;,&quot;icon&quot;:&quot;code&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/merge_requests&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;project_merge_request_list&quot;,&quot;title&quot;:&quot;Merge requests&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/merge_requests&quot;,&quot;pill_count&quot;:&quot;5&quot;,&quot;link_classes&quot;:&quot;shortcuts-merge_requests&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;files&quot;,&quot;title&quot;:&quot;Repository&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/tree/master&quot;,&quot;link_classes&quot;:&quot;shortcuts-tree&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;branches&quot;,&quot;title&quot;:&quot;Branches&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/branches&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;commits&quot;,&quot;title&quot;:&quot;Commits&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/commits/master?ref_type=heads&quot;,&quot;link_classes&quot;:&quot;shortcuts-commits&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;tags&quot;,&quot;title&quot;:&quot;Tags&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/tags&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;graphs&quot;,&quot;title&quot;:&quot;Repository graph&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/network/master?ref_type=heads&quot;,&quot;link_classes&quot;:&quot;shortcuts-network&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;compare&quot;,&quot;title&quot;:&quot;Compare revisions&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/compare?from=master\u0026to=master&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;project_snippets&quot;,&quot;title&quot;:&quot;Snippets&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/snippets&quot;,&quot;link_classes&quot;:&quot;shortcuts-snippets&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;build_menu&quot;,&quot;title&quot;:&quot;Build&quot;,&quot;icon&quot;:&quot;rocket&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/pipelines&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;pipelines&quot;,&quot;title&quot;:&quot;Pipelines&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/pipelines&quot;,&quot;link_classes&quot;:&quot;shortcuts-pipelines&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;jobs&quot;,&quot;title&quot;:&quot;Jobs&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/jobs&quot;,&quot;link_classes&quot;:&quot;shortcuts-builds&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;pipeline_schedules&quot;,&quot;title&quot;:&quot;Pipeline schedules&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/pipeline_schedules&quot;,&quot;link_classes&quot;:&quot;shortcuts-builds&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;artifacts&quot;,&quot;title&quot;:&quot;Artifacts&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/artifacts&quot;,&quot;link_classes&quot;:&quot;shortcuts-builds&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;deploy_menu&quot;,&quot;title&quot;:&quot;Deploy&quot;,&quot;icon&quot;:&quot;deployments&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/releases&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;releases&quot;,&quot;title&quot;:&quot;Releases&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/releases&quot;,&quot;link_classes&quot;:&quot;shortcuts-deployments-releases&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;container_registry&quot;,&quot;title&quot;:&quot;Container Registry&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/container_registry&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;model_registry&quot;,&quot;title&quot;:&quot;Model registry&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/ml/models&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;operations_menu&quot;,&quot;title&quot;:&quot;Operate&quot;,&quot;icon&quot;:&quot;cloud-pod&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/environments&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;environments&quot;,&quot;title&quot;:&quot;Environments&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/environments&quot;,&quot;link_classes&quot;:&quot;shortcuts-environments&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;monitor_menu&quot;,&quot;title&quot;:&quot;Monitor&quot;,&quot;icon&quot;:&quot;monitor&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/incidents&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;incidents&quot;,&quot;title&quot;:&quot;Incidents&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/incidents&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;service_desk&quot;,&quot;title&quot;:&quot;Service Desk&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues/service_desk&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;analyze_menu&quot;,&quot;title&quot;:&quot;Analyze&quot;,&quot;icon&quot;:&quot;chart&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/value_stream_analytics&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;cycle_analytics&quot;,&quot;title&quot;:&quot;Value stream analytics&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/value_stream_analytics&quot;,&quot;link_classes&quot;:&quot;shortcuts-project-cycle-analytics&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;contributors&quot;,&quot;title&quot;:&quot;Contributor analytics&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/graphs/master?ref_type=heads&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;ci_cd_analytics&quot;,&quot;title&quot;:&quot;CI/CD analytics&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/pipelines/charts&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;repository_analytics&quot;,&quot;title&quot;:&quot;Repository analytics&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/graphs/master/charts&quot;,&quot;link_classes&quot;:&quot;shortcuts-repository-charts&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;model_experiments&quot;,&quot;title&quot;:&quot;Model experiments&quot;,&quot;link&quot;:&quot;/GNOME/gnome-remote-desktop/-/ml/experiments&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false}],&quot;current_context_header&quot;:&quot;Project&quot;,&quot;support_path&quot;:&quot;https://about.gitlab.com/get-help/&quot;,&quot;docs_path&quot;:&quot;/help/docs&quot;,&quot;display_whats_new&quot;:false,&quot;show_version_check&quot;:null,&quot;search&quot;:{&quot;search_path&quot;:&quot;/search&quot;,&quot;issues_path&quot;:&quot;/dashboard/issues&quot;,&quot;mr_path&quot;:&quot;/dashboard/merge_requests&quot;,&quot;autocomplete_path&quot;:&quot;/search/autocomplete&quot;,&quot;settings_path&quot;:&quot;/search/settings&quot;,&quot;search_context&quot;:{&quot;group&quot;:{&quot;id&quot;:8,&quot;name&quot;:&quot;GNOME&quot;,&quot;full_name&quot;:&quot;GNOME&quot;},&quot;group_metadata&quot;:{&quot;issues_path&quot;:&quot;/groups/GNOME/-/issues&quot;,&quot;mr_path&quot;:&quot;/groups/GNOME/-/merge_requests&quot;},&quot;project&quot;:{&quot;id&quot;:36,&quot;name&quot;:&quot;gnome-remote-desktop&quot;},&quot;project_metadata&quot;:{&quot;mr_path&quot;:&quot;/GNOME/gnome-remote-desktop/-/merge_requests&quot;,&quot;issues_path&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues&quot;},&quot;code_search&quot;:false,&quot;scope&quot;:&quot;issues&quot;,&quot;for_snippets&quot;:null}},&quot;panel_type&quot;:&quot;project&quot;,&quot;shortcut_links&quot;:[{&quot;title&quot;:&quot;Snippets&quot;,&quot;href&quot;:&quot;/explore/snippets&quot;,&quot;css_class&quot;:&quot;dashboard-shortcuts-snippets&quot;},{&quot;title&quot;:&quot;Groups&quot;,&quot;href&quot;:&quot;/explore/groups&quot;,&quot;css_class&quot;:&quot;dashboard-shortcuts-groups&quot;},{&quot;title&quot;:&quot;Projects&quot;,&quot;href&quot;:&quot;/explore/projects/starred&quot;,&quot;css_class&quot;:&quot;dashboard-shortcuts-projects&quot;}],&quot;terms&quot;:&quot;/-/users/terms&quot;}"></aside>

<div class="content-wrapper">
<div class="broadcast-wrapper">




</div>
<div class="alert-wrapper alert-wrapper-top-space gl-flex gl-flex-col gl-gap-3 container-fluid container-limited">

























</div>
<div class="top-bar-fixed container-fluid" data-testid="top-bar">
<div class="top-bar-container gl-flex gl-items-center gl-gap-2">
<div class="gl-grow gl-basis-0 gl-flex gl-items-center gl-justify-start">
<button class="gl-button btn btn-icon btn-md btn-default btn-default-tertiary js-super-sidebar-toggle-expand super-sidebar-toggle -gl-ml-3" aria-controls="super-sidebar" aria-expanded="false" aria-label="Primary navigation sidebar" type="button"><svg class="s16 gl-icon gl-button-icon " data-testid="sidebar-icon"><use href="/assets/icons-8791a66659d025e0a4c801978c79a1fbd82db1d27d85f044a35728ea7cf0ae80.svg#sidebar"></use></svg>

</button>
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"GNOME","item":"https://gitlab.gnome.org/GNOME"},{"@type":"ListItem","position":2,"name":"gnome-remote-desktop","item":"https://gitlab.gnome.org/GNOME/gnome-remote-desktop"},{"@type":"ListItem","position":3,"name":"Issues","item":"https://gitlab.gnome.org/GNOME/gnome-remote-desktop/-/issues"},{"@type":"ListItem","position":4,"name":"#196","item":"https://gitlab.gnome.org/GNOME/gnome-remote-desktop/-/issues/196"}]}


</script>
<div data-testid="breadcrumb-links" id="js-vue-page-breadcrumbs-wrapper">
<div data-breadcrumbs-json="[{&quot;text&quot;:&quot;GNOME&quot;,&quot;href&quot;:&quot;/GNOME&quot;,&quot;avatarPath&quot;:&quot;/uploads/-/system/group/avatar/8/gnomelogo.png&quot;},{&quot;text&quot;:&quot;gnome-remote-desktop&quot;,&quot;href&quot;:&quot;/GNOME/gnome-remote-desktop&quot;,&quot;avatarPath&quot;:null},{&quot;text&quot;:&quot;Issues&quot;,&quot;href&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues&quot;,&quot;avatarPath&quot;:null},{&quot;text&quot;:&quot;#196&quot;,&quot;href&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues/196&quot;,&quot;avatarPath&quot;:null}]" id="js-vue-page-breadcrumbs"></div>
<div id="js-injected-page-breadcrumbs"></div>
</div>


</div>
<div class="gl-flex-none gl-flex gl-items-center gl-justify-center">
<div id="js-advanced-search-modal"></div>

</div>
<div class="gl-grow gl-basis-0 gl-flex gl-items-center gl-justify-end">
<div id="js-work-item-feedback"></div>


</div>
</div>
</div>

<div class="container-fluid container-limited limit-container-width project-highlight-puc">
<main class="content" id="content-body" itemscope itemtype="http://schema.org/SoftwareSourceCode">
<div class="flash-container flash-container-page sticky" data-testid="flash-container">
<div id="js-global-alerts"></div>
</div>







<div class="issue-details issuable-details js-issue-details">
<div class="detail-page-description content-block js-detail-page-description gl-pt-3 gl-pb-0 gl-border-none">
<div data-header-actions-data="{&quot;can_create_issue&quot;:&quot;true&quot;,&quot;can_create_incident&quot;:&quot;false&quot;,&quot;can_destroy_issue&quot;:&quot;false&quot;,&quot;can_reopen_issue&quot;:&quot;false&quot;,&quot;can_report_spam&quot;:&quot;&quot;,&quot;can_update_issue&quot;:&quot;false&quot;,&quot;is_issue_author&quot;:&quot;false&quot;,&quot;issue_path&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues/196&quot;,&quot;new_issue_path&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues/new?add_related_issue=196&quot;,&quot;project_path&quot;:&quot;GNOME/gnome-remote-desktop&quot;,&quot;report_abuse_path&quot;:&quot;/-/abuse_reports/add_category&quot;,&quot;reported_user_id&quot;:20088,&quot;reported_from_url&quot;:&quot;https://gitlab.gnome.org/GNOME/gnome-remote-desktop/-/issues/196&quot;,&quot;submit_as_spam_path&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues/196/mark_as_spam&quot;,&quot;issuable_email_address&quot;:null}" data-initial="{&quot;endpoint&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues/196&quot;,&quot;updateEndpoint&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues/196.json&quot;,&quot;canUpdate&quot;:false,&quot;canDestroy&quot;:false,&quot;issuableRef&quot;:&quot;#196&quot;,&quot;imported&quot;:false,&quot;markdownPreviewPath&quot;:&quot;/GNOME/gnome-remote-desktop/-/preview_markdown?target_id=196\u0026target_type=Issue&quot;,&quot;markdownDocsPath&quot;:&quot;/help/user/markdown.md&quot;,&quot;lockVersion&quot;:4,&quot;issuableTemplateNamesPath&quot;:&quot;/GNOME/gnome-remote-desktop/description_templates/names/issue&quot;,&quot;initialTitleHtml&quot;:&quot;gnome-remote-desktop: multiple security issues and recommendations&quot;,&quot;initialTitleText&quot;:&quot;gnome-remote-desktop: multiple security issues and recommendations&quot;,&quot;initialDescriptionHtml&quot;:&quot;\u003cp data-sourcepos=\&quot;1:1-1:21\&quot; dir=\&quot;auto\&quot;\u003eHello GNOME security,\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;3:1-8:50\&quot; dir=\&quot;auto\&quot;\u003ethis issue is about the gnome-remote-desktop project \u003ca data-sourcepos=\&quot;3:54-3:56\&quot; href=\&quot;https://gitlab.gnome.org/GNOME/gnome-remote-desktop\&quot;\u003e1\u003c/a\u003e. I am a\u0026#x000A;member of the SUSE security team and I have conducted a source code\u0026#x000A;review of gnome-remote-desktop, because a D-Bus system service has been\u0026#x000A;added to it with GNOME version 46. In the course of this review I found\u0026#x000A;security issues and collected recommendations that I am reporting to you\u0026#x000A;privately this way. Please find the details below.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;10:1-12:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-coordinated-disclosure\&quot; class=\&quot;anchor\&quot; href=\&quot;#coordinated-disclosure\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eCoordinated Disclosure\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;13:1-14:53\&quot; dir=\&quot;auto\&quot;\u003eWe offer coordinated disclosure based on our disclosure policy \u003ca data-sourcepos=\&quot;13:64-13:66\&quot; href=\&quot;https://en.opensuse.org/openSUSE:Security_disclosure_policy\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; target=\&quot;_blank\&quot;\u003e2\u003c/a\u003e.\u0026#x000A;Please answer the following questions in this regard:\u003c/p\u003e\u0026#x000A;\u003cul data-sourcepos=\&quot;16:1-31:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;16:1-26:0\&quot;\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;16:3-21:21\&quot;\u003eDo you want to perform coordinated disclosure? If yes, then please\u0026#x000A;communicate your desired coordinated release date (CRD) for publishing\u0026#x000A;the security issues and any patches/updates. We offer to keep the\u0026#x000A;issues private for up to 90 days (resulting in publication latest on\u0026#x000A;2024-07-18), but prefer to maintain shorter time frames of two to four\u0026#x000A;weeks, if possible.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;23:3-25:36\&quot;\u003eIf you don&#39;t want to perform coordinated disclosure, then we will\u0026#x000A;publish all information we have on the oss-security mailing list \u003ca data-sourcepos=\&quot;24:68-24:70\&quot; href=\&quot;https://www.openwall.com/lists/oss-security\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; target=\&quot;_blank\&quot;\u003e3\u003c/a\u003e\u0026#x000A;and in our bug tracker right away.\u003c/p\u003e\u0026#x000A;\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;27:1-31:0\&quot;\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;27:3-30:33\&quot;\u003eDo you acknowledge the finding? If so, will you obtain CVE identifiers\u0026#x000A;for the relevant issues? If yes, then please share the CVEs with us\u0026#x000A;once they are assigned. Alternatively we offer to request CVEs from\u0026#x000A;the Mitre organization for you.\u003c/p\u003e\u0026#x000A;\u003c/li\u003e\u0026#x000A;\u003c/ul\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;32:1-34:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-design-overview\&quot; class=\&quot;anchor\&quot; href=\&quot;#design-overview\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eDesign Overview\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;35:1-40:60\&quot; dir=\&quot;auto\&quot;\u003egnome-remote-desktop offers access to the graphics system either via the\u0026#x000A;VNC or the RDP (Microsoft remote desktop) network protocol. Before\u0026#x000A;version 46, gnome-remote-desktop was only used in the context of\u0026#x000A;existing graphical sessions. Starting with version 46, one can also\u0026#x000A;configure a system daemon, that allows to connect to the GDM display\u0026#x000A;manager, allowing to create new graphical sessions remotely.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;42:1-45:23\&quot; dir=\&quot;auto\&quot;\u003eThe system daemon runs as a dedicated \&quot;gnome-remote-desktop\&quot; user. It\u0026#x000A;provides a D-Bus interface on the D-Bus system bus. The daemon also\u0026#x000A;interacts with a newly introduced D-Bus interface provided by GDM, to\u0026#x000A;create remote displays.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;47:1-49:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-review-motivation-and-scope\&quot; class=\&quot;anchor\&quot; href=\&quot;#review-motivation-and-scope\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eReview Motivation and Scope\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;50:1-54:31\&quot; dir=\&quot;auto\&quot;\u003eD-Bus system services require a review by the SUSE security team, before\u0026#x000A;they can be added to openSUSE distributions and derived products. With\u0026#x000A;the addition of the system daemon, a review of gnome-remote-desktop has\u0026#x000A;become necessary, before adding it to openSUSE Tumbleweed in the context\u0026#x000A;of the larger GNOME 46 release.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;56:1-58:67\&quot; dir=\&quot;auto\&quot;\u003eThe review was mainly concerned with the newly introduced system level\u0026#x000A;gnome-remote-desktop daemon. The focus was furthermore on the RDP\u0026#x000A;protocol, which is the default and preferred over the VNC protocol.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;60:1-64:69\&quot; dir=\&quot;auto\&quot;\u003eSince the codebase of gnome-remote-desktop is rather large, I further\u0026#x000A;tried to limit the review to the security of the D-Bus methods, the\u0026#x000A;Polkit authentication and parts of the network processing. I did not\u0026#x000A;look closely into the freerdp library, which is used by\u0026#x000A;gnome-remote-desktop for processing the majority of the RDP protocol.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;66:1-68:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-unauthorized-d-bus-interfaces-1\&quot; class=\&quot;anchor\&quot; href=\&quot;#unauthorized-d-bus-interfaces-1\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eUnauthorized D-Bus Interfaces (\u003ccode data-sourcepos=\&quot;66:33-66:34\&quot;\u003e#1\u003c/code\u003e)\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;69:1-74:27\&quot; dir=\&quot;auto\&quot;\u003eOnly the \&quot;/org/gnome/RemoteDesktop/Rdp/Server\&quot; D-Bus interface is\u0026#x000A;protected by Polkit. \u003ccode data-sourcepos=\&quot;70:23-70:32\&quot;\u003eauth_admin\u003c/code\u003e authorization is required on this\u0026#x000A;interface for all methods. The other two interfaces \&quot;Dispatcher\&quot; and\u0026#x000A;\&quot;Handover\&quot; are not authorized and are accessible to all local users in\u0026#x000A;the system. This leads to a number of local security issues described in\u0026#x000A;the following sub sections.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;76:1-78:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-local-private-key-leak-1a\&quot; class=\&quot;anchor\&quot; href=\&quot;#local-private-key-leak-1a\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eLocal Private Key Leak (\u003ccode data-sourcepos=\&quot;76:26-76:29\&quot;\u003e#1.a\u003c/code\u003e)\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;79:1-82:68\&quot; dir=\&quot;auto\&quot;\u003eThe system daemon keeps public SSL certificates and their corresponding\u0026#x000A;private keys in \&quot;/var/lib/gnome-remote-desktop/.local/share/gnome-remote-desktop/certificates\&quot;.\u0026#x000A;Access to the service&#39;s home directory in \&quot;/var/lib/gnome-remote-desktop\&quot;\u0026#x000A;is restricted to the service user \&quot;gnome-remote-desktop\&quot;, mode 0700.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;84:1-89:68\&quot; dir=\&quot;auto\&quot;\u003eThrough the \&quot;/org/gnome/RemoteDesktop/Rdp/Handovers\&quot; D-Bus interface any\u0026#x000A;local user can intercept the private SSL key, though. The private key is\u0026#x000A;returned from the \u003ccode data-sourcepos=\&quot;86:20-86:32\&quot;\u003eStartHandover\u003c/code\u003e D-Bus function. When a remote desktop\u0026#x000A;client connects to the system daemon, then there is a rather long time\u0026#x000A;window, during which a local user (even \u003ccode data-sourcepos=\&quot;88:42-88:47\&quot;\u003enobody\u003c/code\u003e) can call this method on\u0026#x000A;the created session object. This is an example call to achieve this:\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;91:1-94:3\&quot; class=\&quot;code highlight js-syntax-highlight language-plaintext\&quot; lang=\&quot;plaintext\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003egdbus call -y -d org.gnome.RemoteDesktop -o /org/gnome/RemoteDesktop/Rdp/Handovers/sessionc11 \\\u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC2\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e    -m org.gnome.RemoteDesktop.Rdp.Handover.StartHandover someuser somepass\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;96:1-99:18\&quot; dir=\&quot;auto\&quot;\u003eThe username and password parameters are not important here, they will\u0026#x000A;only be forwarded to the connecting client. Doing this, as another\u0026#x000A;effect, also serves as a DoS, because the proper connection handover\u0026#x000A;will be prevented.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;101:1-104:48\&quot; dir=\&quot;auto\&quot;\u003eA local attacker does not necessarily have to wait for somebody to\u0026#x000A;connect to the system daemon, it can connect on its own via localhost,\u0026#x000A;to achieve the same result. Valid credentials for RDP authentication are\u0026#x000A;necessary to get to the handover stage, however.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;106:1-109:63\&quot; dir=\&quot;auto\&quot;\u003eThe impact of this problem is a local information leak and local DoS.\u0026#x000A;The information leak means that the integrity and privacy of RDP\u0026#x000A;connections on the system are compromised. Attached to this issue is\u0026#x000A;also a simple Python script that allows to reproduce the issue.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;111:1-113:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-system-credentials-leak-1b\&quot; class=\&quot;anchor\&quot; href=\&quot;#system-credentials-leak-1b\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSystem Credentials Leak (\u003ccode data-sourcepos=\&quot;111:27-111:30\&quot;\u003e#1.b\u003c/code\u003e)\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;114:1-118:64\&quot; dir=\&quot;auto\&quot;\u003eIf an RDP connection uses system credentials (see struct member\u0026#x000A;\u003ccode data-sourcepos=\&quot;115:2-115:39\&quot;\u003eGrdRemoteClient.use_system_credentials\u003c/code\u003e), then a local attacker with\u0026#x000A;low privileges can obtain these credentials in cleartext in a similar\u0026#x000A;fashion to issue \u003ccode data-sourcepos=\&quot;117:19-117:22\&quot;\u003e#1.a\u003c/code\u003e, by calling the unauthenticated\u0026#x000A;\u003ccode data-sourcepos=\&quot;118:2-118:23\&quot;\u003eGetSystemCredentials()\u003c/code\u003e D-Bus method of the Handover interface.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;120:1-124:47\&quot; dir=\&quot;auto\&quot;\u003eUsing these system credentials, the attacker will be able to connect to\u0026#x000A;the display manager via RDP. This should not directly grant access to a\u0026#x000A;session, since a login on display manager level still has to happen. An\u0026#x000A;exception would be if things like automatic login are enabled, which I\u0026#x000A;don&#39;t know if they apply to remote connections.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;126:1-128:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-the-socket-connection-can-be-obtained-via-takeclient-1c\&quot; class=\&quot;anchor\&quot; href=\&quot;#the-socket-connection-can-be-obtained-via-takeclient-1c\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eThe Socket Connection can be Obtained via TakeClient() (\u003ccode data-sourcepos=\&quot;126:58-126:61\&quot;\u003e#1.c\u003c/code\u003e)\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;129:1-132:60\&quot; dir=\&quot;auto\&quot;\u003eThe equally unauthenticated D-Bus method \u003ccode data-sourcepos=\&quot;129:43-129:63\&quot;\u003eHandover.TakeClient()\u003c/code\u003e allows\u0026#x000A;any local user in the system to obtain the file descriptor pertaining to\u0026#x000A;the RDP client that is in handover state. This could allow a local user\u0026#x000A;to DoS the RDP connection or to setup a crafted RDP session.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;134:1-139:33\&quot; dir=\&quot;auto\&quot;\u003eObtaining the socket via this call only works in certain system daemon\u0026#x000A;states, most notably it seems the \u003ccode data-sourcepos=\&quot;135:36-135:50\&quot;\u003eStartHandover()\u003c/code\u003e needs to have been\u0026#x000A;performed for this to succeed. I did not fully investigate what the\u0026#x000A;exact preconditions are. If the preconditions are not met then this\u0026#x000A;call triggers a series of (non-fatal) assertions, which should also not\u0026#x000A;be reachable this way, I believe:\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;141:1-145:3\&quot; class=\&quot;code highlight js-syntax-highlight language-plaintext\&quot; lang=\&quot;plaintext\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003egnome-remote-de[31380]: g_socket_connection_get_socket: assertion &#39;G_IS_SOCKET_CONNECTION (connection)&#39; failed\u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC2\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003egnome-remote-de[31380]: g_socket_get_fd: assertion &#39;G_IS_SOCKET (socket)&#39; failed\u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC3\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003egnome-remote-de[31380]: g_unix_fd_list_append: assertion &#39;fd \u0026gt;= 0&#39; failed\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;147:1-149:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-dispatcher-interface-seems-safe\&quot; class=\&quot;anchor\&quot; href=\&quot;#dispatcher-interface-seems-safe\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eDispatcher Interface seems Safe\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;150:1-154:29\&quot; dir=\&quot;auto\&quot;\u003eThe only method existing in the Dispatcher interface, \u003ccode data-sourcepos=\&quot;150:56-150:70\&quot;\u003eRequestHandover\u003c/code\u003e,\u0026#x000A;only succeeds if the caller&#39;s session has a connection waiting for\u0026#x000A;handover. It should be okay that this interface is not authorized in its\u0026#x000A;current form, because the sessions are managed by the privileged systemd\u0026#x000A;daemon and cannot be crafted.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;156:1-158:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-suggested-fix\&quot; class=\&quot;anchor\&quot; href=\&quot;#suggested-fix\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSuggested Fix\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;159:1-161:70\&quot; dir=\&quot;auto\&quot;\u003eThe Handover D-Bus interface needs to be protected either by Polkit or\u0026#x000A;via D-Bus configuration. If only specific static users need to call\u0026#x000A;these D-Bus methods, then the D-Bus configuration is the correct spot.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;163:1-171:8\&quot; dir=\&quot;auto\&quot;\u003eThe unauthenticated handover methods seem to be designed to be called by\u0026#x000A;the \u003ccode data-sourcepos=\&quot;164:6-164:15\&quot;\u003e--handover\u003c/code\u003e personality of the gnome-remote-desktop daemon, and\u0026#x000A;this instance likely should run as the dynamic session user that\u0026#x000A;authenticates in GDM. If this is correct, then neither D-Bus nor Polkit\u0026#x000A;offer the necessary features to restrict access to the D-Bus API to\u0026#x000A;exactly this user. A possibility to fix this could be to use the same\u0026#x000A;approach as in the Dispatcher interface, to only grant access to a\u0026#x000A;client that originates from the session that has the respective handover\u0026#x000A;pending.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;173:1-178:64\&quot; dir=\&quot;auto\&quot;\u003eEven if only a legitimate user has access to the Handover D-Bus API,\u0026#x000A;there are still problems with the API design. Nobody except the\u0026#x000A;gnome-remote-desktop system daemon service user should ever have access\u0026#x000A;to the private server key and the system credentials. Why these are\u0026#x000A;passed into the handover context is not fully clear to me. A larger\u0026#x000A;redesign might be necessary to address these overarching issues.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;180:1-182:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-single-polkit-action-for-everything-2\&quot; class=\&quot;anchor\&quot; href=\&quot;#single-polkit-action-for-everything-2\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSingle Polkit Action for Everything (\u003ccode data-sourcepos=\&quot;180:39-180:39\&quot;\u003e2\u003c/code\u003e)\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;183:1-188:72\&quot; dir=\&quot;auto\&quot;\u003eThe bits of the D-Bus interface that are authenticated all use the same\u0026#x000A;Polkit action \u003ccode data-sourcepos=\&quot;184:16-184:62\&quot;\u003eorg.gnome.remotedesktop.configure-system-daemon\u003c/code\u003e. Most of\u0026#x000A;the D-Bus methods are indeed for configuring things. The\u0026#x000A;\u003ccode data-sourcepos=\&quot;186:2-186:17\&quot;\u003eGetCredentials()\u003c/code\u003e method could be considered different, though.\u0026#x000A;Furthermore the \u003ccode data-sourcepos=\&quot;187:18-187:23\&quot;\u003egrdctl\u003c/code\u003e utility also uses this action, if it is\u0026#x000A;supposed to act on the system daemon (by passing the \u003ccode data-sourcepos=\&quot;188:55-188:62\&quot;\u003e--system\u003c/code\u003e switch).\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;190:1-193:60\&quot; dir=\&quot;auto\&quot;\u003eThe action also implies the right to modify systemd units. This is only\u0026#x000A;needed by \u003ccode data-sourcepos=\&quot;191:12-191:17\&quot;\u003egrdctl\u003c/code\u003e to enable or disable the system daemon systemd unit,\u0026#x000A;though. For the D-Bus interface these implied permissions are never\u0026#x000A;needed and are therefore excess privileges most of the time.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;195:1-197:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-suggested-fix-1\&quot; class=\&quot;anchor\&quot; href=\&quot;#suggested-fix-1\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSuggested Fix\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;198:1-202:55\&quot; dir=\&quot;auto\&quot;\u003eA more fine grained approach with multiple Polkit actions would allow to\u0026#x000A;avoid these excess privileges and also would allow Admins to better\u0026#x000A;control the authentication settings for individual actions. For end\u0026#x000A;users, more fine grained actions would result in better authentication\u0026#x000A;messages, that explain what exactly is about to happen.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;204:1-206:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-importcertificate-d-bus-method-dos-weaknesses-and-overly-complex-api-3\&quot; class=\&quot;anchor\&quot; href=\&quot;#importcertificate-d-bus-method-dos-weaknesses-and-overly-complex-api-3\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eImportCertificate D-Bus Method DoS Weaknesses and Overly Complex API (\u003ccode data-sourcepos=\&quot;204:72-204:73\&quot;\u003e3#\u003c/code\u003e)\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;207:1-211:29\&quot; dir=\&quot;auto\&quot;\u003eThis D-Bus method requires \u003ccode data-sourcepos=\&quot;207:29-207:38\&quot;\u003eauth_admin\u003c/code\u003e Polkit authentication, so it is\u0026#x000A;not generally accessible by default. Polkit allows to lower\u0026#x000A;authentication requirements, though. Apart from this, any D-Bus method\u0026#x000A;should be implemented in a robust way. This is not the case for the\u0026#x000A;\&quot;ImportCertificate()\&quot; method.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;213:1-218:24\&quot; dir=\&quot;auto\&quot;\u003eThe method expects two pairs of (filename, file descriptor) both for the\u0026#x000A;public SSL certificate and the private key. Each file descriptor can\u0026#x000A;refer to anything and the D-Bus service simply copies the data from the\u0026#x000A;file descriptor to a file beneath \&quot;/var/lib/gnome-remote-desktop\&quot;. If a\u0026#x000A;caller passes a file descriptor for \&quot;/dev/zero\&quot;, then the service will\u0026#x000A;fill up the file system.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;220:1-227:53\&quot; dir=\&quot;auto\&quot;\u003eSince the call allows to specify a custom filename, the service needs to\u0026#x000A;worry about problematic paths containing path components like \&quot;/\&quot; and\u0026#x000A;\&quot;..\&quot;. It succeeds mostly with this, but there is still an error\u0026#x000A;condition that can be triggered by passing \&quot;.\&quot; as a path. The service\u0026#x000A;will then try to open the path\u0026#x000A;\&quot;/var/lib/gnome-remote-desktop/.local/share/gnome-remote-desktop/certificates\&quot;\u0026#x000A;as a file, which results in an EISDIR error. This has no security\u0026#x000A;relevance, but is still kind of unexpected behaviour.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;229:1-238:56\&quot; dir=\&quot;auto\&quot;\u003eSupporting custom filenames also means that an infinite amount of files\u0026#x000A;can be placed in the certificates directory, including hidden files or\u0026#x000A;files containing unexpected characters like wildcards, binary data,\u0026#x000A;files starting with \&quot;--\&quot; (possibly injecting command line options) etc.\u0026#x000A;This approach also add the burden of managing the lifetime of multiple\u0026#x000A;installed certificates, but this doesn&#39;t even happen. Files are never\u0026#x000A;removed again from the certificates directory. Even more so, if an\u0026#x000A;existing filename is to be overwritten, then backups of the old files\u0026#x000A;are created. But I don&#39;t think any admin will be aware of that fact,\u0026#x000A;even if a certificate would be accidentally overwritten.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;240:1-246:43\&quot; dir=\&quot;auto\&quot;\u003eFurthermore, if the function cannot fully complete the request (e.g.\u0026#x000A;writing the certificate succeeded, but writing the private key failed),\u0026#x000A;then the partially imported data is not removed again. The function can\u0026#x000A;also be tricked into generating an invalid configuration by specifying\u0026#x000A;the same filename for both certificate and key. Only the private key\u0026#x000A;will then remain under this name, but gnome-remote-desktop will try to\u0026#x000A;use the same path also for the certificate.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;248:1-250:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-suggested-fix-2\&quot; class=\&quot;anchor\&quot; href=\&quot;#suggested-fix-2\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSuggested Fix\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;251:1-256:33\&quot; dir=\&quot;auto\&quot;\u003eAllowing custom filenames in this API just adds complexity that seems\u0026#x000A;not to offer much in return. If admins want to manage multiple sets of\u0026#x000A;certificates, then they can do this in their own context. Only one set\u0026#x000A;of certificate and key will ever be active in the system daemon anyway.\u0026#x000A;So I would simply drop the filename support and use a fixed name for\u0026#x000A;both certificate and private key.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;258:1-266:5\&quot; dir=\&quot;auto\&quot;\u003eThe file descriptor passed here should be checked for its type (via\u0026#x000A;\u003ccode data-sourcepos=\&quot;259:2-259:8\&quot;\u003efstat()\u003c/code\u003e) and be rejected if it is not a regular file. Then a maximum\u0026#x000A;file size should be enforced to prevent the file system space being\u0026#x000A;depleted. No certificate / key combination should be larger than a few\u0026#x000A;kilobytes. Once the file type is restricted to regular files, there\u0026#x000A;should also be no big risk of reads on the file descriptor to be\u0026#x000A;blocking. For full security coverage one could also add a timeout\u0026#x000A;handling, to make sure the call completes withing a reasonable amount of\u0026#x000A;time.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;268:1-270:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-credentialsini-is-created-world-readable-4\&quot; class=\&quot;anchor\&quot; href=\&quot;#credentialsini-is-created-world-readable-4\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003ecredentials.ini is Created World-Readable (\u003ccode data-sourcepos=\&quot;268:45-268:46\&quot;\u003e#4\u003c/code\u003e)\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;271:1-279:42\&quot; dir=\&quot;auto\&quot;\u003eThe file\u0026#x000A;\&quot;/var/lib/gnome-remote-desktop/.local/share/gnome-remote-desktop/credentials.ini\&quot;,\u0026#x000A;which contains the cleartext authentication credentials, is saved with\u0026#x000A;the world readable bit set. This happens in function\u0026#x000A;\u003ccode data-sourcepos=\&quot;275:2-275:27\&quot;\u003egrd_credentials_file_new()\u003c/code\u003e. This is not a problem in the context of\u0026#x000A;the system daemon, since its home directory, \&quot;/var/lib/gnome-remote-desktop\&quot;,\u0026#x000A;has mode 0700. Still the file itself should get proper protection bits.\u0026#x000A;This is also inconsistent with respect to the certificate and private\u0026#x000A;key, which do have mode 0700, in contrast.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;281:1-283:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-suggested-fix-3\&quot; class=\&quot;anchor\&quot; href=\&quot;#suggested-fix-3\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSuggested Fix\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;284:1-285:46\&quot; dir=\&quot;auto\&quot;\u003eFixing this should be straight forward simply by applying the proper\u0026#x000A;0600 permissions to the file when creating it.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;287:1-289:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-the-system-service-can-be-started-by-anybody-in-the-system-5\&quot; class=\&quot;anchor\&quot; href=\&quot;#the-system-service-can-be-started-by-anybody-in-the-system-5\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eThe system service can be started by anybody in the system (\u003ccode data-sourcepos=\&quot;287:62-287:63\&quot;\u003e#5\u003c/code\u003e)\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;290:1-295:15\&quot; dir=\&quot;auto\&quot;\u003eIndependently of the enable/disable and start/stop status of the\u0026#x000A;gnome-remote-desktop systemd service, the system daemon can be started\u0026#x000A;by anybody in the system via the D-Bus autostart logic configured in\u0026#x000A;\&quot;/usr/share/dbus-1/system-services/org.gnome.RemoteDesktop.service\&quot;.\u0026#x000A;Introspecting the service on D-Bus level is enough to trigger the start\u0026#x000A;of the service.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;297:1-300:35\&quot; dir=\&quot;auto\&quot;\u003eIf the service has already been configured once by an admin, then this\u0026#x000A;means that the system service will even go live, listening on the\u0026#x000A;network. Only the default firewall settings might prevent it becoming\u0026#x000A;actually accessible on the network.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;302:1-304:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-suggested-fix-4\&quot; class=\&quot;anchor\&quot; href=\&quot;#suggested-fix-4\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSuggested Fix\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;305:1-307:48\&quot; dir=\&quot;auto\&quot;\u003eFor a sensitive network service such as this I would consider not to\u0026#x000A;configure the D-Bus autostart, but to require an explicit admin decision\u0026#x000A;to start or enable the service on systemd level.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;309:1-311:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-find_cr_lf-suffers-from-a-one-byte-overread-6\&quot; class=\&quot;anchor\&quot; href=\&quot;#find_cr_lf-suffers-from-a-one-byte-overread-6\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003e\u003ccode data-sourcepos=\&quot;309:2-309:13\&quot;\u003efind_cr_lf()\u003c/code\u003e Suffers from a one Byte Overread (\u003ccode data-sourcepos=\&quot;309:51-309:52\&quot;\u003e#6\u003c/code\u003e)\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;312:1-316:64\&quot; dir=\&quot;auto\&quot;\u003eThis function processes untrusted pre-authentication RDP protocol\u0026#x000A;network data (the routing token) and looks for a terminating \\r\\n\u0026#x000A;sequence. The size calculation in the function&#39;s for loop is wrong: If\u0026#x000A;the final byte of the buffer is 0x0D, then the logic will access the\u0026#x000A;next byte out of bounds. This buffer is not non-null terminated.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;318:1-320:39\&quot; dir=\&quot;auto\&quot;\u003eThe impact should be negligible in most cases, but the issue should\u0026#x000A;still be addressed. This is the output of Valgrind I obtained after\u0026#x000A;sending a crafted packet to the daemon:\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;322:1-330:3\&quot; class=\&quot;code highlight js-syntax-highlight language-plaintext\&quot; lang=\&quot;plaintext\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e==31119== Invalid read of size 1\u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC2\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e==31119==    at 0x15A1EF: UnknownInlinedFun (grd-rdp-routing-token.c:65)\u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC3\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e==31119==    by 0x15A1EF: UnknownInlinedFun (grd-rdp-routing-token.c:159)\u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC4\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e==31119==    by 0x15A1EF: UnknownInlinedFun (grd-rdp-routing-token.c:239)\u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC5\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e==31119==    by 0x15A1EF: peek_routing_token_in_thread\u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC6\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e(grd-rdp-routing-token.c:281)\u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC7\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e\u0026lt;snip\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;332:1-334:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-suggested-fix-5\&quot; class=\&quot;anchor\&quot; href=\&quot;#suggested-fix-5\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSuggested Fix\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;335:1-336:25\&quot; dir=\&quot;auto\&quot;\u003eThe fix should be straight forward by correcting the maximum search\u0026#x000A;index for the terminator.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;339:1-341:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-grd_rdp_sam_create_sam_file-uses-a-racy-system-call-sequence-to-remove-the-o_cloexec-flag-7\&quot; class=\&quot;anchor\&quot; href=\&quot;#grd_rdp_sam_create_sam_file-uses-a-racy-system-call-sequence-to-remove-the-o_cloexec-flag-7\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003e\u003ccode data-sourcepos=\&quot;339:2-339:30\&quot;\u003egrd_rdp_sam_create_sam_file()\u003c/code\u003e Uses a Racy System Call Sequence to Remove the \u003ccode data-sourcepos=\&quot;339:81-339:89\&quot;\u003eO_CLOEXEC\u003c/code\u003e flag (\u003ccode data-sourcepos=\&quot;339:99-339:100\&quot;\u003e#7\u003c/code\u003e)\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;342:1-346:16\&quot; dir=\&quot;auto\&quot;\u003eThis function creates a temporary file using \u003ccode data-sourcepos=\&quot;342:47-342:55\&quot;\u003emkstemp()\u003c/code\u003e. In a second\u0026#x000A;step the \u003ccode data-sourcepos=\&quot;343:11-343:19\&quot;\u003eO_CLOEXEC\u003c/code\u003e flag is removed from the resulting file descriptor\u0026#x000A;via \u003ccode data-sourcepos=\&quot;344:6-344:12\&quot;\u003efcntl()\u003c/code\u003e. If another thread calls \u003ccode data-sourcepos=\&quot;344:41-344:48\&quot;\u003eexecve()\u003c/code\u003e during this time\u0026#x000A;window, then this file descriptor will be inherited to other processes\u0026#x000A;unintentionally.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;348:1-350:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-suggested-fix-6\&quot; class=\&quot;anchor\&quot; href=\&quot;#suggested-fix-6\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSuggested Fix\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;351:1-353:20\&quot; dir=\&quot;auto\&quot;\u003eOn a number of systems, including Linux with glibc, \u003ccode data-sourcepos=\&quot;351:54-351:63\&quot;\u003emkostemp()\u003c/code\u003e can be\u0026#x000A;used to get a file descriptor with \u003ccode data-sourcepos=\&quot;352:37-352:45\&quot;\u003eO_CLOEXEC\u003c/code\u003e set right away, to avoid\u0026#x000A;this race condition.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;355:1-357:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-on_incoming_redirected_connection-outputs-untrusted-string-via-g_debug-8\&quot; class=\&quot;anchor\&quot; href=\&quot;#on_incoming_redirected_connection-outputs-untrusted-string-via-g_debug-8\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003e\u003ccode data-sourcepos=\&quot;355:2-355:36\&quot;\u003eon_incoming_redirected_connection()\u003c/code\u003e Outputs Untrusted String via \u003ccode data-sourcepos=\&quot;355:69-355:77\&quot;\u003eg_debug()\u003c/code\u003e (\u003ccode data-sourcepos=\&quot;355:82-355:83\&quot;\u003e#8\u003c/code\u003e)\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;358:1-366:22\&quot; dir=\&quot;auto\&quot;\u003eThe \u003ccode data-sourcepos=\&quot;358:6-358:22\&quot;\u003erouting_token_str\u003c/code\u003e is data obtained from an untrusted RDP client\u0026#x000A;before authentication is performed. This is the same data that is\u0026#x000A;processed by \u003ccode data-sourcepos=\&quot;360:15-360:26\&quot;\u003efind_cr_lf()\u003c/code\u003e mentioned in item \u003ccode data-sourcepos=\&quot;360:48-360:49\&quot;\u003e#7\u003c/code\u003e. Luckily the network\u0026#x000A;protocol parsing code in \u003ccode data-sourcepos=\&quot;361:27-361:46\&quot;\u003epeek_routing_token()\u003c/code\u003e at least ensures that\u0026#x000A;this string is always null terminated, otherwise this would allow for an\u0026#x000A;arbitrary unauthenticated remote DoS against the RDP daemon. \u003ccode data-sourcepos=\&quot;363:63-363:71\&quot;\u003eg_debug()\u003c/code\u003e\u0026#x000A;generates the string to be logged, even if the log level DEBUG is not\u0026#x000A;active. Thus formatting errors will always trigger, independently of the\u0026#x000A;logging configuration.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;368:1-374:30\&quot; dir=\&quot;auto\&quot;\u003eIf the DEBUG log level is active, then the output of the untrusted data\u0026#x000A;allows an unauthenticated remote attacker to perform log spoofing. The\u0026#x000A;string can be roughly 200 bytes long (limited by the protocol headers)\u0026#x000A;and can contain arbitrary data (except for the \&quot;\\r\\n\&quot; terminator\u0026#x000A;sequence). Thus it can also contain terminal control characters that\u0026#x000A;allow to overwrite previous log lines, or to create a larger number of\u0026#x000A;seemingly authentic log lines.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;376:1-379:6\&quot; dir=\&quot;auto\&quot;\u003eThe function later on converts the untrusted data into an unsigned long\u0026#x000A;integer. The resulting integer is only used for looking up an existing\u0026#x000A;RDP session. Therefore no further attack surface via crafted data should\u0026#x000A;exist.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;381:1-383:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-suggested-fix-7\&quot; class=\&quot;anchor\&quot; href=\&quot;#suggested-fix-7\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSuggested Fix\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;384:1-386:46\&quot; dir=\&quot;auto\&quot;\u003eThe output of the untrusted data should either be removed completely, or\u0026#x000A;the routing token should be verified both in content and length, to\u0026#x000A;prevent unexpected things happening on output.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;388:1-390:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-grdctl-utility-accepts-cleartext-password-on-the-command-line-9\&quot; class=\&quot;anchor\&quot; href=\&quot;#grdctl-utility-accepts-cleartext-password-on-the-command-line-9\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003e\u003ccode data-sourcepos=\&quot;388:2-388:7\&quot;\u003egrdctl\u003c/code\u003e Utility Accepts Cleartext Password on the Command Line (\u003ccode data-sourcepos=\&quot;388:67-388:68\&quot;\u003e#9\u003c/code\u003e)\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;391:1-393:32\&quot; dir=\&quot;auto\&quot;\u003eThe text based \u003ccode data-sourcepos=\&quot;391:17-391:22\&quot;\u003egrdctl\u003c/code\u003e configuration utility which is used for both,\u0026#x000A;system and session context RDP setups, accepts cleartext passwords in\u0026#x000A;the following invocation styles:\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;395:1-398:3\&quot; class=\&quot;code highlight js-syntax-highlight language-plaintext\&quot; lang=\&quot;plaintext\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003egrdctl [--system] rdp set-credentials \u0026lt;username\u0026gt; \u0026lt;password\u0026gt;\u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC2\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003egrdctl [--system] vnc set-password \u0026lt;username\u0026gt; \u0026lt;password\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;400:1-403:20\&quot; dir=\&quot;auto\&quot;\u003eThis means that the cleartext password will leak via the /proc file\u0026#x000A;system and will be visible in the process task list via \u003ccode data-sourcepos=\&quot;401:58-401:59\&quot;\u003eps\u003c/code\u003e, when\u0026#x000A;configured this way. Other users can thus get access to the\u0026#x000A;authentication data.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;405:1-407:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-suggested-fix-8\&quot; class=\&quot;anchor\&quot; href=\&quot;#suggested-fix-8\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSuggested Fix\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;408:1-409:71\&quot; dir=\&quot;auto\&quot;\u003ePasswords should either be queried from stdin, passed in files or via\u0026#x000A;environment variables to prevent such kinds of local information leaks.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;411:1-413:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-vnc-by-default-does-not-authenticate-but-only-prompts-for-acceptdeny-10\&quot; class=\&quot;anchor\&quot; href=\&quot;#vnc-by-default-does-not-authenticate-but-only-prompts-for-acceptdeny-10\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eVNC by Default does not Authenticate, but Only Prompts for Accept/Deny (\u003ccode data-sourcepos=\&quot;411:74-411:76\&quot;\u003e#10\u003c/code\u003e)\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;414:1-417:48\&quot; dir=\&quot;auto\&quot;\u003eVNC is hidden away from the graphical user interface by now, but by\u0026#x000A;using \u003ccode data-sourcepos=\&quot;415:8-415:13\&quot;\u003egrdctl\u003c/code\u003e it can still be enabled. I tested this only in session\u0026#x000A;context, not in the system daemon context, since I did not manage to\u0026#x000A;enable VNC for the system daemon using \u003ccode data-sourcepos=\&quot;417:41-417:46\&quot;\u003egrdctl\u003c/code\u003e.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;419:1-425:7\&quot; dir=\&quot;auto\&quot;\u003eThe default for the VNC protocol is to prompt only, when a client\u0026#x000A;connects, and to limit access to view-only (no control over input\u0026#x000A;devices). The resulting process is that, on the server side, the user is\u0026#x000A;presented with a popup dialog like \&quot;Host  wants to access your\u0026#x000A;screen. Allow/Deny?\&quot;.  This workflow offers no client verification at\u0026#x000A;all, in particular a man-in-the-middle attack or source IP spoofing can\u0026#x000A;happen.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;427:1-429:20\&quot; dir=\&quot;auto\&quot;\u003eThe VNC protocol is not a secure protocol by default, but this\u0026#x000A;prompt-only approach in gnome-remote-desktop removes all chances of\u0026#x000A;security, by design.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;431:1-433:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-suggested-fix-9\&quot; class=\&quot;anchor\&quot; href=\&quot;#suggested-fix-9\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSuggested Fix\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;434:1-436:10\&quot; dir=\&quot;auto\&quot;\u003eIf proper trust cannot be established via the VNC protocol, then a\u0026#x000A;prompt-only mode should not be offered, and password authentication made\u0026#x000A;mandatory.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;438:1-440:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-miscellaneous\&quot; class=\&quot;anchor\&quot; href=\&quot;#miscellaneous\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eMiscellaneous\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;441:1-442:38\&quot; dir=\&quot;auto\&quot;\u003eFollowing are various bits that I observed while digging through the\u0026#x000A;codebase that I find worth mentioning.\u003c/p\u003e\u0026#x000A;\u003cul data-sourcepos=\&quot;444:1-497:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;444:1-449:0\&quot;\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;444:3-448:25\&quot;\u003eThe D-Bus method \&quot;Rdp.Server.GetCredentials()\&quot; allows to get the\u0026#x000A;cleartext credentials for the system daemon (after Polkit admin\u0026#x000A;authentication). Passing cleartext passwords around this way, even\u0026#x000A;after authorization, should be well considered and it is unclear what\u0026#x000A;the purpose of this is.\u003c/p\u003e\u0026#x000A;\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;450:1-464:0\&quot;\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;450:3-450:71\&quot;\u003e\u003ccode data-sourcepos=\&quot;450:4-450:22\&quot;\u003ecreate_sam_string()\u003c/code\u003e contains a questionable array size calculation:\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;452:7-453:0\&quot; class=\&quot;code highlight js-syntax-highlight language-plaintext\&quot; lang=\&quot;plaintext\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e sam_string = g_malloc0 ((username_length + 3 + 32 + 3 + 1 + 1) * sizeof (char));\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;454:4-460:34\&quot;\u003eThere is no documentation what this is about. The freerdp library\u0026#x000A;function \u003ccode data-sourcepos=\&quot;455:14-455:23\&quot;\u003eNTOWFv1A()\u003c/code\u003e that is called in this function, receives a\u0026#x000A;buffer \u003ccode data-sourcepos=\&quot;456:12-456:18\&quot;\u003ent_hash\u003c/code\u003e, without knowing about the available buffer space.\u0026#x000A;It seems this is \&quot;by contract\&quot;, but pretty dangerous. Furthermore the\u0026#x000A;return value of the function is not checked by \u003ccode data-sourcepos=\&quot;458:52-458:70\&quot;\u003ecreate_sam_string()\u003c/code\u003e.\u0026#x000A;This and a few other looks into the freerdp library raise questions\u0026#x000A;about its code and API quality.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;462:4-463:43\&quot;\u003eI suggest to add comments about the purpose of this and to evaluate\u0026#x000A;the return code of the library function.\u003c/p\u003e\u0026#x000A;\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;465:1-474:0\&quot;\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;465:3-465:75\&quot;\u003eThe \u003ccode data-sourcepos=\&quot;465:8-465:36\&quot;\u003estart_rdp_server_when_ready()\u003c/code\u003e function has a very strange semantic:\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;467:7-468:0\&quot; class=\&quot;code highlight js-syntax-highlight language-plaintext\&quot; lang=\&quot;plaintext\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003estart_rdp_server_when_ready (GrdDaemon *daemon, gboolean should_start_when_ready)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;469:3-471:39\&quot;\u003eBasically this says \u003ccode data-sourcepos=\&quot;469:24-469:48\&quot;\u003estart_when_ready(or_dont)\u003c/code\u003e. I believe this is the\u0026#x000A;result of some unfortunate naming of the function that has a different\u0026#x000A;purpose than what it sounds at first.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;473:3-473:53\&quot;\u003eI suggest to rename this to something more fitting.\u003c/p\u003e\u0026#x000A;\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;475:1-485:0\&quot;\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;475:3-480:58\&quot;\u003eThe \u003ccode data-sourcepos=\&quot;475:8-475:37\&quot;\u003epeek_routing_token_in_thread()\u003c/code\u003e function parses the RDP protocol\u0026#x000A;outside of the freerdp library, to extract the routing token. This is\u0026#x000A;pretty complex and dangerous code. Especially bad is that the\u0026#x000A;extracted untrusted routing token is passed through the codebase via\u0026#x000A;various indirections (callbacks, signals). The boundary where trusted\u0026#x000A;and untrusted data is processed is not well established.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;482:3-484:43\&quot;\u003eThe untrusted data should be clearly marked and ideally all code that\u0026#x000A;deals with it should be grouped in a dedicated compilation unit that\u0026#x000A;only deals with untrusted data like this.\u003c/p\u003e\u0026#x000A;\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;486:1-497:0\&quot;\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;486:3-493:72\&quot;\u003eA renderer thread with an optional NVidia CUDA context is setup for\u0026#x000A;every connecting client, without even having authorized the client.\u0026#x000A;Also a layout manager thread is created. Overall this accounts for\u0026#x000A;some five threads for each unauthenticated session. Luckily the daemon\u0026#x000A;does not perform parallel incoming connection processing, otherwise\u0026#x000A;this would pose a simple remote DoS amplification vector. Still I\u0026#x000A;wonder if it is a good idea to start so many threads, a renderer and\u0026#x000A;hardware acceleration before a client is even authorized for anything.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;495:3-496:16\&quot;\u003eI suggest to only acquire heavy resources after a client successfully\u0026#x000A;authenticated.\u003c/p\u003e\u0026#x000A;\u003c/li\u003e\u0026#x000A;\u003c/ul\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;498:1-500:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-cve-assignments\&quot; class=\&quot;anchor\&quot; href=\&quot;#cve-assignments\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eCVE Assignments\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;501:1-503:69\&quot; dir=\&quot;auto\&quot;\u003eItems \u003ccode data-sourcepos=\&quot;501:8-501:11\&quot;\u003e#1.a\u003c/code\u003e through \u003ccode data-sourcepos=\&quot;501:23-501:26\&quot;\u003e#1.c\u003c/code\u003e are CVE relevant. A single CVE could be issued\u0026#x000A;grouping these as \&quot;unauthenticated D-Bus API\&quot; issues. Item \u003ccode data-sourcepos=\&quot;502:61-502:62\&quot;\u003e#9\u003c/code\u003e also\u0026#x000A;justifies a CVE since this is a very tangible local information leak.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;505:1-507:15\&quot; dir=\&quot;auto\&quot;\u003eWhile they formally would qualify for a CVE, I would not assign any for\u0026#x000A;items \u003ccode data-sourcepos=\&quot;506:8-506:9\&quot;\u003e#6\u003c/code\u003e and \u003ccode data-sourcepos=\&quot;506:17-506:18\&quot;\u003e#8\u003c/code\u003e, because their impact is negligible in default\u0026#x000A;configurations.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;509:1-510:74\&quot; dir=\&quot;auto\&quot;\u003eRegarding the fixes for the reported issues we are available to review\u0026#x000A;them, before publication, if you intend to perform coordinated disclosure.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;512:1-514:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-review-summary\&quot; class=\&quot;anchor\&quot; href=\&quot;#review-summary\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eReview Summary\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;515:1-520:71\&quot; dir=\&quot;auto\&quot;\u003eEven considering the concrete findings from this report fixed, my trust\u0026#x000A;into the gnome-remote-desktop codebase is low. The current design for\u0026#x000A;the handover feels too complex. Implementation wise I don&#39;t see why a\u0026#x000A;sensitive network service is still developed with C89 level code these\u0026#x000A;days anymore. The codebase is really hard to follow and has nearly no\u0026#x000A;comments or documentation. Function names like these don&#39;t help either:\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;522:5-523:0\&quot; class=\&quot;code highlight js-syntax-highlight language-plaintext\&quot; lang=\&quot;plaintext\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003egrd_rdp_network_autodetection_get_bw_measure_stop_event_handle()\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;524:1-529:49\&quot; dir=\&quot;auto\&quot;\u003eThe only thing that reduces the burden a bit are the automatic memory\u0026#x000A;management helpers like \u003ccode data-sourcepos=\&quot;525:26-525:35\&quot;\u003eg_autofree\u003c/code\u003e. gnome-remote-desktop consists of\u0026#x000A;40,000 lines of C code though, and this doesn&#39;t even include the actual\u0026#x000A;parsing of the protocol. The gobject model with its many indirections and\u0026#x000A;the specific coding style found in this project represents a high bar\u0026#x000A;for a third party to comprehend what is going on.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;531:1-537:35\&quot; dir=\&quot;auto\&quot;\u003eAs already mentioned above, there is no clear separation of trusted and\u0026#x000A;untrusted data. In the system daemon context there are at least four\u0026#x000A;different security domains: The GDM domain, the gnome-remote-desktop\u0026#x000A;domain, untrusted remote data from unauthenticated clients and finally\u0026#x000A;trusted remote data from authenticated clients. Without documentation\u0026#x000A;and a clear program structure that clearly separate these security\u0026#x000A;domains, errors can easily slip in.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;539:1-542:18\&quot; dir=\&quot;auto\&quot;\u003eFrom what I have seen of the freerdp library I don&#39;t have the best\u0026#x000A;impression of it either. It seems remote desktop applications and their\u0026#x000A;protocols are generally a problematic area that justify looking more\u0026#x000A;closely into them.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;544:1-547:52\&quot; dir=\&quot;auto\&quot;\u003eGiven all this there might well linger further issues in the design and\u0026#x000A;implementation of gnome-remote-desktop. Should you decide to improve\u0026#x000A;this codebase in the future, then we would be happy to do a follow-up\u0026#x000A;review, or discuss possible options for improvement.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;549:1-551:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-end-user-experience\&quot; class=\&quot;anchor\&quot; href=\&quot;#end-user-experience\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eEnd User Experience\u003c/h1\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;552:1-558:31\&quot; dir=\&quot;auto\&quot;\u003eThe end user experience of gnome-remote-desktop matches the complexity\u0026#x000A;found in the codebase. Only a few clients proved to be compatible with\u0026#x000A;it, like Remmina and gnome-connections. But even with them I never\u0026#x000A;managed to actually get a visible screen, only black with some random\u0026#x000A;colored pixels sprinkled in, for reasons that I did not investigate\u0026#x000A;fully. What I got was enough to create a connection on network level,\u0026#x000A;for testing the D-Bus security.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;560:1-567:4\&quot; dir=\&quot;auto\&quot;\u003eAn older version of Remmina even crashed with a segmentation fault\u0026#x000A;trying to connect. On openSUSE the H.264 patent encumbered codecs first\u0026#x000A;have to be installed, for being able to connect. Other RDP clients like\u0026#x000A;\u003ccode data-sourcepos=\&quot;563:2-563:9\&quot;\u003erdesktop\u003c/code\u003e and \u003ccode data-sourcepos=\&quot;563:17-563:24\&quot;\u003exfreerdp\u003c/code\u003e do not support the NTLM authentication used in\u0026#x000A;gnome-remote-desktop and fall back to kerberos authentication against a\u0026#x000A;domain controller instead. The NTLM password authentication method,\u0026#x000A;which is based on MD digests, is a security worry on its own, by the\u0026#x000A;way.\u003c/p\u003e\u0026#x000A;\u003ch1 data-sourcepos=\&quot;569:1-571:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-references\&quot; class=\&quot;anchor\&quot; href=\&quot;#references\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eReferences\u003c/h1\u003e\u0026#x000A;\u003cul data-sourcepos=\&quot;576:1-579:96\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;576:1-576:35\&quot;\u003e\u003ca data-sourcepos=\&quot;576:3-576:35\&quot; href=\&quot;/GNOME/gnome-remote-desktop/-/blob/master/1\&quot; class=\&quot;gfm\&quot;\u003egnome remote desktop project\u003c/a\u003e\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;577:1-577:29\&quot;\u003e\u003ca data-sourcepos=\&quot;577:3-577:29\&quot; href=\&quot;/GNOME/gnome-remote-desktop/-/blob/master/2\&quot; class=\&quot;gfm\&quot;\u003eSUSE disclosure policy\u003c/a\u003e\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;578:1-578:58\&quot;\u003e\u0026#x000A;\u003ca data-sourcepos=\&quot;578:3-578:32\&quot; href=\&quot;/GNOME/gnome-remote-desktop/-/blob/master/3\&quot; class=\&quot;gfm\&quot;\u003eoss-security mailing list\u003c/a\u003e[wait_for_grd_priv_key.py]\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;579:1-579:96\&quot;\u003e\u003ca data-sourcepos=\&quot;579:3-579:96\&quot; href=\&quot;/-/project/36/uploads/be254e313215afdfd36c6e633dd5c456/wait_for_grd_priv_key.py\&quot; data-canonical-src=\&quot;/uploads/be254e313215afdfd36c6e633dd5c456/wait_for_grd_priv_key.py\&quot; data-link=\&quot;true\&quot; class=\&quot;gfm\&quot;\u003ewait_for_grd_priv_key.py\u003c/a\u003e\u003c/li\u003e\u0026#x000A;\u003c/ul\u003e&quot;,&quot;initialDescriptionText&quot;:&quot;Hello GNOME security,\n\nthis issue is about the gnome-remote-desktop project [1]. I am a\nmember of the SUSE security team and I have conducted a source code\nreview of gnome-remote-desktop, because a D-Bus system service has been\nadded to it with GNOME version 46. In the course of this review I found\nsecurity issues and collected recommendations that I am reporting to you\nprivately this way. Please find the details below.\n\nCoordinated Disclosure\n======================\n\nWe offer coordinated disclosure based on our disclosure policy [2].\nPlease answer the following questions in this regard:\n\n- Do you want to perform coordinated disclosure? If yes, then please\n  communicate your desired coordinated release date (CRD) for publishing\n  the security issues and any patches/updates. We offer to keep the\n  issues private for up to 90 days (resulting in publication latest on\n  2024-07-18), but prefer to maintain shorter time frames of two to four\n  weeks, if possible.\n\n  If you don&#39;t want to perform coordinated disclosure, then we will\n  publish all information we have on the oss-security mailing list [3]\n  and in our bug tracker right away.\n\n- Do you acknowledge the finding? If so, will you obtain CVE identifiers\n  for the relevant issues? If yes, then please share the CVEs with us\n  once they are assigned. Alternatively we offer to request CVEs from\n  the Mitre organization for you.\n\nDesign Overview\n===============\n\ngnome-remote-desktop offers access to the graphics system either via the\nVNC or the RDP (Microsoft remote desktop) network protocol. Before\nversion 46, gnome-remote-desktop was only used in the context of\nexisting graphical sessions. Starting with version 46, one can also\nconfigure a system daemon, that allows to connect to the GDM display\nmanager, allowing to create new graphical sessions remotely.\n\nThe system daemon runs as a dedicated \&quot;gnome-remote-desktop\&quot; user. It\nprovides a D-Bus interface on the D-Bus system bus. The daemon also\ninteracts with a newly introduced D-Bus interface provided by GDM, to\ncreate remote displays.\n\nReview Motivation and Scope\n===========================\n\nD-Bus system services require a review by the SUSE security team, before\nthey can be added to openSUSE distributions and derived products. With\nthe addition of the system daemon, a review of gnome-remote-desktop has\nbecome necessary, before adding it to openSUSE Tumbleweed in the context\nof the larger GNOME 46 release.\n\nThe review was mainly concerned with the newly introduced system level\ngnome-remote-desktop daemon. The focus was furthermore on the RDP\nprotocol, which is the default and preferred over the VNC protocol.\n\nSince the codebase of gnome-remote-desktop is rather large, I further\ntried to limit the review to the security of the D-Bus methods, the\nPolkit authentication and parts of the network processing. I did not\nlook closely into the freerdp library, which is used by\ngnome-remote-desktop for processing the majority of the RDP protocol.\n\nUnauthorized D-Bus Interfaces (`#1`)\n==================================\n\nOnly the \&quot;/org/gnome/RemoteDesktop/Rdp/Server\&quot; D-Bus interface is\nprotected by Polkit. `auth_admin` authorization is required on this\ninterface for all methods. The other two interfaces \&quot;Dispatcher\&quot; and\n\&quot;Handover\&quot; are not authorized and are accessible to all local users in\nthe system. This leads to a number of local security issues described in\nthe following sub sections.\n\nLocal Private Key Leak (`#1.a`)\n-----------------------------\n\nThe system daemon keeps public SSL certificates and their corresponding\nprivate keys in \&quot;/var/lib/gnome-remote-desktop/.local/share/gnome-remote-desktop/certificates\&quot;.\nAccess to the service&#39;s home directory in \&quot;/var/lib/gnome-remote-desktop\&quot;\nis restricted to the service user \&quot;gnome-remote-desktop\&quot;, mode 0700.\n\nThrough the \&quot;/org/gnome/RemoteDesktop/Rdp/Handovers\&quot; D-Bus interface any\nlocal user can intercept the private SSL key, though. The private key is\nreturned from the `StartHandover` D-Bus function. When a remote desktop\nclient connects to the system daemon, then there is a rather long time\nwindow, during which a local user (even `nobody`) can call this method on\nthe created session object. This is an example call to achieve this:\n\n```\ngdbus call -y -d org.gnome.RemoteDesktop -o /org/gnome/RemoteDesktop/Rdp/Handovers/sessionc11 \\\n    -m org.gnome.RemoteDesktop.Rdp.Handover.StartHandover someuser somepass\n```\n\nThe username and password parameters are not important here, they will\nonly be forwarded to the connecting client. Doing this, as another\neffect, also serves as a DoS, because the proper connection handover\nwill be prevented.\n\nA local attacker does not necessarily have to wait for somebody to\nconnect to the system daemon, it can connect on its own via localhost,\nto achieve the same result. Valid credentials for RDP authentication are\nnecessary to get to the handover stage, however.\n\nThe impact of this problem is a local information leak and local DoS.\nThe information leak means that the integrity and privacy of RDP\nconnections on the system are compromised. Attached to this issue is\nalso a simple Python script that allows to reproduce the issue.\n\nSystem Credentials Leak (`#1.b`)\n------------------------------\n\nIf an RDP connection uses system credentials (see struct member\n`GrdRemoteClient.use_system_credentials`), then a local attacker with\nlow privileges can obtain these credentials in cleartext in a similar\nfashion to issue `#1.a`, by calling the unauthenticated\n`GetSystemCredentials()` D-Bus method of the Handover interface.\n\nUsing these system credentials, the attacker will be able to connect to\nthe display manager via RDP. This should not directly grant access to a\nsession, since a login on display manager level still has to happen. An\nexception would be if things like automatic login are enabled, which I\ndon&#39;t know if they apply to remote connections.\n\nThe Socket Connection can be Obtained via TakeClient() (`#1.c`)\n-------------------------------------------------------------\n\nThe equally unauthenticated D-Bus method `Handover.TakeClient()` allows\nany local user in the system to obtain the file descriptor pertaining to\nthe RDP client that is in handover state. This could allow a local user\nto DoS the RDP connection or to setup a crafted RDP session.\n\nObtaining the socket via this call only works in certain system daemon\nstates, most notably it seems the `StartHandover()` needs to have been\nperformed for this to succeed. I did not fully investigate what the\nexact preconditions are. If the preconditions are not met then this\ncall triggers a series of (non-fatal) assertions, which should also not\nbe reachable this way, I believe:\n\n```\ngnome-remote-de[31380]: g_socket_connection_get_socket: assertion &#39;G_IS_SOCKET_CONNECTION (connection)&#39; failed\ngnome-remote-de[31380]: g_socket_get_fd: assertion &#39;G_IS_SOCKET (socket)&#39; failed\ngnome-remote-de[31380]: g_unix_fd_list_append: assertion &#39;fd \u003e= 0&#39; failed\n```\n\nDispatcher Interface seems Safe\n-------------------------------\n\nThe only method existing in the Dispatcher interface, `RequestHandover`,\nonly succeeds if the caller&#39;s session has a connection waiting for\nhandover. It should be okay that this interface is not authorized in its\ncurrent form, because the sessions are managed by the privileged systemd\ndaemon and cannot be crafted.\n\nSuggested Fix\n-------------\n\nThe Handover D-Bus interface needs to be protected either by Polkit or\nvia D-Bus configuration. If only specific static users need to call\nthese D-Bus methods, then the D-Bus configuration is the correct spot.\n\nThe unauthenticated handover methods seem to be designed to be called by\nthe `--handover` personality of the gnome-remote-desktop daemon, and\nthis instance likely should run as the dynamic session user that\nauthenticates in GDM. If this is correct, then neither D-Bus nor Polkit\noffer the necessary features to restrict access to the D-Bus API to\nexactly this user. A possibility to fix this could be to use the same\napproach as in the Dispatcher interface, to only grant access to a\nclient that originates from the session that has the respective handover\npending.\n\nEven if only a legitimate user has access to the Handover D-Bus API,\nthere are still problems with the API design. Nobody except the\ngnome-remote-desktop system daemon service user should ever have access\nto the private server key and the system credentials. Why these are\npassed into the handover context is not fully clear to me. A larger\nredesign might be necessary to address these overarching issues.\n\nSingle Polkit Action for Everything (`2`)\n========================================\n\nThe bits of the D-Bus interface that are authenticated all use the same\nPolkit action `org.gnome.remotedesktop.configure-system-daemon`. Most of\nthe D-Bus methods are indeed for configuring things. The\n`GetCredentials()` method could be considered different, though.\nFurthermore the `grdctl` utility also uses this action, if it is\nsupposed to act on the system daemon (by passing the `--system` switch).\n\nThe action also implies the right to modify systemd units. This is only\nneeded by `grdctl` to enable or disable the system daemon systemd unit,\nthough. For the D-Bus interface these implied permissions are never\nneeded and are therefore excess privileges most of the time.\n\nSuggested Fix\n-------------\n\nA more fine grained approach with multiple Polkit actions would allow to\navoid these excess privileges and also would allow Admins to better\ncontrol the authentication settings for individual actions. For end\nusers, more fine grained actions would result in better authentication\nmessages, that explain what exactly is about to happen.\n\nImportCertificate D-Bus Method DoS Weaknesses and Overly Complex API (`3#`)\n=========================================================================\n\nThis D-Bus method requires `auth_admin` Polkit authentication, so it is\nnot generally accessible by default. Polkit allows to lower\nauthentication requirements, though. Apart from this, any D-Bus method\nshould be implemented in a robust way. This is not the case for the\n\&quot;ImportCertificate()\&quot; method.\n\nThe method expects two pairs of (filename, file descriptor) both for the\npublic SSL certificate and the private key. Each file descriptor can\nrefer to anything and the D-Bus service simply copies the data from the\nfile descriptor to a file beneath \&quot;/var/lib/gnome-remote-desktop\&quot;. If a\ncaller passes a file descriptor for \&quot;/dev/zero\&quot;, then the service will\nfill up the file system.\n\nSince the call allows to specify a custom filename, the service needs to\nworry about problematic paths containing path components like \&quot;/\&quot; and\n\&quot;..\&quot;. It succeeds mostly with this, but there is still an error\ncondition that can be triggered by passing \&quot;.\&quot; as a path. The service\nwill then try to open the path\n\&quot;/var/lib/gnome-remote-desktop/.local/share/gnome-remote-desktop/certificates\&quot;\nas a file, which results in an EISDIR error. This has no security\nrelevance, but is still kind of unexpected behaviour.\n\nSupporting custom filenames also means that an infinite amount of files\ncan be placed in the certificates directory, including hidden files or\nfiles containing unexpected characters like wildcards, binary data,\nfiles starting with \&quot;--\&quot; (possibly injecting command line options) etc.\nThis approach also add the burden of managing the lifetime of multiple\ninstalled certificates, but this doesn&#39;t even happen. Files are never\nremoved again from the certificates directory. Even more so, if an\nexisting filename is to be overwritten, then backups of the old files\nare created. But I don&#39;t think any admin will be aware of that fact,\neven if a certificate would be accidentally overwritten.\n\nFurthermore, if the function cannot fully complete the request (e.g.\nwriting the certificate succeeded, but writing the private key failed),\nthen the partially imported data is not removed again. The function can\nalso be tricked into generating an invalid configuration by specifying\nthe same filename for both certificate and key. Only the private key\nwill then remain under this name, but gnome-remote-desktop will try to\nuse the same path also for the certificate.\n\nSuggested Fix\n-------------\n\nAllowing custom filenames in this API just adds complexity that seems\nnot to offer much in return. If admins want to manage multiple sets of\ncertificates, then they can do this in their own context. Only one set\nof certificate and key will ever be active in the system daemon anyway.\nSo I would simply drop the filename support and use a fixed name for\nboth certificate and private key.\n\nThe file descriptor passed here should be checked for its type (via\n`fstat()`) and be rejected if it is not a regular file. Then a maximum\nfile size should be enforced to prevent the file system space being\ndepleted. No certificate / key combination should be larger than a few\nkilobytes. Once the file type is restricted to regular files, there\nshould also be no big risk of reads on the file descriptor to be\nblocking. For full security coverage one could also add a timeout\nhandling, to make sure the call completes withing a reasonable amount of\ntime.\n\ncredentials.ini is Created World-Readable (`#4`)\n==============================================\n\nThe file\n\&quot;/var/lib/gnome-remote-desktop/.local/share/gnome-remote-desktop/credentials.ini\&quot;,\nwhich contains the cleartext authentication credentials, is saved with\nthe world readable bit set. This happens in function\n`grd_credentials_file_new()`. This is not a problem in the context of\nthe system daemon, since its home directory, \&quot;/var/lib/gnome-remote-desktop\&quot;,\nhas mode 0700. Still the file itself should get proper protection bits.\nThis is also inconsistent with respect to the certificate and private\nkey, which do have mode 0700, in contrast.\n\nSuggested Fix\n-------------\n\nFixing this should be straight forward simply by applying the proper\n0600 permissions to the file when creating it.\n\nThe system service can be started by anybody in the system (`#5`)\n===============================================================\n\nIndependently of the enable/disable and start/stop status of the\ngnome-remote-desktop systemd service, the system daemon can be started\nby anybody in the system via the D-Bus autostart logic configured in\n\&quot;/usr/share/dbus-1/system-services/org.gnome.RemoteDesktop.service\&quot;.\nIntrospecting the service on D-Bus level is enough to trigger the start\nof the service.\n\nIf the service has already been configured once by an admin, then this\nmeans that the system service will even go live, listening on the\nnetwork. Only the default firewall settings might prevent it becoming\nactually accessible on the network.\n\nSuggested Fix\n-------------\n\nFor a sensitive network service such as this I would consider not to\nconfigure the D-Bus autostart, but to require an explicit admin decision\nto start or enable the service on systemd level.\n\n`find_cr_lf()` Suffers from a one Byte Overread (`#6`)\n====================================================\n\nThis function processes untrusted pre-authentication RDP protocol\nnetwork data (the routing token) and looks for a terminating \\r\\n\nsequence. The size calculation in the function&#39;s for loop is wrong: If\nthe final byte of the buffer is 0x0D, then the logic will access the\nnext byte out of bounds. This buffer is not non-null terminated.\n\nThe impact should be negligible in most cases, but the issue should\nstill be addressed. This is the output of Valgrind I obtained after\nsending a crafted packet to the daemon:\n\n```\n==31119== Invalid read of size 1\n==31119==    at 0x15A1EF: UnknownInlinedFun (grd-rdp-routing-token.c:65)\n==31119==    by 0x15A1EF: UnknownInlinedFun (grd-rdp-routing-token.c:159)\n==31119==    by 0x15A1EF: UnknownInlinedFun (grd-rdp-routing-token.c:239)\n==31119==    by 0x15A1EF: peek_routing_token_in_thread\n(grd-rdp-routing-token.c:281)\n\u003csnip\u003e\n```\n\nSuggested Fix\n-------------\n\nThe fix should be straight forward by correcting the maximum search\nindex for the terminator.\n\n\n`grd_rdp_sam_create_sam_file()` Uses a Racy System Call Sequence to Remove the `O_CLOEXEC` flag (`#7`)\n====================================================================================================\n\nThis function creates a temporary file using `mkstemp()`. In a second\nstep the `O_CLOEXEC` flag is removed from the resulting file descriptor\nvia `fcntl()`. If another thread calls `execve()` during this time\nwindow, then this file descriptor will be inherited to other processes\nunintentionally.\n\nSuggested Fix\n-------------\n\nOn a number of systems, including Linux with glibc, `mkostemp()` can be\nused to get a file descriptor with `O_CLOEXEC` set right away, to avoid\nthis race condition.\n\n`on_incoming_redirected_connection()` Outputs Untrusted String via `g_debug()` (`#8`)\n===================================================================================\n\nThe `routing_token_str` is data obtained from an untrusted RDP client\nbefore authentication is performed. This is the same data that is\nprocessed by `find_cr_lf()` mentioned in item `#7`. Luckily the network\nprotocol parsing code in `peek_routing_token()` at least ensures that\nthis string is always null terminated, otherwise this would allow for an\narbitrary unauthenticated remote DoS against the RDP daemon. `g_debug()`\ngenerates the string to be logged, even if the log level DEBUG is not\nactive. Thus formatting errors will always trigger, independently of the\nlogging configuration.\n\nIf the DEBUG log level is active, then the output of the untrusted data\nallows an unauthenticated remote attacker to perform log spoofing. The\nstring can be roughly 200 bytes long (limited by the protocol headers)\nand can contain arbitrary data (except for the \&quot;\\r\\n\&quot; terminator\nsequence). Thus it can also contain terminal control characters that\nallow to overwrite previous log lines, or to create a larger number of\nseemingly authentic log lines.\n\nThe function later on converts the untrusted data into an unsigned long\ninteger. The resulting integer is only used for looking up an existing\nRDP session. Therefore no further attack surface via crafted data should\nexist.\n\nSuggested Fix\n-------------\n\nThe output of the untrusted data should either be removed completely, or\nthe routing token should be verified both in content and length, to\nprevent unexpected things happening on output.\n\n`grdctl` Utility Accepts Cleartext Password on the Command Line (`#9`)\n====================================================================\n\nThe text based `grdctl` configuration utility which is used for both,\nsystem and session context RDP setups, accepts cleartext passwords in\nthe following invocation styles:\n\n```\ngrdctl [--system] rdp set-credentials \u003cusername\u003e \u003cpassword\u003e\ngrdctl [--system] vnc set-password \u003cusername\u003e \u003cpassword\u003e\n```\n\nThis means that the cleartext password will leak via the /proc file\nsystem and will be visible in the process task list via `ps`, when\nconfigured this way. Other users can thus get access to the\nauthentication data.\n\nSuggested Fix\n-------------\n\nPasswords should either be queried from stdin, passed in files or via\nenvironment variables to prevent such kinds of local information leaks.\n\nVNC by Default does not Authenticate, but Only Prompts for Accept/Deny (`#10`)\n============================================================================\n\nVNC is hidden away from the graphical user interface by now, but by\nusing `grdctl` it can still be enabled. I tested this only in session\ncontext, not in the system daemon context, since I did not manage to\nenable VNC for the system daemon using `grdctl`.\n\nThe default for the VNC protocol is to prompt only, when a client\nconnects, and to limit access to view-only (no control over input\ndevices). The resulting process is that, on the server side, the user is\npresented with a popup dialog like \&quot;Host \u003csome-ip\u003e wants to access your\nscreen. Allow/Deny?\&quot;.  This workflow offers no client verification at\nall, in particular a man-in-the-middle attack or source IP spoofing can\nhappen.\n\nThe VNC protocol is not a secure protocol by default, but this\nprompt-only approach in gnome-remote-desktop removes all chances of\nsecurity, by design.\n\nSuggested Fix\n-------------\n\nIf proper trust cannot be established via the VNC protocol, then a\nprompt-only mode should not be offered, and password authentication made\nmandatory.\n\nMiscellaneous\n=============\n\nFollowing are various bits that I observed while digging through the\ncodebase that I find worth mentioning.\n\n- The D-Bus method \&quot;Rdp.Server.GetCredentials()\&quot; allows to get the\n  cleartext credentials for the system daemon (after Polkit admin\n  authentication). Passing cleartext passwords around this way, even\n  after authorization, should be well considered and it is unclear what\n  the purpose of this is.\n\n- `create_sam_string()` contains a questionable array size calculation:\n\n       sam_string = g_malloc0 ((username_length + 3 + 32 + 3 + 1 + 1) * sizeof (char));\n\n   There is no documentation what this is about. The freerdp library\n   function `NTOWFv1A()` that is called in this function, receives a\n   buffer `nt_hash`, without knowing about the available buffer space.\n   It seems this is \&quot;by contract\&quot;, but pretty dangerous. Furthermore the\n   return value of the function is not checked by `create_sam_string()`.\n   This and a few other looks into the freerdp library raise questions\n   about its code and API quality.\n\n   I suggest to add comments about the purpose of this and to evaluate\n   the return code of the library function.\n\n- The `start_rdp_server_when_ready()` function has a very strange semantic:\n\n      start_rdp_server_when_ready (GrdDaemon *daemon, gboolean should_start_when_ready)\n\n  Basically this says `start_when_ready(or_dont)`. I believe this is the\n  result of some unfortunate naming of the function that has a different\n  purpose than what it sounds at first.\n\n  I suggest to rename this to something more fitting.\n\n- The `peek_routing_token_in_thread()` function parses the RDP protocol\n  outside of the freerdp library, to extract the routing token. This is\n  pretty complex and dangerous code. Especially bad is that the\n  extracted untrusted routing token is passed through the codebase via\n  various indirections (callbacks, signals). The boundary where trusted\n  and untrusted data is processed is not well established.\n\n  The untrusted data should be clearly marked and ideally all code that\n  deals with it should be grouped in a dedicated compilation unit that\n  only deals with untrusted data like this.\n\n- A renderer thread with an optional NVidia CUDA context is setup for\n  every connecting client, without even having authorized the client.\n  Also a layout manager thread is created. Overall this accounts for\n  some five threads for each unauthenticated session. Luckily the daemon\n  does not perform parallel incoming connection processing, otherwise\n  this would pose a simple remote DoS amplification vector. Still I\n  wonder if it is a good idea to start so many threads, a renderer and\n  hardware acceleration before a client is even authorized for anything.\n\n  I suggest to only acquire heavy resources after a client successfully\n  authenticated.\n\nCVE Assignments\n===============\n\nItems `#1.a` through `#1.c` are CVE relevant. A single CVE could be issued\ngrouping these as \&quot;unauthenticated D-Bus API\&quot; issues. Item `#9` also\njustifies a CVE since this is a very tangible local information leak.\n\nWhile they formally would qualify for a CVE, I would not assign any for\nitems `#6` and `#8`, because their impact is negligible in default\nconfigurations.\n\nRegarding the fixes for the reported issues we are available to review\nthem, before publication, if you intend to perform coordinated disclosure.\n\nReview Summary\n==============\n\nEven considering the concrete findings from this report fixed, my trust\ninto the gnome-remote-desktop codebase is low. The current design for\nthe handover feels too complex. Implementation wise I don&#39;t see why a\nsensitive network service is still developed with C89 level code these\ndays anymore. The codebase is really hard to follow and has nearly no\ncomments or documentation. Function names like these don&#39;t help either:\n\n    grd_rdp_network_autodetection_get_bw_measure_stop_event_handle()\n\nThe only thing that reduces the burden a bit are the automatic memory\nmanagement helpers like `g_autofree`. gnome-remote-desktop consists of\n40,000 lines of C code though, and this doesn&#39;t even include the actual\nparsing of the protocol. The gobject model with its many indirections and\nthe specific coding style found in this project represents a high bar\nfor a third party to comprehend what is going on.\n\nAs already mentioned above, there is no clear separation of trusted and\nuntrusted data. In the system daemon context there are at least four\ndifferent security domains: The GDM domain, the gnome-remote-desktop\ndomain, untrusted remote data from unauthenticated clients and finally\ntrusted remote data from authenticated clients. Without documentation\nand a clear program structure that clearly separate these security\ndomains, errors can easily slip in.\n\nFrom what I have seen of the freerdp library I don&#39;t have the best\nimpression of it either. It seems remote desktop applications and their\nprotocols are generally a problematic area that justify looking more\nclosely into them.\n\nGiven all this there might well linger further issues in the design and\nimplementation of gnome-remote-desktop. Should you decide to improve\nthis codebase in the future, then we would be happy to do a follow-up\nreview, or discuss possible options for improvement.\n\nEnd User Experience\n===================\n\nThe end user experience of gnome-remote-desktop matches the complexity\nfound in the codebase. Only a few clients proved to be compatible with\nit, like Remmina and gnome-connections. But even with them I never\nmanaged to actually get a visible screen, only black with some random\ncolored pixels sprinkled in, for reasons that I did not investigate\nfully. What I got was enough to create a connection on network level,\nfor testing the D-Bus security.\n\nAn older version of Remmina even crashed with a segmentation fault\ntrying to connect. On openSUSE the H.264 patent encumbered codecs first\nhave to be installed, for being able to connect. Other RDP clients like\n`rdesktop` and `xfreerdp` do not support the NTLM authentication used in\ngnome-remote-desktop and fall back to kerberos authentication against a\ndomain controller instead. The NTLM password authentication method,\nwhich is based on MD digests, is a security worry on its own, by the\nway.\n\nReferences\n==========\n\n[1]: https://gitlab.gnome.org/GNOME/gnome-remote-desktop\n[2]: https://en.opensuse.org/openSUSE:Security_disclosure_policy\n[3]: https://www.openwall.com/lists/oss-security\n\n- [gnome remote desktop project](1)\n- [SUSE disclosure policy](2)\n- [oss-security mailing list](3)[wait_for_grd_priv_key.py]\n- [wait_for_grd_priv_key.py](/uploads/be254e313215afdfd36c6e633dd5c456/wait_for_grd_priv_key.py)&quot;,&quot;initialTaskCompletionStatus&quot;:{&quot;count&quot;:0,&quot;completed_count&quot;:0},&quot;canCreateIncident&quot;:false,&quot;fullPath&quot;:&quot;GNOME/gnome-remote-desktop&quot;,&quot;iid&quot;:196,&quot;issuableId&quot;:198832,&quot;issueType&quot;:&quot;issue&quot;,&quot;isHidden&quot;:false,&quot;zoomMeetingUrl&quot;:null,&quot;authorId&quot;:20088,&quot;authorName&quot;:&quot;Matthias Gerstner&quot;,&quot;authorUsername&quot;:&quot;mgerstner&quot;,&quot;authorWebUrl&quot;:&quot;/mgerstner&quot;,&quot;createdAt&quot;:&quot;2024-04-19T13:48:56+00:00&quot;,&quot;isFirstContribution&quot;:false,&quot;serviceDeskReplyTo&quot;:null,&quot;registerPath&quot;:&quot;/users/sign_up?redirect_to_referer=yes&quot;,&quot;signInPath&quot;:&quot;/users/sign_in?redirect_to_referer=yes&quot;,&quot;projectPath&quot;:&quot;gnome-remote-desktop&quot;,&quot;projectId&quot;:36,&quot;projectNamespace&quot;:&quot;GNOME&quot;,&quot;updatedAt&quot;:&quot;2024-04-19T13:55:44+00:00&quot;,&quot;updatedBy&quot;:{&quot;name&quot;:&quot;Jordan Petridis&quot;,&quot;path&quot;:&quot;/alatiera&quot;}}" id="js-issuable-app">
<div class="title-container">
<h1 class="gl-heading-1 !gl-m-0">gnome-remote-desktop: multiple security issues and recommendations</h1>
</div>
<div class="description">
<div class="md"><p data-sourcepos="1:1-1:21" dir="auto">Hello GNOME security,</p>&#x000A;<p data-sourcepos="3:1-8:50" dir="auto">this issue is about the gnome-remote-desktop project <a data-sourcepos="3:54-3:56" href="https://gitlab.gnome.org/GNOME/gnome-remote-desktop">1</a>. I am a&#x000A;member of the SUSE security team and I have conducted a source code&#x000A;review of gnome-remote-desktop, because a D-Bus system service has been&#x000A;added to it with GNOME version 46. In the course of this review I found&#x000A;security issues and collected recommendations that I am reporting to you&#x000A;privately this way. Please find the details below.</p>&#x000A;<h1 data-sourcepos="10:1-12:0" dir="auto">&#x000A;<a id="user-content-coordinated-disclosure" class="anchor" href="#coordinated-disclosure" aria-hidden="true"></a>Coordinated Disclosure</h1>&#x000A;<p data-sourcepos="13:1-14:53" dir="auto">We offer coordinated disclosure based on our disclosure policy <a data-sourcepos="13:64-13:66" href="https://en.opensuse.org/openSUSE:Security_disclosure_policy" rel="nofollow noreferrer noopener" target="_blank">2</a>.&#x000A;Please answer the following questions in this regard:</p>&#x000A;<ul data-sourcepos="16:1-31:0" dir="auto">&#x000A;<li data-sourcepos="16:1-26:0">&#x000A;<p data-sourcepos="16:3-21:21">Do you want to perform coordinated disclosure? If yes, then please&#x000A;communicate your desired coordinated release date (CRD) for publishing&#x000A;the security issues and any patches/updates. We offer to keep the&#x000A;issues private for up to 90 days (resulting in publication latest on&#x000A;2024-07-18), but prefer to maintain shorter time frames of two to four&#x000A;weeks, if possible.</p>&#x000A;<p data-sourcepos="23:3-25:36">If you don't want to perform coordinated disclosure, then we will&#x000A;publish all information we have on the oss-security mailing list <a data-sourcepos="24:68-24:70" href="https://www.openwall.com/lists/oss-security" rel="nofollow noreferrer noopener" target="_blank">3</a>&#x000A;and in our bug tracker right away.</p>&#x000A;</li>&#x000A;<li data-sourcepos="27:1-31:0">&#x000A;<p data-sourcepos="27:3-30:33">Do you acknowledge the finding? If so, will you obtain CVE identifiers&#x000A;for the relevant issues? If yes, then please share the CVEs with us&#x000A;once they are assigned. Alternatively we offer to request CVEs from&#x000A;the Mitre organization for you.</p>&#x000A;</li>&#x000A;</ul>&#x000A;<h1 data-sourcepos="32:1-34:0" dir="auto">&#x000A;<a id="user-content-design-overview" class="anchor" href="#design-overview" aria-hidden="true"></a>Design Overview</h1>&#x000A;<p data-sourcepos="35:1-40:60" dir="auto">gnome-remote-desktop offers access to the graphics system either via the&#x000A;VNC or the RDP (Microsoft remote desktop) network protocol. Before&#x000A;version 46, gnome-remote-desktop was only used in the context of&#x000A;existing graphical sessions. Starting with version 46, one can also&#x000A;configure a system daemon, that allows to connect to the GDM display&#x000A;manager, allowing to create new graphical sessions remotely.</p>&#x000A;<p data-sourcepos="42:1-45:23" dir="auto">The system daemon runs as a dedicated "gnome-remote-desktop" user. It&#x000A;provides a D-Bus interface on the D-Bus system bus. The daemon also&#x000A;interacts with a newly introduced D-Bus interface provided by GDM, to&#x000A;create remote displays.</p>&#x000A;<h1 data-sourcepos="47:1-49:0" dir="auto">&#x000A;<a id="user-content-review-motivation-and-scope" class="anchor" href="#review-motivation-and-scope" aria-hidden="true"></a>Review Motivation and Scope</h1>&#x000A;<p data-sourcepos="50:1-54:31" dir="auto">D-Bus system services require a review by the SUSE security team, before&#x000A;they can be added to openSUSE distributions and derived products. With&#x000A;the addition of the system daemon, a review of gnome-remote-desktop has&#x000A;become necessary, before adding it to openSUSE Tumbleweed in the context&#x000A;of the larger GNOME 46 release.</p>&#x000A;<p data-sourcepos="56:1-58:67" dir="auto">The review was mainly concerned with the newly introduced system level&#x000A;gnome-remote-desktop daemon. The focus was furthermore on the RDP&#x000A;protocol, which is the default and preferred over the VNC protocol.</p>&#x000A;<p data-sourcepos="60:1-64:69" dir="auto">Since the codebase of gnome-remote-desktop is rather large, I further&#x000A;tried to limit the review to the security of the D-Bus methods, the&#x000A;Polkit authentication and parts of the network processing. I did not&#x000A;look closely into the freerdp library, which is used by&#x000A;gnome-remote-desktop for processing the majority of the RDP protocol.</p>&#x000A;<h1 data-sourcepos="66:1-68:0" dir="auto">&#x000A;<a id="user-content-unauthorized-d-bus-interfaces-1" class="anchor" href="#unauthorized-d-bus-interfaces-1" aria-hidden="true"></a>Unauthorized D-Bus Interfaces (<code data-sourcepos="66:33-66:34">#1</code>)</h1>&#x000A;<p data-sourcepos="69:1-74:27" dir="auto">Only the "/org/gnome/RemoteDesktop/Rdp/Server" D-Bus interface is&#x000A;protected by Polkit. <code data-sourcepos="70:23-70:32">auth_admin</code> authorization is required on this&#x000A;interface for all methods. The other two interfaces "Dispatcher" and&#x000A;"Handover" are not authorized and are accessible to all local users in&#x000A;the system. This leads to a number of local security issues described in&#x000A;the following sub sections.</p>&#x000A;<h2 data-sourcepos="76:1-78:0" dir="auto">&#x000A;<a id="user-content-local-private-key-leak-1a" class="anchor" href="#local-private-key-leak-1a" aria-hidden="true"></a>Local Private Key Leak (<code data-sourcepos="76:26-76:29">#1.a</code>)</h2>&#x000A;<p data-sourcepos="79:1-82:68" dir="auto">The system daemon keeps public SSL certificates and their corresponding&#x000A;private keys in "/var/lib/gnome-remote-desktop/.local/share/gnome-remote-desktop/certificates".&#x000A;Access to the service's home directory in "/var/lib/gnome-remote-desktop"&#x000A;is restricted to the service user "gnome-remote-desktop", mode 0700.</p>&#x000A;<p data-sourcepos="84:1-89:68" dir="auto">Through the "/org/gnome/RemoteDesktop/Rdp/Handovers" D-Bus interface any&#x000A;local user can intercept the private SSL key, though. The private key is&#x000A;returned from the <code data-sourcepos="86:20-86:32">StartHandover</code> D-Bus function. When a remote desktop&#x000A;client connects to the system daemon, then there is a rather long time&#x000A;window, during which a local user (even <code data-sourcepos="88:42-88:47">nobody</code>) can call this method on&#x000A;the created session object. This is an example call to achieve this:</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="91:1-94:3" class="code highlight js-syntax-highlight language-plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">gdbus call -y -d org.gnome.RemoteDesktop -o /org/gnome/RemoteDesktop/Rdp/Handovers/sessionc11 \</span>&#x000A;<span id="LC2" class="line" lang="plaintext">    -m org.gnome.RemoteDesktop.Rdp.Handover.StartHandover someuser somepass</span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<p data-sourcepos="96:1-99:18" dir="auto">The username and password parameters are not important here, they will&#x000A;only be forwarded to the connecting client. Doing this, as another&#x000A;effect, also serves as a DoS, because the proper connection handover&#x000A;will be prevented.</p>&#x000A;<p data-sourcepos="101:1-104:48" dir="auto">A local attacker does not necessarily have to wait for somebody to&#x000A;connect to the system daemon, it can connect on its own via localhost,&#x000A;to achieve the same result. Valid credentials for RDP authentication are&#x000A;necessary to get to the handover stage, however.</p>&#x000A;<p data-sourcepos="106:1-109:63" dir="auto">The impact of this problem is a local information leak and local DoS.&#x000A;The information leak means that the integrity and privacy of RDP&#x000A;connections on the system are compromised. Attached to this issue is&#x000A;also a simple Python script that allows to reproduce the issue.</p>&#x000A;<h2 data-sourcepos="111:1-113:0" dir="auto">&#x000A;<a id="user-content-system-credentials-leak-1b" class="anchor" href="#system-credentials-leak-1b" aria-hidden="true"></a>System Credentials Leak (<code data-sourcepos="111:27-111:30">#1.b</code>)</h2>&#x000A;<p data-sourcepos="114:1-118:64" dir="auto">If an RDP connection uses system credentials (see struct member&#x000A;<code data-sourcepos="115:2-115:39">GrdRemoteClient.use_system_credentials</code>), then a local attacker with&#x000A;low privileges can obtain these credentials in cleartext in a similar&#x000A;fashion to issue <code data-sourcepos="117:19-117:22">#1.a</code>, by calling the unauthenticated&#x000A;<code data-sourcepos="118:2-118:23">GetSystemCredentials()</code> D-Bus method of the Handover interface.</p>&#x000A;<p data-sourcepos="120:1-124:47" dir="auto">Using these system credentials, the attacker will be able to connect to&#x000A;the display manager via RDP. This should not directly grant access to a&#x000A;session, since a login on display manager level still has to happen. An&#x000A;exception would be if things like automatic login are enabled, which I&#x000A;don't know if they apply to remote connections.</p>&#x000A;<h2 data-sourcepos="126:1-128:0" dir="auto">&#x000A;<a id="user-content-the-socket-connection-can-be-obtained-via-takeclient-1c" class="anchor" href="#the-socket-connection-can-be-obtained-via-takeclient-1c" aria-hidden="true"></a>The Socket Connection can be Obtained via TakeClient() (<code data-sourcepos="126:58-126:61">#1.c</code>)</h2>&#x000A;<p data-sourcepos="129:1-132:60" dir="auto">The equally unauthenticated D-Bus method <code data-sourcepos="129:43-129:63">Handover.TakeClient()</code> allows&#x000A;any local user in the system to obtain the file descriptor pertaining to&#x000A;the RDP client that is in handover state. This could allow a local user&#x000A;to DoS the RDP connection or to setup a crafted RDP session.</p>&#x000A;<p data-sourcepos="134:1-139:33" dir="auto">Obtaining the socket via this call only works in certain system daemon&#x000A;states, most notably it seems the <code data-sourcepos="135:36-135:50">StartHandover()</code> needs to have been&#x000A;performed for this to succeed. I did not fully investigate what the&#x000A;exact preconditions are. If the preconditions are not met then this&#x000A;call triggers a series of (non-fatal) assertions, which should also not&#x000A;be reachable this way, I believe:</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="141:1-145:3" class="code highlight js-syntax-highlight language-plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">gnome-remote-de[31380]: g_socket_connection_get_socket: assertion 'G_IS_SOCKET_CONNECTION (connection)' failed</span>&#x000A;<span id="LC2" class="line" lang="plaintext">gnome-remote-de[31380]: g_socket_get_fd: assertion 'G_IS_SOCKET (socket)' failed</span>&#x000A;<span id="LC3" class="line" lang="plaintext">gnome-remote-de[31380]: g_unix_fd_list_append: assertion 'fd &gt;= 0' failed</span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<h2 data-sourcepos="147:1-149:0" dir="auto">&#x000A;<a id="user-content-dispatcher-interface-seems-safe" class="anchor" href="#dispatcher-interface-seems-safe" aria-hidden="true"></a>Dispatcher Interface seems Safe</h2>&#x000A;<p data-sourcepos="150:1-154:29" dir="auto">The only method existing in the Dispatcher interface, <code data-sourcepos="150:56-150:70">RequestHandover</code>,&#x000A;only succeeds if the caller's session has a connection waiting for&#x000A;handover. It should be okay that this interface is not authorized in its&#x000A;current form, because the sessions are managed by the privileged systemd&#x000A;daemon and cannot be crafted.</p>&#x000A;<h2 data-sourcepos="156:1-158:0" dir="auto">&#x000A;<a id="user-content-suggested-fix" class="anchor" href="#suggested-fix" aria-hidden="true"></a>Suggested Fix</h2>&#x000A;<p data-sourcepos="159:1-161:70" dir="auto">The Handover D-Bus interface needs to be protected either by Polkit or&#x000A;via D-Bus configuration. If only specific static users need to call&#x000A;these D-Bus methods, then the D-Bus configuration is the correct spot.</p>&#x000A;<p data-sourcepos="163:1-171:8" dir="auto">The unauthenticated handover methods seem to be designed to be called by&#x000A;the <code data-sourcepos="164:6-164:15">--handover</code> personality of the gnome-remote-desktop daemon, and&#x000A;this instance likely should run as the dynamic session user that&#x000A;authenticates in GDM. If this is correct, then neither D-Bus nor Polkit&#x000A;offer the necessary features to restrict access to the D-Bus API to&#x000A;exactly this user. A possibility to fix this could be to use the same&#x000A;approach as in the Dispatcher interface, to only grant access to a&#x000A;client that originates from the session that has the respective handover&#x000A;pending.</p>&#x000A;<p data-sourcepos="173:1-178:64" dir="auto">Even if only a legitimate user has access to the Handover D-Bus API,&#x000A;there are still problems with the API design. Nobody except the&#x000A;gnome-remote-desktop system daemon service user should ever have access&#x000A;to the private server key and the system credentials. Why these are&#x000A;passed into the handover context is not fully clear to me. A larger&#x000A;redesign might be necessary to address these overarching issues.</p>&#x000A;<h1 data-sourcepos="180:1-182:0" dir="auto">&#x000A;<a id="user-content-single-polkit-action-for-everything-2" class="anchor" href="#single-polkit-action-for-everything-2" aria-hidden="true"></a>Single Polkit Action for Everything (<code data-sourcepos="180:39-180:39">2</code>)</h1>&#x000A;<p data-sourcepos="183:1-188:72" dir="auto">The bits of the D-Bus interface that are authenticated all use the same&#x000A;Polkit action <code data-sourcepos="184:16-184:62">org.gnome.remotedesktop.configure-system-daemon</code>. Most of&#x000A;the D-Bus methods are indeed for configuring things. The&#x000A;<code data-sourcepos="186:2-186:17">GetCredentials()</code> method could be considered different, though.&#x000A;Furthermore the <code data-sourcepos="187:18-187:23">grdctl</code> utility also uses this action, if it is&#x000A;supposed to act on the system daemon (by passing the <code data-sourcepos="188:55-188:62">--system</code> switch).</p>&#x000A;<p data-sourcepos="190:1-193:60" dir="auto">The action also implies the right to modify systemd units. This is only&#x000A;needed by <code data-sourcepos="191:12-191:17">grdctl</code> to enable or disable the system daemon systemd unit,&#x000A;though. For the D-Bus interface these implied permissions are never&#x000A;needed and are therefore excess privileges most of the time.</p>&#x000A;<h2 data-sourcepos="195:1-197:0" dir="auto">&#x000A;<a id="user-content-suggested-fix-1" class="anchor" href="#suggested-fix-1" aria-hidden="true"></a>Suggested Fix</h2>&#x000A;<p data-sourcepos="198:1-202:55" dir="auto">A more fine grained approach with multiple Polkit actions would allow to&#x000A;avoid these excess privileges and also would allow Admins to better&#x000A;control the authentication settings for individual actions. For end&#x000A;users, more fine grained actions would result in better authentication&#x000A;messages, that explain what exactly is about to happen.</p>&#x000A;<h1 data-sourcepos="204:1-206:0" dir="auto">&#x000A;<a id="user-content-importcertificate-d-bus-method-dos-weaknesses-and-overly-complex-api-3" class="anchor" href="#importcertificate-d-bus-method-dos-weaknesses-and-overly-complex-api-3" aria-hidden="true"></a>ImportCertificate D-Bus Method DoS Weaknesses and Overly Complex API (<code data-sourcepos="204:72-204:73">3#</code>)</h1>&#x000A;<p data-sourcepos="207:1-211:29" dir="auto">This D-Bus method requires <code data-sourcepos="207:29-207:38">auth_admin</code> Polkit authentication, so it is&#x000A;not generally accessible by default. Polkit allows to lower&#x000A;authentication requirements, though. Apart from this, any D-Bus method&#x000A;should be implemented in a robust way. This is not the case for the&#x000A;"ImportCertificate()" method.</p>&#x000A;<p data-sourcepos="213:1-218:24" dir="auto">The method expects two pairs of (filename, file descriptor) both for the&#x000A;public SSL certificate and the private key. Each file descriptor can&#x000A;refer to anything and the D-Bus service simply copies the data from the&#x000A;file descriptor to a file beneath "/var/lib/gnome-remote-desktop". If a&#x000A;caller passes a file descriptor for "/dev/zero", then the service will&#x000A;fill up the file system.</p>&#x000A;<p data-sourcepos="220:1-227:53" dir="auto">Since the call allows to specify a custom filename, the service needs to&#x000A;worry about problematic paths containing path components like "/" and&#x000A;"..". It succeeds mostly with this, but there is still an error&#x000A;condition that can be triggered by passing "." as a path. The service&#x000A;will then try to open the path&#x000A;"/var/lib/gnome-remote-desktop/.local/share/gnome-remote-desktop/certificates"&#x000A;as a file, which results in an EISDIR error. This has no security&#x000A;relevance, but is still kind of unexpected behaviour.</p>&#x000A;<p data-sourcepos="229:1-238:56" dir="auto">Supporting custom filenames also means that an infinite amount of files&#x000A;can be placed in the certificates directory, including hidden files or&#x000A;files containing unexpected characters like wildcards, binary data,&#x000A;files starting with "--" (possibly injecting command line options) etc.&#x000A;This approach also add the burden of managing the lifetime of multiple&#x000A;installed certificates, but this doesn't even happen. Files are never&#x000A;removed again from the certificates directory. Even more so, if an&#x000A;existing filename is to be overwritten, then backups of the old files&#x000A;are created. But I don't think any admin will be aware of that fact,&#x000A;even if a certificate would be accidentally overwritten.</p>&#x000A;<p data-sourcepos="240:1-246:43" dir="auto">Furthermore, if the function cannot fully complete the request (e.g.&#x000A;writing the certificate succeeded, but writing the private key failed),&#x000A;then the partially imported data is not removed again. The function can&#x000A;also be tricked into generating an invalid configuration by specifying&#x000A;the same filename for both certificate and key. Only the private key&#x000A;will then remain under this name, but gnome-remote-desktop will try to&#x000A;use the same path also for the certificate.</p>&#x000A;<h2 data-sourcepos="248:1-250:0" dir="auto">&#x000A;<a id="user-content-suggested-fix-2" class="anchor" href="#suggested-fix-2" aria-hidden="true"></a>Suggested Fix</h2>&#x000A;<p data-sourcepos="251:1-256:33" dir="auto">Allowing custom filenames in this API just adds complexity that seems&#x000A;not to offer much in return. If admins want to manage multiple sets of&#x000A;certificates, then they can do this in their own context. Only one set&#x000A;of certificate and key will ever be active in the system daemon anyway.&#x000A;So I would simply drop the filename support and use a fixed name for&#x000A;both certificate and private key.</p>&#x000A;<p data-sourcepos="258:1-266:5" dir="auto">The file descriptor passed here should be checked for its type (via&#x000A;<code data-sourcepos="259:2-259:8">fstat()</code>) and be rejected if it is not a regular file. Then a maximum&#x000A;file size should be enforced to prevent the file system space being&#x000A;depleted. No certificate / key combination should be larger than a few&#x000A;kilobytes. Once the file type is restricted to regular files, there&#x000A;should also be no big risk of reads on the file descriptor to be&#x000A;blocking. For full security coverage one could also add a timeout&#x000A;handling, to make sure the call completes withing a reasonable amount of&#x000A;time.</p>&#x000A;<h1 data-sourcepos="268:1-270:0" dir="auto">&#x000A;<a id="user-content-credentialsini-is-created-world-readable-4" class="anchor" href="#credentialsini-is-created-world-readable-4" aria-hidden="true"></a>credentials.ini is Created World-Readable (<code data-sourcepos="268:45-268:46">#4</code>)</h1>&#x000A;<p data-sourcepos="271:1-279:42" dir="auto">The file&#x000A;"/var/lib/gnome-remote-desktop/.local/share/gnome-remote-desktop/credentials.ini",&#x000A;which contains the cleartext authentication credentials, is saved with&#x000A;the world readable bit set. This happens in function&#x000A;<code data-sourcepos="275:2-275:27">grd_credentials_file_new()</code>. This is not a problem in the context of&#x000A;the system daemon, since its home directory, "/var/lib/gnome-remote-desktop",&#x000A;has mode 0700. Still the file itself should get proper protection bits.&#x000A;This is also inconsistent with respect to the certificate and private&#x000A;key, which do have mode 0700, in contrast.</p>&#x000A;<h2 data-sourcepos="281:1-283:0" dir="auto">&#x000A;<a id="user-content-suggested-fix-3" class="anchor" href="#suggested-fix-3" aria-hidden="true"></a>Suggested Fix</h2>&#x000A;<p data-sourcepos="284:1-285:46" dir="auto">Fixing this should be straight forward simply by applying the proper&#x000A;0600 permissions to the file when creating it.</p>&#x000A;<h1 data-sourcepos="287:1-289:0" dir="auto">&#x000A;<a id="user-content-the-system-service-can-be-started-by-anybody-in-the-system-5" class="anchor" href="#the-system-service-can-be-started-by-anybody-in-the-system-5" aria-hidden="true"></a>The system service can be started by anybody in the system (<code data-sourcepos="287:62-287:63">#5</code>)</h1>&#x000A;<p data-sourcepos="290:1-295:15" dir="auto">Independently of the enable/disable and start/stop status of the&#x000A;gnome-remote-desktop systemd service, the system daemon can be started&#x000A;by anybody in the system via the D-Bus autostart logic configured in&#x000A;"/usr/share/dbus-1/system-services/org.gnome.RemoteDesktop.service".&#x000A;Introspecting the service on D-Bus level is enough to trigger the start&#x000A;of the service.</p>&#x000A;<p data-sourcepos="297:1-300:35" dir="auto">If the service has already been configured once by an admin, then this&#x000A;means that the system service will even go live, listening on the&#x000A;network. Only the default firewall settings might prevent it becoming&#x000A;actually accessible on the network.</p>&#x000A;<h2 data-sourcepos="302:1-304:0" dir="auto">&#x000A;<a id="user-content-suggested-fix-4" class="anchor" href="#suggested-fix-4" aria-hidden="true"></a>Suggested Fix</h2>&#x000A;<p data-sourcepos="305:1-307:48" dir="auto">For a sensitive network service such as this I would consider not to&#x000A;configure the D-Bus autostart, but to require an explicit admin decision&#x000A;to start or enable the service on systemd level.</p>&#x000A;<h1 data-sourcepos="309:1-311:0" dir="auto">&#x000A;<a id="user-content-find_cr_lf-suffers-from-a-one-byte-overread-6" class="anchor" href="#find_cr_lf-suffers-from-a-one-byte-overread-6" aria-hidden="true"></a><code data-sourcepos="309:2-309:13">find_cr_lf()</code> Suffers from a one Byte Overread (<code data-sourcepos="309:51-309:52">#6</code>)</h1>&#x000A;<p data-sourcepos="312:1-316:64" dir="auto">This function processes untrusted pre-authentication RDP protocol&#x000A;network data (the routing token) and looks for a terminating \r\n&#x000A;sequence. The size calculation in the function's for loop is wrong: If&#x000A;the final byte of the buffer is 0x0D, then the logic will access the&#x000A;next byte out of bounds. This buffer is not non-null terminated.</p>&#x000A;<p data-sourcepos="318:1-320:39" dir="auto">The impact should be negligible in most cases, but the issue should&#x000A;still be addressed. This is the output of Valgrind I obtained after&#x000A;sending a crafted packet to the daemon:</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="322:1-330:3" class="code highlight js-syntax-highlight language-plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">==31119== Invalid read of size 1</span>&#x000A;<span id="LC2" class="line" lang="plaintext">==31119==    at 0x15A1EF: UnknownInlinedFun (grd-rdp-routing-token.c:65)</span>&#x000A;<span id="LC3" class="line" lang="plaintext">==31119==    by 0x15A1EF: UnknownInlinedFun (grd-rdp-routing-token.c:159)</span>&#x000A;<span id="LC4" class="line" lang="plaintext">==31119==    by 0x15A1EF: UnknownInlinedFun (grd-rdp-routing-token.c:239)</span>&#x000A;<span id="LC5" class="line" lang="plaintext">==31119==    by 0x15A1EF: peek_routing_token_in_thread</span>&#x000A;<span id="LC6" class="line" lang="plaintext">(grd-rdp-routing-token.c:281)</span>&#x000A;<span id="LC7" class="line" lang="plaintext">&lt;snip&gt;</span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<h2 data-sourcepos="332:1-334:0" dir="auto">&#x000A;<a id="user-content-suggested-fix-5" class="anchor" href="#suggested-fix-5" aria-hidden="true"></a>Suggested Fix</h2>&#x000A;<p data-sourcepos="335:1-336:25" dir="auto">The fix should be straight forward by correcting the maximum search&#x000A;index for the terminator.</p>&#x000A;<h1 data-sourcepos="339:1-341:0" dir="auto">&#x000A;<a id="user-content-grd_rdp_sam_create_sam_file-uses-a-racy-system-call-sequence-to-remove-the-o_cloexec-flag-7" class="anchor" href="#grd_rdp_sam_create_sam_file-uses-a-racy-system-call-sequence-to-remove-the-o_cloexec-flag-7" aria-hidden="true"></a><code data-sourcepos="339:2-339:30">grd_rdp_sam_create_sam_file()</code> Uses a Racy System Call Sequence to Remove the <code data-sourcepos="339:81-339:89">O_CLOEXEC</code> flag (<code data-sourcepos="339:99-339:100">#7</code>)</h1>&#x000A;<p data-sourcepos="342:1-346:16" dir="auto">This function creates a temporary file using <code data-sourcepos="342:47-342:55">mkstemp()</code>. In a second&#x000A;step the <code data-sourcepos="343:11-343:19">O_CLOEXEC</code> flag is removed from the resulting file descriptor&#x000A;via <code data-sourcepos="344:6-344:12">fcntl()</code>. If another thread calls <code data-sourcepos="344:41-344:48">execve()</code> during this time&#x000A;window, then this file descriptor will be inherited to other processes&#x000A;unintentionally.</p>&#x000A;<h2 data-sourcepos="348:1-350:0" dir="auto">&#x000A;<a id="user-content-suggested-fix-6" class="anchor" href="#suggested-fix-6" aria-hidden="true"></a>Suggested Fix</h2>&#x000A;<p data-sourcepos="351:1-353:20" dir="auto">On a number of systems, including Linux with glibc, <code data-sourcepos="351:54-351:63">mkostemp()</code> can be&#x000A;used to get a file descriptor with <code data-sourcepos="352:37-352:45">O_CLOEXEC</code> set right away, to avoid&#x000A;this race condition.</p>&#x000A;<h1 data-sourcepos="355:1-357:0" dir="auto">&#x000A;<a id="user-content-on_incoming_redirected_connection-outputs-untrusted-string-via-g_debug-8" class="anchor" href="#on_incoming_redirected_connection-outputs-untrusted-string-via-g_debug-8" aria-hidden="true"></a><code data-sourcepos="355:2-355:36">on_incoming_redirected_connection()</code> Outputs Untrusted String via <code data-sourcepos="355:69-355:77">g_debug()</code> (<code data-sourcepos="355:82-355:83">#8</code>)</h1>&#x000A;<p data-sourcepos="358:1-366:22" dir="auto">The <code data-sourcepos="358:6-358:22">routing_token_str</code> is data obtained from an untrusted RDP client&#x000A;before authentication is performed. This is the same data that is&#x000A;processed by <code data-sourcepos="360:15-360:26">find_cr_lf()</code> mentioned in item <code data-sourcepos="360:48-360:49">#7</code>. Luckily the network&#x000A;protocol parsing code in <code data-sourcepos="361:27-361:46">peek_routing_token()</code> at least ensures that&#x000A;this string is always null terminated, otherwise this would allow for an&#x000A;arbitrary unauthenticated remote DoS against the RDP daemon. <code data-sourcepos="363:63-363:71">g_debug()</code>&#x000A;generates the string to be logged, even if the log level DEBUG is not&#x000A;active. Thus formatting errors will always trigger, independently of the&#x000A;logging configuration.</p>&#x000A;<p data-sourcepos="368:1-374:30" dir="auto">If the DEBUG log level is active, then the output of the untrusted data&#x000A;allows an unauthenticated remote attacker to perform log spoofing. The&#x000A;string can be roughly 200 bytes long (limited by the protocol headers)&#x000A;and can contain arbitrary data (except for the "\r\n" terminator&#x000A;sequence). Thus it can also contain terminal control characters that&#x000A;allow to overwrite previous log lines, or to create a larger number of&#x000A;seemingly authentic log lines.</p>&#x000A;<p data-sourcepos="376:1-379:6" dir="auto">The function later on converts the untrusted data into an unsigned long&#x000A;integer. The resulting integer is only used for looking up an existing&#x000A;RDP session. Therefore no further attack surface via crafted data should&#x000A;exist.</p>&#x000A;<h2 data-sourcepos="381:1-383:0" dir="auto">&#x000A;<a id="user-content-suggested-fix-7" class="anchor" href="#suggested-fix-7" aria-hidden="true"></a>Suggested Fix</h2>&#x000A;<p data-sourcepos="384:1-386:46" dir="auto">The output of the untrusted data should either be removed completely, or&#x000A;the routing token should be verified both in content and length, to&#x000A;prevent unexpected things happening on output.</p>&#x000A;<h1 data-sourcepos="388:1-390:0" dir="auto">&#x000A;<a id="user-content-grdctl-utility-accepts-cleartext-password-on-the-command-line-9" class="anchor" href="#grdctl-utility-accepts-cleartext-password-on-the-command-line-9" aria-hidden="true"></a><code data-sourcepos="388:2-388:7">grdctl</code> Utility Accepts Cleartext Password on the Command Line (<code data-sourcepos="388:67-388:68">#9</code>)</h1>&#x000A;<p data-sourcepos="391:1-393:32" dir="auto">The text based <code data-sourcepos="391:17-391:22">grdctl</code> configuration utility which is used for both,&#x000A;system and session context RDP setups, accepts cleartext passwords in&#x000A;the following invocation styles:</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="395:1-398:3" class="code highlight js-syntax-highlight language-plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">grdctl [--system] rdp set-credentials &lt;username&gt; &lt;password&gt;</span>&#x000A;<span id="LC2" class="line" lang="plaintext">grdctl [--system] vnc set-password &lt;username&gt; &lt;password&gt;</span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<p data-sourcepos="400:1-403:20" dir="auto">This means that the cleartext password will leak via the /proc file&#x000A;system and will be visible in the process task list via <code data-sourcepos="401:58-401:59">ps</code>, when&#x000A;configured this way. Other users can thus get access to the&#x000A;authentication data.</p>&#x000A;<h2 data-sourcepos="405:1-407:0" dir="auto">&#x000A;<a id="user-content-suggested-fix-8" class="anchor" href="#suggested-fix-8" aria-hidden="true"></a>Suggested Fix</h2>&#x000A;<p data-sourcepos="408:1-409:71" dir="auto">Passwords should either be queried from stdin, passed in files or via&#x000A;environment variables to prevent such kinds of local information leaks.</p>&#x000A;<h1 data-sourcepos="411:1-413:0" dir="auto">&#x000A;<a id="user-content-vnc-by-default-does-not-authenticate-but-only-prompts-for-acceptdeny-10" class="anchor" href="#vnc-by-default-does-not-authenticate-but-only-prompts-for-acceptdeny-10" aria-hidden="true"></a>VNC by Default does not Authenticate, but Only Prompts for Accept/Deny (<code data-sourcepos="411:74-411:76">#10</code>)</h1>&#x000A;<p data-sourcepos="414:1-417:48" dir="auto">VNC is hidden away from the graphical user interface by now, but by&#x000A;using <code data-sourcepos="415:8-415:13">grdctl</code> it can still be enabled. I tested this only in session&#x000A;context, not in the system daemon context, since I did not manage to&#x000A;enable VNC for the system daemon using <code data-sourcepos="417:41-417:46">grdctl</code>.</p>&#x000A;<p data-sourcepos="419:1-425:7" dir="auto">The default for the VNC protocol is to prompt only, when a client&#x000A;connects, and to limit access to view-only (no control over input&#x000A;devices). The resulting process is that, on the server side, the user is&#x000A;presented with a popup dialog like "Host  wants to access your&#x000A;screen. Allow/Deny?".  This workflow offers no client verification at&#x000A;all, in particular a man-in-the-middle attack or source IP spoofing can&#x000A;happen.</p>&#x000A;<p data-sourcepos="427:1-429:20" dir="auto">The VNC protocol is not a secure protocol by default, but this&#x000A;prompt-only approach in gnome-remote-desktop removes all chances of&#x000A;security, by design.</p>&#x000A;<h2 data-sourcepos="431:1-433:0" dir="auto">&#x000A;<a id="user-content-suggested-fix-9" class="anchor" href="#suggested-fix-9" aria-hidden="true"></a>Suggested Fix</h2>&#x000A;<p data-sourcepos="434:1-436:10" dir="auto">If proper trust cannot be established via the VNC protocol, then a&#x000A;prompt-only mode should not be offered, and password authentication made&#x000A;mandatory.</p>&#x000A;<h1 data-sourcepos="438:1-440:0" dir="auto">&#x000A;<a id="user-content-miscellaneous" class="anchor" href="#miscellaneous" aria-hidden="true"></a>Miscellaneous</h1>&#x000A;<p data-sourcepos="441:1-442:38" dir="auto">Following are various bits that I observed while digging through the&#x000A;codebase that I find worth mentioning.</p>&#x000A;<ul data-sourcepos="444:1-497:0" dir="auto">&#x000A;<li data-sourcepos="444:1-449:0">&#x000A;<p data-sourcepos="444:3-448:25">The D-Bus method "Rdp.Server.GetCredentials()" allows to get the&#x000A;cleartext credentials for the system daemon (after Polkit admin&#x000A;authentication). Passing cleartext passwords around this way, even&#x000A;after authorization, should be well considered and it is unclear what&#x000A;the purpose of this is.</p>&#x000A;</li>&#x000A;<li data-sourcepos="450:1-464:0">&#x000A;<p data-sourcepos="450:3-450:71"><code data-sourcepos="450:4-450:22">create_sam_string()</code> contains a questionable array size calculation:</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="452:7-453:0" class="code highlight js-syntax-highlight language-plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext"> sam_string = g_malloc0 ((username_length + 3 + 32 + 3 + 1 + 1) * sizeof (char));</span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<p data-sourcepos="454:4-460:34">There is no documentation what this is about. The freerdp library&#x000A;function <code data-sourcepos="455:14-455:23">NTOWFv1A()</code> that is called in this function, receives a&#x000A;buffer <code data-sourcepos="456:12-456:18">nt_hash</code>, without knowing about the available buffer space.&#x000A;It seems this is "by contract", but pretty dangerous. Furthermore the&#x000A;return value of the function is not checked by <code data-sourcepos="458:52-458:70">create_sam_string()</code>.&#x000A;This and a few other looks into the freerdp library raise questions&#x000A;about its code and API quality.</p>&#x000A;<p data-sourcepos="462:4-463:43">I suggest to add comments about the purpose of this and to evaluate&#x000A;the return code of the library function.</p>&#x000A;</li>&#x000A;<li data-sourcepos="465:1-474:0">&#x000A;<p data-sourcepos="465:3-465:75">The <code data-sourcepos="465:8-465:36">start_rdp_server_when_ready()</code> function has a very strange semantic:</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="467:7-468:0" class="code highlight js-syntax-highlight language-plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">start_rdp_server_when_ready (GrdDaemon *daemon, gboolean should_start_when_ready)</span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<p data-sourcepos="469:3-471:39">Basically this says <code data-sourcepos="469:24-469:48">start_when_ready(or_dont)</code>. I believe this is the&#x000A;result of some unfortunate naming of the function that has a different&#x000A;purpose than what it sounds at first.</p>&#x000A;<p data-sourcepos="473:3-473:53">I suggest to rename this to something more fitting.</p>&#x000A;</li>&#x000A;<li data-sourcepos="475:1-485:0">&#x000A;<p data-sourcepos="475:3-480:58">The <code data-sourcepos="475:8-475:37">peek_routing_token_in_thread()</code> function parses the RDP protocol&#x000A;outside of the freerdp library, to extract the routing token. This is&#x000A;pretty complex and dangerous code. Especially bad is that the&#x000A;extracted untrusted routing token is passed through the codebase via&#x000A;various indirections (callbacks, signals). The boundary where trusted&#x000A;and untrusted data is processed is not well established.</p>&#x000A;<p data-sourcepos="482:3-484:43">The untrusted data should be clearly marked and ideally all code that&#x000A;deals with it should be grouped in a dedicated compilation unit that&#x000A;only deals with untrusted data like this.</p>&#x000A;</li>&#x000A;<li data-sourcepos="486:1-497:0">&#x000A;<p data-sourcepos="486:3-493:72">A renderer thread with an optional NVidia CUDA context is setup for&#x000A;every connecting client, without even having authorized the client.&#x000A;Also a layout manager thread is created. Overall this accounts for&#x000A;some five threads for each unauthenticated session. Luckily the daemon&#x000A;does not perform parallel incoming connection processing, otherwise&#x000A;this would pose a simple remote DoS amplification vector. Still I&#x000A;wonder if it is a good idea to start so many threads, a renderer and&#x000A;hardware acceleration before a client is even authorized for anything.</p>&#x000A;<p data-sourcepos="495:3-496:16">I suggest to only acquire heavy resources after a client successfully&#x000A;authenticated.</p>&#x000A;</li>&#x000A;</ul>&#x000A;<h1 data-sourcepos="498:1-500:0" dir="auto">&#x000A;<a id="user-content-cve-assignments" class="anchor" href="#cve-assignments" aria-hidden="true"></a>CVE Assignments</h1>&#x000A;<p data-sourcepos="501:1-503:69" dir="auto">Items <code data-sourcepos="501:8-501:11">#1.a</code> through <code data-sourcepos="501:23-501:26">#1.c</code> are CVE relevant. A single CVE could be issued&#x000A;grouping these as "unauthenticated D-Bus API" issues. Item <code data-sourcepos="502:61-502:62">#9</code> also&#x000A;justifies a CVE since this is a very tangible local information leak.</p>&#x000A;<p data-sourcepos="505:1-507:15" dir="auto">While they formally would qualify for a CVE, I would not assign any for&#x000A;items <code data-sourcepos="506:8-506:9">#6</code> and <code data-sourcepos="506:17-506:18">#8</code>, because their impact is negligible in default&#x000A;configurations.</p>&#x000A;<p data-sourcepos="509:1-510:74" dir="auto">Regarding the fixes for the reported issues we are available to review&#x000A;them, before publication, if you intend to perform coordinated disclosure.</p>&#x000A;<h1 data-sourcepos="512:1-514:0" dir="auto">&#x000A;<a id="user-content-review-summary" class="anchor" href="#review-summary" aria-hidden="true"></a>Review Summary</h1>&#x000A;<p data-sourcepos="515:1-520:71" dir="auto">Even considering the concrete findings from this report fixed, my trust&#x000A;into the gnome-remote-desktop codebase is low. The current design for&#x000A;the handover feels too complex. Implementation wise I don't see why a&#x000A;sensitive network service is still developed with C89 level code these&#x000A;days anymore. The codebase is really hard to follow and has nearly no&#x000A;comments or documentation. Function names like these don't help either:</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="522:5-523:0" class="code highlight js-syntax-highlight language-plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">grd_rdp_network_autodetection_get_bw_measure_stop_event_handle()</span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<p data-sourcepos="524:1-529:49" dir="auto">The only thing that reduces the burden a bit are the automatic memory&#x000A;management helpers like <code data-sourcepos="525:26-525:35">g_autofree</code>. gnome-remote-desktop consists of&#x000A;40,000 lines of C code though, and this doesn't even include the actual&#x000A;parsing of the protocol. The gobject model with its many indirections and&#x000A;the specific coding style found in this project represents a high bar&#x000A;for a third party to comprehend what is going on.</p>&#x000A;<p data-sourcepos="531:1-537:35" dir="auto">As already mentioned above, there is no clear separation of trusted and&#x000A;untrusted data. In the system daemon context there are at least four&#x000A;different security domains: The GDM domain, the gnome-remote-desktop&#x000A;domain, untrusted remote data from unauthenticated clients and finally&#x000A;trusted remote data from authenticated clients. Without documentation&#x000A;and a clear program structure that clearly separate these security&#x000A;domains, errors can easily slip in.</p>&#x000A;<p data-sourcepos="539:1-542:18" dir="auto">From what I have seen of the freerdp library I don't have the best&#x000A;impression of it either. It seems remote desktop applications and their&#x000A;protocols are generally a problematic area that justify looking more&#x000A;closely into them.</p>&#x000A;<p data-sourcepos="544:1-547:52" dir="auto">Given all this there might well linger further issues in the design and&#x000A;implementation of gnome-remote-desktop. Should you decide to improve&#x000A;this codebase in the future, then we would be happy to do a follow-up&#x000A;review, or discuss possible options for improvement.</p>&#x000A;<h1 data-sourcepos="549:1-551:0" dir="auto">&#x000A;<a id="user-content-end-user-experience" class="anchor" href="#end-user-experience" aria-hidden="true"></a>End User Experience</h1>&#x000A;<p data-sourcepos="552:1-558:31" dir="auto">The end user experience of gnome-remote-desktop matches the complexity&#x000A;found in the codebase. Only a few clients proved to be compatible with&#x000A;it, like Remmina and gnome-connections. But even with them I never&#x000A;managed to actually get a visible screen, only black with some random&#x000A;colored pixels sprinkled in, for reasons that I did not investigate&#x000A;fully. What I got was enough to create a connection on network level,&#x000A;for testing the D-Bus security.</p>&#x000A;<p data-sourcepos="560:1-567:4" dir="auto">An older version of Remmina even crashed with a segmentation fault&#x000A;trying to connect. On openSUSE the H.264 patent encumbered codecs first&#x000A;have to be installed, for being able to connect. Other RDP clients like&#x000A;<code data-sourcepos="563:2-563:9">rdesktop</code> and <code data-sourcepos="563:17-563:24">xfreerdp</code> do not support the NTLM authentication used in&#x000A;gnome-remote-desktop and fall back to kerberos authentication against a&#x000A;domain controller instead. The NTLM password authentication method,&#x000A;which is based on MD digests, is a security worry on its own, by the&#x000A;way.</p>&#x000A;<h1 data-sourcepos="569:1-571:0" dir="auto">&#x000A;<a id="user-content-references" class="anchor" href="#references" aria-hidden="true"></a>References</h1>&#x000A;<ul data-sourcepos="576:1-579:96" dir="auto">&#x000A;<li data-sourcepos="576:1-576:35"><a data-sourcepos="576:3-576:35" href="/GNOME/gnome-remote-desktop/-/blob/master/1" class="gfm">gnome remote desktop project</a></li>&#x000A;<li data-sourcepos="577:1-577:29"><a data-sourcepos="577:3-577:29" href="/GNOME/gnome-remote-desktop/-/blob/master/2" class="gfm">SUSE disclosure policy</a></li>&#x000A;<li data-sourcepos="578:1-578:58">&#x000A;<a data-sourcepos="578:3-578:32" href="/GNOME/gnome-remote-desktop/-/blob/master/3" class="gfm">oss-security mailing list</a>[wait_for_grd_priv_key.py]</li>&#x000A;<li data-sourcepos="579:1-579:96"><a data-sourcepos="579:3-579:96" href="/-/project/36/uploads/be254e313215afdfd36c6e633dd5c456/wait_for_grd_priv_key.py" data-canonical-src="/uploads/be254e313215afdfd36c6e633dd5c456/wait_for_grd_priv_key.py" data-link="true" class="gfm">wait_for_grd_priv_key.py</a></li>&#x000A;</ul></div>
</div>
<div class="edited-text gl-mt-4 gl-text-gray-500 gl-text-sm">Edited <time class="js-timeago issue-edited-ago js-issue-edited-ago" title="Apr 19, 2024 1:55pm" datetime="2024-04-19T13:55:44Z" data-toggle="tooltip" data-placement="bottom" data-container="body">Apr 19, 2024</time> by <a class="author-link hover:gl-underline gl-text-gray-700 js-user-link" data-user-id="274" data-username="alatiera" data-name="Jordan Petridis" href="/alatiera"><span class="">Jordan Petridis</span></a></div>
</div>
<div class="js-issue-widgets">
<div class="emoji-block emoji-block-sticky">
<div class="row gl-m-0 gl-justify-between">
<div class="js-noteable-awards">
<div class="gl-flex gl-flex-wrap gl-justify-between gl-pt-3">
<div data-can-award-emoji="false" data-path="/api/v4/projects/36/issues/196/award_emoji" data-show-default-award-emojis="true" id="js-vue-awards-block"></div>

</div>

</div>
<div class="new-branch-col gl-font-size-0 gl-my-2">

</div>
</div>
</div>

</div>
</div>
<div class="js-issue-widgets">

<div class="js-design-management" data-issue-iid="196" data-issue-path="/GNOME/gnome-remote-desktop/-/issues/196" data-new-comment-template-paths="[{&quot;text&quot;:&quot;Your comment templates&quot;,&quot;href&quot;:&quot;/-/profile/comment_templates&quot;}]" data-project-path="GNOME/gnome-remote-desktop" data-register-path="/users/sign_up?redirect_to_referer=yes" data-sign-in-path="/users/sign_in?redirect_to_referer=yes"></div>

<div class="js-work-item-links-root" data-full-path="GNOME/gnome-remote-desktop" data-issuable-id="198832" data-issuable-iid="196" data-register-path="/users/sign_up?redirect_to_referer=yes" data-sign-in-path="/users/sign_in?redirect_to_referer=yes" data-wi-autocomplete-award-emojis-path="/-/autocomplete/award_emojis" data-wi-can-admin-label="false" data-wi-default-branch="master" data-wi-full-path="GNOME/gnome-remote-desktop" data-wi-group-path="GNOME" data-wi-is-signed-in="false" data-wi-issues-list-path="/GNOME/gnome-remote-desktop/-/issues" data-wi-labels-manage-path="/GNOME/gnome-remote-desktop/-/labels" data-wi-new-comment-template-paths="[{&quot;text&quot;:&quot;Your comment templates&quot;,&quot;href&quot;:&quot;/-/profile/comment_templates&quot;}]" data-wi-register-path="/users/sign_up?redirect_to_referer=yes" data-wi-report-abuse-path="/-/abuse_reports/add_category" data-wi-show-new-issue-link="false" data-wi-sign-in-path="/users/sign_in?redirect_to_referer=yes"></div>


<div class="js-related-issues-root" data-can-add-related-issues="false" data-endpoint="/GNOME/gnome-remote-desktop/-/issues/196/links" data-full-path="GNOME/gnome-remote-desktop" data-has-issue-weights-feature="false" data-has-iterations-feature="false" data-help-path="/help/user/project/issues/related_issues.md" data-is-group="false" data-issuable-type="issue" data-show-categorized-issues="false" data-wi-autocomplete-award-emojis-path="/-/autocomplete/award_emojis" data-wi-can-admin-label="false" data-wi-default-branch="master" data-wi-full-path="GNOME/gnome-remote-desktop" data-wi-group-path="GNOME" data-wi-is-signed-in="false" data-wi-issues-list-path="/GNOME/gnome-remote-desktop/-/issues" data-wi-labels-manage-path="/GNOME/gnome-remote-desktop/-/labels" data-wi-new-comment-template-paths="[{&quot;text&quot;:&quot;Your comment templates&quot;,&quot;href&quot;:&quot;/-/profile/comment_templates&quot;}]" data-wi-register-path="/users/sign_up?redirect_to_referer=yes" data-wi-report-abuse-path="/-/abuse_reports/add_category" data-wi-show-new-issue-link="false" data-wi-sign-in-path="/users/sign_in?redirect_to_referer=yes"></div>

<div data-has-closing-merge-request="false" data-iid="196" data-project-path="GNOME/gnome-remote-desktop" id="js-related-merge-requests"></div>
<div data-url="/GNOME/gnome-remote-desktop/-/issues/196/related_branches" id="related-branches">
</div>
</div>
<div class="js-issue-widgets">
<section class="issuable-discussion js-vue-notes-event">
<div data-can-add-timeline-events="false" data-current-user-data="null" data-new-comment-template-paths="[{&quot;text&quot;:&quot;Your comment templates&quot;,&quot;href&quot;:&quot;/-/profile/comment_templates&quot;}]" data-noteable-data="{&quot;id&quot;:198832,&quot;iid&quot;:196,&quot;description&quot;:&quot;Hello GNOME security,\n\nthis issue is about the gnome-remote-desktop project [1]. I am a\nmember of the SUSE security team and I have conducted a source code\nreview of gnome-remote-desktop, because a D-Bus system service has been\nadded to it with GNOME version 46. In the course of this review I found\nsecurity issues and collected recommendations that I am reporting to you\nprivately this way. Please find the details below.\n\nCoordinated Disclosure\n======================\n\nWe offer coordinated disclosure based on our disclosure policy [2].\nPlease answer the following questions in this regard:\n\n- Do you want to perform coordinated disclosure? If yes, then please\n  communicate your desired coordinated release date (CRD) for publishing\n  the security issues and any patches/updates. We offer to keep the\n  issues private for up to 90 days (resulting in publication latest on\n  2024-07-18), but prefer to maintain shorter time frames of two to four\n  weeks, if possible.\n\n  If you don&#39;t want to perform coordinated disclosure, then we will\n  publish all information we have on the oss-security mailing list [3]\n  and in our bug tracker right away.\n\n- Do you acknowledge the finding? If so, will you obtain CVE identifiers\n  for the relevant issues? If yes, then please share the CVEs with us\n  once they are assigned. Alternatively we offer to request CVEs from\n  the Mitre organization for you.\n\nDesign Overview\n===============\n\ngnome-remote-desktop offers access to the graphics system either via the\nVNC or the RDP (Microsoft remote desktop) network protocol. Before\nversion 46, gnome-remote-desktop was only used in the context of\nexisting graphical sessions. Starting with version 46, one can also\nconfigure a system daemon, that allows to connect to the GDM display\nmanager, allowing to create new graphical sessions remotely.\n\nThe system daemon runs as a dedicated \&quot;gnome-remote-desktop\&quot; user. It\nprovides a D-Bus interface on the D-Bus system bus. The daemon also\ninteracts with a newly introduced D-Bus interface provided by GDM, to\ncreate remote displays.\n\nReview Motivation and Scope\n===========================\n\nD-Bus system services require a review by the SUSE security team, before\nthey can be added to openSUSE distributions and derived products. With\nthe addition of the system daemon, a review of gnome-remote-desktop has\nbecome necessary, before adding it to openSUSE Tumbleweed in the context\nof the larger GNOME 46 release.\n\nThe review was mainly concerned with the newly introduced system level\ngnome-remote-desktop daemon. The focus was furthermore on the RDP\nprotocol, which is the default and preferred over the VNC protocol.\n\nSince the codebase of gnome-remote-desktop is rather large, I further\ntried to limit the review to the security of the D-Bus methods, the\nPolkit authentication and parts of the network processing. I did not\nlook closely into the freerdp library, which is used by\ngnome-remote-desktop for processing the majority of the RDP protocol.\n\nUnauthorized D-Bus Interfaces (`#1`)\n==================================\n\nOnly the \&quot;/org/gnome/RemoteDesktop/Rdp/Server\&quot; D-Bus interface is\nprotected by Polkit. `auth_admin` authorization is required on this\ninterface for all methods. The other two interfaces \&quot;Dispatcher\&quot; and\n\&quot;Handover\&quot; are not authorized and are accessible to all local users in\nthe system. This leads to a number of local security issues described in\nthe following sub sections.\n\nLocal Private Key Leak (`#1.a`)\n-----------------------------\n\nThe system daemon keeps public SSL certificates and their corresponding\nprivate keys in \&quot;/var/lib/gnome-remote-desktop/.local/share/gnome-remote-desktop/certificates\&quot;.\nAccess to the service&#39;s home directory in \&quot;/var/lib/gnome-remote-desktop\&quot;\nis restricted to the service user \&quot;gnome-remote-desktop\&quot;, mode 0700.\n\nThrough the \&quot;/org/gnome/RemoteDesktop/Rdp/Handovers\&quot; D-Bus interface any\nlocal user can intercept the private SSL key, though. The private key is\nreturned from the `StartHandover` D-Bus function. When a remote desktop\nclient connects to the system daemon, then there is a rather long time\nwindow, during which a local user (even `nobody`) can call this method on\nthe created session object. This is an example call to achieve this:\n\n```\ngdbus call -y -d org.gnome.RemoteDesktop -o /org/gnome/RemoteDesktop/Rdp/Handovers/sessionc11 \\\n    -m org.gnome.RemoteDesktop.Rdp.Handover.StartHandover someuser somepass\n```\n\nThe username and password parameters are not important here, they will\nonly be forwarded to the connecting client. Doing this, as another\neffect, also serves as a DoS, because the proper connection handover\nwill be prevented.\n\nA local attacker does not necessarily have to wait for somebody to\nconnect to the system daemon, it can connect on its own via localhost,\nto achieve the same result. Valid credentials for RDP authentication are\nnecessary to get to the handover stage, however.\n\nThe impact of this problem is a local information leak and local DoS.\nThe information leak means that the integrity and privacy of RDP\nconnections on the system are compromised. Attached to this issue is\nalso a simple Python script that allows to reproduce the issue.\n\nSystem Credentials Leak (`#1.b`)\n------------------------------\n\nIf an RDP connection uses system credentials (see struct member\n`GrdRemoteClient.use_system_credentials`), then a local attacker with\nlow privileges can obtain these credentials in cleartext in a similar\nfashion to issue `#1.a`, by calling the unauthenticated\n`GetSystemCredentials()` D-Bus method of the Handover interface.\n\nUsing these system credentials, the attacker will be able to connect to\nthe display manager via RDP. This should not directly grant access to a\nsession, since a login on display manager level still has to happen. An\nexception would be if things like automatic login are enabled, which I\ndon&#39;t know if they apply to remote connections.\n\nThe Socket Connection can be Obtained via TakeClient() (`#1.c`)\n-------------------------------------------------------------\n\nThe equally unauthenticated D-Bus method `Handover.TakeClient()` allows\nany local user in the system to obtain the file descriptor pertaining to\nthe RDP client that is in handover state. This could allow a local user\nto DoS the RDP connection or to setup a crafted RDP session.\n\nObtaining the socket via this call only works in certain system daemon\nstates, most notably it seems the `StartHandover()` needs to have been\nperformed for this to succeed. I did not fully investigate what the\nexact preconditions are. If the preconditions are not met then this\ncall triggers a series of (non-fatal) assertions, which should also not\nbe reachable this way, I believe:\n\n```\ngnome-remote-de[31380]: g_socket_connection_get_socket: assertion &#39;G_IS_SOCKET_CONNECTION (connection)&#39; failed\ngnome-remote-de[31380]: g_socket_get_fd: assertion &#39;G_IS_SOCKET (socket)&#39; failed\ngnome-remote-de[31380]: g_unix_fd_list_append: assertion &#39;fd \u003e= 0&#39; failed\n```\n\nDispatcher Interface seems Safe\n-------------------------------\n\nThe only method existing in the Dispatcher interface, `RequestHandover`,\nonly succeeds if the caller&#39;s session has a connection waiting for\nhandover. It should be okay that this interface is not authorized in its\ncurrent form, because the sessions are managed by the privileged systemd\ndaemon and cannot be crafted.\n\nSuggested Fix\n-------------\n\nThe Handover D-Bus interface needs to be protected either by Polkit or\nvia D-Bus configuration. If only specific static users need to call\nthese D-Bus methods, then the D-Bus configuration is the correct spot.\n\nThe unauthenticated handover methods seem to be designed to be called by\nthe `--handover` personality of the gnome-remote-desktop daemon, and\nthis instance likely should run as the dynamic session user that\nauthenticates in GDM. If this is correct, then neither D-Bus nor Polkit\noffer the necessary features to restrict access to the D-Bus API to\nexactly this user. A possibility to fix this could be to use the same\napproach as in the Dispatcher interface, to only grant access to a\nclient that originates from the session that has the respective handover\npending.\n\nEven if only a legitimate user has access to the Handover D-Bus API,\nthere are still problems with the API design. Nobody except the\ngnome-remote-desktop system daemon service user should ever have access\nto the private server key and the system credentials. Why these are\npassed into the handover context is not fully clear to me. A larger\nredesign might be necessary to address these overarching issues.\n\nSingle Polkit Action for Everything (`2`)\n========================================\n\nThe bits of the D-Bus interface that are authenticated all use the same\nPolkit action `org.gnome.remotedesktop.configure-system-daemon`. Most of\nthe D-Bus methods are indeed for configuring things. The\n`GetCredentials()` method could be considered different, though.\nFurthermore the `grdctl` utility also uses this action, if it is\nsupposed to act on the system daemon (by passing the `--system` switch).\n\nThe action also implies the right to modify systemd units. This is only\nneeded by `grdctl` to enable or disable the system daemon systemd unit,\nthough. For the D-Bus interface these implied permissions are never\nneeded and are therefore excess privileges most of the time.\n\nSuggested Fix\n-------------\n\nA more fine grained approach with multiple Polkit actions would allow to\navoid these excess privileges and also would allow Admins to better\ncontrol the authentication settings for individual actions. For end\nusers, more fine grained actions would result in better authentication\nmessages, that explain what exactly is about to happen.\n\nImportCertificate D-Bus Method DoS Weaknesses and Overly Complex API (`3#`)\n=========================================================================\n\nThis D-Bus method requires `auth_admin` Polkit authentication, so it is\nnot generally accessible by default. Polkit allows to lower\nauthentication requirements, though. Apart from this, any D-Bus method\nshould be implemented in a robust way. This is not the case for the\n\&quot;ImportCertificate()\&quot; method.\n\nThe method expects two pairs of (filename, file descriptor) both for the\npublic SSL certificate and the private key. Each file descriptor can\nrefer to anything and the D-Bus service simply copies the data from the\nfile descriptor to a file beneath \&quot;/var/lib/gnome-remote-desktop\&quot;. If a\ncaller passes a file descriptor for \&quot;/dev/zero\&quot;, then the service will\nfill up the file system.\n\nSince the call allows to specify a custom filename, the service needs to\nworry about problematic paths containing path components like \&quot;/\&quot; and\n\&quot;..\&quot;. It succeeds mostly with this, but there is still an error\ncondition that can be triggered by passing \&quot;.\&quot; as a path. The service\nwill then try to open the path\n\&quot;/var/lib/gnome-remote-desktop/.local/share/gnome-remote-desktop/certificates\&quot;\nas a file, which results in an EISDIR error. This has no security\nrelevance, but is still kind of unexpected behaviour.\n\nSupporting custom filenames also means that an infinite amount of files\ncan be placed in the certificates directory, including hidden files or\nfiles containing unexpected characters like wildcards, binary data,\nfiles starting with \&quot;--\&quot; (possibly injecting command line options) etc.\nThis approach also add the burden of managing the lifetime of multiple\ninstalled certificates, but this doesn&#39;t even happen. Files are never\nremoved again from the certificates directory. Even more so, if an\nexisting filename is to be overwritten, then backups of the old files\nare created. But I don&#39;t think any admin will be aware of that fact,\neven if a certificate would be accidentally overwritten.\n\nFurthermore, if the function cannot fully complete the request (e.g.\nwriting the certificate succeeded, but writing the private key failed),\nthen the partially imported data is not removed again. The function can\nalso be tricked into generating an invalid configuration by specifying\nthe same filename for both certificate and key. Only the private key\nwill then remain under this name, but gnome-remote-desktop will try to\nuse the same path also for the certificate.\n\nSuggested Fix\n-------------\n\nAllowing custom filenames in this API just adds complexity that seems\nnot to offer much in return. If admins want to manage multiple sets of\ncertificates, then they can do this in their own context. Only one set\nof certificate and key will ever be active in the system daemon anyway.\nSo I would simply drop the filename support and use a fixed name for\nboth certificate and private key.\n\nThe file descriptor passed here should be checked for its type (via\n`fstat()`) and be rejected if it is not a regular file. Then a maximum\nfile size should be enforced to prevent the file system space being\ndepleted. No certificate / key combination should be larger than a few\nkilobytes. Once the file type is restricted to regular files, there\nshould also be no big risk of reads on the file descriptor to be\nblocking. For full security coverage one could also add a timeout\nhandling, to make sure the call completes withing a reasonable amount of\ntime.\n\ncredentials.ini is Created World-Readable (`#4`)\n==============================================\n\nThe file\n\&quot;/var/lib/gnome-remote-desktop/.local/share/gnome-remote-desktop/credentials.ini\&quot;,\nwhich contains the cleartext authentication credentials, is saved with\nthe world readable bit set. This happens in function\n`grd_credentials_file_new()`. This is not a problem in the context of\nthe system daemon, since its home directory, \&quot;/var/lib/gnome-remote-desktop\&quot;,\nhas mode 0700. Still the file itself should get proper protection bits.\nThis is also inconsistent with respect to the certificate and private\nkey, which do have mode 0700, in contrast.\n\nSuggested Fix\n-------------\n\nFixing this should be straight forward simply by applying the proper\n0600 permissions to the file when creating it.\n\nThe system service can be started by anybody in the system (`#5`)\n===============================================================\n\nIndependently of the enable/disable and start/stop status of the\ngnome-remote-desktop systemd service, the system daemon can be started\nby anybody in the system via the D-Bus autostart logic configured in\n\&quot;/usr/share/dbus-1/system-services/org.gnome.RemoteDesktop.service\&quot;.\nIntrospecting the service on D-Bus level is enough to trigger the start\nof the service.\n\nIf the service has already been configured once by an admin, then this\nmeans that the system service will even go live, listening on the\nnetwork. Only the default firewall settings might prevent it becoming\nactually accessible on the network.\n\nSuggested Fix\n-------------\n\nFor a sensitive network service such as this I would consider not to\nconfigure the D-Bus autostart, but to require an explicit admin decision\nto start or enable the service on systemd level.\n\n`find_cr_lf()` Suffers from a one Byte Overread (`#6`)\n====================================================\n\nThis function processes untrusted pre-authentication RDP protocol\nnetwork data (the routing token) and looks for a terminating \\r\\n\nsequence. The size calculation in the function&#39;s for loop is wrong: If\nthe final byte of the buffer is 0x0D, then the logic will access the\nnext byte out of bounds. This buffer is not non-null terminated.\n\nThe impact should be negligible in most cases, but the issue should\nstill be addressed. This is the output of Valgrind I obtained after\nsending a crafted packet to the daemon:\n\n```\n==31119== Invalid read of size 1\n==31119==    at 0x15A1EF: UnknownInlinedFun (grd-rdp-routing-token.c:65)\n==31119==    by 0x15A1EF: UnknownInlinedFun (grd-rdp-routing-token.c:159)\n==31119==    by 0x15A1EF: UnknownInlinedFun (grd-rdp-routing-token.c:239)\n==31119==    by 0x15A1EF: peek_routing_token_in_thread\n(grd-rdp-routing-token.c:281)\n\u003csnip\u003e\n```\n\nSuggested Fix\n-------------\n\nThe fix should be straight forward by correcting the maximum search\nindex for the terminator.\n\n\n`grd_rdp_sam_create_sam_file()` Uses a Racy System Call Sequence to Remove the `O_CLOEXEC` flag (`#7`)\n====================================================================================================\n\nThis function creates a temporary file using `mkstemp()`. In a second\nstep the `O_CLOEXEC` flag is removed from the resulting file descriptor\nvia `fcntl()`. If another thread calls `execve()` during this time\nwindow, then this file descriptor will be inherited to other processes\nunintentionally.\n\nSuggested Fix\n-------------\n\nOn a number of systems, including Linux with glibc, `mkostemp()` can be\nused to get a file descriptor with `O_CLOEXEC` set right away, to avoid\nthis race condition.\n\n`on_incoming_redirected_connection()` Outputs Untrusted String via `g_debug()` (`#8`)\n===================================================================================\n\nThe `routing_token_str` is data obtained from an untrusted RDP client\nbefore authentication is performed. This is the same data that is\nprocessed by `find_cr_lf()` mentioned in item `#7`. Luckily the network\nprotocol parsing code in `peek_routing_token()` at least ensures that\nthis string is always null terminated, otherwise this would allow for an\narbitrary unauthenticated remote DoS against the RDP daemon. `g_debug()`\ngenerates the string to be logged, even if the log level DEBUG is not\nactive. Thus formatting errors will always trigger, independently of the\nlogging configuration.\n\nIf the DEBUG log level is active, then the output of the untrusted data\nallows an unauthenticated remote attacker to perform log spoofing. The\nstring can be roughly 200 bytes long (limited by the protocol headers)\nand can contain arbitrary data (except for the \&quot;\\r\\n\&quot; terminator\nsequence). Thus it can also contain terminal control characters that\nallow to overwrite previous log lines, or to create a larger number of\nseemingly authentic log lines.\n\nThe function later on converts the untrusted data into an unsigned long\ninteger. The resulting integer is only used for looking up an existing\nRDP session. Therefore no further attack surface via crafted data should\nexist.\n\nSuggested Fix\n-------------\n\nThe output of the untrusted data should either be removed completely, or\nthe routing token should be verified both in content and length, to\nprevent unexpected things happening on output.\n\n`grdctl` Utility Accepts Cleartext Password on the Command Line (`#9`)\n====================================================================\n\nThe text based `grdctl` configuration utility which is used for both,\nsystem and session context RDP setups, accepts cleartext passwords in\nthe following invocation styles:\n\n```\ngrdctl [--system] rdp set-credentials \u003cusername\u003e \u003cpassword\u003e\ngrdctl [--system] vnc set-password \u003cusername\u003e \u003cpassword\u003e\n```\n\nThis means that the cleartext password will leak via the /proc file\nsystem and will be visible in the process task list via `ps`, when\nconfigured this way. Other users can thus get access to the\nauthentication data.\n\nSuggested Fix\n-------------\n\nPasswords should either be queried from stdin, passed in files or via\nenvironment variables to prevent such kinds of local information leaks.\n\nVNC by Default does not Authenticate, but Only Prompts for Accept/Deny (`#10`)\n============================================================================\n\nVNC is hidden away from the graphical user interface by now, but by\nusing `grdctl` it can still be enabled. I tested this only in session\ncontext, not in the system daemon context, since I did not manage to\nenable VNC for the system daemon using `grdctl`.\n\nThe default for the VNC protocol is to prompt only, when a client\nconnects, and to limit access to view-only (no control over input\ndevices). The resulting process is that, on the server side, the user is\npresented with a popup dialog like \&quot;Host \u003csome-ip\u003e wants to access your\nscreen. Allow/Deny?\&quot;.  This workflow offers no client verification at\nall, in particular a man-in-the-middle attack or source IP spoofing can\nhappen.\n\nThe VNC protocol is not a secure protocol by default, but this\nprompt-only approach in gnome-remote-desktop removes all chances of\nsecurity, by design.\n\nSuggested Fix\n-------------\n\nIf proper trust cannot be established via the VNC protocol, then a\nprompt-only mode should not be offered, and password authentication made\nmandatory.\n\nMiscellaneous\n=============\n\nFollowing are various bits that I observed while digging through the\ncodebase that I find worth mentioning.\n\n- The D-Bus method \&quot;Rdp.Server.GetCredentials()\&quot; allows to get the\n  cleartext credentials for the system daemon (after Polkit admin\n  authentication). Passing cleartext passwords around this way, even\n  after authorization, should be well considered and it is unclear what\n  the purpose of this is.\n\n- `create_sam_string()` contains a questionable array size calculation:\n\n       sam_string = g_malloc0 ((username_length + 3 + 32 + 3 + 1 + 1) * sizeof (char));\n\n   There is no documentation what this is about. The freerdp library\n   function `NTOWFv1A()` that is called in this function, receives a\n   buffer `nt_hash`, without knowing about the available buffer space.\n   It seems this is \&quot;by contract\&quot;, but pretty dangerous. Furthermore the\n   return value of the function is not checked by `create_sam_string()`.\n   This and a few other looks into the freerdp library raise questions\n   about its code and API quality.\n\n   I suggest to add comments about the purpose of this and to evaluate\n   the return code of the library function.\n\n- The `start_rdp_server_when_ready()` function has a very strange semantic:\n\n      start_rdp_server_when_ready (GrdDaemon *daemon, gboolean should_start_when_ready)\n\n  Basically this says `start_when_ready(or_dont)`. I believe this is the\n  result of some unfortunate naming of the function that has a different\n  purpose than what it sounds at first.\n\n  I suggest to rename this to something more fitting.\n\n- The `peek_routing_token_in_thread()` function parses the RDP protocol\n  outside of the freerdp library, to extract the routing token. This is\n  pretty complex and dangerous code. Especially bad is that the\n  extracted untrusted routing token is passed through the codebase via\n  various indirections (callbacks, signals). The boundary where trusted\n  and untrusted data is processed is not well established.\n\n  The untrusted data should be clearly marked and ideally all code that\n  deals with it should be grouped in a dedicated compilation unit that\n  only deals with untrusted data like this.\n\n- A renderer thread with an optional NVidia CUDA context is setup for\n  every connecting client, without even having authorized the client.\n  Also a layout manager thread is created. Overall this accounts for\n  some five threads for each unauthenticated session. Luckily the daemon\n  does not perform parallel incoming connection processing, otherwise\n  this would pose a simple remote DoS amplification vector. Still I\n  wonder if it is a good idea to start so many threads, a renderer and\n  hardware acceleration before a client is even authorized for anything.\n\n  I suggest to only acquire heavy resources after a client successfully\n  authenticated.\n\nCVE Assignments\n===============\n\nItems `#1.a` through `#1.c` are CVE relevant. A single CVE could be issued\ngrouping these as \&quot;unauthenticated D-Bus API\&quot; issues. Item `#9` also\njustifies a CVE since this is a very tangible local information leak.\n\nWhile they formally would qualify for a CVE, I would not assign any for\nitems `#6` and `#8`, because their impact is negligible in default\nconfigurations.\n\nRegarding the fixes for the reported issues we are available to review\nthem, before publication, if you intend to perform coordinated disclosure.\n\nReview Summary\n==============\n\nEven considering the concrete findings from this report fixed, my trust\ninto the gnome-remote-desktop codebase is low. The current design for\nthe handover feels too complex. Implementation wise I don&#39;t see why a\nsensitive network service is still developed with C89 level code these\ndays anymore. The codebase is really hard to follow and has nearly no\ncomments or documentation. Function names like these don&#39;t help either:\n\n    grd_rdp_network_autodetection_get_bw_measure_stop_event_handle()\n\nThe only thing that reduces the burden a bit are the automatic memory\nmanagement helpers like `g_autofree`. gnome-remote-desktop consists of\n40,000 lines of C code though, and this doesn&#39;t even include the actual\nparsing of the protocol. The gobject model with its many indirections and\nthe specific coding style found in this project represents a high bar\nfor a third party to comprehend what is going on.\n\nAs already mentioned above, there is no clear separation of trusted and\nuntrusted data. In the system daemon context there are at least four\ndifferent security domains: The GDM domain, the gnome-remote-desktop\ndomain, untrusted remote data from unauthenticated clients and finally\ntrusted remote data from authenticated clients. Without documentation\nand a clear program structure that clearly separate these security\ndomains, errors can easily slip in.\n\nFrom what I have seen of the freerdp library I don&#39;t have the best\nimpression of it either. It seems remote desktop applications and their\nprotocols are generally a problematic area that justify looking more\nclosely into them.\n\nGiven all this there might well linger further issues in the design and\nimplementation of gnome-remote-desktop. Should you decide to improve\nthis codebase in the future, then we would be happy to do a follow-up\nreview, or discuss possible options for improvement.\n\nEnd User Experience\n===================\n\nThe end user experience of gnome-remote-desktop matches the complexity\nfound in the codebase. Only a few clients proved to be compatible with\nit, like Remmina and gnome-connections. But even with them I never\nmanaged to actually get a visible screen, only black with some random\ncolored pixels sprinkled in, for reasons that I did not investigate\nfully. What I got was enough to create a connection on network level,\nfor testing the D-Bus security.\n\nAn older version of Remmina even crashed with a segmentation fault\ntrying to connect. On openSUSE the H.264 patent encumbered codecs first\nhave to be installed, for being able to connect. Other RDP clients like\n`rdesktop` and `xfreerdp` do not support the NTLM authentication used in\ngnome-remote-desktop and fall back to kerberos authentication against a\ndomain controller instead. The NTLM password authentication method,\nwhich is based on MD digests, is a security worry on its own, by the\nway.\n\nReferences\n==========\n\n[1]: https://gitlab.gnome.org/GNOME/gnome-remote-desktop\n[2]: https://en.opensuse.org/openSUSE:Security_disclosure_policy\n[3]: https://www.openwall.com/lists/oss-security\n\n- [gnome remote desktop project](1)\n- [SUSE disclosure policy](2)\n- [oss-security mailing list](3)[wait_for_grd_priv_key.py]\n- [wait_for_grd_priv_key.py](/uploads/be254e313215afdfd36c6e633dd5c456/wait_for_grd_priv_key.py)&quot;,&quot;title&quot;:&quot;gnome-remote-desktop: multiple security issues and recommendations&quot;,&quot;time_estimate&quot;:0,&quot;total_time_spent&quot;:0,&quot;human_time_estimate&quot;:null,&quot;human_total_time_spent&quot;:null,&quot;state&quot;:&quot;closed&quot;,&quot;milestone_id&quot;:null,&quot;updated_by_id&quot;:362,&quot;created_at&quot;:&quot;2024-04-19T13:48:56Z&quot;,&quot;updated_at&quot;:&quot;2024-05-22T11:49:50Z&quot;,&quot;milestone&quot;:null,&quot;labels&quot;:[],&quot;lock_version&quot;:4,&quot;author_id&quot;:20088,&quot;confidential&quot;:false,&quot;discussion_locked&quot;:null,&quot;assignees&quot;:[],&quot;due_date&quot;:null,&quot;project_id&quot;:36,&quot;moved_to_id&quot;:null,&quot;duplicated_to_id&quot;:null,&quot;web_url&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues/196&quot;,&quot;current_user&quot;:{&quot;can_create_note&quot;:false,&quot;can_create_confidential_note&quot;:false,&quot;can_update&quot;:false,&quot;can_set_issue_metadata&quot;:false,&quot;can_award_emoji&quot;:false},&quot;create_note_path&quot;:&quot;/GNOME/gnome-remote-desktop/notes?target_id=198832\u0026target_type=issue&quot;,&quot;preview_note_path&quot;:&quot;/GNOME/gnome-remote-desktop/-/preview_markdown?target_id=196\u0026target_type=Issue&quot;,&quot;is_project_archived&quot;:false,&quot;issue_email_participants&quot;:[],&quot;type&quot;:&quot;ISSUE&quot;}" data-noteable-type="Issue" data-notes-data="{&quot;noteableType&quot;:&quot;issue&quot;,&quot;noteableId&quot;:198832,&quot;projectId&quot;:36,&quot;groupId&quot;:null,&quot;discussionsPath&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues/196/discussions.json&quot;,&quot;registerPath&quot;:&quot;/users/sign_up?redirect_to_referer=yes&quot;,&quot;newSessionPath&quot;:&quot;/users/sign_in?redirect_to_referer=yes&quot;,&quot;markdownDocsPath&quot;:&quot;/help/user/markdown.md&quot;,&quot;quickActionsDocsPath&quot;:&quot;/help/user/project/quick_actions.md&quot;,&quot;closePath&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues/196.json?issue%5Bstate_event%5D=close&quot;,&quot;reopenPath&quot;:&quot;/GNOME/gnome-remote-desktop/-/issues/196.json?issue%5Bstate_event%5D=reopen&quot;,&quot;notesPath&quot;:&quot;/GNOME/gnome-remote-desktop/noteable/issue/198832/notes&quot;,&quot;prerenderedNotesCount&quot;:10,&quot;lastFetchedAt&quot;:1736623264000000,&quot;notesFilter&quot;:null}" data-notes-filters="{&quot;Show all activity&quot;:0,&quot;Show comments only&quot;:1,&quot;Show history only&quot;:2}" data-report-abuse-path="/-/abuse_reports/add_category" data-show-timeline-view-toggle="false" data-target-type="issue" id="js-vue-notes"></div>
</section>

</div>
</div>
<aside aria-label="issue" aria-live="polite" class="right-sidebar js-right-sidebar js-issuable-sidebar right-sidebar-expanded" data-always-show-toggle data-auto-collapse data-issuable-type="issue">
<div class="issuable-sidebar">
<div class="issuable-sidebar-header">
<button class="gl-button btn btn-md btn-default gutter-toggle gl-float-right js-sidebar-toggle has-tooltip !gl-shadow-none gl-block " type="button" aria-label="Toggle sidebar" title="Collapse sidebar" data-container="body" data-placement="left" data-boundary="viewport" type="button"><span class="gl-button-text">
<span class="js-sidebar-toggle-container gl-button-text" data-is-expanded="true"><svg class="s16 js-sidebar-expand hidden" data-testid="chevron-double-lg-left-icon"><use href="/assets/icons-8791a66659d025e0a4c801978c79a1fbd82db1d27d85f044a35728ea7cf0ae80.svg#chevron-double-lg-left"></use></svg><svg class="s16 js-sidebar-collapse " data-testid="chevron-double-lg-right-icon"><use href="/assets/icons-8791a66659d025e0a4c801978c79a1fbd82db1d27d85f044a35728ea7cf0ae80.svg#chevron-double-lg-right"></use></svg></span>

</span>

</button></div>
<form class="issuable-context-form inline-update js-issuable-update " action="/GNOME/gnome-remote-desktop/-/issues/196.json" accept-charset="UTF-8" data-remote="true" method="post"><div class="block assignee gl-mt-3" data-testid="assignee-block-container">
<div class="js-sidebar-assignees-root" data-field="issue" data-max-assignees="1">
<div class="title hide-collapsed gl-flex gl-justify-between gl-items-center !gl-mb-0">
<span class="gl-font-bold">Assignee</span>
<span class="gl-spinner-container" role="status"><span aria-hidden class="gl-spinner gl-spinner-sm gl-spinner-dark !gl-align-text-bottom"></span><span class="gl-sr-only !gl-absolute">Loading</span>
</span>
</div>
</div>

</div>

<div class="js-sidebar-labels-widget-root" data-allow-label-create="" data-allow-scoped-labels="" data-can-edit="" data-iid="196" data-issuable-type="issue" data-labels-fetch-path="/GNOME/gnome-remote-desktop/-/labels.json?include_ancestor_groups=true" data-labels-manage-path="/GNOME/gnome-remote-desktop/-/labels" data-project-issues-path="/GNOME/gnome-remote-desktop/-/issues" data-project-path="GNOME/gnome-remote-desktop" data-selected-labels="[]"></div>
<div class="block milestone" data-testid="sidebar-milestones">
<div class="js-sidebar-milestone-widget-root" data-can-edit="" data-issue-iid="196" data-project-path="GNOME/gnome-remote-desktop"></div>
</div>

<div class="js-sidebar-due-date-widget-root"></div>
<div class="js-sidebar-time-tracking-root block">
<!-- / Fallback while content is loading -->
<div class="title hide-collapsed gl-flex gl-justify-between gl-items-center !gl-mb-0">
<span class="gl-font-bold">Time tracking</span>
<span class="gl-spinner-container" role="status"><span aria-hidden class="gl-spinner gl-spinner-sm gl-spinner-dark !gl-align-text-bottom"></span><span class="gl-sr-only !gl-absolute">Loading</span>
</span>
</div>
</div>
<script id="js-confidential-issue-data" type="application/json">{"is_confidential":false,"is_editable":null}</script>
<div class="js-sidebar-confidential-widget-root"></div>

<div class="js-sidebar-participants-widget-root"></div>
</form><script class="js-sidebar-options" type="application/json">{"endpoint":"/GNOME/gnome-remote-desktop/-/issues/196.json?serializer=sidebar_extras","toggleSubscriptionEndpoint":"/GNOME/gnome-remote-desktop/-/issues/196/toggle_subscription","moveIssueEndpoint":"/GNOME/gnome-remote-desktop/-/issues/196/move","projectsAutocompleteEndpoint":"/-/autocomplete/projects?project_id=36","editable":"","currentUser":{},"rootPath":"/","fullPath":"GNOME/gnome-remote-desktop","iid":196,"id":198832,"severity":"unknown","timeTrackingLimitToHours":false,"canCreateTimelogs":null,"createNoteEmail":null,"issuableType":"issue","directlyInviteMembers":"false"}</script>
</div>
</aside>



</main>
</div>


</div>
</div>


<script>
//<![CDATA[
if ('loading' in HTMLImageElement.prototype) {
  document.querySelectorAll('img.lazy').forEach(img => {
    img.loading = 'lazy';
    let imgUrl = img.dataset.src;
    // Only adding width + height for avatars for now
    if (imgUrl.indexOf('/avatar/') > -1 && imgUrl.indexOf('?') === -1) {
      const targetWidth = img.getAttribute('width') || img.width;
      imgUrl += `?width=${targetWidth}`;
    }
    img.src = imgUrl;
    img.removeAttribute('data-src');
    img.classList.remove('lazy');
    img.classList.add('js-lazy-loaded');
    img.dataset.testid = 'js-lazy-loaded-content';
  });
}

//]]>
</script>
<script>
//<![CDATA[
gl = window.gl || {};
gl.experiments = {};


//]]>
</script>

</body>
</html>

