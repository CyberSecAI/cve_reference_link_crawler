=== Content from git.kernel.org_85bf16bc_20250111_123244.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d3703fa94116fed91f64c7d1c7d284fb4369070f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3703fa94116fed91f64c7d1c7d284fb4369070f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3703fa94116fed91f64c7d1c7d284fb4369070f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3703fa94116fed91f64c7d1c7d284fb4369070f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Casey Schaufler <casey@schaufler-ca.com> | 2024-06-05 15:41:50 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-08 07:56:35 +0200 |
| commit | [d3703fa94116fed91f64c7d1c7d284fb4369070f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3703fa94116fed91f64c7d1c7d284fb4369070f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d3703fa94116fed91f64c7d1c7d284fb4369070f)) | |
| tree | [1662cc790384a8d97d991b03c9bb3ddd5454d48c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3703fa94116fed91f64c7d1c7d284fb4369070f) | |
| parent | [61e5929d10b81817176c38d0d49752b7933ff6b5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=61e5929d10b81817176c38d0d49752b7933ff6b5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3703fa94116fed91f64c7d1c7d284fb4369070f&id2=61e5929d10b81817176c38d0d49752b7933ff6b5)) | |
| download | [linux-d3703fa94116fed91f64c7d1c7d284fb4369070f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d3703fa94116fed91f64c7d1c7d284fb4369070f.tar.gz) | |

smack: tcp: ipv4, fix incorrect labeling[ Upstream commit 2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550 ]
Currently, Smack mirrors the label of incoming tcp/ipv4 connections:
when a label 'foo' connects to a label 'bar' with tcp/ipv4,
'foo' always gets 'foo' in returned ipv4 packets. So,
1) returned packets are incorrectly labeled ('foo' instead of 'bar')
2) 'bar' can write to 'foo' without being authorized to write.
Here is a scenario how to see this:
\* Take two machines, let's call them C and S,
with active Smack in the default state
(no settings, no rules, no labeled hosts, only builtin labels)
\* At S, add Smack rule 'foo bar w'
(labels 'foo' and 'bar' are instantiated at S at this moment)
\* At S, at label 'bar', launch a program
that listens for incoming tcp/ipv4 connections
\* From C, at label 'foo', connect to the listener at S.
(label 'foo' is instantiated at C at this moment)
Connection succeedes and works.
\* Send some data in both directions.
\* Collect network traffic of this connection.
All packets in both directions are labeled with the CIPSO
of the label 'foo'. Hence, label 'bar' writes to 'foo' without
being authorized, and even without ever being known at C.
If anybody cares: exactly the same happens with DCCP.
This behavior 1st manifested in release 2.6.29.4 (see Fixes below)
and it looks unintentional. At least, no explanation was provided.
I changed returned packes label into the 'bar',
to bring it into line with the Smack documentation claims.
Signed-off-by: Konstantin Andreev <andreev@swemel.ru>
Signed-off-by: Casey Schaufler <casey@schaufler-ca.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3703fa94116fed91f64c7d1c7d284fb4369070f)

| -rw-r--r-- | [security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/security/smack/smack_lsm.c?id=d3703fa94116fed91f64c7d1c7d284fb4369070f) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/security/smack/smack\_lsm.c b/security/smack/smack\_lsm.cindex 081129be5b62cd..ab939e6449e410 100644--- a/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=61e5929d10b81817176c38d0d49752b7933ff6b5)+++ b/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=d3703fa94116fed91f64c7d1c7d284fb4369070f)@@ -4456,7 +4456,7 @@ static int smack\_inet\_conn\_request(const struct sock \*sk, struct sk\_buff \*skb, rcu\_read\_unlock();  if (hskp == NULL)- rc = netlbl\_req\_setattr(req, &skp->smk\_netlabel);+ rc = netlbl\_req\_setattr(req, &ssp->smk\_out->smk\_netlabel); else netlbl\_req\_delattr(req); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:31:21 +0000



=== Content from git.kernel.org_1e47609f_20250111_123242.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4be9fd15c3c88775bdf6fa37acabe6de85beebff)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4be9fd15c3c88775bdf6fa37acabe6de85beebff)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4be9fd15c3c88775bdf6fa37acabe6de85beebff)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4be9fd15c3c88775bdf6fa37acabe6de85beebff)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Casey Schaufler <casey@schaufler-ca.com> | 2024-06-05 15:41:50 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-08 07:54:45 +0200 |
| commit | [4be9fd15c3c88775bdf6fa37acabe6de85beebff](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4be9fd15c3c88775bdf6fa37acabe6de85beebff) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4be9fd15c3c88775bdf6fa37acabe6de85beebff)) | |
| tree | [3654a25591e2c8f46dce6f53028fe6bdbbe0c801](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4be9fd15c3c88775bdf6fa37acabe6de85beebff) | |
| parent | [4c1145144c94371a589feb3e4e42b2436ac58dc7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4c1145144c94371a589feb3e4e42b2436ac58dc7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4be9fd15c3c88775bdf6fa37acabe6de85beebff&id2=4c1145144c94371a589feb3e4e42b2436ac58dc7)) | |
| download | [linux-4be9fd15c3c88775bdf6fa37acabe6de85beebff.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4be9fd15c3c88775bdf6fa37acabe6de85beebff.tar.gz) | |

smack: tcp: ipv4, fix incorrect labeling[ Upstream commit 2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550 ]
Currently, Smack mirrors the label of incoming tcp/ipv4 connections:
when a label 'foo' connects to a label 'bar' with tcp/ipv4,
'foo' always gets 'foo' in returned ipv4 packets. So,
1) returned packets are incorrectly labeled ('foo' instead of 'bar')
2) 'bar' can write to 'foo' without being authorized to write.
Here is a scenario how to see this:
\* Take two machines, let's call them C and S,
with active Smack in the default state
(no settings, no rules, no labeled hosts, only builtin labels)
\* At S, add Smack rule 'foo bar w'
(labels 'foo' and 'bar' are instantiated at S at this moment)
\* At S, at label 'bar', launch a program
that listens for incoming tcp/ipv4 connections
\* From C, at label 'foo', connect to the listener at S.
(label 'foo' is instantiated at C at this moment)
Connection succeedes and works.
\* Send some data in both directions.
\* Collect network traffic of this connection.
All packets in both directions are labeled with the CIPSO
of the label 'foo'. Hence, label 'bar' writes to 'foo' without
being authorized, and even without ever being known at C.
If anybody cares: exactly the same happens with DCCP.
This behavior 1st manifested in release 2.6.29.4 (see Fixes below)
and it looks unintentional. At least, no explanation was provided.
I changed returned packes label into the 'bar',
to bring it into line with the Smack documentation claims.
Signed-off-by: Konstantin Andreev <andreev@swemel.ru>
Signed-off-by: Casey Schaufler <casey@schaufler-ca.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4be9fd15c3c88775bdf6fa37acabe6de85beebff)

| -rw-r--r-- | [security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/security/smack/smack_lsm.c?id=4be9fd15c3c88775bdf6fa37acabe6de85beebff) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/security/smack/smack\_lsm.c b/security/smack/smack\_lsm.cindex 6b92e09d3f780f..98c2bdbfcaed60 100644--- a/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=4c1145144c94371a589feb3e4e42b2436ac58dc7)+++ b/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=4be9fd15c3c88775bdf6fa37acabe6de85beebff)@@ -4354,7 +4354,7 @@ static int smack\_inet\_conn\_request(const struct sock \*sk, struct sk\_buff \*skb, rcu\_read\_unlock();  if (hskp == NULL)- rc = netlbl\_req\_setattr(req, &skp->smk\_netlabel);+ rc = netlbl\_req\_setattr(req, &ssp->smk\_out->smk\_netlabel); else netlbl\_req\_delattr(req); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:31:19 +0000



=== Content from git.kernel.org_20e782f2_20250111_123241.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Casey Schaufler <casey@schaufler-ca.com> | 2024-06-05 15:41:50 -0700 |
| --- | --- | --- |
| committer | Casey Schaufler <casey@schaufler-ca.com> | 2024-06-05 15:41:50 -0700 |
| commit | [2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550)) | |
| tree | [8076acb374a296924d5b6882ebb354f5458959e2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550) | |
| parent | [c3f38fa61af77b49866b006939479069cd451173](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c3f38fa61af77b49866b006939479069cd451173) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550&id2=c3f38fa61af77b49866b006939479069cd451173)) | |
| download | [linux-2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550.tar.gz) | |

smack: tcp: ipv4, fix incorrect labelingCurrently, Smack mirrors the label of incoming tcp/ipv4 connections:
when a label 'foo' connects to a label 'bar' with tcp/ipv4,
'foo' always gets 'foo' in returned ipv4 packets. So,
1) returned packets are incorrectly labeled ('foo' instead of 'bar')
2) 'bar' can write to 'foo' without being authorized to write.
Here is a scenario how to see this:
\* Take two machines, let's call them C and S,
with active Smack in the default state
(no settings, no rules, no labeled hosts, only builtin labels)
\* At S, add Smack rule 'foo bar w'
(labels 'foo' and 'bar' are instantiated at S at this moment)
\* At S, at label 'bar', launch a program
that listens for incoming tcp/ipv4 connections
\* From C, at label 'foo', connect to the listener at S.
(label 'foo' is instantiated at C at this moment)
Connection succeedes and works.
\* Send some data in both directions.
\* Collect network traffic of this connection.
All packets in both directions are labeled with the CIPSO
of the label 'foo'. Hence, label 'bar' writes to 'foo' without
being authorized, and even without ever being known at C.
If anybody cares: exactly the same happens with DCCP.
This behavior 1st manifested in release 2.6.29.4 (see Fixes below)
and it looks unintentional. At least, no explanation was provided.
I changed returned packes label into the 'bar',
to bring it into line with the Smack documentation claims.
Signed-off-by: Konstantin Andreev <andreev@swemel.ru>
Signed-off-by: Casey Schaufler <casey@schaufler-ca.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550)

| -rw-r--r-- | [security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/security/smack/smack_lsm.c?id=2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/security/smack/smack\_lsm.c b/security/smack/smack\_lsm.cindex 70ba2841e181d3..56e02cc5c44d2a 100644--- a/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=c3f38fa61af77b49866b006939479069cd451173)+++ b/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550)@@ -4431,7 +4431,7 @@ static int smack\_inet\_conn\_request(const struct sock \*sk, struct sk\_buff \*skb, rcu\_read\_unlock();  if (hskp == NULL)- rc = netlbl\_req\_setattr(req, &skp->smk\_netlabel);+ rc = netlbl\_req\_setattr(req, &ssp->smk\_out->smk\_netlabel); else netlbl\_req\_delattr(req); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:31:18 +0000



=== Content from git.kernel.org_6e993579_20250111_123240.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0776bcf9cb6de46fdd94d10118de1cf9b05f83b9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0776bcf9cb6de46fdd94d10118de1cf9b05f83b9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0776bcf9cb6de46fdd94d10118de1cf9b05f83b9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0776bcf9cb6de46fdd94d10118de1cf9b05f83b9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Casey Schaufler <casey@schaufler-ca.com> | 2024-06-05 15:41:50 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-08 07:53:10 +0200 |
| commit | [0776bcf9cb6de46fdd94d10118de1cf9b05f83b9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0776bcf9cb6de46fdd94d10118de1cf9b05f83b9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0776bcf9cb6de46fdd94d10118de1cf9b05f83b9)) | |
| tree | [31caaf65af1cd4773d89a25897ed0e02aab0fa3e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0776bcf9cb6de46fdd94d10118de1cf9b05f83b9) | |
| parent | [a1d594e6e7f09b0e6183e0131bf0cdede3f60395](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a1d594e6e7f09b0e6183e0131bf0cdede3f60395) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0776bcf9cb6de46fdd94d10118de1cf9b05f83b9&id2=a1d594e6e7f09b0e6183e0131bf0cdede3f60395)) | |
| download | [linux-0776bcf9cb6de46fdd94d10118de1cf9b05f83b9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0776bcf9cb6de46fdd94d10118de1cf9b05f83b9.tar.gz) | |

smack: tcp: ipv4, fix incorrect labeling[ Upstream commit 2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550 ]
Currently, Smack mirrors the label of incoming tcp/ipv4 connections:
when a label 'foo' connects to a label 'bar' with tcp/ipv4,
'foo' always gets 'foo' in returned ipv4 packets. So,
1) returned packets are incorrectly labeled ('foo' instead of 'bar')
2) 'bar' can write to 'foo' without being authorized to write.
Here is a scenario how to see this:
\* Take two machines, let's call them C and S,
with active Smack in the default state
(no settings, no rules, no labeled hosts, only builtin labels)
\* At S, add Smack rule 'foo bar w'
(labels 'foo' and 'bar' are instantiated at S at this moment)
\* At S, at label 'bar', launch a program
that listens for incoming tcp/ipv4 connections
\* From C, at label 'foo', connect to the listener at S.
(label 'foo' is instantiated at C at this moment)
Connection succeedes and works.
\* Send some data in both directions.
\* Collect network traffic of this connection.
All packets in both directions are labeled with the CIPSO
of the label 'foo'. Hence, label 'bar' writes to 'foo' without
being authorized, and even without ever being known at C.
If anybody cares: exactly the same happens with DCCP.
This behavior 1st manifested in release 2.6.29.4 (see Fixes below)
and it looks unintentional. At least, no explanation was provided.
I changed returned packes label into the 'bar',
to bring it into line with the Smack documentation claims.
Signed-off-by: Konstantin Andreev <andreev@swemel.ru>
Signed-off-by: Casey Schaufler <casey@schaufler-ca.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0776bcf9cb6de46fdd94d10118de1cf9b05f83b9)

| -rw-r--r-- | [security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/security/smack/smack_lsm.c?id=0776bcf9cb6de46fdd94d10118de1cf9b05f83b9) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/security/smack/smack\_lsm.c b/security/smack/smack\_lsm.cindex b0a483e40c827a..75b3e91d5a5f81 100644--- a/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=a1d594e6e7f09b0e6183e0131bf0cdede3f60395)+++ b/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=0776bcf9cb6de46fdd94d10118de1cf9b05f83b9)@@ -4290,7 +4290,7 @@ static int smack\_inet\_conn\_request(const struct sock \*sk, struct sk\_buff \*skb, rcu\_read\_unlock();  if (hskp == NULL)- rc = netlbl\_req\_setattr(req, &skp->smk\_netlabel);+ rc = netlbl\_req\_setattr(req, &ssp->smk\_out->smk\_netlabel); else netlbl\_req\_delattr(req); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:31:17 +0000



=== Content from git.kernel.org_b879333d_20250111_123244.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d3f56c653c65f170b172d3c23120bc64ada645d8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3f56c653c65f170b172d3c23120bc64ada645d8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3f56c653c65f170b172d3c23120bc64ada645d8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3f56c653c65f170b172d3c23120bc64ada645d8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Casey Schaufler <casey@schaufler-ca.com> | 2024-06-05 15:41:50 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:02:50 +0200 |
| commit | [d3f56c653c65f170b172d3c23120bc64ada645d8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3f56c653c65f170b172d3c23120bc64ada645d8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d3f56c653c65f170b172d3c23120bc64ada645d8)) | |
| tree | [44184c05af771407ee870c9f2447766fe1ea6aba](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3f56c653c65f170b172d3c23120bc64ada645d8) | |
| parent | [ebc88484fc780068bce82e9a593513f7f9ed947c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ebc88484fc780068bce82e9a593513f7f9ed947c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3f56c653c65f170b172d3c23120bc64ada645d8&id2=ebc88484fc780068bce82e9a593513f7f9ed947c)) | |
| download | [linux-d3f56c653c65f170b172d3c23120bc64ada645d8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d3f56c653c65f170b172d3c23120bc64ada645d8.tar.gz) | |

smack: tcp: ipv4, fix incorrect labeling[ Upstream commit 2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550 ]
Currently, Smack mirrors the label of incoming tcp/ipv4 connections:
when a label 'foo' connects to a label 'bar' with tcp/ipv4,
'foo' always gets 'foo' in returned ipv4 packets. So,
1) returned packets are incorrectly labeled ('foo' instead of 'bar')
2) 'bar' can write to 'foo' without being authorized to write.
Here is a scenario how to see this:
\* Take two machines, let's call them C and S,
with active Smack in the default state
(no settings, no rules, no labeled hosts, only builtin labels)
\* At S, add Smack rule 'foo bar w'
(labels 'foo' and 'bar' are instantiated at S at this moment)
\* At S, at label 'bar', launch a program
that listens for incoming tcp/ipv4 connections
\* From C, at label 'foo', connect to the listener at S.
(label 'foo' is instantiated at C at this moment)
Connection succeedes and works.
\* Send some data in both directions.
\* Collect network traffic of this connection.
All packets in both directions are labeled with the CIPSO
of the label 'foo'. Hence, label 'bar' writes to 'foo' without
being authorized, and even without ever being known at C.
If anybody cares: exactly the same happens with DCCP.
This behavior 1st manifested in release 2.6.29.4 (see Fixes below)
and it looks unintentional. At least, no explanation was provided.
I changed returned packes label into the 'bar',
to bring it into line with the Smack documentation claims.
Signed-off-by: Konstantin Andreev <andreev@swemel.ru>
Signed-off-by: Casey Schaufler <casey@schaufler-ca.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3f56c653c65f170b172d3c23120bc64ada645d8)

| -rw-r--r-- | [security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/security/smack/smack_lsm.c?id=d3f56c653c65f170b172d3c23120bc64ada645d8) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/security/smack/smack\_lsm.c b/security/smack/smack\_lsm.cindex d9bff4ba7f2e82..158f4df39be446 100644--- a/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=ebc88484fc780068bce82e9a593513f7f9ed947c)+++ b/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=d3f56c653c65f170b172d3c23120bc64ada645d8)@@ -4291,7 +4291,7 @@ access\_check: rcu\_read\_unlock();  if (hskp == NULL)- rc = netlbl\_req\_setattr(req, &skp->smk\_netlabel);+ rc = netlbl\_req\_setattr(req, &ssp->smk\_out->smk\_netlabel); else netlbl\_req\_delattr(req); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:31:21 +0000



=== Content from git.kernel.org_75abacb3_20250111_123242.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5b4b304f196c070342e32a4752e1fa2e22fc0671)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5b4b304f196c070342e32a4752e1fa2e22fc0671)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5b4b304f196c070342e32a4752e1fa2e22fc0671)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5b4b304f196c070342e32a4752e1fa2e22fc0671)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Casey Schaufler <casey@schaufler-ca.com> | 2024-06-05 15:41:50 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:03:50 +0200 |
| commit | [5b4b304f196c070342e32a4752e1fa2e22fc0671](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5b4b304f196c070342e32a4752e1fa2e22fc0671) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5b4b304f196c070342e32a4752e1fa2e22fc0671)) | |
| tree | [7c1d5a0929a55aa41c0c2d8ec0a42fd34113a26b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5b4b304f196c070342e32a4752e1fa2e22fc0671) | |
| parent | [8095bf0579ed4906a33f7bec675bfb29b6b16a3b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8095bf0579ed4906a33f7bec675bfb29b6b16a3b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5b4b304f196c070342e32a4752e1fa2e22fc0671&id2=8095bf0579ed4906a33f7bec675bfb29b6b16a3b)) | |
| download | [linux-5b4b304f196c070342e32a4752e1fa2e22fc0671.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5b4b304f196c070342e32a4752e1fa2e22fc0671.tar.gz) | |

smack: tcp: ipv4, fix incorrect labeling[ Upstream commit 2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550 ]
Currently, Smack mirrors the label of incoming tcp/ipv4 connections:
when a label 'foo' connects to a label 'bar' with tcp/ipv4,
'foo' always gets 'foo' in returned ipv4 packets. So,
1) returned packets are incorrectly labeled ('foo' instead of 'bar')
2) 'bar' can write to 'foo' without being authorized to write.
Here is a scenario how to see this:
\* Take two machines, let's call them C and S,
with active Smack in the default state
(no settings, no rules, no labeled hosts, only builtin labels)
\* At S, add Smack rule 'foo bar w'
(labels 'foo' and 'bar' are instantiated at S at this moment)
\* At S, at label 'bar', launch a program
that listens for incoming tcp/ipv4 connections
\* From C, at label 'foo', connect to the listener at S.
(label 'foo' is instantiated at C at this moment)
Connection succeedes and works.
\* Send some data in both directions.
\* Collect network traffic of this connection.
All packets in both directions are labeled with the CIPSO
of the label 'foo'. Hence, label 'bar' writes to 'foo' without
being authorized, and even without ever being known at C.
If anybody cares: exactly the same happens with DCCP.
This behavior 1st manifested in release 2.6.29.4 (see Fixes below)
and it looks unintentional. At least, no explanation was provided.
I changed returned packes label into the 'bar',
to bring it into line with the Smack documentation claims.
Signed-off-by: Konstantin Andreev <andreev@swemel.ru>
Signed-off-by: Casey Schaufler <casey@schaufler-ca.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5b4b304f196c070342e32a4752e1fa2e22fc0671)

| -rw-r--r-- | [security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/security/smack/smack_lsm.c?id=5b4b304f196c070342e32a4752e1fa2e22fc0671) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/security/smack/smack\_lsm.c b/security/smack/smack\_lsm.cindex 072ce1ef6efb70..7d04b21737cf50 100644--- a/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=8095bf0579ed4906a33f7bec675bfb29b6b16a3b)+++ b/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=5b4b304f196c070342e32a4752e1fa2e22fc0671)@@ -4196,7 +4196,7 @@ access\_check: rcu\_read\_unlock();  if (hskp == NULL)- rc = netlbl\_req\_setattr(req, &skp->smk\_netlabel);+ rc = netlbl\_req\_setattr(req, &ssp->smk\_out->smk\_netlabel); else netlbl\_req\_delattr(req); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:31:20 +0000



=== Content from git.kernel.org_0b6ac09e_20250111_123243.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a948ec993541db4ef392b555c37a1186f4d61670)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a948ec993541db4ef392b555c37a1186f4d61670)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a948ec993541db4ef392b555c37a1186f4d61670)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a948ec993541db4ef392b555c37a1186f4d61670)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Casey Schaufler <casey@schaufler-ca.com> | 2024-06-05 15:41:50 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:06:41 +0200 |
| commit | [a948ec993541db4ef392b555c37a1186f4d61670](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a948ec993541db4ef392b555c37a1186f4d61670) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a948ec993541db4ef392b555c37a1186f4d61670)) | |
| tree | [cbb3f43f28182e4c073ce587266cb7c2a5909663](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a948ec993541db4ef392b555c37a1186f4d61670) | |
| parent | [3f3ef1d9f66b93913ce2171120d9226b55acd41d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3f3ef1d9f66b93913ce2171120d9226b55acd41d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a948ec993541db4ef392b555c37a1186f4d61670&id2=3f3ef1d9f66b93913ce2171120d9226b55acd41d)) | |
| download | [linux-a948ec993541db4ef392b555c37a1186f4d61670.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a948ec993541db4ef392b555c37a1186f4d61670.tar.gz) | |

smack: tcp: ipv4, fix incorrect labeling[ Upstream commit 2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550 ]
Currently, Smack mirrors the label of incoming tcp/ipv4 connections:
when a label 'foo' connects to a label 'bar' with tcp/ipv4,
'foo' always gets 'foo' in returned ipv4 packets. So,
1) returned packets are incorrectly labeled ('foo' instead of 'bar')
2) 'bar' can write to 'foo' without being authorized to write.
Here is a scenario how to see this:
\* Take two machines, let's call them C and S,
with active Smack in the default state
(no settings, no rules, no labeled hosts, only builtin labels)
\* At S, add Smack rule 'foo bar w'
(labels 'foo' and 'bar' are instantiated at S at this moment)
\* At S, at label 'bar', launch a program
that listens for incoming tcp/ipv4 connections
\* From C, at label 'foo', connect to the listener at S.
(label 'foo' is instantiated at C at this moment)
Connection succeedes and works.
\* Send some data in both directions.
\* Collect network traffic of this connection.
All packets in both directions are labeled with the CIPSO
of the label 'foo'. Hence, label 'bar' writes to 'foo' without
being authorized, and even without ever being known at C.
If anybody cares: exactly the same happens with DCCP.
This behavior 1st manifested in release 2.6.29.4 (see Fixes below)
and it looks unintentional. At least, no explanation was provided.
I changed returned packes label into the 'bar',
to bring it into line with the Smack documentation claims.
Signed-off-by: Konstantin Andreev <andreev@swemel.ru>
Signed-off-by: Casey Schaufler <casey@schaufler-ca.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a948ec993541db4ef392b555c37a1186f4d61670)

| -rw-r--r-- | [security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/security/smack/smack_lsm.c?id=a948ec993541db4ef392b555c37a1186f4d61670) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/security/smack/smack\_lsm.c b/security/smack/smack\_lsm.cindex 8c790563b33acf..88bcda1f07bff8 100644--- a/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=3f3ef1d9f66b93913ce2171120d9226b55acd41d)+++ b/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=a948ec993541db4ef392b555c37a1186f4d61670)@@ -4228,7 +4228,7 @@ static int smack\_inet\_conn\_request(struct sock \*sk, struct sk\_buff \*skb, rcu\_read\_unlock();  if (hskp == NULL)- rc = netlbl\_req\_setattr(req, &skp->smk\_netlabel);+ rc = netlbl\_req\_setattr(req, &ssp->smk\_out->smk\_netlabel); else netlbl\_req\_delattr(req); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:31:20 +0000



=== Content from git.kernel.org_94911f09_20250111_123240.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0aea09e82eafa50a373fc8a4b84c1d4734751e2c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0aea09e82eafa50a373fc8a4b84c1d4734751e2c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0aea09e82eafa50a373fc8a4b84c1d4734751e2c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0aea09e82eafa50a373fc8a4b84c1d4734751e2c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Casey Schaufler <casey@schaufler-ca.com> | 2024-06-05 15:41:50 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:07:41 +0200 |
| commit | [0aea09e82eafa50a373fc8a4b84c1d4734751e2c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0aea09e82eafa50a373fc8a4b84c1d4734751e2c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0aea09e82eafa50a373fc8a4b84c1d4734751e2c)) | |
| tree | [40c9cf67cf611a1ddb4528ba7f61b91860a471c2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0aea09e82eafa50a373fc8a4b84c1d4734751e2c) | |
| parent | [f9a48bc3dd9099935751458a5bbbea4b7c28abc8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f9a48bc3dd9099935751458a5bbbea4b7c28abc8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0aea09e82eafa50a373fc8a4b84c1d4734751e2c&id2=f9a48bc3dd9099935751458a5bbbea4b7c28abc8)) | |
| download | [linux-0aea09e82eafa50a373fc8a4b84c1d4734751e2c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0aea09e82eafa50a373fc8a4b84c1d4734751e2c.tar.gz) | |

smack: tcp: ipv4, fix incorrect labeling[ Upstream commit 2fe209d0ad2e2729f7e22b9b31a86cc3ff0db550 ]
Currently, Smack mirrors the label of incoming tcp/ipv4 connections:
when a label 'foo' connects to a label 'bar' with tcp/ipv4,
'foo' always gets 'foo' in returned ipv4 packets. So,
1) returned packets are incorrectly labeled ('foo' instead of 'bar')
2) 'bar' can write to 'foo' without being authorized to write.
Here is a scenario how to see this:
\* Take two machines, let's call them C and S,
with active Smack in the default state
(no settings, no rules, no labeled hosts, only builtin labels)
\* At S, add Smack rule 'foo bar w'
(labels 'foo' and 'bar' are instantiated at S at this moment)
\* At S, at label 'bar', launch a program
that listens for incoming tcp/ipv4 connections
\* From C, at label 'foo', connect to the listener at S.
(label 'foo' is instantiated at C at this moment)
Connection succeedes and works.
\* Send some data in both directions.
\* Collect network traffic of this connection.
All packets in both directions are labeled with the CIPSO
of the label 'foo'. Hence, label 'bar' writes to 'foo' without
being authorized, and even without ever being known at C.
If anybody cares: exactly the same happens with DCCP.
This behavior 1st manifested in release 2.6.29.4 (see Fixes below)
and it looks unintentional. At least, no explanation was provided.
I changed returned packes label into the 'bar',
to bring it into line with the Smack documentation claims.
Signed-off-by: Konstantin Andreev <andreev@swemel.ru>
Signed-off-by: Casey Schaufler <casey@schaufler-ca.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0aea09e82eafa50a373fc8a4b84c1d4734751e2c)

| -rw-r--r-- | [security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/security/smack/smack_lsm.c?id=0aea09e82eafa50a373fc8a4b84c1d4734751e2c) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/security/smack/smack\_lsm.c b/security/smack/smack\_lsm.cindex e9d2ef3deccd1e..25c46b56fae8d4 100644--- a/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=f9a48bc3dd9099935751458a5bbbea4b7c28abc8)+++ b/[security/smack/smack\_lsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/smack/smack_lsm.c?id=0aea09e82eafa50a373fc8a4b84c1d4734751e2c)@@ -4225,7 +4225,7 @@ static int smack\_inet\_conn\_request(const struct sock \*sk, struct sk\_buff \*skb, rcu\_read\_unlock();  if (hskp == NULL)- rc = netlbl\_req\_setattr(req, &skp->smk\_netlabel);+ rc = netlbl\_req\_setattr(req, &ssp->smk\_out->smk\_netlabel); else netlbl\_req\_delattr(req); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:31:17 +0000


