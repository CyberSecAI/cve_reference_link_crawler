<!DOCTYPE html>
<html lang='en'>
<head>
<title>Bluetooth: HCI: Remove HCI_AMP support - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='d3c7b012d912b31ad23b9349c0e499d6dddd48ec'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='d3c7b012d912b31ad23b9349c0e499d6dddd48ec'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='d3c7b012d912b31ad23b9349c0e499d6dddd48ec'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Luiz Augusto von Dentz &lt;luiz.von.dentz@intel.com&gt;</td><td class='right'>2024-05-06 18:33:52 -0400</td></tr>
<tr><th>committer</th><td>Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;</td><td class='right'>2024-05-30 09:49:30 +0200</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>d3c7b012d912b31ad23b9349c0e499d6dddd48ec</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>71e0d5723d80a5639f551a9148ad30fe32882e3b</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>ba0eee5763ea5f571359aa10629f08a6e81a9cb8</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec&amp;id2=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d3c7b012d912b31ad23b9349c0e499d6dddd48ec.tar.gz'>linux-d3c7b012d912b31ad23b9349c0e499d6dddd48ec.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>Bluetooth: HCI: Remove HCI_AMP support</div><div class='commit-msg'>[ Upstream commit 84a4bb6548a29326564f0e659fb8064503ecc1c7 ]

Since BT_HS has been remove HCI_AMP controllers no longer has any use so
remove it along with the capability of creating AMP controllers.

Since we no longer need to differentiate between AMP and Primary
controllers, as only HCI_PRIMARY is left, this also remove
hdev-&gt;dev_type altogether.

Fixes: e7b02296fb40 ("Bluetooth: Remove BT_HS")
Signed-off-by: Luiz Augusto von Dentz &lt;luiz.von.dentz@intel.com&gt;
Signed-off-by: Sasha Levin &lt;sashal@kernel.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/btmrvl_main.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/btmrvl_main.c</a></td><td class='right'>9</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 6.1%;'/><td class='none' style='width: 93.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/btrsi.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/btrsi.c</a></td><td class='right'>1</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 0.7%;'/><td class='none' style='width: 99.3%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/btsdio.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/btsdio.c</a></td><td class='right'>8</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 5.4%;'/><td class='none' style='width: 94.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/btusb.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/btusb.c</a></td><td class='right'>5</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 3.4%;'/><td class='none' style='width: 96.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/hci_bcm4377.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/hci_bcm4377.c</a></td><td class='right'>1</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 0.7%;'/><td class='none' style='width: 99.3%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/hci_ldisc.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/hci_ldisc.c</a></td><td class='right'>6</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 4.1%;'/><td class='none' style='width: 95.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/hci_serdev.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/hci_serdev.c</a></td><td class='right'>5</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 3.4%;'/><td class='none' style='width: 96.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/hci_uart.h?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/hci_uart.h</a></td><td class='right'>1</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 0.7%;'/><td class='none' style='width: 99.3%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/hci_vhci.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/hci_vhci.c</a></td><td class='right'>10</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.7%;'/><td class='rem' style='width: 6.1%;'/><td class='none' style='width: 93.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/virtio_bt.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/virtio_bt.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 1.4%;'/><td class='none' style='width: 98.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/include/net/bluetooth/hci.h?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>include/net/bluetooth/hci.h</a></td><td class='right'>114</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 77.6%;'/><td class='none' style='width: 22.4%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/include/net/bluetooth/hci_core.h?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>include/net/bluetooth/hci_core.h</a></td><td class='right'>46</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.7%;'/><td class='rem' style='width: 30.6%;'/><td class='none' style='width: 68.7%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/include/uapi/linux/virtio_bt.h?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>include/uapi/linux/virtio_bt.h</a></td><td class='right'>1</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 0.7%;'/><td class='none' style='width: 99.3%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_conn.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/hci_conn.c</a></td><td class='right'>3</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.7%;'/><td class='rem' style='width: 1.4%;'/><td class='none' style='width: 98.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_core.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/hci_core.c</a></td><td class='right'>132</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 6.8%;'/><td class='rem' style='width: 83.0%;'/><td class='none' style='width: 10.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_event.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/hci_event.c</a></td><td class='right'>147</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 100.0%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_sock.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/hci_sock.c</a></td><td class='right'>5</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.7%;'/><td class='rem' style='width: 2.7%;'/><td class='none' style='width: 96.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_sync.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/hci_sync.c</a></td><td class='right'>112</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 2.7%;'/><td class='rem' style='width: 73.5%;'/><td class='none' style='width: 23.8%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/l2cap_core.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/l2cap_core.c</a></td><td class='right'>21</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 2.7%;'/><td class='rem' style='width: 11.6%;'/><td class='none' style='width: 85.7%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/mgmt.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/mgmt.c</a></td><td class='right'>84</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 18.4%;'/><td class='rem' style='width: 38.8%;'/><td class='none' style='width: 42.9%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>20 files changed, 49 insertions, 664 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/drivers/bluetooth/btmrvl_main.c b/drivers/bluetooth/btmrvl_main.c<br/>index 9658b33c824a70..18f34998a1204a 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btmrvl_main.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>drivers/bluetooth/btmrvl_main.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btmrvl_main.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/btmrvl_main.c</a></div><div class='hunk'>@@ -121,13 +121,6 @@ int btmrvl_process_event(struct btmrvl_private *priv, struct sk_buff *skb)</div><div class='ctx'> 				((event-&gt;data[2] == MODULE_BROUGHT_UP) ||</div><div class='ctx'> 				(event-&gt;data[2] == MODULE_ALREADY_UP)) ?</div><div class='ctx'> 				"Bring-up succeed" : "Bring-up failed");</div><div class='del'>-</div><div class='del'>-			if (event-&gt;length &gt; 3 &amp;&amp; event-&gt;data[3])</div><div class='del'>-				priv-&gt;btmrvl_dev.dev_type = HCI_AMP;</div><div class='del'>-			else</div><div class='del'>-				priv-&gt;btmrvl_dev.dev_type = HCI_PRIMARY;</div><div class='del'>-</div><div class='del'>-			BT_DBG("dev_type: %d", priv-&gt;btmrvl_dev.dev_type);</div><div class='ctx'> 		} else if (priv-&gt;btmrvl_dev.sendcmdflag &amp;&amp;</div><div class='ctx'> 				event-&gt;data[1] == MODULE_SHUTDOWN_REQ) {</div><div class='ctx'> 			BT_DBG("EVENT:%s", (event-&gt;data[2]) ?</div><div class='hunk'>@@ -686,8 +679,6 @@ int btmrvl_register_hdev(struct btmrvl_private *priv)</div><div class='ctx'> 	hdev-&gt;wakeup = btmrvl_wakeup;</div><div class='ctx'> 	SET_HCIDEV_DEV(hdev, &amp;card-&gt;func-&gt;dev);</div><div class='ctx'> </div><div class='del'>-	hdev-&gt;dev_type = priv-&gt;btmrvl_dev.dev_type;</div><div class='del'>-</div><div class='ctx'> 	ret = hci_register_dev(hdev);</div><div class='ctx'> 	if (ret &lt; 0) {</div><div class='ctx'> 		BT_ERR("Can not register HCI device");</div><div class='head'>diff --git a/drivers/bluetooth/btrsi.c b/drivers/bluetooth/btrsi.c<br/>index 634cf8f5ed2dbd..0c91d7635ac39e 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btrsi.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>drivers/bluetooth/btrsi.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btrsi.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/btrsi.c</a></div><div class='hunk'>@@ -134,7 +134,6 @@ static int rsi_hci_attach(void *priv, struct rsi_proto_ops *ops)</div><div class='ctx'> 		hdev-&gt;bus = HCI_USB;</div><div class='ctx'> </div><div class='ctx'> 	hci_set_drvdata(hdev, h_adapter);</div><div class='del'>-	hdev-&gt;dev_type = HCI_PRIMARY;</div><div class='ctx'> 	hdev-&gt;open = rsi_hci_open;</div><div class='ctx'> 	hdev-&gt;close = rsi_hci_close;</div><div class='ctx'> 	hdev-&gt;flush = rsi_hci_flush;</div><div class='head'>diff --git a/drivers/bluetooth/btsdio.c b/drivers/bluetooth/btsdio.c<br/>index f19d31ee37ea89..fdcfe9c50313ea 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btsdio.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>drivers/bluetooth/btsdio.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btsdio.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/btsdio.c</a></div><div class='hunk'>@@ -32,9 +32,6 @@ static const struct sdio_device_id btsdio_table[] = {</div><div class='ctx'> 	/* Generic Bluetooth Type-B SDIO device */</div><div class='ctx'> 	{ SDIO_DEVICE_CLASS(SDIO_CLASS_BT_B) },</div><div class='ctx'> </div><div class='del'>-	/* Generic Bluetooth AMP controller */</div><div class='del'>-	{ SDIO_DEVICE_CLASS(SDIO_CLASS_BT_AMP) },</div><div class='del'>-</div><div class='ctx'> 	{ }	/* Terminating entry */</div><div class='ctx'> };</div><div class='ctx'> </div><div class='hunk'>@@ -319,11 +316,6 @@ static int btsdio_probe(struct sdio_func *func,</div><div class='ctx'> 	hdev-&gt;bus = HCI_SDIO;</div><div class='ctx'> 	hci_set_drvdata(hdev, data);</div><div class='ctx'> </div><div class='del'>-	if (id-&gt;class == SDIO_CLASS_BT_AMP)</div><div class='del'>-		hdev-&gt;dev_type = HCI_AMP;</div><div class='del'>-	else</div><div class='del'>-		hdev-&gt;dev_type = HCI_PRIMARY;</div><div class='del'>-</div><div class='ctx'> 	data-&gt;hdev = hdev;</div><div class='ctx'> </div><div class='ctx'> 	SET_HCIDEV_DEV(hdev, &amp;func-&gt;dev);</div><div class='head'>diff --git a/drivers/bluetooth/btusb.c b/drivers/bluetooth/btusb.c<br/>index effa5462964866..a1b82abe06c5f1 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btusb.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>drivers/bluetooth/btusb.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btusb.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/btusb.c</a></div><div class='hunk'>@@ -4314,11 +4314,6 @@ static int btusb_probe(struct usb_interface *intf,</div><div class='ctx'> 	hdev-&gt;bus = HCI_USB;</div><div class='ctx'> 	hci_set_drvdata(hdev, data);</div><div class='ctx'> </div><div class='del'>-	if (id-&gt;driver_info &amp; BTUSB_AMP)</div><div class='del'>-		hdev-&gt;dev_type = HCI_AMP;</div><div class='del'>-	else</div><div class='del'>-		hdev-&gt;dev_type = HCI_PRIMARY;</div><div class='del'>-</div><div class='ctx'> 	data-&gt;hdev = hdev;</div><div class='ctx'> </div><div class='ctx'> 	SET_HCIDEV_DEV(hdev, &amp;intf-&gt;dev);</div><div class='head'>diff --git a/drivers/bluetooth/hci_bcm4377.c b/drivers/bluetooth/hci_bcm4377.c<br/>index 9a7243d5db71ff..0c2f15235b4cda 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_bcm4377.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>drivers/bluetooth/hci_bcm4377.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_bcm4377.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/hci_bcm4377.c</a></div><div class='hunk'>@@ -2361,7 +2361,6 @@ static int bcm4377_probe(struct pci_dev *pdev, const struct pci_device_id *id)</div><div class='ctx'> 	bcm4377-&gt;hdev = hdev;</div><div class='ctx'> </div><div class='ctx'> 	hdev-&gt;bus = HCI_PCI;</div><div class='del'>-	hdev-&gt;dev_type = HCI_PRIMARY;</div><div class='ctx'> 	hdev-&gt;open = bcm4377_hci_open;</div><div class='ctx'> 	hdev-&gt;close = bcm4377_hci_close;</div><div class='ctx'> 	hdev-&gt;send = bcm4377_hci_send_frame;</div><div class='head'>diff --git a/drivers/bluetooth/hci_ldisc.c b/drivers/bluetooth/hci_ldisc.c<br/>index a26367e9fb197c..17a2f158a0dfab 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_ldisc.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>drivers/bluetooth/hci_ldisc.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_ldisc.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/hci_ldisc.c</a></div><div class='hunk'>@@ -667,11 +667,6 @@ static int hci_uart_register_dev(struct hci_uart *hu)</div><div class='ctx'> 	if (!test_bit(HCI_UART_RESET_ON_INIT, &amp;hu-&gt;hdev_flags))</div><div class='ctx'> 		set_bit(HCI_QUIRK_RESET_ON_CLOSE, &amp;hdev-&gt;quirks);</div><div class='ctx'> </div><div class='del'>-	if (test_bit(HCI_UART_CREATE_AMP, &amp;hu-&gt;hdev_flags))</div><div class='del'>-		hdev-&gt;dev_type = HCI_AMP;</div><div class='del'>-	else</div><div class='del'>-		hdev-&gt;dev_type = HCI_PRIMARY;</div><div class='del'>-</div><div class='ctx'> 	/* Only call open() for the protocol after hdev is fully initialized as</div><div class='ctx'> 	 * open() (or a timer/workqueue it starts) may attempt to reference it.</div><div class='ctx'> 	 */</div><div class='hunk'>@@ -722,7 +717,6 @@ static int hci_uart_set_flags(struct hci_uart *hu, unsigned long flags)</div><div class='ctx'> {</div><div class='ctx'> 	unsigned long valid_flags = BIT(HCI_UART_RAW_DEVICE) |</div><div class='ctx'> 				    BIT(HCI_UART_RESET_ON_INIT) |</div><div class='del'>-				    BIT(HCI_UART_CREATE_AMP) |</div><div class='ctx'> 				    BIT(HCI_UART_INIT_PENDING) |</div><div class='ctx'> 				    BIT(HCI_UART_EXT_CONFIG) |</div><div class='ctx'> 				    BIT(HCI_UART_VND_DETECT);</div><div class='head'>diff --git a/drivers/bluetooth/hci_serdev.c b/drivers/bluetooth/hci_serdev.c<br/>index 214fff876eae50..0eaec878fa1d84 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_serdev.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>drivers/bluetooth/hci_serdev.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_serdev.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/hci_serdev.c</a></div><div class='hunk'>@@ -366,11 +366,6 @@ int hci_uart_register_device_priv(struct hci_uart *hu,</div><div class='ctx'> 	if (test_bit(HCI_UART_EXT_CONFIG, &amp;hu-&gt;hdev_flags))</div><div class='ctx'> 		set_bit(HCI_QUIRK_EXTERNAL_CONFIG, &amp;hdev-&gt;quirks);</div><div class='ctx'> </div><div class='del'>-	if (test_bit(HCI_UART_CREATE_AMP, &amp;hu-&gt;hdev_flags))</div><div class='del'>-		hdev-&gt;dev_type = HCI_AMP;</div><div class='del'>-	else</div><div class='del'>-		hdev-&gt;dev_type = HCI_PRIMARY;</div><div class='del'>-</div><div class='ctx'> 	if (test_bit(HCI_UART_INIT_PENDING, &amp;hu-&gt;hdev_flags))</div><div class='ctx'> 		return 0;</div><div class='ctx'> </div><div class='head'>diff --git a/drivers/bluetooth/hci_uart.h b/drivers/bluetooth/hci_uart.h<br/>index 68c8c7e95d64dc..00bf7ae82c5b72 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_uart.h?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>drivers/bluetooth/hci_uart.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_uart.h?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/hci_uart.h</a></div><div class='hunk'>@@ -37,7 +37,6 @@</div><div class='ctx'> </div><div class='ctx'> #define HCI_UART_RAW_DEVICE	0</div><div class='ctx'> #define HCI_UART_RESET_ON_INIT	1</div><div class='del'>-#define HCI_UART_CREATE_AMP	2</div><div class='ctx'> #define HCI_UART_INIT_PENDING	3</div><div class='ctx'> #define HCI_UART_EXT_CONFIG	4</div><div class='ctx'> #define HCI_UART_VND_DETECT	5</div><div class='head'>diff --git a/drivers/bluetooth/hci_vhci.c b/drivers/bluetooth/hci_vhci.c<br/>index 572d68d52965f6..28750a40f0ed52 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_vhci.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>drivers/bluetooth/hci_vhci.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_vhci.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/hci_vhci.c</a></div><div class='hunk'>@@ -384,17 +384,10 @@ static int __vhci_create_device(struct vhci_data *data, __u8 opcode)</div><div class='ctx'> {</div><div class='ctx'> 	struct hci_dev *hdev;</div><div class='ctx'> 	struct sk_buff *skb;</div><div class='del'>-	__u8 dev_type;</div><div class='ctx'> </div><div class='ctx'> 	if (data-&gt;hdev)</div><div class='ctx'> 		return -EBADFD;</div><div class='ctx'> </div><div class='del'>-	/* bits 0-1 are dev_type (Primary or AMP) */</div><div class='del'>-	dev_type = opcode &amp; 0x03;</div><div class='del'>-</div><div class='del'>-	if (dev_type != HCI_PRIMARY &amp;&amp; dev_type != HCI_AMP)</div><div class='del'>-		return -EINVAL;</div><div class='del'>-</div><div class='ctx'> 	/* bits 2-5 are reserved (must be zero) */</div><div class='ctx'> 	if (opcode &amp; 0x3c)</div><div class='ctx'> 		return -EINVAL;</div><div class='hunk'>@@ -412,7 +405,6 @@ static int __vhci_create_device(struct vhci_data *data, __u8 opcode)</div><div class='ctx'> 	data-&gt;hdev = hdev;</div><div class='ctx'> </div><div class='ctx'> 	hdev-&gt;bus = HCI_VIRTUAL;</div><div class='del'>-	hdev-&gt;dev_type = dev_type;</div><div class='ctx'> 	hci_set_drvdata(hdev, data);</div><div class='ctx'> </div><div class='ctx'> 	hdev-&gt;open  = vhci_open_dev;</div><div class='hunk'>@@ -634,7 +626,7 @@ static void vhci_open_timeout(struct work_struct *work)</div><div class='ctx'> 	struct vhci_data *data = container_of(work, struct vhci_data,</div><div class='ctx'> 					      open_timeout.work);</div><div class='ctx'> </div><div class='del'>-	vhci_create_device(data, amp ? HCI_AMP : HCI_PRIMARY);</div><div class='add'>+	vhci_create_device(data, 0x00);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static int vhci_open(struct inode *inode, struct file *file)</div><div class='head'>diff --git a/drivers/bluetooth/virtio_bt.c b/drivers/bluetooth/virtio_bt.c<br/>index 2ac70b560c46db..18208e152a3675 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/virtio_bt.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>drivers/bluetooth/virtio_bt.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/virtio_bt.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>drivers/bluetooth/virtio_bt.c</a></div><div class='hunk'>@@ -274,7 +274,6 @@ static int virtbt_probe(struct virtio_device *vdev)</div><div class='ctx'> </div><div class='ctx'> 	switch (type) {</div><div class='ctx'> 	case VIRTIO_BT_CONFIG_TYPE_PRIMARY:</div><div class='del'>-	case VIRTIO_BT_CONFIG_TYPE_AMP:</div><div class='ctx'> 		break;</div><div class='ctx'> 	default:</div><div class='ctx'> 		return -EINVAL;</div><div class='hunk'>@@ -303,7 +302,6 @@ static int virtbt_probe(struct virtio_device *vdev)</div><div class='ctx'> 	vbt-&gt;hdev = hdev;</div><div class='ctx'> </div><div class='ctx'> 	hdev-&gt;bus = HCI_VIRTIO;</div><div class='del'>-	hdev-&gt;dev_type = type;</div><div class='ctx'> 	hci_set_drvdata(hdev, vbt);</div><div class='ctx'> </div><div class='ctx'> 	hdev-&gt;open  = virtbt_open;</div><div class='head'>diff --git a/include/net/bluetooth/hci.h b/include/net/bluetooth/hci.h<br/>index f9db2d1ca5d370..55f95a93c0d7ce 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/bluetooth/hci.h?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>include/net/bluetooth/hci.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/bluetooth/hci.h?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>include/net/bluetooth/hci.h</a></div><div class='hunk'>@@ -33,9 +33,6 @@</div><div class='ctx'> #define HCI_MAX_FRAME_SIZE	(HCI_MAX_ACL_SIZE + 4)</div><div class='ctx'> </div><div class='ctx'> #define HCI_LINK_KEY_SIZE	16</div><div class='del'>-#define HCI_AMP_LINK_KEY_SIZE	(2 * HCI_LINK_KEY_SIZE)</div><div class='del'>-</div><div class='del'>-#define HCI_MAX_AMP_ASSOC_SIZE	672</div><div class='ctx'> </div><div class='ctx'> #define HCI_MAX_CPB_DATA_SIZE	252</div><div class='ctx'> </div><div class='hunk'>@@ -71,26 +68,6 @@</div><div class='ctx'> #define HCI_SMD		9</div><div class='ctx'> #define HCI_VIRTIO	10</div><div class='ctx'> </div><div class='del'>-/* HCI controller types */</div><div class='del'>-#define HCI_PRIMARY	0x00</div><div class='del'>-#define HCI_AMP		0x01</div><div class='del'>-</div><div class='del'>-/* First BR/EDR Controller shall have ID = 0 */</div><div class='del'>-#define AMP_ID_BREDR	0x00</div><div class='del'>-</div><div class='del'>-/* AMP controller types */</div><div class='del'>-#define AMP_TYPE_BREDR	0x00</div><div class='del'>-#define AMP_TYPE_80211	0x01</div><div class='del'>-</div><div class='del'>-/* AMP controller status */</div><div class='del'>-#define AMP_STATUS_POWERED_DOWN			0x00</div><div class='del'>-#define AMP_STATUS_BLUETOOTH_ONLY		0x01</div><div class='del'>-#define AMP_STATUS_NO_CAPACITY			0x02</div><div class='del'>-#define AMP_STATUS_LOW_CAPACITY			0x03</div><div class='del'>-#define AMP_STATUS_MEDIUM_CAPACITY		0x04</div><div class='del'>-#define AMP_STATUS_HIGH_CAPACITY		0x05</div><div class='del'>-#define AMP_STATUS_FULL_CAPACITY		0x06</div><div class='del'>-</div><div class='ctx'> /* HCI device quirks */</div><div class='ctx'> enum {</div><div class='ctx'> 	/* When this quirk is set, the HCI Reset command is send when</div><div class='hunk'>@@ -527,7 +504,6 @@ enum {</div><div class='ctx'> #define ESCO_LINK	0x02</div><div class='ctx'> /* Low Energy links do not have defined link type. Use invented one */</div><div class='ctx'> #define LE_LINK		0x80</div><div class='del'>-#define AMP_LINK	0x81</div><div class='ctx'> #define ISO_LINK	0x82</div><div class='ctx'> #define INVALID_LINK	0xff</div><div class='ctx'> </div><div class='hunk'>@@ -943,56 +919,6 @@ struct hci_cp_io_capability_neg_reply {</div><div class='ctx'> 	__u8     reason;</div><div class='ctx'> } __packed;</div><div class='ctx'> </div><div class='del'>-#define HCI_OP_CREATE_PHY_LINK		0x0435</div><div class='del'>-struct hci_cp_create_phy_link {</div><div class='del'>-	__u8     phy_handle;</div><div class='del'>-	__u8     key_len;</div><div class='del'>-	__u8     key_type;</div><div class='del'>-	__u8     key[HCI_AMP_LINK_KEY_SIZE];</div><div class='del'>-} __packed;</div><div class='del'>-</div><div class='del'>-#define HCI_OP_ACCEPT_PHY_LINK		0x0436</div><div class='del'>-struct hci_cp_accept_phy_link {</div><div class='del'>-	__u8     phy_handle;</div><div class='del'>-	__u8     key_len;</div><div class='del'>-	__u8     key_type;</div><div class='del'>-	__u8     key[HCI_AMP_LINK_KEY_SIZE];</div><div class='del'>-} __packed;</div><div class='del'>-</div><div class='del'>-#define HCI_OP_DISCONN_PHY_LINK		0x0437</div><div class='del'>-struct hci_cp_disconn_phy_link {</div><div class='del'>-	__u8     phy_handle;</div><div class='del'>-	__u8     reason;</div><div class='del'>-} __packed;</div><div class='del'>-</div><div class='del'>-struct ext_flow_spec {</div><div class='del'>-	__u8       id;</div><div class='del'>-	__u8       stype;</div><div class='del'>-	__le16     msdu;</div><div class='del'>-	__le32     sdu_itime;</div><div class='del'>-	__le32     acc_lat;</div><div class='del'>-	__le32     flush_to;</div><div class='del'>-} __packed;</div><div class='del'>-</div><div class='del'>-#define HCI_OP_CREATE_LOGICAL_LINK	0x0438</div><div class='del'>-#define HCI_OP_ACCEPT_LOGICAL_LINK	0x0439</div><div class='del'>-struct hci_cp_create_accept_logical_link {</div><div class='del'>-	__u8                  phy_handle;</div><div class='del'>-	struct ext_flow_spec  tx_flow_spec;</div><div class='del'>-	struct ext_flow_spec  rx_flow_spec;</div><div class='del'>-} __packed;</div><div class='del'>-</div><div class='del'>-#define HCI_OP_DISCONN_LOGICAL_LINK	0x043a</div><div class='del'>-struct hci_cp_disconn_logical_link {</div><div class='del'>-	__le16   log_handle;</div><div class='del'>-} __packed;</div><div class='del'>-</div><div class='del'>-#define HCI_OP_LOGICAL_LINK_CANCEL	0x043b</div><div class='del'>-struct hci_cp_logical_link_cancel {</div><div class='del'>-	__u8     phy_handle;</div><div class='del'>-	__u8     flow_spec_id;</div><div class='del'>-} __packed;</div><div class='del'>-</div><div class='ctx'> #define HCI_OP_ENHANCED_SETUP_SYNC_CONN		0x043d</div><div class='ctx'> struct hci_coding_format {</div><div class='ctx'> 	__u8	id;</div><div class='hunk'>@@ -1614,46 +1540,6 @@ struct hci_rp_read_enc_key_size {</div><div class='ctx'> 	__u8     key_size;</div><div class='ctx'> } __packed;</div><div class='ctx'> </div><div class='del'>-#define HCI_OP_READ_LOCAL_AMP_INFO	0x1409</div><div class='del'>-struct hci_rp_read_local_amp_info {</div><div class='del'>-	__u8     status;</div><div class='del'>-	__u8     amp_status;</div><div class='del'>-	__le32   total_bw;</div><div class='del'>-	__le32   max_bw;</div><div class='del'>-	__le32   min_latency;</div><div class='del'>-	__le32   max_pdu;</div><div class='del'>-	__u8     amp_type;</div><div class='del'>-	__le16   pal_cap;</div><div class='del'>-	__le16   max_assoc_size;</div><div class='del'>-	__le32   max_flush_to;</div><div class='del'>-	__le32   be_flush_to;</div><div class='del'>-} __packed;</div><div class='del'>-</div><div class='del'>-#define HCI_OP_READ_LOCAL_AMP_ASSOC	0x140a</div><div class='del'>-struct hci_cp_read_local_amp_assoc {</div><div class='del'>-	__u8     phy_handle;</div><div class='del'>-	__le16   len_so_far;</div><div class='del'>-	__le16   max_len;</div><div class='del'>-} __packed;</div><div class='del'>-struct hci_rp_read_local_amp_assoc {</div><div class='del'>-	__u8     status;</div><div class='del'>-	__u8     phy_handle;</div><div class='del'>-	__le16   rem_len;</div><div class='del'>-	__u8     frag[];</div><div class='del'>-} __packed;</div><div class='del'>-</div><div class='del'>-#define HCI_OP_WRITE_REMOTE_AMP_ASSOC	0x140b</div><div class='del'>-struct hci_cp_write_remote_amp_assoc {</div><div class='del'>-	__u8     phy_handle;</div><div class='del'>-	__le16   len_so_far;</div><div class='del'>-	__le16   rem_len;</div><div class='del'>-	__u8     frag[];</div><div class='del'>-} __packed;</div><div class='del'>-struct hci_rp_write_remote_amp_assoc {</div><div class='del'>-	__u8     status;</div><div class='del'>-	__u8     phy_handle;</div><div class='del'>-} __packed;</div><div class='del'>-</div><div class='ctx'> #define HCI_OP_GET_MWS_TRANSPORT_CONFIG	0x140c</div><div class='ctx'> </div><div class='ctx'> #define HCI_OP_ENABLE_DUT_MODE		0x1803</div><div class='head'>diff --git a/include/net/bluetooth/hci_core.h b/include/net/bluetooth/hci_core.h<br/>index b1c8489ff93e43..762b049bdabf1e 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/bluetooth/hci_core.h?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>include/net/bluetooth/hci_core.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/bluetooth/hci_core.h?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>include/net/bluetooth/hci_core.h</a></div><div class='hunk'>@@ -126,7 +126,6 @@ enum suspended_state {</div><div class='ctx'> struct hci_conn_hash {</div><div class='ctx'> 	struct list_head list;</div><div class='ctx'> 	unsigned int     acl_num;</div><div class='del'>-	unsigned int     amp_num;</div><div class='ctx'> 	unsigned int     sco_num;</div><div class='ctx'> 	unsigned int     iso_num;</div><div class='ctx'> 	unsigned int     le_num;</div><div class='hunk'>@@ -341,14 +340,6 @@ struct adv_monitor {</div><div class='ctx'> /* Default authenticated payload timeout 30s */</div><div class='ctx'> #define DEFAULT_AUTH_PAYLOAD_TIMEOUT   0x0bb8</div><div class='ctx'> </div><div class='del'>-struct amp_assoc {</div><div class='del'>-	__u16	len;</div><div class='del'>-	__u16	offset;</div><div class='del'>-	__u16	rem_len;</div><div class='del'>-	__u16	len_so_far;</div><div class='del'>-	__u8	data[HCI_MAX_AMP_ASSOC_SIZE];</div><div class='del'>-};</div><div class='del'>-</div><div class='ctx'> #define HCI_MAX_PAGES	3</div><div class='ctx'> </div><div class='ctx'> struct hci_dev {</div><div class='hunk'>@@ -361,7 +352,6 @@ struct hci_dev {</div><div class='ctx'> 	unsigned long	flags;</div><div class='ctx'> 	__u16		id;</div><div class='ctx'> 	__u8		bus;</div><div class='del'>-	__u8		dev_type;</div><div class='ctx'> 	bdaddr_t	bdaddr;</div><div class='ctx'> 	bdaddr_t	setup_addr;</div><div class='ctx'> 	bdaddr_t	public_addr;</div><div class='hunk'>@@ -467,21 +457,6 @@ struct hci_dev {</div><div class='ctx'> 	__u16		sniff_min_interval;</div><div class='ctx'> 	__u16		sniff_max_interval;</div><div class='ctx'> </div><div class='del'>-	__u8		amp_status;</div><div class='del'>-	__u32		amp_total_bw;</div><div class='del'>-	__u32		amp_max_bw;</div><div class='del'>-	__u32		amp_min_latency;</div><div class='del'>-	__u32		amp_max_pdu;</div><div class='del'>-	__u8		amp_type;</div><div class='del'>-	__u16		amp_pal_cap;</div><div class='del'>-	__u16		amp_assoc_size;</div><div class='del'>-	__u32		amp_max_flush_to;</div><div class='del'>-	__u32		amp_be_flush_to;</div><div class='del'>-</div><div class='del'>-	struct amp_assoc	loc_assoc;</div><div class='del'>-</div><div class='del'>-	__u8		flow_ctl_mode;</div><div class='del'>-</div><div class='ctx'> 	unsigned int	auto_accept_delay;</div><div class='ctx'> </div><div class='ctx'> 	unsigned long	quirks;</div><div class='hunk'>@@ -501,11 +476,6 @@ struct hci_dev {</div><div class='ctx'> 	unsigned int	le_pkts;</div><div class='ctx'> 	unsigned int	iso_pkts;</div><div class='ctx'> </div><div class='del'>-	__u16		block_len;</div><div class='del'>-	__u16		block_mtu;</div><div class='del'>-	__u16		num_blocks;</div><div class='del'>-	__u16		block_cnt;</div><div class='del'>-</div><div class='ctx'> 	unsigned long	acl_last_tx;</div><div class='ctx'> 	unsigned long	sco_last_tx;</div><div class='ctx'> 	unsigned long	le_last_tx;</div><div class='hunk'>@@ -778,7 +748,6 @@ struct hci_conn {</div><div class='ctx'> 	void		*l2cap_data;</div><div class='ctx'> 	void		*sco_data;</div><div class='ctx'> 	void		*iso_data;</div><div class='del'>-	struct amp_mgr	*amp_mgr;</div><div class='ctx'> </div><div class='ctx'> 	struct list_head link_list;</div><div class='ctx'> 	struct hci_conn	*parent;</div><div class='hunk'>@@ -805,7 +774,6 @@ struct hci_chan {</div><div class='ctx'> 	struct sk_buff_head data_q;</div><div class='ctx'> 	unsigned int	sent;</div><div class='ctx'> 	__u8		state;</div><div class='del'>-	bool		amp;</div><div class='ctx'> };</div><div class='ctx'> </div><div class='ctx'> struct hci_conn_params {</div><div class='hunk'>@@ -1014,9 +982,6 @@ static inline void hci_conn_hash_add(struct hci_dev *hdev, struct hci_conn *c)</div><div class='ctx'> 	case ACL_LINK:</div><div class='ctx'> 		h-&gt;acl_num++;</div><div class='ctx'> 		break;</div><div class='del'>-	case AMP_LINK:</div><div class='del'>-		h-&gt;amp_num++;</div><div class='del'>-		break;</div><div class='ctx'> 	case LE_LINK:</div><div class='ctx'> 		h-&gt;le_num++;</div><div class='ctx'> 		if (c-&gt;role == HCI_ROLE_SLAVE)</div><div class='hunk'>@@ -1043,9 +1008,6 @@ static inline void hci_conn_hash_del(struct hci_dev *hdev, struct hci_conn *c)</div><div class='ctx'> 	case ACL_LINK:</div><div class='ctx'> 		h-&gt;acl_num--;</div><div class='ctx'> 		break;</div><div class='del'>-	case AMP_LINK:</div><div class='del'>-		h-&gt;amp_num--;</div><div class='del'>-		break;</div><div class='ctx'> 	case LE_LINK:</div><div class='ctx'> 		h-&gt;le_num--;</div><div class='ctx'> 		if (c-&gt;role == HCI_ROLE_SLAVE)</div><div class='hunk'>@@ -1067,8 +1029,6 @@ static inline unsigned int hci_conn_num(struct hci_dev *hdev, __u8 type)</div><div class='ctx'> 	switch (type) {</div><div class='ctx'> 	case ACL_LINK:</div><div class='ctx'> 		return h-&gt;acl_num;</div><div class='del'>-	case AMP_LINK:</div><div class='del'>-		return h-&gt;amp_num;</div><div class='ctx'> 	case LE_LINK:</div><div class='ctx'> 		return h-&gt;le_num;</div><div class='ctx'> 	case SCO_LINK:</div><div class='hunk'>@@ -1085,7 +1045,7 @@ static inline unsigned int hci_conn_count(struct hci_dev *hdev)</div><div class='ctx'> {</div><div class='ctx'> 	struct hci_conn_hash *c = &amp;hdev-&gt;conn_hash;</div><div class='ctx'> </div><div class='del'>-	return c-&gt;acl_num + c-&gt;amp_num + c-&gt;sco_num + c-&gt;le_num + c-&gt;iso_num;</div><div class='add'>+	return c-&gt;acl_num + c-&gt;sco_num + c-&gt;le_num + c-&gt;iso_num;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static inline bool hci_conn_valid(struct hci_dev *hdev, struct hci_conn *conn)</div><div class='hunk'>@@ -1611,10 +1571,6 @@ static inline void hci_conn_drop(struct hci_conn *conn)</div><div class='ctx'> 			}</div><div class='ctx'> 			break;</div><div class='ctx'> </div><div class='del'>-		case AMP_LINK:</div><div class='del'>-			timeo = conn-&gt;disc_timeout;</div><div class='del'>-			break;</div><div class='del'>-</div><div class='ctx'> 		default:</div><div class='ctx'> 			timeo = 0;</div><div class='ctx'> 			break;</div><div class='head'>diff --git a/include/uapi/linux/virtio_bt.h b/include/uapi/linux/virtio_bt.h<br/>index af798f4c968042..3cc7d633456b6b 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/uapi/linux/virtio_bt.h?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>include/uapi/linux/virtio_bt.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/uapi/linux/virtio_bt.h?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>include/uapi/linux/virtio_bt.h</a></div><div class='hunk'>@@ -13,7 +13,6 @@</div><div class='ctx'> </div><div class='ctx'> enum virtio_bt_config_type {</div><div class='ctx'> 	VIRTIO_BT_CONFIG_TYPE_PRIMARY	= 0,</div><div class='del'>-	VIRTIO_BT_CONFIG_TYPE_AMP	= 1,</div><div class='ctx'> };</div><div class='ctx'> </div><div class='ctx'> enum virtio_bt_config_vendor {</div><div class='head'>diff --git a/net/bluetooth/hci_conn.c b/net/bluetooth/hci_conn.c<br/>index 0a80fd6257c65c..7f78fc6c29cf52 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_conn.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>net/bluetooth/hci_conn.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_conn.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/hci_conn.c</a></div><div class='hunk'>@@ -1173,8 +1173,7 @@ struct hci_dev *hci_get_route(bdaddr_t *dst, bdaddr_t *src, uint8_t src_type)</div><div class='ctx'> </div><div class='ctx'> 	list_for_each_entry(d, &amp;hci_dev_list, list) {</div><div class='ctx'> 		if (!test_bit(HCI_UP, &amp;d-&gt;flags) ||</div><div class='del'>-		    hci_dev_test_flag(d, HCI_USER_CHANNEL) ||</div><div class='del'>-		    d-&gt;dev_type != HCI_PRIMARY)</div><div class='add'>+		    hci_dev_test_flag(d, HCI_USER_CHANNEL))</div><div class='ctx'> 			continue;</div><div class='ctx'> </div><div class='ctx'> 		/* Simple routing:</div><div class='head'>diff --git a/net/bluetooth/hci_core.c b/net/bluetooth/hci_core.c<br/>index 101ea9137dfefd..3817d6369f0cc1 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_core.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>net/bluetooth/hci_core.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_core.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/hci_core.c</a></div><div class='hunk'>@@ -395,11 +395,6 @@ int hci_inquiry(void __user *arg)</div><div class='ctx'> 		goto done;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='del'>-	if (hdev-&gt;dev_type != HCI_PRIMARY) {</div><div class='del'>-		err = -EOPNOTSUPP;</div><div class='del'>-		goto done;</div><div class='del'>-	}</div><div class='del'>-</div><div class='ctx'> 	if (!hci_dev_test_flag(hdev, HCI_BREDR_ENABLED)) {</div><div class='ctx'> 		err = -EOPNOTSUPP;</div><div class='ctx'> 		goto done;</div><div class='hunk'>@@ -752,11 +747,6 @@ int hci_dev_cmd(unsigned int cmd, void __user *arg)</div><div class='ctx'> 		goto done;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='del'>-	if (hdev-&gt;dev_type != HCI_PRIMARY) {</div><div class='del'>-		err = -EOPNOTSUPP;</div><div class='del'>-		goto done;</div><div class='del'>-	}</div><div class='del'>-</div><div class='ctx'> 	if (!hci_dev_test_flag(hdev, HCI_BREDR_ENABLED)) {</div><div class='ctx'> 		err = -EOPNOTSUPP;</div><div class='ctx'> 		goto done;</div><div class='hunk'>@@ -910,7 +900,7 @@ int hci_get_dev_info(void __user *arg)</div><div class='ctx'> </div><div class='ctx'> 	strscpy(di.name, hdev-&gt;name, sizeof(di.name));</div><div class='ctx'> 	di.bdaddr   = hdev-&gt;bdaddr;</div><div class='del'>-	di.type     = (hdev-&gt;bus &amp; 0x0f) | ((hdev-&gt;dev_type &amp; 0x03) &lt;&lt; 4);</div><div class='add'>+	di.type     = (hdev-&gt;bus &amp; 0x0f);</div><div class='ctx'> 	di.flags    = flags;</div><div class='ctx'> 	di.pkt_type = hdev-&gt;pkt_type;</div><div class='ctx'> 	if (lmp_bredr_capable(hdev)) {</div><div class='hunk'>@@ -995,8 +985,7 @@ static void hci_power_on(struct work_struct *work)</div><div class='ctx'> 	 */</div><div class='ctx'> 	if (hci_dev_test_flag(hdev, HCI_RFKILLED) ||</div><div class='ctx'> 	    hci_dev_test_flag(hdev, HCI_UNCONFIGURED) ||</div><div class='del'>-	    (hdev-&gt;dev_type == HCI_PRIMARY &amp;&amp;</div><div class='del'>-	     !bacmp(&amp;hdev-&gt;bdaddr, BDADDR_ANY) &amp;&amp;</div><div class='add'>+	    (!bacmp(&amp;hdev-&gt;bdaddr, BDADDR_ANY) &amp;&amp;</div><div class='ctx'> 	     !bacmp(&amp;hdev-&gt;static_addr, BDADDR_ANY))) {</div><div class='ctx'> 		hci_dev_clear_flag(hdev, HCI_AUTO_OFF);</div><div class='ctx'> 		hci_dev_do_close(hdev);</div><div class='hunk'>@@ -2604,21 +2593,7 @@ int hci_register_dev(struct hci_dev *hdev)</div><div class='ctx'> 	if (!hdev-&gt;open || !hdev-&gt;close || !hdev-&gt;send)</div><div class='ctx'> 		return -EINVAL;</div><div class='ctx'> </div><div class='del'>-	/* Do not allow HCI_AMP devices to register at index 0,</div><div class='del'>-	 * so the index can be used as the AMP controller ID.</div><div class='del'>-	 */</div><div class='del'>-	switch (hdev-&gt;dev_type) {</div><div class='del'>-	case HCI_PRIMARY:</div><div class='del'>-		id = ida_alloc_max(&amp;hci_index_ida, HCI_MAX_ID - 1, GFP_KERNEL);</div><div class='del'>-		break;</div><div class='del'>-	case HCI_AMP:</div><div class='del'>-		id = ida_alloc_range(&amp;hci_index_ida, 1, HCI_MAX_ID - 1,</div><div class='del'>-				     GFP_KERNEL);</div><div class='del'>-		break;</div><div class='del'>-	default:</div><div class='del'>-		return -EINVAL;</div><div class='del'>-	}</div><div class='del'>-</div><div class='add'>+	id = ida_alloc_max(&amp;hci_index_ida, HCI_MAX_ID - 1, GFP_KERNEL);</div><div class='ctx'> 	if (id &lt; 0)</div><div class='ctx'> 		return id;</div><div class='ctx'> </div><div class='hunk'>@@ -2670,12 +2645,10 @@ int hci_register_dev(struct hci_dev *hdev)</div><div class='ctx'> 	hci_dev_set_flag(hdev, HCI_SETUP);</div><div class='ctx'> 	hci_dev_set_flag(hdev, HCI_AUTO_OFF);</div><div class='ctx'> </div><div class='del'>-	if (hdev-&gt;dev_type == HCI_PRIMARY) {</div><div class='del'>-		/* Assume BR/EDR support until proven otherwise (such as</div><div class='del'>-		 * through reading supported features during init.</div><div class='del'>-		 */</div><div class='del'>-		hci_dev_set_flag(hdev, HCI_BREDR_ENABLED);</div><div class='del'>-	}</div><div class='add'>+	/* Assume BR/EDR support until proven otherwise (such as</div><div class='add'>+	 * through reading supported features during init.</div><div class='add'>+	 */</div><div class='add'>+	hci_dev_set_flag(hdev, HCI_BREDR_ENABLED);</div><div class='ctx'> </div><div class='ctx'> 	write_lock(&amp;hci_dev_list_lock);</div><div class='ctx'> 	list_add(&amp;hdev-&gt;list, &amp;hci_dev_list);</div><div class='hunk'>@@ -3211,17 +3184,7 @@ static void hci_queue_acl(struct hci_chan *chan, struct sk_buff_head *queue,</div><div class='ctx'> </div><div class='ctx'> 	hci_skb_pkt_type(skb) = HCI_ACLDATA_PKT;</div><div class='ctx'> </div><div class='del'>-	switch (hdev-&gt;dev_type) {</div><div class='del'>-	case HCI_PRIMARY:</div><div class='del'>-		hci_add_acl_hdr(skb, conn-&gt;handle, flags);</div><div class='del'>-		break;</div><div class='del'>-	case HCI_AMP:</div><div class='del'>-		hci_add_acl_hdr(skb, chan-&gt;handle, flags);</div><div class='del'>-		break;</div><div class='del'>-	default:</div><div class='del'>-		bt_dev_err(hdev, "unknown dev_type %d", hdev-&gt;dev_type);</div><div class='del'>-		return;</div><div class='del'>-	}</div><div class='add'>+	hci_add_acl_hdr(skb, conn-&gt;handle, flags);</div><div class='ctx'> </div><div class='ctx'> 	list = skb_shinfo(skb)-&gt;frag_list;</div><div class='ctx'> 	if (!list) {</div><div class='hunk'>@@ -3381,9 +3344,6 @@ static inline void hci_quote_sent(struct hci_conn *conn, int num, int *quote)</div><div class='ctx'> 	case ACL_LINK:</div><div class='ctx'> 		cnt = hdev-&gt;acl_cnt;</div><div class='ctx'> 		break;</div><div class='del'>-	case AMP_LINK:</div><div class='del'>-		cnt = hdev-&gt;block_cnt;</div><div class='del'>-		break;</div><div class='ctx'> 	case SCO_LINK:</div><div class='ctx'> 	case ESCO_LINK:</div><div class='ctx'> 		cnt = hdev-&gt;sco_cnt;</div><div class='hunk'>@@ -3581,12 +3541,6 @@ static void hci_prio_recalculate(struct hci_dev *hdev, __u8 type)</div><div class='ctx'> </div><div class='ctx'> }</div><div class='ctx'> </div><div class='del'>-static inline int __get_blocks(struct hci_dev *hdev, struct sk_buff *skb)</div><div class='del'>-{</div><div class='del'>-	/* Calculate count of blocks used by this packet */</div><div class='del'>-	return DIV_ROUND_UP(skb-&gt;len - HCI_ACL_HDR_SIZE, hdev-&gt;block_len);</div><div class='del'>-}</div><div class='del'>-</div><div class='ctx'> static void __check_timeout(struct hci_dev *hdev, unsigned int cnt, u8 type)</div><div class='ctx'> {</div><div class='ctx'> 	unsigned long last_tx;</div><div class='hunk'>@@ -3700,81 +3654,15 @@ static void hci_sched_acl_pkt(struct hci_dev *hdev)</div><div class='ctx'> 		hci_prio_recalculate(hdev, ACL_LINK);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='del'>-static void hci_sched_acl_blk(struct hci_dev *hdev)</div><div class='del'>-{</div><div class='del'>-	unsigned int cnt = hdev-&gt;block_cnt;</div><div class='del'>-	struct hci_chan *chan;</div><div class='del'>-	struct sk_buff *skb;</div><div class='del'>-	int quote;</div><div class='del'>-	u8 type;</div><div class='del'>-</div><div class='del'>-	BT_DBG("%s", hdev-&gt;name);</div><div class='del'>-</div><div class='del'>-	if (hdev-&gt;dev_type == HCI_AMP)</div><div class='del'>-		type = AMP_LINK;</div><div class='del'>-	else</div><div class='del'>-		type = ACL_LINK;</div><div class='del'>-</div><div class='del'>-	__check_timeout(hdev, cnt, type);</div><div class='del'>-</div><div class='del'>-	while (hdev-&gt;block_cnt &gt; 0 &amp;&amp;</div><div class='del'>-	       (chan = hci_chan_sent(hdev, type, &amp;quote))) {</div><div class='del'>-		u32 priority = (skb_peek(&amp;chan-&gt;data_q))-&gt;priority;</div><div class='del'>-		while (quote &gt; 0 &amp;&amp; (skb = skb_peek(&amp;chan-&gt;data_q))) {</div><div class='del'>-			int blocks;</div><div class='del'>-</div><div class='del'>-			BT_DBG("chan %p skb %p len %d priority %u", chan, skb,</div><div class='del'>-			       skb-&gt;len, skb-&gt;priority);</div><div class='del'>-</div><div class='del'>-			/* Stop if priority has changed */</div><div class='del'>-			if (skb-&gt;priority &lt; priority)</div><div class='del'>-				break;</div><div class='del'>-</div><div class='del'>-			skb = skb_dequeue(&amp;chan-&gt;data_q);</div><div class='del'>-</div><div class='del'>-			blocks = __get_blocks(hdev, skb);</div><div class='del'>-			if (blocks &gt; hdev-&gt;block_cnt)</div><div class='del'>-				return;</div><div class='del'>-</div><div class='del'>-			hci_conn_enter_active_mode(chan-&gt;conn,</div><div class='del'>-						   bt_cb(skb)-&gt;force_active);</div><div class='del'>-</div><div class='del'>-			hci_send_frame(hdev, skb);</div><div class='del'>-			hdev-&gt;acl_last_tx = jiffies;</div><div class='del'>-</div><div class='del'>-			hdev-&gt;block_cnt -= blocks;</div><div class='del'>-			quote -= blocks;</div><div class='del'>-</div><div class='del'>-			chan-&gt;sent += blocks;</div><div class='del'>-			chan-&gt;conn-&gt;sent += blocks;</div><div class='del'>-		}</div><div class='del'>-	}</div><div class='del'>-</div><div class='del'>-	if (cnt != hdev-&gt;block_cnt)</div><div class='del'>-		hci_prio_recalculate(hdev, type);</div><div class='del'>-}</div><div class='del'>-</div><div class='ctx'> static void hci_sched_acl(struct hci_dev *hdev)</div><div class='ctx'> {</div><div class='ctx'> 	BT_DBG("%s", hdev-&gt;name);</div><div class='ctx'> </div><div class='ctx'> 	/* No ACL link over BR/EDR controller */</div><div class='del'>-	if (!hci_conn_num(hdev, ACL_LINK) &amp;&amp; hdev-&gt;dev_type == HCI_PRIMARY)</div><div class='del'>-		return;</div><div class='del'>-</div><div class='del'>-	/* No AMP link over AMP controller */</div><div class='del'>-	if (!hci_conn_num(hdev, AMP_LINK) &amp;&amp; hdev-&gt;dev_type == HCI_AMP)</div><div class='add'>+	if (!hci_conn_num(hdev, ACL_LINK))</div><div class='ctx'> 		return;</div><div class='ctx'> </div><div class='del'>-	switch (hdev-&gt;flow_ctl_mode) {</div><div class='del'>-	case HCI_FLOW_CTL_MODE_PACKET_BASED:</div><div class='del'>-		hci_sched_acl_pkt(hdev);</div><div class='del'>-		break;</div><div class='del'>-</div><div class='del'>-	case HCI_FLOW_CTL_MODE_BLOCK_BASED:</div><div class='del'>-		hci_sched_acl_blk(hdev);</div><div class='del'>-		break;</div><div class='del'>-	}</div><div class='add'>+	hci_sched_acl_pkt(hdev);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static void hci_sched_le(struct hci_dev *hdev)</div><div class='head'>diff --git a/net/bluetooth/hci_event.c b/net/bluetooth/hci_event.c<br/>index 4de8f0dc1a5239..33fac5cab1a8db 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_event.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>net/bluetooth/hci_event.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_event.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/hci_event.c</a></div><div class='hunk'>@@ -913,21 +913,6 @@ static u8 hci_cc_read_local_ext_features(struct hci_dev *hdev, void *data,</div><div class='ctx'> 	return rp-&gt;status;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='del'>-static u8 hci_cc_read_flow_control_mode(struct hci_dev *hdev, void *data,</div><div class='del'>-					struct sk_buff *skb)</div><div class='del'>-{</div><div class='del'>-	struct hci_rp_read_flow_control_mode *rp = data;</div><div class='del'>-</div><div class='del'>-	bt_dev_dbg(hdev, "status 0x%2.2x", rp-&gt;status);</div><div class='del'>-</div><div class='del'>-	if (rp-&gt;status)</div><div class='del'>-		return rp-&gt;status;</div><div class='del'>-</div><div class='del'>-	hdev-&gt;flow_ctl_mode = rp-&gt;mode;</div><div class='del'>-</div><div class='del'>-	return rp-&gt;status;</div><div class='del'>-}</div><div class='del'>-</div><div class='ctx'> static u8 hci_cc_read_buffer_size(struct hci_dev *hdev, void *data,</div><div class='ctx'> 				  struct sk_buff *skb)</div><div class='ctx'> {</div><div class='hunk'>@@ -1071,28 +1056,6 @@ static u8 hci_cc_write_page_scan_type(struct hci_dev *hdev, void *data,</div><div class='ctx'> 	return rp-&gt;status;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='del'>-static u8 hci_cc_read_data_block_size(struct hci_dev *hdev, void *data,</div><div class='del'>-				      struct sk_buff *skb)</div><div class='del'>-{</div><div class='del'>-	struct hci_rp_read_data_block_size *rp = data;</div><div class='del'>-</div><div class='del'>-	bt_dev_dbg(hdev, "status 0x%2.2x", rp-&gt;status);</div><div class='del'>-</div><div class='del'>-	if (rp-&gt;status)</div><div class='del'>-		return rp-&gt;status;</div><div class='del'>-</div><div class='del'>-	hdev-&gt;block_mtu = __le16_to_cpu(rp-&gt;max_acl_len);</div><div class='del'>-	hdev-&gt;block_len = __le16_to_cpu(rp-&gt;block_len);</div><div class='del'>-	hdev-&gt;num_blocks = __le16_to_cpu(rp-&gt;num_blocks);</div><div class='del'>-</div><div class='del'>-	hdev-&gt;block_cnt = hdev-&gt;num_blocks;</div><div class='del'>-</div><div class='del'>-	BT_DBG("%s blk mtu %d cnt %d len %d", hdev-&gt;name, hdev-&gt;block_mtu,</div><div class='del'>-	       hdev-&gt;block_cnt, hdev-&gt;block_len);</div><div class='del'>-</div><div class='del'>-	return rp-&gt;status;</div><div class='del'>-}</div><div class='del'>-</div><div class='ctx'> static u8 hci_cc_read_clock(struct hci_dev *hdev, void *data,</div><div class='ctx'> 			    struct sk_buff *skb)</div><div class='ctx'> {</div><div class='hunk'>@@ -1127,30 +1090,6 @@ unlock:</div><div class='ctx'> 	return rp-&gt;status;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='del'>-static u8 hci_cc_read_local_amp_info(struct hci_dev *hdev, void *data,</div><div class='del'>-				     struct sk_buff *skb)</div><div class='del'>-{</div><div class='del'>-	struct hci_rp_read_local_amp_info *rp = data;</div><div class='del'>-</div><div class='del'>-	bt_dev_dbg(hdev, "status 0x%2.2x", rp-&gt;status);</div><div class='del'>-</div><div class='del'>-	if (rp-&gt;status)</div><div class='del'>-		return rp-&gt;status;</div><div class='del'>-</div><div class='del'>-	hdev-&gt;amp_status = rp-&gt;amp_status;</div><div class='del'>-	hdev-&gt;amp_total_bw = __le32_to_cpu(rp-&gt;total_bw);</div><div class='del'>-	hdev-&gt;amp_max_bw = __le32_to_cpu(rp-&gt;max_bw);</div><div class='del'>-	hdev-&gt;amp_min_latency = __le32_to_cpu(rp-&gt;min_latency);</div><div class='del'>-	hdev-&gt;amp_max_pdu = __le32_to_cpu(rp-&gt;max_pdu);</div><div class='del'>-	hdev-&gt;amp_type = rp-&gt;amp_type;</div><div class='del'>-	hdev-&gt;amp_pal_cap = __le16_to_cpu(rp-&gt;pal_cap);</div><div class='del'>-	hdev-&gt;amp_assoc_size = __le16_to_cpu(rp-&gt;max_assoc_size);</div><div class='del'>-	hdev-&gt;amp_be_flush_to = __le32_to_cpu(rp-&gt;be_flush_to);</div><div class='del'>-	hdev-&gt;amp_max_flush_to = __le32_to_cpu(rp-&gt;max_flush_to);</div><div class='del'>-</div><div class='del'>-	return rp-&gt;status;</div><div class='del'>-}</div><div class='del'>-</div><div class='ctx'> static u8 hci_cc_read_inq_rsp_tx_power(struct hci_dev *hdev, void *data,</div><div class='ctx'> 				       struct sk_buff *skb)</div><div class='ctx'> {</div><div class='hunk'>@@ -4121,12 +4060,6 @@ static const struct hci_cc {</div><div class='ctx'> 	HCI_CC(HCI_OP_READ_PAGE_SCAN_TYPE, hci_cc_read_page_scan_type,</div><div class='ctx'> 	       sizeof(struct hci_rp_read_page_scan_type)),</div><div class='ctx'> 	HCI_CC_STATUS(HCI_OP_WRITE_PAGE_SCAN_TYPE, hci_cc_write_page_scan_type),</div><div class='del'>-	HCI_CC(HCI_OP_READ_DATA_BLOCK_SIZE, hci_cc_read_data_block_size,</div><div class='del'>-	       sizeof(struct hci_rp_read_data_block_size)),</div><div class='del'>-	HCI_CC(HCI_OP_READ_FLOW_CONTROL_MODE, hci_cc_read_flow_control_mode,</div><div class='del'>-	       sizeof(struct hci_rp_read_flow_control_mode)),</div><div class='del'>-	HCI_CC(HCI_OP_READ_LOCAL_AMP_INFO, hci_cc_read_local_amp_info,</div><div class='del'>-	       sizeof(struct hci_rp_read_local_amp_info)),</div><div class='ctx'> 	HCI_CC(HCI_OP_READ_CLOCK, hci_cc_read_clock,</div><div class='ctx'> 	       sizeof(struct hci_rp_read_clock)),</div><div class='ctx'> 	HCI_CC(HCI_OP_READ_ENC_KEY_SIZE, hci_cc_read_enc_key_size,</div><div class='hunk'>@@ -4461,11 +4394,6 @@ static void hci_num_comp_pkts_evt(struct hci_dev *hdev, void *data,</div><div class='ctx'> 			     flex_array_size(ev, handles, ev-&gt;num)))</div><div class='ctx'> 		return;</div><div class='ctx'> </div><div class='del'>-	if (hdev-&gt;flow_ctl_mode != HCI_FLOW_CTL_MODE_PACKET_BASED) {</div><div class='del'>-		bt_dev_err(hdev, "wrong event for mode %d", hdev-&gt;flow_ctl_mode);</div><div class='del'>-		return;</div><div class='del'>-	}</div><div class='del'>-</div><div class='ctx'> 	bt_dev_dbg(hdev, "num %d", ev-&gt;num);</div><div class='ctx'> </div><div class='ctx'> 	for (i = 0; i &lt; ev-&gt;num; i++) {</div><div class='hunk'>@@ -4533,78 +4461,6 @@ static void hci_num_comp_pkts_evt(struct hci_dev *hdev, void *data,</div><div class='ctx'> 	queue_work(hdev-&gt;workqueue, &amp;hdev-&gt;tx_work);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='del'>-static struct hci_conn *__hci_conn_lookup_handle(struct hci_dev *hdev,</div><div class='del'>-						 __u16 handle)</div><div class='del'>-{</div><div class='del'>-	struct hci_chan *chan;</div><div class='del'>-</div><div class='del'>-	switch (hdev-&gt;dev_type) {</div><div class='del'>-	case HCI_PRIMARY:</div><div class='del'>-		return hci_conn_hash_lookup_handle(hdev, handle);</div><div class='del'>-	case HCI_AMP:</div><div class='del'>-		chan = hci_chan_lookup_handle(hdev, handle);</div><div class='del'>-		if (chan)</div><div class='del'>-			return chan-&gt;conn;</div><div class='del'>-		break;</div><div class='del'>-	default:</div><div class='del'>-		bt_dev_err(hdev, "unknown dev_type %d", hdev-&gt;dev_type);</div><div class='del'>-		break;</div><div class='del'>-	}</div><div class='del'>-</div><div class='del'>-	return NULL;</div><div class='del'>-}</div><div class='del'>-</div><div class='del'>-static void hci_num_comp_blocks_evt(struct hci_dev *hdev, void *data,</div><div class='del'>-				    struct sk_buff *skb)</div><div class='del'>-{</div><div class='del'>-	struct hci_ev_num_comp_blocks *ev = data;</div><div class='del'>-	int i;</div><div class='del'>-</div><div class='del'>-	if (!hci_ev_skb_pull(hdev, skb, HCI_EV_NUM_COMP_BLOCKS,</div><div class='del'>-			     flex_array_size(ev, handles, ev-&gt;num_hndl)))</div><div class='del'>-		return;</div><div class='del'>-</div><div class='del'>-	if (hdev-&gt;flow_ctl_mode != HCI_FLOW_CTL_MODE_BLOCK_BASED) {</div><div class='del'>-		bt_dev_err(hdev, "wrong event for mode %d",</div><div class='del'>-			   hdev-&gt;flow_ctl_mode);</div><div class='del'>-		return;</div><div class='del'>-	}</div><div class='del'>-</div><div class='del'>-	bt_dev_dbg(hdev, "num_blocks %d num_hndl %d", ev-&gt;num_blocks,</div><div class='del'>-		   ev-&gt;num_hndl);</div><div class='del'>-</div><div class='del'>-	for (i = 0; i &lt; ev-&gt;num_hndl; i++) {</div><div class='del'>-		struct hci_comp_blocks_info *info = &amp;ev-&gt;handles[i];</div><div class='del'>-		struct hci_conn *conn = NULL;</div><div class='del'>-		__u16  handle, block_count;</div><div class='del'>-</div><div class='del'>-		handle = __le16_to_cpu(info-&gt;handle);</div><div class='del'>-		block_count = __le16_to_cpu(info-&gt;blocks);</div><div class='del'>-</div><div class='del'>-		conn = __hci_conn_lookup_handle(hdev, handle);</div><div class='del'>-		if (!conn)</div><div class='del'>-			continue;</div><div class='del'>-</div><div class='del'>-		conn-&gt;sent -= block_count;</div><div class='del'>-</div><div class='del'>-		switch (conn-&gt;type) {</div><div class='del'>-		case ACL_LINK:</div><div class='del'>-		case AMP_LINK:</div><div class='del'>-			hdev-&gt;block_cnt += block_count;</div><div class='del'>-			if (hdev-&gt;block_cnt &gt; hdev-&gt;num_blocks)</div><div class='del'>-				hdev-&gt;block_cnt = hdev-&gt;num_blocks;</div><div class='del'>-			break;</div><div class='del'>-</div><div class='del'>-		default:</div><div class='del'>-			bt_dev_err(hdev, "unknown type %d conn %p",</div><div class='del'>-				   conn-&gt;type, conn);</div><div class='del'>-			break;</div><div class='del'>-		}</div><div class='del'>-	}</div><div class='del'>-</div><div class='del'>-	queue_work(hdev-&gt;workqueue, &amp;hdev-&gt;tx_work);</div><div class='del'>-}</div><div class='del'>-</div><div class='ctx'> static void hci_mode_change_evt(struct hci_dev *hdev, void *data,</div><div class='ctx'> 				struct sk_buff *skb)</div><div class='ctx'> {</div><div class='hunk'>@@ -7512,9 +7368,6 @@ static const struct hci_ev {</div><div class='ctx'> 	/* [0x3e = HCI_EV_LE_META] */</div><div class='ctx'> 	HCI_EV_REQ_VL(HCI_EV_LE_META, hci_le_meta_evt,</div><div class='ctx'> 		      sizeof(struct hci_ev_le_meta), HCI_MAX_EVENT_SIZE),</div><div class='del'>-	/* [0x48 = HCI_EV_NUM_COMP_BLOCKS] */</div><div class='del'>-	HCI_EV(HCI_EV_NUM_COMP_BLOCKS, hci_num_comp_blocks_evt,</div><div class='del'>-	       sizeof(struct hci_ev_num_comp_blocks)),</div><div class='ctx'> 	/* [0xff = HCI_EV_VENDOR] */</div><div class='ctx'> 	HCI_EV_VL(HCI_EV_VENDOR, msft_vendor_evt, 0, HCI_MAX_EVENT_SIZE),</div><div class='ctx'> };</div><div class='head'>diff --git a/net/bluetooth/hci_sock.c b/net/bluetooth/hci_sock.c<br/>index 703b84bd48d5be..69c2ba1e843eb4 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_sock.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>net/bluetooth/hci_sock.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_sock.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/hci_sock.c</a></div><div class='hunk'>@@ -485,7 +485,7 @@ static struct sk_buff *create_monitor_event(struct hci_dev *hdev, int event)</div><div class='ctx'> 			return NULL;</div><div class='ctx'> </div><div class='ctx'> 		ni = skb_put(skb, HCI_MON_NEW_INDEX_SIZE);</div><div class='del'>-		ni-&gt;type = hdev-&gt;dev_type;</div><div class='add'>+		ni-&gt;type = 0x00; /* Old hdev-&gt;dev_type */</div><div class='ctx'> 		ni-&gt;bus = hdev-&gt;bus;</div><div class='ctx'> 		bacpy(&amp;ni-&gt;bdaddr, &amp;hdev-&gt;bdaddr);</div><div class='ctx'> 		memcpy_and_pad(ni-&gt;name, sizeof(ni-&gt;name), hdev-&gt;name,</div><div class='hunk'>@@ -1007,9 +1007,6 @@ static int hci_sock_bound_ioctl(struct sock *sk, unsigned int cmd,</div><div class='ctx'> 	if (hci_dev_test_flag(hdev, HCI_UNCONFIGURED))</div><div class='ctx'> 		return -EOPNOTSUPP;</div><div class='ctx'> </div><div class='del'>-	if (hdev-&gt;dev_type != HCI_PRIMARY)</div><div class='del'>-		return -EOPNOTSUPP;</div><div class='del'>-</div><div class='ctx'> 	switch (cmd) {</div><div class='ctx'> 	case HCISETRAW:</div><div class='ctx'> 		if (!capable(CAP_NET_ADMIN))</div><div class='head'>diff --git a/net/bluetooth/hci_sync.c b/net/bluetooth/hci_sync.c<br/>index 40b71bc5057305..513b538ef94484 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_sync.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>net/bluetooth/hci_sync.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_sync.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/hci_sync.c</a></div><div class='hunk'>@@ -3488,10 +3488,6 @@ static int hci_unconf_init_sync(struct hci_dev *hdev)</div><div class='ctx'> /* Read Local Supported Features. */</div><div class='ctx'> static int hci_read_local_features_sync(struct hci_dev *hdev)</div><div class='ctx'> {</div><div class='del'>-	 /* Not all AMP controllers support this command */</div><div class='del'>-	if (hdev-&gt;dev_type == HCI_AMP &amp;&amp; !(hdev-&gt;commands[14] &amp; 0x20))</div><div class='del'>-		return 0;</div><div class='del'>-</div><div class='ctx'> 	return __hci_cmd_sync_status(hdev, HCI_OP_READ_LOCAL_FEATURES,</div><div class='ctx'> 				     0, NULL, HCI_CMD_TIMEOUT);</div><div class='ctx'> }</div><div class='hunk'>@@ -3526,51 +3522,6 @@ static int hci_read_local_cmds_sync(struct hci_dev *hdev)</div><div class='ctx'> 	return 0;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='del'>-/* Read Local AMP Info */</div><div class='del'>-static int hci_read_local_amp_info_sync(struct hci_dev *hdev)</div><div class='del'>-{</div><div class='del'>-	return __hci_cmd_sync_status(hdev, HCI_OP_READ_LOCAL_AMP_INFO,</div><div class='del'>-				     0, NULL, HCI_CMD_TIMEOUT);</div><div class='del'>-}</div><div class='del'>-</div><div class='del'>-/* Read Data Blk size */</div><div class='del'>-static int hci_read_data_block_size_sync(struct hci_dev *hdev)</div><div class='del'>-{</div><div class='del'>-	return __hci_cmd_sync_status(hdev, HCI_OP_READ_DATA_BLOCK_SIZE,</div><div class='del'>-				     0, NULL, HCI_CMD_TIMEOUT);</div><div class='del'>-}</div><div class='del'>-</div><div class='del'>-/* Read Flow Control Mode */</div><div class='del'>-static int hci_read_flow_control_mode_sync(struct hci_dev *hdev)</div><div class='del'>-{</div><div class='del'>-	return __hci_cmd_sync_status(hdev, HCI_OP_READ_FLOW_CONTROL_MODE,</div><div class='del'>-				     0, NULL, HCI_CMD_TIMEOUT);</div><div class='del'>-}</div><div class='del'>-</div><div class='del'>-/* Read Location Data */</div><div class='del'>-static int hci_read_location_data_sync(struct hci_dev *hdev)</div><div class='del'>-{</div><div class='del'>-	return __hci_cmd_sync_status(hdev, HCI_OP_READ_LOCATION_DATA,</div><div class='del'>-				     0, NULL, HCI_CMD_TIMEOUT);</div><div class='del'>-}</div><div class='del'>-</div><div class='del'>-/* AMP Controller init stage 1 command sequence */</div><div class='del'>-static const struct hci_init_stage amp_init1[] = {</div><div class='del'>-	/* HCI_OP_READ_LOCAL_VERSION */</div><div class='del'>-	HCI_INIT(hci_read_local_version_sync),</div><div class='del'>-	/* HCI_OP_READ_LOCAL_COMMANDS */</div><div class='del'>-	HCI_INIT(hci_read_local_cmds_sync),</div><div class='del'>-	/* HCI_OP_READ_LOCAL_AMP_INFO */</div><div class='del'>-	HCI_INIT(hci_read_local_amp_info_sync),</div><div class='del'>-	/* HCI_OP_READ_DATA_BLOCK_SIZE */</div><div class='del'>-	HCI_INIT(hci_read_data_block_size_sync),</div><div class='del'>-	/* HCI_OP_READ_FLOW_CONTROL_MODE */</div><div class='del'>-	HCI_INIT(hci_read_flow_control_mode_sync),</div><div class='del'>-	/* HCI_OP_READ_LOCATION_DATA */</div><div class='del'>-	HCI_INIT(hci_read_location_data_sync),</div><div class='del'>-	{}</div><div class='del'>-};</div><div class='del'>-</div><div class='ctx'> static int hci_init1_sync(struct hci_dev *hdev)</div><div class='ctx'> {</div><div class='ctx'> 	int err;</div><div class='hunk'>@@ -3584,28 +3535,9 @@ static int hci_init1_sync(struct hci_dev *hdev)</div><div class='ctx'> 			return err;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='del'>-	switch (hdev-&gt;dev_type) {</div><div class='del'>-	case HCI_PRIMARY:</div><div class='del'>-		hdev-&gt;flow_ctl_mode = HCI_FLOW_CTL_MODE_PACKET_BASED;</div><div class='del'>-		return hci_init_stage_sync(hdev, br_init1);</div><div class='del'>-	case HCI_AMP:</div><div class='del'>-		hdev-&gt;flow_ctl_mode = HCI_FLOW_CTL_MODE_BLOCK_BASED;</div><div class='del'>-		return hci_init_stage_sync(hdev, amp_init1);</div><div class='del'>-	default:</div><div class='del'>-		bt_dev_err(hdev, "Unknown device type %d", hdev-&gt;dev_type);</div><div class='del'>-		break;</div><div class='del'>-	}</div><div class='del'>-</div><div class='del'>-	return 0;</div><div class='add'>+	return hci_init_stage_sync(hdev, br_init1);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='del'>-/* AMP Controller init stage 2 command sequence */</div><div class='del'>-static const struct hci_init_stage amp_init2[] = {</div><div class='del'>-	/* HCI_OP_READ_LOCAL_FEATURES */</div><div class='del'>-	HCI_INIT(hci_read_local_features_sync),</div><div class='del'>-	{}</div><div class='del'>-};</div><div class='del'>-</div><div class='ctx'> /* Read Buffer Size (ACL mtu, max pkt, etc.) */</div><div class='ctx'> static int hci_read_buffer_size_sync(struct hci_dev *hdev)</div><div class='ctx'> {</div><div class='hunk'>@@ -3863,9 +3795,6 @@ static int hci_init2_sync(struct hci_dev *hdev)</div><div class='ctx'> </div><div class='ctx'> 	bt_dev_dbg(hdev, "");</div><div class='ctx'> </div><div class='del'>-	if (hdev-&gt;dev_type == HCI_AMP)</div><div class='del'>-		return hci_init_stage_sync(hdev, amp_init2);</div><div class='del'>-</div><div class='ctx'> 	err = hci_init_stage_sync(hdev, hci_init2);</div><div class='ctx'> 	if (err)</div><div class='ctx'> 		return err;</div><div class='hunk'>@@ -4703,13 +4632,6 @@ static int hci_init_sync(struct hci_dev *hdev)</div><div class='ctx'> 	if (err &lt; 0)</div><div class='ctx'> 		return err;</div><div class='ctx'> </div><div class='del'>-	/* HCI_PRIMARY covers both single-mode LE, BR/EDR and dual-mode</div><div class='del'>-	 * BR/EDR/LE type controllers. AMP controllers only need the</div><div class='del'>-	 * first two stages of init.</div><div class='del'>-	 */</div><div class='del'>-	if (hdev-&gt;dev_type != HCI_PRIMARY)</div><div class='del'>-		return 0;</div><div class='del'>-</div><div class='ctx'> 	err = hci_init3_sync(hdev);</div><div class='ctx'> 	if (err &lt; 0)</div><div class='ctx'> 		return err;</div><div class='hunk'>@@ -4938,12 +4860,8 @@ int hci_dev_open_sync(struct hci_dev *hdev)</div><div class='ctx'> 		 * In case of user channel usage, it is not important</div><div class='ctx'> 		 * if a public address or static random address is</div><div class='ctx'> 		 * available.</div><div class='del'>-		 *</div><div class='del'>-		 * This check is only valid for BR/EDR controllers</div><div class='del'>-		 * since AMP controllers do not have an address.</div><div class='ctx'> 		 */</div><div class='ctx'> 		if (!hci_dev_test_flag(hdev, HCI_USER_CHANNEL) &amp;&amp;</div><div class='del'>-		    hdev-&gt;dev_type == HCI_PRIMARY &amp;&amp;</div><div class='ctx'> 		    !bacmp(&amp;hdev-&gt;bdaddr, BDADDR_ANY) &amp;&amp;</div><div class='ctx'> 		    !bacmp(&amp;hdev-&gt;static_addr, BDADDR_ANY)) {</div><div class='ctx'> 			ret = -EADDRNOTAVAIL;</div><div class='hunk'>@@ -4978,8 +4896,7 @@ int hci_dev_open_sync(struct hci_dev *hdev)</div><div class='ctx'> 		    !hci_dev_test_flag(hdev, HCI_CONFIG) &amp;&amp;</div><div class='ctx'> 		    !hci_dev_test_flag(hdev, HCI_UNCONFIGURED) &amp;&amp;</div><div class='ctx'> 		    !hci_dev_test_flag(hdev, HCI_USER_CHANNEL) &amp;&amp;</div><div class='del'>-		    hci_dev_test_flag(hdev, HCI_MGMT) &amp;&amp;</div><div class='del'>-		    hdev-&gt;dev_type == HCI_PRIMARY) {</div><div class='add'>+		    hci_dev_test_flag(hdev, HCI_MGMT)) {</div><div class='ctx'> 			ret = hci_powered_update_sync(hdev);</div><div class='ctx'> 			mgmt_power_on(hdev, ret);</div><div class='ctx'> 		}</div><div class='hunk'>@@ -5124,8 +5041,7 @@ int hci_dev_close_sync(struct hci_dev *hdev)</div><div class='ctx'> </div><div class='ctx'> 	auto_off = hci_dev_test_and_clear_flag(hdev, HCI_AUTO_OFF);</div><div class='ctx'> </div><div class='del'>-	if (!auto_off &amp;&amp; hdev-&gt;dev_type == HCI_PRIMARY &amp;&amp;</div><div class='del'>-	    !hci_dev_test_flag(hdev, HCI_USER_CHANNEL) &amp;&amp;</div><div class='add'>+	if (!auto_off &amp;&amp; !hci_dev_test_flag(hdev, HCI_USER_CHANNEL) &amp;&amp;</div><div class='ctx'> 	    hci_dev_test_flag(hdev, HCI_MGMT))</div><div class='ctx'> 		__mgmt_power_off(hdev);</div><div class='ctx'> </div><div class='hunk'>@@ -5187,9 +5103,6 @@ int hci_dev_close_sync(struct hci_dev *hdev)</div><div class='ctx'> 	hdev-&gt;flags &amp;= BIT(HCI_RAW);</div><div class='ctx'> 	hci_dev_clear_volatile_flags(hdev);</div><div class='ctx'> </div><div class='del'>-	/* Controller radio is available but is currently powered down */</div><div class='del'>-	hdev-&gt;amp_status = AMP_STATUS_POWERED_DOWN;</div><div class='del'>-</div><div class='ctx'> 	memset(hdev-&gt;eir, 0, sizeof(hdev-&gt;eir));</div><div class='ctx'> 	memset(hdev-&gt;dev_class, 0, sizeof(hdev-&gt;dev_class));</div><div class='ctx'> 	bacpy(&amp;hdev-&gt;random_addr, BDADDR_ANY);</div><div class='hunk'>@@ -5226,8 +5139,7 @@ static int hci_power_on_sync(struct hci_dev *hdev)</div><div class='ctx'> 	 */</div><div class='ctx'> 	if (hci_dev_test_flag(hdev, HCI_RFKILLED) ||</div><div class='ctx'> 	    hci_dev_test_flag(hdev, HCI_UNCONFIGURED) ||</div><div class='del'>-	    (hdev-&gt;dev_type == HCI_PRIMARY &amp;&amp;</div><div class='del'>-	     !bacmp(&amp;hdev-&gt;bdaddr, BDADDR_ANY) &amp;&amp;</div><div class='add'>+	    (!bacmp(&amp;hdev-&gt;bdaddr, BDADDR_ANY) &amp;&amp;</div><div class='ctx'> 	     !bacmp(&amp;hdev-&gt;static_addr, BDADDR_ANY))) {</div><div class='ctx'> 		hci_dev_clear_flag(hdev, HCI_AUTO_OFF);</div><div class='ctx'> 		hci_dev_close_sync(hdev);</div><div class='hunk'>@@ -5329,27 +5241,11 @@ int hci_stop_discovery_sync(struct hci_dev *hdev)</div><div class='ctx'> 	return 0;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='del'>-static int hci_disconnect_phy_link_sync(struct hci_dev *hdev, u16 handle,</div><div class='del'>-					u8 reason)</div><div class='del'>-{</div><div class='del'>-	struct hci_cp_disconn_phy_link cp;</div><div class='del'>-</div><div class='del'>-	memset(&amp;cp, 0, sizeof(cp));</div><div class='del'>-	cp.phy_handle = HCI_PHY_HANDLE(handle);</div><div class='del'>-	cp.reason = reason;</div><div class='del'>-</div><div class='del'>-	return __hci_cmd_sync_status(hdev, HCI_OP_DISCONN_PHY_LINK,</div><div class='del'>-				     sizeof(cp), &amp;cp, HCI_CMD_TIMEOUT);</div><div class='del'>-}</div><div class='del'>-</div><div class='ctx'> static int hci_disconnect_sync(struct hci_dev *hdev, struct hci_conn *conn,</div><div class='ctx'> 			       u8 reason)</div><div class='ctx'> {</div><div class='ctx'> 	struct hci_cp_disconnect cp;</div><div class='ctx'> </div><div class='del'>-	if (conn-&gt;type == AMP_LINK)</div><div class='del'>-		return hci_disconnect_phy_link_sync(hdev, conn-&gt;handle, reason);</div><div class='del'>-</div><div class='ctx'> 	if (test_bit(HCI_CONN_BIG_CREATED, &amp;conn-&gt;flags)) {</div><div class='ctx'> 		/* This is a BIS connection, hci_conn_del will</div><div class='ctx'> 		 * do the necessary cleanup.</div><div class='head'>diff --git a/net/bluetooth/l2cap_core.c b/net/bluetooth/l2cap_core.c<br/>index 44454115c10adc..4a633c1b688258 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/l2cap_core.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>net/bluetooth/l2cap_core.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/l2cap_core.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/l2cap_core.c</a></div><div class='hunk'>@@ -3930,7 +3930,7 @@ static inline int l2cap_command_rej(struct l2cap_conn *conn,</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static void l2cap_connect(struct l2cap_conn *conn, struct l2cap_cmd_hdr *cmd,</div><div class='del'>-			  u8 *data, u8 rsp_code, u8 amp_id)</div><div class='add'>+			  u8 *data, u8 rsp_code)</div><div class='ctx'> {</div><div class='ctx'> 	struct l2cap_conn_req *req = (struct l2cap_conn_req *) data;</div><div class='ctx'> 	struct l2cap_conn_rsp rsp;</div><div class='hunk'>@@ -4009,17 +4009,8 @@ static void l2cap_connect(struct l2cap_conn *conn, struct l2cap_cmd_hdr *cmd,</div><div class='ctx'> 				status = L2CAP_CS_AUTHOR_PEND;</div><div class='ctx'> 				chan-&gt;ops-&gt;defer(chan);</div><div class='ctx'> 			} else {</div><div class='del'>-				/* Force pending result for AMP controllers.</div><div class='del'>-				 * The connection will succeed after the</div><div class='del'>-				 * physical link is up.</div><div class='del'>-				 */</div><div class='del'>-				if (amp_id == AMP_ID_BREDR) {</div><div class='del'>-					l2cap_state_change(chan, BT_CONFIG);</div><div class='del'>-					result = L2CAP_CR_SUCCESS;</div><div class='del'>-				} else {</div><div class='del'>-					l2cap_state_change(chan, BT_CONNECT2);</div><div class='del'>-					result = L2CAP_CR_PEND;</div><div class='del'>-				}</div><div class='add'>+				l2cap_state_change(chan, BT_CONNECT2);</div><div class='add'>+				result = L2CAP_CR_PEND;</div><div class='ctx'> 				status = L2CAP_CS_NO_INFO;</div><div class='ctx'> 			}</div><div class='ctx'> 		} else {</div><div class='hunk'>@@ -4084,7 +4075,7 @@ static int l2cap_connect_req(struct l2cap_conn *conn,</div><div class='ctx'> 		mgmt_device_connected(hdev, hcon, NULL, 0);</div><div class='ctx'> 	hci_dev_unlock(hdev);</div><div class='ctx'> </div><div class='del'>-	l2cap_connect(conn, cmd, data, L2CAP_CONN_RSP, 0);</div><div class='add'>+	l2cap_connect(conn, cmd, data, L2CAP_CONN_RSP);</div><div class='ctx'> 	return 0;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='hunk'>@@ -7495,10 +7486,6 @@ void l2cap_recv_acldata(struct hci_conn *hcon, struct sk_buff *skb, u16 flags)</div><div class='ctx'> 	struct l2cap_conn *conn = hcon-&gt;l2cap_data;</div><div class='ctx'> 	int len;</div><div class='ctx'> </div><div class='del'>-	/* For AMP controller do not create l2cap conn */</div><div class='del'>-	if (!conn &amp;&amp; hcon-&gt;hdev-&gt;dev_type != HCI_PRIMARY)</div><div class='del'>-		goto drop;</div><div class='del'>-</div><div class='ctx'> 	if (!conn)</div><div class='ctx'> 		conn = l2cap_conn_add(hcon);</div><div class='ctx'> </div><div class='head'>diff --git a/net/bluetooth/mgmt.c b/net/bluetooth/mgmt.c<br/>index b8e05ddeedba98..d58d3e13910fa5 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/mgmt.c?id=ba0eee5763ea5f571359aa10629f08a6e81a9cb8'>net/bluetooth/mgmt.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/mgmt.c?id=d3c7b012d912b31ad23b9349c0e499d6dddd48ec'>net/bluetooth/mgmt.c</a></div><div class='hunk'>@@ -443,8 +443,7 @@ static int read_index_list(struct sock *sk, struct hci_dev *hdev, void *data,</div><div class='ctx'> </div><div class='ctx'> 	count = 0;</div><div class='ctx'> 	list_for_each_entry(d, &amp;hci_dev_list, list) {</div><div class='del'>-		if (d-&gt;dev_type == HCI_PRIMARY &amp;&amp;</div><div class='del'>-		    !hci_dev_test_flag(d, HCI_UNCONFIGURED))</div><div class='add'>+		if (!hci_dev_test_flag(d, HCI_UNCONFIGURED))</div><div class='ctx'> 			count++;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='hunk'>@@ -468,8 +467,7 @@ static int read_index_list(struct sock *sk, struct hci_dev *hdev, void *data,</div><div class='ctx'> 		if (test_bit(HCI_QUIRK_RAW_DEVICE, &amp;d-&gt;quirks))</div><div class='ctx'> 			continue;</div><div class='ctx'> </div><div class='del'>-		if (d-&gt;dev_type == HCI_PRIMARY &amp;&amp;</div><div class='del'>-		    !hci_dev_test_flag(d, HCI_UNCONFIGURED)) {</div><div class='add'>+		if (!hci_dev_test_flag(d, HCI_UNCONFIGURED)) {</div><div class='ctx'> 			rp-&gt;index[count++] = cpu_to_le16(d-&gt;id);</div><div class='ctx'> 			bt_dev_dbg(hdev, "Added hci%u", d-&gt;id);</div><div class='ctx'> 		}</div><div class='hunk'>@@ -503,8 +501,7 @@ static int read_unconf_index_list(struct sock *sk, struct hci_dev *hdev,</div><div class='ctx'> </div><div class='ctx'> 	count = 0;</div><div class='ctx'> 	list_for_each_entry(d, &amp;hci_dev_list, list) {</div><div class='del'>-		if (d-&gt;dev_type == HCI_PRIMARY &amp;&amp;</div><div class='del'>-		    hci_dev_test_flag(d, HCI_UNCONFIGURED))</div><div class='add'>+		if (hci_dev_test_flag(d, HCI_UNCONFIGURED))</div><div class='ctx'> 			count++;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='hunk'>@@ -528,8 +525,7 @@ static int read_unconf_index_list(struct sock *sk, struct hci_dev *hdev,</div><div class='ctx'> 		if (test_bit(HCI_QUIRK_RAW_DEVICE, &amp;d-&gt;quirks))</div><div class='ctx'> 			continue;</div><div class='ctx'> </div><div class='del'>-		if (d-&gt;dev_type == HCI_PRIMARY &amp;&amp;</div><div class='del'>-		    hci_dev_test_flag(d, HCI_UNCONFIGURED)) {</div><div class='add'>+		if (hci_dev_test_flag(d, HCI_UNCONFIGURED)) {</div><div class='ctx'> 			rp-&gt;index[count++] = cpu_to_le16(d-&gt;id);</div><div class='ctx'> 			bt_dev_dbg(hdev, "Added hci%u", d-&gt;id);</div><div class='ctx'> 		}</div><div class='hunk'>@@ -561,10 +557,8 @@ static int read_ext_index_list(struct sock *sk, struct hci_dev *hdev,</div><div class='ctx'> 	read_lock(&amp;hci_dev_list_lock);</div><div class='ctx'> </div><div class='ctx'> 	count = 0;</div><div class='del'>-	list_for_each_entry(d, &amp;hci_dev_list, list) {</div><div class='del'>-		if (d-&gt;dev_type == HCI_PRIMARY || d-&gt;dev_type == HCI_AMP)</div><div class='del'>-			count++;</div><div class='del'>-	}</div><div class='add'>+	list_for_each_entry(d, &amp;hci_dev_list, list)</div><div class='add'>+		count++;</div><div class='ctx'> </div><div class='ctx'> 	rp = kmalloc(struct_size(rp, entry, count), GFP_ATOMIC);</div><div class='ctx'> 	if (!rp) {</div><div class='hunk'>@@ -585,16 +579,10 @@ static int read_ext_index_list(struct sock *sk, struct hci_dev *hdev,</div><div class='ctx'> 		if (test_bit(HCI_QUIRK_RAW_DEVICE, &amp;d-&gt;quirks))</div><div class='ctx'> 			continue;</div><div class='ctx'> </div><div class='del'>-		if (d-&gt;dev_type == HCI_PRIMARY) {</div><div class='del'>-			if (hci_dev_test_flag(d, HCI_UNCONFIGURED))</div><div class='del'>-				rp-&gt;entry[count].type = 0x01;</div><div class='del'>-			else</div><div class='del'>-				rp-&gt;entry[count].type = 0x00;</div><div class='del'>-		} else if (d-&gt;dev_type == HCI_AMP) {</div><div class='del'>-			rp-&gt;entry[count].type = 0x02;</div><div class='del'>-		} else {</div><div class='del'>-			continue;</div><div class='del'>-		}</div><div class='add'>+		if (hci_dev_test_flag(d, HCI_UNCONFIGURED))</div><div class='add'>+			rp-&gt;entry[count].type = 0x01;</div><div class='add'>+		else</div><div class='add'>+			rp-&gt;entry[count].type = 0x00;</div><div class='ctx'> </div><div class='ctx'> 		rp-&gt;entry[count].bus = d-&gt;bus;</div><div class='ctx'> 		rp-&gt;entry[count++].index = cpu_to_le16(d-&gt;id);</div><div class='hunk'>@@ -9325,23 +9313,14 @@ void mgmt_index_added(struct hci_dev *hdev)</div><div class='ctx'> 	if (test_bit(HCI_QUIRK_RAW_DEVICE, &amp;hdev-&gt;quirks))</div><div class='ctx'> 		return;</div><div class='ctx'> </div><div class='del'>-	switch (hdev-&gt;dev_type) {</div><div class='del'>-	case HCI_PRIMARY:</div><div class='del'>-		if (hci_dev_test_flag(hdev, HCI_UNCONFIGURED)) {</div><div class='del'>-			mgmt_index_event(MGMT_EV_UNCONF_INDEX_ADDED, hdev,</div><div class='del'>-					 NULL, 0, HCI_MGMT_UNCONF_INDEX_EVENTS);</div><div class='del'>-			ev.type = 0x01;</div><div class='del'>-		} else {</div><div class='del'>-			mgmt_index_event(MGMT_EV_INDEX_ADDED, hdev, NULL, 0,</div><div class='del'>-					 HCI_MGMT_INDEX_EVENTS);</div><div class='del'>-			ev.type = 0x00;</div><div class='del'>-		}</div><div class='del'>-		break;</div><div class='del'>-	case HCI_AMP:</div><div class='del'>-		ev.type = 0x02;</div><div class='del'>-		break;</div><div class='del'>-	default:</div><div class='del'>-		return;</div><div class='add'>+	if (hci_dev_test_flag(hdev, HCI_UNCONFIGURED)) {</div><div class='add'>+		mgmt_index_event(MGMT_EV_UNCONF_INDEX_ADDED, hdev, NULL, 0,</div><div class='add'>+				 HCI_MGMT_UNCONF_INDEX_EVENTS);</div><div class='add'>+		ev.type = 0x01;</div><div class='add'>+	} else {</div><div class='add'>+		mgmt_index_event(MGMT_EV_INDEX_ADDED, hdev, NULL, 0,</div><div class='add'>+				 HCI_MGMT_INDEX_EVENTS);</div><div class='add'>+		ev.type = 0x00;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	ev.bus = hdev-&gt;bus;</div><div class='hunk'>@@ -9358,25 +9337,16 @@ void mgmt_index_removed(struct hci_dev *hdev)</div><div class='ctx'> 	if (test_bit(HCI_QUIRK_RAW_DEVICE, &amp;hdev-&gt;quirks))</div><div class='ctx'> 		return;</div><div class='ctx'> </div><div class='del'>-	switch (hdev-&gt;dev_type) {</div><div class='del'>-	case HCI_PRIMARY:</div><div class='del'>-		mgmt_pending_foreach(0, hdev, cmd_complete_rsp, &amp;status);</div><div class='add'>+	mgmt_pending_foreach(0, hdev, cmd_complete_rsp, &amp;status);</div><div class='ctx'> </div><div class='del'>-		if (hci_dev_test_flag(hdev, HCI_UNCONFIGURED)) {</div><div class='del'>-			mgmt_index_event(MGMT_EV_UNCONF_INDEX_REMOVED, hdev,</div><div class='del'>-					 NULL, 0, HCI_MGMT_UNCONF_INDEX_EVENTS);</div><div class='del'>-			ev.type = 0x01;</div><div class='del'>-		} else {</div><div class='del'>-			mgmt_index_event(MGMT_EV_INDEX_REMOVED, hdev, NULL, 0,</div><div class='del'>-					 HCI_MGMT_INDEX_EVENTS);</div><div class='del'>-			ev.type = 0x00;</div><div class='del'>-		}</div><div class='del'>-		break;</div><div class='del'>-	case HCI_AMP:</div><div class='del'>-		ev.type = 0x02;</div><div class='del'>-		break;</div><div class='del'>-	default:</div><div class='del'>-		return;</div><div class='add'>+	if (hci_dev_test_flag(hdev, HCI_UNCONFIGURED)) {</div><div class='add'>+		mgmt_index_event(MGMT_EV_UNCONF_INDEX_REMOVED, hdev, NULL, 0,</div><div class='add'>+				 HCI_MGMT_UNCONF_INDEX_EVENTS);</div><div class='add'>+		ev.type = 0x01;</div><div class='add'>+	} else {</div><div class='add'>+		mgmt_index_event(MGMT_EV_INDEX_REMOVED, hdev, NULL, 0,</div><div class='add'>+				 HCI_MGMT_INDEX_EVENTS);</div><div class='add'>+		ev.type = 0x00;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	ev.bus = hdev-&gt;bus;</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-10 15:17:33 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
