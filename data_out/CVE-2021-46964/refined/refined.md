The content relates to CVE-2021-46964.

Root cause of vulnerability:
A previous commit (a6dcfe08487e) limited the number of allocated MSI-X vectors to the number of CPUs. However, the driver logic for calculating the number of queue pairs assumed that there would be more vectors available, specifically for the Message Buffer (MB), Response Queue (RSP), and Asynchronous Task I/O (ATIO) interrupts, leading to a miscalculation of the maximum number of queue pairs. This resulted in `ha->queue_pair_map` being left as NULL.

Weaknesses/vulnerabilities present:
- Incorrect calculation of maximum queue pairs (`max_qpairs`)
-  `ha->queue_pair_map` remains NULL due to incorrect allocation logic.
- Dereferencing a NULL pointer at `ha->queue_pair_map[hwq]`.

Impact of exploitation:
- Kernel crash due to NULL pointer dereference
- System instability

Attack vectors:
- Triggering I/O operations using the `qla2xxx` driver on a system with a specific number of CPUs can cause a crash, notably on a system with two CPUs in initiator mode.

Required attacker capabilities/position:
- Ability to initiate I/O operations using the `qla2xxx` driver.
- A system with a limited number of CPUs (e.g., a dual-core VM in the reported crash scenario) that results in a specific configuration.