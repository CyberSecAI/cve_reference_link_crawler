

* [Join/Login](/auth/)
* [Business Software](/software/)
* [Open Source Software](/directory/)
* [For Vendors](/software/vendors/ "For Vendors")
* [Blog](/blog/ "Blog")
* [About](/about)
* More
* + [Articles](/articles/)
  + [Create](/create)
  + [SourceForge Podcast](https://sourceforge.net/articles/category/sourceforge-podcast/)
  + [Site Documentation](https://sourceforge.net/p/forge/documentation/Docs%20Home/)
  + [Subscribe to our Newsletter](/user/newsletters)
  + [Support Request](/support)

[![SourceForge logo](https://a.fsdn.com/con/images/sandiego/sf-logo-full.svg)](/ "Home")
[For Vendors](/software/vendors/ "For Vendors")
[Help](/support "Help")
[Create](/create/ "Create")
[Join](/user/registration "Join")
[Login](/auth/ "Login")

[![SourceForge logo](https://a.fsdn.com/con/images/sandiego/sf-logo-full.svg)](/ "Home")

[![SourceForge logo](https://a.fsdn.com/con/images/sandiego/sf-logo-full.svg)](/ "Home")
[Business Software](/software/)

[Open Source Software](/directory/ "Browse")

[SourceForge Podcast](https://sourceforge.net/articles/category/sourceforge-podcast/)

Resources

* [Articles](/articles/)
* [Case Studies](/software/case-studies/)
* [Blog](/blog/)

Menu

* [Help](/support)
* [Create](/create)
* [Join](/user/registration/ "Join")
* [Login](/auth/ "Login")

[![Nav](https://a.fsdn.com/con/assets/maxnav/sourceforge/okta300-7baad53c.png)](https://auth0.com/signup?utm_source=sourceforge&utm_campaign=global_mult_mult_all_ciam-dev_dg-plg_auth0_display_sourceforge_banner_3p_PLG-SFSiteSearchBanner_utm2&utm_medium=cpc&utm_id=aNK4z000000UIV7GAO)

* [Home](/)
* [Browse](/directory/)
* [GraphicsMagick](/p/graphicsmagick/)
* Bugs

# [bug]Heap buffer overflow when parsing MIFF

## Swiss army knife of image processing

Brought to you by:
[bfriesen](/u/bfriesen/profile/)

* [Summary](/projects/graphicsmagick/)
* [Files](/projects/graphicsmagick/files/)
* [Reviews](/projects/graphicsmagick/reviews/)
* [Support](/projects/graphicsmagick/support)
* [Wiki](/p/graphicsmagick/wiki/)
* [Mailing Lists](/p/graphicsmagick/mailman/)
* [Tickets ▾](/p/graphicsmagick/_list/tickets)
  + [Bugs](/p/graphicsmagick/bugs/)
  + [Support Requests](/p/graphicsmagick/support-requests/)
  + [Patches](/p/graphicsmagick/patches/)
  + [Feature Requests](/p/graphicsmagick/feature-requests/)
* [News](/p/graphicsmagick/news/)
* [Discussion](/p/graphicsmagick/discussion/)
* [Code](/p/graphicsmagick/code/)

Menu
▾
▴

* [Create Ticket](/p/graphicsmagick/bugs/new/ "To create a new ticket, you must be authorized by the project admin.")
* [View Stats](/p/graphicsmagick/bugs/stats/ "Stats")

### Group

* [v1.0\_(example)](/p/graphicsmagick/bugs/milestone/v1.0_%28example%29/)

### Searches

* [Changes](/p/graphicsmagick/bugs/search/?q=%21status%3Aclosed-wont-fix+%26%26+%21status%3Aclosed-accepted+%26%26+%21status%3Aclosed-rejected+%26%26+%21status%3Aclosed-out-of-date+%26%26+%21status%3Aclosed-duplicate+%26%26+%21status%3Aclosed-works-for-me+%26%26+%21status%3Aclosed+%26%26+%21status%3Aclosed-invalid+%26%26+%21status%3Aclosed-fixed&sort=mod_date_dt+desc)
* [Closed Tickets](/p/graphicsmagick/bugs/search/?q=status%3Aclosed-wont-fix+or+status%3Aclosed-accepted+or+status%3Aclosed-rejected+or+status%3Aclosed-out-of-date+or+status%3Aclosed-duplicate+or+status%3Aclosed-works-for-me+or+status%3Aclosed+or+status%3Aclosed-invalid+or+status%3Aclosed-fixed)
* [Open Tickets](/p/graphicsmagick/bugs/search/?q=%21status%3Aclosed-wont-fix+%26%26+%21status%3Aclosed-accepted+%26%26+%21status%3Aclosed-rejected+%26%26+%21status%3Aclosed-out-of-date+%26%26+%21status%3Aclosed-duplicate+%26%26+%21status%3Aclosed-works-for-me+%26%26+%21status%3Aclosed+%26%26+%21status%3Aclosed-invalid+%26%26+%21status%3Aclosed-fixed)

### Help

* [Formatting Help](/nf/markdown_syntax)

## #664 [bug]Heap buffer overflow when parsing MIFF

Milestone:
[v1.0\_(example)](/p/graphicsmagick/bugs/milestone/v1.0_%28example%29)

Status:
closed-fixed

Owner:
[Bob Friesenhahn](/u/bfriesen/profile/)

Labels:
[bug (4)](../search?q=labels:%22bug%22)

[vulnerability (1)](../search?q=labels:%22vulnerability%22)

Priority:
5

Updated:
2022-03-26

Created:
2022-03-24

Creator:
[patchkey](/u/patchkey/profile/)

Private:
No

Version：GraphicsMagick 1.4 snapshot-20220322

```
==3682383==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61700000032e at pc 0x0000003c4a8e bp 0x7fffffff40d0 sp 0x7fffffff3898
WRITE of size 6146 at 0x61700000032e thread T0
    #0 0x3c4a8d in fread (/home/user/fuzzing_asanGrap/bin/gm+0x3c4a8d)
    #1 0x52bb62 in ReadBlob /home/user/test/GraphicsMagick-1.4.020220322/magick/blob.c:3228:19
    #2 0xc1f532 in ReadMIFFImage /home/user/test/GraphicsMagick-1.4.020220322/coders/miff.c:1847:61
    #3 0x5b092e in ReadImage /home/user/test/GraphicsMagick-1.4.020220322/magick/constitute.c:1630:13
    #4 0x5af68b in PingImage /home/user/test/GraphicsMagick-1.4.020220322/magick/constitute.c:1386:9
    #5 0x4b4ef9 in IdentifyImageCommand /home/user/test/GraphicsMagick-1.4.020220322/magick/command.c:8490:17
    #6 0x4ed162 in MagickCommand /home/user/test/GraphicsMagick-1.4.020220322/magick/command.c:8973:17
    #7 0x514b89 in GMCommandSingle /home/user/test/GraphicsMagick-1.4.020220322/magick/command.c:17528:10
    #8 0x51350f in GMCommand /home/user/test/GraphicsMagick-1.4.020220322/magick/command.c:17581:16
    #9 0x7ffff73030b2 in __libc_start_main /build/glibc-sMfBJT/glibc-2.31/csu/../csu/libc-start.c:308:16
    #10 0x3ab2fd in _start (/home/user/fuzzing_asanGrap/bin/gm+0x3ab2fd)

0x61700000032e is located 0 bytes to the right of 686-byte region [0x617000000080,0x61700000032e)
allocated by thread T0 here:
    #0 0x427da3 in realloc (/home/user/fuzzing_asanGrap/bin/gm+0x427da3)
    #1 0x65f1dc in _MagickReallocateResourceLimitedMemory /home/user/test/GraphicsMagick-1.4.020220322/magick/memory.c:769:36

SUMMARY: AddressSanitizer: heap-buffer-overflow (/home/user/fuzzing_asanGrap/bin/gm+0x3c4a8d) in fread
Shadow bytes around the buggy address:
  0x0c2e7fff8010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c2e7fff8020: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c2e7fff8030: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c2e7fff8040: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c2e7fff8050: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x0c2e7fff8060: 00 00 00 00 00[06]fa fa fa fa fa fa fa fa fa fa
  0x0c2e7fff8070: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c2e7fff8080: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c2e7fff8090: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c2e7fff80a0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c2e7fff80b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb

```

command：`./gm identify example.miff`

example.miff link:

<https://drive.google.com/file/d/1kW2wd0S_oCffl23eiRjwErAAMsb3muc-/view?usp=sharing>

**1 Attachments**
[example.miff](/p/graphicsmagick/bugs/664/attachment/example.miff)

## Discussion

* ![patchkey](https://a.fsdn.com/con/images/sandiego/icons/default-avatar.png "patchkey")

  [patchkey](/u/patchkey/profile/)
  - *2022-03-24*

  supplement：

  OS：ubuntu20.04

  If you would like to refer to this comment somewhere else in this project, copy and paste the following link:

* ![Bob Friesenhahn](https://a.fsdn.com/con/images/sandiego/icons/default-avatar.png "Bob Friesenhahn")

  [Bob Friesenhahn](/u/bfriesen/profile/)
  - *2022-03-24*

  + **assigned\_to**: Bob Friesenhahn

  If you would like to refer to this comment somewhere else in this project, copy and paste the following link:

* ![Bob Friesenhahn](https://a.fsdn.com/con/images/sandiego/icons/default-avatar.png "Bob Friesenhahn")

  [Bob Friesenhahn](/u/bfriesen/profile/)
  - *2022-03-24*

  I am able to reproduce this strange issue.

  If you would like to refer to this comment somewhere else in this project, copy and paste the following link:

* ![Bob Friesenhahn](https://a.fsdn.com/con/images/sandiego/icons/default-avatar.png "Bob Friesenhahn")

  [Bob Friesenhahn](/u/bfriesen/profile/)
  - *2022-03-25*

  I see the cause of the problem. Only builds with bzip support are impacted.

  If you would like to refer to this comment somewhere else in this project, copy and paste the following link:

* ![Bob Friesenhahn](https://a.fsdn.com/con/images/sandiego/icons/default-avatar.png "Bob Friesenhahn")

  [Bob Friesenhahn](/u/bfriesen/profile/)
  - *2022-03-26*

  + **status**: open --> closed-fixed

  If you would like to refer to this comment somewhere else in this project, copy and paste the following link:

* ![Bob Friesenhahn](https://a.fsdn.com/con/images/sandiego/icons/default-avatar.png "Bob Friesenhahn")

  [Bob Friesenhahn](/u/bfriesen/profile/)
  - *2022-03-26*

  This issue is addressed by Mercurial changeset 16689:94f4bcf448ad and the latest development snapshot (GraphicsMagick-1.4.020220326.tar.xz).

  Thank you for reporting this issue!

  If you would like to refer to this comment somewhere else in this project, copy and paste the following link:

---

[Log in](/auth/) to post a comment.

SourceForge

* [Create a Project](/create/ "Create a Project")
* [Open Source Software](/directory/ "Open Source Software Directory")
* [Business Software](/software/ "Business Software Directory")
* [Top Downloaded Projects](/top "Top Open Source Projects")

Company

* [About](/about)
* [Team](/about/leadership "Open Source Software Directory")
* SourceForge Headquarters

  225 Broadway Suite 1600

  San Diego, CA 92101

  +1 (858) 422-6466

Resources

* [Support](/support "Support Section")
* [Site Documentation](/p/forge/documentation/Docs%20Home/ "Site Documentation")
* [Site Status](https://fosstodon.org/%40sourceforgestatus "Site Status")
* [SourceForge Reviews](/reviews "Reviews")

[![SourceForge logo](https://a.fsdn.com/con/images/sandiego/sf-logo-full.svg)](/ "Home")

© 2025 Slashdot Media. All Rights Reserved.

[Terms](https://slashdotmedia.com/terms-of-use "Terms")
[Privacy](https://slashdotmedia.com/privacy-statement/ "Privacy")
Privacy Choices
[Advertise](https://slashdotmedia.com/contact/ "Advertise")

