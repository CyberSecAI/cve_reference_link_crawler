

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b446631f355ece73b13c311dd712c47381a23172)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b446631f355ece73b13c311dd712c47381a23172)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b446631f355ece73b13c311dd712c47381a23172)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b446631f355ece73b13c311dd712c47381a23172)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jiri Pirko <jiri@nvidia.com> | 2024-03-06 16:12:40 +0100 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2024-03-08 11:17:30 +0000 |
| commit | [b446631f355ece73b13c311dd712c47381a23172](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b446631f355ece73b13c311dd712c47381a23172) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b446631f355ece73b13c311dd712c47381a23172)) | |
| tree | [6f25ca231c3f857be68e6eb36060210c1e84c3ac](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b446631f355ece73b13c311dd712c47381a23172) | |
| parent | [4469c0c5b14a0919f5965c7ceac96b523eb57b79](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4469c0c5b14a0919f5965c7ceac96b523eb57b79) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b446631f355ece73b13c311dd712c47381a23172&id2=4469c0c5b14a0919f5965c7ceac96b523eb57b79)) | |
| download | [linux-b446631f355ece73b13c311dd712c47381a23172.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b446631f355ece73b13c311dd712c47381a23172.tar.gz) | |

dpll: fix dpll\_xa\_ref\_\*\_del() for multiple registrationsCurrently, if there are multiple registrations of the same pin on the
same dpll device, following warnings are observed:
WARNING: CPU: 5 PID: 2212 at drivers/dpll/dpll\_core.c:143 dpll\_xa\_ref\_pin\_del.isra.0+0x21e/0x230
WARNING: CPU: 5 PID: 2212 at drivers/dpll/dpll\_core.c:223 \_\_dpll\_pin\_unregister+0x2b3/0x2c0
The problem is, that in both dpll\_xa\_ref\_dpll\_del() and
dpll\_xa\_ref\_pin\_del() registration is only removed from list in case the
reference count drops to zero. That is wrong, the registration has to
be removed always.
To fix this, remove the registration from the list and free
it unconditionally, instead of doing it only when the ref reference
counter reaches zero.
Fixes: 9431063ad323 ("dpll: core: Add DPLL framework base functions")
Signed-off-by: Jiri Pirko <jiri@nvidia.com>
Reviewed-by: Rahul Rameshbabu <rrameshbabu@nvidia.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b446631f355ece73b13c311dd712c47381a23172)

| -rw-r--r-- | [drivers/dpll/dpll\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/dpll/dpll_core.c?id=b446631f355ece73b13c311dd712c47381a23172) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 4 deletions

| diff --git a/drivers/dpll/dpll\_core.c b/drivers/dpll/dpll\_core.cindex 7f686d179fc93c..c751a87c7a8e6c 100644--- a/[drivers/dpll/dpll\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/dpll/dpll_core.c?id=4469c0c5b14a0919f5965c7ceac96b523eb57b79)+++ b/[drivers/dpll/dpll\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/dpll/dpll_core.c?id=b446631f355ece73b13c311dd712c47381a23172)@@ -129,9 +129,9 @@ static int dpll\_xa\_ref\_pin\_del(struct xarray \*xa\_pins, struct dpll\_pin \*pin, reg = dpll\_pin\_registration\_find(ref, ops, priv); if (WARN\_ON(!reg)) return -EINVAL;+ list\_del(&reg->list);+ kfree(reg); if (refcount\_dec\_and\_test(&ref->refcount)) {- list\_del(&reg->list);- kfree(reg); xa\_erase(xa\_pins, i); WARN\_ON(!list\_empty(&ref->registration\_list)); kfree(ref);@@ -209,9 +209,9 @@ dpll\_xa\_ref\_dpll\_del(struct xarray \*xa\_dplls, struct dpll\_device \*dpll, reg = dpll\_pin\_registration\_find(ref, ops, priv); if (WARN\_ON(!reg)) return;+ list\_del(&reg->list);+ kfree(reg); if (refcount\_dec\_and\_test(&ref->refcount)) {- list\_del(&reg->list);- kfree(reg); xa\_erase(xa\_dplls, i); WARN\_ON(!list\_empty(&ref->registration\_list)); kfree(ref); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:40:36 +0000

