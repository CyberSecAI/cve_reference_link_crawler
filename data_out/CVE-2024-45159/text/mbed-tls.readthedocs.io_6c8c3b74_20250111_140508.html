
[Mbed TLS](../../)

Contents

* [Getting Started](../../getting_started/)
* [API Reference](https://mbed-tls.readthedocs.io/projects/api)
* [Project](../../project/)
* [Reviews](../../reviews/)
* [Security Advisories](../)
  + [Buffer underrun in pkwrite when writing an opaque key pair](../mbedtls-security-advisory-2024-10-1/)
  + Limited authentication bypass in TLS 1.3 optional client authentication
    - [Vulnerability](#vulnerability)
    - [Impact](#impact)
    - [Affected versions](#affected-versions)
    - [Resolution](#resolution)
    - [Work-around](#work-around)
  + [Stack buffer overflow in ECDSA signature conversion functions](../mbedtls-security-advisory-2024-08-2/)
  + [CTR\_DRBG prioritized over HMAC\_DRBG as the PSA DRBG](../mbedtls-security-advisory-2024-08-1/)
  + [Insecure handling of shared memory in PSA Crypto APIs](../mbedtls-security-advisory-2024-03/)
  + [Buffer overflow in mbedtls\_x509\_set\_extension()](../mbedtls-security-advisory-2024-01-2/)
  + [Timing side channel in private key RSA operations.](../mbedtls-security-advisory-2024-01-1/)
  + [Buffer overflow in TLS handshake parsing with ECDH](../mbedtls-security-advisory-2023-10-2/)
  + [Buffer overread in TLS stream cipher suites](../mbedtls-security-advisory-2023-10-1/)
  + [Buffer overread in DTLS ClientHello parsing](../mbedtls-security-advisory-2022-07/)
  + [Double Free in `mbedtls_ssl_set_session()` in an error case.](../mbedtls-security-advisory-2021-12/)
  + [Local side channel attack on static Diffie-Hellman with Montgomery curves](../mbedtls-security-advisory-2021-07-2/)
  + [Local side channel attack on RSA](../mbedtls-security-advisory-2021-07-1/)
  + [Protocol weakness in DHE-PSK key exchange](../mbedtls-security-advisory-2020-09-3/)
  + [Local side channel attack on RSA and static Diffie-Hellman](../mbedtls-security-advisory-2020-09-2/)
  + [Local side channel attack on classical CBC decryption in (D)TLS](../mbedtls-security-advisory-2020-09-1/)
  + [Side-channel attack on ECC key import and validation](../mbedtls-security-advisory-2020-07/)
  + [Side channel attack on ECDSA](../mbedtls-security-advisory-2020-04/)
  + [Cache attack against RSA key import in SGX](../mbedtls-security-advisory-2020-02/)
  + [Side channel attack on ECDSA](../mbedtls-security-advisory-2019-12/)
  + [Side channel attack on deterministic ECDSA](../mbedtls-security-advisory-2019-10/)
  + [Mbed TLS Security Advisory 2018-03](../mbedtls-security-advisory-2018-03/)
  + [Mbed TLS Security Advisory 2018-02](../mbedtls-security-advisory-2018-02/)
  + [mbed TLS Security Advisory 2018-01](../mbedtls-security-advisory-2018-01/)
  + [mbed TLS Security Advisory 2017-02](../mbedtls-security-advisory-2017-02/)
  + [mbed TLS Security Advisory 2017-01](../mbedtls-security-advisory-2017-01/)
  + [mbed TLS Security Advisory 2015-01](../mbedtls-security-advisory-2015-01/)
  + [PolarSSL Security Advisory 2014-04](../polarssl-security-advisory-2014-04/)
  + [PolarSSL Security Advisory 2014-03](../polarssl-security-advisory-2014-03-poodle-attack-on-ssl-v3/)
  + [PolarSSL Security Advisory 2014-02](../polarssl-security-advisory-2014-02/)
  + [PolarSSL Security Advisory 2014-01](../polarssl-security-advisory-2014-01/)
  + [PolarSSL Security Advisory 2013-05](../polarssl-security-advisory-2013-05/)
  + [PolarSSL Security Advisory 2013-04](../polarssl-security-advisory-2013-04/)
  + [PolarSSL Security Advisory 2013-03](../polarssl-security-advisory-2013-03/)
  + [PolarSSL Security Advisory 2013-02](../polarssl-security-advisory-2013-02/)
  + [PolarSSL Security Advisory 2013-01](../polarssl-security-advisory-2013-01/)
  + [PolarSSL Security Advisory 2012-01](../polarssl-security-advisory-2012-01/)
  + [PolarSSL Security Advisory 2011-02](../polarssl-security-advisory-2011-02/)
  + [PolarSSL Security Advisory 2011-01](../polarssl-security-advisory-2011-01/)
* [Contributing to This Documentation](../../CONTRIBUTING/)
* [Knowledge Base](../../kb/)

[Mbed TLS](../../)

* [Security Advisories](../)
* Limited authentication bypass in TLS 1.3 optional client authentication
* [View page source](../../_sources/security-advisories/mbedtls-security-advisory-2024-08-3.md.txt)

---

# Limited authentication bypass in TLS 1.3 optional client authentication[](#limited-authentication-bypass-in-tls-1-3-optional-client-authentication "Permalink to this heading")

| **Title** | Limited authentication bypass in TLS 1.3 optional client authentication |
| --- | --- |
| **CVE** | CVE-2024-45159 |
| **Date** | 30 August 2024 |
| **Affects** | Mbed TLS 3.2.0 to 3.6.0 included |
| **Severity** | Medium |

## Vulnerability[](#vulnerability "Permalink to this heading")

TLS servers can use optional authentication of the client with
`mbedtls_ssl_conf_authmode(..., MBEDTLS_SSL_VERIFY_OPTIONAL);`, then after the
handshake has completed, call `mbedtls_ssl_get_verify_result()` to check if
the client provided a certificate and if it was correct. If a certificate was
not provided or it was not valid, the return value of this function should be
non-zero, with particular bits set to indicate what exactly was wrong about
the certificate.

In particular, with TLS 1.3, if a client presents a certificate that does not
have the `digitalSignature` bit set in its `keyUsage` extension, the bit
`MBEDTLS_X509_BADCERT_KEY_USAGE` should be set in the return value of
`mbedtls_ssl_get_verify_result()`. Similarly, if the certificate doesn’t have
`clientAuth` listed in its `extKeyUsage` extension, the return value should
have the bit `MBEDTLS_X509_BADCERT_EXT_KEY_USAGE` set.

With TLS 1.3 in Mbed TLS 3.6.0, this was not happening: those two bits were
always unset, regardless of whether the `keyUsage` and `extKeyUsage`
extensions were correct or not. In particular, if those were the only issues
with the certificate, `mbedtls_ssl_get_verify_result()` would return `0`,
incorrectly presenting the certificate as fully valid.

This only impacts TLS 1.3 optional client authentication. Mandatory authentication
(`MBEDTLS_SSL_VERIFY_REQUIRED`) is not affected (it will correctly abort the
handshake with a fatal alert if the client certificate is absent or invalid).
TLS 1.2 authentication is not affected. TLS 1.3 server authentication is not
affected, as before 3.6.1 it could not be made optional.

## Impact[](#impact "Permalink to this heading")

An attacker in possession of a certificate valid for uses other than TLS
client authentication was able to use it for TLS client authentication.

Note that the certificate needs to be valid (in particular, signed by a CA
trusted by the victim TLS server) except for the `keyUsage` and `extKeyUsage`
extension values.

## Affected versions[](#affected-versions "Permalink to this heading")

The vulnerability was present in 3.2.0 which was the first version to support
client authentication in TLS 1.3.

Note that until 3.6.0, support for TLS 1.3 was disabled in the default
compile-time configuration, which meant the vulnerability was not present in a
default build. In 3.6.0, TLS 1.3 became enabled by default, making the
vulnerability present in the default configuration.

## Resolution[](#resolution "Permalink to this heading")

Affected users should upgrade to Mbed TLS 3.6.1.

## Work-around[](#work-around "Permalink to this heading")

The issue can be avoided by forcing use of TLS 1.2 with connections that use
optional client authentication. That is, all servers that call
`mbedtls_ssl_conf_authmode(..., MBEDTLS_SSL_VERIFY_OPTIONAL);` should also call
`mbedtls_ssl_conf_max_tls_version(..., MBEDTLS_SSL_VERSION_TLS1_2);`.

 [Previous](../mbedtls-security-advisory-2024-10-1/ "Buffer underrun in pkwrite when writing an opaque key pair")
[Next](../mbedtls-security-advisory-2024-08-2/ "Stack buffer overflow in ECDSA signature conversion functions")

---

© Copyright The Mbed TLS Contributors.

Built with [Sphinx](https://www.sphinx-doc.org/) using a
[theme](https://github.com/readthedocs/sphinx_rtd_theme)
provided by [Read the Docs](https://readthedocs.org).

