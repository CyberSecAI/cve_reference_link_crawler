<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Limited authentication bypass in TLS 1.3 optional client authentication &mdash; Mbed TLS  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=df4b10f6"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Stack buffer overflow in ECDSA signature conversion functions" href="../mbedtls-security-advisory-2024-08-2/" />
    <link rel="prev" title="Buffer underrun in pkwrite when writing an opaque key pair" href="../mbedtls-security-advisory-2024-10-1/" /> 
<script async type="text/javascript" src="/_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="mbed-tls" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/security-advisories/mbedtls-security-advisory-2024-08-3/" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../" class="icon icon-home">
            Mbed TLS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://mbed-tls.readthedocs.io/projects/api">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project/">Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reviews/">Reviews</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Security Advisories</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2024-10-1/">Buffer underrun in pkwrite when writing an opaque key pair</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Limited authentication bypass in TLS 1.3 optional client authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vulnerability">Vulnerability</a></li>
<li class="toctree-l3"><a class="reference internal" href="#impact">Impact</a></li>
<li class="toctree-l3"><a class="reference internal" href="#affected-versions">Affected versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resolution">Resolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#work-around">Work-around</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2024-08-2/">Stack buffer overflow in ECDSA signature conversion functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2024-08-1/">CTR_DRBG prioritized over HMAC_DRBG as the PSA DRBG</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2024-03/">Insecure handling of shared memory in PSA Crypto APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2024-01-2/">Buffer overflow in mbedtls_x509_set_extension()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2024-01-1/">Timing side channel in private key RSA operations.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2023-10-2/">Buffer overflow in TLS handshake parsing with ECDH</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2023-10-1/">Buffer overread in TLS stream cipher suites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2022-07/">Buffer overread in DTLS ClientHello parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2021-12/">Double Free in <code class="docutils literal notranslate"><span class="pre">mbedtls_ssl_set_session()</span></code> in an error case.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2021-07-2/">Local side channel attack on static Diffie-Hellman with Montgomery curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2021-07-1/">Local side channel attack on RSA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2020-09-3/">Protocol weakness in DHE-PSK key exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2020-09-2/">Local side channel attack on RSA and static Diffie-Hellman</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2020-09-1/">Local side channel attack on classical CBC decryption in (D)TLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2020-07/">Side-channel attack on ECC key import and validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2020-04/">Side channel attack on ECDSA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2020-02/">Cache attack against RSA key import in SGX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2019-12/">Side channel attack on ECDSA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2019-10/">Side channel attack on deterministic ECDSA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2018-03/">Mbed TLS Security Advisory 2018-03</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2018-02/">Mbed TLS Security Advisory 2018-02</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2018-01/">mbed TLS Security Advisory 2018-01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2017-02/">mbed TLS Security Advisory 2017-02</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2017-01/">mbed TLS Security Advisory 2017-01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mbedtls-security-advisory-2015-01/">mbed TLS Security Advisory 2015-01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../polarssl-security-advisory-2014-04/">PolarSSL Security Advisory 2014-04</a></li>
<li class="toctree-l2"><a class="reference internal" href="../polarssl-security-advisory-2014-03-poodle-attack-on-ssl-v3/">PolarSSL Security Advisory 2014-03</a></li>
<li class="toctree-l2"><a class="reference internal" href="../polarssl-security-advisory-2014-02/">PolarSSL Security Advisory 2014-02</a></li>
<li class="toctree-l2"><a class="reference internal" href="../polarssl-security-advisory-2014-01/">PolarSSL Security Advisory 2014-01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../polarssl-security-advisory-2013-05/">PolarSSL Security Advisory 2013-05</a></li>
<li class="toctree-l2"><a class="reference internal" href="../polarssl-security-advisory-2013-04/">PolarSSL Security Advisory 2013-04</a></li>
<li class="toctree-l2"><a class="reference internal" href="../polarssl-security-advisory-2013-03/">PolarSSL Security Advisory 2013-03</a></li>
<li class="toctree-l2"><a class="reference internal" href="../polarssl-security-advisory-2013-02/">PolarSSL Security Advisory 2013-02</a></li>
<li class="toctree-l2"><a class="reference internal" href="../polarssl-security-advisory-2013-01/">PolarSSL Security Advisory 2013-01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../polarssl-security-advisory-2012-01/">PolarSSL Security Advisory 2012-01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../polarssl-security-advisory-2011-02/">PolarSSL Security Advisory 2011-02</a></li>
<li class="toctree-l2"><a class="reference internal" href="../polarssl-security-advisory-2011-01/">PolarSSL Security Advisory 2011-01</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING/">Contributing to This Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kb/">Knowledge Base</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">Mbed TLS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../">Security Advisories</a></li>
      <li class="breadcrumb-item active">Limited authentication bypass in TLS 1.3 optional client authentication</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/security-advisories/mbedtls-security-advisory-2024-08-3.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="limited-authentication-bypass-in-tls-1-3-optional-client-authentication">
<h1>Limited authentication bypass in TLS 1.3 optional client authentication<a class="headerlink" href="#limited-authentication-bypass-in-tls-1-3-optional-client-authentication" title="Permalink to this heading"></a></h1>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Title</strong></p></th>
<th class="head"><p>Limited authentication bypass in TLS 1.3 optional client authentication</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>CVE</strong></p></td>
<td><p>CVE-2024-45159</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Date</strong></p></td>
<td><p>30 August 2024</p></td>
</tr>
<tr class="row-even"><td><p><strong>Affects</strong></p></td>
<td><p>Mbed TLS 3.2.0 to 3.6.0 included</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Severity</strong></p></td>
<td><p>Medium</p></td>
</tr>
</tbody>
</table>
<section id="vulnerability">
<h2>Vulnerability<a class="headerlink" href="#vulnerability" title="Permalink to this heading"></a></h2>
<p>TLS servers can use optional authentication of the client with
<code class="docutils literal notranslate"><span class="pre">mbedtls_ssl_conf_authmode(...,</span> <span class="pre">MBEDTLS_SSL_VERIFY_OPTIONAL);</span></code>, then after the
handshake has completed, call <code class="docutils literal notranslate"><span class="pre">mbedtls_ssl_get_verify_result()</span></code> to check if
the client provided a certificate and if it was correct. If a certificate was
not provided or it was not valid, the return value of this function should be
non-zero, with particular bits set to indicate what exactly was wrong about
the certificate.</p>
<p>In particular, with TLS 1.3, if a client presents a certificate that does not
have the <code class="docutils literal notranslate"><span class="pre">digitalSignature</span></code> bit set in its <code class="docutils literal notranslate"><span class="pre">keyUsage</span></code> extension, the bit
<code class="docutils literal notranslate"><span class="pre">MBEDTLS_X509_BADCERT_KEY_USAGE</span></code> should be set in the return value of
<code class="docutils literal notranslate"><span class="pre">mbedtls_ssl_get_verify_result()</span></code>. Similarly, if the certificate doesn’t have
<code class="docutils literal notranslate"><span class="pre">clientAuth</span></code> listed in its <code class="docutils literal notranslate"><span class="pre">extKeyUsage</span></code> extension, the return value should
have the bit <code class="docutils literal notranslate"><span class="pre">MBEDTLS_X509_BADCERT_EXT_KEY_USAGE</span></code> set.</p>
<p>With TLS 1.3 in Mbed TLS 3.6.0, this was not happening: those two bits were
always unset, regardless of whether the <code class="docutils literal notranslate"><span class="pre">keyUsage</span></code> and <code class="docutils literal notranslate"><span class="pre">extKeyUsage</span></code>
extensions were correct or not. In particular, if those were the only issues
with the certificate, <code class="docutils literal notranslate"><span class="pre">mbedtls_ssl_get_verify_result()</span></code> would return <code class="docutils literal notranslate"><span class="pre">0</span></code>,
incorrectly presenting the certificate as fully valid.</p>
<p>This only impacts TLS 1.3 optional client authentication. Mandatory authentication
(<code class="docutils literal notranslate"><span class="pre">MBEDTLS_SSL_VERIFY_REQUIRED</span></code>) is not affected (it will correctly abort the
handshake with a fatal alert if the client certificate is absent or invalid).
TLS 1.2 authentication is not affected. TLS 1.3 server authentication is not
affected, as before 3.6.1 it could not be made optional.</p>
</section>
<section id="impact">
<h2>Impact<a class="headerlink" href="#impact" title="Permalink to this heading"></a></h2>
<p>An attacker in possession of a certificate valid for uses other than TLS
client authentication was able to use it for TLS client authentication.</p>
<p>Note that the certificate needs to be valid (in particular, signed by a CA
trusted by the victim TLS server) except for the <code class="docutils literal notranslate"><span class="pre">keyUsage</span></code> and <code class="docutils literal notranslate"><span class="pre">extKeyUsage</span></code>
extension values.</p>
</section>
<section id="affected-versions">
<h2>Affected versions<a class="headerlink" href="#affected-versions" title="Permalink to this heading"></a></h2>
<p>The vulnerability was present in 3.2.0 which was the first version to support
client authentication in TLS 1.3.</p>
<p>Note that until 3.6.0, support for TLS 1.3 was disabled in the default
compile-time configuration, which meant the vulnerability was not present in a
default build. In 3.6.0, TLS 1.3 became enabled by default, making the
vulnerability present in the default configuration.</p>
</section>
<section id="resolution">
<h2>Resolution<a class="headerlink" href="#resolution" title="Permalink to this heading"></a></h2>
<p>Affected users should upgrade to Mbed TLS 3.6.1.</p>
</section>
<section id="work-around">
<h2>Work-around<a class="headerlink" href="#work-around" title="Permalink to this heading"></a></h2>
<p>The issue can be avoided by forcing use of TLS 1.2 with connections that use
optional client authentication. That is, all servers that call
<code class="docutils literal notranslate"><span class="pre">mbedtls_ssl_conf_authmode(...,</span> <span class="pre">MBEDTLS_SSL_VERIFY_OPTIONAL);</span></code> should also call
<code class="docutils literal notranslate"><span class="pre">mbedtls_ssl_conf_max_tls_version(...,</span> <span class="pre">MBEDTLS_SSL_VERSION_TLS1_2);</span></code>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../mbedtls-security-advisory-2024-10-1/" class="btn btn-neutral float-left" title="Buffer underrun in pkwrite when writing an opaque key pair" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../mbedtls-security-advisory-2024-08-2/" class="btn btn-neutral float-right" title="Stack buffer overflow in ECDSA signature conversion functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright The Mbed TLS Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>