
            Commit Information:
            ------------------
            Author: Yurii Zubrytskyi <zyy@google.com> 1682976948 -0700
            Date: Android Build Coastguard Worker <android-build-coastguard-worker@google.com> 1697064460 +0000
            Bug ID: 

            Commit Message:
            --------------
            Reland "Use reference counted pointers for ApkAssets"This reverts commit cf6e79f809034386b04ae551db815ab087f76c0aUpdates:    Prepare the shared pointers for the whole operation at once    instead of re-locking them on each iteration.    Still a regression of about 5% for changing theme's    AssetManager object, vs the original 40%    + change the log message to a warning as it doesn't break      the appOriginal comment:    Use reference counted pointers for ApkAssets    The primary reason for memory corruption is freed ApkAssets    Java expected them to only be freed in the finalizers, but    there are explicit close() calls now, destroying objects that    are still in use in some AssetManager2 objects    This CL makes sure those AssetManagers don't assume ApkAssets    always exist, but instead tries to lock them in memory for any    access    It also adds logging in case of deleting an assets object with    any weak pointers still existing. Those will get into the    bugreports attached to related bugs to help with investigation.    Benchmarks don't regress, and the device appears to be working.    Given that the crashes used to be pretty rare, let's wait for    any new reports or lack of those.    + add a missing .clang-format file to the jni directory    + enabled C++23 in the project that uses AssetManager headers    Bug: 197260547    Bug: 276922628    Test: unit tests + boot + benchmarks    Old change id: I495fd9e012fe370a1f725dbb0265b4ee1be8d805(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:b3455190124b41e2deb1774d9c05b396b73b41a2)(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:1cf74939f4623609341f1dd9b69616da88482c58)Merged-In: Id668fbcf07db17b09691a344c04e98df83006f97Change-Id: Id668fbcf07db17b09691a344c04e98df83006f97
            