The provided content relates to CVE-2022-48985.

**Root cause of vulnerability:**
A race condition exists in the `mana_cq_handler` function within the mana network driver. After `napi_complete_done()` is called, the `NAPIF_STATE_SCHED` bit might be cleared, which could allow another CPU to start the NAPI thread and access the per-CQ variable `cq->work_done`.

**Weaknesses/vulnerabilities:**
- Race condition on the per-CQ variable `cq->work_done`.
- Concurrent access to shared memory.

**Impact of exploitation:**
If another thread (e.g., from busy_poll) sets `cq->work_done` to a value greater than or equal to the budget, the current thread may continue to run when it should stop. This can lead to memory corruption and system panic.

**Attack vectors:**
- Concurrent execution of NAPI threads and busy polling
- Triggering NAPI completion and concurrent access to the work_done variable via multiple CPUs/threads

**Required attacker capabilities/position:**
- Ability to trigger network events that cause NAPI processing.
- The attacker needs to be able to influence the value of `cq->work_done` through mechanisms like busy polling from other CPUs or threads.
- Must be able to cause concurrent execution.

The patch addresses this vulnerability by saving the value of `cq->work_done` in a local variable before calling `napi_complete_done()`. This prevents the value from being corrupted by concurrent threads. It also introduces a flag bit `GDMA_DRV_CAP_FLAG_1_NAPI_WKDONE_FIX` to signal that the race has been fixed.