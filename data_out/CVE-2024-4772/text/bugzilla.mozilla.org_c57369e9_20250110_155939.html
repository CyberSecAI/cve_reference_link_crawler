

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1870579)
* [XML](/show_bug.cgi?ctype=xml&id=1870579)

Closed
[Bug 1870579](/show_bug.cgi?id=1870579)
(CVE-2024-4772)

Opened 1 year ago
Closed 10 months ago

# Use of insecure rand() function to generate cnonce value in HTTP digest auth

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Use of insecure rand() function to generate cnonce value in HTTP digest auth

## Categories

### (Core :: Networking: HTTP, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking%3A%20HTTP#Networking%3A%20HTTP)

Networking: HTTP
▾

Core :: Networking: HTTP
For bugs in Mozilla's HTTP networking code. This component deals with HTTP specific issues like pipelining, keep-alive, HTTP proxies, 1.1 issues, redirects, authentication (basic), etc.

Examples of appropriate bugs: Problems with proxy authentication; HTTP redirects looping indefinitely, etc.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20HTTP&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20HTTP&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking%3A%20HTTP)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

126 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=wontfix) |
| firefox124 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=wontfix) |
| firefox125 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=wontfix) |
| firefox126 | [+](/buglist.cgi?f1=cf_tracking_firefox126&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | wontfix |
| firefox-esr128 | --- | --- |
| firefox124 |  | wontfix |
| firefox125 |  | wontfix |
| firefox126 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: hanno, Assigned: kershaw)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b56f02655a9de3d7197ee0518f76f814?d=mm&size=40)  [hanno](/user_profile?user_id=30869)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/b032108dab3ccfada1140fb485c6e182?d=mm&size=40)  [smayya](/user_profile?user_id=711499)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1892449](/show_bug.cgi?id=1892449 "RESOLVED FIXED - Latest beta Firefox doesn't allow authentication input to my ADSL router")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1339479](/show_bug.cgi?id=1339479 "RESOLVED WORKSFORME - Hex value \"f\" is not used for \"cnonce\" calculation in nsHttpDigestAuth::GenerateCredentials")

## Details

### (Keywords: csectype-disclosure, reporter-external, sec-low, Whiteboard: [necko-triaged] [adv-main126+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-4772

[Keywords:](/describekeywords.cgi)

[csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[necko-triaged] [adv-main126+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#c7 "11 months ago") | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | - |
| --- | --- | --- |
| [tjr](/user_profile?user_id=578488) | [sec-bounty-hof](#a15309942_578488 "7 months ago") | + |
| --- | --- | --- |
| [tjr](/user_profile?user_id=578488) | sec-bounty-hof | + |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | [qe-verify](#a10443861_488993 "9 months ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Bug 1870579 - Use PK11\_GenerateRandom to generate random number, r=#necko](/attachment.cgi?id=9391447)  [10 months ago](#c3)  [Kershaw Chang [:kershaw]](/user_profile?user_id=505624)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9391447&action=edit) | [Review](/attachment.cgi?id=9391447) |
| --- | --- | --- |
| [advisory.txt](/attachment.cgi?id=9401111)  [8 months ago](#c8)  [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733)   186 bytes, text/plain |  | [Details](/attachment.cgi?id=9401111&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Hanno Boeck](/user_profile?user_id=30869)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1870579#c0)• 1 year ago |
|  | |

The code for HTTP Digest authentication uses the rand() function to generate a random nonce value (the "cnonce").

This code in nsHttpDigestAuth.cpp:

```
  nsAutoCString cnonce;
  static const char hexChar[] = "0123456789abcdef";
  for (int i = 0; i < 16; ++i) {
    cnonce.Append(hexChar[(int)(15.0 * rand() / (RAND_MAX + 1.0))]);
  }

```

Here: <https://searchfox.org/mozilla-central/source/netwerk/protocol/http/nsHttpDigestAuth.cpp#326>

This should probably use some secure random function. (Like RNG\_GenerateGlobalRandomBytes from NSS.)

I am marking this as a security bug, but I should say that I am unsure what the exact security impact is. I am not familiar with the inner workings of the HTTP Digest authentication protocol and what a predictable cnonce would cause. However, this can probably be used to leak information about the state of the rand() RNG to an attacker. This could be bad if rand() is also used in other problematic places.

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1870579#c1)• 1 year ago |
|  | |

Permalink <https://searchfox.org/mozilla-central/rev/91cc8848427fdbbeb324e6ca56a0d08d32d3c308/netwerk/protocol/http/nsHttpDigestAuth.cpp#326>

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1870579#c2)• 1 year ago |
|  | |

Looks like the "binary data to hex characters" bit is also broken and should use a common utility function instead.

See Also: → [1339479](/show_bug.cgi?id=1339479 "RESOLVED WORKSFORME - Hex value \"f\" is not used for \"cnonce\" calculation in nsHttpDigestAuth::GenerateCredentials")

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a31851_406194)• 1 year ago |

Group: core-security → network-core-security

|  | [Kershaw Chang [:kershaw]](/user_profile?user_id=505624)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a96424_505624)• 1 year ago |

Severity: -- → S3Priority: -- → P2Whiteboard: [necko-triaged] [necko-priority-new]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a225338_1689)• 1 year ago |

Keywords: [csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Kershaw Chang [:kershaw]](/user_profile?user_id=505624)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a1928040_505624)• 1 year ago |

Whiteboard: [necko-triaged] [necko-priority-new] → [necko-triaged] [necko-priority-next]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a3895600_428608)• 11 months ago |

Flags: sec-bounty?

|  | [Sunil Mayya](/user_profile?user_id=711499) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a6765162_711499)• 10 months ago |

Whiteboard: [necko-triaged] [necko-priority-next] → [necko-triaged][necko-priority-queue]

|  | [Kershaw Chang [:kershaw]](/user_profile?user_id=505624)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a7603212_505624)• 10 months ago |

Assignee: nobody → kershaw

|  | [Kershaw Chang [:kershaw]](/user_profile?user_id=505624)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1870579#c3)• 10 months ago |
|  | |

Attached file
[Bug 1870579 - Use PK11\_GenerateRandom to generate random number, r=#necko](attachment.cgi?id=9391447)
— [Details](attachment.cgi?id=9391447&action=edit)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1870579#c4)• 10 months ago |
|  | |

Pushed by kjang@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/4c58e1b47bd6>
Use PK11\_GenerateRandom to generate random number, r=necko-reviewers,valentin

|  | [Kershaw Chang [:kershaw]](/user_profile?user_id=505624)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a7971132_505624)• 10 months ago |

Whiteboard: [necko-triaged][necko-priority-queue] → [necko-triaged]

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1870579#c5)• 10 months ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/4c58e1b47bd6>

Group: network-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 10 months ago
[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 126 Branch

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a8003746_695136)• 10 months ago |

[status-firefox124](/buglist.cgi?f1=cf_status_firefox124&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=wontfix)
[status-firefox125](/buglist.cgi?f1=cf_status_firefox125&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)
[tracking-firefox125](/buglist.cgi?f1=cf_tracking_firefox125&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox125&o1=equals&v1=%2B)
[tracking-firefox126](/buglist.cgi?f1=cf_tracking_firefox126&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox126&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [125+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=125%2B)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1870579#c6)• 10 months ago |
|  | |

The patch landed in nightly and beta is affected.

:kershaw, is this bug important enough to require an uplift?

* If yes, please nominate the patch for beta approval.
* If no, please set `status-firefox125` to `wontfix`.

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#uplift_beta.py).

Flags: needinfo?(kershaw)

|  | [Kershaw Chang [:kershaw]](/user_profile?user_id=505624)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a8051256_505624)• 10 months ago |

[status-firefox125](/buglist.cgi?f1=cf_status_firefox125&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=wontfix)Flags: needinfo?(kershaw)

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a8051361_695136)• 10 months ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=wontfix)
[tracking-firefox125](/buglist.cgi?f1=cf_tracking_firefox125&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox125&o1=equals&v1=%2B) → ---
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
[125+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=125%2B) → ---

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1870579#c7)• 10 months ago |
|  | |

Unfortunately this does not meet the severity level for our bug bounty program

Flags: sec-bounty? → sec-bounty-

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a10443861_488993)• 9 months ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Kershaw Chang [:kershaw]](/user_profile?user_id=505624)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a10887276_505624)• 9 months ago |

Regressions: [1892449](/show_bug.cgi?id=1892449 "RESOLVED FIXED - Latest beta Firefox doesn't allow authentication input to my ADSL router")

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a12401960_486733)• 8 months ago |

Whiteboard: [necko-triaged] → [necko-triaged] [adv-main126+]

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1870579#c8)• 8 months ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9401111)
— [Details](attachment.cgi?id=9401111&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a12476546_578488)• 8 months ago |

Alias: CVE-2024-4772

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a14206966_5898)• 7 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a15309942_578488)• 7 months ago |

Flags: sec-bounty-hof+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1870579#a23827550_1689)• 4 months ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1870579&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Kershaw Chang [:kershaw]](/user_profile?user_id=505624)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

