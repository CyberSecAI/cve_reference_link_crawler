=== Content from plugins.trac.wordpress.org_df9804bf_20250110_221757.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3104932%2540convertkit%252Ftrunk%26old%3D3085997%2540convertkit%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3085997/convertkit/trunk?old=3104932&old_path=%2Fconvertkit%2Ftrunk)

---

# Changes in [convertkit/trunk](/browser/convertkit/trunk?rev=3104932 "Show entry in browser") [[3085997:3104932]](/log/convertkit/trunk?rev=3104932&stop_rev=3085997 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[convertkit/trunk](/browser/convertkit/trunk?rev=3104932)
Files:

11 edited

* [admin/class-convertkit-admin-category.php](/browser/convertkit/trunk/admin/class-convertkit-admin-category.php?rev=3104932 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [includes/class-convertkit-ajax.php](/browser/convertkit/trunk/includes/class-convertkit-ajax.php?rev=3104932 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [includes/class-convertkit-output.php](/browser/convertkit/trunk/includes/class-convertkit-output.php?rev=3104932 "Show entry in browser")
  (modified)
  ([4 diffs](#file2 "Show differences"))
* [includes/class-convertkit-setup.php](/browser/convertkit/trunk/includes/class-convertkit-setup.php?rev=3104932 "Show entry in browser")
  (modified)
  ([2 diffs](#file3 "Show differences"))
* [includes/class-convertkit-term.php](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=3104932 "Show entry in browser")
  (modified)
  ([8 diffs](#file4 "Show differences"))
* [languages/convertkit.pot](/browser/convertkit/trunk/languages/convertkit.pot?rev=3104932 "Show entry in browser")
  (modified)
  ([4 diffs](#file5 "Show differences"))
* [readme.txt](/browser/convertkit/trunk/readme.txt?rev=3104932 "Show entry in browser")
  (modified)
  ([3 diffs](#file6 "Show differences"))
* [resources/frontend/js/convertkit.js](/browser/convertkit/trunk/resources/frontend/js/convertkit.js?rev=3104932 "Show entry in browser")
  (modified)
  ([2 diffs](#file7 "Show differences"))
* [views/backend/term/fields-add.php](/browser/convertkit/trunk/views/backend/term/fields-add.php?rev=3104932 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [views/backend/term/fields-edit.php](/browser/convertkit/trunk/views/backend/term/fields-edit.php?rev=3104932 "Show entry in browser")
  (modified)
  ([1 diff](#file9 "Show differences"))
* [wp-convertkit.php](/browser/convertkit/trunk/wp-convertkit.php?rev=3104932 "Show entry in browser")
  (modified)
  ([2 diffs](#file10 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [convertkit/trunk/admin/class-convertkit-admin-category.php](/changeset/3104932/convertkit/trunk/admin/class-convertkit-admin-category.php?old=2830632&old_path=convertkit%2Ftrunk%2Fadmin%2Fclass-convertkit-admin-category.php "Show the [3085997:3104932] differences restricted to convertkit/trunk/admin/class-convertkit-admin-category.php")

  | [r3085997](/browser/convertkit/trunk/admin/class-convertkit-admin-category.php?rev=2830632#L200 "Show revision 3085997 of this file in browser") | [r3104932](/browser/convertkit/trunk/admin/class-convertkit-admin-category.php?rev=3104932#L200 "Show revision 3104932 of this file in browser") |  |
  | --- | --- | --- |
  | 200 | 200 |  |
  | 201 | 201 | // Build metadata. |
  | 202 |  | $meta = ( isset( $\_POST['wp-convertkit']['form'] ) ? intval( $\_POST['wp-convertkit']['form'] ) : '' ); |
  |  | 202 | $meta = array( |
  |  | 203 | 'form'          => ( isset( $\_POST['wp-convertkit']['form'] ) ? intval( $\_POST['wp-convertkit']['form'] ) : '' ), |
  |  | 204 | 'form\_position' => ( isset( $\_POST['wp-convertkit']['form\_position'] ) ? $\_POST['wp-convertkit']['form\_position'] : '' ), |
  |  | 205 | ); |
  | 203 | 206 |  |
  | 204 | 207 | // Save metadata. |
* ## [convertkit/trunk/includes/class-convertkit-ajax.php](/changeset/3104932/convertkit/trunk/includes/class-convertkit-ajax.php?old=2999102&old_path=convertkit%2Ftrunk%2Fincludes%2Fclass-convertkit-ajax.php "Show the [3085997:3104932] differences restricted to convertkit/trunk/includes/class-convertkit-ajax.php")

  | [r3085997](/browser/convertkit/trunk/includes/class-convertkit-ajax.php?rev=2999102#L29 "Show revision 3085997 of this file in browser") | [r3104932](/browser/convertkit/trunk/includes/class-convertkit-ajax.php?rev=3104932#L29 "Show revision 3104932 of this file in browser") |  |
  | --- | --- | --- |
  | 29 | 29 | add\_action( 'wp\_ajax\_convertkit\_store\_subscriber\_email\_as\_id\_in\_cookie', array( $this, 'store\_subscriber\_email\_as\_id\_in\_cookie' ) ); |
  | 30 | 30 |  |
  | 31 |  | ~~add\_action( 'wp\_ajax\_nopriv\_convertkit\_tag\_subscriber', array( $this, 'tag\_subscriber' ) );~~ |
  | 32 |  | ~~add\_action( 'wp\_ajax\_convertkit\_tag\_subscriber', array( $this, 'tag\_subscriber' ) );~~ |
  | 33 |  |  |
  | 34 | 31 | add\_action( 'wp\_ajax\_nopriv\_convertkit\_subscriber\_authentication\_send\_code', array( $this, 'subscriber\_authentication\_send\_code' ) ); |
  | 35 | 32 | add\_action( 'wp\_ajax\_convertkit\_subscriber\_authentication\_send\_code', array( $this, 'subscriber\_authentication\_send\_code' ) ); |
  | […](/browser/convertkit/trunk/includes/class-convertkit-ajax.php?rev=2999102#L160) | […](/browser/convertkit/trunk/includes/class-convertkit-ajax.php?rev=3104932#L157) |  |
  | 160 | 157 |  |
  | 161 | 158 | /\*\* |
  | 162 |  | ~~\* Tags a subscriber when their subscriber ID is present in the cookie or URL,~~ |
  | 163 |  | ~~\* and the Page's ConvertKit Settings specify a Tag.~~ |
  | 164 |  | ~~\*~~ |
  | 165 |  | ~~\* @since   1.9.6~~ |
  | 166 |  | ~~\*/~~ |
  | 167 |  | ~~public function tag\_subscriber() {~~ |
  | 168 |  |  |
  | 169 |  | ~~// Check nonce.~~ |
  | 170 |  | ~~check\_ajax\_referer( 'convertkit', 'convertkit\_nonce' );~~ |
  | 171 |  |  |
  | 172 |  | ~~// Bail if required request parameters not submitted.~~ |
  | 173 |  | ~~if ( ! isset( $\_REQUEST['subscriber\_id'] ) ) {~~ |
  | 174 |  | ~~wp\_send\_json\_error( \_\_( 'ConvertKit: Required parameter `subscriber\_id` not included in AJAX request.', 'convertkit' ) );~~ |
  | 175 |  | ~~}~~ |
  | 176 |  | ~~if ( ! isset( $\_REQUEST['tag'] ) ) {~~ |
  | 177 |  | ~~wp\_send\_json\_error( \_\_( 'ConvertKit: Required parameter `tag` not included in AJAX request.', 'convertkit' ) );~~ |
  | 178 |  | ~~}~~ |
  | 179 |  | ~~$subscriber\_id = absint( sanitize\_text\_field( $\_REQUEST['subscriber\_id'] ) );~~ |
  | 180 |  | ~~$tag\_id        = absint( sanitize\_text\_field( $\_REQUEST['tag'] ) );~~ |
  | 181 |  |  |
  | 182 |  | ~~// Bail if no subscriber ID or tag provided.~~ |
  | 183 |  | ~~if ( empty( $subscriber\_id ) ) {~~ |
  | 184 |  | ~~wp\_send\_json\_error( \_\_( 'ConvertKit: Required parameter `subscriber\_id` empty in AJAX request.', 'convertkit' ) );~~ |
  | 185 |  | ~~}~~ |
  | 186 |  | ~~if ( empty( $tag\_id ) ) {~~ |
  | 187 |  | ~~wp\_send\_json\_error( \_\_( 'ConvertKit: Required parameter `tag` empty in AJAX request.', 'convertkit' ) );~~ |
  | 188 |  | ~~}~~ |
  | 189 |  |  |
  | 190 |  | ~~// Bail if the API hasn't been configured.~~ |
  | 191 |  | ~~$settings = new ConvertKit\_Settings();~~ |
  | 192 |  | ~~if ( ! $settings->has\_api\_key\_and\_secret() ) {~~ |
  | 193 |  | ~~wp\_send\_json\_error( \_\_( 'ConvertKit: API Keys not defined in Plugin Settings.', 'convertkit' ) );~~ |
  | 194 |  | ~~}~~ |
  | 195 |  |  |
  | 196 |  | ~~// Initialize the API.~~ |
  | 197 |  | ~~$api = new ConvertKit\_API( $settings->get\_api\_key(), $settings->get\_api\_secret(), $settings->debug\_enabled() );~~ |
  | 198 |  |  |
  | 199 |  | ~~// Get subscriber's email address by subscriber ID.~~ |
  | 200 |  | ~~$subscriber = $api->get\_subscriber\_by\_id( $subscriber\_id );~~ |
  | 201 |  |  |
  | 202 |  | ~~// Bail if the subscriber could not be found.~~ |
  | 203 |  | ~~if ( is\_wp\_error( $subscriber ) ) {~~ |
  | 204 |  | ~~wp\_send\_json\_error( $subscriber->get\_error\_message() );~~ |
  | 205 |  | ~~}~~ |
  | 206 |  |  |
  | 207 |  | ~~// Extract the subscriber's email.~~ |
  | 208 |  | ~~$email = $subscriber['email\_address'];~~ |
  | 209 |  |  |
  | 210 |  | ~~// Store the subscriber ID as a cookie.~~ |
  | 211 |  | ~~$subscriber = new ConvertKit\_Subscriber();~~ |
  | 212 |  | ~~$subscriber->set( $subscriber\_id );~~ |
  | 213 |  |  |
  | 214 |  | ~~// Tag the subscriber with the Post's tag.~~ |
  | 215 |  | ~~$tag = $api->tag\_subscribe( $tag\_id, $email );~~ |
  | 216 |  |  |
  | 217 |  | ~~// Bail if an error occured tagging the subscriber.~~ |
  | 218 |  | ~~if ( is\_wp\_error( $tag ) ) {~~ |
  | 219 |  | ~~wp\_send\_json\_error( $tag );~~ |
  | 220 |  | ~~}~~ |
  | 221 |  |  |
  | 222 |  | ~~wp\_send\_json\_success( $tag );~~ |
  | 223 |  |  |
  | 224 |  | ~~}~~ |
  | 225 |  |  |
  | 226 |  | ~~/\*\*~~ |
  | 227 | 159 | \* Calls the API to send the subscriber a magic link by email containing a code when |
  | 228 | 160 | \* the modal version of Restrict Content is used, and the user has submitted their email address. |
* ## [convertkit/trunk/includes/class-convertkit-output.php](/changeset/3104932/convertkit/trunk/includes/class-convertkit-output.php?old=3066899&old_path=convertkit%2Ftrunk%2Fincludes%2Fclass-convertkit-output.php "Show the [3085997:3104932] differences restricted to convertkit/trunk/includes/class-convertkit-output.php")

  | [r3085997](/browser/convertkit/trunk/includes/class-convertkit-output.php?rev=3066899#L68 "Show revision 3085997 of this file in browser") | [r3104932](/browser/convertkit/trunk/includes/class-convertkit-output.php?rev=3104932#L68 "Show revision 3104932 of this file in browser") |  |
  | --- | --- | --- |
  | 68 | 68 | public function \_\_construct() { |
  | 69 | 69 |  |
  | 70 |  | add\_action( 'init', array( $this, 'get\_subscriber\_id\_from\_request' ), 1 ); |
  |  | 70 | add\_action( 'init', array( $this, 'get\_subscriber\_id\_from\_request' ) ); |
  |  | 71 | add\_action( 'wp', array( $this, 'maybe\_tag\_subscriber' ) ); |
  | 71 | 72 | add\_action( 'template\_redirect', array( $this, 'output\_form' ) ); |
  | 72 | 73 | add\_action( 'template\_redirect', array( $this, 'page\_takeover' ) ); |
  | 73 | 74 | add\_action( 'wp\_enqueue\_scripts', array( $this, 'enqueue\_scripts' ) ); |
  | 74 | 75 | add\_filter( 'the\_content', array( $this, 'append\_form\_to\_content' ) ); |
  |  | 76 | add\_filter( 'hooked\_block\_types', array( $this, 'maybe\_register\_form\_block\_on\_category\_archive' ), 10, 4 ); |
  |  | 77 | add\_filter( 'hooked\_block\_convertkit/form', array( $this, 'append\_form\_block\_to\_category\_archive' ), 10, 1 ); |
  | 75 | 78 | add\_action( 'wp\_footer', array( $this, 'output\_global\_non\_inline\_form' ), 1 ); |
  | 76 | 79 | add\_action( 'wp\_footer', array( $this, 'output\_scripts\_footer' ) ); |
  |  | 80 |  |
  |  | 81 | } |
  |  | 82 |  |
  |  | 83 | /\*\* |
  |  | 84 | \* Tags the subscriber, if: |
  |  | 85 | \* - a subscriber ID exists in the cookie or URL, |
  |  | 86 | \* - the WordPress Page has the "Add a Tag" setting specified |
  |  | 87 | \* |
  |  | 88 | \* @since   2.4.9.1 |
  |  | 89 | \*/ |
  |  | 90 | public function maybe\_tag\_subscriber() { |
  |  | 91 |  |
  |  | 92 | // Bail if no subscriber ID detected. |
  |  | 93 | if ( ! $this->subscriber\_id ) { |
  |  | 94 | return; |
  |  | 95 | } |
  |  | 96 |  |
  |  | 97 | // Bail if not a singular Post Type supported by ConvertKit. |
  |  | 98 | if ( ! is\_singular( convertkit\_get\_supported\_post\_types() ) ) { |
  |  | 99 | return; |
  |  | 100 | } |
  |  | 101 |  |
  |  | 102 | // Get Post ID. |
  |  | 103 | $post\_id = get\_the\_ID(); |
  |  | 104 |  |
  |  | 105 | // Bail if a Post ID couldn't be identified. |
  |  | 106 | if ( ! $post\_id ) { |
  |  | 107 | return; |
  |  | 108 | } |
  |  | 109 |  |
  |  | 110 | // Get Settings, if they have not yet been loaded. |
  |  | 111 | if ( ! $this->settings ) { |
  |  | 112 | $this->settings = new ConvertKit\_Settings(); |
  |  | 113 | } |
  |  | 114 |  |
  |  | 115 | // Bail if the API if an API Key and Secret is not defined. |
  |  | 116 | if ( ! $this->settings->has\_api\_key\_and\_secret() ) { |
  |  | 117 | return; |
  |  | 118 | } |
  |  | 119 |  |
  |  | 120 | // Get ConvertKit Post's Settings, if they have not yet been loaded. |
  |  | 121 | if ( ! $this->post\_settings ) { |
  |  | 122 | $this->post\_settings = new ConvertKit\_Post( $post\_id ); |
  |  | 123 | } |
  |  | 124 |  |
  |  | 125 | // Bail if no "Add a Tag" setting specified for this Page. |
  |  | 126 | if ( ! $this->post\_settings->has\_tag() ) { |
  |  | 127 | return; |
  |  | 128 | } |
  |  | 129 |  |
  |  | 130 | // Initialize the API. |
  |  | 131 | $api = new ConvertKit\_API( |
  |  | 132 | $this->settings->get\_api\_key(), |
  |  | 133 | $this->settings->get\_api\_secret(), |
  |  | 134 | $this->settings->debug\_enabled(), |
  |  | 135 | 'output' |
  |  | 136 | ); |
  |  | 137 |  |
  |  | 138 | // Get subscriber's email address by subscriber ID. |
  |  | 139 | $subscriber = $api->get\_subscriber\_by\_id( $this->subscriber\_id ); |
  |  | 140 |  |
  |  | 141 | // Bail if the subscriber could not be found. |
  |  | 142 | if ( is\_wp\_error( $subscriber ) ) { |
  |  | 143 | return; |
  |  | 144 | } |
  |  | 145 |  |
  |  | 146 | // Tag subscriber. |
  |  | 147 | $api->tag\_subscribe( $this->post\_settings->get\_tag(), $subscriber['email\_address'] ); |
  | 77 | 148 |  |
  | 78 | 149 | } |
  | […](/browser/convertkit/trunk/includes/class-convertkit-output.php?rev=3066899#L279) | […](/browser/convertkit/trunk/includes/class-convertkit-output.php?rev=3104932#L350) |  |
  | 279 | 350 |  |
  | 280 | 351 | return $content; |
  |  | 352 |  |
  |  | 353 | } |
  |  | 354 |  |
  |  | 355 | /\*\* |
  |  | 356 | \* Registers the ConvertKit Form block to before or after the Query Loop block, when viewing a Category archive. |
  |  | 357 | \* |
  |  | 358 | \* See append\_form\_block\_on\_category\_archive() configures the block to display the applicable category's Form. |
  |  | 359 | \* |
  |  | 360 | \* @since   2.4.9.1 |
  |  | 361 | \* |
  |  | 362 | \* @param   array                           $hooked\_blocks              The list of hooked block types. |
  |  | 363 | \* @param   string                          $position                   The relative position of the hooked blocks. |
  |  | 364 | \* @param   string                          $anchor\_block               The anchor block type. |
  |  | 365 | \* @param   WP\_Block\_Template|WP\_Post|array $context                    The block template, template part, wp\_navigation post type, or pattern that the anchor block belongs to. |
  |  | 366 | \* @return  array |
  |  | 367 | \*/ |
  |  | 368 | public function maybe\_register\_form\_block\_on\_category\_archive( $hooked\_blocks, $position, $anchor\_block, $context ) { |
  |  | 369 |  |
  |  | 370 | // Don't append if we're not viewing a category archive. |
  |  | 371 | if ( ! is\_category() ) { |
  |  | 372 | return $hooked\_blocks; |
  |  | 373 | } |
  |  | 374 |  |
  |  | 375 | if ( $context instanceof WP\_Block\_Template && $context->slug !== 'archive' ) { |
  |  | 376 | return $hooked\_blocks; |
  |  | 377 | } |
  |  | 378 |  |
  |  | 379 | // Don't append if the anchor block isn't the Query Loop block. |
  |  | 380 | if ( $anchor\_block !== 'core/query' ) { |
  |  | 381 | return $hooked\_blocks; |
  |  | 382 | } |
  |  | 383 |  |
  |  | 384 | // Don't append if the Category's form position setting is not defined. |
  |  | 385 | $form\_position = $this->get\_term\_form\_position(); |
  |  | 386 | if ( ! $form\_position ) { |
  |  | 387 | // Unhook this function as we don't need to check again in this request, as we'll |
  |  | 388 | // never output a form on the Category archive. |
  |  | 389 | remove\_filter( 'hooked\_block\_types', array( $this, 'maybe\_register\_form\_block\_on\_category\_archive' ), 10 ); |
  |  | 390 |  |
  |  | 391 | return $hooked\_blocks; |
  |  | 392 | } |
  |  | 393 |  |
  |  | 394 | // Don't append if the position doesn't match. |
  |  | 395 | if ( $form\_position !== $position ) { |
  |  | 396 | return $hooked\_blocks; |
  |  | 397 | } |
  |  | 398 |  |
  |  | 399 | // Hook the ConvertKit Form block. |
  |  | 400 | $hooked\_blocks[] = 'convertkit/form'; |
  |  | 401 |  |
  |  | 402 | // Unhook this function as we don't need to check again in this request, as |
  |  | 403 | // we have now appended the form. |
  |  | 404 | remove\_filter( 'hooked\_block\_types', array( $this, 'maybe\_register\_form\_block\_on\_category\_archive' ), 10 ); |
  |  | 405 |  |
  |  | 406 | return $hooked\_blocks; |
  |  | 407 |  |
  |  | 408 | } |
  |  | 409 |  |
  |  | 410 | /\*\* |
  |  | 411 | \* Configures the ConvertKit Form block that was hooked below the Query Loop block by maybe\_register\_form\_block\_on\_category\_archive, |
  |  | 412 | \* defining the Form ID based on the current Category's Form ID. |
  |  | 413 | \* |
  |  | 414 | \* @since   2.4.9.1 |
  |  | 415 | \* |
  |  | 416 | \* @param   array $parsed\_hooked\_block    The parsed block array for the given hooked block type, or null to suppress the block. |
  |  | 417 | \* @return  null|array |
  |  | 418 | \*/ |
  |  | 419 | public function append\_form\_block\_to\_category\_archive( $parsed\_hooked\_block ) { |
  |  | 420 |  |
  |  | 421 | // Sanity check that we're still viewing a Category archive. |
  |  | 422 | if ( ! is\_category() ) { |
  |  | 423 | // Returning null will unregister the Form block from displaying. |
  |  | 424 | return null; |
  |  | 425 | } |
  |  | 426 |  |
  |  | 427 | // Get Category archive being viewed. |
  |  | 428 | $category = get\_category( get\_query\_var( 'cat' ) ); |
  |  | 429 |  |
  |  | 430 | // Bail if the Category could be found. |
  |  | 431 | if ( is\_wp\_error( $category ) || is\_null( $category ) ) { |
  |  | 432 | // Returning null will unregister the Form block from displaying. |
  |  | 433 | return null; |
  |  | 434 | } |
  |  | 435 |  |
  |  | 436 | // Load Term Settings. |
  |  | 437 | $term\_settings = new ConvertKit\_Term( $category->term\_id ); |
  |  | 438 |  |
  |  | 439 | // Bail if no Form specified for the Category. |
  |  | 440 | if ( ! $term\_settings->has\_form() ) { |
  |  | 441 | // Returning null will unregister the Form block from displaying. |
  |  | 442 | return null; |
  |  | 443 | } |
  |  | 444 |  |
  |  | 445 | // Define the form block attributes to display the given Form ID. |
  |  | 446 | $parsed\_hooked\_block['attrs'] = array( |
  |  | 447 | 'id' => absint( $term\_settings->get\_form() ), |
  |  | 448 | ); |
  |  | 449 |  |
  |  | 450 | // Return the Form block with its attributes. |
  |  | 451 | return $parsed\_hooked\_block; |
  | 281 | 452 |  |
  | 282 | 453 | } |
  | […](/browser/convertkit/trunk/includes/class-convertkit-output.php?rev=3066899#L354) | […](/browser/convertkit/trunk/includes/class-convertkit-output.php?rev=3104932#L525) |  |
  | 354 | 525 | // If here, use the Plugin's Default Form. |
  | 355 | 526 | return $this->settings->get\_default\_form( get\_post\_type( $post\_id ) ); |
  |  | 527 |  |
  |  | 528 | } |
  |  | 529 |  |
  |  | 530 | /\*\* |
  |  | 531 | \* Returns the Form Position setting for the currently viewed Category. |
  |  | 532 | \* |
  |  | 533 | \* @since   2.4.9.1 |
  |  | 534 | \* |
  |  | 535 | \* @return  bool|string |
  |  | 536 | \*/ |
  |  | 537 | private function get\_term\_form\_position() { |
  |  | 538 |  |
  |  | 539 | // Get Category archive being viewed. |
  |  | 540 | $category = get\_category( get\_query\_var( 'cat' ) ); |
  |  | 541 |  |
  |  | 542 | // Bail if the Category could be found. |
  |  | 543 | if ( is\_wp\_error( $category ) || is\_null( $category ) ) { |
  |  | 544 | return false; |
  |  | 545 | } |
  |  | 546 |  |
  |  | 547 | // Load Term Settings. |
  |  | 548 | $term\_settings = new ConvertKit\_Term( $category->term\_id ); |
  |  | 549 |  |
  |  | 550 | // Return false if no form position is defined i.e. we don't want to display |
  |  | 551 | // it on the Category archive. |
  |  | 552 | if ( ! $term\_settings->has\_form\_position() ) { |
  |  | 553 | return false; |
  |  | 554 | } |
  |  | 555 |  |
  |  | 556 | // Return form position. |
  |  | 557 | return $term\_settings->get\_form\_position(); |
  | 356 | 558 |  |
  | 357 | 559 | } |
  | […](/browser/convertkit/trunk/includes/class-convertkit-output.php?rev=3066899#L392) | […](/browser/convertkit/trunk/includes/class-convertkit-output.php?rev=3104932#L594) |  |
  | 392 | 594 | 'nonce'         => wp\_create\_nonce( 'convertkit' ), |
  | 393 | 595 | 'subscriber\_id' => $this->subscriber\_id, |
  | 394 |  | ~~'tag'           => ( ( is\_singular() && $convertkit\_post->has\_tag() ) ? $convertkit\_post->get\_tag() : false ),~~ |
  | 395 |  | ~~'post\_id'       => $post->ID,~~ |
  | 396 | 596 | ) |
  | 397 | 597 | ); |
* ## [convertkit/trunk/includes/class-convertkit-setup.php](/changeset/3104932/convertkit/trunk/includes/class-convertkit-setup.php?old=3085997&old_path=convertkit%2Ftrunk%2Fincludes%2Fclass-convertkit-setup.php "Show the [3085997:3104932] differences restricted to convertkit/trunk/includes/class-convertkit-setup.php")

  | [r3085997](/browser/convertkit/trunk/includes/class-convertkit-setup.php?rev=3085997#L46 "Show revision 3085997 of this file in browser") | [r3104932](/browser/convertkit/trunk/includes/class-convertkit-setup.php?rev=3104932#L46 "Show revision 3104932 of this file in browser") |  |
  | --- | --- | --- |
  | 46 | 46 |  |
  | 47 | 47 | /\*\* |
  |  | 48 | \* 2.4.9.1+: Migrate ck\_default\_form to \_wp\_convertkit\_term\_meta[form], as Term settings |
  |  | 49 | \* support multiple options (form, position etc). |
  |  | 50 | \*/ |
  |  | 51 | if ( version\_compare( $current\_version, '2.4.9.1', '<' ) ) { |
  |  | 52 | $this->migrate\_term\_form\_settings(); |
  |  | 53 | } |
  |  | 54 |  |
  |  | 55 | /\*\* |
  | 48 | 56 | \* 1.6.1+: Refresh Forms, Landing Pages and Tags data stored in settings, |
  | 49 | 57 | \* to get new Forms Builder Settings. |
  | […](/browser/convertkit/trunk/includes/class-convertkit-setup.php?rev=3085997#L73) | […](/browser/convertkit/trunk/includes/class-convertkit-setup.php?rev=3104932#L81) |  |
  | 73 | 81 | // Update the installed version number in the options table. |
  | 74 | 82 | update\_option( 'convertkit\_version', CONVERTKIT\_PLUGIN\_VERSION ); |
  |  | 83 |  |
  |  | 84 | } |
  |  | 85 |  |
  |  | 86 | /\*\* |
  |  | 87 | \* Migrate ck\_default\_form to \_wp\_convertkit\_term\_meta[form], as Term settings |
  |  | 88 | \* support multiple options (form, position etc). |
  |  | 89 | \* |
  |  | 90 | \* @since   2.4.9.1 |
  |  | 91 | \*/ |
  |  | 92 | private function migrate\_term\_form\_settings() { |
  |  | 93 |  |
  |  | 94 | // Get all Terms that have ConvertKit settings defined. |
  |  | 95 | $query = new WP\_Term\_Query( |
  |  | 96 | array( |
  |  | 97 | 'taxonomy'   => 'category', |
  |  | 98 | 'hide\_empty' => false, |
  |  | 99 | 'fields'     => 'ids', |
  |  | 100 | 'meta\_query' => array( |
  |  | 101 | array( |
  |  | 102 | 'key'        => 'ck\_default\_form', |
  |  | 103 | 'comparison' => 'EXISTS', |
  |  | 104 | ), |
  |  | 105 | ), |
  |  | 106 | ) |
  |  | 107 | ); |
  |  | 108 |  |
  |  | 109 | // Bail if no Terms exist. |
  |  | 110 | if ( ! $query->terms ) { |
  |  | 111 | return; |
  |  | 112 | } |
  |  | 113 |  |
  |  | 114 | // Iterate through Terms, mapping settings. |
  |  | 115 | foreach ( $query->terms as $term\_id ) { |
  |  | 116 | $term\_settings = new ConvertKit\_Term( $term\_id ); |
  |  | 117 | $term\_settings->save( |
  |  | 118 | array( |
  |  | 119 | 'form'          => get\_term\_meta( $term\_id, 'ck\_default\_form', true ), // Fetch form setting from old meta key. |
  |  | 120 | 'form\_position' => '', // Default to no position. |
  |  | 121 | ) |
  |  | 122 | ); |
  |  | 123 |  |
  |  | 124 | // Delete old Term meta. |
  |  | 125 | delete\_term\_meta( $term\_id, 'ck\_default\_form' ); |
  |  | 126 | } |
  | 75 | 127 |  |
  | 76 | 128 | } |
* ## [convertkit/trunk/includes/class-convertkit-term.php](/changeset/3104932/convertkit/trunk/includes/class-convertkit-term.php?old=2704433&old_path=convertkit%2Ftrunk%2Fincludes%2Fclass-convertkit-term.php "Show the [3085997:3104932] differences restricted to convertkit/trunk/includes/class-convertkit-term.php")

  | [r3085997](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=2704433#L19 "Show revision 3085997 of this file in browser") | [r3104932](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=3104932#L19 "Show revision 3104932 of this file in browser") |  |
  | --- | --- | --- |
  | 19 | 19 | \* @var     string |
  | 20 | 20 | \*/ |
  | 21 |  | const TERM\_META\_KEY = '~~ck\_default\_form~~'; |
  |  | 21 | const TERM\_META\_KEY = '\_wp\_convertkit\_term\_meta'; |
  | 22 | 22 |  |
  | 23 | 23 | /\*\* |
  | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=2704433#L33) | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=3104932#L33) |  |
  | 33 | 33 | \* Holds the Term's Settings |
  | 34 | 34 | \* |
  | 35 |  | \* @var     bool|~~string~~ |
  |  | 35 | \* @var     bool|array |
  | 36 | 36 | \*/ |
  | 37 | 37 | private $settings = false; |
  | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=2704433#L67) | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=3104932#L67) |  |
  | 67 | 67 | \* @since   1.9.6 |
  | 68 | 68 | \* |
  | 69 |  | \* @return  ~~string~~ |
  |  | 69 | \* @return  array |
  | 70 | 70 | \*/ |
  | 71 | 71 | public function get() { |
  | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=2704433#L84) | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=3104932#L84) |  |
  | 84 | 84 | public function get\_form() { |
  | 85 | 85 |  |
  | 86 |  | return $this->settings; |
  |  | 86 | return $this->settings['form']; |
  | 87 | 87 |  |
  | 88 | 88 | } |
  | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=2704433#L97) | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=3104932#L97) |  |
  | 97 | 97 | public function has\_form() { |
  | 98 | 98 |  |
  | 99 |  | // Backward compat. for Terms created/edited prior to 1.9.6, where |
  | 100 |  | // 'default' was used instead of zero to denote the Post / Post Type |
  | 101 |  | // setting should be used for determining the Form to display. |
  | 102 |  | // Using a comparison operator on 'default' will return different results in: |
  | 103 |  | // PHP < 8.0: 'default' > 0 is false |
  | 104 |  | // PHP 8.0+: 'default' > 0 is true |
  | 105 |  | // See https://www.php.net/manual/en/language.operators.comparison.php. |
  | 106 |  | if ( $this->settings === 'default' ) { |
  | 107 |  | return false; |
  | 108 |  | } |
  |  | 99 | return ( $this->settings['form'] > 0 ); |
  | 109 | 100 |  |
  | 110 |  | // If the setting is greater than zero, it's a specific Form ID that |
  | 111 |  | // should be used for Posts assigned to this Category. |
  | 112 |  | return ( $this->settings > 0 ); |
  |  | 101 | } |
  |  | 102 |  |
  |  | 103 | /\*\* |
  |  | 104 | \* Returns the form position setting for the Term |
  |  | 105 | \* on the Term archive. |
  |  | 106 | \* |
  |  | 107 | \* @since   2.4.9.1 |
  |  | 108 | \* |
  |  | 109 | \* @return  string |
  |  | 110 | \*/ |
  |  | 111 | public function get\_form\_position() { |
  |  | 112 |  |
  |  | 113 | return $this->settings['form\_position']; |
  |  | 114 |  |
  |  | 115 | } |
  |  | 116 |  |
  |  | 117 | /\*\* |
  |  | 118 | \* Whether the Term has a ConvertKit Form Position defined |
  |  | 119 | \* for the Term archive. |
  |  | 120 | \* |
  |  | 121 | \* @since   2.4.9.1 |
  |  | 122 | \* |
  |  | 123 | \* @return  bool |
  |  | 124 | \*/ |
  |  | 125 | public function has\_form\_position() { |
  |  | 126 |  |
  |  | 127 | return ( $this->settings['form\_position'] !== '' ); |
  | 113 | 128 |  |
  | 114 | 129 | } |
  | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=2704433#L119) | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=3104932#L134) |  |
  | 119 | 134 | \* @since   1.9.6 |
  | 120 | 135 | \* |
  | 121 |  | \* @param   string $meta   Settings. |
  |  | 136 | \* @param   array $meta   Settings. |
  |  | 137 | \* @return  bool          Term Meta was updated |
  | 122 | 138 | \*/ |
  | 123 | 139 | public function save( $meta ) { |
  | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=2704433#L133) | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=3104932#L149) |  |
  | 133 | 149 | \* @since   1.9.6 |
  | 134 | 150 | \* |
  | 135 |  | \* @return  ~~string~~ |
  |  | 151 | \* @return  array |
  | 136 | 152 | \*/ |
  | 137 | 153 | public function get\_default\_settings() { |
  | 138 | 154 |  |
  | 139 |  | $defaults = ''; |
  |  | 155 | $defaults = array( |
  |  | 156 | 'form'          => '', |
  |  | 157 | 'form\_position' => '', |
  |  | 158 | ); |
  | 140 | 159 |  |
  | 141 | 160 | /\*\* |
  | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=2704433#L145) | […](/browser/convertkit/trunk/includes/class-convertkit-term.php?rev=3104932#L164) |  |
  | 145 | 164 | \* @since   1.9.6 |
  | 146 | 165 | \* |
  | 147 |  | \* @param   ~~string~~  $defaults   Default Form |
  |  | 166 | \* @param   array  $defaults   Default Form |
  | 148 | 167 | \*/ |
  | 149 | 168 | $defaults = apply\_filters( 'convertkit\_term\_get\_default\_settings', $defaults ); |
* ## [convertkit/trunk/languages/convertkit.pot](/changeset/3104932/convertkit/trunk/languages/convertkit.pot?old=3085997&old_path=convertkit%2Ftrunk%2Flanguages%2Fconvertkit.pot "Show the [3085997:3104932] differences restricted to convertkit/trunk/languages/convertkit.pot")

  | [r3085997](/browser/convertkit/trunk/languages/convertkit.pot?rev=3085997#L3 "Show revision 3085997 of this file in browser") | [r3104932](/browser/convertkit/trunk/languages/convertkit.pot?rev=3104932#L3 "Show revision 3104932 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | msgid "" |
  | 4 | 4 | msgstr "" |
  | 5 |  | "Project-Id-Version: ConvertKit 2.4.9\n" |
  |  | 5 | "Project-Id-Version: ConvertKit 2.4.9.1\n" |
  | 6 | 6 | "Report-Msgid-Bugs-To: https://wordpress.org/support/plugin/convertkit\n" |
  | 7 | 7 | "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n" |
  | […](/browser/convertkit/trunk/languages/convertkit.pot?rev=3085997#L10) | […](/browser/convertkit/trunk/languages/convertkit.pot?rev=3104932#L10) |  |
  | 10 | 10 | "Content-Type: text/plain; charset=UTF-8\n" |
  | 11 | 11 | "Content-Transfer-Encoding: 8bit\n" |
  | 12 |  | "POT-Creation-Date: 2024-0~~5-13T15:32:16~~+00:00\n" |
  |  | 12 | "POT-Creation-Date: 2024-06-20T08:04:00+00:00\n" |
  | 13 | 13 | "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n" |
  | 14 | 14 | "X-Generator: WP-CLI 2.9.0\n" |
  | […](/browser/convertkit/trunk/languages/convertkit.pot?rev=3085997#L987) | […](/browser/convertkit/trunk/languages/convertkit.pot?rev=3104932#L987) |  |
  | 987 | 987 | msgstr "" |
  | 988 | 988 |  |
  | 989 |  | #: includes/class-convertkit-ajax.php:87 |
  | 990 |  | #: includes/class-convertkit-ajax.php:174 |
  |  | 989 | #: includes/class-convertkit-ajax.php:84 |
  | 991 | 990 | msgid "ConvertKit: Required parameter `subscriber\_id` not included in AJAX request." |
  | 992 | 991 | msgstr "" |
  | 993 | 992 |  |
  | 994 |  | #: includes/class-convertkit-ajax.php:93 |
  | 995 |  | #: includes/class-convertkit-ajax.php:184 |
  |  | 993 | #: includes/class-convertkit-ajax.php:90 |
  | 996 | 994 | msgid "ConvertKit: Required parameter `subscriber\_id` empty in AJAX request." |
  | 997 | 995 | msgstr "" |
  | 998 | 996 |  |
  | 999 |  | #: includes/class-convertkit-ajax.php:12~~9~~ |
  |  | 997 | #: includes/class-convertkit-ajax.php:126 |
  | 1000 | 998 | msgid "ConvertKit: Required parameter `email` not included in AJAX request." |
  | 1001 | 999 | msgstr "" |
  | 1002 | 1000 |  |
  | 1003 |  | #: includes/class-convertkit-ajax.php:13~~5~~ |
  |  | 1001 | #: includes/class-convertkit-ajax.php:132 |
  | 1004 | 1002 | msgid "ConvertKit: Required parameter `email` is empty." |
  | 1005 | 1003 | msgstr "" |
  | 1006 | 1004 |  |
  | 1007 |  | #: includes/class-convertkit-ajax.php:1~~40~~ |
  |  | 1005 | #: includes/class-convertkit-ajax.php:137 |
  | 1008 | 1006 | msgid "ConvertKit: Required parameter `email` is not an email address." |
  | 1009 |  | ~~msgstr ""~~ |
  | 1010 |  |  |
  | 1011 |  | ~~#: includes/class-convertkit-ajax.php:177~~ |
  | 1012 |  | ~~msgid "ConvertKit: Required parameter `tag` not included in AJAX request."~~ |
  | 1013 |  | ~~msgstr ""~~ |
  | 1014 |  |  |
  | 1015 |  | ~~#: includes/class-convertkit-ajax.php:187~~ |
  | 1016 |  | ~~msgid "ConvertKit: Required parameter `tag` empty in AJAX request."~~ |
  | 1017 |  | ~~msgstr ""~~ |
  | 1018 |  |  |
  | 1019 |  | ~~#: includes/class-convertkit-ajax.php:193~~ |
  | 1020 |  | ~~msgid "ConvertKit: API Keys not defined in Plugin Settings."~~ |
  | 1021 | 1007 | msgstr "" |
  | 1022 | 1008 |  |
  | […](/browser/convertkit/trunk/languages/convertkit.pot?rev=3085997#L1754) | […](/browser/convertkit/trunk/languages/convertkit.pot?rev=3104932#L1740) |  |
  | 1754 | 1740 | msgstr "" |
  | 1755 | 1741 |  |
  |  | 1742 | #: views/backend/term/fields-add.php:47 |
  |  | 1743 | msgid "Display CovertKit Form on Archive?" |
  |  | 1744 | msgstr "" |
  |  | 1745 |  |
  |  | 1746 | #: views/backend/term/fields-add.php:50 |
  |  | 1747 | #: views/backend/term/fields-edit.php:54 |
  | 1756 | 1748 | #: views/backend/tinymce/modal-field.php:80 |
  | 1757 | 1749 | msgid "No" |
  |  | 1750 | msgstr "" |
  |  | 1751 |  |
  |  | 1752 | #: views/backend/term/fields-add.php:51 |
  |  | 1753 | #: views/backend/term/fields-edit.php:55 |
  |  | 1754 | msgid "Before Posts" |
  |  | 1755 | msgstr "" |
  |  | 1756 |  |
  |  | 1757 | #: views/backend/term/fields-add.php:52 |
  |  | 1758 | #: views/backend/term/fields-edit.php:56 |
  |  | 1759 | msgid "After Posts" |
  |  | 1760 | msgstr "" |
  |  | 1761 |  |
  |  | 1762 | #: views/backend/term/fields-add.php:56 |
  |  | 1763 | #: views/backend/term/fields-edit.php:60 |
  |  | 1764 | msgid "Whether to display the Form on this Category's archive page, above or below the main posts list." |
  |  | 1765 | msgstr "" |
  |  | 1766 |  |
  |  | 1767 | #: views/backend/term/fields-edit.php:50 |
  |  | 1768 | msgid "Display ConvertKit Form on Archive?" |
  | 1758 | 1769 | msgstr "" |
  | 1759 | 1770 |  |
* ## [convertkit/trunk/readme.txt](/changeset/3104932/convertkit/trunk/readme.txt?old=3085997&old_path=convertkit%2Ftrunk%2Freadme.txt "Show the [3085997:3104932] differences restricted to convertkit/trunk/readme.txt")

  | [r3085997](/browser/convertkit/trunk/readme.txt?rev=3085997#L4 "Show revision 3085997 of this file in browser") | [r3104932](/browser/convertkit/trunk/readme.txt?rev=3104932#L4 "Show revision 3104932 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Tags: email marketing, email newsletter, newsletter, subscribers, membership |
  | 5 | 5 | Requires at least: 5.0 |
  | 6 |  | Tested up to: 6.5.~~3~~ |
  |  | 6 | Tested up to: 6.5.4 |
  | 7 | 7 | Requires PHP: 5.6.20 |
  | 8 |  | Stable tag: 2.4.9 |
  |  | 8 | Stable tag: 2.4.9.1 |
  | 9 | 9 | License: GPLv2 or later |
  | 10 | 10 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/convertkit/trunk/readme.txt?rev=3085997#L16) | […](/browser/convertkit/trunk/readme.txt?rev=3104932#L16) |  |
  | 16 | 16 | [ConvertKit](https://convertkit.com?utm\_source=wordpress&utm\_term=en\_US&utm\_content=readme) makes it easy to create, send and manage your email marketing campaigns; grow your email subscribers lists; send targeted email newsletters; sell more products and build your membership site - all by easily embedding email marketing / email subscriber forms anywhere on your WordPress web site. |
  | 17 | 17 |  |
  | 18 |  | \*\*New to ConvertKit? [Creating an account](https://app.convertkit.com/users/signup?plan=~~1k&utm\_source=wordpress&utm\_term=en\_US&utm\_content=readme) is 100% free for your first 1~~,000 subscribers, making ConvertKit an email marketing solution for everyone - whether you're new to email marketing or a seasoned professional email marketer.\*\* |
  |  | 18 | \*\*New to ConvertKit? [Creating an account](https://app.convertkit.com/users/signup?plan=newsletter-free&utm\_source=wordpress&utm\_term=en\_US&utm\_content=readme) is 100% free for your first 10,000 subscribers, making ConvertKit an email marketing solution for everyone - whether you're new to email marketing or a seasoned professional email marketer.\*\* |
  | 19 | 19 |  |
  | 20 | 20 | ### Email Newsletter and Email Marketing Features |
  | […](/browser/convertkit/trunk/readme.txt?rev=3085997#L158) | […](/browser/convertkit/trunk/readme.txt?rev=3104932#L158) |  |
  | 158 | 158 |  |
  | 159 | 159 | == Changelog == |
  |  | 160 |  |
  |  | 161 | ### 2.4.9.1 2024-06-20 |
  |  | 162 | \* Added: Categories: Option to display specified ConvertKit Form on Category archives |
  |  | 163 | \* Fix: Move "Add a Tag" logic to backend when tagging a subscriber, instead of using AJAX |
  | 160 | 164 |  |
  | 161 | 165 | ### 2.4.9 2024-05-13 |
* ## [convertkit/trunk/resources/frontend/js/convertkit.js](/changeset/3104932/convertkit/trunk/resources/frontend/js/convertkit.js?old=3025162&old_path=convertkit%2Ftrunk%2Fresources%2Ffrontend%2Fjs%2Fconvertkit.js "Show the [3085997:3104932] differences restricted to convertkit/trunk/resources/frontend/js/convertkit.js")

  | [r3085997](/browser/convertkit/trunk/resources/frontend/js/convertkit.js?rev=3025162#L7 "Show revision 3085997 of this file in browser") | [r3104932](/browser/convertkit/trunk/resources/frontend/js/convertkit.js?rev=3104932#L7 "Show revision 3104932 of this file in browser") |  |
  | --- | --- | --- |
  | 7 | 7 | \* @author ConvertKit |
  | 8 | 8 | \*/ |
  | 9 |  |  |
  | 10 |  | ~~/\*\*~~ |
  | 11 |  | ~~\* Tags the given subscriber ID with the given tag~~ |
  | 12 |  | ~~\*~~ |
  | 13 |  | ~~\* @since   1.9.6~~ |
  | 14 |  | ~~\*~~ |
  | 15 |  | ~~\* @param   int     subscriber\_id   Subscriber ID~~ |
  | 16 |  | ~~\* @param   string  tag             Tag~~ |
  | 17 |  | ~~\* @param   int     post\_id         WordPress Post ID~~ |
  | 18 |  | ~~\*/~~ |
  | 19 |  | ~~function convertKitTagSubscriber( subscriber\_id, tag, post\_id ) {~~ |
  | 20 |  |  |
  | 21 |  | ~~if ( convertkit.debug ) {~~ |
  | 22 |  | ~~console.log( 'convertKitTagSubscriber' );~~ |
  | 23 |  | ~~console.log( convertkit );~~ |
  | 24 |  | ~~console.log( subscriber\_id );~~ |
  | 25 |  | ~~console.log( tag );~~ |
  | 26 |  | ~~console.log( post\_id );~~ |
  | 27 |  | ~~}~~ |
  | 28 |  |  |
  | 29 |  | ~~fetch(~~ |
  | 30 |  | ~~convertkit.ajaxurl,~~ |
  | 31 |  | ~~{~~ |
  | 32 |  | ~~method: 'POST',~~ |
  | 33 |  | ~~headers: {~~ |
  | 34 |  | ~~'Content-Type': 'application/x-www-form-urlencoded',~~ |
  | 35 |  | ~~},~~ |
  | 36 |  | ~~body: new URLSearchParams(~~ |
  | 37 |  | ~~{~~ |
  | 38 |  | ~~action: 'convertkit\_tag\_subscriber',~~ |
  | 39 |  | ~~convertkit\_nonce: convertkit.nonce,~~ |
  | 40 |  | ~~subscriber\_id: subscriber\_id,~~ |
  | 41 |  | ~~tag: tag,~~ |
  | 42 |  | ~~post\_id: post\_id,~~ |
  | 43 |  | ~~}~~ |
  | 44 |  | ~~)~~ |
  | 45 |  | ~~}~~ |
  | 46 |  | ~~)~~ |
  | 47 |  | ~~.then(~~ |
  | 48 |  | ~~function ( response ) {~~ |
  | 49 |  | ~~if ( convertkit.debug ) {~~ |
  | 50 |  | ~~console.log( response );~~ |
  | 51 |  | ~~}~~ |
  | 52 |  |  |
  | 53 |  | ~~return response.json();~~ |
  | 54 |  | ~~}~~ |
  | 55 |  | ~~)~~ |
  | 56 |  | ~~.then(~~ |
  | 57 |  | ~~function ( result ) {~~ |
  | 58 |  | ~~if ( convertkit.debug ) {~~ |
  | 59 |  | ~~console.log( result );~~ |
  | 60 |  | ~~}~~ |
  | 61 |  |  |
  | 62 |  | ~~convertKitRemoveSubscriberIDFromURL( window.location.href );~~ |
  | 63 |  | ~~}~~ |
  | 64 |  | ~~)~~ |
  | 65 |  | ~~.catch(~~ |
  | 66 |  | ~~function ( error ) {~~ |
  | 67 |  | ~~if ( convertkit.debug ) {~~ |
  | 68 |  | ~~console.error( error );~~ |
  | 69 |  | ~~}~~ |
  | 70 |  |  |
  | 71 |  | ~~convertKitRemoveSubscriberIDFromURL( window.location.href );~~ |
  | 72 |  | ~~}~~ |
  | 73 |  | ~~);~~ |
  | 74 |  |  |
  | 75 |  | ~~}~~ |
  | 76 | 9 |  |
  | 77 | 10 | /\*\* |
  | […](/browser/convertkit/trunk/resources/frontend/js/convertkit.js?rev=3025162#L246) | […](/browser/convertkit/trunk/resources/frontend/js/convertkit.js?rev=3104932#L179) |  |
  | 246 | 179 | function () { |
  | 247 | 180 |  |
  | 248 |  | if ( convertkit.subscriber\_id > 0 && convertkit.tag && convertkit.post\_id ) { |
  | 249 |  | // If the user can be detected as a ConvertKit Subscriber (i.e. their Subscriber ID is in a cookie or the URL), |
  | 250 |  | // and the Page/Post they are viewing has a Tag specified, subscribe them to the tag. |
  | 251 |  | convertKitTagSubscriber( convertkit.subscriber\_id, convertkit.tag, convertkit.post\_id ); |
  | 252 |  | } else if ( convertkit.subscriber\_id > 0 ) { |
  |  | 181 | if ( convertkit.subscriber\_id > 0 ) { |
  | 253 | 182 | // If the user can be detected as a ConvertKit Subscriber (i.e. their Subscriber ID is in a cookie or the URL), |
  | 254 | 183 | // update the cookie now. |
* ## [convertkit/trunk/views/backend/term/fields-add.php](/changeset/3104932/convertkit/trunk/views/backend/term/fields-add.php?old=3005170&old_path=convertkit%2Ftrunk%2Fviews%2Fbackend%2Fterm%2Ffields-add.php "Show the [3085997:3104932] differences restricted to convertkit/trunk/views/backend/term/fields-add.php")

  | [r3085997](/browser/convertkit/trunk/views/backend/term/fields-add.php?rev=3005170#L42 "Show revision 3085997 of this file in browser") | [r3104932](/browser/convertkit/trunk/views/backend/term/fields-add.php?rev=3104932#L42 "Show revision 3104932 of this file in browser") |  |
  | --- | --- | --- |
  | 42 | 42 | </p> |
  | 43 | 43 | </div> |
  |  | 44 | </div> |
  |  | 45 |  |
  |  | 46 | <div class="form-field term-description-wrap"> |
  |  | 47 | <label for="wp-convertkit-form-position"><?php esc\_html\_e( 'Display CovertKit Form on Archive?', 'convertkit' ); ?></label> |
  |  | 48 |  |
  |  | 49 | <select name="wp-convertkit[form\_position]" id="wp-convertkit-form-position" size="1"> |
  |  | 50 | <option value="" selected><?php esc\_attr\_e( 'No', 'convertkit' ); ?></option> |
  |  | 51 | <option value="before"><?php esc\_attr\_e( 'Before Posts', 'convertkit' ); ?></option> |
  |  | 52 | <option value="after"><?php esc\_attr\_e( 'After Posts', 'convertkit' ); ?></option> |
  |  | 53 | </select> |
  |  | 54 | <p class="description"> |
  |  | 55 | <?php |
  |  | 56 | esc\_html\_e( 'Whether to display the Form on this Category\'s archive page, above or below the main posts list.', 'convertkit' ); |
  |  | 57 | ?> |
  |  | 58 | </p> |
  | 44 | 59 |  |
  | 45 | 60 | <?php |
* ## [convertkit/trunk/views/backend/term/fields-edit.php](/changeset/3104932/convertkit/trunk/views/backend/term/fields-edit.php?old=3005170&old_path=convertkit%2Ftrunk%2Fviews%2Fbackend%2Fterm%2Ffields-edit.php "Show the [3085997:3104932] differences restricted to convertkit/trunk/views/backend/term/fields-edit.php")

  | [r3085997](/browser/convertkit/trunk/views/backend/term/fields-edit.php?rev=3005170#L44 "Show revision 3085997 of this file in browser") | [r3104932](/browser/convertkit/trunk/views/backend/term/fields-edit.php?rev=3104932#L44 "Show revision 3104932 of this file in browser") |  |
  | --- | --- | --- |
  | 44 | 44 | </p> |
  | 45 | 45 | </div> |
  |  | 46 | </td> |
  |  | 47 | </tr> |
  |  | 48 | <tr class="form-field"> |
  |  | 49 | <th scope="row"> |
  |  | 50 | <label for="wp-convertkit-form-position"><?php esc\_html\_e( 'Display ConvertKit Form on Archive?', 'convertkit' ); ?></label> |
  |  | 51 | </th> |
  |  | 52 | <td> |
  |  | 53 | <select name="wp-convertkit[form\_position]" id="wp-convertkit-form-position" size="1"> |
  |  | 54 | <option value=""><?php esc\_attr\_e( 'No', 'convertkit' ); ?></option> |
  |  | 55 | <option value="before"<?php selected( 'before', $convertkit\_term->get\_form\_position() ); ?>><?php esc\_attr\_e( 'Before Posts', 'convertkit' ); ?></option> |
  |  | 56 | <option value="after"<?php selected( 'after', $convertkit\_term->get\_form\_position() ); ?>><?php esc\_attr\_e( 'After Posts', 'convertkit' ); ?></option> |
  |  | 57 | </select> |
  |  | 58 | <p class="description"> |
  |  | 59 | <?php |
  |  | 60 | esc\_html\_e( 'Whether to display the Form on this Category\'s archive page, above or below the main posts list.', 'convertkit' ); |
  |  | 61 | ?> |
  |  | 62 | </p> |
  |  | 63 |  |
  | 46 | 64 | <?php |
  | 47 | 65 | wp\_nonce\_field( 'wp-convertkit-save-meta', 'wp-convertkit-save-meta-nonce' ); |
* ## [convertkit/trunk/wp-convertkit.php](/changeset/3104932/convertkit/trunk/wp-convertkit.php?old=3085997&old_path=convertkit%2Ftrunk%2Fwp-convertkit.php "Show the [3085997:3104932] differences restricted to convertkit/trunk/wp-convertkit.php")

  | [r3085997](/browser/convertkit/trunk/wp-convertkit.php?rev=3085997#L10 "Show revision 3085997 of this file in browser") | [r3104932](/browser/convertkit/trunk/wp-convertkit.php?rev=3104932#L10 "Show revision 3104932 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | \* Plugin URI: https://convertkit.com/ |
  | 11 | 11 | \* Description: Display ConvertKit email subscription forms, landing pages, products, broadcasts and more. |
  | 12 |  | \* Version: 2.4.9 |
  |  | 12 | \* Version: 2.4.9.1 |
  | 13 | 13 | \* Author: ConvertKit |
  | 14 | 14 | \* Author URI: https://convertkit.com/ |
  | […](/browser/convertkit/trunk/wp-convertkit.php?rev=3085997#L26) | […](/browser/convertkit/trunk/wp-convertkit.php?rev=3104932#L26) |  |
  | 26 | 26 | define( 'CONVERTKIT\_PLUGIN\_URL', plugin\_dir\_url( \_\_FILE\_\_ ) ); |
  | 27 | 27 | define( 'CONVERTKIT\_PLUGIN\_PATH', \_\_DIR\_\_ ); |
  | 28 |  | define( 'CONVERTKIT\_PLUGIN\_VERSION', '2.4.9' ); |
  |  | 28 | define( 'CONVERTKIT\_PLUGIN\_VERSION', '2.4.9.1' ); |
  | 29 | 29 |  |
  | 30 | 30 | // Load shared classes, if they have not been included by another ConvertKit Plugin. |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3104932&old=3085997&new_path=%2Fconvertkit%2Ftrunk&old_path=%2Fconvertkit%2Ftrunk)
* [Zip Archive](?format=zip&new=3104932&old=3085997&new_path=%2Fconvertkit%2Ftrunk&old_path=%2Fconvertkit%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_e2b04180_20250110_221803.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# ConvertKit <= 2.4.9 - Missing Authorization

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   ConvertKit <= 2.4.9 - Missing Authorization

5.3

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N)

| CVE | [CVE-2024-3961](https://www.cve.org/CVERecord?id=CVE-2024-3961) |
| --- | --- |
| CVSS | 5.3 (Medium) |
| Publicly Published | June 20, 2024 |
| Last Updated | June 21, 2024 |
| Researcher | [1337\_Wannabe - home](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/amrawad) |

### Description

The ConvertKit – Email Newsletter, Email Marketing, Subscribers and Landing Pages plugin for WordPress is vulnerable to unauthorized modification of data due to a missing capability check on the tag\_subscriber function in all versions up to, and including, 2.4.9. This makes it possible for unauthenticated attackers to subscribe users to tags. Financial damages may occur to site owners if their API quota is exceeded.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&new=3104932%40convertkit%2Ftrunk&old=3085997%40convertkit%2Ftrunk&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fconvertkit%2Fconvertkit-249-missing-authorization&t=ConvertKit%20%3C%3D%202.4.9%20-%20Missing%20Authorization "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fconvertkit%2Fconvertkit-249-missing-authorization&text=ConvertKit%20%3C%3D%202.4.9%20-%20Missing%20Authorization "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fconvertkit%2Fconvertkit-249-missing-authorization "LinkedIn")
Email

## Vulnerability Details for Kit (formerly ConvertKit) – Email Newsletter, Email Marketing, Subscribers and Landing Pages

#### [Kit (formerly ConvertKit) – Email Newsletter, Email Marketing, Subscribers and Landing Pages](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/convertkit)

| Software Type | Plugin |
| --- | --- |
| Software Slug | convertkit [(view on wordpress.org)](https://wordpress.org/plugins/convertkit) |
| Patched? | Yes |
| Remediation | Update to version 2.4.9.1, or a newer patched version |
| Affected Version | * <= 2.4.9 |
| Patched Version | * 2.4.9.1 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


