
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcalico%2Fcalico%2Fissues%2F7908)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcalico%2Fcalico%2Fissues%2F7908)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=projectcalico%2Fcalico)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcalico](/projectcalico)
/
**[calico](/projectcalico/calico)**
Public

* [Notifications](/login?return_to=%2Fprojectcalico%2Fcalico) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fprojectcalico%2Fcalico)
* [Star
   6.1k](/login?return_to=%2Fprojectcalico%2Fcalico)

* [Code](/projectcalico/calico)
* [Issues
  364](/projectcalico/calico/issues)
* [Pull requests
  56](/projectcalico/calico/pulls)
* [Discussions](/projectcalico/calico/discussions)
* [Actions](/projectcalico/calico/actions)
* [Projects
  0](/projectcalico/calico/projects)
* [Security](/projectcalico/calico/security)
* [Insights](/projectcalico/calico/pulse)

Additional navigation options

* [Code](/projectcalico/calico)
* [Issues](/projectcalico/calico/issues)
* [Pull requests](/projectcalico/calico/pulls)
* [Discussions](/projectcalico/calico/discussions)
* [Actions](/projectcalico/calico/actions)
* [Projects](/projectcalico/calico/projects)
* [Security](/projectcalico/calico/security)
* [Insights](/projectcalico/calico/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fprojectcalico%2Fcalico%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fprojectcalico%2Fcalico%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# calico-typha hangs during unclean client TLS handshake #7908

Closed

[rodrigorfk](/rodrigorfk) opened this issue
Aug 8, 2023
· 2 comments
 · Fixed by [#7909](https://github.com/projectcalico/calico/pull/7909)

Closed

# [calico-typha hangs during unclean client TLS handshake](#top) #7908

[rodrigorfk](/rodrigorfk) opened this issue
Aug 8, 2023
· 2 comments
 · Fixed by [#7909](https://github.com/projectcalico/calico/pull/7909)

Labels
[impact/high](/projectcalico/calico/labels/impact/high)
[kind/bug](/projectcalico/calico/labels/kind/bug)
[likelihood/low](/projectcalico/calico/labels/likelihood/low)

## Comments

[![@rodrigorfk](https://avatars.githubusercontent.com/u/1995033?s=80&u=541f9e1f06f16a9a067735f7b384afe82d7a3042&v=4)](/rodrigorfk)

Copy link

Contributor

### **[rodrigorfk](/rodrigorfk)** commented [Aug 8, 2023](#issue-1841028610) • edited Loading

| On certain special conditions, a client TLS handshake can block the typha server indefinitely, as you can see [here](https://github.com/projectcalico/calico/blob/60f8a9e884567ca690487849ff9df991091eced0/typha/pkg/syncserver/sync_server.go#L427), the `Handshake()` call is performed inside the main server handle `for` loop, without any timeout, so a miss behaving client, with an unclean TLS handshake, can take the server down and block the main loop indefinitely while other connections will be setting idle and waiting for that handshake to eventually finish. Expected Behavior A misbehaving client should not impact the availability of the typha server, the TLS handshake must be performed with a safe upper timeout and eventually moved out of the main server handle `for` loop. Current Behavior The client TLS handshake is performed in the main server handle `for` loop without a safe timeout, misbehaving clients can impact the availability of the typha server if the connection is not clearly closed/aborted at client side. Possible Solution  1. Implement a timeout in the TLS handshake to the duration of one Ping interval. 2. Eventually move the TLS handshake to an async go routine and unblock the main server handle `for` loop, so multiple client connections could be handled at the same time.  Steps to Reproduce (for bugs)  1. Perform a few cycles of Kubernetes cluster growth and shrink, eventually one of the nodes running the `calico-node` client will be abruptly terminated during client TLS handshake, leaving the connection towards the `calico-typha` hanging in an unclean state during TLS handshake, the `calico-typha` will never, under a reasonable time, recover from that, the server will be blocked for days and eventually all `calico-typha` replicas will get to the same state, bringing the node network down. 2. Another easy way to simulate this is to perform a `port-forward` to a `calico-typha` pod at port `5473` and then open a `telnet` connection to that port, the typha server will hang with a message like the following and other clients won't be able to connect to that typha server anymore:  ``` 2023-08-07 15:12:57.284 [INFO][7] sync_server.go 421: Accepted from xxx.xxx.xxx.xxx:60824 port=5473  ``` Context This issue can eventually bring a Kubernetes production cluster running Calico with calico-typha completely down, please keep in mind the error is only reproduced on certain special conditions, during race conditions in the client termination in the exact moment of a TLS handshake with the typha server, over time, that can affect all replicas of the typha deployment, bringing the availability of the cluster network down. Your Environment  * Calico version - `v3.26.1` * Orchestrator version (e.g. kubernetes, mesos, rkt): `kubernetes` using the `tigera-operator` * Operating System and version: AWS EKS using Amazon EKS optimized Amazon Linux AMIs * Link to your project (optional): |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@rodrigorfk](https://avatars.githubusercontent.com/u/1995033?s=40&u=541f9e1f06f16a9a067735f7b384afe82d7a3042&v=4)](/rodrigorfk)
[rodrigorfk](/rodrigorfk)
mentioned this issue
[Aug 8, 2023](#ref-pullrequest-1841039377)

[fix: adding timeout to the typha server TLS handshake
#7909](/projectcalico/calico/pull/7909)
 Merged

3 tasks

[![@rodrigorfk](https://avatars.githubusercontent.com/u/1995033?s=40&u=541f9e1f06f16a9a067735f7b384afe82d7a3042&v=4)](/rodrigorfk)
[rodrigorfk](/rodrigorfk)
mentioned this issue
[Aug 22, 2023](#ref-pullrequest-1860752083)

[docs: adding timeout to the typha server TLS handshake
tigera/docs#885](/tigera/docs/pull/885)
 Merged

5 tasks

[![@mazdakn](https://avatars.githubusercontent.com/u/4939502?s=40&u=9815131db867d25c1e7f645dc679c00d1bae0476&v=4)](/mazdakn)
[mazdakn](/mazdakn)
added
[kind/bug](/projectcalico/calico/labels/kind/bug)
[likelihood/low](/projectcalico/calico/labels/likelihood/low)
[impact/high](/projectcalico/calico/labels/impact/high)
labels
[Aug 22, 2023](#event-10160818155)

[![@mazdakn](https://avatars.githubusercontent.com/u/4939502?s=80&u=9815131db867d25c1e7f645dc679c00d1bae0476&v=4)](/mazdakn)

Copy link

Member

### **[mazdakn](/mazdakn)** commented [Aug 22, 2023](#issuecomment-1688559722)

| [@rodrigorfk](https://github.com/rodrigorfk) Thanks for reporting and also providing the fix. |
| --- |

All reactions

Sorry, something went wrong.

[![@fasaxc](https://avatars.githubusercontent.com/u/469264?s=40&u=f2793813b61981bc9e790556a835c05c7ef315d4&v=4)](/fasaxc)
[fasaxc](/fasaxc)
closed this as [completed](/projectcalico/calico/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#7909](/projectcalico/calico/pull/7909)
[Aug 23, 2023](#event-10167952689)

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this issue
[Oct 31, 2023](#ref-issue-1971297434)

[x/vulndb: potential Go vuln in github.com/projectcalico/calico: CVE-2023-41377
golang/vulndb#2167](/golang/vulndb/issues/2167)

Closed

[![@anthonytwh](https://avatars.githubusercontent.com/u/25327116?s=80&u=cafb5665a6546a5037d10f7296360467c1dc8e22&v=4)](/anthonytwh)

Copy link

Contributor

### **[anthonytwh](/anthonytwh)** commented [Nov 6, 2023](#issuecomment-1795073499)

| This issue as been assigned [CVE-2023-41378](https://www.cve.org/cverecord?id=CVE-2023-41378) |
| --- |

All reactions

Sorry, something went wrong.

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this issue
[Nov 6, 2023](#ref-issue-1979621889)

[x/vulndb: potential Go vuln in github.com/projectcalico/calico: CVE-2023-41378
golang/vulndb#2178](/golang/vulndb/issues/2178)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcalico%2Fcalico%2Fissues%2F7908)

Assignees

No one assigned

Labels

[impact/high](/projectcalico/calico/labels/impact/high)
[kind/bug](/projectcalico/calico/labels/kind/bug)
[likelihood/low](/projectcalico/calico/labels/likelihood/low)

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [fix: adding timeout to the typha server TLS handshake](/projectcalico/calico/pull/7909)
 [rodrigorfk/calico](/rodrigorfk/calico)

3 participants

[![@rodrigorfk](https://avatars.githubusercontent.com/u/1995033?s=52&v=4)](/rodrigorfk) [![@mazdakn](https://avatars.githubusercontent.com/u/4939502?s=52&v=4)](/mazdakn) [![@anthonytwh](https://avatars.githubusercontent.com/u/25327116?s=52&v=4)](/anthonytwh)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

