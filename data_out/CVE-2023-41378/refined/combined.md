=== Content from github.com_fea97849_20250110_224157.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcalico%2Fcalico%2Fissues%2F7908)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcalico%2Fcalico%2Fissues%2F7908)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=projectcalico%2Fcalico)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcalico](/projectcalico)
/
**[calico](/projectcalico/calico)**
Public

* [Notifications](/login?return_to=%2Fprojectcalico%2Fcalico) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fprojectcalico%2Fcalico)
* [Star
   6.1k](/login?return_to=%2Fprojectcalico%2Fcalico)

* [Code](/projectcalico/calico)
* [Issues
  364](/projectcalico/calico/issues)
* [Pull requests
  56](/projectcalico/calico/pulls)
* [Discussions](/projectcalico/calico/discussions)
* [Actions](/projectcalico/calico/actions)
* [Projects
  0](/projectcalico/calico/projects)
* [Security](/projectcalico/calico/security)
* [Insights](/projectcalico/calico/pulse)

Additional navigation options

* [Code](/projectcalico/calico)
* [Issues](/projectcalico/calico/issues)
* [Pull requests](/projectcalico/calico/pulls)
* [Discussions](/projectcalico/calico/discussions)
* [Actions](/projectcalico/calico/actions)
* [Projects](/projectcalico/calico/projects)
* [Security](/projectcalico/calico/security)
* [Insights](/projectcalico/calico/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fprojectcalico%2Fcalico%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fprojectcalico%2Fcalico%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# calico-typha hangs during unclean client TLS handshake #7908

Closed

[rodrigorfk](/rodrigorfk) opened this issue
Aug 8, 2023
· 2 comments
 · Fixed by [#7909](https://github.com/projectcalico/calico/pull/7909)

Closed

# [calico-typha hangs during unclean client TLS handshake](#top) #7908

[rodrigorfk](/rodrigorfk) opened this issue
Aug 8, 2023
· 2 comments
 · Fixed by [#7909](https://github.com/projectcalico/calico/pull/7909)

Labels
[impact/high](/projectcalico/calico/labels/impact/high)
[kind/bug](/projectcalico/calico/labels/kind/bug)
[likelihood/low](/projectcalico/calico/labels/likelihood/low)

## Comments

[![@rodrigorfk](https://avatars.githubusercontent.com/u/1995033?s=80&u=541f9e1f06f16a9a067735f7b384afe82d7a3042&v=4)](/rodrigorfk)

Copy link

Contributor

### **[rodrigorfk](/rodrigorfk)** commented [Aug 8, 2023](#issue-1841028610) • edited Loading

| On certain special conditions, a client TLS handshake can block the typha server indefinitely, as you can see [here](https://github.com/projectcalico/calico/blob/60f8a9e884567ca690487849ff9df991091eced0/typha/pkg/syncserver/sync_server.go#L427), the `Handshake()` call is performed inside the main server handle `for` loop, without any timeout, so a miss behaving client, with an unclean TLS handshake, can take the server down and block the main loop indefinitely while other connections will be setting idle and waiting for that handshake to eventually finish. Expected Behavior A misbehaving client should not impact the availability of the typha server, the TLS handshake must be performed with a safe upper timeout and eventually moved out of the main server handle `for` loop. Current Behavior The client TLS handshake is performed in the main server handle `for` loop without a safe timeout, misbehaving clients can impact the availability of the typha server if the connection is not clearly closed/aborted at client side. Possible Solution  1. Implement a timeout in the TLS handshake to the duration of one Ping interval. 2. Eventually move the TLS handshake to an async go routine and unblock the main server handle `for` loop, so multiple client connections could be handled at the same time.  Steps to Reproduce (for bugs)  1. Perform a few cycles of Kubernetes cluster growth and shrink, eventually one of the nodes running the `calico-node` client will be abruptly terminated during client TLS handshake, leaving the connection towards the `calico-typha` hanging in an unclean state during TLS handshake, the `calico-typha` will never, under a reasonable time, recover from that, the server will be blocked for days and eventually all `calico-typha` replicas will get to the same state, bringing the node network down. 2. Another easy way to simulate this is to perform a `port-forward` to a `calico-typha` pod at port `5473` and then open a `telnet` connection to that port, the typha server will hang with a message like the following and other clients won't be able to connect to that typha server anymore:  ``` 2023-08-07 15:12:57.284 [INFO][7] sync_server.go 421: Accepted from xxx.xxx.xxx.xxx:60824 port=5473  ``` Context This issue can eventually bring a Kubernetes production cluster running Calico with calico-typha completely down, please keep in mind the error is only reproduced on certain special conditions, during race conditions in the client termination in the exact moment of a TLS handshake with the typha server, over time, that can affect all replicas of the typha deployment, bringing the availability of the cluster network down. Your Environment  * Calico version - `v3.26.1` * Orchestrator version (e.g. kubernetes, mesos, rkt): `kubernetes` using the `tigera-operator` * Operating System and version: AWS EKS using Amazon EKS optimized Amazon Linux AMIs * Link to your project (optional): |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@rodrigorfk](https://avatars.githubusercontent.com/u/1995033?s=40&u=541f9e1f06f16a9a067735f7b384afe82d7a3042&v=4)](/rodrigorfk)
[rodrigorfk](/rodrigorfk)
mentioned this issue
[Aug 8, 2023](#ref-pullrequest-1841039377)

[fix: adding timeout to the typha server TLS handshake
#7909](/projectcalico/calico/pull/7909)
 Merged

3 tasks

[![@rodrigorfk](https://avatars.githubusercontent.com/u/1995033?s=40&u=541f9e1f06f16a9a067735f7b384afe82d7a3042&v=4)](/rodrigorfk)
[rodrigorfk](/rodrigorfk)
mentioned this issue
[Aug 22, 2023](#ref-pullrequest-1860752083)

[docs: adding timeout to the typha server TLS handshake
tigera/docs#885](/tigera/docs/pull/885)
 Merged

5 tasks

[![@mazdakn](https://avatars.githubusercontent.com/u/4939502?s=40&u=9815131db867d25c1e7f645dc679c00d1bae0476&v=4)](/mazdakn)
[mazdakn](/mazdakn)
added
[kind/bug](/projectcalico/calico/labels/kind/bug)
[likelihood/low](/projectcalico/calico/labels/likelihood/low)
[impact/high](/projectcalico/calico/labels/impact/high)
labels
[Aug 22, 2023](#event-10160818155)

[![@mazdakn](https://avatars.githubusercontent.com/u/4939502?s=80&u=9815131db867d25c1e7f645dc679c00d1bae0476&v=4)](/mazdakn)

Copy link

Member

### **[mazdakn](/mazdakn)** commented [Aug 22, 2023](#issuecomment-1688559722)

| [@rodrigorfk](https://github.com/rodrigorfk) Thanks for reporting and also providing the fix. |
| --- |

All reactions

Sorry, something went wrong.

[![@fasaxc](https://avatars.githubusercontent.com/u/469264?s=40&u=f2793813b61981bc9e790556a835c05c7ef315d4&v=4)](/fasaxc)
[fasaxc](/fasaxc)
closed this as [completed](/projectcalico/calico/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#7909](/projectcalico/calico/pull/7909)
[Aug 23, 2023](#event-10167952689)

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this issue
[Oct 31, 2023](#ref-issue-1971297434)

[x/vulndb: potential Go vuln in github.com/projectcalico/calico: CVE-2023-41377
golang/vulndb#2167](/golang/vulndb/issues/2167)

Closed

[![@anthonytwh](https://avatars.githubusercontent.com/u/25327116?s=80&u=cafb5665a6546a5037d10f7296360467c1dc8e22&v=4)](/anthonytwh)

Copy link

Contributor

### **[anthonytwh](/anthonytwh)** commented [Nov 6, 2023](#issuecomment-1795073499)

| This issue as been assigned [CVE-2023-41378](https://www.cve.org/cverecord?id=CVE-2023-41378) |
| --- |

All reactions

Sorry, something went wrong.

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this issue
[Nov 6, 2023](#ref-issue-1979621889)

[x/vulndb: potential Go vuln in github.com/projectcalico/calico: CVE-2023-41378
golang/vulndb#2178](/golang/vulndb/issues/2178)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcalico%2Fcalico%2Fissues%2F7908)

Assignees

No one assigned

Labels

[impact/high](/projectcalico/calico/labels/impact/high)
[kind/bug](/projectcalico/calico/labels/kind/bug)
[likelihood/low](/projectcalico/calico/labels/likelihood/low)

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [fix: adding timeout to the typha server TLS handshake](/projectcalico/calico/pull/7909)
 [rodrigorfk/calico](/rodrigorfk/calico)

3 participants

[![@rodrigorfk](https://avatars.githubusercontent.com/u/1995033?s=52&v=4)](/rodrigorfk) [![@mazdakn](https://avatars.githubusercontent.com/u/4939502?s=52&v=4)](/mazdakn) [![@anthonytwh](https://avatars.githubusercontent.com/u/25327116?s=52&v=4)](/anthonytwh)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8ec97ce8_20250110_224158.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcalico%2Fcalico%2Fpull%2F7993)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcalico%2Fcalico%2Fpull%2F7993)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=projectcalico%2Fcalico)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcalico](/projectcalico)
/
**[calico](/projectcalico/calico)**
Public

* [Notifications](/login?return_to=%2Fprojectcalico%2Fcalico) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fprojectcalico%2Fcalico)
* [Star
   6.1k](/login?return_to=%2Fprojectcalico%2Fcalico)

* [Code](/projectcalico/calico)
* [Issues
  364](/projectcalico/calico/issues)
* [Pull requests
  56](/projectcalico/calico/pulls)
* [Discussions](/projectcalico/calico/discussions)
* [Actions](/projectcalico/calico/actions)
* [Projects
  0](/projectcalico/calico/projects)
* [Security](/projectcalico/calico/security)
* [Insights](/projectcalico/calico/pulse)

Additional navigation options

* [Code](/projectcalico/calico)
* [Issues](/projectcalico/calico/issues)
* [Pull requests](/projectcalico/calico/pulls)
* [Discussions](/projectcalico/calico/discussions)
* [Actions](/projectcalico/calico/actions)
* [Projects](/projectcalico/calico/projects)
* [Security](/projectcalico/calico/security)
* [Insights](/projectcalico/calico/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fprojectcalico%2Fcalico%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fprojectcalico%2Fcalico%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Move TLS handshake to per-connection goroutine #7993

 Merged

[fasaxc](/fasaxc)
merged 2 commits into
[projectcalico:master](/projectcalico/calico/tree/master "projectcalico/calico:master")
from
[fasaxc:ms-typha-fix](/fasaxc/calico/tree/ms-typha-fix "fasaxc/calico:ms-typha-fix")

Sep 6, 2023

 Merged

# [Move TLS handshake to per-connection goroutine](#top) #7993

[fasaxc](/fasaxc)
merged 2 commits into
[projectcalico:master](/projectcalico/calico/tree/master "projectcalico/calico:master")
from
[fasaxc:ms-typha-fix](/fasaxc/calico/tree/ms-typha-fix "fasaxc/calico:ms-typha-fix")

Sep 6, 2023

[Conversation
0](/projectcalico/calico/pull/7993)
[Commits
2](/projectcalico/calico/pull/7993/commits)
[Checks
0](/projectcalico/calico/pull/7993/checks)
[Files changed](/projectcalico/calico/pull/7993/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![fasaxc](https://avatars.githubusercontent.com/u/469264?s=60&v=4)](/fasaxc)

Copy link

Member

### @fasaxc **[fasaxc](/fasaxc)** commented [Sep 6, 2023](#issue-1883630692)

## Description

## Related issues/PRs

## Todos

* Tests
* Documentation
* Release note

## Release Note

```
TBD

```
## Reminder for the reviewer

Make sure that this PR has the correct labels and milestone set.

Every PR needs one `docs-*` label.

* `docs-pr-required`: This change requires a change to the documentation that has not been completed yet.
* `docs-completed`: This change has all necessary documentation completed.
* `docs-not-required`: This change has no user-facing impact and requires no docs.

Every PR needs one `release-note-*` label.

* `release-note-required`: This PR has user-facing changes. Most PRs should have this label.
* `release-note-not-required`: This PR has no user-facing changes.

Other optional labels:

* `cherry-pick-candidate`: This PR should be cherry-picked to an earlier release. For bug fixes only.
* `needs-operator-pr`: This PR is related to install and requires a corresponding change to the operator.

Sorry, something went wrong.

All reactions

 [![@fasaxc](https://avatars.githubusercontent.com/u/469264?s=40&u=f2793813b61981bc9e790556a835c05c7ef315d4&v=4)](/fasaxc)
[fasaxc](/fasaxc)
requested a review
from a team
as a [code owner](/projectcalico/calico/blob/cf7fa35475eba84f5afcd7f53ac7d07dcb403202/.github/CODEOWNERS#L5)
[September 6, 2023 09:35](#event-10293570877)

[![@marvin-tigera](https://avatars.githubusercontent.com/u/19392133?s=40&u=71f2496a8743f894eef95b29a25fe815f2cefd15&v=4)](/marvin-tigera)
[marvin-tigera](/marvin-tigera)
added this to the [Calico v3.27.0](/projectcalico/calico/milestone/228) milestone
[Sep 6, 2023](#event-10293571472)

[![@marvin-tigera](https://avatars.githubusercontent.com/u/19392133?s=40&u=71f2496a8743f894eef95b29a25fe815f2cefd15&v=4)](/marvin-tigera)
[marvin-tigera](/marvin-tigera)
added
[release-note-required](/projectcalico/calico/labels/release-note-required)
Change has user-facing impact (no matter how small)
[docs-pr-required](/projectcalico/calico/labels/docs-pr-required)
Change is not yet documented
labels
[Sep 6, 2023](#event-10293571558)

[![@mgleung](https://avatars.githubusercontent.com/u/1366219?s=40&v=4)](/mgleung) [![@fasaxc](https://avatars.githubusercontent.com/u/469264?s=40&v=4)](/fasaxc)

`[Move TLS handshake to per-connection goroutine](/projectcalico/calico/pull/7993/commits/068af33b08e4d8e8488c6dd12f910f632c49dd9f "Move TLS handshake to per-connection goroutine")`

`[068af33](/projectcalico/calico/pull/7993/commits/068af33b08e4d8e8488c6dd12f910f632c49dd9f)`

 [![@fasaxc](https://avatars.githubusercontent.com/u/469264?s=40&u=f2793813b61981bc9e790556a835c05c7ef315d4&v=4)](/fasaxc)
[fasaxc](/fasaxc)
[force-pushed](/projectcalico/calico/compare/7ff316fce74a5379d740a0104df1af5ffef447c0..068af33b08e4d8e8488c6dd12f910f632c49dd9f)
the
ms-typha-fix

branch
from
[`7ff316f`](/projectcalico/calico/commit/7ff316fce74a5379d740a0104df1af5ffef447c0) to
[`068af33`](/projectcalico/calico/commit/068af33b08e4d8e8488c6dd12f910f632c49dd9f)  [Compare](/projectcalico/calico/compare/7ff316fce74a5379d740a0104df1af5ffef447c0..068af33b08e4d8e8488c6dd12f910f632c49dd9f)
[September 6, 2023 12:17](#event-10295186236)

[![@fasaxc](https://avatars.githubusercontent.com/u/469264?s=40&v=4)](/fasaxc)

`[Deflake typha grace period tests.](/projectcalico/calico/pull/7993/commits/64d865f94f040940c2eb1c694fb9d6acece6e267 "Deflake typha grace period tests.

Debug logging was causing slow updates, which
in turn meant that we were unable to cause enough
back pressure to trigger the feature.")`
 …

`[64d865f](/projectcalico/calico/pull/7993/commits/64d865f94f040940c2eb1c694fb9d6acece6e267)`

```
Debug logging was causing slow updates, which
in turn meant that we were unable to cause enough
back pressure to trigger the feature.
```

[![@fasaxc](https://avatars.githubusercontent.com/u/469264?s=40&u=f2793813b61981bc9e790556a835c05c7ef315d4&v=4)](/fasaxc)
[fasaxc](/fasaxc)
merged commit [`2ebc1f9`](/projectcalico/calico/commit/2ebc1f92ecc39332cf1d55ba676d9101af24982f)
into
projectcalico:master

[Sep 6, 2023](https://github.com/projectcalico/calico/pull/7993#event-10297581283)

This was referenced Oct 31, 2023

[x/vulndb: potential Go vuln in github.com/projectcalico/calico: CVE-2023-41377
golang/vulndb#2167](/golang/vulndb/issues/2167)

Closed

[x/vulndb: potential Go vuln in github.com/projectcalico/calico: CVE-2023-41378
golang/vulndb#2178](/golang/vulndb/issues/2178)

Closed

[![@mgleung](https://avatars.githubusercontent.com/u/1366219?s=40&u=5c9a5ca5882b869382f97472db403447d254d47d&v=4)](/mgleung)
[mgleung](/mgleung)
added
[docs-not-required](/projectcalico/calico/labels/docs-not-required)
Docs not required for this change
[release-note-not-required](/projectcalico/calico/labels/release-note-not-required)
Change has no user-facing impact
labels
[Nov 16, 2023](#event-10986241986)

[![@marvin-tigera](https://avatars.githubusercontent.com/u/19392133?s=40&u=71f2496a8743f894eef95b29a25fe815f2cefd15&v=4)](/marvin-tigera)
[marvin-tigera](/marvin-tigera)
removed
[release-note-required](/projectcalico/calico/labels/release-note-required)
Change has user-facing impact (no matter how small)
[docs-pr-required](/projectcalico/calico/labels/docs-pr-required)
Change is not yet documented
labels
[Nov 16, 2023](#event-10986242428)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcalico%2Fcalico%2Fpull%2F7993)

Reviewers

No reviews

Assignees

No one assigned

Labels

[docs-not-required](/projectcalico/calico/labels/docs-not-required)
Docs not required for this change
[release-note-not-required](/projectcalico/calico/labels/release-note-not-required)
Change has no user-facing impact

Projects

None yet

Milestone

 [**Calico v3.27.0**](/projectcalico/calico/milestone/228 "Calico v3.27.0")

Development

Successfully merging this pull request may close these issues.

3 participants

[![@fasaxc](https://avatars.githubusercontent.com/u/469264?s=52&v=4)](/fasaxc) [![@mgleung](https://avatars.githubusercontent.com/u/1366219?s=52&v=4)](/mgleung) [![@marvin-tigera](https://avatars.githubusercontent.com/u/19392133?s=52&v=4)](/marvin-tigera)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.tigera.io_12e1cbed_20250110_224158.html ===

[![tigera-logoWhite](/app/uploads/elementor/thumbs/tigera-logoWhite-pgs10u1azwwqta709onlhpgchcu467kpsetcdizd0s.png "tigera-logoWhite")](/)

* [Project Calico](/project-calico/)
* Products
  + [![](https://www.tigera.io/app/uploads/2021/06/icon-calico-os.svg)](https://www.tigera.io/tigera-products/calico/)
  + [![](https://www.tigera.io/app/uploads/2021/06/icon-calico-cloud.svg)Calico Cloud Security for containers and Kubernetes](https://www.tigera.io/tigera-products/calico-cloud/)
  + [![](https://www.tigera.io/app/uploads/2021/06/icon-calico-enterprise.svg)Calico Enterprise Zero trust security for Kubernetes](https://www.tigera.io/tigera-products/calico-enterprise/)
  + [![](https://www.tigera.io/app/uploads/2021/06/icon-compare.svg)Compare Products](https://www.tigera.io/tigera-products/compare-products/)
  + [![](https://www.tigera.io/app/uploads/2021/06/icon-pricing.svg)Pricing](https://www.tigera.io/tigera-products/calico-cloud-pricing/)
  + [![](https://www.tigera.io/app/uploads/2021/06/icon-why.svg)Why Calico](https://www.tigera.io/tigera-products/why-calico/)
* Solutions
  + Use Cases
    - [![](https://www.tigera.io/app/uploads/2023/04/icon-kubernetes-security.svg)Kubernetes Security](/tigera-products/kubernetes-security/)
      * [Egress Gateway](/tigera-products/egress-gateway/)
      * [Universal Firewall Integration](/features/firewall-integration/)
      * [Cluster Mesh](https://www.tigera.io/tigera-products/cluster-mesh/)
      * [Workload Access Controls](/tigera-products/zero-trust-workload-security/)
      * [Microsegmentation](/features/microsegmentation/)
      * [Security Policy Management](/features/policy-lifecycle-management/)
      * [Observability & Troubleshooting](/tigera-products/observability-and-troubleshooting/)
      * [Multi-Cloud Security](/tigera-products/multi-cloud-security/)
      * [High-Availability Kubernetes](/tigera-products/kubernetes-high-availability/)
    - [![](https://www.tigera.io/app/uploads/2022/02/0Aicon-container-security.svg)Container Security](/tigera-products/container-security/)
      * [Vulnerability Management](/tigera-products/vulnerability-management/)
      * [Configuration Security](/features/configuration-security/)
      * [Runtime Threat Defense](/features/runtime-threat-defense/)
      * [Workload Access Controls](/tigera-products/zero-trust-workload-security/)
      * [Security Policy Management](/features/policy-lifecycle-management/)
      * [Observability & Troubleshooting](/tigera-products/observability-and-troubleshooting/)
      * [Compliance](/features/compliance-and-audit/)
  + Environments
    - [![](https://www.tigera.io/app/uploads/2021/06/icon-aws.svg)AWS EKS](/partners/aws/)
    - [![](https://www.tigera.io/app/uploads/2021/06/icon-azure.svg)Azure AKS](/partners/microsoft/)
    - [![](https://www.tigera.io/app/uploads/2021/06/icon-google.svg)Google GKE](/partners/google/)
    - [![](https://www.tigera.io/app/uploads/2021/06/icon-redhat.svg)Red Hat OpenShift](/partners/redhat/)
    - [![](https://www.tigera.io/app/uploads/2022/05/icon-SUSE-rancher.svg)SUSE Rancher](/partners/rancher/)
    - [![](https://www.tigera.io/app/uploads/2021/06/icon-fortinet.svg)Fortinet](/partners/fortinet/)
    - [![](https://www.tigera.io/app/uploads/2021/06/icon-mirantis.svg)Mirantis](/partners/mirantis/)
* Learn
  + Developer Center
    - [Documentation](https://docs.tigera.io/)
    - [Interactive Training](https://www.tigera.io/interactive-training/)
    - [Product Tutorials](https://www.tigera.io/tutorials/)
    - [Certification](https://www.tigera.io/lp/calico-certification/)
    - [Resources](https://www.tigera.io/resources/)
    - [Blog](https://www.tigera.io/blog/)
  + [![Interactive Training](data:image/svg+xml...)![Interactive Training](https://www.tigera.io/app/uploads/2024/09/learn-menu-banner-img.png)Interactive TrainingNEWUse case-driven video lessons, accompanied by a staged demo environment, to help you leverage Calico for container security and networking.Learn More >](https://www.tigera.io/interactive-training/)
  + Guides
    - [Security](https://www.tigera.io/learn/guides/kubernetes-security/)
      * [Container Security](https://www.tigera.io/learn/guides/container-security-best-practices/)
      * [Kubernetes Security](https://www.tigera.io/learn/guides/kubernetes-security/)
      * [LLM Security](https://www.tigera.io/learn/guides/llm-security/)
      * [CNAPP](https://www.tigera.io/learn/guides/cnapp/)
      * [Service Mesh](https://www.tigera.io/learn/guides/devsecops/service-mesh/)
      * [Microservices Security](https://www.tigera.io/learn/guides/microservices-security/)
      * [Zero Trust](https://www.tigera.io/learn/guides/zero-trust/)
      * [Cloud-Native Security](https://www.tigera.io/learn/guides/cloud-native-security/)
  + Guides
    - [Observability](https://www.tigera.io/learn/guides/kubernetes-monitoring/)
      * [Kubernetes Monitoring](https://www.tigera.io/learn/guides/kubernetes-monitoring/)
      * [Prometheus Monitoring](https://www.tigera.io/learn/guides/prometheus-monitoring/)
    - [Networking](https://www.tigera.io/learn/guides/kubernetes-networking/)
      * [Kubernetes Networking](https://www.tigera.io/learn/guides/kubernetes-networking/)
      * [Cillium vs Calico](https://www.tigera.io/learn/guides/cilium-vs-calico/)
      * [eBPF](https://www.tigera.io/learn/guides/ebpf/)
* Support
  + [Customer Success](https://www.tigera.io/customer-success/)
  + [Support Portal](http://tigera.force.com/community/s/login/)
  + [Tigera Help Center](https://www.tigera.io/calico-support/)
  + [Security Bulletins](https://www.tigera.io/security-bulletins/)
  + [Report Security Issue](/vulnerability-disclosure/)
* Company
  + [About](https://www.tigera.io/about/)
  + [Customers](https://www.tigera.io/customer-stories/)
  + [Partners](https://www.tigera.io/partners/)
  + [Events](https://www.tigera.io/events/)
  + [Newsroom](https://www.tigera.io/media/)
  + [Careers](https://www.tigera.io/careers/)
  + [Contact](https://www.tigera.io/contact/)

* + [Contact](https://www.tigera.io/contact/)
  + [Login](http://www.calicocloud.io/)
  + [Try Now](https://www.calicocloud.io/login)

# Security Bulletins

Calico Typha hangs during unclean TLS handshake

| Description | Severity | Notes |
| --- | --- | --- |
| Calico Typha hangs during unclean TLS handshake Reference: TTA-2023-001, CVE-2023-41378  Date published: Novemeber 06, 2023 (Updated) | High | N/A |

### Summary

In certain conditions for Calico Typha (v3.26.2, v3.25.1 and below), and Calico Enterprise Typha (v3.17.1, v3.16.3, v3.15.3 and below), a client TLS handshake can block the Calico Typha server indefinitely, resulting in denial of service. The TLS Handshake() call is performed inside the main server handle for loop without any timeout allowing an unclean TLS handshake to block the main loop indefinitely while other connections will be idle waiting for that handshake to finish.

### Severity

CVSSv3.1: High (7.5)

Vector: AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H

The Calico Typha service port by default is only accessible within the cluster or via the node IP when operating in the host network. Denial of service of a single Calico Typha instance will not disrupt the operations of the cluster. Only in certain conditions where abrupt terminations of the TLS handshake with Typha and all replicas will disrupt the operation of the cluster.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2023-41378>
* <https://github.com/projectcalico/calico/issues/7908>
* <https://github.com/projectcalico/calico/pull/7993>
### Weakness Enumeration

[CWE-400](https://cwe.mitre.org/data/definitions/400.html): Uncontrolled Resource Consumption

[CWE-703](https://cwe.mitre.org/data/definitions/703.html): Improper Check or Handling of Exceptional Conditions

### Indicators of Impact/Compromise

Review flow logs for unexpected connections to calico-typha or private IP addresses on TCP port 5473. Indicators of impact include the Calico Felix pod crash looping or not reaching readiness state.

### Workaround/Mitigation

Review host and cluster network policies and secure Typha port 5473 from external access to the cluster using host-endpoint policies, external security groups, access control lists, or firewalls.

### Affected Releases

* Calico OSS
  + v3.26.2 and below
  + v3.25.1 and below
* Calico Enterprise
  + v3.17.1 and below
  + v3.16.3 and below
  + v3.15.3 and below
* Calico Cloud
  + v17.1.1 and below

### Fixed Versions

* Calico OSS
  + v3.26.3 – released Oct 6, 2023
  + v3.25.2 – released Sept 5, 2023
* Calico Enterprise
  + v3.18.0 – released Sept 1, 2023
  + v3.17.2 – released Oct 3, 2023
  + v3.16.4 – released Sept 23, 2023
  + v3.15.4 – released Sept 12, 2023
* Calico Cloud
  + v18.0.0

### Acknowledgments

Rodrigo Fior Kuntzer of Miroapp (Github: @rodrigorfk) for discovery and partial fix.

[Return to List](https://www.tigera.io/security-bulletins/)

* PROJECT CALICO
  + [What is Project Calico?](https://www.tigera.io/project-calico/)
  + [Docs](https://docs.tigera.io/calico/)
  + [Community](https://www.tigera.io/project-calico/community/)
  + [GitHub](https://github.com/projectcalico/calico)
* PRODUCTS
  + [Calico Open Source](https://www.tigera.io/tigera-products/calico/)
  + [Calico Cloud](https://www.tigera.io/tigera-products/calico-cloud/)
  + [Calico Enterprise](https://www.tigera.io/tigera-products/calico-enterprise/)
  + [Compare Products](https://www.tigera.io/tigera-products/compare-products/)
  + [Pricing](https://www.tigera.io/tigera-products/calico-cloud-pricing/)
  + [Why Calico?](https://www.tigera.io/tigera-products/why-calico/)
* SOLUTIONS
  + [Kubernetes Security](/tigera-products/kubernetes-security/)
  + [Container Security](/tigera-products/container-security/)
  + [Cluster Mesh](https://www.tigera.io/tigera-products/cluster-mesh/)
  + [Multi-Cloud Security](/tigera-products/multi-cloud-security/)
  + [High-Availability for Kubernetes](/tigera-products/kubernetes-high-availability/)
  + [Egress Gateway](/tigera-products/egress-gateway/)
  + [Environments](https://www.tigera.io/partners/)
* LEARN
  + [Documentation](https://docs.tigera.io/)
  + [Interactive Training](https://www.tigera.io/interactive-training/)
  + [Product Tutorials](https://www.tigera.io/tutorials/)
  + [Resources](https://www.tigera.io/resources/)
  + [Certification](https://www.tigera.io/lp/calico-certification/)
  + [Blog](https://www.tigera.io/blog/)
  + [Guides](https://www.tigera.io/learn/guides/kubernetes-security/)
* SUPPORT
  + [Customer Success](https://www.tigera.io/customer-success/)
  + [Support Portal](http://tigera.force.com/community/s/login/)
  + [Tigera Help Center](https://www.tigera.io/calico-support/)
  + [Security Bulletins](https://www.tigera.io/security-bulletins/)
  + [Report Security Issue](https://www.tigera.io/vulnerability-disclosure/)
* COMPANY
  + [About](https://www.tigera.io/about/)
  + [Customers](https://www.tigera.io/customer-stories/)
  + [Partners](https://www.tigera.io/partners/)
  + [Events](https://www.tigera.io/events/)
  + [Newsroom](https://www.tigera.io/media/)
  + [Careers](https://www.tigera.io/careers/)
  + [Contact](https://www.tigera.io/contact/)

[![tigera-logoWhite](data:image/svg+xml... " tigera-logoWhite")![tigera-logoWhite](/app/uploads/elementor/thumbs/tigera-logoWhite-pex43dmbi9rv5py4nuwhpkbh5bury9emp21calqze4.png " tigera-logoWhite")](/)

Copyright ©

 Tigera, Inc. All rights reserved.

* Privacy Center
* Do Not Sell Or Share My Personal Information
* [Legal](/legal/)

[Linkedin](https://www.linkedin.com/company/tigera/)
[Twitter](https://twitter.com/tigeraio)
[Youtube](https://www.youtube.com/channel/UC8uN3yhpeBeerGNwDiQbcgw/)
[Slack](https://calicousers.slack.com/)
[Github](https://github.com/tigera)
[Discourse](https://discuss.projectcalico.tigera.io/)

global-styles ->
eae-peel-css -> https://www.tigera.io/app/plugins/addon-elements-for-elementor-page-builder/assets/lib/peel/peel.css
search-filter-plugin-styles -> https://www.tigera.io/app/plugins/search-filter-pro/public/assets/css/search-filter.min.css
hello-elementor-header-footer -> https://www.tigera.io/app/themes/hello-elementor/header-footer.min.css
fancybox-css -> https://cdn.jsdelivr.net/npm/@fancyapps/[[email protected]](/cdn-cgi/l/email-protection)/dist/fancybox.css
elementor-icons -> https://www.tigera.io/app/plugins/elementor/assets/lib/eicons/css/elementor-icons.min.css
elementor-frontend -> https://www.tigera.io/app/plugins/elementor/assets/css/frontend.min.css
font-awesome-5-all -> https://www.tigera.io/app/plugins/elementor/assets/lib/font-awesome/css/all.min.css
font-awesome-4-shim -> https://www.tigera.io/app/plugins/elementor/assets/lib/font-awesome/css/v4-shims.min.css
widget-text-editor -> https://www.tigera.io/app/plugins/elementor/assets/css/widget-text-editor.min.css
hello-elementor-child-style -> https://www.tigera.io/app/themes/tigera2021/style.css
tigera-2021-theme -> https://www.tigera.io/app/themes/tigera2021/dist/css/tigera.css
webstick-css -> https://www.tigera.io/app/themes/tigera2021/dist/css/webstick.css
default-css -> https://www.tigera.io/app/themes/tigera2021/dist/css/default.css
ecs-styles -> https://www.tigera.io/app/plugins/ele-custom-skin/assets/css/ecs-style.css
core-block-supports-duotone ->


