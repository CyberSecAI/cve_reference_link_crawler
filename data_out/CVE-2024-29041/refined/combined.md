=== Content from github.com_bee15641_20250111_204915.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpressjs%2Fexpress%2Fcommit%2F0867302ddbde0e9463d0564fea5861feb708c2dd)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpressjs%2Fexpress%2Fcommit%2F0867302ddbde0e9463d0564fea5861feb708c2dd)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=expressjs%2Fexpress)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[expressjs](/expressjs)
/
**[express](/expressjs/express)**
Public

* [Notifications](/login?return_to=%2Fexpressjs%2Fexpress) You must be signed in to change notification settings
* [Fork
  17k](/login?return_to=%2Fexpressjs%2Fexpress)
* [Star
   66k](/login?return_to=%2Fexpressjs%2Fexpress)

* [Code](/expressjs/express)
* [Issues
  105](/expressjs/express/issues)
* [Pull requests
  101](/expressjs/express/pulls)
* [Discussions](/expressjs/express/discussions)
* [Actions](/expressjs/express/actions)
* [Wiki](/expressjs/express/wiki)
* [Security](/expressjs/express/security)
* [Insights](/expressjs/express/pulse)

Additional navigation options

* [Code](/expressjs/express)
* [Issues](/expressjs/express/issues)
* [Pull requests](/expressjs/express/pulls)
* [Discussions](/expressjs/express/discussions)
* [Actions](/expressjs/express/actions)
* [Wiki](/expressjs/express/wiki)
* [Security](/expressjs/express/security)
* [Insights](/expressjs/express/pulse)

## Commit

[Permalink](/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Prevent open redirect allow list bypass due to encodeurl

[Browse files](/expressjs/express/tree/0867302ddbde0e9463d0564fea5861feb708c2dd)
Browse the repository at this point in the history

```
Co-authored-by: Jon Church <me@jonchurch.com>
```

* Loading branch information

[![@FDrag0n](https://avatars.githubusercontent.com/u/34733637?s=40&v=4)](/FDrag0n) [![@jonchurch](https://avatars.githubusercontent.com/u/12915163?s=40&v=4)](/jonchurch) [![@wesleytodd](https://avatars.githubusercontent.com/u/1027776?s=40&v=4)](/wesleytodd)

2 people

authored and
[wesleytodd](/expressjs/express/commits?author=wesleytodd "View all commits by wesleytodd")
committed
Mar 20, 2024

1 parent
[567c9c6](/expressjs/express/commit/567c9c665d0de4c344b8e160146050770233783c)

commit 0867302

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**64 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* lib

  + lib/response.js
    [response.js](#diff-c03f99ad1a5cf68a9b32468371973a5898c4c9c9d5f097e124f1d2b7b27db11d)
* test

  + test/res.location.js
    [res.location.js](#diff-51596000622f2ed652debb5cdfb1618e708b3d8fa679cf422a7875e29ef39c6a)

## There are no files selected for viewing

20 changes: 19 additions & 1 deletion

20
[lib/response.js](#diff-c03f99ad1a5cf68a9b32468371973a5898c4c9c9d5f097e124f1d2b7b27db11d "lib/response.js")

Show comments

[View file](/expressjs/express/blob/0867302ddbde0e9463d0564fea5861feb708c2dd/lib/response.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -34,6 +34,7 @@ var extname = path.extname; |
|  |  | var mime = send.mime; |
|  |  | var resolve = path.resolve; |
|  |  | var vary = require('vary'); |
|  |  | var urlParse = require('url').parse; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Response prototype. |
| Expand Down  Expand Up | | @@ -911,8 +912,25 @@ res.location = function location(url) { |
|  |  | loc = this.req.get('Referrer') || '/'; |
|  |  | } |
|  |  |  |
|  |  | var lowerLoc = loc.toLowerCase(); |
|  |  | var encodedUrl = encodeUrl(loc); |
|  |  | if (lowerLoc.indexOf('https://') === 0 || lowerLoc.indexOf('http://') === 0) { |
|  |  | try { |
|  |  | var parsedUrl = urlParse(loc); |
|  |  | var parsedEncodedUrl = urlParse(encodedUrl); |
|  |  | // Because this can encode the host, check that we did not change the host |
|  |  | if (parsedUrl.host !== parsedEncodedUrl.host) { |
|  |  | // If the host changes after encodeUrl, return the original url |
|  |  | return this.set('Location', loc); |
|  |  | } |
|  |  | } catch (e) { |
|  |  | // If parse fails, return the original url |
|  |  | return this.set('Location', loc); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // set location |
|  |  | return this.set('Location', encodeUrl(loc)); |
|  |  | return this.set('Location', encodedUrl); |
|  |  | }; |
|  |  |  |
|  |  | /\*\* |
| Expand Down | |  |

46 changes: 45 additions & 1 deletion

46
[test/res.location.js](#diff-51596000622f2ed652debb5cdfb1618e708b3d8fa679cf422a7875e29ef39c6a "test/res.location.js")

Show comments

[View file](/expressjs/express/blob/0867302ddbde0e9463d0564fea5861feb708c2dd/test/res.location.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,13 +1,27 @@ |
|  |  | 'use strict' |
|  |  |  |
|  |  | var express = require('../') |
|  |  | , request = require('supertest'); |
|  |  | , request = require('supertest') |
|  |  | , url = require('url'); |
|  |  |  |
|  |  | describe('res', function(){ |
|  |  | describe('.location(url)', function(){ |
|  |  | it('should set the header', function(done){ |
|  |  | var app = express(); |
|  |  |  |
|  |  | app.use(function(req, res){ |
|  |  | res.location('http://google.com/').end(); |
|  |  | }); |
|  |  |  |
|  |  | request(app) |
|  |  | .get('/') |
|  |  | .expect('Location', 'http://google.com/') |
|  |  | .expect(200, done) |
|  |  | }) |
|  |  |  |
|  |  | it('should preserve trailing slashes when not present', function(done){ |
|  |  | var app = express(); |
|  |  |  |
|  |  | app.use(function(req, res){ |
|  |  | res.location('http://google.com').end(); |
|  |  | }); |
| Expand All | | @@ -31,6 +45,36 @@ describe('res', function(){ |
|  |  | .expect(200, done) |
|  |  | }) |
|  |  |  |
|  |  | it('should not encode bad "url"', function (done) { |
|  |  | var app = express() |
|  |  |  |
|  |  | app.use(function (req, res) { |
|  |  | // This is here to show a basic check one might do which |
|  |  | // would pass but then the location header would still be bad |
|  |  | if (url.parse(req.query.q).host !== 'google.com') { |
|  |  | res.status(400).end('Bad url'); |
|  |  | } |
|  |  | res.location(req.query.q).end(); |
|  |  | }); |
|  |  |  |
|  |  | request(app) |
|  |  | .get('/?q=http://google.com\\@apple.com') |
|  |  | .expect(200) |
|  |  | .expect('Location', 'http://google.com\\@apple.com') |
|  |  | .end(function (err) { |
|  |  | if (err) { |
|  |  | throw err; |
|  |  | } |
|  |  |  |
|  |  | // This ensures that our protocol check is case insensitive |
|  |  | request(app) |
|  |  | .get('/?q=HTTP://google.com\\@apple.com') |
|  |  | .expect(200) |
|  |  | .expect('Location', 'HTTP://google.com\\@apple.com') |
|  |  | .end(done) |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | it('should not touch already-encoded sequences in "url"', function (done) { |
|  |  | var app = express() |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0867302`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpressjs%2Fexpress%2Fcommit%2F0867302ddbde0e9463d0564fea5861feb708c2dd) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1d428c14_20250111_204919.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpressjs%2Fexpress%2Fpull%2F5539)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpressjs%2Fexpress%2Fpull%2F5539)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=expressjs%2Fexpress)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[expressjs](/expressjs)
/
**[express](/expressjs/express)**
Public

* [Notifications](/login?return_to=%2Fexpressjs%2Fexpress) You must be signed in to change notification settings
* [Fork
  17k](/login?return_to=%2Fexpressjs%2Fexpress)
* [Star
   66k](/login?return_to=%2Fexpressjs%2Fexpress)

* [Code](/expressjs/express)
* [Issues
  105](/expressjs/express/issues)
* [Pull requests
  101](/expressjs/express/pulls)
* [Discussions](/expressjs/express/discussions)
* [Actions](/expressjs/express/actions)
* [Wiki](/expressjs/express/wiki)
* [Security](/expressjs/express/security)
* [Insights](/expressjs/express/pulse)

Additional navigation options

* [Code](/expressjs/express)
* [Issues](/expressjs/express/issues)
* [Pull requests](/expressjs/express/pulls)
* [Discussions](/expressjs/express/discussions)
* [Actions](/expressjs/express/actions)
* [Wiki](/expressjs/express/wiki)
* [Security](/expressjs/express/security)
* [Insights](/expressjs/express/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fexpressjs%2Fexpress%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fexpressjs%2Fexpress%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [deleted] #5539

 Closed

[FDrag0n](/FDrag0n)
wants to merge
2
commits into
[expressjs:master](/expressjs/express/tree/master "expressjs/express:master")
from
FDrag0n:master

 Closed

# [[deleted]](#top) #5539

[FDrag0n](/FDrag0n)
wants to merge
2
commits into
[expressjs:master](/expressjs/express/tree/master "expressjs/express:master")
from
FDrag0n:master

+17

−0

[Conversation
0](/expressjs/express/pull/5539)
[Commits
2](/expressjs/express/pull/5539/commits)
[Checks
0](/expressjs/express/pull/5539/checks)
[Files changed
2](/expressjs/express/pull/5539/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![FDrag0n](https://avatars.githubusercontent.com/u/34733637?s=60&v=4)](/FDrag0n)

Copy link

Contributor

### @FDrag0n **[FDrag0n](/FDrag0n)** commented [Mar 15, 2024](#issue-2187930803) • edited by wesleytodd Loading

 *No description provided.*

Sorry, something went wrong.

All reactions

 [FDrag0n](/FDrag0n)
added 2 commits
[March 15, 2024 15:49](#commits-pushed-154921f)

[![@FDrag0n](https://avatars.githubusercontent.com/u/34733637?s=40&v=4)](/FDrag0n)

`[Update response.js fix-redirect-security](/expressjs/express/pull/5539/commits/154921f83614ef81d7e1606106df6354616cbc82 "Update response.js fix-redirect-security

fix-redirect-security")`
 …

`[154921f](/expressjs/express/pull/5539/commits/154921f83614ef81d7e1606106df6354616cbc82)`

```
fix-redirect-security
```

[![@FDrag0n](https://avatars.githubusercontent.com/u/34733637?s=40&v=4)](/FDrag0n)

`[Update res.location.js fix-redirect-security](/expressjs/express/pull/5539/commits/1f3832b32aa338a623f5c9cdb3a4efe8e53f9bcf "Update res.location.js fix-redirect-security

fix-redirect-security")`
 …

`[1f3832b](/expressjs/express/pull/5539/commits/1f3832b32aa338a623f5c9cdb3a4efe8e53f9bcf)`

```
fix-redirect-security
```

[![@wesleytodd](https://avatars.githubusercontent.com/u/1027776?s=40&v=4)](/wesleytodd)
[wesleytodd](/wesleytodd)
changed the title
~~fix-redirect-security in issue 5538~~
[deleted]
[Mar 15, 2024](#event-12133437242)

[![@wesleytodd](https://avatars.githubusercontent.com/u/1027776?s=40&v=4)](/wesleytodd)
[wesleytodd](/wesleytodd)
closed this
[Mar 15, 2024](#event-12133438216)

[kodiakhq](/apps/kodiakhq) bot
referenced
this pull request
in X-oss-byte/Nextjs
[Mar 26, 2024](#ref-commit-348d420)
[![@renovate](https://avatars.githubusercontent.com/in/2740?s=40&v=4)](/marketplace/renovate)

`[Update dependency express to v4.19.2 [SECURITY] (](/X-oss-byte/Nextjs/commit/348d42052d59894729130fa0bc9500c7298fb01f "Update dependency express to v4.19.2 [SECURITY] (#1614)

[![Mend Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/) ([source](https://togithub.com/expressjs/express)) | [`4.18.3` -> `4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.3/4.19.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |

### GitHub Vulnerability Alerts

#### [CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd
https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)
[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](https://www.mend.io/free-developer-tools/renovate/). View repository job log [here](https://developer.mend.io/github/X-oss-byte/Nextjs).")[#1614](https://github.com/X-oss-byte/Nextjs/pull/1614)[)](/X-oss-byte/Nextjs/commit/348d42052d59894729130fa0bc9500c7298fb01f "Update dependency express to v4.19.2 [SECURITY] (#1614)

[![Mend Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/) ([source](https://togithub.com/expressjs/express)) | [`4.18.3` -> `4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.3/4.19.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |

### GitHub Vulnerability Alerts

#### [CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd
https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)
[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](https://www.mend.io/free-developer-tools/renovate/). View repository job log [here](https://developer.mend.io/github/X-oss-byte/Nextjs).")`
…

`[348d420](/X-oss-byte/Nextjs/commit/348d42052d59894729130fa0bc9500c7298fb01f)`

```
[![Mend Renovate]([https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com](https://app.renovatebot.com/images/banner.svg%29%5D%28https%3A//renovatebot.com))

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](<http://expressjs.com/>) ([source](<https://togithub.com/expressjs/express>)) | [`4.18.3` -> `4.19.2`](<https://renovatebot.com/diffs/npm/express/4.18.3/4.19.2>) | [![age](<https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![adoption](<https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![passing](<https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![confidence](<https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) |

### GitHub Vulnerability Alerts

#### [[CVE-2024-29041](https://github.com/advisories/GHSA-rv95-896h-c2vc "CVE-2024-29041")](<https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc>)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](<https://togithub.com/pillarjs/encodeurl>) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

[expressjs/express@0867302](https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)
[expressjs/express@0b74695](https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)](https://github.com/expressjs/express/pull/5539%5D%28https%3A//togithub.com/expressjs/express/pull/5539%29)
[[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)](https://github.com/koajs/koa/issues/1800%5D%28https%3A//togithub.com/koajs/koa/issues/1800%29)
<https://expressjs.com/en/4x/api.html#res.location>

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.19.1...4.19.2>)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.19.0...4.19.1>)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](<https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.18.3...4.19.0>)

</details>

---

### Configuration

📅 **Schedule**: Branch creation - "" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](<https://www.mend.io/free-developer-tools/renovate/>). View repository job log [here](<https://developer.mend.io/github/X-oss-byte/Nextjs>).
```

[Brooooooklyn](/Brooooooklyn)
referenced
this pull request
in toeverything/AFFiNE
[Mar 26, 2024](#ref-commit-2662ba7)
[![@renovate](https://avatars.githubusercontent.com/in/2740?s=40&v=4)](/marketplace/renovate)

`[chore: bump up express version to v4.19.2 [SECURITY] (](/toeverything/AFFiNE/commit/2662ba763c4c33419d88946db1f9121bb56cd607 "chore: bump up express version to v4.19.2 [SECURITY] (#6308)

[![Mend Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/) ([source](https://togithub.com/expressjs/express)) | [`4.18.2` -> `4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |

### GitHub Vulnerability Alerts

#### [CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd
https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)
[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

### [`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about these updates again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](https://www.mend.io/free-developer-tools/renovate/). View repository job log [here](https://developer.mend.io/github/toeverything/AFFiNE).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoiY2FuYXJ5In0=-->")[#6308](https://github.com/toeverything/AFFiNE/pull/6308)[)](/toeverything/AFFiNE/commit/2662ba763c4c33419d88946db1f9121bb56cd607 "chore: bump up express version to v4.19.2 [SECURITY] (#6308)

[![Mend Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/) ([source](https://togithub.com/expressjs/express)) | [`4.18.2` -> `4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |

### GitHub Vulnerability Alerts

#### [CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd
https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)
[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

### [`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about these updates again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](https://www.mend.io/free-developer-tools/renovate/). View repository job log [here](https://developer.mend.io/github/toeverything/AFFiNE).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoiY2FuYXJ5In0=-->")`
…

`[2662ba7](/toeverything/AFFiNE/commit/2662ba763c4c33419d88946db1f9121bb56cd607)`

```
[![Mend Renovate]([https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com](https://app.renovatebot.com/images/banner.svg%29%5D%28https%3A//renovatebot.com))

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](<http://expressjs.com/>) ([source](<https://togithub.com/expressjs/express>)) | [`4.18.2` -> `4.19.2`](<https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2>) | [![age](<https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![adoption](<https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![passing](<https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![confidence](<https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) |

### GitHub Vulnerability Alerts

#### [[CVE-2024-29041](https://github.com/advisories/GHSA-rv95-896h-c2vc "CVE-2024-29041")](<https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc>)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](<https://togithub.com/pillarjs/encodeurl>) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

[expressjs/express@0867302](https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)
[expressjs/express@0b74695](https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)](https://github.com/expressjs/express/pull/5539%5D%28https%3A//togithub.com/expressjs/express/pull/5539%29)
[[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)](https://github.com/koajs/koa/issues/1800%5D%28https%3A//togithub.com/koajs/koa/issues/1800%29)
<https://expressjs.com/en/4x/api.html#res.location>

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.19.1...4.19.2>)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.19.0...4.19.1>)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](<https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.18.3...4.19.0>)

### [`v4.18.3`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.18.2...4.18.3>)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - "" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about these updates again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](<https://www.mend.io/free-developer-tools/renovate/>). View repository job log [here](<https://developer.mend.io/github/toeverything/AFFiNE>).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoiY2FuYXJ5In0=-->
```

[renovate](/apps/renovate) bot
referenced
this pull request
in Unleash/unleash
[Mar 26, 2024](#ref-commit-91b3336)
[![@renovate](https://avatars.githubusercontent.com/in/2740?s=40&v=4)](/marketplace/renovate)

`[fix(deps): update dependency express to v4.19.2 [security] (](/Unleash/unleash/commit/91b33362bd592fd237caf2fe0f8a28ccf242659b "fix(deps): update dependency express to v4.19.2 [security] (#6693)

[![Mend
Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/)
([source](https://togithub.com/expressjs/express)) | [`4.18.3` ->
`4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.3/4.19.2) |
[![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|

### GitHub Vulnerability Alerts

####
[CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd

https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)

[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" in timezone Europe/Madrid,
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update
again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](https://www.mend.io/free-developer-tools/renovate/). View
repository job log
[here](https://developer.mend.io/github/Unleash/unleash).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->

Co-authored-by: renovate[bot] <29139614+renovate[bot]@users.noreply.github.com>")[#6693](https://github.com/Unleash/unleash/pull/6693)[)](/Unleash/unleash/commit/91b33362bd592fd237caf2fe0f8a28ccf242659b "fix(deps): update dependency express to v4.19.2 [security] (#6693)

[![Mend
Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/)
([source](https://togithub.com/expressjs/express)) | [`4.18.3` ->
`4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.3/4.19.2) |
[![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|

### GitHub Vulnerability Alerts

####
[CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd

https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)

[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" in timezone Europe/Madrid,
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update
again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](https://www.mend.io/free-developer-tools/renovate/). View
repository job log
[here](https://developer.mend.io/github/Unleash/unleash).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->

Co-authored-by: renovate[bot] <29139614+renovate[bot]@users.noreply.github.com>")`
…

`[91b3336](/Unleash/unleash/commit/91b33362bd592fd237caf2fe0f8a28ccf242659b)`

```
[![Mend
Renovate]([https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com](https://app.renovatebot.com/images/banner.svg%29%5D%28https%3A//renovatebot.com))

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](<http://expressjs.com/>)
([source](<https://togithub.com/expressjs/express>)) | [`4.18.3` ->
`4.19.2`](<https://renovatebot.com/diffs/npm/express/4.18.3/4.19.2>) |
[![age](<https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![adoption](<https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![passing](<https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![confidence](<https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|

### GitHub Vulnerability Alerts

####
[[CVE-2024-29041](https://github.com/advisories/GHSA-rv95-896h-c2vc "CVE-2024-29041")](<https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc>)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](<https://togithub.com/pillarjs/encodeurl>) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

[expressjs/express@0867302](https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)

[expressjs/express@0b74695](https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)](https://github.com/expressjs/express/pull/5539%5D%28https%3A//togithub.com/expressjs/express/pull/5539%29)

[[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)](https://github.com/koajs/koa/issues/1800%5D%28https%3A//togithub.com/koajs/koa/issues/1800%29)
<https://expressjs.com/en/4x/api.html#res.location>

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.19.1...4.19.2>)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.19.0...4.19.1>)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](<https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.18.3...4.19.0>)

</details>

---

### Configuration

📅 **Schedule**: Branch creation - "" in timezone Europe/Madrid,
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update
again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](<https://www.mend.io/free-developer-tools/renovate/>). View
repository job log
[here](<https://developer.mend.io/github/Unleash/unleash>).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->

Co-authored-by: renovate[bot] <29139614+renovate[bot]@users.noreply.github.com>
```

[![@debricked](https://avatars.githubusercontent.com/in/24490?s=40&v=4)](/apps/debricked)
[debricked](/apps/debricked)
bot
mentioned this pull request
[Mar 27, 2024](#ref-pullrequest-2210013386)

[Fix CVE–2024–29041
cemmenn/demo-app#1](/cemmenn/demo-app/pull/1)
 Open

[renovate](/apps/renovate) bot
referenced
this pull request
in apollographql/apollo-server
[Mar 28, 2024](#ref-commit-5cf2928)
[![@renovate](https://avatars.githubusercontent.com/in/2740?s=40&v=4)](/marketplace/renovate)

`[chore(deps): update dependency express to v4.19.2 [security] (](/apollographql/apollo-server/commit/5cf29285f47a34f51d462b9653d27dd45b674f70 "chore(deps): update dependency express to v4.19.2 [security] (#7859)

[![Mend
Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/)
([source](https://togithub.com/expressjs/express)) | [`4.18.2` ->
`4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) |
[![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|

### GitHub Vulnerability Alerts

####
[CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd

https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)

[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

###
[`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" in timezone America/Los_Angeles,
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR is behind base branch, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about these
updates again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](https://www.mend.io/free-developer-tools/renovate/). View
repository job log
[here](https://developer.mend.io/github/apollographql/apollo-server).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->

Co-authored-by: renovate[bot] <29139614+renovate[bot]@users.noreply.github.com>")[#7859](https://github.com/apollographql/apollo-server/pull/7859)[)](/apollographql/apollo-server/commit/5cf29285f47a34f51d462b9653d27dd45b674f70 "chore(deps): update dependency express to v4.19.2 [security] (#7859)

[![Mend
Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/)
([source](https://togithub.com/expressjs/express)) | [`4.18.2` ->
`4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) |
[![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|

### GitHub Vulnerability Alerts

####
[CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd

https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)

[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

###
[`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" in timezone America/Los_Angeles,
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR is behind base branch, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about these
updates again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](https://www.mend.io/free-developer-tools/renovate/). View
repository job log
[here](https://developer.mend.io/github/apollographql/apollo-server).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->

Co-authored-by: renovate[bot] <29139614+renovate[bot]@users.noreply.github.com>")`
…

`[5cf2928](/apollographql/apollo-server/commit/5cf29285f47a34f51d462b9653d27dd45b674f70)`

```
[![Mend
Renovate]([https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com](https://app.renovatebot.com/images/banner.svg%29%5D%28https%3A//renovatebot.com))

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](<http://expressjs.com/>)
([source](<https://togithub.com/expressjs/express>)) | [`4.18.2` ->
`4.19.2`](<https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2>) |
[![age](<https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![adoption](<https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![passing](<https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![confidence](<https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|

### GitHub Vulnerability Alerts

####
[[CVE-2024-29041](https://github.com/advisories/GHSA-rv95-896h-c2vc "CVE-2024-29041")](<https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc>)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](<https://togithub.com/pillarjs/encodeurl>) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

[expressjs/express@0867302](https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)

[expressjs/express@0b74695](https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)](https://github.com/expressjs/express/pull/5539%5D%28https%3A//togithub.com/expressjs/express/pull/5539%29)

[[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)](https://github.com/koajs/koa/issues/1800%5D%28https%3A//togithub.com/koajs/koa/issues/1800%29)
<https://expressjs.com/en/4x/api.html#res.location>

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.19.1...4.19.2>)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.19.0...4.19.1>)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](<https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.18.3...4.19.0>)

###
[`v4.18.3`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.18.2...4.18.3>)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - "" in timezone America/Los_Angeles,
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR is behind base branch, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about these
updates again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](<https://www.mend.io/free-developer-tools/renovate/>). View
repository job log
[here](<https://developer.mend.io/github/apollographql/apollo-server>).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->

Co-authored-by: renovate[bot] <29139614+renovate[bot]@users.noreply.github.com>
```

[holtskinner](/holtskinner)
referenced
this pull request
in GoogleCloudPlatform/document-ai-samples
[Mar 28, 2024](#ref-commit-4f4de06)
[![@renovate-bot](https://avatars.githubusercontent.com/u/25180681?s=40&u=52b5860ab267400de6ab46df639ef58661455321&v=4)](/renovate-bot)

`[fix(deps): update dependency express to v4.19.2 [security] (](/GoogleCloudPlatform/document-ai-samples/commit/4f4de06c668d9bc5988f9bfc810e8ee979f39e33 "fix(deps): update dependency express to v4.19.2 [security] (#776)

[![Mend
Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/)
([source](https://togithub.com/expressjs/express)) | [`4.18.2` ->
`4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) |
[![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|

### GitHub Vulnerability Alerts

####
[CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd

https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)

[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

###
[`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - At any time (no schedule defined),
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR is behind base branch, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update
again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](https://www.mend.io/free-developer-tools/renovate/). View
repository job log
[here](https://developer.mend.io/github/GoogleCloudPlatform/document-ai-samples).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->")[#776](https://github.com/GoogleCloudPlatform/document-ai-samples/pull/776)[)](/GoogleCloudPlatform/document-ai-samples/commit/4f4de06c668d9bc5988f9bfc810e8ee979f39e33 "fix(deps): update dependency express to v4.19.2 [security] (#776)

[![Mend
Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/)
([source](https://togithub.com/expressjs/express)) | [`4.18.2` ->
`4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) |
[![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|

### GitHub Vulnerability Alerts

####
[CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd

https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)

[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

###
[`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - At any time (no schedule defined),
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR is behind base branch, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update
again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](https://www.mend.io/free-developer-tools/renovate/). View
repository job log
[here](https://developer.mend.io/github/GoogleCloudPlatform/document-ai-samples).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->")`
…

`[4f4de06](/GoogleCloudPlatform/document-ai-samples/commit/4f4de06c668d9bc5988f9bfc810e8ee979f39e33)`

```
[![Mend
Renovate]([https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com](https://app.renovatebot.com/images/banner.svg%29%5D%28https%3A//renovatebot.com))

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](<http://expressjs.com/>)
([source](<https://togithub.com/expressjs/express>)) | [`4.18.2` ->
`4.19.2`](<https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2>) |
[![age](<https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![adoption](<https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![passing](<https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![confidence](<https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|

### GitHub Vulnerability Alerts

####
[[CVE-2024-29041](https://github.com/advisories/GHSA-rv95-896h-c2vc "CVE-2024-29041")](<https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc>)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](<https://togithub.com/pillarjs/encodeurl>) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

[expressjs/express@0867302](https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)

[expressjs/express@0b74695](https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)](https://github.com/expressjs/express/pull/5539%5D%28https%3A//togithub.com/expressjs/express/pull/5539%29)

[[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)](https://github.com/koajs/koa/issues/1800%5D%28https%3A//togithub.com/koajs/koa/issues/1800%29)
<https://expressjs.com/en/4x/api.html#res.location>

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.19.1...4.19.2>)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.19.0...4.19.1>)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](<https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.18.3...4.19.0>)

###
[`v4.18.3`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.18.2...4.18.3>)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - At any time (no schedule defined),
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR is behind base branch, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update
again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](<https://www.mend.io/free-developer-tools/renovate/>). View
repository job log
[here](<https://developer.mend.io/github/GoogleCloudPlatform/document-ai-samples>).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->
```

[![@PavelMor25](https://avatars.githubusercontent.com/u/77216072?s=40&v=4)](/PavelMor25)
[PavelMor25](/PavelMor25)
mentioned this pull request
[Mar 30, 2024](#ref-issue-2216148419)

[Express.js Open Redirect in malformed URLs
PavelMor25/testcafe-private#74](/PavelMor25/testcafe-private/issues/74)

Closed

1 task

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this pull request
[Apr 2, 2024](#ref-pullrequest-2220944871)

[chore(deps): update dependency n8n to v1.34.2
uniget-org/tools#3953](/uniget-org/tools/pull/3953)
 Merged

1 task

[![@hmdevelopermind](https://avatars.githubusercontent.com/u/52859974?s=40&v=4)](/hmdevelopermind)
[hmdevelopermind](/hmdevelopermind)
mentioned this pull request
[Apr 3, 2024](#ref-issue-2222946341)

[Vulnerabilities in express
scottie1984/swagger-ui-express#369](/scottie1984/swagger-ui-express/issues/369)

Closed

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this pull request
[Apr 4, 2024](#ref-pullrequest-2206344572)

[essais de fix horizontal pod scaller
Khagou/khagu-devops#23](/Khagou/khagu-devops/pull/23)
 Merged

This was referenced Apr 13, 2024

[first try deploiement raspberry
Khagou/khagu-devops#24](/Khagou/khagu-devops/pull/24)
 Closed

[second try deploiement raspberry
Khagou/khagu-devops#25](/Khagou/khagu-devops/pull/25)
 Closed

[3eme essais deploiement raspberry, utilisation image compatible amd64+arm64
Khagou/khagu-devops#26](/Khagou/khagu-devops/pull/26)
 Closed

[Essais deploiement avec api url localhost
Khagou/khagu-devops#27](/Khagou/khagu-devops/pull/27)
 Closed

[4eme essais i guess, modif url pour utiliser ip
Khagou/khagu-devops#28](/Khagou/khagu-devops/pull/28)
 Closed

[Test
Khagou/khagu-devops#29](/Khagou/khagu-devops/pull/29)
 Closed

[Test2
Khagou/khagu-devops#30](/Khagou/khagu-devops/pull/30)
 Closed

[Test
Khagou/khagu-devops#31](/Khagou/khagu-devops/pull/31)
 Closed

[Test
Khagou/khagu-devops#32](/Khagou/khagu-devops/pull/32)
 Closed

[Test
Khagou/khagu-devops#33](/Khagou/khagu-devops/pull/33)
 Closed

[should fix ssl pour back
Khagou/khagu-devops#34](/Khagou/khagu-devops/pull/34)
 Open

[![@hanspagel](https://avatars.githubusercontent.com/u/1577992?s=40&v=4)](/hanspagel)
[hanspagel](/hanspagel)
mentioned this pull request
[Apr 24, 2024](#ref-pullrequest-2261203129)

[chore: update express
scalar/scalar#1516](/scalar/scalar/pull/1516)
 Merged

[hi5a](/hi5a)
referenced
this pull request
in nordic-game-lab/learnhub-sdk
[May 4, 2024](#ref-commit-71e6f1c)
[![@renovate](https://avatars.githubusercontent.com/in/2740?s=40&v=4)](/marketplace/renovate)

`[Update dependency express to v4.19.2 [SECURITY] (](/nordic-game-lab/learnhub-sdk/commit/71e6f1c752652baae44d48f92ea6969c51d0d5aa "Update dependency express to v4.19.2 [SECURITY] (#15)

[![Mend Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/) ([source](https://togithub.com/expressjs/express)) | [`4.18.2` -> `4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |

### GitHub Vulnerability Alerts

#### [CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd
https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)
[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

### [`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](https://www.mend.io/free-developer-tools/renovate/). View repository job log [here](https://developer.mend.io/github/nordic-game-lab/ngl-api-sdk).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjMzMS4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->")[#15](https://github.com/nordic-game-lab/learnhub-sdk/pull/15)[)](/nordic-game-lab/learnhub-sdk/commit/71e6f1c752652baae44d48f92ea6969c51d0d5aa "Update dependency express to v4.19.2 [SECURITY] (#15)

[![Mend Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/) ([source](https://togithub.com/expressjs/express)) | [`4.18.2` -> `4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |

### GitHub Vulnerability Alerts

#### [CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd
https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)
[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

### [`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](https://www.mend.io/free-developer-tools/renovate/). View repository job log [here](https://developer.mend.io/github/nordic-game-lab/ngl-api-sdk).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjMzMS4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->")`
…

`[71e6f1c](/nordic-game-lab/learnhub-sdk/commit/71e6f1c752652baae44d48f92ea6969c51d0d5aa)`

```
[![Mend Renovate]([https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com](https://app.renovatebot.com/images/banner.svg%29%5D%28https%3A//renovatebot.com))

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](<http://expressjs.com/>) ([source](<https://togithub.com/expressjs/express>)) | [`4.18.2` -> `4.19.2`](<https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2>) | [![age](<https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![adoption](<https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![passing](<https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![confidence](<https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) |

### GitHub Vulnerability Alerts

#### [[CVE-2024-29041](https://github.com/advisories/GHSA-rv95-896h-c2vc "CVE-2024-29041")](<https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc>)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](<https://togithub.com/pillarjs/encodeurl>) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

[expressjs/express@0867302](https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)
[expressjs/express@0b74695](https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)](https://github.com/expressjs/express/pull/5539%5D%28https%3A//togithub.com/expressjs/express/pull/5539%29)
[[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)](https://github.com/koajs/koa/issues/1800%5D%28https%3A//togithub.com/koajs/koa/issues/1800%29)
<https://expressjs.com/en/4x/api.html#res.location>

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.19.1...4.19.2>)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.19.0...4.19.1>)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](<https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.18.3...4.19.0>)

### [`v4.18.3`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.18.2...4.18.3>)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - "" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](<https://www.mend.io/free-developer-tools/renovate/>). View repository job log [here](<https://developer.mend.io/github/nordic-game-lab/ngl-api-sdk>).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjMzMS4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->
```

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this pull request
[Aug 15, 2024](#ref-pullrequest-2467127512)

[Fix missing node modules for theme
2pisoftware/cmfive-boilerplate#156](/2pisoftware/cmfive-boilerplate/pull/156)
 Merged

This was referenced Sep 12, 2024

[[Snyk] Security upgrade express from 4.17.1 to 4.21.0
m-mizutani/boilerplate-cdk-react-app#8](/m-mizutani/boilerplate-cdk-react-app/pull/8)
 Open

[[Snyk] Security upgrade express from 4.17.1 to 4.20.0
m-mizutani/boilerplate-cdk-react-app#9](/m-mizutani/boilerplate-cdk-react-app/pull/9)
 Open

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this pull request
[Nov 14, 2024](#ref-pullrequest-2657732834)

[express4.17.3
tadashi0713/docker-scout-demo#8](/tadashi0713/docker-scout-demo/pull/8)
 Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpressjs%2Fexpress%2Fpull%2F5539)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@FDrag0n](https://avatars.githubusercontent.com/u/34733637?s=52&v=4)](/FDrag0n) [![@wesleytodd](https://avatars.githubusercontent.com/u/1027776?s=52&v=4)](/wesleytodd)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_698e9ccf_20250111_204920.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpressjs%2Fexpress%2Fsecurity%2Fadvisories%2FGHSA-rv95-896h-c2vc)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpressjs%2Fexpress%2Fsecurity%2Fadvisories%2FGHSA-rv95-896h-c2vc)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=expressjs%2Fexpress)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[expressjs](/expressjs)
/
**[express](/expressjs/express)**
Public

* [Notifications](/login?return_to=%2Fexpressjs%2Fexpress) You must be signed in to change notification settings
* [Fork
  17k](/login?return_to=%2Fexpressjs%2Fexpress)
* [Star
   66k](/login?return_to=%2Fexpressjs%2Fexpress)

* [Code](/expressjs/express)
* [Issues
  105](/expressjs/express/issues)
* [Pull requests
  101](/expressjs/express/pulls)
* [Discussions](/expressjs/express/discussions)
* [Actions](/expressjs/express/actions)
* [Wiki](/expressjs/express/wiki)
* [Security](/expressjs/express/security)
* [Insights](/expressjs/express/pulse)

Additional navigation options

* [Code](/expressjs/express)
* [Issues](/expressjs/express/issues)
* [Pull requests](/expressjs/express/pulls)
* [Discussions](/expressjs/express/discussions)
* [Actions](/expressjs/express/actions)
* [Wiki](/expressjs/express/wiki)
* [Security](/expressjs/express/security)
* [Insights](/expressjs/express/pulse)

# Express.js Open Redirect in malformed URLs

Moderate

[wesleytodd](/wesleytodd)
published
GHSA-rv95-896h-c2vc
Mar 25, 2024

## Package

npm

express
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

<4.19.2
>=5.0.0-alpha.1, <5.0.0-beta.3

## Patched versions

4.19.2
5.0.0-beta.3

## Description

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](https://github.com/pillarjs/encodeurl) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

[0867302](https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)

[0b74695](https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[#5539](https://github.com/expressjs/express/pull/5539)

[koajs/koa#1800](https://github.com/koajs/koa/issues/1800)

<https://expressjs.com/en/4x/api.html#res.location>

### Severity

Moderate

6.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Changed

Confidentiality
Low

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N

### CVE ID

CVE-2024-29041

### Weaknesses

[CWE-601](/advisories?query=cwe%3A601) [CWE-1286](/advisories?query=cwe%3A1286)

### Credits

* [![@FDrag0n](https://avatars.githubusercontent.com/u/34733637?s=40&v=4)](/FDrag0n)
  [FDrag0n](/FDrag0n)
  Reporter
* [![@jonchurch](https://avatars.githubusercontent.com/u/12915163?s=40&v=4)](/jonchurch)
  [jonchurch](/jonchurch)
  Remediation developer
* [![@blakeembrey](https://avatars.githubusercontent.com/u/1088987?s=40&v=4)](/blakeembrey)
  [blakeembrey](/blakeembrey)
  Remediation developer
* [![@wesleytodd](https://avatars.githubusercontent.com/u/1027776?s=40&v=4)](/wesleytodd)
  [wesleytodd](/wesleytodd)
  Remediation developer
* [![@ruddermann](https://avatars.githubusercontent.com/u/155570043?s=40&v=4)](/ruddermann)
  [ruddermann](/ruddermann)
  Coordinator
* [![@ctcpip](https://avatars.githubusercontent.com/u/15326526?s=40&v=4)](/ctcpip)
  [ctcpip](/ctcpip)
  Coordinator

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1627767d_20250111_204916.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpressjs%2Fexpress%2Fcommit%2F0b746953c4bd8e377123527db11f9cd866e39f94)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpressjs%2Fexpress%2Fcommit%2F0b746953c4bd8e377123527db11f9cd866e39f94)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=expressjs%2Fexpress)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[expressjs](/expressjs)
/
**[express](/expressjs/express)**
Public

* [Notifications](/login?return_to=%2Fexpressjs%2Fexpress) You must be signed in to change notification settings
* [Fork
  17k](/login?return_to=%2Fexpressjs%2Fexpress)
* [Star
   66k](/login?return_to=%2Fexpressjs%2Fexpress)

* [Code](/expressjs/express)
* [Issues
  105](/expressjs/express/issues)
* [Pull requests
  101](/expressjs/express/pulls)
* [Discussions](/expressjs/express/discussions)
* [Actions](/expressjs/express/actions)
* [Wiki](/expressjs/express/wiki)
* [Security](/expressjs/express/security)
* [Insights](/expressjs/express/pulse)

Additional navigation options

* [Code](/expressjs/express)
* [Issues](/expressjs/express/issues)
* [Pull requests](/expressjs/express/pulls)
* [Discussions](/expressjs/express/discussions)
* [Actions](/expressjs/express/actions)
* [Wiki](/expressjs/express/wiki)
* [Security](/expressjs/express/security)
* [Insights](/expressjs/express/pulse)

## Commit

[Permalink](/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Improved fix for open redirect allow list bypass

[Browse files](/expressjs/express/tree/0b746953c4bd8e377123527db11f9cd866e39f94)
Browse the repository at this point in the history

```
Co-authored-by: Jon Church <me@jonchurch.com>
Co-authored-by: Blake Embrey <hello@blakeembrey.com>
```

* Loading branch information

[![@wesleytodd](https://avatars.githubusercontent.com/u/1027776?s=40&v=4)](/wesleytodd) [![@jonchurch](https://avatars.githubusercontent.com/u/12915163?s=40&v=4)](/jonchurch) [![@blakeembrey](https://avatars.githubusercontent.com/u/1088987?s=40&v=4)](/blakeembrey)

3 people

committed
Mar 25, 2024

1 parent
[4f0f6cc](/expressjs/express/commit/4f0f6cc67d531431c096ea006c2191b92931bbc3)

commit 0b74695

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**280 additions**
and
**63 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* History.md
  [History.md](#diff-abfa5988643af1b8b2600aac13b273922dbb3372e021bf1d7caadfe7473c9561)
* lib

  + lib/response.js
    [response.js](#diff-c03f99ad1a5cf68a9b32468371973a5898c4c9c9d5f097e124f1d2b7b27db11d)
* test

  + test/res.location.js
    [res.location.js](#diff-51596000622f2ed652debb5cdfb1618e708b3d8fa679cf422a7875e29ef39c6a)

## There are no files selected for viewing

5 changes: 5 additions & 0 deletions

5
[History.md](#diff-abfa5988643af1b8b2600aac13b273922dbb3372e021bf1d7caadfe7473c9561 "History.md")

Show comments

[View file](/expressjs/express/blob/0b746953c4bd8e377123527db11f9cd866e39f94/History.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,3 +1,8 @@ |
|  |  | unreleased |
|  |  | ========== |
|  |  |  |
|  |  | \* Improved fix for open redirect allow list bypass |
|  |  |  |
|  |  | 4.19.1 / 2024-03-20 |
|  |  | ========== |
|  |  |  |
| Expand Down | |  |

31 changes: 11 additions & 20 deletions

31
[lib/response.js](#diff-c03f99ad1a5cf68a9b32468371973a5898c4c9c9d5f097e124f1d2b7b27db11d "lib/response.js")

Show comments

[View file](/expressjs/express/blob/0b746953c4bd8e377123527db11f9cd866e39f94/lib/response.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -34,7 +34,6 @@ var extname = path.extname; |
|  |  | var mime = send.mime; |
|  |  | var resolve = path.resolve; |
|  |  | var vary = require('vary'); |
|  |  | var urlParse = require('url').parse; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Response prototype. |
| Expand All | | @@ -56,6 +55,7 @@ module.exports = res |
|  |  | \*/ |
|  |  |  |
|  |  | var charsetRegExp = /;\s\*charset\s\*=/; |
|  |  | var schemaAndHostRegExp = /^(?:[a-zA-Z][a-zA-Z0-9+.-]\*:)?\/\/[^\\\/\?]+/; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Set status `code`. |
| Expand Down  Expand Up | | @@ -905,32 +905,23 @@ res.cookie = function (name, value, options) { |
|  |  | \*/ |
|  |  |  |
|  |  | res.location = function location(url) { |
|  |  | var loc = String(url); |
|  |  | var loc; |
|  |  |  |
|  |  | // "back" is an alias for the referrer |
|  |  | if (url === 'back') { |
|  |  | loc = this.req.get('Referrer') || '/'; |
|  |  | } else { |
|  |  | loc = String(url); |
|  |  | } |
|  |  |  |
|  |  | var lowerLoc = loc.toLowerCase(); |
|  |  | var encodedUrl = encodeUrl(loc); |
|  |  | if (lowerLoc.indexOf('https://') === 0 || lowerLoc.indexOf('http://') === 0) { |
|  |  | try { |
|  |  | var parsedUrl = urlParse(loc); |
|  |  | var parsedEncodedUrl = urlParse(encodedUrl); |
|  |  | // Because this can encode the host, check that we did not change the host |
|  |  | if (parsedUrl.host !== parsedEncodedUrl.host) { |
|  |  | // If the host changes after encodeUrl, return the original url |
|  |  | return this.set('Location', loc); |
|  |  | } |
|  |  | } catch (e) { |
|  |  | // If parse fails, return the original url |
|  |  | return this.set('Location', loc); |
|  |  | } |
|  |  | } |
|  |  | var m = schemaAndHostRegExp.exec(loc); |
|  |  | var pos = m ? m[0].length + 1 : 0; |
|  |  |  |
|  |  | // Only encode after host to avoid invalid encoding which can introduce |
|  |  | // vulnerabilities (e.g. `\\` to `%5C`). |
|  |  | loc = loc.slice(0, pos) + encodeUrl(loc.slice(pos)); |
|  |  |  |
|  |  | // set location |
|  |  | return this.set('Location', encodedUrl); |
|  |  | return this.set('Location', loc); |
|  |  | }; |
|  |  |  |
|  |  | /\*\* |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0b74695`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpressjs%2Fexpress%2Fcommit%2F0b746953c4bd8e377123527db11f9cd866e39f94) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from expressjs.com_a41ddc6a_20250111_204914.html ===


[Express](/)

* [Home](/)
* [Getting started](/en/starter/installing.html)
  + [Installing](/en/starter/installing.html)
  + [Hello world](/en/starter/hello-world.html)
  + [Express generator](/en/starter/generator.html)
  + [Basic routing](/en/starter/basic-routing.html)
  + [Static files](/en/starter/static-files.html)
  + [More examples](/en/starter/examples.html)
  + [FAQ](/en/starter/faq.html)
* [Guide](/en/guide/routing.html)
  + [Routing](/en/guide/routing.html)
  + [Writing middleware](/en/guide/writing-middleware.html)
  + [Using middleware](/en/guide/using-middleware.html)
  + [Overriding the Express API](/en/guide/overriding-express-api.html)
  + [Using template engines](/en/guide/using-template-engines.html)
  + [Error handling](/en/guide/error-handling.html)
  + [Debugging](/en/guide/debugging.html)
  + [Express behind proxies](/en/guide/behind-proxies.html)
  + [Moving to Express 4](/en/guide/migrating-4.html)
  + [Moving to Express 5](/en/guide/migrating-5.html)
  + [Database integration](/en/guide/database-integration.html)
* [API reference](/en/5x/api.html)
  + [5.x](/en/5x/api.html)
  + [4.x](/en/4x/api.html)
  + [3.x (deprecated)](/en/3x/api.html)
  + [2.x (deprecated)](/2x/)
* [Advanced topics](/en/advanced/developing-template-engines.html)
  + [Building template engines](/en/advanced/developing-template-engines.html)
  + [Security updates](/en/advanced/security-updates.html)
  + [Security best practices](/en/advanced/best-practice-security.html)
  + [Performance best practices](/en/advanced/best-practice-performance.html)
  + [Health checks & shutdown](/en/advanced/healthcheck-graceful-shutdown.html)
* [Resources](/en/resources/glossary.html)
  + [Community](/en/resources/community.html)
  + [Glossary](/en/resources/glossary.html)
  + [Middleware](/en/resources/middleware.html)
  + [Utility modules](/en/resources/utils.html)
  + [Contributing to Express](/en/resources/contributing.html)
  + [Release Change Log](/en/changelog/4x.html)
* [Support](/en/support)
* [Blog](/2025/01/09/rewind-2024-triumphs-and-2025-vision.html)
  + [Latest post](/2025/01/09/rewind-2024-triumphs-and-2025-vision.html)
  + [All posts](/en/blog/posts.html)
  + [Write a Post](/en/blog/write-post.html)

* [express()](#express)
  + *Methods*
  + [express.json()](#express.json)
  + [express.raw()](#express.raw)
  + [express.Router()](#express.router)
  + [express.static()](#express.static)
  + [express.text()](#express.text)
  + [express.urlencoded()](#express.urlencoded)
* [Application](#app)
  + *Properties*
  + [app.locals](#app.locals)
  + [app.mountpath](#app.mountpath)
  + *Events*
  + [mount](#app.onmount)
  + *Methods*
  + [app.all()](#app.all)
  + [app.delete()](#app.delete.method)
  + [app.disable()](#app.disable)
  + [app.disabled()](#app.disabled)
  + [app.enable()](#app.enable)
  + [app.enabled()](#app.enabled)
  + [app.engine()](#app.engine)
  + [app.get()](#app.get)
  + [app.get()](#app.get.method)
  + [app.listen()](#app.listen)
  + [app.METHOD()](#app.METHOD)
  + [app.param()](#app.param)
  + [app.path()](#app.path)
  + [app.post()](#app.post.method)
  + [app.put()](#app.put.method)
  + [app.render()](#app.render)
  + [app.route()](#app.route)
  + [app.set()](#app.set)
  + [app.use()](#app.use)
* [Request](#req)
  + *Properties*
  + [req.app](#req.app)
  + [req.baseUrl](#req.baseUrl)
  + [req.body](#req.body)
  + [req.cookies](#req.cookies)
  + [req.fresh](#req.fresh)
  + [req.hostname](#req.hostname)
  + [req.ip](#req.ip)
  + [req.ips](#req.ips)
  + [req.method](#req.method)
  + [req.originalUrl](#req.originalUrl)
  + [req.params](#req.params)
  + [req.path](#req.path)
  + [req.protocol](#req.protocol)
  + [req.query](#req.query)
  + [req.res](#req.res)
  + [req.route](#req.route)
  + [req.secure](#req.secure)
  + [req.signedCookies](#req.signedCookies)
  + [req.stale](#req.stale)
  + [req.subdomains](#req.subdomains)
  + [req.xhr](#req.xhr)
  + *Methods*
  + [req.accepts()](#req.accepts)
  + [req.acceptsCharsets()](#req.acceptsCharsets)
  + [req.acceptsEncodings()](#req.acceptsEncodings)
  + [req.acceptsLanguages()](#req.acceptsLanguages)
  + [req.get()](#req.get)
  + [req.is()](#req.is)
  + [req.param()](#req.param)
  + [req.range()](#req.range)
* [Response](#res)
  + *Properties*
  + [res.app](#res.app)
  + [res.headersSent](#res.headersSent)
  + [res.locals](#res.locals)
  + *Methods*
  + [res.append()](#res.append)
  + [res.attachment()](#res.attachment)
  + [res.cookie()](#res.cookie)
  + [res.clearCookie()](#res.clearCookie)
  + [res.download()](#res.download)
  + [res.end()](#res.end)
  + [res.format()](#res.format)
  + [res.get()](#res.get)
  + [res.json()](#res.json)
  + [res.jsonp()](#res.jsonp)
  + [res.links()](#res.links)
  + [res.location()](#res.location)
  + [res.redirect()](#res.redirect)
  + [res.render()](#res.render)
  + [res.send()](#res.send)
  + [res.sendFile()](#res.sendFile)
  + [res.sendStatus()](#res.sendStatus)
  + [res.set()](#res.set)
  + [res.status()](#res.status)
  + [res.type()](#res.type)
  + [res.vary()](#res.vary)
* [Router](#router)
  + *Methods*
  + [router.all()](#router.all)
  + [router.METHOD()](#router.METHOD)
  + [router.param()](#router.param)
  + [router.route()](#router.route)
  + [router.use()](#router.use)

# 4.x API

 Note

Express 4.0 requires Node.js 0.10 or higher.

## express()

Creates an Express application. The `express()` function is a top-level function exported by the `express` module.

```
var express = require('express')
var app = express()

```
### Methods

### express.json([options])

This middleware is available in Express v4.16.0 onwards.

This is a built-in middleware function in Express. It parses incoming requests
with JSON payloads and is based on
[body-parser](/resources/middleware/body-parser.html).

Returns middleware that only parses JSON and only looks at requests where
the `Content-Type` header matches the `type` option. This parser accepts any
Unicode encoding of the body and supports automatic inflation of `gzip` and
`deflate` encodings.

A new `body` object containing the parsed data is populated on the `request`
object after the middleware (i.e. `req.body`), or an empty object (`{}`) if
there was no body to parse, the `Content-Type` was not matched, or an error
occurred.

As `req.body`’s shape is based on user-controlled input, all properties and
values in this object are untrusted and should be validated before trusting.
For example, `req.body.foo.toString()` may fail in multiple ways, for example
`foo` may not be there or may not be a string, and `toString` may not be a
function and instead a string or other user-input.

The following table describes the properties of the optional `options` object.

| Property | Description | Type | Default |
| --- | --- | --- | --- |
| `inflate` | Enables or disables handling deflated (compressed) bodies; when disabled, deflated bodies are rejected. | Boolean | `true` |
| `limit` | Controls the maximum request body size. If this is a number, then the value specifies the number of bytes; if it is a string, the value is passed to the [bytes](https://www.npmjs.com/package/bytes) library for parsing. | Mixed | `"100kb"` |
| `reviver` | The `reviver` option is passed directly to `JSON.parse` as the second argument. You can find more information on this argument [in the MDN documentation about JSON.parse](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse#Example.3A_Using_the_reviver_parameter). | Function | `null` |
| `strict` | Enables or disables only accepting arrays and objects; when disabled will accept anything `JSON.parse` accepts. | Boolean | `true` |
| `type` | This is used to determine what media type the middleware will parse. This option can be a string, array of strings, or a function. If not a function, `type` option is passed directly to the [type-is](https://www.npmjs.org/package/type-is#readme) library and this can be an extension name (like `json`), a mime type (like `application/json`), or a mime type with a wildcard (like `*/*` or `*/json`). If a function, the `type` option is called as `fn(req)` and the request is parsed if it returns a truthy value. | Mixed | `"application/json"` |
| `verify` | This option, if supplied, is called as `verify(req, res, buf, encoding)`, where `buf` is a `Buffer` of the raw request body and `encoding` is the encoding of the request. The parsing can be aborted by throwing an error. | Function | `undefined` |

### express.raw([options])

This middleware is available in Express v4.17.0 onwards.

This is a built-in middleware function in Express. It parses incoming request
payloads into a `Buffer` and is based on
[body-parser](/resources/middleware/body-parser.html).

Returns middleware that parses all bodies as a `Buffer` and only looks at requests
where the `Content-Type` header matches the `type` option. This parser accepts
any Unicode encoding of the body and supports automatic inflation of `gzip` and
`deflate` encodings.

A new `body` `Buffer` containing the parsed data is populated on the `request`
object after the middleware (i.e. `req.body`), or an empty object (`{}`) if
there was no body to parse, the `Content-Type` was not matched, or an error
occurred.

As `req.body`’s shape is based on user-controlled input, all properties and
values in this object are untrusted and should be validated before trusting.
For example, `req.body.toString()` may fail in multiple ways, for example
stacking multiple parsers `req.body` may be from a different parser. Testing
that `req.body` is a `Buffer` before calling buffer methods is recommended.

The following table describes the properties of the optional `options` object.

| Property | Description | Type | Default |
| --- | --- | --- | --- |
| `inflate` | Enables or disables handling deflated (compressed) bodies; when disabled, deflated bodies are rejected. | Boolean | `true` |
| `limit` | Controls the maximum request body size. If this is a number, then the value specifies the number of bytes; if it is a string, the value is passed to the [bytes](https://www.npmjs.com/package/bytes) library for parsing. | Mixed | `"100kb"` |
| `type` | This is used to determine what media type the middleware will parse. This option can be a string, array of strings, or a function. If not a function, `type` option is passed directly to the [type-is](https://www.npmjs.org/package/type-is#readme) library and this can be an extension name (like `bin`), a mime type (like `application/octet-stream`), or a mime type with a wildcard (like `*/*` or `application/*`). If a function, the `type` option is called as `fn(req)` and the request is parsed if it returns a truthy value. | Mixed | `"application/octet-stream"` |
| `verify` | This option, if supplied, is called as `verify(req, res, buf, encoding)`, where `buf` is a `Buffer` of the raw request body and `encoding` is the encoding of the request. The parsing can be aborted by throwing an error. | Function | `undefined` |

### express.Router([options])

Creates a new [router](#router) object.

```
var router = express.Router([options])

```

The optional `options` parameter specifies the behavior of the router.

| Property | Description | Default | Availability |
| --- | --- | --- | --- |
| `caseSensitive` | Enable case sensitivity. | Disabled by default, treating “/Foo” and “/foo” as the same. |  |
| `mergeParams` | Preserve the `req.params` values from the parent router. If the parent and the child have conflicting param names, the child’s value take precedence. | `false` | 4.5.0+ |
| `strict` | Enable strict routing. | Disabled by default, “/foo” and “/foo/” are treated the same by the router. |  |

You can add middleware and HTTP method routes (such as `get`, `put`, `post`, and
so on) to `router` just like an application.

For more information, see [Router](#router).

### express.static(root, [options])

This is a built-in middleware function in Express.
It serves static files and is based on [serve-static](/resources/middleware/serve-static.html).

 Note

For best results, [use a reverse proxy](/en/advanced/best-practice-performance.html#use-a-reverse-proxy) cache to improve performance of serving static assets.

The `root` argument specifies the root directory from which to serve static assets.
The function determines the file to serve by combining `req.url` with the provided `root` directory.
When a file is not found, instead of sending a 404 response, it calls `next()`
to move on to the next middleware, allowing for stacking and fall-backs.

The following table describes the properties of the `options` object.
See also the [example below](#example.of.express.static).

| Property | Description | Type | Default |
| --- | --- | --- | --- |
| `dotfiles` | Determines how dotfiles (files or directories that begin with a dot “.”) are treated. See [dotfiles](#dotfiles) below. | String | `undefined` |
| `etag` | Enable or disable etag generation NOTE: `express.static` always sends weak ETags. | Boolean | `true` |
| `extensions` | Sets file extension fallbacks: If a file is not found, search for files with the specified extensions and serve the first one found. Example: `['html', 'htm']`. | Mixed | `false` |
| `fallthrough` | Let client errors fall-through as unhandled requests, otherwise forward a client error. See [fallthrough](#fallthrough) below. | Boolean | `true` |
| `immutable` | Enable or disable the `immutable` directive in the `Cache-Control` response header. If enabled, the `maxAge` option should also be specified to enable caching. The `immutable` directive will prevent supported clients from making conditional requests during the life of the `maxAge` option to check if the file has changed. | Boolean | `false` |
| `index` | Sends the specified directory index file. Set to `false` to disable directory indexing. | Mixed | “index.html” |
| `lastModified` | Set the `Last-Modified` header to the last modified date of the file on the OS. | Boolean | `true` |
| `maxAge` | Set the max-age property of the Cache-Control header in milliseconds or a string in [ms format](https://www.npmjs.org/package/ms). | Number | 0 |
| `redirect` | Redirect to trailing “/” when the pathname is a directory. | Boolean | `true` |
| `setHeaders` | Function for setting HTTP headers to serve with the file. See [setHeaders](#setHeaders) below. | Function |  |

For more information, see [Serving static files in Express](/starter/static-files.html).
and [Using middleware - Built-in middleware](/en/guide/using-middleware.html#middleware.built-in).

##### dotfiles

Possible values for this option are:

* “allow” - No special treatment for dotfiles.
* “deny” - Deny a request for a dotfile, respond with `403`, then call `next()`.
* “ignore” - Act as if the dotfile does not exist, respond with `404`, then call `next()`.
* `undefined` - Act as ignore, except that files in a directory that begins with a dot are **NOT** ignored.

##### fallthrough

When this option is `true`, client errors such as a bad request or a request to a non-existent
file will cause this middleware to simply call `next()` to invoke the next middleware in the stack.
When false, these errors (even 404s), will invoke `next(err)`.

Set this option to `true` so you can map multiple physical directories
to the same web address or for routes to fill in non-existent files.

Use `false` if you have mounted this middleware at a path designed
to be strictly a single file system directory, which allows for short-circuiting 404s
for less overhead. This middleware will also reply to all methods.

##### setHeaders

For this option, specify a function to set custom response headers. Alterations to the headers must occur synchronously.

The signature of the function is:

```
fn(res, path, stat)

```

Arguments:

* `res`, the [response object](#res).
* `path`, the file path that is being sent.
* `stat`, the `stat` object of the file that is being sent.

#### Example of express.static

Here is an example of using the `express.static` middleware function with an elaborate options object:

```
var options = {
  dotfiles: 'ignore',
  etag: false,
  extensions: ['htm', 'html'],
  index: false,
  maxAge: '1d',
  redirect: false,
  setHeaders: function (res, path, stat) {
    res.set('x-timestamp', Date.now())
  }
}

app.use(express.static('public', options))

```

### express.text([options])

This middleware is available in Express v4.17.0 onwards.

This is a built-in middleware function in Express. It parses incoming request
payloads into a string and is based on
[body-parser](/resources/middleware/body-parser.html).

Returns middleware that parses all bodies as a string and only looks at requests
where the `Content-Type` header matches the `type` option. This parser accepts
any Unicode encoding of the body and supports automatic inflation of `gzip` and
`deflate` encodings.

A new `body` string containing the parsed data is populated on the `request`
object after the middleware (i.e. `req.body`), or an empty object (`{}`) if
there was no body to parse, the `Content-Type` was not matched, or an error
occurred.

As `req.body`’s shape is based on user-controlled input, all properties and
values in this object are untrusted and should be validated before trusting.
For example, `req.body.trim()` may fail in multiple ways, for example
stacking multiple parsers `req.body` may be from a different parser. Testing
that `req.body` is a string before calling string methods is recommended.

The following table describes the properties of the optional `options` object.

| Property | Description | Type | Default |
| --- | --- | --- | --- |
| `defaultCharset` | Specify the default character set for the text content if the charset is not specified in the `Content-Type` header of the request. | String | `"utf-8"` |
| `inflate` | Enables or disables handling deflated (compressed) bodies; when disabled, deflated bodies are rejected. | Boolean | `true` |
| `limit` | Controls the maximum request body size. If this is a number, then the value specifies the number of bytes; if it is a string, the value is passed to the [bytes](https://www.npmjs.com/package/bytes) library for parsing. | Mixed | `"100kb"` |
| `type` | This is used to determine what media type the middleware will parse. This option can be a string, array of strings, or a function. If not a function, `type` option is passed directly to the [type-is](https://www.npmjs.org/package/type-is#readme) library and this can be an extension name (like `txt`), a mime type (like `text/plain`), or a mime type with a wildcard (like `*/*` or `text/*`). If a function, the `type` option is called as `fn(req)` and the request is parsed if it returns a truthy value. | Mixed | `"text/plain"` |
| `verify` | This option, if supplied, is called as `verify(req, res, buf, encoding)`, where `buf` is a `Buffer` of the raw request body and `encoding` is the encoding of the request. The parsing can be aborted by throwing an error. | Function | `undefined` |

### express.urlencoded([options])

This middleware is available in Express v4.16.0 onwards.

This is a built-in middleware function in Express. It parses incoming requests
with urlencoded payloads and is based on [body-parser](/resources/middleware/body-parser.html).

Returns middleware that only parses urlencoded bodies and only looks at
requests where the `Content-Type` header matches the `type` option. This
parser accepts only UTF-8 encoding of the body and supports automatic
inflation of `gzip` and `deflate` encodings.

A new `body` object containing the parsed data is populated on the `request`
object after the middleware (i.e. `req.body`), or an empty object (`{}`) if
there was no body to parse, the `Content-Type` was not matched, or an error
occurred. This object will contain key-value pairs, where the value can be
a string or array (when `extended` is `false`), or any type (when `extended`
is `true`).

As `req.body`’s shape is based on user-controlled input, all properties and
values in this object are untrusted and should be validated before trusting.
For example, `req.body.foo.toString()` may fail in multiple ways, for example
`foo` may not be there or may not be a string, and `toString` may not be a
function and instead a string or other user-input.

The following table describes the properties of the optional `options` object.

| Property | Description | Type | Default |
| --- | --- | --- | --- |
| `extended` | This option allows to choose between parsing the URL-encoded data with the `querystring` library (when `false`) or the `qs` library (when `true`). The “extended” syntax allows for rich objects and arrays to be encoded into the URL-encoded format, allowing for a JSON-like experience with URL-encoded. For more information, please [see the qs library](https://www.npmjs.org/package/qs#readme). | Boolean | `true` |
| `inflate` | Enables or disables handling deflated (compressed) bodies; when disabled, deflated bodies are rejected. | Boolean | `true` |
| `limit` | Controls the maximum request body size. If this is a number, then the value specifies the number of bytes; if it is a string, the value is passed to the [bytes](https://www.npmjs.com/package/bytes) library for parsing. | Mixed | `"100kb"` |
| `parameterLimit` | This option controls the maximum number of parameters that are allowed in the URL-encoded data. If a request contains more parameters than this value, an error will be raised. | Number | `1000` |
| `type` | This is used to determine what media type the middleware will parse. This option can be a string, array of strings, or a function. If not a function, `type` option is passed directly to the [type-is](https://www.npmjs.org/package/type-is#readme) library and this can be an extension name (like `urlencoded`), a mime type (like `application/x-www-form-urlencoded`), or a mime type with a wildcard (like `*/x-www-form-urlencoded`). If a function, the `type` option is called as `fn(req)` and the request is parsed if it returns a truthy value. | Mixed | `"application/x-www-form-urlencoded"` |
| `verify` | This option, if supplied, is called as `verify(req, res, buf, encoding)`, where `buf` is a `Buffer` of the raw request body and `encoding` is the encoding of the request. The parsing can be aborted by throwing an error. | Function | `undefined` |

## Application

The `app` object conventionally denotes the Express application.
Create it by calling the top-level `express()` function exported by the Express module:

```
var express = require('express')
var app = express()

app.get('/', function (req, res) {
  res.send('hello world')
})

app.listen(3000)

```

The `app` object has methods for

* Routing HTTP requests; see for example, [app.METHOD](#app.METHOD) and [app.param](#app.param).
* Configuring middleware; see [app.route](#app.route).
* Rendering HTML views; see [app.render](#app.render).
* Registering a template engine; see [app.engine](#app.engine).

It also has settings (properties) that affect how the application behaves;
for more information, see [Application settings](#app.settings.table).

The Express application object can be referred from the [request object](#req) and the [response object](#res) as `req.app`, and `res.app`, respectively.

### Properties

### app.locals

The `app.locals` object has properties that are local variables within the application,
and will be available in templates rendered with [res.render](#res.render).

The `locals` object is used by view engines to render a response. The object
keys may be particularly sensitive and should not contain user-controlled
input, as it may affect the operation of the view engine or provide a path to
cross-site scripting. Consult the documentation for the used view engine for
additional considerations.

```
console.dir(app.locals.title)
// => 'My App'

console.dir(app.locals.email)
// => 'me@myapp.com'

```

Once set, the value of `app.locals` properties persist throughout the life of the application,
in contrast with [res.locals](#res.locals) properties that
are valid only for the lifetime of the request.

You can access local variables in templates rendered within the application.
This is useful for providing helper functions to templates, as well as application-level data.
Local variables are available in middleware via `req.app.locals` (see [req.app](#req.app))

```
app.locals.title = 'My App'
app.locals.strftime = require('strftime')
app.locals.email = 'me@myapp.com'

```

### app.mountpath

The `app.mountpath` property contains one or more path patterns on which a sub-app was mounted.

A sub-app is an instance of `express` that may be used for handling the request to a route.

```
var express = require('express')

var app = express() // the main app
var admin = express() // the sub app

admin.get('/', function (req, res) {
  console.log(admin.mountpath) // /admin
  res.send('Admin Homepage')
})

app.use('/admin', admin) // mount the sub app

```

It is similar to the [baseUrl](#req.baseUrl) property of the `req` object, except `req.baseUrl`
returns the matched URL path, instead of the matched patterns.

If a sub-app is mounted on multiple path patterns, `app.mountpath` returns the list of
patterns it is mounted on, as shown in the following example.

```
var admin = express()

admin.get('/', function (req, res) {
  console.dir(admin.mountpath) // [ '/adm*n', '/manager' ]
  res.send('Admin Homepage')
})

var secret = express()
secret.get('/', function (req, res) {
  console.log(secret.mountpath) // /secr*t
  res.send('Admin Secret')
})

admin.use('/secr*t', secret) // load the 'secret' router on '/secr*t', on the 'admin' sub app
app.use(['/adm*n', '/manager'], admin) // load the 'admin' router on '/adm*n' and '/manager', on the parent app

```
### Events

### app.on('mount', callback(parent))

The `mount` event is fired on a sub-app, when it is mounted on a parent app. The parent app is passed to the callback function.

**NOTE**

Sub-apps will:

* Not inherit the value of settings that have a default value. You must set the value in the sub-app.
* Inherit the value of settings with no default value.

For details, see [Application settings](/en/4x/api.html#app.settings.table).

```
var admin = express()

admin.on('mount', function (parent) {
  console.log('Admin Mounted')
  console.log(parent) // refers to the parent app
})

admin.get('/', function (req, res) {
  res.send('Admin Homepage')
})

app.use('/admin', admin)

```
### Methods

### app.all(path, callback [, callback ...])

This method is like the standard [app.METHOD()](#app.METHOD) methods,
except it matches all HTTP verbs.

#### Arguments

| Argument | Description | Default |
| --- | --- | --- |
| `path` | The path for which the middleware function is invoked; can be any of:  * A string representing a path. * A path pattern. * A regular expression pattern to match paths. * An array of combinations of any of the above.  For examples, see [Path examples](#path-examples). | '/' (root path) |
| `callback` | Callback functions; can be:  * A middleware function. * A series of middleware functions (separated by commas). * An array of middleware functions. * A combination of all of the above.   You can provide multiple callback functions that behave just like middleware, except that these callbacks can invoke `next('route')` to bypass the remaining route callback(s). You can use this mechanism to impose pre-conditions on a route, then pass control to subsequent routes if there is no reason to proceed with the current route.  Since [router](#router) and [app](#application) implement the middleware interface, you can use them as you would any other middleware function.  For examples, see [Middleware callback function examples](#middleware-callback-function-examples). | None |

#### Examples

The following callback is executed for requests to `/secret` whether using
GET, POST, PUT, DELETE, or any other HTTP request method:

```
app.all('/secret', function (req, res, next) {
  console.log('Accessing the secret section ...')
  next() // pass control to the next handler
})

```

The `app.all()` method is useful for mapping “global” logic for specific path prefixes or arbitrary matches. For example, if you put the following at the top of all other
route definitions, it requires that all routes from that point on
require authentication, and automatically load a user. Keep in mind
that these callbacks do not have to act as end-points: `loadUser`
can perform a task, then call `next()` to continue matching subsequent
routes.

```
app.all('*', requireAuthentication, loadUser)

```

Or the equivalent:

```
app.all('*', requireAuthentication)
app.all('*', loadUser)

```

Another example is white-listed “global” functionality.
The example is similar to the ones above, but it only restricts paths that start with
“/api”:

```
app.all('/api/*', requireAuthentication)

```

### app.delete(path, callback [, callback ...])

Routes HTTP DELETE requests to the specified path with the specified callback functions.
For more information, see the [routing guide](/en/guide/routing.html).

#### Arguments

| Argument | Description | Default |
| --- | --- | --- |
| `path` | The path for which the middleware function is invoked; can be any of:  * A string representing a path. * A path pattern. * A regular expression pattern to match paths. * An array of combinations of any of the above.  For examples, see [Path examples](#path-examples). | '/' (root path) |
| `callback` | Callback functions; can be:  * A middleware function. * A series of middleware functions (separated by commas). * An array of middleware functions. * A combination of all of the above.   You can provide multiple callback functions that behave just like middleware, except that these callbacks can invoke `next('route')` to bypass the remaining route callback(s). You can use this mechanism to impose pre-conditions on a route, then pass control to subsequent routes if there is no reason to proceed with the current route.  Since [router](#router) and [app](#application) implement the middleware interface, you can use them as you would any other middleware function.  For examples, see [Middleware callback function examples](#middleware-callback-function-examples). | None |

#### Example

```
app.delete('/', function (req, res) {
  res.send('DELETE request to homepage')
})

```

### app.disable(name)

Sets the Boolean setting `name` to `false`, where `name` is one of the properties from the [app settings table](#app.settings.table).
Calling `app.set('foo', false)` for a Boolean property is the same as calling `app.disable('foo')`.

For example:

```
app.disable('trust proxy')
app.get('trust proxy')
// => false

```

### app.disabled(name)

Returns `true` if the Boolean setting `name` is disabled (`false`), where `name` is one of the properties from
the [app settings table](#app.settings.table).

```
app.disabled('trust proxy')
// => true

app.enable('trust proxy')
app.disabled('trust proxy')
// => false

```

### app.enable(name)

Sets the Boolean setting `name` to `true`, where `name` is one of the properties from the [app settings table](#app.settings.table).
Calling `app.set('foo', true)` for a Boolean property is the same as calling `app.enable('foo')`.

```
app.enable('trust proxy')
app.get('trust proxy')
// => true

```

### app.enabled(name)

Returns `true` if the setting `name` is enabled (`true`), where `name` is one of the
properties from the [app settings table](#app.settings.table).

```
app.enabled('trust proxy')
// => false

app.enable('trust proxy')
app.enabled('trust proxy')
// => true

```

### app.engine(ext, callback)

Registers the given template engine `callback` as `ext`.

By default, Express will `require()` the engine based on the file extension.
For example, if you try to render a “foo.pug” file, Express invokes the
following internally, and caches the `require()` on subsequent calls to increase
performance.

```
app.engine('pug', require('pug').__express)

```

Use this method for engines that do not provide `.__express` out of the box,
or if you wish to “map” a different extension to the template engine.

For example, to map the EJS template engine to “.html” files:

```
app.engine('html', require('ejs').renderFile)

```

In this case, EJS provides a `.renderFile()` method with
the same signature that Express expects: `(path, options, callback)`,
though note that it aliases this method as `ejs.__express` internally
so if you’re using “.ejs” extensions you don’t need to do anything.

Some template engines do not follow this convention. The
[consolidate.js](https://github.com/tj/consolidate.js) library maps Node template engines to follow this convention,
so they work seamlessly with Express.

```
var engines = require('consolidate')
app.engine('haml', engines.haml)
app.engine('html', engines.hogan)

```

### app.get(name)

Returns the value of `name` app setting, where `name` is one of the strings in the
[app settings table](#app.settings.table). For example:

```
app.get('title')
// => undefined

app.set('title', 'My Site')
app.get('title')
// => "My Site"

```

### app.get(path, callback [, callback ...])

Routes HTTP GET requests to the specified path with the specified callback functions.

#### Arguments

| Argument | Description | Default |
| --- | --- | --- |
| `path` | The path for which the middleware function is invoked; can be any of:  * A string representing a path. * A path pattern. * A regular expression pattern to match paths. * An array of combinations of any of the above.  For examples, see [Path examples](#path-examples). | '/' (root path) |
| `callback` | Callback functions; can be:  * A middleware function. * A series of middleware functions (separated by commas). * An array of middleware functions. * A combination of all of the above.   You can provide multiple callback functions that behave just like middleware, except that these callbacks can invoke `next('route')` to bypass the remaining route callback(s). You can use this mechanism to impose pre-conditions on a route, then pass control to subsequent routes if there is no reason to proceed with the current route.  Since [router](#router) and [app](#application) implement the middleware interface, you can use them as you would any other middleware function.  For examples, see [Middleware callback function examples](#middleware-callback-function-examples). | None |

For more information, see the [routing guide](/en/guide/routing.html).

#### Example

```
app.get('/', function (req, res) {
  res.send('GET request to homepage')
})

```

### app.listen(path, [callback])

Starts a UNIX socket and listens for connections on the given path.
This method is identical to Node’s [http.Server.listen()](https://nodejs.org/api/http.html#http_server_listen).

```
var express = require('express')
var app = express()
app.listen('/tmp/sock')

```
### app.listen([port[, host[, backlog]]][, callback])

Binds and listens for connections on the specified host and port.
This method is identical to Node’s [http.Server.listen()](https://nodejs.org/api/http.html#http_server_listen).

If port is omitted or is 0, the operating system will assign an arbitrary unused
port, which is useful for cases like automated tasks (tests, etc.).

```
var express = require('express')
var app = express()
app.listen(3000)

```

The `app` returned by `express()` is in fact a JavaScript
`Function`, designed to be passed to Node’s HTTP servers as a callback
to handle requests. This makes it easy to provide both HTTP and HTTPS versions of
your app with the same code base, as the app does not inherit from these
(it is simply a callback):

```
var express = require('express')
var https = require('https')
var http = require('http')
var app = express()

http.createServer(app).listen(80)
https.createServer(options, app).listen(443)

```

The `app.listen()` method returns an [http.Server](https://nodejs.org/api/http.html#http_class_http_server) object and (for HTTP) is a convenience method for the following:

```
app.listen = function () {
  var server = http.createServer(this)
  return server.listen.apply(server, arguments)
}

```

 Note

All the forms of Node’s
[http.Server.listen()](https://nodejs.org/api/http.html#http_server_listen)
method are in fact actually supported.

### app.METHOD(path, callback [, callback ...])

Routes an HTTP request, where METHOD is the HTTP method of the request, such as GET,
PUT, POST, and so on, in lowercase. Thus, the actual methods are `app.get()`,
`app.post()`, `app.put()`, and so on. See [Routing methods](#routing-methods) below for the complete list.

#### Arguments

| Argument | Description | Default |
| --- | --- | --- |
| `path` | The path for which the middleware function is invoked; can be any of:  * A string representing a path. * A path pattern. * A regular expression pattern to match paths. * An array of combinations of any of the above.  For examples, see [Path examples](#path-examples). | '/' (root path) |
| `callback` | Callback functions; can be:  * A middleware function. * A series of middleware functions (separated by commas). * An array of middleware functions. * A combination of all of the above.   You can provide multiple callback functions that behave just like middleware, except that these callbacks can invoke `next('route')` to bypass the remaining route callback(s). You can use this mechanism to impose pre-conditions on a route, then pass control to subsequent routes if there is no reason to proceed with the current route.  Since [router](#router) and [app](#application) implement the middleware interface, you can use them as you would any other middleware function.  For examples, see [Middleware callback function examples](#middleware-callback-function-examples). | None |

#### Routing methods

Express supports the following routing methods corresponding to the HTTP methods of the same names:

| * `checkout` * `copy` * `delete` * `get` * `head` * `lock` * `merge` * `mkactivity` | * `mkcol` * `move` * `m-search` * `notify` * `options` * `patch` * `post` | * `purge` * `put` * `report` * `search` * `subscribe` * `trace` * `unlock` * `unsubscribe` |
| --- | --- | --- |

The API documentation has explicit entries only for the most popular HTTP methods `app.get()`,
`app.post()`, `app.put()`, and `app.delete()`.
However, the other methods listed above work in exactly the same way.

To route methods that translate to invalid JavaScript variable names, use the bracket notation. For example, `app['m-search']('/', function ...`.

The `app.get()` function is automatically called for the HTTP `HEAD` method in addition to the `GET`
method if `app.head()` was not called for the path before `app.get()`.

The method, `app.all()`, is not derived from any HTTP method and loads middleware at
the specified path for *all* HTTP request methods.
For more information, see [app.all](#app.all).

For more information on routing, see the [routing guide](/en/guide/routing.html).

### app.param([name], callback)

Add callback triggers to [route parameters](/en/guide/routing.html#route-parameters), where `name` is the name of the parameter or an array of them, and `callback` is the callback function. The parameters of the callback function are the request object, the response object, the next middleware, the value of the parameter and the name of the parameter, in that order.

If `name` is an array, the `callback` trigger is registered for each parameter declared in it, in the order in which they are declared. Furthermore, for each declared parameter except the last one, a call to `next` inside the callback will call the callback for the next declared parameter. For the last parameter, a call to `next` will call the next middleware in place for the route currently being processed, just like it would if `name` were just a string.

For example, when `:user` is present in a route path, you may map user loading logic to automatically provide `req.user` to the route, or perform validations on the parameter input.

```
app.param('user', function (req, res, next, id) {
  // try to get the user details from the User model and attach it to the request object
  User.find(id, function (err, user) {
    if (err) {
      next(err)
    } else if (user) {
      req.user = user
      next()
    } else {
      next(new Error('failed to load user'))
    }
  })
})

```

Param callback functions are local to the router on which they are defined. They are not inherited by mounted apps or routers, nor are they triggered for route parameters inherited from parent routers. Hence, param callbacks defined on `app` will be triggered only by route parameters defined on `app` routes.

All param callbacks will be called before any handler of any route in which the param occurs, and they will each be called only once in a request-response cycle, even if the parameter is matched in multiple routes, as shown in the following examples.

```
app.param('id', function (req, res, next, id) {
  console.log('CALLED ONLY ONCE')
  next()
})

app.get('/user/:id', function (req, res, next) {
  console.log('although this matches')
  next()
})

app.get('/user/:id', function (req, res) {
  console.log('and this matches too')
  res.end()
})

```

On `GET /user/42`, the following is printed:

```
CALLED ONLY ONCE
although this matches
and this matches too

```
```
app.param(['id', 'page'], function (req, res, next, value) {
  console.log('CALLED ONLY ONCE with', value)
  next()
})

app.get('/user/:id/:page', function (req, res, next) {
  console.log('although this matches')
  next()
})

app.get('/user/:id/:page', function (req, res) {
  console.log('and this matches too')
  res.end()
})

```

On `GET /user/42/3`, the following is printed:

```
CALLED ONLY ONCE with 42
CALLED ONLY ONCE with 3
although this matches
and this matches too

```

The following section describes `app.param(callback)`, which is deprecated as of v4.11.0.

The behavior of the `app.param(name, callback)` method can be altered entirely by passing only a function to `app.param()`. This function is a custom implementation of how `app.param(name, callback)` should behave - it accepts two parameters and must return a middleware.

The first parameter of this function is the name of the URL parameter that should be captured, the second parameter can be any JavaScript object which might be used for returning the middleware implementation.

The middleware returned by the function decides the behavior of what happens when a URL parameter is captured.

In this example, the `app.param(name, callback)` signature is modified to `app.param(name, accessId)`. Instead of accepting a name and a callback, `app.param()` will now accept a name and a number.

```
var express = require('express')
var app = express()

// customizing the behavior of app.param()
app.param(function (param, option) {
  return function (req, res, next, val) {
    if (val === option) {
      next()
    } else {
      next('route')
    }
  }
})

// using the customized app.param()
app.param('id', 1337)

// route to trigger the capture
app.get('/user/:id', function (req, res) {
  res.send('OK')
})

app.listen(3000, function () {
  console.log('Ready')
})

```

In this example, the `app.param(name, callback)` signature remains the same, but instead of a middleware callback, a custom data type checking function has been defined to validate the data type of the user id.

```
app.param(function (param, validator) {
  return function (req, res, next, val) {
    if (validator(val)) {
      next()
    } else {
      next('route')
    }
  }
})

app.param('id', function (candidate) {
  return !isNaN(parseFloat(candidate)) && isFinite(candidate)
})

```

The ‘`.`’ character can’t be used to capture a character in your capturing regexp. For example you can’t use `'/user-.+/'` to capture `'users-gami'`, use `[\\s\\S]` or `[\\w\\W]` instead (as in `'/user-[\\s\\S]+/'`.

Examples:

```
// captures '1-a_6' but not '543-azser-sder'
router.get('/[0-9]+-[[\\w]]*', function (req, res, next) { next() })

// captures '1-a_6' and '543-az(ser"-sder' but not '5-a s'
router.get('/[0-9]+-[[\\S]]*', function (req, res, next) { next() })

// captures all (equivalent to '.*')
router.get('[[\\s\\S]]*', function (req, res, next) { next() })

```

### app.path()

Returns the canonical path of the app, a string.

```
var app = express()
var blog = express()
var blogAdmin = express()

app.use('/blog', blog)
blog.use('/admin', blogAdmin)

console.dir(app.path()) // ''
console.dir(blog.path()) // '/blog'
console.dir(blogAdmin.path()) // '/blog/admin'

```

The behavior of this method can become very complicated in complex cases of mounted apps:
it is usually better to use [req.baseUrl](#req.baseUrl) to get the canonical path of the app.

### app.post(path, callback [, callback ...])

Routes HTTP POST requests to the specified path with the specified callback functions.
For more information, see the [routing guide](/en/guide/routing.html).

#### Arguments

| Argument | Description | Default |
| --- | --- | --- |
| `path` | The path for which the middleware function is invoked; can be any of:  * A string representing a path. * A path pattern. * A regular expression pattern to match paths. * An array of combinations of any of the above.  For examples, see [Path examples](#path-examples). | '/' (root path) |
| `callback` | Callback functions; can be:  * A middleware function. * A series of middleware functions (separated by commas). * An array of middleware functions. * A combination of all of the above.   You can provide multiple callback functions that behave just like middleware, except that these callbacks can invoke `next('route')` to bypass the remaining route callback(s). You can use this mechanism to impose pre-conditions on a route, then pass control to subsequent routes if there is no reason to proceed with the current route.  Since [router](#router) and [app](#application) implement the middleware interface, you can use them as you would any other middleware function.  For examples, see [Middleware callback function examples](#middleware-callback-function-examples). | None |

#### Example

```
app.post('/', function (req, res) {
  res.send('POST request to homepage')
})

```

### app.put(path, callback [, callback ...])

Routes HTTP PUT requests to the specified path with the specified callback functions.

#### Arguments

| Argument | Description | Default |
| --- | --- | --- |
| `path` | The path for which the middleware function is invoked; can be any of:  * A string representing a path. * A path pattern. * A regular expression pattern to match paths. * An array of combinations of any of the above.  For examples, see [Path examples](#path-examples). | '/' (root path) |
| `callback` | Callback functions; can be:  * A middleware function. * A series of middleware functions (separated by commas). * An array of middleware functions. * A combination of all of the above.   You can provide multiple callback functions that behave just like middleware, except that these callbacks can invoke `next('route')` to bypass the remaining route callback(s). You can use this mechanism to impose pre-conditions on a route, then pass control to subsequent routes if there is no reason to proceed with the current route.  Since [router](#router) and [app](#application) implement the middleware interface, you can use them as you would any other middleware function.  For examples, see [Middleware callback function examples](#middleware-callback-function-examples). | None |

#### Example

```
app.put('/', function (req, res) {
  res.send('PUT request to homepage')
})

```

### app.render(view, [locals], callback)

Returns the rendered HTML of a view via the `callback` function. It accepts an optional parameter
that is an object containing local variables for the view. It is like [res.render()](#res.render),
except it cannot send the rendered view to the client on its own.

Think of `app.render()` as a utility function for generating rendered view strings.
Internally `res.render()` uses `app.render()` to render views.

The `view` argument performs file system operations like reading a file from
disk and evaluating Node.js modules, and as so for security reasons should not
contain input from the end-user.

The `locals` object is used by view engines to render a response. The object
keys may be particularly sensitive and should not contain user-controlled
input, as it may affect the operation of the view engine or provide a path to
cross-site scripting. Consult the documentation for the used view engine for
additional considerations.

The local variable `cache` is reserved for enabling view cache. Set it to `true`, if you want to
cache view during development; view caching is enabled in production by default.

```
app.render('email', function (err, html) {
  // ...
})

app.render('email', { name: 'Tobi' }, function (err, html) {
  // ...
})

```

### app.route(path)

Returns an instance of a single route, which you can then use to handle HTTP verbs with optional middleware.
Use `app.route()` to avoid duplicate route names (and thus typo errors).

```
var app = express()

app.route('/events')
  .all(function (req, res, next) {
    // runs for all HTTP verbs first
    // think of it as route specific middleware!
  })
  .get(function (req, res, next) {
    res.json({})
  })
  .post(function (req, res, next) {
    // maybe add a new event...
  })

```

### app.set(name, value)

Assigns setting `name` to `value`. You may store any value that you want,
but certain names can be used to configure the behavior of the server. These
special names are listed in the [app settings table](#app.settings.table).

Calling `app.set('foo', true)` for a Boolean property is the same as calling
`app.enable('foo')`. Similarly, calling `app.set('foo', false)` for a Boolean
property is the same as calling `app.disable('foo')`.

Retrieve the value of a setting with [`app.get()`](#app.get).

```
app.set('title', 'My Site')
app.get('title') // "My Site"

```
#### Application Settings

The following table lists application settings.

Note that sub-apps will:

* Not inherit the value of settings that have a default value. You must set the value in the sub-app.
* Inherit the value of settings with no default value; these are explicitly noted in the table below.

Exceptions: Sub-apps will inherit the value of `trust proxy` even though it has a default value (for backward-compatibility);
Sub-apps will not inherit the value of `view cache` in production (when `NODE_ENV` is “production”).

| Property | Type | Description | Default |
| --- | --- | --- | --- |
| `case sensitive routing` | Boolean | Enable case sensitivity. When enabled, "/Foo" and "/foo" are different routes. When disabled, "/Foo" and "/foo" are treated the same.  **NOTE**: Sub-apps will inherit the value of this setting. | N/A (undefined) |
| `env` | String | Environment mode. Be sure to set to “production” in a production environment; see [Production best practices: performance and reliability](/en/advanced/best-practice-performance.html#env). | `process.env.NODE_ENV` (`NODE_ENV` environment variable) or “development” if `NODE_ENV` is not set. |
| `etag` | Varied | Set the ETag response header. For possible values, see the [`etag` options table](#etag.options.table).  [More about the HTTP ETag header](http://en.wikipedia.org/wiki/HTTP_ETag). | `weak` |
| `jsonp callback name` | String | Specifies the default JSONP callback name. | “callback” |
| `json escape` | Boolean | Enable escaping JSON responses from the `res.json`, `res.jsonp`, and `res.send` APIs. This will escape the characters `<`, `>`, and `&` as Unicode escape sequences in JSON. The purpose of this it to assist with [mitigating certain types of persistent XSS attacks](https://blog.mozilla.org/security/2017/07/18/web-service-audits-firefox-accounts/) when clients sniff responses for HTML.  **NOTE**: Sub-apps will inherit the value of this setting. | N/A (undefined) |
| `json replacer` | Varied | The ['replacer' argument used by `JSON.stringify`](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#The_replacer_parameter). **NOTE**: Sub-apps will inherit the value of this setting. | N/A (undefined) |
| `json spaces` | Varied | The ['space' argument used by `JSON.stringify`](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#The_space_argument). This is typically set to the number of spaces to use to indent prettified JSON. **NOTE**: Sub-apps will inherit the value of this setting. | N/A (undefined) |
| `query parser` | Varied | Disable query parsing by setting the value to `false`, or set the query parser to use either “simple” or “extended” or a custom query string parsing function.  The simple query parser is based on Node’s native query parser, [querystring](http://nodejs.org/api/querystring.html).  The extended query parser is based on [qs](https://www.npmjs.org/package/qs).  A custom query string parsing function will receive the complete query string, and must return an object of query keys and their values. | "extended" |
| `strict routing` | Boolean | Enable strict routing. When enabled, the router treats "/foo" and "/foo/" as different. Otherwise, the router treats "/foo" and "/foo/" as the same.  **NOTE**: Sub-apps will inherit the value of this setting. | N/A (undefined) |
| `subdomain offset` | Number | The number of dot-separated parts of the host to remove to access subdomain. | 2 |
| `trust proxy` | Varied | Indicates the app is behind a front-facing proxy, and to use the `X-Forwarded-*` headers to determine the connection and the IP address of the client. NOTE: `X-Forwarded-*` headers are easily spoofed and the detected IP addresses are unreliable.  When enabled, Express attempts to determine the IP address of the client connected through the front-facing proxy, or series of proxies. The `req.ips` property, then contains an array of IP addresses the client is connected through. To enable it, use the values described in the [trust proxy options table](#trust.proxy.options.table).  The `trust proxy` setting is implemented using the [proxy-addr](https://www.npmjs.org/package/proxy-addr) package. For more information, see its documentation.  **NOTE**: Sub-apps *will* inherit the value of this setting, even though it has a default value. | `false` (disabled) |
| `views` | String or Array | A directory or an array of directories for the application's views. If an array, the views are looked up in the order they occur in the array. | `process.cwd() + '/views'` |
| `view cache` | Boolean | Enables view template compilation caching.  **NOTE**: Sub-apps will not inherit the value of this setting in production (when `NODE\_ENV` is "production"). | `true` in production, otherwise undefined. |
| `view engine` | String | The default engine extension to use when omitted. **NOTE**: Sub-apps will inherit the value of this setting. | N/A (undefined) |
| `x-powered-by` | Boolean | Enables the "X-Powered-By: Express" HTTP header. | `true` |

##### Options for `trust proxy` setting

Read [Express behind proxies](/en/guide/behind-proxies.html) for more
information.

| Type | Value |
| --- | --- |
| Boolean | If `true`, the client’s IP address is understood as the left-most entry in the `X-Forwarded-*` header.  If `false`, the app is understood as directly facing the Internet and the client’s IP address is derived from `req.connection.remoteAddress`. This is the default setting. |
| StringString containing comma-separated valuesArray of strings | An IP address, subnet, or an array of IP addresses, and subnets to trust. Pre-configured subnet names are:   * loopback - `127.0.0.1/8`, `::1/128` * linklocal - `169.254.0.0/16`, `fe80::/10` * uniquelocal - `10.0.0.0/8`, `172.16.0.0/12`, `192.168.0.0/16`, `fc00::/7`   Set IP addresses in any of the following ways:  Specify a single subnet:  ``` app.set('trust proxy', 'loopback')  ```  Specify a subnet and an address:  ``` app.set('trust proxy', 'loopback, 123.123.123.123')  ```  Specify multiple subnets as CSV:  ``` app.set('trust proxy', 'loopback, linklocal, uniquelocal')  ```  Specify multiple subnets as an array:  ``` app.set('trust proxy', ['loopback', 'linklocal', 'uniquelocal'])  ```  When specified, the IP addresses or the subnets are excluded from the address determination process, and the untrusted IP address nearest to the application server is determined as the client’s IP address. |
| Number | Trust the *n*th hop from the front-facing proxy server as the client. |
| Function | Custom trust implementation. Use this only if you know what you are doing.  ``` app.set('trust proxy', function (ip) {   if (ip === '127.0.0.1' || ip === '123.123.123.123') return true // trusted IPs   else return false })  ``` |

##### Options for `etag` setting

**NOTE**: These settings apply only to dynamic files, not static files.
The [express.static](#express.static) middleware ignores these settings.

The ETag functionality is implemented using the
[etag](https://www.npmjs.org/package/etag) package.
For more information, see its documentation.

| Type | Value |
| --- | --- |
| Boolean | `true` enables weak ETag. This is the default setting. `false` disables ETag altogether. |
| String | If "strong", enables strong ETag. If "weak", enables weak ETag. |
| Function | Custom ETag function implementation. Use this only if you know what you are doing.  ``` app.set('etag', function (body, encoding) {   return generateHash(body, encoding) // consider the function is defined })  ``` |

### app.use([path,] callback [, callback...])

Mounts the specified [middleware](/en/guide/using-middleware.html) function or functions
at the specified path:
the middleware function is executed when the base of the requested path matches `path`.

#### Arguments

| Argument | Description | Default |
| --- | --- | --- |
| `path` | The path for which the middleware function is invoked; can be any of:  * A string representing a path. * A path pattern. * A regular expression pattern to match paths. * An array of combinations of any of the above.  For examples, see [Path examples](#path-examples). | '/' (root path) |
| `callback` | Callback functions; can be:  * A middleware function. * A series of middleware functions (separated by commas). * An array of middleware functions. * A combination of all of the above.   You can provide multiple callback functions that behave just like middleware, except that these callbacks can invoke `next('route')` to bypass the remaining route callback(s). You can use this mechanism to impose pre-conditions on a route, then pass control to subsequent routes if there is no reason to proceed with the current route.  Since [router](#router) and [app](#application) implement the middleware interface, you can use them as you would any other middleware function.  For examples, see [Middleware callback function examples](#middleware-callback-function-examples). | None |

#### Description

A route will match any path that follows its path immediately with a “`/`”.
For example: `app.use('/apple', ...)` will match “/apple”, “/apple/images”,
“/apple/images/news”, and so on.

Since `path` defaults to “/”, middleware mounted without a path will be executed for every request to the app.
For example, this middleware function will be executed for *every* request to the app:

```
app.use(function (req, res, next) {
  console.log('Time: %d', Date.now())
  next()
})

```

**NOTE**

Sub-apps will:

* Not inherit the value of settings that have a default value. You must set the value in the sub-app.
* Inherit the value of settings with no default value.

For details, see [Application settings](/en/4x/api.html#app.settings.table).

Middleware functions are executed sequentially, therefore the order of middleware inclusion is important.

```
// this middleware will not allow the request to go beyond it
app.use(function (req, res, next) {
  res.send('Hello World')
})

// requests will never reach this route
app.get('/', function (req, res) {
  res.send('Welcome')
})

```

**Error-handling middleware**

Error-handling middleware always takes *four* arguments. You must provide four arguments to identify it as an error-handling middleware function. Even if you don’t need to use the `next` object, you must specify it to maintain the signature. Otherwise, the `next` object will be interpreted as regular middleware and will fail to handle errors. For details about error-handling middleware, see: [Error handling](/en/guide/error-handling.html).

Define error-handling middleware functions in the same way as other middleware functions, except with four arguments instead of three, specifically with the signature `(err, req, res, next)`):

```
app.use(function (err, req, res, next) {
  console.error(err.stack)
  res.status(500).send('Something broke!')
})

```
#### Path examples

The following table provides some simple examples of valid `path` values for
mounting middleware.

| Type | Example |
| --- | --- |
| Path | This will match paths starting with `/abcd`:  ``` app.use('/abcd', function (req, res, next) {   next() })  ``` |
| Path Pattern | This will match paths starting with `/abcd` and `/abd`:  ``` app.use('/abc?d', function (req, res, next) {   next() })  ```  This will match paths starting with `/abcd`, `/abbcd`, `/abbbbbcd`, and so on:  ``` app.use('/ab+cd', function (req, res, next) {   next() })  ```  This will match paths starting with `/abcd`, `/abxcd`, `/abFOOcd`, `/abbArcd`, and so on:  ``` app.use('/ab*cd', function (req, res, next) {   next() })  ```  This will match paths starting with `/ad` and `/abcd`:  ``` app.use('/a(bc)?d', function (req, res, next) {   next() })  ``` |
| Regular Expression | This will match paths starting with `/abc` and `/xyz`:  ``` app.use(/\/abc|\/xyz/, function (req, res, next) {   next() })  ``` |
| Array | This will match paths starting with `/abcd`, `/xyza`, `/lmn`, and `/pqr`:  ``` app.use(['/abcd', '/xyza', /\/lmn|\/pqr/], function (req, res, next) {   next() })  ``` |

#### Middleware callback function examples

The following table provides some simple examples of middleware functions that
can be used as the `callback` argument to `app.use()`, `app.METHOD()`, and `app.all()`.

| Usage | Example |
| --- | --- |
| Single Middleware | You can define and mount a middleware function locally.  ``` app.use(function (req, res, next) {   next() })  ```  A router is valid middleware.  ``` var router = express.Router() router.get('/', function (req, res, next) {   next() }) app.use(router)  ```  An Express app is valid middleware.  ``` var subApp = express() subApp.get('/', function (req, res, next) {   next() }) app.use(subApp)  ``` |
| Series of Middleware | You can specify more than one middleware function at the same mount path.  ``` var r1 = express.Router() r1.get('/', function (req, res, next) {   next() })  var r2 = express.Router() r2.get('/', function (req, res, next) {   next() })  app.use(r1, r2)  ``` |
| Array | Use an array to group middleware logically.  ``` var r1 = express.Router() r1.get('/', function (req, res, next) {   next() })  var r2 = express.Router() r2.get('/', function (req, res, next) {   next() })  app.use([r1, r2])  ``` |
| Combination | You can combine all the above ways of mounting middleware.  ``` function mw1 (req, res, next) { next() } function mw2 (req, res, next) { next() }  var r1 = express.Router() r1.get('/', function (req, res, next) { next() })  var r2 = express.Router() r2.get('/', function (req, res, next) { next() })  var subApp = express() subApp.get('/', function (req, res, next) { next() })  app.use(mw1, [mw2, r1, r2], subApp)  ``` |

Following are some examples of using the [express.static](/en/guide/using-middleware.html#middleware.built-in)
middleware in an Express app.

Serve static content for the app from the “public” directory in the application directory:

```
// GET /style.css etc
app.use(express.static(path.join(__dirname, 'public')))

```

Mount the middleware at “/static” to serve static content only when their request path is prefixed with “/static”:

```
// GET /static/style.css etc.
app.use('/static', express.static(path.join(__dirname, 'public')))

```

Disable logging for static content requests by loading the logger middleware after the static middleware:

```
app.use(express.static(path.join(__dirname, 'public')))
app.use(logger())

```

Serve static files from multiple directories, but give precedence to “./public” over the others:

```
app.use(express.static(path.join(__dirname, 'public')))
app.use(express.static(path.join(__dirname, 'files')))
app.use(express.static(path.join(__dirname, 'uploads')))

```
## Request

The `req` object represents the HTTP request and has properties for the
request query string, parameters, body, HTTP headers, and so on. In this documentation and by convention,
the object is always referred to as `req` (and the HTTP response is `res`) but its actual name is determined
by the parameters to the callback function in which you’re working.

For example:

```
app.get('/user/:id', function (req, res) {
  res.send('user ' + req.params.id)
})

```

But you could just as well have:

```
app.get('/user/:id', function (request, response) {
  response.send('user ' + request.params.id)
})

```

The `req` object is an enhanced version of Node’s own request object
and supports all [built-in fields and methods](https://nodejs.org/api/http.html#http_class_http_incomingmessage).

### Properties

In Express 4, `req.files` is no longer available on the `req` object by default. To access uploaded files
on the `req.files` object, use multipart-handling middleware like [busboy](https://www.npmjs.com/package/busboy), [multer](https://www.npmjs.com/package/multer),
[formidable](https://www.npmjs.com/package/formidable),
[multiparty](https://www.npmjs.com/package/multiparty),
[connect-multiparty](https://www.npmjs.com/package/connect-multiparty),
or [pez](https://www.npmjs.com/package/pez).

### req.app

This property holds a reference to the instance of the Express application that is using the middleware.

If you follow the pattern in which you create a module that just exports a middleware function
and `require()` it in your main file, then the middleware can access the Express instance via `req.app`

For example:

```
// index.js
app.get('/viewdirectory', require('./mymiddleware.js'))

```
```
// mymiddleware.js
module.exports = function (req, res) {
  res.send('The views directory is ' + req.app.get('views'))
}

```

### req.baseUrl

The URL path on which a router instance was mounted.

The `req.baseUrl` property is similar to the [mountpath](#app.mountpath) property of the `app` object,
except `app.mountpath` returns the matched path pattern(s).

For example:

```
var greet = express.Router()

greet.get('/jp', function (req, res) {
  console.log(req.baseUrl) // /greet
  res.send('Konnichiwa!')
})

app.use('/greet', greet) // load the router on '/greet'

```

Even if you use a path pattern or a set of path patterns to load the router,
the `baseUrl` property returns the matched string, not the pattern(s). In the
following example, the `greet` router is loaded on two path patterns.

```
app.use(['/gre+t', '/hel{2}o'], greet) // load the router on '/gre+t' and '/hel{2}o'

```

When a request is made to `/greet/jp`, `req.baseUrl` is “/greet”. When a request is
made to `/hello/jp`, `req.baseUrl` is “/hello”.

### req.body

Contains key-value pairs of data submitted in the request body.
By default, it is `undefined`, and is populated when you use body-parsing middleware such
as [`express.json()`](#express.json) or [`express.urlencoded()`](#express.urlencoded).

As `req.body`’s shape is based on user-controlled input, all properties and values in this object are untrusted and should be validated before trusting. For example, `req.body.foo.toString()` may fail in multiple ways, for example `foo` may not be there or may not be a string, and `toString` may not be a function and instead a string or other user-input.

The following example shows how to use body-parsing middleware to populate `req.body`.

```
var express = require('express')

var app = express()

app.use(express.json()) // for parsing application/json
app.use(express.urlencoded({ extended: true })) // for parsing application/x-www-form-urlencoded

app.post('/profile', function (req, res, next) {
  console.log(req.body)
  res.json(req.body)
})

```

### req.cookies

When using [cookie-parser](https://www.npmjs.com/package/cookie-parser) middleware, this property is an object that
contains cookies sent by the request. If the request contains no cookies, it defaults to `{}`.

```
// Cookie: name=tj
console.dir(req.cookies.name)
// => 'tj'

```

If the cookie has been signed, you have to use [req.signedCookies](#req.signedCookies).

For more information, issues, or concerns, see [cookie-parser](https://github.com/expressjs/cookie-parser).

### req.fresh

When the response is still “fresh” in the client’s cache `true` is returned, otherwise `false` is returned to indicate that the client cache is now stale and the full response should be sent.

When a client sends the `Cache-Control: no-cache` request header to indicate an end-to-end reload request, this module will return `false` to make handling these requests transparent.

Further details for how cache validation works can be found in the
[HTTP/1.1 Caching Specification](https://tools.ietf.org/html/rfc7234).

```
console.dir(req.fresh)
// => true

```

### req.hostname

Contains the hostname derived from the `Host` HTTP header.

When the [`trust proxy` setting](/4x/api.html#trust.proxy.options.table)
does not evaluate to `false`, this property will instead get the value
from the `X-Forwarded-Host` header field. This header can be set by
the client or by the proxy.

If there is more than one `X-Forwarded-Host` header in the request, the
value of the first header is used. This includes a single header with
comma-separated values, in which the first value is used.

Prior to Express v4.17.0, the `X-Forwarded-Host` could not contain multiple
values or be present more than once.

```
// Host: "example.com:3000"
console.dir(req.hostname)
// => 'example.com'

```

### req.ip

Contains the remote IP address of the request.

When the [`trust proxy` setting](/4x/api.html#trust.proxy.options.table) does not evaluate to `false`,
the value of this property is derived from the left-most entry in the
`X-Forwarded-For` header. This header can be set by the client or by the proxy.

```
console.dir(req.ip)
// => '127.0.0.1'

```

### req.ips

When the [`trust proxy` setting](/4x/api.html#trust.proxy.options.table) does not evaluate to `false`,
this property contains an array of IP addresses
specified in the `X-Forwarded-For` request header. Otherwise, it contains an
empty array. This header can be set by the client or by the proxy.

For example, if `X-Forwarded-For` is `client, proxy1, proxy2`, `req.ips` would be
`["client", "proxy1", "proxy2"]`, where `proxy2` is the furthest downstream.

### req.method

Contains a string corresponding to the HTTP method of the request:
`GET`, `POST`, `PUT`, and so on.

### req.originalUrl

`req.url` is not a native Express property, it is inherited from Node’s [http module](https://nodejs.org/api/http.html#http_message_url).

This property is much like `req.url`; however, it retains the original request URL,
allowing you to rewrite `req.url` freely for internal routing purposes. For example,
the “mounting” feature of [app.use()](#app.use) will rewrite `req.url` to strip the mount point.

```
// GET /search?q=something
console.dir(req.originalUrl)
// => '/search?q=something'

```

`req.originalUrl` is available both in middleware and router objects, and is a
combination of `req.baseUrl` and `req.url`. Consider following example:

```
app.use('/admin', function (req, res, next) { // GET 'http://www.example.com/admin/new?sort=desc'
  console.dir(req.originalUrl) // '/admin/new?sort=desc'
  console.dir(req.baseUrl) // '/admin'
  console.dir(req.path) // '/new'
  next()
})

```

### req.params

This property is an object containing properties mapped to the [named route “parameters”](/en/guide/routing.html#route-parameters). For example, if you have the route `/user/:name`, then the “name” property is available as `req.params.name`. This object defaults to `{}`.

```
// GET /user/tj
console.dir(req.params.name)
// => 'tj'

```

When you use a regular expression for the route definition, capture groups are provided in the array using `req.params[n]`, where `n` is the nth capture group. This rule is applied to unnamed wild card matches with string routes such as `/file/*`:

```
// GET /file/javascripts/jquery.js
console.dir(req.params[0])
// => 'javascripts/jquery.js'

```

If you need to make changes to a key in `req.params`, use the [app.param](/en/4x/api.html#app.param) handler. Changes are applicable only to [parameters](/en/guide/routing.html#route-parameters) already defined in the route path.

Any changes made to the `req.params` object in a middleware or route handler will be reset.

 Note

Express automatically decodes the values in `req.params` (using `decodeURIComponent`).

### req.path

Contains the path part of the request URL.

```
// example.com/users?sort=desc
console.dir(req.path)
// => '/users'

```

When called from a middleware, the mount point is not included in `req.path`. See [app.use()](/4x/api.html#app.use) for more details.

### req.protocol

Contains the request protocol string: either `http` or (for TLS requests) `https`.

When the [`trust proxy` setting](#trust.proxy.options.table) does not evaluate to `false`,
this property will use the value of the `X-Forwarded-Proto` header field if present.
This header can be set by the client or by the proxy.

```
console.dir(req.protocol)
// => 'http'

```

### req.query

This property is an object containing a property for each query string parameter in the route.
When [query parser](#app.settings.table) is set to disabled, it is an empty object `{}`, otherwise it is the result of the configured query parser.

As `req.query`’s shape is based on user-controlled input, all properties and values in this object are untrusted and should be validated before trusting. For example, `req.query.foo.toString()` may fail in multiple ways, for example `foo` may not be there or may not be a string, and `toString` may not be a function and instead a string or other user-input.

The value of this property can be configured with the [query parser application setting](#app.settings.table) to work how your application needs it. A very popular query string parser is the [`qs` module](https://www.npmjs.org/package/qs), and this is used by default. The `qs` module is very configurable with many settings, and it may be desirable to use different settings than the default to populate `req.query`:

```
var qs = require('qs')
app.set('query parser', function (str) {
  return qs.parse(str, { /* custom options */ })
})

```

Check out the [query parser application setting](#app.settings.table) documentation for other customization options.

### req.res

This property holds a reference to the [response object](#res)
that relates to this request object.

### req.route

Contains the currently-matched route, a string. For example:

```
app.get('/user/:id?', function userIdHandler (req, res) {
  console.log(req.route)
  res.send('GET')
})

```

Example output from the previous snippet:

```
{ path: '/user/:id?',
  stack:
   [ { handle: [Function: userIdHandler],
       name: 'userIdHandler',
       params: undefined,
       path: undefined,
       keys: [],
       regexp: /^\/?$/i,
       method: 'get' } ],
  methods: { get: true } }

```

### req.secure

A Boolean property that is true if a TLS connection is established. Equivalent to:

```
console.dir(req.protocol === 'https')
// => true

```

### req.signedCookies

When using [cookie-parser](https://www.npmjs.com/package/cookie-parser) middleware, this property
contains signed cookies sent by the request, unsigned and ready for use. Signed cookies reside
in a different object to show developer intent; otherwise, a malicious attack could be placed on
`req.cookie` values (which are easy to spoof). Note that signing a cookie does not make it “hidden”
or encrypted; but simply prevents tampering (because the secret used to sign is private).

If no signed cookies are sent, the property defaults to `{}`.

```
// Cookie: user=tobi.CP7AWaXDfAKIRfH49dQzKJx7sKzzSoPq7/AcBBRVwlI3
console.dir(req.signedCookies.user)
// => 'tobi'

```

For more information, issues, or concerns, see [cookie-parser](https://github.com/expressjs/cookie-parser).

### req.stale

Indicates whether the request is “stale,” and is the opposite of `req.fresh`.
For more information, see [req.fresh](#req.fresh).

```
console.dir(req.stale)
// => true

```

### req.subdomains

An array of subdomains in the domain name of the request.

```
// Host: "tobi.ferrets.example.com"
console.dir(req.subdomains)
// => ['ferrets', 'tobi']

```

The application property `subdomain offset`, which defaults to 2, is used for determining the
beginning of the subdomain segments. To change this behavior, change its value
using [app.set](/en/4x/api.html#app.set).

### req.xhr

A Boolean property that is `true` if the request’s `X-Requested-With` header field is
“XMLHttpRequest”, indicating that the request was issued by a client library such as jQuery.

```
console.dir(req.xhr)
// => true

```
### Methods

### req.accepts(types)

Checks if the specified content types are acceptable, based on the request’s `Accept` HTTP header field.
The method returns the best match, or if none of the specified content types is acceptable, returns
`false` (in which case, the application should respond with `406 "Not Acceptable"`).

The `type` value may be a single MIME type string (such as “application/json”),
an extension name such as “json”, a comma-delimited list, or an array. For a
list or array, the method returns the *best* match (if any).

```
// Accept: text/html
req.accepts('html')
// => "html"

// Accept: text/*, application/json
req.accepts('html')
// => "html"
req.accepts('text/html')
// => "text/html"
req.accepts(['json', 'text'])
// => "json"
req.accepts('application/json')
// => "application/json"

// Accept: text/*, application/json
req.accepts('image/png')
req.accepts('png')
// => false

// Accept: text/*;q=.5, application/json
req.accepts(['html', 'json'])
// => "json"

```

For more information, or if you have issues or concerns, see [accepts](https://github.com/expressjs/accepts).

### req.acceptsCharsets(charset [, ...])

Returns the first accepted charset of the specified character sets,
based on the request’s `Accept-Charset` HTTP header field.
If none of the specified charsets is accepted, returns `false`.

For more information, or if you have issues or concerns, see [accepts](https://github.com/expressjs/accepts).

### req.acceptsEncodings(encoding [, ...])

Returns the first accepted encoding of the specified encodings,
based on the request’s `Accept-Encoding` HTTP header field.
If none of the specified encodings is accepted, returns `false`.

For more information, or if you have issues or concerns, see [accepts](https://github.com/expressjs/accepts).

### req.acceptsLanguages([lang, ...])

Returns the first accepted language of the specified languages,
based on the request’s `Accept-Language` HTTP header field.
If none of the specified languages is accepted, returns `false`.

If no `lang` argument is given, then `req.acceptsLanguages()`
returns all languages from the HTTP `Accept-Language` header
as an `Array`.

For more information, or if you have issues or concerns, see [accepts](https://github.com/expressjs/accepts).

Express (4.x) source: [request.js line 179](https://github.com/expressjs/express/blob/4.x/lib/request.js#L179)

Accepts (1.3) source: [index.js line 195](https://github.com/jshttp/accepts/blob/f69c19e459bd501e59fb0b1a40b7471bb578113a/index.js#L195)

### req.get(field)

Returns the specified HTTP request header field (case-insensitive match).
The `Referrer` and `Referer` fields are interchangeable.

```
req.get('Content-Type')
// => "text/plain"

req.get('content-type')
// => "text/plain"

req.get('Something')
// => undefined

```

Aliased as `req.header(field)`.

### req.is(type)

Returns the matching content type if the incoming request’s “Content-Type” HTTP header field
matches the MIME type specified by the `type` parameter. If the request has no body, returns `null`.
Returns `false` otherwise.

```
// With Content-Type: text/html; charset=utf-8
req.is('html')
// => 'html'
req.is('text/html')
// => 'text/html'
req.is('text/*')
// => 'text/*'

// When Content-Type is application/json
req.is('json')
// => 'json'
req.is('application/json')
// => 'application/json'
req.is('application/*')
// => 'application/*'

req.is('html')
// => false

```

For more information, or if you have issues or concerns, see [type-is](https://github.com/expressjs/type-is).

### req.param(name [, defaultValue])

Deprecated. Use either `req.params`, `req.body` or `req.query`, as applicable.

Returns the value of param `name` when present.

```
// ?name=tobi
req.param('name')
// => "tobi"

// POST name=tobi
req.param('name')
// => "tobi"

// /user/tobi for /user/:name
req.param('name')
// => "tobi"

```

Lookup is performed in the following order:

* `req.params`
* `req.body`
* `req.query`

Optionally, you can specify `defaultValue` to set a default value if the parameter is not found in any of the request objects.

Direct access to `req.body`, `req.params`, and `req.query` should be favoured for clarity - unless you truly accept input from each object.

Body-parsing middleware must be loaded for `req.param()` to work predictably. Refer [req.body](#req.body) for details.

### req.range(size[, options])

`Range` header parser.

The `size` parameter is the maximum size of the resource.

The `options` parameter is an object that can have the following properties.

| Property | Type | Description |
| --- | --- | --- |
| `combine` | Boolean | Specify if overlapping & adjacent ranges should be combined, defaults to `false`. When `true`, ranges will be combined and returned as if they were specified that way in the header. |

An array of ranges will be returned or negative numbers indicating an error parsing.

* `-2` signals a malformed header string
* `-1` signals an unsatisfiable range

```
// parse header from request
var range = req.range(1000)

// the type of the range
if (range.type === 'bytes') {
  // the ranges
  range.forEach(function (r) {
    // do something with r.start and r.end
  })
}

```
## Response

The `res` object represents the HTTP response that an Express app sends when it gets an HTTP request.

In this documentation and by convention,
the object is always referred to as `res` (and the HTTP request is `req`) but its actual name is determined
by the parameters to the callback function in which you’re working.

For example:

```
app.get('/user/:id', function (req, res) {
  res.send('user ' + req.params.id)
})

```

But you could just as well have:

```
app.get('/user/:id', function (request, response) {
  response.send('user ' + request.params.id)
})

```

The `res` object is an enhanced version of Node’s own response object
and supports all [built-in fields and methods](https://nodejs.org/api/http.html#http_class_http_serverresponse).

### Properties

### res.app

This property holds a reference to the instance of the Express application that is using the middleware.

`res.app` is identical to the [req.app](#req.app) property in the request object.

### res.headersSent

Boolean property that indicates if the app sent HTTP headers for the response.

```
app.get('/', function (req, res) {
  console.dir(res.headersSent) // false
  res.send('OK')
  console.dir(res.headersSent) // true
})

```

### res.locals

Use this property to set variables accessible in templates rendered with [res.render](#res.render).
The variables set on `res.locals` are available within a single request-response cycle, and will not
be shared between requests.

The `locals` object is used by view engines to render a response. The object
keys may be particularly sensitive and should not contain user-controlled
input, as it may affect the operation of the view engine or provide a path to
cross-site scripting. Consult the documentation for the used view engine for
additional considerations.

In order to keep local variables for use in template rendering between requests, use
[app.locals](#app.locals) instead.

This property is useful for exposing request-level information such as the request path name,
authenticated user, user settings, and so on to templates rendered within the application.

```
app.use(function (req, res, next) {
  // Make `user` and `authenticated` available in templates
  res.locals.user = req.user
  res.locals.authenticated = !req.user.anonymous
  next()
})

```
### Methods

### res.append(field [, value])

 Note

`res.append()` is supported by Express v4.11.0+

Appends the specified `value` to the HTTP response header `field`. If the header is not already set,
it creates the header with the specified value. The `value` parameter can be a string or an array.

 Note

calling `res.set()` after `res.append()` will reset the previously-set header value.

```
res.append('Link', ['<http://localhost/>', '<http://localhost:3000/>'])
res.append('Set-Cookie', 'foo=bar; Path=/; HttpOnly')
res.append('Warning', '199 Miscellaneous warning')

```

### res.attachment([filename])

Sets the HTTP response `Content-Disposition` header field to “attachment”. If a `filename` is given,
then it sets the Content-Type based on the extension name via `res.type()`,
and sets the `Content-Disposition` “filename=” parameter.

```
res.attachment()
// Content-Disposition: attachment

res.attachment('path/to/logo.png')
// Content-Disposition: attachment; filename="logo.png"
// Content-Type: image/png

```

### res.cookie(name, value [, options])

Sets cookie `name` to `value`. The `value` parameter may be a string or object converted to JSON.

The `options` parameter is an object that can have the following properties.

| Property | Type | Description |
| --- | --- | --- |
| `domain` | String | Domain name for the cookie. Defaults to the domain name of the app. |
| `encode` | Function | A synchronous function used for cookie value encoding. Defaults to `encodeURIComponent`. |
| `expires` | Date | Expiry date of the cookie in GMT. If not specified or set to 0, creates a session cookie. |
| `httpOnly` | Boolean | Flags the cookie to be accessible only by the web server. |
| `maxAge` | Number | Convenient option for setting the expiry time relative to the current time in milliseconds. |
| `path` | String | Path for the cookie. Defaults to “/”. |
| `partitioned` | Boolean | Indicates that the cookie should be stored using partitioned storage. See [Cookies Having Independent Partitioned State (CHIPS)](https://developer.mozilla.org/en-US/docs/Web/Privacy/Partitioned_cookies) for more details. |
| `priority` | String | Value of the “Priority” **Set-Cookie** attribute. |
| `secure` | Boolean | Marks the cookie to be used with HTTPS only. |
| `signed` | Boolean | Indicates if the cookie should be signed. |
| `sameSite` | Boolean or String | Value of the “SameSite” **Set-Cookie** attribute. More information at <https://tools.ietf.org/html/draft-ietf-httpbis-cookie-same-site-00#section-4.1.1>. |

All `res.cookie()` does is set the HTTP `Set-Cookie` header with the options provided.
Any option not specified defaults to the value stated in [RFC 6265](http://tools.ietf.org/html/rfc6265).

For example:

```
res.cookie('name', 'tobi', { domain: '.example.com', path: '/admin', secure: true })
res.cookie('rememberme', '1', { expires: new Date(Date.now() + 900000), httpOnly: true })

```

You can set multiple cookies in a single response by calling `res.cookie` multiple times, for example:

```
res
  .status(201)
  .cookie('access_token', 'Bearer ' + token, {
    expires: new Date(Date.now() + 8 * 3600000) // cookie will be removed after 8 hours
  })
  .cookie('test', 'test')
  .redirect(301, '/admin')

```

The `encode` option allows you to choose the function used for cookie value encoding.
Does not support asynchronous functions.

Example use case: You need to set a domain-wide cookie for another site in your organization.
This other site (not under your administrative control) does not use URI-encoded cookie values.

```
// Default encoding
res.cookie('some_cross_domain_cookie', 'http://mysubdomain.example.com', { domain: 'example.com' })
// Result: 'some_cross_domain_cookie=http%3A%2F%2Fmysubdomain.example.com; Domain=example.com; Path=/'

// Custom encoding
res.cookie('some_cross_domain_cookie', 'http://mysubdomain.example.com', { domain: 'example.com', encode: String })
// Result: 'some_cross_domain_cookie=http://mysubdomain.example.com; Domain=example.com; Path=/;'

```

The `maxAge` option is a convenience option for setting “expires” relative to the current time in milliseconds.
The following is equivalent to the second example above.

```
res.cookie('rememberme', '1', { maxAge: 900000, httpOnly: true })

```

You can pass an object as the `value` parameter; it is then serialized as JSON and parsed by `bodyParser()` middleware.

```
res.cookie('cart', { items: [1, 2, 3] })
res.cookie('cart', { items: [1, 2, 3] }, { maxAge: 900000 })

```

When using [cookie-parser](https://www.npmjs.com/package/cookie-parser) middleware, this method also
supports signed cookies. Simply include the `signed` option set to `true`.
Then `res.cookie()` will use the secret passed to `cookieParser(secret)` to sign the value.

```
res.cookie('name', 'tobi', { signed: true })

```

Later you may access this value through the [req.signedCookie](#req.signedCookies) object.

### res.clearCookie(name [, options])

Clears the cookie specified by `name`. For details about the `options` object, see [res.cookie()](#res.cookie).

Web browsers and other compliant clients will only clear the cookie if the given
`options` is identical to those given to [res.cookie()](#res.cookie), excluding
`expires` and `maxAge`.

```
res.cookie('name', 'tobi', { path: '/admin' })
res.clearCookie('name', { path: '/admin' })

```

### res.download(path [, filename] [, options] [, fn])

Transfers the file at `path` as an “attachment”. Typically, browsers will prompt the user for download.
By default, the `Content-Disposition` header “filename=” parameter is derived from the `path` argument, but can be overridden with the `filename` parameter.
If `path` is relative, then it will be based on the current working directory of the process or
the `root` option, if provided.

This API provides access to data on the running file system. Ensure that either (a) the way in
which the `path` argument was constructed is secure if it contains user input or (b) set the `root`
option to the absolute path of a directory to contain access within.

When the `root` option is provided, Express will validate that the relative path provided as
`path` will resolve within the given `root` option.

The following table provides details on the `options` parameter.

The optional `options` argument is supported by Express v4.16.0 onwards.

| Property | Description | Default | Availability |
| --- | --- | --- | --- |
| `maxAge` | Sets the max-age property of the `Cache-Control` header in milliseconds or a string in [ms format](https://www.npmjs.org/package/ms) | 0 | 4.16+ |
| `root` | Root directory for relative filenames. |  | 4.18+ |
| `lastModified` | Sets the `Last-Modified` header to the last modified date of the file on the OS. Set `false` to disable it. | Enabled | 4.16+ |
| `headers` | Object containing HTTP headers to serve with the file. The header `Content-Disposition` will be overridden by the `filename` argument. |  | 4.16+ |
| `dotfiles` | Option for serving dotfiles. Possible values are “allow”, “deny”, “ignore”. | “ignore” | 4.16+ |
| `acceptRanges` | Enable or disable accepting ranged requests. | `true` | 4.16+ |
| `cacheControl` | Enable or disable setting `Cache-Control` response header. | `true` | 4.16+ |
| `immutable` | Enable or disable the `immutable` directive in the `Cache-Control` response header. If enabled, the `maxAge` option should also be specified to enable caching. The `immutable` directive will prevent supported clients from making conditional requests during the life of the `maxAge` option to check if the file has changed. | `false` | 4.16+ |

The method invokes the callback function `fn(err)` when the transfer is complete
or when an error occurs. If the callback function is specified and an error occurs,
the callback function must explicitly handle the response process either by
ending the request-response cycle, or by passing control to the next route.

```
res.download('/report-12345.pdf')

res.download('/report-12345.pdf', 'report.pdf')

res.download('/report-12345.pdf', 'report.pdf', function (err) {
  if (err) {
    // Handle error, but keep in mind the response may be partially-sent
    // so check res.headersSent
  } else {
    // decrement a download credit, etc.
  }
})

```

### res.end([data[, encoding]][, callback])

Ends the response process. This method actually comes from Node core, specifically the [response.end() method of http.ServerResponse](https://nodejs.org/api/http.html#responseenddata-encoding-callback).

Use to quickly end the response without any data. If you need to respond with data, instead use methods such as [res.send()](#res.send) and [res.json()](#res.json).

```
res.end()
res.status(404).end()

```

### res.format(object)

Performs content-negotiation on the `Accept` HTTP header on the request object, when present.
It uses [req.accepts()](#req.accepts) to select a handler for the request, based on the acceptable
types ordered by their quality values. If the header is not specified, the first callback is invoked.
When no match is found, the server responds with 406 “Not Acceptable”, or invokes the `default` callback.

The `Content-Type` response header is set when a callback is selected. However, you may alter
this within the callback using methods such as `res.set()` or `res.type()`.

The following example would respond with `{ "message": "hey" }` when the `Accept` header field is set
to “application/json” or “\*/json” (however if it is “\*/\*”, then the response will be “hey”).

```
res.format({
  'text/plain': function () {
    res.send('hey')
  },

  'text/html': function () {
    res.send('<p>hey</p>')
  },

  'application/json': function () {
    res.send({ message: 'hey' })
  },

  default: function () {
    // log the request and respond with 406
    res.status(406).send('Not Acceptable')
  }
})

```

In addition to canonicalized MIME types, you may also use extension names mapped
to these types for a slightly less verbose implementation:

```
res.format({
  text: function () {
    res.send('hey')
  },

  html: function () {
    res.send('<p>hey</p>')
  },

  json: function () {
    res.send({ message: 'hey' })
  }
})

```

### res.get(field)

Returns the HTTP response header specified by `field`.
The match is case-insensitive.

```
res.get('Content-Type')
// => "text/plain"

```

### res.json([body])

Sends a JSON response. This method sends a response (with the correct content-type) that is the parameter converted to a
JSON string using [JSON.stringify()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify).

The parameter can be any JSON type, including object, array, string, Boolean, number, or null,
and you can also use it to convert other values to JSON.

```
res.json(null)
res.json({ user: 'tobi' })
res.status(500).json({ error: 'message' })

```

### res.jsonp([body])

Sends a JSON response with JSONP support. This method is identical to `res.json()`,
except that it opts-in to JSONP callback support.

```
res.jsonp(null)
// => callback(null)

res.jsonp({ user: 'tobi' })
// => callback({ "user": "tobi" })

res.status(500).jsonp({ error: 'message' })
// => callback({ "error": "message" })

```

By default, the JSONP callback name is simply `callback`. Override this with the
[jsonp callback name](#app.settings.table) setting.

The following are some examples of JSONP responses using the same code:

```
// ?callback=foo
res.jsonp({ user: 'tobi' })
// => foo({ "user": "tobi" })

app.set('jsonp callback name', 'cb')

// ?cb=foo
res.status(500).jsonp({ error: 'message' })
// => foo({ "error": "message" })

```

### res.links(links)

Joins the `links` provided as properties of the parameter to populate the response’s
`Link` HTTP header field.

For example, the following call:

```
res.links({
  next: 'http://api.example.com/users?page=2',
  last: 'http://api.example.com/users?page=5'
})

```

Yields the following results:

```
Link: <http://api.example.com/users?page=2>; rel="next",
      <http://api.example.com/users?page=5>; rel="last"

```

### res.location(path)

Sets the response `Location` HTTP header to the specified `path` parameter.

```
res.location('/foo/bar')
res.location('http://example.com')
res.location('back')

```

A `path` value of “back” has a special meaning, it refers to the URL specified in the `Referer` header of the request. If the `Referer` header was not specified, it refers to “/”.

See also [Security best practices: Prevent open redirect
vulnerabilities](http://expressjs.com/en/advanced/best-practice-security.html#prevent-open-redirects).

After encoding the URL, if not encoded already, Express passes the specified URL to the browser in the `Location` header,
without any validation.

Browsers take the responsibility of deriving the intended URL from the current URL
or the referring URL, and the URL specified in the `Location` header; and redirect the user accordingly.

### res.redirect([status,] path)

Redirects to the URL derived from the specified `path`, with specified `status`, a positive integer
that corresponds to an [HTTP status code](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) .
If not specified, `status` defaults to “302 “Found”.

```
res.redirect('/foo/bar')
res.redirect('http://example.com')
res.redirect(301, 'http://example.com')
res.redirect('../login')

```

Redirects can be a fully-qualified URL for redirecting to a different site:

```
res.redirect('http://google.com')

```

Redirects can be relative to the root of the host name. For example, if the
application is on `http://example.com/admin/post/new`, the following
would redirect to the URL `http://example.com/admin`:

```
res.redirect('/admin')

```

Redirects can be relative to the current URL. For example,
from `http://example.com/blog/admin/` (notice the trailing slash), the following
would redirect to the URL `http://example.com/blog/admin/post/new`.

```
res.redirect('post/new')

```

Redirecting to `post/new` from `http://example.com/blog/admin` (no trailing slash),
will redirect to `http://example.com/blog/post/new`.

If you found the above behavior confusing, think of path segments as directories
(with trailing slashes) and files, it will start to make sense.

Path-relative redirects are also possible. If you were on
`http://example.com/admin/post/new`, the following would redirect to
`http://example.com/admin/post`:

```
res.redirect('..')

```

A `back` redirection redirects the request back to the [referer](http://en.wikipedia.org/wiki/HTTP_referer),
defaulting to `/` when the referer is missing.

```
res.redirect('back')

```

See also [Security best practices: Prevent open redirect
vulnerabilities](http://expressjs.com/en/advanced/best-practice-security.html#prevent-open-redirects).

### res.render(view [, locals] [, callback])

Renders a `view` and sends the rendered HTML string to the client.
Optional parameters:

* `locals`, an object whose properties define local variables for the view.
* `callback`, a callback function. If provided, the method returns both the possible error and rendered string, but does not perform an automated response. When an error occurs, the method invokes `next(err)` internally.

The `view` argument is a string that is the file path of the view file to render. This can be an absolute path, or a path relative to the `views` setting. If the path does not contain a file extension, then the `view engine` setting determines the file extension. If the path does contain a file extension, then Express will load the module for the specified template engine (via `require()`) and render it using the loaded module’s `__express` function.

For more information, see [Using template engines with Express](/en/guide/using-template-engines.html).

The `view` argument performs file system operations like reading a file from
disk and evaluating Node.js modules, and as so for security reasons should not
contain input from the end-user.

The `locals` object is used by view engines to render a response. The object
keys may be particularly sensitive and should not contain user-controlled
input, as it may affect the operation of the view engine or provide a path to
cross-site scripting. Consult the documentation for the used view engine for
additional considerations.

The local variable `cache` enables view caching. Set it to `true`,
to cache the view during development; view caching is enabled in production by default.

```
// send the rendered view to the client
res.render('index')

// if a callback is specified, the rendered HTML string has to be sent explicitly
res.render('index', function (err, html) {
  res.send(html)
})

// pass a local variable to the view
res.render('user', { name: 'Tobi' }, function (err, html) {
  // ...
})

```

### res.req

This property holds a reference to the [request object](#req)
that relates to this response object.

### res.send([body])

Sends the HTTP response.

The `body` parameter can be a `Buffer` object, a `String`, an object, `Boolean`, or an `Array`.
For example:

```
res.send(Buffer.from('whoop'))
res.send({ some: 'json' })
res.send('<p>some html</p>')
res.status(404).send('Sorry, we cannot find that!')
res.status(500).send({ error: 'something blew up' })

```

This method performs many useful tasks for simple non-streaming responses:
For example, it automatically assigns the `Content-Length` HTTP response header field
(unless previously defined) and provides automatic HEAD and HTTP cache freshness support.

When the parameter is a `Buffer` object, the method sets the `Content-Type`
response header field to “application/octet-stream”, unless previously defined as shown below:

```
res.set('Content-Type', 'text/html')
res.send(Buffer.from('<p>some html</p>'))

```

When the parameter is a `String`, the method sets the `Content-Type` to “text/html”:

```
res.send('<p>some html</p>')

```

When the parameter is an `Array` or `Object`, Express responds with the JSON representation:

```
res.send({ user: 'tobi' })
res.send([1, 2, 3])

```

### res.sendFile(path [, options] [, fn])

`res.sendFile()` is supported by Express v4.8.0 onwards.

Transfers the file at the given `path`. Sets the `Content-Type` response HTTP header field
based on the filename’s extension. Unless the `root` option is set in
the options object, `path` must be an absolute path to the file.

This API provides access to data on the running file system. Ensure that either (a) the way in
which the `path` argument was constructed into an absolute path is secure if it contains user
input or (b) set the `root` option to the absolute path of a directory to contain access within.

When the `root` option is provided, the `path` argument is allowed to be a relative path,
including containing `..`. Express will validate that the relative path provided as `path` will
resolve within the given `root` option.

The following table provides details on the `options` parameter.

| Property | Description | Default | Availability |
| --- | --- | --- | --- |
| `maxAge` | Sets the max-age property of the `Cache-Control` header in milliseconds or a string in [ms format](https://www.npmjs.org/package/ms) | 0 |  |
| `root` | Root directory for relative filenames. |  |  |
| `lastModified` | Sets the `Last-Modified` header to the last modified date of the file on the OS. Set `false` to disable it. | Enabled | 4.9.0+ |
| `headers` | Object containing HTTP headers to serve with the file. |  |  |
| `dotfiles` | Option for serving dotfiles. Possible values are “allow”, “deny”, “ignore”. | “ignore” |  |
| `acceptRanges` | Enable or disable accepting ranged requests. | `true` | 4.14+ |
| `cacheControl` | Enable or disable setting `Cache-Control` response header. | `true` | 4.14+ |
| `immutable` | Enable or disable the `immutable` directive in the `Cache-Control` response header. If enabled, the `maxAge` option should also be specified to enable caching. The `immutable` directive will prevent supported clients from making conditional requests during the life of the `maxAge` option to check if the file has changed. | `false` | 4.16+ |

The method invokes the callback function `fn(err)` when the transfer is complete
or when an error occurs. If the callback function is specified and an error occurs,
the callback function must explicitly handle the response process either by
ending the request-response cycle, or by passing control to the next route.

Here is an example of using `res.sendFile` with all its arguments.

```
app.get('/file/:name', function (req, res, next) {
  var options = {
    root: path.join(__dirname, 'public'),
    dotfiles: 'deny',
    headers: {
      'x-timestamp': Date.now(),
      'x-sent': true
    }
  }

  var fileName = req.params.name
  res.sendFile(fileName, options, function (err) {
    if (err) {
      next(err)
    } else {
      console.log('Sent:', fileName)
    }
  })
})

```

The following example illustrates using
`res.sendFile` to provide fine-grained support for serving files:

```
app.get('/user/:uid/photos/:file', function (req, res) {
  var uid = req.params.uid
  var file = req.params.file

  req.user.mayViewFilesFrom(uid, function (yes) {
    if (yes) {
      res.sendFile('/uploads/' + uid + '/' + file)
    } else {
      res.status(403).send("Sorry! You can't see that.")
    }
  })
})

```

For more information, or if you have issues or concerns, see [send](https://github.com/pillarjs/send).

### res.sendStatus(statusCode)

Sets the response HTTP status code to `statusCode` and sends the registered status message as the text response body. If an unknown status code is specified, the response body will just be the code number.

```
res.sendStatus(404)

```

Some versions of Node.js will throw when `res.statusCode` is set to an
invalid HTTP status code (outside of the range `100` to `599`). Consult
the HTTP server documentation for the Node.js version being used.

[More about HTTP Status Codes](https://en.wikipedia.org/wiki/List_of_HTTP_status_codes)

### res.set(field [, value])

Sets the response’s HTTP header `field` to `value`.
To set multiple fields at once, pass an object as the parameter.

```
res.set('Content-Type', 'text/plain')

res.set({
  'Content-Type': 'text/plain',
  'Content-Length': '123',
  ETag: '12345'
})

```

Aliased as `res.header(field [, value])`.

### res.status(code)

Sets the HTTP status for the response.
It is a chainable alias of Node’s [response.statusCode](http://nodejs.org/api/http.html#http_response_statuscode).

```
res.status(403).end()
res.status(400).send('Bad Request')
res.status(404).sendFile('/absolute/path/to/404.png')

```

### res.type(type)

Sets the `Content-Type` HTTP header to the MIME type as determined by the specified `type`. If `type` contains the “/” character, then it sets the `Content-Type` to the exact value of `type`, otherwise it is assumed to be a file extension and the MIME type is looked up in a mapping using the `express.static.mime.lookup()` method.

```
res.type('.html')
// => 'text/html'
res.type('html')
// => 'text/html'
res.type('json')
// => 'application/json'
res.type('application/json')
// => 'application/json'
res.type('png')
// => 'image/png'

```

### res.vary(field)

Adds the field to the `Vary` response header, if it is not there already.

```
res.vary('User-Agent').render('docs')

```
## Router

A `router` object is an instance of middleware and routes. You can think of it
as a “mini-application,” capable only of performing middleware and routing
functions. Every Express application has a built-in app router.

A router behaves like middleware itself, so you can use it as an argument to
[app.use()](#app.use) or as the argument to another router’s [use()](#router.use) method.

The top-level `express` object has a [Router()](#express.router) method that creates a new `router` object.

Once you’ve created a router object, you can add middleware and HTTP method routes (such as `get`, `put`, `post`,
and so on) to it just like an application. For example:

```
// invoked for any requests passed to this router
router.use(function (req, res, next) {
  // .. some logic here .. like any other middleware
  next()
})

// will handle any request that ends in /events
// depends on where the router is "use()'d"
router.get('/events', function (req, res, next) {
  // ..
})

```

You can then use a router for a particular root URL in this way separating your routes into files or even mini-apps.

```
// only requests to /calendar/* will be sent to our "router"
app.use('/calendar', router)

```

Keep in mind that any middleware applied to a router will run for all requests on that router’s path, even those that aren’t part of the router.

### Methods

### router.all(path, [callback, ...] callback)

This method is just like the `router.METHOD()` methods, except that it matches all HTTP methods (verbs).

This method is extremely useful for
mapping “global” logic for specific path prefixes or arbitrary matches.
For example, if you placed the following route at the top of all other
route definitions, it would require that all routes from that point on
would require authentication, and automatically load a user. Keep in mind
that these callbacks do not have to act as end points; `loadUser`
can perform a task, then call `next()` to continue matching subsequent
routes.

```
router.all('*', requireAuthentication, loadUser)

```

Or the equivalent:

```
router.all('*', requireAuthentication)
router.all('*', loadUser)

```

Another example of this is white-listed “global” functionality. Here
the example is much like before, but it only restricts paths prefixed with
“/api”:

```
router.all('/api/*', requireAuthentication)

```

### router.METHOD(path, [callback, ...] callback)

The `router.METHOD()` methods provide the routing functionality in Express,
where METHOD is one of the HTTP methods, such as GET, PUT, POST, and so on,
in lowercase. Thus, the actual methods are `router.get()`, `router.post()`,
`router.put()`, and so on.

The `router.get()` function is automatically called for the HTTP `HEAD` method in
addition to the `GET` method if `router.head()` was not called for the
path before `router.get()`.

You can provide multiple callbacks, and all are treated equally, and behave just
like middleware, except that these callbacks may invoke `next('route')`
to bypass the remaining route callback(s). You can use this mechanism to perform
pre-conditions on a route then pass control to subsequent routes when there is no
reason to proceed with the route matched.

The following snippet illustrates the most simple route definition possible.
Express translates the path strings to regular expressions, used internally
to match incoming requests. Query strings are *not* considered when performing
these matches, for example “GET /” would match the following route, as would
“GET /?name=tobi”.

```
router.get('/', function (req, res) {
  res.send('hello world')
})

```

You can also use regular expressions—useful if you have very specific
constraints, for example the following would match “GET /commits/71dbb9c” as well
as “GET /commits/71dbb9c..4c084f9”.

```
router.get(/^\/commits\/(\w+)(?:\.\.(\w+))?$/, function (req, res) {
  var from = req.params[0]
  var to = req.params[1] || 'HEAD'
  res.send('commit range ' + from + '..' + to)
})

```

### router.param(name, callback)

Adds callback triggers to route parameters, where `name` is the name of the parameter and `callback` is the callback function. Although `name` is technically optional, using this method without it is deprecated starting with Express v4.11.0 (see below).

The parameters of the callback function are:

* `req`, the request object.
* `res`, the response object.
* `next`, indicating the next middleware function.
* The value of the `name` parameter.
* The name of the parameter.

Unlike `app.param()`, `router.param()` does not accept an array of route parameters.

For example, when `:user` is present in a route path, you may map user loading logic to automatically provide `req.user` to the route, or perform validations on the parameter input.

```
router.param('user', function (req, res, next, id) {
  // try to get the user details from the User model and attach it to the request object
  User.find(id, function (err, user) {
    if (err) {
      next(err)
    } else if (user) {
      req.user = user
      next()
    } else {
      next(new Error('failed to load user'))
    }
  })
})

```

Param callback functions are local to the router on which they are defined. They are not inherited by mounted apps or routers, nor are they triggered for route parameters inherited from parent routers. Hence, param callbacks defined on `router` will be triggered only by route parameters defined on `router` routes.

A param callback will be called only once in a request-response cycle, even if the parameter is matched in multiple routes, as shown in the following examples.

```
router.param('id', function (req, res, next, id) {
  console.log('CALLED ONLY ONCE')
  next()
})

router.get('/user/:id', function (req, res, next) {
  console.log('although this matches')
  next()
})

router.get('/user/:id', function (req, res) {
  console.log('and this matches too')
  res.end()
})

```

On `GET /user/42`, the following is printed:

```
CALLED ONLY ONCE
although this matches
and this matches too

```

The following section describes `router.param(callback)`, which is deprecated as of v4.11.0.

The behavior of the `router.param(name, callback)` method can be altered entirely by passing only a function to `router.param()`. This function is a custom implementation of how `router.param(name, callback)` should behave - it accepts two parameters and must return a middleware.

The first parameter of this function is the name of the URL parameter that should be captured, the second parameter can be any JavaScript object which might be used for returning the middleware implementation.

The middleware returned by the function decides the behavior of what happens when a URL parameter is captured.

In this example, the `router.param(name, callback)` signature is modified to `router.param(name, accessId)`. Instead of accepting a name and a callback, `router.param()` will now accept a name and a number.

```
var express = require('express')
var app = express()
var router = express.Router()

// customizing the behavior of router.param()
router.param(function (param, option) {
  return function (req, res, next, val) {
    if (val === option) {
      next()
    } else {
      res.sendStatus(403)
    }
  }
})

// using the customized router.param()
router.param('id', '1337')

// route to trigger the capture
router.get('/user/:id', function (req, res) {
  res.send('OK')
})

app.use(router)

app.listen(3000, function () {
  console.log('Ready')
})

```

In this example, the `router.param(name, callback)` signature remains the same, but instead of a middleware callback, a custom data type checking function has been defined to validate the data type of the user id.

```
router.param(function (param, validator) {
  return function (req, res, next, val) {
    if (validator(val)) {
      next()
    } else {
      res.sendStatus(403)
    }
  }
})

router.param('id', function (candidate) {
  return !isNaN(parseFloat(candidate)) && isFinite(candidate)
})

```

### router.route(path)

Returns an instance of a single route which you can then use to handle HTTP verbs
with optional middleware. Use `router.route()` to avoid duplicate route naming and
thus typing errors.

Building on the `router.param()` example above, the following code shows how to use
`router.route()` to specify various HTTP method handlers.

```
var router = express.Router()

router.param('user_id', function (req, res, next, id) {
  // sample user, would actually fetch from DB, etc...
  req.user = {
    id: id,
    name: 'TJ'
  }
  next()
})

router.route('/users/:user_id')
  .all(function (req, res, next) {
    // runs for all HTTP verbs first
    // think of it as route specific middleware!
    next()
  })
  .get(function (req, res, next) {
    res.json(req.user)
  })
  .put(function (req, res, next) {
    // just an example of maybe updating the user
    req.user.name = req.params.name
    // save user ... etc
    res.json(req.user)
  })
  .post(function (req, res, next) {
    next(new Error('not implemented'))
  })
  .delete(function (req, res, next) {
    next(new Error('not implemented'))
  })

```

This approach re-uses the single `/users/:user_id` path and adds handlers for
various HTTP methods.

 Note

When you use `router.route()`, middleware ordering is based on when the *route* is created, not when method handlers are added to the route. For this purpose, you can consider method handlers to belong to the route to which they were added.

### router.use([path], [function, ...] function)

Uses the specified middleware function or functions, with optional mount path `path`, that defaults to “/”.

This method is similar to [app.use()](#app.use). A simple example and use case is described below.
See [app.use()](#app.use) for more information.

Middleware is like a plumbing pipe: requests start at the first middleware function defined
and work their way “down” the middleware stack processing for each path they match.

```
var express = require('express')
var app = express()
var router = express.Router()

// simple logger for this router's requests
// all requests to this router will first hit this middleware
router.use(function (req, res, next) {
  console.log('%s %s %s', req.method, req.url, req.path)
  next()
})

// this will only be invoked if the path starts with /bar from the mount point
router.use('/bar', function (req, res, next) {
  // ... maybe some additional /bar logging ...
  next()
})

// always invoked
router.use(function (req, res, next) {
  res.send('Hello World')
})

app.use('/foo', router)

app.listen(3000)

```

The “mount” path is stripped and is *not* visible to the middleware function.
The main effect of this feature is that a mounted middleware function may operate without
code changes regardless of its “prefix” pathname.

The order in which you define middleware with `router.use()` is very important.
They are invoked sequentially, thus the order defines middleware precedence. For example,
usually a logger is the very first middleware you would use, so that every request gets logged.

```
var logger = require('morgan')
var path = require('path')

router.use(logger())
router.use(express.static(path.join(__dirname, 'public')))
router.use(function (req, res) {
  res.send('Hello')
})

```

Now suppose you wanted to ignore logging requests for static files, but to continue
logging routes and middleware defined after `logger()`. You would simply move the call to `express.static()` to the top,
before adding the logger middleware:

```
router.use(express.static(path.join(__dirname, 'public')))
router.use(logger())
router.use(function (req, res) {
  res.send('Hello')
})

```

Another example is serving files from multiple directories,
giving precedence to “./public” over the others:

```
router.use(express.static(path.join(__dirname, 'public')))
router.use(express.static(path.join(__dirname, 'files')))
router.use(express.static(path.join(__dirname, 'uploads')))

```

The `router.use()` method also supports named parameters so that your mount points
for other routers can benefit from preloading using named parameters.

**NOTE**: Although these middleware functions are added via a particular router, *when*
they run is defined by the path they are attached to (not the router). Therefore,
middleware added via one router may run for other routers if its routes
match. For example, this code shows two different routers mounted on the same path:

```
var authRouter = express.Router()
var openRouter = express.Router()

authRouter.use(require('./authenticate').basic(usersdb))

authRouter.get('/:user_id/edit', function (req, res, next) {
  // ... Edit user UI ...
})
openRouter.get('/', function (req, res, next) {
  // ... List users ...
})
openRouter.get('/:user_id', function (req, res, next) {
  // ... View user ...
})

app.use('/users', authRouter)
app.use('/users', openRouter)

```

Even though the authentication middleware was added via the `authRouter` it will run on the routes defined by the `openRouter` as well since both routers were mounted on `/users`. To avoid this behavior, use different paths for each router.

![](/images/arrow.png)
Documentation translations provided by StrongLoop/IBM:
[French](/fr/), [German](/de/), [Spanish](/es/), [Italian](/it/), [Japanese](/ja/), [Russian](/ru/), [Chinese](/zh-cn/), [Traditional Chinese](/zh-tw/), [Korean](/ko/), [Portuguese](/pt-br/).

Community translation available for: [Slovak](/sk/), [Ukrainian](/uk/), [Uzbek](/uz/), [Turkish](/tr/), [Thai](/th/) and [Indonesian](/id/).

[![OpenJS Foundation](https://raw.githubusercontent.com/openjs-foundation/artwork/main/openjs_foundation/openjs_foundation-logo-horizontal-color.svg)](https://openjsf.org/)
[Terms of Use](https://terms-of-use.openjsf.org)
[Privacy Policy](https://privacy-policy.openjsf.org)
[Code of Conduct](https://github.com/expressjs/express/blob/master/Code-Of-Conduct.md)
[Trademark Policy](https://trademark-policy.openjsf.org)
[Security Policy](https://github.com/expressjs/express/security/policy)
[License](https://github.com/expressjs/express/blob/master/LICENSE)

[![Preview Deploys by Netlify](https://www.netlify.com/v3/img/components/netlify-color-accent.svg)](https://www.netlify.com)



=== Content from github.com_009ace16_20250111_204922.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fkoa%2Fissues%2F1800)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fkoa%2Fissues%2F1800)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=koajs%2Fkoa)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[koajs](/koajs)
/
**[koa](/koajs/koa)**
Public

* [Notifications](/login?return_to=%2Fkoajs%2Fkoa) You must be signed in to change notification settings
* [Fork
  3.2k](/login?return_to=%2Fkoajs%2Fkoa)
* [Star
   35.3k](/login?return_to=%2Fkoajs%2Fkoa)

* [Code](/koajs/koa)
* [Issues
  19](/koajs/koa/issues)
* [Pull requests
  11](/koajs/koa/pulls)
* [Discussions](/koajs/koa/discussions)
* [Actions](/koajs/koa/actions)
* [Wiki](/koajs/koa/wiki)
* [Security](/koajs/koa/security)
* [Insights](/koajs/koa/pulse)

Additional navigation options

* [Code](/koajs/koa)
* [Issues](/koajs/koa/issues)
* [Pull requests](/koajs/koa/pulls)
* [Discussions](/koajs/koa/discussions)
* [Actions](/koajs/koa/actions)
* [Wiki](/koajs/koa/wiki)
* [Security](/koajs/koa/security)
* [Insights](/koajs/koa/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fkoajs%2Fkoa%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fkoajs%2Fkoa%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# if "\@" in url ，the redirect result doesn't match the host of the new URL() #1800

Closed

[FDrag0n](/FDrag0n) opened this issue
Jan 17, 2024
· 2 comments
 · Fixed by [#1803](https://github.com/koajs/koa/pull/1803) or [#1804](https://github.com/koajs/koa/pull/1804)

Closed

# [if "\@" in url ，the redirect result doesn't match the host of the new URL()](#top) #1800

[FDrag0n](/FDrag0n) opened this issue
Jan 17, 2024
· 2 comments
 · Fixed by [#1803](https://github.com/koajs/koa/pull/1803) or [#1804](https://github.com/koajs/koa/pull/1804)

Assignees
[![@fengmk2](https://avatars.githubusercontent.com/u/156269?s=40&v=4)](/fengmk2)

Labels
[bug](/koajs/koa/labels/bug)

## Comments

[![@FDrag0n](https://avatars.githubusercontent.com/u/34733637?s=80&u=2848bcc9179a55d4f4bcb5f259e101c587aaca12&v=4)](/FDrag0n)

Copy link

Contributor

### **[FDrag0n](/FDrag0n)** commented [Jan 17, 2024](#issue-2085314029) • edited Loading

| [koa/lib/response.js](https://github.com/koajs/koa/blob/5f159415e58c42b54cb0703d7cfb10870d33d65f/lib/response.js#L269)  Line 269 in [5f15941](/koajs/koa/commit/5f159415e58c42b54cb0703d7cfb10870d33d65f)   |  | this.set('Location', encodeUrl(url)) | | --- | --- |     [image](https://private-user-images.githubusercontent.com/34733637/297249162-46c9d2dc-74a2-4e4a-bf94-d3e2e822004e.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2Mjg4NjIsIm5iZiI6MTczNjYyODU2MiwicGF0aCI6Ii8zNDczMzYzNy8yOTcyNDkxNjItNDZjOWQyZGMtNzRhMi00ZTRhLWJmOTQtZDNlMmU4MjIwMDRlLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTExVDIwNDkyMlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWRmYWViNGNhZWFkMzZhODcyYTdkZGUwNmU3MmJkMjU5ZmZlM2U3ZTVmY2UwNDZiODU2YzExZDE3MmRhYmMzZjYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.qkLarh2GB0QFVlhIDBxhWsUa5UQPMGlbMmCUOf3Al48) Developer often use `new URL()` `host` to verify the redirected url, but here the `encodeurl` will cause the host verification to fail, thus creating a URL hopping vulnerability |
| --- | --- | --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@FDrag0n](https://avatars.githubusercontent.com/u/34733637?s=80&u=2848bcc9179a55d4f4bcb5f259e101c587aaca12&v=4)](/FDrag0n)

Copy link

Contributor

Author

### **[FDrag0n](/FDrag0n)** commented [Jan 17, 2024](#issuecomment-1894880250)

| [image](https://private-user-images.githubusercontent.com/34733637/297251599-dfd3946f-5aef-4c1b-9ffa-cb63ad3d2487.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2Mjg4NjIsIm5iZiI6MTczNjYyODU2MiwicGF0aCI6Ii8zNDczMzYzNy8yOTcyNTE1OTktZGZkMzk0NmYtNWFlZi00YzFiLTlmZmEtY2I2M2FkM2QyNDg3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTExVDIwNDkyMlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTFjNmVhYWE3ODRmMzExNmFiM2I0Mzc3MWJmN2ViZjJmYWRhZWI4Y2NjZGI2YWU3ZDIyODRkZjYwZjRjMjMyNzQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.dgW-K_wgq1-j0c3JT1m5-nOOng7Ij5FbtFBFeFDrUgw) |
| --- |

All reactions

Sorry, something went wrong.

[![@fengmk2](https://avatars.githubusercontent.com/u/156269?s=40&v=4)](/fengmk2)
[fengmk2](/fengmk2)
mentioned this issue
[Mar 15, 2024](#ref-pullrequest-2187829835)

[fix: formatting redirect url on http(s) protocol url
#1803](/koajs/koa/pull/1803)
 Merged

[![@fengmk2](https://avatars.githubusercontent.com/u/156269?s=40&v=4)](/fengmk2)
[fengmk2](/fengmk2)
linked a pull request
[Mar 15, 2024](#event-12127339096)
that will
close
this issue

[fix: formatting redirect url on http(s) protocol url
#1803](/koajs/koa/pull/1803)
 Merged

[![@fengmk2](https://avatars.githubusercontent.com/u/156269?s=40&v=4)](/fengmk2)
[fengmk2](/fengmk2)
self-assigned this
[Mar 15, 2024](#event-12127341086)

[![@fengmk2](https://avatars.githubusercontent.com/u/156269?s=40&v=4)](/fengmk2)
[fengmk2](/fengmk2)
added
the
[bug](/koajs/koa/labels/bug)
label
[Mar 15, 2024](#event-12127341601)

[fengmk2](/fengmk2)
added a commit
that referenced
this issue
[Mar 15, 2024](#ref-commit-926243b)
[![@fengmk2](https://avatars.githubusercontent.com/u/156269?s=40&v=4)](/fengmk2)

`[fix: formatting redirect url on http(s) protocol url](/koajs/koa/commit/926243bd3683ca1daf592665b7a3512bc148d3e3 "fix: formatting redirect url on http(s) protocol url

closes https://github.com/koajs/koa/issues/1800

pick from https://github.com/koajs/koa/pull/1803")`
…

`[926243b](/koajs/koa/commit/926243bd3683ca1daf592665b7a3512bc148d3e3)`

```
closes [#1800](https://github.com/koajs/koa/issues/1800)

pick from [#1803](https://github.com/koajs/koa/pull/1803)
```

[![@fengmk2](https://avatars.githubusercontent.com/u/156269?s=40&v=4)](/fengmk2)
[fengmk2](/fengmk2)
mentioned this issue
[Mar 15, 2024](#ref-pullrequest-2187874232)

[fix: formatting redirect url on http(s) protocol url
#1804](/koajs/koa/pull/1804)
 Merged

[![@fengmk2](https://avatars.githubusercontent.com/u/156269?s=40&v=4)](/fengmk2)
[fengmk2](/fengmk2)
closed this as [completed](/koajs/koa/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#1804](/koajs/koa/pull/1804)
[Mar 15, 2024](#event-12127599887)

[fengmk2](/fengmk2)
added a commit
that referenced
this issue
[Mar 15, 2024](#ref-commit-435534a)
[![@fengmk2](https://avatars.githubusercontent.com/u/156269?s=40&v=4)](/fengmk2)

`[fix: formatting redirect url on http(s) protocol url (](/koajs/koa/commit/435534aa08afd7749b121664f5ab2b54421b276e "fix: formatting redirect url on http(s) protocol url (#1804)

closes https://github.com/koajs/koa/issues/1800

pick from https://github.com/koajs/koa/pull/1803")[#1804](https://github.com/koajs/koa/pull/1804)[)](/koajs/koa/commit/435534aa08afd7749b121664f5ab2b54421b276e "fix: formatting redirect url on http(s) protocol url (#1804)

closes https://github.com/koajs/koa/issues/1800

pick from https://github.com/koajs/koa/pull/1803")`
…

`[435534a](/koajs/koa/commit/435534aa08afd7749b121664f5ab2b54421b276e)`

```
closes [#1800](https://github.com/koajs/koa/issues/1800)

pick from [#1803](https://github.com/koajs/koa/pull/1803)
```

[![@FDrag0n](https://avatars.githubusercontent.com/u/34733637?s=80&u=2848bcc9179a55d4f4bcb5f259e101c587aaca12&v=4)](/FDrag0n)

Copy link

Contributor

Author

### **[FDrag0n](/FDrag0n)** commented [Mar 15, 2024](#issuecomment-1999090769)

| Great fix fit, thanks! |
| --- |

All reactions

Sorry, something went wrong.

This was referenced Mar 15, 2024

[[deleted]
expressjs/express#5539](/expressjs/express/pull/5539)
 Closed

[fix: handle upper case protocol like HTTP or HTTPS
#1805](/koajs/koa/pull/1805)
 Merged

[kodiakhq](/apps/kodiakhq) bot
referenced
this issue
in X-oss-byte/Nextjs
[Mar 26, 2024](#ref-commit-348d420)
[![@renovate](https://avatars.githubusercontent.com/in/2740?s=40&v=4)](/marketplace/renovate)

`[Update dependency express to v4.19.2 [SECURITY] (](/X-oss-byte/Nextjs/commit/348d42052d59894729130fa0bc9500c7298fb01f "Update dependency express to v4.19.2 [SECURITY] (#1614)

[![Mend Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/) ([source](https://togithub.com/expressjs/express)) | [`4.18.3` -> `4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.3/4.19.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |

### GitHub Vulnerability Alerts

#### [CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd
https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)
[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](https://www.mend.io/free-developer-tools/renovate/). View repository job log [here](https://developer.mend.io/github/X-oss-byte/Nextjs).")[#1614](https://github.com/X-oss-byte/Nextjs/pull/1614)[)](/X-oss-byte/Nextjs/commit/348d42052d59894729130fa0bc9500c7298fb01f "Update dependency express to v4.19.2 [SECURITY] (#1614)

[![Mend Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/) ([source](https://togithub.com/expressjs/express)) | [`4.18.3` -> `4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.3/4.19.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |

### GitHub Vulnerability Alerts

#### [CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd
https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)
[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](https://www.mend.io/free-developer-tools/renovate/). View repository job log [here](https://developer.mend.io/github/X-oss-byte/Nextjs).")`
…

`[348d420](/X-oss-byte/Nextjs/commit/348d42052d59894729130fa0bc9500c7298fb01f)`

```
[![Mend Renovate]([https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com](https://app.renovatebot.com/images/banner.svg%29%5D%28https%3A//renovatebot.com))

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](<http://expressjs.com/>) ([source](<https://togithub.com/expressjs/express>)) | [`4.18.3` -> `4.19.2`](<https://renovatebot.com/diffs/npm/express/4.18.3/4.19.2>) | [![age](<https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![adoption](<https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![passing](<https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![confidence](<https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) |

### GitHub Vulnerability Alerts

#### [[CVE-2024-29041](https://github.com/advisories/GHSA-rv95-896h-c2vc "CVE-2024-29041")](<https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc>)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](<https://togithub.com/pillarjs/encodeurl>) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

[expressjs/express@0867302](https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)
[expressjs/express@0b74695](https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)](https://github.com/expressjs/express/pull/5539%5D%28https%3A//togithub.com/expressjs/express/pull/5539%29)
[[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)](https://github.com/koajs/koa/issues/1800%5D%28https%3A//togithub.com/koajs/koa/issues/1800%29)
<https://expressjs.com/en/4x/api.html#res.location>

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.19.1...4.19.2>)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.19.0...4.19.1>)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](<https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.18.3...4.19.0>)

</details>

---

### Configuration

📅 **Schedule**: Branch creation - "" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](<https://www.mend.io/free-developer-tools/renovate/>). View repository job log [here](<https://developer.mend.io/github/X-oss-byte/Nextjs>).
```

[Brooooooklyn](/Brooooooklyn)
referenced
this issue
in toeverything/AFFiNE
[Mar 26, 2024](#ref-commit-2662ba7)
[![@renovate](https://avatars.githubusercontent.com/in/2740?s=40&v=4)](/marketplace/renovate)

`[chore: bump up express version to v4.19.2 [SECURITY] (](/toeverything/AFFiNE/commit/2662ba763c4c33419d88946db1f9121bb56cd607 "chore: bump up express version to v4.19.2 [SECURITY] (#6308)

[![Mend Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/) ([source](https://togithub.com/expressjs/express)) | [`4.18.2` -> `4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |

### GitHub Vulnerability Alerts

#### [CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd
https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)
[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

### [`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about these updates again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](https://www.mend.io/free-developer-tools/renovate/). View repository job log [here](https://developer.mend.io/github/toeverything/AFFiNE).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoiY2FuYXJ5In0=-->")[#6308](https://github.com/toeverything/AFFiNE/pull/6308)[)](/toeverything/AFFiNE/commit/2662ba763c4c33419d88946db1f9121bb56cd607 "chore: bump up express version to v4.19.2 [SECURITY] (#6308)

[![Mend Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/) ([source](https://togithub.com/expressjs/express)) | [`4.18.2` -> `4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |

### GitHub Vulnerability Alerts

#### [CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd
https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)
[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

### [`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about these updates again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](https://www.mend.io/free-developer-tools/renovate/). View repository job log [here](https://developer.mend.io/github/toeverything/AFFiNE).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoiY2FuYXJ5In0=-->")`
…

`[2662ba7](/toeverything/AFFiNE/commit/2662ba763c4c33419d88946db1f9121bb56cd607)`

```
[![Mend Renovate]([https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com](https://app.renovatebot.com/images/banner.svg%29%5D%28https%3A//renovatebot.com))

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](<http://expressjs.com/>) ([source](<https://togithub.com/expressjs/express>)) | [`4.18.2` -> `4.19.2`](<https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2>) | [![age](<https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![adoption](<https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![passing](<https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![confidence](<https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) |

### GitHub Vulnerability Alerts

#### [[CVE-2024-29041](https://github.com/advisories/GHSA-rv95-896h-c2vc "CVE-2024-29041")](<https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc>)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](<https://togithub.com/pillarjs/encodeurl>) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

[expressjs/express@0867302](https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)
[expressjs/express@0b74695](https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)](https://github.com/expressjs/express/pull/5539%5D%28https%3A//togithub.com/expressjs/express/pull/5539%29)
[[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)](https://github.com/koajs/koa/issues/1800%5D%28https%3A//togithub.com/koajs/koa/issues/1800%29)
<https://expressjs.com/en/4x/api.html#res.location>

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.19.1...4.19.2>)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.19.0...4.19.1>)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](<https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.18.3...4.19.0>)

### [`v4.18.3`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.18.2...4.18.3>)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - "" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about these updates again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](<https://www.mend.io/free-developer-tools/renovate/>). View repository job log [here](<https://developer.mend.io/github/toeverything/AFFiNE>).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoiY2FuYXJ5In0=-->
```

[renovate](/apps/renovate) bot
referenced
this issue
in Unleash/unleash
[Mar 26, 2024](#ref-commit-91b3336)
[![@renovate](https://avatars.githubusercontent.com/in/2740?s=40&v=4)](/marketplace/renovate)

`[fix(deps): update dependency express to v4.19.2 [security] (](/Unleash/unleash/commit/91b33362bd592fd237caf2fe0f8a28ccf242659b "fix(deps): update dependency express to v4.19.2 [security] (#6693)

[![Mend
Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/)
([source](https://togithub.com/expressjs/express)) | [`4.18.3` ->
`4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.3/4.19.2) |
[![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|

### GitHub Vulnerability Alerts

####
[CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd

https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)

[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" in timezone Europe/Madrid,
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update
again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](https://www.mend.io/free-developer-tools/renovate/). View
repository job log
[here](https://developer.mend.io/github/Unleash/unleash).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->

Co-authored-by: renovate[bot] <29139614+renovate[bot]@users.noreply.github.com>")[#6693](https://github.com/Unleash/unleash/pull/6693)[)](/Unleash/unleash/commit/91b33362bd592fd237caf2fe0f8a28ccf242659b "fix(deps): update dependency express to v4.19.2 [security] (#6693)

[![Mend
Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/)
([source](https://togithub.com/expressjs/express)) | [`4.18.3` ->
`4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.3/4.19.2) |
[![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|

### GitHub Vulnerability Alerts

####
[CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd

https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)

[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" in timezone Europe/Madrid,
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update
again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](https://www.mend.io/free-developer-tools/renovate/). View
repository job log
[here](https://developer.mend.io/github/Unleash/unleash).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->

Co-authored-by: renovate[bot] <29139614+renovate[bot]@users.noreply.github.com>")`
…

`[91b3336](/Unleash/unleash/commit/91b33362bd592fd237caf2fe0f8a28ccf242659b)`

```
[![Mend
Renovate]([https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com](https://app.renovatebot.com/images/banner.svg%29%5D%28https%3A//renovatebot.com))

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](<http://expressjs.com/>)
([source](<https://togithub.com/expressjs/express>)) | [`4.18.3` ->
`4.19.2`](<https://renovatebot.com/diffs/npm/express/4.18.3/4.19.2>) |
[![age](<https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![adoption](<https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![passing](<https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![confidence](<https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.3/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|

### GitHub Vulnerability Alerts

####
[[CVE-2024-29041](https://github.com/advisories/GHSA-rv95-896h-c2vc "CVE-2024-29041")](<https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc>)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](<https://togithub.com/pillarjs/encodeurl>) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

[expressjs/express@0867302](https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)

[expressjs/express@0b74695](https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)](https://github.com/expressjs/express/pull/5539%5D%28https%3A//togithub.com/expressjs/express/pull/5539%29)

[[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)](https://github.com/koajs/koa/issues/1800%5D%28https%3A//togithub.com/koajs/koa/issues/1800%29)
<https://expressjs.com/en/4x/api.html#res.location>

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.19.1...4.19.2>)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.19.0...4.19.1>)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](<https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.18.3...4.19.0>)

</details>

---

### Configuration

📅 **Schedule**: Branch creation - "" in timezone Europe/Madrid,
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update
again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](<https://www.mend.io/free-developer-tools/renovate/>). View
repository job log
[here](<https://developer.mend.io/github/Unleash/unleash>).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->

Co-authored-by: renovate[bot] <29139614+renovate[bot]@users.noreply.github.com>
```

[![@debricked](https://avatars.githubusercontent.com/in/24490?s=40&v=4)](/apps/debricked)
[debricked](/apps/debricked)
bot
mentioned this issue
[Mar 27, 2024](#ref-pullrequest-2210013386)

[Fix CVE–2024–29041
cemmenn/demo-app#1](/cemmenn/demo-app/pull/1)
 Open

[renovate](/apps/renovate) bot
referenced
this issue
in apollographql/apollo-server
[Mar 28, 2024](#ref-commit-5cf2928)
[![@renovate](https://avatars.githubusercontent.com/in/2740?s=40&v=4)](/marketplace/renovate)

`[chore(deps): update dependency express to v4.19.2 [security] (](/apollographql/apollo-server/commit/5cf29285f47a34f51d462b9653d27dd45b674f70 "chore(deps): update dependency express to v4.19.2 [security] (#7859)

[![Mend
Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/)
([source](https://togithub.com/expressjs/express)) | [`4.18.2` ->
`4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) |
[![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|

### GitHub Vulnerability Alerts

####
[CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd

https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)

[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

###
[`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" in timezone America/Los_Angeles,
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR is behind base branch, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about these
updates again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](https://www.mend.io/free-developer-tools/renovate/). View
repository job log
[here](https://developer.mend.io/github/apollographql/apollo-server).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->

Co-authored-by: renovate[bot] <29139614+renovate[bot]@users.noreply.github.com>")[#7859](https://github.com/apollographql/apollo-server/pull/7859)[)](/apollographql/apollo-server/commit/5cf29285f47a34f51d462b9653d27dd45b674f70 "chore(deps): update dependency express to v4.19.2 [security] (#7859)

[![Mend
Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/)
([source](https://togithub.com/expressjs/express)) | [`4.18.2` ->
`4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) |
[![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|

### GitHub Vulnerability Alerts

####
[CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd

https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)

[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

###
[`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" in timezone America/Los_Angeles,
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR is behind base branch, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about these
updates again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](https://www.mend.io/free-developer-tools/renovate/). View
repository job log
[here](https://developer.mend.io/github/apollographql/apollo-server).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->

Co-authored-by: renovate[bot] <29139614+renovate[bot]@users.noreply.github.com>")`
…

`[5cf2928](/apollographql/apollo-server/commit/5cf29285f47a34f51d462b9653d27dd45b674f70)`

```
[![Mend
Renovate]([https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com](https://app.renovatebot.com/images/banner.svg%29%5D%28https%3A//renovatebot.com))

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](<http://expressjs.com/>)
([source](<https://togithub.com/expressjs/express>)) | [`4.18.2` ->
`4.19.2`](<https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2>) |
[![age](<https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![adoption](<https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![passing](<https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![confidence](<https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|

### GitHub Vulnerability Alerts

####
[[CVE-2024-29041](https://github.com/advisories/GHSA-rv95-896h-c2vc "CVE-2024-29041")](<https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc>)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](<https://togithub.com/pillarjs/encodeurl>) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

[expressjs/express@0867302](https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)

[expressjs/express@0b74695](https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)](https://github.com/expressjs/express/pull/5539%5D%28https%3A//togithub.com/expressjs/express/pull/5539%29)

[[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)](https://github.com/koajs/koa/issues/1800%5D%28https%3A//togithub.com/koajs/koa/issues/1800%29)
<https://expressjs.com/en/4x/api.html#res.location>

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.19.1...4.19.2>)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.19.0...4.19.1>)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](<https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.18.3...4.19.0>)

###
[`v4.18.3`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.18.2...4.18.3>)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - "" in timezone America/Los_Angeles,
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR is behind base branch, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about these
updates again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](<https://www.mend.io/free-developer-tools/renovate/>). View
repository job log
[here](<https://developer.mend.io/github/apollographql/apollo-server>).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->

Co-authored-by: renovate[bot] <29139614+renovate[bot]@users.noreply.github.com>
```

[holtskinner](/holtskinner)
referenced
this issue
in GoogleCloudPlatform/document-ai-samples
[Mar 28, 2024](#ref-commit-4f4de06)
[![@renovate-bot](https://avatars.githubusercontent.com/u/25180681?s=40&u=52b5860ab267400de6ab46df639ef58661455321&v=4)](/renovate-bot)

`[fix(deps): update dependency express to v4.19.2 [security] (](/GoogleCloudPlatform/document-ai-samples/commit/4f4de06c668d9bc5988f9bfc810e8ee979f39e33 "fix(deps): update dependency express to v4.19.2 [security] (#776)

[![Mend
Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/)
([source](https://togithub.com/expressjs/express)) | [`4.18.2` ->
`4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) |
[![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|

### GitHub Vulnerability Alerts

####
[CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd

https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)

[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

###
[`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - At any time (no schedule defined),
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR is behind base branch, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update
again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](https://www.mend.io/free-developer-tools/renovate/). View
repository job log
[here](https://developer.mend.io/github/GoogleCloudPlatform/document-ai-samples).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->")[#776](https://github.com/GoogleCloudPlatform/document-ai-samples/pull/776)[)](/GoogleCloudPlatform/document-ai-samples/commit/4f4de06c668d9bc5988f9bfc810e8ee979f39e33 "fix(deps): update dependency express to v4.19.2 [security] (#776)

[![Mend
Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/)
([source](https://togithub.com/expressjs/express)) | [`4.18.2` ->
`4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) |
[![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|
[![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/)
|

### GitHub Vulnerability Alerts

####
[CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd

https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)

[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

###
[`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare
Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - At any time (no schedule defined),
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR is behind base branch, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update
again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](https://www.mend.io/free-developer-tools/renovate/). View
repository job log
[here](https://developer.mend.io/github/GoogleCloudPlatform/document-ai-samples).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->")`
…

`[4f4de06](/GoogleCloudPlatform/document-ai-samples/commit/4f4de06c668d9bc5988f9bfc810e8ee979f39e33)`

```
[![Mend
Renovate]([https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com](https://app.renovatebot.com/images/banner.svg%29%5D%28https%3A//renovatebot.com))

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](<http://expressjs.com/>)
([source](<https://togithub.com/expressjs/express>)) | [`4.18.2` ->
`4.19.2`](<https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2>) |
[![age](<https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![adoption](<https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![passing](<https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|
[![confidence](<https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>)
|

### GitHub Vulnerability Alerts

####
[[CVE-2024-29041](https://github.com/advisories/GHSA-rv95-896h-c2vc "CVE-2024-29041")](<https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc>)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta
versions before 5.0.0-beta.3 are affected by an open redirect
vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL
Express performs an encode [using
`encodeurl`](<https://togithub.com/pillarjs/encodeurl>) on the contents
before passing it to the `location` header. This can cause malformed
URLs to be evaluated in unexpected ways by common redirect allow list
implementations in Express applications, leading to an Open Redirect via
bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called
from within `res.redirect()`.

### Patches

[expressjs/express@0867302](https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)

[expressjs/express@0b74695](https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

An initial fix went out with `express@4.19.0`, we then patched a feature
regression in `4.19.1` and added improved handling for the bypass in
`4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either
`require('node:url').parse` or `new URL`. These are steps you can take
on your own before passing the user input string to `res.location` or
`res.redirect`.

### References

[[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)](https://github.com/expressjs/express/pull/5539%5D%28https%3A//togithub.com/expressjs/express/pull/5539%29)

[[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)](https://github.com/koajs/koa/issues/1800%5D%28https%3A//togithub.com/koajs/koa/issues/1800%29)
<https://expressjs.com/en/4x/api.html#res.location>

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

###
[`v4.19.2`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.19.1...4.19.2>)

\==========

-   Improved fix for open redirect allow list bypass

###
[`v4.19.1`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.19.0...4.19.1>)

\==========

- Allow passing non-strings to res.location with new encoding handling
checks

###
[`v4.19.0`](<https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.18.3...4.19.0>)

###
[`v4.18.3`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26>)

[Compare
Source](<https://togithub.com/expressjs/express/compare/4.18.2...4.18.3>)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - At any time (no schedule defined),
Automerge - At any time (no schedule defined).

🚦 **Automerge**: Enabled.

♻ **Rebasing**: Whenever PR is behind base branch, or you tick the
rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update
again.

---

- [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check
this box

---

This PR has been generated by [Mend
Renovate](<https://www.mend.io/free-developer-tools/renovate/>). View
repository job log
[here](<https://developer.mend.io/github/GoogleCloudPlatform/document-ai-samples>).

<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjI2OS4yIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->
```

[![@PavelMor25](https://avatars.githubusercontent.com/u/77216072?s=40&v=4)](/PavelMor25)
[PavelMor25](/PavelMor25)
mentioned this issue
[Mar 30, 2024](#ref-issue-2216148419)

[Express.js Open Redirect in malformed URLs
PavelMor25/testcafe-private#74](/PavelMor25/testcafe-private/issues/74)

Closed

1 task

[etroynov](/etroynov)
pushed a commit
to etroynov/koa
that referenced
this issue
[Apr 1, 2024](#ref-commit-69932e3)
[![@fengmk2](https://avatars.githubusercontent.com/u/156269?s=40&v=4)](/fengmk2) [![@etroynov](https://avatars.githubusercontent.com/u/4591518?s=40&v=4)](/etroynov)

`[fix: formatting redirect url on http(s) protocol url (](/etroynov/koa/commit/69932e344f486da765eb62925b96a8c255f7d1b8 "fix: formatting redirect url on http(s) protocol url (#1804)

closes https://github.com/koajs/koa/issues/1800

pick from https://github.com/koajs/koa/pull/1803")[koajs#1804](https://github.com/koajs/koa/pull/1804)[)](/etroynov/koa/commit/69932e344f486da765eb62925b96a8c255f7d1b8 "fix: formatting redirect url on http(s) protocol url (#1804)

closes https://github.com/koajs/koa/issues/1800

pick from https://github.com/koajs/koa/pull/1803")`
…

`[69932e3](/etroynov/koa/commit/69932e344f486da765eb62925b96a8c255f7d1b8)`

```
closes [koajs#1800](https://github.com/koajs/koa/issues/1800)

pick from [koajs#1803](https://github.com/koajs/koa/pull/1803)
```

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Apr 2, 2024](#ref-pullrequest-2220944871)

[chore(deps): update dependency n8n to v1.34.2
uniget-org/tools#3953](/uniget-org/tools/pull/3953)
 Merged

1 task

[![@hmdevelopermind](https://avatars.githubusercontent.com/u/52859974?s=40&v=4)](/hmdevelopermind)
[hmdevelopermind](/hmdevelopermind)
mentioned this issue
[Apr 3, 2024](#ref-issue-2222946341)

[Vulnerabilities in express
scottie1984/swagger-ui-express#369](/scottie1984/swagger-ui-express/issues/369)

Closed

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Apr 4, 2024](#ref-pullrequest-2206344572)

[essais de fix horizontal pod scaller
Khagou/khagu-devops#23](/Khagou/khagu-devops/pull/23)
 Merged

This was referenced Apr 13, 2024

[first try deploiement raspberry
Khagou/khagu-devops#24](/Khagou/khagu-devops/pull/24)
 Closed

[second try deploiement raspberry
Khagou/khagu-devops#25](/Khagou/khagu-devops/pull/25)
 Closed

[3eme essais deploiement raspberry, utilisation image compatible amd64+arm64
Khagou/khagu-devops#26](/Khagou/khagu-devops/pull/26)
 Closed

[Essais deploiement avec api url localhost
Khagou/khagu-devops#27](/Khagou/khagu-devops/pull/27)
 Closed

[4eme essais i guess, modif url pour utiliser ip
Khagou/khagu-devops#28](/Khagou/khagu-devops/pull/28)
 Closed

[Test
Khagou/khagu-devops#29](/Khagou/khagu-devops/pull/29)
 Closed

[Test2
Khagou/khagu-devops#30](/Khagou/khagu-devops/pull/30)
 Closed

This was referenced Apr 13, 2024

[Test
Khagou/khagu-devops#31](/Khagou/khagu-devops/pull/31)
 Closed

[Test
Khagou/khagu-devops#32](/Khagou/khagu-devops/pull/32)
 Closed

[Test
Khagou/khagu-devops#33](/Khagou/khagu-devops/pull/33)
 Closed

[should fix ssl pour back
Khagou/khagu-devops#34](/Khagou/khagu-devops/pull/34)
 Open

[hi5a](/hi5a)
referenced
this issue
in nordic-game-lab/learnhub-sdk
[May 4, 2024](#ref-commit-71e6f1c)
[![@renovate](https://avatars.githubusercontent.com/in/2740?s=40&v=4)](/marketplace/renovate)

`[Update dependency express to v4.19.2 [SECURITY] (](/nordic-game-lab/learnhub-sdk/commit/71e6f1c752652baae44d48f92ea6969c51d0d5aa "Update dependency express to v4.19.2 [SECURITY] (#15)

[![Mend Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/) ([source](https://togithub.com/expressjs/express)) | [`4.18.2` -> `4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |

### GitHub Vulnerability Alerts

#### [CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd
https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)
[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

### [`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](https://www.mend.io/free-developer-tools/renovate/). View repository job log [here](https://developer.mend.io/github/nordic-game-lab/ngl-api-sdk).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjMzMS4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->")[#15](https://github.com/nordic-game-lab/learnhub-sdk/pull/15)[)](/nordic-game-lab/learnhub-sdk/commit/71e6f1c752652baae44d48f92ea6969c51d0d5aa "Update dependency express to v4.19.2 [SECURITY] (#15)

[![Mend Renovate](https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com)

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](http://expressjs.com/) ([source](https://togithub.com/expressjs/express)) | [`4.18.2` -> `4.19.2`](https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |

### GitHub Vulnerability Alerts

#### [CVE-2024-29041](https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](https://togithub.com/pillarjs/encodeurl) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd
https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)
[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)
https://expressjs.com/en/4x/api.html#res.location

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.1...4.19.2)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20)

[Compare Source](https://togithub.com/expressjs/express/compare/4.19.0...4.19.1)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.3...4.19.0)

### [`v4.18.3`](https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26)

[Compare Source](https://togithub.com/expressjs/express/compare/4.18.2...4.18.3)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - \"\" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](https://www.mend.io/free-developer-tools/renovate/). View repository job log [here](https://developer.mend.io/github/nordic-game-lab/ngl-api-sdk).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjMzMS4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->")`
…

`[71e6f1c](/nordic-game-lab/learnhub-sdk/commit/71e6f1c752652baae44d48f92ea6969c51d0d5aa)`

```
[![Mend Renovate]([https://app.renovatebot.com/images/banner.svg)](https://renovatebot.com](https://app.renovatebot.com/images/banner.svg%29%5D%28https%3A//renovatebot.com))

This PR contains the following updates:

| Package | Change | Age | Adoption | Passing | Confidence |
|---|---|---|---|---|---|
| [express](<http://expressjs.com/>) ([source](<https://togithub.com/expressjs/express>)) | [`4.18.2` -> `4.19.2`](<https://renovatebot.com/diffs/npm/express/4.18.2/4.19.2>) | [![age](<https://developer.mend.io/api/mc/badges/age/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![adoption](<https://developer.mend.io/api/mc/badges/adoption/npm/express/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![passing](<https://developer.mend.io/api/mc/badges/compatibility/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) | [![confidence](<https://developer.mend.io/api/mc/badges/confidence/npm/express/4.18.2/4.19.2?slim=true)](https://docs.renovatebot.com/merge-confidence/>) |

### GitHub Vulnerability Alerts

#### [[CVE-2024-29041](https://github.com/advisories/GHSA-rv95-896h-c2vc "CVE-2024-29041")](<https://togithub.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc>)

### Impact

Versions of Express.js prior to 4.19.2 and pre-release alpha and beta versions before 5.0.0-beta.3 are affected by an open redirect vulnerability using malformed URLs.

When a user of Express performs a redirect using a user-provided URL Express performs an encode [using `encodeurl`](<https://togithub.com/pillarjs/encodeurl>) on the contents before passing it to the `location` header. This can cause malformed URLs to be evaluated in unexpected ways by common redirect allow list implementations in Express applications, leading to an Open Redirect via bypass of a properly implemented allow list.

The main method impacted is `res.location()` but this is also called from within `res.redirect()`.

### Patches

[expressjs/express@0867302](https://github.com/expressjs/express/commit/0867302ddbde0e9463d0564fea5861feb708c2dd)
[expressjs/express@0b74695](https://github.com/expressjs/express/commit/0b746953c4bd8e377123527db11f9cd866e39f94)

An initial fix went out with `express@4.19.0`, we then patched a feature regression in `4.19.1` and added improved handling for the bypass in `4.19.2`.

### Workarounds

The fix for this involves pre-parsing the url string with either `require('node:url').parse` or `new URL`. These are steps you can take on your own before passing the user input string to `res.location` or `res.redirect`.

### References

[[https://github.com/expressjs/express/pull/5539](https://togithub.com/expressjs/express/pull/5539)](https://github.com/expressjs/express/pull/5539%5D%28https%3A//togithub.com/expressjs/express/pull/5539%29)
[[https://github.com/koajs/koa/issues/1800](https://togithub.com/koajs/koa/issues/1800)](https://github.com/koajs/koa/issues/1800%5D%28https%3A//togithub.com/koajs/koa/issues/1800%29)
<https://expressjs.com/en/4x/api.html#res.location>

---

### Release Notes

<details>
<summary>expressjs/express (express)</summary>

### [`v4.19.2`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4192--2024-03-25>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.19.1...4.19.2>)

\==========

-   Improved fix for open redirect allow list bypass

### [`v4.19.1`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4191--2024-03-20>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.19.0...4.19.1>)

\==========

-   Allow passing non-strings to res.location with new encoding handling checks

### [`v4.19.0`](<https://togithub.com/expressjs/express/compare/4.18.3...83e77aff6a3859d58206f3ff9501277023c03f87>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.18.3...4.19.0>)

### [`v4.18.3`](<https://togithub.com/expressjs/express/blob/HEAD/History.md#4183--2024-02-26>)

[Compare Source](<https://togithub.com/expressjs/express/compare/4.18.2...4.18.3>)

\==========

-   Fix routing requests without method
-   deps: body-parser@1.20.2
    -   Fix strict json error message on Node.js 19+
    -   deps: content-type@~1.0.5
    -   deps: raw-body@2.5.2

</details>

---

### Configuration

📅 **Schedule**: Branch creation - "" (UTC), Automerge - At any time (no schedule defined).

🚦 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

♻ **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

🔕 **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Mend Renovate](<https://www.mend.io/free-developer-tools/renovate/>). View repository job log [here](<https://developer.mend.io/github/nordic-game-lab/ngl-api-sdk>).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4yNjkuMiIsInVwZGF0ZWRJblZlciI6IjM3LjMzMS4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiJ9-->
```

This was referenced Aug 15, 2024

[Fix missing node modules for theme
2pisoftware/cmfive-boilerplate#156](/2pisoftware/cmfive-boilerplate/pull/156)
 Merged

[Medium severity - Open Redirect vulnerability in express (package.json)
jordaniac89/juice-shop#206](/jordaniac89/juice-shop/issues/206)

Open

This was referenced Sep 12, 2024

[[Snyk] Security upgrade express from 4.17.1 to 4.21.0
m-mizutani/boilerplate-cdk-react-app#8](/m-mizutani/boilerplate-cdk-react-app/pull/8)
 Open

[[Snyk] Security upgrade express from 4.17.1 to 4.20.0
m-mizutani/boilerplate-cdk-react-app#9](/m-mizutani/boilerplate-cdk-react-app/pull/9)
 Open

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Nov 14, 2024](#ref-pullrequest-2657732834)

[express4.17.3
tadashi0713/docker-scout-demo#8](/tadashi0713/docker-scout-demo/pull/8)
 Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fkoa%2Fissues%2F1800)

Assignees

[![@fengmk2](https://avatars.githubusercontent.com/u/156269?s=40&v=4)](/fengmk2) [fengmk2](/fengmk2)

Labels

[bug](/koajs/koa/labels/bug)

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [fix: formatting redirect url on http(s) protocol url](/koajs/koa/pull/1803)
 [koajs/koa](/koajs/koa)

 [fix: formatting redirect url on http(s) protocol url](/koajs/koa/pull/1804)
 [koajs/koa](/koajs/koa)

2 participants

[![@fengmk2](https://avatars.githubusercontent.com/u/156269?s=52&v=4)](/fengmk2) [![@FDrag0n](https://avatars.githubusercontent.com/u/34733637?s=52&v=4)](/FDrag0n)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


