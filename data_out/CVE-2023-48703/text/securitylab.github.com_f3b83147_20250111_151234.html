
[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

March 1, 2024
# GHSL-2023-121: SAML authentication bypass vulnerability in RobotsAndPencils/go-saml - CVE-2023-48703

[![Author avatar](https://avatars.githubusercontent.com/u/176818)
Peter Stöckli](https://github.com/p-)

## Coordinated Disclosure Timeline

* 2023-09-06: Started trying to ask original maintainers (Robots & Pencils) of archived project for a security contact.
* 2023-09-07: Started trying to contact potentially active forks.
* 2024-01-30: Started trying to contact remaining potentially affected OSS projects using the affected codepaths.

## Summary

A SAML authentication bypass vulnerability was found in the archived [go-saml](https://github.com/RobotsAndPencils/go-saml) library from Robots and Pencils. This issue may lead to authentication bypasses in applications using go-saml for the signature verification of SAML assertions.

**Note:** The [RobotsAndPencils/go-saml](https://github.com/RobotsAndPencils/go-saml) library is marked as archived and as such unmaintained. Projects still using it should move to another SAML library or alternatively remove support for SAML from their projects. Also see: “Workaround” for a temporary measure.

## Product

RobotsAndPencils/go-saml (archived)

## Tested Version

[master](https://github.com/RobotsAndPencils/go-saml)

## Details

### Authentication bypass (`GHSL-2023-121`)

A SAML authentication bypass was found in the RobotsAndPencils/go-saml library. This is due to how the `xmlsec1` command line tool is called internally to verify the signature of SAML assertions. When `xmlsec1` is used without defining the enabled key data, the origin of the public key for the signature verification is, unfortunately, not restricted. That means an attacker can sign the SAML assertions themselves and provide the required public key (e.g. an RSA key) directly embedded in the SAML token.

A library using go-saml as seen in the sample code of the [README](https://github.com/RobotsAndPencils/go-saml/blob/29020529affcd0311cd1db1f517819ae8e12d6a5/README.md?plain=1#L89) to verify SAML tokens would call [`Validate`](https://github.com/RobotsAndPencils/go-saml/blob/29020529affcd0311cd1db1f517819ae8e12d6a5/authnresponse.go#L49) on the SAML response. The `Validate` method itself calls [`VerifyResponseSignature`](https://github.com/RobotsAndPencils/go-saml/blob/29020529affcd0311cd1db1f517819ae8e12d6a5/xmlsec.go#L69), which itself calls the [`verify`](https://github.com/RobotsAndPencils/go-saml/blob/29020529affcd0311cd1db1f517819ae8e12d6a5/xmlsec.go#L80) function inside of `xmlsec.go`. Under the hood the `verify`-function uses the `xmlsec1` command line tool for [verifying XML signatures](https://github.com/RobotsAndPencils/go-saml/blob/29020529affcd0311cd1db1f517819ae8e12d6a5/xmlsec.go#L92):

```
func verify(xml string, publicCertPath string, id string) error {
	// snip
	_, err = exec.Command("xmlsec1", "--verify", "--pubkey-cert-pem", publicCertPath, "--id-attr:ID", id, samlXmlsecInput.Name()).CombinedOutput()
	if err != nil {
		return errors.New("error verifing signature: " + err.Error())
	}
	return nil
}

```

The `xmlsec1` tool is called without parameters that define which public keys should be used for the verification of the signatures. This means `xmlsec1` also considers public keys embedded into the XML file itself. In the case of a SAML token that means an attacker can self-sign their tokens and embed their own public key.

#### Workaround

Projects still using RobotsAndPencils/go-saml should move to another SAML library or alternatively remove support for SAML from their projects.

Should a project still use the RobotsAndPencils/go-saml library, it’s likely vulnerable if it uses go-saml to verify the signature of a SAML assertion. This specifically means if they have a code path that leads to a call of the private [`verify`](https://github.com/RobotsAndPencils/go-saml/blob/29020529affcd0311cd1db1f517819ae8e12d6a5/xmlsec.go#L80) function.
E.g. that means from [`VerifyResponseSignature`](https://github.com/RobotsAndPencils/go-saml/blob/29020529affcd0311cd1db1f517819ae8e12d6a5/xmlsec.go#L69) or via [`Validate`](https://github.com/RobotsAndPencils/go-saml/blob/29020529affcd0311cd1db1f517819ae8e12d6a5/authnresponse.go#L49) inside of `authnresponse.go`.
Or from [`VerifyRequestSignature`](https://github.com/RobotsAndPencils/go-saml/blob/29020529affcd0311cd1db1f517819ae8e12d6a5/xmlsec.go#L76) or via [`Validate`](https://github.com/RobotsAndPencils/go-saml/blob/29020529affcd0311cd1db1f517819ae8e12d6a5/authnrequest.go#L64C10-L64C22) inside of `authnrequest.go`.

The vulnerability can likely temporarily be fixed by forking the go-saml project and adding the command line argument `--enabled-key-data` and specifying a value such as `x509` or `raw-x509-cert` when calling the `xmlsec1` binary in the [`verify`](https://github.com/RobotsAndPencils/go-saml/blob/29020529affcd0311cd1db1f517819ae8e12d6a5/xmlsec.go#L92) function. Compare how [pysaml2](https://github.com/IdentityPython/pysaml2/blob/3daa066703f5ec433aeb9714a847330c540fc5d4/src/saml2/sigver.py#L828) calls `xmlsec1` or see [example C code](https://github.com/lsh123/xmlsec/blob/89761689555fa219c980a55b22e13167a3d10a5e/examples/verify4.c#L268) from xmlsec1. Please note that this workaround must be carefully tested before it can be used.
Moving away from the go-saml library is still strongly recommended as it is unmaintained.

##### Sidenote regarding xmlsec1

The version 1.3.3 of xmlsec1 [released in January 2024](https://github.com/lsh123/xmlsec/releases/tag/1.3.3) disables `KeyValue` and `DEREncodedKeyValue` XML nodes by default. However, most Linux distributions ship older versions of xmlsec1 and specifying the enabled-key-data is recommended in any case.

#### Impact

This issue may lead to authentication bypasses in applications using go-saml for authentication purposes.

## CVE

* CVE-2023-48703

## Credit

This issue was discovered and reported by GHSL team member [@p- (Peter Stöckli)](https://github.com/p-).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2023-121` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information

