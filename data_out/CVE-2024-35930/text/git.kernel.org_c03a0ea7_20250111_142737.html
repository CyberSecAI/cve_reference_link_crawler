

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e2cd32435b1dff3d63759476a3abc878e02fb6c8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e2cd32435b1dff3d63759476a3abc878e02fb6c8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2cd32435b1dff3d63759476a3abc878e02fb6c8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2cd32435b1dff3d63759476a3abc878e02fb6c8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Justin Tee <justin.tee@broadcom.com> | 2024-01-31 10:50:57 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-04-13 12:51:38 +0200 |
| commit | [e2cd32435b1dff3d63759476a3abc878e02fb6c8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2cd32435b1dff3d63759476a3abc878e02fb6c8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e2cd32435b1dff3d63759476a3abc878e02fb6c8)) | |
| tree | [c81e90e22dfdca86054584afeb1733708cb88aef](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e2cd32435b1dff3d63759476a3abc878e02fb6c8) | |
| parent | [1b4fe801b5bedec2b622ddb18e5c9bf26c63d79f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1b4fe801b5bedec2b622ddb18e5c9bf26c63d79f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2cd32435b1dff3d63759476a3abc878e02fb6c8&id2=1b4fe801b5bedec2b622ddb18e5c9bf26c63d79f)) | |
| download | [linux-e2cd32435b1dff3d63759476a3abc878e02fb6c8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e2cd32435b1dff3d63759476a3abc878e02fb6c8.tar.gz) | |

scsi: lpfc: Fix possible memory leak in lpfc\_rcv\_padisc()[ Upstream commit 2ae917d4bcab80ab304b774d492e2fcd6c52c06b ]
The call to lpfc\_sli4\_resume\_rpi() in lpfc\_rcv\_padisc() may return an
unsuccessful status. In such cases, the elsiocb is not issued, the
completion is not called, and thus the elsiocb resource is leaked.
Check return value after calling lpfc\_sli4\_resume\_rpi() and conditionally
release the elsiocb resource.
Signed-off-by: Justin Tee <justin.tee@broadcom.com>
Link: [https://lore.kernel.org/r/20240131185112.149731-3-justintee8345@gmail.com](https://lore.kernel.org/r/20240131185112.149731-3-justintee8345%40gmail.com)
Reviewed-by: Himanshu Madhani <himanshu.madhani@oracle.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2cd32435b1dff3d63759476a3abc878e02fb6c8)

| -rw-r--r-- | [drivers/scsi/lpfc/lpfc\_nportdisc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/scsi/lpfc/lpfc_nportdisc.c?id=e2cd32435b1dff3d63759476a3abc878e02fb6c8) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/scsi/lpfc/lpfc\_nportdisc.c b/drivers/scsi/lpfc/lpfc\_nportdisc.cindex e6a94f550a5728..1ca3179444d23e 100644--- a/[drivers/scsi/lpfc/lpfc\_nportdisc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/lpfc/lpfc_nportdisc.c?id=1b4fe801b5bedec2b622ddb18e5c9bf26c63d79f)+++ b/[drivers/scsi/lpfc/lpfc\_nportdisc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/lpfc/lpfc_nportdisc.c?id=e2cd32435b1dff3d63759476a3abc878e02fb6c8)@@ -781,8 +781,10 @@ lpfc\_rcv\_padisc(struct lpfc\_vport \*vport, struct lpfc\_nodelist \*ndlp, /\* Save the ELS cmd \*/ elsiocb->drvrTimeout = cmd; - lpfc\_sli4\_resume\_rpi(ndlp,- lpfc\_mbx\_cmpl\_resume\_rpi, elsiocb);+ if (lpfc\_sli4\_resume\_rpi(ndlp,+ lpfc\_mbx\_cmpl\_resume\_rpi,+ elsiocb))+ kfree(elsiocb); goto out; } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 14:26:15 +0000

