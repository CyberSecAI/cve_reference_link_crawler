<!DOCTYPE html>
<html lang="en-US" data-themeable="true">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="csrf-token" content="ZHkhTqA6-eo6lXVTkAkoieJRcBz-5yZiv5k8">
    
    
    <meta name="description" content="On July 30th at 16:44 UTC, Vyper foundation acknowledged a bug affecting Vyper versions 0.2.15, 0.2.16, and 0.3.0.">
    
    <title>Curve Pool Reentrancy Exploit Postmortem July 30th, 2023 - HackMD</title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
	<link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">
	<!--  meta value for server side given sign in boolean -->
    <meta name="signin" content="false">

    
<script nonce="dfd34372-6a78-4ad0-887d-ff8a46d9b545">
  window.domain = 'hackmd.io'
  window.urlpath = ''
  window.debug = false || window.localStorage.getItem('HMD_DEBUG_FLAG') === 'true'
  window.version = '1.3.0'
  window.brand = 'HackMD'

  
  window.NOTE_ID = 'zzEeuxynThu-JcWgW1hz7Q'
  

  window.GOOGLE_DRIVE_API_KEY = 'AIzaSyAHmcP5gL_64ZafuAYOvJruFAIaYgHQaY4'
  window.GOOGLE_DRIVE_CLIENT_ID = '65857506266-76uhhee8se8dgs1i0q8fhtj1prg0ar27.apps.googleusercontent.com'
  window.DROPBOX_APP_KEY = 'rdoizrlnkuha23r'
  
  window.PLANTUML_SERVER = 'https://ptuml.hackmd.io'

  window.ASSET_URL = 'https://assets.hackmd.io'

  window.USER_CAN_CREATE_TEAM = true
  window.USER_CAN_DELETE_ACCOUNT = true
  window.USER_DELETE_ACCOUNT_VIA_EMAIL = true
  window.PAYMENT_ENABLED = true
  window.PAYMENT_PROMOTION_BANNER_ENABLED = false
  window.GITHUB_SYNC_ENABLED = true
  window.GITLAB_SYNC_ENABLED = false
  window.GITLAB_SYNC_BASE_URL = ''
  window.VCS_SYNC_MODE = 'github'
  window.VCS_PROVIDER_NAME = 'GitHub'
  window.FREE_TEAM_NUM = 20
  window.FREE_TEAM_MEMBER_NUM = 3
  window.FREE_PUBLIC_TEAM_NUM = 10
  window.NEO_OVERVIEW_UI = true
  window.FOLDER_ENABLE = true
  
  window.EE_SITE_ENABLE = false
  window.EE_SITE_NAME = 'false'
  window.EE_SITE_LINK = 'false'
  window.EESITE_INFO = false
  window.ENTERPRISE_DISCOVERY_ENABLE = false
  window.ENTERPRISE_DISCOVERY_TEAM = true
  window.ENTERPRISE_DISCOVERY_NOTE = true
  window.ENTERPRISE_DISCOVERY_VIEW_PERMISSION = 'guest'
  
  window.ALLOW_ANONYMOUS = true
  window.ALLOW_ANONYMOUS_EDIT = false
  window.ALLOW_DOWNLOAD_PDF = true
  window.PUBLIC_OVERVIEW = false
  window.INTERNAL_PUBLIC_OVERVIEW = false
  window.FULL_TEXT_SEARCH_ENABLE = false
  window.ALGOLIA_SEARCH_ENABLE = true
  window.MARKETING_EMAIL_ENABLE = true
  window.OFFLINE_ACCESS = true
  
  
  
    window.WALLET_CONNECT_PROJECT_ID = '91d6fa182b725b5895a17a170a5878c1'
  
  window.API_MANAGEMENT_UI_ENABLE = true
  window.FEEDBACK_UI_ENABLE = true
  window.PUBLISH_ENABLE = true

  

  
  window.SHOW_HOT_NOTES = false
  

  
  window.HOT_NOTES_TIME_TYPE = 'week'
  

  
  window.SHOW_OVERVIEW = false
  

  
  window.MENTIONS = {}
  

  
  window.MENTION_ANCHORS = []
  

  
  window.COMMENT_ANCHORS = []
  

  
  window.IS_OWNER = false
  

  
  window.IS_TEAM_ADMIN = false
  

  
  window.IS_INVITEE_ADMIN = false
  

  
  window.USER_PROFILE = '%7B%22name%22%3A%22Guest%20Miles%22%7D'
  

  
  window.VERSION_TIME = '1691011303503'
  

  
  window.canEdit = true
  

  
  window.canWriteComment = false
  

  
  window.canHideComment = false
  

  window.TRASH_NOTE_DELETE_AFTER_FREE = 3
  window.TRASH_NOTE_DELETE_AFTER_PAID = 30

  
    window.ENABLED_PREVIEW_FEATURE = {}
  

  
    window.IS_OWNER_UPGRADED = false
  

  
    window.IMGUR_FALLBACK_CDN = 'https://imgur-backup.hackmd.io'
  

  
    window.CLOUD_META_UI = true
  
  
    window.CLOUD_META_API = true
  
  
    window.CLOUD_META_MIGRATION = false
  
  
    window.YAML_METADATA_ENABLED = false
  

  
    window.NOTE_CAPACITY_LIMIT = 50
  

  
    window.DOCUMENT_MAX_LENGTH = 100000
  

  
    window.SOCIAL_NETWORK_FEATURES_ENABLED = true
  

  
    window.PUBLISHMENT_MODERATION_ENABLED = true
  

  
    window.COMMENT_ENABLED = true
  

  window.SUGGEST_EDIT_ENABLED = true
  
    window.SUGGEST_EDIT_ENABLED = true
  

  
    window.REALTIME_CLIENT_WITH_CREDENTIALS = false
  

  
    window.COMMENT_ENABLED = true
  

  
    window.DEBUG_DISCONNECT_SOCKET_WHEN_OFFLINE = false
  

  

  

  

  
    window.CUSTOM_STYLE_ENABLED = "true"
  

  
    window.USE_NEW_LOGO = true
  

  
    window.ITERABLE_ENABLED = true
  
  
    window.ITERABLE_API_KEY = "c2c36a44c2614fb19aa3b46d660bbce2"
  

  
    window.TEXT_SELECTION_CHANGED = false
  

  
    window.CAN_VIEW_HISTORY_AT_REVISION = false
  
</script>


    
<!-- Google Tag Manager -->
<script nonce="dfd34372-6a78-4ad0-887d-ff8a46d9b545">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KLW9Z3');</script>
<!-- End Google Tag Manager -->


    





    <meta property="fb:app_id" content="1436904003272070">



    <meta name="twitter:image:src" content="https://hackmd.io/images/media/HackMD-neo-og.jpg">
    <meta name="twitter:image:alt" content="Curve Pool Reentrancy Exploit Postmortem July 30th, 2023 - HackMD">


<meta name="twitter:site" content="@hackmdio" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Curve Pool Reentrancy Exploit Postmortem July 30th, 2023 - HackMD" />


    <meta name="twitter:description" content="On July 30th at 16:44 UTC, Vyper foundation acknowledged a bug affecting Vyper versions 0.2.15, 0.2.16, and 0.3.0." />



    <meta property="og:image" content="https://hackmd.io/images/media/HackMD-neo-og.jpg">
    <meta property="og:image:alt" content="Curve Pool Reentrancy Exploit Postmortem July 30th, 2023 - HackMD">


<meta property="og:site_name" content="HackMD" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Curve Pool Reentrancy Exploit Postmortem July 30th, 2023 - HackMD" />


    <meta property="og:description" content="On July 30th at 16:44 UTC, Vyper foundation acknowledged a bug affecting Vyper versions 0.2.15, 0.2.16, and 0.3.0." />



    <link rel="canonical" href="https://hackmd.io/@LlamaRisk/BJzSKHNjn" />
    <meta property="og:url" content="https://hackmd.io/@LlamaRisk/BJzSKHNjn" />
    <meta property="twitter:url" content="https://hackmd.io/@LlamaRisk/BJzSKHNjn" />


     <link href="https://assets.hackmd.io/build/font-vendor.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/font-vendor.ea8218d7d4f468b2c430.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/common-vendor.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/common-vendor.0a08ae20e14fefe857eb.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/pretty-vendor.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/pretty-vendor.db0e7b64c54d0a77290f.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/pretty.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/pretty.206c1db4aa617ea5aa67.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
<![endif]-->

    


    <script defer data-domain="hackmd.io" src="https://plausible.io/js/script.js"></script>
<script nonce="dfd34372-6a78-4ad0-887d-ff8a46d9b545">
  window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments); }
  const keyboardWhiteList = ['a', 'span', 'button']

  function getTaggedEventAttributes (e) {
    const eventAttrs = { name: null, props: {} }
    if (!e || !e.classList) return eventAttrs
    const psEvent = /plausible-event-(.+)(=|--)(.+)/
    for (const className of [...e.classList]) {
      const [, key, , val] = className.match(psEvent) || []
      if (!key || !val) continue
      const value = val.replace(/\+/g, ' ')
      switch (key.toLowerCase()) {
        case 'name':
          eventAttrs.name = value
          break
        default:
          eventAttrs.props[key] = value
          break
      }
    }
    return eventAttrs
  }

  function isLocal () {
    return /^localhost$|^127(\.[0-9]+){0,2}\.[0-9]+$|^\[::1?\]$/.test(location.hostname) || location.protocol === 'file:'
  }

  function isAutomation () {
    return Boolean(window._phantom || window.__nightmare || window.navigator.webdriver || window.Cypress)
  }

  function shouldIgnore () {
    return isLocal() ||
      isAutomation() ||
      window.localStorage.getItem('plausible_ignore') === 'true'
  }

  function handler (e) {
    if (!window.plausible) return
    if (!e.target || !('className' in e.target)) return
    const ele = e.target

    const eventAttrs = getTaggedEventAttributes(ele)
    if (!eventAttrs.name) return
    if (ele?.href) eventAttrs.props.url = ele.href

    if (shouldIgnore()) {
      if (window.debug) logDebugEventMsg(eventAttrs)
      return
    }
    window.plausible(eventAttrs.name, { props: eventAttrs.props })
  }

  function logDebugEventMsg (eventAttrs) {
    console.warn(
      `Ignoring Event: "${eventAttrs.name}"`,
      eventAttrs,
    )
  }

  function keydownHandler (e) {
    if (e.key !== 'Enter') return
    if (e.target.nodeName.toLowerCase() === 'input') {
      switch (e.target.type.toLowerCase()) {
        case 'submit':
        case 'button':
        case 'reset':
        case 'checkbox':
        case 'radio':
        case 'file':
        case 'image':
        case 'color':
          break
        default:
          return
      }
    } else if (!keyboardWhiteList.includes(e.target.nodeName.toLowerCase())) {
      return
    }
    handler(e)
  }

  document.addEventListener('mousedown', handler)
  document.addEventListener('keydown', keydownHandler)
</script>

    
<script nonce="dfd34372-6a78-4ad0-887d-ff8a46d9b545">
  window.publishProps = JSON.parse(`{"isOwnerAnonymous":false,"isOwnedByTeam":false,"ownerInfo":{"name":"Llama%20Risk","path":"LlamaRisk","avatarUrl":"https%3A%2F%2Fuploads-public.hackmd.io%2Fupload_c022f1a31209d627d1952da185a6244f.png","description":"LlamaRisk%20conducts%20risk%20assessments%20on%20topics%20relevant%20to%20Curve%20DAO%20and%20its%20liquidity%20providers."},"isPublished":true,"createTime":1690749242273,"updateTime":1691011303503,"vcsSyncMode":"github","vcsProviderName":"GitHub","canEdit":true,"hardBreaks":true,"onlyOwnerCanEdit":false,"isCommentEnabled":true,"likedCount":8,"isNotificationEnabled":true,"notificationType":"never","hasEmail":false,"canWriteComment":false,"viewCount":29330,"markdown":"!%5B%5D(https%3A%2F%2Fhackmd.io%2F_uploads%2FS1xvzFHj2.png)%0A%0A%23%23%20Summary%0A-%20A%20bug%20within%20older%20versions%20of%20the%20Vyper%20compiler%20caused%20a%20failure%20in%20a%20security%20feature%20used%20by%20a%20limited%20set%20of%20Curve%20pools%20(see%20affected%20pools%20below).%0A-%20As%20a%20result%20attackers%20were%20able%20to%20drain%20the%20affected%20pools%20of%20their%20tokens.%0A-%20The%20exploit%20comes%20directly%20at%20the%20expense%20of%20Curve%20liquidity%20providers%20for%20these%20affected%20pools%2C%20although%20Curve%20is%20attempting%20to%20contact%20exploiters%20and%20recover%20user%20funds.%0A-%20Thanks%20to%20a%20white%20hat%2C%20a%20portion%20of%20tokens%20from%20one%20affected%20pool%20were%20recovered%20by%20the%20DAO.%0A-%20The%20Curve%20eDAO%20cannot%20pause%20Curve%20pools%20or%20handle%20user%20funds%20in%20any%20way.%20However%2C%20it%20can%20kill%20CRV%20gauge%20emissions%20to%20Curve%20pools.%20It%20is%20expected%20the%20eDAO%20will%20kill%20gauge%20emissions%20to%20all%20affected%20pools.%0A-%20For%20more%20information%3A%20%0A%20%20%20%20-%20join%20the%20%5BCurve%20Announcements%20TG%5D(https%3A%2F%2Ft.me%2Fcurvefiann)%2C%20%0A%20%20%20%20-%20follow%20%5BCurve%20Finance%5D(https%3A%2F%2Ftwitter.com%2FCurveFinance)%20on%20Twitter%2C%0A%20%20%20%20-%20join%20the%20%5BCurve%20TG%5D(https%3A%2F%2Ft.me%2Fcurvefi)%20group%0A%20%20%20%20-%20join%20the%20%5BCurve%20Discord%5D(https%3A%2F%2Fdiscord.gg%2FrgrfS7W)%0A%0A%23%23%20Exploit%20Overview%0AOn%20July%2030th%20between%2013%3A10%20and%2022%3A00%20UTC%2C%20a%20series%20of%20exploits%20resulted%20in%20loss%20of%20funds%20from%20several%20Curve%20pools.%20The%20source%20of%20the%20vulnerability%20in%20each%20case%20is%20a%20malfunctioning%20reentrancy%20lock%20in%20certain%20versions%20of%20Vyper.%0A%0AAffected%20pools%20and%20amount%20extracted%20by%20each%20exploit%3A%0A-%20%5BpETH%2FETH%5D(https%3A%2F%2Fcurve.fi%2F%23%2Fethereum%2Fpools%2Ffactory-v2-194%2Fdeposit)%20%7C%206%2C106.65%20WETH%20(~%2411m)%0A-%20%5BmsETH%2FETH%5D(https%3A%2F%2Fcurve.fi%2F%23%2Fethereum%2Fpools%2Ffactory-v2-252%2Fdeposit)%20%7C%20866.55%20WETH%20(~%241.6%20m)%20and%20959.71%20msETH%20(~%241.8m)%0A-%20%5BalETH%2FETH%5D(https%3A%2F%2Fcurve.fi%2F%23%2Fethereum%2Fpools%2Ffactory-v2-38%2Fdeposit)%20%7C%207%2C258.70%20WETH%20(~%2413.6%20m)%20and%204%2C821.55%20alETH%20(~9m)%0A-%20%5BCRV%2FETH%5D(https%3A%2F%2Fcurve.fi%2F%23%2Fethereum%2Fpools%2Fcrveth%2Fdeposit)%20%7C%207%2C193%2C401.77%20CRV%20(~%245.1m%20at%20time%20of%20exploit)%2C%207%2C680.49%20WETH%20(~%2414.2m)%2C%20and%202%2C879.65%20ETH%20(~%245.4m)%0A%0AAnother%20pool%20potentially%20affected%20is%20%5BArbitrum%E2%80%99s%20Tricrypto%5D(https%3A%2F%2Fcurve.fi%2F%23%2Farbitrum%2Fpools%2Ftricrypto%2Fdeposit)%20pool.%20Auditors%20and%20Vyper%20devs%20could%20not%20find%20a%20profitable%20exploit%2C%20**but%20Curve%20is%20advising%20LPs%20to%20exit%20that%20pool%20as%20a%20precaution.**%0A%0AOn%20July%2030th%20at%2016%3A44%20UTC%2C%20Vyper%20official%20Twitter%20acknowledged%20a%20bug%20affecting%20Vyper%20versions%200.2.15%2C%200.2.16%2C%20and%200.3.0.%20The%20compiler%20had%20a%20bug%20which%20negated%20the%20reentrancy%20protection.%20This%20bug%20was%20patched%20in%20version%200.3.1%20(accidentally%2C%20as%20the%20bug%20remained%20unknown%20until%20July%2030th).%20All%20contracts%20after%200.3.1%20are%20in%20general%20without%20this%20bugged%20reentrancy%20guard.%0A%0A%0A!%5B%5D(https%3A%2F%2Fhackmd.io%2F_uploads%2FB1ruTSEo2.png)%0ASource%3A%20%5BTwitter%5D(https%3A%2F%2Ftwitter.com%2Fvyperlang%2Fstatus%2F1685692973051498497)%0A%0AThe%20bug%20was%20introduced%20in%20this%20PR%3A%20%5B%232391%5D(https%3A%2F%2Fgithub.com%2Fvyperlang%2Fvyper%2Fpull%2F2391)%0AThe%20bug%20was%20patched%20in%20PRs%3A%20%5B%232439%5D(https%3A%2F%2Fgithub.com%2Fvyperlang%2Fvyper%2Fpull%2F2439)%20and%20%5B%232514%5D(https%3A%2F%2Fgithub.com%2Fvyperlang%2Fvyper%2Fpull%2F2514)%0A%0ACurve's%20contracts%20become%20vulnerable%20when%20making%20a%20raw_call%20to%20send%20native%20tokens.%20The%20affected%20Curve%20pools%20were%20each%20using%20one%20of%20the%20aforementioned%20Vyper%20versions%20and%20are%20paired%20with%20native%20ETH.%20Tokens%20using%20the%20ERC-777%20standard%20have%20also%20been%20affected%2C%20although%20Curve%20pools%20involving%20these%20tokens%20have%20all%20largely%20been%20deprecated%20(e.g.%20%5BpBTC%5D(https%3A%2F%2Fcurve.fi%2F%23%2Fethereum%2Fpools%2Ffactory-v2-99%2Fdeposit)%20and%20%5BHOME%5D(https%3A%2F%2Fcurve.fi%2F%23%2Fethereum%2Fpools%2Ffactory-v2-123%2Fdeposit)).%20ERC-777%20adds%20callbacks%2C%20making%20those%20pools%20susceptible%20to%20the%20same%20reentrancy%20issue.%20Pools%20paired%20with%20WETH%20**have%20not**%20been%20affected.%0A%0AThere%20appear%20to%20be%20multiple%20actors%20involved%20with%20the%20exploits%20and%20at%20least%20one%20is%20working%20with%20the%20Curve%20team%20to%20recover%20funds.%202%2C879.65%20ETH%20(~%245.4m)%20extracted%20from%20the%20CRV%2FETH%20pool%20by%20c0ffeebabe.eth%20has%20been%20returned%20to%20the%20Curve%20team.%20%20%0A%0A%23%23%20Arbitrum%20Tricrypto%20Alert%0A%0AThe%20%5BArbitrum%20Tricrypto%20pool%5D(https%3A%2F%2Fcurve.fi%2F%23%2Farbitrum%2Fpools%2Ftricrypto%2Fdeposit)%20might%20be%20at%20risk%20of%20being%20exploited.%20While%20security%20researchers%20have%20not%20identified%20a%20profitable%20exploit%2C%20Curve%20is%20recommending%20users%20to%20exit%20this%20pool%20in%20an%20abundance%20of%20caution.%0A%0A!%5B%5D(https%3A%2F%2Fhackmd.io%2F_uploads%2FBJc-yH_jh.png)%0ASource%3A%20%5BTwitter%5D(https%3A%2F%2Ftwitter.com%2FCurveFinance%2Fstatus%2F1685925429041917952%3Fs%3D20)%0A%0A%23%23%20pETH%2FETH%20Pool%20Exploit%0A%5BExploit%20tx%5D(https%3A%2F%2Fetherscan.io%2Ftx%2F0xa84aa065ce61dbb1eb50ab6ae67fc31a9da50dd2c74eefd561661bfce2f1620c)%0A%0AOn%20July%2030th%20at%2013%3A10%20UTC%2C%20an%20exploit%20occurred%20that%20drained%20pETH%20from%20the%20Curve%20pool.%20The%20attacker%20swapped%20pETH%20to%20WETH%20for%20a%20profit%20of%206%2C106.65%20WETH%20(~%2411m).%0A%0A!%5B%5D(https%3A%2F%2Fhackmd.io%2F_uploads%2FS1EhxxBs3.png)%0ASource%3A%20%5BPhalcon%20Explorer%5D(https%3A%2F%2Fethtx.info%2Fmainnet%2F0xa84aa065ce61dbb1eb50ab6ae67fc31a9da50dd2c74eefd561661bfce2f1620c%2F)%20%0A%0AThe%20exploit%20logic%20was%20as%20follows%3A%0A-%20The%20exploiter%20opened%20an%2080%2C000%20WETH%20flash%20loan%20from%20%5BBalancer%5D(https%3A%2F%2Fetherscan.io%2Faddress%2F0xba12222222228d8ba445958a75a0704d566bf2c8)%20and%20unwrapped%20all%20to%20ETH.%0A-%20They%20provided%2040%2C000%20ETH%20as%20liquidity%20to%20the%20Curve%20%5BpETH%2FETH%20pool%5D(https%3A%2F%2Fetherscan.io%2Ftoken%2F0x9848482da3ee3076165ce6497eda906e66bb85c5)%20and%20received%2032%2C431.41%20pETH-ETH%20LP%20tokens.%0A-%203%2C740%20pETH%20and%2034%2C316%20ETH%20was%20removed%20from%20the%20pool%20by%20burning%2032%2C431.41%20%5BpETH%2FETH%20pool%5D(https%3A%2F%2Fetherscan.io%2Ftoken%2F0x9848482da3ee3076165ce6497eda906e66bb85c5)%20LP%20tokens.%0A-%20They%20again%20provided%2040%2C000%20ETH%20as%20liquidity%20to%20the%20Curve%20%5BpETH%2FETH%20pool%5D(https%3A%2F%2Fetherscan.io%2Ftoken%2F0x9848482da3ee3076165ce6497eda906e66bb85c5)%2C%20minting%2082%2C182%20more%20LP%20tokens.%0A-%20Another%201%2C184.73%20pETH%20and%2047%2C506.53%20ETH%20was%20withdrawn%20by%20burning%2010%2C272.84%20Curve%20LP%20tokens.%0A-%204%2C924%20pETH%20was%20swapped%20for%204%2C285%20ETH%20within%20the%20Curve%20pool.%0A-%2086%2C106.65%20ETH%20was%20wrapped%20to%20WETH.%0A-%2080%2C000%20WETH%20repaid%20to%20%5BBalancer%5D(https%3A%2F%2Fetherscan.io%2Faddress%2F0xba12222222228d8ba445958a75a0704d566bf2c8)%20to%20return%20the%20flash%20loan.%0A-%206%2C106.65%20WETH%20~%2411%20million%20was%20retained%20as%20profit.%0A%0AThe%20reentrancy%20occurred%20between%20the%20remove%20liquidity%20and%20add%20liquidity%20actions.%20A%20pool%20depositor%20should%20ordinarily%20be%20entitled%20to%20pool%20tokens%20equal%20to%20the%20product%20of%20the%20%20total%20pool%20token%20supply%20and%20the%20the%20fraction%20of%20the%20depositor%E2%80%99s%20supplied%20liquidity.%20However%2C%20due%20to%20the%20reentrancy%20bug%2C%20the%20allotted%20pool%20tokens%20were%20calculated%20with%20the%20pre-burn%20balances.%20This%20allowed%20the%20exploit%20to%20infinite%20mint%20pool%20tokens%20to%20create%20a%20fraudulent%20claim%20on%20the%20entire%20contents%20of%20the%20pool.%0A%0A%20%0A%0A%0AAt%20time%20of%20writing%2C%20the%20funds%20are%20held%20in%20the%20%5BJPEGd_69%20Exploit%5D(https%3A%2F%2Fetherscan.io%2Faddress%2F0x6ec21d1868743a44318c3c259a6d4953f9978538)%20wallet%20address.%0A%0AThe%20pETH%2FETH%20Curve%20pool%20contained%20~%2421m%20TVL%20at%20the%20time%20of%20the%20incident%2C%20and%20all%20funds%20have%20since%20been%20drained%20or%20otherwise%20removed%20by%20users.%20While%20the%20emergency%20DAO%20is%20unable%20to%20take%20action%20to%20pause%20the%20pool%20or%20influence%20user%20funds%20in%20any%20way%2C%20it%20is%20able%20to%20freeze%20CRV%20gauge%20emissions%20to%20the%20pool.%20This%20action%20is%20expected%20shortly.%0A%0A%23%23%20msETH%2FETH%20Pool%20Exploit%0A%5BExploit%20tx%5D(https%3A%2F%2Fetherscan.io%2Ftx%2F0xc93eb238ff42632525e990119d3edc7775299a70b56e54d83ec4f53736400964)%0A%0AOn%20July%2030th%20at%2014%3A50%20UTC%2C%20an%20exploit%20occurred%20that%20drained%20msETH%20from%20the%20Curve%20pool.%20The%20attacker%20retained%20a%20profit%20of%20866.55%20ETH%20(~%241.6m)%20and%20959.71%20msETH%20(~%241.8).%0A%0A!%5B%5D(https%3A%2F%2Fhackmd.io%2F_uploads%2FByG6oxBoh.png)%0ASource%3A%20%5BPhalcon%20Explorer%5D(https%3A%2F%2Fexplorer.phalcon.xyz%2Ftx%2Feth%2F0xc93eb238ff42632525e990119d3edc7775299a70b56e54d83ec4f53736400964)%0A%0AThe%20exploit%20logic%20was%20as%20follows%3A%0A-%20The%20exploiter%20opened%20an%2010%2C000%20WETH%20flash%20loan%20from%20%5BBalancer%5D(https%3A%2F%2Fetherscan.io%2Faddress%2F0xba12222222228d8ba445958a75a0704d566bf2c8)%20and%20unwrapped%20all%20to%20ETH.%0A-%20They%20provided%205%2C000%20ETH%20as%20liquidity%20to%20the%20Curve%20%5BmsETH%2FETH%20pool%5D(https%3A%2F%2Fetherscan.io%2Ftoken%2F0xc897b98272aa23714464ea2a0bd5180f1b8c0025)%20and%20received%204%2C984.26%20alETH-ETH%20LP%20tokens.%0A-%20959.71%20msETH%20and%204%2C036.22%20ETH%20was%20removed%20from%20the%20pool%20by%20burning%204%2C984.26%20%5BmsETH%2FETH%20pool%5D(https%3A%2F%2Fetherscan.io%2Ftoken%2F0xc897b98272aa23714464ea2a0bd5180f1b8c0025)%20LP%20tokens.%0A-%20They%20again%20provided%205%2C000%20ETH%20as%20liquidity%20to%20the%20Curve%20%5BmsETH%2FETH%20pool%5D(https%3A%2F%2Fetherscan.io%2Ftoken%2F0xc897b98272aa23714464ea2a0bd5180f1b8c0025)%2C%20minting%2011%2C192.69%20more%20LP%20tokens.%0A-%202%2C260.72%20msETH%2FETH%20LP%20token%20was%20burned%20to%20withdraw%206%2C830.50%20ETH%20(this%20was%20a%20removeLiquidityOne%20call).%0A-%2010%2C866.72%20ETH%20was%20wrapped%20to%20WETH.%0A-%2010%2C000%20WETH%20repaid%20to%20%5BBalancer%5D(https%3A%2F%2Fetherscan.io%2Faddress%2F0xba12222222228d8ba445958a75a0704d566bf2c8)%20to%20return%20the%20flash%20loan.%0A-%20866.55%20WETH%20(~%241.6%20m)%20and%20959.71%20msETH%20(~%241.8m)%20was%20retained%20as%20profit.%0A%0AThe%20reentrancy%20occurred%20between%20the%20remove%20liquidity%20and%20add%20liquidity%20actions.%20A%20pool%20depositor%20should%20ordinarily%20be%20entitled%20to%20pool%20tokens%20equal%20to%20the%20product%20of%20the%20%20total%20pool%20token%20supply%20and%20the%20the%20fraction%20of%20the%20depositor%E2%80%99s%20supplied%20liquidity.%20However%2C%20due%20to%20the%20reentrancy%20bug%2C%20the%20allotted%20pool%20tokens%20were%20calculated%20with%20the%20pre-burn%20balances.%20This%20allowed%20the%20exploit%20to%20infinite%20mint%20pool%20tokens%20to%20create%20a%20fraudulent%20claim%20on%20the%20entire%20contents%20of%20the%20pool.%0A%0A%0A%0A%0AAt%20the%20time%20of%20writing%2C%20the%20%5Bc0ffeebabe.eth%5D(https%3A%2F%2Fetherscan.io%2Faddress%2F0xc0ffeebabe5d496b2dde509f9fa189c25cf29671)%20address%20appears%20to%20be%20a%20whitehat%20and%20is%20working%20with%20the%20Curve%20team%20to%20recover%20funds%20(as%20seen%20in%20on-chain%20messages%20%5Bhere%5D(https%3A%2F%2Fetherscan.io%2Ftx%2F0x65670d8e4f08d56971d476b0c68ca745b0749ec7f79f9b79d993ef47cc91b9c6)%20and%20%5Bhere%5D(https%3A%2F%2Fetherscan.io%2Ftx%2F0x31f9e6bc4f0cc4a7b430811ab462349b427ca358697b35cacfe3770c8f4d909e)).%20The%20address%20was%20also%20involved%20with%20the%20CRV%2FETH%20pool%20exploit%20described%20below%20and%20has%20returned%20proceeds%20from%20that.%20However%2C%20the%20address%20is%20still%20in%20possession%20of%20the%20msETH%20and%20ETH%20attained%20from%20the%20msETH%2FETH%20pool%20exploit.%0A%0AThe%20msETH%2FETH%20Curve%20pool%20contained%20~%244.1m%20TVL%20at%20the%20time%20of%20the%20incident%2C%20and%20essentially%20all%20funds%20have%20since%20been%20drained%20or%20otherwise%20removed%20by%20users.%20While%20the%20emergency%20DAO%20is%20unable%20to%20take%20action%20to%20pause%20the%20pool%20or%20influence%20user%20funds%20in%20any%20way%2C%20it%20is%20able%20to%20freeze%20CRV%20gauge%20emissions%20to%20the%20pool.%20This%20action%20is%20expected%20shortly.%0A%0A%0A%23%23%20alETH%2FETH%20Pool%20Exploit%0A%5BExploit%20tx%5D(https%3A%2F%2Fetherscan.io%2Ftx%2F0xb676d789bb8b66a08105c844a49c2bcffb400e5c1cfabd4bc30cca4bff3c9801)%0A%0AOn%20July%2030th%20at%2015%3A34%20UTC%2C%20an%20exploit%20occurred%20that%20drained%20alETH%20from%20the%20Curve%20pool.%20The%20attacker%20retained%20a%20profit%20of%207%2C258.70%20ETH%20(~%2413.6m)%20and%204%2C821.55%20alETH%20(~9m).%0A%0A!%5B%5D(https%3A%2F%2Fhackmd.io%2F_uploads%2FH1IolWSs2.png)%0ASource%3A%20%5BPhalcon%20Explorer%5D(https%3A%2F%2Fexplorer.phalcon.xyz%2Ftx%2Feth%2F0xb676d789bb8b66a08105c844a49c2bcffb400e5c1cfabd4bc30cca4bff3c9801)%0A%0AThe%20exploit%20logic%20was%20as%20follows%3A%0A%0A-%20The%20exploiter%20opened%20an%2040%2C000%20WETH%20flash%20loan%20from%20%5BBalancer%5D(https%3A%2F%2Fetherscan.io%2Faddress%2F0xba12222222228d8ba445958a75a0704d566bf2c8)%20and%20unwrapped%20all%20to%20ETH.%0A-%20They%20provided%2020%2C000%20ETH%20as%20liquidity%20to%20the%20Curve%20%5BalETH%2FETH%20pool%5D(https%3A%2F%2Fetherscan.io%2Ftoken%2F0xc4c319e2d4d66cca4464c0c2b32c9bd23ebe784e)%20and%20received%2019%2C895.21%20alETH-ETH%20LP%20tokens.%0A-%204%2C821.55%20alETH%20and%2015%2C146.77%20ETH%20was%20removed%20from%20the%20pool%20by%20burning%2019%2C895.21%20%5BalETH%2FETH%20pool%5D(https%3A%2F%2Fetherscan.io%2Ftoken%2F0xc4c319e2d4d66cca4464c0c2b32c9bd23ebe784e)%20LP%20tokens.%0A-%20They%20again%20provided%2020%2C000%20ETH%20as%20liquidity%20to%20the%20Curve%20%5BalETH%2FETH%20pool%5D(https%3A%2F%2Fetherscan.io%2Ftoken%2F0xc4c319e2d4d66cca4464c0c2b32c9bd23ebe784e)%2C%20minting%2034%2C277.05%20more%20LP%20tokens.%0A-%2015%2C910.04%20alETH%2FETH%20LP%20token%20was%20burned%20to%20withdraw%2032%2C111.92%20ETH%20(this%20was%20a%20removeLiquidityOne%20call).%0A-%2047%2C258.70%20ETH%20was%20wrapped%20to%20WETH.%0A-%2040%2C000%20WETH%20repaid%20to%20%5BBalancer%5D(https%3A%2F%2Fetherscan.io%2Faddress%2F0xba12222222228d8ba445958a75a0704d566bf2c8)%20to%20return%20the%20flash%20loan.%0A-%207%2C258.70%20WETH%20(~%2413.6%20m)%20and%204%2C821.55%20alETH%20(~9m)%20was%20retained%20as%20profit.%0A%0AThe%20reentrancy%20occurred%20between%20the%20remove%20liquidity%20and%20add%20liquidity%20actions.%20A%20pool%20depositor%20should%20ordinarily%20be%20entitled%20to%20pool%20tokens%20equal%20to%20the%20product%20of%20the%20%20total%20pool%20token%20supply%20and%20the%20the%20fraction%20of%20the%20depositor%E2%80%99s%20supplied%20liquidity.%20However%2C%20due%20to%20the%20reentrancy%20bug%2C%20the%20allotted%20pool%20tokens%20were%20calculated%20with%20the%20pre-burn%20balances.%20This%20allowed%20the%20exploit%20to%20infinite%20mint%20pool%20tokens%20to%20create%20a%20fraudulent%20claim%20on%20the%20entire%20contents%20of%20the%20pool.%0A%0A%0A%0AAt%20the%20time%20of%20writing%2C%20the%20funds%20are%20held%20in%20the%20%5BalETH%20Exploit%5D(https%3A%2F%2Fetherscan.io%2Faddress%2F0xdce5d6b41c32f578f875efffc0d422c57a75d7d8)%20wallet%20address.%0A%0APrior%20to%20the%20exploit%2C%20Alchemix%20was%20able%20to%20withdraw%208%2C027.35%20alETH%20from%20the%20pool%20(%5Btx%5D(https%3A%2F%2Fetherscan.io%2Ftx%2F0x20d00acdfbaeffa5fe618ecbcbb8c13df80133cb6d964f9a7ab6a5a7b0d796f3)).%20As%20disclosed%20in%20this%20%5BTwitter%20post%5D(https%3A%2F%2Ftwitter.com%2FAlchemixFi%2Fstatus%2F1685737632133971968%3Fs%3D20)%2C%20Alchemix%20was%20in%20the%20process%20to%20remove%205%2C000%20ETH%20from%20its%20AMO%20when%20they%20were%20frontrun%20by%20the%20exploiter.%20This%20has%20resulted%20in%20a%20partial%20loss%20of%20backing%20for%20alETH.%20%0A%0AThe%20alETH%2FETH%20Curve%20pool%20contained%20~%2446m%20TVL%20at%20the%20time%20of%20the%20incident%2C%20and%20essentially%20all%20funds%20have%20since%20been%20drained%20or%20otherwise%20removed%20by%20users.%20While%20the%20emergency%20DAO%20is%20unable%20to%20take%20action%20to%20pause%20the%20pool%20or%20influence%20user%20funds%20in%20any%20way%2C%20it%20is%20able%20to%20freeze%20CRV%20gauge%20emissions%20to%20the%20pool.%20This%20action%20is%20expected%20shortly.%0A%0A%23%23%20CRV%2FETH%20Pool%20Exploit%0A%0AThere%20were%202%20exploit%20transactions%20involved%20with%20the%20CRV%2FETH%20pool%20(the%20second%20being%20a%20whitehat).%0A%0A%5BExploit%20tx1%5D(https%3A%2F%2Fetherscan.io%2Ftx%2F0x2e7dc8b2fb7e25fd00ed9565dcc0ad4546363171d5e00f196d48103983ae477c)%0A%5BExploit%20tx2%5D(https%3A%2F%2Fetherscan.io%2Ftx%2F0xcd99fadd7e28a42a063e07d9d86f67c88e10a7afe5921bd28cd1124924ae2052)%0A%0A**Exploit%201**%20%20%0AOn%20July%2030th%20at%2019%3A08%20UTC%2C%20an%20exploit%20occurred%20that%20drained%20CRV%20and%20ETH%20from%20the%20Curve%20pool.%20The%20attacker%20retained%207%2C193%2C401.77%20CRV%20(~%245.1m%20at%20time%20of%20exploit)%20and%207%2C680.49%20WETH%20(~%2414.2m)%20as%20profit.%0A%0A!%5B%5D(https%3A%2F%2Fhackmd.io%2F_uploads%2FrJjbxGHjh.png)%0ASource%3A%20%5BPhalcon%20Explorer%5D(https%3A%2F%2Fexplorer.phalcon.xyz%2Ftx%2Feth%2F0x2e7dc8b2fb7e25fd00ed9565dcc0ad4546363171d5e00f196d48103983ae477c%3Fline%3D11)%0A%0AThe%20exploit%20logic%20was%20as%20follows%3A%0A%0A-%20The%20exploiter%20opened%20a%2010%2C000%20WETH%20flash%20loan%20from%20%5BBalancer%5D(https%3A%2F%2Fetherscan.io%2Faddress%2F0xba12222222228d8ba445958a75a0704d566bf2c8)%20and%20unwrapped%20all%20to%20ETH.%0A-%20They%20provided%20400%20ETH%20as%20liquidity%20to%20the%20Curve%20CRV%2FETH%20pool%20and%20received%209%2C804.78%20CRV%2FETH%20LP%20tokens.%0A-%20Swap%20500%20ETH%20for%201%2C212%2C778.28%20CRV.%0A-%20Withdraw%20517%2C589.04%20CRV%20and%20203.26%20ETH%20from%20the%20pool%2C%20burning%204%2C674.13%20CRV%2FETH%20LP%20tokens.%0A-%20Withdraw%201%2C730%2C367.33%20CRV%2C%20burning%204%2C674.13%20CRV%2FETH%20LP%20tokens.%0A-%20Swap%201%2C730%2C367.33%20CRV%20for%20639.89%20ETH.%0A-%20Repeat%20the%20process%20until%20CRV%20has%20been%20drained%20from%20the%20pool.%0A-%207%2C193%2C401.77%20CRV%20(~%245.1m%20at%20time%20of%20exploit)%20and%207%2C680.49%20WETH%20(~%2414.2m)%20was%20retained%20as%20profit.%0A%0AThe%20reentrancy%20occurred%20between%20the%20remove%20liquidity%20and%20add%20liquidity%20actions.%20A%20pool%20depositor%20should%20ordinarily%20be%20entitled%20to%20pool%20tokens%20equal%20to%20the%20product%20of%20the%20%20total%20pool%20token%20supply%20and%20the%20the%20fraction%20of%20the%20depositor%E2%80%99s%20supplied%20liquidity.%20However%2C%20due%20to%20the%20reentrancy%20bug%2C%20the%20allotted%20pool%20tokens%20were%20calculated%20with%20the%20pre-burn%20balances.%20This%20allowed%20the%20exploit%20to%20infinite%20mint%20pool%20tokens%20to%20create%20a%20fraudulent%20claim%20on%20the%20entire%20contents%20of%20the%20pool.%0A%0AThis%20exploit%20is%20unique%20because%20an%20arbitrage%20exploit%20was%20also%20conducted%20in%20addition%20to%20the%20%22reentrancy%20guard%20bug%22%20exploit%20(which%20affected%20all%20four%20pools).%20The%20reason%20for%20this%20is%20that%20the%20CRV-ETH%20pool%20is%20the%20only%20non-stable%20pool%20exploited%20in%20this%20event.%0A%0AAt%20the%20time%20of%20writing%2C%20the%20funds%20have%20been%20transferred%20to%20a%20%5BCRV%2FETH%20Exploit%5D(https%3A%2F%2Fetherscan.io%2Faddress%2F0xb1c33b391c2569b737ec387e731e88589e8ec148)%20wallet%20address.%20%0A%0A%0A**Exploit%202**%0AOn%20July%2030th%20at%2022%3A00%20UTC%2C%20a%20second%20exploit%20occurred%20that%20drained%202%2C879.65%20ETH%20remaining%20in%20the%20pool.%20This%20was%20a%20whitehat%20action%20by%20c0ffeebabe.eth%20and%20the%20proceeds%20were%20returned%20to%20the%20Curve%20team%20shortly%20thereafter%20(%5Btx%5D(https%3A%2F%2Fetherscan.io%2Ftx%2F0xb76754124fdde090f25129105ed2907e3c62e0db87ecb8ffcefcb1dede0954fd)).%0A%0A!%5B%5D(https%3A%2F%2Fhackmd.io%2F_uploads%2FH1MXSfrjh.png)%0ASource%3A%20%5BPhalcon%20Explorer%5D(https%3A%2F%2Fexplorer.phalcon.xyz%2Ftx%2Feth%2F0xcd99fadd7e28a42a063e07d9d86f67c88e10a7afe5921bd28cd1124924ae2052)%0A%0AThe%20exploit%20logic%20was%20as%20follows%3A%0A%0A-%20The%20exploiter%20opened%20a%20100%20WETH%20flash%20loan%20from%20%5BBalancer%5D(https%3A%2F%2Fetherscan.io%2Faddress%2F0xba12222222228d8ba445958a75a0704d566bf2c8).%0A-%20They%20swapped%2070%20WETH%20for%20190%2C388.61%20CRV%20on%20Uniswap.%0A-%20Deposit%2030%2C000%20CRV%20to%20the%20pool.%0A-%20Claim%20admin%20fees%20to%20Curve%20Pool%20Owner%20for%201%2C493.16%20CRV%2FETH%20LP%20tokens.%0A-%20Swap%20160%2C388.61%20CRV%20for%202%2C949.65%20WETH%20in%20the%20pool.%0A-%20Claim%20admin%20fees%20to%20Curve%20Pool%20Owner%20for%2083%2C647.01%20CRV%2FETH%20LP%20tokens.%0A-%20100%20WETH%20repaid%20to%20%5BBalancer%5D(https%3A%2F%2Fetherscan.io%2Faddress%2F0xba12222222228d8ba445958a75a0704d566bf2c8)%20to%20return%20the%20flash%20loan.%0A-%202%2C879.65%20ETH%20(~%245.4m)%20was%20retained%20from%20the%20exploit.%0A%0AFollowing%20the%20first%20exploit%2C%20the%20pool%20had%20broken%20balances.%20It%20thought%20it%20contained%20a%20CRV%20balance%2C%20while%20in%20reality%20all%20CRV%20had%20been%20drained%20in%20the%20first%20hack.%20By%20depositing%20some%20CRV%20and%20calling%20%60claim_admin_fees%60%2C%20the%20pool%20balance%20could%20be%20synced.%20The%20hacker%20donated%20CRV%20to%20the%20pool%2C%20synced%20balances%2C%20and%20then%20exchanged%20a%20few%20CRV%20for%20most%20of%20the%20ETH.%0A%0AAt%20the%20time%20of%20writing%2C%20the%20funds%20have%20been%20returned%20to%20the%20Curve%20Deployer%20address%20in%20this%20%5Btx%5D(https%3A%2F%2Fetherscan.io%2Ftx%2F0xb76754124fdde090f25129105ed2907e3c62e0db87ecb8ffcefcb1dede0954fd).%0A%0AThe%20CRV%2FETH%20Curve%20pool%20contained%20~%2447m%20TVL%20at%20the%20time%20of%20the%20incident%2C%20and%20most%20funds%20have%20since%20been%20drained%20or%20removed%20by%20users.%20The%20pool%20still%20contains%20some%20ETH%2C%20which%20existing%20LPs%20can%20withdraw%20by%20calling%20%60remove_liquidity_one_coin%60.%20%0A%0AWhile%20the%20emergency%20DAO%20is%20unable%20to%20take%20action%20to%20pause%20the%20pool%20or%20handle%20user%20funds%20in%20any%20way%2C%20it%20is%20able%20to%20freeze%20CRV%20gauge%20emissions%20to%20the%20pool.%20This%20action%20is%20expected%20shortly.%20%0A%0A%23%23%20Next%20Steps%0AImmediate%20next%20steps%20are%20to%20kill%20gauge%20emissions%20to%20the%20affected%20pools%20and%20create%20new%20plain%20pools%20for%20alETH%2C%20msETH%2C%20and%20pETH.%20New%20pools%20should%20be%20paired%20with%20WETH%20or%20the%20new%20ETH%20pool%20implementation.%20CRV%20already%20has%20a%20new%20%5BTricrypto%20pool%5D(https%3A%2F%2Fcurve.fi%2F%23%2Fethereum%2Fpools%2Ffactory-tricrypto-4%2Fdeposit)%20paired%20with%20crvUSD%20and%20ETH%20that%20is%20not%20affected%20by%20the%20reentrancy%20bug.%0A%0AThe%20Curve%20team%20will%20continue%20to%20explore%20all%20avenues%20for%20the%20recovery%20of%20user%20funds%20and%20updates%20on%20the%20situation%20will%20be%20made%20on%20the%20social%20channels%20(Twitter%2C%20Telegram%2C%20and%20Discord).%0A%0A","viewMode":"publish","isOwner":false,"isSignIn":false,"isLiked":false,"isBookmarked":false,"publishType":"view","commentCount":0,"isNotesRecommendationsEnabled":true,"recommendedNotes":[{"id":"047eb8cb-2888-447d-af3c-3cb1635fc582","title":"Addendum%20to%20Collateral%20Risk%20Assessment%20-%20Threshold%20BTC%20(tBTC)","brief":"Update%20No%3A%201%20%7C%20May%2013th%2C%202024Referenced%20Report%3A%20Collateral%20Risk%20Assessment-%20tBTC%20%7C%20November%201%2C%202023","lastchangeAt":"2024-05-16T22%3A44%3A39.365Z","publishLink":"%40LlamaRisk%2FtBTC-addendum-1"},{"id":"4a36cc34-3591-4846-9d18-df33900cb8ae","title":"Pegkeeper%20Onboarding%20Review%3A%20PayPal%20USD%20(PYUSD)","brief":"In%20this%20report%2C%20we%20will%20analyze%20staked%20PayPal%20USD%20(PYUSD)%20as%20a%20potential%20pegkeeper%20asset%20for%20crvUSD.%20The%20objective%20of%20this%20analysis%20is%20to%20comprehensively%20assess%20the%20risks%20associated%20with%20PYUSD%20to%20determine%20its%20suitability%20for%20pegkeeper%20onboarding.%20Our%20evaluation%20will%20employ%20both%20quantitative%20and%20qualitative%20methods%2C%20providing%20insights%20into%20the%20safety%20of%20integrating%20PYUSD%20and%20recommending%20any%20necessary%20exposure%20restrictions.","lastchangeAt":"2024-04-03T22%3A43%3A57.166Z","publishLink":"%40LlamaRisk%2FPYUSD"},{"id":"0cf591d2-6702-47b0-95ec-e5ec6bde5f41","title":"Collateral%20Risk%20Assessment%3A%20Staked%20Frax%20(sFRAX)","brief":"LlamaRisk_sFRAX","lastchangeAt":"2023-12-07T21%3A22%3A46.505Z","publishLink":"%40LlamaRisk%2FsFRAX"},{"id":"fe9d7113-85a4-4371-8418-080b586cc02b","title":"Collateral%20Risk%20Assessment%3A%20Threshold%20BTC%20(tBTC)","brief":"Threshold%20Network","lastchangeAt":"2023-12-06T06%3A17%3A21.026Z","publishLink":"%40LlamaRisk%2FtBTC"}],"lastChangeUserInfo":{"name":"Llama%20Risk","path":"LlamaRisk","avatarUrl":"https%3A%2F%2Fuploads-public.hackmd.io%2Fupload_c022f1a31209d627d1952da185a6244f.png"}}`);
  (function () {
    const decodeStringProps = (props) => {
      for (const key in props) {
        if (typeof props[key] === 'string') {
          props[key] = decodeURIComponent(props[key])
        } else if (typeof props[key] === 'object') {
          decodeStringProps(props[key])
        }
      }
    }
    decodeStringProps(window.publishProps)
  })()
</script>

    <script src="https://tally.so/widgets/embed.js"></script>

    
</head>

<body style="display:none;">
    <div id="toasts-container" class="toasts-container z-[2000]"></div>
    <div id="publish-page">![](https://hackmd.io/_uploads/S1xvzFHj2.png)

## Summary
- A bug within older versions of the Vyper compiler caused a failure in a security feature used by a limited set of Curve pools (see affected pools below).
- As a result attackers were able to drain the affected pools of their tokens.
- The exploit comes directly at the expense of Curve liquidity providers for these affected pools, although Curve is attempting to contact exploiters and recover user funds.
- Thanks to a white hat, a portion of tokens from one affected pool were recovered by the DAO.
- The Curve eDAO cannot pause Curve pools or handle user funds in any way. However, it can kill CRV gauge emissions to Curve pools. It is expected the eDAO will kill gauge emissions to all affected pools.
- For more information: 
    - join the [Curve Announcements TG](https://t.me/curvefiann), 
    - follow [Curve Finance](https://twitter.com/CurveFinance) on Twitter,
    - join the [Curve TG](https://t.me/curvefi) group
    - join the [Curve Discord](https://discord.gg/rgrfS7W)

## Exploit Overview
On July 30th between 13:10 and 22:00 UTC, a series of exploits resulted in loss of funds from several Curve pools. The source of the vulnerability in each case is a malfunctioning reentrancy lock in certain versions of Vyper.

Affected pools and amount extracted by each exploit:
- [pETH/ETH](https://curve.fi/#/ethereum/pools/factory-v2-194/deposit) | 6,106.65 WETH (~$11m)
- [msETH/ETH](https://curve.fi/#/ethereum/pools/factory-v2-252/deposit) | 866.55 WETH (~$1.6 m) and 959.71 msETH (~$1.8m)
- [alETH/ETH](https://curve.fi/#/ethereum/pools/factory-v2-38/deposit) | 7,258.70 WETH (~$13.6 m) and 4,821.55 alETH (~9m)
- [CRV/ETH](https://curve.fi/#/ethereum/pools/crveth/deposit) | 7,193,401.77 CRV (~$5.1m at time of exploit), 7,680.49 WETH (~$14.2m), and 2,879.65 ETH (~$5.4m)

Another pool potentially affected is [Arbitrum’s Tricrypto](https://curve.fi/#/arbitrum/pools/tricrypto/deposit) pool. Auditors and Vyper devs could not find a profitable exploit, **but Curve is advising LPs to exit that pool as a precaution.**

On July 30th at 16:44 UTC, Vyper official Twitter acknowledged a bug affecting Vyper versions 0.2.15, 0.2.16, and 0.3.0. The compiler had a bug which negated the reentrancy protection. This bug was patched in version 0.3.1 (accidentally, as the bug remained unknown until July 30th). All contracts after 0.3.1 are in general without this bugged reentrancy guard.


![](https://hackmd.io/_uploads/B1ruTSEo2.png)
Source: [Twitter](https://twitter.com/vyperlang/status/1685692973051498497)

The bug was introduced in this PR: [#2391](https://github.com/vyperlang/vyper/pull/2391)
The bug was patched in PRs: [#2439](https://github.com/vyperlang/vyper/pull/2439) and [#2514](https://github.com/vyperlang/vyper/pull/2514)

Curve&#39;s contracts become vulnerable when making a raw_call to send native tokens. The affected Curve pools were each using one of the aforementioned Vyper versions and are paired with native ETH. Tokens using the ERC-777 standard have also been affected, although Curve pools involving these tokens have all largely been deprecated (e.g. [pBTC](https://curve.fi/#/ethereum/pools/factory-v2-99/deposit) and [HOME](https://curve.fi/#/ethereum/pools/factory-v2-123/deposit)). ERC-777 adds callbacks, making those pools susceptible to the same reentrancy issue. Pools paired with WETH **have not** been affected.

There appear to be multiple actors involved with the exploits and at least one is working with the Curve team to recover funds. 2,879.65 ETH (~$5.4m) extracted from the CRV/ETH pool by c0ffeebabe.eth has been returned to the Curve team.  

## Arbitrum Tricrypto Alert

The [Arbitrum Tricrypto pool](https://curve.fi/#/arbitrum/pools/tricrypto/deposit) might be at risk of being exploited. While security researchers have not identified a profitable exploit, Curve is recommending users to exit this pool in an abundance of caution.

![](https://hackmd.io/_uploads/BJc-yH_jh.png)
Source: [Twitter](https://twitter.com/CurveFinance/status/1685925429041917952?s=20)

## pETH/ETH Pool Exploit
[Exploit tx](https://etherscan.io/tx/0xa84aa065ce61dbb1eb50ab6ae67fc31a9da50dd2c74eefd561661bfce2f1620c)

On July 30th at 13:10 UTC, an exploit occurred that drained pETH from the Curve pool. The attacker swapped pETH to WETH for a profit of 6,106.65 WETH (~$11m).

![](https://hackmd.io/_uploads/S1EhxxBs3.png)
Source: [Phalcon Explorer](https://ethtx.info/mainnet/0xa84aa065ce61dbb1eb50ab6ae67fc31a9da50dd2c74eefd561661bfce2f1620c/) 

The exploit logic was as follows:
- The exploiter opened an 80,000 WETH flash loan from [Balancer](https://etherscan.io/address/0xba12222222228d8ba445958a75a0704d566bf2c8) and unwrapped all to ETH.
- They provided 40,000 ETH as liquidity to the Curve [pETH/ETH pool](https://etherscan.io/token/0x9848482da3ee3076165ce6497eda906e66bb85c5) and received 32,431.41 pETH-ETH LP tokens.
- 3,740 pETH and 34,316 ETH was removed from the pool by burning 32,431.41 [pETH/ETH pool](https://etherscan.io/token/0x9848482da3ee3076165ce6497eda906e66bb85c5) LP tokens.
- They again provided 40,000 ETH as liquidity to the Curve [pETH/ETH pool](https://etherscan.io/token/0x9848482da3ee3076165ce6497eda906e66bb85c5), minting 82,182 more LP tokens.
- Another 1,184.73 pETH and 47,506.53 ETH was withdrawn by burning 10,272.84 Curve LP tokens.
- 4,924 pETH was swapped for 4,285 ETH within the Curve pool.
- 86,106.65 ETH was wrapped to WETH.
- 80,000 WETH repaid to [Balancer](https://etherscan.io/address/0xba12222222228d8ba445958a75a0704d566bf2c8) to return the flash loan.
- 6,106.65 WETH ~$11 million was retained as profit.

The reentrancy occurred between the remove liquidity and add liquidity actions. A pool depositor should ordinarily be entitled to pool tokens equal to the product of the  total pool token supply and the the fraction of the depositor’s supplied liquidity. However, due to the reentrancy bug, the allotted pool tokens were calculated with the pre-burn balances. This allowed the exploit to infinite mint pool tokens to create a fraudulent claim on the entire contents of the pool.

 


At time of writing, the funds are held in the [JPEGd_69 Exploit](https://etherscan.io/address/0x6ec21d1868743a44318c3c259a6d4953f9978538) wallet address.

The pETH/ETH Curve pool contained ~$21m TVL at the time of the incident, and all funds have since been drained or otherwise removed by users. While the emergency DAO is unable to take action to pause the pool or influence user funds in any way, it is able to freeze CRV gauge emissions to the pool. This action is expected shortly.

## msETH/ETH Pool Exploit
[Exploit tx](https://etherscan.io/tx/0xc93eb238ff42632525e990119d3edc7775299a70b56e54d83ec4f53736400964)

On July 30th at 14:50 UTC, an exploit occurred that drained msETH from the Curve pool. The attacker retained a profit of 866.55 ETH (~$1.6m) and 959.71 msETH (~$1.8).

![](https://hackmd.io/_uploads/ByG6oxBoh.png)
Source: [Phalcon Explorer](https://explorer.phalcon.xyz/tx/eth/0xc93eb238ff42632525e990119d3edc7775299a70b56e54d83ec4f53736400964)

The exploit logic was as follows:
- The exploiter opened an 10,000 WETH flash loan from [Balancer](https://etherscan.io/address/0xba12222222228d8ba445958a75a0704d566bf2c8) and unwrapped all to ETH.
- They provided 5,000 ETH as liquidity to the Curve [msETH/ETH pool](https://etherscan.io/token/0xc897b98272aa23714464ea2a0bd5180f1b8c0025) and received 4,984.26 alETH-ETH LP tokens.
- 959.71 msETH and 4,036.22 ETH was removed from the pool by burning 4,984.26 [msETH/ETH pool](https://etherscan.io/token/0xc897b98272aa23714464ea2a0bd5180f1b8c0025) LP tokens.
- They again provided 5,000 ETH as liquidity to the Curve [msETH/ETH pool](https://etherscan.io/token/0xc897b98272aa23714464ea2a0bd5180f1b8c0025), minting 11,192.69 more LP tokens.
- 2,260.72 msETH/ETH LP token was burned to withdraw 6,830.50 ETH (this was a removeLiquidityOne call).
- 10,866.72 ETH was wrapped to WETH.
- 10,000 WETH repaid to [Balancer](https://etherscan.io/address/0xba12222222228d8ba445958a75a0704d566bf2c8) to return the flash loan.
- 866.55 WETH (~$1.6 m) and 959.71 msETH (~$1.8m) was retained as profit.

The reentrancy occurred between the remove liquidity and add liquidity actions. A pool depositor should ordinarily be entitled to pool tokens equal to the product of the  total pool token supply and the the fraction of the depositor’s supplied liquidity. However, due to the reentrancy bug, the allotted pool tokens were calculated with the pre-burn balances. This allowed the exploit to infinite mint pool tokens to create a fraudulent claim on the entire contents of the pool.




At the time of writing, the [c0ffeebabe.eth](https://etherscan.io/address/0xc0ffeebabe5d496b2dde509f9fa189c25cf29671) address appears to be a whitehat and is working with the Curve team to recover funds (as seen in on-chain messages [here](https://etherscan.io/tx/0x65670d8e4f08d56971d476b0c68ca745b0749ec7f79f9b79d993ef47cc91b9c6) and [here](https://etherscan.io/tx/0x31f9e6bc4f0cc4a7b430811ab462349b427ca358697b35cacfe3770c8f4d909e)). The address was also involved with the CRV/ETH pool exploit described below and has returned proceeds from that. However, the address is still in possession of the msETH and ETH attained from the msETH/ETH pool exploit.

The msETH/ETH Curve pool contained ~$4.1m TVL at the time of the incident, and essentially all funds have since been drained or otherwise removed by users. While the emergency DAO is unable to take action to pause the pool or influence user funds in any way, it is able to freeze CRV gauge emissions to the pool. This action is expected shortly.


## alETH/ETH Pool Exploit
[Exploit tx](https://etherscan.io/tx/0xb676d789bb8b66a08105c844a49c2bcffb400e5c1cfabd4bc30cca4bff3c9801)

On July 30th at 15:34 UTC, an exploit occurred that drained alETH from the Curve pool. The attacker retained a profit of 7,258.70 ETH (~$13.6m) and 4,821.55 alETH (~9m).

![](https://hackmd.io/_uploads/H1IolWSs2.png)
Source: [Phalcon Explorer](https://explorer.phalcon.xyz/tx/eth/0xb676d789bb8b66a08105c844a49c2bcffb400e5c1cfabd4bc30cca4bff3c9801)

The exploit logic was as follows:

- The exploiter opened an 40,000 WETH flash loan from [Balancer](https://etherscan.io/address/0xba12222222228d8ba445958a75a0704d566bf2c8) and unwrapped all to ETH.
- They provided 20,000 ETH as liquidity to the Curve [alETH/ETH pool](https://etherscan.io/token/0xc4c319e2d4d66cca4464c0c2b32c9bd23ebe784e) and received 19,895.21 alETH-ETH LP tokens.
- 4,821.55 alETH and 15,146.77 ETH was removed from the pool by burning 19,895.21 [alETH/ETH pool](https://etherscan.io/token/0xc4c319e2d4d66cca4464c0c2b32c9bd23ebe784e) LP tokens.
- They again provided 20,000 ETH as liquidity to the Curve [alETH/ETH pool](https://etherscan.io/token/0xc4c319e2d4d66cca4464c0c2b32c9bd23ebe784e), minting 34,277.05 more LP tokens.
- 15,910.04 alETH/ETH LP token was burned to withdraw 32,111.92 ETH (this was a removeLiquidityOne call).
- 47,258.70 ETH was wrapped to WETH.
- 40,000 WETH repaid to [Balancer](https://etherscan.io/address/0xba12222222228d8ba445958a75a0704d566bf2c8) to return the flash loan.
- 7,258.70 WETH (~$13.6 m) and 4,821.55 alETH (~9m) was retained as profit.

The reentrancy occurred between the remove liquidity and add liquidity actions. A pool depositor should ordinarily be entitled to pool tokens equal to the product of the  total pool token supply and the the fraction of the depositor’s supplied liquidity. However, due to the reentrancy bug, the allotted pool tokens were calculated with the pre-burn balances. This allowed the exploit to infinite mint pool tokens to create a fraudulent claim on the entire contents of the pool.



At the time of writing, the funds are held in the [alETH Exploit](https://etherscan.io/address/0xdce5d6b41c32f578f875efffc0d422c57a75d7d8) wallet address.

Prior to the exploit, Alchemix was able to withdraw 8,027.35 alETH from the pool ([tx](https://etherscan.io/tx/0x20d00acdfbaeffa5fe618ecbcbb8c13df80133cb6d964f9a7ab6a5a7b0d796f3)). As disclosed in this [Twitter post](https://twitter.com/AlchemixFi/status/1685737632133971968?s=20), Alchemix was in the process to remove 5,000 ETH from its AMO when they were frontrun by the exploiter. This has resulted in a partial loss of backing for alETH. 

The alETH/ETH Curve pool contained ~$46m TVL at the time of the incident, and essentially all funds have since been drained or otherwise removed by users. While the emergency DAO is unable to take action to pause the pool or influence user funds in any way, it is able to freeze CRV gauge emissions to the pool. This action is expected shortly.

## CRV/ETH Pool Exploit

There were 2 exploit transactions involved with the CRV/ETH pool (the second being a whitehat).

[Exploit tx1](https://etherscan.io/tx/0x2e7dc8b2fb7e25fd00ed9565dcc0ad4546363171d5e00f196d48103983ae477c)
[Exploit tx2](https://etherscan.io/tx/0xcd99fadd7e28a42a063e07d9d86f67c88e10a7afe5921bd28cd1124924ae2052)

**Exploit 1**  
On July 30th at 19:08 UTC, an exploit occurred that drained CRV and ETH from the Curve pool. The attacker retained 7,193,401.77 CRV (~$5.1m at time of exploit) and 7,680.49 WETH (~$14.2m) as profit.

![](https://hackmd.io/_uploads/rJjbxGHjh.png)
Source: [Phalcon Explorer](https://explorer.phalcon.xyz/tx/eth/0x2e7dc8b2fb7e25fd00ed9565dcc0ad4546363171d5e00f196d48103983ae477c?line=11)

The exploit logic was as follows:

- The exploiter opened a 10,000 WETH flash loan from [Balancer](https://etherscan.io/address/0xba12222222228d8ba445958a75a0704d566bf2c8) and unwrapped all to ETH.
- They provided 400 ETH as liquidity to the Curve CRV/ETH pool and received 9,804.78 CRV/ETH LP tokens.
- Swap 500 ETH for 1,212,778.28 CRV.
- Withdraw 517,589.04 CRV and 203.26 ETH from the pool, burning 4,674.13 CRV/ETH LP tokens.
- Withdraw 1,730,367.33 CRV, burning 4,674.13 CRV/ETH LP tokens.
- Swap 1,730,367.33 CRV for 639.89 ETH.
- Repeat the process until CRV has been drained from the pool.
- 7,193,401.77 CRV (~$5.1m at time of exploit) and 7,680.49 WETH (~$14.2m) was retained as profit.

The reentrancy occurred between the remove liquidity and add liquidity actions. A pool depositor should ordinarily be entitled to pool tokens equal to the product of the  total pool token supply and the the fraction of the depositor’s supplied liquidity. However, due to the reentrancy bug, the allotted pool tokens were calculated with the pre-burn balances. This allowed the exploit to infinite mint pool tokens to create a fraudulent claim on the entire contents of the pool.

This exploit is unique because an arbitrage exploit was also conducted in addition to the &#34;reentrancy guard bug&#34; exploit (which affected all four pools). The reason for this is that the CRV-ETH pool is the only non-stable pool exploited in this event.

At the time of writing, the funds have been transferred to a [CRV/ETH Exploit](https://etherscan.io/address/0xb1c33b391c2569b737ec387e731e88589e8ec148) wallet address. 


**Exploit 2**
On July 30th at 22:00 UTC, a second exploit occurred that drained 2,879.65 ETH remaining in the pool. This was a whitehat action by c0ffeebabe.eth and the proceeds were returned to the Curve team shortly thereafter ([tx](https://etherscan.io/tx/0xb76754124fdde090f25129105ed2907e3c62e0db87ecb8ffcefcb1dede0954fd)).

![](https://hackmd.io/_uploads/H1MXSfrjh.png)
Source: [Phalcon Explorer](https://explorer.phalcon.xyz/tx/eth/0xcd99fadd7e28a42a063e07d9d86f67c88e10a7afe5921bd28cd1124924ae2052)

The exploit logic was as follows:

- The exploiter opened a 100 WETH flash loan from [Balancer](https://etherscan.io/address/0xba12222222228d8ba445958a75a0704d566bf2c8).
- They swapped 70 WETH for 190,388.61 CRV on Uniswap.
- Deposit 30,000 CRV to the pool.
- Claim admin fees to Curve Pool Owner for 1,493.16 CRV/ETH LP tokens.
- Swap 160,388.61 CRV for 2,949.65 WETH in the pool.
- Claim admin fees to Curve Pool Owner for 83,647.01 CRV/ETH LP tokens.
- 100 WETH repaid to [Balancer](https://etherscan.io/address/0xba12222222228d8ba445958a75a0704d566bf2c8) to return the flash loan.
- 2,879.65 ETH (~$5.4m) was retained from the exploit.

Following the first exploit, the pool had broken balances. It thought it contained a CRV balance, while in reality all CRV had been drained in the first hack. By depositing some CRV and calling `claim_admin_fees`, the pool balance could be synced. The hacker donated CRV to the pool, synced balances, and then exchanged a few CRV for most of the ETH.

At the time of writing, the funds have been returned to the Curve Deployer address in this [tx](https://etherscan.io/tx/0xb76754124fdde090f25129105ed2907e3c62e0db87ecb8ffcefcb1dede0954fd).

The CRV/ETH Curve pool contained ~$47m TVL at the time of the incident, and most funds have since been drained or removed by users. The pool still contains some ETH, which existing LPs can withdraw by calling `remove_liquidity_one_coin`. 

While the emergency DAO is unable to take action to pause the pool or handle user funds in any way, it is able to freeze CRV gauge emissions to the pool. This action is expected shortly. 

## Next Steps
Immediate next steps are to kill gauge emissions to the affected pools and create new plain pools for alETH, msETH, and pETH. New pools should be paired with WETH or the new ETH pool implementation. CRV already has a new [Tricrypto pool](https://curve.fi/#/ethereum/pools/factory-tricrypto-4/deposit) paired with crvUSD and ETH that is not affected by the reentrancy bug.

The Curve team will continue to explore all avenues for the recovery of user funds and updates on the situation will be made on the social channels (Twitter, Telegram, and Discord).

</div>
    <!-- signin modal -->

<div class="modal fade signin-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="margin-top: 10px; right: 20px; position: absolute;"><span aria-hidden="true">&times;</span></button>
            






    









<h3>Sign in</h3>

<form data-toggle="validator" role="form" class="form-horizontal" method="post" enctype="application/x-www-form-urlencoded" id="signin-form">
    <div class="hmd-dn"><input type="hidden" name="_csrf" value="ZHkhTqA6-eo6lXVTkAkoieJRcBz-5yZiv5k8"></div>
    <div class="hmd-dn"><input type="hidden" name="create_team" value="false"></div>
    <div class="hmd-dn"><input type="hidden" name="create_paid_team" value="false"></div>
    
    <div class="form-group  ">
        <label for="email" class="control-label">Email</label>
        <label for="inputEmail" class="control-label pull-right errors">
            
        </label>
        <span class="help-block control-label with-errors pull-right" style="margin-top: 14px"></span>
        <div class="input-block">
            
                <input type="email" class="form-control" name="email" placeholder="Your email" required autocomplete="email">
            
            <span class="error-sign"></span>
        </div>
    </div>
    <div class="form-group ">
        <label for="password" class="control-label">Password</label>
        <label for="inputPassword" class="control-label pull-right errors">
            
        </label>
        <span class="help-block control-label with-errors pull-right" style="margin-top: 14px"></span>
        <div class="input-block">
            <input type="password" class="form-control" name="password" placeholder="Your password" required autocomplete="current-password" maxlength="128">
            <span class="error-sign"></span>
            
                <span class="control-label pull-right !text-normal !leading-normal !font-normal !mt-1.5"><a href="https://hackmd.io/settings/forgotPassword" style="text-decoration: underline;">Forgot password</a></span>
            
        </div>
    </div>

    <div style="text-align: center; padding-top: 15px; margin-bottom: 0px;">
        <div
            hidden
            id="hmd-captcha"
            data-provider=""
            data-captcha-data=""
            class="flex justify-center"
        ></div>

        
            <input type="submit" class="neo-btn neo-btn-primary !justify-center !py-3.5 !mx-auto" formaction="https://hackmd.io/login" value="Sign in">
        

        
    </div>
</form>














    
        <p class="separator">or</p>
    

    
        <p>By clicking below, you agree to our <a href="https://hackmd.io/s/terms" target="_blank">terms of service</a>.</p>
    

    












<script id="gsi-client" src="https://accounts.google.com/gsi/client" async defer nonce="dfd34372-6a78-4ad0-887d-ff8a46d9b545"></script>
<script nonce="dfd34372-6a78-4ad0-887d-ff8a46d9b545">
    function handleCredentialResponse(response) {
        const form = document.getElementById('sign-in-with-google-form')
        form.children.credential.value = response.credential
        form.children.method.value = location.href.toLowerCase() === 'https://hackmd.io/settings#general' ? 'merge' : 'login'
        form.submit()
    }
    var GSI_READY = new Promise(function (resolve) {
        function initialize () {
            google.accounts.id.initialize({
                client_id: '911617723593-drikdibvvn63slfd6kbqigo8ql1no55s.apps.googleusercontent.com',
                callback: handleCredentialResponse
            })
            const loginPath = '/login'
            const joinPath = '/join'
            const renderButton = function () {
                google.accounts.id.renderButton(
                    document.getElementById('sign-in-with-google-button'),
                    { type: 'standard', width: 250 }
                )
            }
            if (location.pathname.toLowerCase() === loginPath || location.pathname.toLowerCase() === joinPath) {
                renderButton()
            } else {
                $('.signin-modal').one('shown.bs.modal', function () {
                    renderButton()
                })
            }
            resolve()
        }

        window.addEventListener('load', function () { initialize() })
    })
</script>
<form class="hidden" id="sign-in-with-google-form" action="/auth/google" method="post">
    <input type="hidden" name="credential">
    <input type="hidden" name="method">
</form>


<div class="social-buttons-container">
    
    <div id="sign-in-with-google-button"></div>
    
    
    <a href="https://hackmd.io/auth/facebook" class="btn btn-lg btn-block btn-social btn-facebook">
        <i class="fa fa-facebook"></i> Sign in via Facebook
    </a>
    
    
    <a href="https://hackmd.io/auth/twitter" class="btn btn-lg btn-block btn-social btn-twitter">
        <i class="fa fa-twitter"></i> Sign in via Twitter
    </a>
    
    
    <a href="https://hackmd.io/auth/github" class="btn btn-lg btn-block btn-social btn-github">
        <i class="fa fa-github"></i> Sign in via GitHub
    </a>
    
    
    <a href="https://hackmd.io/auth/dropbox" class="btn btn-lg btn-block btn-social btn-dropbox">
        <i class="fa fa-dropbox"></i> Sign in via Dropbox
    </a>
    
    
    
      <a href="#" class="bg-white btn btn-block btn-social btn-web3 bg-gray-800 hocus:bg-[#2b2b2b] text-white hocus:text-white">
          <img src="https://hackmd.io/images/wallet.svg" style="max-height: 20px; margin-top: 8px; margin-left: 6px; border: none;">
          <span class="sign-in-wallet-text">
              Sign in with Wallet
          </span>

          <div class="inline-flex items-center justify-between w-full hidden web3-wallet-info">
              <span>
                   Wallet
                   (
                    <span class="web3-wallet-address"></span>
                   )
              </span>

              <i class="fa fa-arrow-right" aria-hidden="true"></i>
          </div>
      </a>

      <small class="web3-wallet-info hidden text-left hocus:text-white underline hocus:underline block pt-2 ui-disconnect-connected-wallets text-gray-600 cursor-pointer">
          Connect another wallet
      </small>
    
</div>




    <div >
        <p>New to HackMD? <a href="https://hackmd.io/join" class="plausible-event-name=LoginModalSignUp">Sign up</a></p>
    </div>




        </div>
    </div>
</div>

    
    <script src="https://www.googletagmanager.com/gtag/js?id=G-NGVZMM6DR6"></script>
    <script nonce="dfd34372-6a78-4ad0-887d-ff8a46d9b545">
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        let userid = (document.cookie.match('(^|; )userid=([^;]*)')||0)[2];
        gtag('config', 'G-NGVZMM6DR6', {'user_id': userid});
        
    </script>


    
<script src="https://browser.sentry-cdn.com/5.15.5/bundle.min.js" crossorigin="anonymous"></script>
<script nonce="dfd34372-6a78-4ad0-887d-ff8a46d9b545">Sentry.init({ dsn: 'https://73410f1915d84abc8b2dd1f1aabd1c82@sentry.hackmd.dev/4', environment: 'production', integrations: function (intrus) { return intrus.filter(function (itr) { return itr.name !== 'TryCatch' }) } });</script>


    
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KLW9Z3"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->



    <script src="https://hackmd.io/api/i18n.js"></script>
     <script src="https://assets.hackmd.io/build/font-vendor.eaa8dd82d4e056021b8c.js" defer="defer"></script><script src="https://assets.hackmd.io/build/common-vendor.04da453a2a68f624f4d4.js" defer="defer"></script><script src="https://assets.hackmd.io/build/pretty-vendor.94ca39727118897623cd.js" defer="defer"></script><script src="https://assets.hackmd.io/build/pretty-common.e537850a918313f6b528.js" defer="defer"></script><script src="https://assets.hackmd.io/build/pretty.542e7daea665107a9e4b.js" defer="defer"></script>

    

</body>
</html>
