<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- templates/en/article.html
     $Id: article.html,v 1.1 2020/01/27 18:39:21 karl Exp $ -->
<HTML>
 <HEAD>
   <TITLE>Possible SEGV (null pointer deref) in writet1.c - tex-live mailing list - TeX Users Group
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:tex-live%40tug.org?Subject=Re:%20Re%3A%20Possible%20SEGV%20%28null%20pointer%20deref%29%20in%20writet1.c&In-Reply-To=%3CCAHw3FwdNH_XNyw%3Dk%3DkAXVPYcFUqtGLcA-jev_FKcZyVSdkF66w%40mail.gmail.com%3E">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="049399.html">
   <LINK REL="Next"  HREF="049401.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
      <ul>
         <li><b><a href="../">Archives for this list</a></b>.</li>

         <li><b><a href="https://tug.org/mailman/listinfo/tex-live">More information about this list</a></b>,
         or <a href="https://lists.tug.org/">all TUG lists</a>
         (or <a href="/">TUG home page</a>).</li>

<li>
   <form method=get action="//duckduckgo.com/">
     <input type="hidden" name="sites" value="tug.org/pipermail/tex-live">
     <input name=q size=20 maxlength=99 placeholder="Search list archives"
    ><input type=submit value="Search list archives">
     <small>(via&nbsp;<a href="https://duckduckgo.com/">DuckDuckGo</a>)</small>
    </form>
</li>
      </ul>

   <H1>Possible SEGV (null pointer deref) in writet1.c</H1>
    <B>Gregory James DUCK</B> 
    <A HREF="mailto:tex-live%40tug.org?Subject=Re:%20Re%3A%20Possible%20SEGV%20%28null%20pointer%20deref%29%20in%20writet1.c&In-Reply-To=%3CCAHw3FwdNH_XNyw%3Dk%3DkAXVPYcFUqtGLcA-jev_FKcZyVSdkF66w%40mail.gmail.com%3E"
       TITLE="Possible SEGV (null pointer deref) in writet1.c">gjduck at gmail.com
       </A><BR>
    <I>Fri Aug 25 08:54:10 CEST 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="049399.html">install-tl-20230310/install-tl won't let me install
</A></li>
        <LI>Next message (by thread): <A HREF="049401.html">Possible SEGV (null pointer deref) in writet1.c
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49400">[ date ]</a>
              <a href="thread.html#49400">[ thread ]</a>
              <a href="subject.html#49400">[ subject ]</a>
              <a href="author.html#49400">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

There seems to be a possible SEGV (null pointer dereference) in
texk/web2c/pdftexdir/writet1.c.  The relevant code snippet is:

    /*
       check for `dup &lt;index&gt; &lt;glyph&gt; put'
     */
    if (sscanf(p, &quot;dup %i%255s put&quot;, &amp;i, t1_buf_array) == 2 &amp;&amp;
        *t1_buf_array == '/' &amp;&amp; valid_code(i)) {
        if (strcmp(t1_buf_array + 1, notdef) != 0)
            glyph_names[i] = xstrdup(t1_buf_array + 1);
        p = strstr(p, &quot; put&quot;) + strlen(&quot; put&quot;);
        skip(p, ' ');
    }

The code seems to assume that if sscanf() returns 2 then the format string
was fully matched including the &quot;put&quot; substring.  The problem is that
sscanf() will also return 2 even if the &quot;put&quot; substring is missing provided
both the i and t1_buf_array are matched and assigned (see scanf manpage).
This causes strstr() to return NULL, leading to a null pointer dereference
in the next line.

Sample stack trace:

Program received signal SIGSEGV, Segmentation fault.
t1_builtin_enc () at ../../../texk/web2c/pdftexdir/writet1.c:845
...
#0  t1_builtin_enc () at ../../../texk/web2c/pdftexdir/writet1.c:845
#1  t1_subset_ascii_part () at ../../../texk/web2c/pdftexdir/writet1.c:1320
#2  0x000055555562dc5a in writet1 (fd=0x555555838960) at
../../../texk/web2c/pdftexdir/writet1.c:1697
#3  write_fontfile (fd=0x555555838960) at
../../../texk/web2c/pdftexdir/writefont.c:406
#4  0x000055555563126e in write_fontdescriptor (fd=0x555555838960) at
../../../texk/web2c/pdftexdir/writefont.c:462
#5  0x000055555563177d in write_fontdescriptors () at
../../../texk/web2c/pdftexdir/writefont.c:534
#6  0x000055555562a627 in writefontstuff () at
../../../texk/web2c/pdftexdir/writefont.c:613
#7  closefilesandterminate () at
/usr/src/texlive-bin-2022.20220321.62855-5ubuntu0.1/Work/texk/web2c/pdftex0.c:40300
#8  0x00005555555af7e5 in mainbody () at
/usr/src/texlive-bin-2022.20220321.62855-5ubuntu0.1/Work/texk/web2c/pdftexini.c:5660
#9  main (ac=&lt;optimized out&gt;, av=&lt;optimized out&gt;) at
../../../texk/web2c/lib/texmfmp.c:1175

Attached is a (corrupted) PoC cmr10.pfb file that can be used to reproduce
the problem.  Replacing the system version and using pdflatex or pdftex
works for me.

-Greg.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://tug.org/pipermail/tex-live/attachments/20230825/5d07f139/attachment-0001.htm">https://tug.org/pipermail/tex-live/attachments/20230825/5d07f139/attachment-0001.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: cmr10.pfb
Type: application/x-font-type1
Size: 35753 bytes
Desc: not available
URL: &lt;<A HREF="https://tug.org/pipermail/tex-live/attachments/20230825/5d07f139/attachment-0001.bin">https://tug.org/pipermail/tex-live/attachments/20230825/5d07f139/attachment-0001.bin</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="049399.html">install-tl-20230310/install-tl won't let me install
</A></li>
	<LI>Next message (by thread): <A HREF="049401.html">Possible SEGV (null pointer deref) in writet1.c
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49400">[ date ]</a>
              <a href="thread.html#49400">[ thread ]</a>
              <a href="subject.html#49400">[ subject ]</a>
              <a href="author.html#49400">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://tug.org/mailman/listinfo/tex-live">More information about the tex-live
mailing list</a>.<br>
</body></html>
