

[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

# New Security Issue: USBGuard and device spoofing

Original reporter: Michael Fincham

Area: Platform component (libraries, tools)

## Message

Hi Gnome security,

We've discovered a security issue affecting the Gnome Settings Daemon USBGuard integration.

As implemented, regardless of the level of protection applied (either "Always" or "Lockscreen"), GSD allows all USB devices with a class of 0x03 (HID) or 0x09 (Hub). This code is in gsd-usb-protection-manager.c:

<https://gitlab.gnome.org/GNOME/gnome-settings-daemon/-/blob/master/plugins/usb-protection/gsd-usb-protection-manager.c?ref_type=heads#L472-L473>

This implementation causes GSD to allow all USB devices that present a hub or HID device class to be authorized and then handled by the kernel. The kernel does not strictly validate that the USB device class matches the actual device, instead matching the device based on its PID and VID after failing to probe it with the hub or HID drivers. A device may claim to be a hub or HID but actually implement mass storage or a number of other device types and the kernel will load the relevant module and communicate with the device. This allows bypassing Gnome's USB protection and attacking the kernel over USB for a significant number of USB driver kernel modules.

We have demonstrated this using a Linux USB mass storage device gadget on a PocketCHIP patched to present either the HID or hub USB classes. When the GSD USB protection level was set to "Always" or "Lockscreen" and the USB gadget connected the volume presented over USB was still auto-mounted by Gnome, effectively bypassing USBGuard.

The following short screencast shows a demonstration against Debian Bookworm running Gnome 3.43, however the current Gnome GitLab repository for GSD seems as though it would still be vulnerable:

<https://pulsesec-static-a.s3.ap-southeast-2.amazonaws.com/a3a73b73e9a8e3e4e69f870a55c1b2ce-gnome/demo.webm>

We were further able to present a raw USB gadget as a Yurex device and a USB CAN bus adapter and cause the relevant Linux kernel modules to be loaded, including the creation of a can0 network device in the latter case. Many other modules could be loaded and interacted with over USB in this way.

Bare USBGuard is not affected by this vulnerability when policy rules are in place that explicity specify allowed VIDs and PIDs. A sample USBGuard rule that would be vulnerable is:

allow with-interface equals { 03:*:* }

We intend to publish a blog post about this vulnerability soon. Are you able to advise on a public disclosure timeline that would be acceptable to the Gnome project?

At this stage a CVE has not been applied for, but we would welcome Gnome undertaking this and advising a CVE number for this issue.

Let me know if you have any questions or would like further PoC information.

Thanks,
Michael Fincham
Pulse Security
[www.pulsesecurity.co.nz](http://www.pulsesecurity.co.nz)

To upload designs, you'll need to enable LFS and have an admin enable hashed storage. [More information](/help/user/project/issues/design_management.md#prerequisites)

Assignee
Loading

Time tracking
Loading

