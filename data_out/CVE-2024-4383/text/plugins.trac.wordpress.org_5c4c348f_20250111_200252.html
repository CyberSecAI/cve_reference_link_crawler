

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3081024%2Fsimple-membership%2Ftrunk%2Fclasses%2Fshortcode-related%2Fclass.swpm-shortcodes-handler.php%3Fold%3D3010737%26old_path%3D%252Fsimple-membership%252Ftrunk%252Fclasses%252Fshortcode-related%252Fclass.swpm-shortcodes-handler.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3010737/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?old=3081024&old_path=%2Fsimple-membership%2Ftrunk%2Fclasses%2Fshortcode-related%2Fclass.swpm-shortcodes-handler.php)

---

# Changes in [simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3081024 "Show entry in browser") [[3010737:3081024]](/log/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3081024&stop_rev=3010737 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

File:

1 edited

* [simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149 "Show entry in browser")
  (modified)
  ([14 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php](/changeset/3080149/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?old=3010737&old_path=simple-membership%2Ftrunk%2Fclasses%2Fshortcode-related%2Fclass.swpm-shortcodes-handler.php "Show the [3010737:3081024] differences restricted to simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php")

  | [r3010737](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L15 "Show revision 3010737 of this file in browser") | [r3081024](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L15 "Show revision 3081024 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 |  |
  | 16 | 16 | add\_shortcode( 'swpm\_stripe\_subscription\_cancel\_link', array( $this, 'swpm\_stripe\_cancel\_subs\_link\_sc' ) ); |
  |  | 17 |  |
  |  | 18 | add\_shortcode( 'swpm\_show\_subscriptions\_and\_cancel\_link', array( $this, 'swpm\_show\_subscriptions\_and\_cancel\_link' ) ); |
  | 17 | 19 |  |
  | 18 | 20 | //TODO - WIP (Later, this will be moved to the shortcode implementation section like the other ones) |
  | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L38) | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L40) |  |
  | 38 | 40 | } |
  | 39 | 41 |  |
  | 40 |  | ~~//Sanitize th~~e arguments. |
  | 41 |  | $args = array\_map( 'esc\_attr', $args ); |
  |  | 42 | //Add a quick escaping to the shortcode arguments. |
  |  | 43 | $args = array\_map( 'esc\_attr', $args ); |
  | 42 | 44 |  |
  | 43 | 45 | $button\_id = $id; |
  | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L46) | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L48) |  |
  | 46 | 48 | if ( empty( $button\_type ) ) { |
  | 47 | 49 | $error\_msg  = '<p class="swpm-red-box">'; |
  | 48 |  | $error\_msg .= 'Error! The button ID (' . ~~$button\_id~~ . ') you specified in the shortcode does not exist. You may have deleted this payment button. '; |
  |  | 50 | $error\_msg .= 'Error! The button ID (' . esc\_attr($button\_id) . ') you specified in the shortcode does not exist. You may have deleted this payment button. '; |
  | 49 | 51 | $error\_msg .= 'Go to the Manage Payment Buttons interface then copy and paste the correct button ID in the shortcode.'; |
  | 50 | 52 | $error\_msg .= '</p>'; |
  | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L77) | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L79) |  |
  | 77 | 79 | $username = SwpmMemberUtils::get\_logged\_in\_members\_username(); |
  | 78 | 80 | $output  .= '<div class="swpm-ty-page-registration-logged-in swpm-yellow-box">'; |
  | 79 |  | $output  .= '<p>' . ~~SwpmUtils::\_( 'Your membership profile will be updated to reflect the payment.~~' ) . '</p>'; |
  | 80 |  | $output  .= ~~SwpmUtils::\_( 'Your profile username: ' ) . $username~~; |
  |  | 81 | $output  .= '<p>' . \_\_( 'Your membership profile will be updated to reflect the payment.', 'simple-membership' ) . '</p>'; |
  |  | 82 | $output  .= \_\_( 'Your profile username: ', 'simple-membership' ) . esc\_attr($username); |
  | 81 | 83 | $output  .= '</div>'; |
  | 82 | 84 | $output = apply\_filters( 'swpm\_ty\_page\_registration\_msg\_to\_logged\_in\_member', $output ); |
  | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L97) | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L99) |  |
  | 97 | 99 | ); |
  | 98 | 100 | $output .= '<div class="swpm-ty-page-registration-link swpm-yellow-box">'; |
  | 99 |  | $output .= '<p>' . ~~SwpmUtils::\_( 'Click on the following link to complete the registration.~~' ) . '</p>'; |
  | 100 |  | $output .= '<p><a href="' . ~~$rego\_complete\_url . '">' . SwpmUtils::\_( 'Click here to complete your paid registration~~' ) . '</a></p>'; |
  |  | 101 | $output .= '<p>' . \_\_( 'Click on the following link to complete the registration.', 'simple-membership' ) . '</p>'; |
  |  | 102 | $output .= '<p><a href="' . esc\_url($rego\_complete\_url) . '">' . \_\_( 'Click here to complete your paid registration', 'simple-membership' ) . '</a></p>'; |
  | 101 | 103 | $output .= '</div>'; |
  | 102 | 104 | //Allow addons to modify the output |
  | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L105) | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L107) |  |
  | 105 | 107 | //Nothing found. Check again later. |
  | 106 | 108 | $output .= '<div class="swpm-ty-page-registration-link swpm-yellow-box">'; |
  | 107 |  | $output .= ~~SwpmUtils::\_( 'If you have just made a membership payment then your payment is yet to be processed. Please check back in a few minutes. An email will be sent to you with the details shortly.~~' ); |
  |  | 109 | $output .= \_\_( 'If you have just made a membership payment then your payment is yet to be processed. Please check back in a few minutes. An email will be sent to you with the details shortly.', 'simple-membership' ); |
  | 108 | 110 | $output .= '</div>'; |
  | 109 | 111 | //Allow addons to modify the output |
  | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L122) | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L124) |  |
  | 122 | 124 | $auth        = SwpmAuth::get\_instance(); |
  | 123 | 125 | $expiry\_date = $auth->get\_expire\_date(); |
  | 124 |  | $output     .= ~~SwpmUtils::\_( 'Expiry: ' ) . $expiry\_date~~; |
  |  | 126 | $output     .= \_\_( 'Expiry: ', 'simple-membership' ) . esc\_attr($expiry\_date); |
  | 125 | 127 | } else { |
  | 126 |  | $output .= ~~SwpmUtils::\_( 'You are not logged-in as a member~~' ); |
  |  | 128 | $output .= \_\_( 'You are not logged-in as a member', 'simple-membership' ); |
  | 127 | 129 | } |
  | 128 | 130 | $output .= '</div>'; |
  | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L146) | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L148) |  |
  | 146 | 148 | //User is logged in |
  | 147 | 149 | $username = $auth->get( 'user\_name' ); |
  | 148 |  | $output  .= '<span class="swpm\_mini\_login\_label">' . ~~SwpmUtils::\_( 'Logged in as: '~~ ) . '</span>'; |
  | 149 |  | $output  .= '<span class="swpm\_mini\_login\_username">' . ~~$username~~ . '</span>'; |
  | 150 |  | $output  .= '<span class="swpm\_mini\_login\_profile"> | <a href="' . ~~$profile\_page\_url . '">' . SwpmUtils::\_( 'Profile'~~ ) . '</a></span>'; |
  | 151 |  | $output  .= '<span class="swpm\_mini\_login\_logout"> | <a href="' . ~~$logout\_url . '">' . SwpmUtils::\_( 'Logout'~~ ) . '</a></span>'; |
  |  | 150 | $output  .= '<span class="swpm\_mini\_login\_label">' . \_\_( 'Logged in as: ', 'simple-membership') . '</span>'; |
  |  | 151 | $output  .= '<span class="swpm\_mini\_login\_username">' . esc\_attr($username) . '</span>'; |
  |  | 152 | $output  .= '<span class="swpm\_mini\_login\_profile"> | <a href="' . esc\_url($profile\_page\_url) . '">' . \_\_( 'Profile', 'simple-membership') . '</a></span>'; |
  |  | 153 | $output  .= '<span class="swpm\_mini\_login\_logout"> | <a href="' . esc\_url($logout\_url) . '">' . \_\_( 'Logout', 'simple-membership') . '</a></span>'; |
  | 152 | 154 | } else { |
  | 153 | 155 | //User not logged in. |
  | 154 |  | $output .= '<span class="swpm\_mini\_login\_login\_here"><a href="' . ~~$filtered\_login\_url . '">' . SwpmUtils::\_( 'Login Here'~~ ) . '</a></span>'; |
  | 155 |  | $output .= '<span class="swpm\_mini\_login\_no\_membership"> | ' . ~~SwpmUtils::\_( 'Not a member? '~~ ) . '</span>'; |
  | 156 |  | $output .= '<span class="swpm\_mini\_login\_join\_now"><a href="' . ~~$join\_page\_url . '">' . SwpmUtils::\_( 'Join Now'~~ ) . '</a></span>'; |
  |  | 156 | $output .= '<span class="swpm\_mini\_login\_login\_here"><a href="' . esc\_url($filtered\_login\_url) . '">' . \_\_( 'Login Here', 'simple-membership') . '</a></span>'; |
  |  | 157 | $output .= '<span class="swpm\_mini\_login\_no\_membership"> | ' . \_\_( 'Not a member? ', 'simple-membership') . '</span>'; |
  |  | 158 | $output .= '<span class="swpm\_mini\_login\_join\_now"><a href="' . esc\_url($join\_page\_url) . '">' . \_\_( 'Join Now', 'simple-membership') . '</a></span>'; |
  | 157 | 159 | } |
  | 158 | 160 |  |
  | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L165) | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L167) |  |
  | 165 | 167 |  |
  | 166 | 168 | public function swpm\_stripe\_cancel\_subs\_link\_sc( $args ) { |
  | 167 |  | //Shortcode parameters: ['anchor\_text'] |
  |  | 169 | //Shortcode parameters: ['anchor\_text'] |
  | 168 | 170 |  |
  | 169 | 171 | if ( ! SwpmMemberUtils::is\_member\_logged\_in() ) { |
  | 170 | 172 | //member not logged in |
  | 171 |  | return SwpmUtils::\_( 'You are not logged-in as a member' ); |
  | 172 |  | } |
  |  | 173 | $error\_msg = '<div class="swpm-stripe-cancel-error-msg">' . \_\_( 'You are not logged-in as a member', 'simple-membership' ) . '</div>'; |
  |  | 174 | return $error\_msg; |
  |  | 175 | } |
  |  | 176 |  |
  |  | 177 | //Get the member ID |
  | 173 | 178 | $member\_id = SwpmMemberUtils::get\_logged\_in\_members\_id(); |
  | 174 |  |  |
  | 175 |  | $subs = new SWPM\_Member\_Subscriptions( $member\_id ); |
  | 176 |  |  |
  |  | 179 | $subs = (new SWPM\_Utils\_Subscriptions( $member\_id ))->load\_stripe\_subscriptions(); |
  | 177 | 180 | if ( empty( $subs->get\_active\_subs\_count() ) ) { |
  | 178 | 181 | //no active subscriptions found |
  | 179 |  | return SwpmUtils::\_( 'No active subscriptions' ); |
  | 180 |  | } |
  | 181 |  |  |
  | 182 |  | $output = $subs->get\_stripe\_subs\_cancel\_url($args, false); |
  |  | 182 | $error\_msg = '<div class="swpm-stripe-cancel-error-msg">' . \_\_( 'No active subscriptions', 'simple-membership' ) . '</div>'; |
  |  | 183 | return $error\_msg; |
  |  | 184 | } |
  |  | 185 |  |
  |  | 186 | $output = $subs->get\_stripe\_subs\_cancel\_url($args, false); |
  |  | 187 |  |
  |  | 188 | $output = '<div class="swpm-stripe-subscription-cancel-link">' . $output . '</div>'; |
  | 183 | 189 |  |
  | 184 | 190 | return $output; |
  | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L186) | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L192) |  |
  | 186 | 192 |  |
  | 187 | 193 | public function swpm\_pp\_cancel\_subs\_link\_sc( $args ) { |
  | 188 |  | //Shortcode parameters: ['anchor\_text'], ['merchant\_id'] |
  |  | 194 | //Shortcode parameters: ['anchor\_text'], ['merchant\_id'] |
  | 189 | 195 |  |
  | 190 | 196 | extract( |
  | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L193) | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L199) |  |
  | 193 | 199 | 'merchant\_id' => '', |
  | 194 | 200 | 'anchor\_text' => '', |
  | 195 |  | 'new\_window' => '', |
  | 196 |  | 'css\_class' => '', |
  |  | 201 | 'new\_window' => '', |
  |  | 202 | 'css\_class' => '', |
  | 197 | 203 | ), |
  | 198 | 204 | $args |
  | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L215) | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L221) |  |
  | 215 | 221 | //The user is logged-in |
  | 216 | 222 |  |
  | 217 |  | //Set the default window target (if it is set via the shortcode). |
  | 218 |  | if ( empty( $new\_window ) ) { |
  | 219 |  | $window\_target = ''; |
  | 220 |  | } else { |
  | 221 |  | $window\_target = ' target="\_blank"'; |
  | 222 |  | } |
  | 223 |  |  |
  | 224 |  | //Set the CSS class (if it is set via the shortcode). |
  | 225 |  | if ( empty( $css\_class ) ) { |
  | 226 |  | $link\_css\_class = ''; |
  | 227 |  | } else { |
  | 228 |  | ~~$link\_css\_class = ' class="' . $css\_class~~ . '"'; |
  | 229 |  | } |
  |  | 223 | //Set the default window target (if it is set via the shortcode). |
  |  | 224 | if ( empty( $new\_window ) ) { |
  |  | 225 | $window\_target = ''; |
  |  | 226 | } else { |
  |  | 227 | $window\_target = ' target="\_blank"'; |
  |  | 228 | } |
  |  | 229 |  |
  |  | 230 | //Set the CSS class (if it is set via the shortcode). |
  |  | 231 | if ( empty( $css\_class ) ) { |
  |  | 232 | $link\_css\_class = ''; |
  |  | 233 | } else { |
  |  | 234 | $link\_css\_class = ' class="' . sanitize\_html\_class($css\_class) . '"'; |
  |  | 235 | } |
  | 230 | 236 |  |
  | 231 | 237 | //Set the default anchor text (if one is provided via the shortcode). |
  | 232 | 238 | if ( empty( $anchor\_text ) ) { |
  | 233 |  | $anchor\_text = ~~SwpmUtils::\_( 'Unsubscribe from PayPal~~' ); |
  |  | 239 | $anchor\_text = \_\_( 'Unsubscribe from PayPal', 'simple-membership' ); |
  | 234 | 240 | } |
  | 235 | 241 |  |
  | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L238) | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L244) |  |
  | 238 | 244 | if ( $sandbox\_enabled ) { |
  | 239 | 245 | //Sandbox mode |
  | 240 |  | $output .= '<a href="https://www.sandbox.paypal.com/cgi-bin/webscr?cmd=\_subscr-find&alias=' . ~~$merchant\_id . '" \_fcksavedurl="https://www.sandbox.paypal.com/cgi-bin/webscr?cmd=\_subscr-find&alias=' . $merchant\_id . '" '. $window\_target~~ . esc\_attr($link\_css\_class) .'>'; |
  | 241 |  | $output .= ~~$anchor\_text~~; |
  |  | 246 | $output .= '<a href="https://www.sandbox.paypal.com/cgi-bin/webscr?cmd=\_subscr-find&alias=' . esc\_attr($merchant\_id) . '" \_fcksavedurl="https://www.sandbox.paypal.com/cgi-bin/webscr?cmd=\_subscr-find&alias=' . esc\_attr($merchant\_id) . '" '. esc\_js($window\_target) . esc\_attr($link\_css\_class) .'>'; |
  |  | 247 | $output .= esc\_attr($anchor\_text); |
  | 242 | 248 | $output .= '</a>'; |
  | 243 | 249 | } else { |
  | 244 | 250 | //Live mode |
  | 245 |  | $output .= '<a href="https://www.paypal.com/cgi-bin/webscr?cmd=\_subscr-find&alias=' . ~~$merchant\_id . '" \_fcksavedurl="https://www.paypal.com/cgi-bin/webscr?cmd=\_subscr-find&alias=' . $merchant\_id . '" '.$window\_target~~ . esc\_attr($link\_css\_class) .'>'; |
  | 246 |  | $output .= ~~$anchor\_text~~; |
  |  | 251 | $output .= '<a href="https://www.paypal.com/cgi-bin/webscr?cmd=\_subscr-find&alias=' . esc\_attr($merchant\_id) . '" \_fcksavedurl="https://www.paypal.com/cgi-bin/webscr?cmd=\_subscr-find&alias=' . esc\_attr($merchant\_id) . '" '. esc\_js($window\_target) . esc\_attr($link\_css\_class) .'>'; |
  |  | 252 | $output .= esc\_attr($anchor\_text); |
  | 247 | 253 | $output .= '</a>'; |
  | 248 | 254 | } |
  | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3010737#L251) | […](/browser/simple-membership/trunk/classes/shortcode-related/class.swpm-shortcodes-handler.php?rev=3080149#L257) |  |
  | 251 | 257 | } else { |
  | 252 | 258 | //The user is NOT logged-in |
  | 253 |  | $output .= '<p>' . SwpmUtils::\_( 'You are not logged-in as a member' ) . '</p>'; |
  | 254 |  | } |
  |  | 259 | $output .= '<p>' . \_\_( 'You are not logged-in as a member.', 'simple-membership' ) . '</p>'; |
  |  | 260 | } |
  |  | 261 | return $output; |
  |  | 262 | } |
  |  | 263 |  |
  |  | 264 | public function swpm\_show\_subscriptions\_and\_cancel\_link($atts){ |
  |  | 265 | $output = ''; |
  |  | 266 |  |
  |  | 267 | $atts = shortcode\_atts(array( |
  |  | 268 | 'show\_all\_status' => '' |
  |  | 269 | ), $atts); |
  |  | 270 |  |
  |  | 271 | if ( ! SwpmMemberUtils::is\_member\_logged\_in() ) { |
  |  | 272 | //member not logged in |
  |  | 273 | return '<p>'.\_\_( 'You are not logged-in as a member.', 'simple-membership' ).'</p>'; |
  |  | 274 | } |
  |  | 275 |  |
  |  | 276 | //Get the member ID and load subscriptions utils class. |
  |  | 277 | $member\_username = SwpmMemberUtils::get\_logged\_in\_members\_username(); |
  |  | 278 | $member\_id = SwpmMemberUtils::get\_logged\_in\_members\_id(); |
  |  | 279 | $subscriptions = new SWPM\_Utils\_Subscriptions( $member\_id ); |
  |  | 280 | $subscriptions = $subscriptions->load\_subs\_data(); |
  |  | 281 |  |
  |  | 282 | /\*\* |
  |  | 283 | \* Display any API key error messages (if subscription exists but api keys are not saved). |
  |  | 284 | \* The error message is only shown when the subscription of the corresponding payment gateway is present. |
  |  | 285 | \* For example: If there are no stripe sca subscriptions, stripe api error wont be shown. |
  |  | 286 | \*/ |
  |  | 287 | $any\_stripe\_api\_key\_error\_msg = $subscriptions->get\_any\_stripe\_sca\_api\_key\_error(); |
  |  | 288 | if ( !empty( $any\_stripe\_api\_key\_error\_msg ) ) { |
  |  | 289 | $output .= '<p class="swpm-active-subs-api-key-error-msg">'. esc\_attr($any\_stripe\_api\_key\_error\_msg) . '</p>'; |
  |  | 290 | } |
  |  | 291 | $any\_paypal\_api\_key\_error\_msg = $subscriptions->get\_any\_paypal\_ppcp\_api\_key\_error(); |
  |  | 292 | if ( !empty( $any\_paypal\_api\_key\_error\_msg ) ) { |
  |  | 293 | $output .= '<p class="swpm-active-subs-api-key-error-msg">'. esc\_attr($any\_paypal\_api\_key\_error\_msg) . '</p>'; |
  |  | 294 | } |
  |  | 295 |  |
  |  | 296 | //Check if we need to show all subscriptions or just the active ones |
  |  | 297 | $show\_all\_subscriptions = !empty($atts['show\_all\_status']) ? true : false; |
  |  | 298 |  |
  |  | 299 | //Get the list of subscriptions |
  |  | 300 | if ($show\_all\_subscriptions) { |
  |  | 301 | $subscriptions\_list = $subscriptions->get\_all\_subscriptions(); |
  |  | 302 | }else{ |
  |  | 303 | $subscriptions\_list = $subscriptions->get\_active\_subscriptions(); |
  |  | 304 | } |
  |  | 305 |  |
  |  | 306 | //Display the list of subscriptions |
  |  | 307 | $output .= '<div class="swpm-active-subs-table-wrap">'; |
  |  | 308 |  |
  |  | 309 | if (count($subscriptions\_list)) { |
  |  | 310 | $output .= '<table class="swpm-active-subs-table">'; |
  |  | 311 |  |
  |  | 312 | // Header section |
  |  | 313 | $output .= '<thead>'; |
  |  | 314 | $output .= '<tr>'; |
  |  | 315 | $output .= '<th>'. \_\_('Subscription', 'simple-membership').'</th>'; |
  |  | 316 | $output .= '<th>'. \_\_('Action', 'simple-membership') .'</th>'; |
  |  | 317 | $output .= '</tr>'; |
  |  | 318 | $output .= '</thead>'; |
  |  | 319 |  |
  |  | 320 | $output .= '<tbody>'; |
  |  | 321 | foreach ($subscriptions\_list as $subscription) { |
  |  | 322 | $output .= '<tr>'; |
  |  | 323 | $output .= '<td>'; |
  |  | 324 | $output .= '<div class="swpm-sub-name">'. esc\_attr($subscription['plan']).'</div>'; |
  |  | 325 | if( isset ( $subscription['is\_attached\_to\_profile'] ) && $subscription['is\_attached\_to\_profile'] == 'yes'  ){ |
  |  | 326 | //This subscription is attached to the profile currently. Show a message. |
  |  | 327 | $output .= '<div class="swpm-sub-attached-to-profile">'. \_\_('Currently used for your membership access.', 'simple-membership').'</div>'; |
  |  | 328 | } |
  |  | 329 | $output .= '</td>'; |
  |  | 330 |  |
  |  | 331 | $output .= '<td>'; |
  |  | 332 | $output .= SWPM\_Utils\_Subscriptions::get\_cancel\_subscription\_output($subscription); |
  |  | 333 | $output .= '</td>'; |
  |  | 334 | $output .= '</tr>'; |
  |  | 335 | } |
  |  | 336 | $output .= '</tbody>'; |
  |  | 337 |  |
  |  | 338 | $output .= '</table>'; |
  |  | 339 | }else{ |
  |  | 340 | $output .= '<p>'.\_\_( 'Active subscription not detected for the member account with the username: ', 'simple-membership' ). esc\_attr($member\_username) . '</p>'; |
  |  | 341 | } |
  |  | 342 |  |
  |  | 343 | //This is used to refresh the page so this shortcode is reloaded after a new subscription is added. |
  |  | 344 | //This is needed for the newly created subscription to show up in the list. |
  |  | 345 | $output .= '<script>'; |
  |  | 346 | $output .= 'document.addEventListener( "swpm\_paypal\_subscriptions\_complete", function(){ window.location = window.location.href });'; |
  |  | 347 | $output .= '</script>'; |
  |  | 348 |  |
  |  | 349 | $output .= '</div>'; |
  |  | 350 |  |
  | 255 | 351 | return $output; |
  | 256 | 352 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3081024&old=3010737&new_path=%2Fsimple-membership%2Ftrunk%2Fclasses%2Fshortcode-related%2Fclass.swpm-shortcodes-handler.php&old_path=%2Fsimple-membership%2Ftrunk%2Fclasses%2Fshortcode-related%2Fclass.swpm-shortcodes-handler.php)
* [Zip Archive](?format=zip&new=3081024&old=3010737&new_path=%2Fsimple-membership%2Ftrunk%2Fclasses%2Fshortcode-related%2Fclass.swpm-shortcodes-handler.php&old_path=%2Fsimple-membership%2Ftrunk%2Fclasses%2Fshortcode-related%2Fclass.swpm-shortcodes-handler.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

