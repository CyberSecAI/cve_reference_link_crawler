=== Content from bugzilla.mozilla.org_73336bd3_20250110_183122.html ===


![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1816390)
* [XML](/show_bug.cgi?ctype=xml&id=1816390)

Closed
[Bug 1816390](/show_bug.cgi?id=1816390)
(CVE-2024-1554)

Opened 2 years ago
Closed 1 year ago

# Browser cache poisoning attack using fetch() with different headers

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Browser cache poisoning attack using fetch() with different headers

## Categories

### (Core :: Networking: Cache, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking%3A%20Cache#Networking%3A%20Cache)

Networking: Cache
▾

Core :: Networking: Cache
For bugs in the cache, which stores recently accessed data for more rapid access. Includes the disk cache, memory cache, and all cache preferences.

Examples of appropriate bugs: Implement compression of network cache data; or Implement partial HTTP caching.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20Cache&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20Cache&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking%3A%20Cache)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Firefox 109

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

123 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=wontfix) |
| firefox121 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=wontfix) |
| firefox122 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=wontfix) |
| firefox123 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | wontfix |
| firefox-esr128 | --- | --- |
| firefox121 |  | wontfix |
| firefox122 |  | wontfix |
| firefox123 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: martin.oneal, Assigned: valentin)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=40)  [valentin](/user_profile?user_id=415378)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/f189c991b3a0cfc2f34ef558713fd1ef?d=mm&size=40)  [martin.oneal](/user_profile?user_id=713228)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/b032108dab3ccfada1140fb485c6e182?d=mm&size=40)  [smayya](/user_profile?user_id=711499)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

### ( [URL](https://attackshipsonfi.re/p/72fd0b4c-b173-4fdd-9d8f-d5a2e82e6033 "https://attackshipsonfi.re/p/72fd0b4c-b173-4fdd-9d8f-d5a2e82e6033") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[attackshipsonfi.re/p/72fd0b4c-b173-4f...](https://attackshipsonfi.re/p/72fd0b4c-b173-4fdd-9d8f-d5a2e82e6033 "https://attackshipsonfi.re/p/72fd0b4c-b173-4fdd-9d8f-d5a2e82e6033")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[bugs.chromium.org/p/chromium/issues/d...](https://bugs.chromium.org/p/chromium/issues/detail?id=1415268 "https://bugs.chromium.org/p/chromium/issues/detail?id=1415268")

## Details

### (Keywords: reporter-external, sec-moderate, Whiteboard: [necko-triaged][necko-priority-queue][adv-main123+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-1554

[Keywords:](/describekeywords.cgi)

[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[necko-triaged][necko-priority-queue][adv-main123+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a30962685_1689 "1 year ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | [qe-verify](#a29878946_488993 "1 year ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [Bug 1816390 - Partition the cache entries generated by cross-origin fetch requests r=#necko](/attachment.cgi?id=9367434)  [1 year ago](#c62)  [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9367434&action=edit) | [Review](/attachment.cgi?id=9367434) |
| --- | --- | --- |
| [Bug 1816390 - test r=#necko](/attachment.cgi?id=9373002)  [1 year ago](#c74)  [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9373002&action=edit) | [Review](/attachment.cgi?id=9373002) |
| [advisory.txt](/attachment.cgi?id=9380042)  [11 months ago](#c78)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   518 bytes, text/plain |  | [Details](/attachment.cgi?id=9380042&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1816390#c0)• 2 years ago |
|  | |

User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/109.0

Steps to reproduce:

# TL;DR

If the right set of circumstances are present, Fetch can be used to pre-load the browser private cache, and poison normal navigation. Using this approach, a range of attacks that were previously thought to be unexploitable, can be unlocked and made practical. Hurrah!

# Blah Blah Blah

The reason that this works is because the browser shares the private cache between Fetch and normal navigation, with the cache key being based upon the URI and originating context. However, because Fetch is able to add headers to the request that can vary the response (but which are not included in the cache key), an attacker can pre-request resources to poison the private cache, then force the browser to navigate to the page, which activates the attack.

To make this work requires two things:

* The Fetch request and response must be cacheable under normal circumstances by the browser. Typically, a GET method, and the response must be implicitly cacheable (301/308 status code, and last-modified header), or explicitly cacheable (cache-control, pragma and expires headers).
* The target endpoint must pass a pre-flight check, as adding additional headers to a Fetch request requires CORS.

As an interesting observation, the response does not always have to be made available to Fetch for the browser cache to be updated. For example, if the pre-flight passes, but the actual response does not have an access-control-allow-origin header, then it will be blocked due to CORS. But even so, the cache will sometimes still be updated successfully.

# Recommendations

It is recommended that additional information is added to the cache key, so that requests made by Fetch and the normal navigation are separated.

# PoC

The following PoC links launch same-origin, same-site and cross-origin tests, either directly or from within an iframe data URI (to force a null origin).

## 301 status code (direct)

* cross-site: <https://p1.scarlet.ae/ff229a50-9266-4741-a478-ff91383525fa>
* same-site: <https://p1.smelter.org/ff229a50-9266-4741-a478-ff91383525fa>
* same-origin: <https://p2.smelter.org/ff229a50-9266-4741-a478-ff91383525fa>

## 200 status code (direct)

* cross-site: <https://p1.scarlet.ae/9991460e-55db-49eb-8716-f4c72fd74d0c>
* same-site: <https://p1.smelter.org/9991460e-55db-49eb-8716-f4c72fd74d0c>
* same-origin: <https://p2.smelter.org/9991460e-55db-49eb-8716-f4c72fd74d0c>

## 301 status code (iframe)

* cross-site: <https://p1.scarlet.ae/17a031ba-cd6e-4cc0-af06-4c3f80354731>
* same-site: <https://p1.smelter.org/17a031ba-cd6e-4cc0-af06-4c3f80354731>
* same-origin: <https://p2.smelter.org/17a031ba-cd6e-4cc0-af06-4c3f80354731>

## 200 status code (iframe)

* cross-site: <https://p1.scarlet.ae/e5b1e318-d679-4b47-b113-744cc97bcacf>
* same-site: <https://p1.smelter.org/e5b1e318-d679-4b47-b113-744cc97bcacf>
* same-origin: <https://p2.smelter.org/e5b1e318-d679-4b47-b113-744cc97bcacf>

Actual results:

as above

Expected results:

as above

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1816390#c1)• 2 years ago |
|  | |

(In reply to scarlet from [comment #0](/show_bug.cgi?id=1816390#c0 "RESOLVED FIXED - Browser cache poisoning attack using fetch() with different headers"))

> If the right set of circumstances are present, Fetch can be used to pre-load the browser private cache, and poison normal navigation. Using this approach, a range of attacks that were previously thought to be unexploitable, can be unlocked and made practical. Hurrah!

What do you mean by "private cache" and "normal navigation" here? And can you give an example of an attack made possible by this issue?

Group: firefox-core-security → network-core-securityComponent: Untriaged → Networking: CacheFlags: needinfo?(martin.oneal)Product: Firefox → Core

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1816390#c2)• 2 years ago |
|  | |

Caches tend to fall into two buckets, private caches (the one in the browser) and shared caches (proxies, accelerators etc). Details here: <https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching>

The reference to "normal navigation" is just to make a destinction between Fetch, and normal browser activity: following a link, loading resources from within a page etc.

Cache poisoning is an approach to adding an attack to a cache that will be activated by the next access. Generally this is a shared cache (poison once, attack many), but the bug described here works just as well for targeting the private cache in the browser. Details here (shared cache attacks, but the principal works just the same): <https://portswigger.net/research/practical-web-cache-poisoning>

So this kind of attack is great for unlocking a range of vulnerabilities in a site (such as XSS) that otherwise can't be practically exploited.

Hopefully that helps!

Flags: needinfo?(martin.oneal)

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1816390#c3)• 2 years ago |
|  | |

Could you explain what the PoC does? How it actually works for every request? I would have expected network state partitioning to be a good mitigation against cache poisoning.

Severity: -- → S3Priority: -- → P1Whiteboard: [necko-triaged][necko-priority-review]

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1816390#c4)• 2 years ago |
|  | |

my pleasure!

The PoCs are all very similar, and work in the same way: first they make a request using Fetch (using a header that alters the response, but isn't part of the cache key), then they follow up with normal navigation to the same URI. Because the response is cacheable, the second navigation step loads the response from cache (and doesn't make a new request).

The PoCs are broken into three CORS clumps: same origin (literally the same host), same site (they share a base domain, like mozilla.org) and cross site (the domains are unrelated).

Then on top of this, the PoCs are also split into direct requests (just made from a page) and others that are wrapped inside an iframe (as this forces the origin of the request to null).

And finally, the PoCs are separated into reponses that generate a 200 and a 301 (though 308 will work the same way: basically a permanent, inherently cacheable redirect).

The idea being that these tests permute the main combinations, and demonstrate whether the browser request can be poisoned.

Have you tried safari and chrome yet? ;)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1816390#c5)• 2 years ago |
|  | |

As an aside, a MITM proxy like Charles or Burp will make the mechanics of the actual requests much more clear.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1816390#c6)• 2 years ago |
|  | |

(In reply to scarlet from [comment #4](/show_bug.cgi?id=1816390#c4 "RESOLVED FIXED - Browser cache poisoning attack using fetch() with different headers"))

> Have you tried safari and chrome yet? ;)

Looks like Chrome at least reports "poisoned: yep" for at least some of those - I assume you've also reported to Chrome and Safari (if they too are vulnerable) as well, and if so, can you link the reports? :-)

Flags: needinfo?(martin.oneal)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a45275_159069)• 2 years ago |

Summary: Private cache poisoning attack → Browser cache poisoning attack using fetch() with different headers

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1816390#c7)• 2 years ago |
|  | |

Haha, indeed reported elsewhere too.

I've found cross-browser bugs before, so happy to reference tickets across vendors. I know chrome are too, but Apple (as ever) generally give pretty much no feedback prior to releasing a patch, so I wouldn't expect anything. ;)

Flags: needinfo?(martin.oneal)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1816390#c8)• 2 years ago |
|  | |

chromium ticket: <https://bugs.chromium.org/p/chromium/issues/detail?id=1415268>

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1816390#c9)• 2 years ago |
|  | |

there is the potential for this to become a whatwg issue, given the cross-browser aspect.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1816390#c10)• 2 years ago |
|  | |

If the server is returning different values based on the headers, doesn't it fall on the server to issue a `Vary:` header for those?

Status: UNCONFIRMED → NEWEver confirmed: trueSee Also: → <https://bugs.chromium.org/p/chromium/issues/detail?id=1415268>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a219681_1689)• 2 years ago |

Flags: needinfo?(valentin.gosu)

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1816390#c11)• 2 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #10](/show_bug.cgi?id=1816390#c10 "RESOLVED FIXED - Browser cache poisoning attack using fetch() with different headers"))

> If the server is returning different values based on the headers, doesn't it fall on the server to issue a `Vary:` header for those?

Yes, it does. As far as I can tell, none of the requests to links in [comment 0](/show_bug.cgi?id=1816390#c0 "RESOLVED FIXED - Browser cache poisoning attack using fetch() with different headers") are returning a Vary header.

Flags: needinfo?(valentin.gosu)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1816390#c12)• 2 years ago |
|  | |

Oh yes, the standards have a mechanism for dealing with this, but the reality is that it just isn't used particularly widely (in this way).

The typical approach to avoid cache poisoning is to include one or other of `referer` and `origin` in the `vary` response, but as this is a private cache, they are going to be the same anyway.

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1816390#c13)• 2 years ago |
|  | |

(In reply to scarlet from [comment #12](/show_bug.cgi?id=1816390#c12 "RESOLVED FIXED - Browser cache poisoning attack using fetch() with different headers"))

> Oh yes, the standards have a mechanism for dealing with this, but the reality is that it just isn't used particularly widely (in this way).
>
> The typical approach to avoid cache poisoning is to include one or other of `referer` and `origin` in the `vary` response, but as this is a private cache, they are going to be the same anyway.

(In reply to scarlet from [comment #0](/show_bug.cgi?id=1816390#c0 "RESOLVED FIXED - Browser cache poisoning attack using fetch() with different headers"))

> * same-origin: <https://p2.smelter.org/9991460e-55db-49eb-8716-f4c72fd74d0c>

But in this case the server is returning a different response based on the `x-original-url` header, so presumably it should include that in the Vary response?

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1816390#c14)• 2 years ago |
|  | |

in my experience, for anything other than the most simple install, there really isn't anything you can point to as a server. There will be a stack of infrastructure and application components, each with rules about what to allow, and what extra headers to add to responses.

so the bit that will respond to the `x-original-url` header will be the app component (or framework) whereas other than the basic 200 responses, the cache headers will actually be applied by middleware, the framework, or a webserver, or maybe a WAF, reverse proxy or firewall.

a lot of this stuff doesn't even consider the caching aspect too: for example the 301/308s. They'll be sent as-is, with no extra headers, and it is the browser that inherently caches them.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1816390#c15)• 2 years ago |
|  | |

I ran some more testing using service workers this weekend.

results the same as the direct PoCs previously provided:

### 301 status code (service worker)

* cross-site: <https://p1.scarlet.ae/263d8d0d-e889-447e-9270-14fa3a4d7096>
* same-site: <https://p1.smelter.org/263d8d0d-e889-447e-9270-14fa3a4d7096>
* same-origin: <https://p2.smelter.org/263d8d0d-e889-447e-9270-14fa3a4d7096>

### 200 status code (service worker)

* cross-site: <https://p1.scarlet.ae/6a6cde5c-e28c-4b62-9f3c-d155feccb2c4>
* same-site: <https://p1.smelter.org/6a6cde5c-e28c-4b62-9f3c-d155feccb2c4>
* same-origin: <https://p2.smelter.org/6a6cde5c-e28c-4b62-9f3c-d155feccb2c4>

I also noticed a strange quirk with the same-origin 200 response: if the response has a `cache-control: no-cache, no-store header` then the first time it is requested, it fails as expected. However, subsequent requests succeed. Only for same-origin, the others are unnafected.

As with the other same origin stuff, it's not that useful as an exploit. However, it does hint at something else being broken.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1816390#c16)• 2 years ago |
|  | |

ignore the reload bit: my code was broken (didn;t activate properly immediately). so same-origin via a service worker ignores cache settings.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1816390#c17)• 2 years ago |
|  | |

same results for pre-caching through a service worker:

### 301 status code (service worker, pre-cache)

* cross-site: <https://p1.scarlet.ae/c96edaed-9816-4dcc-a857-5cdb4cea59ee>
* same-site: <https://p1.smelter.org/c96edaed-9816-4dcc-a857-5cdb4cea59ee>
* same-origin: <https://p2.smelter.org/c96edaed-9816-4dcc-a857-5cdb4cea59ee>

### 200 status code (service worker, pre-cache)

* cross-site: <https://p1.scarlet.ae/3ca1ee29-1e02-40ef-aad6-22efd83c8407>
* same-site: <https://p1.smelter.org/3ca1ee29-1e02-40ef-aad6-22efd83c8407>
* same-origin: <https://p2.smelter.org/3ca1ee29-1e02-40ef-aad6-22efd83c8407>

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1816390#c18)• 2 years ago |
|  | |

I also noticed a strange quirk with the same-origin 200 response: if the response has a `cache-control: no-cache, no-store header` then it is successfully cached. Only for same-origin, the others are unnafected.

As with the other same origin stuff, it's not that useful as an exploit. However, it does hint at something else being broken.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1816390#c19)• 2 years ago |
|  | |

and just for clarity, that's via the service worker only: direct requests are not cached as expected.

|  | [Greg Hess](/user_profile?user_id=694371) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a708265_694371)• 2 years ago |

Severity: S3 → S2Priority: P1 → P2

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1816390#c20)• 2 years ago |
|  | |

(In reply to scarlet from [comment #9](/show_bug.cgi?id=1816390#c9 "RESOLVED FIXED - Browser cache poisoning attack using fetch() with different headers"))

> there is the potential for this to become a whatwg issue, given the cross-browser aspect.

Hi Anne,

Should we open a fetch security advisory for this issue?

Thanks!

Flags: needinfo?(annevk)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1816390#c21)• 2 years ago |
|  | |

I'm not a subject matter expert, but to me, it seems more of an implementation thing, than a standards thing. All the main browsers (and even recent versions) respond differently, as they seem to use a subtly different approach to deciding how to generate the cache key.

As a layman, for this particular issue, adding a flag for whether the fetch request is initiated from javascript or not would seem to solve the problem.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1816390#c22)• 2 years ago |
|  | |

I ran up some more tests last night, and bodyless POSTs (via an overide header) work just fine too.

This is very useful in the real world, for leveraging XSS that has previously been unexploitable as it requires CORS (auth headers, cookie or header based XSS etc).

### 301 status code (direct, bodyless post)

* cross-site: <https://p1.scarlet.ae/abb9d2b8-06ea-4abf-b6eb-25f346f6e8a1>
* same-site: <https://p1.smelter.org/abb9d2b8-06ea-4abf-b6eb-25f346f6e8a1>
* same-origin: <https://p2.smelter.org/abb9d2b8-06ea-4abf-b6eb-25f346f6e8a1>

### 200 status code (direct, bodyless post)

* cross-site: <https://p1.scarlet.ae/eecc1994-eac6-43a8-82cc-ff7cde1607f8>
* same-site: <https://p1.smelter.org/eecc1994-eac6-43a8-82cc-ff7cde1607f8>
* same-origin: <https://p2.smelter.org/eecc1994-eac6-43a8-82cc-ff7cde1607f8>

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1816390#c23)• 2 years ago |
|  | |

The boundary we are trying to protect is top-level cross-site. That's done through HTTP cache partitioning. Top-level cross-site tests don't seem to work so I think all is working as designed?

Servers could use Fetch Metadata Request Headers if they need control within the site boundary.

Valentin, feel free if you think there are changes we should make. I don't see anything actionable here personally.

Flags: needinfo?(annevk)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1816390#c24)• 2 years ago |
|  | |

is there a plan and schedule for getting a fix together and shipped?

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1816390#c25)• 2 years ago |
| duplicate | |

| Comment hidden (duplicate) |  |
| --- | --- |

[prod]

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1816390#c26)• 2 years ago |
|  | |

I start working on this. We don't have a timeline for shipping a fix yet.

Assignee: nobody → valentin.gosu

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1816390#c27)• 2 years ago |
|  | |

cool. thanks for the update!

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1816390#c28)• 2 years ago |
|  | |

what approach have you taken? will you be adding a flag to the cache key for fetch-javascript, ala iframe?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a2634993_1689)• 2 years ago |

Flags: needinfo?(valentin.gosu)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1816390#c29)• 2 years ago |
| duplicate | |

| Comment hidden (duplicate) |  |
| --- | --- |

any progress?

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1816390#c30)• 2 years ago |
|  | |

Sorry for the long response delay - I'm working on the patch to add a fetch flag to the partitioning key.

Most of my time is occupied by another project, but that's ramping down this week so I'll probably have something to share by the end of next week. Thank you for your patience.

Flags: needinfo?(valentin.gosu)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1816390#c31)• 2 years ago |
|  | |

cool. just checking it hasn't been forgotten ;)

|  | [Greg Hess](/user_profile?user_id=694371) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a4332766_694371)• 2 years ago |

Whiteboard: [necko-triaged][necko-priority-review] → [necko-triaged][necko-priority-next]

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1816390#c32)• 2 years ago |
|  | |

Valentin, if you don't think this is WONTFIX could you please discuss the relevant standard changes in tandem with any fix? It's still not clear to me this is worth fixing at all.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1816390#c33)• 2 years ago |
|  | |

There's a really good primer for cache poisoning here: <https://portswigger.net/web-security/web-cache-poisoning>

The only bit different, is that the poisoning happens within the browser's private cache (and not a shared cache, as in the link), but otherwise all the principals and effects are the same.

I've been having a lot of fun with it in the last few months, as it unlocks a collection of attacks that have previously been unexploitable.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1816390#c34)• 2 years ago |
| duplicate | |

| Comment hidden (duplicate) |  |
| --- | --- |

how is this going?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1816390#c35)• 2 years ago |
|  | |

> if the pre-flight passes, but the actual response does not have an access-control-allow-origin header, then it will be blocked due to CORS. But even so, the cache will sometimes still be updated successfully.

Is there a way we can avoid caching these failed responses ever? We do, though, want to cache the pre-flight responses for a time for perf reasons, but maybe these can be tagged to only be used for pre-flights and nothing else?

Keywords: [sec-other](/buglist.cgi?keywords=sec-other&resolution=---)

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a9171732_415378)• 2 years ago |

Whiteboard: [necko-triaged][necko-priority-next] → [necko-triaged][necko-priority-queue]

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1816390#c36)• 1 years ago |
| duplicate | |

| Comment hidden (duplicate) |  |
| --- | --- |

how's it going?

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1816390#c37)• 1 years ago |
|  | |

As an example of how this can be used in the real world, if you can find a site with the following criteria, then you have a universal XSS flaw:

* javascript files
* pre-flight response with \* for origin and headers
* responds to host/protocol override headers (typically a 301)

So to exploit it, you use the fetch to pre-load the cache, then navigate to the site, which uses the cached redirect to load malicious javascript.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1816390#c38)• 1 year ago |
| duplicate | |

| Comment hidden (duplicate) |  |
| --- | --- |

any progress?

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1816390#c39)• 1 year ago |
|  | |

Hi Scarlet, I'm sorry for the delay here.

I'm trying to verify if the addition of a fetch flag to the isolation key fixes this issue, but your links don't work anymore.

Could you possibly upload the sources of the test cases? It would make it much easier to reason about the correctness of the behaviour.

That said, I'm wondering what is the status of the Chrome bug? Did they address it in any way?

Flags: needinfo?(martin.oneal)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1816390#c40)• 1 year ago |
|  | |

haha, as far as I know, it's all still queued with everyone .

yeah, the test cases were decommissioned a while back: this was reported 7 months ago. ;)

Flags: needinfo?(martin.oneal)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1816390#c41)• 1 year ago |
|  | |

I reinstated the test cases, and some are still failing:

<http://a.gvj.io/>

<http://a.gvj.io/iframe>

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1816390#c42)• 1 year ago |
|  | |

Added a test for 308s, and these can be poisoned cross-site, which is a fun plot-twist. ;)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1816390#c43)• 1 year ago |
|  | |

actually, ignore me: typo in the test code.

as far as I can see, the caching is now fixed in line with what I'd expect.

all the iframe poisoning is now blocked.

embed, object and direct poisoning is limited to same-origin, but that is inline with the cache partition strategy.

Do you agree that it is fixed?

<http://a.gvj.io/>

<http://a.gvj.io/iframe>

<http://a.gvj.io/embed>

<http://a.gvj.io/object>

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1816390#c44)• 1 year ago |
|  | |

chrome and safari still have broken test cases though, so please hold off on any announcement.

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1816390#c45)• 1 year ago |
|  | |

Hi Scarlet, I don't think we made any changes to fetch caching recently.

Either the new test cases are wrong, or the previous ones were.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1816390#c46)• 1 year ago |
|  | |

I'm confident the test cases are right: they still show consistent results on the other browsers.

It's obviously 9 months ago now, but IIRC when I originally logged the bug, some of the iframe tests were failing, as all the fetch reqests shared the same null origin.

That no-longer seems to be the case.

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1816390#c47)• 1 year ago |
|  | |

I used mozregression to check with Firefox 109 with the new test cases, and I get the exact same values as with the latest version. Please let me know if you're seeig something different.

<https://mozilla.github.io/mozregression/quickstart.html>

`mozregression -b 109 --find-fix`

Status: NEW → RESOLVEDClosed: 1 year agoResolution: --- → FIXED

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1816390#c48)• 1 year ago |
|  | |

yep, re-downloaded 109 and seeing the same thing.

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1816390#c49)• 1 year ago |
|  | |

I had closed the bug by mistake.

Severity: S2 → S3Status: RESOLVED → REOPENEDResolution: FIXED → ---Whiteboard: [necko-triaged][necko-priority-queue] → [necko-triaged][necko-monitor]

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1816390#c50)• 1 year ago |
|  | |

so, the bits that are left are that you can poison the navigation same-site using fetch, which isn't vastly useful in the real world (as to be able to deliver it, requires another, more serious issue in the site).

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1816390#c51)• 1 year ago |
|  | |

Note that I downgraded the bug to S3 considering [comment 43](/show_bug.cgi?id=1816390#c43 "RESOLVED FIXED - Browser cache poisoning attack using fetch() with different headers") and [comment 46](/show_bug.cgi?id=1816390#c46 "RESOLVED FIXED - Browser cache poisoning attack using fetch() with different headers").

We'll keep the bug open in order to determine if there is an actual vulnerability here, or if the original testcases were failing for a different reason.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1816390#c52)• 1 year ago |
|  | |

it's possible.

the original test cases spawned an iframe, then ran the test within it. the current ones wrap the whole test suite in a single iframe.

I've found notable differences between browsers based on how the navigation is triggered too: location.replace or an A element onclick have different results.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1816390#c53)• 1 year ago |
|  | |

so, I went back to my original notes and found that firefox only poisoned the normal navigation cache if the Access-Control-Allow-Credentials header was present in the responses. with the headers reinstated, the current code now poisons cross-site within an iframe. pow!

<http://a.gvj.io/iframe>

you may want to reprioritise the bug and fix that. ;)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1816390#c54)• 1 year ago |
|  | |

I've put together a draft write-up for the issue (this isn't publically visible yet):

<https://attackshipsonfi.re/p/72fd0b4c-b173-4fdd-9d8f-d5a2e82e6033>

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1816390#c55)• 1 year ago |
|  | |

Ni Valentin for a re-triage given the last few comments.

Flags: needinfo?(moz.valentin)

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a24551865_415378)• 1 year ago |

Status: REOPENED → ASSIGNEDFlags: needinfo?(moz.valentin)

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a24554383_415378)• 1 year ago |

Whiteboard: [necko-triaged][necko-monitor] → [necko-triaged][necko-priority-queue]

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1816390#c56)• 1 year ago |
|  | |

Hi Scarlet,

> <http://a.gvj.io/iframe>

So Sunil and I worked on this bug today and we confirmed that the iframe testcase is fixed by adding an extra flag to the [cacheKey](https://searchfox.org/mozilla-central/rev/996f5bf0b9a32aa0620a841abb9531625fe916aa/netwerk/protocol/http/nsHttpChannel.cpp#3758) when the request is caused by a [fetch](https://searchfox.org/mozilla-central/rev/996f5bf0b9a32aa0620a841abb9531625fe916aa/netwerk/protocol/http/HttpBaseChannel.cpp#3081) fixes the test case.

But when we started to work on writing tests for this we started to think about the implications of this attack.

So attacker.com does a fetch request that poisons the cache, then includes an iframe to target.com that is then loaded from the cache. Since the cache, cookies and site data is keyed by the top level domain, there are no user specific info that can be obtained from getting the iframe to load the wrong content.

If the cross-site cache poisoning worked for <http://a.gvj.io/direct> it would indeed be a lot more worrisome.

But for iframes, I don't think there's anything the attacker could get from the iframe. Do you have a different view of this? Or is there some attack vector I'm not seeing?

Flags: needinfo?(martin.oneal)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1816390#c57)• 1 year ago |
|  | |

for a vanilla iframe, where you are looking to isolate between the two contexts, then yup, the direct and iframe are isolated.

but in this case, say the exploit we're targeting is an XSS, that means we're running our code inside the iframe, and also outside. which means we can pass data between them through window messages etc. and because we're not looking to isolate them, the parent window can subsequently add allow-same-origin to the iframe sandbox, after the initial navigation that activates the exploit.

Flags: needinfo?(martin.oneal)

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1816390#c58)• 1 year ago |
|  | |

That still doesn't explain what an attacker could steal from the iframe. You need an extra step where the iframe has access to either cookies or some other sensitive resource that is only accessible to the victim.

Otherwise there is functionally no difference between you, the attacker loading <http://a.gvj.io/iframe> in your browser and the victim loading <http://a.gvj.io/iframe> in theirs. Or maybe there's a more creative way of making the iframe share data with a top level window of the same domain.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1816390#c59)• 1 year ago |
|  | |

it's not about stealing directly.

a successful attack is often an attack-chain, gluing mutiple issues together.

so the successful poisoning enables javascript running in the target site DOM.

from there, you can chain it with a raft of other issues that leverage the same-site scope, or move from the null partition to direct.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1816390#c60)• 1 year ago |
|  | |

what's the plan for pushing the code?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a25649532_1689)• 1 year ago |

URL: [https://attackshipsonfi.re/p/72fd0b4c...](https://attackshipsonfi.re/p/72fd0b4c-b173-4fdd-9d8f-d5a2e82e6033)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1816390#c61)• 1 year ago |
|  | |

(In reply to Valentin Gosu [:valentin] (he/him) from [comment #58](/show_bug.cgi?id=1816390#c58 "RESOLVED FIXED - Browser cache poisoning attack using fetch() with different headers"))

> That still doesn't explain what an attacker could steal from the iframe. You need an extra step where the iframe has access to either cookies or some other sensitive resource that is only accessible to the victim.

There could be a "popup" from the iframe that, still partitioned, let's users log into the iframed site. Or the target site could have used the Storage Access API to get unpartitioned cookies. But even if the cookies are partitioned, don't underestimate the ability of clever hackers to find some way to exploit this difference. It would be very site specific of course, and probably rare to get the conditions to line up, but definitely could be a problem.

Going back to the thinking behind the CORS pre-flight, there are some fetch/xhr requests that look and behave exactly like requests that could already be made from unscripted HTML elements. Those don't need a pre-flight because the server already has to handle those requests; we only need CORS to know whether to let the script read the response or not. Other requests—like ones that add a header!—can only be done using fetch/xhr. We need to do a pre-flight to know if we're even allowed to MAKE the request, let alone read the response.

Adding a cache flag to distinguish "initiated by HTML" from "scripted and needed a pre-flight" not only seems like a workable fix, I think the fundamental theory of CORS requires it. If the theory I'm presenting holds any water then fetch requests that did not need a pre-flight should be cached and shared with web content rather than with requests that required a pre-flight. In most cases It probably doesn't matter either way (other than one way taking up more space), but I feel vaguely uneasy that browser engines should agree on the same behavior here and write it into the Fetch spec. Maybe some old site tries to use scripted fetch to "pre-load" resources to speed up the next page, and segregating the cache would defeat that (never mind that we have better dedicated features to do that these days). ¯\\_(ツ)\_/¯

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1816390#c62)• 1 year ago |
|  | |

Attached file
[Bug 1816390 - Partition the cache entries generated by cross-origin fetch requests r=#necko](attachment.cgi?id=9367434)
— [Details](attachment.cgi?id=9367434&action=edit)

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1816390#c63)• 1 year ago |
|  | |

Daniel, it's not entirely clear to me how that theory holds given top-level site HTTP cache partitioning and as such the poisoning you can do is very limited and restricted to the same site. I still haven't seen anything that invalidates [comment 23](/show_bug.cgi?id=1816390#c23 "RESOLVED FIXED - Browser cache poisoning attack using fetch() with different headers").

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1816390#c64)• 1 year ago |
|  | |

I'm inclined to agree with Daniel as to the standard, as all three browser stacks have implemented the functionality differently.

Does that not (in itself) say something in the standard isn't clear?

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1816390#c65)• 1 year ago |
|  | |

Also, if you look at <http://a.gvj.io/iframe> you can see that the navigation is poisoned cross-site just fine.

Did affect chromium, but they've fixed it since it was originally reported. Still affects firefox (patch as above) and safari.

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1816390#c66)• 1 year ago |
|  | |

scarlet, I don't see how that demo proves anything with regards to that as there's no top-level cross-site navigation. Chromium has additional cache keying beyond top-level site and maybe you discovered a flaw in that, but Gecko and WebKit don't as far as I know. And yes, that means some same-top-level-site attacks work in Gecko and WebKit and those should (eventually) be addressed, but that's been a known bug for quite a while.

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1816390#c67)• 1 year ago |
|  | |

well, there are a few problems as far as I can see.

the first is the fact that fetch/xhr share the cache with normal browser operations at all. the reason this is a problem is that fetch/xhr allow you to add headers to the request that do not inherently get included within the cache key. adding a flag that differentiated between fetch/xhr and regular browser operations would solve this globally.

the second is that the partitioning implementation is patchy. some browsers partition strictly on origin, and some samesite (eTLD). this is a critical issue, as for large eTLDs, the attack surface is huge. this discrepancy enables an attacker to jump laterally from unloved.mozilla.org to [www.mozilla.org](http://www.mozilla.org). I think you chaps need to make a call on this, and update the standards to match.

the third is the universal equivalence of the null origin with the partitioning. it is common to use an iframe wrapper for thirdparty code (for example embedding tweets in your site). if a vulnerability can be found in twitter, then an attacker can pre-seed using fetch, and then use your page with the embedded tweet to activate the attack. adding a flag that separates the null origin would solve this globally (as firefox have done).

the fourth is that when making the fetch/xhr request, the pre-flight obviously has to succeed for the regular request to be attempted, but if the response fails the CORS check, then the HTTP cache is updated anyway. you chaps may want to reverse the order of those operations, so that only successful requests are cached.

I would have though that some or all of those were whatwg standards things, no?

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1816390#c68)• 1 year ago |
|  | |

Is there an ETA for shipping the patched version?

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=1816390#c69)• 1 year ago |
|  | |

There is an r+ patch which didn't land and no activity in this bug for 2 weeks.

:valentin, could you have a look please?

If you still have some work to do, you can add an action "Plan Changes" in Phabricator.

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#not_landed.py).

Flags: needinfo?(moz.valentin)Flags: needinfo?(kershaw)

|  | [Kershaw Chang [:kershaw]](/user_profile?user_id=505624) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a28067612_505624)• 1 year ago |

Flags: needinfo?(kershaw)

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=1816390#c70)• 1 year ago |
|  | |

(In reply to scarlet from [comment #68](/show_bug.cgi?id=1816390#c68 "RESOLVED FIXED - Browser cache poisoning attack using fetch() with different headers"))

> Is there an ETA for shipping the patched version?

I'll try to land it sometimes this week.

Flags: needinfo?(moz.valentin)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=1816390#c71)• 1 year ago |
|  | |

cool, ta

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=1816390#c72)• 1 year ago |
|  | |

Hey chaps,

since the last time I looked (admitedly a few months back), there have been a couple of changes to the way firefox poisons:

* same-site now works for direct (was only same-origin)
* 303s don't cache at all

is that a deliberate change in behaviour, or a side effect of another change in partitioning/caching that has been pushed?

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=1816390#c73)• 1 year ago |
|  | |

Pushed by valentin.gosu@gmail.com:
<https://hg.mozilla.org/integration/autoland/rev/94ed4d6361b3>
Partition the cache entries generated by cross-origin fetch requests r=necko-reviewers,kershaw,jesup

|  | [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=1816390#c74)• 1 year ago |
|  | |

Attached file
[Bug 1816390 - test r=#necko](attachment.cgi?id=9373002)
— [Details](attachment.cgi?id=9373002&action=edit)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=1816390#c75)• 1 year ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/94ed4d6361b3>

Group: network-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 1 year ago → 1 year ago
[status-firefox123](/buglist.cgi?f1=cf_status_firefox123&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 123 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a29151444_75935)• 1 year ago |

[status-firefox121](/buglist.cgi?f1=cf_status_firefox121&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=wontfix)
[status-firefox122](/buglist.cgi?f1=cf_status_firefox122&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=wontfix)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=wontfix)

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=1816390#c76)• 1 year ago |
|  | |

can you please tag this bug for a bounty? TIA

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a29745526_159069)• 1 year ago |

Flags: sec-bounty?

|  | [scarlet](/user_profile?user_id=713228)  Reporter |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=1816390#c77)• 1 year ago |
|  | |

thanks!

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a29878946_488993)• 1 year ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a30962685_1689)• 11 months ago |

Flags: sec-bounty? → sec-bounty+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a31572107_578488)• 11 months ago |

Whiteboard: [necko-triaged][necko-priority-queue] → [necko-triaged][necko-priority-queue][adv-main123+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=1816390#c78)• 11 months ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9380042)
— [Details](attachment.cgi?id=9380042&action=edit)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a31617272_428608)• 11 months ago |

Keywords: [sec-other](/buglist.cgi?keywords=sec-other&resolution=---) → [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a31735757_578488)• 11 months ago |

Alias: CVE-2024-1554

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a40807964_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1816390#a50186643_1689)• 4 months ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1816390&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Valentin Gosu [:valentin] (he/him) {{ PTO 21 Dec - 06 Jan }}](/user_profile?user_id=415378)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_34fd28ef_20250110_183123.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    #### Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [#### Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    #### Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    #### Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    #### Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    #### Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    #### MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    #### Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    #### Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [#### About Mozilla](/en-US/about/)
  + [#### The Mozilla Manifesto](/en-US/about/manifesto/)
  + [#### Get Involved](/en-US/contribute/)
  + [#### Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [#### Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2024-05

## Security Vulnerabilities fixed in Firefox 123

Announced
February 20, 2024
Impact
high
Products
Firefox
Fixed in

* Firefox 123

#### [#CVE-2024-1546: Out-of-bounds memory read in networking channels](#CVE-2024-1546)

Reporter
Alfred Peters
Impact
high
##### Description

When storing and re-accessing data on a networking channel, the length of buffers may have been confused, resulting in an out-of-bounds memory read.

##### References

* [Bug 1843752](https://bugzilla.mozilla.org/show_bug.cgi?id=1843752)

#### [#CVE-2024-1547: Alert dialog could have been spoofed on another site](#CVE-2024-1547)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Through a series of API calls and redirects, an attacker-controlled alert dialog could have been displayed on another website (with the victim website's URL shown).

##### References

* [Bug 1877879](https://bugzilla.mozilla.org/show_bug.cgi?id=1877879)

#### [#CVE-2024-1554: fetch could be used to effect cache poisoning](#CVE-2024-1554)

Reporter
scarlet
Impact
moderate
##### Description

The `fetch()` API and navigation incorrectly shared the same cache, as the cache key did not include the optional headers `fetch()` may contain. Under the correct circumstances, an attacker may have been able to poison the local browser cache by priming it with a `fetch()` response controlled by the additional headers. Upon navigation to the same URL, the user would see the cached response instead of the expected response.

##### References

* [Bug 1816390](https://bugzilla.mozilla.org/show_bug.cgi?id=1816390)

#### [#CVE-2024-1548: Fullscreen Notification could have been hidden by select element](#CVE-2024-1548)

Reporter
Hafiizh
Impact
moderate
##### Description

A website could have obscured the fullscreen notification by using a dropdown select input element. This could have led to user confusion and possible spoofing attacks.

##### References

* [Bug 1832627](https://bugzilla.mozilla.org/show_bug.cgi?id=1832627)

#### [#CVE-2024-1549: Custom cursor could obscure the permission dialog](#CVE-2024-1549)

Reporter
Hafiizh
Impact
moderate
##### Description

If a website set a large custom cursor, portions of the cursor could have overlapped with the permission dialog, potentially resulting in user confusion and unexpected granted permissions.

##### References

* [Bug 1833814](https://bugzilla.mozilla.org/show_bug.cgi?id=1833814)

#### [#CVE-2024-1550: Mouse cursor re-positioned unexpectedly could have led to unintended permission grants](#CVE-2024-1550)

Reporter
Hafiizh
Impact
moderate
##### Description

A malicious website could have used a combination of exiting fullscreen mode and `requestPointerLock` to cause the user's mouse to be re-positioned unexpectedly, which could have led to user confusion and inadvertently granting permissions they did not intend to grant.

##### References

* [Bug 1860065](https://bugzilla.mozilla.org/show_bug.cgi?id=1860065)

#### [#CVE-2024-1551: Multipart HTTP Responses would accept the Set-Cookie header in response parts](#CVE-2024-1551)

Reporter
Johan Carlsson
Impact
moderate
##### Description

Set-Cookie response headers were being incorrectly honored in multipart HTTP responses. If an attacker could control the Content-Type response header, as well as control part of the response body, they could inject Set-Cookie response headers that would have been honored by the browser.

##### References

* [Bug 1864385](https://bugzilla.mozilla.org/show_bug.cgi?id=1864385)

#### [#CVE-2024-1555: SameSite cookies were not properly respected when opening a website from an external browser](#CVE-2024-1555)

Reporter
Narendra Bhati
Impact
moderate
##### Description

When opening a website using the `firefox://` protocol handler, SameSite cookies were not properly respected.

##### References

* [Bug 1873223](https://bugzilla.mozilla.org/show_bug.cgi?id=1873223)

#### [#CVE-2024-1556: Invalid memory access in the built-in profiler](#CVE-2024-1556)

Reporter
Ronald Crane
Impact
low
##### Description

The incorrect object was checked for NULL in the built-in profiler, potentially leading to invalid memory access and undefined behavior. *Note:* This issue only affects the application when the profiler is running.

##### References

* [Bug 1870414](https://bugzilla.mozilla.org/show_bug.cgi?id=1870414)

#### [#CVE-2024-1552: Incorrect code generation on 32-bit ARM devices](#CVE-2024-1552)

Reporter
Gary Kwong
Impact
low
##### Description

Incorrect code generation could have led to unexpected numeric conversions and potential undefined behavior. *Note:* This issue only affects 32-bit ARM devices.

##### References

* [Bug 1874502](https://bugzilla.mozilla.org/show_bug.cgi?id=1874502)

#### [#CVE-2024-1553: Memory safety bugs fixed in Firefox 123, Firefox ESR 115.8, and Thunderbird 115.8](#CVE-2024-1553)

Reporter
Andrew McCreight, Randell Jesup, Gabriele Svelto, Paul Bone, and the Mozilla Fuzzing Team
Impact
high
##### Description

Memory safety bugs present in Firefox 122, Firefox ESR 115.7, and Thunderbird 115.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 123, Firefox ESR 115.8, and Thunderbird 115.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1855686%2C1867982%2C1871498%2C1872296%2C1873521%2C1873577%2C1873597%2C1873866%2C1874080%2C1874740%2C1875795%2C1875906%2C1876425%2C1878211%2C1878286)

#### [#CVE-2024-1557: Memory safety bugs fixed in Firefox 123](#CVE-2024-1557)

Reporter
Andrew McCreight, Randell Jesup, and the Mozilla Fuzzing Team
Impact
high
##### Description

Memory safety bugs present in Firefox 122. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 123](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1746471%2C1848829%2C1864011%2C1869175%2C1869455%2C1869938%2C1871606)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


