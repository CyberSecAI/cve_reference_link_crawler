```
{
  "cveId": "CVE-2024-40905",
  "description": "PLACEHOLDER - Implement CVE description retrieval",
  "relatedContent": [
    {
      "content": "ipv6: fix possible race in \\_\\_fib6\\_drop\\_pcpu\\_from()\n\nsyzbot found a race in \\_\\_fib6\\_drop\\_pcpu\\_from() [1]\n\nIf compiler reads more than once (\*ppcpu\\_rt),\nsecond read could read NULL, if another cpu clears\nthe value in rt6\\_get\\_pcpu\\_route().\n\nAdd a READ\\_ONCE() to prevent this race.\nAlso add rcu\\_read\\_lock()/rcu\\_read\\_unlock() because\nwe rely on RCU protection while dereferencing pcpu\\_rt.\n\n[1]\nOops: general protection fault, probably for non-canonical address 0xdffffc0000000012: 0000 [#1] PREEMPT SMP KASAN PTI\nKASAN: null-ptr-deref in range [0x0000000000000090-0x0000000000000097]\nCPU: 0 PID: 7543 Comm: kworker/u8:17 Not tainted 6.10.0-rc1-syzkaller-00013-g2bfcfd584ff5 #0\nHardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 04/02/2024\nWorkqueue: netns cleanup\\_net\nRIP: 0010:\\_\\_fib6\\_drop\\_pcpu\\_from.part.0+0x10a/0x370 net/ipv6/ip6\\_fib.c:984\nCode: f8 48 c1 e8 03 80 3c 28 00 0f 85 16 02 00 00 4d 8b 3f 4d 85 ff 74 31 e8 74 a7 fa f7 49 8d bf 90 00 00 00 48 89 f8 48 c1 e8 03 <80> 3c 28 00 0f 85 1e 02 00 00 49 8b 87 90 00 00 00 48 8b 0c 24 48\nRSP: 0018:ffffc900040df070 EFLAGS: 00010206\nRAX: 0000000000000012 RBX: 0000000000000001 RCX: ffffffff89932e16\nRDX: ffff888049dd1e00 RSI: ffffffff89932d7c RDI: 0000000000000091\nRBP: dffffc0000000000 R08: 0000000000000005 R09: 0000000000000007\nR10: 0000000000000001 R11: 0000000000000006 R12: ffff88807fa080b8\nR13: fffffbfff1a9a07d R14: ffffed100ff41022 R15: 0000000000000001\nFS: 0000000000000000(0000) GS:ffff8880b9200000(0000) knlGS:0000000000000000\nCS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 0000001b32c26000 CR3: 000000005d56e000 CR4: 00000000003526f0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nDR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\nCall Trace:\n<TASK>\n \\_\\_fib6\\_drop\\_pcpu\\_from net/ipv6/ip6\\_fib.c:966 [inline]\n fib6\\_drop\\_pcpu\\_from net/ipv6/ip6\\_fib.c:1027 [inline]\n fib6\\_purge\\_rt+0x7f2/0x9f0 net/ipv6/ip6\\_fib.c:1038\n fib6\\_del\\_route net/ipv6/ip6\\_fib.c:1998 [inline]\n fib6\\_del+0xa70/0x17b0 net/ipv6/ip6\\_fib.c:2043\n fib6\\_clean\\_node+0x426/0x5b0 net/ipv6/ip6\\_fib.c:2205\n fib6\\_walk\\_continue+0x44f/0x8d0 net/ipv6/ip6\\_fib.c:2127\n fib6\\_walk+0x182/0x370 net/ipv6/ip6\\_fib.c:2175\n fib6\\_clean\\_tree+0xd7/0x120 net/ipv6/ip6\\_fib.c:2255\n \\_\\_fib6\\_clean\\_all+0x100/0x2d0 net/ipv6/ip6\\_fib.c:2271\n rt6\\_sync\\_down\\_dev net/ipv6/route.c:4906 [inline]\n rt6\\_disable\\_ip+0x7ed/0xa00 net/ipv6/route.c:4911\n addrconf\\_ifdown.isra.0+0x117/0x1b40 net/ipv6/addrconf.c:3855\n addrconf\\_notify+0x223/0x19e0 net/ipv6/addrconf.c:3778\n notifier\\_call\\_chain+0xb9/0x410 kernel/notifier.c:93\n call\\_netdevice\\_notifiers\\_info+0xbe/0x140 net/core/dev.c:1992\n call\\_netdevice\\_notifiers\\_extack net/core/dev.c:2030 [inline]\n call\\_netdevice\\_notifiers net/core/dev.c:2044 [inline]\n dev\\_close\\_many+0x333/0x6a0 net/core/dev.c:1585\n unregister\\_netdevice\\_many\\_notify+0x46d/0x19f0 net/core/dev.c:11193\n unregister\\_netdevice\\_many net/core/dev.c:11276 [inline]\n default\\_device\\_exit\\_batch+0x85b/0xae0 net/core/dev.c:11759\n ops\\_exit\\_list+0x128/0x180 net/core/net\\_namespace.c:178\n cleanup\\_net+0x5b7/0xbf0 net/core/net\\_namespace.c:640\n process\\_one\\_work+0x9fb/0x1b60 kernel/workqueue.c:3231\n process\\_scheduled\\_works kernel/workqueue.c:3312 [inline]\n worker\\_thread+0x6c8/0xf70 kernel/workqueue.c:3393\n kthread+0x2c1/0x3a0 kernel/kthread.c:389\n ret\\_from\\_fork+0x45/0x80 arch/x86/kernel/process.c:147\n ret\\_from\\_fork\\_asm+0x1a/0x30 arch/x86/entry/entry\\_64.S:244\n\nFixes: d52d3997f843 (\"ipv6: Create percpu rt6\\_info\")\nSigned-off-by: Eric Dumazet <edumazet@google.com>\nCc: Martin KaFai Lau <kafai@fb.com>\nLink: [https://lore.kernel.org/r/20240604193549.981839-1-edumazet@google.com](https://lore.kernel.org/r/20240604193549.981839-1-edumazet%40google.com)\nSigned-off-by: Paolo Abeni <pabeni@redhat.com>\nSigned-off-by: Sasha Levin <sashal@kernel.org>",
      "vulnerability": {
        "rootCause": "A race condition exists in the `__fib6_drop_pcpu_from` function. The compiler might read the `*ppcpu_rt` value more than once. If another CPU clears the value in `rt6_get_pcpu_route()` between these reads, the second read can access a NULL pointer.",
        "weaknesses": [
          "Race Condition",
          "Null Pointer Dereference"
        ],
        "impact": "A null-pointer dereference can occur, leading to a general protection fault and a crash.",
        "attackVectors": [
          "Local",
          "Concurrent execution of network operations"
        ],
         "requiredCapabilities": "The attacker must be able to trigger network operations that lead to the execution of the vulnerable code path concurrently on different CPUs."
      }
    }
  ]
}
```