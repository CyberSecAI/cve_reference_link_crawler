=== Content from git.kernel.org_a5d85941_20250111_175546.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=38134ada0ceea3e848fe993263c0ff6207fd46e7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=38134ada0ceea3e848fe993263c0ff6207fd46e7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=38134ada0ceea3e848fe993263c0ff6207fd46e7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=38134ada0ceea3e848fe993263c0ff6207fd46e7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pavel Begunkov <asml.silence@gmail.com> | 2021-04-15 13:07:39 +0100 |
| --- | --- | --- |
| committer | Jens Axboe <axboe@kernel.dk> | 2021-04-17 19:20:07 -0600 |
| commit | [38134ada0ceea3e848fe993263c0ff6207fd46e7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=38134ada0ceea3e848fe993263c0ff6207fd46e7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=38134ada0ceea3e848fe993263c0ff6207fd46e7)) | |
| tree | [2401b532fc9a60889a0a29d5736f312d91f2c6c9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=38134ada0ceea3e848fe993263c0ff6207fd46e7) | |
| parent | [c82d5bc703825a47af5c600e82e1e0c1db49e036](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c82d5bc703825a47af5c600e82e1e0c1db49e036) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=38134ada0ceea3e848fe993263c0ff6207fd46e7&id2=c82d5bc703825a47af5c600e82e1e0c1db49e036)) | |
| download | [linux-38134ada0ceea3e848fe993263c0ff6207fd46e7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-38134ada0ceea3e848fe993263c0ff6207fd46e7.tar.gz) | |

io\_uring: fix overflows checks in provide buffersColin reported before possible overflow and sign extension problems in
io\_provide\_buffers\_prep(). As Linus pointed out previous attempt did nothing
useful, see d81269fecb8ce ("io\_uring: fix provide\_buffers sign extension").
Do that with help of check\_<op>\_overflow helpers. And fix struct
io\_provide\_buf::len type, as it doesn't make much sense to keep it
signed.
Reported-by: Colin Ian King <colin.king@canonical.com>
Fixes: efe68c1ca8f49 ("io\_uring: validate the full range of provided buffers for access")
Signed-off-by: Pavel Begunkov <asml.silence@gmail.com>
Link: [https://lore.kernel.org/r/46538827e70fce5f6cdb50897cff4cacc490f380.1618488258.git.asml.silence@gmail.com](https://lore.kernel.org/r/46538827e70fce5f6cdb50897cff4cacc490f380.1618488258.git.asml.silence%40gmail.com)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=38134ada0ceea3e848fe993263c0ff6207fd46e7)

| -rw-r--r-- | [fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/io_uring.c?id=38134ada0ceea3e848fe993263c0ff6207fd46e7) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 2 deletions

| diff --git a/fs/io\_uring.c b/fs/io\_uring.cindex 81bfe91aed0afe..bae13811d2f392 100644--- a/[fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/io_uring.c?id=c82d5bc703825a47af5c600e82e1e0c1db49e036)+++ b/[fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/io_uring.c?id=38134ada0ceea3e848fe993263c0ff6207fd46e7)@@ -626,7 +626,7 @@ struct io\_splice { struct io\_provide\_buf { struct file \*file; \_\_u64 addr;- \_\_s32 len;+ \_\_u32 len; \_\_u32 bgid; \_\_u16 nbufs; \_\_u16 bid;@@ -3918,7 +3918,7 @@ static int io\_remove\_buffers(struct io\_kiocb \*req, unsigned int issue\_flags) static int io\_provide\_buffers\_prep(struct io\_kiocb \*req, const struct io\_uring\_sqe \*sqe) {- unsigned long size;+ unsigned long size, tmp\_check; struct io\_provide\_buf \*p = &req->pbuf; u64 tmp; @@ -3932,6 +3932,12 @@ static int io\_provide\_buffers\_prep(struct io\_kiocb \*req, p->addr = READ\_ONCE(sqe->addr); p->len = READ\_ONCE(sqe->len); + if (check\_mul\_overflow((unsigned long)p->len, (unsigned long)p->nbufs,+ &size))+ return -EOVERFLOW;+ if (check\_add\_overflow((unsigned long)p->addr, size, &tmp\_check))+ return -EOVERFLOW;+ size = (unsigned long)p->len \* p->nbufs; if (!access\_ok(u64\_to\_user\_ptr(p->addr), size)) return -EFAULT; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 17:54:24 +0000



=== Content from git.kernel.org_15dfbcb3_20250111_175551.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cbbc13b115b8f18e0a714d89f87fbdc499acfe2d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cbbc13b115b8f18e0a714d89f87fbdc499acfe2d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cbbc13b115b8f18e0a714d89f87fbdc499acfe2d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cbbc13b115b8f18e0a714d89f87fbdc499acfe2d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pavel Begunkov <asml.silence@gmail.com> | 2021-04-15 13:07:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-05-14 09:50:28 +0200 |
| commit | [cbbc13b115b8f18e0a714d89f87fbdc499acfe2d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cbbc13b115b8f18e0a714d89f87fbdc499acfe2d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cbbc13b115b8f18e0a714d89f87fbdc499acfe2d)) | |
| tree | [f807801f0488aa1cfd104662ca883ba26208758c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cbbc13b115b8f18e0a714d89f87fbdc499acfe2d) | |
| parent | [db4645fbae17092b54efe48eda89f812c12406cd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=db4645fbae17092b54efe48eda89f812c12406cd) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cbbc13b115b8f18e0a714d89f87fbdc499acfe2d&id2=db4645fbae17092b54efe48eda89f812c12406cd)) | |
| download | [linux-cbbc13b115b8f18e0a714d89f87fbdc499acfe2d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cbbc13b115b8f18e0a714d89f87fbdc499acfe2d.tar.gz) | |

io\_uring: fix overflows checks in provide buffers[ Upstream commit 38134ada0ceea3e848fe993263c0ff6207fd46e7 ]
Colin reported before possible overflow and sign extension problems in
io\_provide\_buffers\_prep(). As Linus pointed out previous attempt did nothing
useful, see d81269fecb8ce ("io\_uring: fix provide\_buffers sign extension").
Do that with help of check\_<op>\_overflow helpers. And fix struct
io\_provide\_buf::len type, as it doesn't make much sense to keep it
signed.
Reported-by: Colin Ian King <colin.king@canonical.com>
Fixes: efe68c1ca8f49 ("io\_uring: validate the full range of provided buffers for access")
Signed-off-by: Pavel Begunkov <asml.silence@gmail.com>
Link: [https://lore.kernel.org/r/46538827e70fce5f6cdb50897cff4cacc490f380.1618488258.git.asml.silence@gmail.com](https://lore.kernel.org/r/46538827e70fce5f6cdb50897cff4cacc490f380.1618488258.git.asml.silence%40gmail.com)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cbbc13b115b8f18e0a714d89f87fbdc499acfe2d)

| -rw-r--r-- | [fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/io_uring.c?id=cbbc13b115b8f18e0a714d89f87fbdc499acfe2d) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 2 deletions

| diff --git a/fs/io\_uring.c b/fs/io\_uring.cindex 55e214defb42f3..369ec81033d674 100644--- a/[fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/io_uring.c?id=db4645fbae17092b54efe48eda89f812c12406cd)+++ b/[fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/io_uring.c?id=cbbc13b115b8f18e0a714d89f87fbdc499acfe2d)@@ -527,7 +527,7 @@ struct io\_splice { struct io\_provide\_buf { struct file \*file; \_\_u64 addr;- \_\_s32 len;+ \_\_u32 len; \_\_u32 bgid; \_\_u16 nbufs; \_\_u16 bid;@@ -3996,7 +3996,7 @@ static int io\_remove\_buffers(struct io\_kiocb \*req, bool force\_nonblock, static int io\_provide\_buffers\_prep(struct io\_kiocb \*req, const struct io\_uring\_sqe \*sqe) {- unsigned long size;+ unsigned long size, tmp\_check; struct io\_provide\_buf \*p = &req->pbuf; u64 tmp; @@ -4010,6 +4010,12 @@ static int io\_provide\_buffers\_prep(struct io\_kiocb \*req, p->addr = READ\_ONCE(sqe->addr); p->len = READ\_ONCE(sqe->len); + if (check\_mul\_overflow((unsigned long)p->len, (unsigned long)p->nbufs,+ &size))+ return -EOVERFLOW;+ if (check\_add\_overflow((unsigned long)p->addr, size, &tmp\_check))+ return -EOVERFLOW;+ size = (unsigned long)p->len \* p->nbufs; if (!access\_ok(u64\_to\_user\_ptr(p->addr), size)) return -EFAULT; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 17:54:28 +0000



=== Content from git.kernel.org_c185af81_20250111_175549.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=84b8c266c4bfe9ed5128e13253c388deb74b1b03)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=84b8c266c4bfe9ed5128e13253c388deb74b1b03)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=84b8c266c4bfe9ed5128e13253c388deb74b1b03)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=84b8c266c4bfe9ed5128e13253c388deb74b1b03)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pavel Begunkov <asml.silence@gmail.com> | 2021-04-15 13:07:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-05-14 10:52:42 +0200 |
| commit | [84b8c266c4bfe9ed5128e13253c388deb74b1b03](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=84b8c266c4bfe9ed5128e13253c388deb74b1b03) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=84b8c266c4bfe9ed5128e13253c388deb74b1b03)) | |
| tree | [5a3a6ee592e3265bb74514c79c36e1cdf688ced3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=84b8c266c4bfe9ed5128e13253c388deb74b1b03) | |
| parent | [9fb875f2c2f991bbee0fe74225f6168e3cffaa6d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9fb875f2c2f991bbee0fe74225f6168e3cffaa6d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=84b8c266c4bfe9ed5128e13253c388deb74b1b03&id2=9fb875f2c2f991bbee0fe74225f6168e3cffaa6d)) | |
| download | [linux-84b8c266c4bfe9ed5128e13253c388deb74b1b03.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-84b8c266c4bfe9ed5128e13253c388deb74b1b03.tar.gz) | |

io\_uring: fix overflows checks in provide buffers[ Upstream commit 38134ada0ceea3e848fe993263c0ff6207fd46e7 ]
Colin reported before possible overflow and sign extension problems in
io\_provide\_buffers\_prep(). As Linus pointed out previous attempt did nothing
useful, see d81269fecb8ce ("io\_uring: fix provide\_buffers sign extension").
Do that with help of check\_<op>\_overflow helpers. And fix struct
io\_provide\_buf::len type, as it doesn't make much sense to keep it
signed.
Reported-by: Colin Ian King <colin.king@canonical.com>
Fixes: efe68c1ca8f49 ("io\_uring: validate the full range of provided buffers for access")
Signed-off-by: Pavel Begunkov <asml.silence@gmail.com>
Link: [https://lore.kernel.org/r/46538827e70fce5f6cdb50897cff4cacc490f380.1618488258.git.asml.silence@gmail.com](https://lore.kernel.org/r/46538827e70fce5f6cdb50897cff4cacc490f380.1618488258.git.asml.silence%40gmail.com)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=84b8c266c4bfe9ed5128e13253c388deb74b1b03)

| -rw-r--r-- | [fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/io_uring.c?id=84b8c266c4bfe9ed5128e13253c388deb74b1b03) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 2 deletions

| diff --git a/fs/io\_uring.c b/fs/io\_uring.cindex 2bdd7eab6c6699..144056b0cac92f 100644--- a/[fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/io_uring.c?id=9fb875f2c2f991bbee0fe74225f6168e3cffaa6d)+++ b/[fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/io_uring.c?id=84b8c266c4bfe9ed5128e13253c388deb74b1b03)@@ -614,7 +614,7 @@ struct io\_splice { struct io\_provide\_buf { struct file \*file; \_\_u64 addr;- \_\_s32 len;+ \_\_u32 len; \_\_u32 bgid; \_\_u16 nbufs; \_\_u16 bid;@@ -3979,7 +3979,7 @@ static int io\_remove\_buffers(struct io\_kiocb \*req, unsigned int issue\_flags) static int io\_provide\_buffers\_prep(struct io\_kiocb \*req, const struct io\_uring\_sqe \*sqe) {- unsigned long size;+ unsigned long size, tmp\_check; struct io\_provide\_buf \*p = &req->pbuf; u64 tmp; @@ -3993,6 +3993,12 @@ static int io\_provide\_buffers\_prep(struct io\_kiocb \*req, p->addr = READ\_ONCE(sqe->addr); p->len = READ\_ONCE(sqe->len); + if (check\_mul\_overflow((unsigned long)p->len, (unsigned long)p->nbufs,+ &size))+ return -EOVERFLOW;+ if (check\_add\_overflow((unsigned long)p->addr, size, &tmp\_check))+ return -EOVERFLOW;+ size = (unsigned long)p->len \* p->nbufs; if (!access\_ok(u64\_to\_user\_ptr(p->addr), size)) return -EFAULT; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 17:54:27 +0000



=== Content from git.kernel.org_677caf2d_20250111_175548.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=51bf90901952aaac564bbdb36b2b503050c53dd9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=51bf90901952aaac564bbdb36b2b503050c53dd9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=51bf90901952aaac564bbdb36b2b503050c53dd9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=51bf90901952aaac564bbdb36b2b503050c53dd9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pavel Begunkov <asml.silence@gmail.com> | 2021-04-15 13:07:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-05-14 10:49:58 +0200 |
| commit | [51bf90901952aaac564bbdb36b2b503050c53dd9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=51bf90901952aaac564bbdb36b2b503050c53dd9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=51bf90901952aaac564bbdb36b2b503050c53dd9)) | |
| tree | [f007578bdbe10dd497559ce3bbf9cdbf163d8fc0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=51bf90901952aaac564bbdb36b2b503050c53dd9) | |
| parent | [63d99ca8e2dd3a96fbbadd42ce3733ad41e6c85e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=63d99ca8e2dd3a96fbbadd42ce3733ad41e6c85e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=51bf90901952aaac564bbdb36b2b503050c53dd9&id2=63d99ca8e2dd3a96fbbadd42ce3733ad41e6c85e)) | |
| download | [linux-51bf90901952aaac564bbdb36b2b503050c53dd9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-51bf90901952aaac564bbdb36b2b503050c53dd9.tar.gz) | |

io\_uring: fix overflows checks in provide buffers[ Upstream commit 38134ada0ceea3e848fe993263c0ff6207fd46e7 ]
Colin reported before possible overflow and sign extension problems in
io\_provide\_buffers\_prep(). As Linus pointed out previous attempt did nothing
useful, see d81269fecb8ce ("io\_uring: fix provide\_buffers sign extension").
Do that with help of check\_<op>\_overflow helpers. And fix struct
io\_provide\_buf::len type, as it doesn't make much sense to keep it
signed.
Reported-by: Colin Ian King <colin.king@canonical.com>
Fixes: efe68c1ca8f49 ("io\_uring: validate the full range of provided buffers for access")
Signed-off-by: Pavel Begunkov <asml.silence@gmail.com>
Link: [https://lore.kernel.org/r/46538827e70fce5f6cdb50897cff4cacc490f380.1618488258.git.asml.silence@gmail.com](https://lore.kernel.org/r/46538827e70fce5f6cdb50897cff4cacc490f380.1618488258.git.asml.silence%40gmail.com)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=51bf90901952aaac564bbdb36b2b503050c53dd9)

| -rw-r--r-- | [fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/io_uring.c?id=51bf90901952aaac564bbdb36b2b503050c53dd9) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 2 deletions

| diff --git a/fs/io\_uring.c b/fs/io\_uring.cindex 157ceda046505f..c42c2e9570e584 100644--- a/[fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/io_uring.c?id=63d99ca8e2dd3a96fbbadd42ce3733ad41e6c85e)+++ b/[fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/io_uring.c?id=51bf90901952aaac564bbdb36b2b503050c53dd9)@@ -535,7 +535,7 @@ struct io\_splice { struct io\_provide\_buf { struct file \*file; \_\_u64 addr;- \_\_s32 len;+ \_\_u32 len; \_\_u32 bgid; \_\_u16 nbufs; \_\_u16 bid;@@ -4214,7 +4214,7 @@ static int io\_remove\_buffers(struct io\_kiocb \*req, bool force\_nonblock, static int io\_provide\_buffers\_prep(struct io\_kiocb \*req, const struct io\_uring\_sqe \*sqe) {- unsigned long size;+ unsigned long size, tmp\_check; struct io\_provide\_buf \*p = &req->pbuf; u64 tmp; @@ -4228,6 +4228,12 @@ static int io\_provide\_buffers\_prep(struct io\_kiocb \*req, p->addr = READ\_ONCE(sqe->addr); p->len = READ\_ONCE(sqe->len); + if (check\_mul\_overflow((unsigned long)p->len, (unsigned long)p->nbufs,+ &size))+ return -EOVERFLOW;+ if (check\_add\_overflow((unsigned long)p->addr, size, &tmp\_check))+ return -EOVERFLOW;+ size = (unsigned long)p->len \* p->nbufs; if (!access\_ok(u64\_to\_user\_ptr(p->addr), size)) return -EFAULT; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 17:54:25 +0000


