
[![Splunk Security Content Logo](https://research.splunk.com/images/logo.svg)](https://research.splunk.com/)

* [Analytic Stories](https://research.splunk.com/stories/)
* [Detections](https://research.splunk.com/detections/)
* [Playbooks](https://research.splunk.com/playbooks/)
* [Data Sources](https://research.splunk.com/sources/)
* [Blog](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)
* [About](http://splunk.com/threat-research)
* [![GitHub Repo](https://research.splunk.com/images/GitHubMarkLight.svg)](https://github.com/splunk/security_content)

## Table of Contents

* + [Description](#description)
  + [Search](#search)
  + [Data Source](#data-source)
  + [Macros Used](#macros-used)
  + [Annotations](#annotations)
  + [Default Configuration](#default-configuration)
  + [Implementation](#implementation)
  + [Known False Positives](#known-false-positives)
  + [Associated Analytic Story](#associated-analytic-story)
  + [Risk Based Analytics (RBA)](#risk-based-analytics-rba)
  + [References](#references)
  + [Detection Testing](#detection-testing)

# Detection: Splunk Code Injection via custom dashboard leading to RCE

**EXPERIMENTAL DETECTION**

This detection status is set to experimental. The Splunk Threat Research team has not yet fully tested, simulated, or built comprehensive datasets for this detection. As such, this analytic is not officially supported. If you have any questions or concerns, please reach out to us at research@splunk.com.

Updated Date: 2024-10-17
ID: b06b41d7-9570-4985-8137-0784f582a1b3
Author: Rod Soto
[Type: Hunting](#default-configuration)
[Product: Splunk Enterprise Security](https://www.splunk.com/en_us/products/enterprise-security.html)
### Description

The following analytic identifies attempts to exploit a vulnerability in Splunk Enterprise versions below 8.2.9, 8.1.12, and 9.0.2, where an authenticated user can execute arbitrary code via the dashboard PDF generation component. It detects this activity by analyzing events in the \_internal index with the file=export parameter. This behavior is significant because it indicates a potential code injection attack, which could lead to remote code execution (RCE). If confirmed malicious, an attacker could gain unauthorized access, execute arbitrary commands, and potentially compromise the entire Splunk environment.

### Search

```
 1`splunkd_ui` uri_path=*/data/ui/views/* OR uri_path=*saved/searches/*
 2| dedup uri_path
 3| eval URL=urldecode("uri_path")
 4| rex field=URL "\/saved\/searches\/(?<NAME>[^\/]*)"
 5| rex field=URL "\/data\/ui\/views\/(?<NAME1>[^\/]*)"
 6| eval NAME=NAME."( Saved Search )",NAME1=NAME1."( Dashboard )"
 7| eval NAME=coalesce(NAME,NAME1)
 8| eval STATUS=case(match(status,"2\d+"),"SUCCESS",match(status,"3\d+"),"REDIRECTION",match(status,"4\d+") OR match(status,"5\d+"),"ERROR")
 9| stats list(NAME) as DASHBOARD_TITLE,list(method) as HTTP_METHOD,list(status) as Status_Code,list(STATUS) as STATUS by user
10| rename user as User
11| `splunk_code_injection_via_custom_dashboard_leading_to_rce_filter`

```
### Data Source

No data sources specified for this detection.

### Macros Used

| Name | Value |
| --- | --- |
| [splunkd\_ui](https://github.com/splunk/security_content/blob/develop/macros/splunkd_ui.yml) | `index=_internal sourcetype=splunkd_ui_access` |
| splunk\_code\_injection\_via\_custom\_dashboard\_leading\_to\_rce\_filter | `search *` |

`splunk_code_injection_via_custom_dashboard_leading_to_rce_filter` is an empty macro by default. It allows the user to filter out any results (false positives) without editing the SPL.
### Annotations

- MITRE ATT&CK

+ Kill Chain Phases

+ NIST

+ CIS

- Threat Actors

| ID | Technique | Tactic |
| --- | --- | --- |
| [T1210](https://attack.mitre.org/techniques/T1210/) | Exploitation of Remote Services | Lateral Movement |

KillChainPhase.EXPLOITAITON

NistCategory.DE\_AE

Cis18Value.CIS\_10

APT28
Dragonfly
Earth Lusca
Ember Bear
FIN7
Fox Kitten
MuddyWater
Threat Group-3390
Tonto Team
Wizard Spider
menuPass

### Default Configuration

This detection is configured by default in Splunk Enterprise Security to run with the following settings:

| Setting | Value |
| --- | --- |
| Disabled | true |
| Cron Schedule | `0 * * * *` |
| Earliest Time | `-70m@m` |
| Latest Time | `-10m@m` |
| Schedule Window | `auto` |
| Creates Risk Event | False |

This configuration file applies to all detections of type hunting.
### Implementation

This detection does not require you to ingest any new data. The detection does require the ability to search the \_internal index.

### Known False Positives

Not all exports and downloads are malicious, special attention must be put as well on /en-US/splunkd/\_\_raw/services/pdfgen/render in the context of this search.

### Associated Analytic Story

* [Splunk Vulnerabilities](/stories/splunk_vulnerabilities/)

### Risk Based Analytics (RBA)

| Risk Message | Risk Score | Impact | Confidence |
| --- | --- | --- | --- |
| Potential exploitation of Code Injection via Dashboard PDF generation. | 25 | 50 | 50 |

The Risk Score is calculated by the following formula: Risk Score = (Impact \* Confidence/100). Initial Confidence and Impact is set by the analytic author.
### References

* <https://www.splunk.com/en_us/product-security.html>

### Detection Testing

| Test Type | Status | Dataset | Source | Sourcetype |
| --- | --- | --- | --- | --- |
| Validation | Not Applicable | N/A | N/A | N/A |
| Unit | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1210/splunk/splunk_code_injection_via_custom_dashboard_leading_to_rce.log) | `/opt/splunk/var/log/splunk/splunkd_ui_access.log` | `splunkd_ui_access` |
| Integration | â Passing | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1210/splunk/splunk_code_injection_via_custom_dashboard_leading_to_rce.log) | `/opt/splunk/var/log/splunk/splunkd_ui_access.log` | `splunkd_ui_access` |

Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)

---

Source: [GitHub](https://github.com/splunk/security_content/tree/develop/detections/application/splunk_code_injection_via_custom_dashboard_leading_to_rce.yml) |
Version: **3**

[Detection: Splunk App for Lookup File Editing RCE via User XSLT](https://research.splunk.com/application/a053e6a6-2146-483a-9798-2d43652f3299/ "Detection: Splunk App for Lookup File Editing RCE via User XSLT")

[Detection: Splunk Command and Scripting Interpreter Risky Commands](https://research.splunk.com/application/1cf58ae1-9177-40b8-a26c-8966040f11ae/ "Detection: Splunk Command and Scripting Interpreter Risky Commands")

Â© 2005 - 2024 Splunk LLC All rights reserved.

