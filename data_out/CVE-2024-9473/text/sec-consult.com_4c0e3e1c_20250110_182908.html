
Toggle Navbar

* [Career](/career/)
* [About us](/about-us/)
* [Contact](/contact/)

* EN
  + [DE](/de/vulnerability-lab/advisory/local-privilege-escalation-mittels-msi-installer-in-palo-alto-networks-globalprotect/ "German")
Search

* Security Testing
  + [Web Application Security](/security-testing/web-application-security/)
  + [Penetration Testing](/security-testing/penetration-testing/)
  + [Mobile Security](/security-testing/mobile-security/)
  + [Cloud Security](/security-testing/cloud-security/)
  + [IT Infrastructure Security](/security-testing/it-infrastructure-security/)
  + [Security for SAP Services](/security-testing/security-for-sap-services/)
  + [IoT and Embedded Systems Security](/security-testing/iot-and-embedded-systems-security/)
  + [Red Teaming](/security-testing/red-teaming/)
* Processes & Organisation
  + [Information Security Management (ISM)](/processes-organisation/information-security-management-ism/)
  + [Network and Information Systems Security (NIS)](/processes-organisation/network-and-information-systems-security-nis/)
  + [OT Security](/processes-organisation/ot-security/)
  + [Secure Software Development Consulting](/processes-organisation/secure-software-development/)
  + [Red Teaming](/security-testing/red-teaming/)
  + [SEC Trainings](/processes-organisation/sec-trainings/)
  + [Project- und Program Management](/processes-organisation/project-und-program-management/)
* Incident Response
  + [SEC Defence](/incident-response/sec-defence/)
* [Vulnerability Lab](/vulnerability-lab/)
* [Blog](/blog/)
 [Incident?
Breached?
Report an incident](/incident-response/sec-defence/)

1. [Home](/)
2. [Vulnerability Lab](/vulnerability-lab/)
3. Local Privilege Escalation via MSI installer in Palo Alto Networks GlobalProtect
# Local Privilege Escalation via MSI installer in Palo Alto Networks GlobalProtect

Title

Local Privilege Escalation via MSI installer

Product

Palo Alto Networks GlobalProtect

Vulnerable Version

5.1.x, 5.2.x, 6.0.x, 6.1.x, <6.2.5, 6.3.x

Fixed Version

>=6.2.5, all other versions are not patched yet

CVE Number

CVE-2024-9473

Impact

high

Homepage

[https://docs.paloaltonetworks.com/globalprotect](https://docs.paloaltonetworks.com/globalprotect "https://docs.paloaltonetworks.com/globalprotect")

Found

16.11.2023

By

Michael Baer (Office Fürth) | SEC Consult Vulnerability Lab

The MSI installer of GlobalProtect of Palo Alto Networks contains a privilege escalation vulnerability. This enables a local, low-privileged attacker with GUI access to a system, where GlobalProtect is installed via the MSI installer, to escalate the privileges to SYSTEM level.

## Vendor description

*"GlobalProtect enables you to use Palo Alto Networks next-gen firewalls or Prisma Access to secure your mobile workforce."*

Source: <https://docs.paloaltonetworks.com/globalprotect>

## Business recommendation

The vendor provides a patched version v6.2.5 which should be installed immediately. Further affected branches will be patched by the vendor in the future, except branch 5.2.x which is EOL. Users are urged to upgrade to the most recent versions.

SEC Consult highly recommends to perform a thorough security review of the product conducted by security professionals to identify and resolve potential further security issues.

## Vulnerability overview/description

### 1) Local Privilege Escalation via MSI installer (CVE-2024-9473)

The configuration of the GlobalProtect MSI installer file was found to produce a visible conhost.exe window running as the SYSTEM user when using the repair function of msiexec.exe. This allows a local, low-privileged attacker to use a chain of actions, to open a fully functional cmd.exe with the privileges of the SYSTEM user.

## Proof of concept

### 1) Local Privilege Escalation via MSI installer (CVE-2024-9473)

For the exploit to work, GlobalProtect has to be installed via the MSI file. Afterwards, any low-privileged user can start the repair of GlobalProtect by double-clicking the installer and trigger the vulnerable actions without a UAC popup. The installer, if deleted from it's original location, can be found in C:\Windows\Installer with a randomized name.

During the repair process, the subprocess PanVCrediChecker.exe gets called with SYSTEM privileges and performs a read action on the file "C:\Program Files\Palo Alto Networks\GlobalProtect\libeay32.dll".

This can be used by an attacker by simply setting an oplock on the file. As soon as it gets read, the process is blocked until the lock is released. To do that, one can use the 'SetOpLock.exe' tool from "https://github.com/googleprojectzero/symboliclink-testing-tools" with the following parameters, see figure 1:

```
SetOpLock.exe "C:\Program Files\Palo Alto Networks\GlobalProtect\libeay32.dll" x
```
![](/fileadmin/user_upload/sec-consult/Dynamisch/Advisories/2024_10/sec-consult-c-palo-alto-lock.png)

Figure 1: SetOpLock.exe execution

![](/fileadmin/user_upload/sec-consult/Dynamisch/Advisories/2024_10/sec-consult-c-palo-alto-openbrowser.png)

Figure 2: Open browser (untick "Always use this app")

During the repair process, the locked file is accessed several times. The lock has to be released by pressing ENTER five times before the conhost.exe window opens. For the sixth request, the lock should not be released to keep the window open. The conhost window that gets opened when PanVcrediChecker.exe is executed doesn't close and can then be interacted with.

The attacker can then perform the following actions to spawn a SYSTEM shell:

* Right click on the top bar of the window
* Click on properties [see figure 2 below]
* Under options, click on the "new console features" link [see figure 2 below]
* Open the link with e.g. firefox or chrome [see figure 2 below]
![](/fileadmin/user_upload/sec-consult/Dynamisch/Advisories/2024_10/sec-consult-c-palo-alto-cmd.png)

Figure 3: Execution of cmd.exe as SYSTEM

* In the opened browser window press the key combination CTRL+o
* Type cmd.exe in the top bar and press Enter [see figure 3 below]

Note that this does not work using a recent version of the Edge Browser.

## Vulnerable / tested versions

The following versions have been tested which were the only versions available to SEC Consult at the time of the test. SEC Consult was not entirely sure, which exact version the product was:

* ProductVersion as stated by the PropertyTable: 5.2.10
* Version as stated by Windows after installing: 5.1.5
* 6.1.2 is affected as well

The vendor confirmed that versions <6.2.5 are affected. Furthermore, all other branches 5.1.x, 5.2.x, 6.0.x, 6.1.x and 6.3.x are affected as well. Branch 5.2.x is end of life according to the vendor and will not be patched.

## Vendor contact timeline

| 2023-11-17 | Contacting vendor through PSIRT@PaloAltoNetworks.com asking for most recent software version |
| --- | --- |
| 2023-11-21 | Vendor confirms receipt of contact |
| 2023-11-23 | Vendor denies providing most recent version and asks for full technical report via their online form: https://security.paloaltonetworks.com/report Note: Submitting the advisory draft via online form repeatedly results in server errors |
| 2023-11-23 | Sending the advisory via PSIRT@PaloAltoNetworks.com |
| 2024-01-11 | Contacting vendor through PSIRT@PaloAltoNetworks.com asking for confirmation of receiving the advisory and status of their triage. |
| 2024-01-12 | Vendor confirms receiving the advisory. The issue is tracked internally. |
| 2024-03-06 | Contacting vendor through PSIRT@PaloAltoNetworks.com asking for update of the vulnerability. |
| 2024-04-02 | The vendor notifies that the product team is working on the report. |
| 2024-04-08 | Asking vendor to notify about updates and the timeline of a fix. |
| 2024-04-24 | Vendor was able to reproduce the issue, but not in the most recent versions. 5.1.5 is affected, but not 5.2.10 nor 5.1.12, nor 6.2.2. |
| 2024-05-23 | Asking vendor about affected/fixed versions and regarding CVE number. |
| 2024-05-30 | Vendor apologizes for version confusion, following up with team internally. Vendor plans to publish an advisory with CVE, but no date yet, asks us to wait/coordinate our advisory with theirs. |
| 2024-06-03 | Answering that we will wait for their release & advisory. |
| 2024-06-17 | Asking for a status update regarding the version numbers & advisory release. Vendor: no ETA/timeline yet, no version information. |
| 2024-09-25 | Asking for a status update regarding the vendor advisory and for confirmation of the available fixes. |
| 2024-09-27 | Vendor investigated further and previous versions are unfortunately affected as well. Product team works on a fix, advisory & CVE release scheduled for 9th October 9 AM PT. |
| 2024-09-27 | Acknowledging the coordinated advisory release for 9th October. |
| 2024-10-03 | Vendor communicates further information regarding affected versions and their advisory draft. |
| 2024-10-07 | Vendor confirms 5.2.x as affected as well, but is EOL without fix. |
| 2024-10-09 | Coordinated release of security advisory. |

## Solution

The vendor provides an updated version v6.2.5 which fixes the issues for this specific branch. Other versions are not yet patched and will be fixed in future releases.

Further information can be found at the vendor's website: <https://security.paloaltonetworks.com>

Users are urged to upgrade to the latest version and remove old versions of the MSI installer, especially users of v5.2.x as this branch is EOL and won't receive an update.

 SEC Consult has also released a blog post on 12th September 2024 regarding MSI installer security issues tracked as CVE-2024-38014 and a general fix by Microsoft. We have contacted Microsoft to have a more general solution for every affected vendor. For further details check out the blog post: <https://r.sec-consult.com/msi>

## Workaround

None

## Advisory URL

<https://sec-consult.com/vulnerability-lab/>

 EOF Michael Baer / @2024

*Interested to work with the experts of SEC Consult? Send us your [application](https://sec-consult.com/career/)*

*Interested in improving your cyber security with the experts of SEC Consult? Contact our [local offices](https://sec-consult.com/contact/)*

[Back](/vulnerability-lab/)

* [Legal Notice](/legalnotice/)
* [Privacy Statement](/privacy-statement/)
* [Jobs](/career/)

SEC Consult is one of the leading consultancies in the field of cyber and [application security](/security-testing/web-application-security/ "Web Application Security"). The company specializes in [information security management](/processes-organisation/information-security-management-ism/ "Information Security Management (ISM)"), [NIS security audits](/processes-organisation/network-and-information-systems-security-nis/ "NIS security audits"), [penetration testing](/security-testing/penetration-testing/ "Pentesting (Pentest)"), ISO 27001 certification support, [Cyber Defence](/incident-response/sec-defence/ "Cyber Defence") and [secure software certification](/processes-organisation/secure-software-development/ "Secure Software Development Consulting"). SEC Consult is part of [Eviden](https://eviden.com/ "Link to Eviden website").

[![bsi ISO/IEC 27001 Information Security Management CERTIFIED](/typo3temp/assets/_processed_/c/2/csm_bsi_9a24e74563.png)](/about-us/ "About us")[![ISO 27001 CREST certified](/typo3temp/assets/_processed_/0/6/csm_crest_0eb9c5864d.png)](/about-us/ "About us")[![Great Place To Work AT certified](/typo3temp/assets/_processed_/0/3/csm_great-place-to-work-at_773b265aa6.png)](/about-us/ "About us")[![Great Place To Work DE certified](/typo3temp/assets/_processed_/d/6/csm_great-place-to-work-de_2fcb537270.png)](/about-us/ "About us")

## We use Cookies

We use cookies to offer you a perfect visit experience. These include cookies that are necessary for the operation of the site and for the control of our commercial corporate goals, as well as those that are only used for anonymous statistical purposes, for convenience settings or to display personalized content. Decide for yourself which categories you want to allow. Please note that based on your settings, not all functions of the site may be available.

**[Legal Notice](/legalnotice/)** •  **[Privacy Statement](/privacy-statement/)**

### Technically required

(
0
Service
)

no

Technically required (
0
Service
)

yes

### Analysis / statistics

(
1
Service
)

Anonymous evaluation for troubleshooting and further development

no

Analysis / statistics (
1
Service
)

yes

#### Matomo

no

Matomo

yes

Matomo.org
Show details

Hide details

**Purpose**: Error analysis, statistical evaluation of our website accesses, campaign analysis, conversion tracking.
 **Processing operations**: collection of access data, data from your browser and data about the content accessed; execution of analysis software and storage of data on your terminal device, anonymization of the data collected; evaluation of the anonymous data in the form of statistics.
 **Storage period**: 1 year.
 **Joint controller**: LimeSoda Interactive Marketing GmbH.
 **Legal basis for data processing**: Art. 6 para. 1 lit. f of the DSGVO.
 **Consequences of non-consent**: This basic tracking is absolutely necessary for the operation of our website.
 **Data transfer**: The data collected with Matomo is stored on our own servers. It is not passed on to third parties.

Accept selected

Reject all

Accept all

