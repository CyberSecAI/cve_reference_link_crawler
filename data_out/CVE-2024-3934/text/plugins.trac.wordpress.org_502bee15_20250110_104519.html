

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3119214%2Fwoocommerce-mercadopago%2Ftags%2F7.6.2%2Fsrc%2FIO%2FDownloader.php%3Fold%3D3108278%26old_path%3Dwoocommerce-mercadopago%252Ftags%252F7.6.1%252Fsrc%252FIO%252FDownloader.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3108278/woocommerce-mercadopago/tags/7.6.1/src/IO/Downloader.php?old=3119214&old_path=%2Fwoocommerce-mercadopago%2Ftags%2F7.6.2%2Fsrc%2FIO%2FDownloader.php)

---

# Changes from [woocommerce-mercadopago/tags/7.6.1/src/IO/Downloader.php](/browser/woocommerce-mercadopago/tags/7.6.1/src/IO/Downloader.php?rev=3108278 "Show entry in browser") at [r3108278](/changeset/3108278 "Show full changeset") to [woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php](/browser/woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php?rev=3119214 "Show entry in browser") at [r3119214](/changeset/3119214 "Show full changeset")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

File:

1 edited

* [woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php](/browser/woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php?rev=3119214 "Show entry in browser")
  (modified)
  ([7 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php](/changeset/3119214/woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php?old=3108278&old_path=woocommerce-mercadopago%2Ftags%2F7.6.1%2Fsrc%2FIO%2FDownloader.php "Show the [3108278:3119214] differences restricted to woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php")

  | [r3108278](/browser/woocommerce-mercadopago/tags/7.6.1/src/IO/Downloader.php?rev=3108278#L6 "Show revision 3108278 of this file in browser") | [r3119214](/browser/woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php?rev=3119214#L6 "Show revision 3119214 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | use MercadoPago\Woocommerce\Libraries\Logs\Logs; |
  | 7 | 7 | use MercadoPago\Woocommerce\Helpers\Form; |
  |  | 8 | use MercadoPago\Woocommerce\Helpers\CurrentUser; |
  | 8 | 9 |  |
  | 9 | 10 | if (!defined('ABSPATH')) { |
  | […](/browser/woocommerce-mercadopago/tags/7.6.1/src/IO/Downloader.php?rev=3108278#L24) | […](/browser/woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php?rev=3119214#L25) |  |
  | 24 | 25 | public $pluginLogs; |
  | 25 | 26 |  |
  |  | 27 | /\*\* |
  |  | 28 | \* @var CurrentUser |
  |  | 29 | \*/ |
  |  | 30 | private $currentUser; |
  | 26 | 31 |  |
  | 27 |  | public function \_\_construct(Logs $logs) |
  |  | 32 | public function \_\_construct(Logs $logs, CurrentUser $currentUser) |
  | 28 | 33 | { |
  |  | 34 | $this->currentUser  = $currentUser; |
  | 29 | 35 | $this->logs     = $logs; |
  | 30 | 36 | $this->pluginLogs = $this->getNameOfFileLogs(); |
  | […](/browser/woocommerce-mercadopago/tags/7.6.1/src/IO/Downloader.php?rev=3108278#L100) | […](/browser/woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php?rev=3119214#L106) |  |
  | 100 | 106 | $filename = reset($selectedFile); |
  | 101 | 107 |  |
  | 102 |  | if (!$this->validate~~Filename~~($filename)) { |
  |  | 108 | if (!$this->validatesDownloadSecurity($filename)) { |
  | 103 | 109 | throw new \Exception('attempt to download the file ' . $filename . 'on ' .  \_\_METHOD\_\_); |
  | 104 | 110 | } |
  | […](/browser/woocommerce-mercadopago/tags/7.6.1/src/IO/Downloader.php?rev=3108278#L129) | […](/browser/woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php?rev=3119214#L135) |  |
  | 129 | 135 | if ($zip->open($temp\_file, \ZipArchive::CREATE) === true) { |
  | 130 | 136 | foreach ($selectedFiles as $filename) { |
  | 131 |  | if (!$this->validate~~Filename~~($filename)) { |
  |  | 137 | if (!$this->validatesDownloadSecurity($filename)) { |
  | 132 | 138 | continue; |
  | 133 | 139 | } |
  | […](/browser/woocommerce-mercadopago/tags/7.6.1/src/IO/Downloader.php?rev=3108278#L153) | […](/browser/woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php?rev=3119214#L159) |  |
  | 153 | 159 |  |
  | 154 | 160 | /\*\* |
  | 155 |  | \* Validates a filename to prevent path traversal attempts and ensure expected format. |
  |  | 161 | \* Validates a filename and user permissions to prevent path traversal attempts and ensure expected format. |
  | 156 | 162 | \* |
  | 157 | 163 | \* @param string $filename The filename to be validated |
  | […](/browser/woocommerce-mercadopago/tags/7.6.1/src/IO/Downloader.php?rev=3108278#L159) | […](/browser/woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php?rev=3119214#L165) |  |
  | 159 | 165 | \* @return bool True if the filename is valid, false otherwise |
  | 160 | 166 | \*/ |
  | 161 |  | private function validate~~Filename~~(string $filename): bool |
  |  | 167 | private function validatesDownloadSecurity(string $filename): bool |
  | 162 | 168 | { |
  |  | 169 | $this->currentUser->validateUserNeededPermissions(); |
  |  | 170 |  |
  | 163 | 171 | return $this->hasAllowedExtension($filename) && |
  | 164 | 172 | $this->hasNoDisallowedCharacters($filename) && |
  | […](/browser/woocommerce-mercadopago/tags/7.6.1/src/IO/Downloader.php?rev=3108278#L169) | […](/browser/woocommerce-mercadopago/tags/7.6.2/src/IO/Downloader.php?rev=3119214#L177) |  |
  | 169 | 177 | { |
  | 170 | 178 | $allowed\_pattern = '/\.log$/'; |
  | 171 |  | return (bool)preg\_match($allowed\_pattern, $filename); |
  |  | 179 | return  (bool)preg\_match($allowed\_pattern, $filename); |
  | 172 | 180 | } |
  | 173 | 181 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3119214&old=3108278&new_path=%2Fwoocommerce-mercadopago%2Ftags%2F7.6.2%2Fsrc%2FIO%2FDownloader.php&old_path=%2Fwoocommerce-mercadopago%2Ftags%2F7.6.1%2Fsrc%2FIO%2FDownloader.php)
* [Zip Archive](?format=zip&new=3119214&old=3108278&new_path=%2Fwoocommerce-mercadopago%2Ftags%2F7.6.2%2Fsrc%2FIO%2FDownloader.php&old_path=%2Fwoocommerce-mercadopago%2Ftags%2F7.6.1%2Fsrc%2FIO%2FDownloader.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

