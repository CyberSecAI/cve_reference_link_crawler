=== Content from www.code-intelligence.com_66a33abd_20250111_124035.html ===


[Skip to content](#main-content)
Close

* Product
  + Our Products
    - [CI Fuzz](https://www.code-intelligence.com/product-ci-fuzz)
    - [Documentation](https://docs.code-intelligence.com/)
    - [Product Demo](https://www.code-intelligence.com/book-a-demo)
  + Our Solutions
    - [Application security](https://www.code-intelligence.com/solutions-application-security)
    - [Testing efficiency](https://www.code-intelligence.com/solutions-testing-efficiency)
    - [Vulnerability detection](https://www.code-intelligence.com/solutions-vulnerability-detection)
    - [ISO 21434 Compliance](https://www.code-intelligence.com/solutions-iso-21434-compliance)
    - [AUTOSAR Simulator](https://www.code-intelligence.com/solutions/autosar-simulator)
  + By industry
    - [Automotive](https://www.code-intelligence.com/industry-automotive-landing-page-old)
    - [Medical Devices](https://www.code-intelligence.com/industry/medical-devices-security)
* Resources
  + [Blog](https://www.code-intelligence.com/blog)
  + [Webinars](https://www.code-intelligence.com/webinar)
  + [White papers & Checklists](https://www.code-intelligence.com/white-papers-and-checklists)
* Company
  + [About Code Intelligence](https://www.code-intelligence.com/about-us)
  + [Contact Us](https://www.code-intelligence.com/contact)
SEARCH

[BOOK A DEMO](https://www.code-intelligence.com/book-a-demo "Button BOOK A DEMO")

[![Code Intelligence](https://www.code-intelligence.com/hs-fs/hubfs/Logos/CI%20Logos/Logo_quer_wei%C3%9F-1.png?width=1200&height=400&name=Logo_quer_wei%C3%9F-1.png)](/)

* Product
  + Our Products
    - [CI Fuzz](https://www.code-intelligence.com/product-ci-fuzz)
    - [Documentation](https://docs.code-intelligence.com/)
    - [Product Demo](https://www.code-intelligence.com/book-a-demo)
  + Our Solutions
    - [Application security](https://www.code-intelligence.com/solutions-application-security)
    - [Testing efficiency](https://www.code-intelligence.com/solutions-testing-efficiency)
    - [Vulnerability detection](https://www.code-intelligence.com/solutions-vulnerability-detection)
    - [ISO 21434 Compliance](https://www.code-intelligence.com/solutions-iso-21434-compliance)
    - [AUTOSAR Simulator](https://www.code-intelligence.com/solutions/autosar-simulator)
  + By industry
    - [Automotive](https://www.code-intelligence.com/industry-automotive-landing-page-old)
    - [Medical Devices](https://www.code-intelligence.com/industry/medical-devices-security)
* Resources
  + [Blog](https://www.code-intelligence.com/blog)
  + [Webinars](https://www.code-intelligence.com/webinar)
  + [White papers & Checklists](https://www.code-intelligence.com/white-papers-and-checklists)
* Company
  + [About Code Intelligence](https://www.code-intelligence.com/about-us)
  + [Contact Us](https://www.code-intelligence.com/contact)

[BOOK A DEMO](https://www.code-intelligence.com/book-a-demo "Button BOOK A DEMO")

Search Suggestions

**OUR PRODUCTS**

[**CI Fuzz**
Finds the hidden bugs in software](https://www.code-intelligence.com/product-ci-fuzz)[**Documentation**](https://docs.code-intelligence.com/)[**Product Demo**](https://www.code-intelligence.com/book-a-demo)

**OUR SOLUTIONS**

[**Application security**Maximum code coverage](https://www.code-intelligence.com/solutions-application-security)[**Testing efficiency**Secure software with less effort](https://www.code-intelligence.com/solutions-testing-efficiency)[**Vulnerability detection**Fix vulnerabilities in your software](https://www.code-intelligence.com/solutions-vulnerability-detection)[**ISO 21434**Comply with testing requirements](https://www.code-intelligence.com/solutions-iso-21434-compliance)[**AUTOSAR Simulator**Test AUTOSAR applications without hardware](https://www.code-intelligence.com/solutions/autosar-simulator)

**BY INDUSTRY**

[**Automotive**Software testing without hardware dependencies](https://www.code-intelligence.com/industry-automotive-landing-page)[**Medical Devices**Fuzz testing for medical device security](https://www.code-intelligence.com/industry/medical-devices-security)

[**Blog**](https://www.code-intelligence.com/blog)[**Webinars**](https://www.code-intelligence.com/webinar)[**White papers & Checklists**](https://www.code-intelligence.com/white-papers-and-checklists)

[**About Code Intelligence**](https://www.code-intelligence.com/about-us)[**Contact Us**](https://www.code-intelligence.com/contact)

[Roman Wagner](https://www.code-intelligence.com/blog/author/roman-wagner)3 min read
# New Vulnerability in tree-kit: Prototype Pollution - CVE-2023-38894

We have found a new Prototype Pollution vulnerability in the JavaScript package tree-kit in all versions before 0.7.5. The maintainer of [tree-kit](https://github.com/cronvel/tree-kit) has released an update that fixed the issue on 21 July 2023. The vulnerability was discovered by Peter Samarin using [Jazzer.js](https://github.com/CodeIntelligenceTesting/jazzer.js) with our newly integrated Prototype Pollution bug detector. This finding emerged in part from our collaboration with Google's OSS-Fuzz and puts affected applications at risk of remote code execution and denial of service attacks.

## Vulnerability Description

The prototype pollution can be initiated via the extend function when option unflat is set. Here is an example:

```
const treekit = require("tree-kit");

treekit.extend({unflat: true}, {}, {'constructor.prototype.polluted': true});
console.log({}.polluted); // prints "true
```
## Impact and Risks

An attacker-controlled object, e.g. data in JSON format received over the network and parsed by the application using tree-kit's extend function, can be used to pollute the prototype of the Object.prototype by adding and overwriting its data and functions. These data and functions will be available in all objects created henceforth.

Depending on the application that uses the tree-kit library, this vulnerability can result in follow-up issues, such as:

* Remote code execution (RCE)
* A denial of service attack (DoS) by overriding some built-in functions (e.g. toString)
* Authentication/validation bypass
* Privilege escalation
* Cross-site scripting (XSS)

## Mitigation and Remediation

The maintainers have already released an update fixing the issue. Versions from 6.10.0 to 7.2.4 are affected and thus vulnerable to Prototype Pollution. We strongly recommend that impacted users upgrade to the newer version that includes the fixes, i.e., version 7.2.4 and above.

## How Did We Find It?

We found the issue by using our JavaScript fuzzer: [Jazzer.js](https://github.com/CodeIntelligenceTesting/jazzer.js). Here is the setup to reproduce the issue using Jazzer.js:

The *fuzz.j*s file:

```
const treekit = require("tree-kit");
module.exports.fuzzFn = function(data) {
    try {
 treekit.extend({ unflat: true }, {}, JSON.parse(data.toString()));
    } catch(e){}
}
```

Notable info in the package.json is the script for running the fuzzer:

```
{
    "scripts": {
        "fuzz": "jazzer fuzz -f fuzzFn -i tree-kit --sync -- -dict=dict.txt"
    },
    "dependencies": {
        "tree-kit": "0.7.4"
    },
    "devDependencies": {
        "@jazzer.js/core": "^1.6.1"
    }
}
```

The extend function expects valid objects that we provide to it using JSON.parse().
However, the fuzzer will usually spend some time finding inputs that result in valid JavaScript objects.
To help the fuzzer, we put this into the dictionary file dict.txt:

```
"{\"test\": {\"property\": \"true\"}}"
```

Running the script with npm run fuzz command results in the following output (“...” means some lines were deleted):

```
> fuzz
> jazzer fuzz -f fuzzFn -i tree-kit --sync -- -dict=dict.txt
...
INFO: Seed: 1508363828
...
#3190   NEW    cov: 71 ft: 71 corp: 3/33b lim: 33 exec/s: 0 rss: 155Mb L: 31/31 MS: 3 InsertByte-EraseBytes-ManualDict- DE: "{\"test\": {\"property\": \"true\"}}"-
#3195   REDUCE cov: 71 ft: 71 corp: 3/32b lim: 33 exec/s: 0 rss: 155Mb L: 30/30 MS: 5 CopyPart-EraseBytes-CopyPart-ChangeBinInt-PersAutoDict- DE: "{\"test\": {\"property\": \"true\"}}"-
#3537   REDUCE cov: 71 ft: 71 corp: 3/29b lim: 33 exec/s: 0 rss: 155Mb L: 27/27 MS: 2 PersAutoDict-EraseBytes- DE: "{\"test\": {\"property\": \"true\"}}"-
#5976   REDUCE cov: 77 ft: 77 corp: 4/63b lim: 43 exec/s: 0 rss: 156Mb L: 41/41 MS: 1 ManualDict- DE: "constructor.prototype"-
...
#17090  REDUCE cov: 82 ft: 101 corp: 15/583b lim: 98 exec/s: 0 rss: 159Mb L: 89/89 MS: 1 EraseBytes-
==3524== Prototype Pollution: Prototype of Object changed. Additional properties in object1: { 'tre0': [object Object] }

MS: 1 ManualDict- DE: "__proto__"-; base unit: 2ccbd755e648bb96a1a46ed5c9b80d7fab5d3e5e
0x7b,0x22,0x63,0x6f,0x6e,0x73,0x2e,0x5f,0x5f,0x70,0x72,0x6f,0x74,0x6f,0x5f,0x5f,0x2e,0x74,0x72,0x65,0x30,0x22,0x3a,0x20,0x7b,0x22,0x70,0x72,0x72,0x22,0x3a,0x20,0x22,0x74,0x61,0x22,0x7d,0x7d,
{\"cons.__proto__.tre0\": {\"prr\": \"ta\"}}
artifact_prefix='./'; Test unit written to ./crash-ba1a28a50be4cbbe5f3f70e965ff37bc7e685a12
Base64: eyJjb25zLl9fcHJvdG9fXy50cmUwIjogeyJwcnIiOiAidGEifX0=
```
## Prototype Pollution Attacks

Prototype pollution vulnerabilities in JavaScript typically involve user-supplied data that is not properly validated or sanitized. By carefully crafting input that influences object creation or manipulation, an attacker can modify the prototype chain and introduce malicious properties or methods. This manipulation can occur in third-party libraries, frameworks, or even custom code.

## References

* More info:<https://nvd.nist.gov/vuln/detail/CVE-2023-38894>
* Release: <https://github.com/cronvel/tree-kit/releases/tag/v0.7.5>
* Commit with fix: <https://github.com/cronvel/tree-kit/commit/61bf10cf0dbddaeea3f198cfe7cb469f360d82bc>

### Acknowledgments

We thank Cédric Ronvel for responding to the issue and providing a quick fix and a new release.

## Related Articles

[![Code Intelligence Logo](https://www.code-intelligence.com/hs-fs/hubfs/Logos/CI%20Logos/Logo_quer_wei%C3%9F-1.png?width=200&height=67&name=Logo_quer_wei%C3%9F-1.png)](/)

**ABOUT CODE**
**INTELLIGENCE**

[Code Intelligence GmbH
Rheinwerkallee 6
53227 Bonn, Germany](https://goo.gl/maps/knocbExjWmSK4XtP7)

[Open Positions](https://www.code-intelligence.com/careers)
[Contact Us](https://www.code-intelligence.com/contact)
[About Us](https://www.code-intelligence.com/about-us)

**Follow Us**

* OUR PRODUCTS
  + [CI Fuzz](https://www.code-intelligence.com/product-ci-fuzz)
  + [Documentation](https://docs.code-intelligence.com/)
  + [Product Demo](https://www.code-intelligence.com/book-a-demo)
* BY INDUSTRY
  + [Automotive](https://www.code-intelligence.com/industry-automotive-landing-page)
  + [Medical Devices](https://www.code-intelligence.com/industry/medical-devices-security)
* OUR SOLUTIONS
  + [Application Security](https://www.code-intelligence.com/solutions-application-security)
  + [Testing Efficiency](https://www.code-intelligence.com/solutions-testing-efficiency)
  + [Vulnerability Detection](https://www.code-intelligence.com/solutions-vulnerability-detection)
  + [ISO 21434 Compliance](https://www.code-intelligence.com/solutions-iso-21434-compliance)
  + [AUTOSAR Simulator](https://www.code-intelligence.com/solutions/autosar-simulator)
* RESOURCES
  + [Blog](https://www.code-intelligence.com/blog)
  + [Webinars](https://www.code-intelligence.com/webinar)
  + [White papers & Checklists](https://www.code-intelligence.com/white-papers-and-checklists)

© 2024 Code Intelligence

* [Imprint](https://www.code-intelligence.com/imprint)
* [Privacy Policy](https://www.code-intelligence.com/privacy)



=== Content from github.com_79293350_20250111_124035.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcronvel%2Ftree-kit)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcronvel%2Ftree-kit)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=cronvel%2Ftree-kit)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[cronvel](/cronvel)
/
**[tree-kit](/cronvel/tree-kit)**
Public

* [Notifications](/login?return_to=%2Fcronvel%2Ftree-kit) You must be signed in to change notification settings
* [Fork
  7](/login?return_to=%2Fcronvel%2Ftree-kit)
* [Star
   29](/login?return_to=%2Fcronvel%2Ftree-kit)

Tree utilities (extend, mask, etc...)

### License

[MIT license](/cronvel/tree-kit/blob/master/LICENSE)

[29
stars](/cronvel/tree-kit/stargazers) [7
forks](/cronvel/tree-kit/forks) [Branches](/cronvel/tree-kit/branches) [Tags](/cronvel/tree-kit/tags) [Activity](/cronvel/tree-kit/activity)
 [Star](/login?return_to=%2Fcronvel%2Ftree-kit)

 [Notifications](/login?return_to=%2Fcronvel%2Ftree-kit) You must be signed in to change notification settings

* [Code](/cronvel/tree-kit)
* [Issues
  0](/cronvel/tree-kit/issues)
* [Pull requests
  0](/cronvel/tree-kit/pulls)
* [Actions](/cronvel/tree-kit/actions)
* [Projects
  0](/cronvel/tree-kit/projects)
* [Wiki](/cronvel/tree-kit/wiki)
* [Security](/cronvel/tree-kit/security)
* [Insights](/cronvel/tree-kit/pulse)

Additional navigation options

* [Code](/cronvel/tree-kit)
* [Issues](/cronvel/tree-kit/issues)
* [Pull requests](/cronvel/tree-kit/pulls)
* [Actions](/cronvel/tree-kit/actions)
* [Projects](/cronvel/tree-kit/projects)
* [Wiki](/cronvel/tree-kit/wiki)
* [Security](/cronvel/tree-kit/security)
* [Insights](/cronvel/tree-kit/pulse)

# cronvel/tree-kit

    master[Branches](/cronvel/tree-kit/branches)[Tags](/cronvel/tree-kit/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[161 Commits](/cronvel/tree-kit/commits/master/) | | |
| [.todo.txt](/cronvel/tree-kit/tree/master/.todo.txt ".todo.txt") | | [.todo.txt](/cronvel/tree-kit/tree/master/.todo.txt ".todo.txt") |  |  |
| [bench](/cronvel/tree-kit/tree/master/bench "bench") | | [bench](/cronvel/tree-kit/tree/master/bench "bench") |  |  |
| [browser](/cronvel/tree-kit/tree/master/browser "browser") | | [browser](/cronvel/tree-kit/tree/master/browser "browser") |  |  |
| [lib](/cronvel/tree-kit/tree/master/lib "lib") | | [lib](/cronvel/tree-kit/tree/master/lib "lib") |  |  |
| [log](/cronvel/tree-kit/tree/master/log "log") | | [log](/cronvel/tree-kit/tree/master/log "log") |  |  |
| [sample](/cronvel/tree-kit/tree/master/sample "sample") | | [sample](/cronvel/tree-kit/tree/master/sample "sample") |  |  |
| [test](/cronvel/tree-kit/tree/master/test "test") | | [test](/cronvel/tree-kit/tree/master/test "test") |  |  |
| [.eslintrc.js](/cronvel/tree-kit/blob/master/.eslintrc.js ".eslintrc.js") | | [.eslintrc.js](/cronvel/tree-kit/blob/master/.eslintrc.js ".eslintrc.js") |  |  |
| [.gitignore](/cronvel/tree-kit/blob/master/.gitignore ".gitignore") | | [.gitignore](/cronvel/tree-kit/blob/master/.gitignore ".gitignore") |  |  |
| [.npmignore](/cronvel/tree-kit/blob/master/.npmignore ".npmignore") | | [.npmignore](/cronvel/tree-kit/blob/master/.npmignore ".npmignore") |  |  |
| [CHANGELOG](/cronvel/tree-kit/blob/master/CHANGELOG "CHANGELOG") | | [CHANGELOG](/cronvel/tree-kit/blob/master/CHANGELOG "CHANGELOG") |  |  |
| [LICENSE](/cronvel/tree-kit/blob/master/LICENSE "LICENSE") | | [LICENSE](/cronvel/tree-kit/blob/master/LICENSE "LICENSE") |  |  |
| [Makefile](/cronvel/tree-kit/blob/master/Makefile "Makefile") | | [Makefile](/cronvel/tree-kit/blob/master/Makefile "Makefile") |  |  |
| [README.md](/cronvel/tree-kit/blob/master/README.md "README.md") | | [README.md](/cronvel/tree-kit/blob/master/README.md "README.md") |  |  |
| [SECURITY.md](/cronvel/tree-kit/blob/master/SECURITY.md "SECURITY.md") | | [SECURITY.md](/cronvel/tree-kit/blob/master/SECURITY.md "SECURITY.md") |  |  |
| [documentation.md](/cronvel/tree-kit/blob/master/documentation.md "documentation.md") | | [documentation.md](/cronvel/tree-kit/blob/master/documentation.md "documentation.md") |  |  |
| [package.json](/cronvel/tree-kit/blob/master/package.json "package.json") | | [package.json](/cronvel/tree-kit/blob/master/package.json "package.json") |  |  |
| [wfm.json](/cronvel/tree-kit/blob/master/wfm.json "wfm.json") | | [wfm.json](/cronvel/tree-kit/blob/master/wfm.json "wfm.json") |  |  |
| View all files | | |

## Repository files navigation

* README
* MIT license
* Security
# Tree Kit

This lib is a toolbox that provide functions to operate with nested `Object` structure.
It features the best `.extend()` method, providing dozen of options that all others libs miss.

* License: MIT
* Current status: release candidate
* Platform: Node.js only (browser support is planned)

Some tutorials are available at [blog.soulserv.net/tag/tree-kit](http://blog.soulserv.net/tag/tree-kit/).

# Install

Use Node Package Manager:

```
npm install tree-kit

```

# Library references

* [.extend()](#ref.extend): full-featured extend facility, copy, clone, extend
* [.clone()](#ref.clone): clone any object
* [.diff()](#ref.diff): report differences between two objects

In all examples below, it is assumed that you have required the lib into the `tree` variable:

```
var tree = require( 'tree-kit' ) ;
```
## .extend( options , target , source1 , [source2] , [...] )

* options `Object` extend options, it supports the properties:
  + own `boolean` only copy enumerable own properties from the sources
  + nonEnum `boolean` copy non-enumerable properties as well, works only with own:true
  + descriptor `boolean` preserve property's descriptor (i.e. writable, enumerable, configurable, get & set)
  + deep: `boolean` or `Array` or `Set`, if true perform a deep (recursive) extend, if it is an Array/Set of prototypes, only deep-copy
    objects of those prototypes (it is a replacement for deepFilter.whitelist which was removed in Tree Kit 0.6)
  + immutables: an Array/Set of immutable object's prototypes that are filtered out for deep-copy (it is a replacement
    for deepFilter.blacklist which was removed in Tree Kit 0.6)
  + circular `boolean` (default to false) if true then circular references are checked and each identical objects are reconnected
    (referenced), if false then nested object are blindly cloned
  + maxDepth `integer` used in conjunction with deep, when the max depth is reached an exception is raised, it defaults to 100
    when the 'circular' option is off, or defaults to null if 'circular' is on
  + move `boolean` move properties from the sources object to the target object (delete properties from the sources object)
  + preserve `boolean` existing properties in the target object will not be overwritten
  + nofunc `boolean` skip properties that are functions
  + deepFunc `boolean` in conjunction with 'deep', this will process sources functions like objects rather than
    copying/referencing them directly into the source (default behaviour), thus, the result will not be a function,
    it forces 'deep' options
  + proto `boolean` alter the target's prototype so that it matches the source's prototype.
    It forces option 'own'. Specifying multiple sources does not make sens here.
  + inherit `boolean` make the target inherit from the source (the target's prototype will be the source itself, not its prototype).
    It forces option 'own' and disable 'proto'. Specifying multiple sources does not make sens here.
  + skipRoot `boolean` prevent the prototype of the target **root** object from mutation.
    Only nested objects' prototype will be mutated.
  + flat `boolean|string` sources properties are copied in a way to produce a *flat* target, the target's key
    is the full path (separated by '.') of the source's key, also if a string is provided it will be used as
    the path separator
  + unflat `boolean|string` it is the opposite of 'flat': assuming that the sources are in the *flat* format,
    it expands all flat properties -- whose name are path with '.' as the separator -- deeply into the target,
    also if a string is provided it will be used as the path separator
* target `Object` the target of the extend, properties will be copied to this object
* source1 `Object` the source of the extend, properties will be copied from this object
* ...

This is a full-featured *extend* of an object with one or more source object.

It is easily translated from jQuery-like *extend()*:

* `extend( target , source )` translate into `tree.extend( null , target , source )`
* `extend( true , target , source )` translate into `tree.extend( { deep: true } , target , source )`

However, here we have full control over what will be extended and how.

**All the options above are inactive by default**.
You can pass null as argument #0 to get the default behaviour (= all options are inactive).
So using the default behaviour, `tree.extend()` will copy all enumerable properties, and perform a shallow copy (a nested object
is not cloned, it remains a reference of the original one).

With the *deep* option, a deep copy is performed, so nested object are cloned too.

The *own* option clone only owned properties from the sources, properties that are part of the source's prototype would not
be copied/cloned.

The *nonEnum* option will clone properties that are not enumerable.

The *descriptor* option will preserve property's descriptor, e.g. if the source property is not writable and not enumerable,
so will be the copied property.

In case of a *getter* properties:

* without the *descriptor* option, the getter function of the source object will be called, the return value will be put
  into the target property (so it lose its getter/setter behaviour)
* with the *descriptor* option, the getter & setter function of the source object will be copied (but not called) into the target
  property: the getter/setter behaviour is preserved

If *circular* is on, the lib will detect when the source's data structure reuses the same object multiple time and will preserve it.
We can see this *circular* feature in action in [this example](#example.circular).

Mixing *inherit* and *deep* provides a nice multi-level inheritance.

With the *flat* option example:

```
var o = {
	one: 1,
	sub: {
		two: 2,
		three: 3
	}
} ;

var flatCopy = tree.extend( { flat: true } , {} , o ) ;
```

... it will produce:

```
{
	one: 1,
	"sub.two": 2,
	"sub.three": 3
}
```

By the way, the *unflat* option does the opposite, and thus can reverse this back to the original form.

The *deepFilter* option is used when you do not want to clone some type of object.
Let's say you want a deep copy except for `Buffer` objects, you simply want them to share the same reference:

```
var o = {
	one: '1' ,
	buf: new Buffer( "My buffer" ) ,
	subtree: {
		two: 2 ,
		three: 'THREE'
	}
} ;

// either
var extended1 = tree.extend( { deep: true, deepFilter: { whitelist: [ Object.prototype ] } } , {} , o ) ;
// or
var extended2 = tree.extend( { deep: true, deepFilter: { blacklist: [ Buffer.prototype ] } } , {} , o ) ;
```

Doing this, we have `o.buf === extended1.buf === extended2.buf`, and `o.subtree !== extended1.subtree !== extended2.subtree`.

## .clone( original , [circular] )

* original `Object` the source object to clone
* circular `boolean` (default to false) if true then circular references are checked and each identical objects are reconnected
  (referenced), if false then nested object are blindly cloned

It returns a clone of the *original* object, providing the best object-cloning facility that this lib can offer.

The clone produced are perfect independant copy **in 99% of use case**, but there is one big limitation:
method that access variables in the parent's scope.

The clone will share those variables with the *original* object, so they are not totally independant entity.
Design pattern using closure to emulate *private member* (e.g. the revealing pattern) can cause trouble.

If *circular* is on, the lib will detect when the source's data structure reuses the same object multiple time and will preserve it.

Here is an example of this *circular* feature:

```
var o = {
	a: 'a',
	sub: {
		b: 'b'
	},
	sub2: {
		c: 'c'
	}
} ;

o.loop = o ;
o.sub.loop = o ;
o.subcopy = o.sub ;
o.sub.link = o.sub2 ;
o.sub2.link = o.sub ;

var c = tree.clone( o , true ) ;

expect( c.loop ).to.be( c ) ;
expect( c.sub ).to.be( c.subcopy ) ;
expect( c.sub.loop ).to.be( c ) ;
expect( c.subcopy.loop ).to.be( c ) ;
expect( c.sub.link ).to.be( c.sub2 ) ;
expect( c.sub2.link ).to.be( c.sub ) ;
```

... without *circular* on, the `clone()` method would run forever, creating a new object independant nested object each time
it reaches the *loop* property.
We can see that the *subcopy* property remains a reference of *sub* even in the clone, thanks to the *circular* option.

However, if we are sure that there isn't multiple reference to the same object or circular references, we can gain a lot of
performances by leaving that options off.
It can save a lot of `.indexOf()` call on big data structure.

This method does not uses `extend()` anymore like in version 0.3.x, it now uses its own optimized code.
However it is equivalent to an `extend()` with those options turned on: *deep, own, nonEnum, descriptor & proto*.
If *circular* is on, it has the same effect than the `extend()`'s *circular* option.

**Also please note that design pattern emulating private members using a closure's scope cannot be truly cloned**
(e.g. the *revealing pattern*).
This is not possible to mutate a function's scope.
So the clone's methods will continue to inherit the parent's scope of the original function.

## .diff( left , right , [options] )

* left `Object` the left-hand side object structure
* right `Object` the right-hand side object structure
* options `Object` containing options, it supports:
  + path `string` the initial path, default: empty string
  + pathSeparator `string` the path separator, default: '.'

This tool reports diff between a left-hand side and right-hand side object structure.
It returns an object, each key is a path where a difference is reported, the value being an object containing (again) the path
and a human-readable message.

See this example:

```
var left = {
	a: 'a',
	b: 2,
	c: 'three',
	sub: {
		e: 5,
		f: 'six',
	}
} ;

var right = {
	b: 2,
	c: 3,
	d: 'dee',
	sub: {
		e: 5,
		f: 6,
	}
} ;

console.log( tree.diff( a , b ) ) ;
```

It will output:

```
{ '.a': { path: '.a', message: 'does not exist in right-hand side' },
  '.c': { path: '.c', message: 'different typeof: string - number' },
  '.sub.f': { path: '.sub.f', message: 'different typeof: string - number' },
  '.d': { path: '.d', message: 'does not exist in left-hand side' } }
```

## About

Tree utilities (extend, mask, etc...)

### Resources

[Readme](#readme-ov-file)
### License

[MIT license](#MIT-1-ov-file)
### Security policy

[Security policy](#security-ov-file)

[Activity](/cronvel/tree-kit/activity)
### Stars

[**29**
stars](/cronvel/tree-kit/stargazers)
### Watchers

[**4**
watching](/cronvel/tree-kit/watchers)
### Forks

[**7**
forks](/cronvel/tree-kit/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fcronvel%2Ftree-kit&report=cronvel+%28user%29)

## [Releases](/cronvel/tree-kit/releases)

[71
tags](/cronvel/tree-kit/tags)

## [Packages 0](/users/cronvel/packages?repo_name=tree-kit)

No packages published

## Languages

* [JavaScript
  98.5%](/cronvel/tree-kit/search?l=javascript)
* [Makefile
  1.5%](/cronvel/tree-kit/search?l=makefile)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


