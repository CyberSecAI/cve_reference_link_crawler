=== Content from github.com_3fba59e3_20250111_151037.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmichaelrsweet%2Fmxml%2Fissues%2F286)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmichaelrsweet%2Fmxml%2Fissues%2F286)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=michaelrsweet%2Fmxml)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[michaelrsweet](/michaelrsweet)
/
**[mxml](/michaelrsweet/mxml)**
Public

* [Notifications](/login?return_to=%2Fmichaelrsweet%2Fmxml) You must be signed in to change notification settings
* [Fork
  165](/login?return_to=%2Fmichaelrsweet%2Fmxml)
* [Star
   455](/login?return_to=%2Fmichaelrsweet%2Fmxml)

* [Code](/michaelrsweet/mxml)
* [Issues
  5](/michaelrsweet/mxml/issues)
* [Pull requests
  2](/michaelrsweet/mxml/pulls)
* [Actions](/michaelrsweet/mxml/actions)
* [Projects
  0](/michaelrsweet/mxml/projects)
* [Security](/michaelrsweet/mxml/security)
* [Insights](/michaelrsweet/mxml/pulse)

Additional navigation options

* [Code](/michaelrsweet/mxml)
* [Issues](/michaelrsweet/mxml/issues)
* [Pull requests](/michaelrsweet/mxml/pulls)
* [Actions](/michaelrsweet/mxml/actions)
* [Projects](/michaelrsweet/mxml/projects)
* [Security](/michaelrsweet/mxml/security)
* [Insights](/michaelrsweet/mxml/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fmichaelrsweet%2Fmxml%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fmichaelrsweet%2Fmxml%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# stack-buffer-overflow and heap-buffer-overflow #286

Closed

[NotmebutWind](/NotmebutWind) opened this issue
Oct 15, 2021
· 7 comments

Closed

# [stack-buffer-overflow and heap-buffer-overflow](#top) #286

[NotmebutWind](/NotmebutWind) opened this issue
Oct 15, 2021
· 7 comments

Assignees
[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=40&v=4)](/michaelrsweet)

Labels
[investigating](/michaelrsweet/mxml/labels/investigating)
Investigating the issue

## Comments

[![@NotmebutWind](https://avatars.githubusercontent.com/u/33690208?s=80&u=553ff0f41067fefcc764c3953c96bbd63b5d0faa&v=4)](/NotmebutWind)

Copy link

### **[NotmebutWind](/NotmebutWind)** commented [Oct 15, 2021](#issue-1027052616)

| Hi,  We have used Mini-xml in our project, so I test v3.2 and master branch and found something:  Fisrt, there are some memory leaks in v3.2 and master:  ``` ================================================================= ==111401==ERROR: LeakSanitizer: detected memory leaks  Direct leak of 6 byte(s) in 1 object(s) allocated from:     #0 in strdup (/opt/mnt/software/mxml32/a.out+0x46f260)     #1 in mxmlSaveAllocString /opt/mnt/software/mxml32/mxml-file.c:227:13     #2 in LLVMFuzzerTestOneInput /opt/mnt/software/mxml32/mxml_fuzzer.cpp:23:8     #3 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/opt/mnt/software/mxml32/a     .out+0x42f357)     #4 in fuzzer::Fuzzer::MutateAndTestOne() (/opt/mnt/software/mxml32/a.out+0x439bc4)     #5 in fuzzer::Fuzzer::Loop(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::a     llocator<char> >, fuzzer::fuzzer_allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<     char> > > > const&) (/opt/mnt/software/mxml32/a.out+0x43b22f)     #6 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/opt/mnt/soft     ware/mxml32/a.out+0x42a5ec)     #7 in main (/opt/mnt/software/mxml32/a.out+0x41d4b2)     #8 in __libc_start_main /build/glibc-S9d2JN/glibc-2.27/csu/../csu/libc-start.c:310  SUMMARY: AddressSanitizer: 6 byte(s) leaked in 1 allocation(s). INFO: to ignore leaks on libFuzzer side use -detect_leaks=0.  ```  and : this is your testmxml.c:  ``` ... Creating libmxml.so.1.6... Creating libmxml.a... a - mxml-attr.o a - mxml-entity.o a - mxml-file.o a - mxml-get.o a - mxml-index.o a - mxml-node.o a - mxml-search.o a - mxml-set.o a - mxml-private.o a - mxml-string.o Compiling testmxml.c Linking testmxml... Testing library...  ================================================================= ==113129==ERROR: LeakSanitizer: detected memory leaks  Direct leak of 88 byte(s) in 1 object(s) allocated from:     #0 in calloc (/opt/mnt/software/mxml32/testmxml+0x4da178)     #1 in mxml_new /opt/mnt/software/mxml32/mxml-node.c:841:15     #2 in mxmlNewElement /opt/mnt/software/mxml32/mxml-node.c:382:15     #3 in mxml_load_data /opt/mnt/software/mxml32/mxml-file.c:1783:14     #4 in mxmlSAXLoadFile /opt/mnt/software/mxml32/mxml-file.c:467:11     #5 in main /opt/mnt/software/mxml32/testmxml.c:676:5     #6 in __libc_start_main /build/glibc-S9d2JN/glibc-2.27/csu/../csu/libc-start.c:310  Indirect leak of 37 byte(s) in 1 object(s) allocated from:     #0 in __interceptor_strdup (/opt/mnt/software/mxml32/testmxml+0x436770)     #1 in mxmlNewElement /opt/mnt/software/mxml32/mxml-node.c:383:32     #2 in mxml_load_data /opt/mnt/software/mxml32/mxml-file.c:1783:14     #3 in mxmlSAXLoadFile /opt/mnt/software/mxml32/mxml-file.c:467:11     #4 in main /opt/mnt/software/mxml32/testmxml.c:676:5     #5 in __libc_start_main /build/glibc-S9d2JN/glibc-2.27/csu/../csu/libc-start.c:310  SUMMARY: AddressSanitizer: 125 byte(s) leaked in 2 allocation(s). Makefile:271: recipe for target 'testmxml' failed make: *** [testmxml] Error 1  ```  also ,we I input an unformed string to mxmlLoadString, there will be a stack-buffer-overflow and heap-buffer-overflow. I think if you add a longth check in mxml\_string\_getc when every pointer change("like (\*s)++"), will be better? Of course Maybe I have use it in a wrong . you can check it here: this is my testcase:  ``` #include <string> #include <vector> #include <assert.h> #include "mxml.h"  extern "C" int LLVMFuzzerTestOneInput(const uint8_t *data, size_t size) {  std::string c(reinterpret_cast<const char *>(data), size);  char *ptr;  mxml_node_t *tree;  tree = mxmlLoadString(NULL, c.c_str(), MXML_NO_CALLBACK);  if(tree){         ptr = mxmlSaveAllocString(tree, MXML_NO_CALLBACK);         if(!ptr) assert(false);         mxmlDelete(tree); }  return 0; }   ```  you can compile your lib with CFLAGS =+ "-g -O0 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address -fsanitize-address-use-after-scope -fsanitize=fuzzer-no-link" and LDFLAGS =+"-fsanitize=fuzzer-no-link -fsanitize=address" and clang++ -g -O1 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address -fsanitize-address-use-after-scope -fsanitize=fuzzer-no-link mxml\_fuzzer.cpp -I ./ -fsanitize=fuzzer ./libmxml.a  run and these are the backtrace:  ``` ================================================================= ==2858==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7ffed9190220 at pc 0x00000055a6f2 bp 0x7ffed918edc0 sp 0x7ffed918edb8 READ of size 1 at 0x7ffed9190220 thread T0     #0 in mxml_string_getc /opt/mnt/software/mxml32/mxml-file.c:2611:16     #1 in mxml_parse_element /opt/mnt/software/mxml32/mxml-file.c:2141:16     #2 in mxml_load_data /opt/mnt/software/mxml32/mxml-file.c:1977:14     #3 in mxmlLoadString /opt/mnt/software/mxml32/mxml-file.c:180:11     #4 in LLVMFuzzerTestOneInput /opt/mnt/software/mxml32/mxml_fuzzer.cpp:12:8     #5 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/opt/mnt/software/mxml32/a.out+0x42f357)     #6 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) (/opt/mnt/software/mxml32/a.out+0x41f7ea)     #7 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/opt/mnt/software/mxml32/a.out+0x42a7b0)     #8 in main (/opt/mnt/software/mxml32/a.out+0x41d4b2)     #9 in __libc_start_main /build/glibc-S9d2JN/glibc-2.27/csu/../csu/libc-start.c:310     #10 in _start (/opt/mnt/software/mxml32/a.out+0x41d529)  ```  ``` ================================================================= ==6265==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x612000000a73 at pc 0x000000558e2d bp 0x7ffe13e2caa0 sp 0x7ffe13e2ca98 READ of size 1 at 0x612000000a73 thread T0     #0 in mxml_string_getc /opt/mnt/software/mxml32/mxml-file.c:2422:13     #1 in mxml_load_data /opt/mnt/software/mxml32/mxml-file.c:1558:20     #2 in mxmlLoadString /opt/mnt/software/mxml32/mxml-file.c:180:11     #3 in LLVMFuzzerTestOneInput /opt/mnt/software/mxml32/mxml_fuzzer.cpp:12:8     #4 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/opt/mnt/software/mxml32/a.out+0x42f357)     #5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) (/opt/mnt/software/mxml32/a.out+0x41f7ea)     #6 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/opt/mnt/software/mxml32/a.out+0x42a7b0)     #7 in main (/opt/mnt/software/mxml32/a.out+0x41d4b2)     #8 in __libc_start_main /build/glibc-S9d2JN/glibc-2.27/csu/../csu/libc-start.c:310     #9 in _start (/opt/mnt/software/mxml32/a.out+0x41d529)   ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=80&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)

Copy link

Owner

### **[michaelrsweet](/michaelrsweet)** commented [Oct 15, 2021](#issuecomment-944315656)

| [@liweiii](https://github.com/liweiii) Note that I do not consider leaks at exit a bug - unfortunately AddressSanitizer on Linux defaults to performing leak checks at exit which often yields false positives. When a process goes away, so does any memory it allocated...  Anyways, if you will kindly provide the input that causes the stack/heap overflow issues I will look into this further. |
| --- |

All reactions

Sorry, something went wrong.

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=40&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)
[michaelrsweet](/michaelrsweet)
self-assigned this
[Oct 15, 2021](#event-5469956147)

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=40&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)
[michaelrsweet](/michaelrsweet)
added
the
[investigating](/michaelrsweet/mxml/labels/investigating)
Investigating the issue
label
[Oct 15, 2021](#event-5469956477)

[![@NotmebutWind](https://avatars.githubusercontent.com/u/33690208?s=80&u=553ff0f41067fefcc764c3953c96bbd63b5d0faa&v=4)](/NotmebutWind)

Copy link

Author

### **[NotmebutWind](/NotmebutWind)** commented [Oct 16, 2021](#issuecomment-944850822) via email

| Hi, I argee with your idea that ASan is check leak that way, but that not mean that leaks occurred when exit! Besides, I didn't use ASan to check ,but LSan, it can report leak when it occurs. Second, I couldn't upload the crash case until Monday, but you can quickly reproduce the crash used my teatcase and compile lines provided in issue.&nbsp; Best Wishes … ------------------&nbsp;原始邮件&nbsp;------------------ 发件人: "michaelrsweet/mxml" \*\*\*@\*\*\*.\*\*\*&gt;; 发送时间:&nbsp;2021年10月15日(星期五) 晚上9:46 \*\*\*@\*\*\*.\*\*\*&gt;; 抄送:&nbsp;"COME WITH \*\*\*@\*\*\*.\*\*\*\*\*\*@\*\*\*.\*\*\*&gt;; 主题:&nbsp;Re: [michaelrsweet/mxml] stack-buffer-overflow and heap-buffer-overflow ([#286](https://github.com/michaelrsweet/mxml/issues/286)) [@liweiii](https://github.com/liweiii) Note that I do not consider leaks at exit a bug - unfortunately AddressSanitizer on Linux defaults to performing leak checks at exit which often yields false positives. When a process goes away, so does any memory it allocated... Anyways, if you will kindly provide the input that causes the stack/heap overflow issues I will look into this further. — You are receiving this because you were mentioned. Reply to this email directly, view it on GitHub, or unsubscribe. Triage notifications on the go with GitHub Mobile for iOS or Android. |
| --- |

All reactions

Sorry, something went wrong.

[![@NotmebutWind](https://avatars.githubusercontent.com/u/33690208?s=80&u=553ff0f41067fefcc764c3953c96bbd63b5d0faa&v=4)](/NotmebutWind)

Copy link

Author

### **[NotmebutWind](/NotmebutWind)** commented [Oct 19, 2021](#issuecomment-946475120)

| Here is the input . I think the reason I have found. leak is because you didn‘’t free the memory. I think if this lib is used in an server or parse a lot of XML ,maybe OOM and crash will occur. overflow is because my input string is not a well-formed XML string. so it's your deal if it's necessery to change the code or tell that only formed strings to use mxmlLoadStrin [crash-71c1bb2443bbb3249e11999ba2d8178a52a7166c.zip](https://github.com/michaelrsweet/mxml/files/7371504/crash-71c1bb2443bbb3249e11999ba2d8178a52a7166c.zip) [crash-3d7f02c2a2b7910101ebf16005e97a8f0bfebb06.zip](https://github.com/michaelrsweet/mxml/files/7371505/crash-3d7f02c2a2b7910101ebf16005e97a8f0bfebb06.zip) g. |
| --- |

All reactions

Sorry, something went wrong.

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=80&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)

Copy link

Owner

### **[michaelrsweet](/michaelrsweet)** commented [Oct 26, 2021](#issuecomment-952209739)

| [@liweiii](https://github.com/liweiii) OK, after testing the current master code, I can't get this to fail. Can you re-test and let me know if the other changes I've made have corrected the issue? |
| --- |

All reactions

Sorry, something went wrong.

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=80&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)

Copy link

Owner

### **[michaelrsweet](/michaelrsweet)** commented [Nov 6, 2021](#issuecomment-962451743)

| Closing as fixed in current master; if you can reproduce on master, please let me know the details! |
| --- |

All reactions

Sorry, something went wrong.

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=40&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)
[michaelrsweet](/michaelrsweet)
closed this as [completed](/michaelrsweet/mxml/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Nov 6, 2021](#event-5578021846)

[![@ghost](https://avatars.githubusercontent.com/u/10137?s=80&v=4)](/ghost)

Copy link

### **[ghost](/ghost)** commented [May 30, 2022](#issuecomment-1140894282)

| Hi,  I'm trying to triage [CVE-2021-42859](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42859) on behalf of Debian. I have been unable to reproduce using the PoC ZIP attached to this issue using version 3.2 as packaged in Debian. (<https://tracker.debian.org/pkg/mxml>)  [@michaelrsweet](https://github.com/michaelrsweet) - if the issue cannot be reproduced, can I ask that you, as upstream, request that the CVE is rejected at <https://cveform.mitre.org/> please? (using the requesting an update of the CVE option) |
| --- |

All reactions

Sorry, something went wrong.

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=80&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)

Copy link

Owner

### **[michaelrsweet](/michaelrsweet)** commented [May 30, 2022](#issuecomment-1141037857)

| [@codehelp](https://github.com/codehelp) Done! |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fmichaelrsweet%2Fmxml%2Fissues%2F286)

Assignees

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=40&v=4)](/michaelrsweet) [michaelrsweet](/michaelrsweet)

Labels

[investigating](/michaelrsweet/mxml/labels/investigating)
Investigating the issue

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=52&v=4)](/michaelrsweet) [![@NotmebutWind](https://avatars.githubusercontent.com/u/33690208?s=52&v=4)](/NotmebutWind)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


