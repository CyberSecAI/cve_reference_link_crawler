

[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20852)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoading…[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20852)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-20852](/browse/XWIKI-20852)

# Groovy jobs check the wrong author, allowing remote code execution

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20852 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  [14.10.9](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+14.10.9 "14.10.9 "), [15.4-rc-1](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+15.4-rc-1 "15.4-rc-1 ")
* **Affects Version/s:**
  1.2 M1
* **Component/s:**
  [Scheduler](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+Scheduler "Scheduler ")
* **Labels:**
  + [attack\_escalation](/issues/?jql=labels+%3D+attack_escalation "attack_escalation")
  + [attacker\_edit](/issues/?jql=labels+%3D+attacker_edit "attacker_edit")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Tests:**
  Unit
* **Difficulty:**
  Unknown
* **Documentation:**
  N/A
* **Documentation in Release Notes:**
  N/A
* **Similar issues:**

#### Description

**Steps to reproduce:**

1. Login as a user without programming right
2. Choose any document whose content has last been changed by a user with programming right on which you have edit right. This could be the user profile for users created by admins.
3. Edit that document using the object editor and add an object of class XWiki.SchedulerJobClass with the following contents:
   * Job name: any name you like
   * Job description: any text
   * Job class: com.xpn.xwiki.plugin.scheduler.GroovyJob
   * Status: Normal
   * Cron expression: 0 0/5 \* \* \* ?
   * Job script: services.logging.getLogger("foo").error("Job content executed")
   * Job execution context user: XWiki.Admin
   * Job execution context lang: en
   * Job execution context database: xwiki
4. Exploit [~~XWIKI-20851~~](https://jira.xwiki.org/browse/XWIKI-20851 "CSRF in the job scheduler") to trigger (or schedule) the job (set the "which" parameter to the document reference of the document on which you've added the job object)

**Expected result:**

The job isn't executed as its author doesn't have programming right and thus no log message is displayed.

**Actual result:**

A message similar to

```
2023-04-18 10:20:00,028 [DefaultQuartzScheduler_Worker-2] ERROR foo                            - Job content executed
```

is displayed in the log. This shows that the Groovy code has been executed.

This shows a privilege escalation from simple edit to programming right. The underlying root cause is that the job executor checks the rights of the content author of the document that contains the job but the job script can be changed without changing the content author.

For the reproduction steps, [~~XWIKI-20851~~](https://jira.xwiki.org/browse/XWIKI-20851 "CSRF in the job scheduler") needs to be exploited to actually execute the job but it is also possible that an admin created a job that is editable by users without programming right, in which case this step wouldn't be necessary.

#### Attachments

#### Issue Links

links to

![Web Link](https://github.com/favicon.ico "Web Link")
[Security Advisory](https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-8xhr-x3v8-rghj)

#### Activity

#### People

Assignee:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Reporter:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Votes:
0
Vote for this issue

Watchers:
1
Start watching this issue

#### Dates

Created:

18/Apr/23 10:27

Updated:

23/Aug/23 14:35

Resolved:

24/Apr/23 17:33

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)

